"use strict";define("selection",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const n=function(e,t,i){this.list=void 0===e.children?e:e.children,this.cache=this.anchor=this.lead=void 0,this.trueValue=void 0===t||t,this.falseValue=void 0!==i&&i};n.prototype={clear:function(){const e=this;i.each(this.list,function(t){t.selected=e.falseValue}),this.cache=this.anchor=this.lead=void 0},deselect:function(e){if(e<0||e>=this.list.length)return!1;const t=this;this.cache=void 0,this.index=this.lead=e,i.each(this.list,function(i,n){n===e&&(i.selected=t.falseValue)})},get:function(){return this.cache||(this.cache=i.where(this.list,{selected:this.trueValue})),this.cache},getAnchor:function(){return this.list[this.anchor]},getLead:function(){return this.list[this.lead]},select:function(e,t,n){if(e<0||e>=this.list.length||t<0||t>=this.list.length)return!1;this.cache=void 0,this.anchor=e,this.lead=t;const s=Math.min(e,t),o=Math.max(e,t),r=this;return i.each(this.list,function(e,t){e.selected=!e.unselectable&&(n&&e.selected===r.trueValue||t>=s&&t<=o)?r.trueValue:r.falseValue}),this.lead},selectNext:function(e,t){let i=this.anchor||0,n=this.lead+(void 0!==t?t:1)||0;for(;n<this.list.length&&this.list[n].unselectable;)n++;if(!(n>=this.list.length))return this.select(e?i:n,n,!1),this.lead},selectPrevious:function(e,t){let i=this.anchor||0,n=this.lead-(void 0!==t?t:1)||0;for(;n>0&&this.list[n].unselectable;)n--;if(!(n<0))return this.select(e?i:n,n,!1),this.lead},selectAll:function(){const e=this.list.length-1;return this.select(0,e,!0),this.lead},toggle:function(e,t,i){i?this.select(void 0!==this.anchor?this.anchor:e,e,!1):t&&this.list[e].selected===this.trueValue?this.deselect(e):this.select(e,e,t)}},t.default=n}),define("services/tw_common",["require","exports","log","moment","reusable_utilities","talkwalker_constants","underscore"],function(e,t,i,n,s,o,r){var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RESIZE="RESIZE",e.OVERRIDE="OVERRIDE",e.RESIZE_CHART="RESIZE_CHART",e.FULL_SCREEN="FULL_SCREEN"}(a=t.WidgetActionButtons||(t.WidgetActionButtons={}));class c{constructor(){this.composedGraphTypes=[o.TypeGraph.AREA,o.TypeGraph.LINE_CHART,o.TypeGraph.COLUMN_CHART],this.composedGraphType="COMPOSED",this.RadarGraphTypes=[o.TypeGraph.RADAR_CHART,o.DataType.RADAR_CHART_ROW_AXES,o.DataType.RADAR_CHART_COLUMN_AXES,"RADAR_CHART_MULTI_METRIC_COLUMN_AXES"],this.RadarGraphConfigs=[o.ConfigurationDefaultsEnum.UUID_CONFIG_RADAR_CHART_ROW_AXES,o.ConfigurationDefaultsEnum.UUID_CONFIG_RADAR_CHART_COLUMN_AXES,"UUID_CONFIG_RADAR_CHART_MULTI_METRIC_COLUMN_AXES"],this.WheelChartGraphConfigs=[o.ConfigurationDefaultsEnum.UUID_CONFIG_PIE_CHART,o.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_PIE_CHART,o.ConfigurationDefaultsEnum.UUID_CONFIG_WHEEL_CHART,o.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_WHEEL_CHART],this.ThemeCloudGraphConfigs=[o.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_CLOUD,o.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_CLOUD_HORIZONTAL],this.InfluencerTableGraphConfigs=[o.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_TABLE_DEFAULT,o.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_DEFAULT],this.ThemeTreeGraphConfigs=[o.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE,o.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_WITH_TRENDS,o.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_ONLY_TRENDS],this.replayTypes=[constants.widget.replayType.animated_cumulative,constants.widget.replayType.animated_discrete],this.nestedWidgetEndPoints={dashboard:"custom_page_widget_dashboards",report:"custom_page_widget_reports"},this.smartThemeTypes=[constants.topic_menu.TYPE.named_entity_types,constants.topic_menu.TYPE.custom_entities],this.predefinedCategoryIds=this.initPredefinedCategoryIds(),this.initializeEnums()}isSmartTheme(e){let t=!1;return e.forEach(e=>{this.smartThemeTypes.indexOf(e.key)>-1&&(t=!0),this.smartThemeTypes.forEach(i=>{e.value.indexOf(i)>=0&&(t=!0)})}),t}initializeEnums(){this.visualizationInitializationStrategy={INSTANT:0,ANIMATED:1},this.widgetHeight={DYNAMIC:-1,TINY:0,SMALL:.5,NORMAL:1,LARGE:2,HUGE:3},this.reloadingStrategy={NONE:"none",DEFAULT:"default",BUBBLE:"bubble",WIDGET:"widget",BUBBLE_NO_FADE:"bubble_no_fade",SPINNER:"spinner"},this.keys=s.Keys,this.state={active:"active",inactive:"inactive"},this.filterTypes={searchBar:"search bar",time:"time"},this.applicationState={Initializing:"initializing",LoadingSkeleton:"loadingSkeleton",LoadingData:"loadingData",LoadingMore:"loadingMore",FatalError:"fatalError",Done:"done"},this.applicationType={MAIN:"MAIN",BUBBLE:"BUBBLE",SINGLE_PAGE_BUBBLE:"SINGLE_PAGE_BUBBLE",MOCK:"MOCK"},this.WidgetBubbleMode={PAGED:"PAGED",SINGLE_PAGE:"SINGLE_PAGED",SINGLE_AND_PAGED:"SINGLE_AND_PAGED",INDEXED_PAGED:"INDEXED_PAGED"},this.PageDataStrategy={CONFIGURATION_BASED:0,SKIP_DATA:1,DOWNLOAD_DATA:2},this.logFeatures={None:{name:"",style:""},FilterStore:{name:"FILTER_STORE",style:""},FilterOptionContainer:{name:"FILTER_OPTION_CONTAINER",style:""},RoutingService:{name:"ROUTING_SERVICE",style:"color:green"},UnitTestUtils:{name:"UNIT_TEST_UTILS",style:"color:green"},Session:{name:"SESSION",style:"color:green"},Application:{name:"APPLICATION",style:"color:green"},IntegrationTest:{name:"INTEGRATION_TEST",style:"color:green"},DirectiveWrapper:{name:"DIRECTIVE_WRAPPER",style:"color:darkgray; font-size:8px"},Broker:{name:"BROKER",style:"color:darkgray; font-size:8px"},Restful:{name:"RESTFUL",style:"color:blue"},SettingsPage:{name:"SETTINGS_PAGE",style:"color:blue"},AbstractWrapper:{name:"PAGE_STATE",style:"color:indigo; font-weight:bold"},PageState:{name:"PAGE_STATE",style:"color:indigo; font-weight:bold"},BubbleDialog:{name:"BUBBLE_DIALOG",style:"color:indigo; font-weight:bold"},AllowedPages:{name:"ALLOWED_PAGES",style:"color:indigo; font-weight:bold"},Page:{name:"PAGE",style:"color:indigo; font-weight:bold"},UserFilterSettings:{name:"UFS",style:"color:indigo; font-weight:bold"},Branding:{name:"BRANDING",style:"color:indigo; font-weight:bold"},Project:{name:"PROJECT",style:"color:indigo; font-weight:bold"},TopicMenu:{name:"TOPIC_MENU_WRAPPER",style:""},TopicEntry:{name:"TOPIC_ENTRY_WRAPPER",style:""},Widget:{name:"WIDGET",style:""},WidgetInitializer:{name:"WIDGET_INITIALIZER",style:""},DataTable:{name:"DATA_TABLE",style:""},Entry:{name:"ENTRY",style:""},BindOnce:{name:"BIND_ONCE",style:""},Navigation:{name:"NAVIGATION",style:""},NavigationParams:{name:"NAVIGATION_PARAMS",style:""},LogService:{name:"LOG_SERVICE",style:""},LogCluster:{name:"LOG_CLUSTER",style:""},Configuration:{global:{name:"CONFIGURATION.GLOBAL",style:""},widget:{base:{name:"CONFIGURATION.WIDGET.BASE",style:""},world_map:{name:"CONFIGURATION.WIDGET.WORLD_MAP",style:""}},BubbleDialog:{base:{name:"CONFIGURATION.BUBBLE_DIALOG.BASE",style:""}}},Debug:{name:"DEBUG",style:""},EventBus:{name:"EVENT_BUS",style:"color: gray; font-weight bold;"},DraggableWidgetsStrategy:{name:"DRAGGABLE_WIDGETS_STRATEGY",style:""},DraggableDashboardsStrategy:{name:"DRAGGABLE_DASHBOARDS_STRATEGY",style:""},DraggableGridStrategy:{name:"DRAGGABLE_GRID_STRATEGY",style:"font-weight: bold"},MultiplexerStrategy:{name:"MULTIPLEXER_STRATEGY",style:"font-weight: bold; color: ForestGreen;"},ResizableGridStrategy:{name:"RESIZABLE_GRID_STRATEGY",style:"font-weight: bold; color: teal;"},ContentStructure:{name:"CONTENT_STRUCTURE_WRAPPER",style:""},ContentStructureEntry:{name:"CONTENT_STRUCTURE_ENTRY_WRAPPER",style:""},SingleSelect:{name:"SINGLE_SELECT",style:""},Searchbar:{name:"SEARCHBAR",style:""},WidgetFactory:{name:"WIDGET_FACTORY",style:""},TimeFilter:{name:"TIME_FILTER",style:""},MockService:{name:"MOCK_SERVICE",style:"color:green;"},DataPlot:{Base:{name:"DATA_PLOT.BASE",style:""},Pie:{name:"DATA_PLOT.PIE",style:""}},MapService:{name:"MAP_SERVICE",style:""},PlotsOverlay:{name:"PLOTS_OVERLAY",style:""},WorldMapWidget:{name:"WORLD_MAP_WIDGET",style:""},Charts:{Elements:{Axis:{name:"CHARTS.ELEMENTS.AXIS",style:""}},PackChart:{name:"CHARTS.PACK_CHART",style:""},Kpi:{name:"CHARTS.KPI",style:""},LineChart:{name:"CHARTS.LINE_CHART",style:""},Composed:{name:"CHARTS.COMPOSED",style:""}},DataGraph:{DataGraphWrapper:{name:"DATA_GRAPH_WRAPPER",style:""},DataGraphCellWrapper:{name:"DATA_GRAPH_CELL_WRAPPER",style:""}},Color:{name:"COLOR",style:""},Drawable:{DrawableTreeNode:{name:"DRAWABLE.DRAWABLE_TREE_NODE"}},TableWrapper:{name:"TABLE_WRAPPER",style:""},InfluencerProfile:{name:"INFLUENCER_PROFILE",style:""},BoundingBox:{name:"BOUNDING_BOX",style:""},IconsService:{name:"ICONS_SERVICE",style:""},ThemeCloud:{name:"THEME_CLOUD",style:""},SummaryWrapper:{name:"SUMMARY_WRAPPER",style:""},DataPlotFactory:{name:"DATA_PLOT_FACTORY",style:""},Articles:{name:"Articles",style:""},Comments:{name:"COMMENTS",style:"color:purple"},ItemPool:{name:"ITEM_POOL",style:"color: yellow; background-color: #222;"},MultiMetrics:{name:"MULTI_METRICS",style:""},CommandCenter:{name:"COMMAND_CENTER",style:"color: orange; background-color: #222;"},Grid:{name:"GRID",style:"color: #ff00ff; background-color: #333;"},OpenlayersMap:{name:"OPEN_LAYERS_MAP",style:"color: #ffa500"},AiEngine:{name:"AI_ENGINE",style:"color: #00cc00"},WidgetSizeCalculator:{name:"WidgetSizeCalculator",style:"color:green;"}},this.TimeFormat={ShortDate:"D MMM"},this.sides={TOP:"TOP",RIGHT:"RIGHT",BOTTOM:"BOTTOM",LEFT:"LEFT",CENTER:"CENTER",CENTER_LEFT:"CENTER_LEFT",CENTER_RIGHT:"CENTER_RIGHT"},this.corners={TOP_RIGHT:"TOP_RIGHT",BOTTOM_RIGHT:"BOTTOM_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",TOP_LEFT:"TOP_LEFT"},this.widgetActionButtons=a,this.selectionConstraintStrategies={AND:"CONSTRAINT_AND",OR:"CONSTRAINT_OR",XOR:"CONSTRAINT_XOR"},this.selectionStrategies={MULTIPLE:"MULTIPLE",MULTIPLE_INVERTED:"MULTIPLE_INVERTED",SINGLE:"SINGLE",OPPOSITE:"OPPOSITE",SINGLE_AND_MULTIPLE:"SINGLE_AND_MULTIPLE",SINGLE_OR_MULTIPLE:"SINGLE_OR_MULTIPLE",TOPIC_PM_COMPOSED_SELECTION:"TOPIC_PM_COMPOSED_SELECTION",TOPIC_PM_COMPOSED_SELECTION_MIXED:"TOPIC_PM_COMPOSED_SELECTION_MIXED"},this.TopicEntryVisbilityStrategy={NO_DUPLICATES:"NO_DUPLICATES",ALL:"ALL"},this.wmLoadingBehaviours={NONE:0,REDRAW:1,RELOAD:2},this.holderTypes={PAGE:0,WIDGET:1},this.Origin={Location:{INSIDE:"inside",OUTSIDE:"outside"},TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_RIGHT:"top right",TOP_LEFT:"top left",BOTTOM_RIGHT:"bottom right",BOTTOM_LEFT:"bottom left",CENTER:"Center"},this.ContainerType={RECTANGLE:"rectangle"},this.Mouse={State:{Neutral:"Neutral",Left:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"},Wheel:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"},Right:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"}},Buttons:{Left:0,Wheel:1,Right:2}},this.InfluencerTableViewMode={MOST_ACTIVE_AUTHORS:"MOST_ACTIVE_AUTHORS",MOST_INFLUENTIAL_AUTHORS:"MOST_INFLUENTIAL_AUTHORS",MOST_ACTIVE_SITES:"MOST_ACTIVE_SITES",MOST_ENGAGED_SITES:"MOST_ENGAGED_SITE"}}getFunctionName(e){const t=e.toString().substr("function ".length);return t.substr(0,t.indexOf("("))}isBrowserFullScreen(){return Math.abs(window.innerHeight-screen.height)<=3}formatNumberMinSize(e,t){let i=t-e.toString().length,n=e.toString();for(;i>0;)n="0"+n,i--;return n}flash(e,t,i){const n=i,s=e.css("background");let o=0;const r=setInterval(()=>{e.css("background","rgba("+t.r+","+t.g+","+t.b+","+Math.abs(Math.sin(o))+")"),o+=46/n,i<=0&&(e.css("background",s),clearInterval(r)),i-=15},15)}formatTimestamp(e,t){return this.isMidnight(e)?n(e).format(this.TimeFormat.ShortDate):n(e).format(t)}isMidnight(e){const t=n(e);return 0===t.hours()&&0===t.minutes()&&0===t.seconds()}formatNumberValue(e){return constants.number_format.indexOf(".")>constants.number_format.indexOf(",")?e.toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(","):e.toString().split(/(?=(?:\d{3})+(?:,|$))/g).join(".")}mediaTypeToPageMonitoring(e){let t;switch(e){case"SOCIALMEDIA_FACEBOOK":t="MONITORED_CATEGORY|fb";break;case"SOCIALMEDIA_TWITTER":t="MONITORED_CATEGORY|tw";break;case"SOCIALMEDIA_INSTAGRAM":t="MONITORED_CATEGORY|ig";break;case"SOCIALMEDIA_YOUTUBE":t="MONITORED_CATEGORY|yt";break;case"SOCIALMEDIA_DAILYMOTION":t="MONITORED_CATEGORY|dm";break;case"SOCIALMEDIA_FLICKR":t="MONITORED_CATEGORY|fl";break;case"SOCIALMEDIA_FOURSQUARE":t="MONITORED_CATEGORY|fs";break;case"SOCIALMEDIA_GOOGLEPLUS":t="MONITORED_CATEGORY|gp";break;case"SOCIALMEDIA_LINKEDIN":t="MONITORED_CATEGORY|li";break;case"SOCIALMEDIA_MIXCLOUD":t="MONITORED_CATEGORY|mc";break;case"SOCIALMEDIA_SOUNDCLOUD":t="MONITORED_CATEGORY|sc";break;case"SOCIALMEDIA_VIMEO":t="MONITORED_CATEGORY|vi";break;case"SOCIALMEDIA_WEIBO":t="MONITORED_CATEGORY|wb";break;case"SOCIALMEDIA_DOUBAN":t="MONITORED_CATEGORY|db";break;default:return}return t}isPointOnElement(e,t){return i.logService.assert(void 0!==e,"point is required"),i.logService.assert(void 0!==t,"element is required"),e.x>=Math.floor(t.offset().left)-window.pageXOffset&&e.y>=Math.floor(t.offset().top)-window.pageYOffset&&e.x<=Math.floor(t.offset().left)-window.pageXOffset+t.outerWidth()&&e.y<=Math.floor(t.offset().top)-window.pageYOffset+t.outerHeight()}generateUuid(){return Math.floor(268435456*(1+Math.random()))}extractProtocol(e){return 0===e.indexOf("https")?"https":0===e.indexOf("http")?"http":void 0}hashString(e){return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)}getPageBounds(){let e=$("#wrapper");return 0===e.length&&(e=$("body")),e.length>0?{left:window.pageXOffset+e.offset().left,top:window.pageYOffset,bottom:window.pageYOffset+$(window).outerHeight(),right:window.pageXOffset+Math.min(e.width(),$(window).outerWidth())+e.offset().left}:{left:window.pageXOffset,top:window.pageYOffset,bottom:window.pageYOffset+$(window).outerHeight(),right:window.pageXOffset+$(window).outerWidth()}}isElementOnScreen(e,t,i,n,s){n=n||2e5,s=s||2e5,t=t||0,i=i||0;const o=e[0].getBoundingClientRect();let r=o.width,a=o.height;return o.top<0&&(a+=o.top),o.left<0&&(r+=o.left),o.bottom>=window.innerHeight&&(a-=o.bottom-window.innerHeight),o.right>=window.innerWidth&&(r-=o.right-window.innerWidth),(r>=n||r>=(1-t)*o.width)&&(a>=s||a>=(1-i)*o.height)}isElementOffScreen(e){const t=e[0].getBoundingClientRect();return t.top>=window.innerHeight||t.bottom<=0||t.left>=window.innerWidth||t.right<=0}isPredefinedCategory(e){return r.contains(this.predefinedCategoryIds,e)}isDefaultCustomPageGroup(e){const t=e.split("|"),i=t[t.length-1];return r.contains(constants.custom_page.group.default_id,i)}initPredefinedCategoryIds(){return r.chain(constants.predefined_category).values().map(e=>r.values(e)).flatten().map(e=>e.mapped_id).value()}extractAxisYLabel(e,t){const i=e.payloadDataGraph;return i.total_label?i.total_label:t}}t.default=c,function(e){e[e.INSTANT=0]="INSTANT",e[e.ANIMATED=1]="ANIMATED"}(t.WidgetAnimationStrategy||(t.WidgetAnimationStrategy={})),t.twCommon=new c}),define("services/broker",["require","exports","log","underscore","services/tw_common"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.id=0,this.topics={},this.traces={}}subscribe(e,t,n){return i.logService.assert(void 0!==t,"callback is required",s.twCommon.logFeatures.Broker),this._subscribe(this.topics,e,t,n)}_subscribe(e,t,n,s){const o=i.logService.getStackTrace(1).split("\n")[0].trim();e[t]||(e[t]={}),e[t][this.id]=n,this.traces[t]||(this.traces[t]={}),this.traces[t][this.id]="subscribed "+o;const r=this.id++;return s&&s.registerCleanupFunction(()=>this.unsubscribe(t,r)),r}unsubscribe(e,t){i.logService.assert(n.isString(e),"Topic must be a string",s.twCommon.logFeatures.Broker),i.logService.assert(n.isNumber(t),"id must be a number",s.twCommon.logFeatures.Broker),this._unsubscribe(this.topics,e,t)}_unsubscribe(e,t,n){return i.logService.log({message:"topic "+t+" was unsubscribed",feature:s.twCommon.logFeatures.Broker,logLevel:i.logLevel.VERBOSE,trace:!0}),this.traces[t]&&this.traces[t][n]&&delete this.traces[t][n],!(!e[t]||!e[t][n])&&delete e[t][n]}publish(e,t){i.logService.debug(["broker event fired:"+e,i.logService.getStackTrace()+"\n"].concat(Object.values(this.traces[e]||{})),s.twCommon.logFeatures.Broker);const n=i.logService.startTimer(s.twCommon.logFeatures.Broker);for(const i of Object.values(this.topics[e]||{}))i.apply(void 0,[].concat(t));i.logService.endTimer(n,100,"Broker took too long to process event "+e,t)}},Object.defineProperty(t,"brokerService",{get:function(){return window.tw.inject("brokerService")}})}),define("classes/data_set/data_set",["require","exports","lazy","d3","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){this.metaData={color:t.color,additional_info:t.additional_info,code:t.code,filter:t.filter,function:t.function,label:t.label,tooltip:t.tooltip};const o=[];if(t.cells.forEach(function(i,n){if(s.isUndefined(i.value)||i.value.value===constants.data_graph.value_not_accessible)return;const r=s.extend({},i,{row:t,column:e[n]});r.value.value&&(r.value.value=parseFloat(r.value.value),r.value.value_old=s.isUndefined(r.value.value_old)?0:parseFloat(r.value.value_old),o.push(r))}),this.items=o,0!==this.items.length){this.row=this.items[0].row;const e=i(this.items).filter(function(e){return void 0===e.column.cut_off_type}).reduce(function(e,t){return e.old.push(t.value.value_old),e.new.push(t.value.value),e},{old:[],new:[]});this.extent=n.extent(e.new),this.total=n.sum(e.new),this.total_old=n.sum(e.old)}}}),define("components/tools/data_graph",["require","exports","classes/data_set/data_set","lazy","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o="=";function r(e){this.payloadDataGraph=e;const t=this;n(e).keys().each(function(i){"rows"!==i&&"column_groups"!==i&&(t[i]=e[i])})}function a(e){const t=JSON.parse(JSON.stringify(e.value));return Object.keys(e).forEach(function(i){"value"!==i&&(t[i]=e[i])}),t}function c(e,t){const i=e,n=i&&i.rows?i.rows.length:0;this._currentIdx=t?n-1:0,this._done=n<=0,this.next=function(){return!this._done&&(this.index=this._currentIdx,this.current=i.rows[this._currentIdx],this._currentIdx=this._currentIdx+(t?-1:1),(t&&this._currentIdx<0||!t&&this._currentIdx>=n)&&(this._done=!0),[this.index,this.current])},this.cellIterator=function(){return new function(e){this._currentIdx=0;const t=e;this._done=!(t&&t.cells&&t.cells.length>0),this.next=function(){return!this._done&&(this.index=this._currentIdx,this.current=a(t.cells[this._currentIdx]),this._currentIdx+=1,this._currentIdx>=t.cells.length&&(this._done=!0),[this.index,this.current])}}(this.current)}}r.prototype._ensureColsInited=function(){let e;this.allCols||(e=[],void 0!==this.payloadDataGraph.column_groups&&(this.payloadDataGraph.column_groups.forEach(function(t){let i;if(t.data_columns&&t.data_columns.length>1){i={name:t.name_group};const n=t.data_columns.map(function(e){return e.parent=i,e});i.children=n,e=e.concat(n)}else e.push(t.data_columns[0])}),this.allCols=e))},r.prototype.getRowsLength=function(){return this.getRows().length},r.prototype.getRows=function(){return this.payloadDataGraph.rows},r.prototype.getRow=function(e){return e<0||e>=this.getRowsLength()?void 0:this.getRows()[e]},r.prototype.getCell=function(e,t){return void 0===e||void 0===t||t<0||t>=e.cells.length?void 0:a(e.cells[t])},r.prototype.getColumns=function(){return this._ensureColsInited(),this.allCols},r.prototype.isValueOldAvailable=function(){return 0!==this.getRowsLength()&&void 0!==this.getRow(0).cells&&s.isFinite(this.getRow(0).cells[0].value.value_old)},r.prototype.isClickable=function(){return this.clickable},r.prototype.getGroupPage=function(){return this.payloadDataGraph.group_page},r.prototype._initTotalSubtotalRow=function(){const e=new c(this.payloadDataGraph,!0);let t=this.getRowsLength()-1;for(;e.next()&&("total"===e.current.type?this._totalRowIdx=t:"subtotal"===e.current.type&&(this._subtotalRowIdx=t),!this._totalRow||!this._subtotalRow);)t--},r.prototype.getTotalRowIdx=function(){return this._initTotalSubtotalRow(),this._totalRowIdx},r.prototype.getSubtotalRowIdx=function(){return this._initTotalSubtotalRow(),this._subtotalRowIdx},r.prototype.rowIterator=function(){return new c(this.payloadDataGraph,!1)},r.prototype.sortByColumn=function(e){return!(e<0||e>=this.getColumns().length)&&(this.payloadDataGraph.rows=n(this.getRows()).sortBy(function(t){return Number(t.cells[e].value.value)}).value(),!0)},r.prototype.reorderColumnsByRow=function(e){let t;return!(e<0||e>=this.getRowsLength())&&(t=n(this.getRow(e).cells).map(function(e,t){return{value:e.value.value,index:t}}).sortBy(function(e){return e.value},!0).pluck("index").value(),this.allCols=s(this.allCols).sortBy(i),s(this.getRows()).each(function(e){e.cells=n(e.cells).sortBy(i).value()}),!0);function i(e,i){return n(t).indexOf(i)}},r.constructor.parseFilters=function(e){return void 0===e?[]:e.split(";").map(function(e){const t=e.split(o),i=t[0],n=t.slice(1).join(o);return{key:i,value:n,toString:function(){return i+":"+n}}})},r.prototype.getRowFilters=function(e){return void 0===e||e>=this.getRowsLength()?void 0:r.constructor.parseFilters(this.getRow(e).filter)},r.prototype.getRequestPageType=function(e,t){const i=this.getRow(e),n=this.getCell(i,t),s=this.getColumns()[t];return void 0!==n&&n.requested_page_type?n.requested_page_type:void 0!==i&&i.requested_page_type?i.requested_page_type:void 0!==s&&s.requested_page_type?s.requested_page_type:void 0},r.prototype.getColumnFilters=function(e){return void 0===e||e>=this.getColumns().length?void 0:r.constructor.parseFilters(this.getColumns()[e].filter)},r.prototype.getCellFilters=function(e,t){if(!(void 0===e||void 0===t||e>=this.getRowsLength()||t>=this.getColumns().length)){const i=this.getCell(this.getRow(e),t);return r.constructor.parseFilters(i.filter)}},r.constructor.buildEventFromDataEvent=function(e){return r.constructor.buildEvent(e.title,e.date,e.start,e.end)},r.constructor.buildEvent=function(e,t,i,n){return{title:e,date:t,start:i,end:n,toString:function(){return e+":"+t}}},r.prototype._ensureEvetnsInited=function(){if(!this.allEvents){const e=[];if(void 0===this.payloadDataGraph.events)return[];this.payloadDataGraph.events.forEach(function(t){e.push(r.constructor.buildEventFromDataEvent(t))}),this.allEvents=e}},r.prototype.getEvents=function(){return this._ensureEvetnsInited(),this.allEvents},r.prototype.getPreviousPeriodMappedId=function(){return this.payloadDataGraph.previous_period_mapped_id?this.payloadDataGraph.previous_period_mapped_id:null},r.constructor.DataGraphIdx=function(e,t){return{rowIdx:e,cellIdx:t}},r.prototype.extractData=function(){return this.getRows().map(function(e){return new i.default(this.getColumns(),e)},this)},r.prototype.getVelocityChartModel=function(){const e=this.extractData(),t={x_axis_name:this.x_axis_name,y_axis_label:this.total_label};return{dataSets:e,columns:this.getColumns(),axisLabels:t,metaData:this.meta_data}},r.prototype.getAnimationFrameCount=function(){const e=this.meta_data;return e&&e.attributes&&e.attributes.number_of_animation_frames||0},r.prototype.getAdditionalFrames=function(){return this.additional_frames},r.prototype.hasAdditionalFrames=function(){return this.getAdditionalFrames()&&this.getAdditionalFrames().length>0},r.prototype.hasNestedFrames=function(){if(this.hasAdditionalFrames()){const e=this.getAdditionalFrames()[0].meta_data,t=constants.data_graph.meta_data.attributes.dataframe_type.nested;return void 0!==e&&void 0!==e.attributes&&e.attributes.dataframe_type===t}return!1},r.prototype.hasAnimationFrames=function(){if(this.hasAdditionalFrames()){const e=this.getAdditionalFrames()[0].meta_data;return Boolean(void 0!==e&&e.attributes.animation_timeframe)}return this.getAnimationFrameCount()>0},r.prototype.hasIndicatorFrames=function(){return this.hasAdditionalFrames()&&!this.hasAnimationFrames()&&!this.hasNestedFrames()},r.prototype.getDatasetFrame=function(){return this.hasAdditionalFrames()&&this.getAdditionalFrames()[0]},r.prototype.getDataFrameType=function(){return this.meta_data&&this.meta_data.attributes.dataframe_type},r.prototype.isNestedDataFrame=function(){const e=constants.data_graph.meta_data.attributes.dataframe_type.nested;return this.getDataFrameType()===e},r.prototype.isExternalDataFrame=function(){const e=constants.data_graph.meta_data.attributes.dataframe_type.external;return this.getDataFrameType()===e},r.prototype.mergeIndicatorFrames=function(){const e=JSON.parse(JSON.stringify(this));if(!this.hasIndicatorFrames()&&!this.hasNestedFrames())return e;const t=this.getDatasetFrame(),i=e.payloadDataGraph.rows.map(function(t){return t.clickable=e.clickable,t}),n=Math.min(...i.map(e=>e.cells.length)),s=t.rows.map(function(e){return e.clickable=t.clickable,e.cells.length=Math.min(e.cells.length,n),e});return e.payloadDataGraph.rows=i.concat(s),new r(e.payloadDataGraph)},r.prototype.getComments=function(){return[...this.comments,...this.additional_frames&&this.additional_frames[0]&&this.additional_frames[0].comments||[]]},r.prototype.getCommentsWithMarkers=function(e){let t=0;return s(this.getComments()).chain().filter(function(t){return!e||!0===t.pinned}).sortBy(function(e){return parseInt(e.timestamp)}).value().map(function(e){return e.pinned&&(e.marker=String.fromCharCode("a".charCodeAt(0)+t),t++),e})},r.prototype.hasComments=function(){return!s.isUndefined(this.getComments())&&this.getComments().length>0},r.prototype.findComment=function(e,t){if(this.hasComments())return s.find(this.getComments(),function(i){return i.row_key===e&&i.timestamp===t})},r.prototype.mergeComments=function(e){e&&0!==e.length&&(this.hasComments()?this.comments=s.reduce(e,function(e,t){return s.find(e,function(e){return e.id===t.id||e.row_key===t.row_key&&e.timestamp===t.timestamp})||e.push(t),e},this.comments):this.comments=e)},r.prototype.hasNegativeValues=function(){return s(this.extractData()).some(function(e){const t=e.extent;return t&&t[0]<0})},t.default=r}),define("configuration/application/base",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{canShowWidgetTitle(){return!0}isWidgetActionAllowed(e,t){return!_.contains(t.getWidgetSettings().forbiddenWidgetActions,e)}isWidgetMenuAllowed(e){return!0}widgetShowResultCount(){return!1}showWidgetFirstLoadingBubble(){return!0}}t.default=i,t.baseApplicationConfiguration=new i}),define("components/form/common/topic_menu",["require","exports","underscore","common_constants"],function(e,t,i,n){function s(e,t){t!==n.topic_entry.selected.none||i.isUndefined(e.hits)||(e.hits=0),i(e.children).each(e=>{e.selected=t,e.children&&s(e,t)})}function o(e,t,n,s){i(e.children).each(e=>{if(n&&!0===n){const i=JSON.parse(JSON.stringify(e));s&&(i.selected=s),t.push(i)}else t.push(e);e.children&&o(e,t,n,s)})}function r(e,t,n,s){i(e.children).each(e=>{if(void 0===e.children||null===e.children||0===e.children.length)if(n&&!0===n){const i=JSON.parse(JSON.stringify(e));s&&(i.selected=s),t.push(i)}else t.push(e);e.children&&r(e,t,n,s)})}function a(e,t){let n=!1,s=[];return i(e.children).each(o=>{s=[],o.mapped_id===t.mapped_id&&(n=!0),n||function e(t,n,s,o){i(t.children).each(t=>{const r=[];i(o).each(e=>{r.push(e)}),t.mapped_id===n.mapped_id&&i(o).each(e=>{s.push(e)}),t.children&&(r.push(t),e(t,n,s,r))})}(e,t,s)}),s}function c(e,t){if(e.mapped_id===t)return e;if(e.children)for(let i=0;e.children&&i<e.children.length;i++){const n=c(e.children[i],t);if(null!==n)return n}return null}function l(e,t){if(e.children&&i(e.children).findWhere({mapped_id:t}))return e;if(e.children)for(let i=0;e.children&&i<e.children.length;i++){const n=l(e.children[i],t);if(null!==n)return n}return null}function d(e,t){let i=!1,n=e.children.length;for(;n--;)e.children[n].mapped_id===t?(e.children.splice(n,1),i=!0):e.children[n].children&&(i=d(e.children[n],t)||i);return i}function g(e){let t=!1;if(void 0!==e)for(let i=0;i<e.length;i++){if(e[i].selected===n.topic_entry.selected.node){t=!0;break}if(e[i].children&&(t=g(e[i].children)))break}return t}function u(e){if(e.selected===n.topic_entry.selected.node)return e;if(e.children)for(let t=0;t<e.children.length;t++){const i=u(e.children[t]);if(i)return i}return null}function p(e){if(!i.isUndefined(e)){const t=[];o(e.root_entry,t),i(t).each(function(e){delete e.filter_hits})}}return{recursiveUnselectAndSelect:function(e,t){e&&i(e.children).each(e=>{e.mapped_id!==t?e.selected=n.topic_entry.selected.none:e.selected=n.topic_entry.selected.node})},recursiveUnselectAndToggle:function(e,t){e&&i(e.children).each(e=>{e.mapped_id!==t?e.selected=n.topic_entry.selected.none:e.selected===n.topic_entry.selected.none?e.selected=n.topic_entry.selected.node:e.selected=n.topic_entry.selected.none})},compareTopicMenu:function(e,t){return e.name<t.name?-1:e.name>t.name?1:0},removeTopicEntry:d,pruneTopicEntryKeepingSelection:function(e,t){const n=[];return i(e).each(e=>{const s=i.findWhere(n,{mapped_id:e.mapped_id});s?e.selected===t&&(s.selected=t):n.push(e)}),n},findTopicEntry:c,findTopicEntryParent:l,getSelectedValue:function(e){let t=null;return e&&i(e.children).each(e=>{e.selected===n.topic_entry.selected.node&&(t=e)}),t},changeEntryParent:function(e,t,i){if(l(e,t.mapped_id).mapped_id===i)return;d(e,t.mapped_id);const n=c(e,i);n.children?n.children.push(t):n.children=[t]},getSelectedBranchRecursive:function(e,t,i){if(i||(i=" "),!e||!e.children)return e.selected===n.topic_entry.selected.node?t(e):void 0;for(const s in e.children)if(e.children.hasOwnProperty(s)){const o=e.children[s];if(o.selected===n.topic_entry.selected.node||this.getSelectedBranchRecursive(o,t,i))return t(e)?t(e)+i+this.getSelectedBranchRecursive(o,t,i):this.getSelectedBranchRecursive(o,t,i)}},getSelectedValueRecursive:function(e){let t;if(e&&e.children)for(const i in e.children)if(e.children.hasOwnProperty(i)){const s=e.children[i];if(void 0!==(t=s.selected===n.topic_entry.selected.node?s:this.getSelectedValueRecursive(s)))break}return t},retrieveLeaves:function(e,t,n){const s=[];return i(e).each(e=>{i(e.children).each(e=>{r(e,s,t,n)})}),s},retrieveLeavesMappedIds:function(e){const t=[],n=[];return r(e,t),i(t).each(e=>{n.push(e.mapped_id)}),n},retrieveAllChildrenOnChildren:function(e,t,n){const s=[];return i(e).each(e=>{i(e.children).each(e=>{o(e,s,t,n)})}),s},retrieveAllChildrenOnElement:function(e,t,n,s){let r=[];if(i(e.children).each(e=>{o(e,r,t,n)}),s){const e=[],t=[];i(r).each(n=>{-1===i(e).indexOf(n.mapped_id)&&(e.push(n.mapped_id),t.push(n))}),r=t}return r},unselectParentAndChildren:function(e,t){const o=a(e,t);i(o).each(e=>{e.selected=n.topic_entry.selected.none}),s(t,n.topic_entry.selected.none)},recursiveChildrenSelect:s,checkLvlParentSelect:function(e,t,o){let r=!0;return o?i(e.children).each(e=>{e.children[0].selected===t&&(r=!1)}):i(e.children).each(e=>{e.selected===t&&(r=!1)}),r&&(e.selected=n.topic_entry.selected.node,t===n.topic_entry.selected.none&&(o?i(e.children).each(e=>{e.children[0].selected=n.topic_entry.selected.none,e.children[1].selected=n.topic_entry.selected.node}):s(e,n.topic_entry.selected.none))),r},childrenSelected:function(e){if(e.children){let t=!0;for(let i=0;i<e.children.length;i++)if(e.children[i].selected===n.topic_entry.selected.node){t=!1;break}return!t}return!1},createSubSetOfTopicMenu:function(e){const t={};return function e(t,n){return function(e,t){e.mapped_id=t.mapped_id,e.name=t.name,e.hits_text=t.hits_text,e.selection_type=t.selection_type,e.topic_add=t.topic_add,e.topic_behaviour=t.topic_behaviour,e.visibility=t.visibility,e.children_ordering_available=t.children_ordering_available,e.collapsed=t.collapsed}(n,t),t.children&&(n.children=[],i(t.children).each(t=>{let i={};i=e(t,i),n.children.push(i)})),n}(e.root_entry,t),{root_entry:t}},getTopicMenuByType:function(e,t){const n=i(e).where({type:t});return n?n[0]:void 0},childrenSelectedRecursive:g,iconType:function(e){return e?e.children?g(e.children)?"open":"closed":"":void 0},getTwoLevelFlatList:function(e){const t=[];return e.children&&i(e.children).each(e=>{e.children?i(e.children).each(i=>{i.name=`${e.name} ${i.name}`,t.push(i)}):t.push(e)}),t},recursiveSelectFirstSelectableEntry:function e(t,i){if(void 0!==i&&i===t.mapped_id)t.selected=n.topic_entry.selected.node;else if(1===t.children.length){const i=e(t.children[0],t.children[0].mapped_id);t.children=[i]}else if(t.children&&t.children.length>0){let n=[],s=!1;for(let o=0;o<t.children.length;o++){const r=t.children[o];if(r.children&&1===r.children.length&&!s){s=!0;const t=e(r,i);n.push(t)}else n.push(r)}t.children=n}return t},isAnyEntrySelected:function(e){return!i.isUndefined(e)&&(e.root_entry.selected===n.topic_entry.selected.node||g(e.root_entry.children))},levelFullySelected:function(e){let t=!0;const n=i.isUndefined(e.children)?e:e.children;for(let e=0;e<n.length;e++)if(n[e].selected!==constants.topic_entry.selected.node){t=!1;break}return t},levelFullyUnselected:function(e){let t=!0;const n=i.isUndefined(e.children)?e:e.children;for(let e=0;e<n.length;e++)if(n[e].selected===constants.topic_entry.selected.node){t=!1;break}return t},hasSecondLevelChildren:function(e){return e&&e.children&&e.children[0]&&e.children[0].children&&e.children[0].children.length>0},recursiveResetHits:function e(t){i.isUndefined(t.hits)||(t.hits=0),t.children&&i(t.children).each(t=>e(t))},toggle:function(e){e.selected===n.topic_entry.selected.none?e.selected=n.topic_entry.selected.node:e.selected=n.topic_entry.selected.none},getFirstSelectableEntry:function(e,t,i){if(e.children&&t===n.topic_menu.TYPE.dashboard)return function(e,t){for(let i=0;i<e.children.length;i++){const s=e.children[i];if(t.edit_mode&&0===i)return s;if(s.visibility===n.topic_entry.visibility.visible)return s}}(e,i)},numFirstLevelSelections:function(e){return i(e.children).reduce(function(e,t){return t.selected===n.topic_entry.selected.node?++e:e},0)},getFirstSelectedEntry:u,getFirstSelectedMappedId:function(e){const t=u(e);return t?t.mapped_id:""},getSelectedEntries:function(e){const t=[];return function e(t,s){!i.isUndefined(t.children)&&t.children.length>0&&i(t.children).each(t=>{t.selected===n.topic_entry.selected.node?s.push(t):e(t,s)})}(e,t),t},getUnselectedEntries:function(e){const t=[];return function e(t,s){!i.isUndefined(t.children)&&t.children.length>0&&i(t.children).each(t=>{void 0===t.selected||t.selected===n.topic_entry.selected.none?s.push(t):e(t,s)})}(e,t),t},refresh_hits:function(e,t){p(e),i(t.getRows()).each(t=>{const i=t.code;if(void 0!==i){const n=c(e.root_entry,i);if(n){n.filter_hits=parseInt(t.cells[0].value.value);const i=a(e.root_entry,n);i.length>1&&i[i.length-1]&&i[i.length-1].mapped_id===n.mapped_id&&i.pop(),i.length>1&&i[i.length-1]&&(i[i.length-1].filter_hits?i[i.length-1].filter_hits+=n.filter_hits:i[i.length-1].filter_hits=n.filter_hits)}else console.log(`Could not find topic_entry for ${i} in topic menu ${e.type}`)}})},resetFilterHits:p,removeFilterHits:function(e){const t=[];o(e.root_entry,t),i(t).each(e=>delete e.filter_hits)},getParentsOfEntry:function(e,t){return a(t.root_entry,e)}}}),define("classes/application/application",["require","exports","configuration/application/base","classes/application/abstract_application"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends n.AbstractApplication{constructor(e){super(e),this.type=n.ApplicationType.MAIN}getConfiguration(){return i.baseApplicationConfiguration}isOffline(){return this.offline}}t.Application=s,t.mainApplication=new s}),define("entry_point/configurations/angular_configuration/interface",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("entry_point/configurations/operation_modes/operation_mode_model",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/context_data/containers/limits",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.Limits=class{constructor(e){this.limits=e}getLimit(e){const t=this.limits[e];return void 0!==t?t.limit:9e5}}}),define("classes/context_data/containers/links",["require","exports","log"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.Links=class{constructor(e){this.links=e}getLogo(){return this.getLink("LOGO")}replaceLinksInTemplate(e){const t=/tw:lnk:\[.*?\]/g;let n=e.match(t);for(;null!==(n=t.exec(e));){const s=/\[(.*)]/.exec(n[0]);void 0!==this.links[s[1]]?e=e.replace(n[0],this.links[s[1]].link):i.logService.error(`cannot find the link ${n}`),t.lastIndex=0}return e}getLink(e){return void 0!==this.links[e]?this.links[e].link:(i.logService.warn(`Problem while trying to get the link for the following ${e}`),"")}}}),define("classes/context_data/containers/messages_library",["require","exports","log"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.message=e.message,this.parameters=e.parameters}}t.Message=n;t.MessageLibrary=class{constructor(e){this.contextMessage=e}replaceAllMessagesInTemplate(e){const t=/tw:msg:\[.*?\]/g;let i=e.match(t);for(;null!==(i=t.exec(e));){const n=/\[(.*)\(/.exec(i[0]),s=this.getParameters(i[0]),o=this.getMessage(n[1],s);e=e.replace(i[0],o),t.lastIndex=0}return e}getParameters(e){const t=/['|"](.*?)['|"]/g;let i;const n=[];for(;null!==(i=t.exec(e));)n.push(i[1]);return n}getMessage(e,t=[]){const n=this.fetchMessageEntry(e)||this.fetchMessageEntry(e.replace("_","_1"));return void 0!==n?this.resolveExistingMessage(e,n,t):void i.logService.warn(`Can't find the messages ${e}`)}resolveExistingMessage(e,t,i){return void 0!==t.parameters?this.resolveMessageWithParameters(e,t,i):this.resolveMessageWithoutParameters(t,i)}resolveMessageWithParameters(e,t,n){n.length!==t.parameters.length&&i.logService.warn(`incorrect parameter count got ${n.length} expected ${t.parameters.length} ~ ${e}`);let s=t.message,o=0;for(const e of t.parameters){const t=n[o++];s=s.replace(e,void 0!==t?t.toString():"")}return s}resolveMessageWithoutParameters(e,t){return void 0!==t&&t.length>0&&i.logService.warn(`incorrect parameter count got ${t.length} expected 0 ${e.message}`),e.message}fetchMessageEntry(e){const t=this.contextMessage[e];return void 0!==t?new n(t):void 0}}}),define("classes/context_data/containers/rules",["require","exports","log"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.Rules=class{constructor(e){this.rules=e}replaceRulesInTemplate(e){const t=/tw:rule:\[.*?\]/g;let n;for(;null!==(n=t.exec(e));){const s=/\[(.*)]/.exec(n[0]);void 0!==this.rules[s[1]]?e=e.replace(n[0],`${this.rules[s[1]].enabled}`):i.logService.error(`Cannot find the rule: ${n}`),t.lastIndex=0}return e}isRuleEnabled(e){return void 0===this.rules[e]?(i.logService.error(`Cannot find the rule: ${e}`),!0):this.rules[e].enabled}isExportEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ExportProjectRule")}isLiveViewEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.LiveViewEnabledProjectRule")}isCommandCenterEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.CommandCenterEnabledProjectRule")}isProximityFilterEnabled(){return!this.isRuleEnabled("models.tw.profiles.policies.rules.project.DisableNearFilterOptionProjectRule")}isInToolReportingEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.specialrules.InToolReportingRule")}isArticleTaggingEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ResultsArticleTagsProjectRule")}isArticleSentimentEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ResultsArticleSentimentProjectRule")}isArticleSourcePanelEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.SourcePanelAvailableProjectRule")}isSourcePanelSuggestionEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.partner.UseSourcePanelSuggestionsPartnerRule")}isRebuildsEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.UserRebuildsAvailableProjectRule")}isOriginalUserEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.OriginalUserRule")}isImageDetectionEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ImageDetectionProjectRule")}isDashboardUsersEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.ProjectAdminRule")}isAcademyEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.AcademyRule")}isImpersonate(){return this.isRuleEnabled("isImpersonate")}isTagsCreationEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.TagsCreationRule")}isBookmarkSharingEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.BookmarkSharingRule")}isTopicBasedSentimentEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.TopicBasedSentimentProjectRule")}isCustomTimeFiltersEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.CustomTimeFilterProjectRule")}isProjectAdminEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.ProjectAdminRule")}isUserRebuildSettingsVisible(){return this.isRuleEnabled("models.tw.profiles.policies.rules.partner.UserRebuildSettingsVisiblePartnerRule")}isAlertsProjectEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.AlertsProjectRule")}isPartnerNotTwAccountEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.PartnerNotTwAccountRule")}isProductProjectRuleEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ProductProjectRule")}isReviewTrackersEnabled(){return this.isRuleEnabled("models.tw.profiles.policies.rules.project.ReviewTrackerRule")}}}),define("classes/context_data/containers/entity_accesses",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.EntityAccesses=class{constructor(e){this.entityActions=new Map,Object.keys(e).forEach(t=>{const{actions:i=[]}=e[t];this.entityActions.set(t,new Map),i.forEach(e=>{this.entityActions.get(t).set(e,!0)})})}hasAccess(e,t){if(this.entityActions.has(e)){const i=this.entityActions.get(e);return i.has(t)&&!0===i.get(t)}return!1}}}),define("classes/context_data/context_data",["require","exports","classes/context_data/containers/limits","classes/context_data/containers/links","classes/context_data/containers/messages_library","classes/context_data/containers/rules","classes/context_data/containers/entity_accesses"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this.sentimentColors={negative:"#e74c3c",neutral:"#f2c100",none:"#b2b2b2",positive:"#1fce6e"},this.resetData(e)}resetData(e){if(void 0===e)throw new Error("Context data form shall not be null");if(this.rules=new o.Rules(e.rules),this.messages=new s.MessageLibrary(e.messages),this.links=new n.Links(e.links),this.limits=new i.Limits(e.limits),this.accesses=new r.EntityAccesses(e.accesses),this.userSettings=e.user_settings,this.projectSettings=e.project_settings,this.commonPropertiesContainer=e.common_properties_container,e.sentiment_colors){if(this.sentimentColors={positive:e.sentiment_colors.positive.color,negative:e.sentiment_colors.negative.color,neutral:e.sentiment_colors.neutral.color,none:e.sentiment_colors.none.color},!document.getElementById("sentiment-colors")){const e=document.createElement("style");e.id="sentiment-colors",document.head.appendChild(e)}document.getElementById("sentiment-colors").innerHTML=`\n                .tendency.positive {\n                    color: ${this.sentimentColors.positive} !important;\n                }\n                .tendency.negative {\n                    color: ${this.sentimentColors.negative} !important;\n                }\n                .tendency.neutral {\n                    color: ${this.sentimentColors.neutral} !important;\n                }\n            `}this.initializeFeatureflags(e.features)}getMessage(e,t){return this.messages.getMessage(e,void 0!==t&&t.length>0&&void 0!==t[0]?t:[])}getLink(e){return this.links.getLink(e)}areMetricsEnabled(){const e=this.getMetricsConfiguration();return Object.keys(e).reduce((t,i)=>void 0!==e[i]?e[i].enabled||t:void 0,!1)}getMetricsConfiguration(){const e={"*":{enabled:!1,sendToServer:!1}};return void 0!==this.commonPropertiesContainer.client_metrics&&void 0!==this.commonPropertiesContainer.client_metrics.metrics_config&&Object.keys(this.commonPropertiesContainer.client_metrics.metrics_config).forEach(t=>{e[t]={enabled:this.commonPropertiesContainer.client_metrics.metrics_config[t].enabled,sendToServer:this.commonPropertiesContainer.client_metrics.metrics_config[t].send_to_server}}),Object.keys(e).forEach(t=>{"boolean"!=typeof e[t].enabled&&(e[t].enabled=!1),"boolean"!=typeof e[t].sendToServer&&(e[t].sendToServer=!1)}),e}replaceAllMetaLanguageTags(e){let t=this.messages.replaceAllMessagesInTemplate(e);return t=this.links.replaceLinksInTemplate(t),t=this.rules.replaceRulesInTemplate(t),t=this.replaceAssetsInTemplate(t)}replaceAssetsInTemplate(e){const t=/tw:asset:\[.*?\]/g;let i=e.match(t);for(;null!==(i=t.exec(e));){const t=/\[(.*)]/.exec(i[0]);e=e.replace(i[0],this.commonPropertiesContainer.assets_path+t[1])}return e}isRuleEnabled(e){return this.rules.isRuleEnabled(e)}getLimit(e){return this.limits.getLimit(e)}getNumberFormatterConfig(){const{abbreviations:e,delimiters:t}=this.commonPropertiesContainer.number_format;return{abbreviations:{thousand:e.thousand,million:e.million,billion:e.billion,trillion:e.trillion},delimiters:{thousands:t.thousands,decimal:t.decimal},currency:{symbol:"€"},ordinal:e=>""+e}}initializeFeatureflags(e){this.isFeatureEnabled=(t=>{if(void 0===e[t])throw`Unknown feature ${t}`;return!0===e[t].enabled})}}t.ContextData=a,t.contextData=new a(window.context_data),window.context_data=t.contextData}),define("components/page/modules/application_module_page",["require","exports","talkwalker_constants"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ApplicationModulePage=class{static determineDirective(e){const t=e.getAllowedPages().getModule();switch(t){case i.ApplicationModule.ISSUE_TRACKER:return"issue-tracker-module-page";case i.ApplicationModule.INFLUENCER_MANAGEMENT:return"influencer-management-page";case i.ApplicationModule.DEFAULT_MODULE:throw new Error("Default module does not have a directive");default:throw new Error(`Unknown module: ${t}`)}}}}),define("controllers/routing/abstract_page_controller",["require","exports","router"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractPageController=class extends i.AbstractPage{constructor(e,t,i,n,s){super(t,i),this.title=n,this.groupPage=e,this.pageData=void 0,this.config=s}getGroupPage(){return this.groupPage}isPublic(){return this.config.public}applyPageTitle(){document.title=this.title()}}}),define("controllers/routing/external_page",["require","exports","controllers/routing/abstract_page_controller","classes/application/application","wrappers/page_state/page_state_wrapper"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.ExternalPage=class extends i.AbstractPageController{constructor(e,t,i,n,s){super(e,t,i,n,s)}navigate(e){e.accept(),this.initialize(),e.complete()}initialize(){window.page_state&&n.mainApplication.injectPageState(new s.PageStateWrapper(window.page_state,n.mainApplication),!1)}refresh(e){}}}),define("classes/refresh/model_refresh_strategy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.RELOAD=0]="RELOAD",e[e.REFRESH=1]="REFRESH",e[e.REFRESH_NO_CACHE=2]="REFRESH_NO_CACHE",e[e.LOAD_MORE_CONTENT=3]="LOAD_MORE_CONTENT"}(t.ModelRefreshStrategy||(t.ModelRefreshStrategy={}))}),define("classes/refresh/model_state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PARTIAL=0]="PARTIAL",e[e.FULL=1]="FULL"}(t.ModelState||(t.ModelState={}))}),define("classes/refresh/refresh_options",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("services/loading_bubble",["require","exports","jquery","other/tw"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.showingSpinner=!0}showSpinner(){this.cancelDelayedHideIfExists(),i("div.main-spinner").show(),this.showingSpinner=!0}hideSpinner(){i("div.main-spinner").hide(),this.showingSpinner=!1}delayHideSpinnerBy(e){this.hideTimeoutId=setTimeout(()=>this.hideSpinner())}removeLoadingMessage(){i("div.main-spinner").find(".loading").remove()}isSpinnerVisible(){return this.showingSpinner}cancelDelayedHideIfExists(){void 0!==this.hideTimeoutId&&(clearTimeout(this.hideTimeoutId),this.hideTimeoutId=void 0)}},Object.defineProperty(t,"loadingBubbleService",{get:function(){return n.tw.inject("loadingBubbleService")}})}),define("constants/page_size_constants",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_WITH_SIDEBAR_WIDTH=1058,t.DIALOG_PAGE_WIDTH=1200,t.PAGE_WITHOUT_SIDEBAR_WIDTH=1278,t.EXPORT_PREVIEW_PAGE_WIDTH=1020,t.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH=1222,t.REPORT_PAGE_WIDTH=t.PAGE_WITHOUT_SIDEBAR_WIDTH-100,t.DEFAULT_GRID_PAGE_WIDTH=1280,t.GRID_DASHBOARD_HEIGHT=768}),define("configuration/bubble_dialog/base",["require","exports","services/tw_common","log","other/tw","bubble_dialogs","constants/page_size_constants"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(){this.styles={};let e=new o.BubbleDialogStyle;e.setArrowSide(i.twCommon.sides.CENTER),e.setAbsoluteY(80),e.setMinWidth(1200),e.setMaxWidth(1200),e.setMinHeight(400),e.setDisplay("table"),this.styles[constants.bubble_dialog.id.widget]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setMaxWidth(1200),e.setMinHeight(300),e.setAbsoluteY(80),e.setBoxShadow("0 5px 15px rgba(0, 0, 0, 0.5)"),this.styles[constants.bubble_dialog.id.mail_error]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setMinWidth(600),e.setMaxWidth(750),e.setMinHeight(780),e.setAbsoluteY(80),e.setBoxShadow("0 5px 15px rgba(0, 0, 0, 0.5)"),this.styles[constants.bubble_dialog.id.alert]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setMinWidth(600),e.setMaxWidth(600),e.setAbsoluteY(200),e.setBoxShadow("0 5px 15px rgba(0, 0, 0, 0.5)"),this.styles[constants.bubble_dialog.id.smtptest]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setAbsoluteY(180),e.setMinWidth(600),e.setMaxWidth(1200),e.setMinHeight(200),this.styles[constants.bubble_dialog.id.shortcut_explanation]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setAbsoluteY(180),e.setMinWidth(1200),e.setMaxWidth(1200),e.setMinHeight(700),this.styles[constants.bubble_dialog.id.diff_explorer]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER),e.setPositionOffsetY(24),e.setAbsoluteY(80),e.setMinWidth(800),e.setMinHeight(400),this.styles[constants.bubble_dialog.id.contact_form]=e,(e=new o.BubbleDialogStyle).setPositionOffsetX(18),e.setMaxWidth(500),this.styles[constants.bubble_dialog.id.topic_menu_message]=e,(e=new o.BubbleDialogStyle).setMinWidth(200),e.setMinHeight(100),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("#AAA"),e.setFadeOut(250),e.setAbsoluteXOrigin(i.twCommon.sides.CENTER),e.setAbsoluteYOrigin(i.twCommon.sides.BOTTOM),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.message_diffusion]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(80),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.activity]=e,(e=new o.BubbleDialogStyle).setMinWidth(100),e.setMinHeight(25),e.setFadeOut(100),e.setArrowSide(i.twCommon.sides.TOP),this.styles[constants.bubble_dialog.id.context_menu]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setMaxWidth(450),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setPositionOffsetX(-2),e.setPositionOffsetY(-10),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.popup]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setPositionOffsetX(-4),e.setPositionOffsetY(-10),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.sentiment]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setPositionOffsetY(-10),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.lines]=e,(e=new o.BubbleDialogStyle).setMinWidth(40),e.setMinHeight(10),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setPositionOffsetY(-10),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.velocity]=e,(e=new o.BubbleDialogStyle).setMinWidth(40),e.setMinHeight(10),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setPositionOffsetY(-10),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.colored_message]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.theme_cloud]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setArrowSide(i.twCommon.sides.RIGHT),this.styles[constants.bubble_dialog.id.pie]=e,(e=new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.TOP),e.setMinWidth(200),e.setMinHeight(80),this.styles[constants.bubble_dialog.id.filters.selection]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMaxWidth(250),e.setMinHeight(20),e.setBorderWidth(1),e.setBorderColor("#33465e"),e.setColor("#33465e"),e.setUseShadow(!1),e.setFadeOut(125),e.setPositionOffsetY(-1),e.setArrowSide(i.twCommon.sides.BOTTOM),e.setArrowWidth(6),e.setArrowLength(6),e.setZIndex(1050),this.styles[constants.bubble_dialog.id.tooltip]=e,(e=this.styles[constants.bubble_dialog.id.widget].clone()).setArrowSide(i.twCommon.sides.CENTER),e.setPositionOffsetY(24),e.setAbsoluteY(80),e.setMinWidth(1200),e.setMinHeight(250),this.styles[constants.bubble_dialog.id.entry]=e,(e=new o.BubbleDialogStyle).setMinWidth(50),e.setMinHeight(20),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(125),e.setArrowSide(i.twCommon.sides.CENTER),this.styles[constants.bubble_dialog.id.months]=e,(e=new o.BubbleDialogStyle).setMinWidth(80),e.setMaxWidth(120),e.setMinHeight(20),e.setBorderRadius(5),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setFadeOut(25),e.setArrowSide(i.twCommon.sides.BOTTOM),e.setArrowWidth(6),e.setArrowLength(6),e.setPositionOffsetX(-2),this.styles[constants.bubble_dialog.id.replay_speed]=e,(e=new o.BubbleDialogStyle).setMinWidth(26),e.setMaxWidth(48),e.setMinHeight(22),e.setBorderRadius(3),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setBoxShadow("rgba(189, 195, 199, 0.66) 0px 0px 5px 0px"),e.setArrowSide(i.twCommon.sides.BOTTOM),e.setArrowWidth(4),e.setArrowLength(4),e.setPositionOffsetY(-2),e.setZIndex(50),e.setPreventOutOfBoundCheck(!0),this.styles[constants.bubble_dialog.id.comment_marker]=e,(e=new o.BubbleDialogStyle).setMinWidth(64),e.setMinHeight(64),e.setMaxHeight(64),e.setBorderRadius(32),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setBorderSide(i.twCommon.sides.LEFT,0),e.setBoxShadow("rgba(189, 195, 199, 0.66) 0px 0px 5px 0px"),e.setArrowSide(i.twCommon.sides.BOTTOM),e.setArrowWidth(6),e.setArrowLength(6),e.setPositionOffsetX(2),e.setPositionOffsetY(-2),e.setZIndex(50),e.setPreventOutOfBoundCheck(!window.embedded_mode),this.styles[constants.bubble_dialog.id.comment_preview]=e,(e=new o.BubbleDialogStyle).setMinHeight(20),e.setMinWidth(0),e.setMaxHeight(64),e.setBorderRadius(32),e.setBorderWidth(2),e.setBorderRadius(3),e.setBorderWidth(1),e.setBorderColor("rgba(0,0,0,0.2)"),e.setBoxShadow("rgba(189, 195, 199, 0.66) 0px 0px 5px 0px"),e.setPositionOffsetX(4),e.setPositionOffsetY(0),e.setArrowSide(i.twCommon.sides.LEFT),e.setArrowWidth(5),e.setArrowLength(5),e.setPreventOutOfBoundCheck(!0),this.styles[constants.bubble_dialog.id.generic_message]=e,this.styles[constants.bubble_dialog.id.placeholder_information]=(new o.BubbleDialogStyle).setMinHeight(32).setMinWidth(64).setMaxHeight(64).setBorderRadius(3).setBorderWidth(1).setBorderColor("rgba(0,0,0,0.2)").setBoxShadow("rgba(189, 195, 199, 0.66) 0px 0px 5px 0px").setPositionOffsetX(0).setPositionOffsetY(0).setArrowSide(i.twCommon.sides.BOTTOM).setArrowWidth(5).setArrowLength(5).setPreventOutOfBoundCheck(!0),this.styles.widget_menu=(new o.BubbleDialogStyle).setMinHeight(0).setMinWidth(0).setPositionOffsetX(14).setPositionOffsetY(0).setFadeOut(0).setFadeIn(0).setArrowSide(i.twCommon.sides.CENTER).setPreventOutOfBoundCheck(!0),this.styles[constants.bubble_dialog.id.edit_search_query]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(80).setMinWidth(800).setMaxWidth(800).setMinHeight(400),this.styles[constants.bubble_dialog.id.confirmation]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setFadeOut(0).setFadeIn(0).setZIndex(1200).setMinHeight(168).setMinWidth(500).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.source_panel_menu]=(new o.BubbleDialogStyle).setMinHeight(0).setMinWidth(0).setPositionOffsetX(15).setPositionOffsetY(0).setFadeOut(0).setFadeIn(0).setArrowSide(i.twCommon.sides.CENTER).setPreventOutOfBoundCheck(!0),this.styles[constants.bubble_dialog.id.new_dashboard]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(800).setMaxWidth(800).setMinHeight(400),this.styles[constants.bubble_dialog.id.image_box_edition]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(600).setMaxWidth(600).setMinHeight(400).setHeight(400),this.styles[constants.bubble_dialog.id.video_box_edition]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(600).setMaxWidth(600).setMinHeight(400).setHeight(400),this.styles[constants.bubble_dialog.id.color_edition]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.influencers_list_creation]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(600).setMaxWidth(600),this.styles[constants.bubble_dialog.id.influencer_follower_info]=(new o.BubbleDialogStyle).setMinWidth(50).setMinHeight(20).setMaxWidth(450).setBorderRadius(5).setBorderWidth(1).setBorderColor("rgba(0,0,0,0.2)").setFadeOut(125).setPositionOffsetX(-2).setArrowSide(i.twCommon.sides.BOTTOM),this.styles[constants.bubble_dialog.id.topic_menu_select_dropdown]=(new o.BubbleDialogStyle).setMinHeight(0).setMinWidth(0).setPositionOffsetY(8).setFadeOut(0).setFadeIn(0).setArrowSide(i.twCommon.sides.TOP).setPreventOutOfBoundCheck(!0).setTargetXOrigin("RIGHT"),this.styles[constants.bubble_dialog.id.add_influencers_to_campaign]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(600).setMaxWidth(600),this.styles[constants.bubble_dialog.id.influencers_list_selection]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.watchlist_selection]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.influencer_add_to_campaign]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.ai_rule_change_category]=(new o.BubbleDialogStyle).setFadeOut(0).setFadeIn(0).setMinWidth(150).setMaxWidth(230).setMinHeight(80).setUseShadow(!0).setPositionOffsetX(-100).setPositionOffsetY(43),this.styles[constants.bubble_dialog.id.tag_creation]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.rebuild_time_range]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.add_tag_category]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setMaxHeight(700).setUseShadow(!1),this.styles[constants.bubble_dialog.id.group_creation]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.deleted_categories]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.crop_image]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(600).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.export_preview]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setFadeOut(0).setFadeIn(0).setMinWidth(r.EXPORT_PREVIEW_PAGE_WIDTH+1).setMaxWidth(1282).setMinHeight(680).setUseShadow(!1),this.styles[constants.bubble_dialog.id.tos_update]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setAbsoluteY(0).setFadeOut(0).setFadeIn(0).setMinWidth(400).setMaxWidth(400).setMinHeight(237).setUseShadow(!1),this.styles[constants.bubble_dialog.id.account_details]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setPosition("fixed").setFadeOut(0).setFadeIn(0).setZIndex(1200).setMinHeight(168).setMinWidth(500).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.bars]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.BOTTOM).setMinHeight(32).setMinWidth(32).setMaxWidth(600).setUseShadow(!1),this.styles[constants.bubble_dialog.id.influencer_search_rollover]=(new o.BubbleDialogStyle).setPosition("unset").setMinHeight(0).setUseShadow(!1).setFadeIn(0).setFadeOut(0),this.styles[constants.bubble_dialog.id.save_influencer_search]=(new o.BubbleDialogStyle).setPosition("fixed").setAbsoluteY(300).setFadeOut(0).setFadeIn(0).setMinWidth(500).setMaxWidth(500).setMinHeight(80).setUseShadow(!1),this.styles[constants.bubble_dialog.id.custom_fields_data_types]=(new o.BubbleDialogStyle).setFadeOut(0).setFadeIn(0).setMinWidth(150).setMaxWidth(150).setMinHeight(120).setMaxHeight(120).setUseShadow(!0).setPositionOffsetX(-164).setPositionOffsetY(75),this.styles[constants.bubble_dialog.id.create_custom_field]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(700).setMaxWidth(700),this.styles[constants.bubble_dialog.id.edit_topic]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(1200).setMaxWidth(1200).setMinHeight(400),this.styles[constants.bubble_dialog.id.add_custom_score]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(700).setMaxWidth(700),this.styles[constants.bubble_dialog.id.add_indicator_variable]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(700).setMaxWidth(700),this.styles[constants.bubble_dialog.id.article_video_player]=(new o.BubbleDialogStyle).setArrowSide(i.twCommon.sides.TOP).setPosition("fixed").setAbsoluteY(60).setMinWidth(300).setMaxWidth(1200).setMinHeight(300).setMaxHeight(900)}getStyle(e){const t=this.styles[e];if(n.logService.assertDefined(t,i.twCommon.logFeatures.Configuration.BubbleDialog.base),void 0!==t)return t.clone()}}t.default=a,t.baseBubbleDialogConfiguration=new a,Object.defineProperty(t,"baseBubbleDialogConfiguration",{get:function(){return s.tw.inject("baseBubbleDialogConfiguration")}})}),define("classes/widget/types/widget_type",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ACTIVITY_CHART="activity",e.DATA_TABLE="table",e.THEME_CLOUD="themeCloud",e.PIE_CHART="pieChart",e.AREA_CHART="areaChart",e.LINE_CHART="lineChart",e.VELOCITY_CHART="velocityChart",e.BUBBLE_CHART="bubbleChart",e.KPI_CHART="kpi",e.SINGLE_METRIC="singleMetric",e.COUNTER="counter",e.HORIZONTAL_BAR_CHART="horizontalBarChart",e.VERTICAL_BAR_CHART="verticalBarChart",e.GENDER="gender",e.INFLUENCER_TABLE="influencerTable",e.INFLUENCER_OVERVIEW="influencerOverview",e.INFLUENCER_NETWORK="influencerNetwork",e.DOCUMENT_CLUSTER="documentCluster",e.MESSAGE_DIFFUSION="messageDiffusion",e.TEXT="text",e.TOP_INFLUENCERS_OVERVIEW="topInfluencersOverview",e.THEME_TREE="themeTree",e.EMOJI_TREE="emojiTree",e.TREEMAP="treemap",e.MULTI_METRICS="metricMultiple",e.TRENDS_TABLE="trendsTable",e.SUMMARIES="summary",e.PAYLOAD_EDITION="payloadEdition",e.PAGE_BREAK="pageBreak",e.TOP_IMAGES="topImages",e.ARTICLES="articles",e.WHEEL_CHART="wheelChart",e.COMPOSED_GRAPH="composedGraph",e.RADAR_CHART="radarChart",e.TEXT_BOX="textBox",e.IMAGE_BOX="imageBox",e.VIDEO_BOX="videoBox",e.OPENLAYERS_WORLD_MAP="openlayersWorldMap",e.RESTFORM="restform",e.PROGRESS_GRAPH="progressGraph",e.BLOCK_INFLUENCERS="blockInfluencers",e.BLOCK_ISSUES="blockIssues",e.CAMPAIGNS_TABLE="campaignsTable",e.TRENDS_CONFIGURABLE="trendsConfigurable",e.EXTERNAL_TREND_TABLE="externalTrendTable",e.EXTERNAL_TREND_WORD_CLOUD="externalTrendWordCloud",e.IMPACT_GRAPH="impactGraph",e.STREAM_GRAPH="streamGraph",e.SORTED_THEME_CLOUD="sortedThemeCloud",e.COMPARED_TOPICS="comparedTopics"}(t.WidgetType||(t.WidgetType={}))}),define("configuration/widget/base",["require","exports","services/tw_common"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.BaseWidgetConfiguration=class{constructor(){this.disabledMenus=[]}canBeFullScreen(e){return!1}canShowBreakdown(e){return!1}canShowHeaderMenu(e,t){return!e.getPageState().getAllowedPages().isCommandCenterScreen()&&this.disabledMenus.indexOf(t)<0}isReplayable(e){return!0}hasReplayModes(e){return this.isReplayable(e)}canAutoRefresh(e){return!0}getHeightRange(e){return[this.getHeight(e),this.getHeight(e)]}getPreferredHeight(e){return this.getHeight(e)}getHeight(e){return i.twCommon.widgetHeight.NORMAL}canUseBackgroundColor(e){return!1}shouldRewrapWidgetOnLayoutChange(e,t){return!0}shouldDisableInteraction(){return!1}}}),define("configuration/widget/area_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AreaChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}hasReplayModes(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/activity",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ActivityWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/articles",["require","exports","services/tw_common","classes/widget/types/widget_type","configuration/widget/base","talkwalker_constants"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.ArticlesWidgetConfiguration=class extends s.BaseWidgetConfiguration{canBeFullScreen(e){return e.hasPageState()&&e.getPageState().getAllowedPages().isCustomPage()}isReplayable(e){return!1}canShowHeaderMenu(e,t){return super.canShowHeaderMenu(e,t)&&(!_.contains(["NUMBER_RESULTS"],t)||!e.isSmallArticlesWidget())}getHeight(e){return i.twCommon.widgetHeight.DYNAMIC}shouldRewrapWidgetOnLayoutChange(e,t){return e.getDataTypeUuid()===o.DataType.RESULTSLIST_TREE_MAP||t!==n.WidgetType.ARTICLES}}}),define("configuration/widget/bubble_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.BubbleChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/counter",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.CounterWidgetConfiguration=class extends i.BaseWidgetConfiguration{getHeight(e){return n.twCommon.widgetHeight.TINY}isReplayable(e){return!1}}}),define("configuration/widget/emoji_tree",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.EmojiTreeWidgetConfiguration=class extends i.BaseWidgetConfiguration{constructor(){super(...arguments),this.disabledMenus=[constants.topic_menu.TYPE.number_results,constants.topic_menu.TYPE.theme_options]}canBeFullScreen(e){return!0}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/gender",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.GenderWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/vertical_bar_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.VerticalBarChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}hasReplayModes(e){return!e.isDateHistogram()}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("services/scroll",["require","exports","jquery","jquery-scrollify"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){i.scrollify({section:".section",sectionName:!1,easing:"linear",scrollSpeed:300,offset:0,scrollbars:!0,standardScrollElements:"",setHeights:!1,before:()=>{i.scrollify.update()}}),this.disable()}enable(){i.scrollify.update(),i.scrollify.enable()}disable(){i.scrollify.disable()}snapToNearest(){i.scrollify.manualScroll.calculateNearest()}update(){i.scrollify.update(),i.scrollify.manualScroll.calculateNearest()}setOptions(e){i.scrollify.setOptions(e)}}t.ScrollService=n,t.scrollService=new n}),define("services/confirmation_service",["require","exports","angular_utilities","services/bubble_dialog","services/configuration","bubble_dialogs"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){}display(e,t,i){return new Promise((o,r)=>{const a=i||s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.confirmation).clone(),c=n.bubbleDialogService.createByType(constants.bubble_dialog.id.confirmation,$("body"),constants.bubble_dialog.id.confirmation,e,a,Object.assign({fadeBackground:!0},t));c.onMessage.subscribe(e=>{c.destroy(),e?o():r()})})}}__decorate([i.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object,o.BubbleDialogStyle]),__metadata("design:returntype",Promise)],r.prototype,"display",null),t.default=r,t.confirmationService=new r}),define("services/browser_extension",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.isOffline=!1,this.pendingResponses={},document.addEventListener("commandCenterExtensionBridge",e=>{this.handleMessage(e.detail.payload,e.detail.id)})}async isAvailable(){if(this.isOffline)return Promise.resolve(!1);try{return await this.sendMessage("ping",{}),!0}catch(e){return this.isOffline=!0,!1}}async isFullscreen(){return await this.sendMessage("isFullscreen",{})}async forceFullscreenMode(e){return await this.sendMessage("fullscreen",e)}sendMessage(e,t){return i.promiseTimeout(new Promise((i,n)=>{const s=Math.random();window.postMessage({type:e,payload:t,id:s},"*"),this.pendingResponses[s]={promise:{resolve:i,reject:n}}}),500,void 0,{rejectOnTimeout:!0})}handleMessage(e,t){this.pendingResponses[t]&&(this.pendingResponses[t].promise.resolve(e),delete this.pendingResponses[t])}}t.BrowserExtension=n,t.browserExtensionService=new n}),define("entry_point/configurations/angular_configuration/embedded_widget",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.embeddedWidgetAngularConfiguration={components:["bubble_dialogs","core","modals","filters","forms","ng_filters","other","pages","to_be_split","widgets_1","widgets_2"],modules:{"angular-bootstrap-colorpicker":"colorpicker.module","angular-sanitize":"ngSanitize","angular-messages":"ngMessages",bindonce:"pasvaz.bindonce",oclazyLoad:"oc.lazyLoad","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:["autofill_events"]}}),define("entry_point/configurations/lifetime_services/normal",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.normalLifeTimeServices=["browserDetectionService","customTimezonesService","injector","scriptsLoadingService","sessionService","storeService","popoverService","canvasChartService","themeService","versionService"]}),define("entry_point/configurations/operation_modes/embedded_widget_mode",["require","exports","entry_point/configurations/angular_configuration/embedded_widget","entry_point/configurations/lifetime_services/normal"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.embeddedWidgetMode={lifeTimeServices:n.normalLifeTimeServices,public:!0,routingTables:[{routes:{[constants.sub_pages.embedded_widget.page.id]:{patterns:["*"],angularConfiguration:i.embeddedWidgetAngularConfiguration}}}]}}),define("entry_point/configurations/angular_configuration/complete",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.completeAngularConfiguration={components:["bubble_dialogs","core","edit_mode","filters","forms","modals","ng_filters","other","pages","reports","rest_form","settings","to_be_split","ui","widgets_1","widgets_2"],modules:{"angular-bootstrap-colorpicker":"colorpicker.module","angular-messages":"ngMessages","angular-sanitize":"ngSanitize","angular-resource":"ngResource",bindonce:"pasvaz.bindonce",rzSlider:"rzModule","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:[]}}),define("entry_point/configurations/routing/routing_tables/hootsuite_dashboard_routing_table",["require","exports","entry_point/configurations/angular_configuration/complete"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.hootsuiteDashboardRoutingTable={routes:{HOOTSUITE_DASHBOARD:{patterns:["/*/:source/:source_id/hootsuite_dashboard/:dashboard"],angularConfiguration:i.completeAngularConfiguration}}}}),define("entry_point/configurations/operation_modes/hootsuite_dashboard_mode",["require","exports","entry_point/configurations/routing/routing_tables/hootsuite_dashboard_routing_table","entry_point/configurations/lifetime_services/normal"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.hootsuiteDashboardMode={lifeTimeServices:n.normalLifeTimeServices,public:!0,routingTables:[i.hootsuiteDashboardRoutingTable]}}),define("entry_point/configurations/routing/routing_tables/export_routing_table",["require","exports","entry_point/configurations/angular_configuration/complete"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.exportRoutingTable={routes:{EXPORT:{patterns:["/*/:source/:source_id/export"],angularConfiguration:i.completeAngularConfiguration}}}}),define("entry_point/configurations/lifetime_services/export",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.exportLifeTimeServices=["customTimezonesService","injector","scriptsLoadingService","sessionService","themeService","storeService","popoverService","momentService"]}),define("entry_point/configurations/operation_modes/image_export_mode",["require","exports","entry_point/configurations/routing/routing_tables/export_routing_table","entry_point/configurations/lifetime_services/export"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.imageExportMode={lifeTimeServices:n.exportLifeTimeServices,public:!0,routingTables:[i.exportRoutingTable]}}),define("entry_point/configurations/angular_configuration/login",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loginAngularConfiguration={components:["core","forms"],modules:{},externalDependencies:["autofill_events"]}}),define("entry_point/configurations/routing/routing_tables/login_routing_table",["require","exports","entry_point/configurations/angular_configuration/login"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.loginRoutingTable={routes:{LOGIN:{patterns:["/*/login"],angularConfiguration:i.loginAngularConfiguration}}}}),define("entry_point/configurations/operation_modes/login_mode",["require","exports","entry_point/configurations/routing/routing_tables/login_routing_table"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.loginMode={lifeTimeServices:["injector"],public:!0,routingTables:[i.loginRoutingTable]}}),define("entry_point/configurations/routing/routing_tables/shared_dashboard_routing_table",["require","exports","entry_point/configurations/angular_configuration/complete"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedDashboardRoutingTable={routes:{SHARED_DASHBOARD:{patterns:["/*/:source/:source_id/cached/:dashboard","/*/:source/:source_id/shared_dashboard/:dashboard"],angularConfiguration:i.completeAngularConfiguration}}}}),define("entry_point/configurations/angular_configuration/minimal",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.minimalAngularConfiguration={components:["core","filters","modals","ng_filters","other","pages","settings","ui"],modules:{"angular-bootstrap-colorpicker":"colorpicker.module","angular-sanitize":"ngSanitize","angular-messages":"ngMessages",oclazyLoad:"oc.lazyLoad",bindonce:"pasvaz.bindonce",rzSlider:"rzModule","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:[]}}),define("entry_point/configurations/angular_configuration/none",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.noneAngularConfiguration={components:["core"],modules:{},externalDependencies:[]}}),define("entry_point/configurations/angular_configuration/settings",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.settingsAngularConfiguration={components:["bubble_dialogs","core","edit_mode","filters","forms","modals","ng_filters","other","pages","rest_form","ui","settings","to_be_split","widgets_1"],modules:{"angular-bootstrap-colorpicker":"colorpicker.module","angular-sanitize":"ngSanitize","angular-messages":"ngMessages",oclazyLoad:"oc.lazyLoad",bindonce:"pasvaz.bindonce",rzSlider:"rzModule","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:[]}}),define("entry_point/configurations/routing/routing_tables/main_routing_table",["require","exports","entry_point/configurations/angular_configuration/complete","entry_point/configurations/angular_configuration/minimal","entry_point/configurations/angular_configuration/none","entry_point/configurations/angular_configuration/settings"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=window.bootPayload.baseUrl+"/page#/";t.mainRoutingTable={routes:{SANDBOX:{patterns:[r+"sandbox"],angularConfiguration:i.completeAngularConfiguration},SAFEBROWSING:{patterns:["*/rform/safe_browsing/show"],angularConfiguration:s.noneAngularConfiguration},SETTINGS:{patterns:[r+"settings"],angularConfiguration:o.settingsAngularConfiguration},ALLUSER:{patterns:["*/rform/all_users_application","*/rform/dev_phantomjs_metrics","*/rform/dev_oauth_testing","*/rform/dev_code_insights"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.embedded_widget.page.id]:{patterns:[r+constants.sub_pages.embedded_widget.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.search.page.id]:{patterns:[r+constants.sub_pages.search.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.quick_search.page.id]:{patterns:[r+constants.sub_pages.quick_search.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.application_module.page.id]:{patterns:[r+constants.sub_pages.application_module.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.trend_discovery.page.id]:{patterns:[r+constants.sub_pages.trend_discovery.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.visual_search.page.id]:{patterns:[r+constants.sub_pages.visual_search.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.user_workflow.page.id]:{patterns:[r+constants.sub_pages.user_workflow.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.monitor.page.id]:{patterns:[r+constants.sub_pages.monitor.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.trigger_condition.page.id]:{patterns:[r+constants.sub_pages.trigger_condition.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.dashboard.page.id]:{patterns:[r+constants.sub_pages.dashboard.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.report.page.id]:{patterns:[r+constants.sub_pages.report.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.topic_setup.page.id]:{patterns:[r+constants.sub_pages.topic_setup.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.command_center.page.id]:{patterns:[r+constants.sub_pages.command_center.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.command_center_overview.page.id]:{patterns:[r+constants.sub_pages.command_center_overview.page.route+"#",r+"COMMAND_CENTER_OVERVIEW#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.dashboard_screen.page.id]:{patterns:[r+constants.sub_pages.dashboard_screen.page.route+"#"],angularConfiguration:n.minimalAngularConfiguration},[constants.sub_pages.iq_app_screen.page.id]:{patterns:[r+constants.sub_pages.iq_app_screen.page.route+"#"],angularConfiguration:n.minimalAngularConfiguration},[constants.sub_pages.iq_app.page.id]:{patterns:[r+constants.sub_pages.iq_app.page.route+"#"],angularConfiguration:i.completeAngularConfiguration},[constants.sub_pages.edit.page.id]:{patterns:[r+constants.sub_pages.edit.page.route+"#"],angularConfiguration:n.minimalAngularConfiguration},[constants.sub_pages.home_screen.page.id]:{patterns:[r+constants.sub_pages.home_screen.page.route+"#",r+"USER_HOMESCREEN#"],angularConfiguration:n.minimalAngularConfiguration},[constants.sub_pages.discovery_screen.page.id]:{patterns:[r+constants.sub_pages.discovery_screen.page.route+"#"],angularConfiguration:n.minimalAngularConfiguration},AUTHENTICATION:{patterns:["/*/sma"],angularConfiguration:n.minimalAngularConfiguration}}}}),define("entry_point/configurations/angular_configuration/public",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.publicAngularConfiguration={components:["core","forms","modals","pages","ng_filters","other","rest_form"],modules:{bindonce:"pasvaz.bindonce","angular-messages":"ngMessages",oclazyLoad:"oc.lazyLoad","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:["autofill_events"]}}),define("entry_point/configurations/routing/routing_tables/public_routing_table",["require","exports","entry_point/configurations/angular_configuration/public"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.publicRoutingTable={routes:{PUBLIC:{patterns:["/*/rform/:form/:action","*/oauth/*","*/confirm_email/:key","*/unsubscribe/:key"],angularConfiguration:i.publicAngularConfiguration}}}}),define("entry_point/configurations/operation_modes/normal_mode",["require","exports","entry_point/configurations/routing/routing_tables/hootsuite_dashboard_routing_table","entry_point/configurations/lifetime_services/normal","entry_point/configurations/routing/routing_tables/shared_dashboard_routing_table","entry_point/configurations/routing/routing_tables/main_routing_table","entry_point/configurations/routing/routing_tables/public_routing_table","entry_point/configurations/routing/routing_tables/login_routing_table"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.normalMode={lifeTimeServices:n.normalLifeTimeServices,public:!1,routingTables:[a.loginRoutingTable,i.hootsuiteDashboardRoutingTable,s.sharedDashboardRoutingTable,o.mainRoutingTable,r.publicRoutingTable]}}),define("entry_point/configurations/operation_modes/shared_dashboard_mode",["require","exports","entry_point/configurations/lifetime_services/normal","entry_point/configurations/routing/routing_tables/shared_dashboard_routing_table"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedDashboardMode={lifeTimeServices:i.normalLifeTimeServices,public:!0,routingTables:[n.sharedDashboardRoutingTable]}}),define("entry_point/configurations/routing/routing_tables/shared_command_center_routing_table",["require","exports","entry_point/configurations/angular_configuration/complete"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedCommandCenterRoutingTable={routes:{SHARED_COMMAND_CENTER:{patterns:["/*/:source/:source_id/command_center_public/COMMAND_CENTER_SCREEN"],angularConfiguration:i.completeAngularConfiguration}}}}),define("entry_point/configurations/operation_modes/shared_command_center_mode",["require","exports","entry_point/configurations/routing/routing_tables/shared_command_center_routing_table","entry_point/configurations/lifetime_services/normal"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedCommandCenterMode={lifeTimeServices:n.normalLifeTimeServices,public:!0,routingTables:[i.sharedCommandCenterRoutingTable]}}),define("services/application_mode",["require","exports","log","entry_point/configurations/operation_modes/embedded_widget_mode","entry_point/configurations/operation_modes/hootsuite_dashboard_mode","entry_point/configurations/operation_modes/image_export_mode","entry_point/configurations/operation_modes/login_mode","entry_point/configurations/operation_modes/normal_mode","entry_point/configurations/operation_modes/shared_dashboard_mode","classes/context_data/context_data","services/router","reusable_utilities","entry_point/configurations/operation_modes/shared_command_center_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){var p;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SANDBOX=0]="SANDBOX",e[e.NORMAL=1]="NORMAL",e[e.LOGIN=2]="LOGIN",e[e.IMAGE_EXPORT=3]="IMAGE_EXPORT",e[e.HOOTSUITE_DASHBOARD=4]="HOOTSUITE_DASHBOARD",e[e.EMBEDDED=5]="EMBEDDED",e[e.SHARED_DASHBOARD=6]="SHARED_DASHBOARD",e[e.SHARED_COMMAND_CENTER=7]="SHARED_COMMAND_CENTER"}(p=t.AppMode||(t.AppMode={}));class h{getCurrentAppMode(){return p[window.bootPayload.operationMode]}getAppModeModelForCurrentMode(){return this.getAppModeModel(this.getCurrentAppMode())}getAppModeModel(e){switch(e){case p.NORMAL:return a.normalMode;case p.LOGIN:return r.loginMode;case p.IMAGE_EXPORT:return o.imageExportMode;case p.EMBEDDED:return n.embeddedWidgetMode;case p.SHARED_DASHBOARD:return c.sharedDashboardMode;case p.SHARED_COMMAND_CENTER:return u.sharedCommandCenterMode;case p.HOOTSUITE_DASHBOARD:return s.hootsuiteDashboardMode;default:return i.logService.error("Unknown operation mode defaulting to normal"),a.normalMode}}isMobile(){return this.hasMobileUserAgent()&&!0===l.contextData.commonPropertiesContainer.mobile}hasMobileUserAgent(){return-1!==window.navigator.userAgent.indexOf("Mobi")}setMobileMode(e){const t=new g.Url(window.location.href);t.setUrlParameter("mobile",e?"true":"false"),d.routerService.router.forceReload(t.getHref())}}t.ApplicationModeService=h,t.applicationMode=new h}),define("classes/refresh/refresh_decorator_interface",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/refresh/model_type",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PAGE_STATE=0]="PAGE_STATE",e[e.STATELESS_SCREEN_SECTION=1]="STATELESS_SCREEN_SECTION",e[e.WIDGET=2]="WIDGET"}(t.ModelType||(t.ModelType={}))}),define("classes/refresh/decorator/page_state/page_state_load_more_decorator",["require","exports","classes/refresh/decorator/abstract_page_state_refresh_decorator"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateLoadMoreDecorator=class extends i.AbstractPageStateRefreshDecorator{prepareForRefresh(e){return{page_state:this.copyPageState(e.keepPayload).toProto()}}processResponse(e,t){return this.mergePageStateFromRestForm(e,t),this.setUrlHash(this.pageState.getApplication()),this.handleAngularScopeApply(),this.pageState}}}),define("classes/refresh/decorator/page_state/page_state_reload_decorator",["require","exports","classes/refresh/decorator/abstract_page_state_refresh_decorator"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateReloadDecorator=class extends i.AbstractPageStateRefreshDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return this.preparePageStateRefresh(t),e.noLoadingBubble||this.showSpinner(),{page_state:t.toProto()}}processResponse(e,t){const i=this.wrapPageStateFromRestForm(e);return this.setUrlHash(i.getApplication()),this.handleAngularScopeApply(),this.delayHideSpinnerBy(300),i}}}),define("classes/refresh/decorator/page_state/page_state_refresh_no_cache_decorator",["require","exports","classes/refresh/decorator/abstract_page_state_refresh_decorator"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateRefreshNoCacheDecorator=class extends i.AbstractPageStateRefreshDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return this.bypassCache(t),this.preparePageStateRefresh(t),this.showSpinner(),{page_state:t.toProto()}}processResponse(e,t){return this.mergePageStateFromRestForm(e,t),this.dispatchPageStateReceivedEvents(),this.setUrlHash(this.pageState.getApplication()),this.handleAngularScopeApply(),this.delayHideSpinnerBy(300),this.pageState}}}),define("classes/refresh/decorator/widget_refresh_decorator",["require","exports","other/tw","wrappers/page_state/page_state_wrapper","classes/refresh/model_refresh_strategy"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.WidgetRefreshDecorator=class{constructor(e,t){this.pageState=e,this.endpoint="page_state",this.application=t}prepareForRefresh(e){return{page_state:this.pageState.copyAndPrune(!0).toProto()}}processResponse(e,t){const i=new n.PageStateWrapper(e.page_state,this.pageState.getApplication());if(localStorage.getItem("cluster_config")){const e=JSON.parse(localStorage.getItem("cluster_config"));i.getWidgets().forEach(t=>{t.isDocumentCluster()&&t.hasPayloadValue()&&(t.getExtendedConfiguration().setClusterLabelsShown(e.canShowLabels),t.getExtendedConfiguration().setColorScheme(e.colorScheme),t.hasMenu()&&t.getMenu().hasClusterLabelsMenu()&&(t.getMenu().getClusterLabelsMenu().getSelectedEntriesRecursively().forEach(e=>e.setSelected(!1)),t.getMenu().getClusterLabelsMenu().selectEntryByMappedId(e.canShowLabels?"1":"0")),t.hasMenu()&&t.getMenu().hasColoringOptionsMenu()&&(t.getMenu().getColoringOptionsMenu().getSelectedEntriesRecursively().forEach(e=>e.setSelected(!1)),t.getMenu().getColoringOptionsMenu().selectEntryByMappedId(`${e.colorScheme}`)),t.setConfigurationChanged(!0))}),localStorage.removeItem("cluster_config")}return this.pageState.getApplication().injectPageState(i,!0,t===s.ModelRefreshStrategy.LOAD_MORE_CONTENT),this.handleAngularScopeApply(),i}processError(e,t){if(e.request_limit_breached&&e.page_state)return this.processResponse(e,t);throw e}isAllowed(){return this.pageState.isSkeleton()||!this.pageState.areAllWidgetsDeferred()}handleAngularScopeApply(){i.tw.inject("$rootScope").$$phase||i.tw.inject("$rootScope").$apply()}}}),define("services/grid_drag_handle",["require","exports"],function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FORBIDDEN="fa-ban",e.MOVE="fa-arrows",e.EXCHANGE="fa-exchange",e.STACK="fa-clone",e.NONE=""}(i=t.DragHandleIcon||(t.DragHandleIcon={}));class n{setAsInvalid(e,t=i.FORBIDDEN){e.classList.remove("valid-target"),e.classList.add("invalid-target");const n=$(e).find(".content")[0];n&&(n.className="content fa fa-3x "+t)}setAsValid(e,t=i.MOVE){e.classList.remove("invalid-target"),e.classList.add("valid-target");const n=$(e).find(".content")[0];n&&(n.className="content fa fa-3x "+t)}}t.GridDragHandleService=n,t.gridDragHandleService=new n}),define("components/resizable/directive",["require","exports","event_bus","reusable_utilities","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"A",scope:{model:"=",strategy:"=",showPermanent:"=?"},controller:o}};class o{constructor(e,t){this.$scope=e,this.$element=t,this.sides=["top","right","bottom","left","top-right-right","top-right-top","bottom-right","bottom-left","top-left"],this.model=e.model,this.element=t}$onInit(){this.showPermanent=void 0!==this.$scope.showPermanent&&this.$scope.showPermanent,this.cancellationToken=new n.CancellationToken(i.eventBus.subscribe(i.EVENT_TYPES.TOGGLE_RESIZABLE_DISPLAY,this.setPermanentResizer.bind(this)).unsubscribe),this.model&&this.element&&this.setupEvents()}setupEvents(){this.showPermanent?this.showResizeZones():(this.onMouseEnter=this.onMouseEnterHandler.bind(this),this.onMouseLeave=this.onMouseLeaveHandler.bind(this),this.element.on("mouseenter",this.onMouseEnter),this.element.on("mouseleave",this.onMouseLeave)),this.$scope.$on("$destroy",this.destroy.bind(this))}destroy(){this.showPermanent||(this.element.off("mouseenter",this.onMouseEnter),this.element.off("mouseenter",this.onMouseLeave)),this.cancellationToken.cancel()}onMouseEnterHandler(e){!this.showPermanent&&this.$scope.strategy&&this.$scope.strategy.isActive()&&this.showResizeZones()}onMouseLeaveHandler(e){this.showPermanent||this.hideResizeZones()}showResizeZones(e){this.model.isMovable()&&(this.element.addClass("resizable"),s.forEach(this.sides,t=>this.createResizer(t,e)))}hideResizeZones(){this.model.isMovable()&&!this.showPermanent&&(this.element.removeClass("resizable"),s.forEach(this.sides,e=>this.removeResizer(e)))}createResizer(e,t){const i=$(`\n            <div class="resizer ${e}">\n                <div class="line"></div>\n            </div>\n        `);void 0!==t&&(s.contains(["top","right","bottom","left"],e)?i.find(".line").css({backgroundColor:t}):i.find(".line").css({borderColor:t})),this.element.append(i)}removeResizer(e){$(`.resizer.${e}`,this.element).remove()}setPermanentResizer(e){if(e.value.id===this.model.getCurrentItemId()){const t=this.showPermanent;this.hideResizeZones(),this.showPermanent=e.value.show,this.showPermanent!==t&&(this.showPermanent?this.showResizeZones("#a2daf1"):this.hideResizeZones())}}}o.$inject=["$scope","$element"],t.ResizableController=o}),define("classes/draggable/strategy/interfaces",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/filter_menu/interfaces/topic_menu_wrapper_attributes",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("wrappers/topic_menu/topic_entry_functions",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mediaTypeToPageMonitoring=function(e){let t;switch(e){case"SOCIALMEDIA_FACEBOOK":t="MONITORED_CATEGORY|fb";break;case"SOCIALMEDIA_TWITTER":t="MONITORED_CATEGORY|tw";break;case"SOCIALMEDIA_INSTAGRAM":t="MONITORED_CATEGORY|ig";break;case"SOCIALMEDIA_YOUTUBE":t="MONITORED_CATEGORY|yt";break;case"SOCIALMEDIA_DAILYMOTION":t="MONITORED_CATEGORY|dm";break;case"SOCIALMEDIA_FLICKR":t="MONITORED_CATEGORY|fl";break;case"SOCIALMEDIA_FOURSQUARE":t="MONITORED_CATEGORY|fs";break;case"SOCIALMEDIA_GOOGLEPLUS":t="MONITORED_CATEGORY|gp";break;case"SOCIALMEDIA_LINKEDIN":t="MONITORED_CATEGORY|li";break;case"SOCIALMEDIA_MIXCLOUD":t="MONITORED_CATEGORY|mc";break;case"SOCIALMEDIA_SOUNDCLOUD":t="MONITORED_CATEGORY|sc";break;case"SOCIALMEDIA_VIMEO":t="MONITORED_CATEGORY|vi";break;case"SOCIALMEDIA_WEIBO":t="MONITORED_CATEGORY|wb";break;case"SOCIALMEDIA_DOUBAN":t="MONITORED_CATEGORY|db";break;default:return}return t}}),define("wrappers/topic_menu/enums/topic_entry_visibility_strategy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NO_DUPLICATES="NO_DUPLICATES",e.ALL="ALL"}(t.TopicEntryVisibilityStrategy||(t.TopicEntryVisibilityStrategy={}))}),define("wrappers/topic_menu/topic_entry_wrapper",["require","exports","underscore","log","wrappers/topic_menu/topic_entry_functions","wrappers/topic_menu/enums/topic_entry_visibility_strategy","talkwalker_constants","other/tw","classes/application/abstract_application","services/context","services/configuration","services/rest_form_service","services/tw_routing","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});class h{constructor(e,t,s){this.hidden=!1,this.collapsableRoot=!1,n.logService.assert(void 0!==e,"topicEntry is required"),n.logService.assert(!i.isArray(e),"topicEntry must not be an array"),this.topicEntry=e,this.parentEntry=s,this.associatedTopicMenuWrapper=t,this.initialize()}static create(e,t){const n=Object.create(h.prototype);return n.topicEntry={mapped_id:e,children:[]},i.isUndefined(t)||(n.topicEntry.name=t),n.initialize(),n}initialize(){this.junctions=[],this.junctionIndexes=[],this.associatedTopicMenuWrapper?(this.visibilityStrategies={},this.visibilityStrategies[o.TopicEntryVisibilityStrategy.ALL]=this.allVisibleStrategy,this.visibilityStrategies[o.TopicEntryVisibilityStrategy.NO_DUPLICATES]=this.noDuplicatesVisibleStrategy,u.twRoutingService.getGroupPage()===constants.group_page.settings?this.visibilityStrategy=this.visibilityStrategies[o.TopicEntryVisibilityStrategy.ALL]:this.visibilityStrategy=this.visibilityStrategies[d.configurationService.getTopicMenuConfiguration().getChildVisibilityStrategy(this.associatedTopicMenuWrapper.getType())]):this.visibilityStrategy=this.allVisibleStrategy.bind(this)}getTopicMenuType(){return this.associatedTopicMenuWrapper.getType()}isCollapsableRoot(){return this.collapsableRoot}getMultiSelectionStrategy(){if(void 0!==this.topicEntry.selection_type)return{strategy:this.topicEntry.selection_type,root:this};if(!this.hasParent())throw new Error("No selection strategy found at root level");return this.getParent().getMultiSelectionStrategy()}toProto(){const e=this.getOwnChildren();return 0===e.length?(this.topicEntry.children=void 0,this.topicEntry):(void 0===this.topicEntry.children&&(this.topicEntry.children=[]),this.topicEntry.children.length=0,e.forEach(e=>{this.topicEntry.children.push(e.toProto())}),this.topicEntry)}toModel(){const e=i.omit(this.topicEntry,["children"]),t=this.getChildren();return 0===t.length?e:(e.children=[],t.forEach(t=>{e.children.push(t.toModel())}),e)}isJunction(e){return-1!==this.junctions.indexOf(e)}merge(e,t){void 0===t&&(t=new n.LogCluster("Entry wrapper merge",n.logLevel.DEBUG,h.logFeature)),t.addNestingLevel("Merging entry : "+this.getMappedId()),t.addObject(this,!0,"toProto"),t.addObject(e,!0,"toProto"),this.selectionConstraints=void 0,void 0!==this.topicEntry.filter_hits&&void 0===e.topicEntry.filter_hits&&e.hasChildren()&&(e.topicEntry.filter_hits=this.topicEntry.filter_hits),this.topicEntry=e.topicEntry;const s=e.getOwnChildren(),o=this.getChildren(),r=o.slice(),a=e=>i.find(r,t=>t.getMappedId()===e),c=this.junctions.slice(),l=this.junctionIndexes.slice();this.removeAllJunctions(),o.length=0;for(let e=0;e<s.length;e++){t.addMessage("Checking if child exists: "+s[e].getMappedId());const i=a(s[e].getMappedId());void 0!==i?(t.addMessage("Found: merging"),o.push(i),i.getOwnChildrenCount()>0&&s[e].getOwnChildrenCount()>0||i.getOwnChildrenCount()>0&&(t.addMessage("New child has no children, dropping existing children"),i.children=void 0),i.merge(s[e],t)):(t.addMessage("Not found: adding as new child"),s[e].parentEntry=this,o.push(s[e]),s[e].associatedTopicMenuWrapper=this.associatedTopicMenuWrapper)}this.reAddJunctions(c,l),t.addMessage("Result for: "+this.getMappedId()),t.addObject(this,!0,"toProto"),t.removeNestingLevel()}discoverSelectionStrategy(){void 0!==this.topicEntry.selection_type&&void 0!==this.topicEntry.topic_behaviour?this.associatedTopicMenuWrapper.selectionStrategy=this.topicEntry.selection_type:i.each(this.getOwnChildren(),e=>{e.discoverSelectionStrategy()})}isVisible(){return this.visibilityStrategy()&&(!this.hasVisibility()||this.getVisibility()!==r.Visibility.NOT_VISIBLE)}isHidden(){return this.hidden}show(){this.hidden=!1}hide(){this.hidden=!0}hasVisibility(){return!i.isUndefined(this.getVisibility())}getVisibility(){return this.topicEntry.visibility}setVisibility(e){this.topicEntry.visibility=e}getRelevantPageState(){return void 0!==this.associatedTopicMenuWrapper&&this.associatedTopicMenuWrapper.hasAssociatedUserFilterSettings()&&void 0!==this.associatedTopicMenuWrapper.getAssociatedUserFilterSettings().getPageState()?this.associatedTopicMenuWrapper.getAssociatedUserFilterSettings().getPageState():a.tw.pageState}allVisibleStrategy(){return i.isUndefined(this.topicEntry.visibility)||this.topicEntry.visibility===r.Visibility.VISIBLE||this.getRelevantPageState()&&this.getRelevantPageState().isEditMode()&&this.topicEntry.visibility!==r.Visibility.NEVER_VISIBLE||this.topicEntry.visibility===r.Visibility.VISIBLE_ANY_TIME}noDuplicatesVisibleStrategy(){return this.hasParent()&&this.getParent().getMappedId()!==this.getMappedId()&&(i.isUndefined(this.topicEntry.visibility)||this.topicEntry.visibility===r.Visibility.VISIBLE)||!this.hasParent()&&(i.isUndefined(this.topicEntry.visibility)||this.topicEntry.visibility===r.Visibility.VISIBLE)}setParent(e){this.parentEntry=e}hasParent(){return!i.isUndefined(this.parentEntry)}getParent(){return this.parentEntry}hasName(){return void 0!==this.topicEntry.name}isMovable(){return window.location.href.indexOf("tag_management")>-1}getDropZoneConfiguration(){return["CENTER"]}attachTemplate(e){n.logService.assert(void 0!==e,"element is required",h.logFeature),this.element=e}hasTemplate(){return void 0!==this.element}getTemplate(){return this.element}getDescription(){return this.topicEntry.description}hasDescription(){return!i.isUndefined(this.getDescription())}getName(){return this.topicEntry.name}debugPrint(e){this._debugPrint(this,"",!0,!1,e)}_debugPrint(e,t,i,n,s){let o="";n&&(o="red"),s?s.addMessage(t+(i?"└── ":"├── ")+e.debugId(!0,s)):console.log("%c"+t+(i?"└── ":"├── ")+e.debugId(!0,s),"color:"+o);for(let o=0;o<e.getChildrenCount();o++)this._debugPrint(e.getChildren()[o],t+(i?"    ":"│   "),e.getChildrenCount()===o+1,n||e.isJunction(e.getChildren()[o]),s)}debugId(e,t){let i=this.getMappedId()+"|"+this.getName();return this.hasFilterHits()&&(i+=" hits:"+this.getFilterHits()),e&&(this.hasMinSelection()&&(i+=" min:"+this.getMinSelection()),this.hasMaxSelection()&&(i+=" max:"+this.getMaxSelection()),void 0!==this.getSelectionConstraintStrategy()&&this.getChildrenCount()>1&&(i+=" constr.:"+this.getSelectionConstraintStrategy())),i=this.isSelected()?"[X]"+i:"[]"+i}addJunction(e){n.logService.assert(!1===this.isJunction(e),"attempting to add same junction twice",h.logFeature),i.contains(this.associatedTopicMenuWrapper.getJoinedMenuTypes(),e.associatedTopicMenuWrapper.getType())||this.associatedTopicMenuWrapper.getJoinedMenuTypes().push(e.associatedTopicMenuWrapper.getType()),this.addChild(e),this.junctions.push(e);const t=this.getChildrenCount()-1;return i.contains(this.junctionIndexes,t)||this.insertJunctionIndex(t),e}addChildrenAsJunction(e,t){return i.each(e.getChildren(),(e,i)=>{t?this.insertJunction(e,i):this.addJunction(e)},this),e}setMappedId(e){this.topicEntry.mapped_id=e}removeEntry(e){let t=!1;if(this.hasChild(e))this.removeChild(e),t=!0;else for(let i=0;i<this.getChildren().length&&!(t=this.getChildren()[i].removeEntry(e));i++);return t}setChildren(e){this.getChildren().length=0,this.children.push.apply(this.children,e)}reAddJunctions(e,t){let i;for(i=0;i<e.length;i++){const n=t[i];this.reinsertJunction(e[i],n)}}insertJunction(e,t){n.logService.assert(!1===this.isJunction(e),"attempting to add same junction twice",h.logFeature),i.contains(this.associatedTopicMenuWrapper.getJoinedMenuTypes(),e.associatedTopicMenuWrapper.getType())||this.associatedTopicMenuWrapper.getJoinedMenuTypes().push(e.associatedTopicMenuWrapper.getType()),e.setParent(this),e.associatedTopicMenuWrapper=this.associatedTopicMenuWrapper,this.getChildren().splice(t,0,e),this.junctions.push(e),this.junctionIndexes.push(t)}reinsertJunction(e,t){this.junctions.push(e),this.getChildren().splice(t,0,e)}insertJunctionIndex(e){this.junctionIndexes.push(e)}removeAllJunctions(){const e=[];this.junctions.forEach(t=>{this.isJunction(t)&&e.push(t)}),i.each(e,this.removeChild,this)}getFirstSelectedEntry(){return i.find(this.getChildren(),e=>e.isSelected())}getFirstSelectedEntryRecursively(){let e=this.getFirstSelectedEntry();if(e)return e;for(let t=0;t<this.getChildrenCount();t++)if(e=this.getChildren()[t].getFirstSelectedEntryRecursively())return e}getEntriesRecursively(){const e=[];return this.queryAllEntries(t=>{e.push(t)}),e}getSelectedEntriesRecursively(e=!1){const t=[];return this.queryAllEntries(e=>{e.isSelected()&&t.push(e)},e),t}getSelectedEntriesLeavesRecursively(e=!1){const t=[];return this.queryAllEntries(e=>{e.isSelected()&&(e.hasChildren()?t.push(...e.getChildren()):t.push(e))},e),t}getAllLeavesRecursively(e=!1){const t=[];return this.queryAllEntries(e=>{e.hasChildren()||t.push(e)},e),t}getSelectedChildren(){return i.filter(this.getChildren(),e=>e.isSelected())}getUnselectedChildren(){return i.filter(this.getChildren(),e=>!e.isSelected())}isParentAndGrandParentSelected(){let e=this.getParent();return!(void 0!==e&&e.isSelected()||void 0===e||void 0===(e=e.getParent())||!e.isSelected())}isParentOrGrandParentSelected(){let e=this.getParent();const t=void 0!==e&&e.isSelected();return!(t||void 0===e||void 0===(e=e.getParent())||!e.isSelected())||t}queryAllEntries(e,t=!1){n.logService.assert(void 0!==e,"action is required"),n.logService.assert(i.isFunction(e),"action must be a function"),n.logService.assert(1===e.length,"action must take 1 argument"),t||e(this),this.getChildren().forEach(t=>t.queryAllEntries(e))}getChildIndex(e){return n.logService.assert(void 0!==e,"entry is required"),n.logService.assert(e instanceof h,"entry must be wrapped"),this.topicEntry.children.indexOf(e.getTopicEntry())}getLeavesCountRecursively(){if(0===this.getChildrenCount())return 1;let e=0;for(let t=0;t<this.getChildrenCount();t++)e+=this.getChildren()[t].getLeavesCountRecursively();return e}countSelectionRecursively(){let e=0;if(this.isSelected())e+=this.getLeavesCountRecursively();else for(let t=0;t<this.getChildrenCount();t++)e+=this.getChildren()[t].countSelectionRecursively();return e}getTopicEntry(){return this.topicEntry}getMappedId(){return this.topicEntry.mapped_id}getOwnChildren(){return this.getChildren().filter(e=>!this.isJunction(e))}getOwnChildrenCount(){return this.getChildren().length-this.junctions.length}getChildren(){return void 0===this.children&&(this.children=[],i.each(this.topicEntry.children,e=>{this.children.push(new h(e,this.associatedTopicMenuWrapper,this))},this)),this.children}getOriginalChildren(){const e=[];return this.getChildren().forEach(t=>e.push(t.getTopicEntry())),e}getFamilies(){return i.filter(this.getChildren(),e=>e.hasChildren())}swapChildOrder(e,t){n.logService.assert(void 0!==e,"mapped id is required"),n.logService.assert(void 0!==t,"new index is required");const s=this.getChildren();let o;for(let t=0;t<s.length;t++)if(s[t].getMappedId()===e){o=t;break}if(i.isUndefined(o)){const n=i.find(s,i=>i.swapChildOrder(e,t));return!i.isUndefined(n)}return!(o===t||t<0||t>=s.length)&&(s.splice(t,0,s.splice(o,1)[0]),!0)}clearNotification(){this.topicEntry.notification=void 0}hasNotification(){return void 0!==this.topicEntry.notification}getNotification(){return this.topicEntry.notification}getNotificationTrigger(){return this.topicEntry.notification_trigger}hasNotificationTrigger(){return void 0!==this.topicEntry.notification_trigger}getNotificationKey(){return this.topicEntry.notification_key}hasAdditionalInfo(){return void 0!==this.topicEntry.additional_info&&!!this.getAdditionalInfo()}getAdditionalInfo(){return void 0===this.topicEntry.additional_info?"":this.topicEntry.additional_info}hasFilterHits(){return void 0!==this.topicEntry.filter_hits&&this.getFilterHits()>0}setFilterHits(e){this.topicEntry.filter_hits=e}getFilterHits(){return this.topicEntry.filter_hits}hasHits(){return void 0!==this.topicEntry.hits&&this.getHits()>0}getHits(){return this.topicEntry.hits}getHitsText(){return this.topicEntry.hits_text}selectFirstSelectableEntry(){const e=this.getFirstSelectableChild();void 0!==e&&e.setSelected(!0)}getFirstSelectableChild(){return i.find(this.getChildren(),e=>e.isVisible()&&!e.isSelected())}getFirstVisibleChild(){return i.find(this.getChildren(),e=>e.isVisible())}getFirstLeaf(){const e=this.getAllLeavesRecursively(!0);return e.length>0?e[0]:void 0}prune(e=!1){if(this.isSelected())e=!0,this.removeChildren();else{const t=[];this.getChildren().forEach(i=>{i.prune()?e=!0:t.push(i)}),t.forEach(e=>{this.removeChild(e)}),0===this.getChildrenCount()&&this.hasSelectionChanged()&&(e=!0)}return e}addChild(e){if(void 0===e)throw new Error("child cannot be undefined");e.setParent(this),e.associatedTopicMenuWrapper=this.associatedTopicMenuWrapper,this.getChildren().push(e),i.isUndefined(this.topicEntry.children)&&(this.topicEntry.children=[])}addChildAtIndex(e,t){e.setParent(this),e.associatedTopicMenuWrapper=this.associatedTopicMenuWrapper,this.getChildren().splice(t,0,e)}removeChildren(){this.children=[],this.junctions=[],this.junctionIndexes=[]}removeChildByMappedId(e){return this.removeChild(this.getEntryByMappedId(e))}removeChild(e){if(this.isJunction(e)){const t=this.junctions.indexOf(e);this.junctions.splice(t,1),this.junctionIndexes.splice(this.junctionIndexes.indexOf(t),1)}const t=i.indexOf(this.getChildren(),e);n.logService.assert(-1!==t,"entry not found",h.logFeature,{TM:this,entry:e}),this.getChildren().splice(t,1)}hasChildren(){return this.getChildrenCount()>0}hasChildGroups(){return this.getChildGroupCount()>0}hasChild(e){let t=!1;for(let i=0;i<this.getChildren().length;i++)if(this.getChildren()[i].getMappedId()===e.getMappedId()){t=!0;break}return t}getChildByMappedId(e){let t;for(let i=0;i<this.getChildren().length;i++)if(this.getChildren()[i].getMappedId()===e){t=this.getChildren()[i];break}return t}hasMinSelection(){return void 0!==this.topicEntry.select_children_min}getMinSelection(){return this.topicEntry.select_children_min}hasMaxSelection(){return void 0!==this.topicEntry.select_children_max}getMaxSelection(){return this.topicEntry.select_children_max}setHits(e){n.logService.assert(void 0!==e,"value is required"),this.topicEntry.hits=e}setSelectionRecursively(e){n.logService.assert(void 0!==e,"selected is required"),this.setSelected(e),this.setChildrenSelectionRecursively(e)}setChildrenSelectionRecursively(e){n.logService.assert(void 0!==e,"selected id is required");const t=this.getChildren();i.each(t,t=>{t.setSelectionRecursively(e)})}toggleSelection(e){this.setSelected(!this.isSelected(),e)}getEntryByMappedId(e,t){if(n.logService.assert(void 0!==e,"mapped id is required"),this.getMappedId()===e){if(void 0===t)return this;if(this.getParent().getMappedId()===t)return this}const i=this.getChildren();for(let n=0;n<i.length;n++){const s=i[n].getEntryByMappedId(e,t);if(void 0!==s)return s}}hasEntryByMappedId(e){if(n.logService.assert(void 0!==e,"mapped id is required"),this.getMappedId()===e)return!0;const t=this.getChildren();for(let i=0;i<t.length;i++){const n=t[i].hasEntryByMappedId(e);if(n)return n}return!1}getEntryByName(e){if(n.logService.assertDefined(e,h.logFeature),this.getName()===e)return this;const t=this.getChildren();for(let n=0;n<t.length;n++){const s=t[n].getEntryByName(e);if(!i.isUndefined(s))return s}}hasEntryByName(e){if(n.logService.assertDefined(e,h.logFeature),this.getName()===e)return!0;const t=this.getChildren();for(let i=0;i<t.length;i++){const n=t[i].hasEntryByName(e);if(n)return n}return!1}getEntriesByMappedId(e){n.logService.assert(void 0!==e,"mapped id is required");let t=[];const i=this.getChildren();for(let n=0;n<i.length;n++)t=t.concat(i[n].getEntriesByMappedId(e));return 0===t.length&&this.getMappedId()===e&&t.push(this),t}_minSelectionConstraint(){return this.countSelectionRecursively()>=this.getMinSelection()}_maxSelectionConstraint(e){const t=this.countSelectionRecursively();return t<=this.getMaxSelection()||!(!e.isSelected()||2!==t||1!==this.getMaxSelection())&&(this.setSelectionRecursively(!1),e.setSelected(!0),!0)}_hasConstraints(){return this._getConstraintChecks().length>0}_getConstraintChecks(){return this.selectionConstraints||(this.selectionConstraints=[],this.hasMinSelection()&&this.selectionConstraints.push(this._minSelectionConstraint.bind(this)),this.hasMaxSelection()&&this.selectionConstraints.push(this._maxSelectionConstraint.bind(this))),this.selectionConstraints}_isSelectionValid(e,t){let i;const n=this._getConstraintChecks();for(let s=0;s<n.length;s++)if(!(i=n[s](e)))return t.addMessage("Selection invalid "+e.getMappedId()),!1;return!0}_isBranchSelectionValid(e,t){t.addMessage("checking branch with strategy : "+this.getSelectionConstraintStrategy(t)+" results:"+e);let n,s=0;switch(i.each(e,e=>{!0===e&&s++}),this.getSelectionConstraintStrategy(t)){case r.SelectionConstraintStrategy.CONSTRAINT_AND:n=s===e.length;break;case r.SelectionConstraintStrategy.CONSTRAINT_OR:n=s>0;break;case r.SelectionConstraintStrategy.CONSTRAINT_XOR:n=1===s}return t.addMessage("Validation result : "+n),n}_validateSelection(e,t){let i;if(t.addNestingLevel("validating selection on entry:"+this.debugId(!1)),0===this.getChildrenCount())return i=this._isSelectionValid(e,t),t.removeNestingLevel(),i;{const n=[];for(let i=0;i<this.getChildrenCount();i++)n.push(this.getChildren()[i]._validateSelection(e,t));return this._isBranchSelectionValid(n,t)?(i=this._isSelectionValid(e,t),t.removeNestingLevel(),i):(t.addMessage("Validation of: "+e.getMappedId()+"|"+e.getName()+" failed"),t.removeNestingLevel(),!1)}}getSelectionConstraintStrategy(e){return void 0===this.topicEntry.selection_constraint_strategy?(void 0!==e&&e.addMessage("SelectionConstraintStrategy: "+r.SelectionConstraintStrategy.CONSTRAINT_OR),r.SelectionConstraintStrategy.CONSTRAINT_OR):(void 0!==e&&e.addMessage("SelectionConstraintStrategy: "+this.topicEntry.selection_constraint_strategy),this.topicEntry.selection_constraint_strategy)}containsEntry(e){return void 0!==this.getEntryByMappedId(e.getMappedId())}getChildrenCount(){return this.getChildren().length}getVisibleChildrenCount(){return i.filter(this.getChildren(),e=>e.isVisible()).length}getChildGroupCount(){return this.getChildGroups().length}getChildGroups(){let e=this.getChildren();return this.getAssociatedTopicMenu().isEvent()&&void 0!==this.getChildren()[1]&&(e=[this.getChildren()[1]]),i.filter(e,e=>e.hasChildren())}getVisibleChildren(){return i.filter(this.getChildren(),e=>e.isVisible())}removeInvisibleChildrenRecursive(){this._removeInvisibleChildren(),i.each(this.getChildren(),e=>e.removeInvisibleChildrenRecursive())}_removeInvisibleChildren(){const e=[];i.each(this.getChildren(),t=>{t.isVisible()||e.push(t)}),i.each(e,e=>{this.removeChild(e)})}allChildrenSelected(){const e=this.getChildren();for(let t=0;t<e.length;t++)if(e[t].isVisible()&&!e[t].isSelected())return!1;return!0}isCollapsed(){return!!this.topicEntry.collapsed}toggleCollapse(){this.topicEntry.collapsed=!this.isCollapsed()}containsSelection(e=!1){if(this.isSelected()&&!e)return!0;const t=this.getChildren();for(let e=0;e<t.length;e++){const i=t[e].containsSelection();if(i)return i}return!1}hasSelectionChanged(){return void 0!==this.topicEntry.selected}isSelected(){return this.topicEntry.selected===r.Selected.NODE}_showNotification(e,t){const n=this,s=[];"PRINT"!==this.getMappedId()&&"BROADCAST"!==this.getMappedId()&&s.push({text:i.isUndefined(t)?p.contextData.getMessage("_939087"):t,onClick:function(e){window.location.href=routes.controllers.tw.TopicSetup.show(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id).url,this.close()}}),s.push({text:p.contextData.getMessage("_465488"),onClick:function(e){e.stopPropagation();const t={notification_key:n.getNotificationKey()};g.restFormService.post(routes.controllers.tw.TWRestForm.post(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,"notification_form","dismiss","","rform").url,t),n.clearNotification(),this.close()}}),s.push({text:p.contextData.getMessage("_716089"),isPrimary:function(){return!0},onClick:function(e){e.stopPropagation(),this.close()}}),a.tw.inject("bubbleDialogService").destroyById(constants.bubble_dialog.id.topic_menu_message),a.tw.inject("bubbleDialogService").createMessage(constants.bubble_dialog.id.topic_menu_message,e,"Warning",n.getNotification(),s,d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.topic_menu_message))}_checkPageMonitoring(e){const t=a.tw.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.page_monitoring);if(void 0===t)return;const i=s.mediaTypeToPageMonitoring(this.getMappedId());if(void 0!==i){const n=t.getEntryByMappedId(i);void 0===e||void 0!==n&&0!==n.getChildrenCount()||this._showNotification(e,p.contextData.getMessage("_267578"))}}showNotification(e){switch(this.getNotificationTrigger()){case constants.topic_entry.notification_trigger.always:this._showNotification(e);break;case constants.topic_entry.notification_trigger.page_monitoring:this._checkPageMonitoring(e);break;default:n.logService.error("Unexpected notification trigger",h.logFeature,{Entry:this,Trigger:this.getNotificationTrigger()})}}setSelected(e,t){n.logService.assert(void 0!==e,"selected is required"),e?(this.topicEntry.selected=r.Selected.NODE,void 0===t||!this.hasNotification()||this.associatedTopicMenuWrapper.hasAssociatedUserFilterSettings()&&this.associatedTopicMenuWrapper.getAssociatedUserFilterSettings().getPageState().getApplication().getType()!==c.ApplicationType.MAIN||this.showNotification(t)):void 0!==this.topicEntry.selected&&(this.topicEntry.selected=r.Selected.NONE)}invertSelection(e,t){!e||!this.isSelected()&&this.containsSelection(!0)?"SINGLE_OR_MULTIPLE"===this.associatedTopicMenuWrapper.selectionStrategy&&this.allChildrenSelected()?(this.getChildren().forEach(e=>e.invertSelection(!0)),this.getParent().getChildren()[0].setSelected(!0)):"SINGLE_OR_MULTIPLE"===this.associatedTopicMenuWrapper.selectionStrategy&&this.getParent().getChildren()[0].isSelected()?(this.getParent().getChildren()[0].setSelected(!1),this.getChildren().forEach(e=>e.invertSelection(!0))):(this.getChildren().forEach(e=>e.invertSelection(!0)),e||!t||!this.isSelected()&&this.containsSelection(!0)||this.toggleSelection(void 0)):this.toggleSelection(void 0)}getPath(){return this._getPath([])}_getPath(e){return this.hasParent()&&this.parentEntry._getPath(e),e.push(this.getMappedId()),e}getSelectionType(){return this.topicEntry.selection_type}setColor(e){this.topicEntry.color=e}setName(e){this.topicEntry.name=e}setDisabled(e){this.topicEntry.disabled=e}isDisabled(){return!i.isUndefined(this.topicEntry.disabled)&&this.topicEntry.disabled}resetFilterHits(){this.topicEntry.filter_hits=void 0,this.topicEntry.additional_info=void 0,this.hasChildren()&&i.each(this.getChildren(),e=>e.resetFilterHits())}isChildrenHidden(){return!i.isUndefined(this.topicEntry.hide_children)&&this.topicEntry.hide_children}isNotSelectable(){return!i.isUndefined(this.topicEntry.not_selectable)&&this.topicEntry.not_selectable}isSortable(){return!i.isUndefined(this.topicEntry.children_ordering_available)&&this.topicEntry.children_ordering_available&&d.configurationService.getPageConfiguration().isSidebarSortable()}isTopicAdd(){return!i.isUndefined(this.topicEntry.topic_add)&&this.topicEntry.topic_add===constants.topic_entry.add_strategy.add}getTrend(){return this.topicEntry.trend}hasColor(){return!i.isUndefined(this.topicEntry.color)&&this.topicEntry.color.length>0}getColor(){return this.topicEntry.color}getAssociatedTopicMenu(){return this.associatedTopicMenuWrapper}hasAssociatedTopicMenu(){return!i.isUndefined(this.associatedTopicMenuWrapper)}setAdditionalInfo(e){this.topicEntry.additional_info=e}hasChildrenUnselectAvailable(){return void 0!==this.topicEntry.children_unselect_available}isChildrenUnselectAvailable(){return!0===this.topicEntry.children_unselect_available}unselectAndSelectNextSibling(){const e=this.parentEntry.getChildren(),t=e[(e.indexOf(this)+1)%e.length];this.setSelected(!1),t.setSelected(!0)}hasTransientProperties(){return void 0!==this.getTransientProperties()}getTransientProperties(){return this.topicEntry.transient_properties}clone(){const e=JSON.parse(JSON.stringify(this.toProto()));return new h(e,this.getAssociatedTopicMenu(),this.getParent())}}h.logFeature={TopicEntry:{name:"TOPIC_ENTRY_WRAPPER",style:""}},t.TopicEntryWrapper=h,t.default=i.constant(h)}),define("react_components/filter_menu/topic_menu_wrapper_adapter",["require","exports","filter_menu"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuWrapperMenuAdapter=class extends i.MenuAdapter{update(e){this.data=e}getAttributes(){return this.transformAttributes(this.data)}getFilters(){return this.remapTopicMenu(this.data.topicMenu)}transformAttributes(e){const{topicMenu:t,rootId:i,allNodeId:n,controller:s,config:o,selectionModes:r}=e,a=t.getRootEntry();return{topicMenu:{root_entry:a.toProto(),disabled:t.isDisabled(),default_mapped_id:t.getDefaultMappedId()},allNodeId:n,rootId:i||a.getMappedId(),config:this.createMenuConfig(o),controller:s,selectionModes:r}}remapTopicMenu(e,t){return e.getRootEntry().getEntriesRecursively().filter(e=>e.isVisible()).map(t=>({name:t.getName(),selected:t.isSelected(),isNotSelectable:t.isNotSelectable(),mappedId:t.getMappedId(),parent:void 0,children:t.getChildren().filter(e=>e.isVisible()).map(e=>this.remapTopicEntry(e)),needsToken:"NEED_TOKEN"===t.getNotificationTrigger(),significance:this.getSignificance(t),showExpandButton:t.hasChildren()||e.shouldFetchFromServer()&&!t.hasAdditionalInfo()&&!this.isTransientLeaf(t)}))}remapTopicEntry(e){if(e)return{name:e.getName(),selected:e.isSelected(),isNotSelectable:e.isNotSelectable(),mappedId:e.getMappedId(),parent:e.getParent()&&e.getParent().isVisible()?{name:e.getParent().getName(),selected:e.getParent().isSelected(),isNotSelectable:e.getParent().isNotSelectable(),mappedId:e.getParent().getMappedId(),parent:void 0,children:void 0,needsToken:"NEED_TOKEN"===e.getParent().getNotificationTrigger(),significance:this.getSignificance(e.getParent())}:void 0,children:e.getChildren().filter(e=>e.isVisible()).map(e=>this.remapTopicEntry(e)),needsToken:"NEED_TOKEN"===e.getNotificationTrigger(),significance:this.getSignificance(e),showExpandButton:e.hasChildren()||!e.hasAdditionalInfo()&&e.getAssociatedTopicMenu().shouldFetchFromServer()&&!this.isTransientLeaf(e)}}isTransientLeaf(e){return e.hasTransientProperties()&&e.getTransientProperties().is_leaf}getSignificance(e){const{significance:t=0}=e.getTransientProperties()||{};return t}}}),define("classes/refresh/download_options",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/refresh/abstract_download_handler",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDownloadHandler=class{prepareDownloadId(e){return e.id||new i.Url(window.location.href).getParameterHash()||this.createIdWithZone(window.tw.page_state_id)}createIdWithZone(e){let t=e;const i=jstz.determine();return""!==t&&-1===t.indexOf("tz")&&(t=t+"&tz="+i.name()),t}}}),define("classes/refresh/download_handler/page_state_download_handler",["require","exports","classes/refresh/abstract_download_handler","classes/refresh/model_state","services/rest_form_service","services/loading_bubble"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateDownloadHandler=class extends i.AbstractDownloadHandler{constructor(){super(...arguments),this.endpoint="page_state"}prepareRequest(e){const t=this.buildRequestUrl(e);return e.noLoadingBubble||o.loadingBubbleService.showSpinner(),t}handleError(e,t){if(e.request_limit_breached&&e.page_state)return this.handleResponse(e,t);throw e}handleResponse(e,t){return o.loadingBubbleService.hideSpinner(),e.page_state}buildRequestUrl(e){const t=this.prepareDownloadId(e),i=e.modelState===n.ModelState.FULL,o=(new Date).getTime();return s.restFormService.getRFormUrl("page_state","show",t+"|"+i)+"?ts="+o}}}),define("classes/refresh/download_handler/stateless_screen_section_download_handler",["require","exports","classes/refresh/abstract_download_handler"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.StatelessScreenSectionDownloadHandler=class extends i.AbstractDownloadHandler{prepareRequest(e){return this.constructUrl(e)}handleResponse(e,t){return e}handleError(e,t){throw e}constructUrl(e){const{id:t,application:i,applicationModule:n}=e,s=[];return void 0!==t&&t.length>0&&s.push(`group_page_id=${t}`),void 0!==i&&i.length>0&&void 0!==n&&n.length>0&&(s.push(`a=${i}`),s.push(`am=${n}`)),s.length>0?`${e.url}?${s.join("&")}`:e.url}}}),define("services/refresh/model_refresh_service",["require","exports","reusable_utilities","services/rest_form_service","classes/application/abstract_application","services/tw_common","log","services/loading_bubble","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/refresh/download_handler/page_state_download_handler","classes/refresh/download_handler/stateless_screen_section_download_handler","classes/context_data/context_data","event_bus"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){var h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.REFRESH=0]="REFRESH",e[e.DOWNLOAD=1]="DOWNLOAD"}(h=t.ModelRefreshServiceJobType||(t.ModelRefreshServiceJobType={}));const m="ignore";class _{constructor(){this.refreshAllowed=!0,this.backoffFactor=0,this.cancellationTokenMap={},this.cancellationTokenMap[h.REFRESH]=[],this.cancellationTokenMap[h.DOWNLOAD]=[],p.eventBus.subscribe(p.EVENT_TYPES.CANCEL_ALL_REFRESH_JOBS,()=>this.cancelAllJobsByType(h.REFRESH))}cancelAllJobs(){for(const e in this.cancellationTokenMap)this.cancelAllJobsByType(e)}cancelAllJobsByType(e){this.cancellationTokenMap[e].forEach(e=>e.cancel())}async downloadData(e){return this.cancelAllJobsByType(h.DOWNLOAD),this.deferDownloadData(e)}async refresh(e,t){return new Promise((i,n)=>{this.isModelRefreshAllowed(e,t)&&this.refreshAllowed?(this.cancelPreviousRefreshIfExists(h.REFRESH),this.debounceRefresh(e,t,i,n)):n()})}isModelRefreshAllowed(e,t){return e.isAllowed()||!e.isAllowed()&&t.force}cancelPreviousRefreshIfExists(e){const t=this.cancellationTokenMap[e];t.length>0&&(t[t.length-1].cancel(),t.splice(t.length-1,1))}debounceRefresh(e,t,n,s){const o=this.decideRefreshDelay(t),r=new i.CancellationToken,a=Date.now();this.lastRequestTs=a;const l=setTimeout(async()=>{t.strategy===c.ModelRefreshStrategy.REFRESH_NO_CACHE&&(this.refreshAllowed=!1);try{const i=await this.prepareRefreshJob(e,t,r,a);n(i)}catch(e){s(e)}},o);this.addCleanUpFunctionToToken(r,l,s),this.cancellationTokenMap[h.REFRESH].push(r)}prepareRefreshJob(e,t,i,n){return this.performRefresh(e,t,i,n)}async performRefresh(e,t,i,o){try{const r=e.prepareForRefresh(t),a=n.restFormService.getRFormUrl(e.endpoint,"refresh");try{const i=await n.restFormService.post(a,r);this.checkIfLastTimestamp(o);const c=e.processResponse(i,t.strategy);return e.application.setState(s.ApplicationState.IDLE),this.backoffFactor=Math.max(0,this.backoffFactor-1),c}catch(i){return this.handlePerformRefreshPotentialThrottling(i,e,t)}}catch(t){this.handlePerformRefreshFailure(e.application,t)}finally{this.handlePerformRefreshFinalOperation(t,i)}}handlePerformRefreshFailure(e,t){throw t!==m&&e.setState(s.ApplicationState.FATAL_ERROR),t}handlePerformRefreshFinalOperation(e,t){e.strategy===c.ModelRefreshStrategy.REFRESH_NO_CACHE&&(this.refreshAllowed=!0),this.cancellationTokenMap[h.REFRESH].splice(this.cancellationTokenMap[h.REFRESH].indexOf(t),1)}handlePerformRefreshPotentialThrottling(e,t,i){if(e!==m){const n=t.processError(e,i.strategy);return t.application.setState(s.ApplicationState.IDLE),this.backoffFactor++,n}throw e}async deferDownloadData(e){const t=this.getDownloadHandler(e);return new Promise((i,s)=>{const c=t.prepareRequest(e);r.logService.debug(`Fetching ${e.modelType}..`,o.twCommon.logFeatures.Application),setTimeout(()=>{n.restFormService.get(c).then(n=>{r.logService.debug(`Fetched ${e.modelType} has arrived`,o.twCommon.logFeatures.Application),this.backoffFactor=Math.max(0,this.backoffFactor-1),i(t.handleResponse(n,e))},n=>{a.loadingBubbleService.hideSpinner();try{const o=t.handleError(n,e);this.backoffFactor++,i(o)}catch(e){s()}})},this.decideDownloadDelay())})}getDownloadHandler(e){switch(e.modelType){case l.ModelType.PAGE_STATE:return new d.PageStateDownloadHandler;case l.ModelType.STATELESS_SCREEN_SECTION:return new g.StatelessScreenSectionDownloadHandler;default:return void r.logService.error("Download handler not implemented !")}}addCleanUpFunctionToToken(e,t,i){e.addCleanupFunction(()=>{clearTimeout(t),i(),this.cancelAllJobsByType(h.REFRESH)})}checkIfLastTimestamp(e){if(e<this.lastRequestTs)throw m}decideRefreshDelay(e){return(void 0!==e.delay?e.delay:u.contextData.projectSettings.perform_refresh_timeout)+this.computeBackoffTime()}decideDownloadDelay(){return 0+this.computeBackoffTime()}computeBackoffTime(){return 100*(Math.pow(2,this.backoffFactor)-1)}}t.ModelRefreshService=_,t.modelRefreshService=new _}),define("services/filter",["require","exports","underscore","services/broker","other/tw","services/refresh/model_refresh_service","classes/application/application","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.menusSetList=[],n.brokerService.subscribe(constants.events.filters.selected,this.updateFilter.bind(this))}getClearableFilters(){return this.menusSetList}clearFilters(){s.tw.pageState.getUserFilterSettings().resetFilters(),this.menusSetList=[],this.refreshPageData()}clearMenusSetList(){this.menusSetList=[]}updateFilter(e,t){if(void 0!==e)if(t){for(let t=0;t<this.menusSetList.length;t++)if(i.isEqual(this.menusSetList[t],e)){this.menusSetList.splice(t,1);break}}else i(this.menusSetList).contains(e)||this.menusSetList.push(e)}async refreshPageData(){const e={strategy:a.ModelRefreshStrategy.REFRESH},t=l.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,d.ModelType.PAGE_STATE,e);try{await o.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&c.logService.error("Error when refreshing page state after clearing filters !",void 0,e)}}},Object.defineProperty(t,"filterService",{get:function(){return s.tw.inject("filterService")}})}),define("wrappers/abstract_wrapper",["require","exports","log","services/tw_common","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e){this.disposed=!1,this.wrapperType=e,this.uuid="["+e+"]"+n.twCommon.generateUuid(),this.disposeDebugData={uuid:this.uuid}}isDisposed(){return this.disposed}mergeKey(e,t,i){i=i||e,void 0!==this[e]&&void 0!==t[i]?this[e].merge(t[i]):void 0===this[e]&&void 0!==t[i]?this[e]=t[i]:this[e]=void 0}getDisposeDebugData(){console.dir(this.disposeDebugData)}getUuid(){return this.uuid}dispose(){this.isDisposed()||(i.logService.verbose("Destroying "+this.uuid,n.twCommon.logFeatures.AbstractWrapper),this.disposed=!0)}}t.AbstractWrapper=o,t.default=s.constant(o)}),define("services/google_analytics",["require","exports","log","underscore","classes/application/application"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{initialize(){!function(e,t,i,n,s,o,r){e.GoogleAnalyticsObject=s,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=Date.now(),o=t.createElement(i),r=t.getElementsByTagName(i)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",r.parentNode.insertBefore(o,r)}(window,document,"script",0,"ga"),ga("create",constants.google_analytics.api,constants.google_analytics.website),ga("set","anonymizeIp",!0),ga("require","displayfeatures")}sendPageView(){if(this.isEnabled()){const e={},t="(default)",i=s.mainApplication.getPageState().getAllowedPages().getGroupPage();e.dimension1=n.isUndefined(i)?t:i;const o=s.mainApplication.getPageState().getAllowedPages().getPageCategory();e.dimension2=n.isUndefined(o)?t:o;const r=s.mainApplication.getPageState().getAllowedPages().getPageType();e.dimension3=n.isUndefined(r)?t:r;const a=s.mainApplication.getPageState().getAllowedPages().getCompareSelected();e.dimension4=n.isUndefined(a)?t:a;const c=s.mainApplication.getPageState().getAllowedPages().getCustomPageId();e.dimension5=n.isUndefined(c)?t:c,window.ga&&ga("send","pageview",e)}}sendEvent(e,t,s,o){if(i.logService.assertDefined(e),i.logService.assertDefined(t),this.isEnabled()){const i={};i.eventCategory=e,i.eventAction=t,n.isUndefined(s)||(i.eventLabel=s),n.isUndefined(o)||(i.eventValue=o),window.ga&&ga("send","event",i)}}isEnabled(){return!0}}t.GoogleAnalyticsService=o,t.googleAnalyticsService=new o}),define("wrappers/allowed_pages/allowed_pages_wrapper",["require","exports","log","talkwalker_constants","underscore","services/google_analytics","services/tw_common","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(e,t){this.allowedPages=e,void 0!==this.allowedPages.display_pages&&(this.displayPagesWrapper=new a.TopicMenuWrapper(this.allowedPages.display_pages)),void 0!==this.allowedPages.dashboard_page_menu&&(this.dashboardPageMenuWrapper=new a.TopicMenuWrapper(this.allowedPages.dashboard_page_menu)),void 0!==this.allowedPages.report_page_menu&&(this.reportPageMenuWrapper=new a.TopicMenuWrapper(this.allowedPages.report_page_menu)),void 0!==this.allowedPages.command_center_menu&&(this.commandCenterMenu=new a.TopicMenuWrapper(this.allowedPages.command_center_menu)),this.allowedPages.bookmark_menu&&(this.bookmarkMenu=new a.TopicMenuWrapper(this.allowedPages.bookmark_menu)),this.allowedPages.alerts_menu&&(this.alertsMenu=new a.TopicMenuWrapper(this.allowedPages.alerts_menu)),t||this._validate()}toProto(){return void 0!==this.displayPagesWrapper&&(this.allowedPages.display_pages=this.displayPagesWrapper.toProto()),void 0!==this.dashboardPageMenuWrapper&&(this.allowedPages.dashboard_page_menu=this.dashboardPageMenuWrapper.toProto()),void 0!==this.reportPageMenuWrapper&&(this.allowedPages.report_page_menu=this.reportPageMenuWrapper.toProto()),void 0!==this.commandCenterMenu&&(this.allowedPages.command_center_menu=this.commandCenterMenu.toProto()),this.allowedPages}hasErrorMessage(){return void 0!==this.allowedPages.missing_data_reason_message}getErrorMessage(){return this.allowedPages.missing_data_reason_message}setErrorMessage(e){this.allowedPages.missing_data_reason_message=e}getApplication(){return this.allowedPages.application}getModule(){return this.allowedPages.module}getPageMode(){return this.allowedPages.page_mode}clearDashboards(){void 0!==this.dashboardPageMenuWrapper&&this.dashboardPageMenuWrapper.getRootEntry().removeChildren()}getGroupPage(){return this.allowedPages.group_page}setGroupPage(e){this.allowedPages.group_page=e}isGroupOneOf(e){return e.includes(this.getGroupPage())}hasDisplayPages(){return void 0!==this.displayPagesWrapper}selectPage(e){this.selectPageByMappedId(e.getMappedId())}selectPageByMappedId(e){i.logService.assert(this.hasDisplayPages(),"the current page has no display pages to select",r.twCommon.logFeatures.AllowedPages),this.displayPagesWrapper.selectEntryByMappedId(e)}getDisplayPages(){return this.displayPagesWrapper}hasDashboardPageMenu(){return void 0!==this.dashboardPageMenuWrapper}getDashboardPageMenu(){return this.dashboardPageMenuWrapper}isPageOneOf(e){return e.includes(this.getPageType())}hasReportPageMenu(){return void 0!==this.reportPageMenuWrapper}getReportPageMenu(){return this.reportPageMenuWrapper}hasCommandCenterMenu(){return void 0!==this.commandCenterMenu}getCommandCenterMenu(){return this.commandCenterMenu}hasBookmarkMenu(){return void 0!==this.bookmarkMenu}getBookmarkMenu(){return this.bookmarkMenu}getAlertsMenu(){return this.alertsMenu}getReload(){return this.allowedPages.reload}setReload(e){this.allowedPages.reload=e}merge(e){this._mergeMenu("displayPagesWrapper",e.getDisplayPages()),this._mergeMenu("dashboardPageMenuWrapper",e.getDashboardPageMenu()),this._mergeMenu("reportPageMenuWrapper",e.getReportPageMenu()),this._mergeMenu("bookmarkMenu",e.getBookmarkMenu()),this._mergeMenu("alertsMenu",e.getAlertsMenu()),this.mergeDisplayFields(e);let t=!1;const i=e.getCustomPageId();i!==this.getCustomPageId()&&(this._setCustomPageId(i),t=!0);const n=e.isCustomPageEditable();n!==this.isCustomPageEditable()&&this._setCustomPageEditable(n),this.setCompareSelected(e.getCompareSelected());const s=e.getPageType();s!==this.getPageType()&&(this.setPageType(s),t=!0);const r=e.getPageCategory();r!==this.getPageCategory()&&(this.setPageCategory(r),t=!0),t&&o.googleAnalyticsService.sendPageView(),this.hasErrorMessage()!==e.hasErrorMessage()&&this.setErrorMessage(e.hasErrorMessage()?e.getErrorMessage():void 0),this.setReload(!1)}setPageType(e){this.allowedPages.page_type=e}getPageType(){return this.allowedPages.page_type}setPageCategory(e){this.allowedPages.page_category=e}getPageCategory(){return this.allowedPages.page_category}setCompareSelected(e){this.allowedPages.compare_selected=e}getCompareSelected(){return this.allowedPages.compare_selected}_setCustomPageId(e){this.allowedPages.custom_page_id=e}removeCustomPageId(){delete this.allowedPages.custom_page_id}_setCustomPageEditable(e){this.allowedPages.custom_page_editable=e}isCustomPageEditable(){return this.allowedPages.custom_page_editable}getCustomPageId(){return this.allowedPages.custom_page_id}setCustomPageId(e){this.allowedPages.custom_page_id=e}getCustomPageType(){return this.isReport()?constants.custom_page.type.report:this.isDashboard()?constants.custom_page.type.dashboard:this.isCommandCenterScreenEditMode()?constants.custom_page.type.command_center_screen:this.isCommandCenterWidgetPreview()?constants.custom_page.type.command_center_screen:void 0}_mergeMenu(e,t){void 0===t?this[e]=void 0:void 0===this[e]?this[e]=t:this[e].merge(t)}hasWidgetBubbleTitle(){return void 0!==this.allowedPages.widget_bubble_dialog_title&&this.allowedPages.widget_bubble_dialog_title.length>0}getWidgetBubbleTitle(){return this.allowedPages.widget_bubble_dialog_title}isInfluencerNetwork(){return this.allowedPages.page_type===constants.page_type.da_influencers}isReplay(){return this.allowedPages.page_type===constants.page_type.replay}isReport(){return this.allowedPages.group_page===constants.group_page.report}isTriggerEdit(){return this.allowedPages.group_page===constants.group_page.trigger_condition}isSearch(){return this.allowedPages.group_page===constants.group_page.search}isSearchAdvanced(){return this.allowedPages.group_page===constants.group_page.search_advanced}isFreeSearch(){return this.isSearch()&&"FREE_INSTANT_DISCOVERY_CATEGORY"===this.getPageCategory()}isQuickSearch(){return this.isSearchAdvanced()&&"INSTANT_DISCOVERY_CATEGORY"===this.getPageCategory()}isMonitor(){return this.allowedPages.group_page===constants.group_page.monitor}isTopicSetup(){return this.allowedPages.group_page===constants.group_page.topic_setup}isHomeScreen(){return this.allowedPages.group_page===constants.group_page.home_screen}isBubbleDialog(){return this.allowedPages.group_page===constants.group_page.context_menu}isWidgetEdit(){return this.allowedPages.group_page===constants.group_page.widget_edit}isEmbeddedWidget(){return this.allowedPages.group_page===constants.group_page.embedded_widget}isCustomPage(){return this.isDashboard()||this.isReport()||this.isDashboardTemplate()}isNonPredefinedPage(){return this.isDashboard()||this.isCommandCenter()||this.isReport()}isDashboardTemplate(){return this.allowedPages.group_page===constants.group_page.dashboard_template}isIqApp(){return this.isDashboardTemplate()}isDocumentClusterIqApp(){return"CONVERSATION_CLUSTER_DT_CATEGORY"===this.getPageCategory()}isDashboard(){return this.allowedPages.group_page===constants.group_page.dashboard}isEditFiltersPage(){return this.allowedPages.group_page===constants.group_page.edit}isSettings(){return this.allowedPages.group_page===constants.group_page.settings}isUserWorkflow(){return this.allowedPages.group_page===constants.group_page.user_workflow}isCommandCenter(){return this.allowedPages.group_page===constants.group_page.command_center}isSingleResultEntry(){return this.allowedPages.page_type===constants.page_type.context_menu_result_entry}isCommandCenterWidgetPreview(){return"CONTEXT_COMMAND_CENTER_PREVIEW"===this.allowedPages.page_type}isVelocity(){return this.allowedPages.page_type===constants.page_type.context_menu_velocity}isMessageDiffusion(){return this.allowedPages.page_type===constants.page_type.context_menu_message_diffusion}isInfluencerOverview(){return this.allowedPages.page_type===constants.page_type.context_menu_influencer_overview}isTrendDiscovery(){return this.isTrendDiscoveryDemographics()||this.isTrendDiscoveryInfluencers()||this.isTrendDiscoveryOverview()||this.isTrendDiscoveryResults()||this.isTrendDiscoveryThemes()}isTrendDiscoveryDemographics(){return this.allowedPages.page_type===constants.page_type.td_demographics}isTrendDiscoveryInfluencers(){return this.allowedPages.page_type===constants.page_type.td_influencers}isTrendDiscoveryOverview(){return this.allowedPages.page_type===constants.page_type.td_overview}isTrendDiscoveryResults(){return this.allowedPages.page_type===constants.page_type.td_results}isTrendDiscoveryThemes(){return this.allowedPages.page_type===constants.page_type.td_themes}isVisualDiscovery(){return this.isVisualDiscoveryResults()||this.isVisualDiscoveryAnalytics()||this.isVisualDiscoveryInfluencers()||this.isVisualDiscoveryDemographics()||this.isVisualDiscoveryWorldmap()}isVisualDiscoveryResults(){return this.allowedPages.page_type===constants.page_type.vd_results}isVisualDiscoveryAnalytics(){return this.allowedPages.page_type===constants.page_type.vd_analytics}isVisualDiscoveryInfluencers(){return this.allowedPages.page_type===constants.page_type.vd_influencers}isVisualDiscoveryDemographics(){return this.allowedPages.page_type===constants.page_type.vd_demographics}isVisualDiscoveryWorldmap(){return this.allowedPages.page_type===constants.page_type.vd_worldmap}isInstantDiscovery(){return this.allowedPages.page_type===constants.page_type.id_overview}isPreview(){return this.allowedPages.page_type===constants.page_type.context_menu_preview}isThemeOverview(){return this.allowedPages.page_type===constants.page_type.context_menu_theme_overview}isMessageDiffusionAndVelocity(){return this.allowedPages.page_type===constants.page_type.context_menu_diffusion_and_velocity}isVelocityAndMessageDiffusion(){return this.allowedPages.page_type===constants.page_type.context_menu_velocity_and_diffusion}isLoadMoreStoryClustering(){return this.allowedPages.page_type===constants.page_type.load_more_story_clustering}isMessageDiffusionOrVelocity(){return this.isMessageDiffusion()||this.isVelocity()||this.isMessageDiffusionAndVelocity()||this.isVelocityAndMessageDiffusion()}isCommandCenterScreen(){return this.isCommandCenter()&&this.allowedPages.page_type===constants.page_type.generic}isCommandCenterScreenEditMode(){return this.isCommandCenter()&&this.allowedPages.page_type===constants.page_type.edit}isSandbox(){return void 0===this.allowedPages.page_type&&this.allowedPages.group_page===constants.group_page.generic}hasDisplayingTitle(){return!!this.getDisplayingTitle()}getDisplayingTitle(){return this.allowedPages.displaying_title}setDisplayingTitle(e){this.allowedPages.displaying_title=e}hasDisplayingDescription(){return!!this.getDisplayingDescription()}getDisplayingDescription(){return this.allowedPages.displaying_description}setDisplayingDescription(e){this.allowedPages.displaying_description=e}isDefaultApplication(){return this.getApplication()===n.Application.DEFAULT_APP}isProtectApplication(){return this.getApplication()===n.Application.PROTECT}isDefaultModule(){return this.getModule()===n.ApplicationModule.DEFAULT_MODULE}isIssueTrackerModule(){return this.getModule()===n.ApplicationModule.ISSUE_TRACKER}isInfluencerManagementModule(){return this.getModule()===n.ApplicationModule.INFLUENCER_MANAGEMENT}isReportPreview(){return!0===this.allowedPages.report_preview}mergeDisplayFields(e){this.setDisplayingTitle(e.getDisplayingTitle()),this.setDisplayingDescription(e.getDisplayingDescription())}_validate(){i.logService.assert(void 0!==this.allowedPages.group_page,"Allowed pages group_page is required",r.twCommon.logFeatures.AllowedPages)}}t.AllowedPagesWrapper=c,t.default=s.constant(c)}),define("services/pin",["require","exports","other/tw","services/rest_form_service","services/context","event_bus"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.numPinnedMenus=0}setPinState(e,t){this.handleNumPinnedMenus(e);const r=i.tw.pageState.getAllowedPages(),a={filter_type:t,pin:e,group_page:r.getGroupPage(),custom_page_id:r.getCustomPageId()||r.getPageType()};n.restFormService.post(routes.controllers.tw.TWRestForm.post(s.contextService.getCurrentContext().scope,s.contextService.getCurrentContext().id,"pinned_filters","update","","rform").url,a),o.eventBus.dispatch({type:o.EVENT_TYPES.FILTER_MENU_PIN_TOGGLED,value:void 0})}initNumPinnedMenus(e){let t=0;e.getUserFilterSettings().getTimeFilter().isPinned()&&t++,e.getUserFilterSettings().getSearchbarFilter().isPinned()&&t++,t+=e.getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).length,this.numPinnedMenus=t}getNumPinnedMenus(){return this.numPinnedMenus}handleNumPinnedMenus(e){!0===e?this.numPinnedMenus++:this.numPinnedMenus--}},Object.defineProperty(t,"pinService",{get:()=>i.tw.inject("pinService")})}),define("wrappers/searchbar_filter/searchbar_filter_wrapper",["require","exports","common_constants","event","log","underscore","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/broker","services/configuration","services/navbar","services/pin","services/refresh/model_refresh_service","services/tw_common","wrappers/topic_menu/topic_menu_wrapper","talkwalker_constants"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0});class v{constructor(e,t,i=!1){this.geoboxRegexString="(AND\\s|OR\\s)?\\(?("+constants.world_map.geobox_query_key+"|"+constants.world_map.profile_coord_query_key+")[-]?\\d*\\.?\\d*,[-]?\\d*\\.?\\d*;[-]?\\d*\\.?\\d*,[-]?\\d*\\.?\\d*\\)?\\s?((AND\\s|OR\\s)\\(("+constants.world_map.sourcegeo_resolution.city+"|"+constants.world_map.sourcegeo_resolution.coordinates+"|"+constants.world_map.articlegeo_resolution.city+"|"+constants.world_map.articlegeo_resolution.coordinates+")\\))?",this.searchbar=e,this.userFilterSettings=t,this.onQueryChanged=new n.Event,i||this.validate()}toProto(){return this.searchbar}pin(){this.searchbar.query_pinned=!this.isPinned(),h.pinService.setPinState(this.isPinned(),this.getPinnedType())}isPinnable(){return u.configurationService.getPageConfiguration().canUserPinFilter(this.getType(),this.userFilterSettings.getPageState())&&this.getPinnedType()!==i.topic_menu.pinned_type.none}isPinned(){return u.configurationService.getPageConfiguration().isPinForced(this.getType())||this.searchbar.query_pinned}isForceShowFilter(){return!1}reset(){this.searchbar.query="",this.searchbar.query_override=!1,this.clearMapViewport()}getPinnedType(){return this.searchbar.query_pinned_type}getQuery(){return this.searchbar&&this.searchbar.query?this.searchbar.query:""}hasQuery(){return""!==this.getQuery()}hasGeoboxQuery(){return this.getQuery().indexOf(constants.world_map.geobox_query_key)>-1}hasSourcegeoResolutionCoordinates(){return this.getQuery().indexOf(constants.world_map.sourcegeo_resolution.coordinates)>-1}hasProfileCoordinateQuery(){return this.getQuery().indexOf(constants.world_map.profile_coord_query_key)>-1}removeGeoboxQuery(e){s.logService.assert(this.hasGeoboxQuery()||this.hasProfileCoordinateQuery(),"geobox query required",_.twCommon.logFeatures.Searchbar);const t=new RegExp(this.geoboxRegexString),i=this.getQuery().replace(t,"");this.clearMapViewport(),this.setQuery(i,e)}clearMapViewport(){o.flatten(r.mainApplication.getPageStates().map(e=>e.getWidgets())).filter(e=>e).filter(e=>e.getExtendedConfiguration()).forEach(e=>{e.getExtendedConfiguration().getType()===y.TypeExtendedConfiguration.UUID_CONFIG_WORLDMAP_CONFIGURATION&&e.getExtendedConfiguration().clearViewport()})}getGeoboxQuery(){s.logService.assert(this.hasGeoboxQuery()||this.hasProfileCoordinateQuery(),"geobox query required",_.twCommon.logFeatures.Searchbar);const e=new RegExp(this.geoboxRegexString);return this.getQuery().match(e)[0]}addQuery(e,t,i){this.hasQuery()?this.setQuery(`(${e}) ${t} (${this.getQuery()})`,i):this.setQuery(e,i)}setQuery(e,t){this.searchbar.query=e,this.searchbar.query_override=this.hasQuery()&&u.configurationService.getPageConfiguration().isFilterOverrideMode(),t&&(p.navbarService.getFilterState()===p.FilterState.OPEN?p.navbarService.setFilterState(p.FilterState.CLOSE):this.refreshPageData(),g.brokerService.publish(constants.events.filters.selected,[constants.root_id.searchbar,!this.hasQuery()])),this.onQueryChanged.fire(e)}getStateHash(){return this.getQuery()}getType(){return constants.root_id.searchbar}hasErrorMessage(){return this.userFilterSettings.getPageState().hasErrorMessage()}getErrorMessageCode(){return this.userFilterSettings.getPageState().getErrorMessageCode()}merge(e){this.searchbar.query_pinned=e.searchbar.query_pinned,this.searchbar.query!==e.searchbar.query?(this.searchbar.query=e.searchbar.query,this.onQueryChanged.fire(this.searchbar.query),g.brokerService.publish(constants.events.filters.selected,[constants.root_id.searchbar,!this.hasQuery()])):this.searchbar.query=e.searchbar.query,this.searchbar.query_override=e.searchbar.query_override,this.hasQueryModifierMenu()&&e.hasQueryModifierMenu()?this.getQueryModifierMenu().merge(e.getQueryModifierMenu()):this.hasQueryModifierMenu()?this.queryModifierMenu.dispose():e.hasQueryModifierMenu()&&(this.queryModifierMenu=new f.TopicMenuWrapper(e.queryModifierMenu.toProto(),void 0,this.userFilterSettings))}isOverriden(){return this.searchbar.query_override}getQueryModifierMenu(){return this.queryModifierMenu}hasQueryModifierMenu(){return void 0!==this.getQueryModifierMenu()}dispose(){this.onQueryChanged.cancelAll(),this.searchbar=void 0,this.userFilterSettings=void 0,this.hasQueryModifierMenu()&&(this.queryModifierMenu.dispose(),this.queryModifierMenu=void 0)}validate(){s.logService.assert(void 0!==this.searchbar.query_pinned_type,"pinned_type required",_.twCommon.logFeatures.Searchbar),s.logService.assert(void 0!==this.searchbar.query_pinned,"query_pinned is required",_.twCommon.logFeatures.Searchbar)}async refreshPageData(){const e={strategy:l.ModelRefreshStrategy.REFRESH,delay:a.contextData.projectSettings.slow_refresh_timeout},t=c.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,d.ModelType.PAGE_STATE,e);try{await m.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after setting query !",void 0,e)}}}t.SearchbarFilterWrapper=v,t.default=o.constant(v)}),define("wrappers/time_filter/time_filter_wrapper",["require","exports","common_constants","moment-timezone","other/tw","services/broker","services/configuration","services/pin","wrappers/abstract_wrapper","classes/context_data/context_data","underscore"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});class g extends c.AbstractWrapper{constructor(e,t,i,n=!1){super("TIME_FILTER_WRAPPER"),this.timeFilter=e,this.timeFilterTMWrapper=t,this.associatedUfsWrapper=i,this._initialize(),n||this._validate()}dispose(){super.dispose(),this.timeFilter=void 0,this.timeFilterTMWrapper.dispose(),this.timeFilterTMWrapper=void 0,this.associatedUfsWrapper=void 0}toProto(){return this.timeFilter}reset(){this.clearTimeRange(),this.setTimeInterval(this.getDefaulTimeInterval(),!0)}hasTimeFilterMenu(){return void 0!==this.timeFilterTMWrapper}getTimeFilterMenu(){return this.timeFilterTMWrapper}pin(){this.timeFilter.pinned=!this.isPinned(),a.pinService.setPinState(this.isPinned(),this.getPinnedType())}isPinnable(){return r.configurationService.getPageConfiguration().canUserPinFilter(this.getType(),this.associatedUfsWrapper.getPageState())&&this.getPinnedType()!==i.topic_menu.pinned_type.none}isOverrideMode(){return this.getTimeFilterMenu().isOverrideMode()}isOverriden(){return this.timeFilter.override}getStateHash(){return this.getFrom()+""+this.getTo()}setOverride(e){this.getTimeFilterMenu().setOverride(e),this.timeFilter.override=e;const t=this.associatedUfsWrapper.getTopicMenuByType(constants.topic_menu.TYPE.event);void 0!==t&&t.setOverride(e)}setTimeInterval(e,t=!1,i=!1){this._setTimeInterval(e,t,i)}resetEvents(){const e=this.associatedUfsWrapper.getTopicMenuByType(constants.topic_menu.TYPE.event);e&&e.setEntriesSelectionRecursively(!1)}intervalToMomentValue(e){const t=e.match(/[a-zA-Z]+|[0-9]+/g),i=t[0],n=Number(t[1]);return{identifier:{min:"m",h:"h",d:"d",m:"M",y:"y"}[i],value:n}}_setTimeInterval(e,t=!1,i=!1){if(i&&this.resetEvents(),this.timeFilter.time_interval=e,this.timeFilterTMWrapper.unselectAll(),void 0!==e&&e!==constants.time_filter.TIME_INTERVAL.no_interval&&this.timeFilterTMWrapper.getEntryByMappedId(e).setSelected(!0),!this.hasNoInterval()){const t=n();this._canResetDayTime(e)&&this._resetDayTimeOnMoment(t,!0);const i=n(t.toDate()),s=this.intervalToMomentValue(this.getTimeInterval());i.subtract(s.value,s.identifier),this._setTimeRange(i.toDate().getTime(),t.toDate().getTime(),!0)}r.configurationService.getPageConfiguration().isFilterOverrideMode()&&this.setOverride(!this.hasDefaultState(this.associatedUfsWrapper)),this.associatedUfsWrapper.checkFiltersChanged(),t&&(o.brokerService.publish(constants.events.time_filter.select.range),o.brokerService.publish(constants.events.filters.selected,[constants.events.time_filter.id,this.timeFilterTMWrapper.hasDefaultFilterState(this.associatedUfsWrapper)]))}getTimeInterval(){return this.timeFilter.time_interval}hasDefaultState(e){if(this.hasTimeRange())return!1;const t=e.getTopicMenuByType(constants.topic_menu.TYPE.event);return this.getTimeFilterMenu().hasDefaultFilterState(e)&&(void 0===t||t.hasDefaultFilterState(e))}hasTimeRange(){return this.hasNoInterval()&&void 0!==this.getFrom()}getDiff(e=!1){if(!0===e){const e=[315576e5,262974e4,864e5,36e5,6e4];let t="",i=this.timeFilter.to_ts-this.timeFilter.from_ts;for(let n=0;n<e.length;++n){i/e[n]>=1&&(t.length>0&&(t+=", "),t+=moment.duration(i).humanize(),i%=e[n])}return t}return this.timeFilter.to_ts-this.timeFilter.from_ts}selectDefaultTimeInterval(e=!1){this._setTimeInterval(this.getDefaulTimeInterval(),e)}clearTimeRange(){delete this.timeFilter.from_ts,delete this.timeFilter.to_ts,this.timeFilter.override=!1}formatTimeSpan(){const e=l.contextData.commonPropertiesContainer.date_format.date_format,t=n.duration(1,"days").asMilliseconds(),i=n(this.getFrom()).format(e);if(Math.floor(this.getTo()/t)!==Math.floor(this.getFrom()/t)&&this.getTo()-this.getFrom()>t){return i+" - "+n(this.getTo()-1e3).format(e)}{const e=s.tw.inject("timeService").extractFormattedTimeOfDay(this.getFrom());let t=s.tw.inject("timeService").extractFormattedTimeOfDay(this.getTo());return this.getTo()>this.getFrom()&&"00:00:00"===t&&(t="24:00:00"),i+" "+e+"-"+t}}_setTimeRange(e,t,i=!1,s=!1){let a,c;s&&(a=n(e),c=n(t),this._resetDayTimeOnMoment(a,!1),this._resetDayTimeOnMoment(c,!0)),this.timeFilter.from_ts=void 0!==a?a.toDate().getTime():e,this.timeFilter.to_ts=void 0!==c?c.toDate().getTime():t,r.configurationService.getPageConfiguration().isFilterOverrideMode()?this.setOverride(!this.hasDefaultState(this.associatedUfsWrapper)):this.timeFilter.override=!1,i&&o.brokerService.publish(constants.events.time_filter.select.range)}_resetDayTimeOnMoment(e,t){e.subtract(e.hours(),"hours"),e.subtract(e.minutes(),"minutes"),e.subtract(e.seconds(),"seconds"),e.subtract(e.milliseconds(),"milliseconds"),t&&e.add(1,"days")}_canResetDayTime(e){return e!==constants.time_filter.TIME_INTERVAL.d1&&-1===e.search("h")}setTimeRange(e,t,i=!1,n=!1){const s=this.getTimeInterval();this.resetEvents(),this.setNoInterval(!1),this._setTimeRange(e,t,i,!0!==n&&s===constants.time_filter.TIME_INTERVAL.d1&&this.hasNoInterval())}getFrom(){return this.timeFilter.from_ts}getTo(){return this.timeFilter.to_ts}setNoInterval(e=!1){this._setTimeInterval(constants.time_filter.TIME_INTERVAL.no_interval,e)}hasNoInterval(){return this.getTimeInterval()===constants.time_filter.TIME_INTERVAL.no_interval}isDefaultInterval(){return this.getTimeInterval()===this.getDefaulTimeInterval()}getType(){return constants.topic_menu.TYPE.time_filter}getDefaulTimeInterval(){return this.timeFilter.default_time_interval}isPinned(){return r.configurationService.getPageConfiguration().isPinForced(this.getType())||this.timeFilter.pinned}isForceShowFilter(){return this.timeFilter.force_show_filter}getPinnedType(){return this.timeFilter.time_filter_pinned_type}merge(e){this.timeFilterTMWrapper.merge(e.getTimeFilterMenu()),this.timeFilter.default_time_interval=e.timeFilter.default_time_interval,this.timeFilter.pinned=e.timeFilter.pinned,this.timeFilter.time_interval=e.timeFilter.time_interval,this.timeFilter.time_filter_pinned_type=e.timeFilter.time_filter_pinned_type,this.timeFilter.from_ts=e.timeFilter.from_ts,this.timeFilter.to_ts=e.timeFilter.to_ts,this.timeFilter.override=e.timeFilter.override,this.timeFilter.force_show_filter=e.timeFilter.force_show_filter;const t=this.associatedUfsWrapper.getTopicMenuByType(constants.topic_menu.TYPE.event);void 0!==t&&t.setOverride(e.timeFilter.override),o.brokerService.publish(constants.events.time_filter.select.range)}getDayTime(){return this.dayTime}_initialize(){const e=r.configurationService.getCalendarConfiguration();this.dayTime={from:e.getDefaultTimeValuesFrom(),to:e.getDefaultTimeValuesTo()},this.hasNoInterval()&&this.timeFilterTMWrapper.setEntriesSelectionRecursively(!1)}_validate(){}}t.TimeFilterWrapper=g,t.default=d.constant(g)}),define("wrappers/user_filter_settings/build_parameters/build_parameters",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this._buildParameters=e}toProto(){return this._buildParameters}merge(e){this._buildParameters.preview_topic_id=e.getPreviewTopicId(),this._buildParameters.attributes=e._buildParameters.attributes}dispose(){this._buildParameters=void 0}clone(){return new n(JSON.parse(JSON.stringify(this.toProto())))}getPreviewTopicId(){return this._buildParameters.preview_topic_id}setPreviewTopicId(e){this._buildParameters.preview_topic_id=e}}t.BuildParametersWrapper=n,t.default=i.constant(n)}),define("wrappers/user_filter_settings/user_filter_settings_wrapper",["require","exports","log","map","moment-timezone","underscore","classes/application/abstract_application","services/broker","services/filter","services/rest_form_service","services/tw_common","wrappers/abstract_wrapper","wrappers/searchbar_filter/searchbar_filter_wrapper","wrappers/time_filter/time_filter_wrapper","wrappers/topic_menu/topic_entry_wrapper","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/build_parameters/build_parameters"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_){var f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.AddToMenu="ADD_TO_MENU",e.TimeInterval="TIME_INTERVAL",e.Time="TIME",e.Query="QUERY",e.Region="REGION",e.Other="Other"}(f=t.SpecialFilterType||(t.SpecialFilterType={}));class y extends g.AbstractWrapper{constructor(e,t,n,s=!1){super("TOPIC_MENU_WRAPPER"),i.logService.assert(void 0!==e,"ufsProto is required"),this._ufs=e,this._pageState=t,this._holderType=n,this._topicMenuWrappers=[],this._filterTopicMenuWrappers=[],this._allTopicMenuWrappers=[],this._initializeTimeSelectedFiltersWrapper(),o.isUndefined(e.build_parameters)||(this._buildParametersWrapper=new _.BuildParametersWrapper(e.build_parameters)),void 0!==e.filters&&(this.setSearchbarFilter(e.filters,s),this._initializeQueryFiltersWrapper()),o.each(this._ufs.topics,e=>{const t=new m.TopicMenuWrapper(e,void 0,this);this._topicMenuWrappers.push(t)}),this._ufs.filters&&o.each(this._ufs.filters.topic_menu,e=>{const t=new m.TopicMenuWrapper(e,void 0,this);this._filterTopicMenuWrappers.push(t)}),this._allTopicMenuWrappers=o.union(this._filterTopicMenuWrappers,this._topicMenuWrappers),e.filters&&e.filters.time_filter&&this.setTimeFilter(e.filters.time_filter,this.getTopicMenuByType(constants.topic_menu.TYPE.time_filter),s),this._createJunctions(),s||this._validate()}toProto(){return this._ufs.topics=[],o.each(this._topicMenuWrappers,e=>{this._ufs.topics.push(e.toProto())}),o.isUndefined(this._ufs.filters)||(this._ufs.filters.topic_menu=[],o.each(this._filterTopicMenuWrappers,e=>{this._ufs.filters.topic_menu.push(e.toProto())})),this.hasBuildParameters()&&(this._ufs.build_parameters=this.getBuildParameters().toProto()),this._ufs}hasBuildParams(){return void 0!==this._ufs.build_parameters}getVirtualSearch(){return this._getBuildParamAttribute("virtual-search")}hasVirtualSearch(){return this._hasBuildParamAttribute("virtual-search")}_hasBuildParamAttribute(e){return!!this._ufs.build_parameters&&!!this._ufs.build_parameters.attributes&&o.some(this._ufs.build_parameters.attributes,t=>t.key===e)}_getBuildParamAttribute(e){return o.find(this._ufs.build_parameters.attributes,t=>t.key===e).value}_createJunctions(){const e=this.getTopicMenuByType(constants.topic_menu.TYPE.source_panel),t=this.getTopicMenuByType(constants.topic_menu.TYPE.influenstar);if(!o.isUndefined(e)&&!o.isUndefined(t)&&t.getAllNode()){e.getEntryByMappedId(constants.root_id.source_panel).addChildrenAsJunction(t.getAllNode(),!0)}const i=this.getTopicMenuByType(constants.topic_menu.TYPE.sentiment),n=this.getTopicMenuByType(constants.topic_menu.TYPE.important);if(!o.isUndefined(i)&&!o.isUndefined(n)&&n.getRootEntry().hasChildren()){i.getRootEntry().addJunction(n.getRootEntry().getChildren()[0]),i.setPostSelectionfunction(function(){this.getRootEntry().containsSelection(!0)?(this.getRootEntry().setSelected(!1),o.each(this.getJoinedMenuTypes(),e=>{this.getAssociatedUserFilterSettings().getTopicMenuByType(e).getRootEntry().setSelected(!1)})):(this.getRootEntry().setSelected(!0),o.each(this.getJoinedMenuTypes(),e=>{this.getAssociatedUserFilterSettings().getTopicMenuByType(e).getRootEntry().setSelected(!0)}))})}}clone(){return new y(JSON.parse(JSON.stringify(this.toProto())),this._pageState,this._holderType)}getPageState(){return this._pageState}getHolderType(){return this._holderType}hasFilters(){return void 0!==this._ufs.filters}hasTopics(){return void 0!==this._ufs.topics}overrideFilters(e){o.each(e.getFilters(),e=>{if(e.isOverriden()){const t=this.getTopicMenuByType(e.getType());o.isUndefined(t)||t.merge(e)}});const t=e.getTopicMenuByType(constants.topic_menu.TYPE.filter);if(!o.isUndefined(t)&&t.isOverriden()){this.getTopicMenuByType(constants.topic_menu.TYPE.filter).merge(t)}const i=e.getTopicMenuByType(constants.topic_menu.TYPE.event);if(!o.isUndefined(i)&&i.isOverriden()){this.getTopicMenuByType(constants.topic_menu.TYPE.event).merge(i)}e.getTimeFilter().isOverriden()&&this.hasTimeFilter()&&this.getTimeFilter().merge(e.getTimeFilter()),e.getSearchbarFilter().isOverriden()&&this.hasSearchbarFilter()&&this.getSearchbarFilter().merge(e.getSearchbarFilter())}hasTimeFilter(){return void 0!==this.getTimeFilter()}getTimeFilter(){return this._timeFilterWrapper}setTimeFilter(e,t,i){this._timeFilterWrapper=new p.TimeFilterWrapper(e,t,this,i)}canShowFilters(){return!this._ufs.force_hide_filters}hasSearchbarFilter(){return void 0!==this._searchbarWrapper}getSearchbarFilter(){return this._searchbarWrapper}setSearchbarFilter(e,t){return this._searchbarWrapper=new u.SearchbarFilterWrapper(e,this,t),this}getHashSelectionState(){let e="";return o.each(this._allTopicMenuWrappers,t=>{e+=t.getHashSelectionState()}),this.hasSearchbarFilter()&&(e+=this.getSearchbarFilter().getStateHash()),this.hasTimeFilter()&&!this.getTimeFilter().isDisposed()&&(e+=this.getTimeFilter().getStateHash()),d.twCommon.hashString(e)}applyDatagraphFilters(e){const t=[];return e.forEach(e=>{const i=this.applyDatagraphFilter(e);void 0!==i&&t.push(i)}),this.checkFiltersChanged(),Promise.all(t)}applyDatagraphFilter(e){if(!o.isArray(e))return this.applyWorldMapFilter(e);this._regroupFilters(e).forEach(e=>{const t=e.values;switch(e.type){case f.AddToMenu:const i=this.mapFiltersByMenuTypes(t);i.keys().forEach(e=>this.applyDataGraphAddToMenu(this.getTopicMenuByType(e),i.get(e)));break;case f.TimeInterval:this.applyDatagraphTimeIntervalFilter(t);break;case f.Time:this.applyDatagraphTimeFilter(t);break;case f.Query:this.applyDatagraphQueryFilter(t);break;case f.Region:const n={};n[t[0].value]=[t],this.applyWorldMapFilter(n);break;default:this.applyDatagraphTopicFilter(t)}})}_regroupFilters(e){const t={};return e.forEach(e=>{"INTERVAL"===e.key&&(e.key=f.Time),void 0===t[e.key]&&(t[e.key]={type:e.key,values:[]}),t[e.key].values.push(e)}),o.values(t)}mapFiltersByMenuTypes(e){const t=new n.Map;return e.forEach(e=>{const i=JSON.parse(e.value);t.has(i.type)||t.set(i.type,[]),t.get(i.type).push(i)}),t}applyWorldMapQuery(e){for(let t=0;t<e.length;t++)if(!o.isUndefined(e[t])){const i=e[t],n=t>0?"OR":"AND";this.getSearchbarFilter().addQuery(i,n,!1)}}applyWorldMapFilter(e){if(void 0!==e.QUERY)return this.applyWorldMapQuery(e.QUERY);{const t=this.getTopicMenuByType(constants.topic_menu.TYPE.countries);t.setEntriesSelectionRecursively(!1);const i=[];if(o.each(Object.keys(e),n=>{o.isArray(e[n])&&o.each(e[n],e=>{this.applyRegionFilter(e[0].value,t,i)})}),i.length>0)return this._fetchAndApplyRegionFilters(i,t)}}debugDisplayFilters(){o.each(this._allTopicMenuWrappers,e=>{const t=e.getType();let i="";o.each(e.getSelectedEntriesRecursively(),function(e){i+=e.getName()+" ,"}),i=i.substr(0,i.length-2),console.log(t+": "+i)}),console.log("Query: "+this.getSearchbarFilter().getQuery()),console.log("Time filter time span: "+this.getTimeFilter().getDiff()),console.log("Time filter start: "+this.getTimeFilter().getFrom()),console.log("Time filter end: "+this.getTimeFilter().getTo())}applyRegionFilter(e,t,i){const n=t.getEntryByMappedId(e);o.isUndefined(n)?i.push(e):n.setSelected(!0)}applyDatagraphTimeIntervalFilter(e){this.getTimeFilter().setTimeRange(e[0].begin,e[0].begin+e[0].interval,this.getPageState().getApplication().getType()===r.ApplicationType.MAIN)}applyDatagraphTimeFilter(e){const t=Number(e[0].value),n=s(t);switch(e[1].value){case"SEC":n.add("seconds",1);break;case"MIN":n.add("minutes",1);break;case"MIN15":n.add("minutes",15);break;case"HOUR":n.add("hours",1);break;case"DAY":n.add("days",1);break;case"WEEK":n.add("weeks",1);break;case"MONTH":n.add("months",1);break;default:i.logService.error(`Time interval not listed: ${e[1].value}`,d.twCommon.logFeatures.Application,{"request page state:":this.getPageState()})}const o=n.toDate().getTime();this.getTimeFilter().setTimeRange(t,o,this.getPageState().getApplication().getType()===r.ApplicationType.MAIN,!0)}applyDataGraphAddToMenu(e,t){i.logService.assertDefined(e,d.twCommon.logFeatures.UserFilterSettings),o.isUndefined(e)||(e.setEntriesSelectionRecursively(!1),t.forEach(t=>{const n=e.getEntryByMappedId(t.parent_id);if(i.logService.assertDefined(n,d.twCommon.logFeatures.UserFilterSettings),!o.isUndefined(n)){const i=new h.TopicEntryWrapper(t.entry,e,n);i.setSelected(!0),n.addChild(i),n.toProto()}}))}applyDatagraphTopicFilter(e){const t=this.getTopicMenuByType(e[0].key);o.isUndefined(t)?i.logService.assertDefined(t,d.twCommon.logFeatures.UserFilterSettings):(t.setEntriesSelectionRecursively(!1),o.each(e,e=>{const n=t.getEntryByMappedId(e.value.trim());void 0===n?i.logService.error(t.getType()+" has no entry with mapped id "+e.value.trim()+" filter cannot be applied",d.twCommon.logFeatures.UserFilterSettings):n.setSelected(!0)}))}applyDatagraphQueryFilter(e){const t=o.last(e);this.getSearchbarFilter().addQuery(t.value,t.operation||"AND",!1)}hasTopicMenuByType(e){return void 0!==this.getTopicMenuByType(e)}getTopicMenuByType(e){const t=this.getTopicMenuByPredicate(t=>t.getType()===e);return t?t[0]:void 0}replaceFilters(e){e.hasSearchbarFilter()&&this._searchbarWrapper.merge(e._searchbarWrapper),e.hasTimeFilter()&&this._timeFilterWrapper.merge(e._timeFilterWrapper),o.each(e._filterTopicMenuWrappers,e=>{this._addOrReplaceTopicMenu(this._filterTopicMenuWrappers,e)}),o.each(e._topicMenuWrappers,e=>{this._addOrReplaceTopicMenu(this._topicMenuWrappers,e)}),this._allTopicMenuWrappers=o.union(this._filterTopicMenuWrappers,this._topicMenuWrappers)}_addOrReplaceTopicMenu(e,t){if(o.any(e,e=>e.getType()===t.getType())){for(let i=0;i<e.length;i++)if(e[i].getType()===t.getType()){e[i].merge(t);break}}else e.push(t)}merge(e,t=[]){i.logService.assert(void 0!==e,"userFilterSettingsWrapper is required",d.twCommon.logFeatures.UserFilterSettings),this._ufs.force_hide_filters=!e.canShowFilters(),this._ufs.filters&&e._ufs.filters?this._ufs.filters.search_descriptor_container=e._ufs.filters.search_descriptor_container:!e._ufs.filters&&this._ufs.filters&&delete this._ufs.filters.search_descriptor_container,this._mergeBuildParameters(e),o.contains(t,d.twCommon.filterTypes.searchBar)||(this.hasSearchbarFilter()?this._searchbarWrapper.merge(e.getSearchbarFilter()):e.hasSearchbarFilter()&&this.setSearchbarFilter(e.getSearchbarFilter().toProto()),this._queryFiltersWrapper.merge(e.getQueryFilterMenu())),o.contains(t,constants.topic_menu.TYPE.time_filter)||(this.hasTimeFilter()?this._timeFilterWrapper.merge(e.getTimeFilter()):e.hasTimeFilter()&&this.setTimeFilter(e.getTimeFilter().toProto(),e.getTimeFilter().getTimeFilterMenu())),this._checkFiltersMenusToRemove(e.getTopicMenus());const n=[];o.each(e.getTopicMenus(),e=>{if(!o.contains(t,e.getType())){const t=this.getTopicMenuByType(e.getType());void 0!==t?(t.merge(e),t.recalculateHits()):e.getType()!==constants.topic_menu.TYPE.geodata_precision_types&&(this.addMenu(e,!0),n.push(e.getType()))}}),o.each(n,t=>{e.removeTopicMenuByType(t)}),e._ufs.filters.search_descriptor_container&&(this._ufs.filters.search_descriptor_container=e._ufs.filters.search_descriptor_container),this.checkFiltersChanged()}_mergeBuildParameters(e){!o.isUndefined(this._buildParametersWrapper)&&e.hasBuildParameters()?this._buildParametersWrapper.merge(e.getBuildParameters()):e.hasBuildParameters()&&(this._buildParametersWrapper=e.getBuildParameters().clone())}resetFilters(){o.each(this._filterTopicMenuWrappers,e=>{e.getType()!==constants.topic_menu.TYPE.time_filter&&e.getType()!==constants.topic_menu.TYPE.report_output_type&&e.getType()!==constants.topic_menu.TYPE.allowed_monitor_page_compare&&e.reset(this)});const e=this.getTopicMenuByType(constants.topic_menu.TYPE.filter);if(o.isUndefined(e)||e.reset(this),o.isUndefined(this._timeFilterWrapper)||(this._timeFilterWrapper.reset(),a.brokerService.publish(constants.events.time_filter.reset,["time-id_1"])),this.isNotDashboardTemplate()){const e=this.getTopicMenuByType(constants.topic_menu.TYPE.topic_pm_composed);o.isUndefined(e)||e.reset(this)}o.isUndefined(this._searchbarWrapper)||this._searchbarWrapper.reset()}_checkFiltersMenusToRemove(e){const t=this,i=[],n=o.map(e,e=>e.getType());o.each(this.getTopicMenus(),e=>{e.isFilter()&&!o.contains(n,e.getType())&&i.push(e)}),o.each(i,e=>{a.brokerService.publish(constants.events.filters.selected,[e.getType(),!0]),a.brokerService.publish(constants.events.filters.menu.remove,[e.getType()]),t.removeTopicMenuByType(e.getType())})}checkFiltersChanged(){if(o.isUndefined(this.getPageState())||this.getPageState().getApplication().getType()!==r.ApplicationType.MAIN||this.getHolderType()!==d.twCommon.holderTypes.PAGE)return;o.each(this.getTopicMenus(),e=>{const t=e.getType();!e.isFilter()&&e.getType()!==constants.topic_menu.TYPE.topic_pm_composed||e.getType()===constants.topic_menu.TYPE.event||(e.isOverrideMode()&&e.setOverride(!e.hasDefaultFilterState(this)),(e.getType()!==constants.topic_menu.TYPE.important&&e.getType()!==constants.topic_menu.TYPE.influenstar&&e.getType()!==constants.topic_menu.TYPE.topic_pm_composed||e.getType()===constants.topic_menu.TYPE.topic_pm_composed&&this.isNotDashboardTemplate())&&c.filterService.updateFilter(t,e.hasDefaultFilterState(this)))});const e=this.getTopicMenuByType(constants.topic_menu.TYPE.event);c.filterService.updateFilter(constants.topic_menu.TYPE.time_filter,this.getTimeFilter().hasDefaultState(this)&&!o.isUndefined(e)&&e.hasDefaultFilterState(this)),c.filterService.updateFilter(constants.root_id.searchbar,!this.getSearchbarFilter().hasQuery())}removeTopicMenuByType(e){let t;for(t=0;t<this._topicMenuWrappers.length;t++)if(this._topicMenuWrappers[t].getType()===e){this._topicMenuWrappers.splice(t,1);break}for(t=0;t<this._filterTopicMenuWrappers.length;t++)if(this._filterTopicMenuWrappers[t].getType()===e){this._filterTopicMenuWrappers.splice(t,1);break}for(t=0;t<this._allTopicMenuWrappers.length;t++)if(this._allTopicMenuWrappers[t].getType()===e){this._allTopicMenuWrappers.splice(t,1);break}}addMenu(e,t,i=!1){!e.isFilter()&&!0!==i||o.isUndefined(this._ufs.filters)?(this._ufs.topics.push(e.toProto()),this._topicMenuWrappers.push(e)):(this._ufs.filters.topic_menu.push(e.toProto()),this._filterTopicMenuWrappers.push(e),t&&a.brokerService.publish(constants.events.filters.menu.add,[e])),e.setAssociatedUserFilterSettings(this),this._allTopicMenuWrappers.push(e)}prune(){this.queryAllTopicMenus(e=>{e.prune()})}queryAllTopicMenus(e){o.each(this._allTopicMenuWrappers,function(t){e(t)})}getTopicMenus(){return this._allTopicMenuWrappers}isAnyFilterActive(){return this.getTopicMenuByPredicate(function(e){return e.isFilter()&&!e.hasDefaultFilterState(this)}.bind(this)).length>0||!0===this._ufs.filters.time_filter.override||this._searchbarWrapper.hasQuery()}getTopicMenuByPredicate(e){const t=[];return o.each(this.getTopicMenus(),i=>{e(i)&&t.push(i)}),t}getFirstTopicMenuByPredicate(e){for(let t=0;t<this.getTopicMenus().length;t++){const i=this.getTopicMenus()[t];if(!0===e(i))return i}}clearLoadingState(){delete this._ufs.reload}setReload(e){this._ufs.reload=e}isTimeFilterPinned(){return this._ufs.filters.time_filter.pinned}getTimeFilterPinnedType(){return this._ufs.filters.time_filter.time_filter_pinned_type}isQueryPinned(){return this._ufs.filters.query_pinned}getQueryPinnedType(){return this._ufs.filters.query_pinned_type}getBuildParameters(){return this._buildParametersWrapper}setBuildParameters(e){this._buildParametersWrapper=e}hasBuildParameters(){return!o.isUndefined(this._buildParametersWrapper)}getTopics(){return this._topicMenuWrappers}getFilters(){return this._filterTopicMenuWrappers}getSelectedFilters(e,t){const i=[];if(this.getHolderType()===d.twCommon.holderTypes.WIDGET||e){const e=this.getTopicMenuByType(constants.topic_menu.TYPE.topic),t=this.getTopicMenuByType(constants.topic_menu.TYPE.page_monitoring);!o.isUndefined(e)&&e.containsSelection()&&i.push(e),!o.isUndefined(t)&&t.containsSelection()&&i.push(t)}return o.each(this._getFilterWrappers(Boolean(t)),this._getMenu(i)),(this.getHolderType()===d.twCommon.holderTypes.WIDGET||t)&&this.hasTimeFilter()&&this._timeFilterWrapper.hasDefaultState(this)&&i.push(this._timeFilterWrapper.getTimeFilterMenu()),i}getNoSelectionFilters(){const e=[];return o.each(this._getFilterWrappersDefaultState(),this._getNoSelectionMenu(e)),e}getSelectionList(e){return o.flatten(this.getTopics().map(function(t){return e?t.getSelectedEntriesLeavesRecursively().filter(function(e){return e.isVisible()}).map(function(e){return e.getName()}):t.getSelectedEntriesRecursively().map(function(e){return e.getName()})}))}getTitleByMenuType(e){return constants.navbar.filter_translation[e]}getQueryFilterMenu(){return this._queryFiltersWrapper}_getMenu(e){return t=>{t.getType()===constants.topic_menu.TYPE.time_filter?e.push(this.getRelevantTimeMenu(t)):t.getType()===constants.root_id.searchbar?(this.prepareQueryFiltersWrapper(),e.push(this._queryFiltersWrapper)):e.push(t)}}_getNoSelectionMenu(e){return t=>{t.getType()===constants.topic_menu.TYPE.time_filter?e.push(this.getRelevantTimeMenu(t)):t.getType()===constants.root_id.searchbar?(this.prepareQueryFiltersWrapper(),e.push(this._queryFiltersWrapper)):e.push(t)}}getRelevantTimeMenu(e){let t;if(e.containsSelection())t=e;else{const i=this.getTopicMenuByType(constants.topic_menu.TYPE.event);if(o.isUndefined(i))t=this._buildSelectedDates(e.getType());else{t=0===i.getSelectedEntriesRecursively().length?this._buildSelectedDates(e.getType()):i}}return t}_buildSelectedDates(e){this._timeSelectedFiltersWrapper.getRootEntry().setName(this.getTitleByMenuType(e)),this._timeSelectedFiltersWrapper.getRootEntry().removeChildren();const t={};return t.name=this.getTimeFilter().formatTimeSpan(),t.mapped_id=t.name,t.selected=constants.topic_entry.selected.node,this._timeSelectedFiltersWrapper.getRootEntry().addChild(new h.TopicEntryWrapper(t,this._timeSelectedFiltersWrapper,this._timeSelectedFiltersWrapper.getRootEntry())),this._timeSelectedFiltersWrapper.toProto(),this._timeSelectedFiltersWrapper}dispose(){super.dispose(),this._ufs=void 0,this._pageState=void 0,this.hasBuildParameters()&&this._buildParametersWrapper.dispose(),this.hasSearchbarFilter()&&this._timeFilterWrapper.dispose(),this.hasTimeFilter()&&this._searchbarWrapper.dispose(),this.queryAllTopicMenus(e=>{e.dispose()}),this._topicMenuWrappers=[],this._filterTopicMenuWrappers=[],this._allTopicMenuWrappers=[]}_getFilterWrappers(e){return this._getFilterWrappersByPredicate(function(t){return t.isFilter()&&(e||!t.hasDefaultFilterState(this))&&t.getType()!==constants.topic_menu.TYPE.time_filter&&t.getType()!==constants.topic_menu.TYPE.important&&t.getType()!==constants.topic_menu.TYPE.influenstar}.bind(this))}_getFilterWrappersDefaultState(){const e=this.getTopicMenuByPredicate(e=>e.isFilter()&&e.hasDefaultFilterState(this)&&e.getType()!==constants.topic_menu.TYPE.time_filter&&e.getType()!==constants.topic_menu.TYPE.important&&e.getType()!==constants.topic_menu.TYPE.influenstar);if(this.isNotDashboardTemplate()){const t=this.getTopicMenuByType(constants.topic_menu.TYPE.topic_pm_composed);!o.isUndefined(t)&&t.hasDefaultFilterState(this)&&e.push(t)}return this.hasSearchbarFilter()&&!this._searchbarWrapper.hasQuery()&&e.push(this._searchbarWrapper),e}_getFilterWrappersByPredicate(e){const t=this.getTopicMenuByPredicate(e),i=this.getTopicMenuByType(constants.topic_menu.TYPE.event);if(!this.hasTimeFilter()||this._timeFilterWrapper.hasDefaultState(this)&&(o.isUndefined(i)||i.hasDefaultFilterState(this))||t.push(this._timeFilterWrapper.getTimeFilterMenu()),this.isNotDashboardTemplate()){const e=this.getTopicMenuByType(constants.topic_menu.TYPE.topic_pm_composed);o.isUndefined(e)||e.hasDefaultFilterState(this)||t.push(e)}return this.hasSearchbarFilter()&&this._searchbarWrapper.hasQuery()&&t.push(this._searchbarWrapper),t}_initializeQueryFiltersWrapper(){const e={};e.type=constants.root_id.searchbar,e.root_entry={name:this.getTitleByMenuType(constants.root_id.searchbar),children:[]},this._queryFiltersWrapper=new m.TopicMenuWrapper(e,void 0,this),this.prepareQueryFiltersWrapper()}prepareQueryFiltersWrapper(){this._queryFiltersWrapper.getRootEntry().removeChildren();const e={name:this.getSearchbarFilter().getQuery(),mapped_id:this.getSearchbarFilter().getQuery(),selected:this.getSearchbarFilter().hasQuery()?constants.topic_entry.selected.node:constants.topic_entry.selected.none},t=new h.TopicEntryWrapper(e,this._queryFiltersWrapper,this._queryFiltersWrapper.getRootEntry());this._queryFiltersWrapper.getRootEntry().addChild(t),this._queryFiltersWrapper.toProto()}_initializeTimeSelectedFiltersWrapper(){const e={};e.type=constants.topic_menu.TYPE.time_filter,e.root_entry={name:"",children:[],selection_type:"SINGLE"},this._timeSelectedFiltersWrapper=new m.TopicMenuWrapper(e,void 0,this)}_validate(){}_fetchAndApplyRegionFilters(e,t){const i=$.Deferred(),n={region_ids:e};return l.restFormService.post(routes.controllers.tw.TWRestForm.post("project",this.getPageState().getProject().getId(),"regions","show","","rform").url,n).then(e=>{o.each(e.cc_to_regions,(e,i)=>{o.each(e,e=>{const n=new h.TopicEntryWrapper(e),s=t.getEntryByMappedId(i);s.hasChild(n)?o.each(n.getChildren(),e=>{const t=s.getChildByMappedId(n.getMappedId());t.hasChild(e)||t.addChild(e)}):s.addChild(n)})}),t.toProto(),i.resolve()}),i.promise()}replacePageState(e){this._pageState=e}hasPageState(){return void 0!==this._pageState}isNotDashboardTemplate(){return!this.hasPageState()||!this.getPageState().getAllowedPages().isDashboardTemplate()}}t.UserFilterSettingsWrapper=y,t.default=o.constant(y)}),define("services/topic_entry_loader",["require","exports","services/tw_common","services/rest_form_service","log","other/tw","services/context"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this.TopicEntryWrapper=e}loadRegions(e,t){const i={country:e.toProto()},s=routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"regions","show","","rform").url;n.restFormService.post(s,i).then(i=>this.processResponse(i,e,t))}loadGenericDynamicFilters(e,t,i,s){const o={entry:e.toProto(),type:t,count:1e3,page_state_id:i};n.restFormService.post(routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"dynamic_filter_loading","info","","rform").url,o).then(t=>this.processResponse(t,e,s))}loadDynamicFilters(e,t,i,n){t===constants.topic_menu.TYPE.countries?this.loadRegions(e,n):this.loadGenericDynamicFilters(e,t,i,n)}processResponse(e,t,n){const o=new this.TopicEntryWrapper(e.entry||e.country),r=new s.LogCluster("Merging topicEntry : "+t.getName(),s.logLevel.VERBOSE,i.twCommon.logFeatures.TopicMenu);r.addObject(t,!0,"toProto"),r.addObject(o,!0,"toProto"),t.merge(o,r),r.addMessage("merging result"),r.addObject(t,!0,"toProto"),r.addObject(o,!0,"toProto"),r.writeLog(),void 0!==n&&n(t)}}a.$inject=["TopicEntryWrapper"],t.default=a,Object.defineProperty(t,"topicEntryLoaderService",{get:function(){return o.tw.inject("topicEntryLoaderService")}})}),define("react_components/filter_menu/default_filter_menu_controller",["require","exports","services/topic_entry_loader","classes/context_data/context_data","filter_menu","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/application/application","classes/refresh/model_type","services/refresh/model_refresh_service","log"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultFilterMenuController=class extends s.AbstractFilterMenuController{constructor(e,t){super(e,t)}onFilterChanged(e,t,i){if(!this.shouldHandleAction(t))return!1;const{topicMenu:n}=this.adapter.getData();e.mappedId!==t||i?n.selectEntryByMappedId(e.mappedId):n.unselectAll();const s=n.getRootEntry();return s.isSelected()&&!i&&n.selectEntryByMappedId(s.getChildren()[0].getMappedId()),this.updateContainerState(),!0}async onMenuExpandToggled(e,t){return!!this.shouldHandleAction(t)&&this.lazyLoadEntriesIfPossible(e)}async lazyLoadEntriesIfPossible(e){const{topicMenu:t}=this.adapter.getData(),i=t.getEntryByMappedId(e);return!!this.shouldLazyLoadEntry(i,t)&&this.loadDynamicFilters(i,t)}shouldLazyLoadEntry(e,t){return t.shouldFetchFromServer()&&!e.hasChildren()&&!e.hasAdditionalInfo()&&!this.isTransientLeaf(e.toProto())}loadDynamicFilters(e,t){let s;return tw.pageState.getAllowedPages().isCustomPage()||(s=tw.pageState.getId()),new Promise(async(o,r)=>{i.topicEntryLoaderService.loadDynamicFilters(e,t.getType(),s,()=>{e.hasChildren()||e.setAdditionalInfo(n.contextData.getMessage("_1216469",[e.getTopicEntry().name])),this.menuState=this.getInitialFilterFormContainerState(),o(!0)})})}onMenuClose(){this.getState().openState===s.FilterMenuState.CLOSED&&this.shouldPersistChanges()&&this.persistChanges()}persistChanges(){this.refreshPageState(),this.markAsUnmodified()}shouldPersistChanges(){return this.modified}async refreshPageState(){const e={strategy:o.ModelRefreshStrategy.REFRESH},t=r.modelRefreshDecoratorFactory.getDecorator(a.mainApplication.getPageState(),a.mainApplication,c.ModelType.PAGE_STATE,e);try{return await l.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&d.logService.error(e.message)}}updateContainerState(){this.modified=!0,this.menuState=this.getInitialFilterFormContainerState()}}}),define("classes/filters/suggestions/suggestion_filter_input",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/filters/suggestions/endpoints/abstract_suggestion_endpoint",["require","exports","services/rest_form_service"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractSuggestionEndpoint=class{constructor(e){this.endpoint=e}makeRequest(e){return i.restFormService.post(this.endpoint,e)}}}),define("classes/filters/suggestions/endpoints/geolocalization_suggestion_endpoint",["require","exports","classes/filters/suggestions/endpoints/abstract_suggestion_endpoint","services/rest_form_service","reusable_utilities"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.GeolocalizationSuggestionEndpoint=class extends i.AbstractSuggestionEndpoint{constructor(){super(n.restFormService.getRFormUrl("world_map_suggestions","search"))}async requestSuggestions(e){return(await this.makeRequest({input:e})).suggestions.map(e=>({mappedId:s.TopicEntryUtils.getFirstLeaf(e.menu_structure).mapped_id,name:e.name,typeLabel:e.type_label,selected:!1,isNotSelectable:!1,menuStructure:e.menu_structure}))}}}),define("classes/filters/suggestions/filter_form_suggestions_controller",["require","exports","filter_menu","reusable_utilities","wrappers/topic_menu/topic_entry_wrapper"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends i.DefaultFilterFormController{constructor(e,t){super(),this.suggestionEndpoint=e,this.menu=t}async onSearchInputChangeHandler(e,t){const i=t.target.value,n=this.canRequestSuggestions(i);e.setState({requestingSuggestions:n,searchInput:i}),n&&this.requestSuggestions(i,e)}filterSelectionHandler(e,t,i){e.state=Object.assign({},e.state,{searchInput:"",showTopResults:!0,fetchedSuggestions:void 0}),this.addHierachyIfAbsent(t),this.dispatchFilterSelection(e,t,i)}async requestSuggestions(e,t){this.results=await this.suggestionEndpoint.requestSuggestions(e),t.setState({requestingSuggestions:!1,fetchedSuggestions:this.results})}canRequestSuggestions(e){return void 0!==e&&""!==e}addHierachyIfAbsent(e){const t=new s.TopicEntryWrapper(e.menuStructure);if(void 0===this.menu.getEntryByMappedId(e.mappedId)){const i=this.findExistingAncestorEntry(e.mappedId,t);i.ancestorEntry.addChild(i.matchingEntry.getChildren()[0]),this.menu.toProto()}}findExistingAncestorEntry(e,t){const i=t.getEntryByMappedId(e).getParent(),n=this.menu.getEntryByMappedId(i.getMappedId());return void 0===n?this.findExistingAncestorEntry(i.getMappedId(),t):{ancestorEntry:n,matchingEntry:i}}}__decorate([n.debounce(300),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",Promise)],o.prototype,"requestSuggestions",null),t.FilterFormSuggestionsController=o}),define("classes/grid/grid_page",["require","exports","log","map","reusable_utilities","talkwalker_constants","classes/grid/grid","classes/grid/grid_configuration","classes/grid/grid_slot_item"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l{constructor(e,t,i,s){this.instanceId=l.nextInstanceId++,this.id=e,this.number=t,this.parentPage=s,this.subPages=new n.Map,void 0!==s&&s.addSubPage(this),this.grid=new r.Grid(i)}static generateGridPage(e,t,n={},o,r,d){void 0!==n.width&&void 0!==n.height||i.logService.error("gridOptions width or height are undefined!");const g=t.filter(t=>t.hasSlotConfiguration()?t.getSlotConfiguration().page===e.id:(i.logService.error(`item id ${t.getId()} => invalid state: no slot configuration`),!1)),u=s.assignRecursive(a.generateDefaultGridConfig(e,o),n),p=new l(e.id,o,u,d);return void 0!==e.anchor_metadata&&p.setAnchorMetadata(e.anchor_metadata),p.getGrid().addItems(c.GridSlotItem.generateSlotItems(g,r)),p}getId(){return this.id}getNumber(){return this.number}getGrid(){return this.grid}getConfiguration(){return this.getGrid().getConfiguration()}setConfiguration(e){this.getGrid().setConfiguration(e)}getPageIconModel(){const e=this.getAnchorIcon();return{type:e,customIconData:e===o.PageIcon.CUSTOM?{type:this.anchorMetadata.custom_icon_data.type,content:this.anchorMetadata.custom_icon_data.content}:void 0}}hasAnchorMetadata(){return void 0!==this.anchorMetadata}setAnchorMetadata(e){this.anchorMetadata=e}getAnchorIcon(){return this.hasAnchorMetadata()?this.anchorMetadata.icon:void 0}hasAnchorIcon(){return this.hasAnchorMetadata()&&void 0!==this.getAnchorIcon()}getAnchorTitle(){return this.hasAnchorMetadata()?this.anchorMetadata.title:void 0}setHtmlElement(e){this.htmlElement=e}getHtmlElement(){return this.htmlElement}hasParentPage(){return void 0!==this.getParentPage()}getParentPage(){return this.parentPage}hasSubPages(){return this.subPages.size>0}getSubPages(){return this.subPages.values()}addSubPage(e){this.subPages.set(e.getId(),e)}removeSubPage(e){this.subPages.has(e.getId())&&(e.dispose(),this.subPages.delete(e.getId()))}dispose(){this.htmlElement=void 0,this.grid.dispose(),this.hasSubPages()&&this.getSubPages().forEach(e=>this.removeSubPage(e))}}l.nextInstanceId=1,t.GridPage=l}),define("classes/grid/anchor/grid_anchor_model",["require","exports","event_bus","reusable_components","reusable_utilities","other/tw"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.GridAnchorModel=class{constructor(e){this.fixedPosition=n.DisplayMode.FIXED,this.keyNavigationActive=!0,this.pageConfig=e}onMouseEnter(){}onMouseLeave(){}getFlatNodeList(e){return _.flatten(e.map(e=>this.getNodeAndChildren(e)))}getNodeAndChildren(e){return _.flatten([e,e.children?_.flatten(e.children.map(e=>this.getNodeAndChildren(e))):[]])}getSelectedNodeIndex(){if(!this.selectionIsValid(this.nodes))throw new Error("Invalid Selection");return this.getFlatNodeList(this.nodes).findIndex(e=>e.selected)}getSelectedNode(){if(!this.selectionIsValid(this.nodes))throw new Error("Invalid Selection");return this.getFlatNodeList(this.nodes).find(e=>e.selected)}changeActiveGridPage(e){i.eventBus.dispatch({type:i.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,value:{pageId:e}})}selectAnchorNode(e,t=!0){e!==this.getSelectedNode()&&(this.updateNodesSelection(this.nodes,e),o.tw.inject("$rootScope").$applyAsync(),i.eventBus.dispatch({type:i.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,value:e}),t&&this.changeActiveGridPage(e.id))}selectNodeById(e,t=!0){const i=this.getFlatNodeList(this.nodes).find(t=>t.id===e);this.selectAnchorNode(i,t)}updateNodesSelection(e,t){e.forEach((e,i)=>{e.selected=e===t,void 0!==e.children&&e.children.length>0&&this.updateNodesSelection(e.children,t)})}selectionIsValid(e){return 0===e.length||this.containsSelection(e)}containsSelection(e){return e.some(e=>e.selected||e.children&&this.containsSelection(e.children))}selectPreviousAnchorNode(){const e=this.getSelectedNodeIndex();if(e>0){const t=e-1,i=this.nodes[t];return this.selectAnchorNode(i,!0),!0}return!1}highlightNextAnchor(){const e=this.getSelectedNodeIndex();if(e<this.nodes.length-1){const t=this.nodes[e+1];this.selectAnchorNode(t,!1)}}selectNextAnchorNode(e){const t=this.getSelectedNodeIndex();if(t<this.nodes.length-1){let i=t+1;const n=this.nodes[i];return e&&i--,this.selectAnchorNode(n,!0),!0}return!1}highlightPreviousAnchor(){const e=this.getSelectedNodeIndex();if(e>0){const t=this.nodes[e-1];this.selectAnchorNode(t,!1)}}setUpKeyNavigation(){let e,t=this.getSelectedNodeIndex(),n=t;const o=t=>{if(this.keyNavigationActive){switch(t.keyCode){case s.Keys.UP_ARROW:case s.Keys.PAGE_UP:t.preventDefault(),this.highlightPreviousAnchor();break;case s.Keys.DOWN_ARROW:case s.Keys.PAGE_DOWN:t.preventDefault(),this.highlightNextAnchor();break;default:return}e=t.keyCode,n=this.getSelectedNodeIndex()}};document.addEventListener("keydown",o);const r=i=>{if(this.keyNavigationActive&&i.keyCode===e&&n!==t){const e=this.getSelectedNode();-1!==n&&void 0!==e&&(this.changeActiveGridPage(e.id),t=n)}};document.addEventListener("keyup",r);const a=new s.CancellationToken;return a.subscribeToStream(i.eventBus,i.EVENT_TYPES.ANCHOR_MODEL_KEY_NAVIGATION_ACTIVE,e=>{this.keyNavigationActive=e.value.active}),a.addCleanupFunction(()=>{document.removeEventListener("keyup",r),document.removeEventListener("keydown",o)}),a}setupScrollNavigation(e={}){return new s.DeadScroll(Object.assign({target:$(document),resetTime:200,scrollStopDelay:600,onScrollDown:()=>this.highlightNextAnchor(),onScrollUp:()=>this.highlightPreviousAnchor(),onScrollStop:()=>{const e=this.getSelectedNodeIndex(),t=this.getSelectedNode();-1!==e&&void 0!==t&&this.changeActiveGridPage(t.id)},allowScrollbar:!0},e))}disableDeadScrollOnMouseEnter(e){this.onMouseEnter=(()=>{e.pause()}),this.onMouseLeave=(()=>{e.resume()})}}}),define("classes/grid/anchor/grid_icon_anchor_model",["require","exports","math_utils","classes/grid/anchor/grid_anchor_configuration","classes/grid/anchor/grid_anchor_model"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.GridIconAnchorModel=class extends s.GridAnchorModel{constructor(e,t,i,n){super(t),this.nodes=[],this.initializeNodeStyle(n),this.initializeNodes(e,i),this.iconAnchorStyle={position:"relative",left:-this.nodeSize.x}}initializeNodeStyle(e={}){const{fontSize:t=20,nodeSize:n=new i.Vector2D(56,56),nodeOffset:s=new i.Vector2D(0,56),className:o=""}=e;this.fontSize=t,this.nodeSize=n,this.nodeOffset=s,this.className=o}initializeNodes(e,t){let i,n;if(this.nodes&&this.nodes.length>0){const e=(n=this.getFlatNodeList(this.nodes)).find(e=>e.selected);void 0!==e&&(i=e.id)}e.filter(e=>e.hasAnchorIcon()).forEach((e,i)=>{this.addPage(e,this.isPageSelected(e,t,i)),e.hasSubPages&&e.getSubPages().filter(t=>e.hasAnchorIcon()).forEach(e=>this.addPage(e,this.isPageSelected(e,t,i)))}),n=this.getFlatNodeList(this.nodes),this.updateSelectedNode(n,i)}addPage(e,t,i){const n=this.getAppropriateNodesList(e);if(!n.some(t=>t.id===e.getId())){const s=this.createIconNode(e,t);i&&i<n.length?n.splice(Math.max(0,i),0,s):n.push(s)}}removePage(e){const t=this.nodes.filter(t=>t.id===e.getId())[0];t&&this.nodes.splice(this.nodes.indexOf(t),1)}onClick(e,t,i,n){e.stopPropagation(),this.selectAnchorNode(t)}isPageSelected(e,t,i){return void 0!==t?t===e.getId():0===i}updateSelectedNode(e,t){if(t){const i=e.find(e=>e.id===t);i&&(e.forEach(e=>e.selected=!1),i.selected=!0)}}getAppropriateNodesList(e){return e.hasParentPage()?this.nodes.find(t=>t.id===e.getParentPage().getId()).children:this.nodes}createIconNode(e,t){const i=e.getAnchorTitle(),n={pageTitle:e.getAnchorTitle(),icon:e.getPageIconModel()};return{id:e.getId(),children:[],selected:t,icon:n,label:i}}getType(){return n.GridAnchorType.ICON}}}),define("classes/page_mode",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.EXPANDED_WIDGET=0]="EXPANDED_WIDGET",e[e.SIDEBAR_PAGE=1]="SIDEBAR_PAGE",e[e.NO_SIDEBAR_PAGE=2]="NO_SIDEBAR_PAGE",e[e.REPORT_PAGE=3]="REPORT_PAGE",e[e.DIALOG=4]="DIALOG",e[e.EMBEDDED_PAGE=5]="EMBEDDED_PAGE",e[e.IMAGE_EXPORT_PAGE=6]="IMAGE_EXPORT_PAGE",e[e.COMMAND_CENTER=7]="COMMAND_CENTER",e[e.SHARED_DASHBOARD=8]="SHARED_DASHBOARD",e[e.MOBILE=9]="MOBILE",e[e.EXPORT_PREVIEW_PAGE=10]="EXPORT_PREVIEW_PAGE",e[e.GRID_DASHBOARD=11]="GRID_DASHBOARD"}(t.PageMode||(t.PageMode={}))}),define("classes/grid/grid_page_collection",["require","exports","event","event_bus","map","reusable_utilities","classes/grid/anchor/grid_anchor_configuration","classes/grid/anchor/grid_icon_anchor_model","classes/grid/anchor/grid_preview_anchor_model","constants/page_size_constants","classes/page_mode"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});class g{constructor(e,t=r.defaultGridAnchorConfiguration,a){this.pages=new s.Map,this.throttledPreviewUpdates=new s.Map,this.cancellationToken=new o.CancellationToken,this.anchorConfiguration=t,this.pageConfig=e,this.context=a,this.onUpdate=new i.Event,this.onRemoveItem=new i.Event,this.onAddItem=new i.Event,this.onRemoveSubItem=new i.Event,this.onTransformItem=new i.Event,this.onStackItem=new i.Event,this.onCloneItem=new i.Event,this.onSwapItem=new i.Event,this.onDeletePressed=new i.Event,this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_UPDATE_PREVIEW,e=>{this.pages.has(e.value.pageId)&&this.updatePreview(this.pages.get(e.value.pageId))})}static getActiveAnchorModelIfAble(){return g.activeAnchorModel}getActiveAnchorModel(){return this.anchorModel||this.initializeAnchorModel(),g.activeAnchorModel}get currentPageId(){return this.pageConfig.active_page_id}set currentPageId(e){this.pageConfig.active_page_id=e,this.updateSelectedAnchorNode()}get size(){return this.pages.size}setPageConfig(e){this.pageConfig=e,this.initializeAnchorModel()}resetAnchorModel(){this.anchorModel=void 0}initializeAnchorModel(){switch(this.anchorConfiguration.type){case r.GridAnchorType.ICON:this.anchorModel=new a.GridIconAnchorModel(this.getPages(),this.pageConfig,this.pageConfig.active_page_id,this.anchorConfiguration.style),g.activeAnchorModel=this.anchorModel;break;case r.GridAnchorType.PREVIEW:const e=this.context===d.PageMode.EXPORT_PREVIEW_PAGE?l.EXPORT_PREVIEW_PAGE_WIDTH:l.PAGE_WITH_SIDEBAR_WIDTH,t=Object.assign({},this.anchorConfiguration.options,{gridWidth:e});this.anchorModel=new c.GridPreviewAnchorModel(this.getPages(),this.pageConfig,t),g.activeAnchorModel=this.anchorModel;break;default:throw new Error("Anchor model requested but no type specified")}}updateSelectedAnchorNode(){this.anchorModel.selectNodeById(this.pageConfig.active_page_id,!1)}addPage(e,t){this.pages.set(e.getId(),e),this.subscribeToGridEvents(e.getGrid()),this.anchorModel&&this.anchorModel.addPage(e,t)}removePage(e){this.pages.delete(e.getId()),this.unsubscribeFromGridEvents(e.getGrid()),e.dispose(),this.anchorModel&&this.anchorModel.removePage(e)}resetPages(){this.pages.clear()}subscribeToGridEvents(e){e.onUpdate.link(this.onUpdate),e.onRemoveItem.link(this.onRemoveItem),e.onAddItem.link(this.onAddItem),e.onRemoveSubItem.link(this.onRemoveSubItem),e.onTransformItem.link(this.onTransformItem),e.onStackItem.link(this.onStackItem),e.onCloneItem.link(this.onCloneItem),e.onSwapItem.link(this.onSwapItem),e.onDeletePressed.link(this.onDeletePressed)}unsubscribeFromGridEvents(e){e.onUpdate.unlink(this.onUpdate),e.onRemoveItem.unlink(this.onRemoveItem),e.onAddItem.unlink(this.onAddItem),e.onRemoveSubItem.unlink(this.onRemoveSubItem),e.onTransformItem.unlink(this.onTransformItem),e.onStackItem.unlink(this.onStackItem),e.onCloneItem.unlink(this.onCloneItem),e.onSwapItem.unlink(this.onSwapItem),e.onDeletePressed.unlink(this.onDeletePressed)}findPage(e){return this.pages.get(e)||void 0}hasPage(e){return this.pages.has(e)}getPages(){return this.pages.values()}hasPages(){return this.pages.size>0}setCurrentPageId(e){this.currentPageId=e}setCurrentPage(e){this.setCurrentPageId(e.getId())}getCurrentPage(){return this.currentPageId&&this.pages.has(this.currentPageId)?this.pages.get(this.currentPageId):this.pages.values()[0]}hasAnchorModel(){return this.anchorConfiguration.type!==r.GridAnchorType.NONE}getAnchorModel(){return this.anchorModel||this.initializeAnchorModel(),this.anchorModel}updatePreview(e){this.throttledPreviewUpdates.has(e)||this.throttledPreviewUpdates.set(e,_.throttle(()=>{this.cancellationToken.isCanceled()||this.cancellationToken.setTimeout(()=>{this.cloneDomForPreview(e)},375)},200,{trailing:!0})),this.throttledPreviewUpdates.get(e)()}cloneDomForPreview(e){if(!this.hasAnchorModel())return;const t=this.getAnchorModel(),i=e.getHtmlElement(),s=t.nodes.findIndex(t=>t.id===e.getId()),o=this.cloneGridElem(i);-1===s?t.nodes.push(t.createPreviewNode(e.getId(),o,!1)):n.eventBus.dispatch({type:n.EVENT_TYPES.ANCHOR_PREVIEW_CHANGED,value:{id:t.nodes[s].id,preview:o}})}cloneGridElem(e){const t=e.querySelectorAll(".tw-grid")[0].cloneNode(!1);$(t).addClass("grid-preview-clone");const i=e.querySelectorAll(".widgets");for(let e=0;e<i.length;e++)t.appendChild(i[e].cloneNode(!0));const n=e.querySelectorAll(".widgets canvas"),s=t.querySelectorAll("canvas");for(let e=0;e<n.length;e++)this.cloneCanvas(n[e],s[e]);return t}cloneCanvas(e,t){if(0===t.height||0===t.width)return;t.getContext("2d").drawImage(e,0,0)}dispose(){this.pages.forEach(e=>e.dispose()),this.pages=void 0,this.anchorModel=void 0,this.throttledPreviewUpdates=void 0,this.cancellationToken.cancel()}}t.GridPageCollection=g}),define("services/toolbar_service",["require","exports","other/tw","services/rest_form_service","services/context","report_components","event_bus","underscore"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=routes.controllers.tw.TWRestForm;class l{async fetchWidgetTemplateItems(){const e=i.tw.pageState.getAllowedPages().getGroupPage();return n.restFormService.get(c.get(s.contextService.getCurrentContext().scope,s.contextService.getCurrentContext().id,"widget_templates","info",e,"rform").url,void 0).then(e=>{const{templates:t}=e;return t.map(e=>this.createWidgetItem(e))})}createWidgetItem(e){return{id:a.uniqueId("toolbar-item-"),title:e.label,tooltip:e.label,icon:e.icon,type:o.ToolbarItemType.DRAGGABLE_BUTTON,eventType:r.EVENT_TYPES.DRAG_TOOLBAR_ITEM,actionPayload:{data:e.dic_template}}}}t.ToolbarService=l,t.toolbarService=new l}),define("classes/draggable/strategy/draggable_strategy",["require","exports","jquery","underscore","log","services/broker","services/tw_common","math_utils"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.DraggableStrategy=class{constructor(e,t){this.sortCallback=e,this.active=!!n.isUndefined(t)||t,this.dragging=!1,this.sideThickness=60,this.activeDropzones=[],this.targetSidePredicates={[r.twCommon.sides.TOP]:this.isCommonSideTop.bind(this),[r.twCommon.sides.RIGHT]:this.isCommonSideRight.bind(this),[r.twCommon.sides.BOTTOM]:this.isCommonSideBottom.bind(this),[r.twCommon.sides.LEFT]:this.isCommonSideLeft.bind(this),[r.twCommon.sides.CENTER]:this.isCenterTarget.bind(this)},this.sideThicknessSubscription=o.brokerService.subscribe(constants.events.draggable.side_thickness,(e=60)=>{n.isNumber(e)&&(this.sideThickness=e)})}onMouseDown(e,t){this.mouseDownLocation=new a.Vector2D(e.clientX,e.clientY)}postDrag(){}dispose(){o.brokerService.unsubscribe(constants.events.draggable.side_thickness,this.sideThicknessSubscription)}attachModel(e){this.model=e}initStartValues(e){this.dragging=!0,this.handleX=e.clientX+window.scrollX,this.handleY=e.clientY+window.scrollY,this.startScrollX=window.pageXOffset,this.startScrollY=window.pageYOffset}toggleDragging(){this.dragging=!this.dragging}disableDragging(){this.dragging=!1}removeDragHandle(){this.dragHandle&&(this.dragHandle.remove(),this.dragHandle=void 0)}findTargetDropzone(e,t){const i=n(this.activeDropzones).find(t=>r.twCommon.isPointOnElement(e,t.getTemplate()));return void 0!==i?{target:n.assign(i.scope.model,{getTemplate:()=>i.getTemplate(),getDropZoneConfiguration:()=>["DROPZONE"]}),isSection:!0,side:"DROPZONE"}:void 0}highlightTarget(e,t){s.logService.assert(void 0!==e,"target is required"),s.logService.assert(void 0!==t,"side is required"),this.highlightedTarget===e&&this.highlightedSide===t||(this.highlightedTarget=e,this.highlightedSide=t,o.brokerService.publish(constants.events.draggable.highlight,[this.highlightedTarget,this.highlightedSide,this.type]))}removeHighlight(){this.highlightedTarget=void 0,this.highlightedSide=void 0,o.brokerService.publish(constants.events.draggable.highlight,[this.highlightedTarget,this.highlightedSide,this.type])}isUnsortable(e){const t=i(e.target);return 0!==e.button||t.hasClass("unsortable")||t.parents(".unsortable").length>0}getDragHandle(e="",t){const s=n.isUndefined(t)?"":t;return i(`<div class='draggable drag-handle ${s}'>\n                <span class='fa fa-arrows'></span>\n                <span>${e}</span>\n            </div>`)}showDropzones(e){if(this.hasDropzoneConfig()){let t=i(this.dropzoneConfig.selector).toArray().map(e=>({getTemplate:()=>i(e),scope:i(e).scope()}));this.dropzoneConfig.predicate&&(t=n.filter(t,t=>this.dropzoneConfig.predicate(t,e))),t.forEach(e=>{e.getTemplate().css("display","")}),this.activeDropzones=t}}hideDropzones(){this.hasDropzoneConfig()&&(i(this.dropzoneConfig.selector).hide(),this.activeDropzones.length=0)}moveDragHandle(e,t,i){let n;n=i&&i.sharedData.scale||void 0===this.handleOffset?new a.Vector2D(this.dragHandle.width()/2,this.dragHandle.height()/2):this.handleOffset,this.dragHandle.css("left",t.clientX-n.x+window.pageXOffset+"px"),this.dragHandle.css("top",t.clientY-n.y+window.pageYOffset+"px")}addDraggingStyles(e){e.addClass("draggable"),e.addClass("dragging")}removeDraggingStyles(e){e.removeClass("dragging"),e.removeClass("draggable")}getCommonTargetSideByPoint(e,t){const i=n.find(Object.keys(this.targetSidePredicates),i=>(0,this.targetSidePredicates[i])(e,t));return{target:e,isSection:!1,side:i}}isCommonSideTop(e,t){return this.isPointAboveTarget(e,t,this.sideThickness)&&n.contains(e.getDropZoneConfiguration(),r.twCommon.sides.TOP)}isCommonSideLeft(e,t){return this.isPointLeftOfTarget(e,t,this.sideThickness)&&n.contains(e.getDropZoneConfiguration(),r.twCommon.sides.LEFT)}isCommonSideRight(e,t){return this.isPointRightOfTarget(e,t,this.sideThickness)&&n.contains(e.getDropZoneConfiguration(),r.twCommon.sides.RIGHT)}isCommonSideBottom(e,t){return this.isPointBelowTarget(e,t,this.sideThickness)&&n.contains(e.getDropZoneConfiguration(),r.twCommon.sides.BOTTOM)}isCenterTarget(e,t){const i=window.pageXOffset,s=window.pageYOffset,o=e.getDropZoneConfiguration(),a=e.getTemplate(),c=a.offset(),l=t.x,d=t.y,g=n.contains(o,r.twCommon.sides.LEFT)?this.sideThickness:0,u=n.contains(o,r.twCommon.sides.RIGHT)?this.sideThickness:0,p=n.contains(o,r.twCommon.sides.TOP)?this.sideThickness:0,h=n.contains(o,r.twCommon.sides.BOTTOM)?this.sideThickness:0;return l>c.left-i+g&&l<c.left+a.outerWidth()-i-u&&d>c.top-s+p&&d<c.top+a.outerHeight()-s-h&&n.contains(o,r.twCommon.sides.CENTER)}isPointAboveTarget(e,t,i=this.sideThickness){return t.y<e.getTemplate().offset().top-window.pageYOffset+i}isPointBelowTarget(e,t,i=this.sideThickness){const n=e.getTemplate();return t.y>n.offset().top-window.pageYOffset+n.outerHeight()-i}isPointLeftOfTarget(e,t,i=this.sideThickness){return t.x<e.getTemplate().offset().left-window.pageXOffset+i}isPointRightOfTarget(e,t,i=this.sideThickness){const n=e.getTemplate();return t.x>n.offset().left-window.pageXOffset+n.outerWidth()-i}toggleActive(){this.setActive(!this.active)}setActive(e){this.active=e}isActive(){return this.active}isDragging(){return this.dragging}setDropzoneConfig(e,t){this.dropzoneConfig={selector:e,predicate:t}}hasDropzoneConfig(){return void 0!==this.dropzoneConfig&&void 0!==this.dropzoneConfig.selector}}}),define("classes/grid/grid_slot",["require","exports","math_utils"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.GridSlot=class{constructor(e,t,i,n){this.column=e,this.row=t,this.index=i,this.owner=n,this.active=!1}toPoint(){return new i.Point(new i.Vector2D(this.column,this.row))}getColumn(){return this.column}getRow(){return this.row}getIndex(){return this.index}isOccupied(e){return e.multiSelectionActive()?this.getOwner()&&!e.getGrid().getSelectedItems().some(e=>this.getOwner().isEqualTo(e)):this.hasOwner()&&!this.getOwner().isEqualTo(e)}setOwner(e){this.owner=e}getOwner(){return this.owner}hasOwner(){return void 0!==this.getOwner()}setActive(e){this.active=e}isActive(){return this.active}debugPrint(e=!1){if((e||this.hasOwner())&&console.log(`Item ${this.index} -> [${this.getColumn()}, ${this.getRow()}]`),this.hasOwner()&&(console.log("└─ Model",this.getOwner()),void 0!==this.getOwner().getSlotConfiguration)){const e=this.getOwner().getSlotConfiguration();console.log(`└──── [${e.grid_x}, ${e.grid_y}, ${e.grid_z}]`)}}}}),define("classes/draggable/strategy/grid_strategy",["require","exports","log","math_utils","services/tw_common","classes/draggable/strategy/draggable_strategy","reusable_utilities","services/grid_spacial"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=1e4;t.GridStrategy=class extends o.DraggableStrategy{constructor(e,t,i){super(()=>!0,!1),this.element=$(e),this.grid=t,this.type=constants.draggable.strategy.grid,this.config=Object.assign({selector:".zones"},i),this.targetValid=!1}startDragging(e,t){if(this.container=this.element.find(this.config.selector),this.snappingMode=!1,this.lastPosition=e,this.dragSession=new r.CancellationToken,this.dragSession.addDomEvent(window,"keydown",e=>{e.keyCode===r.Keys.CTRL&&this.enterSnappedMode()}),this.dragSession.addDomEvent(window,"keyup",e=>{e.keyCode===r.Keys.CTRL&&this.exitSnappedMode()}),t.hasTemplate()){const e=t.getHandleCSSProperties();this.handleOffset=new n.Vector2D(this.mouseDownLocation.x-e.left+window.scrollX,this.mouseDownLocation.y-e.top+window.scrollY)}}enterSnappedMode(){this.snappingMode=!0}exitSnappedMode(){this.snappingMode=!1}getSnappedSize(e){const{column:t,row:i}=this.getGridCoordinatesByPoint({x:e.clientX+window.scrollX,y:e.clientY+window.scrollY}),s=new n.Rectangle(new n.Vector2D(t,i),1,1);if(a.gridSpacialService.isAreaInBounds(this.grid,s)){if(a.gridSpacialService.isAreaEmpty(this.grid,s,[this.model]))return a.gridSpacialService.findAligningSize(this.grid,s.position,[this.model]);{const e=a.gridSpacialService.getItemsInArea(this.grid,s,[this.model])[0].getSlotConfiguration();return new n.Rectangle(new n.Vector2D(e.grid_x,e.grid_y),e.width,e.height)}}{const e=this.model.getSlotConfiguration();return new n.Rectangle(new n.Vector2D(e.grid_x,e.grid_y),e.width,e.height)}}stopDragging(e){this.dragSession.cancel(),this.mouseDownLocation=void 0,this.handleOffset=void 0}postDrag(){this.targetValid=void 0,this.targetedGridItemIndex=void 0,this.clearGrid()}getGridWidth(){return this.grid.getWidth()}getGridHeight(){return this.grid.getHeight()}getModelWidth(){return this.model.getSlotConfiguration().width}getModelHeight(){return this.model.getSlotConfiguration().height}getModelArea(){if(this.model.multiSelectionActive()){let e=0;return this.model.getGrid().getSelectedItems().forEach(t=>{e+=t.getWidth()*t.getHeight()}),e}return this.getModelWidth()*this.getModelHeight()}getModelMinimumWidth(){return this.getModelDimensionLimitForField("min_width")}getModelMaximumWidth(){return this.getModelDimensionLimitForField("max_width")||c}getModelMinimumHeight(){return this.getModelDimensionLimitForField("min_height")}getModelMaximumHeight(){return this.getModelDimensionLimitForField("max_height")||c}getModelDimensionLimitForField(e){const t=this.model.getSlotConfiguration();return t.dimension_limit&&void 0!==t.dimension_limit[e]?t.dimension_limit[e]:0}hasGridConfig(){return void 0!==this.config}hideDraggedElement(){this.model.hasTemplate()&&this.getElement().css("background-color","transparent").css("outline-style","solid").css("opacity",.5).css("pointer-events","none").addClass("no-zones")}showDraggedElement(){this.model.hasTemplate()&&this.getElement().css("background-color","").css("outline-style","").css("opacity",1).css("pointer-events","").removeClass("no-zones")}addDragHandle(){void 0===this.dragHandle&&(this.dragHandle=this.getDragHandle(),$("body").prepend(this.dragHandle))}updateActiveGridItems(e,t){if(this.hasGridConfig()){this.invalidateGridItemSelection();const i=this.findFirstCollidingGridElementIndex(e);this.targetedGridItemIndex!==i&&-1!==i&&this.updateGridItemSelection(i,t)}}updateGridItemSelection(e,t){this.targetedGridItemIndex=e,this.allTargetedGridSlots=this.findAllConcernedGridItems(e,t),this.targetValid=this.validateActiveGridItems(t),this.allTargetedGridSlots.forEach(e=>{e.setActive(!0)}),this.grid.getSlots().forEach(this.updateGridItemElementClasses.bind(this)),this.computeGridExpansion()}computeGridExpansion(){const e=this.grid.getConfiguration().dragAndDrop;e.expandGridAheadOfDragAndDrop&&e.expandGridAheadOfDragAndDrop.down&&this.computeGridExpansionDown(e.expandGridAheadOfDragAndDrop.down)}computeGridExpansionDown(e){Math.max(...this.grid.getSlots().flatten().filter(e=>e.isActive()).map(e=>e.getRow()))>=this.grid.getHeight()-1&&this.grid.expand(new n.Vector2D(0,e))}invalidateGridItemSelection(){this.targetedGridItemIndex=void 0,this.targetValid=!1,this.grid.getSlots().forEach(e=>{e.setActive(!1)}),this.grid.backgroundCanvasGrid.setStateGlobally("default")}clearGrid(){this.grid.getSlots().forEach(e=>{e.setActive(!1)}),this.grid.backgroundCanvasGrid.setStateGlobally("default")}isRestrictedArea(e){return this.grid.restrictedAreas.some(t=>n.collisionCalculator.isPointOverlappingRectangle(e,t))}getItemByPoint(e){const{column:t,row:i}=this.getGridCoordinatesByPoint(e);if(this.grid.isValidColumnIndex(t)&&this.grid.isValidRowIndex(i))return this.grid.getSlot(t,i)}getGridCoordinatesByPoint(e){const t=$(this.grid.backgroundCanvasGrid.canvas).offset(),i=this.grid.backgroundCanvasGrid.getCellSize();return{column:Math.floor((e.x-t.left)/i.x),row:Math.floor((e.y-t.top)/i.y)}}getPageCoordinatesByGridCoordinates(e){const t=this.grid.backgroundCanvasGrid.getCellSize(),i=$(this.grid.backgroundCanvasGrid.canvas).offset();return e.clone().componentWiseMul(t).moveBy(window.scrollX,window.scrollY).moveBy(i.left,i.top)}findFirstCollidingGridElementIndex(e){const{top:t,left:n}=e.offset(),o=$(this.grid.backgroundCanvasGrid.canvas).offset(),r={top:t-o.top,left:n-o.left},a=this.isDragHandleOffsetValid(r);if(i.logService.debug("findFirstCollidingGridElementIndex",s.twCommon.logFeatures.Grid,{dragHandleOffset:{top:t,left:n},delta:r,isValid:a}),a){const e=this.getItemByPoint({x:n,y:t});return void 0!==e?e.getIndex():-1}return-1}isDragHandleOffsetValid(e){const t=this.getContainerWidth(),i=this.getContainerHeight();return e.top<=i&&e.left<=t}getContainerWidth(){return this.container.width()}getContainerHeight(){return this.container.height()}findAllConcernedGridItems(e,t){const n=this.grid.getSlotAtIndex(e);let o,r,a=n.getRow(),c=n.getColumn();if(this.snappingMode){const e=this.getSnappedSize(this.lastPosition);c=e.position.x,r=e.right-1,a=e.position.y,o=e.bottom-1}else if(t.sharedData.size&&t.sharedData.offset)a=t.sharedData.offset.y,c=t.sharedData.offset.x,o=t.sharedData.size.height+a-1,r=t.sharedData.size.width+ +c-1;else{if(this.model.multiSelectionActive()){const e=this.model.getGrid().getSelectionBounds();return this.model.getGrid().getSelectedSlots(c-e.x,a-e.y)}o=Math.min(a+this.getModelHeight()-1,this.getGridHeight()-1),r=Math.min(c+this.getModelWidth()-1,this.getGridWidth()-1)}return i.logService.verbose("Finding grid items",s.twCommon.logFeatures.DraggableGridStrategy,{gridItem:n,startRow:a,endRow:o,startColumn:c,endColumn:r}),_.flatten(this.grid.getRectangularSlotRegion(a,o,c,r))}validateActiveGridItems(e){return e.lockHandle||this.allTargetedGridSlots&&this.allTargetedGridSlots.length&&this.isTargetGridValid()}updateGridItemElementClasses(e){e.isActive()?(this.grid.getConfiguration().dragAndDrop.expandGridAheadOfDragAndDrop,this.targetValid?this.grid.backgroundCanvasGrid.updateStateForCell(e.getColumn(),e.getRow(),"active"):this.grid.backgroundCanvasGrid.updateStateForCell(e.getColumn(),e.getRow(),"invalid")):this.grid.backgroundCanvasGrid.updateStateForCell(e.getColumn(),e.getRow(),"default")}isTargetGridValid(){return(this.allTargetedGridSlots.length===this.getModelArea()||this.snappingMode)&&!this.allTargetedGridSlots.map(e=>e.toPoint()).some(e=>this.isRestrictedArea(e))&&!this.allTargetedGridSlots.some(e=>e.isOccupied(this.model))}isModelNotPartOfGrid(){const{grid_x:e,grid_y:t}=this.model.getSlotConfiguration();return void 0===e||-1===e||void 0===t||-1===t}getElement(){return this.model.getTemplate()}}}),define("classes/draggable/strategy/draggable_grid_strategy",["require","exports","underscore","jquery","classes/draggable/strategy/grid_strategy","services/tw_common","services/grid_drag_handle"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends s.GridStrategy{constructor(e,t,i){super(e,t,i),this.dropzones={},this.setActive(!0),this.config=Object.assign({selector:".zones"},i)}startDragging(e,t){e.preventDefault(),this.isActive()&&(n("body").css("cursor","move"),super.startDragging(e,t),this.attachModel(t),this.initStartValues(e),this.performStartDragCallback(),this.addDragHandle(),this.hideDraggedElement())}move(e,t){e.preventDefault(),this.isActive()&&(e.preventDefault(),e.stopPropagation(),this.lastPosition=e,t.dragHandle=this.dragHandle[0],t.lockHandle||(this.snappingMode?this.setHandleSizeByGridItemDimensions(this.dragHandle):this.moveDragHandle(this.dragHandle,e,t)),this.updateActiveGridItems(this.dragHandle,t),this.updateDropzones(this.dragHandle,e),this.updateDragHandleStatus(e))}updateDropzones(e,t){const i=this.target,n=void 0!==i?i.getOwner():void 0;this.target=this.getTargetedItem(t),(void 0===this.target||i!==this.target&&n!==this.target.getOwner())&&(this.removeDropzones(i),this.updateTargetIcon(i)),this.hasValidInteractionTarget(t)?this.addDropzones(this.target,t):this.removeDropzones(this.target)}stopDragging(e){n("body").css("cursor",""),super.stopDragging(e),this.dragging&&(this.disableDragging(),this.showDraggedElement(),this.performAction(e),this.removeDragHandle(),this.removeDropzones(this.target))}performStartDragCallback(){const{onDragStart:e}=this.config;this.model&&e&&e(this.model)}getDragHandle(){const e=n('<div class="draggable drag-handle center-content no-minimums">\n                <i class="content fa fa-3x"></i>\n             </div>');return this.isModelNotPartOfGrid()?this.setHandleSizeByGridItemDimensions(e):e.css(this.model.getHandleCSSProperties()),this.updateHandleIcon(e),e}enterSnappedMode(){super.enterSnappedMode(),this.setHandleSizeByGridItemDimensions(this.dragHandle),this.updateActiveGridItems(this.dragHandle,{lockHandle:!1,model:this.model,dragHandle:this.dragHandle[0],sourceOptions:null}),this.updateDragHandleStatus(this.lastPosition)}exitSnappedMode(){super.exitSnappedMode(),this.setHandleSizeByGridItemDimensions(this.dragHandle),this.updateActiveGridItems(this.dragHandle,{lockHandle:!1,model:this.model,dragHandle:this.dragHandle[0],sharedData:{},sourceOptions:null}),this.updateDragHandleStatus(this.lastPosition)}hasValidInteractionTarget(e){const{swap:t,stack:i,nest:n}=this.config;if(t||i||n){const s=this.getTargetedItem(e),o=void 0!==s&&void 0!==s.getOwner()&&!s.getOwner().isEqualTo(this.model);return!this.model.multiSelectionActive()&&o&&(t&&t.validate(this.model,s.getOwner())||i&&i.validate(this.model,s.getOwner())||n&&n.validate(this.model,s.getOwner()))}return!1}setHandleSizeByGridItemDimensions(e){const t=this.grid.backgroundCanvasGrid.getCellSize();if(this.snappingMode){const i=this.getSnappedSize(this.lastPosition),n=this.getPageCoordinatesByGridCoordinates(i.position);e.css("left",n.x+"px"),e.css("top",n.y+"px"),e.css("width",t.x*i.width),e.css("height",t.y*i.height)}else e.css("width",t.x*this.getModelWidth()),e.css("height",t.y*this.getModelHeight())}updateHandleIcon(e){const t=n("i.content",e),i=Math.floor(.55*Math.min(e.width(),e.height()));t.css("font-size",`${i}px`)}updateDragHandleStatus(e){const t=n(".content",this.dragHandle);i.forEach(this.dropzones,e=>{t.removeClass(e.icon)}),o.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.element.parent())&&(this.targetValid?r.gridDragHandleService.setAsValid(this.dragHandle[0]):this.hasValidInteractionTarget(e)?(r.gridDragHandleService.setAsValid(this.dragHandle[0],r.DragHandleIcon.NONE),this.isInteractingWithTarget()&&t.addClass(this.activeDropzone.icon)):r.gridDragHandleService.setAsInvalid(this.dragHandle[0]))}getTargetedItem(e){const{swap:t,stack:i,nest:n}=this.config;if(t||i||n){const t={x:e.clientX+window.scrollX,y:e.clientY+window.scrollY};return this.getItemByPoint(t)}}isInteractingWithTarget(e=this.target){return void 0!==e&&void 0!==e.getOwner()&&void 0!==this.activeDropzone}getInteractionTarget(e){const t=this.getTargetedItem(e);if(void 0!==t&&void 0!==t.getOwner())return t.getOwner()}performAction(e){this.isInteractingWithTarget()&&this.hasValidInteractionTarget(e)?void 0!==this.activeDropzone.action&&this.activeDropzone.action(e):this.performDrop()}performSwap(e){const{swap:t}=this.config;if(t&&t.enabled){const i=this.getInteractionTarget(e);t.callback?t.callback(this.model,i):i.swap(this.model)}}performStack(e){const{stack:t}=this.config;if(t&&t.enabled){const i=this.getInteractionTarget(e);t.callback?t.callback(this.model,i):i.stack(this.model)}}performNest(e){const{nest:t}=this.config;if(t&&t.enabled){const i=this.getInteractionTarget(e);t.callback&&t.callback(this.model,i)}}performDrop(){const{onDragEnd:e}=this.config;if(e&&this.targetValid&&this.allTargetedGridSlots.length>0)if(this.model.multiSelectionActive()){const t=this.findFirstCollidingGridElementIndex(this.dragHandle),i=this.grid.getSlotAtIndex(t),n=i.getRow(),s=i.getColumn(),o=this.model.getGrid().getSelectionBounds();this.grid.getSelectedItems().forEach(t=>{const i=t.getSlotConfiguration(),r=Object.assign({},i,{grid_x:i.grid_x+s-o.x,grid_y:i.grid_y+n-o.y});e(r,t)})}else{const t=this.allTargetedGridSlots[0];let i;if(this.snappingMode){const e=this.getSnappedSize(this.lastPosition);i=Object.assign({},this.model.getSlotConfiguration(),{grid_x:e.x,grid_y:e.y,width:e.width,height:e.height})}else i=Object.assign({},this.model.getSlotConfiguration(),{grid_x:t.getColumn(),grid_y:t.getRow()});e(i,this.model)}}addDropzones(e,t){let i=0;this.config.stack&&this.config.stack.validate(this.model,e.getOwner())&&i++,this.config.swap&&this.config.swap.validate(this.model,e.getOwner())&&i++,this.config.nest&&this.config.nest.validate(this.model,e.getOwner())&&i++,this.config.swap&&this.config.swap.validate(this.model,e.getOwner())&&this.addSingleDropzone(e,o.twCommon.sides.CENTER_LEFT,"swap","fa-exchange",i,this.performSwap.bind(this)),this.config.stack&&this.config.stack.validate(this.model,e.getOwner())&&this.addSingleDropzone(e,o.twCommon.sides.CENTER_RIGHT,"stack","fa-clone fa-flip-horizontal",i,this.performStack.bind(this)),this.config.nest&&this.config.nest.validate(this.model,e.getOwner())&&this.addSingleDropzone(e,o.twCommon.sides.CENTER_RIGHT,"nest","fa-compress",i,this.performNest.bind(this)),this.updateDropzoneStatus(t)}addSingleDropzone(e,t,i,s,o,r){const a=2===o?"two_options":"single_option";if(void 0===this.dropzones[i]){const o=n(`\n                <div class="center-zone ${t.toLowerCase()} ${i} ${a}">\n                    <i class="fa ${s}"></i>\n                </div>\n            `);this.dropzones[i]={type:i,side:t,icon:s,action:r,element:o},e.getOwner().getTemplate().prepend(this.dropzones[i].element)}}updateDropzoneStatus(e){this.activeDropzone=void 0,Object.keys(this.dropzones).forEach(t=>{const i=this.dropzones[t];o.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},i.element)?(i.element.addClass("active"),this.activeDropzone=i):i.element.removeClass("active")})}removeDropzones(e){this.activeDropzone=void 0,Object.keys(this.dropzones).forEach(e=>{this.dropzones[e].element.remove(),delete this.dropzones[e]}),this.updateTargetIcon(e)}applyDropzoneStyle(){}clearDropzoneStyle(){}updateTargetIcon(e){void 0!==e&&(this.isInteractingWithTarget()?e.getOwner().getTemplate().addClass("hide-content"):e.hasOwner()&&e.getOwner().hasTemplate()&&e.getOwner().getTemplate().removeClass("hide-content"))}}}),define("classes/draggable/strategy/multiplexer_strategy",["require","exports","log","services/tw_common","classes/draggable/strategy/draggable_strategy"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.MultiplexerStrategy=class extends s.DraggableStrategy{constructor(e){super(void 0,!0),this.strategies=e}determineActiveStrategy(e,t){const s=this.strategies.find(i=>i.predicate(e,t));void 0!==s?(this.activeStrategy=s.strategy,i.logService.verbose("Chosen strategy ",n.twCommon.logFeatures.MultiplexerStrategy,this.activeStrategy)):this.activeStrategy=void 0}onMouseDown(e,t){this.isActive()&&(super.onMouseDown(e,t),this.determineActiveStrategy(e,t),this.activeStrategy&&this.activeStrategy.onMouseDown(e,t))}startDragging(e,t){this.isActive()&&this.activeStrategy&&this.activeStrategy.startDragging(e,t)}move(e,t){this.isActive()&&this.activeStrategy&&this.activeStrategy.move(e,t)}stopDragging(e){this.activeStrategy&&this.activeStrategy.stopDragging(e)}postDrag(){this.activeStrategy&&this.activeStrategy.postDrag(),this.clearActiveStrategy()}applyDropzoneStyle(){this.activeStrategy&&this.activeStrategy.applyDropzoneStyle()}clearDropzoneStyle(){this.activeStrategy&&this.activeStrategy.clearDropzoneStyle()}addDragHandle(){this.activeStrategy&&this.activeStrategy.addDragHandle()}isDragging(){return this.activeStrategy?this.activeStrategy.isDragging():void 0}clearActiveStrategy(){this.activeStrategy&&(i.logService.verbose("Cleared strategy!",n.twCommon.logFeatures.MultiplexerStrategy,this.activeStrategy),this.activeStrategy=void 0)}dispose(){super.dispose(),this.strategies.forEach(e=>{const{strategy:t}=e;t&&t.dispose()})}}}),define("classes/draggable/strategy/resize/abstract_resize_strategy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dimensionVectors={ONLY_WIDTH:[1,0],ONLY_HEIGHT:[0,1],ONLY_WIDTH_INVERTED:[-1,0],ONLY_HEIGHT_INVERTED:[0,-1],BOTH:[1,1],BOTH_INVERTED:[-1,-1],BOTH_HEIGHT_INVERTED:[1,-1],BOTH_WIDTH_INVERTED:[-1,1]},t.positionVectors={ONLY_X:[1,0],ONLY_Y:[0,1],BOTH:[1,1],NEITHER:[0,0]};t.AbstractResizeStrategy=class{constructor(e,t,i=1){this.side=e,this.grid=t,this.borderThickness=i}wasZoneClicked(e){return e.hasClass(this.zoneClass)}getPositionVector(){return this.positionVector}getDimensionVector(){return this.dimensionVector}}}),define("classes/draggable/strategy/resize/bottom_left_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BottomLeftResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.corners.BOTTOM_LEFT,e,t),this.positionVector=i.positionVectors.ONLY_X,this.dimensionVector=i.dimensionVectors.BOTH_WIDTH_INVERTED,this.zoneClass="bottom-left"}findGridItem(e,t){return this.getHandleBottomLeft(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(i.grid_y,e.getRow(),e.getColumn(),i.grid_x+i.width-1)}getHandleBottomLeft(e){const t=e.position();return{x:t.left-window.pageXOffset,y:t.top+e.outerHeight()-this.borderThickness-window.pageYOffset}}}}),define("classes/draggable/strategy/resize/bottom_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BottomResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.sides.BOTTOM,e,t),this.positionVector=i.positionVectors.NEITHER,this.dimensionVector=i.dimensionVectors.ONLY_HEIGHT,this.zoneClass="bottom"}findGridItem(e,t){return this.getHandleMidBottom(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(i.grid_y,e.getRow(),i.grid_x,i.grid_x+i.width-1)}getHandleMidBottom(e){const t=e.position();return{x:t.left+e.outerWidth()-this.borderThickness-window.pageXOffset,y:t.top+e.outerHeight()-window.pageYOffset}}}}),define("classes/draggable/strategy/resize/bottom_right_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BottomRightResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.corners.BOTTOM_RIGHT,e,t),this.positionVector=i.positionVectors.NEITHER,this.dimensionVector=i.dimensionVectors.BOTH,this.zoneClass="bottom-right"}findGridItem(e,t){return this.getHandleBottomRight(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(i.grid_y,e.getRow(),i.grid_x,e.getColumn())}getHandleBottomRight(e){const t=e.position();return{x:t.left+e.outerWidth()-this.borderThickness-window.pageXOffset,y:t.top+e.outerHeight()-this.borderThickness-window.pageYOffset}}}}),define("classes/draggable/strategy/resize/left_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.LeftResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.sides.LEFT,e,t),this.positionVector=i.positionVectors.ONLY_X,this.dimensionVector=i.dimensionVectors.ONLY_WIDTH_INVERTED,this.zoneClass="left"}findGridItem(e,t){return this.getHandleMidLeft(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(i.grid_y,i.grid_y+i.height-1,e.getColumn(),i.grid_x+i.width-1)}getHandleMidLeft(e){const t=e.position();return{x:t.left-window.pageXOffset,y:t.top-window.pageYOffset+this.borderThickness}}}}),define("classes/draggable/strategy/resize/right_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.RightResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.sides.RIGHT,e,t),this.positionVector=i.positionVectors.NEITHER,this.dimensionVector=i.dimensionVectors.ONLY_WIDTH,this.zoneClass="right"}findGridItem(e,t){return this.getHandleMidRight(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(i.grid_y,i.grid_y+i.height-1,i.grid_x,e.getColumn())}getHandleMidRight(e){const t=e.position();return{x:t.left+e.outerWidth()-window.pageXOffset,y:t.top-window.pageYOffset+this.borderThickness}}}}),define("classes/draggable/strategy/resize/top_left_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TopLeftResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.corners.TOP_LEFT,e,t),this.positionVector=i.positionVectors.BOTH,this.dimensionVector=i.dimensionVectors.BOTH_INVERTED,this.zoneClass="top-left"}findGridItem(e,t){return this.getHandleTopLeft(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(e.getRow(),i.grid_y+i.height-1,e.getColumn(),i.grid_x+i.width-1)}getHandleTopLeft(e){const t=e.position();return{x:t.left-window.pageXOffset,y:t.top-window.pageYOffset}}}}),define("classes/draggable/strategy/resize/top_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TopResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.sides.TOP,e,t),this.positionVector=i.positionVectors.ONLY_Y,this.dimensionVector=i.dimensionVectors.ONLY_HEIGHT_INVERTED,this.zoneClass="top"}findGridItem(e,t){return this.getHandleMidTop(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(e.getRow(),i.grid_y+i.height-1,i.grid_x,i.grid_x+i.width-1)}getHandleMidTop(e){const t=e.position();return{x:t.left+e.outerWidth()-this.borderThickness-window.pageXOffset,y:t.top-window.pageYOffset}}}}),define("classes/draggable/strategy/resize/top_right_resize_strategy",["require","exports","classes/draggable/strategy/resize/abstract_resize_strategy","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TopRightResizeStrategy=class extends i.AbstractResizeStrategy{constructor(e,t){super(n.twCommon.corners.TOP_RIGHT,e,t),this.positionVector=i.positionVectors.ONLY_Y,this.dimensionVector=i.dimensionVectors.BOTH_HEIGHT_INVERTED,this.zoneClass="top-right"}findGridItem(e,t){return this.getHandleTopRight(t)}getGridItemArea(e,t){const i=t.getSlotConfiguration();return this.grid.getRectangularSlotRegion(e.getRow(),i.grid_y+i.height-1,i.grid_x,e.getColumn())}wasZoneClicked(e){return e.hasClass(this.zoneClass)||e.hasClass(this.zoneClass+"-top")||e.hasClass(this.zoneClass+"-right")}getHandleTopRight(e){const t=e.position();return{x:t.left+e.outerWidth()-this.borderThickness-window.pageXOffset,y:t.top-window.pageYOffset}}}}),define("classes/draggable/strategy/resizable_grid_strategy",["require","exports","log","services/tw_common","classes/draggable/strategy/grid_strategy","classes/draggable/strategy/resize/bottom_left_resize_strategy","classes/draggable/strategy/resize/bottom_resize_strategy","classes/draggable/strategy/resize/bottom_right_resize_strategy","classes/draggable/strategy/resize/left_resize_strategy","classes/draggable/strategy/resize/right_resize_strategy","classes/draggable/strategy/resize/top_left_resize_strategy","classes/draggable/strategy/resize/top_resize_strategy","classes/draggable/strategy/resize/top_right_resize_strategy"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});t.ResizableGridStrategy=class extends s.GridStrategy{constructor(e,t,i){super(e,t,i),this.strategyMap={},this.borderThickness=2,this.gridItemElementDimension=0,this.setupStrategyMap()}setupStrategyMap(){this.strategyMap={[n.twCommon.sides.TOP]:new g.TopResizeStrategy(this.grid,this.borderThickness),[n.twCommon.sides.RIGHT]:new l.RightResizeStrategy(this.grid,this.borderThickness),[n.twCommon.sides.BOTTOM]:new r.BottomResizeStrategy(this.grid,this.borderThickness),[n.twCommon.sides.LEFT]:new c.LeftResizeStrategy(this.grid,this.borderThickness),[n.twCommon.corners.TOP_RIGHT]:new u.TopRightResizeStrategy(this.grid,this.borderThickness),[n.twCommon.corners.BOTTOM_RIGHT]:new a.BottomRightResizeStrategy(this.grid,this.borderThickness),[n.twCommon.corners.BOTTOM_LEFT]:new o.BottomLeftResizeStrategy(this.grid,this.borderThickness),[n.twCommon.corners.TOP_LEFT]:new d.TopLeftResizeStrategy(this.grid,this.borderThickness)}}onMouseDown(e,t){super.onMouseDown(e,t),this.attachModel(t),this.determineResizeStrategy(e),this.initStartValues(e)}startDragging(e,t){super.startDragging(e,t),$("body").addClass("resizing"),this.attachModel(t),this.addDragHandle(),this.hideDraggedElement()}move(e,t){t.sharedData.isResize=!0,this.updateActiveGridItems(this.dragHandle,t),this.resizeDragHandle(e)}stopDragging(e){super.stopDragging(e),$("body").removeClass("resizing"),this.disableDragging(),this.removeDragHandle(),this.showDraggedElement(),this.performResize(),this.clearResizeStrategy()}initStartValues(e){super.initStartValues(e),this.handleWidth=this.getElement().width(),this.handleHeight=this.getElement().height(),this.gridItemElementDimension=this.grid.backgroundCanvasGrid.getCellSize().x,this.minWidth=this.gridItemElementDimension/2,this.minHeight=this.gridItemElementDimension/2}findFirstCollidingGridElementIndex(e){const{top:t,left:s}=e.offset(),o=$(this.grid.backgroundCanvasGrid.canvas).offset(),r={top:t-o.top,left:s-o.left},a=this.isDragHandleOffsetValid(r);if(i.logService.debug("findFirstCollidingGridElementIndex",n.twCommon.logFeatures.ResizableGridStrategy,{dragHandleOffset:{top:t,left:s},delta:r,isValid:a}),this.isDragHandleOffsetValid(r)){const t=this.resizeStrategy.findGridItem(void 0,e),s=this.getItemByPoint({x:t.x+window.pageXOffset,y:t.y+window.pageYOffset});return i.logService.debug("finding grid item via strategy",n.twCommon.logFeatures.ResizableGridStrategy,{gridItem:t,item:s}),void 0!==s?s.getIndex():-1}return-1}findAllConcernedGridItems(e){if(this.resizeStrategy){const t=this.grid.getSlotAtIndex(e);return this.rectangularGridItemSelection=this.resizeStrategy.getGridItemArea(t,this.model),_.flatten(this.rectangularGridItemSelection)}return[]}isTargetGridValid(){return void 0!==this.allTargetedGridSlots&&0!==this.allTargetedGridSlots.length&&!!this.isGridItemSelectionValid()&&!this.allTargetedGridSlots.map(e=>e.toPoint()).some(e=>this.isRestrictedArea(e))&&!_.any(this.allTargetedGridSlots,e=>e.isOccupied(this.model))}isGridItemSelectionValid(){const e=this.rectangularGridItemSelection,t=e?e.length:0,i=e&&e[0]?e[0].length:0;return this.checkGridItemSelectionHeight(i)&&this.checkGridItemSelectionWidth(t)}checkGridItemSelectionWidth(e){const{minWidth:t,maxWidth:i}=this.config.dimensionChecks,n=!t||e>=this.getModelMinimumWidth(),s=!i||e<=this.getModelMaximumWidth();return n&&s}checkGridItemSelectionHeight(e){const{minHeight:t,maxHeight:i}=this.config.dimensionChecks,n=!t||e>=this.getModelMinimumHeight(),s=!i||e<=this.getModelMaximumHeight();return n&&s}getDragHandle(){const e=$('<div class="resize drag-handle center-content">   <i class="content fa fa-3x"></i></div>');return e.css({width:this.handleWidth,height:this.handleHeight,left:this.getElement().offset().left,top:this.getElement().offset().top,"min-width":0,"min-height":0}),e}resizeDragHandle(e){const t=[e.clientX+window.scrollX-this.handleX,e.clientY+window.scrollY-this.handleY];i.logService.debug("Resizing & updating position of drag handle...",n.twCommon.logFeatures.ResizableGridStrategy,{delta:t,mouse:{x:e.clientX,y:e.clientY},scroll:{pageXOffset:window.pageXOffset,pageYOffset:window.pageYOffset},handle:{x:this.handleX,y:this.handleY}}),this.updateDragHandle(this.resizeStrategy,this.dragHandle,t)}updateDragHandle(e,t,s){const[o,r]=[e.getPositionVector(),e.getDimensionVector()],a=Math.max(this.handleWidth+s[0]*r[0],this.minWidth),c=Math.max(this.handleHeight+s[1]*r[1],this.minHeight),l=t.offset();0!==o[0]&&(l.left=Math.min(this.handleX+s[0]*o[0],this.handleX+this.handleWidth-this.minWidth)+window.pageXOffset),0!==o[1]&&(l.top=Math.min(this.handleY+s[1]*o[1],this.handleY+this.handleHeight-this.minHeight)+window.pageYOffset),i.logService.debug("Updating dragHandle",n.twCommon.logFeatures.ResizableGridStrategy,{delta:s,handleX:this.handleX,handleY:this.handleY,oldWidth:t.width(),oldHeight:t.height(),newWidth:a,newHeight:c,newX:l.left,newY:l.top});const d=this.isTargetGridValid()&&!0===this.targetValid;if(t.offset(l).css("height",c+"px").css("width",a+"px").addClass(d?"valid":"invalid").removeClass(d?"invalid":"valid"),!d){const e=new i.LogCluster("Invalid resize detected!",i.logLevel.VERBOSE,n.twCommon.logFeatures.ResizableGridStrategy);e.addObject(this),e.addObject({isValid:d,isTargetGridValue:this.isTargetGridValid(),targetValid:this.targetValid,dimensions:{newHeight:c,newWidth:a},allTargetedGridSlots:this.allTargetedGridSlots,isGridItemSelectionValid:this.isGridItemSelectionValid(),model:this.model}),e.writeLog()}}performResize(){if(this.targetValid){const e=_.first(this.allTargetedGridSlots),t=_.last(this.allTargetedGridSlots),s={grid_x:e.getColumn(),grid_y:e.getRow(),width:t.getColumn()-e.getColumn()+1,height:t.getRow()-e.getRow()+1};i.logService.verbose("Resizing model in grid area",n.twCommon.logFeatures.ResizableGridStrategy,{targetedGridItems:this.allTargetedGridSlots,newConfiguration:s}),this.model.updateSlotConfiguration(s)}}determineResizeStrategy(e){const t=this.findTargetedResizeZone(e);this.resizeStrategy=this.findMatchingStrategyForZone(t)}findTargetedResizeZone(e){const t={x:e.clientX,y:e.clientY},i=$(".resizer",this.getElement().parent()),s=_.find(i,e=>n.twCommon.isPointOnElement(t,$(e)));return $(s)}findMatchingStrategyForZone(e){const t=_.find(this.strategyMap,t=>t.wasZoneClicked(e));if(t)return t;throw new Error(`No side found that matches these classes: ${e.attr("class")}!`)}clearResizeStrategy(){this.resizeStrategy=void 0}applyDropzoneStyle(){}clearDropzoneStyle(){}}}),define("themes/dark_theme",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.darkTheme={right:"1058px",left:"222px",overlayZIndex:"10",dropdownZIndex:"100",tintedShade:"#acacac",highlightMain:"#0089c0",highlight:"#009bda",highlightLight:"#00adf3",highlightMedium:"#0077a7",highlightDark:"#006188",highlightTransparent:"rgba(141, 222, 255, 0.7)",lightTransparent:"rgba(192, 237, 255, 0.2)",highlightDarkest:"#34495e",axisStrokeWidth:"1px",axisStroke:"black",gridColumns:"12",gridWidth:"1280px",gridGutterWidth:"30px",gridStrokeWidth:"1px",mapHeight:"600px",mapWidth:"100%",sliceTitleFontFamily:"CabinCondensedM",sliceTitleFontFill:"white",sliceTitleFontSize:"1.1em",widgetFontFamily:"CabinCondensedM",filterColumnWidth:"213px",bubbleDialogZIndex:"1039",overlayShadedMediumColor:"rgba(47, 47, 47, 0.25)",navigationPaneWidth:"42px",navigationPaneIconDim:"36px",screenSize:"256px",imageEntryPadding:"0",thumbnailDimension:"100px",thumbnailContainerPadding:"12px",articleDimension:"124px",reportMultiplier:"1.2",dashboardMultiplier:"1.2",carouselItemDim:"72px",loaderDim:"40px",fontSize:"11px",codemirrorEmojiSize:"16px",twWebBluedark:"#1e3589",twWebPink:"#c94f97",twWebPinkdark:"#af367d",twWebGray:"#aab1ba",contrast:"#adc80b",complementary:"#fcf5cb",greenCyan:"#1fce6e",redDirty:"#e74c3c",lightOrangeDirty:"#ffe6c0",important:"#e47923",favorite:"#d32b57",negative:"#e74c3c",neutral:"#f2c100",positive:"#1fce6e",female:"#cc006a",male:"#0092d2",help:"#f1c40f",error:"#e74c3c",success:"#1fce6e",warning:"#f9d000",facebook:"#3b5998",twitter:"#00aced",googlePlus:"#dd4b39",linkedin:"#007bb6",pinterest:"#cb2027",youtube:"#b00",instagram:"#517fa4",tumblr:"#32506d",flickr:"#ff0084",foursquare:"#0072b1",vimeo:"#45bbff",blog:"#6c3",klout:"#e44600",soundCloudLightGradient:"#f76700",soundCloudDarkGradient:"#fa3219",dailymotion:"#ffd700",weibo:"red",vine:"#00bf8f",vkontakte:"#4c75a3",douban:"#007711",tripadvisor:"#00ad88",adobeExperienceCloud:"#ff0010",adobeAnalytics:"#342a4f",reviewtrackers:"#00add7",twitch:"#6441a4",kakaoStory:"#fae100",change_color_negative:"red",change_color_positive:"green",articleComment:"#f1c40f",instagramBackgroundGradients:"radial-gradient(circle farthest-corner at 35% 90%, #fec564, transparent 50%), radial-gradient(circle farthest-corner at 0 140%, #fec564, transparent 50%), radial-gradient(ellipse farthest-corner at 0 -25%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 20% -50%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 0, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 60% -20%, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 100%, #d9317a, transparent), linear-gradient(#6559ca, #bc318f 30%, #e33f5f 50%, #f77638 70%, #fec66d 100%)",white:"#fff",appsIssue_tracker:"#ff1e02",shadeLight:"#1f1f1f",shade:"#2f2f2f",shadeMedium:"#565656",shadeDark:"#888888",shadeDarkest:"#aaaaaa",shadeFaded:"#202020",bodyBackground:"#151515",wrapperBackground:"#191919",backgroundColor:"#191919",defaultBorder:"1px solid #202020",dashedBorder:"1px dashed #1c1c1c",d3LabelColor:"#888888",gridStrokeColor:"#888888",gridTextColor:"#cccccc",labelBackgroundFillColor:"none",separatorMarkerColor:"#888888",separatorMarkerShadow:"none",resultCountColor:"#aaaaaa",none:"#191919",sortedColumnBottomColor:"#262626",commonTableBottomBorder:"1px solid #2a2a2a",dataTableColor:"#aaaaaa",dataTableBorder:"1px solid #202020",dataTableHeaderColor:"#242424",dataTableRowHover:"#2f2f2f",dataTableTotalBackground:"lightgray",tableColorEven:"#202020",tableColorHover:"#2f2f2f",fancyDataTableHeadColor:"#aaaaaa",fancyDataTableHeadBackground:"#242424",fancyDataTableHeadBackgroundSorted:"#2f2f2f",fancyDataTableHeadBackgroundHover:"#2f2f2f",influencerTableHeadColor:"#aaaaaa",influencerTableHeadBackground:"#242424",influencerTableHeadBackgroundSorted:"#2f2f2f",influencerTableHeadBackgroundHover:"#2f2f2f",influencerCardHoverColor:"#262626",widgetHeadTitleBackground:"#2f2f2f",widgetLegendFontColor:"#aaaaaa",formGroupBorder:"1px solid #262626",formGroupHover:"#262626",menuitemIconColor:"#aaaaaa",menuitemIconBackground:"#242424",popoverShadow:"none",popoverBorderColor:"#242424",popoverContentColor:"#aaaaaa",popoverContentBackground:"#191919",popoverContentShadow:"0 0 3px #121212",popoverContentHeadingColor:"#999999",gridZoneOutline:"1px dashed #2f2f2f",gridSingleZoneOutline:"1px dashed rgba(170, 170, 170, 0.05)",gridItemOutline:"1px solid #565656",gridTargetValidOutline:"1px solid rgba(170, 170, 170, 0.5)",gridBottomSeparator:"0",articlesStoryBorder:"thin solid #3f3f3f",widgetSlotBackground:"#191919"}}),define("themes/light_theme",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.lightTheme={right:"1058px",left:"222px",overlayZIndex:"10",dropdownZIndex:"100",tintedShade:"#e5e7e9",highlightMain:"#0089c0",highlight:"#009bda",highlightLight:"#00adf3",highlightMedium:"#0077a7",highlightDark:"#006188",highlightTransparent:"rgba(141, 222, 255, 0.7)",lightTransparent:"rgba(192, 237, 255, 0.2)",highlightDarkest:"#34495e",axisStrokeWidth:"1px",axisStroke:"black",gridColumns:"12",gridWidth:"1280px",gridGutterWidth:"30px",gridStrokeWidth:"1px",mapHeight:"600px",mapWidth:"100%",sliceTitleFontFamily:"CabinCondensedM",sliceTitleFontFill:"white",sliceTitleFontSize:"1.1em",widgetFontFamily:"CabinCondensedM",filterColumnWidth:"213px",bubbleDialogZIndex:"1039",overlayShadedMediumColor:"rgba(189, 195, 199, 0.25)",navigationPaneWidth:"42px",navigationPaneIconDim:"36px",screenSize:"256px",imageEntryPadding:"0",thumbnailDimension:"100px",thumbnailContainerPadding:"12px",articleDimension:"124px",reportMultiplier:"1.2",dashboardMultiplier:"1.2",carouselItemDim:"72px",loaderDim:"40px",fontSize:"11px",codemirrorEmojiSize:"16px",twWebBluedark:"#1e3589",twWebPink:"#c94f97",twWebPinkdark:"#af367d",twWebGray:"#aab1ba",contrast:"#adc80b",complementary:"#fcf5cb",greenCyan:"#1fce6e",redDirty:"#e74c3c",lightOrangeDirty:"#ffe6c0",important:"#e47923",favorite:"#d32b57",negative:"#e74c3c",neutral:"#f2c100",positive:"#1fce6e",female:"#cc006a",male:"#0092d2",help:"#f1c40f",error:"#e74c3c",success:"#1fce6e",warning:"#f9d000",facebook:"#3b5998",twitter:"#00aced",googlePlus:"#dd4b39",linkedin:"#007bb6",pinterest:"#cb2027",youtube:"#b00",instagram:"#517fa4",tumblr:"#32506d",flickr:"#ff0084",foursquare:"#0072b1",vimeo:"#45bbff",blog:"#6c3",klout:"#e44600",soundCloudLightGradient:"#f76700",soundCloudDarkGradient:"#fa3219",dailymotion:"#ffd700",weibo:"red",vine:"#00bf8f",vkontakte:"#4c75a3",douban:"#007711",tripadvisor:"#00ad88",adobeExperienceCloud:"#ff0010",adobeAnalytics:"#342a4f",reviewtrackers:"#00add7",twitch:"#6441a4",kakaoStory:"#fae100",change_color_negative:"red",change_color_positive:"green",articleComment:"#f1c40f",instagramBackgroundGradients:"radial-gradient(circle farthest-corner at 35% 90%, #fec564, transparent 50%), radial-gradient(circle farthest-corner at 0 140%, #fec564, transparent 50%), radial-gradient(ellipse farthest-corner at 0 -25%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 20% -50%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 0, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 60% -20%, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 100%, #d9317a, transparent), linear-gradient(#6559ca, #bc318f 30%, #e33f5f 50%, #f77638 70%, #fec66d 100%)",white:"#fff",appsIssue_tracker:"#ff1e02",shade:"#bdc3c7",shadeLight:"#f5f4f5",shadeMedium:"#95a5a6",shadeDark:"#7f8c8c",shadeDarkest:"#33465e",shadeFaded:"#d7dbdd",bodyBackground:"#f2f3f4",wrapperBackground:"#fff",backgroundColor:"#fff",defaultBorder:"1px solid #d7dbdd",dashedBorder:"1px dashed #cacfd2",d3LabelColor:"#7f8c8c",gridStrokeColor:"lightgray",gridTextColor:"#7f8c8c",labelBackgroundFillColor:"white",separatorMarkerColor:"#666",separatorMarkerShadow:"0 0 3px #fff",resultCountColor:"#95a5a6",none:"#fff",sortedColumnBottomColor:"#006188",commonTableBottomBorder:"1px solid #f2f3f4",dataTableColor:"#33465e",dataTableBorder:"1px solid #dddddd",dataTableHeaderColor:"#eaecef",dataTableRowHover:"#f5f6f7",dataTableTotalBackground:"lightblue",tableColorEven:"rgba(0, 208, 230, 0.1)",tableColorHover:"rgba(0, 208, 230, 0.2)",fancyDataTableHeadColor:"#fff",fancyDataTableHeadBackground:"#009bda",fancyDataTableHeadBackgroundSorted:"#0077a7",fancyDataTableHeadBackgroundHover:"#0077a7",influencerTableHeadColor:"#fff",influencerTableHeadBackground:"#009bda",influencerTableHeadBackgroundSorted:"#0077a7",influencerTableHeadBackgroundHover:"#0077a7",influencerCardHoverColor:"#f4f5f6",widgetHeadTitleBackground:"#f2f3f4",widgetLegendFontColor:"black",formGroupBorder:"1px solid #f2f3f4",formGroupHover:"#f2f3f4",menuitemIconColor:"#7f8c8c",menuitemIconBackground:"#f2f3f4",popoverShadow:"0 0 10px #bdc3c7",popoverBorderColor:"rgba(0, 0, 0, 0.15)",popoverContentColor:"#34495e",popoverContentBackground:"white",popoverContentShadow:"0 0 3px rgba(52, 73, 94, 0.15)",popoverContentHeadingColor:"#999999",gridZoneOutline:"1px dashed #bdc3c7",gridSingleZoneOutline:"1px dashed #ececec",gridItemOutline:"1px solid #d7dbdd",gridTargetValidOutline:"1px solid rgba(0, 0, 0, 0.33)",gridBottomSeparator:"1px solid #d7dbdd",articlesStoryBorder:"thin solid rgba(0, 0, 0, 0.1)",widgetSlotBackground:"#ffffff"}}),define("themes/navy_theme",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.navyTheme={right:"1058px",left:"222px",overlayZIndex:"10",dropdownZIndex:"100",tintedShade:"#9da3a7",highlightMain:"#0089c0",highlight:"#009bda",highlightLight:"#00adf3",highlightMedium:"#0077a7",highlightDark:"#006188",highlightTransparent:"rgba(141, 222, 255, 0.7)",lightTransparent:"rgba(192, 237, 255, 0.2)",highlightDarkest:"#34495e",axisStrokeWidth:"1px",axisStroke:"black",gridColumns:"12",gridWidth:"1280px",gridGutterWidth:"30px",gridStrokeWidth:"1px",mapHeight:"600px",mapWidth:"100%",sliceTitleFontFamily:"CabinCondensedM",sliceTitleFontFill:"white",sliceTitleFontSize:"1.1em",widgetFontFamily:"CabinCondensedM",filterColumnWidth:"213px",bubbleDialogZIndex:"1039",overlayShadedMediumColor:"rgba(11, 25, 35, 0.25)",navigationPaneWidth:"42px",navigationPaneIconDim:"36px",screenSize:"256px",imageEntryPadding:"0",thumbnailDimension:"100px",thumbnailContainerPadding:"12px",articleDimension:"124px",reportMultiplier:"1.2",dashboardMultiplier:"1.2",carouselItemDim:"72px",loaderDim:"40px",fontSize:"11px",codemirrorEmojiSize:"16px",twWebBluedark:"#1e3589",twWebPink:"#c94f97",twWebPinkdark:"#af367d",twWebGray:"#aab1ba",contrast:"#adc80b",complementary:"#fcf5cb",greenCyan:"#1fce6e",redDirty:"#e74c3c",lightOrangeDirty:"#ffe6c0",important:"#e47923",favorite:"#d32b57",negative:"#e74c3c",neutral:"#f2c100",positive:"#1fce6e",female:"#cc006a",male:"#0092d2",help:"#f1c40f",error:"#e74c3c",success:"#1fce6e",warning:"#f9d000",facebook:"#3b5998",twitter:"#00aced",googlePlus:"#dd4b39",linkedin:"#007bb6",pinterest:"#cb2027",youtube:"#b00",instagram:"#517fa4",tumblr:"#32506d",flickr:"#ff0084",foursquare:"#0072b1",vimeo:"#45bbff",blog:"#6c3",klout:"#e44600",soundCloudLightGradient:"#f76700",soundCloudDarkGradient:"#fa3219",dailymotion:"#ffd700",weibo:"red",vine:"#00bf8f",vkontakte:"#4c75a3",douban:"#007711",tripadvisor:"#00ad88",adobeExperienceCloud:"#ff0010",adobeAnalytics:"#342a4f",reviewtrackers:"#00add7",twitch:"#6441a4",kakaoStory:"#fae100",change_color_negative:"red",change_color_positive:"green",articleComment:"#f1c40f",instagramBackgroundGradients:"radial-gradient(circle farthest-corner at 35% 90%, #fec564, transparent 50%), radial-gradient(circle farthest-corner at 0 140%, #fec564, transparent 50%), radial-gradient(ellipse farthest-corner at 0 -25%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 20% -50%, #5258cf, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 0, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 60% -20%, #893dc2, transparent 50%), radial-gradient(ellipse farthest-corner at 100% 100%, #d9317a, transparent), linear-gradient(#6559ca, #bc318f 30%, #e33f5f 50%, #f77638 70%, #fec66d 100%)",white:"#fff",appsIssue_tracker:"#ff1e02",shadeLight:"#00141f",shade:"#0b1923",shadeMedium:"#565656",shadeDark:"#727272",shadeDarkest:"#d3d3d3",shadeFaded:"#132c3f",bodyBackground:"#0d1e29",wrapperBackground:"#0f2332",backgroundColor:"#0f2332",defaultBorder:"1px solid #132c3f",dashedBorder:"1px dashed #132c3f",d3LabelColor:"#727272",gridStrokeColor:"#727272",gridTextColor:"#cccccc",labelBackgroundFillColor:"none",separatorMarkerColor:"#888888",separatorMarkerShadow:"none",resultCountColor:"#d3d3d3",none:"#0f2332",sortedColumnBottomColor:"#09141c",commonTableBottomBorder:"1px solid #2a2a2a",dataTableColor:"#d3d3d3",dataTableBorder:"1px solid #132c3f",dataTableHeaderColor:"#242424",dataTableRowHover:"#0b1923",dataTableTotalBackground:"lightgray",tableColorEven:"#202020",tableColorHover:"#0b1923",fancyDataTableHeadColor:"#d3d3d3",fancyDataTableHeadBackground:"#242424",fancyDataTableHeadBackgroundSorted:"#0b1923",fancyDataTableHeadBackgroundHover:"#0b1923",influencerTableHeadColor:"#d3d3d3",influencerTableHeadBackground:"#242424",influencerTableHeadBackgroundSorted:"#0b1923",influencerTableHeadBackgroundHover:"#0b1923",influencerCardHoverColor:"#153146",widgetHeadTitleBackground:"#0f2332",widgetLegendFontColor:"#d3d3d3",formGroupBorder:"1px solid #153146",formGroupHover:"#153146",menuitemIconColor:"#d3d3d3",menuitemIconBackground:"#242424",popoverShadow:"none",popoverBorderColor:"#242424",popoverContentColor:"#d3d3d3",popoverContentBackground:"#0f2332",popoverContentShadow:"0 0 3px #121212",popoverContentHeadingColor:"#999999",gridZoneOutline:"1px dashed #0b1923",gridSingleZoneOutline:"1px dashed rgba(211, 211, 211, 0.05)",gridItemOutline:"1px solid #565656",gridTargetValidOutline:"1px solid rgba(211, 211, 211, 0.5)",gridBottomSeparator:"0",articlesStoryBorder:"thin solid #0b1923",widgetSlotBackground:"#0f2332"}}),define("services/theme",["require","exports","event_bus","log","other/tw","themes/dark_theme","themes/light_theme","themes/navy_theme","services/context","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.Themes={NONE:{id:0,cssFile:"main",strategyName:"BRANDED_STRATEGY"},LIGHT:{id:1,cssFile:"main_light",strategyName:"LIGHT_STRATEGY"},DARK:{id:2,cssFile:"main_dark",strategyName:"DARK_STRATEGY"},NAVY:{id:3,cssFile:"main_navy",strategyName:"NAVY_STRATEGY"}};t.default=class{constructor(){this.currentTheme=t.Themes.NONE,i.eventBus.subscribe(i.EVENT_TYPES.ON_CONTEXT_SWITCH,this.onContextSwitch.bind(this))}async changeTheme(e){return void 0!==e&&void 0!==e.cssFile&&this.currentTheme!==e?(this.currentTheme=e,await this.reloadCSS(),this.currentTheme):$.when(this.currentTheme)}getCurrentThemeModel(){switch(this.getCurrentThemeId()){case 0:case 1:return r.lightTheme;case 2:return o.darkTheme;case 3:return a.navyTheme}}getBrandingColor(){return l.contextData.projectSettings.branding.color||this.getCurrentThemeModel().highlightMain}getCurrentTheme(){return this.currentTheme}getDefaultTheme(){return t.Themes.NONE}getCurrentThemeId(){return this.getCurrentTheme().id}isLightTheme(){const e=this.getCurrentThemeId();return 1===e||0===e}isDarkTheme(){return 2===this.getCurrentThemeId()}findThemeById(e){return this.findByPredicate(t=>t.id===e)}findThemeByCSSFile(e){return this.findByPredicate(t=>t.cssFile===e)}findThemeByStrategy(e){return this.findByPredicate(t=>t.strategyName===e)}findByPredicate(e){return _.find(_.values(t.Themes),t=>e(t))}async reloadCSS(){return new Promise((e,t)=>this.reloadCSSLogic(e,t))}reloadCSSLogic(e,t){const i=$("#mainCSS"),s=$('<link rel="stylesheet">');s[0].onload=(()=>{i.remove(),e()}),s[0].onerror=(()=>{n.logService.error("error while loading the css file"),e()});const{scope:o,id:r}=c.contextService.getCurrentContext(),{cssFile:a}=this.getCurrentTheme();s.attr("href",`/app/${o}/${r}/assets/brand/${a}.css?v=`+window.bootPayload.version),s.attr("id","mainCSS"),s.insertAfter(i)}onContextSwitch(e){e.value.promiseList.push(this.reloadCSS())}},Object.defineProperty(t,"themeService",{get:()=>s.tw.inject("themeService")})}),define("services/presentation_service",["require","exports","event_bus","jquery","reusable_utilities","other/tw","services/fullscreen","services/navbar","services/theme"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l={};class d{constructor(){this.isPresentationEnabled=!1}async enterPresentationMode(e){return this.checkConditions(e.conditions),this.setStyle(e.style),n("#pageRoot").css({opacity:0}),new Promise(async(t,r)=>{this.isPresentationEnabled=!0,i.eventBus.dispatch({type:i.EVENT_TYPES.BEFORE_ENTER_PRESENTATION_MODE,value:{}}),this.presentationToken=new s.CancellationToken,this.placeOverlay(e.overlayOptions),await this.applyTheme(e.style.theme),this.performActions(e.actions),i.eventBus.dispatch({type:i.EVENT_TYPES.ENTER_PRESENTATION_MODE,value:{}}),o.tw.inject("$rootScope").$apply(()=>{n("#pageRoot").css({opacity:""}),t()})})}async exitPresentationMode(){if(!this.isPresentationEnabled)throw new Error("not in presentation mode");return this.isPresentationEnabled=!1,n("#pageRoot").css({opacity:0}),this.removeStyle(),new Promise((e,t)=>{setTimeout(async()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.BEFORE_EXIT_PRESENTATION_MODE,value:{}}),this.presentationToken.cancel(),this.presentationToken=void 0,await this.resetTheme(),this.redrawWidgets(),n(".page__overlay").remove(),i.eventBus.dispatch({type:i.EVENT_TYPES.EXIT_PRESENTATION_MODE,value:{}}),o.tw.inject("$rootScope").$apply(()=>{n("#pageRoot").css({opacity:""}),e()})})})}checkConditions(e){if(this.isPresentationEnabled)throw new Error("already in presentation mode");if(e.failIfNotFullscreen&&!r.fullscreenService.isFullscreen())throw new Error("Fullscreen required");return this}applyStyle(e=l){this.setStyle(e)}setStyle(e){n("body").addClass("full-screen"),n("#page_content").addClass("full-screen");const t=n("#pageRoot");t.children().eq(0).addClass("full-screen"),t.find("#wrapper").css({margin:0,width:"100%"}),e.bodyColor&&n("body").css({"background-color":e.bodyColor.toRGB()}),e.hideSidebar&&n(".page__content__sidebar").hide(),e.hideNavbar&&a.navbarService.hideNavbar(),e.hideHeader&&n(".page__content__header").hide(),e.hideNotifications&&n("#notifications").hide()}async applyTheme(e){e&&await c.themeService.changeTheme(e)}removeStyle(){n("body").removeClass("full-screen").css({"background-color":""}),n("#page_content").removeClass("full-screen");const e=n("#pageRoot");e.children().eq(0).removeClass("full-screen"),e.find("#wrapper").css({margin:"",width:""}),n(".page__content__sidebar").show(),n(".page__content__header").show(),n("#notifications").show(),a.navbarService.showNavbar()}async resetTheme(){await c.themeService.changeTheme(c.themeService.getDefaultTheme())}placeOverlay(e){if(e){const t=n('<div class="page__overlay" ng-if="vm.isFullscreen()"></div>');n(".page").prepend(t),e.onMouseDown&&this.presentationToken.addDomEvent(t,"mousedown",e.onMouseDown),this.presentationToken.addDomEvent(t,"contextmenu",e=>e.preventDefault())}}performActions(e){e.redrawWidgets&&this.redrawWidgets(),e.exitPresentationOnEscape&&this.presentationToken.addDomEvent(n(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",()=>{this.isPresentationEnabled&&this.exitPresentationMode()})}redrawWidgets(){o.tw.pageState&&!o.tw.pageState.isDisposed()&&o.tw.pageState.queryAllWidgets(e=>{_.isUndefined(e)||e.isDisposed()||e.redraw(!0)})}}t.PresentationService=d,t.presentationService=new d}),define("services/pages/page_size_calculator",["require","exports","log","math_utils","services/application_mode","services/presentation_service","constants/page_size_constants","classes/page_mode","reusable_utilities"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l{getGridCellSize(e,t){if(e.isGridPage())return{width:this.getGridCellWidth(e,t),height:this.getGridCellHeight(e,t)};throw new Error("Cannot be used for widgets that are not in a grid page")}getGridPageDimensions(e){if(o.presentationService.isPresentationEnabled){const t=e.aspect_ratio;return window.innerWidth/t>window.innerHeight?new n.Vector2D(window.innerHeight*t,window.innerHeight):new n.Vector2D(window.innerWidth,window.innerWidth/t)}throw new Error("not implemented")}getFullPageWidth(e,t){return o.presentationService.isPresentationEnabled?this.getGridPageDimensions(t).x:e.isWholePageExport()?r.EXPORT_PREVIEW_PAGE_WIDTH:e.isGridPage()&&e.getAllowedPages().isReport()?r.PAGE_WITH_SIDEBAR_WIDTH:e.getAllowedPages().isDashboard()?r.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH:e.isGridPage()?r.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH:r.PAGE_WITHOUT_SIDEBAR_WIDTH}getGridCellWidth(e,t){return this.getFullPageWidth(e,t)/t.width}getPageMode(e){if(s.applicationMode.isMobile())return a.PageMode.MOBILE;switch(s.applicationMode.getCurrentAppMode()){case s.AppMode.SHARED_COMMAND_CENTER:return a.PageMode.COMMAND_CENTER;case s.AppMode.EMBEDDED:return a.PageMode.EMBEDDED_PAGE;case s.AppMode.IMAGE_EXPORT:return a.PageMode.IMAGE_EXPORT_PAGE;case s.AppMode.HOOTSUITE_DASHBOARD:return a.PageMode.MOBILE;case s.AppMode.SHARED_DASHBOARD:return e.isGridPage()?a.PageMode.GRID_DASHBOARD:a.PageMode.SHARED_DASHBOARD;case s.AppMode.SANDBOX:return a.PageMode.NO_SIDEBAR_PAGE;case s.AppMode.NORMAL:const t=e.getAllowedPages();if(e.getApplication().getWidgetSettings().displayFullSizeWidget)return a.PageMode.EXPANDED_WIDGET;if(e.isWholePageExport())return a.PageMode.EXPORT_PREVIEW_PAGE;if(t.isReport())return a.PageMode.REPORT_PAGE;if(t.isIssueTrackerModule()||t.isInfluencerManagementModule())return t.isTopicSetup()||t.isTriggerEdit()?a.PageMode.SIDEBAR_PAGE:a.PageMode.NO_SIDEBAR_PAGE;if(t.isDashboard()&&e.isGridPage())return a.PageMode.GRID_DASHBOARD;if(t.isDashboard())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isIqApp())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isSearchAdvanced())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isUserWorkflow())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isTrendDiscovery())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isVisualDiscovery())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isTriggerEdit())return a.PageMode.SIDEBAR_PAGE;if(t.isCommandCenterScreenEditMode())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isMonitor())return a.PageMode.SIDEBAR_PAGE;if(t.isTopicSetup())return a.PageMode.SIDEBAR_PAGE;if(t.isBubbleDialog())return a.PageMode.DIALOG;if(t.isEditFiltersPage())return a.PageMode.SIDEBAR_PAGE;if(t.isEmbeddedWidget())return a.PageMode.SIDEBAR_PAGE;if(t.isCommandCenterScreen())return a.PageMode.COMMAND_CENTER;if(t.isSearch())return a.PageMode.NO_SIDEBAR_PAGE;if(t.isSandbox())return a.PageMode.NO_SIDEBAR_PAGE}return i.logService.error("unknown page type"),a.PageMode.SIDEBAR_PAGE}getGridCellHeight(e,t){if(o.presentationService.isPresentationEnabled)return this.getGridPageDimensions(t).y/t.height;const i=this.getPageMode(e);if(i===a.PageMode.EXPORT_PREVIEW_PAGE)return r.EXPORT_PREVIEW_PAGE_WIDTH/t.aspect_ratio/t.height;if(i===a.PageMode.REPORT_PAGE)return r.PAGE_WITH_SIDEBAR_WIDTH/t.aspect_ratio/t.height;if(i===a.PageMode.GRID_DASHBOARD||i==a.PageMode.SHARED_DASHBOARD)return r.GRID_DASHBOARD_HEIGHT/16;if(i===a.PageMode.NO_SIDEBAR_PAGE&&e.getAllowedPages().isInfluencerManagementModule())return r.DEFAULT_GRID_PAGE_WIDTH/t.aspect_ratio/t.height;if(i===a.PageMode.NO_SIDEBAR_PAGE)return r.PAGE_WITHOUT_SIDEBAR_WIDTH*(9/16)/t.height;throw new Error("Invalid case")}getCurrentGrid(e){const t=c.PageConfigurationUtils.getCurrentPage(e);return void 0!==t&&void 0!==t.grid?t.grid:e.grid}}t.PageSizeCalculatorService=l,t.pageSizeCalculatorService=new l}),define("services/template_source",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.templateSourceFactory=function(e){return void 0===tw.inject("$templateCache").get(e)?`${window.BASE_TEMPLATE_URL}${e}/template.html?v=${window.bootPayload.version}`:e}}),define("components/grid/directive",["require","exports","angular","angular_utilities","drag_and_drop","event_bus","jquery","map","math_utils","reusable_services","reusable_utilities","underscore","classes/application/application","classes/context_data/context_data","classes/draggable/strategy/draggable_grid_strategy","classes/draggable/strategy/multiplexer_strategy","classes/draggable/strategy/resizable_grid_strategy","classes/grid/grid_configuration","classes/grid/grid_page_collection","classes/grid/grid_slot_item","services/grid_drag_handle","services/grid_spacial","services/pages/page_size_calculator","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C){Object.defineProperty(t,"__esModule",{value:!0}),t.gridDirective=function(){return{replace:!1,restrict:"E",bindToController:{grid:"=",pageState:"=?",editMode:"=",fullscreen:"="},controllerAs:"vm",controller:E,templateUrl:C.templateSourceFactory("components/grid"),scope:{}}};let E=class{constructor(e,t,i,n){this.$scope=e,this.$element=t,this.$rootScope=i,this.$timeout=n,this.clickCount=0}$onInit(){this.initialize(),this.initializePlaceholderState(),this.initializeBackgroundGrid(),this.initializeDragAndDrop(),this.initializeCopyPaste(),this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>this.grid.getConfiguration(),(e,t)=>{void 0!==t&&e.width===t.width&&e.height===t.height||this.initialize()})),this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>this.grid,e=>{e.setContainerDimensions([this.$element.children()[0].offsetWidth,this.$element.children()[0].offsetHeight])})),this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>`${this.$element.children()[0].offsetWidth}x${this.$element.children()[0].offsetHeight}`,()=>{this.grid.setContainerDimensions([this.$element.children()[0].offsetWidth,this.$element.children()[0].offsetHeight])})),this.cancellationToken.subscribe(this.grid.onUpdate,()=>{this.$timeout(()=>{this.$scope.$$phase||this.$scope.$apply()})}),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}isLoadingPage(){return!u.mainApplication.isIdle()}initializeCopyPaste(){this.grid.getConfiguration().gridActions&&this.grid.getConfiguration().gridActions.copyPaste&&l.clipboardService.addPasteEvent(document.body,this.grid.getConfiguration().gridActions.copyPaste.channel,e=>{this.getCurrentPageState().getWidgets().every(e=>!e.isEditMode())&&y.GridPageCollection.getActiveAnchorModelIfAble().getSelectedNode().id===this.grid.getConfiguration().id&&void 0!==e.data.getCurrentItem()&&this.grid.getConfiguration().gridActions.copyPaste.onPaste(e)},this.cancellationToken)}applyAspectRatio(){this.grid.getConfiguration().style.grid.aspectRatio&&this.$element.css({height:this.$element[0].getBoundingClientRect().width/this.grid.getConfiguration().style.grid.aspectRatio})}initializeDragAndDrop(){if(this.grid.getConfiguration().dragAndDrop){const e=this.grid.getConfiguration().dragAndDrop.callbacks||{};e.onDragStart=e.onDragStart||g.noop,e.onDragEnd=e.onDragEnd||g.noop,this.createGridStrategies()}}showItemOutline(){return this.grid.getConfiguration().style.items.showOutline||!1}getToolbarDragAndDropChannels(){return this.grid.getConfiguration().dragAndDrop.gridDragAndDropReceiveChannels}getZonesStyle(){return this.zonesStyle}initialize(){void 0!==this.cancellationToken&&this.cancellationToken.cancel(),this.cancellationToken=new d.CancellationToken,this.applyAspectRatio(),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_UPDATE_CONFIGURATION,e=>{this.grid.getConfiguration().id===e.value.id&&(this.grid.setConfiguration(Object.assign(this.grid.getConfiguration(),e.value.configuration)),this.draggableStrategy&&this.draggableStrategy.setActive(void 0!==this.grid.getConfiguration().dragAndDrop),this.gridResizeStrategy&&this.gridResizeStrategy.setActive(void 0!==this.grid.getConfiguration().dragAndDrop),this.gridDragStrategy&&this.gridDragStrategy.setActive(void 0!==this.grid.getConfiguration().dragAndDrop),this.initializeBackgroundGrid(),this.initializeDragAndDrop(),this.initializePlaceholderState(),this.$rootScope.$$phase||this.$rootScope.$apply())}),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_UPDATE_PAGE_NUMBER,e=>{this.grid.getConfiguration().id===e.value.id&&(this.grid.getConfiguration().pageNumber=e.value.pageNumber)}),this.cancellationToken.addDomEvent(r(document),"keydown",e=>this.handleKeyDown(e)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_UPDATE_SIZE,e=>{this.grid.getConfiguration().id===e.value.id&&(this.$element.find(".tw-grid").css({width:e.value.width}),this.applyAspectRatio(),this.initializeBackgroundGrid())}),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_ADD_ITEM,e=>{if(this.grid.getConfiguration().id===e.value.gridId&&(this.grid.addItem(e.value.item),e.value.resize)){const t=e.value.item.getSlotConfiguration(),i=b.gridSpacialService.findSymmetricSize(this.grid,new c.Vector2D(t.grid_x,t.grid_y),{horizontalSymmetry:!0,ignoreItems:[e.value.item],minWidth:6,minHeight:3,maxVerticalSymmetryDistance:3,maxHeight:8,aspectRatio:2,verticalSymmetry:!0});e.value.item.updateSlotConfiguration({grid_x:i.x,grid_y:i.y,width:i.width,height:i.height})}}),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_REMOVE_ITEM,e=>{this.grid.getConfiguration().id===e.value.gridId&&this.removeItem(e.value.itemId)}),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.GRID_REMOVE_SUB_ITEM,e=>{if(this.grid.getConfiguration().id===e.value.gridId){this.grid.getItemsContainingSubItemId(e.value.itemId).forEach(t=>{t.removeItemById(e.value.itemId)})}})}handleKeyDown(e){const t=this.grid.getItems().find(e=>e.selected&&!e.getCurrentItem().isEditMode());t&&(e.keyCode===d.Keys.DELETE&&(this.getGrid().onDeletePressed.fire(t),this.onRemove&&this.onRemove(t),this.$scope.$apply()),e.keyCode===d.Keys.ESCAPE?(this.getGrid().unselectItem(t),this.$scope.$apply()):e.shiftKey?this.handleShiftSelection(e,t):this.handleNudge(e,t))}handleShiftSelection(e,t){switch(e.keyCode){case d.Keys.DOWN_ARROW:this.shiftSelection(t,new c.Vector2D(0,1));break;case d.Keys.UP_ARROW:this.shiftSelection(t,new c.Vector2D(0,-1));break;case d.Keys.LEFT_ARROW:this.shiftSelection(t,new c.Vector2D(-1,0));break;case d.Keys.RIGHT_ARROW:this.shiftSelection(t,new c.Vector2D(1,0))}}handleNudge(e,t){switch(e.keyCode){case d.Keys.DOWN_ARROW:this.nudgeItem(t,new c.Vector2D(0,1),e.metaKey||e.ctrlKey);break;case d.Keys.UP_ARROW:this.nudgeItem(t,new c.Vector2D(0,-1),e.metaKey||e.ctrlKey);break;case d.Keys.LEFT_ARROW:this.nudgeItem(t,new c.Vector2D(-1,0),e.metaKey||e.ctrlKey);break;case d.Keys.RIGHT_ARROW:this.nudgeItem(t,new c.Vector2D(1,0),e.metaKey||e.ctrlKey)}}shiftSelection(e,t){const i=b.gridSpacialService.getBestFittingNeighbour(this.grid,e.getSlotConfiguration(),t);i&&(this.getGrid().unselectItem(e),this.getGrid().toggleItemSelection(i),this.$scope.$apply())}nudgeItem(e,t,i){i?e.multiSelectionActive()||e.resize(t):e.multiSelectionActive()?this.getGrid().getSelectedItems().forEach(e=>{e.move(t,this.getGrid().getSelectedItems())}):e.move(t)}removeItem(e){if(!this.grid.hasItemId(e))throw new Error("item not found");this.grid.removeItemById(e)}hasDragAndDrop(){return void 0!==this.grid.getConfiguration().dragAndDrop}getBackgroundImage(){return this.getGridConfig().style.background.backgroundImage}getGridPlaceholders(){return this.grid.getConfiguration().dropzonePlaceholders.gridPlaceholders}canShowGridPlaceholders(){return void 0!==this.getGridPlaceholders()}getGridPlaceholderStyles(e){if(this.pageState){const t=w.pageSizeCalculatorService.getGridCellSize(this.pageState,w.pageSizeCalculatorService.getCurrentGrid(this.pageState.getPageConfiguration()));return{width:e.size.width*t.width+"px",height:e.size.height*t.height+"px",left:e.offset.x*t.width+"px",top:e.offset.y*t.height+"px"}}return this.getGridPlaceholderStylesDeprecated(e)}getGridPlaceholderStylesDeprecated(e){const{width:t,height:i}=this.grid.getConfiguration();return{width:d.StyleUtils.toPercentageString(e.size.width,t),height:d.StyleUtils.toPercentageString(e.size.height,i),left:d.StyleUtils.toPercentageString(e.offset.x,t),top:d.StyleUtils.toPercentageString(e.offset.y,i)}}isPlaceholderVisible(e){return this.placeholderState.get(e).visible}getPageNumber(){return this.grid.getConfiguration().pageNumber}getGridPlaceholderLabel(e,t){return this.getMessageForGridPlaceholder(e.type,t)}getMessageForGridPlaceholder(e,t){switch(e){case"SLIDE_NR":return t.toString();case"DATE":return moment().format(p.contextData.commonPropertiesContainer.date_format.date_format);default:return""}}canShowPlaceholder(e){switch(this.getGridConfig().gridItemOptions.showPlaceholder){case f.PlaceholderMode.ALWAYS:return!0;case f.PlaceholderMode.IF_SKELETON:return e.getCurrentItem().isSkeleton();case f.PlaceholderMode.NEVER:return!1;default:throw new Error("not implemented")}}createGridStrategies(){if(this.gridDragStrategy=this.constructDraggableStrategy(),this.gridResizeStrategy=this.constructResizableStrategy(),this.draggableStrategy=new m.MultiplexerStrategy([{strategy:this.gridDragStrategy,predicate:(e,t)=>!r(e.target).hasClass("resizer")&&!t.getCurrentItem().editMode},{strategy:this.gridResizeStrategy,predicate:e=>r(e.target).hasClass("resizer")}]),this.cancellationToken.registerDisposable(this.draggableStrategy),this.hasDragAndDrop()){s.dragAndDropService.registerDropTargets([this.$element.parent()[0]],{onDragAccept:()=>this.updateVisiblePlaceholders(),onDragCancel:()=>this.updateVisiblePlaceholders(),onDragLeave:(e,t)=>{S.gridDragHandleService.setAsInvalid(t.dragHandle)},channels:this.grid.getConfiguration().dragAndDrop.gridDragAndDropReceiveChannels,cancellationToken:this.cancellationToken}),this.cancellationToken.setTimeout(()=>{this.$element.find(".grid-placeholder-dropzone").toArray().forEach(e=>{const t=r(e).scope().placeholder;let i;const n=r(e);let o,a;s.dragAndDropService.registerDropTargets([e],{onDragAccept:(e,t)=>{i=void 0},onDragCancel:(e,t)=>{i=void 0},onDragEnter:(e,s)=>{s.dragHandle.style.width&&s.dragHandle.style.height&&(i={width:s.dragHandle.style.width,height:s.dragHandle.style.height}),s.sharedData={offset:t.offset,size:t.size},this.snappingTarget=t,s.lockHandle=!0;const c=(o=r(s.dragHandle).find("i.content")).css("fontSize")||"0px";a=Number(c.substring(0,c.indexOf("px")));const l=this.$element.parent().width()*(t.size.width/this.grid.getConfiguration().width),d=this.$element.parent().height()*(t.size.height/this.grid.getConfiguration().height),g=Math.floor(.35*Math.min(l,d));r(s.dragHandle).animate({left:this.$element.parent().offset().left+this.$element.parent().width()*(t.offset.x/this.grid.getConfiguration().width),top:this.$element.parent().offset().top+this.$element.parent().height()*(t.offset.y/this.grid.getConfiguration().height),width:l,height:d},350),n.animate({fontSize:g}),o.animate({fontSize:.7*g})},onDragLeave:(e,t)=>{r(t.dragHandle).stop(!0,!1),n.stop(!0,!1),n.css({fontSize:""}),o.stop(!0,!1),o.css({fontSize:a}),this.snappingTarget=void 0,t.lockHandle=!1,t.sharedData={},i&&(t.dragHandle.style.width=i.width,t.dragHandle.style.height=i.height,i=void 0)},channels:this.grid.getConfiguration().dragAndDrop.gridDragAndDropReceiveChannels,cancellationToken:this.cancellationToken})})});const e={id:this.grid.getConfiguration().id,draggableStrategy:this.draggableStrategy,channels:this.grid.getConfiguration().dragAndDrop.gridDragAndDropReceiveChannels};o.eventBus.dispatch({type:o.EVENT_TYPES.SEND_GRID_DRAGNDROP_INFO,value:e})}}constructDraggableStrategy(){let e,t,i;this.grid.getConfiguration().dragAndDrop&&(this.grid.getConfiguration().gridItemOptions.swappable&&(e={enabled:!0,callback:this.onSwap.bind(this),validate:this.validateSwap.bind(this)}),this.grid.getConfiguration().gridItemOptions.stackable&&(t={enabled:!0,callback:this.onStack.bind(this),validate:this.validateStack.bind(this)}),this.grid.getConfiguration().gridItemOptions.nestable&&(i={enabled:!0,callback:this.onNest.bind(this),validate:this.validateNest.bind(this)}));const n=new h.default(this.$element[0],this.grid,{onDragStart:this.onDragStart.bind(this),onDragEnd:this.onDragEnd.bind(this),swap:e,stack:t,nest:i,multiSelect:this.getGridConfig().multiSelect});return this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.TEXT_BOX_FOCUS_CHANGED,e=>{n.setActive(!e.value.focused)}),n}constructResizableStrategy(){return new _.ResizableGridStrategy(this.$element[0],this.grid,{dimensionChecks:{minWidth:!0,maxWidth:!0,minHeight:!0,maxHeight:!0}})}validateSwap(e,t){const i=e.getSlotConfiguration(),n=t.getSlotConfiguration();return b.gridSpacialService.validateDimensionLimit(i,n.dimension_limit)&&b.gridSpacialService.validateDimensionLimit(n,i.dimension_limit)&&-1!==i.grid_x&&-1!==i.grid_y}validateStack(e,t){const i=e.getSlotConfiguration(),n=t.getSlotConfiguration();return b.gridSpacialService.validateDimensionLimit(n,i.dimension_limit)&&-1!==n.grid_x&&-1!==n.grid_y&&!e.hasMultipleItems()}validateNest(e,t){return e.getCurrentItem().canNest(t.getCurrentItem())}onDragStart(e){this.updateVisiblePlaceholders(e),this.grid.getConfiguration().dragAndDrop.callbacks.onDragStart(e),this.$scope.$apply()}async onDragEnd(e,t){let i=!1;void 0!==this.snappingTarget&&(i=!0,e.grid_x=this.snappingTarget.offset.x,e.grid_y=this.snappingTarget.offset.y,e.width=this.snappingTarget.size.width,e.height=this.snappingTarget.size.height,this.snappingTarget=void 0),this.updateVisiblePlaceholders(),t.updateSlotConfiguration(g.omit(e,["grid_z"])),await this.grid.getConfiguration().dragAndDrop.callbacks.onDragEnd(e,t,i)}updateVisiblePlaceholders(e){this.grid.getConfiguration().dropzonePlaceholders.gridPlaceholders&&this.grid.getConfiguration().dropzonePlaceholders.gridPlaceholders.forEach(t=>this.placeholderState.get(t).visible=this.grid.getConfiguration().dropzonePlaceholders.highlightCondition(void 0!==e,e,t,this.grid.getItems()))}async onSwap(e,t){t.swap(e),this.grid.getConfiguration().dragAndDrop.callbacks.onSwap&&await this.grid.getConfiguration().dragAndDrop.callbacks.onSwap(e,t)}async onStack(e,t){const i=g.clone(e.getSlotConfiguration());try{"template"!==e.getCurrentItem().getId()&&t.stack(e),this.grid.getConfiguration().dragAndDrop.callbacks.onStack&&await this.grid.getConfiguration().dragAndDrop.callbacks.onStack(e,t)}catch(e){t.next();const n=t.splitCurrent();n.updateSlotConfiguration(i),this.getGrid().addItem(n),this.getGrid().update()}}async onNest(e,t){t.getCurrentItem().addNestedWidget(e.getCurrentItem())}getItems(){return this.grid.getItems()}getGrid(){return this.grid}getGridConfig(){return this.grid.getConfiguration()}getZones(){return this.getGridConfig()&&void 0!==this.getGrid()?g.range(0,this.grid.getLength()):void 0}showBackgroundGrid(){return void 0!==this.grid.getConfiguration().style.background.backgroundGrid}isFullscreen(){return!0===this.fullscreen}getGroupPage(){return this.getCurrentPageState().getAllowedPages().getGroupPage()}getZoneDebugInfo(e){return""}toggleSelection(e,t){this.grid.getConfiguration().gridItemOptions.selectable&&(this.clickCount++,g.debounce(()=>{!e.getCurrentItem()||(1!==this.clickCount||e.getCurrentItem().editMode)&&e.getCurrentItem().selected||(this.getGrid().toggleItemSelection(e,this.getGridConfig().multiSelect&&t.ctrlKey,this.getGridConfig().multiSelect&&t.shiftKey),this.$scope.$$phase||this.$scope.$apply()),this.clickCount=0},200)())}initializeBackgroundGrid(){setTimeout(()=>{this.rebuildBackgroundGrid()})}rebuildBackgroundGrid(){const e=this.$element.find(".zones");1===e.length&&this.grid.createBackgroundCanvasGrid(e[0],this.grid.getConfiguration().style)}initializePlaceholderState(){this.placeholderState=new a.Map,this.grid.getConfiguration().dropzonePlaceholders.gridPlaceholders&&this.grid.getConfiguration().dropzonePlaceholders.gridPlaceholders.forEach(e=>this.placeholderState.set(e,{visible:!1}))}getCurrentPageState(){return void 0!==this.pageState?this.pageState:u.mainApplication.getPageState()}};__decorate([d.throttle(150,{leading:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[v.GridSlotItem,c.Vector2D,Boolean]),__metadata("design:returntype",void 0)],E.prototype,"nudgeItem",null),E=__decorate([n.ngInject(["$scope","$element","$rootScope","$timeout"]),__metadata("design:paramtypes",[Object,Object,Object,Function])],E),t.GridController=E}),define("classes/widget/types/articles_widget",["require","exports","talkwalker_constants","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends n.WidgetWrapper{constructor(e,t){super(e,t,s.WidgetType.ARTICLES)}clone(){const e=new o(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}isArticles(){return this.getPayloadType()===i.PayloadType.PAYLOAD_ARTICLES&&this.getDataTypeUuid()!==i.DataType.RESULTSLIST_TREE_MAP}isSmallArticlesWidget(){return this.isArticles()&&this.getWidth()<12}isArticlesStoryTiles(){return this.isArticles()&&this.getDataTypeUuid()===i.DataType.RESULTSLIST_STORY_TILES}isArticlesKeyStories(){return this.isArticles()&&this.getDataTypeUuid()===i.DataType.RESULTSLIST_STORIES}isArticlesCompact(){return this.isArticles()&&this.getDataTypeUuid()===i.DataType.RESULTSLIST_COMPACT}getType(){return s.WidgetType.ARTICLES}}t.ArticlesWidget=o}),define("classes/widget/types/block_influencers_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.BLOCK_INFLUENCERS)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.BLOCK_INFLUENCERS}}t.BlockInfluencersWidget=s}),define("classes/widget/types/gender_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type","talkwalker_constants"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.GENDER)}clone(){const e=new o(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}isGender(){return this.getPayloadType()===s.PayloadType.PAYLOAD_GENDER}getType(){return n.WidgetType.GENDER}}t.GenderWidget=o}),define("classes/widget/types/message_diffusion_widget",["require","exports","talkwalker_constants","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends n.WidgetWrapper{constructor(e,t){super(e,t,s.WidgetType.MESSAGE_DIFFUSION)}clone(){const e=new o(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}isMessageDiffusion(){return this.getPayloadType()===i.PayloadType.PAYLOAD_MESSAGE_DIFFUSION_ENTRIES}isGlobe(){return this.getSelectedViewMode()===constants.widget.view_mode_options.view_by_location}getType(){return s.WidgetType.MESSAGE_DIFFUSION}}t.MessageDiffusionWidget=o}),define("classes/widget/types/openlayers_map_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type","talkwalker_constants","reusable_utilities"],function(e,t,i,n,s,o){var r;Object.defineProperty(t,"__esModule",{value:!0});let a=r=class extends i.WidgetWrapper{clone(){const e=new r(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.OPENLAYERS_WORLD_MAP}isWorldMap(){return this.getPayloadType()===s.PayloadType.PAYLOAD_MAP}isDefaultMap(){return this.isWorldMap()&&this.getDataTypeUuid()===dataTypeConf.MAP_DEFAULT.data_type}isHeatmap(){return this.isWorldMap()&&this.getDataTypeUuid()===dataTypeConf.MAP_HEATMAP.data_type}isGeoCentroidMap(){return this.isWorldMap()&&this.getDataTypeUuid()===dataTypeConf.MAP_GEO_CENTROID.data_type}isChoroplethMap(){return this.isWorldMap()&&this.getDataTypeUuid()===dataTypeConf.MAP_CHOROPLETH.data_type}isEmojiMap(){return this.isWorldMap()&&this.getDataTypeUuid()===dataTypeConf.MAP_EMOJI.data_type}getSelectedGeodataPrecisionType(){return this.getMenu().getGeodataPrecisionTypesMenu().getFirstSelectedEntry().getMappedId()}};a=r=__decorate([o.meta({name:"OpenlayersMapWidget"})],a),t.OpenlayersMapWidget=a,t.default=_.constant(a)}),define("classes/widget/types/progress_graph_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.PROGRESS_GRAPH)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.PROGRESS_GRAPH}isProgressGraph(){return!0}}t.ProgressGraphWidget=s}),define("classes/widget/types/restform_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.RESTFORM)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.RESTFORM}}t.RestformWidget=s}),define("classes/widget/types/single_metric_widget",["require","exports","talkwalker_constants","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends n.WidgetWrapper{constructor(e,t){super(e,t,s.WidgetType.SINGLE_METRIC)}clone(){const e=new o(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}isSingleMetric(){return this.isResult()&&this.getConfigurationRendering().uuid_configuration===i.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT_SIMPLE}getType(){return s.WidgetType.SINGLE_METRIC}}t.SingleMetricWidget=o}),define("classes/widget/types/text_widget",["require","exports","event_bus","flux","talkwalker_constants","services/context","services/rest_form_service","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends a.WidgetWrapper{constructor(e,t){super(e,t,c.WidgetType.TEXT),this.isText()&&this.hasImageId()&&this.loadImage()}clone(){const e=new l(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}merge(e,t){super.merge(e,t),this.isText()&&e.hasImageId()&&e.getImageId()!==this.getImageId()&&this.loadImage()}isText(){return this.getPayloadType()===s.PayloadType.PAYLOAD_TEXT}isHeadline(){if(!this.getDicWrapper().hasPrimarySource())return!1;return this.getDicWrapper().getPrimarySource().data_type_configuration_uuid===dataTypeConf[constants.data_type.text_headline].configuration.uuid_configuration}isImage(){if(!this.getDicWrapper().hasPrimarySource())return!1;return this.getDicWrapper().getPrimarySource().data_type_configuration_uuid===dataTypeConf[constants.data_type.text_image].configuration.uuid_configuration}isVideo(){if(!this.getDicWrapper().hasPrimarySource())return!1;return this.getDicWrapper().getPrimarySource().data_type_configuration_uuid===dataTypeConf[constants.data_type.text_video].configuration.uuid_configuration}getType(){return this.hasPageState()&&this.getPageState().getAllowedPages().isReport()&&this.getPageState().hasPageConfiguration()&&!this.isFooter()&&!this.isHeader()?this.isImage()?c.WidgetType.IMAGE_BOX:this.isVideo()?c.WidgetType.VIDEO_BOX:c.WidgetType.TEXT_BOX:c.WidgetType.TEXT}isFooter(){return this.hasPayloadValue()&&this.getPayloadValue().report_element_context===constants.report.element_context.footer}isHeader(){return this.hasPayloadValue()&&this.getPayloadValue().report_element_context===constants.report.element_context.header}loadImage(){r.restFormService.get(routes.controllers.tw.Images.get(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,this.getImageId()).url).then(e=>{if(!this.hasPayloadValue())return;const t=this.getPayloadValue(!0);t.content_url="data:image/png;base64,"+e,this.setPayloadValue(t),n.dispatcher.dispatch(this.dispatchCommands.onImageLoaded,{widgetId:this.getId()}),i.eventBus.dispatch({type:i.EVENT_TYPES.IMAGE_LOADED,value:this})})}}t.TextWidget=l}),define("classes/widget/types/treemap_widget",["require","exports","talkwalker_constants","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends n.WidgetWrapper{constructor(e,t){super(e,t,s.WidgetType.TREEMAP)}clone(){const e=new o(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}isTreeMap(){return this.hasTreePayloadType()&&this.getConfigurationRendering().uuid_configuration===i.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_TREEMAP||this.getDataTypeUuid()===i.DataType.RESULTSLIST_TREE_MAP}isSmallTreemap(){return this.isTreeMap()&&this.getWidth()<12}getType(){return s.WidgetType.TREEMAP}}t.TreemapWidget=o}),define("wrappers/widget/sorting_config_wrapper",["require","exports","wrappers/abstract_wrapper"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.SortingConfigWrapper=class extends i.AbstractWrapper{constructor(e){super("SORTING_CONFIG_WRAPPER"),this.sortingConfig=e}isSortOnRowLabel(){return!0===this.sortingConfig.sort_on_row_label}setSortOnRowLabel(e){this.sortingConfig.sort_on_row_label=e}hasSortOnColumnCode(){return void 0!==this.getSortOnColumnCode()}getSortOnColumnCode(){return this.sortingConfig.sort_on_column_code}setSortOnColumnCode(e){this.sortingConfig.sort_on_column_code=e}getSortDirection(){return this.sortingConfig.sort_direction}setSortDirection(e){this.sortingConfig.sort_direction=e}merge(e){this.sortingConfig=e.sortingConfig}toProto(){return this.sortingConfig}}}),define("wrappers/widget/axis_configuration_wrapper",["require","exports","wrappers/abstract_wrapper","wrappers/topic_menu/topic_menu_wrapper","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends i.AbstractWrapper{constructor(e){super("AXIS_CONFIGURATION_WRAPPER"),this.axisConfiguration=e,s.isUndefined(e.axis_type_menu)||(this.axisTypeMenu=new n.TopicMenuWrapper(e.axis_type_menu))}isLogarithmic(){return"LOGARITHMIC"===this.getAxisType()}toProto(){return s.isUndefined(this.axisTypeMenu)||(this.axisConfiguration.axis_type_menu=this.axisTypeMenu.toProto()),this.axisConfiguration}merge(e){this.axisConfiguration=e.axisConfiguration,this.mergeKey("axisTypeMenu",e)}hideLabels(){return this.axisConfiguration.hide_axis}hasLabel(){return!s.isUndefined(this.getLabel())}getLabel(){return this.axisConfiguration.label}hasAxisType(){return!s.isUndefined(this.getAxisType())}getAxisType(){return this.axisConfiguration.axis_type}setAxisType(e){this.axisConfiguration.axis_type=e}hasAxisTypeMenu(){return!s.isUndefined(this.getAxisTypeMenu())}getAxisTypeMenu(){return this.axisTypeMenu}setAxisTypeMenu(e){this.axisTypeMenu=new n.TopicMenuWrapper(e)}shouldAutoRenameLegend(){return this.axisConfiguration.auto_rename_legend}setUseMainAxis(e){this.axisConfiguration.use_main_axis=e}shouldUseMainAxis(){return this.axisConfiguration.use_main_axis}}t.AxisConfigurationWrapper=o,t.default=s.constant(o)}),define("wrappers/widget/comments_wrapper",["require","exports","underscore","wrappers/abstract_wrapper","services/comments"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.CommentsWrapper=class extends n.AbstractWrapper{constructor(e){super("COMMENTS_WRAPPER"),this.setComments(e)}getComments(){return this.comments||[]}findComment(e,t){return i.find(this.getComments(),i=>i.row_key===e&&i.timestamp===t)}getComment(e){return e&&this.map[e]}hasComments(){return!i.isUndefined(this.comments)&&this.comments.length>0}setComments(e){this.comments=e,this.initializeMap()}clearComments(){this.setComments([])}addComment(e){this.removeComment(e),this.addToMap(e),this.comments.push(e)}removeComment(e){i.isUndefined(this.getComment(e.id))||(this.comments=i.filter(this.comments,t=>t.id!==e.id),delete this.map[e.id])}toProto(){return this.comments}initializeMap(){this.map={},this.comments&&this.comments.forEach(e=>this.addToMap(e))}addToMap(e){i.isUndefined(e.id)&&(e.id=s.commentsService.generateRandomId()),this.map[e.id]=e}}}),define("wrappers/widget/extended_configuration_wrapper",["require","exports","lazy","underscore","wrappers/abstract_wrapper","wrappers/topic_menu/topic_menu_wrapper","wrappers/widget/axis_configuration_wrapper","wrappers/widget/comments_wrapper","math_utils","wrappers/widget/sorting_config_wrapper","graphics_utilities"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});class g extends s.AbstractWrapper{constructor(e){super("EXTENDED_CONFIGURATION_WRAPPER"),this.extendedConfiguration=e,this.rewrapMenus(e),this.comments=new a.CommentsWrapper(e.comments||[]),this.type=e.type}rewrapMenus(e){delete this.sortByMenu,delete this.treemapSortByMenu,delete this.groupByMenu,delete this.numResultsMenu,delete this.transformationsMenu,delete this.trendCountriesMenu,delete this.trendTimerangeMenu,delete this.xAxisConfiguration,delete this.yAxisConfiguration,delete this.zAxisConfiguration,delete this.sortingConfig,void 0!==e.sort_by&&(this.sortByMenu=new o.TopicMenuWrapper(e.sort_by)),void 0!==e.tree_map_sort_by&&(this.treemapSortByMenu=new o.TopicMenuWrapper(e.tree_map_sort_by)),void 0!==e.group_by&&(this.groupByMenu=new o.TopicMenuWrapper(e.group_by)),void 0!==e.num_results&&(this.numResultsMenu=new o.TopicMenuWrapper(e.num_results)),void 0!==e.transformations_menu&&(this.transformationsMenu=new o.TopicMenuWrapper(e.transformations_menu)),void 0!==e.trend_countries&&(this.trendCountriesMenu=new o.TopicMenuWrapper(this.extendedConfiguration.trend_countries)),void 0!==e.trend_timerange&&(this.trendTimerangeMenu=new o.TopicMenuWrapper(this.extendedConfiguration.trend_timerange)),void 0!==e.x_axis_configuration&&(this.xAxisConfiguration=new r.AxisConfigurationWrapper(e.x_axis_configuration)),void 0!==e.y_axis_configuration&&(this.yAxisConfiguration=new r.AxisConfigurationWrapper(e.y_axis_configuration)),void 0!==e.z_axis_configuration&&(this.zAxisConfiguration=new r.AxisConfigurationWrapper(e.z_axis_configuration)),void 0!==e.sorting_config&&(this.sortingConfig=new l.SortingConfigWrapper(e.sorting_config))}toProto(){return this.sortByMenu&&(this.extendedConfiguration.sort_by=this.sortByMenu.toProto()),this.treemapSortByMenu&&(this.extendedConfiguration.tree_map_sort_by=this.treemapSortByMenu.toProto()),this.groupByMenu&&(this.extendedConfiguration.group_by=this.groupByMenu.toProto()),this.numResultsMenu&&(this.extendedConfiguration.num_results=this.numResultsMenu.toProto()),this.transformationsMenu&&(this.extendedConfiguration.transformations_menu=this.transformationsMenu.toProto()),this.trendCountriesMenu&&(this.extendedConfiguration.trend_countries=this.trendCountriesMenu.toProto()),this.trendTimerangeMenu&&(this.extendedConfiguration.trend_timerange=this.trendTimerangeMenu.toProto()),this.comments&&(this.extendedConfiguration.comments=this.comments.toProto()),this.sortingConfig&&(this.extendedConfiguration.sorting_config=this.sortingConfig.toProto()),this.extendedConfiguration}setHistoryId(e){this.extendedConfiguration.interaction_network_config||(this.extendedConfiguration.interaction_network_config={}),this.extendedConfiguration.interaction_network_config.history_item=e}getBackgroundColor(){return d.Color.fromHex(this.extendedConfiguration.background_color||"#FFFFFFFF")}setBackgroundColor(e){this.extendedConfiguration.background_color=e.toHex8()}getType(){return this.type}isInfluencerType(){return this.type===constants.widget.extended_configuration.type.uuid_config_influencors_configuration}hasColorScheme(){return this.extendedConfiguration.interaction_network_config&&void 0!==this.extendedConfiguration.interaction_network_config.color_scheme}getColorScheme(){return this.hasColorScheme()?this.extendedConfiguration.interaction_network_config.color_scheme:void 0}setColorScheme(e){this.extendedConfiguration.interaction_network_config||(this.extendedConfiguration.interaction_network_config={}),this.extendedConfiguration.interaction_network_config.color_scheme=e}setClusterLabelsShown(e){this.extendedConfiguration.clusterLabelsShown=e}getClusterLabelsShown(){return this.extendedConfiguration.clusterLabelsShown}merge(e){this.extendedConfiguration=e.extendedConfiguration,this.mergeKey("sortByMenu",e),this.mergeKey("treemapSortByMenu",e),this.mergeKey("groupByMenu",e),this.mergeKey("blocked_themes",e),this.mergeKey("blocked_smart_themes",e),this.mergeKey("numResultsMenu",e),this.mergeKey("transformationMenu",e),this.mergeKey("trendCountriesMenu",e),this.mergeKey("trendTimerangeMenu",e),this.mergeKey("xAxisConfiguration",e),this.mergeKey("yAxisConfiguration",e),this.mergeKey("zAxisConfiguration",e),this.mergeKey("sortingConfig",e),this.rewrapMenus(this.extendedConfiguration)}addHiddenColumn(e){const t=this.getHiddenColumns();t.includes(e)||t.push(e)}removeHiddenColumn(e){const t=this.getHiddenColumns();t.splice(t.indexOf(e),1)}createThemeIdentifier(e){return`${e.label||""}_${e.label||""}`}blockTheme(e,t=!1){this.getRemovedThemes().includes(e.label)||(t?this.extendedConfiguration.blocked_smart_themes.push(e):this.extendedConfiguration.blocked_themes.push(e.label))}showRemovedTheme(e,t=!1){if(this.getRemovedThemes(),t){const t=this.getRemovedSmartThemes();this.extendedConfiguration.blocked_smart_themes.splice(t.findIndex(({id:t,label:i})=>t===e.id&&i===e.label),1)}else{const t=this.getRemovedNormalThemes();this.extendedConfiguration.blocked_themes.splice(t.indexOf(e.label),1)}}getRemovedNormalThemes(){return void 0===this.extendedConfiguration.blocked_themes&&(this.extendedConfiguration.blocked_themes=[]),this.extendedConfiguration.blocked_themes}getRemovedSmartThemes(){return void 0===this.extendedConfiguration.blocked_smart_themes&&(this.extendedConfiguration.blocked_smart_themes=[]),this.extendedConfiguration.blocked_smart_themes}getRemovedThemes(){return[...this.getRemovedNormalThemes(),...this.getRemovedSmartThemes().map(({label:e})=>e)]}getHiddenColumns(){return void 0===this.extendedConfiguration.hidden_columns&&(this.extendedConfiguration.hidden_columns=[]),this.extendedConfiguration.hidden_columns}getSortByMenu(){return this.sortByMenu}getTreemapSortByMenu(){return this.treemapSortByMenu}getGroupByMenu(){return this.groupByMenu}getTransformationsMenu(){return this.transformationsMenu}setTransformationsMenu(e){this.transformationsMenu=new o.TopicMenuWrapper(e)}getNumResultsMenu(){return this.numResultsMenu}setNumResultsMenu(e){this.numResultsMenu=new o.TopicMenuWrapper(e)}getTrendCountriesMenu(){return this.trendCountriesMenu}getTrendTimerangeMenu(){return this.trendTimerangeMenu}setOffset(e){this.extendedConfiguration.offset=e}setLoadMoreFlag(e){return this.extendedConfiguration.load_more=e,this}getLoadMoreFlag(){return this.extendedConfiguration.load_more}getOffset(){return this.extendedConfiguration.offset}setLoadedUrls(e){this.extendedConfiguration.loaded_urls=e}getLoadedUrls(){return this.extendedConfiguration.loaded_urls}clearLoadedUrls(){this.setLoadedUrls([])}hasSortByMenu(){return void 0!==this.sortByMenu}hasTreemapSortByMenu(){return void 0!==this.treemapSortByMenu}hasGroupByMenu(){return void 0!==this.groupByMenu}hasNumResultsMenu(){return void 0!==this.numResultsMenu}hasTransformationsMenu(){return void 0!==this.transformationsMenu}hasTrendCountryMenu(){return void 0!==this.trendCountriesMenu}hasTrendTimerangeMenu(){return void 0!==this.trendTimerangeMenu}setTopLeftLonLat(e){this.extendedConfiguration.top_left||(this.extendedConfiguration.top_left={});const[t,i]=e;this.setTopLeftXY(new c.Vector2D(t,i)),this.extendedConfiguration.top_left.longitude=t.toString(10),this.extendedConfiguration.top_left.latitude=i.toString(10)}setTopRightLonLat(e){this.extendedConfiguration.top_right||(this.extendedConfiguration.top_right={});const[t,i]=e;this.setTopRightXY(new c.Vector2D(t,i)),this.extendedConfiguration.top_right.longitude=t.toString(10),this.extendedConfiguration.top_right.latitude=i.toString(10)}setBottomLeftLonLat(e){this.extendedConfiguration.bottom_left||(this.extendedConfiguration.bottom_left={});const[t,i]=e;this.setBottomLeftXY(new c.Vector2D(t,i)),this.extendedConfiguration.bottom_left.longitude=t.toString(10),this.extendedConfiguration.bottom_left.latitude=i.toString(10)}setBottomRightLonLat(e){this.extendedConfiguration.bottom_right||(this.extendedConfiguration.bottom_right={});const[t,i]=e;this.setBottomRightXY(new c.Vector2D(t,i)),this.extendedConfiguration.bottom_right.longitude=t.toString(10),this.extendedConfiguration.bottom_right.latitude=i.toString(10)}setTopLeftXY(e){this.extendedConfiguration.top_left=e.toJSON()}setTopRightXY(e){this.extendedConfiguration.top_right=e.toJSON()}setBottomLeftXY(e){this.extendedConfiguration.bottom_left=e.toJSON()}setBottomRightXY(e){this.extendedConfiguration.bottom_right=e.toJSON()}setCenterLonLat(e){this.extendedConfiguration.center||(this.extendedConfiguration.center={});const[t,i]=e;this.extendedConfiguration.center.longitude=t.toString(10),this.extendedConfiguration.center.latitude=i.toString(10)}getCenterLonLat(){if(this.extendedConfiguration.center){const{longitude:e,latitude:t}=this.extendedConfiguration.center;return[Number(e),Number(t)]}return[0,0]}getTopLeft(){return new c.Vector2D(this.extendedConfiguration.top_left.x,this.extendedConfiguration.top_left.y)}getTopRight(){return new c.Vector2D(this.extendedConfiguration.top_right.x,this.extendedConfiguration.top_right.y)}getBottomLeft(){return new c.Vector2D(this.extendedConfiguration.bottom_left.x,this.extendedConfiguration.bottom_left.y)}getBottomRight(){return new c.Vector2D(this.extendedConfiguration.bottom_right.x,this.extendedConfiguration.bottom_right.y)}getTopLeftLonLat(){return this.extendedConfiguration.top_left||(this.extendedConfiguration.top_left={longitude:"-180",latitude:"-80"}),[Number(this.extendedConfiguration.top_left.longitude),Number(this.extendedConfiguration.top_left.latitude)]}getTopRightLonLat(){return this.extendedConfiguration.top_right||(this.extendedConfiguration.top_right={longitude:"180",latitude:"80"}),[Number(this.extendedConfiguration.top_right.longitude),Number(this.extendedConfiguration.top_right.latitude)]}getBottomLeftLonLat(){return this.extendedConfiguration.bottom_left||(this.extendedConfiguration.bottom_left={longitude:"-180",latitude:"-80"}),[Number(this.extendedConfiguration.bottom_left.longitude),Number(this.extendedConfiguration.bottom_left.latitude)]}getBottomRightLonLat(){return this.extendedConfiguration.bottom_right||(this.extendedConfiguration.bottom_right={longitude:"-180",latitude:"80"}),[Number(this.extendedConfiguration.bottom_right.longitude),Number(this.extendedConfiguration.bottom_right.latitude)]}hasTopLeft(){return void 0!==this.extendedConfiguration.top_left}hasTopRight(){return void 0!==this.extendedConfiguration.top_right}hasBottomLeft(){return void 0!==this.extendedConfiguration.bottom_left}hasBottomRight(){return void 0!==this.extendedConfiguration.bottom_right}hasZoom(){return void 0!==this.extendedConfiguration.zoom_level}setWidgetCameraState(e,t){this.setTopLeftXY(e),this.setZoomLevel(t,8)}getWidgetCameraState(){return{panningOffset:this.getTopLeft(),zoom:this.getZoomLevel(8)}}hasWidgetCameraState(){return this.hasZoom()&&this.hasTopLeft()}setZoomLevel(e,t=1){this.extendedConfiguration.zoom_level=Math.floor(e*10**t)}getZoomLevel(e=1){return this.extendedConfiguration.zoom_level/10**e}getEntryUrls(){return this.extendedConfiguration.entry_urls}setEntryUrls(e){this.extendedConfiguration.entry_urls=e}getXAxisConfiguration(){return this.xAxisConfiguration}setXAxisConfiguration(e){this.extendedConfiguration.x_axis_configuration=e,this.xAxisConfiguration=new r.AxisConfigurationWrapper(this.extendedConfiguration.x_axis_configuration)}hasXAxisConfiguration(){return void 0!==this.getXAxisConfiguration()}getYAxisConfiguration(){return this.yAxisConfiguration}setYAxisConfiguration(e){this.extendedConfiguration.y_axis_configuration=e,this.yAxisConfiguration=new r.AxisConfigurationWrapper(this.extendedConfiguration.y_axis_configuration)}hasYAxisConfiguration(){return void 0!==this.getYAxisConfiguration()}getZAxisConfiguration(){return this.zAxisConfiguration}setZAxisConfiguration(e){this.extendedConfiguration.z_axis_configuration=e,this.zAxisConfiguration=new r.AxisConfigurationWrapper(this.extendedConfiguration.z_axis_configuration)}hasZAxisConfiguration(){return void 0!==this.getZAxisConfiguration()}getZAxisTypeMenuData(){return this.hasZAxisConfiguration()?this.getZAxisConfiguration().getAxisTypeMenu():void 0}setZAxisTypeMenuData(e){this.extendedConfiguration.z_axis_configuration.axis_type_menu=e,this.zAxisConfiguration.setAxisTypeMenu(this.extendedConfiguration.z_axis_configuration.axis_type_menu),this.zAxisConfiguration.setAxisType(i(e.root_entry.children).find(function(e){return"NODE"===e.selected}).mapped_id)}hasZAxisTypeMenuData(){return void 0!==this.getZAxisTypeMenuData()}hasComments(){return this.comments.hasComments()}getComments(){return this.comments.getComments()}clearComments(){this.comments.clearComments()}getComment(e){return this.comments.getComment(e)}findComment(e,t){return this.comments.findComment(e,t)}addComment(e){this.comments.addComment(e)}removeComment(e){this.comments.removeComment(e)}hasSortingConfig(){return void 0!==this.sortingConfig}getSortingConfig(){return this.sortingConfig}setSortingConfig(e){this.extendedConfiguration.sorting_config=e,this.sortingConfig=new l.SortingConfigWrapper(e)}canUseFullIndexForUrls(){return!0===this.extendedConfiguration.use_full_index_for_urls}shouldHideMetaData(){return!0===this.extendedConfiguration.hide_meta_data}setUseFullIndexForUrls(e){this.extendedConfiguration.use_full_index_for_urls=e}setClusterId(e){this.extendedConfiguration.cluster_id=e}getClusterId(){return this.extendedConfiguration.cluster_id}setParentUrl(e){this.extendedConfiguration.parent_url=e}getParentUrl(){return this.extendedConfiguration.parent_url}setSkipDataLoading(e){this.extendedConfiguration.skip_data_loading=e}getSkipDataLoading(){return this.extendedConfiguration.skip_data_loading}clearViewport(){this.setBottomLeftLonLat([-180,-80]),this.setTopRightLonLat([180,80])}}t.ExtendedConfigurationWrapper=g,t.default=n.constant(g)}),define("services/modal",["require","exports","underscore","other/tw"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MEDIUM="medium",e.LARGE="large"}(t.ModalSize||(t.ModalSize={}));class s{constructor(e,t){this.$rootScope=e,this.$q=t,this.$rootScope.modals=[]}isAnyModalOpen(){return this.$rootScope.modals.length>0}display(e,t,i={fullscreen:!1}){return i.fullscreen=!1,this.push({type:e,data:t,options:i})}displayFullScreen(e,t,i={fullscreen:!0}){return i.fullscreen=!0,this.push({type:e,data:t,options:i})}get(){return this.$rootScope.modals}getLast(){return i.last(this.$rootScope.modals)}dismissAll(){this.$rootScope.modals.length=0}dismiss(e,t,n){const s=i.indexOf(this.$rootScope.modals,e);s>=0&&(this.$rootScope.modals.splice(s,1),t?e.deferred.resolve(n):e.deferred.reject(n),this.$rootScope.$$phase||this.$rootScope.$apply())}push(e){const t=this.$q.defer();return void 0!==e&&(e.deferred=t,this.$rootScope.modals.unshift(e),this.$rootScope.$$phase||this.$rootScope.$apply()),t.promise}}s.$inject=["$rootScope","$q"],t.default=s,Object.defineProperty(t,"modalService",{get:function(){return n.tw.inject("modalService")}})}),define("services/comments",["require","exports","underscore","other/tw","services/rest_form_service","services/bubble_dialog","services/modal","angular_utilities","log","reusable_utilities","classes/refresh/model_type","services/tw_common","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});let m=class{constructor(e){this.$rootScope=e,this.modalName="EDIT_COMMENT",this.actionMap={add:this.addComment.bind(this),update:this.updateComment.bind(this),remove:this.removeComment.bind(this)}}editComment(e,t,i,n=!1,s,o,a){e.canEditComments()&&(r.modalService.display(this.modalName,{widget:e,rowKey:t,timestamp:i,isIndicator:n,nestedId:o,id:s,pageState:a}),this.$rootScope.$$phase||this.$rootScope.$apply())}performEdit(e,t,n,s,o=!1,r){if(!i.isUndefined(t))if(void 0!==this.actionMap[n]){const i=!1;this.actionMap[n](e,t,s,i,o,r)}else c.logService.warn("Could not find a valid action for type",void 0,{action:n});return Promise.resolve({})}addComment(e,t,n,s=!1,o=!1,r){if(e.canEditComments()){const a=e.findExtendedConfiguration(r);if(i.isUndefined(t.id)&&(t.id=this.generateRandomId()),this.updateDisplayType(t,e),e.canSaveComments())return this.postAddComment(e,t,n,o,r).then(this.handleCommentUpdate.bind(this,e,t,s,r));a.addComment(t),s||(e.prepareReload(),this.refreshWidgetData(e))}return Promise.resolve({})}updateComment(e,t,n,s=!1,o=!1,r){if(e.canEditComments()){const a=e.findExtendedConfiguration(r),c=a.getComment(t.id);if(i.isUndefined(c))return this.addComment(e,t,n,s,o,r);if(this.updateDisplayType(t,e),t.timestamp=c.timestamp,e.canSaveComments())return this.postUpdateComment(e,t,n,o,r).then(this.handleCommentUpdate.bind(this,e,t,s,r));a.addComment(t),s||(e.prepareReload(),this.refreshWidgetData(e))}return Promise.resolve({})}removeComment(e,t,i=!1,n=!1,s){if(e.canEditComments()){if(e.canSaveComments())return this.postRemoveComment(e,t,n,s).then(this.handleCommentRemoval.bind(this,e,t,i,s));e.findExtendedConfiguration(s).removeComment(t),i||(e.prepareReload(),this.refreshWidgetData(e))}return Promise.resolve({})}togglePin(e,t,i=!1,n){if(t.canEditComments())return e.pinned=!e.pinned,this.updateComment(t,e,void 0,!1,i,n)}postAddComment(e,t,i,n,s){return this.performRFormAction("add",this.constructFormData(e,t,i,n,s),void 0!==i)}postUpdateComment(e,t,i,n,s){return this.performRFormAction("update",this.constructFormData(e,t,i,n,s),void 0!==i)}postRemoveComment(e,t,i,n){return this.performRFormAction("remove",this.constructFormData(e,t,void 0,i,n),!1)}performRFormAction(e,t,i=!1){const n=s.restFormService.getRFormUrl("widget_comment",e);return i?s.restFormService.post(n,t):s.restFormService.postMultipart(n,t)}constructFormData(e,t,i,s,o){const r=this.getCommentContext(e,s),a={context:r,widget_id:this.constructWidgetIdPath(e.getId(),o),comment:t};if(void 0!==i&&(a.image_attachment=new l.Url(i.dataUrl).getBase64()),void 0!==this.getCustomPageType())a.custom_page_id=e.getPageState().getAllowedPages().getCustomPageId();else if("embedded_widget"===r){const t=e.getPageState()||n.tw.pageState;a.custom_page_id=t.toProto().sub_ids[0]}return a}getCommentContext(e,t){const i=e.getPageState().getAllowedPages();if(t)return"indicators";if(i.isEmbeddedWidget())return"embedded_widget";{const e=this.getCustomPageType();if(void 0!==e)return e.toUpperCase()}}handleCommentRemoval(e,t,i,n){e.findExtendedConfiguration(n).removeComment(t),i||(e.prepareReload(),this.refreshWidgetData(e))}handleCommentUpdate(e,t,i,n,s){e.findExtendedConfiguration(n).addComment(s.comment||t),i||(e.prepareReload(),this.refreshWidgetData(e))}getCommentDisplayMode(e){if(!e.hasMenu()||!e.getMenu().hasCommentDisplayTypeMenu())return;const t=e.getMenu().getCommentDisplayTypeMenu().getFirstSelectedEntryRecursively();return void 0!==t?t.getMappedId():void 0}validateComment(e,t){const i={comment:e,max_character_count:t};return s.restFormService.post(routes.controllers.tw.TWRestForm.post("project",n.tw.project_id,"widget_comment","validate",0,"rform").url,i)}getCustomPageType(){const e=n.tw.pageState.getAllowedPages();return e.isReport()?constants.custom_page.type.report:e.isDashboard()?constants.custom_page.type.dashboard:e.isCommandCenterScreenEditMode()||e.isCommandCenterWidgetPreview()?constants.custom_page.type.command_center_screen:void 0}generateRandomId(){return Math.round(Date.now()*(Math.pow(16,4)-Math.random()*Math.pow(16,4))).toString(16)}removeAllCommentBubbles(){const e=constants.bubble_dialog.id,t=[e.comment_marker,e.comment_info,e.comment_preview];o.bubbleDialogService.find(e=>i.contains(t,e.getType())).forEach(e=>e.destroy())}updateDisplayType(e,t){const i=this.getCommentDisplayMode(t);void 0!==i&&(e.display_type=i)}constructWidgetIdPath(e,t){return i.compact([e,t]).join("/")}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:u.ModelRefreshStrategy.REFRESH},i=h.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),d.ModelType.WIDGET,t);try{return await p.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&c.logService.error("Error when refreshing widget!",void 0,e)}}else c.logService.error("reload attempted on widget without page state, this could be due to a memory leak",g.twCommon.logFeatures.WidgetWrapper)}};m=__decorate([a.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],m),t.default=m,Object.defineProperty(t,"commentsService",{get:function(){return n.tw.inject("commentsService")}})}),define("services/tw_number_formatter",["require","exports","reusable_utilities","other/tw","counter"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{initialize(e,t){this.formatter=i.NumberFormatterFactory.build(e,t),this.lowPrecisionFormatter=new i.DefaultNumberFormatter(e),this.counterFormatter=new s.CounterNumberFormatter(e)}getInstance(){return this.formatter}getLowPrecisionFormatter(){return this.lowPrecisionFormatter}getCounterNumberFormatter(){return this.counterFormatter}},Object.defineProperty(t,"twNumberFormatter",{get:()=>n.tw.inject("twNumberFormatter")})}),define("services/widgets/widget_initializer",["require","exports","log","other/tw","services/tw_common","classes/context_data/context_data","services/presentation_service","classes/application/application","services/application_mode"],function(e,t,i,n,s,o,r,a,c){var l;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PAGE_BY_PAGE=0]="PAGE_BY_PAGE",e[e.ONE_BY_ONE=1]="ONE_BY_ONE",e[e.INSTANT=2]="INSTANT"}(l=t.WidgetInitializationStrategy||(t.WidgetInitializationStrategy={}));class d{constructor(){this.frame=0}update(){this.frame++,this.checkWidgetsToInitialize()}expediteGridPage(e,t=n.tw.pageState){this.loadWidgetsInGridPage(e,t)}checkWidgetsToInitialize(){switch(this.getWidgetInitializationStrategy()){case l.ONE_BY_ONE:this.initializeNextWidget();break;case l.INSTANT:this.initializeAllWidgets();break;case l.PAGE_BY_PAGE:this.initializeAllWidgetsByPage();break;default:throw new Error("Not implemented")}}getWidgetInitializationStrategy(){return(n.tw.pageState.getAllowedPages().isInstantDiscovery()||n.tw.pageState.getAllowedPages().isSearch()||n.tw.pageState.getAllowedPages().isReport()||n.tw.pageState.getAllowedPages().isDashboard()&&n.tw.pageState.isEditMode())&&n.tw.pageState.hasPageConfiguration()?l.INSTANT:l.ONE_BY_ONE}shouldLoadWidgetInstant(e){return!e.isFailedVisualization()&&!e.isVisualizationInitialized()&&e.isReadyToBeVisualized()&&!e.isReloading()}shouldLoadWidget(e){return this.shouldLoadWidgetInstant(e)&&(e.isOnScreen(.15,80)||e.getSection().hasAnyVisualizedWidget())}initializeNextWidget(){const e=this.getNextWidgetToLoad(e=>this.shouldLoadWidget(e));void 0!==e&&this.loadWidget(e)}initializeAllWidgetsByPage(){if(this.frame%4==0){const e=this.getAllWidgetsToLoad(e=>this.shouldLoadWidget(e));if(e.length>0){const t=e[0].getSlotConfiguration().page;this.loadWidgetsInGridPage(t,e[0].getPageState())}}}loadWidgetsInGridPage(e,t){t.getWidgets().filter(t=>(t.getSlotConfiguration()||{}).page===e&&this.shouldLoadWidget(t)).forEach(e=>this.loadWidget(e))}initializeAllWidgets(){this.getAllWidgetsToLoad(e=>this.shouldLoadWidgetInstant(e)).forEach(e=>this.loadWidget(e))}loadWidget(e){const t=this.getAnimationStrategy();e.setCanBeDrawn(!0);try{e.initializeVisualization({strategy:t,duration:this.getAnimationDuration()})}catch(t){i.logService.error("Unexpected exception happened during widget visualization",s.twCommon.logFeatures.WidgetInitializer,{widget:e,exception:t}),e.setFailedVisualization(!0)}}getAnimationDuration(){return this.canAnimate()?Number(o.contextData.userSettings.animation_strategy.type)===s.twCommon.visualizationInitializationStrategy.INSTANT?0:o.contextData.userSettings.animation_strategy.duration:0}getAnimationStrategy(){return this.canAnimate()?Number(o.contextData.userSettings.animation_strategy.type):0}canAnimate(){return c.applicationMode.getCurrentAppMode()!==c.AppMode.IMAGE_EXPORT&&(r.presentationService.isPresentationEnabled||(!n.tw.pageState.getAllowedPages().isDashboard()||!n.tw.pageState.isEditMode())&&!n.tw.pageState.getAllowedPages().isReport())}getAllWidgetsToLoad(e){const t=a.mainApplication.getPageStates(),i=[];for(const n of t)for(const t of n.getWidgets())e(t)&&i.push(t);return i}getNextWidgetToLoad(e){const t=a.mainApplication.getPageStates();for(const i of t)for(const t of i.getWidgets())if(e(t))return t}areAllWidgetsLoaded(e){return _.all(e.getWidgets(),e=>e.isVisualizationInitialized()||e.isSkeleton())}areAllVisibleWidgetsLoaded(e){return _.all(e.getWidgets(),e=>e.isSkeleton()||e.isVisualizationInitialized()||!e.isOnScreen())}}t.default=d,t.widgetInitializer=new d}),define("services/directive",["require","exports","other/tw","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){n.templateSettings={interpolate:/\{\{(.+?)\}\}/g},this.attributeTemplateFactory=n.template("<div {{directiveName}} {{args}}></div>"),this.elementTemplateFactory=n.template("<{{directiveName}} {{args}}></{{directiveName}}>")}inject(e,t,i,s,o=!1){const r=this.factory(t,i,s,o);return n.isFunction(r.then)?r.then(t=>{e.append(t.template)}):e.append(r.template),r}factory(e,t,s,o=!1){s=s||i.tw.inject("$rootScope").$new(!0);const r=n.uniqueId("$$args");s[r]={},n.each(n.keys(t),(e,i)=>{n.isString(t[e])||(s[r]["arg"+i]=t[e],t[e]=`${r}.arg`+i)});const a=this.parseArgs(t||{});let c;return c=o?this.elementTemplateFactory:this.attributeTemplateFactory,{template:i.tw.inject("$compile")(c({directiveName:e,args:a}))(s),parentScope:s}}parseArgs(e){return Object.keys(e).map(t=>t+"="+e[t]).join(" ")}}t.default=s,t.directiveService=new s}),define("classes/widget/fragment_bases/abstract_legacy_directive_fragment",["require","exports","widget_base","log","services/tw_common","services/directive"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractLegacyDirectiveFragment=class{constructor(e){this.model=e,n.logService.debug(`created abstract legacy directive fragment of type ${this.directiveName()} with widget type ${e.widget.getType()}`,s.twCommon.logFeatures.Widget,e)}get additionalDirectiveArgs(){return{}}async initialize(e,t,r,a){const c=document.createElement("div");e.appendChild(c),this.model.widget.onDispose.subscribeOnce(()=>this.dispose());const l=$.Deferred();this.initializeFuture=l,this.cancellationToken=a;const{template:d,parentScope:g}=o.directiveService.inject($(c),this.directiveName(),_.assign({widget:this.model.widget,fullscreen:!1,fragment:this,"draw-settings":r,mediator:t},this.additionalDirectiveArgs),void 0,!0);return n.logService.debug(`Directive injected ${this.directiveName}`,s.twCommon.logFeatures.WidgetInitializer,{fragment:this,chartContainer:e,mediator:t,settings:r}),this.scope=g,this.template=d,setTimeout(()=>{if(this.model.widget.isDisposed())this.dispose(),l.reject(this);else if($(c.children[0]).unwrap(),this.applyFontClasses())switch(r.style.fontSize){case i.FontSize.SMALL:break;case i.FontSize.MEDIUM:this.template.children().first().addClass("fontsize-medium");break;case i.FontSize.LARGE:this.template.children().first().addClass("fontsize-large");break;default:throw new Error("unknown font size")}}),l.promise()}async update(e){return Promise.resolve(this)}async draw(e){e.heightMode!==i.WidgetHeightMode.LEGACY?(this.rootElement.css({position:"absolute",top:e.dimensions.y,left:e.dimensions.x}),this.rootElement.css({height:e.dimensions.height})):this.rootElement.css({"min-height":e.dimensions.height}),this.rootElement.css({width:e.dimensions.width});const t=this.chartController.redrawWidget(e);if(this.scope&&this.scope.$root&&!this.scope.$root.$$phase&&this.scope.$apply(),t&&t.then)return t.then(()=>this);n.logService.error(`widget ${this.model.widget.getType()}'s draw function does not return a promise exports will not work`)}applyFontClasses(){return!1}dispose(){this.scope&&this.scope.$destroy(),this.template&&this.template.remove()}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:e.dimensions.height||0}}attach(e,t){this.chartController=e,this.rootElement=t,this.initializeFuture.resolve(this)}}}),define("classes/widget/fragments/legacy_directive/bar_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.BarChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-bars"}}}),define("classes/bubble_dialog/widget_dialog_config",["require","exports","components/tools/data_graph","underscore","services/configuration"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.WidgetDialogConfig=class{constructor(e,t={}){this.pageState=e,this.style=s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.widget),this.style.setAbsoluteY(window.pageYOffset+50),this.dataSource="PAGE_STATE",this.groupPage="CONTEXT_MENU",this.showCompareBar=!0,this.showDrilldown=!0,this.pageType=constants.page_type.context_menu_default,this.targetElement=$("#page_content"),this.displayFullSizeWidget=!1,this.forbidExpand=!1,this.reloadWidget=!0,this.removeCustomPageId=!0,this.setAllowedPagesReloadFlag=!1,n.assign(this,t)}getPageState(){return this.pageState}getWidgetToSend(){return this.widgetToSend}getUfs(){return this.ufs}getMode(){return this.mode}getDataSource(){return this.dataSource}getShowDrilldown(){return this.showDrilldown}getShowCompareBar(){return this.showCompareBar}getStyle(){return this.style}getTargetElement(){return this.targetElement}setStyle(e){return this.style=e,this}getFilters(){return this.filters}setFilters(e){return n.isString(e)&&(e=[i.default.constructor.parseFilters(e)]),this.filters=e,this}getPageType(){return this.pageType}setPageType(e){return this.pageType=e,this}getGroupPage(){return this.groupPage}setGroupPage(e){return this.groupPage=e,this}setTargetElement(e){return this.targetElement=e,this}setWidgetToSend(e){return this.widgetToSend=e,this}setUfs(e){return this.ufs=e,this}setMode(e){return this.mode=e,this}setDataSource(e){return this.dataSource=e,this}setShowDrilldown(e){return this.showDrilldown=e,this}setShowCompareBar(e){return this.showCompareBar=e,this}isDisplayFullSizeWidget(){return this.displayFullSizeWidget}setDisplayFullSizeWidget(e){this.displayFullSizeWidget=e}getReuseActiveBubbleIfAble(){return this.reuseBubble||!1}setReuseActiveBubbleIfAble(e){return this.reuseBubble=e,this}setForbidExpand(e){return this.forbidExpand=e,this}getForbidExpand(){return this.forbidExpand||!1}getReloadWidget(){return this.reloadWidget}getRemoveCustomPageId(){return this.removeCustomPageId}shouldSetAllowedPagesReloadFlag(){return this.setAllowedPagesReloadFlag}}}),define("classes/navigation/nav_params",["require","exports","underscore","log","services/tw_common"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(){this.refreshAll=!0}setFilters(e){n.logService.assertDefined(e,s.twCommon.logFeatures.NavigationParams),this.filters=e}getFilters(){return n.logService.assertDefined(this.filters,s.twCommon.logFeatures.NavigationParams),this.filters}hasFilters(){return void 0!==this.filters&&this.filters.length>0}setWidget(e){n.logService.assert(void 0!==e.toProto,"Widget must be wrapped",s.twCommon.logFeatures.NavigationParams),n.logService.assertDefined(e,s.twCommon.logFeatures.NavigationParams),this.widget=e}getWidget(){return n.logService.assertDefined(this.widget,s.twCommon.logFeatures.NavigationParams),this.widget}setClickTarget(e){n.logService.assertDefined(e,s.twCommon.logFeatures.NavigationParams),this.clickTarget=e}getClickTarget(){return n.logService.assertDefined(this.clickTarget,s.twCommon.logFeatures.NavigationParams),this.clickTarget}setWidgetToSend(e){this.widgetToSend=e}getWidgetToSend(){return this.widgetToSend}addTopicMenuFilter(e){i.isUndefined(this.tmFiltersToAdd)&&(this.tmFiltersToAdd=[]),this.tmFiltersToAdd.push(JSON.parse(JSON.stringify(e)))}getTopicMenuFiltersToAdd(){return i.isUndefined(this.tmFiltersToAdd)?[]:this.tmFiltersToAdd}setRefreshAll(e){this.refreshAll=e}isRefreshAll(){return this.refreshAll}}t.NavigationParams=o,t.default=i.constant(o)}),define("react_components/comment_info/comment_actions",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CommentActions={comment_onOpenModal:"comment_onOpenModal",comment_onAddComment:"comment_onAddComment",comment_onUpdateComment:"comment_onUpdateComment",comment_onRemoveComment:"comment_onRemoveComment",comment_onSubmitChanges:"comment_onSubmitChanges",comment_onTogglePin:"comment_onTogglePin"}}),define("services/navigation",["require","exports","angular_utilities","flux","jquery","log","classes/application/application","classes/bubble_dialog/widget_dialog_config","classes/context_data/context_data","classes/navigation/nav_params","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","react_components/comment_info/comment_actions","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","services/application_mode","services/bubble_dialog","services/configuration","services/context","services/modal","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","services/tw_routing"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T){Object.defineProperty(t,"__esModule",{value:!0});let M=class{constructor(e){this.topicService=e,f.applicationMode.getCurrentAppMode()===f.AppMode.HOOTSUITE_DASHBOARD&&(window.parent.postMessage({type:"REQUEST_SESSION_ID",payload:{}},"*"),window.addEventListener("message",e=>{"SESSION_ID"===e.data.type&&(this.hootsuiteSessionId=e.data.payload.sessionId)}))}moveToDisplayPage(e,t){this.moveToDisplayPageByMappedId(e.getMappedId(),t)}moveToDisplayPageByMappedId(e,t){void 0===t?this.performMove(e):this.validateMove(e,t)}performMove(e){const t=r.mainApplication.getPageState().getAllowedPages();t.selectPageByMappedId(e),t.setReload(!0),this.refreshPageData("Error when refreshing page state after moving to other display page !")}validateMove(e,t){const i={page_type:e,page_category:r.mainApplication.getPageState().getAllowedPages().getPageCategory()},n=routes.controllers.tw.TWRestForm.post(S.contextService.getCurrentContext().scope,S.contextService.getCurrentContext().id,t,"validate","","rform").url;C.restFormService.post(n,i).then(t=>{t.is_page_validate&&this.performMove(e)})}openDrilldownWithPayload(e){this.handleOpenDrilldown(e)}openDrilldown(e,t,i,n,s,o,r,a){this.handleOpenDrilldown({filters:e,popup:t,requestedPageType:i,element:n,widget:s,closeBubbleHandler:o,showDrilldown:r,fadeBackground:a})}handleOpenDrilldown(e){const{filters:i,popup:n,requestedPageType:s,element:o,widget:r,closeBubbleHandler:a,showDrilldown:c,fadeBackground:d}=e;void 0!==n&&n.close();const g=new l.NavigationParams;let u;g.setFilters(i),void 0!==r&&g.setWidget(r),void 0!==o&&g.setClickTarget(o),void 0!==(u=void 0!==s?t.navigationService.clickHandler(g,o,s,void 0,void 0,c,d):t.navigationService.clickHandler(g,o))&&void 0!==a&&u.onDestroy.subscribeOnce(a)}datagraphClick(e,t,i,n,s,o){let r=o||[];if(void 0===e.getColumns()[n]||!0!==e.getColumns()[n].drilldown_disabled&&!0!==e.getRows()[i].drilldown_disabled){r=r.concat(e.getRowFilters(i)),void 0!==n&&(r=(r=r.concat(e.getColumnFilters(n))).concat(e.getCellFilters(i,n))),r=r.filter(function(e){return""!==e.key});const o=new l.NavigationParams;o.setFilters([r]),o.setWidget(t),o.setClickTarget(s),this.clickHandler(o,s,e.getRequestPageType(i,n))}else;}extractColumnBasedFilters(e,t,i,n){return n=(n=n.concat(e.getColumnFilters(t))).concat(e.getCellFilters(i,t)),n=this.filterEmptyKeys(n)}filterEmptyKeys(e){return e.filter(function(e){return""!==e.key})}selectTopic(e,t,i="SINGLE"){const n=r.mainApplication.getPageState().getUserFilterSettings();this.topicService.selectTopicEntry(e,t,n.getTopics().map(function(e){return e.toProto()}),i)}toggleDeletedMode(e){const t=r.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.deleted_results_option);if(void 0!==t){const i=t.getRootEntry().getChildren()[0];void 0!==e?e?i.setSelected(!0):i.setSelected(!1):i.toggleSelection(void 0),this.refreshPageData("Error when refreshing page state after toggling delete mode !")}}clickHandlerWithArgs(e,t,i,n,s){const o=new l.NavigationParams;return o.setFilters(e),o.setWidget(t),this.clickHandler(o,i,s,void 0,n)}clickHandler(e,t,i,n,s,r=!0,a=!1){if(o.logService.info("navigationService - clicked",E.twCommon.logFeatures.Navigation),b.modalService.dismissAll(),f.applicationMode.getCurrentAppMode()!==f.AppMode.HOOTSUITE_DASHBOARD){if(!f.applicationMode.isMobile()){return this.normalClickHandling(e,s,i,r,a)}}else this.callHootsuiteApi(e,s,i)}callHootsuiteApi(e,t,i){const n=this.constructClickHandlerPayload(e,t,i),s=this.preparePageStateForHootsuite(n);(async()=>{window.parent.postMessage({type:"WIDGET_ACTION",payload:await C.restFormService.postRForm("hootsuite_api","override",{page_state:s.toProto(),session_id:this.hootsuiteSessionId||"0"})},"*")})()}preparePageStateForHootsuite(e){return e.pageState.clearWidgets(!1),e.ufs.overrideFilters(e.pageState.getUserFilterSettings()),e.ufs.applyDatagraphFilters(e.filters),e.pageState.getUserFilterSettings().replaceFilters(e.ufs),e.pageState}normalClickHandling(e,t,i,n=!0,o=!1){const r=v.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.widget);r.setAbsoluteY(window.pageYOffset+50);const a=this.constructClickHandlerPayload(e,t,i,n),c=y.bubbleDialogService.getFirstBubbleById(constants.bubble_dialog.id.widget);return void 0!==c&&c.isBuilt()?(c.getScope().vm.navigate(a),c):y.bubbleDialogService.createByType(constants.bubble_dialog.id.widget,s("#page_content"),"widget",a,r,{fadeBackground:o})}constructClickHandlerPayload(e,t,i,n=!0){let s=e.getWidgetToSend();void 0!==s&&(s=s.clone()).setConfigurationChanged(!0);const o=new a.WidgetDialogConfig(e.getWidget().getPageState().clone(),{widgetToSend:s,filters:e.getFilters(),groupPage:"CONTEXT_MENU",showDrilldown:n,pageType:i||constants.page_type.context_menu_default,refreshAll:e.isRefreshAll(),ufs:void 0,removeCustomPageId:!1});if(void 0!==t&&e.getWidget().hasNestedDics()){const i=e.getWidget().getNestedDics()[t];i&&(o.ufs=new _.UserFilterSettingsWrapper(i.getDataSource().uf,o.pageState,E.twCommon.holderTypes.WIDGET,!0))}else e.getWidget().hasUf()&&(o.ufs=e.getWidget().getUf().clone());const r=e.getTopicMenuFiltersToAdd();return r.length>0&&r.forEach(e=>{const t=new m.TopicMenuWrapper(e,void 0,o.pageState.getUserFilterSettings());o.pageState.getUserFilterSettings().addMenu(t,!1,!0)}),o}commentClickHandlerWithArgs(e,t,i,n,s,o,r){const a=new l.NavigationParams;a.setFilters(e),a.setWidget(t.clone()),this.commentClickHandler(a,i,n,s,o,r)}commentClickHandler(e,t,i,s,o,r){const a=this.constructClickHandlerPayload(e,r),c=e.getWidget(),l=a.pageState,d=a.ufs,g=a.filters;d&&(d.overrideFilters(l.getUserFilterSettings()),l.replaceUserFilterSettings(d),g&&d.applyDatagraphFilters(g),c.hasUf()||(c.getPrimarySource().tw_data_source.uf=d.toProto())),n.dispatcher.dispatch(h.CommentActions.comment_onOpenModal,{widgetId:c.getId(),rowKey:t,timestamp:i,pageState:l,isIndicator:s,nestedId:o})}goToTrial(e=!1,t){let i=c.contextData.links.getLink("SIGN-UP_TRIAL");void 0!==t&&(i+=t),e?window.open(i,"_blank"):window.location.href=i}goToTrendDiscoverySignup(){window.location.href=c.contextData.links.getLink("SIGN-UP_PAID-TREND-DISCOVERY")}loadBookmark(e){const t={view_id:e},i=routes.controllers.tw.TWRestForm.post(S.contextService.getCurrentContext().scope,S.contextService.getCurrentContext().id,"bookmark","new","","rform").url;C.restFormService.post(i,t).then(function(e){T.twRoutingService.changePageById(e.sub_page_id,e.token)})}async refreshPageData(e){const t={strategy:g.ModelRefreshStrategy.REFRESH},i=d.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,u.ModelType.PAGE_STATE,t);try{await w.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&o.logService.error(e,void 0,t)}}};M=__decorate([i.ngInject(["topicService"]),__metadata("design:paramtypes",[Object])],M),t.default=M,Object.defineProperty(t,"navigationService",{get:function(){return p.tw.inject("navigationService")}})}),define("components/form/common/dimensions",["require","exports","angular"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.Dimensions=class{constructor(e,t=60,n=60,s,o=0,r,a=!1,c=!1){let l=20+o;a&&(o=0,l=0),c&&(t=60),this.canvas={height:i.isUndefined(s)?250+o:s+o,width:r?e:constants.widget.max_size/12*e-2*constants.widget.padding},this.bleed={top:10,right:n,bottom:l,left:t},this.graph={top:this.bleed.top,right:this.canvas.width-this.bleed.right,bottom:this.canvas.height-this.bleed.bottom,left:this.bleed.left,totalWidth:this.canvas.width,width:this.canvas.width-this.bleed.right-this.bleed.left,height:this.canvas.height-this.bleed.top-this.bleed.bottom}}}}),define("components/form/common/graph_helper_shared",["require","exports","moment-timezone","underscore","map"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_CHARACTER_WIDTH=8.5,t.MAX_LEGEND_WIDTH_PROPORTION=5/12,t.getLabelMap=function(e,t){const o=i(n(e).first().timestamp).year()!==i(n(e).last().timestamp).year(),r=new s.Map;return e.forEach((e,n)=>(function(e,n,s){e.set(n.code,{name:n.name,key:n.code,label:function(e,t){const n=i(e.timestamp).year();return t&&-1===e.name_formatted_compressed.indexOf(n)?`${e.name_formatted_compressed} ${n}`:e.name_formatted_compressed||e.name}(n,o),cutoff:n.cut_off_type||"none",should_display_point:s%t==0})})(r,e,n)),r},t.getCutoffData=function(e){let t=void 0;return e.values().reduce((e,i,n)=>("none"!==i.cutoff&&(void 0!==t&&n===t+1?e[0].end=i.name:e.splice(0,0,{start:i.name,end:i.name,type:i.cutoff}),t=n),e),[])}}),define("components/form/common/main_axis_data",["require","exports","d3","lazy","components/form/common/graph_helper_shared"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t,n,o){this.columns=e,this.dimensions=t,this.step=n,this.modifiers=o,this.labelMap=s.getLabelMap(this.columns,n),this.maximumAmountOfCharacters=this.getMaximumAmountOfCharacters(),this.scale=i.scale.ordinal().domain(this.labelMap.values().map(e=>e.key)),this.axis=i.svg.axis().scale(this.scale).tickValues(this.getTickValues()).tickFormat(this.tickFormatter()),o.isComposedGraph?(this.scale.rangeBands([t.graph.left,t.graph.right]),this.axis.orient("bottom")):o.isLineChart?(this.scale.rangePoints([t.graph.left,t.graph.right]),this.axis.orient("bottom")):o.isHorizontal?(this.scale.rangeBands([t.graph.top,t.graph.bottom]),this.axis.orient("left")):(this.scale.rangeBands([t.graph.left,t.graph.right]),this.axis.orient("bottom")),this.cutoffs=s.getCutoffData(this.labelMap)}getMaximumAmountOfCharacters(){return((!0===this.modifiers.isHorizontal||!0===this.modifiers.isLineChart?this.dimensions.graph.totalWidth*s.MAX_LEGEND_WIDTH_PROPORTION:90)-o.PADDING)/s.MAX_CHARACTER_WIDTH}getTickValues(){return n(this.columns).filter((...e)=>{return e[1]%this.step==0}).pluck("code").toArray()}tickFormatter(){return e=>{let t=this.labelMap.get(e).label;return t=t.length>this.maximumAmountOfCharacters?`${t.substring(0,this.maximumAmountOfCharacters-1)}…`:t}}}o.PADDING=25,t.MainAxisData=o}),define("components/bars/directive",["require","exports","angular","canvas_chart_utilities","components/form/common/graph_helper","components/tools/data_graph","d3","lazy","reusable_utilities","widget_base","other/tw","services/bubble_dialog","services/configuration","services/navigation","services/widgets/widget_initializer","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;const _=150;function f(){return e.$inject=["$element","$scope","$timeout"],{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"="},controller:e,templateUrl:m.templateSourceFactory("components/bars")};function e(e,t,m){let f,y,v,S;t.mediator.listen(l.REPLAY_ACTIONS.PROGRESS,()=>{t.currentReplayStep!==t.widget.replayManager.frameIndex&&(t.currentReplayStep=t.widget.replayManager.frameIndex,F(t.drawSettings))});let b=null;const w={};function C(e){return!1===e.interpolated}function E(e){return C(e.column)}function T(e){return e.items=a(e.items).filter(E).toArray(),e}let M,P,D;function A(e){void 0===P?s.transitionStyle(e.selectAll("rect.bar"),"opacity",1,300):e.selectAll("rect.bar").each(function(e){e.popoverData.node.rowCode===P?s.transitionStyle(this,"opacity",1,300):s.transitionStyle(this,"opacity",.2,300)})}function I(){return"STACK_PERCENT"===t.dic.configuration_rendering.bar_chart.stacking_mode}function x(e){e.each(function(){const e=s.getSelection(this);e.style("pointer-events",""),I()?s.transitionStyle(this,"opacity",1,300):s.showElement(e)})}function R(e){void 0!==M&&M.cancel(),M=new c.CancellationToken,t.mediator.listen(n.LegendFragmentActions.LEGEND_MOUSEENTER,t=>{P=t,A(e)},{token:M}).listen(n.LegendFragmentActions.LEGEND_MOUSELEAVE,t=>{P===t&&(P=void 0),A(e)},{token:M}).listen(n.LegendFragmentActions.LEGEND_MOUSECLICK,t=>{D===t?(x(e.selectAll("text.overlay, rect.bar")),D=void 0):(D=t,e.selectAll("text.overlay, rect.bar").each(function(e){e.popoverData.node.rowCode===D?x(s.getSelection(this)):function(e){e.each(function(){const e=s.getSelection(this);e.style("pointer-events","none"),I()?s.transitionStyle(this,"opacity",.2,300):s.hideElement(e)})}(s.getSelection(this))}))},{token:M})}function F(c){let m,E;P=void 0,D=void 0,y=c,t.drawSettings=y,t.payload=function(){let e=t.widget.getPayloadValue();return t.widget.hasTreePayloadType()&&(e={data_graph:e.chart_data_graph}),e}(),b=t.widget.hasReplayManager()?function(){const e=a(t.payload.data_graph.additional_frames).pluck("rows").toArray();let i;i="STACK"===t.dic.configuration_rendering.bar_chart.stacking_mode?a(e).map(function(e){return a(e).pluck("cells").flatten().map(n).groupBy("index").values().map(s).toArray()}).flatten().toArray():a(e).flatten().pluck("cells").flatten().pluck("value").pluck("numeric_data").map(Number).toArray();return{x:{min:0,max:r.max(i)}};function n(e,i){return{index:i%t.payload.data_graph.column_groups.length,cell:e}}function s(e){return a(e).pluck("cell").pluck("value").pluck("numeric_data").map(Number).sum()}}():null,t.conf=t.dic.primary_source,t.orientation=t.dic.configuration_rendering.bar_chart.orientation_mode,t.stacking=t.dic.configuration_rendering.bar_chart.stacking_mode,i.isDefined(t.conf)&&(m=t.conf.tw_data_source,i.isDefined(m)&&(E=m.x_axis));const M=t.widget.hasExtendedConfiguration()&&t.widget.getExtendedConfiguration().hasYAxisConfiguration(),A=t.widget.hasExtendedConfiguration()&&t.widget.getExtendedConfiguration().hasXAxisConfiguration(),I=M&&t.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisType()===constants.axis_type.truncate_min_max,x=M&&t.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisType()===constants.axis_type.logarithmic,F=A&&t.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels(),O=M&&t.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels(),N=i.isDefined(m)&&m.adaptive_legend||!1,L="NONE_PERCENT"===t.stacking||"STACK_PERCENT"===t.stacking,B=i.isUndefined(E)||i.isUndefined(E)?"ordinal":E.time_interval||"ordinal",W={isAdaptiveLegend:N,isBarChart:!0,isHorizontal:"HORIZONTAL"===t.orientation,isInPercent:L,isTranslated:t.widget.isTranslateAll(),logarithmicScale:x,stacking:t.stacking,timeInterval:B,truncateScale:I,integerTicks:!t.widget.isXAxisMajorTickDecimal()&&"HORIZONTAL"===t.orientation},U=new o.default(function(){if(!t.init&&t.widget.hasReplayManager()&&k()>=0){const e=t.dic.primary_source.tw_data_source;if(i.isUndefined(e.x_axis)||!0!==e.x_axis.use_time)return t.payload.data_graph.additional_frames[k()]}return t.payload.data_graph}());t.isSampleData=U.sample_data||!1;const G=a(U.getColumns()).filter(C).toArray(),$=U.getEvents(),j=U.getRows();"HORIZONTAL"===t.orientation&&1===y.heightMode&&(t.displaceLabels=15*G.length>y.dimensions.height),"VERTICAL"!==t.orientation&&c.heightMode===l.WidgetHeightMode.LEGACY?c.dimensions.height="NONE"===t.stacking||"NONE_PERCENT"===t.stacking?G.length*(10+15*j.length)+60:25*G.length+60:"VERTICAL"===t.orientation&&c.heightMode===l.WidgetHeightMode.LEGACY&&(c.dimensions.height=Math.max(250,c.dimensions.height)),S=ee(c,F);const H="HORIZONTAL"===t.orientation||"ordinal"===W.timeInterval?1:s.getStep(G.length,W.timeInterval,t.widget.getWidth()),q=a(U.extractData()).map(T).toArray(),V=a(G).filter(e=>i.isUndefined(e.cut_off_type)).map(function(e){return q.map(function(t){return t.items.filter(function(t){return e.code===t.column.code})[0]}).filter(i.isDefined)}).toArray();let z;switch(t.stacking){case"NONE_PERCENT":let e=0,i=0;a(V).each(t=>{e=Math.max(e,t.reduce((e,t)=>(void 0!==t.value.value&&(e=Math.max(e,t.value.value)),i+=t.value.value,e),0))});const n=e/i*100;z=n<=10?[0,Math.ceil(n)]:[0,10*Math.ceil(n/10)];break;case"NONE":z=null!==b&&!1===t.init&&"ordinal"===W.timeInterval?[b.x.min,b.x.max]:a(q).pluck("extent").flatten().toArray();break;case"STACK":z=null!==b&&!1===t.init&&"ordinal"===W.timeInterval?[b.x.min,b.x.max]:a(V).map(e=>a(e).pluck("value").pluck("value").sum()).toArray();break;case"STACK_PERCENT":z=[0,100];break;default:throw new Error("invalid stacking mode")}const Y=d.tw.project_id;let X,K;t.series=s.update_legend(q,W),"HORIZONTAL"===t.orientation?function(e){X=new s.getMainAxisData(G,S,H,W),S=new s.Dimensions(e.dimensions.width,s.getAxisLegendWidthFromVirtualNode(X,"tick",t.getFontSize(e),S)*(t.displaceLabels?2:1),30,e.dimensions.height,0,!0,F,O),K=new s.getSecondaryAxisData(z,S,e.dimensions.width,"left",W);const i=s.getMaxTickWidth(K.axis.tickValues(),K.axis.tickFormat(),"tick",t.getFontSize(e))+2*K.axis.tickPadding()+10,n=Math.max(2,Math.floor(e.dimensions.width/i)-2);K.axis.tickValues().length>n&&(K=new s.getSecondaryAxisData(z,S,e.dimensions.width,"left",W,n))}(c):"ordinal"===W.timeInterval?function(e){S=new s.Dimensions(e.dimensions.width,60,30,e.dimensions.height-50,50,!0,F,O),K=new s.getSecondaryAxisData(z,S,t.widget.getWidth(),"left",W),S=new s.Dimensions(e.dimensions.width,60,30,e.dimensions.height-50,50,!0,F,O),X=new s.getMainAxisData(G,S,H,W)}(c):function(e){K=new s.getSecondaryAxisData(z,S,t.widget.getWidth(),"left",W),S=new s.Dimensions(e.dimensions.width,60,30,e.dimensions.height,0,!0,F,O),X=new s.getMainAxisData(G,S,H,W)}(c),function(){const e=ee(c,F),t={width:Math.max(0,e.canvas.width),height:Math.max(0,e.canvas.height)};v.attr(t)}();const Q=function(e,i,n,o,r,a){const c="HORIZONTAL"===t.orientation?"HorizontalBars":"VerticalBars";return{bars:new s[c](e,i,n,r,o,t.widget.getDataGraph().total_label,a)}}(V,X,K,S,t.stacking,W);"HORIZONTAL"===t.orientation?function(){let e=X.labelMap.entries().map(e=>e[0]+e[1]&&e[1].name).concat([i.toJson(K.limits),W.stacking]).concat([a(S.canvas).toArray().join("-")]).join("-");w.x===e||F||(s.drawXGrid(f.grid,K,S),w.x=e);e=X.labelMap.entries().map(e=>e[0]+e[1]&&e[1].name).concat([a(S.canvas).toArray().join("-")]).concat([W.stacking]).join("-"),w.y!==e&&(s.drawYGrid(f.grid,X,S,!0,t.displaceLabels,!0,O),w.y=e);s.drawBaseline(f.grid,K.scale,S,"VERTICAL",W)}():function(){let e=X.labelMap.entries().map(e=>e[0]+e[1]&&e[1].name).concat([a(S.canvas).toArray().join("-")]).concat([W.stacking]).join("-");w.x===e||F||(s.drawXGrid(f.grid,X,S,"ordinal"===W.timeInterval),w.x=e);e=X.labelMap.entries().map(e=>e[0]+e[1]&&e[1].name).concat([i.toJson(K.limits),W.stacking]).concat([a(S.canvas).toArray().join("-")]).join("-"),w.y!==e&&(s.drawYGrid(f.grid,K,S,!1,!1,!1,O),w.y=e);s.drawBaseline(f.grid,K.scale,S,void 0,W)}(),s.drawNewDaySeparators(f.grid,G,X,S,W),s.drawEvents(f.grid,$,G,X,S,W),Q.bubbleDialogService=g.bubbleDialogService,Q.configurationService=u.configurationService,Q.orientation=t.orientation;const J=Number(!0===W.logarithmicScale);if(Q.scaledBottom=K.scale(J),"ordinal"!==W.timeInterval&&t.widget.hasReplayManager()&&0!==t.widget.replayManager.progress){const e=Math.round(t.widget.replayManager.progress*G.length),i=a(G).slice(0,e).pluck("code").toArray();Q.bars=a(Q.bars).map(function(e,t){return a(t).filter(function(t){return a(e).contains(t.reference.column.name)}).toArray()}.bind({},i)).toArray()}let Z;function ee(e,t=!0){return new s.Dimensions(e.dimensions.width,void 0,void 0,e.dimensions.height,0,!0,t)}return Z=t.widget.hasReplayManager()?function(){const e=t.dic.primary_source.tw_data_source;return void 0!==e&&void 0!==e.x_axis&&e.x_axis.use_time}()?_:t.widget.replayManager.duration/(t.widget.replayManager.numberOfSteps-1):i.isDefined(t.animation)?t.animation.model.duration:h.widgetInitializer.getAnimationDuration(),s.drawBars(f.bars,Q,function(i){!window.isExport&&t.widget.isClickable()&&s.barClick(i,p.navigationService,t.widget,t.widget.isClickable(),e)},t.widget.isClickable(),Z,(e,i)=>{t.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSEENTER,i.popoverData.node.rowCode)},(e,i)=>{t.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSELEAVE,i.popoverData.node.rowCode)}),R(f.bars),f.bars.selectAll("rect.bar").style("opacity",1).style("pointer-events",""),t.widget.getPageState().getAllowedPages().isCommandCenterScreen()||s.drawCutoffs(f.cutoffs,Q,X,S,"HORIZONTAL"===t.orientation,Y),t.widget.setFullyLoaded(!0),Promise.resolve()}function O(e,t){return e[t]=v.append("g").classed(t,!0),e}function k(){return t.widget.hasReplayManager()?t.widget.replayManager.frameIndex:null}Object.defineProperties(t,{dic:{get:function(){return this.widget.getDic()}}}),t.displaceLabels=!1,t.showTicks=!0,t.getFontSize=function(e=y){if(void 0===y||t.displaceLabels)return"font-size-normal";switch(e.style.fontSize){case l.FontSize.SMALL:return"font-size-normal";case l.FontSize.MEDIUM:return"font-size-medium";case l.FontSize.LARGE:return"font-size-large";case l.FontSize.EXTRA_LARGE:return"font-size-extra-large"}},t.getClass=function(){return[t.getFontSize(),t.showTicks?"":"hide_ticks","HORIZONTAL"===t.orientation?"horizontal":"vertical"].join(" ")},t.fragment.attach(t,e),t.loaded=!1,t.redrawWidget=F,t.$on("$destroy",function(){m.cancel(t.promise)}),v=r.select(e[0]).append("svg").classed("chart",!0),(f=a(["grid","bars","cutoffs","labels"]).reduce(O,{})).grid.append("g").classed({axis:!0,"x-axis":!0}),f.grid.append("g").classed({axis:!0,"y-axis":!0,left:!0}),f.grid.append("g").classed({axis:!0,baseline:!0}).append("line")}}t.BarsDirective=f}),define("components/form/common/popover-data",["require","exports","angular","services/tw_number_formatter","data_structures","classes/context_data/context_data"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.PopoverData=class{constructor(e,t,r,a,c){this.commentInfo=r,void 0!==e.popover?this.header=e.popover.title:this.header=e.column.data_type===constants.data_graph.value_type.datetime?e.column.name_formatted_full+(e.column.name_formatted_time?" ("+e.column.name_formatted_time+")":""):null,i.isDefined(e.value.percent)&&(this.corner=n.twNumberFormatter.getInstance().toPercentage(parseFloat(e.value.percent)/100)),this.node={color:e.row.color,label:Boolean(c)&&e.row.translated_label?e.row.translated_label:e.row.label,rowCode:e.row.code,columnCode:e.column.code},i.isDefined(r)&&(this.commentInfo=r);const l=e.value.value;let d,g;void 0!==e.popover?(g=e.popover.value,d=e.popover.label):(g=(a?n.twNumberFormatter.getInstance().toPercentage(l):void 0)||e.value.formatted_value||l,d=void 0!==t&&t.trim().length>0?t:e.popover&&e.popover.label||o.contextData.getMessage("_281677"));const u=e.value.value_old;this.values=[{label:d,value:g,tendency:u>0?new s.Tendency(l,e.value.value_old).build():void 0}],void 0!==e.additional_metric&&this.values.push({label:e.additional_metric.label,value:e.additional_metric.formatted_value})}}}),define("components/form/common/point",["require","exports","components/form/common/popover-data"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.Point=class{constructor(e,t,n,s,o,r){this.reference=e,this.modifiers=s,this.label=o,this.commentInfo=r,!0===s.isComposedGraph?this.x=t.scale.rangeBand()/2+t.scale(e.column.name):this.x=t.scale(e.column.name),!0===s.logarithmicScale&&1===e.value.value?this.y=n.scale(1.1):this.y=n.scale(e.value.value),this.popoverData=new i.PopoverData(e,o,r,s.isInPercent,s.isTranslated)}get color(){return this.reference.row.color}set color(e){throw new Error("color cannot be set")}}}),define("components/form/common/graph_helper",["require","exports","angular","components/tools/data_graph","d3","data_structures","lazy","log","math_utils","reusable_utilities","underscore","classes/context_data/context_data","services/bubble_dialog","services/comments","services/theme","services/tw_common","services/tw_number_formatter","services/widgets/widget_initializer","components/form/common/dimensions","components/form/common/graph_helper_shared","components/form/common/main_axis_data","components/form/common/point","components/form/common/popover-data"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w){const C=Object.freeze({intervals:["sec1","min1","min5","min15","h1","h3","h6"]}),E={fillOpacity:1,strokeOpacity:0,strokeDashArray:!1},T={fillOpacity:1,strokeOpacity:0,strokeDashArray:!1};function M(e){return e instanceof s.selection?e:s.select(e)}function P(e,t,i,n=500){M(e).filter(function(){return s.select(this).style(t)!==i.toString()}).transition().duration(n).style(t,i)}function D(e,t){return s.svg.area().x(d.property("x")).y0(e).y1(d.property("y"))(t)}function A(e,t){return s.svg.line().x(d.property("x")).y(d.property("y"))(t)}function I(e,t,n){let o;this.oldData=this.oldData||[];const a=n?G(e.points,e.scaledBottom):r(e.points).map(e=>r(e).pick(["x","y"]).toObject()).toArray();this.oldData.length<e.points.length?l(this.oldData,a):this.oldData.length>e.points.length&&(o=i.copy(a),l(a,this.oldData));const c=s.interpolateArray(this.oldData,a);return this.oldData=o||a,function(i){return t(e.scaledBottom,c(i))};function l(e,t){r.range(t.length-e.length).map(function(i){return Math.floor(i*e.length/t.length)}).reverse().each(function(t){e.splice(t,0,e[t])})}}function x(e,t){if(!t||!t.comments)return;const i=t.comments,n=e.row.code,s=e.column.code&&parseInt(e.column.code,10),o=d.filter(i,function(e){return e.row_key===n&&e.timestamp===s});return{comments:o,widgetId:t.widgetId,actions:J(e,e.reference,t.options),displayType:function(e){const t=constants.comments.display_type;return d.reduce(e,function(e,i){const n=i.display_type;return e===t.always_open||n===t.always_open?t.always_open:e===t.show_all_comments||n===t.show_all_comments?t.show_all_comments:e===t.show_as_footnote&&n===t.show_as_footnote?n:t.show_on_hover},t.show_as_footnote)}(o),onClick:t.onClick.bind(this,e),marker:o[0]&&o[0].marker}}function R(e){return e.value.value}function F(e){return e.isCrossingZero?0:e.limits.min<0?e.limits.max:e.limits.min}class O{constructor(e,t,i,n,s,o){this.reference=e;const r=e.column.code;switch(this.color=e.row.color,this.style=n.style||E,this.x=i.main.scale(r)+n.spacing/2,this.width=n.stackedWidth,n.stackMode){case"NONE_PERCENT":if(this.x+=s*t.unstackedWidth,this.width=t.unstackedWidth,0!==t.total){t.maxValue>1?e.value.percent=100*R(e)/t.total:e.value.percent=R(e)/t.total;const i=e.value.percent/t.maxPercentage;this.height=(o.graph.bottom-o.graph.top)*i,this.y=o.graph.bottom-this.height}else this.y=0,this.height=0;this.height<=0&&(this.y--,this.height=1);break;case"NONE":e.value.percent=void 0;const a=R(e);this.x+=s*t.unstackedWidth,this.width=t.unstackedWidth,this.height=n.offsetToMinimum-i.secondary.scale(a),R(e)<0?(this.y=n.offsetToMinimum,this.height=-this.height):this.y=i.secondary.scale(a)-t.offsetY,this.height<=0&&(this.y--,this.height=1);break;case"STACK_PERCENT":0!==t.total?(e.value.percent=100*R(e)/t.total,this.y=i.secondary.scale(e.value.percent)-t.offsetY,this.height=o.graph.bottom-i.secondary.scale(e.value.percent)):(this.y=0,this.height=0),t.offsetY+=this.height;break;case"STACK":e.value.percent=void 0,0!==t.total?(this.y=i.secondary.scale(R(e))-t.offsetY,this.height=o.graph.bottom-i.secondary.scale(R(e))):(this.y=0,this.height=0),t.offsetY+=this.height;break;default:throw new Error("invalid stacking mode")}this.popoverData=new w.PopoverData(e,n.label,n.isInPercent,n.isTranslated)}}class k{constructor(e,t,i,n,s,o){this.reference=e,this.color=e.row.color,this.style=n.style||E,this.config=n;const r=e.column.code;switch(this.y=i.main.scale(r)+n.spacing/2,this.height=n.stackedHeight,n.stackMode){case"NONE_PERCENT":if(this.y+=s*t.unstackedHeight,this.height=t.unstackedHeight,0!==t.total){t.maxValue>1?e.value.percent=100*R(e)/t.total:e.value.percent=R(e)/t.total;const i=e.value.percent/t.maxPercentage;this.width=(o.graph.right-o.graph.left)*i,this.x=o.graph.left}else this.x=0,this.width=0;0===this.width&&(this.x--,this.width=1);break;case"NONE":e.value.percent=void 0;const a=R(e);this.y+=s*t.unstackedHeight,this.height=t.unstackedHeight,R(e)<0?(this.x=i.secondary.scale(a),this.width=t.offsetX-i.secondary.scale(a)+n.offsetToMinimum):(this.x=t.offsetX+n.offsetToMinimum,this.width=t.offsetX+i.secondary.scale(a)-n.offsetToMinimum),this.width=0===this.width?1:this.width;break;case"STACK_PERCENT":this.x=t.offsetX+o.bleed.left,0===t.total?this.width=0:(e.value.percent=100*R(e)/t.total,this.width=i.secondary.scale(e.value.percent)-o.graph.left),t.offsetX+=this.width;break;case"STACK":e.value.percent=void 0,0===t.total?this.width=0:(this.x=t.offsetX+o.bleed.left,this.width=i.secondary.scale(R(e))-o.graph.left),t.offsetX+=this.width;break;default:throw new Error("invalid stacking mode")}this.popoverData=new w.PopoverData(e,n.label,n.isInPercent,n.isTranslated)}}function N(e){if(e<1)return Math.ceil(10*e)/10;let t=d.isArray(e)?Math.ceil(s.max(e)):e;const i=t<0;t=Math.abs(t);const n=Math.max(1,Math.floor(Math.log(t)/Math.log(10))),o=Math.pow(10,n)/2;return e%Math.pow(10,n)==0?e:(Math.ceil(t/o)+1)*o*(i?-1:1)}function L(e){return N([Math.ceil(100*s.max(e))])/100}function B(e,t){this.title=e,this.content=t}function W(e,t){return e.indexOf("[0]")<0||e.indexOf("[1]")<0?e:e.replace("[0]",'<a target="_blank" href="'+t+'">').replace("[1]","</a>")}function U(e,t){return e.indexOf("[0]")<0||e.indexOf("[1]")<0?e:e.replace("[0]",'<a href="mailto:'+t+'">').replace("[1]","</a>")}function G(e,t){return e.map(function(e){return{x:e.x,y:t}})}function j(e){const t=e.commentInfo;return!d.isUndefined(t)&&!d.isUndefined(t.comments)&&t.comments.length>0}function H(e){const t=e.commentInfo;return j(e)&&t.displayType===constants.comments.display_type.show_as_footnote&&void 0!==t.marker}function q(e){const t=constants.comments.display_type,i=e.commentInfo;return j(e)&&(i.displayType===t.always_open||i.displayType===t.show_all_comments)}function V(e,t){return{timestamp:d.isString(e)?parseInt(e,10):e,label:t}}function z(e,t,i,n,o,r,a,c){e.select("g.separators."+c).remove();const l=e.append("g").classed("separators",!0).classed(c,!0).selectAll("g.separator").data(t);l.enter().append("g").classed("separator",!0),l.each(function(e){const t=n.scale(e.timestamp)+n.scale.rangeBand()/2;s.select(this).append("line").classed("separator-marker-line",!0).attr(r.isHorizontal?{x1:o.graph.left,x2:o.graph.right,y1:t,y2:t}:{x1:t,x2:t,y1:o.graph.top,y2:o.graph.bottom}),i&&!r.isHorizontal&&s.select(this).append("text").text(e.label).style("text-anchor","end").style("font-size",14*r.fontScale+"px").attr({class:"separator-marker-label",transform:"rotate(-90)",x:-o.graph.top-15,y:a?t+15:t-5})}),l.exit().remove()}function Y(e){this.dispose=!0,this.title=e.title,this.content=U(e.message_branded,g.contextData.projectSettings.branding.contact_email)}function X(e,t,i,n){const s=$(`<div class="tw-bars ${n}">\n        <span style"visibility: hidden; position:absolute;" class="${i}">\n            <text><text>\n        </span>\n      </div>\n    `).appendTo("body"),o=e.map(e=>t(e)).reduce((e,t)=>Math.max(e,s.find("text").html(t).outerWidth()),0);return s.remove(),o}function K(e){return!r([void 0,""]).contains(e)}function Q(e){return r(e).pick(["column","row"]).pluck("drilldown_disabled").some(function(e){return!0===e})}function J(e,t,i){let n=[];return i&&(n=d(i).map(i=>!i.canShow||i.canShow&&i.canShow(e)?function(e,t,i,n,s){return{icon:n,text:i,onClick:()=>{if(s)return s(e,t)}}}(e,t,i.label,i.icon,i.action):void 0).filter(e=>!!e)),n}return{MAX_CHARACTER_WIDTH:v.MAX_CHARACTER_WIDTH,barClick:function(e,t,i,s,o,r){if(s&&!Q(e)){const s=[];K(e.column.filter)&&s.push(n.default.constructor.parseFilters(e.column.filter)),K(e.row.filter)&&s.push(n.default.constructor.parseFilters(e.row.filter)),t.clickHandlerWithArgs(s,i,o,r,e.column?e.column.requested_page_type:void 0)}},miscClick:function(e,t,i,s){const o=[];K(e)&&o.push(n.default.constructor.parseFilters(e)),t.clickHandlerWithArgs(o,i,s)},pointClick:function(e,t,i,s,o,a){if(s&&!Q(e)){const s=r(e).pick(["column","row"]).flatten().pluck("filter").filter(K).map(n.default.constructor.parseFilters);t.clickHandlerWithArgs(s.toArray(),i,o,a,e.column?e.column.requested_page_type:void 0)}},commentClick:function(e,t,i,s,o,r){if(s){const s=[];Q(e)||(K(e.column.filter)&&s.push(n.default.constructor.parseFilters(e.column.filter)),K(e.row.filter)&&s.push(n.default.constructor.parseFilters(e.row.filter)));const a=e.row.code,c=e.column.code&&parseInt(e.column.code,10);t.commentClickHandlerWithArgs(s,i,a,c,o,r)}},triggerEvent:function(e,t){const i=document.createEvent("SVGEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)},showElement:function(e){P(M(e).filter(function(){return"1"!==s.select(this).style("opacity")}),"opacity",1,300)},hideElement:function(e){P(M(e).filter(function(){return"0"!==s.select(this).style("opacity")}),"opacity",0,300)},transitionStyle:P,getSelection:M,custom_max_percent:L,custom_max:N,equalsWithTolerance:function(e,t,i){return Math.abs(e-t)<=Math.pow(10,-1*i)},CutOff:class{constructor(e,t,i,n,s){this.x=e,this.y=t,this.width=i,this.height=n,this.message=s}},DataGraph:n.default,Dimensions:y.Dimensions,HorizontalBars:function(e,t,i,n,s,o,a){const c={main:t,secondary:i},l=d(a).extend({label:o,offsetToMinimum:i.scale(F(i)),spacing:10,stackMode:n});l.stackedHeight=t.scale.rangeBand(),l.spacing>=l.stackedHeight&&(l.spacing=l.stackedHeight/5),l.stackedHeight-=l.spacing;let g=0,u=0;r(e).each(e=>{g=Math.max(g,e.reduce((e,t)=>(void 0!==t.value.value&&(e=Math.max(e,t.value.value)),u+=t.value.value,e),0))});const p="NONE_PERCENT"===l.stackMode?i.extent[1]:0;return r(e).map(function(e){const t={numberOfSeries:e.length,total:"NONE_PERCENT"===l.stackMode?u:r(e).filter(e=>void 0!==e).map(R).sum(),maxValue:N(g),maxPercentage:p,unstackedHeight:l.stackedHeight/e.length,offsetX:.5};return r(e).map((...e)=>{const[i,n]=e;return void 0!==i?new k(i,t,c,l,n,s):void 0}).toArray()}).toArray()},Points:function(e,t,i,n,s,o){return s.isLineChart=s.isLineChart||!1,s.isTranslated=s.isTranslated||!1,r(e).filter(e=>!e.column.interpolated).map(e=>new b.Point(e,t,i,s,n,x(e,o))).toArray()},VerticalBars:function(e,t,i,n,s,o,a){const c={main:t,secondary:i},l=d(a).extend({label:o,offsetToMinimum:i.scale(F(i)),spacing:t.scale.rangeBand()>=20?10:0,stackMode:n});l.stackedWidth=t.scale.rangeBand()-l.spacing;let g=0,u=0;r(e).each(e=>{g=Math.max(g,e.reduce((e,t)=>(void 0!==t.value.value&&(e=Math.max(e,t.value.value)),u+=t.value.value,e),0))});const p="NONE_PERCENT"===l.stackMode?i.extent[1]:0;return r(e).map(function(e){const i={offsetY:!0===a.logarithmicScale?0:.5,total:"NONE_PERCENT"===l.stackMode?u:r(e).filter(e=>void 0!==e).map(R).sum(),maxValue:N(g),maxPercentage:p,unstackedWidth:(t.scale.rangeBand()-l.spacing)/e.length};return r(e).map((...e)=>{const[t,n]=e;return void 0!==t?new O(t,i,c,l,n,s):void 0}).toArray()}).toArray()},drawAreas:function(e,t){const i=e.selectAll("path.area").data(t);i.enter().append("path").each(function(e){s.select(this).attr({class:"area",fill:e.color,"fill-opacity":0}),this.oldData=G(e.points,e.scaledBottom)}),i.each(function(e){s.select(this).transition().duration(f.widgetInitializer.getAnimationDuration()).attr({fill:e.color,"fill-opacity":.25,style:"pointer-events:none"}).attrTween("d",d(I).partial(d,D))}),i.exit().each(function(){s.select(this).transition().duration(f.widgetInitializer.getAnimationDuration()).attr({"fill-opacity":0}).attrTween("d",d(I).partial(d,D,!0)).remove()});const n={};return i.each(function(e){n[e.points[0].popoverData.node.rowCode]={data:e,elem:this}}),n},drawBars:function(e,t,i,n,o=f.widgetInitializer.getAnimationDuration(),r,a){const c=e.selectAll("g.bar-group").data(t.bars);c.enter().append("g").attr({class:"bar-group"}),c.exit().remove();const l=c.selectAll("rect.bar").data(e=>e);!function(e){e.each(function(){s.select(this).transition().duration(o).attr("HORIZONTAL"===t.orientation?{x:t.scaledBottom,width:0}:{y:t.scaledBottom,height:0}).attr("fill-opacity",0).remove()})}(l.exit()),function(e){e.append("rect").each(function(e){s.select(this).attr({class:"bar",cursor:n?"pointer":"default",height:0,width:0,"fill-opacity":e.style.fillOpacity,fill:e.color,"stroke-dasharray":e.style.strokeDashArray,"stroke-opacity":e.style.strokeOpacity,"stroke-width":0,stroke:e.color}).attr("HORIZONTAL"===t.orientation?{x:t.scaledBottom,y:e.y+e.height/2}:{x:e.x+e.width/2,y:t.scaledBottom})})}(l.enter()),function(e){e.each(function(e){const t=s.select(this);(function(e){e.on({click:null,mouseenter:null,mouseleave:null})})(t),t.transition().duration(o).attr({height:e.height,width:e.width,x:e.x,y:e.y,"fill-opacity":e.style.fillOpacity,fill:e.color,"stroke-opacity":e.style.strokeOpacity,"stroke-width":1,stroke:e.color}).each("end",d(p).partial(t,e))})}(l);const g=e.selectAll("g.text-overlays").data(t.bars);g.enter().append("g").classed("text-overlays",!0),g.exit().remove();const u=g.selectAll("text.overlay").data(e=>e);function p(e,t){e.on({click:e=>i(e.reference),mouseenter:d(h).partial(e,t),mouseleave:d(m).partial(e,t)})}function h(e,i){void 0!==r&&r(e,i),e.transition().attr({x:i.x-4,y:i.y-4,width:i.width+8,height:i.height+8,"fill-opacity":1,"stroke-opacity":.4,"stroke-width":10,"stroke-dasharray":!1}),function(e,i){t.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),t.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,e.node(),"bars",i.popoverData,t.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.popup))}(e,i)}function m(e,i){void 0!==a&&a(e,i),e.transition().attr({x:i.x,y:i.y,width:i.width,height:i.height,"fill-opacity":i.style.fillOpacity,"stroke-dasharray":i.style.strokeDashArray,"stroke-opacity":i.style.strokeOpacity,"stroke-width":1}),t.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.popup,500)}!function(e){e.remove()}(u.exit()),function(e){e.append("text").each(function(){s.select(this).classed("overlay",!0).style({"text-anchor":"middle","font-size":"0","pointer-events":"none"}).attr({fill:"white"})})}(u.enter()),function(e){const i="HORIZONTAL"===t.orientation?10:8;e.each(function(e){const n=void 0===e.reference.value.percent?"":_.twNumberFormatter.getInstance().toPercentage(parseFloat(e.reference.value.percent)/100),r=Math.floor(.64*Math.min(e.height,e.width/2.5)),a={x:e.x+e.width/2,y:e.y+e.height/2};s.select(this).transition().duration(o).style({"font-size":`${r}px`}).attr({x:isNaN(a.x)?0:a.x,y:isNaN(a.y)?0:a.y,dy:r/2.5}).text(n).each(()=>{if(r<i)this.remove();else if("HORIZONTAL"===t.orientation){const t=n.split("").filter(e=>e.match(/[\d%]/)).length,i=r*t*.56;i>.85*e.width&&this.remove()}})})}(u)},drawBaseline:function(e,t,i,n,s){n=n||"HORIZONTAL",e.select(".baseline").select("line").transition().duration(f.widgetInitializer.getAnimationDuration()).attr("HORIZONTAL"===n?{x1:0,x2:i.canvas.width,y1:Math.min(t(0),i.graph.bottom),y2:Math.min(t(0),i.graph.bottom)}:{x1:Math.max(t(0),i.graph.left),x2:Math.max(t(0),i.graph.left),y1:0,y2:i.canvas.height-i.bleed.bottom})},drawCutoffs:function(e,t,i,n,o,r){o=o||!1,e.select("defs").remove(),e.classed("cutoffs",!0).append("defs").append("pattern").attr({id:"diagonal",patternUnits:"userSpaceOnUse",width:"10",height:"10"}).append("path").attr({d:"M-1,1 l2,-2 M0,10 l10,-10 M11,9 l-2,2",stroke:"#ddd","stroke-width":"3"});const a=e.selectAll("rect.cutoff").data(i.cutoffs),c=e.selectAll("rect.cutoff-striped").data(i.cutoffs);a.enter().append("rect").classed("cutoff",!0).attr("fill","#f3f3f3"),c.enter().append("rect").classed("cutoff-striped",!0).attr("fill","url(#diagonal)");const l=function(e){return o?{x:n.graph.left,width:n.graph.width,y:i.scale(e.start),height:i.scale(e.end)-i.scale(e.start)+i.scale.rangeBand()}:{x:i.scale(e.start),width:i.scale(e.end)-i.scale(e.start)+i.scale.rangeBand(),y:n.graph.top,height:n.graph.height}};routes.controllers.tw.TWRestForm.get("project",r,"upgrade","show","","rform").url,a.each(function(e){s.select(this).attr(l(e))}),c.each(function(e){s.select(this).attr(l(e)),window.embedded_mode||s.select(this).on("mouseover",function(){t.bubbleDialogService.destroyById(constants.bubble_dialog.id.topic_menu_message),t.bubbleDialogService.createMessageWithPayload(constants.bubble_dialog.id.topic_menu_message,this,function(e,t){if(!d.isString(e))return new Y(constants.messages.cutoff.general);switch(e.toLowerCase()){case constants.cutoff.type.norebuild.toLowerCase():return new Y(constants.messages.cutoff.norebuild);case constants.cutoff.type.projecthistorylimitations.toLowerCase():return new Y(constants.messages.cutoff.projecthistorylimitations);case constants.cutoff.type.toomanyresultspermonth.toLowerCase():return new Y(constants.messages.cutoff.toomanyresultspermonth);case constants.cutoff.type.facebookinsightlimitations.toLowerCase():return new Y(constants.messages.cutoff.facebookinsightlimitations);default:return new Y(constants.messages.cutoff.general)}}(e.type),t.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.topic_menu_message))}).on("mouseout",function(){t.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.topic_menu_message,500)})}),a.exit().remove(),c.exit().remove()},drawEvents:function(e,t,i,n,s,o){o.isHorizontal=o.isHorizontal||!1;const a=r(i).pluck("name").map(function(e){return parseInt(e,10)}).toArray();let c=t.map(function(e){try{return V(function(e,t){const i=e.indexOf(t.date);if(i>=0)return e[i];let n;for(n=1;n<e.length;n++)if(t.date<e[n])return e[n-1];throw console.warn("event date did not match the selected time range"),new Error("Illegal application state - an event is in the list, although it is not in the selected time range")}(a,e),e.title)}catch(e){return void console.warn("there was an error while trying to get the closest column of an event")}}).filter(e=>void 0!==e);const l={};d.each(c,function(e){d.isUndefined(l[e.timestamp])?l[e.timestamp]=e:l[e.timestamp].label=l[e.timestamp].label+", "+e.label,l[e.timestamp].label.length>20&&(l[e.timestamp].label=l[e.timestamp].label.substring(0,17)+"...")}),z(e,c=Object.keys(l).map(function(e){return l[e]}),!0,n,s,o,!0,"events")},drawLabels:function(e,t,i,n,o,r=0){let a;if(e.selectAll("*").remove(),void 0!==i){const n=e.append("g").classed("x-axis-label",!0).attr({transform:`translate(${t.canvas.width},${t.graph.bottom+5})`}),s=n.append("rect").classed("label-background",!0).attr({fill:"white",height:"18"}),o=n.append("text").classed("axis-label",!0).style("text-anchor","end").text(i).attr("dominant-baseline","hanging").node().getBBox().width+5;s.attr({width:o,x:-o})}if(void 0!==n&&(a=`translate(16, ${t.canvas.height/2}), rotate(270)`,e.append("g").attr({class:"y-axis-label",transform:a}).style("text-anchor","middle").append("text").classed("axis-label",!0).text(n)),void 0!==o){const i=24,n=s.select(e.node().parentElement).selectAll("g.axis.y-axis.right text"),a=void 0!==n?d.chain(n).flatten().map(e=>e.getBoundingClientRect()?e.getBoundingClientRect().width:i).max().value():i,c=t.graph.right+(a+16)+r,l=t.canvas.height/2;e.append("g").attr({class:"y-axis-label",transform:`translate(${c}, ${l}), rotate(270)`}).style("text-anchor","middle").append("text").classed("axis-label",!0).text(o)}},drawLines:function(e,t){const i=e.selectAll("path.line").data(t);i.enter().append("path").each(function(e){e.style=e.style||T,s.select(this).attr({fill:"none",class:"line","stroke-dasharray":e.style.strokeDashArray,stroke:e.color,"stroke-opacity":0,"stroke-width":0}),this.oldData=G(e.points,e.scaledBottom)}),i.each(function(e){const t=s.select(this);!function(e){e.on({mouseout:null,mouseover:null})}(t),t.transition().duration(f.widgetInitializer.getAnimationDuration()).attr({stroke:e.color,"stroke-opacity":1,"stroke-width":2}).attrTween("d",d(I).partial(d,A)).each("end",d(o).partial(t))}),i.exit().each(function(){s.select(this).transition().duration(f.widgetInitializer.getAnimationDuration()).attr({"stroke-opacity":0,"stroke-width":0}).attrTween("d",d(I).partial(d,A,!0)).remove()});const n={};function o(e){e.on({mouseout:d(a).partial(e),mouseover:d(r).partial(e)})}function r(e){e.transition().attr("stroke-width",4)}function a(e){e.transition().attr("stroke-width",2)}return i.each(function(e){e.points[0]&&(n[e.points[0].popoverData.node.rowCode]={data:e,elem:this})}),n},drawNewDaySeparators:function(e,t,i,n,s,o){s.isHorizontal=s.isHorizontal||!1;const a=r(C.intervals).contains(s.timeInterval)?t.filter(e=>e.new_day):[];z(e,d(a).map(e=>V(e.name,e.name_formatted_compressed)),!t[0].new_day,i,n,s,!1,"new-day")},drawPoints:function(e,t,i,n,o,r,a){const c=e.selectAll("g.serie").data(t);c.enter().append("g").classed("serie",!0),c.exit().transition().duration(50).remove();const l=M.bind(this,function(e,t){i.service.createByType(d.first(t.commentInfo.comments).id,e,constants.bubble_dialog.id.comment_marker,{marker:t.commentInfo.marker,clickAction:t.commentInfo.onClick},i.styleService.getStyle(constants.bubble_dialog.id.comment_marker).setFadeIn(window.isExport?0:300),{timeout:{active:!1},persist:!0,watchElement:{enable:!0,threshold:20,interval:250}})},E),g=M.bind(this,function(e,t){const n=t.reference.row,s=d.first(t.commentInfo.comments);i.service.createByType(s.id,e,constants.bubble_dialog.id.comment_preview,{comment:s,clickAction:t.commentInfo.onClick,color:n.color,isAlwaysVisible:s.display_type===constants.comments.display_type.show_all_comments},i.styleService.getStyle(constants.bubble_dialog.id.comment_preview).setFadeIn(window.isExport?0:300),{timeout:{active:!1},persist:!0,watchElement:{enable:!0,threshold:20,interval:250}})},T),p=c.selectAll("circle.point");p.each(function(){E(this),T(this)}),p.remove();const m=c.selectAll("circle.point").data(d.property("points")),_={};function y(e,t){return t?1:m[0]&&1===m[0].length||j(e)?1:0}function v(e,t){return t?e.color:j(e)?h.themeService.isDarkTheme()?"#191919":"white":e.color}function S(e,t){return{cx:e.x,cy:function(e){return e.y}(e),r:function(e,t){return t?7:j(e)?3:4}(e,t),fill:v(e,t),"fill-opacity":y(e,t),stroke:function(e,t){return e.color}(e),"stroke-width":function(e,t){return t?10:j(e)?2:0}(e,t),"stroke-opacity":function(e,t){return t?.4:j(e)?1:0}(e,t)}}function b(e,t){e.on({click:d(o).partial(t.reference),mouseover:d(w).partial(e,t),mouseout:d(C).partial(e,t,this),mouseenter:()=>(function(e,t){void 0!==r&&r(e,t),function(e,t){let n;const o=s.select(e);o.on("mouseleave",()=>{clearTimeout(n),o.on("mouseleave",null)}),n=setTimeout(function(){o.on("mouseleave",()=>{i.service.scheduleDestructionById(constants.bubble_dialog.id.popup,500),i.service.scheduleDestructionById(constants.bubble_dialog.id.context_menu,500),o.on("mouseleave",null)}),function(e,t){i.service.destroyById(constants.bubble_dialog.id.popup),i.service.createByType(constants.bubble_dialog.id.popup,e,"bars",t.popoverData,i.styleService.getStyle(i.styleType),{timeout:{active:!0,delay:0},persist:!1}),H(t)&&E(e),q(t)&&T(e),t.commentInfo&&t.commentInfo.actions.length>0&&(i.menuStyle.setAbsoluteX(e.x).setAbsoluteY(e.y).setPositionOffsetY(-8),i.service.createDropDownMenu(constants.bubble_dialog.id.context_menu,e,{buttons:t.commentInfo.actions},i.menuStyle))}(e,t)},250)}(e,t)})(this,t)})}function w(e,t){e.transition().attr(S(t,!0))}function C(e,t,i){void 0!==a&&a(i,t),e.transition().attr(S(t,!1)),H(t)&&l(i,t),q(t)&&g(i,t)}function E(e){u.bubbleDialogService.find(function(t){return t.getType()===constants.bubble_dialog.id.comment_marker&&t.isReferenceElement(e)}).forEach(function(e){e.destroy()})}function T(e){i.service.find(t=>t.getType()===constants.bubble_dialog.id.comment_preview&&t.isReferenceElement(e)).forEach(e=>e.destroy())}function M(e,t,n,s){t(n);const o=i.service.find(function(e){return e.isReferenceElement(n)});o.length>0?d.first(o).onDestroy.subscribeOnce(e.bind(this,n,s)):e(n,s)}return m.enter().append("circle").each(function(e){s.select(this).classed({point:!0,clickable:n}).attr({r:0,"fill-opacity":y(e),fill:v(e),"stroke-opacity":0,"stroke-width":0}),E(this),T(this)}),m.each(function(e){const t=this,i=s.select(this);!function(e){e.on({click:null,mouseenter:null,mouseout:null,mouseover:null})}(i);const n=d(b).partial(i,e);i.transition().duration(f.widgetInitializer.getAnimationDuration()).attr(S(e,!1)).each("end",function(){n.call(this),H(e)&&l(t,e),q(e)&&g(t,e)})}),m.exit().each(function(e){const t=s.select(this);E(this),T(this),t.transition().duration(50).attr({r:0,"fill-opacity":y(e)}).remove()}),e.selectAll("g.serie").each(function(e){e.points[0]&&(_[e.points[0].popoverData.node.label]={data:e,elem:this})}),_},drawXGrid:function(e,t,i,n){n=n||!1;const s=e.select("g.axis.x-axis").attr("transform","translate(0,"+(i.graph.bottom||50)+")").call(t.axis).selectAll(".tick");s.select("line").attr({y1:0,y2:-(i.graph.height||50)});const o=s.select("text").attr({y:i.graph.height||50,opacity:0});o.transition().duration(!0===window.isExport?0:f.widgetInitializer.getAnimationDuration()).attr({opacity:1,y:9}),n?o.style("text-anchor","end").attr({dx:"-0.8em",dy:"-0.5em",transform:"rotate(-90)"}):o.attr({"dominant-baseline":"central",dy:0})},drawYGrid:function(e,t,i,n=!1,o=!1,r=!1,a=!1){t.side=t.side||"left";const{side:c}=t,l=e.select("g.axis.y-axis."+c).attr("transform","translate("+i.graph[c]+",0)").call(t.axis),d=l.selectAll(".tick");if("left"===c){const e=d.select("line");e.attr({x1:-i.graph.left,x2:i.graph.right}),r?e.style("opacity",0):e.style("opacity",1)}if(a)d.select("text").remove();else{const e=d.select("text").attr({x:-i.bleed.right,opacity:0});e.transition().duration(!0===window.isExport?0:f.widgetInitializer.getAnimationDuration()).attr({opacity:1,transform:"right"===c?"translate(20,0)":void 0}).attr("x",(e,t)=>o&&t%2==0?-50:-9),n||e.attr({"dominant-baseline":"hanging",dy:0}).filter((e,t)=>0===t),l.selectAll(".tick text").each(function(e){s.select(this).append("title").text(t.formatTick?t.formatTick(e):t.labelMap?t.labelMap.get(e).name:e)})}},getArea:D,getAxisLegendWidth:function(e,t,i,n){const{side:s}=e,o=void 0===t?100:t.graph.totalWidth*v.MAX_LEGEND_WIDTH_PROPORTION,a=e.tickFormatter?e.tickFormatter():e=>`${e}`,l=r(e.axis.tickValues()).map(e=>a(e)).map(e=>e.length*v.MAX_CHARACTER_WIDTH).max();let d=l;return void 0!==i&&i.trim().length>0&&(d+="left"===s?32:l+16),void 0!==n&&0!==n||(n=1),c.generalMathUtils.clamp(d*n,50,o)},getAxisLegendWidthFromVirtualNode:function(e,t,i,n){const s=X(e.axis.tickValues(),e.tickFormatter(),t,i),o=void 0===n?100:n.graph.totalWidth*v.MAX_LEGEND_WIDTH_PROPORTION;return c.generalMathUtils.clamp(s+10,50,o)},getMaxTickWidth:X,getCutoffMessage:function(e,t){if(d.isUndefined(e)||d.isArray(e)&&0===e.length||!d.isArray(e)&&""===e)return;let i=null;d.isArray(e)&&e.length>0?i=d.contains(e,constants.cutoff.type.toomanyresultspermonth.toLowerCase())?constants.cutoff.type.toomanyresultspermonth.toLowerCase():d.contains(e,constants.cutoff.type.norebuild.toLowerCase())?constants.cutoff.type.norebuild.toLowerCase():d.contains(e,constants.cutoff.type.projecthistorylimitations.toLowerCase())?constants.cutoff.type.projecthistorylimitations.toLowerCase():d.contains(e,constants.cutoff.type.data_retention_limitations.toLowerCase())?constants.cutoff.type.data_retention_limitations.toLowerCase():e[0]:d.isArray(e)||(i=e);const n=routes.controllers.tw.TWRestForm.get("project",t,"upgrade","show","","rform").url;let s;if(r([void 0,null]).contains(i))return new B(constants.messages.cutoff.general.title,W(constants.messages.cutoff.general.message,n));switch(i){case constants.cutoff.type.norebuild.toLowerCase():return s=U(constants.messages.cutoff.norebuild.message_branded,g.contextData.projectSettings.branding.contact_email),new B(constants.messages.cutoff.norebuild.title,s);case constants.cutoff.type.projecthistorylimitations.toLowerCase():return s=U(constants.messages.cutoff.projecthistorylimitations.message_branded,g.contextData.projectSettings.branding.contact_email),new B(constants.messages.cutoff.projecthistorylimitations.title,s);case constants.cutoff.type.toomanyresultspermonth.toLowerCase():return s=U(constants.messages.cutoff.toomanyresultspermonth.message_branded,g.contextData.projectSettings.branding.contact_email),new B(constants.messages.cutoff.toomanyresultspermonth.title,s);case constants.cutoff.type.data_retention_limitations.toLowerCase():return new B(constants.messages.cutoff.data_retention_limitations.title,constants.messages.cutoff.data_retention_limitations.message);default:return s=g.contextData.projectSettings.branding.is_branded?U(constants.messages.cutoff.general.message_branded,g.contextData.projectSettings.branding.contact_email):W(constants.messages.cutoff.general.message,n),new B(constants.messages.cutoff.general.title,s)}},getTokenExpirationMessage:function(e){if(e&&e.length>0)return{title:g.contextData.getMessage("_1144647"),content:'<ul class="list-unstyled">'+e.map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>"}},getLine:A,getMainAxisData:S.MainAxisData,getPopoverData:w.PopoverData,getReloadFunction:function(e,t,i){return()=>{t.$evalAsync((...n)=>{t.loaded=!1,i.css("opacity","0.5"),e.apply(void 0,Array.prototype.slice.call(n,1)),i.css("opacity","1"),t.loaded=!0})}},getSecondaryAxisData:function(e,t,i,n,o,a=Number.MAX_VALUE){let c,l;if(o.stacking=o.stacking||"NONE",o.hasLegendPaddingMin=o.hasLegendPaddingMin||.05,this.extent=s.extent(e),this.side=n||"left",this.isCrossingZero=this.extent[0]*this.extent[1]<0,!0===o.truncateScale?this.limits=function(e){const t=Math.round((e[1]-e[0])/(1-o.hasLegendPaddingMin)/100);return{min:e[0]>=0?Math.max(0,e[0]-t):e[0]-t,max:e[1]+t}}(this.extent):o.logarithmicScale?this.limits=function(e){return{min:1,max:Math.max(1,e[1])}}(this.extent):o.isInPercent?this.limits=function(e){return{min:0,max:(e[1]<=100&&e[1])>=90?100:L([e[1]])}}(this.extent):o.isAdaptiveLegend&&!this.isCrossingZero?this.limits=function(e){let[t,i]=e;const n=r([t,i]).map(e=>(e||0).toString()).map(e=>e.split(".")).map(([e,t])=>void 0===t?0:t.length).max(),s=Math.max(10,e[1]-e[0]),a=Math.pow(10,s.toFixed(n).length-1);return t="STACK"===o.stacking?0:e[0]-e[0]%a,i=0===n?e[1]+a-e[1]%a:N(e[1]),{min:t,max:i}}(this.extent):this.isCrossingZero?this.limits=function(e){const t=N([Math.max(Math.abs(e[0]),Math.abs(e[1]))]);return{min:-t,max:t}}(this.extent):this.extent[0]<0?this.limits=function(e){return{min:-N([-e[0]]),max:0}}(this.extent):this.limits=function(e){return{min:0,max:N([e[1]])}}(this.extent),this.limits,o.logarithmicScale){l=[0],this.limits.min<1&&(this.limits.min=1),1===this.limits.max&&(this.limits.max=2),this.scale=s.scale.log().domain([this.limits.min,this.limits.max]).clamp(!0);const e=Math.log(this.limits.max);for(let t=1;t<=u();t++){const i=e/u()*t;l.push(Math.round(1e3*Math.pow(Math.E,i))/1e3)}}else{this.scale=s.scale.linear().domain([this.limits.min,this.limits.max]);const e=this.limits.max+Math.pow(10,-5);l=s.range(this.limits.min,e,function(e,t,i){const{min:n,max:s}=e;let o=s-n;return 0===o?o=1:o<0&&(o=t-n),o/i}(this.limits,e,u()))}function g(e){return o.isInPercent||"STACK_PERCENT"===o.stacking?_.twNumberFormatter.getInstance().toPercentage(e/100):c(e)}function u(){let e;return e=o.isHorizontal?i<4?2:i<5?3:i<6?4:i<10?5:10:5,Math.min(a,e)}c=function(e){return t=>0===t?"":void 0!==e&&e?_.twNumberFormatter.getLowPrecisionFormatter().toInteger(t):_.twNumberFormatter.getLowPrecisionFormatter().toDecimal(t)}(o.integerTicks),1===d.uniq(l.map(e=>c(e))).length&&(c=(e=>e)),this.axis=s.svg.axis().scale(this.scale).tickFormat(g),this.formatTick=g,this.axis.tickValues(l),o.isHorizontal?(this.scale.range([t.graph.left,t.graph.right]),this.axis.orient("bottom")):(this.scale.range([t.graph.bottom,t.graph.top]),this.axis.orient(this.side))},getStep:function(e,t,i){const n=Object.freeze({min1:10,min5:2,min15:4,h1:24,d1:7,d7:4,d30:3,m1:3,m3:4,m6:2,y1:2});return e<i?1:function(t){return Math.ceil(e/t)<4?Math.floor(t/2):t*Math.ceil(e/(t*i))}(n[t])},update_legend:function(e,t){return e.filter(function(e){return void 0!==e.row}).map(function(e){return{label:t.isTranslated&&Boolean(e.row.translated_label)?e.row.translated_label:e.row.label,color:e.row.color,style:t.style||{},valueChange:new o.Tendency(e.total_old,e.total).build(),isLineChart:t.isLineChart||!1,isBarChart:t.isBarChart||!1,isLegendAutoRenamed:t.isLegendAutoRenamed||!1}})},upgrade_message:function(e,t){const i=10,n=["#ddd","#f3f3f3"];t.append("defs").append("pattern").attr({id:"diagonal",patternUnits:"userSpaceOnUse",width:i,height:i}).append("path").attr({d:["M-1,1 l2,-2 M0,",i," l",i,",","-",i," M",i+1,",",i-1," l-2,2"].join(""),stroke:n[0],"stroke-width":3}),t.selectAll("cut_off").data(e).enter().append("rect").each(function(e){s.select(this).attr({fill:n[1],x:e.x,y:e.y,height:e.height,width:e.width})}),t.selectAll("cut_off_pattern").data(e).enter().append("rect").each(function(e){s.select(this).attr({fill:"url(#diagonal)",x:e.x,y:e.y,height:e.height,width:e.width,"data-toggle":"popover","data-title":e.message.title,"data-content":e.message.content})})},createCommentsDropdownMenu:function(e,t,i,n,s){const o=[];if(e.canEditComments()&&e.hasDataGraph()){const r=e.getDataGraph(),a=p.commentsService.getCommentDisplayMode(e);o.push({label:g.contextData.getMessage("_489448"),icon:"fa fa-bars",action:e=>{n(e)},canShow:d.identity.bind(this,!0)}),o.push({label:g.contextData.getMessage("_1745684"),icon:"fa fa-comment-o",action:e=>(s(e,i,t),!0),canShow:e=>!r.findComment(e.row.code,parseInt(e.column.code,10))}),o.push({label:g.contextData.getMessage("_1745676"),icon:"fa fa-pencil",action:e=>(s(e,i,t),!0),canShow:e=>r.findComment(e.row.code,parseInt(e.column.code,10))}),o.push({label:g.contextData.getMessage("_1745686"),icon:"fa fa-thumb-tack",action:n=>{const s=r.findComment(n.row.code,parseInt(n.column.code,10));return p.commentsService.togglePin(s,e,i,t),!0},canShow:e=>{const t=r.getCommentsWithMarkers(!0).length,i=r.findComment(e.row.code,parseInt(e.column.code,10));return void 0!==i&&!i.pinned&&a===constants.comments.display_type.show_as_footnote&&t<5}}),o.push({label:g.contextData.getMessage("_1745687"),icon:"fa fa-thumb-tack fa-rotate-90",action:n=>{const s=r.findComment(n.row.code,parseInt(n.column.code,10));return p.commentsService.togglePin(s,e,i,t),!0},canShow:e=>{const t=r.findComment(e.row.code,parseInt(e.column.code,10));return void 0!==t&&!0===t.pinned&&a===constants.comments.display_type.show_as_footnote}}),o.push({label:g.contextData.getMessage("_1745680"),icon:"fa fa-trash-o",action:n=>{const s=r.findComment(n.row.code,parseInt(n.column.code,10));return p.commentsService.removeComment(e,s,!1,i,t),!0},canShow:e=>r.findComment(e.row.code,parseInt(e.column.code,10))})}return o},createOptionMenu:J,createComments:x,clearCommentBubbles:function(e){e.service.find(function(e){const t=e.getReferenceElement();return e.isPersistent()&&!t.get(0)||!document.contains(t.get(0))}).forEach(function(e){e.destroy()})},hasComments:j,commentsFullyLoaded:function e(t){a.logService.setLogLevel(a.logService.logLevel.DEBUG,m.twCommon.logFeatures.Comments);const i=p.commentsService.getCommentDisplayMode(t);if(i===constants.comments.display_type.show_on_hover)return a.logService.debug(`No need to wait for bubbles, comment display type is ${i}!`,m.twCommon.logFeatures.Comments),Promise.resolve();const n=d.uniq(t.getDataGraph().getCommentsWithMarkers(i===constants.comments.display_type.show_as_footnote),e=>e.timestamp).map(e=>e.id);if(0===n.length)return Promise.resolve();const s=u.bubbleDialogService.find(e=>d(n).contains(e.getId()));if(s.length>=n.length){a.logService.debug(`${s.length} bubbles(s) found which belong this widget!`,m.twCommon.logFeatures.Comments);const e=s.map(e=>new Promise(t=>{e.isReady()?t():e.onReady.subscribeOnce(t)}));return a.logService.debug("Waiting for all promises to resolve",m.twCommon.logFeatures.Comments,{bubblePromises:e}),Promise.all(e).then(()=>{a.logService.debug("All bubbles promises resolved!",m.twCommon.logFeatures.Comments)})}return l.waitFor(200).then(()=>e(t))}}}),define("wrappers/widget/table/table_cell",["require","exports","data_structures","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,i,n,s,o,r){this.value=e,this.oldValue=t,this.numericData=i,this.valueChange=n,this.metaData=s,this.formattedValue=o,this.empty=r}build(){return{value:this.value,value_old:this.oldValue,value_formatted:this.formattedValue,value_change:this.valueChange.build(),meta_data:this.metaData,numeric_data:this.numericData,empty:this.empty,cutoff_message:this.cutoffMessage}}setFormattedValue(e){this.formattedValue=e}setCutoffMessage(e){this.cutoffMessage=e}static buildFromDatagraphCell(e){return new s(e.value,e.value_old,e.numeric_data,new i.Tendency(e.numeric_data||parseFloat(e.value),e.numeric_data_old),e.meta_data,e.formatted_value)}static createEmpty(){return new s("0","0",0,new i.Tendency(0,0),void 0,n.contextData.getMessage("_714772"),!0)}}t.TableCell=s}),define("wrappers/widget/table/table_row",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.TableRow=class{constructor(e,t,i,n){this.cells=e,this.label=t,this.row=i,this.widget=n,this.row.clickable=void 0===i.clickable||i.clickable}getLabel(){return this.label}getType(){return this.row.type}getFilter(){return this.row.filter}isClickable(){return this.row.clickable}getTrendingPercentage(){return this.row.trending_info&&this.row.trending_info.trending_percentage}hasIconUrl(){return void 0!==this.getIconUrl()}getIconUrl(){return this.row.icon_url}getCells(){return 0===this.cells.length?void 0:this.cells}getVisibleCells(){const e=this.widget.getDataGraph();if(this.widget.isInfluencerTableOptionPresent()&&void 0!==e){const t=[];return this.widget.getTableHeader().getColumns().forEach(i=>{const n=e.getColumns().indexOf(i);n<0?i.children.forEach(i=>{if(!this.widget.isColumnHidableForTypes(i)){const n=e.getColumns().indexOf(i);n>-1&&t.push(this.cells[n])}}):t.push(this.cells[n])}),t}return 0===this.cells.length?void 0:this.cells}getCellIndex(e){return this.cells.indexOf(e)}getClickActions(){return this.row.click_actions}hasClickActions(){return this.getClickActions()&&this.getClickActions().length>0}hasClickAction(e){return this.hasClickActions()&&-1!==this.getClickActions().indexOf(e)}getColor(){return this.row.color}hasColor(){return void 0!==this.getColor()}isDrilldownDisabled(){return!0===this.row.drilldown_disabled}}}),define("wrappers/widget/table/table_body",["require","exports","components/form/common/graph_helper","underscore","services/tw_number_formatter","wrappers/widget/table/table_cell","wrappers/widget/table/table_row"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.TableBody=class{constructor(e,t=!1){this.widget=e,this.translateLabels=t,this.build()}getRows(){return this.rows}getRow(e){return this.rows[e]}sortRows(e,t,i){void 0!==i&&i>-1?this.rows.sort((t,n)=>this.sortWithSecondaryCriteria(t,n,e,i)):this.rows=n.sortBy(this.rows,t=>Number(t.getCells()[e].numeric_data))}sortRowsByLabel(){this.rows=n.sortBy(this.rows,e=>e.getLabel().toLowerCase())}build(){let e=this.widget.getDataGraph();(e.hasIndicatorFrames()||e.hasNestedFrames())&&(e=e.mergeIndicatorFrames());const t=n.range(e.getColumns().length),i=e.rowIterator();for(this.rows=[];i.next();){const n=i.current,s=t.map(t=>this.buildCells(t,n,e)),o=new r.TableRow(s,this.getLabel(n),n,this.widget);this.rows.push(o)}}getLabel(e){return this.translateLabels&&e.translated_label?e.translated_label:e.label}buildCells(e,t,s){const r=s.getCell(t,e);if(n.isUndefined(r))return o.TableCell.createEmpty().build();{const t=o.TableCell.buildFromDatagraphCell(r);let a=r.value;n.isUndefined(r.formatted_value)?this.canFormatCellValue(s,e)&&(a=this.formatCellValue(r.numeric_data||parseFloat(r.value))):a=r.formatted_value,t.setFormattedValue(a);const c=this.widget.getPageState().getProject().getId();return r.cut_off_type?t.setCutoffMessage(i.getCutoffMessage(r.cut_off_type,c)):s.getColumns()[e].cut_off_type&&t.setCutoffMessage(i.getCutoffMessage(s.getColumns()[e].cut_off_type,c)),t.build()}}canFormatCellValue(e,t){const i=e.getColumns()[t];return!n.isUndefined(i.data_type)&&"number"===i.data_type}formatCellValue(e){return n.isFinite(e)?s.twNumberFormatter.getInstance().toDecimal(e):`${e}`}sortWithSecondaryCriteria(e,t,i,n){const s=Number(e.getCells()[i].numeric_data),o=Number(t.getCells()[i].numeric_data),r=Number(e.getCells()[n].numeric_data),a=Number(t.getCells()[n].numeric_data);return s<o?-1:s>o?1:r<a?1:r>a?-1:0}}}),define("wrappers/widget/table/table_header",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.TableHeader=class{constructor(e){this.widget=e,this.build()}build(){const e=this.widget.getDataGraph();this.allColumns=e.getColumns().slice(0),this.columns=[],this.subColumns=[],this.allColumns.forEach((e,t)=>{e.index=t,e.parent?(e.parent.numMaxChildren?e.parent.numMaxChildren+=1:(this.columns.push(e.parent),e.parent.numMaxChildren=1),this.subColumns.push(e)):(e.rowspan=2,this.columns.push(e)),e.name=e.name_formatted_compressed?e.name_formatted_compressed:e.name})}getColumns(){return this.columns.filter(e=>!this.widget.isColumnHidableForTypes(e))}getSubColumns(){return this.subColumns.filter(e=>!this.widget.isColumnHidableForTypes(e))}getColumnByPredicate(e){return this.columns.find(t=>!0===e(t))}isMinWidthInvalid(e){return!_.isUndefined(e.min_width_required)&&e.min_width_required>this.widget.getWidth()}findColumnById(e,t){return _.find(e,e=>!_.isUndefined(e.function)&&e.function===t&&!this.widget.isColumnHidableForTypes(e))}findColumnByCode(e,t){return _.find(e,e=>!_.isUndefined(e.code)&&e.code===t&&!this.widget.isColumnHidableForTypes(e))}getColumnById(e){return this.findColumnById(this.columns,e)}getColumnByCode(e){return this.findColumnByCode(this.columns,e)}getSubColumnById(e){return this.findColumnById(this.subColumns,e)}hasColumn(e){return!_.isUndefined(this.getColumnById(e))}hasSubColumn(e){return!_.isUndefined(this.getSubColumnById(e))}getColumnIndex(e){return _.indexOf(this.allColumns,e)}getColumnSortedBy(){return _.find(this.allColumns,e=>!_.isUndefined(e.sort))}getColumnSpan(e){return _.filter(e.children,e=>!this.widget.isColumnHidableForTypes(e)).length}}}),define("wrappers/widget/table/table_wrapper",["require","exports","log","talkwalker_constants","underscore","services/tw_common","wrappers/widget/widget_wrapper","wrappers/widget/table/table_body","wrappers/widget/table/table_header","classes/widget/types/widget_type"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});class d extends r.WidgetWrapper{constructor(e,t){super(e,t,"TABLE_WRAPPER"),i.logService.assertDefined(e,o.twCommon.logFeatures.TableWrapper),i.logService.assertDefined(t,o.twCommon.logFeatures.TableWrapper),this.isSkeleton()||this.build(),this.onPayloadChange.subscribe(()=>{this.isSkeleton()||this.build()})}isTable(){return this.getPayloadType()===n.PayloadType.PAYLOAD_DATA_TABLE||this.getPayloadType()===n.PayloadType.PAYLOAD_CAMPAIGNS_TABLE||this.getPayloadType()===n.PayloadType.PAYLOAD_ISSUE_ITEMS_TABLE}isFancyDataTable(){return this.isTable()&&(this.getConfigurationRenderingUuid()===n.ConfigurationDefaultsEnum.UUID_CONFIG_DATA_TABLE_FANCY||this.getConfigurationRenderingUuid()===n.ConfigurationDefaultsEnum.UUID_CONFIG_CAMPAIGNS_TABLE||this.getPayloadType()===n.PayloadType.PAYLOAD_ISSUE_ITEMS_TABLE)}isInfluencerTable(){return this.isTable()&&o.twCommon.InfluencerTableGraphConfigs.indexOf(this.getConfigurationRenderingUuid())>-1}isTrendsTablePayload(){return this.getPayloadType()===n.PayloadType.PAYLOAD_TRENDS_TABLE}isTrendsTable(){return this.isTrendsTablePayload()&&this.getConfigurationRenderingUuid()===n.ConfigurationDefaultsEnum.UUID_CONFIG_TRENDS_TABLE}isTopImagesList(){return this.isTrendsTablePayload()&&this.getConfigurationRenderingUuid()===n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_IMAGES}isCampaignsTable(){return this.getPayloadType()===n.PayloadType.PAYLOAD_CAMPAIGNS_TABLE}build(){const e=this.getConfigurationRendering();if(this.getMenu().hasCompatibleDataTypes()&&this.getMenu().getCompatibleDataTypes().getRootEntry().getChildren().forEach(t=>{(e=>e.getMappedId()===constants.data_type.activity)(t)&&(e.graph=dataTypeConf[t.getMappedId()].configuration.graph)}),this.hasDataGraph()){const e=this.getConfigurationRendering().data_table,t=!s.isUndefined(this.getDic().menu)&&!0===this.getDic().menu.translate,i=this.getDataGraph();if(this.showRowLabel=!1,!this.getExtendedConfiguration().isInfluencerType()&&!this.isInfluencerTable()){const e=i.rowIterator();for(;e.next();)if(e.current.label){this.showRowLabel=!0;break}}this.header=new c.TableHeader(this),this.body=new a.TableBody(this,t),s.isUndefined(e)||s.isUndefined(e.show_total_top)||"Y"===e.show_total_top||this.body.getRows().splice(i.getSubtotalRowIdx(),1),s.isUndefined(e)||s.isUndefined(e.show_total_all)||"Y"===e.show_total_all||this.body.getRows().splice(i.getTotalRowIdx(),1),this.checkToApplyCustomSorting()}}getTableBody(){return this.body}getTableHeader(){return this.header}canShowRowLabel(){return this.showRowLabel}isInfluencerTableOptionPresent(){if(this.hasMenu()){const e=this.getMenu().getCompatibleDataTypes();return!s.isUndefined(e)&&e.hasEntryByMappedId(constants.data_type.influencors_data_type)}return!1}isColumnHidableForTypes(e){return!s.isUndefined(e.hidable_for_types)&&this.getMenu().hasCompatibleDataTypes()&&s.contains(e.hidable_for_types,this.getMenu().getCompatibleDataTypes().getFirstSelectedEntryRecursively().getMappedId().toLowerCase())}sort(e,t,n){let s,r;i.logService.log({message:"Sorting on column, type: "+t,logLevel:i.logService.logLevel.INFO,trace:!0,feature:o.twCommon.logFeatures.DataTable,object:{table:this,column:e}}),this.isSortReloading()&&!n?(s=this.getMultiDataSource().columns,r=this.isMultiDataSourceColumnEqual):(s=this.getDataGraph().getColumns(),r=this.isColumnEqual),this.setColumnSorting(e,t,s,r),this.isSortReloading()&&!n||this.sortByColumnIndex(this.getDataGraph().getColumns().indexOf(e),t)}isSortReloading(){return this.getExtendedConfiguration()&&this.getExtendedConfiguration().isInfluencerType()||this.isInfluencerTable()}sortByRowLabels(e){const t=this.getDataGraph();t.payloadDataGraph.rows=this.sortPayloadRowsByRowLabels(t),this.getTableBody().sortRowsByLabel(),this.reverseRowOrder(e,t),this.getExtendedConfiguration().hasSortingConfig()||this.getExtendedConfiguration().setSortingConfig({}),this.getExtendedConfiguration().getSortingConfig().setSortDirection(this.isSortedNone(e)?void 0:e),this.getExtendedConfiguration().getSortingConfig().setSortOnColumnCode(void 0),this.getExtendedConfiguration().getSortingConfig().setSortOnRowLabel(!this.isSortedNone(e))}isSortedAsc(e){return!s.isUndefined(e)&&e.toLowerCase()===constants.data_table.sorting.ASC.toLowerCase()}isSortedDesc(e){return!s.isUndefined(e)&&e.toLowerCase()===constants.data_table.sorting.DESC.toLowerCase()}isSortedNone(e){return!s.isUndefined(e)&&e.toLowerCase()===constants.data_table.sorting.NONE.toLowerCase()}isHeaderHidden(){return this.hasMenu()&&this.getMenu().isHideTableHeader()}setHeaderHidden(e){this.getMenu().setHideTableHeader(e)}clone(){const e=new d(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}sortByColumnIndex(e,t){const i=this.getDataGraph(),n=s.findIndex(i.getColumns(),e=>"RANK"===e.code);i.payloadDataGraph.rows=this.sortPayloadRowsByNumbericData(i,e,n),this.getTableBody().sortRows(e,t,n),this.reverseRowOrder(t,i)}getType(){return this.isInfluencerTable()?l.WidgetType.INFLUENCER_TABLE:this.isTrendsTable()?l.WidgetType.TRENDS_TABLE:this.isCampaignsTable()?l.WidgetType.CAMPAIGNS_TABLE:this.isTopImagesList()?l.WidgetType.TOP_IMAGES:l.WidgetType.DATA_TABLE}sortPayloadRowsByNumbericData(e,t,i){if(i>-1){return JSON.parse(JSON.stringify(e.payloadDataGraph.rows)).sort((e,n)=>this.sortWithSecondaryCriteria(e,n,t,i))}return s.sortBy(e.payloadDataGraph.rows,e=>Number(e.cells[t].value.numeric_data))}sortWithSecondaryCriteria(e,t,i,n){const s=Number(e.cells[i].value.numeric_data),o=Number(t.cells[i].value.numeric_data),r=Number(e.cells[n].value.numeric_data),a=Number(t.cells[n].value.numeric_data);return s<o?-1:s>o?1:r<a?1:r>a?-1:0}sortPayloadRowsByRowLabels(e){return s.sortBy(e.payloadDataGraph.rows,e=>e.label.toLowerCase())}reverseRowOrder(e,t){"DESC"===e&&(t.payloadDataGraph.rows.reverse(),this.getTableBody().getRows().reverse())}setColumnSorting(e,t,i,n){this.getExtendedConfiguration().hasSortingConfig()||this.getExtendedConfiguration().setSortingConfig({}),i.forEach((i,s)=>{if(n(i,e)){i.sort=t,this.getExtendedConfiguration().getSortingConfig().setSortDirection(this.isSortedNone(t)?void 0:t);const n=this.isSortedNone(t)?void 0:e.code;this.getExtendedConfiguration().getSortingConfig().setSortOnColumnCode(n),this.getExtendedConfiguration().getSortingConfig().setSortOnRowLabel(!1)}else i.sort=constants.data_table.sorting.NONE})}isColumnEqual(e,t){return t===e}isMultiDataSourceColumnEqual(e,t){return void 0!==e.column&&e.column.function===t.function}checkToApplyCustomSorting(){if(this.getExtendedConfiguration().hasSortingConfig()){const e=this.getExtendedConfiguration().getSortingConfig();if(e.hasSortOnColumnCode()){const t=this.getTableHeader().getColumnByCode(e.getSortOnColumnCode());void 0!==t&&this.sort(t,e.getSortDirection(),!0)}else e.isSortOnRowLabel()&&this.sortByRowLabels(e.getSortDirection())}}}t.TableWrapper=d,t.default=s.constant(d)}),define("classes/widget/types/trends_configurable_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.TRENDS_CONFIGURABLE)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.TRENDS_CONFIGURABLE}}t.TrendsConfigurableWidget=s}),define("classes/widget/types/external_trend_table_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.EXTERNAL_TREND_TABLE)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.EXTERNAL_TREND_TABLE}}t.ExternalTrendTableWidget=s}),define("classes/widget/types/external_trend_word_cloud_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.EXTERNAL_TREND_WORD_CLOUD)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.EXTERNAL_TREND_WORD_CLOUD}}t.ExternalTrendWordCloudWidget=s}),define("classes/widget/types/compared_topics_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.COMPARED_TOPICS)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.COMPARED_TOPICS}}t.ComparedTopicsWidget=s}),define("classes/widget/types/block_issues_widget",["require","exports","wrappers/widget/widget_wrapper","classes/widget/types/widget_type"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.WidgetWrapper{constructor(e,t){super(e,t,n.WidgetType.BLOCK_ISSUES)}clone(){const e=new s(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getType(){return n.WidgetType.BLOCK_ISSUES}}t.BlockIssuesWidget=s}),define("services/widgets/widget_factory",["require","exports","log","talkwalker_constants","classes/widget/types/articles_widget","classes/widget/types/block_influencers_widget","classes/widget/types/gender_widget","classes/widget/types/message_diffusion_widget","classes/widget/types/openlayers_map_widget","classes/widget/types/progress_graph_widget","classes/widget/types/restform_widget","classes/widget/types/single_metric_widget","classes/widget/types/text_widget","classes/widget/types/treemap_widget","wrappers/widget/table/table_wrapper","wrappers/widget/widget_wrapper","services/tw_common","classes/widget/types/trends_configurable_widget","classes/widget/types/external_trend_table_widget","classes/widget/types/external_trend_word_cloud_widget","classes/widget/types/widget_type","reusable_utilities","map","classes/widget/types/compared_topics_widget","classes/widget/types/block_issues_widget"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E){Object.defineProperty(t,"__esModule",{value:!0});class T{constructor(){this.initWidgetTypeConstructors()}wrapWidget(e,t){i.logService.assertDefined(e,_.twCommon.logFeatures.WidgetFactory),i.logService.assertDefined(e.payload,_.twCommon.logFeatures.WidgetFactory),i.logService.assertDefined(e.payload.type,_.twCommon.logFeatures.WidgetFactory);const n=this.determineWidgetType(e,t);return new(this.widgetTypeConstructors.get(n))(e,t)}rewrapWidget(e){const t=e.getPageState().getWidgets(),i=t.indexOf(e);t.splice(i,1);const n=this.wrapWidget(e.toProto(),e.getPageState());return e.hasTemplate()&&n.attachTemplate(e.getTemplate()),e.dispose(),t.splice(i,0,n),n}determineWidgetType(e,t){switch(i.logService.assertDefined(e,_.twCommon.logFeatures.WidgetFactory),i.logService.assertDefined(e.payload,_.twCommon.logFeatures.WidgetFactory),i.logService.assertDefined(e.payload.type,_.twCommon.logFeatures.WidgetFactory),e.payload.type){case n.PayloadType.PAYLOAD_ISSUE_ITEMS_TABLE:return S.WidgetType.DATA_TABLE;case n.PayloadType.PAYLOAD_ARTICLES:return this.determineArticlesPayloadWidgetType(e);case n.PayloadType.PAYLOAD_DATAGRAPH:return this.determineDatagraphWidgetType(e);case n.PayloadType.PAYLOAD_BUBBLE:return S.WidgetType.BUBBLE_CHART;case n.PayloadType.PAYLOAD_GENDER:return S.WidgetType.GENDER;case n.PayloadType.PAYLOAD_MAP:return this.determineWorldMapWidgetType(e);case n.PayloadType.PAYLOAD_MESSAGE_DIFFUSION_ENTRIES:return S.WidgetType.MESSAGE_DIFFUSION;case n.PayloadType.PAYLOAD_RESTFORM:return S.WidgetType.RESTFORM;case n.PayloadType.PAYLOAD_DATA_TABLE:return this.determineTableWidgetType(e);case n.PayloadType.PAYLOAD_EDITION:return S.WidgetType.PAYLOAD_EDITION;case n.PayloadType.PAYLOAD_ACTIVITY:return S.WidgetType.ACTIVITY_CHART;case n.PayloadType.PAYLOAD_TRENDS_TABLE:return this.determineTrendsTableWidgetType(e);case n.PayloadType.PAYLOAD_CAMPAIGNS_TABLE:return S.WidgetType.CAMPAIGNS_TABLE;case n.PayloadType.PAYLOAD_TEXT:return this.determineTextWidgetType(e,t);case n.PayloadType.PAYLOAD_THEME_TREE:return this.determineThemeTreePayloadWidgetType(e);case n.PayloadType.PAYLOAD_RESULT:return this.determineResultPayloadWidgetType(e);case n.PayloadType.PAYLOAD_SUMMARY_WIDGET:return S.WidgetType.SUMMARIES;case n.PayloadType.PAYLOAD_PROGRESS:return S.WidgetType.PROGRESS_GRAPH;case n.PayloadType.PAYLOAD_INFLUENCER_OVERVIEW:return S.WidgetType.INFLUENCER_OVERVIEW;case n.PayloadType.PAYLOAD_TOP_INFLUENCERS_OVERVIEW:return S.WidgetType.TOP_INFLUENCERS_OVERVIEW;case n.PayloadType.PAYLOAD_INFLUENCER_LIST:return S.WidgetType.BLOCK_INFLUENCERS;case n.PayloadType.PAYLOAD_ISSUES_LIST:return S.WidgetType.BLOCK_ISSUES;case n.PayloadType.PAYLOAD_INFLUENCER_NETWORK:return S.WidgetType.INFLUENCER_NETWORK;case n.PayloadType.PAYLOAD_DOCUMENT_CLUSTER:return S.WidgetType.DOCUMENT_CLUSTER;case n.PayloadType.PAYLOAD_EXTERNAL_TRENDS:return this.determineExternalTrendsWidgetType(e,t);case n.PayloadType.PAYLOAD_EXTERNAL_DATA:return S.WidgetType.COMPOSED_GRAPH;case n.PayloadType.PAYLOAD_VELOCITY_DATAGRAPH:return S.WidgetType.VELOCITY_CHART;case n.PayloadType.PAYLOAD_PAGE_BREAK:return S.WidgetType.PAGE_BREAK;case n.PayloadType.PAYLOAD_TOPICS_COMPARE:return S.WidgetType.COMPARED_TOPICS;default:return this.determineWithoutPayloadType(e)}}determineArticlesPayloadWidgetType(e){return e.configuration_rendering.uuid_configuration===n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_TREE_MAP?S.WidgetType.TREEMAP:S.WidgetType.ARTICLES}determineDatagraphWidgetType(e){return e.configuration_rendering.graph.type_graph===n.TypeGraph.PIE_CHART?S.WidgetType.PIE_CHART:this.isComposedGraph(e)?S.WidgetType.COMPOSED_GRAPH:e.configuration_rendering.graph.type_graph===n.TypeGraph.AREA?S.WidgetType.AREA_CHART:e.configuration_rendering.graph.type_graph===n.TypeGraph.LINE_CHART?S.WidgetType.LINE_CHART:e.configuration_rendering.graph.type_graph===n.TypeGraph.COLUMN_CHART?"HORIZONTAL"===e.configuration_rendering.bar_chart.orientation_mode?S.WidgetType.HORIZONTAL_BAR_CHART:S.WidgetType.VERTICAL_BAR_CHART:e.configuration_rendering.graph.type_graph===n.TypeGraph.MULTI_METRICS?S.WidgetType.MULTI_METRICS:_.twCommon.RadarGraphTypes.indexOf(e.configuration_rendering.graph.type_graph)>-1&&_.twCommon.RadarGraphConfigs.indexOf(e.configuration_rendering.uuid_configuration)>-1?S.WidgetType.RADAR_CHART:void i.logService.error("No widget type is defined for this widget !",void 0,e)}isComposedGraph(e){if(e.empty_widget||void 0===e.payload.value)return!1;const t=JSON.parse(e.payload.value).data_graph;return(b.DataGraphUtils.hasIndicatorFrames(t)||b.DataGraphUtils.hasNestedFrames(t))&&_.twCommon.composedGraphTypes.indexOf(e.configuration_rendering.graph.type_graph)>-1}determineWorldMapWidgetType(e){return S.WidgetType.OPENLAYERS_WORLD_MAP}determineTableWidgetType(e){switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_ELEMENTS_TABLE:return S.WidgetType.EXTERNAL_TREND_TABLE;case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_TABLE_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_DEFAULT:return S.WidgetType.INFLUENCER_TABLE;default:return S.WidgetType.DATA_TABLE}}determineTrendsTableWidgetType(e){switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_ELEMENTS_TABLE:return S.WidgetType.EXTERNAL_TREND_TABLE;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_IMAGES:return S.WidgetType.TOP_IMAGES;default:return S.WidgetType.DATA_TABLE}}determineTextWidgetType(e,t){if(!t||!t.hasPageConfiguration())return S.WidgetType.TEXT;switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_IMAGE:return S.WidgetType.IMAGE_BOX;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_VIDEO:return S.WidgetType.VIDEO_BOX;default:return S.WidgetType.TEXT_BOX}}determineThemeTreePayloadWidgetType(e){switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_SORTED:return S.WidgetType.SORTED_THEME_CLOUD;case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_TREEMAP:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_WITH_TRENDS:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_ONLY_TRENDS:return S.WidgetType.THEME_TREE;case n.ConfigurationDefaultsEnum.UUID_CONFIG_PIE_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_PIE_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_WHEEL_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_WHEEL_CHART:return S.WidgetType.WHEEL_CHART;default:if(void 0!==e.payload.value){const t=JSON.parse(e.payload.value).tree;if(void 0!==t&&void 0!==t.meta_data&&void 0!==t.meta_data.attributes&&!0===t.meta_data.attributes[constants.data_graph.meta_data.attrs.emoji_data])return S.WidgetType.EMOJI_TREE}return S.WidgetType.THEME_TREE}}determineResultPayloadWidgetType(e){switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_COUNTER:return S.WidgetType.COUNTER;case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT_SIMPLE:return S.WidgetType.SINGLE_METRIC;case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT_PROGRESS_GRAPH:return S.WidgetType.PROGRESS_GRAPH;case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT:default:return S.WidgetType.KPI_CHART}}determineExternalTrendsWidgetType(e,t){if(t&&t.getAllowedPages().isCommandCenterWidgetPreview())return S.WidgetType.TRENDS_CONFIGURABLE;switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_CLOUD:return S.WidgetType.EXTERNAL_TREND_WORD_CLOUD;case n.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_LIST:return S.WidgetType.EXTERNAL_TREND_TABLE;default:return S.WidgetType.TRENDS_CONFIGURABLE}}determineWithoutPayloadType(e){const t=this.determineByUuidConfiguration(e);if(void 0!==t)return t;i.logService.error("No widget type is defined for this widget !",void 0,e)}determineByUuidConfiguration(e){switch(e.configuration_rendering.uuid_configuration){case n.ConfigurationDefaultsEnum.UUID_CONFIG_IMPACT_BUBBLES_DEFAULT:return S.WidgetType.IMPACT_GRAPH;case n.ConfigurationDefaultsEnum.UUID_CONFIG_STREAM_GRAPH:return S.WidgetType.STREAM_GRAPH;default:return void i.logService.error("No widget type is defined for this widget !",void 0,e)}}initWidgetTypeConstructors(){this.widgetTypeConstructors=new w.Map,this.widgetTypeConstructors.set(S.WidgetType.RADAR_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.WHEEL_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.PAYLOAD_EDITION,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.INFLUENCER_NETWORK,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.DOCUMENT_CLUSTER,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.MULTI_METRICS,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.EMOJI_TREE,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.TOP_INFLUENCERS_OVERVIEW,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.INFLUENCER_OVERVIEW,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.PAGE_BREAK,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.SUMMARIES,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.VERTICAL_BAR_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.HORIZONTAL_BAR_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.VELOCITY_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.BUBBLE_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.LINE_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.AREA_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.COMPOSED_GRAPH,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.PIE_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.EXTERNAL_TREND_TABLE,y.ExternalTrendTableWidget),this.widgetTypeConstructors.set(S.WidgetType.EXTERNAL_TREND_WORD_CLOUD,v.ExternalTrendWordCloudWidget),this.widgetTypeConstructors.set(S.WidgetType.TRENDS_CONFIGURABLE,f.TrendsConfigurableWidget),this.widgetTypeConstructors.set(S.WidgetType.COUNTER,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.KPI_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.SORTED_THEME_CLOUD,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.PROGRESS_GRAPH,l.ProgressGraphWidget),this.widgetTypeConstructors.set(S.WidgetType.THEME_TREE,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.THEME_CLOUD,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.ARTICLES,s.ArticlesWidget),this.widgetTypeConstructors.set(S.WidgetType.STREAM_GRAPH,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.IMPACT_GRAPH,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.TEXT_BOX,u.TextWidget),this.widgetTypeConstructors.set(S.WidgetType.VIDEO_BOX,u.TextWidget),this.widgetTypeConstructors.set(S.WidgetType.IMAGE_BOX,u.TextWidget),this.widgetTypeConstructors.set(S.WidgetType.TEXT,u.TextWidget),this.widgetTypeConstructors.set(S.WidgetType.TOP_IMAGES,h.TableWrapper),this.widgetTypeConstructors.set(S.WidgetType.DATA_TABLE,h.TableWrapper),this.widgetTypeConstructors.set(S.WidgetType.CAMPAIGNS_TABLE,h.TableWrapper),this.widgetTypeConstructors.set(S.WidgetType.INFLUENCER_TABLE,h.TableWrapper),this.widgetTypeConstructors.set(S.WidgetType.OPENLAYERS_WORLD_MAP,c.OpenlayersMapWidget),this.widgetTypeConstructors.set(S.WidgetType.TREEMAP,p.TreemapWidget),this.widgetTypeConstructors.set(S.WidgetType.BLOCK_INFLUENCERS,o.BlockInfluencersWidget),this.widgetTypeConstructors.set(S.WidgetType.BLOCK_ISSUES,E.BlockIssuesWidget),this.widgetTypeConstructors.set(S.WidgetType.RESTFORM,d.RestformWidget),this.widgetTypeConstructors.set(S.WidgetType.MESSAGE_DIFFUSION,a.MessageDiffusionWidget),this.widgetTypeConstructors.set(S.WidgetType.GENDER,r.GenderWidget),this.widgetTypeConstructors.set(S.WidgetType.TRENDS_TABLE,h.TableWrapper),this.widgetTypeConstructors.set(S.WidgetType.SINGLE_METRIC,g.SingleMetricWidget),this.widgetTypeConstructors.set(S.WidgetType.ACTIVITY_CHART,m.WidgetWrapper),this.widgetTypeConstructors.set(S.WidgetType.COMPARED_TOPICS,C.ComparedTopicsWidget)}}t.WidgetFactory=T,t.widgetFactory=new T}),define("classes/grid/grid_toolbar_model",["require","exports","services/toolbar_service","event_bus","reusable_utilities","drag_and_drop","classes/grid/grid_slot_item","services/widgets/widget_factory"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(){this.toolbarDraggableBtnsToInit=[],this.gridDragNDropPayloads={},this.toolbarMounted=!1,this.items=[],this.cancellationToken=new s.CancellationToken,this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.INIT_TOOLBAR_ITEM_DRAG_N_DROP,this.handleInitToolbarDragNDrop.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SEND_GRID_DRAGNDROP_INFO,this.handleGridDragNDropPayload.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.TOOLBAR_MOUNTED,this.handleToolbarMounted.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,this.handleAnchorSelectionChanged.bind(this))}static async constructAsync(){const e=new c;return await e.initToolbarItems(),e}handleInitToolbarDragNDrop(e){this.toolbarDraggableBtnsToInit.push(e),this.toolbarMounted&&void 0!==this.currentGridDragPayload&&this.registerDragNDropForToolbarItem(e,this.currentGridDragPayload)}constructDummyModel(e){const t=a.widgetFactory.wrapWidget(JSON.parse(JSON.stringify(e)));return t.isMovable=(()=>!0),new r.GridSlotItem([t.getId()],()=>t)}handleGridDragNDropPayload(e){this.gridDragNDropPayloads[e.value.id]=e.value,void 0===this.currentGridDragPayload&&(this.currentGridDragPayload=e.value,this.toolbarMounted&&this.initAllDraggableBtnsForGrid(e.value.id))}registerDragNDropForToolbarItem(e,t){o.dragAndDropService.registerDragSources([e.value.element],{onDragStart:async i=>{i.stopPropagation(),i.preventDefault();const n=this.constructDummyModel(e.value.item.actionPayload.data);return t.draggableStrategy.startDragging(i,n),{dragHandle:document.createElement("div"),model:n}},onDragMove:(e,i)=>t.draggableStrategy.move(e,i),onDragStop:async e=>{t.draggableStrategy.stopDragging(e),t.draggableStrategy.postDrag()},channels:t.channels,minimumDragDistance:5,cancellationToken:e.value.cancellationToken}),e.value.cancellationToken.addDomEvent(e.value.element,"mousedown",i=>{t.draggableStrategy.onMouseDown(i,this.constructDummyModel(e.value.item.actionPayload.data))})}handleToolbarMounted(e){this.toolbarMounted||(this.toolbarMounted=e.value,void 0!==this.currentGridDragPayload&&this.initAllDraggableBtnsForGrid(this.currentGridDragPayload.id))}initAllDraggableBtnsForGrid(e){this.toolbarDraggableBtnsToInit.forEach(t=>{this.registerDragNDropForToolbarItem(t,this.gridDragNDropPayloads[e])})}handleAnchorSelectionChanged(e){this.changeToolbarDragStategies(e)}changeToolbarDragStategies(e){const t=e.value;this.toolbarDraggableBtnsToInit.forEach(e=>{e.value.cancellationToken.cancel(),e.value.cancellationToken=new s.CancellationToken,this.registerDragNDropForToolbarItem(e,this.gridDragNDropPayloads[t.id])})}async initToolbarItems(){this.items=await i.toolbarService.fetchWidgetTemplateItems()}dispose(){this.toolbarDraggableBtnsToInit.length=0,this.gridDragNDropPayloads={},this.currentGridDragPayload=void 0,this.toolbarMounted=!1,this.cancellationToken.cancel()}}t.GridToolbarModel=c}),define("classes/grid/grid_page_controller",["require","exports","classnames","event_bus","log","math_utils","reusable_utilities","underscore","constants/page_size_constants","react_components/filter_menu/topic_menu_wrapper_adapter","services/broker","services/bubble_dialog","services/grid_spacial","services/refresh/model_refresh_service","classes/application/application","classes/base_page","classes/context_data/context_data","react_components/filter_menu/default_filter_menu_controller","classes/filters/suggestions/endpoints/geolocalization_suggestion_endpoint","classes/filters/suggestions/filter_form_suggestions_controller","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_page","classes/grid/grid_page_collection","classes/grid/grid_slot_item","classes/grid/grid_toolbar_model","reusable_components","services/pages/page_size_calculator"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0});const I=["MEDIA_TYPE","LANGUAGES","COUNTRIES","DEMOGRAPHICS_AND_GENDER","GENERATOR_DEVICE","SENTIMENT"];class x extends m.default{constructor(e,t){super(e),this.$element=t,this.pageClasses=[],this.minimumExpandGridSize=0,this.cancellationToken=new r.CancellationToken,e.$on("$destroy",()=>this.destroy())}$onInit(){super.$onInit(),this.setupPage()}setupPage(){const{anchorConfiguration:e}=this.configuration;this.gridPageCollection=new T.GridPageCollection(this.pageState.getPageConfiguration(),e),this.initializeGridPages(),this.initializePageFilters(),this.initializeActivePageId(),this.initializeToolbar(),this.initializePreviewAnchor(),this.createSubscriptions()}async initializeToolbar(){this.configuration.toolbar&&(this.toolbarModel=await P.GridToolbarModel.constructAsync(),this.cancellationToken.registerDisposable(this.toolbarModel))}recomputeGridSize(){const e=$(this.gridPageCollection.getCurrentPage().getHtmlElement()),t=e.find(".tw-grid"),i=this.$element.find(".gridcontroller"),n=this.gridPageCollection.getCurrentPage().getGrid().getHeight()*A.pageSizeCalculatorService.getGridCellSize(this.pageData,A.pageSizeCalculatorService.getCurrentGrid(this.pageData.getPageConfiguration())).height;t.height(n),this.minimumExpandGridSize=n;const s=e.find(".zones");if(1==s.length){const e=this.gridPageCollection.getCurrentPage().getGrid();e.createBackgroundCanvasGrid(s[0],e.getConfiguration().style)}i.height("auto")}initializePreviewAnchor(){if(!this.configuration.sidebar||!this.configuration.sidebar.previewAnchor||this.configuration.anchorConfiguration.type!==C.GridAnchorType.PREVIEW)return;const{addAction:e=a.noop,deleteAction:t=a.noop,editAction:i=a.noop,moveItemToPageAction:n=a.noop}=this.configuration.sidebar.previewAnchor;this.getPreviewAnchorModel().addAction=e.bind(this),this.getPreviewAnchorModel().deleteAction=t.bind(this),this.getPreviewAnchorModel().editAction=i.bind(this),this.getPreviewAnchorModel().moveItemToPageAction=n.bind(this)}getPreviewAnchorModel(){return this.gridPageCollection.getAnchorModel()}initializeActivePageId(){const e=this.gridPageCollection.getActiveAnchorModel().getSelectedNode();if(void 0!==e){const t=this.pageState.getPageConfiguration().pages.find(t=>t.id===e.id);void 0!==t&&(this.pageState.getPageConfiguration().active_page_id=t.id)}}adjustSizeToFitContent(e){const t=this.getGridPageCollection().getCurrentPage().getGrid(),i=Math.max(16,...t.getItems().map(t=>t.getSlotConfiguration().grid_y+t.getSlotConfiguration().height+e));t.getHeight()>i&&t.shrink(new o.Vector2D(0,t.getHeight()-i)),t.getHeight()<i&&t.expand(new o.Vector2D(0,i-t.getHeight()))}onGridSizeChange(e){}createSubscriptions(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_CELLS_ADDED,e=>{this.gridPageCollection.getCurrentPage().getId()===e.value.id&&this.onGridSizeChange(e.value.amountAdded)}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_CELLS_REMOVED,e=>{this.gridPageCollection.getCurrentPage().getId()===e.value.id&&this.onGridSizeChange(e.value.amountAdded.clone().flip())}),this.getPageControllerConfiguration().respondToWidgetOverflow&&this.enableExpandableGrid();const e=d.brokerService.subscribe(constants.events.page_state.received,(e,t)=>{!this.pageState.isDisposed()&&this.pageState.getId()===e.getId()&&this.pageState.hasPageConfiguration()&&(this.gridPageCollection.setPageConfig(this.pageState.getPageConfiguration()),t&&this.initializeGridPages())},this.cancellationToken);this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.PAGESTATE_REFRESH,this.handlePageStateRefresh.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.WATCHLIST_ITEM_ADDED,this.refreshPageData.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ANCHOR_MODEL_CHANGED,this.initializePreviewAnchor.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,()=>{this.$element.find(".gridcontroller")[0].style.height=null}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_PIN_TOGGLED,()=>this.resetPageFilters()),this.cancellationToken.registerDisposable(this.gridPageCollection),this.cancellationToken.registerCleanupFunction(()=>{d.brokerService.unsubscribe(constants.events.page_state.received,e)})}enableExpandableGrid(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_WIDGET_OVERFLOW,e=>{const t=this.pageState.getWidgetById(e.value.id);if(void 0!==t&&u.gridSpacialService.isAtTheBottomEdge(this.getCurrentPage().getGrid().getHeight(),t)){const t=this.$element.find(".tw-grid"),i=this.$element.find(".gridcontroller");if(e.value.realSize.y>e.value.expectedSize.y){const n=Math.max(this.minimumExpandGridSize,this.getFixedGridHeight()+this.getBottomBannerHeight()+e.value.realSize.y-e.value.expectedSize.y);t[0].style.height=`${n}px`,i[0].style.height="auto"}else t[0].style.height=this.minimumExpandGridSize?`${this.minimumExpandGridSize}px`:null,i[0].style.height=null}})}handlePageStateRefresh(e){!this.pageState.isDisposed()&&this.pageState.hasPageConfiguration()&&(this.initIconAnchorModel(),this.resetPageFilters())}toggleEditMode(){this.pageData.toggleEditMode(),this.refreshPageData().then(()=>void 0,e=>{e instanceof Error&&s.logService.error("Error when refreshing page state when toggling edit mode !",void 0,e)})}initializeGridPages(){this.gridPageCollection.getPages().forEach(e=>{e.dispose(),this.gridPageCollection.removePage(e)});const{pages:e,grid:t}=this.pageState.getPageConfiguration();e.reduce((e,i)=>this.generateAndAddPageToGrid(i,this.pageState,void 0!==i.grid?i.grid:t,++e),0),this.initIconAnchorModel()}async refreshPageData(){const e={strategy:b.ModelRefreshStrategy.REFRESH},t=S.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),w.ModelType.PAGE_STATE,e);try{return await p.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}generateAndAddPageToGrid(e,t,i,n,s){const o=E.GridPage.generateGridPage(e,t.getWidgets(),this.generateGridConfiguration(i,e.id),n,M.GridSlotItem.getWidgetByIdFunction(t),s),r=void 0!==this.getActivePageId()?this.getActivePageId()===o.getId():1===n;this.gridPageCollection.addPage(o,r);const{pages:a=[]}=e;return a.forEach(e=>n=this.generateAndAddPageToGrid(e,t,void 0!==e.grid?e.grid:i,++n,o)),n}generateGridConfiguration(e,t){return{width:e.width,height:e.height,id:t,restrictedAreas:[],dropzonePlaceholders:{},gridItemOptions:{}}}initializePageFilters(){const{pageFilters:e}=this.configuration;if(void 0===e)return void(this.pageUFSMenus=void 0);const{userFilterSettings:t,filterBarController:i,allowedFilterTypes:n=I,color:s=_.contextData.projectSettings.branding.color}=e;if(this.pageUFSMenus=t.getFilters().filter(e=>this.canShowFilterAsPageFilterMenu(n,e)).map(e=>this.buildMenuAttributes(e,t)).map(e=>this.buildFilterMenuProps(e)),n.includes("TOPIC_PM_COMPOSED")){const e=this.buildMenuAttributes(t.getTopicMenuByType("TOPIC_PM_COMPOSED"),t),i=this.buildFilterMenuProps(e);this.pageUFSMenus.push(i)}this.filterBarController=i,this.filterMenuColor=s,this.updateFilterMenus()}canShowFilterAsPageFilterMenu(e,t){return e.includes(t.getType())&&"TIME_FILTER"!==t.getType()}buildFilterMenuProps(e){const{topicMenu:t}=e;return{controller:new(this.getFilterMenuController(t))(e,l.TopicMenuWrapperMenuAdapter)}}getFilterMenuController(e){return f.DefaultFilterMenuController}initIconAnchorModel(){this.gridPageCollection.resetAnchorModel(),this.setupKeyNavigation(),n.eventBus.dispatch({type:n.EVENT_TYPES.ANCHOR_MODEL_CHANGED,value:this.getIconAnchorModel()})}setupKeyNavigation(){this.configuration.enableKeyNavigation&&(void 0!==this.keyToken&&(this.keyToken.cancel(),this.keyToken=void 0),this.keyToken=this.getIconAnchorModel().setUpKeyNavigation(),this.registerKeyboardNavigationSubscriptions())}registerKeyboardNavigationSubscriptions(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.BUBBLE_DIALOG_CREATED,e=>{const{id:t,type:i}=e.value;if("widget"===i){const e=a.first(g.bubbleDialogService.getBubblesById(t));this.cancellationToken.subscribeOnce(e.onOpen,()=>{void 0!==this.keyToken&&(this.keyToken.cancel(),this.keyToken=void 0)}),this.cancellationToken.subscribeOnce(e.onDestroy,()=>{this.keyToken=this.getIconAnchorModel().setUpKeyNavigation()})}}),this.cancellationToken.registerCleanupFunction(()=>{void 0===this.keyToken||this.keyToken.isCanceled()||(this.keyToken.cancel(),this.keyToken=void 0)})}destroy(){this.cancellationToken.cancel()}getUserFilterSettings(){return h.mainApplication.getPageState().getUserFilterSettings()}getActivePageId(){return this.pageState.getPageConfiguration().active_page_id}getGridPageCollection(){return this.gridPageCollection}getCurrentPage(){return this.gridPageCollection.getCurrentPage()}canShowIconAnchorMenu(){return this.configuration.anchorConfiguration.type!==C.GridAnchorType.NONE&&this.getIconAnchorModel()&&this.getIconAnchorModel().nodes&&this.getIconAnchorModel().nodes.length>0}getIconAnchorModel(){return this.gridPageCollection.getAnchorModel()}getIconAnchorStyle(){return this.getIconAnchorModel().iconAnchorStyle}getAnchorClass(){return""}getPageBodyClass(){return this.canShowIconAnchorMenu()?"show-anchor-menu":""}getPageClass(){return i(["gridcontroller",...this.pageClasses])}getParentPage(){return this.getCurrentPage()&&this.getCurrentPage().getParentPage()}hasParentPage(){return void 0!==this.getParentPage()}getPageTitle(){return this.getCurrentPage()?this.getCurrentPage().getAnchorTitle():""}hasPageFilters(){return void 0!==this.pageUFSMenus}getPageFilters(){return this.pageUFSMenus}canShowPageFilters(){return void 0!==this.configuration.pageFilters&&this.configuration.pageFilters.allowedFilterTypes.length>0}getFilterBarController(){return this.filterBarController}getFilterMenuColor(){return this.filterMenuColor}getMenuConfig(e){return{shouldInvertFilters:this.pageState.getAllowedPages().isSearchAdvanced(),showSelectionAsLabel:this.canShowMenuSelectionAsLabel(e),shouldExpandSingleCategory:this.canExpandSingleCategory(e)}}buildMenuAttributes(e,t){const i={topicMenu:e,config:this.getMenuConfig(e),selectionModes:this.buildFilterSelectionModes(e)};return"COUNTRIES"===e.getType()&&(i.controller=new v.FilterFormSuggestionsController(new y.GeolocalizationSuggestionEndpoint,i.topicMenu)),i}buildFilterSelectionModes(e){return e.hasInvertFilter()?[{id:D.FilterMenuSelectionModeType.INCLUDE,description:_.contextData.getMessage("_1894564"),label:_.contextData.getMessage("_1894563"),selected:!e.invertFilter,onSelected:()=>{e.invertFilter=!1}},{id:D.FilterMenuSelectionModeType.EXCLUDE,description:_.contextData.getMessage("_1894567"),label:_.contextData.getMessage("_1894566"),selected:e.invertFilter,onSelected:()=>{e.invertFilter=!0}}]:[]}canShowMenuSelectionAsLabel(e){return!1}canExpandSingleCategory(e){return!1}getFixedGridHeight(){return c.PAGE_WITHOUT_SIDEBAR_WIDTH*(9/16)}getBottomBannerHeight(){return 0}resetPageFilters(){this.configuration.pageFilters.enableFilterTypesReset&&(this.resetAllowedFilterTypes(),this.initializePageFilters())}resetAllowedFilterTypes(){this.configuration.pageFilters.allowedFilterTypes=this.pageState.getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).map(e=>e.getType())}updateFilterMenus(){this.pageFiltersUpdateTs=Date.now()}}__decorate([r.debounce(10),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],x.prototype,"recomputeGridSize",null),t.GridPageController=x}),define("classes/grid/interfaces",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/grid/grid_configuration",["require","exports"],function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NEVER=0]="NEVER",e[e.IF_SKELETON=1]="IF_SKELETON",e[e.ALWAYS=2]="ALWAYS"}(i=t.PlaceholderMode||(t.PlaceholderMode={})),t.generateDefaultGridConfig=function(e,t){return{id:e.id,pageNumber:t,dropzonePlaceholders:{},style:{items:{},grid:{},background:{backgroundImage:e.slide_metadata?e.slide_metadata.background_image:void 0,backgroundGrid:void 0}},width:0,height:0,gridItemOptions:{showPlaceholder:i.NEVER,interactive:!0},restrictedAreas:[],showPageNumber:!1}}}),define("classes/grid/grid",["require","exports","background_grid","data_structures","event","event_bus","generic_selection","log","map","math_utils","underscore","classes/grid/grid_slot"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});class u{constructor(e){this.setConfiguration(e),this.items=new c.Map,this.updateSelectableItems(),this.onUpdate=new s.Event,this.onRemoveItem=new s.Event,this.onAddItem=new s.Event,this.onRemoveSubItem=new s.Event,this.onTransformItem=new s.Event,this.onStackItem=new s.Event,this.onCloneItem=new s.Event,this.onSwapItem=new s.Event,this.onDeletePressed=new s.Event}static getLastItemSelection(){return u.lastItemSelection}get width(){return this.configuration.width}get height(){return this.configuration.height}get length(){return this.width*this.height}get restrictedAreas(){return this.configuration.restrictedAreas}getConfiguration(){return this.configuration}setConfiguration(e){this.configuration=e,this.initializeSlots()}initializeSlots(){const e=this.slots;this.slots=n.SquareArray.createFromDimensions(this.width,this.height),this.slots.forEach((t,i,n,s)=>{s[n]=new g.GridSlot(i,n,n*this.width+i),e&&e.has(i,n)&&s[n].setOwner(e.getItem(i,n).getOwner())})}expand(e){this.setSize(e.add(new l.Vector2D(this.width,this.height))),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_CELLS_ADDED,value:{id:this.getConfiguration().id,amountAdded:e}})}shrink(e){this.setSize(e.flip().add(new l.Vector2D(this.width,this.height))),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_CELLS_REMOVED,value:{id:this.getConfiguration().id,amountAdded:e}})}setSize(e){this.configuration.width=e.x,this.configuration.height=e.y,this.initializeSlots(),this.backgroundCanvasGrid&&this.backgroundCanvasGrid.updateGridSize(e)}setContainerDimensions(e){this.containerWidth=e[0]||this.containerWidth,this.containerHeight=e[1]||this.containerHeight}getContainerDimensions(){return[this.containerWidth,this.containerHeight]}getCellHeight(){return this.containerHeight/this.getHeight()}getCellWidth(){return this.containerWidth/this.getWidth()}createBackgroundCanvasGrid(e,t){this.containerWidth=e.offsetWidth||this.containerWidth,this.containerHeight=e.offsetHeight||this.containerHeight,$(e).empty(),this.backgroundCanvasGrid=new i.BackgroundCanvasGrid(e,{canvasSize:new l.Vector2D(this.containerWidth,this.containerHeight),canvasDomClass:"noselect",gridSize:new l.Vector2D(this.width,this.height),style:{default:{gridLineDashPattern:[2,4],gridLineColor:t.background.backgroundGrid.zoneGridColor},active:{gridLineDashPattern:[],gridLineColor:t.background.backgroundGrid.activeZoneGridColor||t.background.backgroundGrid.zoneGridColor},invalid:{gridLineDashPattern:[],gridLineColor:t.background.backgroundGrid.invalidGridColor||t.background.backgroundGrid.zoneGridColor}}})}addItem(e){const t=this.items.values().find(t=>t.getCompositionId()===e.getCompositionId());t?t.merge(e):(e.setGrid(this),this.items.set(e.getId(),e),this.updateSlotsOfItem(e,t=>t.setOwner(e)),this.updateSelectableItems(),this.onAddItem.fire(e),this.onUpdate.fire())}addItems(e){e.forEach(e=>this.addItem(e))}removeItem(e){this.items.has(e.getId())&&(this.removeItemWithoutEvent(e),this.updateSelectableItems(),e.getItems().forEach(e=>{this.onRemoveSubItem.fire(e)}),this.onRemoveItem.fire(e),this.onUpdate.fire())}removeItemWithoutEvent(e){this.items.has(e.getId())&&(this.items.delete(e.getId()),this.updateSlotsOfItem(e,e=>e.setOwner(void 0)))}removeItemById(e){this.removeItem(this.getItemById(e))}hasItem(e){return this.items.values().includes(e)}hasItemId(e){return this.items.has(e)}getItemById(e){return this.items.get(e)}getItems(){return this.items.values()}getItemsContainingSubItemId(e){return this.items.values().filter(t=>t.hasItemId(e))}cleanupDuplicateSubItemsById(e){const t=this.getItemsContainingSubItemId(e),i=t.shift();t.forEach(e=>{i.addItemIds(e.getItemIds()),this.removeItemWithoutEvent(e)}),this.updateSlotsOfItem(i,e=>e.setOwner(i)),this.updateSelectableItems(),this.update()}forEachItem(e){this.items.forEach(e)}indexOfItem(e){return this.items.values().indexOf(e)}updateSelectableItems(){this.selectableItems=new r.Selection(this.items.values().slice().sort((e,t)=>{const i=e.getSlotConfiguration().grid_x+e.getSlotConfiguration().grid_y*this.getWidth(),n=t.getSlotConfiguration().grid_x+t.getSlotConfiguration().grid_y*this.getWidth();return i<n?-1:i>n?1:0}))}multipleItemsSelected(){return this.selectableItems.get().length>1}getSelectedItems(){return this.selectableItems.get()}getSelectedItem(){return this.selectableItems.get()[0]}toggleItemSelection(e,t=!1,i=!1){const n=this.selectableItems.getList().indexOf(e);e.selected?(this.selectableItems.deselect(n),u.lastItemSelection=void 0,o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,value:{grid:this,item:void 0}})):(this.selectableItems.toggle(n,t,i),u.lastItemSelection=e,o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,value:{grid:this,item:e}}))}unselectItem(e){const t=this.selectableItems.getList().indexOf(e);this.selectableItems.deselect(t),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,value:{grid:this,item:void 0}})}clearItemSelection(){this.selectableItems.clear(),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,value:{grid:this,item:void 0}})}updateSlotsOfItem(e,t){const i=e.getSlotConfiguration(),n=this.getRectangularSlotRegion(i.grid_y,i.grid_y+i.height-1,i.grid_x,i.grid_x+i.width-1);d.flatten(n).forEach(t)}getWidth(){return this.width}getHeight(){return this.height}getLength(){return this.length}getSlots(){return this.slots}getSelectionBounds(){let e=1/0,t=0,i=1/0,n=0;return this.getSelectedSlots().forEach(s=>{e=Math.min(s.getColumn(),e),i=Math.min(s.getRow(),i),t=Math.max(s.getColumn(),t),n=Math.max(s.getRow(),n)}),new l.Rectangle(new l.Vector2D(e,i),t-e+1,n-i+1)}getSelectedSlots(e=0,t=0){const i=this.getSelectedItems(),n=this.slots.flatten().filter(e=>i.includes(e.getOwner()));return e||t?n.filter(i=>{const n=i.getColumn()+e,s=i.getRow()+t;return this.slots.has(n,s)}).map(i=>{const n=i.getColumn()+e,s=i.getRow()+t;return this.slots.getItem(n,s)}):n}getSlot(e,t){if(this.isValidColumnIndex(e)){if(this.isValidRowIndex(t))return this.slots.getItem(e,t);a.logService.error(`y must be between 0 and ${this.height-1}`)}else a.logService.error(`x must be between 0 and ${this.width-1}`)}getSlotAtIndex(e){if(!this.isValidIndex(e))return void a.logService.error(`x must be between 0 and ${this.length-1}`);const t=Math.floor(e/this.width),i=e%this.width;return this.slots.getItem(i,t)}getRectangularSlotRegion(e,t,i,s){if(this.isValidRowIndex(e)&&this.isValidRowIndex(t)){if(this.isValidColumnIndex(i)&&this.isValidColumnIndex(s))return n.SquareArray.fromSquareArray(this.slots,i,e,s-i+1,t-e+1).getData();a.logService.error(`start- and endcolumn must be between 0 and ${this.width-1}`)}else a.logService.error(`start- and endrow must be between 0 and ${this.height-1}`)}clear(){this.items.clear(),this.updateSelectableItems(),this.initializeSlots()}dispose(){this.disposed=!0,this.slots=void 0,this.selectableItems=void 0,this.items=void 0}isValidColumnIndex(e){return e>=0&&e<this.width}isValidRowIndex(e){return e>=0&&e<this.height}isValidIndex(e){return e>=0&&e<this.length}update(){this.onUpdate.fire()}debugPrint(e=!1){d.flatten(Object.values(this.slots)).forEach(t=>t.debugPrint(e))}debugASCII(){let e="";for(let t=0;t<this.height;++t){let i="|";for(let e=0;e<this.width;++e){const n=this.getSlot(e,t);n.hasOwner()?i+=this.items.values().indexOf(n.getOwner()).toString(36).toUpperCase():i+=" ",i+="|"}e+=i+"\n"}console.log(e)}}t.Grid=u}),define("services/grid_spacial",["require","exports","math_utils"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{hasNeighbour(e,t,i){return void 0!==this.getNeighbour(e,t,i)}getNeighbour(e,t,i){const n=this.computeTargetPosition(t,i);return this.getTarget(e,n)}isAtTheBottomEdge(e,t){const i=t.getSlotConfiguration();return e<=i.grid_y+i.height}getItemsInArea(e,t,i=[]){const n=[];for(let s=t.x;s<t.x+t.width;s++)for(let o=t.y;o<t.y+t.height;o++){const t=e.getSlot(s,o).getOwner();!t||n.includes(t)||i.includes(t)||n.push(t)}return n}getBestFittingNeighbour(e,t,i,n=[]){if(0!==i.x&&0!==i.y)throw new Error("method not implemented for diagonal directions");i.sign();const s=this.computeAreaByDirection(t,i);for(let t=s.x,o=s.y;t>=0&&t<e.getWidth()&&o>=0&&o<e.getHeight();t+=i.x,o+=i.y){s.x=t,s.y=o;const i=this.getItemsInArea(e,s,n);if(i.length>0)return i[0]}}isAreaEmpty(e,t,i=[]){return this.isAreaInBounds(e,t)&&0===this.getItemsInArea(e,t,i).length}isAreaInBounds(e,t){return t.x>=0&&t.y>=0&&t.right<=e.getWidth()&&t.bottom<=e.getHeight()}getTarget(e,t){return e.getSlot(t.x,t.y).getOwner()}findAligningSize(e,n,s=[]){const o={grid_x:n.x,grid_y:n.y,width:1,height:1};let r=this.getBestFittingNeighbour(e,o,new i.Vector2D(-1,0),s);r||(r=t.gridSpacialService.getBestFittingNeighbour(e,o,new i.Vector2D(1,0),s));const a=t.gridSpacialService.getLargestFreeAreaBySlice(e,t.gridSpacialService.getLargestFreeHorizontalSlice(e,n,s),s);if(r){const e=r.getSlotConfiguration().grid_y;if(e>=a.position.y&&e<a.position.y+a.height){const t=e-a.position.y;a.position.y+=t,a.height-=t}a.height=Math.min(a.height,r.getSlotConfiguration().height)}return a}findSymmetricSize(e,t,i){const n=this.getLargestFreeHorizontalSlice(e,t,i.ignoreItems||[]),s=this.getLargestFreeVerticalSlice(e,t,i.ignoreItems||[]),o=Math.min(i.minWidth||n.width,n.width);if(i.horizontalSymmetry){const e=Math.abs(n.x-t.x);n.x+=e,n.width-=2*e}i.maxWidth&&(n.width=Math.min(n.width,i.maxWidth));const r=this.inflateAreaDownwards(e,n,i.ignoreItems||[]),a=Math.min(i.minHeight||r.height,r.height);if(i.verticalSymmetry){const e=Math.abs(s.y-t.y);i.maxVerticalSymmetryDistance&&e<=i.maxVerticalSymmetryDistance&&(r.height-=e)}if(i.aspectRatio){const e=r.width/i.aspectRatio;r.height=Math.min(r.height,e)}return i.maxHeight&&(r.height=Math.min(r.height,i.maxHeight)),r.size.floor(),r.width<o&&(r.width=o),r.height<a&&(r.height=a),r}getLargestFreeVerticalSlice(e,t,n){const s=this.getTopBound(e,t,n),o=this.getBottomBound(e,t,n);return new i.Rectangle(new i.Vector2D(t.x,s),o-s+1,1)}getLargestFreeHorizontalSlice(e,t,n){const s=this.getLeftBound(e,t,n),o=this.getRightBound(e,t,n);return new i.Rectangle(new i.Vector2D(s,t.y),o-s+1,1)}getLargestFreeAreaBySlice(e,t,i){const n=t.clone();if(1===t.width){for(let s=t.x-1;s>=0&&(n.x=s,this.isAreaEmpty(e,n,i));s--)t.x--,t.width++;for(let s=t.x+t.width;s<e.getWidth()-1&&(n.x=s,this.isAreaEmpty(e,n,i));s++)t.width++}else{if(1!==t.height)throw new Error("this function can only work with slices, the rectangle must either have width 1 or height 1");for(let s=t.y-1;s>=0&&(n.y=s,this.isAreaEmpty(e,n,i));s--)t.y--,t.height++;this.inflateAreaDownwards(e,t,i)}return t}inflateAreaDownwards(e,t,i){const n=t.clone();n.height=1;for(let s=t.y+t.height;s<e.getHeight()-1;s++){if(n.y=s,!this.isAreaEmpty(e,n,i))return t;t.height++}return t}getLeftBound(e,t,i){const n=t.clone();for(let s=t.x-1;s>=0;s--)if(n.x=s,this.isOccupied(e,n,i))return s+1;return 0}getRightBound(e,t,i){const n=t.clone();for(let s=t.x+1;s<e.getWidth();s++)if(n.x=s,this.isOccupied(e,n,i))return s-1;return e.getWidth()-1}getTopBound(e,t,i){const n=t.clone();for(let s=t.y-1;s>=0;s--)if(n.y=s,this.isOccupied(e,n,i))return s+1;return 0}getBottomBound(e,t,i){const n=t.clone();for(let s=t.y+1;s<e.getHeight();s++)if(n.y=s,this.isOccupied(e,n,i))return s-1;return e.getHeight()-1}isOccupied(e,t,i){const n=e.getSlot(t.x,t.y);return n.getOwner()&&!i.includes(n.getOwner())}computeAreaByDirection(e,t){if(0!==t.x&&0!==t.y)throw new Error("method not implemented for diagonal directions");let n,s;return t.floor(),n=t.x>0?e.grid_x+e.width-1+t.x:e.grid_x+t.x,s=t.y>0?e.grid_y+e.height-1+t.y:e.grid_y+t.y,new i.Rectangle(new i.Vector2D(n,s),Math.abs(t.x)||e.width,Math.abs(t.y)||e.height)}computeTargetPosition(e,t){let n,s;return t.floor(),n=t.x>0?e.grid_x+e.width-1+t.x:e.grid_x+t.x,s=t.y>0?e.grid_y+e.height-1+t.y:e.grid_y+t.y,new i.Vector2D(n,s)}validateDimensionLimit(e,t){return!t||e.width<=t.max_width&&e.width>=t.min_width&&e.height<=t.max_height&&e.height>=t.min_height}}t.GridSpacialService=n,t.gridSpacialService=new n}),define("classes/grid/grid_slot_item",["require","exports","log","math_utils","underscore","services/grid_spacial","services/tw_common","classes/application/application"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(e,t){this.getItemById=t,this.id=c.nextId++,this.itemIds=e,this.index=0,this.nextRotation=Date.now()}get items(){return this.itemIds.map(e=>this.getItemById(e))}set items(e){this.itemIds=e.map(e=>e.getId())}static getWidgetByIdFunction(e){return void 0!==e?e.getWidgetById.bind(e):a.mainApplication.getWidgetById.bind(a.mainApplication)}static generateSlotItems(e,t){return s(e).chain().groupBy(e=>{const t=e.getSlotConfiguration();return`${t.grid_x}-${t.grid_y}`}).map(e=>{const i=s.uniq(e.map(e=>e.getSlotConfiguration().grid_z)).map((t,i)=>e[i]);return new c(i.map(e=>e.getId()),t)}).value()}setItems(e){this.items=e}getItems(){return this.items}getItemIds(){return this.itemIds}addItemIds(e){this.itemIds=s.union(this.itemIds,e)}getItemAt(e){return this.items[e]}getItemCount(){return this.items.length}getNextZPosition(){const e=this.items.map(e=>e.getSlotConfiguration().grid_z).sort((e,t)=>e-t);return e[e.length-1]+1}hasMultipleItems(){return this.getItemCount()>1}hasItem(e){return-1!==this.items.indexOf(e)}hasItemId(e){return this.itemIds.includes(e)}removeItem(e){const t=this.items.indexOf(e);if(-1!==t)if(1===this.getItemCount()&&this.hasGrid())this.getGrid().removeItem(this);else{this.hasGrid()&&this.getGrid().onRemoveSubItem.fire(e),t===this.getItemCount()-1&&this.previous(),this.itemIds.splice(t,1),this.hasGrid()&&this.grid.updateSelectableItems()}}removeItemById(e){this.removeItem(this.getItemById(e))}next(){this.index=(this.index+1)%this.items.length}previous(){this.index=(this.index-1+this.items.length)%this.items.length}splitCurrent(){if(this.hasMultipleItems()){const e=this.itemIds.splice(this.index,1);return this.getItemById(e[0]).attachTemplate(void 0),this.previous(),new c(e,this.getItemById)}return this}removeCurrent(){this.removeItem(this.getCurrentItem())}getNextItem(){return this.items[(this.index+1)%this.items.length]}getCurrentItem(){return this.items[this.index]}isMovable(){return this.getCurrentItem().isMovable()}getTemplate(){return this.template}getHandleCSSProperties(){let e,t,i,n,s,o;if(this.multiSelectionActive()){this.getGrid().getSelectedItems().forEach(e=>{const t=e.getTemplate().offset().left,r=e.getTemplate().offset().top,a=e.getTemplate().offset().left+e.getTemplate().width(),c=e.getTemplate().offset().top+e.getTemplate().height();i=i?Math.min(i,t):t,n=n?Math.min(n,r):r,s=s?Math.max(s,a):a,o=o?Math.max(o,c):c}),e=s-i,t=o-n}else e=this.getTemplate().width(),t=this.getTemplate().height(),i=this.getTemplate().offset().left,n=this.getTemplate().offset().top;return{width:e,height:t,left:i,top:n}}getWidth(){return this.getSlotConfiguration().width}getHeight(){return this.getSlotConfiguration().height}getDropZoneConfiguration(){return this.getCurrentItem().getDropZoneConfiguration()}getSlotConfiguration(){return this.getCurrentItem().getSlotConfiguration()}updateSlotConfiguration(e){const t=s.clone(this.getSlotConfiguration()),i=this.createAreaFromSlotConfiguration(e);let n=!1;this.hasGrid()&&this.updateArea(i,!1,this.getDefaultIgnoreItems(),!1)&&(n=!0,this.update()),this.getItems().forEach((t,i)=>t.updateSlotConfiguration(Object.assign({},e,{grid_z:i}))),n&&this.grid.onTransformItem.fire(this,t)}getDefaultIgnoreItems(){return this.multiSelectionActive()?this.getGrid().getSelectedItems():[this]}hasSlotConfiguration(){return this.getCurrentItem().hasSlotConfiguration()}updateAreaInSlotConfiguration(e){this.getItems().forEach(t=>t.updateSlotConfiguration({grid_x:e.x,grid_y:e.y,width:e.width,height:e.height}))}hasTemplate(){return void 0!==this.template}attachTemplate(e){this.template=e}isEqualTo(e){return this.getItemCount()===e.getItemCount()&&this.hasSameSlotAs(e)}hasSameSlotAs(e){const t=this.getSlotConfiguration(),i=e.getSlotConfiguration();return t.grid_x===i.grid_x&&t.grid_y===i.grid_y}validate(){return!this.getItems().some((e,t)=>e.getSlotConfiguration().grid_z!==t)||(i.logService.debug("Not all items in slot item have a valid grid_z index, updating all configurations!",r.twCommon.logFeatures.Grid,{items:this.getItems()}),this.getItems().forEach((e,t)=>{e.updateSlotConfiguration(Object.assign({},e.getSlotConfiguration(),{grid_z:t}))}),!1)}merge(e){this.items=e.items,this.index=this.index%this.items.length}setNextRotationTime(e){this.nextRotation=e}getNextRotationTime(){return this.nextRotation}getCompositionId(){return this.getItems().map(e=>e.getId()).join("_")}getId(){return this.id.toString()}getCurrentItemId(){return this.items[this.index].getId()}get selected(){return this.getCurrentItem().selected}set selected(e){this.getCurrentItem().selected=e}multiSelectionActive(){return this.hasGrid()&&this.getGrid().multipleItemsSelected()&&this.selected}hasGrid(){return!!this.grid}setGrid(e){this.grid=e}getGrid(){return this.grid}update(){this.hasGrid()&&this.grid.update()}updateArea(e,t=!1,i=[this],r=!0){const a=s.clone(this.getSlotConfiguration());if(!this.createAreaFromSlotConfiguration(a).isEquivalentTo(e)&&o.gridSpacialService.isAreaEmpty(this.grid,e,i)){const i=Math.min(a.grid_x,e.x),s=Math.min(a.grid_y,e.y),o=Math.max(a.grid_x+a.width,e.right),c=Math.max(a.grid_y+a.height,e.bottom);for(let t=i;t<o;++t)for(let i=s;i<c;++i){const s=this.grid.getSlot(t,i);e.containsPoint(new n.Vector2D(t,i))?s.setOwner(this):s.getOwner()===this&&s.setOwner(void 0)}return t&&this.updateAreaInSlotConfiguration(e),this.hasGrid()&&r&&(this.getGrid().onTransformItem.fire(this,a),this.getGrid().updateSelectableItems()),this.update(),!0}return!1}resize(e){const t=this.getSlotConfiguration(),i=t.width+e.x,s=t.height+e.y;if(i<this.getSlotConfiguration().dimension_limit.min_width||i>this.getSlotConfiguration().dimension_limit.max_width||s<this.getSlotConfiguration().dimension_limit.min_height||s>this.getSlotConfiguration().dimension_limit.max_height)return!1;const o=new n.Rectangle(new n.Vector2D(t.grid_x,t.grid_y),t.width+e.x,t.height+e.y);return this.updateArea(o,!0)}move(e,t=[this]){const i=this.getSlotConfiguration(),s=new n.Vector2D(i.grid_x+e.x,i.grid_y+e.y),o=new n.Rectangle(s,i.width,i.height);return this.updateArea(o,!0,t)}swap(e){const t=this.createAreaFromSlotConfiguration(this.getSlotConfiguration()),i=this.createAreaFromSlotConfiguration(e.getSlotConfiguration());return!(!this.updateArea(i,!0,[this,e],!1)||!e.updateArea(t,!0,[this,e],!1))&&(this.hasGrid()&&this.getGrid().onSwapItem.fire(e,this),!0)}stack(e){e.hasGrid()&&e.getGrid().removeItemWithoutEvent(e);const t=s.omit(this.getSlotConfiguration(),["dimension_limit"]);return this.setItems(s.union(e.getItems(),this.getItems())),this.updateSlotConfiguration(t),this.hasGrid()&&(this.getGrid().onStackItem.fire(e,this),this.getGrid().update()),!0}createAreaFromSlotConfiguration(e){return new n.Rectangle(new n.Vector2D(e.grid_x,e.grid_y),e.width,e.height)}}c.nextId=1,t.GridSlotItem=c}),define("classes/grid/anchor/grid_preview_anchor_model",["require","exports","reusable_components","math_utils","services/grid_drag_handle","other/tw","event_bus","classes/grid/grid_slot_item","classes/context_data/context_data","jquery","classes/grid/anchor/grid_anchor_model","event","classes/grid/anchor/grid_anchor_configuration","talkwalker_constants"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});const h=.17;t.GridPreviewAnchorModel=class extends d.GridAnchorModel{get scaleFactor(){return this.options.previewScale}constructor(e,t,s={}){super(t),this.options={gridWidth:s.gridWidth||1057,aspectRatio:s.aspectRatio||t.grid.aspect_ratio,previewScale:s.previewScale||h},this.initializeNodes(e);const o=this.options.gridWidth*this.options.previewScale;this.nodeSize=new n.Vector2D(o+40,o*(1/this.options.aspectRatio)+20),this.nodeOffset=n.Vector2D.zero(),this.className="sidebar-scrolling",this.maxNodeCount=c.contextData.getLimit("report_slides"),this.deleteButtonIcon="fa fa-trash",this.editButtonIcon="icon-tw-gear",this.dropzoneChannels=["previews"],this.swappingConfiguration={type:i.DropzoneType.self,callback:(e,t,i)=>this.swappingCallback(e,t,i)},this.addButtonDropZone={acceptChannels:()=>this.pageConfig.pages.map(e=>e.id),onDragEnter:(e,t,i)=>this.onPreviewNodeDragEnter(e,t,i,""),onDragLeave:(e,t,i)=>this.onPreviewNodeDragLeave(e,t,i,""),onDragStop:(e,t,i)=>this.onPreviewNodeDragStop(e,t,i)},this.onAdd=new g.Event,this.onDelete=new g.Event,this.onEdit=new g.Event,this.onMoveItemToPage=new g.Event}initializeNodes(e){let t;if(this.nodes&&(t=this.getSelectedNode().id),this.nodes=e.map((e,t)=>this.createDefaultPreviewNode(e.getId(),e.getConfiguration().style.background.backgroundImage,0===t,e.getGrid().getItems().length>0)),t){const e=this.nodes.find(e=>e.id===t);e&&(this.nodes.forEach(e=>e.selected=!1),e.selected=!0)}}addPage(e){}removePage(e){}onClick(e,t,i,n){i.nodes.find(e=>e.selected)!==t&&(i.nodes.forEach(e=>e.selected=e===t),r.eventBus.dispatch({type:r.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,value:t}),this.changeActiveGridPage(t.id))}deleteNode(e){this.getSelectedNode().id===e.id&&(this.selectNextAnchorNode(!0)||this.selectPreviousAnchorNode()||this.nodes.forEach(e=>e.selected=!1)),this.onDelete.fire(e),r.eventBus.dispatch({type:r.EVENT_TYPES.REMOVE_ANCHOR_PREVIEW_NODE,value:e.id})}onDeleteButtonClick(e){this.deleteAction?this.deleteAction(e).then(()=>{this.deleteNode(e)}).catch(()=>{throw new Error("Deleting of anchor node failed")}):this.deleteNode(e)}editNode(e){this.onEdit.fire(e)}onEditButtonClick(e){this.editAction?this.editAction(e).then(()=>{this.editNode(e)}).catch(()=>{throw new Error("Editing of anchor node failed")}):this.editNode(e)}async addNode(){const e=await this.addAction();this.onAdd.fire();const t=e.slide_metadata&&e.slide_metadata.background_image?e.slide_metadata.background_image:"",i=this.createDefaultPreviewNode(e.id,t,!1,!1);let s;return e.anchor_metadata&&e.anchor_metadata.icon&&(s=e.anchor_metadata.icon),e.grid&&(i.gridSize=new n.Vector2D(e.grid.width,e.grid.height)),e.anchor_metadata&&(i.icon={icon:{type:s,customIconData:s===p.PageIcon.CUSTOM?{type:e.anchor_metadata.custom_icon_data.type,content:e.anchor_metadata.custom_icon_data.content}:void 0},pageTitle:e.anchor_metadata.title}),r.eventBus.dispatch({type:r.EVENT_TYPES.ADD_ANCHOR_PREVIEW_NODE,value:i}),e}onAddButtonClick(){if(!this.addAction)throw new Error("addAction required");this.addNode().then().catch(()=>{throw new Error("An error occurred while adding a new page")})}onPreviewNodeDragEnter(e,t,i,n){if(t.sharedData.isResize)return;const o=t.model;t.sharedData={scale:this.options.previewScale},o.hasItemId("template")||o.getCurrentItem().getSlotConfiguration().page===n?s.gridDragHandleService.setAsInvalid(t.dragHandle):(i.style.backgroundColor="blue",t.dragHandle.style.transform=`scale(${this.options.previewScale})`,s.gridDragHandleService.setAsValid(t.dragHandle))}onPreviewNodeDragLeave(e,t,i,n){t.sharedData.isResize||t.model.getCurrentItem().getSlotConfiguration().page!==n&&(t.sharedData={},i.style.backgroundColor="",t.dragHandle.style.transform="",s.gridDragHandleService.setAsInvalid(t.dragHandle))}async onPreviewNodeDragStop(e,t,i,n){if(!t.sharedData.isResize&&!t.model.hasItemId("template")){s.gridDragHandleService.setAsInvalid(t.dragHandle),t.sharedData={},i.style.backgroundColor="",t.dragHandle.style.transform="";try{n||(n=(await this.addNode()).id)}catch(e){return}await this.moveItemToPage(t.model.getCurrentItem(),this.getSelectedNode().id,n,t.model.getItemById)}}async moveItemToPage(e,t,i,n){if(e.getSlotConfiguration().page!==i)try{r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_REMOVE_SUB_ITEM,value:{gridId:t,itemId:e.getId()}}),this.moveItemToPageAction&&await this.moveItemToPageAction(e,t,i),r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:i,item:a.GridSlotItem.generateSlotItems([e],n)[0]}}),o.tw.inject("$rootScope").$applyAsync(),setTimeout(()=>{r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:t}}),r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:i}})}),this.onMoveItemToPage.fire(e,t,i)}catch(e){throw new Error("Moving of item failed")}}swappingCallback(e,t,i){const n=this.nodes.indexOf(e),s={movedNode:e,oldIndex:n,newIndex:i};this.nodes.splice(n,1),this.nodes.splice(i,0,e),r.eventBus.dispatch({type:r.EVENT_TYPES.ANCHOR_PREVIEW_NODE_MOVED,value:s});for(let e=0;e<this.nodes.length;e++)this.nodes[e].selected&&r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,value:{pageId:this.nodes[e].id}}),r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_UPDATE_PAGE_NUMBER,value:{id:this.nodes[e].id,pageNumber:e+1}})}createDefaultPreviewNode(e,t,i,n){return this.createPreviewNode(e,l(`<div class="default-anchor-preview"\n                    style="background: url('${t}') no-repeat;\n                    background-size: contain;">\n                    ${n?'\n                        <div class="tw-splashscreen" style="transform:scale(5)">\n                            <div class="loader"></div>\n                        </div>\n                    ':""}\n                </div>`)[0],i)}createPreviewNode(e,t,i){return{id:e,selected:i,dropZone:{acceptChannels:()=>this.pageConfig.pages.map(e=>e.id),onDragEnter:(t,i,n)=>this.onPreviewNodeDragEnter(t,i,n,e),onDragLeave:(t,i,n)=>this.onPreviewNodeDragLeave(t,i,n,e),onDragStop:(t,i,n)=>this.onPreviewNodeDragStop(t,i,n,e)},preview:t}}getType(){return u.GridAnchorType.PREVIEW}}}),define("classes/grid/anchor/grid_anchor_configuration",["require","exports"],function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.ICON=1]="ICON",e[e.PREVIEW=2]="PREVIEW"}(i=t.GridAnchorType||(t.GridAnchorType={})),t.defaultGridAnchorConfiguration={type:i.NONE}}),define("services/grid_page_refresh",["require","exports","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_page_collection"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{setPageConfigurationFlags(e,t){if(void 0===n.GridPageCollection.getActiveAnchorModelIfAble()||n.GridPageCollection.getActiveAnchorModelIfAble().getType()!==i.GridAnchorType.ICON)return;const s=n.GridPageCollection.getActiveAnchorModelIfAble().getSelectedNode(),o=e.getPageConfiguration();if(this.clearPageConfigurationFlags(o),void 0!==s){let i;if(void 0!==t.pageNavigation){const e=t.pageNavigation;i=this.findGridPageByNavigation(o.pages,e)}else i=this.findGridPageById(o.pages,s.id);void 0!==i&&(o.active_page_id=i.id,i.refresh=!0,this.updateAllowedPages(e,i,t.pageNavigation))}}clearPageConfigurationFlags(e){delete e.active_page_id,e.pages.forEach(e=>delete e.refresh)}findGridPageById(e,t){return _.compact(_.flatten(e.map(e=>[e,e.pages]))).find(e=>e.id===t)}updateAllowedPages(e,t,i){const n=void 0!==i?i:t.navigation;if(void 0!==n){const{page_category:t,page_type:i}=n;void 0!==i&&e.getAllowedPages().setPageType(i),void 0!==t&&e.getAllowedPages().setPageCategory(t),e.getAllowedPages().setReload(!0)}}findGridPageByNavigation(e,t){return e.find(e=>e.navigation.page_category===t.page_category&&e.navigation.page_type===t.page_type)}}t.GridPageRefreshService=s,t.gridPageRefreshService=new s}),define("classes/refresh/decorator/page_state/grid_page_state_refresh_decorator",["require","exports","classes/refresh/decorator/page_state/page_state_refresh_decorator","services/grid_page_refresh","classes/refresh/model_state"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.GridPageStateRefreshDecorator=class extends i.PageStateRefreshDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return n.gridPageRefreshService.setPageConfigurationFlags(t,e),this.preparePageStateRefresh(t),e.noLoadingBubble||this.showSpinner(),{page_state:t.toProto(),is_skeleton:e.modelState===s.ModelState.PARTIAL}}processResponse(e,t){return super.processResponse(e,t)}}}),define("classes/refresh/decorator/page_state/grid_page_state_load_more_decorator",["require","exports","classes/refresh/decorator/page_state/page_state_load_more_decorator","services/grid_page_refresh"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.GridPageStateLoadMoreDecorator=class extends i.PageStateLoadMoreDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return n.gridPageRefreshService.setPageConfigurationFlags(t,e),e.noLoadingBubble||this.showSpinner(),{page_state:t.toProto()}}processResponse(e,t){const i=super.processResponse(e,t);return this.handleAngularScopeApply(),this.delayHideSpinnerBy(300),i}}}),define("classes/refresh/decorator/page_state/grid_page_state_reload_decorator",["require","exports","services/grid_page_refresh","classes/refresh/decorator/page_state/page_state_reload_decorator"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.GridPageStateReloadDecorator=class extends n.PageStateReloadDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return i.gridPageRefreshService.setPageConfigurationFlags(t,e),this.preparePageStateRefresh(t),e.noLoadingBubble||this.showSpinner(),{page_state:t.toProto()}}processResponse(e,t){return super.processResponse(e,t)}}}),define("classes/refresh/decorator/page_state/grid_page_state_refresh_no_cache_decorator",["require","exports","services/grid_page_refresh","classes/refresh/decorator/page_state/page_state_refresh_no_cache_decorator"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.GridPageStateRefreshNoCacheDecorator=class extends n.PageStateRefreshNoCacheDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return i.gridPageRefreshService.setPageConfigurationFlags(t,e),this.bypassCache(t),this.preparePageStateRefresh(t),this.showSpinner(),{page_state:t.toProto()}}processResponse(e,t){return super.processResponse(e,t)}}}),define("classes/refresh/model_refresh_decorator_factory",["require","exports","classes/refresh/model_type","log","classes/refresh/model_refresh_strategy","classes/refresh/decorator/page_state/page_state_load_more_decorator","classes/refresh/decorator/page_state/page_state_reload_decorator","classes/refresh/decorator/page_state/page_state_refresh_no_cache_decorator","classes/refresh/decorator/page_state/page_state_refresh_decorator","classes/refresh/decorator/widget_refresh_decorator","classes/refresh/decorator/page_state/grid_page_state_refresh_decorator","classes/refresh/decorator/page_state/grid_page_state_load_more_decorator","classes/refresh/decorator/page_state/grid_page_state_reload_decorator","classes/refresh/decorator/page_state/grid_page_state_refresh_no_cache_decorator"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});class h{getDecorator(e,t,s,o){switch(s){case i.ModelType.PAGE_STATE:return this.getPageStateDecorator(e,t,o);case i.ModelType.WIDGET:return new l.WidgetRefreshDecorator(e,t);default:n.logService.error(`Model type ${s} not implemented !`)}}getPageStateDecorator(e,t,i){return e.isGridPage()?this.getGridPageStateDecorator(e,t,i):this.getBasePageStateDecorator(e,t,i)}getGridPageStateDecorator(e,t,i){switch(i.strategy){case s.ModelRefreshStrategy.LOAD_MORE_CONTENT:return new g.GridPageStateLoadMoreDecorator(e,t);case s.ModelRefreshStrategy.RELOAD:return new u.GridPageStateReloadDecorator(e,t);case s.ModelRefreshStrategy.REFRESH_NO_CACHE:return new p.GridPageStateRefreshNoCacheDecorator(e,t);case s.ModelRefreshStrategy.REFRESH:default:return new d.GridPageStateRefreshDecorator(e,t)}}getBasePageStateDecorator(e,t,i){switch(i.strategy){case s.ModelRefreshStrategy.LOAD_MORE_CONTENT:return new o.PageStateLoadMoreDecorator(e,t,i.endpoint);case s.ModelRefreshStrategy.RELOAD:return new r.PageStateReloadDecorator(e,t,i.endpoint);case s.ModelRefreshStrategy.REFRESH_NO_CACHE:return new a.PageStateRefreshNoCacheDecorator(e,t,i.endpoint);case s.ModelRefreshStrategy.REFRESH:default:return new c.PageStateRefreshDecorator(e,t,i.endpoint)}}}t.ModelRefreshDecoratorFactory=h,t.modelRefreshDecoratorFactory=new h}),define("wrappers/navbar/navbar_wrapper",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.NavbarWrapper=class{constructor(e){this.model=e}getModel(){return this.model}}}),define("services/navbar",["require","exports","angular_utilities","event_bus","log","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","wrappers/navbar/navbar_wrapper","services/configuration","services/context","services/directive","services/refresh/model_refresh_service","services/rest_form_service","services/tw_routing","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y){var v;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OPEN=1]="OPEN",e[e.CLOSE=2]="CLOSE"}(v=t.FilterState||(t.FilterState={}));class S{constructor(){this.navbarWrapper=void 0,this.filterState=v.CLOSE,n.eventBus.subscribe(n.EVENT_TYPES.ON_CONTEXT_SWITCH,e=>this.reloadNavbar(e.value.promiseList))}async load(e){return this.setFilterState(e.getFilterState()),void 0===this.navbarWrapper&&(this.navbarWrapper=await this._requestingNavbarFromServer(e)),this.navbarWrapper}getNavbarModel(){return void 0!==this.navbarWrapper?this.navbarWrapper.getModel():void 0}getFilterState(){return this.filterState}setFilterState(e){const t=this.filterState;$(window).scrollTop(0),l.tw.pageState&&l.tw.pageState.getUserFilterSettings()&&(this.filterState!==v.CLOSE&&e!==v.OPEN?this.filtersHash!==l.tw.pageState.getUserFilterSettings().getHashSelectionState()&&this.refreshPageData():this.filterState!==v.OPEN&&e&&(this.filtersHash=o.mainApplication.getPageState().getUserFilterSettings().getHashSelectionState())),_.isBoolean(e)?this.filterState=e?v.OPEN:v.CLOSE:this.filterState=e,this.filterState!==t&&n.eventBus.dispatch({type:n.EVENT_TYPES.FILTER_STATE_CHANGE,value:this.filterState===v.OPEN})}async reloadNavbar(e){const i=$("[tw-navbar]"),n=i.parent(),s=i.scope();if(void 0!==s){const i=s.$$childHead&&s.$$childHead.navbarOptions||new(l.tw.inject("NavBarOptionsWrapper"))(u.contextService.getCurrentContext().id,void 0,u.contextService.getCurrentContext().scope);s.$destroy(),n.empty(),e.push(t.navbarService.reload(i).then(()=>{p.directiveService.inject(n,"tw-navbar",{"navbar-options":i})}))}}hideNavbar(){$("body").addClass("no-navbar"),$("[tw-navbar]").hide()}showNavbar(){$("body").removeClass("no-navbar"),$("[tw-navbar]").show()}async reload(e){return this.setFilterState(e.getFilterState()),this.navbarWrapper=await this._requestingNavbarFromServer(e),this.navbarWrapper}showOpenFilters(){return g.configurationService.getPageConfiguration(f.twRoutingService.getActivePage()).showFilters()}_requestingNavbarFromServer(e){const t=new y.Url(location.href).getUrlParameters(),i=t.m,n=t.cpid,s=t.a,o=t.am;let r;e.hasGroupPage()?(r="?group_page_id="+e.getGroupPage(),void 0!==s&&(r+="&"+constants.keys.application+"="+s),void 0!==o&&(r+="&"+constants.keys.module+"="+o)):r=_.isUndefined(f.twRoutingService.getGroupPage())?"?":"?group_page_id="+f.twRoutingService.getGroupPage();const a=_.isUndefined(i)?"":"&m="+i,c=_.isUndefined(n)?"":"&custom_page_id="+n;let d;return d="project"===l.tw.context?this._navBarRestFormCall(routes.controllers.tw.TWRestForm.get("project",l.tw.project_id,"navbar","show","","rform").url+r+a+c):"account"===l.tw.context?this._navBarRestFormCall(routes.controllers.tw.TWRestForm.get("account",l.tw.account_id,"navbar","show","","rform").url+r):this._navBarRestFormCall(routes.controllers.tw.TWRestForm.get("none","none","navbar","show","","rform").url)}async _navBarRestFormCall(e){return new d.NavbarWrapper(await m.restFormService.get(e))}async refreshPageData(){if(o.mainApplication.hasPageState()&&o.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp()&&o.mainApplication.getPageState().getWidgets().length>0&&o.mainApplication.getPageState().getWidgets()[0].isDocumentCluster()&&o.mainApplication.getPageState().getWidgets()[0].hasPayloadValue()&&o.mainApplication.getPageState().getWidgets()[0].getPayloadValue().graph)return;const e={strategy:a.ModelRefreshStrategy.REFRESH,delay:0},t=r.modelRefreshDecoratorFactory.getDecorator(o.mainApplication.getPageState(),o.mainApplication,c.ModelType.PAGE_STATE,e);try{await h.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after closing filters !",void 0,e)}}}__decorate([i.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],S.prototype,"load",null),__decorate([i.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],S.prototype,"reload",null),__decorate([i.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],S.prototype,"_navBarRestFormCall",null),t.NavbarService=S,t.navbarService=new S}),define("services/fullscreen",["require","exports","angular","jquery","underscore","event","other/tw","classes/context_data/context_data","services/rest_form_service","services/tw_common","services/tw_routing","angular_utilities","services/scroll","services/context","services/confirmation_service","reusable_utilities","services/browser_extension","services/application_mode","services/navbar","classes/application/application"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v){Object.defineProperty(t,"__esModule",{value:!0});let S=class{constructor(e){this.$rootScope=e,this.allowedPageIds=["DASHBOARD","SHARED_DASHBOARD","COMMAND_CENTER","SHARED_COMMAND_CENTER"],this.hasEnteredFullscreen=!1,this.isF11=!1,this.initFullscreenEventListeners(),this.setupEvents()}buildFullscreenElementList(){return[document.fullscreenElement,document.mozFullScreenElement,document.webkitFullscreenElement,document.msFullscreenElement]}isFullscreen(){if(f.applicationMode.getCurrentAppMode()===f.AppMode.IMAGE_EXPORT||navigator.userAgent.includes("HeadlessChrome"))return!1;if(f.applicationMode.getCurrentAppMode()===f.AppMode.SHARED_COMMAND_CENTER||window.live_view_mode_enabled&&l.twCommon.isBrowserFullScreen())return!0;const e=this.buildFullscreenElementList();return s.compact(e).length>0||this.isF11&&this.isPageAllowed()&&this.isNotEditMode()}isFullscreenModeAllowed(){return void 0!==r.tw.pageState&&this.isPageAllowed()&&this.isNotEditMode()}isPageAllowed(){const e=d.twRoutingService.getActivePage();return void 0!==e&&s.contains(this.allowedPageIds,e.getId())}isNotEditMode(){return!v.mainApplication.getPageState().isEditMode()}async enableFullscreen(){await n.when(this.updatePage(!0))}async disableFullscreen(){await n.when(this.updatePage(!1))}async goFullscreen(e=document.documentElement,t=!0){const i=this.launchIntoFullscreen(e);return t?i.then(()=>c.restFormService.get(routes.controllers.tw.TWRestForm.get(p.contextService.getCurrentContext().scope,p.contextService.getCurrentContext().id,"user_prefs","show","","rform").url)).then(e=>{if(!0===t){this.showConsentForm(e).then(e=>e?void 0:this.exitFullscreen())}}):i}updatePage(e){if(e)this.hasEnteredFullscreen=!0,n("body").addClass("full-screen"),y.navbarService.hideNavbar(),this.onEnter.fire(),u.scrollService.enable(),u.scrollService.snapToNearest();else{this.hasEnteredFullscreen=!1,n("body").removeClass("full-screen"),y.navbarService.showNavbar(),this.fullscreenExitTs=Date.now(),this.onExit.fire(),u.scrollService.disable();const e=r.tw.inject("$rootScope");e.$$phase||e.$apply()}}initFullscreenEventListeners(){n(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",()=>{this.isFullscreen()||(this.handleFsStateChange(),this.hasEnteredFullscreen=!1)})}handleFsStateChange(){this.updatePage(this.isFullscreen())}async showConsentForm(e){return e.consented_to_command_center?Promise.resolve(!0):h.confirmationService.display({message:{title:a.contextData.getMessage("_1000300"),message:a.contextData.getMessage("_1000301")}}).then(function(){const e=routes.controllers.tw.TWRestForm.post(p.contextService.getCurrentContext().scope,p.contextService.getCurrentContext().id,"user_prefs","update","","rform").url;return c.restFormService.post(e,{consented_to_command_center:!0}).then(()=>!0)},()=>!1)}async launchIntoFullscreen(e){const{requestFullscreen:t,mozRequestFullScreen:i,webkitRequestFullscreen:n,msRequestFullscreen:o}=e,r=s.first(s.compact([t,i,n,o]));return r&&r.call(e),await this.waitForElement(),this.handleFsStateChange()}async waitForElement(e=15e3){return m.promiseTimeout(new Promise(async e=>{for(;0===s.compact(this.buildFullscreenElementList()).length;)await m.waitFor(250);e()}),e,"Could not find fullscreen element!")}exitFullscreen(){const{exitFullscreen:e,mozCancelFullScreen:t,webkitExitFullscreen:i,msExitFullscreen:n}=document,o=s.first(s.compact([e,t,i,n]));o&&o.call(document),this.handleFsStateChange(),this.hasEnteredFullscreen=!1}update(){this.isFullscreen()!==this.hasEnteredFullscreen&&this.handleFsStateChange(),this.checkF11()}async checkF11(){this.isF11=await _.browserExtensionService.isAvailable()&&await _.browserExtensionService.isFullscreen()}setupEvents(){n(document.body).keyup(async e=>{this.isFullscreen()&&e.keyCode===m.Keys.ESCAPE&&await _.browserExtensionService.isAvailable()&&(await _.browserExtensionService.forceFullscreenMode(!1),this.updatePage(!1),r.tw.inject("$rootScope").$apply())}),this.onEnter=new o.Event,this.onExit=new o.Event}};S=__decorate([g.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],S),t.default=S,Object.defineProperty(t,"fullscreenService",{get:()=>r.tw.inject("fullscreenService")})}),define("configuration/widget/horizontal_bar_chart",["require","exports","configuration/widget/vertical_bar_chart","services/fullscreen","services/tw_common"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.HorizontalBarChartWidgetConfiguration=class extends i.VerticalBarChartWidgetConfiguration{getHeight(e){return n.fullscreenService.isFullscreen()||e.getPageState().getAllowedPages().isMonitor()?s.twCommon.widgetHeight.TINY:s.twCommon.widgetHeight.DYNAMIC}}}),define("configuration/widget/influencer_network",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkWidgetConfiguration=class extends i.BaseWidgetConfiguration{getHeight(){return n.twCommon.widgetHeight.HUGE}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/influencer_overview",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerOverViewWidgetConfiguration=class extends i.BaseWidgetConfiguration{hasReplayModes(e){return!1}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}}}),define("configuration/widget/table",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TableWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}hasReplayModes(e){return!1}isReplayable(e){return!1}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("wrappers/widget/widget_menu_wrapper",["require","exports","log","underscore","wrappers/topic_menu/topic_menu_wrapper","other/tw"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=!1){this.topicService=o.tw.inject("topicService"),i.logService.assert(void 0!==e,"widgetMenuProto missing"),n.isUndefined(e.search_mode)||(this.searchMode=new s.TopicMenuWrapper(e.search_mode)),n.isUndefined(e.timefilter_mode)||(this.timeFilterModeMenu=new s.TopicMenuWrapper(e.timefilter_mode)),n.isUndefined(e.view_mode)||(this.viewModeMenu=new s.TopicMenuWrapper(e.view_mode)),n.isUndefined(e.breakdown_options)||(this.breakdownOptionsMenu=new s.TopicMenuWrapper(e.breakdown_options)),n.isUndefined(e.theme_options)||(this.themeOptionsMenu=new s.TopicMenuWrapper(e.theme_options)),n.isUndefined(e.compatible_data_types)||(this.compatibleDataTypesMenu=new s.TopicMenuWrapper(e.compatible_data_types)),n.isUndefined(e.time_axis_options)||(this.timeAxisOptions=new s.TopicMenuWrapper(e.time_axis_options)),n.isUndefined(e.cluster_labels_menu)||(this.clusterLabelsMenu=new s.TopicMenuWrapper(e.cluster_labels_menu)),n.isUndefined(e.number_results_menu)||(this.numberResultsMenu=new s.TopicMenuWrapper(e.number_results_menu)),n.isUndefined(e.sort_menu)||(this.sortMenu=new s.TopicMenuWrapper(e.sort_menu)),n.isUndefined(e.group_menu)||(this.groupMenu=new s.TopicMenuWrapper(e.group_menu)),n.isUndefined(e.content_contains_type)||(this.contentContainsType=new s.TopicMenuWrapper(e.content_contains_type)),n.isUndefined(e.theme_bubble_sizes)||(this.themeBubbleSizes=new s.TopicMenuWrapper(e.theme_bubble_sizes)),n.isUndefined(e.author_source_menu)||(this.authorSourceMenu=new s.TopicMenuWrapper(e.author_source_menu)),n.isUndefined(e.page_monitoring)||(this.pageMonitoringMenu=new s.TopicMenuWrapper(e.page_monitoring)),n.isUndefined(e.hashtag_menu)||(this.hashtagMenu=new s.TopicMenuWrapper(e.hashtag_menu)),n.isUndefined(e.filters)||(this.filtersMenu=new s.TopicMenuWrapper(e.filters)),n.isUndefined(e.display_on_map_menu)||(this.displayOnMapMenu=new s.TopicMenuWrapper(e.display_on_map_menu)),n.isUndefined(e.result_rule_menu)||(this.resultRuleMenu=new s.TopicMenuWrapper(e.result_rule_menu)),n.isUndefined(e.export_menu)||(this.exportMenu=new s.TopicMenuWrapper(e.export_menu)),n.isUndefined(e.export_complete_menu)||(this.exportCompleteMenu=new s.TopicMenuWrapper(e.export_complete_menu)),n.isUndefined(e.share)||(this.shareMenu=new s.TopicMenuWrapper(e.share)),n.isUndefined(e.special_actions)||(this.specialActionsMenu=new s.TopicMenuWrapper(e.special_actions)),n.isUndefined(e.report_actions)||(this.reportActionsMenu=new s.TopicMenuWrapper(e.report_actions)),n.isUndefined(e.external_data_menu)||(this.externalDataMenu=new s.TopicMenuWrapper(e.external_data_menu)),n.isUndefined(e.animation_menu)||(this.widgetAnimationMenu=new s.TopicMenuWrapper(e.animation_menu)),n.isUndefined(e.refresh_period_menu)||(this.widgetRefreshPeriodMenu=new s.TopicMenuWrapper(e.refresh_period_menu)),n.isUndefined(e.geodata_precision_types)||(this.geodataPrecisionTypesMenu=new s.TopicMenuWrapper(e.geodata_precision_types)),n.isUndefined(e.export_share_menu)||(this.exportShareMenu=new s.TopicMenuWrapper(e.export_share_menu)),n.isUndefined(e.nested_graph_type_menu)||(this.nestedGraphTypeMenu=new s.TopicMenuWrapper(e.nested_graph_type_menu)),n.isUndefined(e.translation_target_language_menu)||(this.translationTargetLanguageMenu=new s.TopicMenuWrapper(e.translation_target_language_menu)),n.isUndefined(e.comment_display_type_menu)||(this.commentDisplayTypeMenu=new s.TopicMenuWrapper(e.comment_display_type_menu)),n.isUndefined(e.text_widget_layout_menu)||(this.textWidgetLayoutMenu=new s.TopicMenuWrapper(e.text_widget_layout_menu)),n.isUndefined(e.custom_menus)||(this.customMenus=n.map(e.custom_menus,e=>new s.TopicMenuWrapper(e))),n.isUndefined(e.select_search_data_function_menu)||(this.selectSearchDataFunctionMenu=new s.TopicMenuWrapper(e.select_search_data_function_menu)),n.isUndefined(e.zoom_level_menu)||(this.zoomLevelMenu=new s.TopicMenuWrapper(e.zoom_level_menu)),n.isUndefined(e.coloring_options_menu)||(this.coloringOptionsMenu=new s.TopicMenuWrapper(e.coloring_options_menu)),n.isUndefined(e.clone_dashboard_menu)||(this.cloneDashboardMenu=new s.TopicMenuWrapper(e.clone_dashboard_menu)),n.isUndefined(e.theme_sampling_mode_menu)||(this.themeSamplingModeMenu=new s.TopicMenuWrapper(e.theme_sampling_mode_menu)),this.menuKeys=n.keys(this).filter(e=>this[e]instanceof s.TopicMenuWrapper),this.widgetMenuProto=e,this.buttonMenusTop=[],this.buttonMenusRight=[],this.buttonMenusBottom=[],this.buttonMenusLeft=[],t||this.validate(),this.hasNestedGraphTypeMenu()&&this.hasCompatibleDataTypes()&&this.topicService.validateLinkedMenuSelection(this.getCompatibleDataTypes(),this.getNestedGraphTypeMenu(),[constants.data_type_categories.line_chart_group]),this._checkForButtonMenus()}shouldHideWidgetTagging(){return this.widgetMenuProto.hide_widget_tagging||!1}getWrapperForTopicMenu(e){for(let t=0,i=this.menuKeys.length;t<i;t++){const i=this[this.menuKeys[t]];if(i.toProto()===e)return i}}toProto(){return this.hasSearchModeMenu()?this.widgetMenuProto.search_mode=this.searchMode.toProto():void 0!==this.widgetMenuProto.search_mode&&delete this.widgetMenuProto.search_mode,this.hasTimeFilterModeMenu()?this.widgetMenuProto.timefilter_mode=this.timeFilterModeMenu.toProto():void 0!==this.widgetMenuProto.timefilter_mode&&delete this.widgetMenuProto.timefilter_mode,this.hasClusterLabelsMenu()?this.widgetMenuProto.cluster_labels_menu=this.clusterLabelsMenu.toProto():void 0!==this.widgetMenuProto.cluster_labels_menu&&delete this.widgetMenuProto.cluster_labels_menu,this.hasViewModeMenu()?this.widgetMenuProto.view_mode=this.viewModeMenu.toProto():void 0!==this.widgetMenuProto.view_mode&&delete this.widgetMenuProto.view_mode,this.hasBreakDownOptionsMenu()?this.widgetMenuProto.breakdown_options=this.breakdownOptionsMenu.toProto():void 0!==this.widgetMenuProto.breakdown_options&&delete this.widgetMenuProto.breakdown_options,this.hasThemeOptionsMenu()?this.widgetMenuProto.theme_options=this.themeOptionsMenu.toProto():void 0!==this.widgetMenuProto.theme_options&&delete this.widgetMenuProto.theme_options,this.hasCompatibleDataTypes()?this.widgetMenuProto.compatible_data_types=this.compatibleDataTypesMenu.toProto():void 0!==this.widgetMenuProto.compatible_data_types&&delete this.widgetMenuProto.compatible_data_types,this.hasTimeAxisOptions()?this.widgetMenuProto.time_axis_options=this.timeAxisOptions.toProto():void 0!==this.widgetMenuProto.time_axis_options&&delete this.widgetMenuProto.time_axis_options,this.hasNumberResultsMenu()?this.widgetMenuProto.number_results_menu=this.numberResultsMenu.toProto():void 0!==this.widgetMenuProto.number_results_menu&&delete this.widgetMenuProto.number_results_menu,this.hasSortMenu()?this.widgetMenuProto.sort_menu=this.sortMenu.toProto():void 0!==this.widgetMenuProto.sort_menu&&delete this.widgetMenuProto.sort_menu,this.hasGroupMenu()?this.widgetMenuProto.group_menu=this.groupMenu.toProto():void 0!==this.widgetMenuProto.group_menu&&delete this.widgetMenuProto.group_menu,this.hasContentContainsType()?this.widgetMenuProto.content_contains_type=this.contentContainsType.toProto():void 0!==this.widgetMenuProto.content_contains_type&&delete this.widgetMenuProto.content_contains_type,this.hasThemeBubbleSizes()?this.widgetMenuProto.theme_bubble_sizes=this.themeBubbleSizes.toProto():void 0!==this.widgetMenuProto.theme_bubble_sizes&&delete this.widgetMenuProto.theme_bubble_sizes,this.hasAuthorSourceMenu()?this.widgetMenuProto.author_source_menu=this.authorSourceMenu.toProto():void 0!==this.widgetMenuProto.author_source_menu&&delete this.widgetMenuProto.author_source_menu,this.hasPageMonitoringMenu()?this.widgetMenuProto.page_monitoring=this.pageMonitoringMenu.toProto():void 0!==this.widgetMenuProto.page_monitoring&&delete this.widgetMenuProto.page_monitoring,this.hasHashtagMenu()?this.widgetMenuProto.hashtag_menu=this.hashtagMenu.toProto():void 0!==this.widgetMenuProto.hashtag_menu&&delete this.widgetMenuProto.hashtag_menu,this.hasFiltersMenu()?this.widgetMenuProto.filters=this.filtersMenu.toProto():void 0!==this.widgetMenuProto.filters&&delete this.widgetMenuProto.filters,this.hasDisplayOnMapMenu()?this.widgetMenuProto.display_on_map_menu=this.displayOnMapMenu.toProto():void 0!==this.widgetMenuProto.display_on_map_menu&&delete this.widgetMenuProto.display_on_map_menu,this.hasResultRuleMenu()?this.widgetMenuProto.result_rule_menu=this.resultRuleMenu.toProto():void 0!==this.widgetMenuProto.result_rule_menu&&delete this.widgetMenuProto.result_rule_menu,this.hasExportMenu()?this.widgetMenuProto.export_menu=this.exportMenu.toProto():void 0!==this.widgetMenuProto.export_menu&&delete this.widgetMenuProto.export_menu,this.hasExportCompleteMenu()?this.widgetMenuProto.export_complete_menu=this.exportCompleteMenu.toProto():void 0!==this.widgetMenuProto.export_complete_menu&&delete this.widgetMenuProto.export_complete_menu,this.hasShareMenu()?this.widgetMenuProto.share=this.shareMenu.toProto():void 0!==this.widgetMenuProto.share&&delete this.widgetMenuProto.share,this.hasSpecialActionsMenu()?this.widgetMenuProto.special_actions=this.specialActionsMenu.toProto():void 0!==this.widgetMenuProto.special_actions&&delete this.widgetMenuProto.special_actions,this.hasReportActionsMenu()?this.widgetMenuProto.report_actions=this.reportActionsMenu.toProto():void 0!==this.widgetMenuProto.report_actions&&delete this.widgetMenuProto.report_actions,this.hasWidgetAnimationMenu()?this.widgetMenuProto.animation_menu=this.widgetAnimationMenu.toProto():void 0!==this.widgetMenuProto.animation_menu&&delete this.widgetMenuProto.animation_menu,this.hasWidgetRefreshPeriodMenu()?this.widgetMenuProto.refresh_period_menu=this.widgetRefreshPeriodMenu.toProto():void 0!==this.widgetMenuProto.refresh_period_menu&&delete this.widgetMenuProto.refresh_period_menu,this.hasGeodataPrecisionTypesMenu()?this.widgetMenuProto.geodata_precision_types=this.geodataPrecisionTypesMenu.toProto():void 0!==this.widgetMenuProto.geodata_precision_types&&delete this.widgetMenuProto.geodata_precision_types,this.hasExportShareMenu()?this.widgetMenuProto.export_share_menu=this.exportShareMenu.toProto():void 0!==this.widgetMenuProto.export_share_menu&&delete this.widgetMenuProto.export_share_menu,this.hasNestedGraphTypeMenu()?this.widgetMenuProto.nested_graph_type_menu=this.nestedGraphTypeMenu.toProto():void 0!==this.widgetMenuProto.nested_graph_type_menu&&delete this.widgetMenuProto.nested_graph_type_menu,this.hasTranslationTargetLanguageMenu()?this.widgetMenuProto.translation_target_language_menu=this.translationTargetLanguageMenu.toProto():void 0!==this.widgetMenuProto.translation_target_language_menu&&delete this.widgetMenuProto.translation_target_language_menu,this.hasCommentDisplayTypeMenu()?this.widgetMenuProto.comment_display_type_menu=this.commentDisplayTypeMenu.toProto():void 0!==this.widgetMenuProto.comment_display_type_menu&&delete this.widgetMenuProto.comment_display_type_menu,this.hasTextWidgetLayoutMenu()?this.widgetMenuProto.text_widget_layout_menu=this.textWidgetLayoutMenu.toProto():void 0!==this.widgetMenuProto.text_widget_layout_menu&&delete this.widgetMenuProto.text_widget_layout_menu,this.hasCustomMenus()?this.widgetMenuProto.custom_menus=n.map(this.customMenus,e=>e.toProto()):void 0!==this.widgetMenuProto.custom_menus&&delete this.widgetMenuProto.custom_menus,this.hasSelectSearchDataFunctionMenu()?this.widgetMenuProto.select_search_data_function_menu=this.selectSearchDataFunctionMenu.toProto():void 0!==this.widgetMenuProto.select_search_data_function_menu&&delete this.widgetMenuProto.select_search_data_function_menu,this.hasZoomLevelMenu()?this.widgetMenuProto.zoom_level_menu=this.zoomLevelMenu.toProto():void 0!==this.widgetMenuProto.zoom_level_menu&&delete this.widgetMenuProto.zoom_level_menu,this.hasColoringOptionsMenu()?this.widgetMenuProto.coloring_options_menu=this.coloringOptionsMenu.toProto():void 0!==this.widgetMenuProto.coloring_options_menu&&delete this.widgetMenuProto.coloring_options_menu,this.hasCloneDashboardMenu()?this.widgetMenuProto.clone_dashboard_menu=this.cloneDashboardMenu.toProto():void 0!==this.widgetMenuProto.clone_dashboard_menu&&delete this.widgetMenuProto.clone_dashboard_menu,this.hasThemeSamplingModeMenu()?this.widgetMenuProto.theme_sampling_mode_menu=this.themeSamplingModeMenu.toProto():void 0!==this.widgetMenuProto.search_mode&&delete this.widgetMenuProto.search_mode,this.widgetMenuProto}dispose(){this.buttonMenusTop.length=0,this.buttonMenusRight.length=0,this.buttonMenusBottom.length=0,this.buttonMenusLeft.length=0,n.each(this.menuKeys,e=>{void 0!==this[e]&&(this.disposeButtonMenus(e,this.buttonMenusTop),this.disposeButtonMenus(e,this.buttonMenusRight),this.disposeButtonMenus(e,this.buttonMenusBottom),this.disposeButtonMenus(e,this.buttonMenusLeft),void 0!==this[e]&&this[e].dispose(),delete this[e])})}disposeButtonMenus(e,t){const i=t.indexOf(this[e]);i>=0&&t.splice(i,1)}_checkForButtonMenus(){this.buttonMenusTop.length=0,this.buttonMenusRight.length=0,this.buttonMenusBottom.length=0,this.buttonMenusLeft.length=0,n.each(this.menuKeys,e=>{const t=this[e];void 0!==t&&t.isButtonMenu()&&(t.isDisplayPositionTop()?this.buttonMenusTop.push(this[e]):t.isDisplayPositionRight()?this.buttonMenusRight.push(this[e]):t.isDisplayPositionLeft()?this.buttonMenusLeft.push(this[e]):this.buttonMenusBottom.push(this[e]))})}getButtonMenusTop(){return this.buttonMenusTop}hasButtonMenusTop(){return this.buttonMenusTop.length>0}getButtonMenusRight(){return this.buttonMenusRight}hasButtonMenusRight(){return this.buttonMenusRight.length>0}getButtonMenusBottom(){return this.buttonMenusBottom}hasButtonMenusBottom(){return this.buttonMenusBottom.length>0}getButtonMenusLeft(){return this.buttonMenusLeft}hasButtonMenusLeft(){return this.buttonMenusLeft.length>0}getMenuByType(e){return n.filter(this.menuKeys,t=>this[t].getType()===e)}hasMenuByType(e){return this.getMenuByType(e).length>0}merge(e){e!==this&&(this.menuKeys=n.union(this.menuKeys,e.menuKeys),n.each(this.menuKeys,t=>{void 0===this[t]?this[t]=e[t]:e.menuKeys.includes(t)?this[t].merge(e[t]):this[t]=void 0}),this.widgetMenuProto=e.widgetMenuProto,this._checkForButtonMenus(),this.menuKeys=n.keys(this).filter(e=>this[e]instanceof s.TopicMenuWrapper))}hasSearchModeMenu(){return void 0!==this.getSearchModeMenu()}getSearchModeMenu(){return this.searchMode}hasTimeFilterModeMenu(){return void 0!==this.getTimeFilterModeMenu()}getTimeFilterModeMenu(){return this.timeFilterModeMenu}hasViewModeMenu(){return void 0!==this.getViewModeMenu()}getClusterLabelsMenu(){return this.clusterLabelsMenu}hasClusterLabelsMenu(){return void 0!==this.clusterLabelsMenu}getViewModeMenu(){return this.viewModeMenu}hasBreakDownOptionsMenu(){return void 0!==this.getBreakDownOptionsMenu()}getBreakDownOptionsMenu(){return this.breakdownOptionsMenu}hasThemeOptionsMenu(){return void 0!==this.getThemeOptionsMenu()&&this.getThemeOptionsMenu().hasRootEntry()&&this.getThemeOptionsMenu().getRootEntry().isVisible()}getThemeOptionsMenu(){return this.themeOptionsMenu}hasCompatibleDataTypes(){return!n.isUndefined(this.compatibleDataTypesMenu)}getCompatibleDataTypes(){return this.compatibleDataTypesMenu}hasTimeAxisOptions(){return!n.isUndefined(this.timeAxisOptions)}getTimeAxisOptions(){return this.timeAxisOptions}hasNumberResultsMenu(){return!n.isUndefined(this.numberResultsMenu)&&this.numberResultsMenu.hasRootEntry()&&this.numberResultsMenu.getRootEntry().hasChildren()}getNumberResultsMenu(){return this.numberResultsMenu}hasSortMenu(){return!n.isUndefined(this.sortMenu)}getSortMenu(){return this.sortMenu}hasGroupMenu(){return!n.isUndefined(this.groupMenu)}getGroupMenu(){return this.groupMenu}hasContentContainsType(){return!n.isUndefined(this.contentContainsType)}getContentContainsType(){return this.contentContainsType}hasThemeBubbleSizes(){return!n.isUndefined(this.themeBubbleSizes)}getThemeBubbleSizes(){return this.themeBubbleSizes}hasAuthorSourceMenu(){return!n.isUndefined(this.authorSourceMenu)}getAuthorSourceMenu(){return this.authorSourceMenu}hasPageMonitoringMenu(){return!n.isUndefined(this.pageMonitoringMenu)}getPageMonitoringMenu(){return this.pageMonitoringMenu}hasHashtagMenu(){return!n.isUndefined(this.hashtagMenu)}getHashtagMenu(){return this.hashtagMenu}hasFiltersMenu(){return!n.isUndefined(this.filtersMenu)}getFiltersMenu(){return this.filtersMenu}hasDisplayOnMapMenu(){return!n.isUndefined(this.displayOnMapMenu)}getDisplayOnMapMenu(){return this.displayOnMapMenu}hasResultRuleMenu(){return!n.isUndefined(this.resultRuleMenu)}getResultRuleMenu(){return this.resultRuleMenu}hasExportMenu(){return!n.isUndefined(this.exportMenu)}getExportMenu(){return this.exportMenu}hasExportCompleteMenu(){return!n.isUndefined(this.exportCompleteMenu)}getExportCompleteMenu(){return this.exportCompleteMenu}hasShareMenu(){return!n.isUndefined(this.shareMenu)}getShareMenu(){return this.shareMenu}hasSpecialActionsMenu(){return!n.isUndefined(this.specialActionsMenu)}getSpecialActionsMenu(){return this.specialActionsMenu}hasReportActionsMenu(){return!n.isUndefined(this.reportActionsMenu)}getReportActionsMenu(){return this.reportActionsMenu}hasSourcePanelMenu(){return!n.isUndefined(this.widgetMenuProto.has_source_panel_menu)&&this.widgetMenuProto.has_source_panel_menu}getExternalDataMenu(){return this.externalDataMenu}hasExternalDataMenu(){return!n.isUndefined(this.externalDataMenu)}getWidgetAnimationMenu(){return this.widgetAnimationMenu}hasWidgetAnimationMenu(){return!n.isUndefined(this.widgetAnimationMenu)}getWidgetRefreshPeriodMenu(){return this.widgetRefreshPeriodMenu}hasWidgetRefreshPeriodMenu(){return!n.isUndefined(this.widgetRefreshPeriodMenu)}isHideTableHeader(){return!n.isUndefined(this.widgetMenuProto.hide_table_header)&&this.widgetMenuProto.hide_table_header}setHideTableHeader(e){this.widgetMenuProto.hide_table_header=e}isHidden(){return!0===this.widgetMenuProto.hidden}hasGeodataPrecisionTypesMenu(){return!n.isUndefined(this.geodataPrecisionTypesMenu)}getGeodataPrecisionTypesMenu(){return this.geodataPrecisionTypesMenu}getExportShareMenu(){return this.exportShareMenu}hasExportShareMenu(){return!n.isUndefined(this.exportShareMenu)}getNestedGraphTypeMenu(){return this.nestedGraphTypeMenu}hasNestedGraphTypeMenu(){return!n.isUndefined(this.nestedGraphTypeMenu)}getTranslationTargetLanguageMenu(){return this.translationTargetLanguageMenu}hasTranslationTargetLanguageMenu(){return!n.isUndefined(this.translationTargetLanguageMenu)}getCommentDisplayTypeMenu(){return this.commentDisplayTypeMenu}hasCommentDisplayTypeMenu(){return!n.isUndefined(this.commentDisplayTypeMenu)}getTextWidgetLayoutMenu(){return this.textWidgetLayoutMenu}hasTextWidgetLayoutMenu(){return!n.isUndefined(this.textWidgetLayoutMenu)}getCustomMenus(){return this.customMenus}hasCustomMenus(){return!n.isUndefined(this.customMenus)}getSelectSearchDataFunctionMenu(){return this.selectSearchDataFunctionMenu}hasSelectSearchDataFunctionMenu(){return!n.isUndefined(this.selectSearchDataFunctionMenu)}validate(){}showWidgetMetrics(){return!this.widgetMenuProto.hide_widget_metrics}hasZoomLevelMenu(){return!n.isUndefined(this.zoomLevelMenu)}hasColoringOptionsMenu(){return!n.isUndefined(this.coloringOptionsMenu)}hasCloneDashboardMenu(){return!n.isUndefined(this.cloneDashboardMenu)}getZoomLevelMenu(){return this.zoomLevelMenu}getColoringOptionsMenu(){return this.coloringOptionsMenu}getCloneDashboardMenu(){return this.cloneDashboardMenu}hasThemeSamplingModeMenu(){return void 0!==this.themeSamplingModeMenu}getThemeSamplingModeMenu(){return this.themeSamplingModeMenu}}t.WidgetMenuWrapper=r,t.default=n.constant(r)}),define("configuration/widget/influencer_table",["require","exports","configuration/widget/table"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerTableWidgetConfiguration=class extends i.TableWidgetConfiguration{canShowHeaderMenu(e,t){const i=e.hasMenu()&&e.getMenu();return i&&!i.isHidden()&&!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/kpi",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.KPIWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/line_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.LineChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}hasReplayModes(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/message_diffusion",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.MessageDiffusionWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowBreakdown(e){return!0}hasReplayModes(e){return!1}getHeight(e){return n.twCommon.widgetHeight.LARGE}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/metrics_multiple",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.MetricsMultipleWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!e.getPageState().getAllowedPages().isSearchAdvanced()}hasReplayModes(e){return!1}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}getHeight(e){return n.twCommon.widgetHeight.SMALL}}}),define("configuration/widget/payload_edition",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PayloadEditionWidgetConfiguration=class extends i.BaseWidgetConfiguration{isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/pie_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PieChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/progress_graph",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ProgressGraphWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!0}}}),define("configuration/widget/radar_chart",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.RadarChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/single_metric",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.SingleMetricWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!e.getPageState().getAllowedPages().isSearchAdvanced()}isReplayable(e){return!1}getHeight(e){return n.twCommon.widgetHeight.SMALL}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/theme_cloud",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ThemeCloudWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}getHeight(e){return n.twCommon.widgetHeight.LARGE}}}),define("configuration/widget/sorted_theme_cloud",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.SortedThemeCloudWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/stream_graph",["require","exports","configuration/widget/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.StreamGraphWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}hasReplayModes(e){return!0}}}),define("configuration/widget/text_box",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TextBoxWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!1}isReplayable(e){return!1}canUseBackgroundColor(e){return!1}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/text",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TextWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!1}isReplayable(e){return!1}canUseBackgroundColor(e){return e.getPageState().getAllowedPages().isCommandCenterWidgetPreview()}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/theme_tree",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ThemeTreeWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}getHeight(e){return e.getDataTypeUuid()===constants.data_type.theme_tree_with_trends?n.twCommon.widgetHeight.LARGE:e.getDataTypeUuid()===constants.data_type.theme_tree?n.twCommon.widgetHeight.LARGE:n.twCommon.widgetHeight.SMALL}}}),define("configuration/widget/top_influencers_overview",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TopInfluencerOverviewWidgetConfiguration=class extends i.BaseWidgetConfiguration{isReplayable(e){return!1}getHeight(e){return n.twCommon.widgetHeight.TINY}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/treemap",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TreeMapWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}canShowHeaderMenu(e,t){return super.canShowHeaderMenu(e,t)&&!_.contains(["NUMBER_RESULTS"],t)&&!e.isSmallTreemap()}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}}}),define("configuration/widget/trends_table",["require","exports","configuration/widget/table","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TrendsTableWidgetConfiguration=class extends i.TableWidgetConfiguration{canBeFullScreen(e){return!1}isReplayable(e){return!1}getHeight(e){return n.twCommon.widgetHeight.DYNAMIC}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("configuration/widget/wheel_chart",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.WheelChartWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}getHeight(e){return n.twCommon.widgetHeight.LARGE}}}),define("configuration/widget/world_map",["require","exports","configuration/widget/base","services/tw_common","services/application_mode"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.WorldMapWidgetConfiguration=class extends i.BaseWidgetConfiguration{canBeFullScreen(e){return!0}isReplayable(e){return!1}getHeight(e){const t=e.getHeightIndex();return void 0!==t&&t>0?t:n.twCommon.widgetHeight.NORMAL}shouldDisableInteraction(){return s.applicationMode.getCurrentAppMode()===s.AppMode.EMBEDDED||s.applicationMode.isMobile()}}}),define("configuration/widget/document_cluster",["require","exports","configuration/widget/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterkWidgetConfiguration=class extends i.BaseWidgetConfiguration{getHeight(){return n.twCommon.widgetHeight.HUGE}canShowHeaderMenu(e,t){return!_.contains(["NUMBER_RESULTS"],t)}}}),define("services/configuration",["require","exports","underscore","other/tw","classes/widget/types/widget_type","configuration/widget/base","configuration/widget/area_chart","configuration/widget/activity","configuration/widget/articles","configuration/widget/bubble_chart","configuration/widget/counter","configuration/widget/emoji_tree","configuration/widget/gender","configuration/widget/horizontal_bar_chart","configuration/widget/influencer_network","configuration/widget/influencer_overview","configuration/widget/influencer_table","configuration/widget/table","configuration/widget/kpi","configuration/widget/line_chart","configuration/widget/message_diffusion","configuration/widget/metrics_multiple","configuration/widget/payload_edition","configuration/widget/pie_chart","configuration/widget/progress_graph","configuration/widget/radar_chart","configuration/widget/single_metric","configuration/widget/theme_cloud","configuration/widget/sorted_theme_cloud","configuration/widget/stream_graph","configuration/widget/text_box","configuration/widget/text","configuration/widget/theme_tree","configuration/widget/top_influencers_overview","configuration/widget/treemap","configuration/widget/trends_table","configuration/widget/vertical_bar_chart","configuration/widget/wheel_chart","configuration/widget/world_map","reusable_utilities","configuration/widget/document_cluster"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U){Object.defineProperty(t,"__esModule",{value:!0});class G{constructor(e,t){this.$injector=e,this.twRoutingService=t}getPageConfiguration(e){return e=e||this.twRoutingService.getActivePage(),!i.isUndefined(e)&&this.$injector.has(e.getId().toLowerCase()+"Configuration")?this.$injector.get(e.getId().toLowerCase()+"Configuration"):this.$injector.get("basePageConfiguration")}getWidgetConfiguration(e){switch(e){case s.WidgetType.OPENLAYERS_WORLD_MAP:return new B.WorldMapWidgetConfiguration;case s.WidgetType.WHEEL_CHART:return new L.WheelChartWidgetConfiguration;case s.WidgetType.VERTICAL_BAR_CHART:return new N.VerticalBarChartWidgetConfiguration;case s.WidgetType.TRENDS_TABLE:return new k.TrendsTableWidgetConfiguration;case s.WidgetType.TREEMAP:return new O.TreeMapWidgetConfiguration;case s.WidgetType.TOP_INFLUENCERS_OVERVIEW:return new F.TopInfluencerOverviewWidgetConfiguration;case s.WidgetType.THEME_TREE:return new R.ThemeTreeWidgetConfiguration;case s.WidgetType.TEXT:return new x.TextWidgetConfiguration;case s.WidgetType.TEXT_BOX:return new I.TextBoxWidgetConfiguration;case s.WidgetType.STREAM_GRAPH:return new A.StreamGraphWidgetConfiguration;case s.WidgetType.SORTED_THEME_CLOUD:return new D.SortedThemeCloudWidgetConfiguration;case s.WidgetType.THEME_CLOUD:return new P.ThemeCloudWidgetConfiguration;case s.WidgetType.SINGLE_METRIC:return new M.SingleMetricWidgetConfiguration;case s.WidgetType.RADAR_CHART:return new T.RadarChartWidgetConfiguration;case s.WidgetType.PROGRESS_GRAPH:return new E.ProgressGraphWidgetConfiguration;case s.WidgetType.PIE_CHART:return new C.PieChartWidgetConfiguration;case s.WidgetType.PAYLOAD_EDITION:return new w.PayloadEditionWidgetConfiguration;case s.WidgetType.MULTI_METRICS:return new b.MetricsMultipleWidgetConfiguration;case s.WidgetType.MESSAGE_DIFFUSION:return new S.MessageDiffusionWidgetConfiguration;case s.WidgetType.LINE_CHART:return new v.LineChartWidgetConfiguration;case s.WidgetType.KPI_CHART:return new y.KPIWidgetConfiguration;case s.WidgetType.DATA_TABLE:return new f.TableWidgetConfiguration;case s.WidgetType.INFLUENCER_TABLE:return new _.InfluencerTableWidgetConfiguration;case s.WidgetType.INFLUENCER_OVERVIEW:return new m.InfluencerOverViewWidgetConfiguration;case s.WidgetType.INFLUENCER_NETWORK:return new h.InfluencerNetworkWidgetConfiguration;case s.WidgetType.DOCUMENT_CLUSTER:return new U.DocumentClusterkWidgetConfiguration;case s.WidgetType.HORIZONTAL_BAR_CHART:return new p.HorizontalBarChartWidgetConfiguration;case s.WidgetType.GENDER:return new u.GenderWidgetConfiguration;case s.WidgetType.EMOJI_TREE:return new g.EmojiTreeWidgetConfiguration;case s.WidgetType.COUNTER:return new d.CounterWidgetConfiguration;case s.WidgetType.BUBBLE_CHART:return new l.BubbleChartWidgetConfiguration;case s.WidgetType.ARTICLES:return new c.ArticlesWidgetConfiguration;case s.WidgetType.ACTIVITY_CHART:return new a.ActivityWidgetConfiguration;case s.WidgetType.AREA_CHART:return new r.AreaChartWidgetConfiguration;default:return new o.BaseWidgetConfiguration}}getTopicMenuConfiguration(){return this.$injector.get("baseTopicMenuConfiguration")}getBubbleDialogConfiguration(){return this.$injector.get("baseBubbleDialogConfiguration")}getCalendarConfiguration(){return this.$injector.get("calendarConfiguration")}getApplicationConfiguration(e){return e.getConfiguration()}}G.$inject=["$injector","twRoutingService"],__decorate([W.memoize(e=>e),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",o.BaseWidgetConfiguration)],G.prototype,"getWidgetConfiguration",null),t.default=G,Object.defineProperty(t,"configurationService",{get:function(){return n.tw.inject("configurationService")}})}),define("configuration/application/bubble",["require","exports","configuration/application/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.default{canShowWidgetTitle(){return!1}isWidgetMenuAllowed(e){return!0}widgetShowResultCount(){return!0}showWidgetFirstLoadingBubble(){return!1}}t.BubbleApplicationConfiguration=n,t.bubbleApplicationConfiguration=new n}),define("classes/application/bubble_application",["require","exports","configuration/application/bubble","classes/application/abstract_application"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BubbleApplication=class extends n.AbstractApplication{constructor(e){super(e),this.type=n.ApplicationType.BUBBLE}getConfiguration(){return i.bubbleApplicationConfiguration}}}),define("configuration/application/single_page_bubble",["require","exports","configuration/application/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.default{canShowWidgetTitle(){return!0}isWidgetMenuAllowed(e){return!_.contains([constants.topic_menu.TYPE.number_results],e)}widgetShowResultCount(){return!0}showWidgetFirstLoadingBubble(){return!1}}t.SinglePageBubbleApplicationConfiguration=n,t.singlePageBubbleApplicationConfiguration=new n}),define("classes/application/single_page_bubble_application",["require","exports","configuration/application/single_page_bubble","classes/application/abstract_application","classes/application/bubble_application"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.SinglePageBubbleApplication=class extends s.BubbleApplication{constructor(e){super(e),this.type=n.ApplicationType.SINGLE_PAGE_BUBBLE}getConfiguration(){return i.singlePageBubbleApplicationConfiguration}}}),define("classes/custom_pages/custom_page",["require","exports","services/rest_form_service","log"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){this.container=e,this.form=t}static async new(e,t,s){const o={type:e,[t]:s};return n.logService.assertDefined(t),n.logService.assertDefined(o.type),n.logService.assertDefined(o[t]),i.restFormService.postRForm("custom_pages","new",o)}async update(e){const t=this.buildRequest(e);n.logService.assertDefined(t.type),n.logService.assertDefined(t[this.getContainerField()]),n.logService.assertDefined(t[this.getContainerField()].mapped_id),this.form=await i.restFormService.postRForm("custom_pages","update",t)}async override(e){const t=this.buildRequest(e);return n.logService.assertDefined(t.type),n.logService.assertDefined(t[this.getContainerField()]),n.logService.assertDefined(t[this.getContainerField()].mapped_id),n.logService.assertDefined(t[this.getContainerField()].page_state),i.restFormService.postRForm("custom_pages","override",t)}async remove(){const e=this.buildRequest(this.container);n.logService.assertDefined(e.type),n.logService.assertDefined(e[this.getContainerField()]),n.logService.assertDefined(e[this.getContainerField()].mapped_id),await i.restFormService.postRForm("custom_pages","remove",e)}async addWidgets(e,t){const n={custom_page_id:this.getId(),add_active_filters:this.getContainer().add_active_filters,page_state:s.cloneAndEnhancePageState(t),dics:e.map(e=>s.cloneAndEnhanceWidget(e))},o=this.buildWidgetRequest(n,t);return i.restFormService.postRForm("custom_page_widgets","add",o)}async saveWidget(e,t,n){const o={custom_page_id:this.getId(),page_state:s.cloneAndEnhancePageState(t),data_input_configuration:s.cloneAndEnhanceWidget(e),update_from_page_state:n,add_active_filters:e.getDicWrapper().isDisplayActiveFilters()},r=this.buildWidgetRequest(o);await i.restFormService.postRForm("custom_page_widgets","update",r)}async overrideWidget(e,t,n){const o={custom_page_id:this.getId(),page_state:s.cloneAndEnhancePageState(t,[s.cloneAndEnhanceWidget(e)],t.getUserFilterSettings())},r=this.buildWidgetRequest(o);await i.restFormService.postRForm("custom_page_widgets","override",r)}async removeWidget(e){const t={custom_page_id:this.getId(),mapped_id:e.getId()},n=this.buildWidgetRequest(t);await i.restFormService.postRForm("custom_page_widgets","remove",n)}async cloneWidget(e){const t={custom_page_id:this.getId(),data_input_configuration:s.cloneAndEnhanceWidget(e)},n=this.buildWidgetRequest(t);return i.restFormService.postRForm("custom_page_widgets","copy",n)}async setAsTriggerCondition(e){const t={custom_page_id:this.getId(),data_input_configuration:s.cloneAndEnhanceWidget(e)},n=this.buildWidgetRequest(t);await i.restFormService.postRForm("custom_page_widgets","select",n)}getForm(){return this.form}getId(){return this.container.mapped_id}getContainer(){return this.container}setContainer(e){this.container=e}buildRequest(e){return{type:this.type,[this.getContainerField()]:e}}buildWidgetRequest(e,t){return this.enhanceWidgetContainer(e,t),{type:this.type,[this.getWidgetContainerField()]:e}}enhanceWidgetContainer(e,t){}static cloneAndEnhancePageState(e,t,i){if(void 0!==e){const n=e.copyAndPrune(!0),s=n.toProto();return s.data_input_configuration=t||[],void 0!==i&&(s.user_filter_settings=i.toProto()),n.dispose(),s}}static cloneAndEnhanceWidget(e){const t=e.copyAndPrune(!1,!0),i=t.toProto();return t.dispose(),i}}t.CustomPage=s}),define("classes/custom_pages/custom_page_interfaces",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/custom_pages/pages/report_page",["require","exports","classes/custom_pages/custom_page","services/rest_form_service","log"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends i.CustomPage{constructor(){super(...arguments),this.type=constants.custom_page.type.report}async create(){const e=await i.CustomPage.new(this.type,this.getContainerField(),this.container);return new o(e[this.getContainerField()],e)}async update(e){return s.logService.assertDefined(e.mapped_id),super.update(e)}async override(e){return s.logService.assertDefined(e.mapped_id),s.logService.assertDefined(e.page_state),super.override(e)}saveWidgets(e,t){return n.restFormService.postRForm("custom_page_widgets","save",{type:this.type,report_widget_container:{custom_page_id:e,dics:t}})}createSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.postRForm("custom_pages_grid","create",{type:this.type,report_container:e})}updateSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.postRForm("custom_pages_grid","update",{type:this.type,report_container:e})}removeSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.deleterRForm("custom_pages_grid","remove",{type:this.type,report_container:e})}moveSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.postRForm("custom_pages_grid","move",{type:this.type,report_container:e})}copyWidgetToSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.postRForm("custom_pages_grid","copy",{type:this.type,report_container:e})}changeWidgetSlide(e){return s.logService.assertDefined(e.mapped_id),n.restFormService.postRForm("custom_pages_grid","merge",{type:this.type,report_container:e})}updateTemplate(e){return n.restFormService.postRForm("custom_pages_grid","convert",{type:this.type,report_container:e})}async clone(e){const t=this.buildRequest(e);s.logService.assertDefined(t.type),s.logService.assertDefined(e.title),s.logService.assertDefined(e.page_state);const i=await n.restFormService.postRForm("custom_pages","copy",t);return new o(i.report_container,i)}async refresh(e){const t=this.buildRequest(e);s.logService.assertDefined(t[this.getContainerField()].mapped_id),s.logService.assertDefined(t[this.getContainerField()].output_types_and_templates);const i=await n.restFormService.postRForm("custom_pages","refresh",t);return this.container.output_renderer=i.renderer_enum,this}async remove(e=!1){return this.container.notify=e,super.remove()}static async info(){return n.restFormService.postRForm("custom_pages","info",{type:constants.custom_page.type.report})}enhanceWidgetContainer(e,t){void 0!==t&&t.hasAllowedPages()&&(e.source_custom_page_id=t.getAllowedPages().getCustomPageId())}getContainerField(){return"report_container"}getWidgetContainerField(){return"report_widget_container"}}t.ReportPage=o}),define("components/modals/multipage_modal/directive",["require","exports","angular","event_bus","angular_utilities","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"A",bindToController:{payload:"=",ok:"&",cancel:"=",modalOptions:"="},controllerAs:"vm",controller:r,templateUrl:o.templateSourceFactory("components/modals/multipage_modal"),scope:{}}};let r=class{constructor(e){this.$rootScope=e,this.selectedIndex=0,this.tabsId="multipage-modal-tabs"}selectNext(e){e.stopPropagation(),this.selectedIndex++,n.eventBus.dispatch({type:n.EVENT_TYPES.TAB_CHANGE_SELECTION,value:{id:this.tabsId,tabIndex:this.selectedIndex}})}selectPrevious(e){e.stopPropagation(),this.selectedIndex--,n.eventBus.dispatch({type:n.EVENT_TYPES.TAB_CHANGE_SELECTION,value:{id:this.tabsId,tabIndex:this.selectedIndex}})}selectIndex(e){this.selectedIndex=e}processClose(){void 0!==this.payload.callback?(this.processing=!0,this.payload.callback().then(()=>{this.close(),this.processing=!1},()=>{this.processing=!1,this.$rootScope.$$phase||this.$rootScope.$apply()})):this.close()}close(){this.ok({payload:this.payload})}};r=__decorate([s.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],r),t.MultipageModalController=r}),define("components/form_fragments/widget/custom_page_addition/directive",["require","exports","angular","angular_utilities","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:o,templateUrl:s.templateSourceFactory("components/form_fragments/widget/custom_page_addition"),scope:{}}};let o=class{constructor(e){this.$scope=e}};o=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],o),t.WidgetCustomPageAdditionFormFragmentController=o}),define("components/form_fragments/report/creation/directive",["require","exports","angular","underscore","services/context","services/rest_form_service","reusable_utilities","classes/context_data/context_data","angular_utilities","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:d,templateUrl:l.templateSourceFactory("components/form_fragments/report/creation"),scope:{}}};let d=class{constructor(e){this.$scope=e,this.bottomBtn={name:a.contextData.getMessage("_569808")}}$onInit(){this.initialize()}checkDuplicateReportName(){this.errorDuplicate=n.any(this.existingReports,e=>e.name===this.payload.title)}hideNewGroupField(){this.newGroupFieldShown=!1}displayNewGroupField(){r.TopicEntryUtils.setSelectionRecursive(this.payload.groups.root_entry,!1),this.newGroupFieldShown=!0}async createNewReportGroup(e){e.stopPropagation(),e.preventDefault();const t=routes.controllers.tw.TWRestForm.post(s.contextService.getCurrentContext().scope,s.contextService.getCurrentContext().id,"report_category","new","","rform").url,i=(await o.restFormService.post(t,{name:this.newGroupLabel})).report_groups;this.newGroupLabel="",r.TopicEntryUtils.recursiveUnselectAndSelect(i.root_entry,n(i.root_entry.children).last().mapped_id),this.payload.groups=i,this.hideNewGroupField(),this.$scope.$$phase||this.$scope.$apply()}initialize(){this.existingReports=JSON.parse(JSON.stringify(this.payload.reports.root_entry.children)),this.existingReports.shift()}};d=__decorate([c.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],d),t.ReportCreationFormFragmentController=d}),define("components/form_fragments/report/page_format/directive",["require","exports","angular","angular_utilities","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:o,templateUrl:s.templateSourceFactory("components/form_fragments/report/page_format"),scope:{}}};let o=class{constructor(e){this.$scope=e}};o=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],o),t.ReportPageFormatFormFragmentController=o}),define("components/form_fragments/widgets/custom_page_addition/directive",["require","exports","angular","angular_utilities","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:o,templateUrl:s.templateSourceFactory("components/form_fragments/widgets/custom_page_addition"),scope:{}}};let o=class{constructor(e){this.$scope=e,this.useSuffix=!1}allowSuffix(e){e.preventDefault(),e.stopPropagation(),this.useSuffix=!0}};o=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],o),t.WidgetsCustomPageAdditionFormFragmentController=o}),define("components/modals/custom_page/widget_additions/directive",["require","exports","components/form/common/topic_menu","services/template_source"],function(e,t,i,n){function s(){return{replace:!1,restrict:"A",bindToController:{payload:"=",ok:"&",cancel:"=",modalOptions:"="},controllerAs:"vm",controller:o,templateUrl:n.templateSourceFactory("components/modals/custom_page/widget_additions"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.CustomPageWidgetAdditionsDirective=s;class o{constructor(){}canAdd(){return null!==i.getFirstSelectedEntry(this.payload.topicMenu.root_entry)}processClose(){if(void 0!==this.payload.callback){this.processing=!0;const e={add_active_filters:this.payload.descriptionFiltersAllowed,widget_suffix:this.payload.titleSuffix,topicMenu:this.payload.topicMenu};this.payload.callback(e).then(()=>{this.close(),this.processing=!1})}else this.close()}close(){this.ok({payload:this.payload})}}}),define("services/report_service",["require","exports","classes/context_data/context_data","services/confirmation_service","services/rest_form_service","other/tw","services/context","services/broker","classes/custom_pages/custom_page_factory","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","components/form/common/topic_menu"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});class _{openRemoveReportConfirmations(){n.confirmationService.display({message:i.contextData.getMessage("_705442")}).then(()=>{n.confirmationService.display({message:{message:i.contextData.getMessage("_484105"),ok:i.contextData.getMessage("_697024"),cancel:i.contextData.getMessage("_348105")}}).then(()=>{this.removeAction(!0)},()=>{this.removeAction(!1)})},()=>{})}async createReport(e,t){const i=t.clone();i.prune(!0,!0);const n={title:e.title,page_state:i.toProto(),groups:e.groups,reports:e.reports,output_types_and_templates:e.output_types_and_templates,add_active_filters:e.description_filters_allowed,widget_suffix:void 0!==e.widget_title_suffix&&e.widget_title_suffix.length>0?e.widget_title_suffix:void 0};i.dispose(),await c.CustomPageFactory.createPage(constants.custom_page.type.report,n)}async addWidgetsToReport(e,t){const i=t.clone(),n=i.getWidgets(),s={mapped_id:m.getFirstSelectedEntry(e.topicMenu.root_entry).mapped_id,page_state:i.toProto(),reports:e.topicMenu,add_active_filters:e.add_active_filters,widget_suffix:void 0!==e.widget_suffix&&e.widget_suffix.length>0?e.widget_suffix:void 0},o=await c.CustomPageFactory.getPageByType(constants.custom_page.type.report,s);await o.addWidgets(n,i),i.dispose()}goToLayoutPage(){this.goToSubPage(constants.page_type.report_layout)}goToSchedulePage(){this.goToSubPage(constants.page_type.report_schedule)}goToSettingsPage(){this.goToSubPage(constants.page_type.report_settings)}removeAction(e){const t=o.tw.pageState.getAllowedPages().getCustomPageId().split("|"),i=t[t.length-1],n={notify:e};s.restFormService.deleter(routes.controllers.tw.TWRestForm.deleter(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"report","remove",i,"rform").url,n).then(this.handleReportDeletionSuccess.bind(this),e=>{})}handleReportDeletionSuccess(e){const t=l.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report),i=t.getEntryByMappedId(e.mapped_id).getParent();a.brokerService.publish(constants.events.page.title,[""]),a.brokerService.publish(constants.events.topic.remove,[i.getMappedId(),e.mapped_id,constants.topic_menu.TYPE.report,!0]),t.selectEntry(t.getRootEntry())}goToSubPage(e){const t=o.tw.pageState.getAllowedPages().getDisplayPages();t.setEntriesSelectionRecursively(!1),t.selectEntryByMappedId(e),this.refreshPageData(e)}async refreshPageData(e){const t={strategy:g.ModelRefreshStrategy.REFRESH},i=p.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,h.ModelType.PAGE_STATE,t);try{await d.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&u.logService.error(`Error when refreshing page state after going to ${e} !`,void 0,t)}}}t.ReportService=_,t.reportService=new _}),define("services/custom_pages",["require","exports","classes/custom_pages/custom_page_factory","classes/custom_pages/pages/dashboard_page","wrappers/topic_menu/topic_entry_wrapper","services/tw_common","wrappers/topic_menu/topic_menu_wrapper","classes/custom_pages/pages/report_page","services/rest_form_service","angular_utilities","services/tw_routing","services/navbar","services/loading_bubble","classes/context_data/context_data","services/modal","reusable_utilities","services/report_service","notifications","services/refresh/model_refresh_service","classes/application/application","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C){Object.defineProperty(t,"__esModule",{value:!0});class E{async updateDashboard(e){const t=i.CustomPageFactory.getPage(n.DashboardPage,e);return await t.update(e),t.getForm()}async updateReport(e){const t=i.CustomPageFactory.getPage(a.ReportPage,e);return await t.update(e),t.getForm()}async removeDashboard(e){const t=i.CustomPageFactory.getPage(n.DashboardPage,e);await t.remove()}async saveWidget(e,t,n,s,o){const r=i.CustomPageFactory.getPageByType(e,t);await r.saveWidget(n,s,o)}async overrideWidget(e,t,n,s,o){const r=i.CustomPageFactory.getPageByType(e,t);await r.overrideWidget(n,s,o)}async removeWidget(e,t,n){const s=i.CustomPageFactory.getPageByType(e,t);await s.removeWidget(n),n.getPageState()&&n.getPageState().deleteWidget(n)}async cloneWidget(e,t,n){const s=i.CustomPageFactory.getPageByType(e,t),o=await s.cloneWidget(n);return o&&this.refreshPageData("Error when refreshing page state after cloning widget !"),o}async setAsTriggerCondition(e,t,n){const s=i.CustomPageFactory.getPageByType(e,t);await s.setAsTriggerCondition(n)}async createCustomPageWithWidgets(e,t,n,s){let o;return e===constants.custom_page.type.report?(n&&(t.page_state.data_input_configuration=n.map(e=>e.toProto())),o=await i.CustomPageFactory.createPage(e,t)):(t.page_state=void 0,o=await i.CustomPageFactory.createPage(e,t),await o.addWidgets(n,s)),this.addCustomPageToTopicMenu(o),o}async addWidgetsToCustomPage(e,t,n,s){const o=i.CustomPageFactory.getPageByType(e,t);return await o.addWidgets(n,s),o}async createNewGroup(e,t){return await c.restFormService.postRForm("custom_pages_group","new",{title:e,projects:t})}async removeGroup(e){await c.restFormService.deleterRForm("custom_pages_group","remove",void 0,e)}addCustomPageToTopicMenu(e){const t=v.mainApplication.getPageState(),i=e.getContainer();let n,a,c;switch(e.type){case constants.custom_page.type.dashboard:n=t.getAllowedPages().getDashboardPageMenu(),a=e.getId(),c=new r.TopicMenuWrapper(i.groups).getFirstSelectedEntry();break;case constants.custom_page.type.report:n=t.getAllowedPages().getReportPageMenu(),a=e.getId(),c=new r.TopicMenuWrapper(i.groups).getFirstSelectedEntry()}if(void 0!==n){const e=s.TopicEntryWrapper.create(a,i.title);void 0!==c&&c.getMappedId().length>0&&!o.twCommon.isDefaultCustomPageGroup(c.getMappedId())?n.getEntryByMappedId(c.getMappedId()).addChild(e):n.getAllNode().addChildAtIndex(e,n.getAllNode().getChildren().length-1),n.getAllNode().toProto()}}selectNextDashboard(){const e=v.mainApplication.getPageState();if(e&&e.hasUserFilterSettings()){const t=e.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.dashboard);if(t.getAllLeavesRecursively().length>1){const e=t.getNextEntryByPredicate(e=>!e.isNotSelectable()&&!e.hasChildren());e&&t.unselectAllAndSelect(e),this.refreshPageData("Error when refreshing page state after selecting next dashboard !")}else d.twRoutingService.changePageByUrl(g.navbarService.getNavbarModel().group_pages.find(e=>"DASHBOARD"===e.group_page_type).url)}}async showMultipageModalForWidgetToNewReport(e){const t=await this.createReportSteps(),i=t[0],n=t[1],s=this.createWidgetCustomPageAddition(e),o={disable:!p.contextData.rules.isAlertsProjectEnabled(),lastStepButtonLabel:p.contextData.getMessage("_612374"),lastStepButtonProgressLabel:p.contextData.getMessage("_911337"),steps:[i,n,s],finishCondition:()=>void 0!==i.model.groups&&void 0!==m.TopicMenuUtils.getFirstSelectedEntry(i.model.groups),headerIcon:"icon2-tw-report",headerHelpLink:p.contextData.getLink("ACADEMY_SUBSCRIBE_ALERT"),headerTitle:p.contextData.getMessage("_895435"),headerDescription:p.contextData.getMessage("_895434")};return u.loadingBubbleService.hideSpinner(),await h.modalService.display("MULTIPAGE_MODAL",o),{dic:s.model.widget.getDic(),description_filters_allowed:s.model.descriptionFiltersAllowed,title:i.model.title,reports:i.model.reports,groups:i.model.groups,output_types_and_templates:n.model.outputTypesAndTemplates}}async showMultipageModalForNewReport(e){const t=await this.createReportSteps(),i=t[0],n=t[1],s=this.createWidgetsCustomPageAddition(),o={disable:!1,lastStepButtonLabel:p.contextData.getMessage("_868669"),lastStepButtonProgressLabel:p.contextData.getMessage("_868670"),steps:[i,n,s],finishCondition:()=>void 0!==i.model.groups&&void 0!==m.TopicMenuUtils.getFirstSelectedEntry(i.model.groups),headerIcon:"icon2-tw-report",headerHelpLink:p.contextData.getLink("ACADEMY_SUBSCRIBE_ALERT"),headerTitle:p.contextData.getMessage("_895435"),headerDescription:p.contextData.getMessage("_895434"),callback:()=>{const t={description_filters_allowed:s.model.descriptionFiltersAllowed,title:i.model.title,reports:i.model.reports,groups:i.model.groups,output_types_and_templates:n.model.outputTypesAndTemplates,widget_title_suffix:s.model.titleSuffix},o=_.reportService.createReport(t,e);return f.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+p.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:o}),o}};u.loadingBubbleService.hideSpinner(),await h.modalService.display("MULTIPAGE_MODAL",o)}async showModalToAddWidgetsToReport(e){u.loadingBubbleService.showSpinner();const t=(await a.ReportPage.info()).report_container.reports,i={headerTitle:p.contextData.getMessage("_1894665"),headerDescription:p.contextData.getMessage("_1946262"),menuLabel:p.contextData.getMessage("_1985404"),topicMenu:t,descriptionFiltersAllowed:!1,callback:t=>{const i=_.reportService.addWidgetsToReport(t,e);return f.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+p.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:i}),i}};u.loadingBubbleService.hideSpinner(),await h.modalService.display("CUSTOM_PAGE_WIDGET_ADDITIONS",i)}async createReportSteps(){const e={title:"",groups:void 0,reports:void 0},t={label:p.contextData.getMessage("_1891032"),directiveName:"report-creation-form-fragment",model:e};u.loadingBubbleService.showSpinner();const i=(await a.ReportPage.info()).report_container;t.model.groups=i.groups,t.model.reports=i.reports;const n={outputTypesAndTemplates:i.output_types_and_templates};return[t,{label:p.contextData.getMessage("_1849065"),directiveName:"report-page-format-form-fragment",model:n}]}createWidgetCustomPageAddition(e){const t={widget:e,descriptionFiltersAllowed:!1};return{label:p.contextData.getMessage("_1958442"),directiveName:"widget-custom-page-addition-form-fragment",model:t}}createWidgetsCustomPageAddition(){return{label:p.contextData.getMessage("_1798165"),directiveName:"widgets-custom-page-addition-form-fragment",model:{descriptionFiltersAllowed:!1}}}async refreshPageData(e){const t={strategy:S.ModelRefreshStrategy.REFRESH},i=w.modelRefreshDecoratorFactory.getDecorator(v.mainApplication.getPageState(),v.mainApplication,C.ModelType.PAGE_STATE,t);try{await y.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&b.logService.error(e,void 0,t)}}}__decorate([l.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",Promise)],E.prototype,"createNewGroup",null),t.default=E,t.customPagesService=new E}),define("services/issue_tracker_service",["require","exports","log","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{async addToWatchList(e,t){return n.restFormService.postRForm("issue","create",{brand_mapped_id:e,issue_mapped_id:t})}async addToWatchlistFromUFS(e){const t=e.getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_brand),n=e.getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_issue);try{const e=t.getFirstSelectedEntryRecursively().getMappedId(),s=n.getFirstSelectedEntryRecursively().getMappedId();return await this.addToWatchList(e,s)}catch(e){i.logService.error(e)}}async addToSpecificWatchlist(e){return n.restFormService.postRForm("issue","create",e)}async addMultipleToWatchList(e){return n.restFormService.postRForm("issue","create",e)}}t.default=s,t.issueTrackerService=new s}),define("classes/application/mock_application",["require","exports","classes/application/abstract_application"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.MockApplication=class extends i.AbstractApplication{constructor(e){super(e),this.type=i.ApplicationType.MOCK}getConfiguration(){}injectPageState(e){}getPageState(){}isLoading(){return!1}}}),define("wrappers/page_state/page_state_request_wrapper",["require","exports","underscore","log","wrappers/page_state/page_state_wrapper","other/tw","wrappers/topic_menu/topic_entry_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","services/tw_common","services/rest_form_service","classes/application/mock_application","classes/application/application"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});const u={refreshAll:!0,reloadWidget:!0,removeCustomPageId:!0,setAllowedPagesReloadFlag:!1};t.PageStateRequestWrapper=class{constructor(e,t,i){this.$q=o.tw.inject("$q"),this.isDownloadSkeleton=!0,this.additionalPageStateParams=[],this.configuration=Object.assign({},u,i),this.application=new d.MockApplication(g.mainApplication),void 0!==t?this.preparePageStateWithWidget(e,t):this.preparePageStateAndClearWidgets(e),this.pageState.setApplication(this.application),this.pageState.getAllowedPages().setPageCategory(e.getAllowedPages().getPageCategory()),this.pageState.getAllowedPages().setPageType("RESULTS"),this.cleanPageState()}preparePageStateWithWidget(e,t){const i=e.clone(),n=i.toProto();i.dispose();const{reloadWidget:o}=this.configuration;t.setConfigurationChanged(!0),t.setReloading(o),n.data_input_configuration=[t.toProto()];const r=new s.PageStateWrapper(n,this.application);r.prune(!1),this.pageState=r}preparePageStateAndClearWidgets(e){this.pageState=e.clone(),this.pageState.clearWidgets()}cleanPageState(){const{removeCustomPageId:e,setAllowedPagesReloadFlag:t}=this.configuration;this.pageState.clearSections(),this.pageState.getAllowedPages().clearDashboards(),e&&this.pageState.getAllowedPages().removeCustomPageId(),t&&this.pageState.getAllowedPages().setReload(!0),this.pageState.getUserFilterSettings().removeTopicMenuByType(constants.topic_menu.TYPE.dashboard)}setGroupPage(e){this.pageState.getAllowedPages().setGroupPage(e)}setDisplayPage(e){const t=this.pageState.getAllowedPages().getDisplayPages();t.getRootEntry().removeChildren();const i=r.TopicEntryWrapper.create(e,void 0);i.setSelected(!0),t.getRootEntry().addChild(i)}replaceFilters(e){this.pageState.getUserFilterSettings().replaceFilters(e)}overrideFilters(e){this.pageState.getUserFilterSettings().overrideFilters(e)}setPageType(e){this.pageState.getAllowedPages().setPageType(e)}setCustomPageId(e){this.pageState.getAllowedPages().setCustomPageId(e)}setPageCategory(e){this.pageState.getAllowedPages().setPageCategory(e)}setAdditionalPageStateParams(e){this.additionalPageStateParams=e}getApplication(){return this.application}getUserFilterSettings(){return this.pageState.getUserFilterSettings()}applyDatagraphFilters(e){return this.getUserFilterSettings().applyDatagraphFilters(e)}setUfs(e){i.isFunction(e.toProto)?(e.replacePageState(this.pageState),this.pageState.replaceUserFilterSettings(e)):this.pageState.replaceUserFilterSettings(new a.UserFilterSettingsWrapper(e,this.pageState,c.twCommon.holderTypes.PAGE))}setDownloadSkeleton(e){this.isDownloadSkeleton=e}applyDatagraphFilter(e){return this.getUserFilterSettings().applyDatagraphFilter(e)}setProjectId(e){this.pageState.getProject().setId(e)}dispose(){this.application.dispose()}getPageState(){return this.pageState}getPageStateToSend(){return this.getPageState().clone()}requestPageState(e){const{refreshAll:t}=this.configuration,i=this.$q.defer(),o=this.pageState.copyAndPrune(!1);t&&(o.clearWidgetLoadingState(),o.getAllowedPages().setReload(!0));const r=o.toProto();r.ts=(new Date).getTime(),o.dispose();const a={page_state:r,is_skeleton:this.isDownloadSkeleton};return n.logService.debug("Requesting page state",c.twCommon.logFeatures.Application,{"request page state:":a}),this.additionalPageStateParams.forEach(e=>{r.id+="&"+e}),l.restFormService.post(routes.controllers.tw.TWRestForm.get("project",this.pageState.getProject().getId(),"page_state","refresh","","rform").url,a).then(t=>{const n=new s.PageStateWrapper(t.page_state,e);n.getAllowedPages().setReload(!1),i.resolve(n)},()=>{i.reject()}),i.promise}},t.default=i.constant(s.PageStateWrapper)}),define("wrappers/section/section_wrapper",["require","exports","log","underscore","services/configuration","services/tw_common","event"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e,t,n){i.logService.assert(void 0!==e,"sectionProto missing"),i.logService.assert(void 0!==t,"width missing"),i.logService.assert(void 0!==n,"pageStateWrapper missing"),this.internalAssociatedPageState=n,this.sectionProto=e,this.onResize=new r.Event,void 0===e.section_id&&(e.section_id=o.twCommon.generateUuid()),this.width=t}dispose(){this.internalAssociatedPageState=void 0,this.sectionProto=void 0}toProto(){return this.sectionProto}merge(e){i.logService.assert(void 0!==e,"section is required"),this.sectionProto=e.toProto()}isHidden(){return this.sectionProto.hidden}_setPageState(e){this.internalAssociatedPageState=e}setDataLoaded(e){this.sectionProto.data_loaded=e}isDataLoaded(){return this.sectionProto.data_loaded}hasAnyVisualizedWidget(){return n.any(this.getWidgets(),e=>e.isVisualizationInitialized())}areAllWidgetsLoaded(){return!n.any(this.getWidgets(),e=>!e.isDataLoaded())}isShared(){return this.sectionProto.is_shared}getContext(){return constants.report.element_context.body}getRemainingWidth(){let e=0;for(let t=0;t<this.getWidgets().length;t++)e+=this.getWidgets()[t].getWidth();return this.width-e}getId(){return this.sectionProto.section_id}setId(e){i.logService.assert(void 0!==e,"newId is required"),this.sectionProto.section_id=e}getWidth(){return this.width}getTabIndex(){return this.sectionProto.tab_index}hasTitle(){return void 0!==this.sectionProto.title}getTitle(){return this.sectionProto.title}hasDescription(){return void 0!==this.sectionProto.description}getDescription(){return this.sectionProto.description}isSortable(){return!!this.sectionProto.children_orderable}setSortable(e){this.sectionProto.children_orderable=e}attachTemplate(e){i.logService.assert(void 0!==e,"element is required"),this.element=e}hasTemplate(){return void 0!==this.element}getTemplate(){return this.element}repartitionSpace(){const e=this.getWidgets().length,t=Math.floor(this.width/e);let i;for(i=0;i<this.getWidgets().length;i++)i===this.getWidgets().length-1?this.getWidgets()[i].requestSizeChange(this.getRemainingWidth()+this.getWidgets()[i].getWidth()):this.getWidgets()[i].requestSizeChange(t);if(this.getRemainingWidth()<0)for(i=0;i<this.getWidgets().length&&this.getRemainingWidth()<0;i++)this.getWidgets()[i].requestSizeChange(this.getWidgets()[i].getWidth()+this.getRemainingWidth())}getLeftNeighbour(e){const t=this.getWidgets().indexOf(e);return t<=0?void 0:this.getWidgets()[t-1]}getRightNeighbour(e){i.logService.assert(void 0!==e,"widget argument is required");const t=this.getWidgets().indexOf(e);return-1===t||t===this.getWidgets().length-1?void 0:this.getWidgets()[t+1]}hasWidget(e){i.logService.assert(!n.isUndefined(e),"id is required"),i.logService.assert(n.isString(e),"id must be a string");for(let t=0;t<this.getWidgets().length;t++)if(this.getWidgets()[t].getId()===e)return!0;return!1}hasWidgets(){return this.getWidgets().length>0}addWidget(e,t,s){if(i.logService.assert(void 0!==e,"widget argument is required"),i.logService.assert(-1===n.indexOf(this.getWidgets(),e),"widget is already in this section"),e.setSectionId(this.getId()),void 0===t)return void this.internalAssociatedPageState.getWidgets().splice(0,0,e);const r=this.internalAssociatedPageState.getWidgets().indexOf(t);-1===r&&i.logService.error("droptarget "+t.getId()+" is not part of this section"),s===o.twCommon.sides.RIGHT?this.internalAssociatedPageState.getWidgets().splice(r+1,0,e):this.internalAssociatedPageState.getWidgets().splice(r,0,e)}isEmpty(){return 0===this.getWidgets().length}hasPage(){return void 0!==this.page}getPage(){return this.page}getPageState(){return this.internalAssociatedPageState}removePage(){this.page=void 0}setPage(e){i.logService.assert(void 0!==e,"page is required"),i.logService.assert(void 0===this.page," this section already belongs to a page"),this.page=e}removeWidget(e){i.logService.assert(void 0!==e,"widget argument is required"),i.logService.assert(n.isNumber(e.getWidth()),"widget has invalid width");const t=this.getWidgets().indexOf(e);i.logService.assert(-1!==t,"widget "+e.getId()+" is not part of this section"),e.setSectionId(void 0),this.internalAssociatedPageState.deleteWidget(e)}isPageBreakSection(){return 1===this.getWidgets().length&&this.getWidgets()[0].isPageBreak()}canBeDeleted(){for(let e=0;e<this.getWidgets().length;e++)if(!this.getWidgets()[e].canBeDeleted())return!1;return!0}isPayloadEditionSection(){return 1===this.getWidgets().length&&this.getWidgets()[0].isPayloadEdition()}isTextWidgetSection(){return 1===this.getWidgets().length&&this.getWidgets()[0].isText()}isWorldMapSection(){return 1===this.getWidgets().length&&this.getWidgets()[0].isWorldMap()}getSectionsPerScreen(){return 3}getHeightInPixel(){return n.max(this.getWidgets().map(e=>e.pixelHeight))}getHeight(){if(this.isEmpty())return 0;const e=n.max(this.getWidgets(),e=>s.configurationService.getWidgetConfiguration(e.getType()).getHeight(e));return s.configurationService.getWidgetConfiguration(e.getType()).getHeight(e)}getExportHeight(){return this.isEmpty()?0:n.max(this.getWidgets(),e=>e.getExportHeight()).getExportHeight()}isContent(){return this.getWidgets().length>0&&!this.isPageBreakSection()&&!this.isPayloadEditionSection()}clearWidgets(){this.removeWidget.apply(this,this.getWidgets())}swapWidgets(e,t){i.logService.assert(e<this.getWidgets().length,"indexA out of bounds"),i.logService.assert(t<this.getWidgets().length,"indexB out of bounds"),this.internalAssociatedPageState.swapWidgets(this.getWidgets()[e],this.getWidgets()[t])}getWidgets(){return this.internalAssociatedPageState.getWidgetsBySection(this)}getFirstWidget(){return n.first(this.getWidgets())}getLastWidget(){return i.logService.assert(!this.isEmpty(),"section cannot be empty"),this.getWidgets()[this.getWidgets().length-1]}getLastContentWidget(){i.logService.assert(!this.isEmpty(),"section cannot be empty");for(let e=this.getWidgets().length-1;e>=0;e--)if(this.getWidgets()[e].isContent())return this.getWidgets()[e]}canAddWidget(e){return-1!==this.getWidgets().indexOf(e)||e.getWidth()<=this.getRemainingWidth()}hasTabIndex(){return void 0!==this.sectionProto.tab_index}}t.SectionWrapper=a,t.default=n.constant(a)}),define("components/modals/add_to_watchlist/add_to_watchlist_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("components/bubble_dialog/widget/directive",["require","exports","angular_utilities","bubble_dialogs","event_bus","log","reusable_services","reusable_utilities","underscore","classes/application/application","classes/application/bubble_application","classes/application/single_page_bubble_application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/bubble_dialog","services/configuration","services/confirmation_service","services/context","services/custom_pages","services/issue_tracker_service","services/modal","services/refresh/model_refresh_service","services/rest_form_service","services/template_source","services/tw_common","wrappers/page_state/page_state_request_wrapper","wrappers/page_state/page_state_wrapper","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",scope:{},controller:I,controllerAs:"vm",bindToController:{payload:"=",id:"@",referenceElement:"=",styleInformation:"="},templateUrl:T.templateSourceFactory("components/bubble_dialog/widget"),compile:()=>({post:e})};function e(e,t,i,n){setTimeout(()=>{n.styleInformation.apply(n.referenceElement,t)},0)}};let I=class{constructor(e,t,i){this.$scope=e,this.$rootScope=t,this.$element=i,this.watchListItemAdded=!1,this.payloadHistory=[],this.payloadHistoryPointer=0,this.activeSections=[],this.allowedContextsForTimeInterval=["CONTEXT_INFLUENCER_DETAILS","CONTEXT_INFLUENCER_INFO"],this.cancellationToken=new a.CancellationToken,this.cancellationToken.addDomEvent($(document),"keydown",this.escape.bind(this)),this.cancellationToken.addDomEvent($(document),"mouseup",this.handleClick.bind(this)),this.cancellationToken.addDomEvent($(document),"mousedown",this.handleMouseDown.bind(this)),this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>document.body.scrollTop/(document.body.scrollHeight-$(document.body).outerHeight()),(e,t)=>{e>.95&&this.loadMore()})),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.PAGESTATE_REFRESH,e=>{this.application&&e.value.pagestate.getId()===this.application.getPageState().getId()&&this.activeSections.forEach(async e=>{e.areAllWidgetsLoaded()||(await this.reloadSection(e),this.$scope.$apply())})}),this.boundAddToWatchlist=this.openAddToWatchlistModal.bind(this),this.$scope.$on("$destroy",this.dispose.bind(this))}$onInit(){void 0===this.styleInformation&&(this.styleInformation=new n.BubbleDialogStyle),this.navigate(this.payload)}navigateBack(){this.reset(),this.payload=this.payloadHistory[this.payloadHistoryPointer-2],this.payloadHistoryPointer--;const e=new D.PageStateWrapper(this.application.getPageStateHistoryLog().navigateBack(),this.application);this.handleData(e,!0)}canShowHeaderText(){return!this.canShowTimeFilter()}getHeaderText(){if(void 0!==this.application&&this.application.getPageState()){const e=this.application.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.event);if(e&&!e.containsSelection())return`${u.contextData.getMessage("_1000602")} ${this.application.getPageState().getUserFilterSettings().getTimeFilter().formatTimeSpan()}`}return""}canNavigateBack(){return void 0!==this.application&&this.application.getPageStateHistoryLog().canNavigateBack()}canNavigateForward(){return void 0!==this.application&&this.application.getPageStateHistoryLog().canNavigateForward()}navigateForward(){this.reset(),this.payload=this.payloadHistory[this.payloadHistoryPointer++];const e=new D.PageStateWrapper(this.application.getPageStateHistoryLog().navigateForward(),this.application);this.payload.pageState=e,this.handleData(e,!0)}async loadMore(){if(void 0===this.application||!this.application.hasPageState()||this.application.isLoading())return;let e=this.application.getPageState().getNumberOfSectionsToLoad(),t=!1;if(this.application.getPageState().getSections().forEach(i=>{i.isDataLoaded()||e--<=0||i.getWidgets().forEach(e=>{this.shouldReloadWidget(e)&&(e.setReloading(!0),t=!0)})}),t){const e={strategy:h.ModelRefreshStrategy.LOAD_MORE_CONTENT},t=p.modelRefreshDecoratorFactory.getDecorator(this.application.getPageState(),this.application,m.ModelType.PAGE_STATE,e);try{await C.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&o.logService.error("Error when loading more in widget bubble dialog !",void 0,e)}}}isLoadingMore(){return void 0!==this.application&&this.application.hasPageState()&&this.application.getPageState().getWidgets().some(e=>e.isReloading()&&!e.isDataLoaded())}togglePageDashboard(){this.canAddToDashboardOrReport()?y.confirmationService.display({message:u.contextData.getMessage("_475533")}).then(()=>{this.toggleDashboardModal()},()=>void 0):this.toggleDashboardModal()}togglePageReport(){this.canAddToDashboardOrReport()?y.confirmationService.display({message:u.contextData.getMessage("_475533")}).then(()=>{S.customPagesService.showMultipageModalForNewReport(this.payload.pageState)},()=>void 0):S.customPagesService.showMultipageModalForNewReport(this.payload.pageState)}canAddToDashboardOrReport(){return this.isMainApplicationInfluencerOverviewPage()}canAddToWatchlist(){if(void 0!==this.application&&this.application.hasPageState()){const e=this.application.getPageState(),t=this.application.getPageState().getUserFilterSettings(),i=t.getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_brand),n=t.getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_issue);return n&&i&&void 0!==n.getFirstSelectedEntryRecursively()&&void 0!==i.getFirstSelectedEntryRecursively()&&e.canCreateIssueWatchItem()&&e.getAllowedPages().isIssueTrackerModule()&&e.getAllowedPages().getPageType()===constants.page_type.context_menu_issue_overview}return!1}async addToWatchlist(e){const t=this.application.getPageState().getUserFilterSettings();void 0!==await b.issueTrackerService.addToWatchlistFromUFS(t)&&(this.watchListItemAdded=!0)}async openAddToWatchlistModal(e){const t=this.application.getPageState().getUserFilterSettings();try{const{issue_tracker_brand:e,issue_tracker_issue:i}=constants.topic_menu.TYPE,n=t.getTopicMenuByType(e),s=t.getTopicMenuByType(i),r=n.getFirstSelectedEntryRecursively(),a=s.getFirstSelectedEntryRecursively(),c=r.getMappedId(),l=a.getMappedId(),d=await w.modalService.display("ADD_TO_WATCHLIST",{ufs:t,issue_mapped_id:l,brand_mapped_id:c}),{label:g,description:u,colors:p,watchlistMappedId:h}=d,m={brand_mapped_id:c,issue_mapped_id:l,watch_list_mapped_id:h,name:g,colors:p,ufs:t.toProto()};await b.issueTrackerService.addToSpecificWatchlist(m),this.watchListItemAdded=!0,o.logService.debug("Successfully added an issue to watchlist",{name:"BUBBLE_DIALOG",style:"color:indigo; font-weight:bold"},m)}catch(e){throw new Error(`Could not add issue to watchlist! ${e}`)}}getSectionZIndex(e){return void 0!==this.activeSections?this.activeSections.length-e:0}canShowBubbleTitle(){return this.payload.pageState&&this.payload.pageState.getAllowedPages()&&this.payload.pageState.getAllowedPages().hasWidgetBubbleTitle()}getBubbleTitle(){return void 0!==this.payload.pageState&&this.payload.pageState.hasAllowedPages()&&this.payload.pageState.getAllowedPages().hasWidgetBubbleTitle()?this.payload.pageState.getAllowedPages().getWidgetBubbleTitle():""}escape(e){e.keyCode===M.twCommon.keys.ESCAPE&&this.close()}applyFilters(){this.canAddToDashboardOrReport()?y.confirmationService.display({message:{title:u.contextData.getMessage("_1695864"),message:u.contextData.getMessage("_475533")}}).then(()=>{this.mergeFiltersAndRefresh()},()=>void 0):this.mergeFiltersAndRefresh()}showAppliedFilters(e){void 0===_.bubbleDialogService.getFirstBubbleById(constants.bubble_dialog.id.filters.selection)?_.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,$(e.target),this.application.getPageState().getUserFilterSettings(),f.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1,void 0,void 0,void 0,!0):this.cancelAppliedFiltersClose()}attemptCloseAppliedFilters(){_.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.filters.selection,500)}cancelAppliedFiltersClose(){_.bubbleDialogService.cancelDestructionById(constants.bubble_dialog.id.filters.selection)}applyOnAnalytics(){const e=window.open("","_blank");this.application.getPageState().navigate().then(t=>{e.location.href=t.url})}drilldownOnNewTab(){const e=window.open("","_blank");this.application.getPageState().navigate(!0).then(t=>{const i=new a.Url(t.url),n=new a.Url(window.location.href);n.setUrlParameter("i",i.getUrlParameter("i")),e.location.href=n.getHref()})}isLoading(){return void 0!==this.application&&this.application.isLoading()}hasReloadingWidgets(){let e=!1;return void 0!==this.application&&this.application.hasPageState()&&this.application.getPageState().getWidgets().forEach(t=>{t.isEmptyWidget()||t.isSkeleton()||!t.isReloading()||(e=!0)}),e}isApplyOnAnalyticsAllowed(){return(l.mainApplication.getPageState().getAllowedPages().isDashboard()||l.mainApplication.getPageState().getAllowedPages().isDashboardTemplate())&&!["CONTEXT_MENU_RESULT_ENTRY","CONTEXT_MENU_MESSAGE_DIFFUSION","CONTEXT_MENU_DIFFUSION_AND_VELOCITY","CONTEXT_MENU_VELOCITY_AND_DIFFUSION","CONTEXT_MENU_VELOCITY","CONTEXT_MENU_CONVERSATION_CLUSTER_STORIES"].includes(this.payload.pageType)}isPaged(){return"PAGED"===this.mode}isDrilldownAllowed(){return void 0!==this.application&&!this.application.getPageState().isDrilldownDisabled()&&(this.payload.showDrilldown&&!["CONTEXT_MENU_RESULT_ENTRY","CONTEXT_MENU_MESSAGE_DIFFUSION","CONTEXT_MENU_PREVIEW","CONTEXT_MENU_DIFFUSION_AND_VELOCITY","CONTEXT_MENU_VELOCITY_AND_DIFFUSION","CONTEXT_MENU_VELOCITY"].includes(this.payload.pageType)||this.isWorldMapDrilldownAllowed())}getDescription(){if(void 0!==this.payload.buttons)for(let e=0;e<this.payload.buttons.length;e++)if(this.payload.buttons[e].isSelected()&&this.payload.buttons[e].hasDescription())return this.payload.buttons[e].description}shouldCutText(e){return e.trim().length>30}cutText(e){let t=e.trim().slice(0,30);return t.lastIndexOf(" ")>-1&&(t=t.slice(0,t.lastIndexOf(" "))),t+"..."}parseTextForEmoji(e){return r.emojiService.parseTextForEmoji(e)}call(e,t){e.call(this.$scope,t)}close(){if(void 0!==this.application){const e=this.application.getPageState().getWidgets();void 0!==e&&e.forEach(e=>{if(e.hasReplayManager()){const t=e.getReplayManager();(t.timeline.isPlaying()||t.timeline.getParams().isWaiting)&&e.getReplayManager().timeline.stop()}})}_.bubbleDialogService.destroyById(this.id),this.watchListItemAdded&&(this.watchListItemAdded=!1,s.eventBus.dispatch({type:s.EVENT_TYPES.WATCHLIST_ITEM_ADDED,value:void 0}))}async compareChanged(){this.application.getPageState().getWidgets().forEach(e=>{e.setConfigurationChanged(!0)});const e={strategy:h.ModelRefreshStrategy.REFRESH},t=p.modelRefreshDecoratorFactory.getDecorator(this.application.getPageState(),this.application,m.ModelType.PAGE_STATE,e);try{await C.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&o.logService.error("Error when refreshing page state after changing compare in widget bubble dialog !",void 0,e)}}handleClick(e){$(e.target).parents("menuitem").add($(e.target)).is("menuitem")?c.defer(()=>{this.performHandleClick(e)}):this.performHandleClick(e)}canShowTimeFilter(){return void 0!==this.application&&this.allowedContextsForTimeInterval.includes(this.application.getPageState().getAllowedPages().getPageType())}getUserFilterSettings(){return this.application.getPageState().getUserFilterSettings()}navigate(e){this.reset(),this.payload=e,this.payloadHistory.push(this.payload),this.payloadHistoryPointer++,this.payloadHistory.length=this.payloadHistoryPointer,this.getData().then(this.handleData.bind(this))}canHideDateTime(){return this.allowedContextsForTimeInterval.includes(this.payload.pageState.getAllowedPages().getPageType())}toggleDashboardModal(){this.buildDashboardPageModalPayload().then(e=>{e.pageState=this.payload.pageState,w.modalService.display("DASHBOARD_PAGE",e)})}isMainApplicationInfluencerOverviewPage(){return void 0!==this.application&&this.application.getPageState().getAllowedPages().getPageType()===constants.page_type.context_menu_influencer_overview}reset(){this.activeMultiSection=void 0,this.multiSectionButtons=[],this.activeSections=[]}getData(){return"PAGE_STATE"===(this.payload.dataSource||"PAGE_STATE")?this.getDataFromPageState():this.getDataFromLocal()}handleDataIndexedPaged(e){this.tabGroups={},e.getSections().forEach(e=>{void 0===this.tabGroups[e.getTabIndex()]&&(this.tabGroups[e.getTabIndex()]=[],this.payload.buttons.push({text:e.getTitle()||e.getFirstWidget().getTitle(),description:e.getDescription(),onClick:t=>{let i,n;void 0!==t&&(n=$(t.target).parents(".tw-bubble-dialog"),i=n.css("min-width"),n.css("min-width",n.outerWidth())),this.activeSections=this.tabGroups[e.getTabIndex()],this.tabGroups[e.getTabIndex()].forEach(async e=>{e.areAllWidgetsLoaded()||(await this.reloadSection(e),this.$scope.$apply(),n&&setTimeout(()=>{o.logService.info("Are all widgets loaded is: "+this.areAllWidgetsLoaded().toString()),n.css("min-width",i)},500))})},isSelected:()=>this.activeSections===this.tabGroups[e.getTabIndex()],hasDescription:()=>e.hasDescription()})),this.tabGroups[e.getTabIndex()].push(e)}),this.payload.buttons[0].onClick()}handleDataPaged(e){let t;e.getSections().forEach((e,i)=>{if(!e.hasWidgets())return;const n={text:e.getTitle()||e.getFirstWidget().getTitle(),description:e.getDescription(),onClick:async()=>{this.activeSections=[e],e.areAllWidgetsLoaded()||(await this.reloadSection(e),this.$scope.$apply())},isSelected:()=>this.activeSections[0]===e,hasDescription:()=>e.hasDescription()};0===i&&(t=n),void 0!==n.text&&this.payload.buttons.push(n),void 0===this.payload.selectedSection||e.getTitle()!==this.payload.selectedSection&&e.getFirstWidget().getTitle()!==this.payload.selectedSection||c.last(this.payload.buttons).onClick()}),0===this.activeSections.length&&void 0!==t&&t.onClick()}handleDataSinglePage(e){e.getSections().forEach((e,t)=>{0===t&&e.hasTitle()&&this.payload.buttons.push({text:e.getTitle(),description:e.getDescription(),isSelected:()=>!0,hasDescription:()=>e.hasDescription(),onClick:()=>void 0}),e.hasWidgets()&&this.activeSections.push(e)})}handleDataSingleAndPaged(e){e.getSections().forEach((e,t)=>{0===t&&e.hasTitle()&&this.payload.buttons.push({text:e.getTitle(),description:e.getDescription(),isSelected:()=>!0,hasDescription:()=>e.hasDescription(),onClick:()=>void 0}),e.isShared()||this.multiSectionButtons.push({text:e.getTitle()||e.getFirstWidget().getTitle(),description:e.getDescription(),onClick:()=>{const t=this.activeSections.indexOf(this.activeMultiSection);this.activeSections[t]=e,this.activeMultiSection=e,e.areAllWidgetsLoaded()||this.reloadSection(e)},isSelected:()=>this.activeMultiSection===e,hasDescription:()=>e.hasDescription()}),e.hasWidgets()&&(e.isShared()||void 0===this.activeMultiSection)&&(this.activeSections.push(e),e.isShared()||(this.activeMultiSection=e))})}handleData(e,t){this.mode=e.getAllowedPages().getPageMode()||"PAGED",t||(void 0!==this.payload.widgetToSend&&this.payload.widgetToSend.dispose(),void 0===this.application&&(this.mode===M.twCommon.WidgetBubbleMode.SINGLE_PAGE||this.mode===M.twCommon.WidgetBubbleMode.SINGLE_AND_PAGED||this.mode===M.twCommon.WidgetBubbleMode.INDEXED_PAGED?(this.payload.pageState.dispose(),this.application=new g.SinglePageBubbleApplication(l.mainApplication)):(this.payload.pageState.dispose(),this.application=new d.BubbleApplication(l.mainApplication))),this.application.getPageStateHistoryLog().addStep(e)),e.setApplication(this.application),this.application.injectPageState(e),this.payload.forbidExpand?this.application.getWidgetSettings().forbiddenWidgetActions.push(M.twCommon.widgetActionButtons.FULL_SCREEN):this.application.getWidgetSettings().forbiddenWidgetActions.length=0,this.application.getWidgetSettings().displayFullSizeWidget=!!this.payload.displayFullSizeWidget,this.allowedPagesCompareTM=e.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.allowed_monitor_page_compare),this.payload.pageState=e,this.payload.buttons=[],this.mode===M.twCommon.WidgetBubbleMode.PAGED?this.handleDataPaged(e):this.mode===M.twCommon.WidgetBubbleMode.SINGLE_PAGE?this.handleDataSinglePage(e):this.mode===M.twCommon.WidgetBubbleMode.SINGLE_AND_PAGED?this.handleDataSingleAndPaged(e):this.mode===M.twCommon.WidgetBubbleMode.INDEXED_PAGED&&this.handleDataIndexedPaged(e),this.$rootScope.$$phase||this.$rootScope.$apply()}async getDataFromPageState(){const{refreshAll:e,reloadWidget:t,removeCustomPageId:i,setAllowedPagesReloadFlag:n}=this.payload,s=new P.PageStateRequestWrapper(this.payload.pageState,this.payload.widgetToSend,{reloadWidget:t,refreshAll:e,removeCustomPageId:i,setAllowedPagesReloadFlag:n});s.setDownloadSkeleton(!1),void 0!==this.payload.ufs&&(this.payload.ufs.overrideFilters(this.payload.pageState.getUserFilterSettings()),s.replaceFilters(this.payload.ufs)),void 0!==this.payload.src&&void 0!==this.payload.src.page_state&&void 0!==this.payload.src.page_state.params&&s.setAdditionalPageStateParams(this.payload.src.page_state.params);const o=void 0!==this.payload.groupPage?this.payload.groupPage:"CONTEXT_MENU";return s.setGroupPage(o),s.setPageType(this.payload.pageType),void 0!==this.payload.filters&&this.payload.filters.length>0?(await s.applyDatagraphFilters(this.payload.filters),this.requestPageState(s)):this.requestPageState(s)}getDataFromLocal(){return new Promise((e,t)=>{const i=this.payload.pageState.clone();this.payload.widgetToSend&&(i.clearWidgets(),i.getSections()[0].addWidget(this.payload.widgetToSend.clone()),this.payload.widgetToSend._setPageState(i)),e(i)})}requestPageState(e){return new Promise((t,i)=>{e.requestPageState(this.application).then(i=>{e.dispose(),e=void 0,void 0===this.cancelPageState&&(i.getWidgets().forEach(e=>e.setReloading(!1)),t(i))})})}getFilterTypesToIgnore(){const e=[];switch(this.application.getPageState().getAllowedPages().getPageType()){case constants.page_type.context_menu_influencer_overview:e.push(constants.topic_menu.TYPE.time_filter)}return e}areAllWidgetsLoaded(){return this.activeSections.every(e=>e.areAllWidgetsLoaded())}shouldReloadWidget(e){const t=this.application.getPageState().getSectionById(e.getSectionId()).getTabIndex();return!e.isReloading()&&(!this.activeSections||this.tabGroups&&void 0!==t&&this.activeSections===this.tabGroups[t])}shouldCloseBubble(e,t,i){if(this.clickedInside)return!1;if(M.twCommon.isPointOnElement({x:e,y:t},this.$element))return!1;const n=$(".tw-widget-menu-dropdown");if(n.is(i)||n.has(i).length>0)return!1;const s=this.$element.find("#entryMenu");if(s.is(i)||s.has(i).length>0)return!1;const o=$(".modal-dialog");return!(o.is(i)||o.has(i).length>0)&&(!($(i).parents("#notifications").length>0)&&(this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY))}performHandleClick(e){this.shouldCloseBubble(e.clientX,e.clientY,e.target)&&this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&(e.stopPropagation(),this.close()),this.clickedInside=!1}handleMouseDown(e){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY,M.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)&&(this.clickedInside=!0)}dispose(){this.cancellationToken.cancel(),void 0!==this.application?this.application.dispose():this.cancelPageState=!0}isWorldMapDrilldownAllowed(){if(this.payload.pageType===constants.page_type.context_menu_world_map&&this.application.isIdle()){const e=this.application.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.geodata_precision_types);if(void 0!==e){const t=e.getFirstSelectedEntry();return void 0!==t&&(t.getMappedId()!==constants.geodata_precision_type.real_coordinates||t.getMappedId()===constants.geodata_precision_type.real_coordinates&&this.application.getPageState().getUserFilterSettings().hasSearchbarFilter()&&this.application.getPageState().getUserFilterSettings().getSearchbarFilter().hasSourcegeoResolutionCoordinates())}}return!1}async mergeFiltersAndRefresh(){l.mainApplication.getPageState().getUserFilterSettings().merge(this.application.getPageState().getUserFilterSettings().clone(),this.getFilterTypesToIgnore()),l.mainApplication.getPageState().getUserFilterSettings().checkFiltersChanged();const e={strategy:h.ModelRefreshStrategy.REFRESH},t=p.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,m.ModelType.PAGE_STATE,e);try{await C.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&o.logService.error("Error when refreshing page state after applying widget bubble dialog filters to main page !",void 0,e)}this.close()}buildDashboardPageModalPayload(){const e=routes.controllers.tw.TWRestForm.get(v.contextService.getCurrentContext().scope,v.contextService.getCurrentContext().id,"dashboard_groups","show","","rform").url;return E.restFormService.get(e).then(e=>({pageState:void 0,name:void 0,description:void 0,widget_title_suffix:"",description_filters_allowed:!1,groups:new A.TopicMenuWrapper(e.groups)}))}reloadSection(e){return Promise.all(e.getWidgets().map(async e=>(e.prepareReload(),this.refreshWidgetData(e))))}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:h.ModelRefreshStrategy.REFRESH},i=p.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),m.ModelType.WIDGET,t);try{return await C.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&o.logService.error("Error when refreshing widget!",void 0,e)}}else o.logService.error("reload attempted on widget without page state, this could be due to a memory leak",M.twCommon.logFeatures.WidgetWrapper)}};I=__decorate([i.ngInject(["$scope","$rootScope","$element"]),__metadata("design:paramtypes",[Object,Object,Object])],I)}),define("services/bubble_dialog",["require","exports","log","other/tw","services/configuration","services/tw_common","classes/bubble_dialog/widget_dialog_config","bubble_dialogs","angular","angular_utilities","event_bus","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});let u=class extends a.BubbleDialogService{constructor(e,t){super({$compile:e,parentScope:t.$new(!0),angularDirectivePrefix:"tw-bubble-dialog-",persist:!1,parentElement:$(".tw-bubbles"),autoFlipDirections:["LEFT","TOP","RIGHT","BOTTOM","CENTER"],timeout:{delay:250}}),this.cancellationToken=new g.CancellationToken,this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.BUBBLE_DIALOG_CREATE,this.handleCreateEvent.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,this.handleDestroyEvent.bind(this))}createWidgetReplayBubble(e){const t=new r.WidgetDialogConfig(e.getPageState());if(t.getStyle().setWidth("90%").setMaxWidth(0),!e.isReplayable())throw Error("cannot create widget replay bubble because the widget is not replayable");{const i=e.clone();t.setGroupPage(e.getPageState().getAllowedPages().getGroupPage()).setPageType("REPLAY").setShowCompareBar(!1).setMode(o.twCommon.WidgetBubbleMode.SINGLE_PAGE).setShowDrilldown(!1).setReuseActiveBubbleIfAble(!0).setWidgetToSend(i).setForbidExpand(!0).setDisplayFullSizeWidget(!0)}return this.createWidgetDialogBubble(t)}createWidgetDialogBubble(e){const t=void 0===e.getWidgetToSend()?void 0:e.getWidgetToSend().clone(),i={pageState:e.getPageState().clone(),widgetToSend:t,filters:e.getFilters(),groupPage:e.getGroupPage(),mode:e.getMode(),pageType:e.getPageType(),ufs:e.getUfs(),showDrilldown:e.getShowDrilldown(),showCompareBar:e.getShowCompareBar(),dataSource:e.getDataSource(),refreshAll:void 0===t,displayFullSizeWidget:e.isDisplayFullSizeWidget(),forbidExpand:e.getForbidExpand(),reloadWidget:e.getReloadWidget(),removeCustomPageId:e.getRemoveCustomPageId(),setAllowedPagesReloadFlag:e.shouldSetAllowedPagesReloadFlag()},n=this.getFirstBubbleById(constants.bubble_dialog.id.widget);return e.getReuseActiveBubbleIfAble()&&void 0!==n&&void 0!==n.getScope()?(n.getScope().vm.navigate(i),n):this.createByType(constants.bubble_dialog.id.widget,e.getTargetElement(),"widget",i,e.getStyle())}createDropDownMenu(e,t,i,n,s,o){return this.createByType(e,t,"drop-down-menu",i,n,s,o)}createMessageWithPayload(e,t,i,n,s,o){return this.createByType(e,t,"message",i,n,s,o)}createMessage(e,t,i,n,s,o,r,a,c={}){const l=Object.assign({title:i,content:n,buttons:s},c);return this.createMessageWithPayload(e,t,l,o,r,a)}createSelectedFilters(e,t,n,s,r,a,c,l=!0,d=!1){i.logService.assertDefined(n,o.twCommon.logFeatures.BubbleDialog);const g={ufs:n,widget:a,editable:r,showAll:c,selfDestructable:l,readOnly:d};return this.createByType(e,t,"filters-selection",g,s)}createRFormBubble(e,t,i,n,s,o){return this.createByType(e,t,"rform",i,n,s,o)}createCutoffLegendBubble(e,t){e.dispose=!0;const i=s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.pie);return this.createMessageWithPayload(constants.bubble_dialog.id.cutoff,t,e,i)}createTokenExpirationBubble(e,t){e.dispose=!0;const i=s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.pie);return this.createMessageWithPayload(constants.bubble_dialog.id.cutoff,t,e,i)}handleCreateEvent(e){const{id:t,targetElement:i,type:n,payload:r,placement:a,config:c,parent:l}=e.value,d=s.configurationService.getBubbleDialogConfiguration().getStyle(n);switch(a){case"top":d.setArrowSide(o.twCommon.sides.BOTTOM);break;case"right":d.setArrowSide(o.twCommon.sides.LEFT);break;case"bottom":d.setArrowSide(o.twCommon.sides.TOP);break;case"left":d.setArrowSide(o.twCommon.sides.RIGHT);break;default:console.warn("incorrect value")}return this.createByType(t,i,n,r,d,c,l)}handleDestroyEvent(e){const{id:t,schedule:i}=e.value;i?this.scheduleDestructionById(t,250):this.destroyById(t)}};u=__decorate([l.ngInject(["$compile","$rootScope"]),__metadata("design:paramtypes",[Function,Object])],u),t.default=u,Object.defineProperty(t,"bubbleDialogService",{get:function(){return n.tw.inject("bubbleDialogService")}})}),define("services/bulletin",["require","exports","services/application_mode","services/context","services/modal","services/rest_form_service"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.messages=[],this.bulletinMessagesModal=[],i.applicationMode.getAppModeModelForCurrentMode().public||this.startPeriodicalFetching(12e4)}dismiss(e){const{scope:t,id:i}=n.contextService.getCurrentContext();return o.restFormService.put(routes.controllers.tw.TWRestForm.put(t,i,"bulletin","update",e,"rform").url,{})}dismissAll(e){const t={message_ids:e},{scope:i,id:s}=n.contextService.getCurrentContext();return o.restFormService.post(routes.controllers.tw.TWRestForm.post(i,s,"bulletin","dismiss","","rform").url,t)}async displayBulletinMessage(e){try{await s.modalService.display("BULLETIN_NOTIFICATION",e)}catch(e){if(void 0!==e)throw e}finally{this.notificationDismiss(e)}}async responseShowHandler(e){this._filterOutMessages(this.messages,e.messages);const t=this._retrieveNewBulletinMessage(this.bulletinMessagesModal,_.where(e.messages,{type:constants.notification.confirm}));if(t&&t.length>0){for(const e of t)this.displayBulletinMessage(e);this.bulletinMessagesModal=_.union(this.bulletinMessagesModal,t)}}notificationDismiss(e){this.dismiss(e.id).then(()=>{this.bulletinMessagesModal=_.reject(this.bulletinMessagesModal,t=>t.id===e.id)})}_retrieveNewBulletinMessage(e,t){const i=[];return t.forEach(t=>{const n=_.where(e,{id:t.id});n&&0!==n.length||i.push(t)}),i}_filterOutMessages(e,t){t.forEach(t=>{if(t.key!==constants.bulletin.predefined.token_expires&&t.key!==constants.bulletin.predefined.token_expired&&t.key!==constants.bulletin.predefined.impersonating_user){const i=_.where(e,{id:t.id});i&&0!==i.length||e.unshift(t)}})}startPeriodicalFetching(e){setInterval(()=>this.fetchBulletin(),e)}fetchBulletin(){if([i.AppMode.IMAGE_EXPORT,i.AppMode.HOOTSUITE_DASHBOARD,i.AppMode.SHARED_DASHBOARD,i.AppMode.EMBEDDED].includes(i.applicationMode.getCurrentAppMode()))return;if(n.contextService.isNoneContext())return;const{id:e,scope:t}=n.contextService.getCurrentContext();o.restFormService.get(routes.controllers.tw.TWRestForm.get(t,e,"bulletin","show","","rform").url).then(e=>this.responseShowHandler(e))}get(){return this.messages}}t.BulletinService=r,t.bulletinService=new r}),define("services/tw_routing",["require","exports","underscore","event","reusable_utilities","other/tw","services/bubble_dialog","services/context","services/rest_form_service","services/router","log","classes/application/abstract_application","classes/application/application","services/bulletin"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});class h{constructor(){this.onPageChangeBegin=new n.Event,this.onPageChangeCanceled=new n.Event,this.onPageChangeEnd=new n.Event,this.onPageBuilt=new n.Event,this.onContextChange=new n.Event,this.forceReloadContextData=!1,l.routerService.router.onRoutingRequest.subscribe(e=>{const t=e.oldUrl,i=e.newUrl;a.contextService.checkAndSetContext(e,this.forceReloadContextData)&&this.onContextChange.fire(t,i,this.getPageByUrl(i)),this.pageLoadedAtLeastOnce=!0,this.pageIsLoading=!0,this.forceReloadContextData=!1}),l.routerService.router.onRoutingAccept.subscribe((e,t)=>{r.bubbleDialogService.destroyAll(),this.onPageChangeBegin.fire(this.getPageByUrl(e.oldUrl),this.getPageByUrl(e.newUrl),e,t||{})}),l.routerService.router.onRoutingCanceled.subscribe(e=>{this.onPageChangeCanceled.fire(this.getPageByUrl(e.oldUrl),this.getPageByUrl(e.newUrl),e),this.pageIsLoading=!1}),l.routerService.router.onRoutingFinish.subscribe((e,t)=>{this.onPageChangeEnd.fire(this.getPageByUrl(e.oldUrl),this.getPageByUrl(e.newUrl),e,t||{}),p.bulletinService.fetchBulletin(),this.pageIsLoading=!1}),l.routerService.router.onUnknownPage.subscribe(e=>{window.location.hash="",window.location.pathname=window.bootPayload.defaultUrl}),l.routerService.router.onRoutingError.subscribe((e,t)=>{setTimeout(()=>{window.location.hash="",window.location.pathname=window.bootPayload.defaultUrl},3e3)})}navigate(e,t){l.routerService.router.navigateTo(e,t)}refresh(e){l.routerService.router.reload(e)}getActivePage(){return l.routerService.router.getCurrentPage()}getPageByUrl(e){return l.routerService.router.getPageByUrl(e)}changePageById(e,t=""){d.logService.warn("Using this method is not relyable, it only works if the page pattern happens to not require any arguments and is part of the /app/page pages");const i=routes.controllers.tw.Page.show("","").url,n=l.routerService.router.getPageById(e);window.location.href=i+"#"+n.getPatterns()[0].split("#")[1]+"#"+t}changePageByUrl(e,t={}){return new Promise(i=>{this._changePageByUrl(e,t,i)})}_changePageByUrl(e,t,i){const n={name:"TW_ROUTING"};d.logService.verbose(`changing page by url: ${e}\n        with the following arguments: ${JSON.stringify(t)}`,n),-1!==e.indexOf("routing_service")?(d.logService.verbose("url requires further routing upon resolution",n),u.mainApplication.setState(g.ApplicationState.LOADING),c.restFormService.get(e).then(e=>{d.logService.verbose("url resolved, initializing subsequent routing",n),e.result.url_type=e.result.url_type.toUpperCase(),"EXTERNAL"===e.result.url_type?(d.logService.verbose("intiating external url resolution",n),setTimeout(()=>{window.location.href=new s.Url(e.result.url).assignUrlParameters(t).getHref()},0,!1)):(d.logService.verbose("intiating internal url resolution",n),this._changePageByUrl(e.result.url,t,i))},()=>u.mainApplication.setState(g.ApplicationState.IDLE))):(d.logService.verbose("url doesn't require further routing upon resolution",n),setTimeout(()=>{d.logService.verbose("resolving url",n);const o=this.getPageByUrl(e),r=this.getActivePage(),a=new s.Url(e);let c=!1;void 0!==o&&void 0!==r&&(d.logService.verbose("comparing targetPage and currentpage",n),o.getId()===r.getId()&&(d.logService.verbose("targetPage and currentpage determined to be identical",n),c=!0)),a.hasParameterHash()&&(d.logService.verbose(`found parameter hash in url: ${a.getParameterHash()}`,n),a.setParameterHash(encodeURIComponent(a.getParameterHash()))),decodeURIComponent(window.location.pathname+window.location.hash)===decodeURIComponent(a.getHref())?u.mainApplication.setState(g.ApplicationState.IDLE):window.location.href=new s.Url(a.getHref()).assignUrlParameters(t).getHref(),d.logService.verbose("finished resolving url",n),i(c)},0,!1))}reloadPageAndContext(){this.forceReloadContextData=!0,l.routerService.router.reload()}search(e){const t=new s.Url(window.location.href);e?t.setUrlParameter("sr",e):t.removeUrlParameter("sr"),window.location.href=t.getHref()}getSearchParameters(){return new s.Url(window.location.href).getUrlParameter("sr")}getUrlParameter(e){return new s.Url(window.location.href).getUrlParameter(e)}setUrlParameter(e,t){window.location.href=new s.Url(window.location.href).setUrlParameter(e,t).getHref()}removeUrlParameter(e){window.location.href=new s.Url(window.location.href).removeUrlParameter(e).getHref()}getGroupPage(){const e=this.getActivePage();return!i.isUndefined(e)&&e.getGroupPage()?e.getGroupPage():o.tw.pageState.getAllowedPages().getGroupPage()}}__decorate([s.deprecated("getPageByUrl"),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String]),__metadata("design:returntype",void 0)],h.prototype,"changePageById",null),t.default=h,Object.defineProperty(t,"twRoutingService",{get:function(){return o.tw.inject("twRoutingService")}})}),define("classes/refresh/abstract_refresh_decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractRefreshDecorator=class{isAllowed(){return!0}}}),define("classes/refresh/decorator/abstract_page_state_refresh_decorator",["require","exports","flux","log","reusable_utilities","other/tw","services/broker","services/loading_bubble","services/router","services/tw_common","services/tw_routing","wrappers/page_state/page_state_wrapper","classes/refresh/abstract_refresh_decorator","classes/refresh/model_refresh_strategy"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractPageStateRefreshDecorator=class extends u.AbstractRefreshDecorator{constructor(e,t,i="page_state"){super(),this.endpoint=i,this.application=t,this.pageState=e}processError(e,t){if(e.request_limit_breached&&e.page_state)return this.processResponse(e,t);throw e}copyPageState(e){return e?this.pageState.clone():this.pageState.copyAndPrune(!0)}mergePageStateFromRestForm(e,t){const i=this.wrapPageStateFromRestForm(e);this.pageState.getApplication().injectPageState(i,!0,t===p.ModelRefreshStrategy.LOAD_MORE_CONTENT)}wrapPageStateFromRestForm(e){return new g.PageStateWrapper(e.page_state,this.pageState.getApplication())}bypassCache(e){e.setNoCache()}setUrlHash(e){if("TOPIC_SETUP"!==d.twRoutingService.getGroupPage()){n.logService.debug("Set page hash to page state hash",l.twCommon.logFeatures.Application);const t=new s.Url(window.location.href);t.setParameterHash(e.getPageState().getId()),setTimeout(()=>{c.routerService.router.setUrlWithoutRouting(t.getHref())},0)}}preparePageStateRefresh(e){e.clearWidgetLoadingState(),e.getAllowedPages().setReload(!0)}dispatchPageStateReceivedEvents(){i.dispatcher.dispatch("global_onPageStateReceived",this.pageState.getId()),r.brokerService.publish(constants.events.page_state.received,[this.pageState])}showSpinner(){a.loadingBubbleService.showSpinner()}hideSpinner(){a.loadingBubbleService.hideSpinner()}delayHideSpinnerBy(e){a.loadingBubbleService.delayHideSpinnerBy(e)}handleAngularScopeApply(){o.tw.inject("$rootScope").$$phase||o.tw.inject("$rootScope").$apply()}}}),define("classes/refresh/decorator/page_state/page_state_refresh_decorator",["require","exports","classes/refresh/model_state","classes/refresh/decorator/abstract_page_state_refresh_decorator"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateRefreshDecorator=class extends n.AbstractPageStateRefreshDecorator{prepareForRefresh(e){const t=this.copyPageState(e.keepPayload);return this.preparePageStateRefresh(t),e.noLoadingBubble||this.showSpinner(),{page_state:t.toProto(),is_skeleton:e.modelState===i.ModelState.PARTIAL}}processResponse(e,t){return this.mergePageStateFromRestForm(e,t),this.dispatchPageStateReceivedEvents(),this.pageState.getApplication().isMainApplication()&&this.setUrlHash(this.pageState.getApplication()),this.handleAngularScopeApply(),this.delayHideSpinnerBy(300),this.pageState}}}),define("controllers/routing/page_state_page",["require","exports","log","reusable_utilities","classes/application/abstract_application","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_state","classes/refresh/model_type","other/tw","services/refresh/model_refresh_service","services/router","wrappers/page_state/page_state_wrapper","controllers/routing/abstract_page_controller"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.PageStatePage=class extends h.AbstractPageController{constructor(e,t,i,n,s){super(e,t,i,n,s)}navigate(e,t){if(e.requestToken.isCanceled())return;t=t||{};const i=new n.Url(e.newUrl);if(void 0===i.getUrlParameter("g")&&i.setUrlParameter("g",this.getGroupPage()),t.urlParams&&i.setUrlParameters(t.urlParams),this.config.parameters){const e=i.parseParameters(this.config.parameters);Object.keys(e).forEach(t=>{i.setUrlParameter(t,e[t])})}setTimeout(()=>{history.replaceState({},"",i.getHref()),e.accept(),t.waitForExitAnimationToFinishBeforeEntering?setTimeout(()=>this.fetchData(e,t),t.animationDuration):this.fetchData(e,t)},0)}async fetchData(e,t){if(!1===t.applicationRefresh)return void e.complete(d.tw.pageState);let s;try{s=await this.loadPage(new n.Url(e.newUrl),t,!1,!1,e)}catch(e){return void i.logService.error(e)}if(!e.requestToken.isCanceled())try{e.complete(s)}catch(s){e.error(s)}}refresh(e){if(e.requestToken.isCanceled())return;e.accept();const t=new n.Url(e.newUrl),i=new n.Url(e.oldUrl);this.loadByStrategy(t,i,e).then(()=>{e.complete()})}async loadByStrategy(e,t,i){""===e.getParameterHash()?this.addMissingParameters(e,{},i):(e.getUrlParameter("i")||e.getUrlParameter("t"))&&void 0!==d.tw.pageState&&void 0!==d.tw.pageState.getId()&&decodeURIComponent(e.getParameterHash())!==decodeURIComponent(d.tw.pageState.getId())?await this.loadPage(e,{},!1,!0,i):void 0===e.getUrlParameter("g")?(e.setUrlParameter("g",this.getGroupPage()),await n.waitFor(0),history.replaceState({},"",e.getHref()),await this.loadPage(e,{},!0,!0,i)):e.getUrlParameter("g")!==t.getUrlParameter("g")&&"TOPIC_SETUP"!==e.getUrlParameter("g")||(await n.waitFor(0),history.replaceState({},"",e.getHref()),await this.loadPage(e,{},!0,!0,i))}async loadPage(e,t,i=!1,n=!1,r){o.mainApplication.setState(s.ApplicationState.LOADING);const a=this.isSkeletonNeeded(r),c=await this.loadPageData(t,a);if(!r.requestToken.isCanceled())return c.getAllowedPages().setReload(!0),this.pageData=c,this.pageData.setSkeleton(a),this.injectPageData(c,i,e,n),this.initializeNewPage(t),c}injectPageData(e,t,i,n){o.mainApplication.injectPageState(e,n),t&&(i.setParameterHash(e.getId()),setTimeout(()=>{u.routerService.router.setUrlWithoutRouting(i.getHref())},0))}async loadPageData(e,t){if(e.applicationRefresh)return this.reloadPageState(e);{const e=await this.downloadPageState(t);return new p.PageStateWrapper(e,o.mainApplication)}}async reloadPageState(e){const t={strategy:a.ModelRefreshStrategy.RELOAD,noLoadingBubble:e.noLoadingBubble},n=r.modelRefreshDecoratorFactory.getDecorator(o.mainApplication.getPageState(),o.mainApplication,l.ModelType.PAGE_STATE,t);try{return await g.modelRefreshService.refresh(n,t)}catch(e){e instanceof Error&&i.logService.error("Error when reloading page state !",void 0,e)}}downloadPageState(e){const t={modelState:!0===e?c.ModelState.PARTIAL:c.ModelState.FULL,modelType:l.ModelType.PAGE_STATE,id:window.pageStateToken};return g.modelRefreshService.downloadData(t)}addMissingParameters(e,t,i){e.setUrlParameter("g",this.getGroupPage()),setTimeout(()=>{history.replaceState({},"",e.getHref()),this.loadPage(e,t,!1,!1,i)},0)}async initializeNewPage(e){if(this.pageData.isSkeleton()){o.mainApplication.setState(s.ApplicationState.LOADING);const t={strategy:a.ModelRefreshStrategy.REFRESH,delay:0,noLoadingBubble:e.noLoadingBubble},n=r.modelRefreshDecoratorFactory.getDecorator(o.mainApplication.getPageState(),o.mainApplication,l.ModelType.PAGE_STATE,t);try{await g.modelRefreshService.refresh(n,t)}catch(e){e instanceof Error&&i.logService.error("Error when refreshing page state for page initialization !",void 0,e)}}this.applyPageTitle(),this.pageData=void 0}isSkeletonNeeded(e){const t=new n.Url(e.newUrl),i=new n.Url(e.oldUrl);return e.oldUrl!==e.newUrl&&i.getUrlParameter("g")!==t.getUrlParameter("g")}}}),define("controllers/routing/r_form_page",["require","exports","reusable_utilities","classes/application/abstract_application","classes/application/application","other/tw","services/loading_bubble","controllers/routing/abstract_page_controller","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.RFormPage=class extends a.AbstractPageController{constructor(e,t,i,n,s){super(e,t,i,n,s),this.form=s.form,this.action=s.action}async navigate(e){e.accept();try{const t=await this.getData(e);if(e.requestToken.isCanceled())return;this.initialize(t),e.complete(t)}catch(t){if(e.requestToken.isCanceled())return;e.error(t)}}getData(e){return new Promise((t,i)=>{if(e.requestToken.isCanceled()&&t(),this.config.dataQuery)return t(this.config.dataQuery());s.mainApplication.setState(n.ApplicationState.LOADING);const r=routes.controllers.tw.TWRestForm.get(this.config.context||"project",o.tw.project_id,this.form,this.action||"show","","rform").url;c.restFormService.get(r).then(e=>{t(e)},e=>{i({status:e.status,text:e.statusText})})})}initialize(e){s.mainApplication.setState(n.ApplicationState.IDLE),r.loadingBubbleService.hideSpinner(),this.applyPageTitle()}refresh(e){const t=new i.Url(e.newUrl),n=new i.Url(e.oldUrl);t.getUrlParameter("cid")!==n.getUrlParameter("cid")?this.navigate(e):r.loadingBubbleService.hideSpinner()}}}),define("controllers/routing/url_page",["require","exports","controllers/routing/abstract_page_controller"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.UrlPage=class extends i.AbstractPageController{constructor(e,t,i,n,s){super(e,t,i,n,s)}navigate(e){e.accept(),this.initialize(),e.complete()}refresh(e){e.accept(),e.complete()}initialize(){this.applyPageTitle()}}}),define("services/theme_service",["require","exports","event_bus","log","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","wrappers/page_state/page_state_wrapper","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","services/bubble_dialog"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});class h{constructor(){i.eventBus.subscribe(i.EVENT_TYPES.BLOCK_THEME,e=>{this.blockTheme(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.DELETE_THEME,e=>{this.deleteTheme(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_THEME,e=>{this.showTheme(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_ALL_THEMES,e=>{this.showAllThemes(e.value)})}getWidgetById(e){if(p.bubbleDialogService.getBubbles().length>0)for(const t of p.bubbleDialogService.getBubbles())if(void 0!==t.getPayload()&&t.getPayload().pageState instanceof l.PageStateWrapper)return t.getPayload().pageState.getApplication().getWidgetById(e),t.getPayload().pageState.getApplication().getWidgetById(e);return s.mainApplication.getWidgetById(e)}blockTheme({filters:e,widgetId:t,id:i,text:n,deleteLink:s}){let o;if(u.twCommon.isSmartTheme(e[0])){const e=i.split("\t");if(e.length>1){o={name:e[1]}}}void 0===o&&(o={name:n});const r={tag_cloud_panel_entries:[o]},a=s;g.restFormService.post(a,r,constants.events.form.action.add_one).then(()=>{const e=this.getWidgetById(t);e.prepareReload(),this.refreshWidgetData(e)})}showTheme({widgetId:e,id:t,text:i}){const n=this.getWidgetById(e),s=n.getExtendedConfiguration().getRemovedSmartThemes().findIndex(e=>e.label===i&&e.id===t)>-1;n.getExtendedConfiguration().showRemovedTheme({id:t,label:i},s),this.saveChanges(n).then(()=>{n.prepareReload(),this.refreshWidgetData(n)}).catch(()=>{n.getExtendedConfiguration().blockTheme({id:t,label:i},s)})}showAllThemes({widgetId:e}){const t=this.getWidgetById(e),i=[...t.getExtendedConfiguration().getRemovedNormalThemes()],n=[...t.getExtendedConfiguration().getRemovedSmartThemes()];t.getExtendedConfiguration().getRemovedNormalThemes().length=0,t.getExtendedConfiguration().getRemovedSmartThemes().length=0,this.saveChanges(t).then(()=>{t.prepareReload(),this.refreshWidgetData(t)}).catch(()=>{i.forEach(e=>t.getExtendedConfiguration().blockTheme({label:e,id:""})),n.forEach(e=>t.getExtendedConfiguration().blockTheme(e,!0))})}deleteTheme({widgetId:e,text:t,id:i,filters:n}){const s=this.getWidgetById(e),o=u.twCommon.isSmartTheme(n[0]);s.getExtendedConfiguration().blockTheme({label:t,id:i},o),this.saveChanges(s).then(()=>{s.prepareReload(),this.refreshWidgetData(s)}).catch(()=>{s.getExtendedConfiguration().showRemovedTheme({label:t,id:i},o)})}saveChanges(e){let t;if(c.tw.pageState.getAllowedPages().isReport())t=constants.custom_page.type.report;else if(c.tw.pageState.getAllowedPages().isDashboard())t=constants.custom_page.type.dashboard;else{if(!c.tw.pageState.getAllowedPages().isCommandCenterScreenEditMode())throw new Error("No custom page type defined");t=constants.custom_page.type.command_center_screen}const i={data_input_configuration:e.getDic(),dics:[e.getDic()],custom_page_id:window.tw.pageState.getAllowedPages().getCustomPageId(),custom_page_type:t},n=t===constants.custom_page.type.dashboard?i.custom_page_id:"";let s;switch(t){case constants.custom_page.type.report:s="custom_page_widget_reports";break;case constants.custom_page.type.dashboard:s="custom_page_widget_dashboards";break;case constants.custom_page.type.command_center_screen:s="command_center_screen_widgets";break;default:throw new Error("Invalid custom page type")}const o=routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,s,"update",n,"rform").url;return g.restFormService.post(o,i)}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:r.ModelRefreshStrategy.REFRESH},i=o.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),a.ModelType.WIDGET,t);try{return await d.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&n.logService.error("Error when refreshing widget!",void 0,e)}}else n.logService.error("reload attempted on widget without page state, this could be due to a memory leak",u.twCommon.logFeatures.WidgetWrapper)}}t.default=h,t.themesService=new h}),define("services/live_refresh_strategies",["require","exports","other/tw","services/fullscreen","services/application_mode"],function(e,t,i,n,s){var o;function r(){const e=i.tw.pageState.getAllowedPages();return e.isCommandCenterScreen()||e.isDashboard()}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PAGE=0]="PAGE",e[e.WIDGET=1]="WIDGET",e[e.AJAX_RELOAD=2]="AJAX_RELOAD"}(o=t.LiveRefreshTypes||(t.LiveRefreshTypes={})),t.liveRefreshStrategies={fullscreen:{condition:function(){return!window.embedded_mode&&r()&&n.fullscreenService.isFullscreenModeAllowed()&&(n.fullscreenService.isFullscreen()||window.live_view_mode_enabled)},refresh:{type:o.WIDGET,endpoint:"page_state_fullscreen"}},sharedCommandCenter:{condition:function(){return r()&&n.fullscreenService.isFullscreenModeAllowed()&&(n.fullscreenService.isFullscreen()||window.live_view_mode_enabled)},refresh:{type:o.WIDGET,endpoint:"public_cc"}},hootsuite:{condition:function(){return!1},refresh:{type:o.WIDGET}},embedded:{condition:function(){return window.live_view_mode_enabled&&s.applicationMode.getCurrentAppMode()===s.AppMode.EMBEDDED},refresh:{type:o.AJAX_RELOAD,urlParameters:["live-view=true","refresh=true"]}}}}),define("services/live_refresh",["require","exports","log","reusable_utilities","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","wrappers/page_state/page_state_wrapper","services/live_refresh_strategies","services/refresh/model_refresh_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});class p{constructor(){this.paused=!1}update(){this.paused||this.autoRefresh()}isPaused(){return this.paused}getAutoRefreshStrategy(){return Object.values(g.liveRefreshStrategies).find(e=>e.condition())}autoRefresh(){const e=this.getAutoRefreshStrategy();void 0!==e?(this.autoRefreshEnabled||(this.autoRefreshEnabled=!0,this.autoRefreshEnableTime=(new Date).getTime()),this.refresh(e)):this.autoRefreshEnabled=!1}refresh(e){switch(e.refresh.type){case g.LiveRefreshTypes.PAGE:this.pageRefresh(e);break;case g.LiveRefreshTypes.WIDGET:this.widgetsRefresh(e);break;case g.LiveRefreshTypes.AJAX_RELOAD:this.ajaxReloadRefresh(e);break;default:throw new Error("Unrecognized live refresh strategy")}}pageRefresh(e){void 0!==e.refresh.urlParameters&&(window.location.search=e.refresh.urlParameters.join("&")),window.location.reload()}ajaxReloadRefresh(e){if(l.tw.pageState.getWidgets().length>0&&l.tw.pageState.getWidgets()[0].checkAutoRefresh(this.autoRefreshEnableTime)){this.autoRefreshEnableTime=(new Date).getTime();const t=new n.Url(window.location.href);e.refresh.urlParameters&&t.setSearch(e.refresh.urlParameters.join("&")),$.getJSON(t.getHref(),e=>{s.mainApplication.injectPageState(new d.PageStateWrapper(e,s.mainApplication,!0)),l.tw.inject("$rootScope").$apply()})}}widgetsRefresh(e){const t=this.selectWidgetsToRefresh();if(t.length>0){t.forEach(e=>{e.setReloading(!0,e.determineAutoRefreshStrategy())});const i=l.tw.pageState.getCustomPageLastUpdateTs();this.refreshPageData(a.ModelRefreshStrategy.LOAD_MORE_CONTENT,"Error when loading more data for autorefreshing widgets",e.refresh.endpoint).then(this.handleWidgetsRefreshSuccess.bind(this,i),this.handleWidgetsRefreshFailure.bind(this))}}handleWidgetsRefreshSuccess(e,t){!this.paused&&l.tw.pageState.getCustomPageLastUpdateTs()>e&&this.refreshPageData(a.ModelRefreshStrategy.REFRESH,"Error when refreshing page state after autorefresh !")}handleWidgetsRefreshFailure(e){s.mainApplication.getPageState().getWidgets().forEach(t=>{555===e.status?(t.setErrorState(o.contextData.getMessage("_165485"),2),t.setReloading(!1),t.disableAutoRefresh()):t.isReloading()&&(t.setErrorState(o.contextData.getMessage("_165484"),1),t.setReloading(!1))})}selectWidgetsToRefresh(){return l.tw.pageState.getWidgets().filter(e=>e.checkAutoRefresh(this.autoRefreshEnableTime))}pause(){this.paused=!0}resume(){this.paused=!1}async refreshPageData(e,t,n){const o={strategy:e,endpoint:n},a=r.modelRefreshDecoratorFactory.getDecorator(s.mainApplication.getPageState(),s.mainApplication,c.ModelType.PAGE_STATE,o);try{return await u.modelRefreshService.refresh(a,o)}catch(e){e instanceof Error&&i.logService.error(t,void 0,e)}}}t.LiveRefreshService=p,t.liveRefreshService=new p}),define("services/text_editor_widget_refresh",["require","exports","other/tw","text_editor"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.callCount=0}update(){this.callCount++,i.tw.pageState&&this.callCount%20==0&&i.tw.pageState.getWidgets().filter(e=>{if(e.hasPayloadValue()&&e.isText()){const t=e.getPayloadValue();if(void 0!==t.text&&n.hasTimeCommands(t.text)||void 0!==t.headline&&n.hasTimeCommands(t.headline))return!0}return!1}).forEach(e=>e.redraw())}}t.TextEditorWidgetRefreshService=s,t.textEditorWidgetRefreshService=new s}),define("services/session",["require","exports","reusable_utilities","classes/application/application","services/context","services/fullscreen","services/live_refresh","services/loading_bubble","services/text_editor_widget_refresh","services/widgets/widget_initializer","services/theme_service"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=300,g=25;class u{constructor(){this.pageFullyLoaded=!1,t.sessionService=this}initialize(){s.contextService.updateFormatter(),s.contextService.setInitialContext(location.href),$(window).scroll(()=>{(new Date).getTime()-this.lastUpdateTs>d&&this.update()}),this.timeoutHandle=setTimeout(()=>this.update(),this.getPollDelay())}getPollDelay(){return window.imageExporter?g:d}update(){this.lastUpdateTs=(new Date).getTime(),clearInterval(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>this.update(),this.getPollDelay()),n.mainApplication.hasPageState()&&!n.mainApplication.isLoading()&&this.checkPageState()}checkPageState(){o.fullscreenService.update(),l.widgetInitializer.update(),r.liveRefreshService.update(),c.textEditorWidgetRefreshService.update()}setPageFullyLoaded(e){e&&a.loadingBubbleService.removeLoadingMessage(),this.pageFullyLoaded=e}async waitPageReady(e){return this.pageFullyLoaded?Promise.resolve():(await i.waitFor(100),await this.waitPageReady(e))}}__decorate([i.cancellable(Promise.resolve()),__metadata("design:type",Function),__metadata("design:paramtypes",[i.CancellationToken]),__metadata("design:returntype",Promise)],u.prototype,"waitPageReady",null),t.default=u}),define("controllers/main_controller",["require","exports","angular_utilities","notifications","react","react-dom","reusable_utilities","classes/application/application","entry_point/configurations/routing/page_definitions","services/context","services/fullscreen","services/loading_bubble","services/presentation_service","services/router","services/session","services/tw_routing","controllers/routing/abstract_page_controller","controllers/routing/r_form_page"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f){function y(e,t,i){return new v(e,t,i)}Object.defineProperty(t,"__esModule",{value:!0}),y.$inject=["$element","$compile","$scope"];class v{constructor(e,t,i){this.$compile=t,this.$scope=i,i.isFullscreen=(()=>d.fullscreenService.isFullscreen()),i.isLoggedIn=(()=>!l.contextService.isNoneContext());const r=$("#notifications")[0];r&&o.render(s.createElement(n.NotificationsTrayContainer,{notifications:n.notificationService.getNotifications()}),r),m.twRoutingService.onPageChangeEnd.subscribe((e,t,i,n,s)=>this.preparePage(e,t,i,n)),this.pageRoot=e.find("#pageRoot"),p.routerService.router.reload()}preparePage(e,t,i,n){if(e!==t||!l.contextService.areUrlSameContext(i.oldUrl,i.newUrl)){if(i.requestToken.isCanceled())return;n.noLoadingBubble||g.loadingBubbleService.showSpinner(),void 0!==this.element&&(this.element.scope()&&this.element.scope().$destroy(),o.unmountComponentAtNode(this.pageRoot[0]),this.pageRoot.empty());const t=m.twRoutingService.getActivePage().getId();this.buildPage(e,n,t,i.requestToken)}}async injectPage(e,t,i){this.isReactPage(t)?this.initializeReactPage(await c.pageDefinitions[t].config.reactComponentProvider(),e):await this.initializeAngularPage(t,e),m.twRoutingService.onPageBuilt.fire()}initializeReactPage(e,t){o.render(s.createElement(e,{model:t}),this.pageRoot[0])}isReactPage(e){return void 0!==c.pageDefinitions[e].config.reactComponentProvider}async initializeAngularPage(e,t){const{template:n}=await i.directiveService.inject(this.$compile,this.pageRoot,this.getDirectiveName(c.pageDefinitions[e].config,t),{directiveArguments:{"page-data":t},parentScope:this.$scope,directiveAsElement:!0});this.element=n}async buildPage(e,t,i,n){void 0!==e&&await h.sessionService.waitPageReady(n),this.removePageState(n),await this.injectPage(t.pageData,i,n),g.loadingBubbleService.hideSpinner(),u.presentationService.isPresentationEnabled&&u.presentationService.applyStyle()}removePageState(e){m.twRoutingService.getActivePage()instanceof f.RFormPage&&a.mainApplication.removePageState()}getDirectiveName(e,t){if(void 0!==e.directive)return e.directive;if(void 0!==e.directiveProvider)return e.directiveProvider(t);throw new Error("Could not get directive to be injected! Either directive or provider must be provided!")}}__decorate([r.cancellable(Promise.resolve()),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,String,r.CancellationToken]),__metadata("design:returntype",Promise)],v.prototype,"injectPage",null),__decorate([r.cancellable(),__metadata("design:type",Function),__metadata("design:paramtypes",[_.AbstractPageController,Object,String,r.CancellationToken]),__metadata("design:returntype",Promise)],v.prototype,"buildPage",null),__decorate([r.cancellable(),__metadata("design:type",Function),__metadata("design:paramtypes",[r.CancellationToken]),__metadata("design:returntype",void 0)],v.prototype,"removePageState",null),t.MainController=v,t.default=y}),define("components/page/safe_browsing/safe_browsing",["require","exports","react"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends i.Component{render(){return i.createElement("div",{className:"tw-centered-block-form"},i.createElement("form",{className:"form-horizontal error-splashscreen-form",role:"form"},i.createElement("div",{className:"form-group"},i.createElement("i",{className:"fa fa-exclamation-triangle"}),this.props.model.warning_message.map((e,t)=>i.createElement("p",{key:t},e)),i.createElement("a",{href:this.props.model.url},"Continue to ",this.props.model.url))))}}}),define("entry_point/configurations/routing/page_definitions",["require","exports","classes/context_data/context_data","components/page/modules/application_module_page","controllers/routing/external_page","controllers/routing/page_state_page","controllers/routing/r_form_page","controllers/routing/url_page"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.pageDefinitions={HOOTSUITE_DASHBOARD:{groupPage:constants.sub_pages.dashboard.page.group_page.toUpperCase(),type:o.PageStatePage,title:()=>constants.sub_pages.dashboard.page.page_title,config:{directive:"dashboard-controller-picker"}},SHARED_DASHBOARD:{groupPage:"SHARED_DASHBOARD",type:s.ExternalPage,config:{public:!0,directive:"dashboard-controller-picker"}},SHARED_COMMAND_CENTER:{groupPage:"SHARED_COMMAND_CENTER",type:s.ExternalPage,config:{public:!0,directive:""}},SANDBOX:{groupPage:"MONITOR",type:s.ExternalPage,title:()=>"Sandbox",config:{directive:"sandbox-page"}},SETTINGS:{groupPage:"SETTINGS",type:a.UrlPage,title:()=>"Settings",config:{directive:"settings-page"}},ALLUSER:{groupPage:"MONITOR",type:s.ExternalPage,title:()=>"All User",config:{directive:"dev-main-page"}},[constants.sub_pages.search.page.id]:{groupPage:constants.sub_pages.search.page.group_page.toUpperCase(),config:{directive:"free-search-page",parameters:constants.sub_pages.search.page.parameters},type:o.PageStatePage,title:()=>constants.sub_pages.search.page.page_title},[constants.sub_pages.application_module.page.id]:{groupPage:"MONITOR",config:{parameters:constants.sub_pages.application_module.page.parameters,directiveProvider:e=>n.ApplicationModulePage.determineDirective(e)},type:o.PageStatePage,title:()=>constants.sub_pages.application_module.page.page_title},[constants.sub_pages.quick_search.page.id]:{groupPage:constants.sub_pages.quick_search.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.quick_search.page.parameters,directive:"quick-search-page"},type:o.PageStatePage,title:()=>constants.sub_pages.quick_search.page.page_title},[constants.sub_pages.trend_discovery.page.id]:{groupPage:constants.sub_pages.trend_discovery.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.trend_discovery.page.parameters,directive:"discovery-page"},type:o.PageStatePage,title:()=>constants.sub_pages.trend_discovery.page.page_title},[constants.sub_pages.visual_search.page.id]:{groupPage:constants.sub_pages.visual_search.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.visual_search.page.parameters,directive:"discovery-page"},type:o.PageStatePage,title:()=>constants.sub_pages.visual_search.page.page_title},[constants.sub_pages.user_workflow.page.id]:{groupPage:constants.sub_pages.user_workflow.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.user_workflow.page.parameters,directive:"discovery-page"},type:o.PageStatePage,title:()=>constants.sub_pages.user_workflow.page.page_title},[constants.sub_pages.monitor.page.id]:{groupPage:constants.sub_pages.monitor.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.monitor.page.parameters,directive:"analytics-page"},type:o.PageStatePage,title:()=>constants.sub_pages.monitor.page.page_title},[constants.sub_pages.trigger_condition.page.id]:{groupPage:constants.sub_pages.trigger_condition.page.group_page.toUpperCase(),config:{parameters:constants.sub_pages.trigger_condition.page.parameters,directive:"analytics-page"},type:o.PageStatePage,title:()=>constants.sub_pages.trigger_condition.page.page_title},[constants.sub_pages.dashboard.page.id]:{groupPage:constants.sub_pages.dashboard.page.group_page.toUpperCase(),config:{directive:"dashboard-controller-picker",parameters:constants.sub_pages.dashboard.page.parameters},type:o.PageStatePage,title:()=>constants.sub_pages.dashboard.page.page_title},[constants.sub_pages.report.page.id]:{groupPage:constants.sub_pages.report.page.group_page.toUpperCase(),config:{directive:"report-page",parameters:constants.sub_pages.report.page.parameters},type:o.PageStatePage,title:()=>constants.sub_pages.report.page.page_title},[constants.sub_pages.topic_setup.page.id]:{groupPage:constants.sub_pages.topic_setup.page.group_page.toUpperCase(),type:o.PageStatePage,config:{directive:"topic-setup-page",parameters:constants.sub_pages.topic_setup.page.parameters},title:()=>constants.sub_pages.topic_setup.page.page_title},[constants.sub_pages.command_center_overview.page.id]:{groupPage:constants.sub_pages.command_center_overview.page.group_page.toUpperCase(),type:r.RFormPage,config:{form:constants.sub_pages.command_center_overview.page.form,directive:"r-form-page",parameters:constants.sub_pages.command_center_overview.page.parameters},title:()=>constants.sub_pages.command_center_overview.page.page_title},[constants.sub_pages.command_center.page.id]:{groupPage:constants.sub_pages.command_center.page.group_page.toUpperCase(),type:o.PageStatePage,config:{directive:"command-center-screen-page",parameters:constants.sub_pages.command_center.page.parameters},title:()=>constants.sub_pages.command_center.page.page_title},[constants.sub_pages.dashboard_screen.page.id]:{groupPage:constants.sub_pages.dashboard_screen.page.group_page.toUpperCase(),type:r.RFormPage,config:{directive:"r-form-page",form:constants.sub_pages.dashboard_screen.page.form,parameters:constants.sub_pages.dashboard_screen.page.parameters},title:()=>constants.sub_pages.dashboard_screen.page.page_title},[constants.sub_pages.iq_app_screen.page.id]:{groupPage:constants.sub_pages.iq_app_screen.page.group_page.toUpperCase(),config:{form:constants.sub_pages.iq_app_screen.page.form,parameters:constants.sub_pages.iq_app_screen.page.parameters,directive:"r-form-page"},type:r.RFormPage,title:()=>constants.sub_pages.iq_app_screen.page.page_title},[constants.sub_pages.iq_app.page.id]:{groupPage:constants.sub_pages.iq_app.page.group_page.toUpperCase(),config:{directive:"dashboard-template-page",parameters:constants.sub_pages.iq_app.page.parameters},type:o.PageStatePage,title:()=>constants.sub_pages.iq_app.page.page_title},[constants.sub_pages.edit.page.id]:{groupPage:constants.sub_pages.edit.page.group_page.toUpperCase(),config:{directive:"analytics-page",parameters:constants.sub_pages.edit.page.parameters},type:o.PageStatePage,title:()=>constants.sub_pages.edit.page.page_title},[constants.sub_pages.home_screen.page.id]:{groupPage:constants.sub_pages.home_screen.page.group_page.toUpperCase(),config:{directive:"r-form-page",form:constants.sub_pages.home_screen.page.form,parameters:constants.sub_pages.home_screen.page.parameters},type:r.RFormPage,title:()=>constants.sub_pages.home_screen.page.page_title},[constants.sub_pages.discovery_screen.page.id]:{groupPage:constants.sub_pages.discovery_screen.page.group_page.toUpperCase(),config:{directive:"r-form-page",form:constants.sub_pages.discovery_screen.page.form,parameters:constants.sub_pages.discovery_screen.page.parameters},type:r.RFormPage,title:()=>constants.sub_pages.discovery_screen.page.page_title},[constants.sub_pages.embedded_widget.page.id]:{groupPage:"EMBEDDED_WIDGET",config:{parameters:constants.sub_pages.embedded_widget.page.parameters,directive:"analytics-page"},type:o.PageStatePage,title:()=>constants.sub_pages.embedded_widget.page.page_title},EXPORT:{groupPage:"EXPORT",type:s.ExternalPage,config:{directive:"export-page"}},AUTHENTICATION:{groupPage:"NONE",type:s.ExternalPage,config:{directive:""}},TEST:{groupPage:"TESTS",type:s.ExternalPage,config:{directive:""}},SAFEBROWSING:{groupPage:"PUBLIC",type:r.RFormPage,title:()=>i.contextData.projectSettings.branding.product_name,config:{form:"safe_browsing",dataQuery:()=>window.formEntry,reactComponentProvider:async()=>(await new Promise((t,i)=>{e(["components/page/safe_browsing/safe_browsing"],t,i)})).default}},LOGIN:{groupPage:"PUBLIC",type:r.RFormPage,title:()=>i.contextData.projectSettings.branding.product_name+" - "+constants.sub_pages.login.page.page_title,config:{public:!0,context:"none",form:"login",directive:"login-page"}},PUBLIC:{groupPage:"PUBLIC",type:s.ExternalPage,title:()=>i.contextData.projectSettings.branding.product_name+" - "+constants.sub_pages.login.page.page_title,config:{public:!0,context:"none",directive:""}}}}),define("services/router",["require","exports","router","classes/context_data/context_data","services/application_mode","event_bus"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.router=new i.Router,o.eventBus.subscribe(o.EVENT_TYPES.ON_CONTEXT_SWITCH,()=>this.replaceBackgroundImage())}replaceBackgroundImage(){const e=n.contextData.projectSettings.branding.background_image,i=n.contextData.projectSettings.branding.background_image_login_screen;window.isExport&&s.applicationMode.getCurrentAppMode()!==s.AppMode.SHARED_DASHBOARD?document.body.style.backgroundImage="":"LOGIN"===t.routerService.router.getCurrentPage().getId()&&void 0!==i&&i.length>0?document.body.style.backgroundImage="url('"+i+"')":void 0!==e&&e.length>0?document.body.style.backgroundImage="url('"+e+"')":document.body.style.backgroundImage=""}initialize(e,t){e.forEach(e=>{Object.keys(e.routes).forEach(i=>{const n=e.routes[i],s=t[i];if(void 0===s)throw new Error(`Error in routing table: page ${i} is not defined add a definition to page definitions or revise your routing table`);this.router.addPage(new s.type(s.groupPage,n.patterns,i,s.title,s.config))})})}}t.RouterService=r,t.routerService=new r}),define("services/context",["require","exports","log","router","reusable_utilities","underscore","services/tw_number_formatter","classes/context_data/context_data","event_bus"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=["none","user","project","account"];class d{constructor(){this.currentContext={scope:"none",id:"0"}}setInitialContext(e){this.checkAndSetContext(new n.RoutingRequest(e,e),!0)}checkAndSetContext(e,t){const i=[this.currentContext.scope,this.currentContext.id].join(","),n=this.parseUrl(e.newUrl);switch(window.tw.context=n.co,window.tw.account_id="0",window.tw.project_id="0",!n.co&&window.contextInUrl&&(n.co=window.location.pathname.split("/")[2],n.cid=window.location.pathname.split("/")[3]),n.co){case"project":window.tw.project_id=n.cid;break;case"account":window.tw.account_id=n.cid}const s=i!==[n.co,n.cid].join(",");return({co:this.currentContext.scope,cid:this.currentContext.id}=n),(s||t)&&this.reloadStaticFiles(e),s}areUrlSameContext(e,t){const i=this.parseUrl(e),n=this.parseUrl(t);return i.co===n.co&&i.cid===n.cid}changeOldUrl(e){let t="";const i=e.split("/");return""===i[0]&&(i[0]="url="),t=i.length>3&&-1!==l.indexOf(i[2])?i[0]+e+"&co="+i[2]+"&cid="+i[3]:e}reloadConstantFile(){return this.reloadConstantFileLogic()}async reloadContextData(e){const{scope:t,id:i}=this.getCurrentContext();await this.reloadContextDataByContext(t,i,e),this.loadFavicon(),this.updateFormatter()}async updateModuleData(){this.resetCanvasEngineBrandingColor(),this.relayConstants(),this.updateModuleConstants()}updateModuleConstants(){s.StringUtils.updateStringUtilConstants()}relayConstants(){this.relayNumberSuffixes(),this.relayNumberFormatingPrecision()}relayNumberSuffixes(){const e={kilo:constants.number_prefixes.kilo,mega:constants.number_prefixes.mega,giga:constants.number_prefixes.giga,tera:constants.number_prefixes.tera,peta:constants.number_prefixes.peta,exa:constants.number_prefixes.exa};this.relayObjectEntries(e,s.RelayedConstants.number_prefixes)}relayObjectEntries(e,t){Object.keys(e).forEach(i=>t[i]=e[i])}relayNumberFormatingPrecision(){s.RelayedConstants.project.settings.useHighPrecisionFormatting=constants.project.settings.useHighPrecisionFormatting}loadFavicon(){const e=document.getElementById("favicon");e&&(e.href=a.contextData.projectSettings.branding.favicon_path)}reloadConstantFileLogic(){const{scope:e,id:t}=this.getCurrentContext();return new Promise(n=>{$.getScript(`/app/${e}/${t}/assets/constants.js`).done((e,t)=>{const i=document.createElement("script");i.innerHTML=e,document.body.appendChild(i),this.updateFormatter(),n()}).fail((e,t,s)=>{i.logService.error("Exception while loading the constants file"),n()})})}updateFormatter(){r.twNumberFormatter.initialize(a.contextData.getNumberFormatterConfig(),{highPrecision:constants.project.settings.useHighPrecisionFormatting})}resetCanvasEngineBrandingColor(){s.Color.addCustomColor("BRANDING_COLOR",a.contextData.projectSettings.branding.color)}reloadStaticFiles(e){const t=[],i=[(async()=>{await this.reloadContextData(e.requestToken),await this.reloadConstantFile(),c.eventBus.dispatch({type:c.EVENT_TYPES.ON_CONTEXT_SWITCH,value:{promiseList:t,context:this.currentContext}})})(),this.updateModuleData()];e.waitFor(...i,new Promise(async e=>{await Promise.all(i),await Promise.all(t),e()}))}isNoneContext(){const e=this.parseUrl(location.href).co;return!l.includes(e)||"none"===e}getCurrentContext(){return this.currentContext}parseUrl(e){e.includes("?")&&(e=e.substring(0,e.indexOf("?")));const t=decodeURIComponent(e),i=o.object(t.substring(t.lastIndexOf("#")+1).split("&").map(e=>e.split("="))),n=Object.keys(i);if(1===n.length&&"http"===n[0].substring(0,4)&&(i.co=new s.Url(e).getPath().split("/")[2],i.cid=new s.Url(e).getPath().split("/")[3],void 0!==i.cid&&l.includes(i.co)||(i.co="none",i.cid="none")),i.url){const e=i.url.split("/");i.co=e[2],i.cid=e[3]}return i}reloadContextDataByContext(e,t,i){return new Promise(n=>{$.ajax({url:window.bootPayload.baseUrlWithVersion+`/${e}/${t}/rform/context_data/show`,headers:{"content-type":"application/json"}}).then(e=>{i.isCanceled()||(a.contextData.resetData(e),n())})})}}__decorate([s.cancellable(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String,s.CancellationToken]),__metadata("design:returntype",Promise)],d.prototype,"reloadContextDataByContext",null),t.default=d,t.contextService=new d}),define("services/rest_form_service",["require","exports","angular","underscore","log","notifications","other/tw","services/broker","services/tw_common","services/context","services/router","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});class u{constructor(e,t){this.$http=e,this.$q=t}displayErrorNotification(e,t){if(!n.isEmpty(e))if(o.notificationService.display(e.notification),401===t){const e=d.routerService.router.getCurrentPage();void 0!==e&&e.isPublic()||setTimeout(()=>{window.location.href=window.bootPayload.defaultUrl},5e3)}else 413===t&&o.notificationService.display([{message:g.contextData.getMessage("_1546461"),type:"ERROR",permanent:!0}])}redirectIfMaintenance(e){return!(!e||!e.maintenance)&&(window.location.href=e.url,!0)}get(e,t){e=this.setCanaryVersion(e);const i=s.logService.getStackTrace();t=t||constants.events.form.action.get,a.brokerService.publish(constants.events.form.action.get,[constants.events.form.status.doing,t]);const n=this.$q.defer();return this.$http.get(e).then(({data:r,status:l})=>{s.logService.debug([`HTTP GET ${l} ${e}`,i],c.twCommon.logFeatures.Restful,r),this.redirectIfMaintenance(r)||(a.brokerService.publish(constants.events.form.action.get,[constants.events.form.status.done,t]),o.notificationService.display(r.notification),n.resolve(r))},({data:o,status:r})=>{s.logService.debug([`HTTP GET ${r} ${e}`,i],c.twCommon.logFeatures.Restful,o),this.redirectIfMaintenance(o)||(a.brokerService.publish(constants.events.form.action.get,[constants.events.form.status.error,t]),this.displayErrorNotification(o,r),n.reject(o))}),n.promise}setCanaryVersion(e){return!e.startsWith(window.bootPayload.baseUrlWithVersion)&&e.startsWith(window.bootPayload.baseUrl)&&(e=e.replace(window.bootPayload.baseUrl,window.bootPayload.baseUrlWithVersion)),e}getRForm(e,t,...i){return this.get(this.getRFormUrl(e,t)+(i.length?"/"+encodeURIComponent(i.join("/")):""))}postRForm(e,t,i,n){return this.post(this.getRFormUrl(e,t,n),i)}deleterRForm(e,t,i,n){return this.deleter(this.getRFormUrl(e,t,n),i)}getRFormUrl(e,t,i=""){return routes.controllers.tw.TWRestForm.get(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,e,t,i,"rform").url}post(e,t,i){e=this.setCanaryVersion(e);const r=s.logService.getStackTrace(),l=t;i=i||constants.events.form.action.post,t=n.isUndefined(t)?{}:t,a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.doing,i]);const d=this.$q.defer();return delete t.field_messages,this.$http.post(e,t).then(({data:t,status:n})=>{s.logService.debug([`HTTP POST  ${n} ${e}`,r],c.twCommon.logFeatures.Restful,{post:l,response:t}),this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.done,i]),o.notificationService.display(t.notification),d.resolve(t))},({data:t,status:n})=>{s.logService.debug(["HTTP POST "+n+" "+e,r],c.twCommon.logFeatures.Restful,{post:l,response:t}),(t=t||{}).status=n,this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.error,i]),this.displayErrorNotification(t,n),d.reject(t))}),d.promise}postMultipartRForm(e,t,i){return this.postMultipart(this.getRFormUrl(e,t),i)}postMultipart(e,t,r,l){e=this.setCanaryVersion(e);const d=s.logService.getStackTrace(),g=t;l=n.isUndefined(l)?constants.events.form.action.post:l,t=n.isUndefined(t)?{}:t,a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.doing,l]);const u={},p={};for(const e in t)t[e]instanceof FileList?p[e]=t[e]:this.isCacheInfoObject(t[e])?u[e]=Object.assign({},t[e],{object:void 0}):u[e]=t[e];delete u.field_messages;const h=this.$q.defer(),m={headers:{"Content-Type":void 0},method:constants.events.form.action.post,transformRequest:()=>{const e=new FormData;return e.append("data",i.toJson(u)),n(p).each((t,i)=>{e.append(i.toString(),t[0])}),r instanceof FileList&&n(r).each(t=>{e.append("file[]",t.toString())}),e},url:e};return this.$http(m).then(({data:t,status:i})=>{s.logService.debug([`HTTP POST Multipart  ${i} ${e}`,d],c.twCommon.logFeatures.Restful,{post:g,response:t}),this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.done,l]),o.notificationService.display(t.notification),h.resolve(t))},({data:t,status:i})=>{s.logService.debug([`HTTP POST Multipart ${i} ${e}`,d],c.twCommon.logFeatures.Restful,{post:g,response:t}),this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.post,[constants.events.form.status.error,l]),this.displayErrorNotification(t,i),h.reject(n.extend(t,p)))}),h.promise}put(e,t=constants.events.form.action.put){e=this.setCanaryVersion(e);const i=s.logService.getStackTrace();a.brokerService.publish(constants.events.form.action.put,[constants.events.form.status.doing,t]);const n=this.$q.defer();return this.$http.put(e,{}).then(({data:r,status:l})=>{s.logService.debug([`PUT ${l} ${e}`,i],c.twCommon.logFeatures.Restful,{response:r}),this.redirectIfMaintenance(r)||(a.brokerService.publish(constants.events.form.action.put,[constants.events.form.status.done,t]),o.notificationService.display(r.notification),n.resolve(r))},({data:o,status:r})=>{s.logService.debug([`PUT ${r} ${e}`,i],c.twCommon.logFeatures.Restful,{response:o}),this.redirectIfMaintenance(o)||(a.brokerService.publish(constants.events.form.action.put,[constants.events.form.status.error,t]),this.displayErrorNotification(o,r),n.reject(o))}),n.promise}deleter(e,t){e=this.setCanaryVersion(e);const i=s.logService.getStackTrace(),n=constants.events.form.action.deleter;return a.brokerService.publish(constants.events.form.action.deleter,[constants.events.form.status.doing,n]),this.$q((r,l)=>{this.$http({method:"DELETE",url:e,data:t}).then(({data:t,status:l})=>{s.logService.debug([`DELETE ${l} ${e}`,i],c.twCommon.logFeatures.Restful,{response:t}),this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.deleter,[constants.events.form.status.done,n]),o.notificationService.display(t.notification),r(t))},({data:t,status:o})=>{s.logService.debug([`DELETE ${o} ${e}`,i],c.twCommon.logFeatures.Restful,{response:t}),this.redirectIfMaintenance(t)||(a.brokerService.publish(constants.events.form.action.deleter,[constants.events.form.status.error,n]),this.displayErrorNotification(t,o),l(t))})})}isCacheInfoObject(e){return void 0!==e&&void 0!==e.mime_type&&void 0!==e.object}}u.$inject=["$http","$q"],t.default=u,Object.defineProperty(t,"restFormService",{get:function(){return r.tw.inject("restFormService")}})}),define("classes/custom_pages/pages/dashboard_page",["require","exports","log","reusable_utilities","services/rest_form_service","services/router","classes/custom_pages/custom_page"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a extends r.CustomPage{constructor(){super(...arguments),this.type=constants.custom_page.type.dashboard}async create(){const e=await r.CustomPage.new(this.type,this.getContainerField(),this.container);return new a(e[this.getContainerField()],e)}async update(e){return i.logService.assertDefined(e.mapped_id),super.update(e)}async override(e){return i.logService.assertDefined(e.mapped_id),i.logService.assertDefined(e.page_state),super.override(e)}saveWidgets(e,t){return s.restFormService.postRForm("custom_page_widgets","save",{type:this.type,dashboard_widget_container:{custom_page_id:e,dics:t}})}createSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.postRForm("custom_pages_grid","create",{type:this.type,dashboard_container:e})}updateSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.postRForm("custom_pages_grid","update",{type:this.type,dashboard_container:e})}removeSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.deleterRForm("custom_pages_grid","remove",{type:this.type,dashboard_container:e})}moveSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.postRForm("custom_pages_grid","move",{type:this.type,dashboard_container:e})}copyWidgetToSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.postRForm("custom_pages_grid","copy",{type:this.type,dashboard_container:e})}changeWidgetSlide(e){return i.logService.assertDefined(e.mapped_id),s.restFormService.postRForm("custom_pages_grid","merge",{type:this.type,dashboard_container:e})}async clone(e){const t=this.buildRequest(e);i.logService.assertDefined(t.type),i.logService.assertDefined(e.mapped_id),i.logService.assertDefined(e.title),i.logService.assertDefined(e.page_state);const n=await s.restFormService.postRForm("custom_pages","copy",t);return new a(n.dashboard_container,n)}async remove(){return super.remove()}convertToGrid(e){return s.restFormService.postRForm("custom_pages","refresh",{type:this.type,dashboard_container:e})}refreshPage(){const e=new n.Url(window.location.href);e.removeUrlParameter("i"),e.setUrlParameter("ts",(new Date).valueOf().toString()),o.routerService.router.navigateTo(e.getHref())}getContainerField(){return"dashboard_container"}getWidgetContainerField(){return"dashboard_widget_container"}}t.DashboardPage=a}),define("classes/custom_pages/pages/command_center_page",["require","exports","classes/custom_pages/custom_page","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.CustomPage{constructor(){super(...arguments),this.type=constants.custom_page.type.command_center_screen}async create(){const e=await i.CustomPage.new(this.type,this.getContainerField(),this.container);return new s(e[this.getContainerField()],e)}async clone(e){return new s(e)}getContainerField(){return"command_center_container"}getWidgetContainerField(){return"command_center_widget_container"}async overrideWidget(e,t,s){const o={custom_page_id:this.getId(),page_state:i.CustomPage.cloneAndEnhancePageState(t,[i.CustomPage.cloneAndEnhanceWidget(e)],t.getUserFilterSettings())},r=this.buildWidgetRequest(o);await n.restFormService.postRForm("custom_page_widgets","override",r)}}t.CommandCenterPage=s}),define("classes/custom_pages/custom_page_factory",["require","exports","classes/custom_pages/pages/dashboard_page","classes/custom_pages/pages/report_page","classes/custom_pages/pages/command_center_page"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{static getPageByType(e,t){switch(e){case constants.custom_page.type.dashboard:return o.getPage(i.DashboardPage,t);case constants.custom_page.type.report:return o.getPage(n.ReportPage,t);case constants.custom_page.type.command_center_screen:return o.getPage(s.CommandCenterPage,t);default:throw new Error(`Invalid custom page type: ${e}`)}}static getPageFromPageState(e){const t=e.getAllowedPages(),r={mapped_id:t.getCustomPageId()};if(t.isDashboard())return o.getPage(i.DashboardPage,r);if(t.isReport())return o.getPage(n.ReportPage,r);if(t.isCommandCenterScreenEditMode())return o.getPage(s.CommandCenterPage,r);throw new Error("Unknown custom page type")}static getPage(e,t){return new e(t)}static async createPage(e,t){switch(e){case constants.custom_page.type.dashboard:return new i.DashboardPage(t).create();case constants.custom_page.type.report:return new n.ReportPage(t).create();case constants.custom_page.type.command_center_screen:return new s.CommandCenterPage(t).create();default:throw new Error(`Invalid custom page type: ${e}`)}}}t.CustomPageFactory=o}),define("services/widgets/widget_section_service",["require","exports","map","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.sectionMap=new i.Map,this.widgetSectionMap=new i.Map,this.widgetAttributes=new i.Map}static getInstance(){return s.instance||(s.instance=new s),s.instance}getSectionHeightRange(e){if(this.hasWidget(e)){const t=this.widgetSectionMap.get(e).widgets.map(e=>e.getHeightRange());return t.find(e=>-1===e[0]||-1===e[1])?e.getHeightRange():t.reduce((e,t)=>(e[1]=Math.min(e[1],t[1]),e[0]=Math.min(e[1],Math.max(e[0],t[0])),e),[0,Number.MAX_VALUE])}return[e.getHeight(),e.getHeight()]}hasWidget(e){return this.widgetSectionMap.has(e)}addWidget(e,t){this.sectionMap.has(e)||this.sectionMap.set(e,{id:e,widgets:[],mediator:new n.WidgetMediator});const i=this.sectionMap.get(e);i.widgets.push(t),this.widgetSectionMap.set(t,i)}removeWidget(e){if(this.widgetSectionMap.has(e)){const t=this.widgetSectionMap.get(e),i=t.widgets.indexOf(e);t.widgets.splice(i,1),this.widgetSectionMap.delete(e),this.widgetAttributes.delete(e),0===t.widgets.length&&this.sectionMap.delete(t.id)}}setWidgetAttribute(e,t,n){this.widgetAttributes.has(e)||this.widgetAttributes.set(e,new i.Map),this.widgetAttributes.get(e).set(t,n),this.widgetSectionMap.get(e).mediator.dispatch(s.WIDGET_ATTRIBUTE_UPDATED_EVENT,{widget:e,attribute:t,value:n})}getWidgetAttributesForSection(e,t){const i=[];return this.sectionMap.get(e).widgets.forEach(e=>{this.widgetAttributes.has(e)&&this.widgetAttributes.get(e).has(t)&&i.push(this.widgetAttributes.get(e).get(t))}),i}getSectionIdOfWidget(e){return this.widgetSectionMap.get(e).id}getSectionMediator(e){return this.sectionMap.get(e).mediator}}s.WIDGET_ATTRIBUTE_UPDATED_EVENT="WIDGET_ATTRIBUTE_UPDATED",t.WidgetSectionService=s}),define("services/widgets/widget_size_calculator",["require","exports","log","math_utils","widget_base","services/application_mode","services/presentation_service","services/tw_common","reusable_utilities","constants/page_size_constants","classes/page_mode","services/widgets/widget_section_service","services/pages/page_size_calculator","classes/widget/types/widget_type"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});const h=380,m=.76,_=.9,f=20,y=80,v=250,S=165,b=30;class w{constructor(){this.LOG_PREFIX_BUILDER=(e=>`[WidgetSizeCalculatorService.${e}]`)}getWidthMode(e){switch(u.pageSizeCalculatorService.getPageMode(e.getPageState())){case d.PageMode.EXPANDED_WIDGET:case d.PageMode.EMBEDDED_PAGE:return s.WidgetWidthMode.FULLSCREEN;default:return s.WidgetWidthMode.FIXED}}getHeightMode(e){return!e.getPageState().getApplication().getWidgetSettings().displayFullSizeWidget||e.isArticles()||e.isTable()||e.isInfluencerTable()||e.isProgressGraph()?this.canWidgetResizeToGrid(e)?s.WidgetHeightMode.FIXED:-1===e.getHeight()?s.WidgetHeightMode.LEGACY:r.presentationService.isPresentationEnabled?s.WidgetHeightMode.FIXED:s.WidgetHeightMode.LEGACY:s.WidgetHeightMode.FULLSCREEN}getIdealSize(e){return{width:this.getWidth(e),height:this.getHeight(e)}}getGridCellSize(e){return u.pageSizeCalculatorService.getGridCellSize(e,this.getCurrentGrid(e))}getWidth(e){if(i.logService.verbose(`${this.LOG_PREFIX_BUILDER("getWidth")} for ${e.constructor.name}`,a.twCommon.logFeatures.WidgetSizeCalculator,{widget:e}),r.presentationService.isPresentationEnabled)return this.getFullscreenWidth(e);let t=0;const s=u.pageSizeCalculatorService.getPageMode(e.getPageState());if(e.getPageState().getApplication().getWidgetSettings().displayFullSizeWidget)t=this.getExpandedWidth(e),i.logService.verbose(`${this.LOG_PREFIX_BUILDER("getWidth")} displaying ${e.constructor.name} expanded (width: ${t})`,a.twCommon.logFeatures.WidgetSizeCalculator,{widget:e});else{switch(s){case d.PageMode.GRID_DASHBOARD:case d.PageMode.NO_SIDEBAR_PAGE:case d.PageMode.SHARED_DASHBOARD:t=this.canWidgetResizeToGrid(e)?this.getNoSidebarGridPageWidth(e):o.applicationMode.isMobile()?l.PAGE_WITHOUT_SIDEBAR_WIDTH:n.generalMathUtils.lerp(0,l.PAGE_WITHOUT_SIDEBAR_WIDTH,e.getWidth()/12);break;case d.PageMode.IMAGE_EXPORT_PAGE:t=this.getImageExportWidth(e);break;case d.PageMode.SIDEBAR_PAGE:t=this.getSidebarPageWidth(e);break;case d.PageMode.REPORT_PAGE:t=this.getReportPageWidth(e);break;case d.PageMode.DIALOG:t=n.generalMathUtils.lerp(0,l.DIALOG_PAGE_WIDTH,e.getWidth()/12);break;case d.PageMode.MOBILE:t=this.getFullscreenWidth(e);break;case d.PageMode.EMBEDDED_PAGE:t=window.innerWidth;break;case d.PageMode.COMMAND_CENTER:t=n.generalMathUtils.lerp(0,window.innerWidth,e.getSlotConfiguration().width/e.getPageState().getScreenConfiguration().grid_width);break;case d.PageMode.EXPORT_PREVIEW_PAGE:t=n.generalMathUtils.lerp(0,l.EXPORT_PREVIEW_PAGE_WIDTH,e.getSlotConfiguration().width/e.getPageState().getPageConfiguration().grid.width);break;default:t=0}i.logService.verbose(`${this.LOG_PREFIX_BUILDER("getWidth")} displaying ${e.constructor.name} in specific size for pageMode (width: ${t})`,a.twCommon.logFeatures.WidgetSizeCalculator,{pageMode:s})}return t}getImageExportWidth(e){i.logService.verbose(`${this.LOG_PREFIX_BUILDER("getImageExportWidth")} for ${e.constructor.name}`,a.twCommon.logFeatures.WidgetSizeCalculator,{widget:e,isGridPage:e.getPageState().isGridPage(),isReport:e.getPageState().getAllowedPages().isReport()});let t=0;return t=e.getPageState().isGridPage()?e.getPageState().getAllowedPages().isReport()?this.getReportPageWidth(e):this.getNoSidebarGridPageWidth(e):e.getType()===p.WidgetType.DOCUMENT_CLUSTER?l.PAGE_WITHOUT_SIDEBAR_WIDTH:this.getSidebarPageWidth(e),i.logService.verbose(`${this.LOG_PREFIX_BUILDER("getImageExportWidth")} for ${e.constructor.name}, width: ${t}`,a.twCommon.logFeatures.WidgetSizeCalculator),t}getImageExportHeight(e){return e.getPageState().getAllowedPages().isReport()?this.getReportGridPageHeight(e):this.getNoSidebarGridPageHeight(e)}getHeight(e){const t=u.pageSizeCalculatorService.getPageMode(e.getPageState());if(t===d.PageMode.IMAGE_EXPORT_PAGE&&e.getPageState().isGridPage())return this.getImageExportHeight(e);if(r.presentationService.isPresentationEnabled)return this.getFullscreenHeight(e);if(e.getPageState().getApplication().getWidgetSettings().displayFullSizeWidget)return this.getExpandedHeight(e);if(t===d.PageMode.EXPORT_PREVIEW_PAGE)return n.generalMathUtils.lerp(0,l.EXPORT_PREVIEW_PAGE_WIDTH/this.getCurrentGrid(e.getPageState()).aspect_ratio,e.getSlotConfiguration().height/this.getCurrentGrid(e.getPageState()).height);if(u.pageSizeCalculatorService.getPageMode(e.getPageState())===d.PageMode.REPORT_PAGE&&this.canWidgetResizeToGrid(e))return this.getReportGridPageHeight(e);if(t===d.PageMode.GRID_DASHBOARD&&this.canWidgetResizeToGrid(e))return this.getNoSidebarGridPageHeight(e);if(t===d.PageMode.NO_SIDEBAR_PAGE&&this.canWidgetResizeToGrid(e))return this.getNoSidebarGridPageHeight(e);{let t,i;if(e.hasPageState()&&e.getPageState().hasAllowedPages()&&e.getPageState().getAllowedPages().isCustomPage()){const t=e.getPreferredHeight(),n=g.WidgetSectionService.getInstance().getSectionHeightRange(e);i=Math.min(n[1],t)}else i=e.getHeight();switch(i){case-1:t=0;break;case 0:t=b+y;break;case.5:t=S+y;break;default:t=i*v+y}return this.getHeightMode(e)===s.WidgetHeightMode.FLEXIBLE?Math.max(t,e.getSection().getHeightInPixel()):t}}getExpandedWidth(e){return window.innerWidth*_}getExpandedHeight(e){return e.isGender()?h:window.innerHeight*m}getGridPageDimensions(e){return u.pageSizeCalculatorService.getGridPageDimensions(this.getCurrentGrid(e.getPageState()))}getFullscreenHeight(e){if(e.getPageState().isGridPage())return n.generalMathUtils.lerp(0,this.getGridPageDimensions(e).y,e.getSlotConfiguration().height/this.getCurrentGrid(e.getPageState()).height);switch(u.pageSizeCalculatorService.getPageMode(e.getPageState())){case d.PageMode.COMMAND_CENTER:return n.generalMathUtils.lerp(0,window.innerHeight,e.getSlotConfiguration().height/e.getPageState().getScreenConfiguration().grid_height);case d.PageMode.SHARED_DASHBOARD:case d.PageMode.NO_SIDEBAR_PAGE:switch(e.getHeight()){case-1:return 0;case 0:return window.innerHeight/6-f;default:return window.innerHeight*e.getHeight()/3-f}default:throw new Error("no logic defined for full screen in this page mode")}}getFullscreenWidth(e){if(e.getPageState().isGridPage())return n.generalMathUtils.lerp(0,this.getGridPageDimensions(e).x,e.getSlotConfiguration().width/this.getCurrentGrid(e.getPageState()).width);switch(u.pageSizeCalculatorService.getPageMode(e.getPageState())){case d.PageMode.COMMAND_CENTER:return n.generalMathUtils.lerp(0,window.innerWidth,e.getSlotConfiguration().width/e.getPageState().getScreenConfiguration().grid_width);case d.PageMode.MOBILE:return window.innerWidth;case d.PageMode.SHARED_DASHBOARD:case d.PageMode.NO_SIDEBAR_PAGE:return n.generalMathUtils.lerp(0,window.innerWidth,e.getWidth()/12);default:throw new Error("no logic defined for full screen in this page mode")}}getReportPageWidth(e){return this.canWidgetResizeToGrid(e)?n.generalMathUtils.lerp(0,l.PAGE_WITH_SIDEBAR_WIDTH,e.getSlotConfiguration().width/this.getCurrentGrid(e.getPageState()).width):o.applicationMode.isMobile()?l.PAGE_WITH_SIDEBAR_WIDTH:n.generalMathUtils.lerp(0,l.REPORT_PAGE_WIDTH,e.getWidth()/12)}getReportGridPageHeight(e){return n.generalMathUtils.lerp(0,l.PAGE_WITH_SIDEBAR_WIDTH/this.getCurrentGrid(e.getPageState()).aspect_ratio,e.getSlotConfiguration().height/this.getCurrentGrid(e.getPageState()).height)}getSidebarPageWidth(e){return o.applicationMode.isMobile()?l.PAGE_WITH_SIDEBAR_WIDTH:n.generalMathUtils.lerp(0,l.PAGE_WITH_SIDEBAR_WIDTH,e.getWidth()/12)}canWidgetResizeToGrid(e){return e.hasSlotConfiguration()&&e.getPageState().isGridPage()&&(!e.getPageState().getAllowedPages().isReport()||e.getPageState().getAllowedPages().getPageType()===constants.page_type.report_layout||o.applicationMode.getCurrentAppMode()===o.AppMode.IMAGE_EXPORT)}getFullPageWidth(e){return r.presentationService.isPresentationEnabled?this.getGridPageDimensions(e).x:e.getPageState().isWholePageExport()?u.pageSizeCalculatorService.getPageMode(e.getPageState())===d.PageMode.GRID_DASHBOARD?l.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH:l.EXPORT_PREVIEW_PAGE_WIDTH:e.getPageState().isGridPage()&&e.getPageState().getAllowedPages().isReport()?l.PAGE_WITH_SIDEBAR_WIDTH:e.getPageState().getAllowedPages().isDashboard()?l.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH:e.getPageState().isGridPage()?l.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH:l.PAGE_WITHOUT_SIDEBAR_WIDTH}getNoSidebarGridPageWidth(e){const t=this.getFullPageWidth(e);return n.generalMathUtils.lerp(0,t,e.getSlotConfiguration().width/this.getCurrentGrid(e.getPageState()).width)}getNoSidebarGridPageHeight(e){return u.pageSizeCalculatorService.getPageMode(e.getPageState())===d.PageMode.GRID_DASHBOARD?this.getGridCellSize(e.getPageState()).height*e.getSlotConfiguration().height:n.generalMathUtils.lerp(0,l.PAGE_WITHOUT_SIDEBAR_WIDTH*(9/16),e.getSlotConfiguration().height/this.getCurrentGrid(e.getPageState()).height)}getCurrentGrid(e){const t=c.PageConfigurationUtils.getCurrentPage(e.getPageConfiguration());return void 0!==t&&void 0!==t.grid?t.grid:e.getPageConfiguration().grid}}t.WidgetSizeCalculatorService=w,t.widgetSizeCalculatorService=new w}),define("wrappers/legend_configuration/legend_configuration_wrapper",["require","exports","canvas_chart_utilities","wrappers/topic_menu/topic_menu_wrapper","wrappers/abstract_wrapper"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.LegendConfigurationWrapper=class extends s.AbstractWrapper{constructor(e){super("LEGEND_CONFIGURATION_WRAPPER"),this.legendConfiguration=e,e.position_menu&&(this.legendPositionMenu=new n.TopicMenuWrapper(e.position_menu)),e.legend_type_menu&&(this.legendTypeMenu=new n.TopicMenuWrapper(e.legend_type_menu))}toProto(){return this.legendConfiguration}toLegendServerData(){return{legendType:i.LegendTypes[this.legendConfiguration.legend_type],position:i.LegendPosition[this.legendConfiguration.position]}}merge(e){this.legendConfiguration=e.legendConfiguration,this.mergeKey("legendPosition",e),this.mergeKey("legendType",e)}setLegendType(e){this.legendConfiguration.legend_type=e}getLegendType(){return this.legendConfiguration.legend_type}setLegendPosition(e){this.legendConfiguration.position=e}getLegendPosition(){return this.legendConfiguration.position}isHidden(){return"HIDDEN"===this.getLegendPosition()||this.legendPositionMenu&&"HIDDEN"===this.legendPositionMenu.getFirstSelectedEntryRecursively().getMappedId()}}}),define("wrappers/summary/summary_wrapper",["require","exports","wrappers/abstract_wrapper"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.SummaryWrapper=class extends i.AbstractWrapper{constructor(e){super("SUMMARY_WRAPPER"),this.summaryProto=e}toProto(){return this.summaryProto}getLabel(){return this.summaryProto.label}getValue(){return this.summaryProto.value.value}getNumericData(){return this.summaryProto.value.numeric_data}getValueType(){return this.summaryProto.value_type}isPredicatedValue(){return this.summaryProto.value.predicated_value}}}),define("wrappers/widget/dic_wrapper",["require","exports","underscore","wrappers/abstract_wrapper","wrappers/legend_configuration/legend_configuration_wrapper","wrappers/widget/extended_configuration_wrapper","wrappers/widget/widget_menu_wrapper"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a extends n.AbstractWrapper{constructor(e){super("DicWrapper"),this.dic=e,this.initExtendedConfiguration(e),this.initLegendConfiguration(e),this.initMenu(e),this.initNestedDics(e)}merge(e){this.dic=e.getDic(),this.mergeExtendedConfiguration(e),this.mergeLegendConfiguration(e),this.mergeMenu(e),e.hasSlotConfiguration()&&this.updateSlotConfiguration(e.getSlotConfiguration()),e.hasNestedDics()&&this.mergeNestedDics(e.getNestedDics()),this.getDic().ts=(new Date).getTime()}dispose(){super.dispose(),this.hasExtendedConfiguration()&&(this.getExtendedConfiguration().dispose(),this.extendedConfiguration=void 0),this.hasLegendConfiguration()&&(this.getLegendConfiguration().dispose(),this.legendConfiguration=void 0),this.hasMenu()&&(this.getMenu().dispose(),this.menu=void 0),this.dic=void 0}toProto(){return this.hasMenu()&&(this.getDic().menu=this.getMenu().toProto()),this.hasExtendedConfiguration()&&(this.getCurrentDataSource().extended_configuration=this.getExtendedConfiguration().toProto()),this.hasNestedDics()&&(this.dic.nested_data_input_configurations=this.getNestedDics().map(e=>e.toProto())),this.getDic()}updateSlotConfiguration(e){this.dic.slot_configuration=i.assign(this.dic.slot_configuration,e)}hasSlotConfiguration(){return void 0!==this.getSlotConfiguration()}getSlotConfiguration(){return this.dic.slot_configuration}getAnimationAxis(){return this.hasDataSource()?this.getDataSource().animation_axis:this.hasMultiDataSource()?this.getMultiDataSource().animation_axis:void 0}isAsyncRefresh(){return!0===this.dic.async_refresh}hasConfigurationChanged(){return!0===this.getDic().config_changed}setConfigurationChanged(e){this.getDic().config_changed=e}hasDescription(){return!!this.getDescription()}getConfigurationRendering(){return this.getDic().configuration_rendering}hasConfigurationRendering(){return void 0!==this.getConfigurationRendering()}getConfigurationRenderingUuid(){return this.hasConfigurationRendering()?this.getConfigurationRendering().uuid_configuration:void 0}setDescription(e){this.dic.description=e}getDescription(){return this.dic.description}getDisplayDescription(){return this.dic.display_description}getDisplayTitle(){return this.dic.display_title}isEmptyWidget(){return!!this.dic.empty_widget}hasExtendedConfiguration(){return void 0!==this.getExtendedConfiguration()}getExtendedConfiguration(){return this.extendedConfiguration}hasPayload(){return void 0!==this.getPayload()}getPayload(){return this.getDic().payload}hasPrimarySource(){return void 0!==this.getPrimarySource()}getPrimarySource(){return this.getDic().primary_source}hasDataSource(){return void 0!==this.getDataSource()}getDataSource(){return this.hasPrimarySource()?this.getPrimarySource().tw_data_source:void 0}hasMultiDataSource(){return void 0!==this.getMultiDataSource()}getMultiDataSource(){return this.hasPrimarySource()?this.getPrimarySource().tw_multi_data_source:void 0}hasResultDataSource(){return void 0!==this.getResultDataSource()}getResultDataSource(){return this.hasPrimarySource()?this.getPrimarySource().tw_result_source:void 0}hasDynamicSource(){return void 0!==this.getDynamicSource()}getDynamicSource(){return this.hasPrimarySource()?this.getPrimarySource().tw_dynamic_source:void 0}hasAnyDataSource(){return void 0!==this.getCurrentDataSource()}getCurrentDataSource(){if(this.hasPrimarySource()){const e=this.getDataSource()||this.getMultiDataSource()||this.getResultDataSource()||this.getDynamicSource();return void 0!==e?e:void 0}}isDataLoaded(){return this.dic.data_loaded}getDic(){return this.dic}hasEventConsumerType(){return void 0!==this.getEventConsumerType()}getEventConsumerType(){return this.dic.event_type_consumer}hasEventProducerType(){return void 0!==this.getEventProducerType()}getEventProducerType(){return this.dic.event_type_producer}getEventProducerStrategyType(){return this.dic.event_producer_strategy}getEventConsumerStrategyType(){return this.dic.event_consumer_strategy}hasLegendConfiguration(){return void 0!==this.getLegendConfiguration()}getLegendConfiguration(){return this.legendConfiguration}hasMenu(){return void 0!==this.getMenu()}getMenu(){return this.menu}hasUf(){if(!this.hasPrimarySource())return!1;const e=this.getCurrentDataSource();return void 0!==e&&void 0!==e.uf}hasMenuProto(){return void 0!==this.getMenuProto()}getMenuProto(){return this.dic.menu}getMergeType(){return this.getDic().merge_type}hasMergeType(){return void 0!==this.getMergeType()}hasNestedDics(){return void 0!==this.getNestedDics()&&this.getNestedDics().length>0}getNestedDics(){return this.nestedDics}setNotCachedFlag(e){this.dic.not_cached=e}setRefreshPeriodTime(e){this.getDic().refresh_period=e}hasRefreshPeriodTime(){return void 0!==this.getRefreshPeriodTime()}getRefreshPeriodTime(){return this.dic.refresh_period}setSectionId(e){this.dic.section_id=e}getSectionId(){return this.dic.section_id}isSkeleton(){return this.dic.skeleton}setSkeleton(e){this.dic.skeleton=e}hasTitle(){return!!this.getTitle()}setTitle(e){this.dic.title=e}getTitle(){return this.dic.title}getTs(){return this.dic.ts}getWidgetId(){return this.dic.widget_id}setWidgetId(e){this.dic.widget_id=e}getWidth(){return this.dic.width}setWidth(e){this.dic.width=e}setDisplayActiveFilters(e){this.dic.display_active_filters=e}isDisplayActiveFilters(){return!0===this.dic.display_active_filters}hasExtendedConfigurationProto(){return void 0!==this.getExtendedConfigurationProto()}getExtendedConfigurationProto(){return this.hasAnyDataSource()?this.getCurrentDataSource().extended_configuration:void 0}hasWidgetContext(){return void 0!==this.getWidgetContext()}getWidgetContext(){return this.dic.widget_context}hasLegendConfigurationProto(){return void 0!==this.getDic().legend_configuration}initExtendedConfiguration(e){this.hasExtendedConfigurationProto()&&(this.extendedConfiguration=new o.ExtendedConfigurationWrapper(this.getExtendedConfigurationProto()))}initLegendConfiguration(e){this.hasLegendConfigurationProto()&&(this.legendConfiguration=new s.LegendConfigurationWrapper(this.getDic().legend_configuration))}initMenu(e){void 0!==e.menu&&(this.menu=new r.WidgetMenuWrapper(e.menu))}initNestedDics(e){if(e.nested_data_input_configurations){this.nestedDics=[];for(const t of e.nested_data_input_configurations)this.nestedDics.push(new a(t))}}mergeExtendedConfiguration(e){this.hasExtendedConfiguration()&&e.hasExtendedConfiguration()?this.extendedConfiguration.merge(e.getExtendedConfiguration()):this.extendedConfiguration=e.getExtendedConfiguration()}mergeLegendConfiguration(e){this.hasLegendConfiguration()&&e.hasLegendConfiguration()?this.legendConfiguration.merge(e.getLegendConfiguration()):this.legendConfiguration=e.getLegendConfiguration()}mergeMenu(e){this.hasMenu()&&e.hasMenu()?this.menu.merge(e.getMenu()):this.menu=e.getMenu()}mergeNestedDics(e){const t=[];for(let i=e.length-1;i>=0;i--){const n=this.getNestedDicById(e[i].getWidgetId());void 0!==n?(n.merge(e[i]),t.push(n)):t.push(e[i])}const i=this.getNestedDics();t.reverse(),this.nestedDics=t,void 0!==i&&i.forEach(e=>{void 0===this.getNestedDicById(e.getWidgetId())&&e.dispose()})}getNestedDicById(e){return this.hasNestedDics()?this.nestedDics.find(t=>t.getWidgetId()===e):void 0}}t.DicWrapper=a}),define("wrappers/widget/widget_wrapper",["require","exports","cache_service","components/form/common/topic_menu","components/tools/data_graph","data_structures","event","event_bus","flux","log","reusable_utilities","talkwalker_constants","underscore","classes/application/abstract_application","classes/application/application","classes/custom_pages/custom_page_factory","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/widget/types/widget_type","services/configuration","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","services/widgets/widget_size_calculator","wrappers/abstract_wrapper","wrappers/summary/summary_wrapper","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","wrappers/widget/dic_wrapper","components/form/common/graph_helper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I){var x;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NORMAL=0]="NORMAL",e[e.NESTED=1]="NESTED",e[e.ANIMATION=2]="ANIMATION"}(x=t.DatagraphType||(t.DatagraphType={}));const R=new i.WeakCache("widget_wrapper_payload");class F extends T.AbstractWrapper{constructor(e,t,i="WIDGET_WRAPPER"){if(super(i),this.onPayloadChange=new r.Event,this.onRedraw=new r.Event,this.onSetConfigurationChanged=new r.Event,this.onResize=new r.Event,this.onInitializeVisualization=new r.Event,this.onLayoutChange=new r.Event,this.onHeightChanged=new r.Event,this.onDispose=new r.Event,this.onTransitionWidgetObtained=new r.Event,this.reloadingStrategy=C.twCommon.reloadingStrategy.NONE,this.visualizationInitilized=!1,this.failedVisualization=!1,this._isReadyToBeVisualized=!1,this.autoRefreshDisabled=!1,this._canBeDrawn=!1,this.scheduledMenuDelegates=[],this.hasEmptyWidgetMenu=!0,this.dispatchCommands={onResize:"widget_onResize",onImageLoaded:"textEditor_onImageLoaded"},t&&t.isDisposed())throw new Error("cannot assign disposed page state to widget");R.addEntry(this),this.associatedPageState=t,this.dic=new A.DicWrapper(e),this.initialize(),l.logService.assert(!this.isDataLoaded()||void 0!==e.width,"dic "+e.widget_id+" "+e.title+" has no width",C.twCommon.logFeatures.Widget,e)}get pixelHeight(){return this._pixelHeight}set pixelHeight(e){this._pixelHeight=e,this.onHeightChanged.fire(this),this.hasSection()&&this.getSection().onResize.fire(e)}hasLegendConfiguration(){return this.dic.hasLegendConfiguration()}getLegendConfiguration(){return this.dic.getLegendConfiguration()}getLegendOptions(){return this.hasLegendConfiguration()?this.getLegendConfiguration().toLegendServerData():{}}getSelectedViewMode(){if(this.hasMenu()&&this.getMenu().hasViewModeMenu()){const e=this.getMenu().getViewModeMenu().getFirstSelectedEntry();return void 0!==e&&e.getMappedId()}}toProto(){return this.getDicWrapper().toProto()}isVisualizationInitialized(){return this.visualizationInitilized}setVisualizationInitialized(e){this.visualizationInitilized=e}initializeVisualization(e){this.setReloading(!1),this.onInitializeVisualization.fire(e),this.setVisualizationInitialized(!0)}setFailedVisualization(e){this.failedVisualization=e}isFailedVisualization(){return this.failedVisualization}getReplayManager(){return this.replayManager}isNetSentiment(){return void 0!==this.getDic().primary_source&&void 0!==this.getDic().primary_source.tw_data_source&&void 0!==this.getDic().primary_source.tw_data_source.y_axis&&"NET_SENTIMENT"===this.getDic().primary_source.tw_data_source.y_axis.function}hasReplayManager(){return void 0!==this.replayManager}isAnimated(){return this.getMenu().hasWidgetAnimationMenu()&&u.contains(C.twCommon.replayTypes,this.getMenu().getWidgetAnimationMenu().getFirstSelectedEntry().getMappedId())}getIdealWidgetSize(){return E.widgetSizeCalculatorService.getIdealSize(this)}updateReplayManager(){const e=window.tw.inject("ReplayManagerFactory");if(this.isReplayable()){if(this.hasNestedDics())return void(this.hasReplayManager()&&(this.getReplayManager().dispose(),this.replayManager=void 0));if(void 0===this.replayManager)if(this.hasGraph()&&this.isAnimated())this.replayManager=new e(new o.NetworkModel(this.getPayloadValue(!0)));else if(this.hasDataGraph()&&this.getDataGraph().hasAnimationFrames()){const t=new o.DataGraphWrapper(this.getPayloadValue(!0).data_graph);t.hasNumberOfAnimationFrames()?this.replayManager=new e(t,t.getNumberOfAnimationFrames()):this.replayManager=new e(t)}this.hasReplayManager()&&this.refreshReplayManager()}}hasReplayData(){return this.hasGraph()&&this.isAnimated()||this.hasDataGraph()&&this.getDataGraph().hasAnimationFrames()||this.hasReplayManager()}hasAdditionalFrames(){return this.hasReplayManager()&&this.getReplayManager().numberOfFrames>1}refreshReplayManager(){if(this.hasMenu()&&this.getMenu().hasWidgetAnimationMenu()){const e=this.getMenu().getWidgetAnimationMenu().getRootEntry().getSelectedChildren()[0].getMappedId();this.replayManager.setReplayType(e)}this.isWorldMap()||this.isBubbleChart()?this.replayManager.setDurationMultiplier(2):this.replayManager.setDurationMultiplier(1)}setRefreshPeriodTime(e){this.getDicWrapper().setRefreshPeriodTime(e)}hasRefreshPeriodTime(){return this.getDicWrapper().hasRefreshPeriodTime()}getRefreshPeriodTime(){return this.getDicWrapper().getRefreshPeriodTime()}disableAutoRefresh(){this.autoRefreshDisabled=!0}isAutoRefreshEnabled(){return this.isDataLoaded()&&!this.autoRefreshDisabled&&void 0!==this.element&&S.configurationService.getWidgetConfiguration(this.getType()).canAutoRefresh(this)&&this.isOnScreen(.4,100)&&void 0!==this.getRefreshPeriodTime()&&0!==this.getRefreshPeriodTime()}isOnScreen(e=.2,t=500){return C.twCommon.isElementOnScreen(this.element,1,e,1,t)}checkAutoRefresh(e){l.logService.assert(0!==this.getRefreshPeriodTime(),"You are not allowed to have auto refresh with a period duration of 0",C.twCommon.logFeatures.Widget,this);const t=this.isAutoRefreshEnabled()&&(new Date).getTime()-Math.max(this.lastAutoRefreshTs||0,e)>this.getRefreshPeriodTime();return t&&(this.lastAutoRefreshTs=(new Date).getTime()),t}getExtendedConfiguration(){return this.dic.getExtendedConfiguration()}hasExtendedConfiguration(){return this.dic.hasExtendedConfiguration()}getEventConsumerType(){return this.getDicWrapper().getEventConsumerType()}hasEventConsumerType(){return this.getDicWrapper().hasEventConsumerType()}hasEventProducerType(){return this.getDicWrapper().hasEventProducerType()}getEventProducerType(){return this.getDicWrapper().getEventProducerType()}getEventProducerStrategyType(){return this.getDicWrapper().getEventProducerStrategyType()}getEventConsumerStrategyType(){return this.getDicWrapper().getEventConsumerStrategyType()}setNotCachedFlag(e){this.getDicWrapper().setNotCachedFlag(e)}getNestType(){return this.getDicWrapper().getMergeType()}hasNestType(){return this.getDicWrapper().hasMergeType()}getNestedDics(){return this.dic.getNestedDics()}hasNestedDics(){return this.dic.hasNestedDics()}canNest(e){return this.hasNestType()&&e.hasNestType()&&e.getNestType()===this.getNestType()&&!(e.hasNestedDics()||this.hasNestedDics()||e.getDataGraph().hasIndicatorFrames()||this.getDataGraph().hasIndicatorFrames())}getDatagraphsByType(e){if(!this.hasDataGraph())return[];switch(e){case x.NORMAL:return[new o.DataGraphWrapper(this.getPayloadValue().data_graph)];case x.NESTED:return new o.DataGraphWrapper(this.getPayloadValue().data_graph).getFramesOfType("nested");case x.ANIMATION:return new o.DataGraphWrapper(this.getPayloadValue().data_graph).getFramesOfType("animation");default:throw new Error("not implemented")}}getNestedWidgetById(e){if(this.hasNestedDics())return u.find(this.getNestedDics(),t=>t.getWidgetId()===e)}addNestedWidget(e){if(!this.getPageState().hasAllowedPages())return;const t=this.getPageState().getAllowedPages();let i;t.isDashboard()?i=C.twCommon.nestedWidgetEndPoints.dashboard:t.isReport()&&(i=C.twCommon.nestedWidgetEndPoints.report);const n=routes.controllers.tw.TWRestForm.get("project",this.getPageState().getProject().getId(),i,"merge",0,"rform").url,s=t.getCustomPageId();let o=this,r=e;r.getDataGraph().hasNegativeValues()&&([o,r]=[r,o],l.logService.debug("Swapping source & target widget for nesting",C.twCommon.logFeatures.Widget,{target:o,source:r})),w.restFormService.post(n,{data_input_configuration:o.toProto(),dics:[r.toProto()],custom_page_id:s}).then(e=>{this.refreshPageData("Error when refreshing page state after adding nested widget !")})}unlinkNestedWidgets(){if(!this.getPageState().hasAllowedPages())return;const e=this.getPageState().getAllowedPages();let t;e.isDashboard()?t=C.twCommon.nestedWidgetEndPoints.dashboard:e.isReport()&&(t=C.twCommon.nestedWidgetEndPoints.report);const i=routes.controllers.tw.TWRestForm.get("project",this.getPageState().getProject().getId(),t,"split",0,"rform").url;w.restFormService.post(i,{data_input_configuration:this.toProto(),custom_page_id:e.getCustomPageId()}).then(e=>{this.refreshPageData("Error when refreshing page state after unlinking nested widgets !")})}isStreamGraph(){return this.getConfigurationRenderingUuid()===g.ConfigurationDefaultsEnum.UUID_CONFIG_STREAM_GRAPH}isSortedThemeCloud(){return this.hasTreePayloadType()&&this.getConfigurationRenderingUuid()===g.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_SORTED}isImpactGraph(){return this.getConfigurationRenderingUuid()===g.ConfigurationDefaultsEnum.UUID_CONFIG_IMPACT_BUBBLES_DEFAULT}getType(){if(this.isImpactGraph())return v.WidgetType.IMPACT_GRAPH;if(this.isStreamGraph())return v.WidgetType.STREAM_GRAPH;if(this.isSortedThemeCloud())return v.WidgetType.SORTED_THEME_CLOUD;if(this.isThemeCloud())return v.WidgetType.THEME_CLOUD;if(this.isPieChart())return v.WidgetType.PIE_CHART;if(this.isComposedGraph()||this.isNestedWidget())return v.WidgetType.COMPOSED_GRAPH;if(this.isAreaChart())return v.WidgetType.AREA_CHART;if(this.isLineChart())return v.WidgetType.LINE_CHART;if(this.isVelocityChart())return v.WidgetType.VELOCITY_CHART;if(this.isBubbleChart())return v.WidgetType.BUBBLE_CHART;if(this.isCounter())return v.WidgetType.COUNTER;if(this.isKPI())return v.WidgetType.KPI_CHART;if(this.isHorizontalBarChart())return v.WidgetType.HORIZONTAL_BAR_CHART;if(this.isVerticalBarChart())return v.WidgetType.VERTICAL_BAR_CHART;if(this.isActivity())return v.WidgetType.ACTIVITY_CHART;if(this.isSummary())return v.WidgetType.SUMMARIES;if(this.isPageBreak())return v.WidgetType.PAGE_BREAK;if(this.isInfluencerOverview())return v.WidgetType.INFLUENCER_OVERVIEW;if(this.isTopInfluencersOverview())return v.WidgetType.TOP_INFLUENCERS_OVERVIEW;if(this.isEmojiTree())return v.WidgetType.EMOJI_TREE;if(this.isThemeTree())return v.WidgetType.THEME_TREE;if(this.isMetricMultiple())return v.WidgetType.MULTI_METRICS;if(this.isInfluencerNetwork())return v.WidgetType.INFLUENCER_NETWORK;if(this.isDocumentCluster())return v.WidgetType.DOCUMENT_CLUSTER;if(this.isPayloadEdition())return v.WidgetType.PAYLOAD_EDITION;if(this.isWheelChart())return v.WidgetType.WHEEL_CHART;if(this.isRadarChart())return v.WidgetType.RADAR_CHART;if(this.isProgressGraph())return v.WidgetType.PROGRESS_GRAPH;let e="Unknown widget type for payload type "+this.getPayloadType();this.hasGraphType()&&(e+=" , graph type "+this.getGraphType()),this.hasDataTypeUuid()&&(e+=" , data type "+this.getDataTypeUuid()),this.hasConfigurationRendering()&&(e+=" , configuration uuid "+this.getConfigurationRenderingUuid()),this.hasExtendedConfiguration()&&(e+=" and extended configuration type "+this.getExtendedConfiguration().getType()),l.logService.error(e,C.twCommon.logFeatures.Widget,this)}hasPageState(){return void 0!==this.getPageState()}getPageState(){return this.associatedPageState}isSelected(){return this.selected}setSelected(e){this.selected=e}toggleSelected(){this.selected=!this.selected}getId(){return this.getDicWrapper().getWidgetId()}setId(e){this.getDicWrapper().setWidgetId(e)}redraw(e=!1){l.logService.debug("Redrawing widget of type:"+this.getType(),C.twCommon.logFeatures.Widget),this.getDic().ts=Date.now(),this.onRedraw.fire(e)}isDataLoaded(){return this.getDic().data_loaded}getTs(){return this.getDic().ts}getResultCount(){return this.hasPayloadValue()?this.getPayloadValue().total:void 0}hasResultCount(){return!u.isUndefined(this.getResultCount())}getResultCountText(){return this.hasPayloadValue()?this.getPayloadValue().total_label:void 0}hasResultCountText(){return!u.isUndefined(this.getResultCountText())}_setPageState(e){this.associatedPageState=e}hasUf(){return this.getDicWrapper().hasUf()}getUf(){return this.hasUf()?new D.UserFilterSettingsWrapper(this.getCurrentDataSource().uf,this.getPageState(),C.twCommon.holderTypes.WIDGET,!0):void 0}prune(e=!1,t=!1){return e&&!this.hasFiltersChanged()&&this.getApplication().getType()===p.ApplicationType.MAIN&&(this.getDic().ts=void 0,this.getDic().uuid_conf_section=void 0,this.getDic().configuration_rendering=void 0,this.hasAnyDataSource()&&delete this.getCurrentDataSource().uf),t&&(this.getDic().menu=void 0),this.clearPayloadValue(),this}copyAndPrune(e,t){const i=this.clone();return i.prune(e,t),i}setTitle(e){this.getDicWrapper().setTitle(e)}hasTitle(){return this.getDicWrapper().hasTitle()}hasDescription(){return this.getDicWrapper().hasDescription()}getTitle(){return this.getDicWrapper().getTitle()}getDisplayTitle(){return this.getDicWrapper().getDisplayTitle()}getDescription(){return this.getDicWrapper().getDescription()}getDisplayDescription(){return this.getDicWrapper().getDisplayDescription()}setDescription(e){this.getDicWrapper().setDescription(e)}getConfigurationRendering(){return this.getDicWrapper().getConfigurationRendering()}hasConfigurationRendering(){return this.getDicWrapper().hasConfigurationRendering()}getConfigurationRenderingUuid(){return this.getDicWrapper().getConfigurationRenderingUuid()}hasMissingDataReason(){return this.hasPayload()&&void 0!==this.getPayload().missing_data_reason}getMissingDataReason(){return this.hasMissingDataReason()?this.getPayload().missing_data_reason:void 0}isMissingDataReasonSearchNotAvailable(){return this.hasMissingDataReason()&&this.getMissingDataReason()===constants.payload.missing_data_reason.search_not_available}isMissingDataReasonFeatureDisabled(){return this.hasMissingDataReason()&&"FEATURE_DISABLED"===this.getMissingDataReason()}isEmptyWidget(){return this.getDicWrapper().isEmptyWidget()}isExternalData(){return"UUID_CONFIG_EXTERNAL_DATA"===this.getConfigurationRenderingUuid()}getWidth(){return this.getDicWrapper().getWidth()}getAllowedWidths(){return this.allowedWidths}getSmallestAllowedWidth(){return this.canResize()?u.min(this.getAllowedWidths()):this.getWidth()}setSkeleton(e){this.getDicWrapper().setSkeleton(e)}isSkeleton(){return!!this.getDicWrapper().isSkeleton()}clearPayload(){return this.hasPayload()&&!0!==this.getPayload().keep_payload&&(this.getPayload().value=void 0),this}clone(){const e=new F(JSON.parse(JSON.stringify(this.toProto())),this.associatedPageState);return e.setFiltersChanged(this.hasFiltersChanged()),e}getAllowedSizeClosestTo(e){if(l.logService.assert(void 0!==e,"desiredSize is required"),!this.canResize())return this.getWidth();let t,i=Number.MAX_VALUE;for(let n=0;n<this.getAllowedWidths().length;n++){const s=Math.abs(e-this.getAllowedWidths()[n]);s<i&&(i=s,t=n)}return this.getAllowedWidths()[t]}canResize(){return this.getAllowedWidths().length>0&&S.configurationService.getPageConfiguration().canResizeWidget(this)}getLargestAllowedWidth(){return this.canResize()?u.max(this.getAllowedWidths()):this.getWidth()}hasSection(){return void 0!==this.associatedPageState&&void 0!==this.getSection()}getSection(){return this.associatedPageState.getSectionById(this.getSectionId())}isMovable(){if(!this.hasPageState())return!1;if(this.getPageState().isGridPage())return this.getPageState().isEditMode()||this.getPageState().hasAllowedPages()&&this.getPageState().getAllowedPages().isReport()&&this.getPageState().getAllowedPages().getPageType()===constants.page_type.report_layout;{const e=this.associatedPageState.getSectionById(this.getSectionId());return e&&e.isSortable()}}setSectionId(e){this.getDicWrapper().setSectionId(e)}getSectionId(){return this.getDicWrapper().getSectionId()}setErrorState(e,t){this.errorState=e,this.errorLevel=t}setErrorLevel(e){this.errorLevel=e}getErrorLevel(){return this.errorLevel}getErrorState(){return this.errorState}clearErrorState(){this.errorState=void 0}hasErrorState(){return void 0!==this.errorState}merge(e,t){if(Object.getPrototypeOf(this)!==Object.getPrototypeOf(e))throw new Error("cannot merge widgets of different wrapper types");R.getEntry(this).clear(),this.transitionWidget=void 0,this.clearErrorState(),this.setFailedVisualization(!1),l.logService.assert(void 0!==e,"widget is required");const i=this.hasPayload(),n=this.hasFiltersChanged();if(this.dic.merge(e.getDicWrapper()),this.dataGraph=void 0,this.summaries=void 0,this.setFiltersChanged(n),this.setSectionId(e.getSectionId()),this.hasMenu()&&e.hasMenu()&&this.getMenu().merge(e.getMenu()),e.isSkeleton()&&(this._isReadyToBeVisualized=!1,this.visualizationInitilized=!1),this.hasNumResults()){const t=new P.TopicMenuWrapper(e._getExtendedConfigurationProto().num_results);t.hasRootEntry()?(t.queryAllEntries(e=>{e.isSelected()||(e.setSelected(!0),e.setSelected(!1))}),this.getExtendedConfiguration().setNumResultsMenu(t.toProto())):(l.logService.error("Widget has broken num_results menu",C.twCommon.logFeatures.PageState,this),delete e._getExtendedConfigurationProto().num_results)}this.initialize(),this.hasReplayManager()&&(e.hasReplayManager()?(this.hasDataGraph()?this.replayManager.merge(new o.DataGraphWrapper(this.getPayloadValue(!0).data_graph)):this.hasGraph()&&this.replayManager.merge(new o.NetworkModel(this.getPayloadValue(!0))),this.refreshReplayManager()):(this.replayManager.dispose(),this.replayManager=void 0)),this.hasPayload()||i?this.onPayloadChange.fire({newPayload:this.getPayload(),isLoadMore:t}):a.eventBus.dispatch({type:a.EVENT_TYPES.CLEAR_WIDGET_MENU_CACHE,value:this})}hasNumResults(){return this._hasExtendedConfigurationProto()&&void 0!==this._getExtendedConfigurationProto().num_results}hasAllowedEventSources(){return void 0!==this.getAllowedEventSources()}getAllowedEventSources(){return this.getDic().allowed_event_sources}getLinkedWidgets(){return this.getPageState().getWidgets().filter(e=>e.hasEventConsumerType()&&e.getEventConsumerType()===this.getEventProducerType())}initialize(){if(this.updateReplayManager(),this.allowedWidths=[],this.editMode=this.isEditMode(),this.hasDicMenuWidgetWidth()){const e=n.retrieveLeavesMappedIds(this.getDicMenuWidgetWidth().root_entry);this.allowedWidths.push.apply(this.allowedWidths,e.map(e=>parseInt(e,10)))}this.hasSlotConfiguration()&&void 0===this.getSlotConfiguration().trailing_whitespace&&(this.getSlotConfiguration().trailing_whitespace=0)}hasDicMenu(){return void 0!==this.getDicMenu()}getDicMenu(){return this.getDic().menu}hasDicMenuWidgetWidth(){return void 0!==this.getDicMenuWidgetWidth()}getDicMenuWidgetWidth(){return this.hasDicMenu()?this.getDicMenu().widget_width:void 0}hasImageId(){return this.hasPayload()&&void 0!==this.getPayload().image_id}getImageId(){return this.getPayload().image_id}setImageId(e){this.getPayload().image_id=e,this.redraw()}getDic(){return this.dic.getDic()}hasDic(){return void 0!==this.getDic()}getDicWrapper(){return this.dic}attachTemplate(e){this.element=e}hasTemplate(){return void 0!==this.element}getTemplate(){return this.element}isReadyToBeVisualized(){return this._isReadyToBeVisualized}setReadyToBeVisualized(e){this._isReadyToBeVisualized=e,e&&(this.visualizationInitilized=!1)}dispose(){super.dispose(),this.onDispose.fire(),delete this.element,this.associatedPageState=void 0,this.dic.dispose(),R.getEntry(this).hasValue()&&R.getEntry(this).clear(),this.cancelEvents(),l.logService.debug("dispose widget",C.twCommon.logFeatures.Widget,{widget:this})}cancelEvents(){this.onPayloadChange.cancelAll(),this.onRedraw.cancelAll(),this.onSetConfigurationChanged.cancelAll(),this.onResize.cancelAll(),this.onInitializeVisualization.cancelAll(),this.onLayoutChange.cancelAll(),this.onHeightChanged.cancelAll(),this.onTransitionWidgetObtained.cancelAll(),this.onDispose.cancelAll()}canShrink(){return!!this.canResize()&&u.min(this.getAllowedWidths())<this.getWidth()}shrink(){let e=u.indexOf(this.getAllowedWidths(),this.getWidth());e>0&&e--,this.requestSizeChange(this.getAllowedWidths()[e])}isContent(){return!this.isPageBreak()&&!this.isPayloadEdition()}hasPrimarySource(){return this.getDicWrapper().hasPrimarySource()}getPrimarySource(){return this.getDicWrapper().getPrimarySource()}hasAnimationAxis(){return this.hasPrimarySource()&&void 0!==this.getAnimationAxis()}getAnimationAxis(){return this.getDicWrapper().getAnimationAxis()}getDynamicSource(){return this.getDicWrapper().getDynamicSource()}hasDynamicSource(){return this.getDicWrapper().hasDynamicSource()}getTopInfluencersOverviewConfiguration(){return this.getDynamicSource().top_influencers_overview_configuration}hasTopInfluencersOverviewConfiguration(){return this.hasDynamicSource()&&!u.isUndefined(this.getTopInfluencersOverviewConfiguration())}getInfluencersConfiguration(){return this.getTopInfluencersOverviewConfiguration().influencers_configuration}hasInfluencersConfiguration(){return this.hasTopInfluencersOverviewConfiguration()&&!u.isUndefined(this.getInfluencersConfiguration())&&this.getInfluencersConfiguration().length>0}isFooter(){return!1}isHeader(){return!1}hasPayload(){return this.hasDic()&&void 0!==this.getPayload()}getPayload(){return this.getDic().payload}clearPayloadValue(){return this.hasPayload()&&!this.getDic().payload.keep_payload&&(this.getDic().payload.value=void 0),R.getEntry(this).hasValue()&&R.getEntry(this).clear(),this}clearLoadingState(){l.logService.debug("clear loading state",C.twCommon.logFeatures.Widget),this.setReloadingStrategy(C.twCommon.reloadingStrategy.NONE),this.getDic().reload=!1}canBeFullScreen(){return this.hasMenu()&&void 0!==this.getDicMenu().can_be_enlarge&&S.configurationService.getWidgetConfiguration(this.getType()).canBeFullScreen(this)}isReplayable(){return this.canBeFullScreen()&&this.getPageState().hasAllowedPages()&&!this.getPageState().getAllowedPages().isSearchAdvanced()&&S.configurationService.getWidgetConfiguration(this.getType()).isReplayable(this)}hasReplayModes(){return this.isReplayable()&&S.configurationService.getWidgetConfiguration(this.getType()).hasReplayModes(this)}setPayload(e){this.getDic().payload=e,R.getEntry(this).clear(),this.dataGraph=void 0,this.onPayloadChange.fire({newPayload:this.getPayload(),isLoadMore:!1})}setPayloadValue(e,t=!0){R.getEntry(this).set(e),this.getDic().payload.value=JSON.stringify(e),this.dataGraph=void 0,t||this.onPayloadChange.fire({newPayload:this.getPayload(),isLoadMore:!1})}hasPayloadValue(){return this.hasPayload()&&void 0!==this.getDic().payload.value}getPayloadValue(e=!1){return l.logService.assert(void 0!==this.getDic().payload,"Payload is not available",C.twCommon.logFeatures.Widget),l.logService.assert(void 0!==this.getDic().payload.value,"Payload value is not available",C.twCommon.logFeatures.Widget),R.getEntry(this).hasValue()&&this.hasPayloadValue()&&R.getEntry(this).set(JSON.parse(this.getDic().payload.value)),e?d.deepClone(R.getEntry(this).get()):R.getEntry(this).get()}hasPayloadType(){return this.hasPayload()&&void 0!==this.getPayload().type}getPayloadType(){return this.hasPayloadType()?this.getDic().payload.type:void 0}getMenu(){return this.isSkeleton()?void 0:this.dic.getMenu()}hasMenu(){return void 0!==this.getMenu()}getMultiDataSource(){return this.getDicWrapper().getMultiDataSource()}hasMultiDataSource(){return this.getDicWrapper().hasMultiDataSource()}getResultDataSource(){return this.getDicWrapper().getResultDataSource()}hasResultDataSource(){return this.getDicWrapper().hasResultDataSource()}getDataSource(){return this.getDicWrapper().getDataSource()}hasDataSource(){return this.getDicWrapper().hasDataSource()}getCurrentDataSource(){return this.getDicWrapper().getCurrentDataSource()}hasAnyDataSource(){return this.getDicWrapper().hasAnyDataSource()}isGender(){return!1}isInfluencerOverview(){return this.getPayloadType()===g.PayloadType.PAYLOAD_INFLUENCER_OVERVIEW}isTable(){return!1}isInfluencerTable(){return!1}isThemeCloud(){return this.hasTreePayloadType()&&C.twCommon.ThemeCloudGraphConfigs.indexOf(this.getConfigurationRenderingUuid())>-1}isEmojiTree(){return this.isThemeTree()&&this.hasPayloadValue()&&d.ObjectUtils.hasPropertyChain(this.getPayloadValue(),["tree","meta_data","attributes",constants.data_graph.meta_data.attrs.emoji_data])&&!0===this.getPayloadValue().tree.meta_data.attributes[constants.data_graph.meta_data.attrs.emoji_data]}hasDatagraphPayloadType(){return this.getPayloadType()===g.PayloadType.PAYLOAD_DATAGRAPH}isPieChart(){return this.hasDatagraphPayloadType()&&this.getGraphType()===g.TypeGraph.PIE_CHART}isRadarChart(){return this.hasDatagraphPayloadType()&&C.twCommon.RadarGraphTypes.indexOf(this.getGraphType())>-1&&C.twCommon.RadarGraphConfigs.indexOf(this.getConfigurationRenderingUuid())>-1}isWheelChart(){return this.hasTreePayloadType()&&C.twCommon.WheelChartGraphConfigs.indexOf(this.getConfigurationRenderingUuid())>-1}isAreaChart(){return this.getPayloadType()===g.PayloadType.PAYLOAD_DATAGRAPH&&this.getGraphType()===g.TypeGraph.AREA}isBubbleChart(){return this.getPayloadType()===g.PayloadType.PAYLOAD_BUBBLE}isLineChart(){return this.getPayloadType()===g.PayloadType.PAYLOAD_DATAGRAPH&&this.getGraphType()===g.TypeGraph.LINE_CHART}isProgressGraph(){return this.getPayloadType()===g.PayloadType.PAYLOAD_PROGRESS&&this.getGraphType()===g.TypeGraph.LINE_CHART}isComposedGraph(){return this.hasDataGraph()&&(this.getDataGraph().hasIndicatorFrames()||this.getDataGraph().hasNestedFrames())&&C.twCommon.composedGraphTypes.indexOf(this.getGraphType())>-1}isVelocityChart(){return this.getPayloadType()===constants.payload_type.payload_velocity_datagraph&&this.getGraphType()===g.TypeGraph.LINE_CHART}isBarChart(){return(this.hasDatagraphPayloadType()||this.hasTreePayloadType())&&this.getGraphType()===g.TypeGraph.COLUMN_CHART}isDateHistogram(){return this.isBarChart()||this.isAreaChart()||this.isLineChart()&&this.hasDataSource()&&this.getDataSource().x_axis&&this.getDataSource().x_axis.use_time}isKPI(){return this.isResult()&&(this.getDataTypeUuid()===g.DataType.RESULT||this.isSkeleton())}isCounter(){return this.isResult()&&this.getDataTypeUuid()===g.DataType.COUNTER}isResult(){return this.getPayloadType()===g.PayloadType.PAYLOAD_RESULT}isSingleMetric(){return!1}isActivity(){return this.getPayloadType()===g.PayloadType.PAYLOAD_ACTIVITY}isText(){return!1}isExternalTrends(){return this.getPayloadType()===g.PayloadType.PAYLOAD_EXTERNAL_TRENDS}isMessageDiffusion(){return!1}isGlobe(){return!1}isHorizontalBarChart(){return this.isBarChart()&&this.getConfigurationRendering().bar_chart.orientation_mode===constants.bar_chart.orientation.HORIZONTAL}isVerticalBarChart(){return this.isBarChart()&&this.getConfigurationRendering().bar_chart.orientation_mode===constants.bar_chart.orientation.VERTICAL}isPageBreak(){return this.getPayloadType()===g.PayloadType.PAYLOAD_PAGE_BREAK}isPayloadEdition(){return this.getPayloadType()===g.PayloadType.PAYLOAD_EDITION}isNestedWidget(){return this.getPayloadType()===g.PayloadType.PAYLOAD_EXTERNAL_DATA}isSummary(){return this.getPayloadType()===g.PayloadType.PAYLOAD_SUMMARY_WIDGET}isWorldMap(){return!1}isArticles(){return!1}isArticlesStoryTiles(){return!1}isArticlesKeyStories(){return!1}isArticlesCompact(){return!1}isTopInfluencersOverview(){return this.getPayloadType()===g.PayloadType.PAYLOAD_TOP_INFLUENCERS_OVERVIEW}hasTransitionWidget(){return void 0!==this.transitionWidget}isTransitionWidget(){return void 0!==this.getTransitionTarget()}async setTransitionWidget(e){this.getTemplate().fadeOut(500),await d.waitFor(500),this.merge(e,!1),await window.tw.inject("$timeout")(()=>{this.getTemplate().fadeIn(500)})}hasTreePayloadType(){return this.getPayloadType()===g.PayloadType.PAYLOAD_THEME_TREE}isThemeTree(){return this.hasTreePayloadType()&&C.twCommon.ThemeTreeGraphConfigs.indexOf(this.getConfigurationRenderingUuid())>-1}isTreeMap(){return!1}isMetricMultiple(){return this.hasDatagraphPayloadType()&&this.getGraphType()===g.TypeGraph.MULTI_METRICS}isInfluencerNetwork(){return this.getPayloadType()===g.PayloadType.PAYLOAD_INFLUENCER_NETWORK}isDocumentCluster(){return this.getPayloadType()===g.PayloadType.PAYLOAD_DOCUMENT_CLUSTER}isTrendsTable(){return!1}isHideWidgetLegend(){return!!this.dic.hasMenuProto()&&!0===this.dic.getMenuProto().hide_widget_legend}isHideWidgetTitle(){return!!this.dic.hasMenuProto()&&!0===this.dic.getMenuProto().hide_widget_title}isHideWidgetDescription(){return!!this.dic.hasMenuProto()&&!0===this.dic.getMenuProto().hide_widget_description}isHideWidgetMetrics(){return!!this.dic.hasMenuProto()&&!0===this.dic.getMenuProto().hide_widget_metrics}isTopImagesList(){return!1}isSmallArticlesWidget(){return!1}isSmallTreemap(){return!1}canShowCommentContainer(){return this.isLineChart()||this.isAreaChart()||this.isComposedGraph()}setReloading(e,t){l.logService.info("changed reloading to "+e,C.twCommon.logFeatures.WidgetWrapper),this.getDic().reload=e,this.setReloadingStrategy(t)}determineAutoRefreshStrategy(){return window.tw.pageState.getAllowedPages().isCommandCenterScreen()?C.twCommon.reloadingStrategy.NONE:this.isArticlesCompact()&&this.getWidth()<12?C.twCommon.reloadingStrategy.SPINNER:C.twCommon.reloadingStrategy.DEFAULT}getReloadStrategy(){return this.reloadingStrategy}isReloadingWithDefaultStrategy(){return this.hasReloadingStrategyOfType(C.twCommon.reloadingStrategy.DEFAULT)}isReloadingWithSpinnerStrategy(){return this.hasReloadingStrategyOfType(C.twCommon.reloadingStrategy.SPINNER)}isReloadingWithWidgetStrategy(){return this.hasReloadingStrategyOfType(C.twCommon.reloadingStrategy.WIDGET)}isReloading(){return this.getDic().reload}setReloadingStrategy(e){this.reloadingStrategy=e}hasReloadingStrategyOfType(e){return this.reloadingStrategy===e}prepareReload(e=C.twCommon.reloadingStrategy.DEFAULT){return this.setReloadingStrategy(e),this.getDic().reload=!0,this.hasReplayManager()&&this.getReplayManager().isPlaying()&&this.getReplayManager().getTimeline().stop(),this}setConfigurationChanged(e){this.getDicWrapper().setConfigurationChanged(e),this.onSetConfigurationChanged.fire(e)}hasConfigurationChanged(){return this.getDicWrapper().hasConfigurationChanged()}canBeDeleted(){return!this.isPayloadEdition()}canBeDrawn(){return this._canBeDrawn}setCanBeDrawn(e){this._canBeDrawn=e}canBeSaved(){return this.getDic().saveable}getApplication(){return this.associatedPageState.getApplication()}getExportHeight(){return this.isWorldMap()||this.isArticles()?2:1}getPreferredHeight(){return S.configurationService.getWidgetConfiguration(this.getType()).getPreferredHeight(this)}getHeight(){return S.configurationService.getWidgetConfiguration(this.getType()).getHeight(this)}getHeightRange(){return S.configurationService.getWidgetConfiguration(this.getType()).getHeightRange(this)}canGrowBy(e){const t=u.indexOf(this.getAllowedWidths(),this.getWidth())+1;return t<this.getAllowedWidths().length&&this.getAllowedWidths()[t]-this.getWidth()===e}canExpand(){if(!this.canResize())return!1;return u.indexOf(this.getAllowedWidths(),this.getWidth())<this.getAllowedWidths().length-1}expand(){let e=u.indexOf(this.getAllowedWidths(),this.getWidth());e<this.getAllowedWidths().length-1&&e++,this.requestSizeChange(this.getAllowedWidths()[e])}forceSizeChange(e){this.setDicWidth(e),c.dispatcher.dispatch(this.dispatchCommands.onResize,{dic:this.getDic()}),this.onResize.fire()}requestSizeChange(e){if(!this.canResize())return;const t=this.getAllowedSizeClosestTo(e);this.setDicWidth(t),n.recursiveUnselectAndSelect(this.getDicMenuWidgetWidth().root_entry,t),c.dispatcher.dispatch(this.dispatchCommands.onResize,{dic:this.getDic()}),this.onResize.fire()}setDicWidth(e){this.getDicWrapper().setWidth(e)}getDropZoneConfiguration(){let e=[];return this.isMovable()&&(e=this.element.height()<120?[C.twCommon.sides.RIGHT,C.twCommon.sides.LEFT,C.twCommon.sides.CENTER]:[C.twCommon.sides.TOP,C.twCommon.sides.RIGHT,C.twCommon.sides.BOTTOM,C.twCommon.sides.LEFT,C.twCommon.sides.CENTER]),e}isStackable(){return this.hasSlotConfiguration()&&void 0!==this.getSlotConfiguration().grid_y}isXAxisMajorTickDecimal(){return void 0===this.getCurrentDataSource().extended_configuration.x_axis_configuration||void 0===this.getCurrentDataSource().extended_configuration.x_axis_configuration.allow_major_tick_decimal||!0===this.getCurrentDataSource().extended_configuration.x_axis_configuration.allow_major_tick_decimal}_getExtendedConfigurationProto(){return this.hasAnyDataSource()?this.getCurrentDataSource().extended_configuration:void 0}_hasExtendedConfigurationProto(){return void 0!==this._getExtendedConfigurationProto()}findExtendedConfiguration(e){if(void 0!==e&&this.hasNestedDics()){const t=this.getNestedWidgetById(e);if(void 0!==t)return t.getExtendedConfiguration()}return this.getExtendedConfiguration()}getDataGraph(){return u.isUndefined(this.dataGraph)&&this.hasPayloadValue()&&void 0!==this.getPayloadValue().data_graph&&(this.dataGraph=new s.default(this.getPayloadValue(!0).data_graph)),this.dataGraph}getSummaries(){return u.isUndefined(this.summaries)&&this.hasPayloadValue()&&(this.summaries=[],(this.getPayloadValue(!0).summaries||[]).forEach(e=>{this.summaries.push(new M.SummaryWrapper(e))})),this.summaries}getGraphType(){return this.hasGraphType()?this.getConfigurationRendering().graph.type_graph:void 0}hasGraphType(){return this.hasConfigurationRendering()&&void 0!==this.getConfigurationRendering().graph&&void 0!==this.getConfigurationRendering().graph.type_graph}getNestedGraphType(){if(this.getMenu().hasNestedGraphTypeMenu()){const e=this.getMenu().getNestedGraphTypeMenu().getFirstSelectedEntryRecursively();return!u.isUndefined(e)&&e.getMappedId()}}getDataTypeUuid(){return this.hasPrimarySource()?this.getPrimarySource().data_type_configuration_uuid:void 0}hasDataTypeUuid(){return void 0!==this.getDataTypeUuid()}hasGraph(){return this.hasPayloadValue()&&void 0!==this.getPayloadValue().graph}hasDataGraph(){return void 0!==this.getDataGraph()}determineDataGraphType(){return this.isComposedGraph()?C.twCommon.composedGraphType:this.getGraphType()}isFullyLoaded(){return!!this.fullyLoaded}setFullyLoaded(e){this.fullyLoaded=e}isClickable(){return!this.hasSampleData()&&this.hasDataGraph()&&this.getDataGraph().clickable}hasSampleData(){const e=this.getDataGraph();return!u.isUndefined(e)&&!u.isUndefined(e.sample_data)&&e.sample_data}canUseSampleData(){return!0===this.getDic().use_sample_data}setFiltersChanged(e){this.filtersChanged=e}hasFiltersChanged(){return void 0!==this.filtersChanged&&this.filtersChanged}setEditMode(e){this.dic.edit_mode=e,this.editMode=e}getEditMode(){return this.dic.edit_mode}isEditMode(){return!0===this.dic.edit_mode}isTranslateAll(){if(this.hasMenu()&&this.getMenu().hasTranslationTargetLanguageMenu()){const e=this.getMenu().getTranslationTargetLanguageMenu().getFirstSelectedEntry();return e&&e.getMappedId()!==constants.topic_menu.target_language.no_translation}return!1}getCutoffMessage(){const e=this.getPageState().getProject().getId();return I.getCutoffMessage(this.getDataGraph().cutoffs_in_time_range,e)}getTokenExpirationMessage(){return I.getTokenExpirationMessage(this.getDataGraph().partial_data_messages)}canReplay(){return this.getDic().can_replay}hasNavigationOptions(){return!u.isUndefined(this.getNavigationOptions())}getNavigationOptions(){return this.getDic().navigation_options}scheduleCallOnMenuClose(e,t){this.scheduledMenuDelegates.push({delegate:e,args:t})}resolveScheduledMenuDelegates(){this.scheduledMenuDelegates.length>0&&((this.scheduledMenuDelegates||[]).forEach(e=>{e.delegate.apply(null,e.args)}),this.scheduledMenuDelegates.length=0)}setHeightIndex(e){this.getDic().height_index=e}getHeightIndex(){return this.getDic().height_index}hasHeightIndex(){return void 0!==this.getHeightIndex()}canEditComments(){const e=this.getPageState().getAllowedPages(),t=this.getPageState().isEditMode();return e&&(t&&(e.isDashboard()||e.isIqApp())||e.isReport()||e.isEmbeddedWidget()||e.isCommandCenterWidgetPreview()||e.isCommandCenterScreenEditMode())}canSaveComments(){return this.canEditComments()}hasSlotConfiguration(){return this.dic.hasSlotConfiguration()}getSlotConfiguration(){return this.dic.getSlotConfiguration()}updateSlotConfiguration(e){this.dic.updateSlotConfiguration(e)}getTransitionWidget(){return this.transitionWidget}getTransitionTarget(){if(!this.hasPageState())return;const e=this.getPageState().getWidgets();return u.find(e,e=>e.getTransitionWidget()===this)}canGridResizeTo(e){const{dimension_limit:{min_height:t,max_height:i,max_width:n,min_width:s}}=this.getSlotConfiguration();return e.width>=s&&e.width<=n&&e.height>=t&&e.height<=i}getBlueprint(){return this.blueprint}hasBluePrint(){return void 0!==this.blueprint}isEqualTo(e){return this===e}isDeferred(){return this.getDicWrapper().isAsyncRefresh()}clearCachedResults(){a.eventBus.dispatch({type:a.EVENT_TYPES.ITEM_POOL_DISCARD_OLD,value:{id:this.getId()}})}async refreshPageData(e){const t={strategy:f.ModelRefreshStrategy.REFRESH},i=_.modelRefreshDecoratorFactory.getDecorator(h.mainApplication.getPageState(),h.mainApplication,y.ModelType.PAGE_STATE,t);try{await b.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&l.logService.error(e,void 0,t)}}}__decorate([d.deprecated("clearPayloadValue"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],F.prototype,"clearPayload",null),t.WidgetWrapper=F,a.eventBus.subscribe(a.EVENT_TYPES.TOGGLE_EDIT_WIDGET,e=>{const t=h.mainApplication.getWidgetById(e.value.id);a.eventBus.dispatch({type:a.EVENT_TYPES.SET_WIDGET_EDIT,value:{id:e.value.id,state:!t.getEditMode()}})}),a.eventBus.subscribe(a.EVENT_TYPES.SET_WIDGET_EDIT,e=>{const t=h.mainApplication.getWidgetById(e.value.id);t&&(t.setEditMode(e.value.state),t.redraw())}),a.eventBus.subscribe(a.EVENT_TYPES.SET_WIDGET_EDIT,e=>{if(!1===e.value.state){const t=h.mainApplication.getWidgetById(e.value.id);!t.isText()&&t.canBeSaved()&&m.CustomPageFactory.getPageFromPageState(t.getPageState()).saveWidget(h.mainApplication.getWidgetById(e.value.id))}})}),define("classes/page_state/history/page_state_history_log",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.PageStateHistoryLog=class{constructor(e=10){this.maxHistorySteps=e,this.pageStates=[],this.currentIndex=-1}canNavigateBack(){return this.currentIndex>0}canNavigateForward(){return this.currentIndex<this.pageStates.length-1}navigateBack(){if(this.canNavigateBack())return this.pageStates[--this.currentIndex]}navigateForward(){if(this.currentIndex<this.pageStates.length)return this.pageStates[++this.currentIndex]}addStep(e){this.pageStates.push(e.toProto()),this.currentIndex++,this.enforceMaxHistorySize()}enforceMaxHistorySize(){if(this.pageStates.length>this.maxHistorySteps){const e=this.pageStates.length-this.maxHistorySteps;this.pageStates=this.pageStates.slice(e),this.currentIndex-=e}}}}),define("classes/application/settings/application_widget_settings",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/application/abstract_application",["require","exports","event_bus","flux","log","reusable_utilities","services/broker","services/tw_common","classes/page_state/history/page_state_history_log"],function(e,t,i,n,s,o,r,a,c){var l,d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NOT_INITIALIZED=0]="NOT_INITIALIZED",e[e.LOADING=1]="LOADING",e[e.IDLE=2]="IDLE",e[e.FATAL_ERROR=3]="FATAL_ERROR"}(l=t.ApplicationState||(t.ApplicationState={})),function(e){e[e.MAIN=0]="MAIN",e[e.BUBBLE=1]="BUBBLE",e[e.SINGLE_PAGE_BUBBLE=2]="SINGLE_PAGE_BUBBLE",e[e.MOCK=3]="MOCK"}(d=t.ApplicationType||(t.ApplicationType={}));t.AbstractApplication=class{constructor(e){this.widgetSettings={displayFullSizeWidget:!1,forbiddenWidgetActions:[]},this.pageStateHistoryLog=new c.PageStateHistoryLog,e&&e.childApps.push(this),this.disposeToken=new o.CancellationToken,this.disposeToken.addCleanupFunction(()=>{void 0!==e&&e.removeSubApplication(this)}),this.pageState=void 0,this.childApps=[],this.state=l.NOT_INITIALIZED}getType(){return this.type}isMainApplication(){return this.getType()===d.MAIN}injectPageState(e,t=!1,i=!1){const n=e.getAllowedPages().getReload();e.setApplication(this),t?this.mergePageState(e,i):(this.hasPageState()&&(this.pageState===e?s.logService.error("Page state wrappers are equal !"):this.pageState.dispose()),this.pageState=e,!this.pageState.isSkeleton()&&this.pageState.hasUserFilterSettings()&&this.pageState.getUserFilterSettings().checkFiltersChanged()),this.pageState.getAllowedPages().setReload(!1),this.state=l.IDLE,this.handlePageStateInjectDispatches(n)}removePageState(){void 0!==this.pageState&&(this.pageState.dispose(),this.pageState=void 0,i.eventBus.dispatch({type:i.EVENT_TYPES.CANCEL_ALL_REFRESH_JOBS,value:void 0}))}getPageStateHistoryLog(){return this.pageStateHistoryLog}getWidgetSettings(){return this.widgetSettings}navigateTo(e){this.pageStateHistoryLog.addStep(e),this.injectPageState(e)}addSubApplication(e){this.childApps.push(e)}removeSubApplication(e){this.childApps.splice(this.childApps.indexOf(e),1)}getSubApplications(){return this.childApps}hasPageState(){return void 0!==this.pageState}getPageState(){return this.pageState}getWidgetById(e){let t;for(const i of this.getPageStates())if(void 0!==(t=i.getWidgets().find(t=>t.getId()===e)))break;return t}getPageStates(){const e=[this.pageState];return this.childApps.forEach(t=>{t.hasPageState()&&e.push(...t.getPageStates())}),e}isLoading(){return this.state===l.LOADING}isIdle(){return this.state===l.IDLE}setState(e){this.state=e}getState(){return this.state}dispose(){this.childApps.forEach(e=>e.dispose()),void 0!==this.pageState&&this.pageState.dispose(),this.disposeToken.cancel()}mergePageState(e,t){this.pageState.merge(e,t)}handlePageStateInjectDispatches(e){try{this.pageState.isComplete()?(n.dispatcher.dispatch("global_onPageStateReceived",{id:this.pageState.getId()}),i.eventBus.dispatch({type:i.EVENT_TYPES.PAGESTATE_REFRESH,value:{pagestate:this.pageState,isLoadMore:!e}}),r.brokerService.publish(constants.events.page_state.received,[this.pageState,e])):n.dispatcher.dispatch("global_onPartialPageStateRefresh",{id:this.pageState.getId()})}catch(e){s.logService.error(e,a.twCommon.logFeatures.Application)}try{r.brokerService.publish("MASTER.REFRESH")}catch(e){s.logService.error(e,a.twCommon.logFeatures.Application)}}}}),define("wrappers/branding/branding_wrapper",["require","exports","log","underscore","services/tw_common"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t=!1){this._branding=e,t||this.validate()}toProto(){return this._branding}getColor(){return this._branding.hex_color}getProductName(){return this._branding.product_name}merge(e){this._branding=e._branding}validate(){i.logService.assert(void 0!==this._branding.product_name,"Branding product name is required",s.twCommon.logFeatures.PageState)}}t.BrandingWrapper=o,t.default=n.constant(o)}),define("wrappers/project/project_wrapper",["require","exports","log","underscore","services/tw_common","wrappers/branding/branding_wrapper"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this._project=e,this._project.branding&&(this._brandingWrapper=new o.BrandingWrapper(this._project.branding,t)),t||this.validate()}toProto(){return this._project}merge(e){this.setLastUpdate(e.getLastUpdate())}getName(){return this._project.main_project_title}setId(e){this._project.main_project_id=e}getId(){return this._project.main_project_id}setLastUpdate(e){this._project.last_update=e}getLastUpdate(){return this._project.last_update}getBranding(){return this._brandingWrapper}validate(){i.logService.assert(void 0!==this._project.branding,"Project branding is required",s.twCommon.logFeatures.Project)}}t.ProjectWrapper=r,t.default=n.constant(r)}),define("wrappers/page_state/page_state_wrapper",["require","exports","common_constants","event_bus","log","notifications","reusable_services","underscore","widget_base","classes/context_data/context_data","other/tw","services/configuration","services/rest_form_service","services/tw_common","services/widgets/widget_factory","wrappers/abstract_wrapper","wrappers/allowed_pages/allowed_pages_wrapper","wrappers/project/project_wrapper","wrappers/section/section_wrapper","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0});class b extends m.AbstractWrapper{constructor(e,t,i=!1){super("PAGE_STATE_WRAPPER"),this.PageWrapper=d.tw.inject("PageWrapper"),s.logService.assert(void 0!==e,"pagestateProto is required",p.twCommon.logFeatures.PageState),s.logService.trace("Creating page state "+this.uuid,p.twCommon.logFeatures.PageState),this.incomplete=i,this.application=t,this.offline=!1,this.pageState=e,this._preProcess(),void 0===this.getId()&&(i=!0),this.widgetWrappers=[],this.sectionWrappers=[],this.editingLayout=!1,this.retryCount=0,this.lastMergeTs=Date.now(),e.project&&(this.projectWrapper=new f.ProjectWrapper(e.project,i)),e.allowed_pages&&(this.allowedPagesWrapper=new _.AllowedPagesWrapper(e.allowed_pages,i)),this.pageState.breadcrumb&&(this.breadcrumbWrapper=new v.TopicMenuWrapper(e.breadcrumb)),this.pageState.user_filter_settings&&(this.userFilterSettingsWrapper=new S.UserFilterSettingsWrapper(e.user_filter_settings,this,p.twCommon.holderTypes.PAGE,i)),(this.pageState.data_input_configuration||[]).forEach(e=>{this.widgetWrappers.push(h.widgetFactory.wrapWidget(e,this))}),(this.pageState.page_section||[]).forEach(e=>{this.sectionWrappers.push(new y.SectionWrapper(e,12,this))}),this._recalculatePages(),this.checkFontPresences(),this.hasPageConfiguration()&&(this.getPageConfiguration().pages=this.getPageConfiguration().pages||[]),i||this._validate()}setNoCache(){this.pageState.not_cached=!0,this.queryAllWidgets(e=>{e.isDataLoaded()&&(e.setNotCachedFlag(!0),e.setConfigurationChanged(!0))})}isDrilldownDisabled(){return this.hasPageSettings()&&this.getPageSettings().disable_drilldown}canCreateIssueWatchItem(){return this.hasPageSettings()&&void 0!==this.getPageSettings().create_issue_watch_item}hasPageSettings(){return void 0!==this.pageState.page_settings}getPageSettings(){return this.pageState.page_settings}setExportWholePageStateFlag(e){this.pageState.export_whole_page=e}setOffline(e){this.offline=e}isOffline(){return this.offline}isComplete(){return!this.incomplete}dispose(){super.dispose(),this.widgetWrappers.forEach(e=>{e.dispose()}),this.sectionWrappers.forEach(e=>{e.dispose()}),a.isUndefined(this.userFilterSettingsWrapper)||this.userFilterSettingsWrapper.dispose(),this.pageState=void 0,this.widgetWrappers=void 0,this.sectionWrappers=void 0,this.pageWrappers=void 0,this.projectWrapper=void 0,this.allowedPagesWrapper=void 0,void 0!==this.breadcrumbWrapper&&(this.breadcrumbWrapper.dispose(),this.breadcrumbWrapper=void 0),this.userFilterSettingsWrapper=void 0,this.application=void 0}toProto(){const e=this.pageState;return e.data_input_configuration=[],this.widgetWrappers.forEach(t=>{e.data_input_configuration.push(t.toProto())}),e.page_section=[],this.sectionWrappers.forEach(t=>{e.page_section.push(t.toProto())}),this.userFilterSettingsWrapper&&(e.user_filter_settings=this.userFilterSettingsWrapper.toProto()),this.allowedPagesWrapper&&(e.allowed_pages=this.allowedPagesWrapper.toProto()),this.breadcrumbWrapper&&(e.breadcrumb=this.breadcrumbWrapper.toProto()),e}setSkeleton(e){this._isSkeleton=e}isSkeleton(){return!!this._isSkeleton}getApplication(){return this.application}setApplication(e){this.application=e}_preProcess(){void 0===this.pageState.error_message&&(this.pageState.error_message={})}getMinimumPages(){return g.configurationService.getPageConfiguration().getMinimumPages(this.getOutputType())}getOutputType(){let e="HTML";return this.hasUserFilterSettings()&&this.userFilterSettingsWrapper.hasTopicMenuByType(constants.topic_menu.TYPE.report_output_type)&&(e=this.userFilterSettingsWrapper.getTopicMenuByType(constants.topic_menu.TYPE.report_output_type).getRootEntry().getFirstSelectedEntry().getMappedId()),e}getTs(){return this.pageState.ts}getCustomPageLastUpdateTs(){return this.pageState.custom_page_last_update_ts}hasCustomPageLastUpdateTs(){return void 0!==this.getCustomPageLastUpdateTs}getSectionsPerPage(){return g.configurationService.getPageConfiguration().getSectionsPerPage(this.getOutputType())}getTimezone(){return this.pageState.timezone}getAllowedPages(){return this.allowedPagesWrapper}hasAllowedPages(){return void 0!==this.allowedPagesWrapper}setAllowedPages(e){this.allowedPagesWrapper=e}copyAndPrune(e){const t=this.cloneNoWidgets(),i=this.getWidgetsByPredicate(e=>e.isReloading()||e.hasConfigurationChanged());return t.widgetWrappers=i.map(e=>e.clone()),t.widgetWrappers.forEach(e=>e._setPageState(t)),t.prune(e),t}setOutputType(e){this.pageState.output_type=e}cloneNoWidgets(){const e=this.toProto(),t=e.data_input_configuration;e.data_input_configuration=[];const i=new b(JSON.parse(JSON.stringify(e)),this.getApplication());return e.data_input_configuration=t,i}cloneWithOnlySpecificWidgets(e){const t=this.cloneNoWidgets();return e.forEach(e=>t.widgetWrappers.push(this.getWidgetById(e).clone())),t.widgetWrappers.forEach(e=>e._setPageState(t)),t}clone(){const e=new b(JSON.parse(JSON.stringify(this.toProto())),this.getApplication());e.setSkeleton(this.isSkeleton());const t=this.getWidgets().map(e=>e.clone());return e._setWidgets(t),e}prune(e,t){if(this.getUserFilterSettings().prune(),!t){const e=this.getWidgetsByPredicate(e=>e.isReloading()||e.hasConfigurationChanged());this._setWidgets(e)}e&&a.invoke(this.widgetWrappers,"prune",!0,!1)}getWidgetsBySection(e){return this.getWidgetsByPredicate(t=>t.getSectionId()===e.getId())}getPages(){return this.pageWrappers}setShareMode(e,t){this.pageState.sharing=e?constants.sharing.element:void 0,this.pageState.exportr=e,this.pageState.output_type=t}setExportMode(e,t,i){this.widgetWrappers.forEach(e=>e.hasExtendedConfiguration()?e.getExtendedConfiguration().setSkipDataLoading(!1):void 0),this.pageState.exportr=e,this.pageState.export_whole_page=t,this.pageState.output_type=i}getLastPage(){return this.pageWrappers[this.pageWrappers.length-1]}_recalculatePages(){const e=[];if(this.pageWrappers=[],!this.hasAllowedPages()||!(this.getAllowedPages().isDashboard()||this.getAllowedPages().isReport()&&!this.isGridPage()))return;let t=new this.PageWrapper(this.getSectionsPerPage());this.pageWrappers.push(t),(this.sectionWrappers||[]).forEach(i=>{-1!==i.getId()&&(i.removePage(),(t.isFull()||i.isPageBreakSection()&&!t.isEmpty())&&(i.isPageBreakSection()?e.push("Pagebreak widget"):e.push("Page full, splitting automatically (this may be a sign of page state corruption)"),t=new this.PageWrapper(this.getSectionsPerPage()),this.pageWrappers.push(t)),t.addSection(i))})}debugPrintFlags(){console.log("Allowed pages reload:"+this.getAllowedPages().getReload())}debugPrintWidgetIDs(){this.getWidgets().forEach(e=>{console.log(e.getId())})}merge(e,t){const i=s.logService.startTimer(p.twCommon.logFeatures.PageState);if(n.eventBus.dispatch({type:n.EVENT_TYPES.PAGE_STATE_BEFORE_MERGE,value:{currentPageState:this,newPageState:e}}),this.setSkeleton(e.isSkeleton()),this.pageState.custom_page_last_update_ts=e.getCustomPageLastUpdateTs(),this.pageState.screen_configuration=e.getScreenConfiguration(),this.pageState.page_configuration=e.getPageConfiguration(),this.pageState.not_cached=!1,e.getAllowedPages().getReload()){e.hasUserFilterSettings()&&this.userFilterSettingsWrapper.merge(e.getUserFilterSettings()),this.allowedPagesWrapper.merge(e.getAllowedPages()),this._setId(e.getId()),this.setEditMode(e.isEditMode()),this.projectWrapper.merge(e.getProject()),e.hasBreadCrumb()?this._setBreadCrumb(e.getBreadCrumb()):(delete this.pageState.breadcrumb,this.breadcrumbWrapper=void 0),this._mergeSections(e.getSections(),e),this._setUuidConfPage(e.getUuidConfPage());const t=this._mergeWidgets(e.getWidgets(),e);this.insertTransitionalWidgets(t)}else this.updateWidgets(e.getWidgets(),t),e._setWidgets([]);a.invoke(this.getWidgets(),"clearLoadingState"),this._setErrorMessageCode(e.getErrorMessageCode()),this.getUserFilterSettings().clearLoadingState(),this._recalculatePages(),s.logService.endTimer(i,250,"Page state merge took too long"),this.lastMergeTs=Date.now()}getLastMergeTs(){return this.lastMergeTs}navigate(e=!1){const t=$.Deferred(),n=this.clone();n.prune(!1);let s="navigate";e&&(n.setAllowedPages(d.tw.pageState.getAllowedPages()),s="move");const r={page_state:n.toProto()},a=routes.controllers.tw.TWRestForm.get(i.source_context.project,window.tw.project_id,"page_state",s,"","rform").url;return u.restFormService.post(a,r).then(e=>{t.resolve(e)},e=>{o.notificationService.display(e.notification),t.reject(e)}),t.promise()}_mergeSections(e,t){if(s.logService.assert(void 0!==e,"sections is required",p.twCommon.logFeatures.PageState),0===e.length)return void this.clearSections();const i=[];for(let n=e.length-1;n>=0;n--){const s=this.getSectionById(e[n].getId());void 0!==s?(s.merge(e[n]),i.push(s)):(e[n]._setPageState(this),i.push(e[n]),t.sectionWrappers.splice(n,1))}i.reverse(),this._setSections(i)}updateWidgets(e,t){for(let i=0;i<e.length;i++){const n=this.getWidgetById(e[i].getId());if(void 0!==n){const s=n.getDic().payload.type;if(s===e[i].getDic().payload.type||s!==dataTypeConf[constants.data_type.datatable].payload_type&&e[i].getDic().payload.type!==dataTypeConf[constants.data_type.datatable].payload_type)n.merge(e[i],t),n.hasSection()&&n.getSection().setDataLoaded(!0);else{const t=this.getWidgets();t[a.indexOf(t,n)]=e[i],n.dispose()}}}}canTransition(e,t){return!t.isSkeleton()&&(!e.isEmptyWidget()&&!t.isEmptyWidget()&&e.hasBluePrint()&&void 0!==e.blueprint.transitionOnNewData&&e.blueprint.transitionOnNewData!==c.WidgetTransitionType.NONE)}_mergeWidgets(e,t){const i=[],n=s.logService.startTimer(p.twCommon.logFeatures.PageState);if(s.logService.assert(void 0!==e,"widgets is required",p.twCommon.logFeatures.PageState),0===e.length)return this.clearWidgets(),i;const o=[];for(let n=e.length-1;n>=0;n--){const s=this.getWidgetById(e[n].getId());void 0!==s&&s.getType()===e[n].getType()?(this.canTransition(s,e[n])?i.push(e[n]):s.merge(e[n],!1),o.push(s)):(e[n]._setPageState(this),o.push(e[n]),t.widgetWrappers.splice(n,1))}const r=this.getWidgets();return o.reverse(),this._setWidgets(o),r.forEach(e=>{const t=this.getWidgetById(e.getId());a.isUndefined(t)&&e.dispose()}),s.logService.endTimer(n,100,"widget merge took too long"),i}getNumberOfSectionsToLoad(){return this.pageState.number_section_to_load}getLastContentSection(){if(0===this.getSections().length)return;let e;for(let t=0;t<this.getSections().length;t++)this.getSections()[t].isContent()&&(e=this.getSections()[t]);return e}getWidgetById(e){return this.getFirstWidgetByPredicate(t=>t.getId()===e)}getFirstWidgetByPredicate(e){for(let t=0;t<this.getWidgets().length;t++)if(!0===e(this.getWidgets()[t]))return this.getWidgets()[t]}getSectionByWidgetId(e){return this.getFirstSectionByPredicate(t=>t.hasWidget(e))}getSectionById(e){return this.getFirstSectionByPredicate(t=>t.getId()===e)}getFirstSectionByPredicate(e){for(let t=0;t<this.getSections().length;t++)if(!0===e(this.getSections()[t]))return this.getSections()[t]}isLayoutBeingEdited(){return this.editingLayout}beginEditingPageLayout(){s.logService.assert(!1===this.editingLayout,"page is already being edited",p.twCommon.logFeatures.PageState),this.editingLayout=!0}endEditingPageLayout(){s.logService.assert(!0===this.editingLayout,"page wasn't being edited",p.twCommon.logFeatures.PageState);const e=$.Deferred();return this._endEditingPage(e)}_endEditingPage(e){for(let t=0;t<this.pageWrappers.length;t++)if(this.pageWrappers[t].isOverflowing())return this.handlePageOverflow(this.pageWrappers[t],e);return g.configurationService.getPageConfiguration().canSave()?this.savePage(e):(this.editingLayout=!1,e.resolve(),e.promise())}insertSectionBelow(e,t,i){s.logService.assert(!0===this.editingLayout,"must call beginEditingPageLayout() before you can edit the page layout",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==e,"sourceSection is required",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==e.getPage(),"sourceSection has no page",p.twCommon.logFeatures.PageState);const n=a.indexOf(this.getSections(),e);return s.logService.assert(-1!==n,"source section is not part of this page state",p.twCommon.logFeatures.PageState),void 0===i&&(i=e.getPage()),void 0===t&&(t=this._createSection(!0)),s.logService.assert(!e.isPageBreakSection()||!t.isPageBreakSection(),"can't have 2 consecutive page breaks",p.twCommon.logFeatures.PageState),i!==e.getPage()?i.prependSection(t):(i=e.getPage()).insertSectionBelow(e,t),this.sectionWrappers.splice(n+1,0,t),t}insertSectionAbove(e,t,i){s.logService.assert(!0===this.editingLayout,"must call beginEditingPageLayout() before you can edit the page layout",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==e,"sourceSection is required",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==e.getPage(),"sourceSection has no page",p.twCommon.logFeatures.PageState);const n=a.indexOf(this.getSections(),e);return s.logService.assert(-1!==n,"source section is not part of this page state",p.twCommon.logFeatures.PageState),void 0===i&&(i=e.getPage()),void 0===t&&(t=this._createSection(!0)),s.logService.assert(!e.isPageBreakSection()||!t.isPageBreakSection(),"can't have 2 consecutive page breaks",p.twCommon.logFeatures.PageState),i!==e.getPage()?i.addSection(t):(i=e.getPage()).insertSectionAbove(e,t),this.sectionWrappers.splice(n,0,t),t}swapWidgets(e,t){const i=a.indexOf(this.getWidgets(),e),n=a.indexOf(this.getWidgets(),t),s=this.getWidgets()[i];this.getWidgets()[i]=this.getWidgets()[n],this.getWidgets()[n]=s}deleteAllWidgets(){this.widgetWrappers=[]}getOnScreenSections(e){const t=this.getSections().slice(e);if(0===t.length)return[];let i,n=t[0].getSectionsPerScreen();for(i=0;i<t.length&&(t[i].isTextWidgetSection()||!((n-=t[i].getHeight())<=0));i++);return t.slice(0,i+1)}deleteWidget(e,t=!1){e.hasSlotConfiguration()&&n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_REMOVE_SUB_ITEM,value:{gridId:e.getSlotConfiguration().page||"grid",itemId:e.getId()}});const i=a.indexOf(this.widgetWrappers,e);if(s.logService.assert(-1!==i,"widget not found",p.twCommon.logFeatures.PageState),this.widgetWrappers.splice(i,1),t){const t={id:e.getId(),custom_page_id:this.allowedPagesWrapper.getCustomPageId(),custom_page_type:this.allowedPagesWrapper.getGroupPage()},i=this.allowedPagesWrapper.getGroupPage()===constants.custom_page.type.report?"custom_page_widget_reports":"custom_page_widget_dashboards",n=this.allowedPagesWrapper.isDashboard()?this.allowedPagesWrapper.getCustomPageId():"";u.restFormService.post(routes.controllers.tw.TWRestForm.post("project",this.projectWrapper.getId(),i,"remove",n,"rform").url,t)}}deletePage(e){const t=a.indexOf(this.pageWrappers,e);s.logService.assert(-1!==t,"page not found",p.twCommon.logFeatures.PageState),e.setDeleting(!0);const i=[];for(let t=e.getSections().length-1;t>=0;t--)e.getSections()[t].canBeDeleted()?this.deleteSection(e.getSections()[t],!0):i.push(e.getSections()[t]);let n;t<this.pageWrappers.length-1?(n=this.pageWrappers[t+1],a.each(i,function(e){n.prependSection(e)})):(n=this.pageWrappers[t-1],a.each(i,function(e){n.addSection(e)})),this.pageWrappers.splice(t,1)}deleteSection(e,t=!1,i=!0){s.logService.trace("Delete section",p.twCommon.logFeatures.PageState,e);const n=a.indexOf(this.getSections(),e);if(s.logService.assert(-1!==n,"section not found",p.twCommon.logFeatures.PageState),t)for(let t=0;t<e.getWidgets().length;t++)this.deleteWidget(e.getWidgets()[t],i);if(this.sectionWrappers.splice(n,1),e.hasPage()){const t=e.getPage();t.removeSection(e),t.isEmpty()&&!t.isDeleting()&&this.pageWrappers.length>this.getMinimumPages()&&this.deletePage(t)}}_sortWidgets(){const e=[];this.getSections().forEach(t=>{t.getWidgets().forEach(t=>{e.push(t)})}),this.widgetWrappers=e}insertPageAfter(e,t){this.pageWrappers.splice(a.indexOf(this.pageWrappers,t)+1,0,e)}handlePageOverflow(e,t){s.logService.assert(!0===this.editingLayout,"invalid state: page isn't being edited",p.twCommon.logFeatures.PageState);const i=new this.PageWrapper(this.getSectionsPerPage()),n=e.getLastContentSection();e.removeSection(n),i.addSection(n),this.insertPageAfter(i,e);const o={custom_page_id:this.allowedPagesWrapper.getCustomPageId(),page_state:{allowed_pages:this.allowedPagesWrapper.toProto()}};return u.restFormService.post(routes.controllers.tw.TWRestForm.post("project",this.projectWrapper.getId(),"custom_page_widget_reports","create","","rform").url,o).then(e=>{const o=i.getLastContentSection();s.logService.assert(void 0!==n,"new page is empty",p.twCommon.logFeatures.PageState),s.logService.assert(o.getPage()===i,"state corruption: section has no reference to it's page",p.twCommon.logFeatures.PageState);for(let n=e.dics.length-1;n>=0;n--){const r=e.dics[n],a=this._createSection(!1);a.setSortable(!1),a.addWidget(h.widgetFactory.wrapWidget(r,this)),s.logService.assert(a.isPageBreakSection(),"unexpected error: returned widget is not page break",p.twCommon.logFeatures.PageState),this.insertSectionAbove(o,a,i),this._sortWidgets(),this._endEditingPage(t)}}),t.promise()}_createSection(e){return new y.SectionWrapper({children_orderable:!!e,data_loaded:!0,hidden:!1},g.configurationService.getPageConfiguration().getSectionWidth(),this)}getTrimmedOrderedSavableDicList(){const e=[],t=this;for(const i of this.getSections())for(const n of i.getWidgets())if(n.canBeSaved()&&e.push(t.trimDicForSave(n)),n.isSkeleton())return e;return e}trimDicForSave(e){return{widget_id:e.getId(),width:e.getWidth(),section_id:e.getSectionId()}}_verifySave(e){let t;for(t=1;t<e.dics.length;t++)if(this.getWidgetById(e.dics[t-1].widget_id).isPageBreak()&&this.getWidgetById(e.dics[t].widget_id).isPageBreak())return s.logService.error("Invalid save: 2 consecutive page breaks",p.twCommon.logFeatures.PageState,{widgets:[e.dics[t-1],e.dics[t]],request:e}),!1;for(t=0;t<this.getPages().length;t++)if(this.getPages()[t].isOverflowing())return s.logService.error("Invalid save: page overflowing",p.twCommon.logFeatures.PageState,{page:this.getPages()[t],request:e}),!1;for(t=0;t<this.getSections().length;t++)if(this.getSections()[t].getRemainingWidth()<0)return s.logService.error("Invalid save: section overflowing",p.twCommon.logFeatures.PageState,{section:this.getSections()[t],request:e}),!1;return!0}savePage(e){if(void 0===e&&(e=$.Deferred()),s.logService.assert(!0===this.editingLayout,"can't save a page that wasn't modified",p.twCommon.logFeatures.PageState),g.configurationService.getPageConfiguration().canSave()){const t={dics:this.getTrimmedOrderedSavableDicList(),custom_page_id:this.allowedPagesWrapper.getCustomPageId(),custom_page_type:constants.custom_page.type.report};if(!this._verifySave(t))return this.retryCount<5?(this.retryCount++,s.logService.warn("Invalid save request detected, retrying... "+this.retryCount,p.twCommon.logFeatures.PageState),setTimeout(this.savePage.bind(this),1e3)):(s.logService.error("Failed to save custom page",p.twCommon.logFeatures.PageState),o.notificationService.error("Something went wrong, please refresh the page",{permanent:!0})),e.reject("Failed to save custom page"),e.promise();this.retryCount=0;const i=this.allowedPagesWrapper.isDashboard()?"custom_page_widget_dashboards":"custom_page_widget_reports",n=this.allowedPagesWrapper.isDashboard()?this.allowedPagesWrapper.getCustomPageId():"";u.restFormService.post(routes.controllers.tw.TWRestForm.post("project",this.projectWrapper.getId(),i,"save",n,"rform").url,t).then(t=>{this.editingLayout=!1,e.resolve()})}else s.logService.trace("Save page called on page that cannot be saved",p.twCommon.logFeatures.PageState,this),this.editingLayout=!1,e.reject("Save page called on page that cannot be saved");return e.promise()}hasErrorMessage(){return void 0!==this.pageState.error_message.code}getErrorMessage(){return this.pageState.error_message}getErrorMessageCode(){return this.pageState.error_message.code}_setErrorMessageCode(e){this.pageState.error_message.code=e}getUuidConfPage(){return this.pageState.uuid_conf_page}_setUuidConfPage(e){this.pageState.uuid_conf_page=e}getBreadCrumb(){return this.breadcrumbWrapper}hasBreadCrumb(){return void 0!==this.breadcrumbWrapper}_setBreadCrumb(e){this.pageState.breadcrumb=e.toProto(),this.breadcrumbWrapper=e}_setId(e){this.pageState.id=e}clearSections(){delete this.pageState.page_section,this.sectionWrappers=[]}clearWidgets(e=!1){e&&this.widgetWrappers.forEach(e=>e.dispose()),delete this.pageState.data_input_configuration,this.widgetWrappers.length=0}clearWidgetsByPredicate(e){this.widgetWrappers=this.widgetWrappers.filter(t=>!e(t)),this.pageState.data_input_configuration=this.widgetWrappers.map(e=>e.toProto())}getUserFilterSettings(){return this.userFilterSettingsWrapper}hasUserFilterSettings(){return void 0!==this.userFilterSettingsWrapper}replaceUserFilterSettings(e){this.userFilterSettingsWrapper=e}hasId(){return void 0!==this.getId()}getParentId(){return this.pageState.parent_id}getId(){return this.pageState.id}hasProject(){return void 0!==this.projectWrapper}getProject(){return this.projectWrapper}toggleEditMode(){this.setEditMode(!this.isEditMode())}setEditMode(e){this.pageState.edit_mode!==e&&(this.pageState.edit_mode=e)}isEditMode(){return this.pageState.edit_mode||!1}clearWidgetLoadingState(){this.queryAllWidgets(e=>{e.clearLoadingState()})}queryAllWidgets(e){this.widgetWrappers.forEach(t=>{e(t)})}queryAllSections(e){this.sectionWrappers.forEach(t=>{e(t)})}getLanguage(){return this.pageState.language}getWidgets(){return this.widgetWrappers}getSelectedWidgets(){return this.getWidgetsByPredicate(e=>e.isSelected())}getSectionsByPredicate(e){const t=[];return this.getSections().forEach(i=>{!0===e(i)&&t.push(i)}),t}getWidgetsByPredicate(e,t){const i=[];return this.getWidgets().forEach(n=>{!0===e.call(t||this,n)&&i.push(n)}),i}getSharedSections(){return this.getSections().filter(e=>e.isShared())}getSections(){return this.sectionWrappers}getPageStateType(){return this.pageState.page_state_type}hasScreenConfiguration(){return void 0!==this.getScreenConfiguration()}getScreenConfiguration(){return this.pageState.screen_configuration}hasPageConfiguration(){return void 0!==this.getPageConfiguration()}getPageConfiguration(){return this.pageState.page_configuration}isGridPage(){return this.hasPageConfiguration()&&void 0!==this.getPageConfiguration().grid}isWholePageExport(){return!0===this.pageState.export_whole_page}_setWidgets(e){e.forEach(e=>e._setPageState(this)),this.widgetWrappers=e}_setSections(e){this.sectionWrappers=e}_validate(){s.logService.assert(void 0!==this.pageState.allowed_pages,"Page state allowed_pages is required",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==this.pageState.edit_mode,"Page state edit_mode is required",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==this.pageState.project,"Page state project is required",p.twCommon.logFeatures.PageState),s.logService.assert(void 0!==this.pageState.timezone,"timezone is missing",p.twCommon.logFeatures.PageState)}insertTransitionalWidgets(e){e.forEach(e=>{this.getWidgetById(e.getId()).setTransitionWidget(e),e.getPageState().deleteWidget(e,!1),e._setPageState(this)})}checkFontPresences(){this.hasPageConfiguration()&&this.getPageConfiguration().pages&&this.getPageConfiguration().pages.forEach(e=>{e.slide_metadata&&e.slide_metadata.font_family_menu&&e.slide_metadata.font_family_menu.root_entry.children.forEach(e=>{r.fontDetectionService.detect(e.name)||(e.name=e.name+" ⚠",e.description=l.contextData.getMessage("_1489479"))})})}areAllWidgetsDeferred(){return this.widgetWrappers.length>0&&this.widgetWrappers.every(e=>e.isDeferred())}getStyleSheet(){return this.pageState.stylesheet}getBanner(){return this.pageState.banner}hasBanner(){return void 0!==this.getBanner()}}t.PageStateWrapper=b,t.default=a.constant(b)}),define("other/tw",["require","exports","classes/application/application"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.tw={},window.tw?t.tw=window.tw:window.tw=t.tw,t.tw.hasOwnProperty("pageState")||Object.defineProperty(t.tw,"pageState",{get:()=>i.mainApplication.getPageState()})}),define("wrappers/topic_menu/topic_menu_wrapper",["require","exports","common_constants","components/tools/data_graph","log","reusable_utilities","underscore","other/tw","services/broker","services/configuration","services/pin","services/tw_common","wrappers/abstract_wrapper","wrappers/topic_menu/topic_entry_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});class h extends u.AbstractWrapper{constructor(e,t,i){super("TOPIC_MENU_WRAPPER"),this.topicMenu=e,void 0===this.topicMenu.ts&&(this.topicMenu.ts=(new Date).getTime()),this.joinedMenuTypes=void 0,this.validate(),this.associatedUserFilterSettingsWrapper=i,this.initializeSelectionStrategyMap(),this.hasRootEntry()&&l.configurationService.getTopicMenuConfiguration().canTrimInvisible(this.getType())&&this.trimInvisible(),this._discoverSelectionStrategy()}publishSelection(){c.brokerService.publish(constants.events.filters.selected)}dispose(){u.AbstractWrapper.prototype.dispose.call(this),this.topicMenu=void 0,this.associatedUserFilterSettingsWrapper=void 0}toProto(){return this.hasRootEntry()&&(this.topicMenu.root_entry=this.getRootEntry().toProto()),this.topicMenu}toModel(){const e=r.omit(this.topicMenu,["root_entry"]);return this.hasRootEntry()&&(e.root_entry=this.getRootEntry().toModel()),e}_discoverSelectionStrategy(){const e=this.getRootEntry();if(!e)return;const t=e.getTopicEntry();e.getChildren().forEach(e=>e.discoverSelectionStrategy()),this.selectionStrategy=t.selection_type?t.selection_type:g.twCommon.selectionStrategies.MULTIPLE,s.logService.verbose(this.getType()+" selection strategy set to "+this.selectionStrategy,g.twCommon.logFeatures.TopicMenu)}hasRootEntry(){return void 0!==this.topicMenu.root_entry}hasAssociatedUserFilterSettings(){return void 0!==this.associatedUserFilterSettingsWrapper}getAssociatedUserFilterSettings(){return this.associatedUserFilterSettingsWrapper}setAssociatedUserFilterSettings(e){this.associatedUserFilterSettingsWrapper=e}queryAllEntries(e){s.logService.assert(void 0!==e,"action is required"),s.logService.assert(r.isFunction(e),"action must be a function"),s.logService.assert(1===e.length,"action must take 1 argument"),e(this.getRootEntry()),this.getRootEntry().getChildren().forEach(t=>{t.queryAllEntries(e)})}recalculateHits(){this.queryAllEntries(e=>{e.setHits(e.getChildren().filter(e=>e.isSelected()).length)})}refreshFilterHits(e){s.logService.assert(void 0!==e,"dataGraph is required"),s.logService.assert(e instanceof n.default,"dataGraph must be DataGraph wrapper"),this.resetFilterHits(),e.getRows().forEach(e=>{const t=e.code;if(void 0!==t){this.getEntriesByMappedId(t).forEach(t=>{const i=parseInt(e.cells[0].value.value);t.setFilterHits(i);let n=t.getParent();for(;n;)n.setFilterHits((n.getFilterHits()||0)+i),n=n.getParent()})}}),this.publishSelection()}merge(e){if(!e.hasRootEntry())return;this.hasRootEntry()||(this.topicMenu.root_entry=e.topicMenu.root_entry,this.rootEntry=e.getRootEntry());const t=new s.LogCluster("Merging menu : "+this.getType(),s.logLevel.VERBOSE,g.twCommon.logFeatures.TopicMenu);t.addObject(this,!0,"toProto"),t.addObject(e,!0,"toProto"),this.topicMenu.pinned=e.topicMenu.pinned,this.topicMenu.filter_behaviour=e.topicMenu.filter_behaviour,!e.isRefreshEntries()&&e.isTrimmed()?this.mergeTrimmed(e):(this.setRootEntry(e.getRootEntry(),t),this.topicMenu.ts=(new Date).getTime(),this.setRefreshEntries(!1),t.addMessage("merging result"),t.addObject(this,!0,"toProto"),t.addObject(e,!0,"toProto")),t.writeLog(),this.getType()!==constants.topic_menu.TYPE.event&&this.setOverride(!this.hasDefaultFilterState(this.associatedUserFilterSettingsWrapper)),this.hasRootEntry()&&l.configurationService.getTopicMenuConfiguration().canTrimInvisible(this.getType())&&this.trimInvisible(),this.invertFilter=e.invertFilter}removeEntry(e){this.getRootEntry().removeEntry(e)}retrieveChildrenOnEntry(e,t){let i=[];if(e.getChildren().forEach(e=>{this.retrieveChildrenOnEntryRecursively(e,i)},this),t){const e=[],t=[];i.forEach(i=>{e.includes(i.getMappedId())||(e.push(i.getMappedId()),t.push(i))}),i=t}return i}retrieveChildrenOnEntryRecursively(e,t){e.getChildren().forEach(e=>{t.push(e),e.hasChildren()&&this.retrieveChildrenOnEntryRecursively(e,t)},this)}trimInvisible(){this.getRootEntry().removeInvisibleChildrenRecursive()}setRootEntry(e,t){void 0===e?this.rootEntry=void 0:this.getRootEntry().merge(e,t)}mergeTrimmed(e){const t=new s.LogCluster("Merging menu : "+this.getType(),s.logLevel.VERBOSE,g.twCommon.logFeatures.TopicMenu);t.addObject(this,!0,"toProto"),t.addObject(e,!0,"toProto"),this.unselectAll(),this.resetFilterHits(),e.getEntriesRecursively().forEach(e=>{if(this.getEntryByMappedId(e.getMappedId())){const t=this.getEntryByMappedId(e.getMappedId());if(e.hasParent()&&e.getParent().getChildren().length===t.getParent().getChildren().length){const i=e.getParent().getChildren().indexOf(e),n=t.getParent().getChildren().indexOf(t),s=t.getParent().getChildren()[i];if(void 0===s)throw new Error("something went wrong with the sorting");t.getParent().getChildren()[i]=t,t.getParent().getChildren()[n]=s}t.setVisibility(e.getVisibility()),t.setFilterHits(e.getFilterHits()),e.isSelected()&&(this.selectEntry(t),e.hasHits()&&t.setHits(e.getHits()))}else{let t=e.getParent();for(;void 0!==t;){const i=this.getEntryByMappedId(t.getMappedId());if(void 0!==e){const t=new p.TopicEntryWrapper(e.toProto(),this,i);t.setFilterHits(e.getFilterHits()),i.addChild(t),i.toProto();break}t=t.getParent(),e=e.getParent()}}},this),this.topicMenu.ts=(new Date).getTime(),this.topicMenu.trimmed=!1,t.addMessage("merging result"),t.addObject(this,!0,"toProto"),t.addObject(e,!0,"toProto"),t.writeLog()}setGrouping(e){this.topicMenu.grouping=!0===e?constants.topic_menu.grouping.grouped:constants.topic_menu.grouping.not_grouped}isGrouped(){return this.topicMenu.grouping===constants.topic_menu.grouping.grouped}isGroupingNotApplied(){return this.topicMenu.grouping===constants.topic_menu.grouping.not_applied}isTrimmed(){return this.topicMenu.trimmed}isMenuGrouped(){return this.topicMenu.grouped}getAllNode(){return 1===this.getRootEntry().getChildrenCount()?this.getRootEntry().getChildren()[0]:void 0}hasAllNode(){return Boolean(1===this.getRootEntry().getChildrenCount()&&!g.twCommon.isPredefinedCategory(this.getRootEntry().getChildren()[0].getMappedId())&&this.getType()!==constants.topic_menu.TYPE.widget_animation)}isOverrideMode(){return void 0!==a.tw.pageState&&a.tw.pageState.getAllowedPages().isDashboardTemplate()&&this.getType()===constants.topic_menu.TYPE.topic_pm_composed||l.configurationService.getPageConfiguration().isFilterOverrideMode()&&this.getType()!==constants.topic_menu.TYPE.topic&&this.getType()!==constants.topic_menu.TYPE.page_monitoring}initializeSelectionStrategyMap(){this.selectionStrategyMap={},this.selectionStrategyMap[g.twCommon.selectionStrategies.MULTIPLE]=this.selectMultiple.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.MULTIPLE_INVERTED]=this.selectMultipleInverted.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.SINGLE]=this.selectSingle.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.SINGLE_AND_MULTIPLE]=this.selectSingleAndMultiple.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.SINGLE_OR_MULTIPLE]=this.selectSingleOrMultiple.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.OPPOSITE]=this.selectOpposite.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.TOPIC_PM_COMPOSED_SELECTION]=this.selectComposed.bind(this),this.selectionStrategyMap[g.twCommon.selectionStrategies.TOPIC_PM_COMPOSED_SELECTION_MIXED]=this._selectComposedMixed.bind(this)}getHeight(){return this.topicMenu.height}setPin(e){this.topicMenu.pinned=e,d.pinService.setPinState(e,this.getPinnedType())}pin(){this.topicMenu.pinned=!this.isPinned(),d.pinService.setPinState(this.isPinned(),this.getPinnedType())}isPinnable(){return l.configurationService.getPageConfiguration().canUserPinFilter(this.getType(),this.associatedUserFilterSettingsWrapper.getPageState())&&this.getPinnedType()!==i.topic_menu.pinned_type.none}isPinned(){return l.configurationService.getPageConfiguration().isPinForced(this.getType())||!0===this.topicMenu.pinned}getPinnedType(){return this.topicMenu.pinned_type}setEntriesSelectionRecursively(e){this.getRootEntry().setSelected(e),this.getRootEntry().setChildrenSelectionRecursively(e)}prune(){if(!this.hasRootEntry())return;this.getRootEntry().prune(!1)||(delete this.topicMenu.root_entry,this.rootEntry=void 0)}trim(){this.hasAllNode()&&(this.isMenuGrouped()?this.getAllNode().getChildren().forEach(e=>{e.getChildren().forEach(e=>{this._removeUnselectedChildren(e)})}):this.getAllNode().getChildren().forEach(e=>{this._removeUnselectedChildren(e)}))}removeTopicEntriesByPredicate(e,t){const i=[];t.getChildren().forEach(t=>{e(t)?i.push(t):this.removeTopicEntriesByPredicate(e,t)}),i.forEach(e=>{t.removeChild(e)})}_removeUnselectedChildren(e){const t=[];e.getChildren().forEach(e=>{e.isSelected()||0!==e.getSelectedChildren().length?e.isSelected()&&e.removeChildren():t.push(e)}),t.forEach(t=>{e.removeChild(t)})}getTopicMenu(){return this.topicMenu}getDefaultMappedId(){return this.topicMenu.default_mapped_id}hasDefaultMappedId(){return void 0!==this.getDefaultMappedId()}isOverriden(){return this.topicMenu.override}setSorting(e){this.topicMenu.sorting=e}forceOverride(e){this.setOverride(e,!0)}setOverride(e,t=!1){this.isOverrideMode()||!0===t?this.topicMenu.override=e:this.topicMenu.override=!1}isInvalidated(){return this.ts!==this.topicMenu.ts}_refresh(){s.logService.verbose(this.getType()+" refreshing",g.twCommon.logFeatures.TopicMenu),this._discoverSelectionStrategy(),this.ts=this.topicMenu.ts}getSelectionStrategy(){return this.isInvalidated()&&this._refresh(),this.selectionStrategy}reset(e){this.resetSelection(e)}hasDefaultFilterState(e){const t=l.configurationService.getTopicMenuConfiguration().getDefaultMappedIdsByType(this,e);return!this.getSelectedEntriesRecursively().some(e=>!t.includes(e.getMappedId())||(t.splice(t.indexOf(e.getMappedId()),1),!1))&&0===t.length}getSelectedEntriesRecursively(){return this.hasRootEntry()?this.getRootEntry().getSelectedEntriesRecursively():[]}getSelectedEntriesLeavesRecursively(){return this.hasRootEntry()?this.getRootEntry().getSelectedEntriesLeavesRecursively():[]}getAllLeavesRecursively(){return this.hasRootEntry()?this.getRootEntry().getAllLeavesRecursively():[]}getEntriesRecursively(){return this.getRootEntry().getEntriesRecursively()}resetSelection(e){if(this.getRootEntry().setSelectionRecursively(!1),this.isOverrideMode()&&e.getHolderType()===g.twCommon.holderTypes.PAGE)this.setOverride(!1),this.hasForceRootSelection()&&!this.containsSelection()&&this.getRootEntry().setSelected(!0);else{l.configurationService.getTopicMenuConfiguration().getDefaultMappedIdsByType(this,e).forEach(e=>{this.selectEntryByMappedId(e)})}this.recalculateHits(),void 0!==this.postSelectionProcessing&&this.postSelectionProcessing(),this.publishSelection()}unselectAll(){this.setEntriesSelectionRecursively(!1)}unselectAllAndSelect(e){this.setEntriesSelectionRecursively(!1),this.selectEntry(e)}unselectAllAndSelectByMappedId(e){this.setEntriesSelectionRecursively(!1),this.selectEntryByMappedId(e)}selectEntryByMappedId(e,t){return s.logService.assert(void 0!==e,"mappedId is required"),this.selectEntry(this.getEntryByMappedId(e,t))}selectEntryByName(e){s.logService.assertDefined(e,g.twCommon.logFeatures.TopicMenu),this.selectEntry(this.getEntryByName(e))}selectFirstSelectableEntry(){const e=this.getFirstSelectableEntry();void 0!==e&&e.setSelected(!0)}selectEntryWithDefaultMappedId(){this.hasDefaultMappedId()&&this.selectEntryByMappedId(this.getDefaultMappedId())}getFirstSelectedEntry(){return this.getRootEntry().getFirstSelectedEntry()}getFirstSelectedEntryRecursively(){return this.getRootEntry().getFirstSelectedEntryRecursively()}getFirstSelectableEntry(){return this.getRootEntry().getChildren().find(e=>e.isVisible()&&!e.isSelected())}getNextEntryByPredicate(e){if(!this.containsSelection())return this.getRootEntry().getChildren().find(e);let t=this.getRootEntry().getChildren().filter(e=>!e.hasChildren());this.getRootEntry().getChildren().filter(e=>e.hasChildren()).forEach(e=>{t=t.concat(e.getChildren())});const i=this.getFirstSelectedEntryRecursively();let n=t.indexOf(i);do{n=n===t.length-1?n-1:n+1}while(!e(t[n]));return t[n]}selectEntry(e,t){return this._selectEntryByStrategy(e,this.getSelectionStrategy(),t)}selectEntryByStrategy(e,t,i){this._selectEntryByStrategy(e,t,i)}_selectEntryByStrategy(e,t,i){let n=!0;const o=new s.LogCluster("Selected Entry : "+e.debugId(!1)+" Topic Menu: "+this.getType(),s.logLevel.VERBOSE,g.twCommon.logFeatures.TopicMenu);o.addNestingLevel("Pre selection state"),this.debugPrint(o),o.removeNestingLevel(),s.logService.assert(void 0!==e,"entry is required"),s.logService.assert(e instanceof p.TopicEntryWrapper,"entry must be topic entry wrapper"),o.addNestingLevel("Selection Phase");const a=e.isParentOrGrandParentSelected();o.addMessage("parent selected:"+a);const c=JSON.parse(JSON.stringify(this.toProto()));if(o.addObjectWithMessage("Undo State:",c,!0),o.addMessage("strategy:"+t),r.isString(t))this.getRootEntry().isSelected()&&e!==this.getRootEntry()&&this.getRootEntry().setSelected(!1),this.selectionStrategyMap[t](e,i,this.getRootEntry(),o);else{const n=t;this.selectionStrategyMap[n.strategy](e,i,n.root,o)}return o.removeNestingLevel(),o.addNestingLevel("Post selection state"),this.debugPrint(o),o.removeNestingLevel(),o.addNestingLevel("Validation Phase"),this.validateSelection(e,o)||this.constraintHack(a,o)?(o.addMessage("Validation successful"),o.removeNestingLevel()):(o.addMessage(this.getType()+" validation failed reverting selection"),o.removeNestingLevel(),o.addNestingLevel("Undo process"),o.addObjectWithMessage("Before:",this.topicMenu.root_entry,!0),this.getRootEntry().merge(new p.TopicEntryWrapper(c.root_entry),o),n=!1,o.addObjectWithMessage("After:",this.topicMenu.root_entry,!0),o.removeNestingLevel()),(this.isFilter()||this.getType()===constants.topic_menu.TYPE.topic_pm_composed)&&this.associatedUserFilterSettingsWrapper&&this.associatedUserFilterSettingsWrapper.checkFiltersChanged(),this.publishSelection(),this.recalculateHits(),o.addNestingLevel("Post validation state"),this.debugPrint(o),o.removeNestingLevel(),o.writeLog(),void 0!==this.postSelectionProcessing&&this.postSelectionProcessing(),n}constraintHack(e,t){const i=this.getSelectionStrategy();return(i===g.twCommon.selectionStrategies.TOPIC_PM_COMPOSED_SELECTION||i===g.twCommon.selectionStrategies.TOPIC_PM_COMPOSED_SELECTION_MIXED)&&e}validateSelection(e,t){if(t.addNestingLevel("validating selection on entry:"+this.getRootEntry().debugId(!1)),!this.getRootEntry()._isSelectionValid(e,t))return!1;const i=this.getRootEntry()._validateSelection(e,t);return t.removeNestingLevel(),i}isFilter(){return l.configurationService.getTopicMenuConfiguration().isFilter(this.getType())}isEvent(){return this.getType()===constants.topic_entry.creation_id.event}isClearableFilter(){return l.configurationService.getTopicMenuConfiguration().isClearableFilter(this.getType())}selectOpposite(e,t,i,n){if(e.toggleSelection(t),e.getMappedId()!==this.getAllNode().getMappedId()){const t=this.getAllNode().getChildrenCount()/2;let i=this.getAllNode().getChildIndex(e);i<t?i+=t:i-=t,this.getAllNode().setSelected(!1),this.getAllNode().getChildren()[i].setSelected(!1)}const s=this.getAssociatedUserFilterSettings();this.containsSelection()||this.isOverrideMode()&&s.getHolderType()!==g.twCommon.holderTypes.WIDGET||this.getAllNode().setSelected(!0)}selectSingle(e,t,i){this.hasLeafSelectionOnly()&&e.hasChildren()?this.processSingleSelectIntermediateNode(e):this.processSingleSelect(e,t,i)}processSingleSelect(e,t,i){const n=e.isSelected();this.unselectAll(),n?this.hasForceRootSelection()&&!this.containsSelection()?this.getRootEntry().setSelected(!0):this.getRootEntry().hasChildrenUnselectAvailable()&&!this.getRootEntry().isChildrenUnselectAvailable()&&e.setSelected(!0):e.toggleSelection(t)}processSingleSelectIntermediateNode(e){this.unselectAll();const t=e.getFirstLeaf();void 0!==t&&t.setSelected(!0)}selectSingleAndMultiple(e,t,i){this.getRootEntry()===e?this.selectRootFirstChildSelectable(t):e.getParent()===this.getRootEntry()?(e.isSelected()||this.unselectAll(),e.toggleSelection(t)):e.getParent().isSelected()?(e.getParent().setSelected(!1),e.getParent().getChildren().forEach(t=>{t!==e&&t.setSelected(!0)})):e.getParent().containsSelection(!0)?(e.toggleSelection(t),e.getParent().containsSelection(!0)?e.getParent().allChildrenSelected()&&(e.getParent().getChildren().forEach(e=>{e.setSelected(!1)}),e.getParent().setSelected(!0)):e.getParent().setSelected(!0)):(this.unselectAll(),e.toggleSelection(t))}selectSingleOrMultiple(e,t,i){e.getParent()===this.getRootEntry()?this.selectSingleOrMultipleSingleLevel(e,t):e.getParent().containsSelection(!0)?this.selectSingleOrMultipleParentHasSelections(e,t):this.selectSingleOrMultipleParentHasNoSelections(e,t)}selectSingleOrMultipleSingleLevel(e,t){0===e.getParent().getSelectedChildren().length?(this.unselectAll(),e.toggleSelection(t)):e.getAssociatedTopicMenu().hasDefaultMappedId()?e.getParent().getChildren().forEach(e=>{e.toggleSelection(t)}):e.isSelected()?e.toggleSelection(t):e.getParent().getChildren().forEach(e=>{e.toggleSelection(t)})}selectSingleOrMultipleParentHasSelections(e,t){e.toggleSelection(t),e.containsSelection(!0)&&e.setChildrenSelectionRecursively(!1),e.getParent().containsSelection(!0)||this.getRootEntry().getChildren().includes(e.getParent())&&!e.getAssociatedTopicMenu().hasDefaultMappedId()?!this.getRootEntry().getChildren().includes(e.getParent())&&e.getParent().allChildrenSelected()&&(e.getParent().getChildren().forEach(e=>{e.setSelected(!1)}),e.getParent().setSelected(!0)):e.getParent().setSelected(!0)}selectSingleOrMultipleParentHasNoSelections(e,t){e.getParent().isSelected()&&e.getParent().setSelected(!1),e.toggleSelection(t),this.getRootEntry().getSelectedChildren().length>0&&this.getRootEntry().getChildren().forEach(e=>{e.setSelected(!1)}),!this.getRootEntry().getChildren().includes(e.getParent())&&e.getParent().allChildrenSelected()&&(e.getParent().getChildren().forEach(e=>{e.setSelected(!1)}),e.getParent().setSelected(!0))}getHashSelectionState(){let e="";return this.queryAllEntries(t=>{t.isSelected()&&(e+=t.getMappedId())}),g.twCommon.hashString(e)}selectMultiple(e,t,i,n){const s=this.getAssociatedUserFilterSettings();e.setChildrenSelectionRecursively(!1),this.unselectPath(e),e.toggleSelection(t),i===this.getRootEntry()&&this.hasAllNode()&&this.getAllNode().getTopicEntry()!==e.getTopicEntry()&&(this.getAllNode().setSelected(!1),this.escalateSelectionIfPossible(e)),this.hasAllNode()&&i===this.getRootEntry()||this.escalateSelectionIfPossible(e),!this.hasAllNode()&&this.getRootEntry().containsSelection(!0)&&i===this.getRootEntry()&&this.getRootEntry().setSelected(!1),(this.isOverrideMode()||i!==this.getRootEntry()||void 0!==s&&s.getHolderType()!==g.twCommon.holderTypes.PAGE)&&(void 0===s||s.getHolderType()!==g.twCommon.holderTypes.WIDGET)||!this.hasAllNode()||this.containsSelection()?this.hasForceRootSelection()&&!this.containsSelection()&&i===this.getRootEntry()&&this.getRootEntry().setSelected(!0):this.getAllNode().setSelected(!0)}selectMultipleInverted(e,t,i,n){this.getRootEntry()===e?this.selectRootFirstChildSelectable(t):this.getRootEntry().isSelected()?(this.getRootEntry().setSelected(!1),this.getRootEntry().getChildren().forEach(t=>{t!==e&&(t!==e.getParent()?t.setSelected(!0):t.getChildren().forEach(t=>{t!==e&&t.setSelected(!0)}))})):e.getParent()===this.getRootEntry()?(e.isSelected()||e.setChildrenSelectionRecursively(!1),e.toggleSelection(t)):e.getParent().isSelected()?(e.getParent().setSelected(!1),e.getParent().getChildren().forEach(t=>{t!==e&&t.setSelected(!0)})):(e.toggleSelection(t),e.getParent().allChildrenSelected()&&(e.getParent().getChildren().forEach(e=>{e.setSelected(!1)}),e.getParent().setSelected(!0)))}isRootEntrySelected(){return this.getRootEntry().getVisibleChildrenCount()>1&&this.getRootEntry().allChildrenSelected()}selectComposed(e,t,i,n){n.addMessage("Select Composed: This means you cannot mix page monitoring types!"),this.getRootEntry().getChildren().forEach(t=>{t.containsEntry(e)||t.setSelectionRecursively(!1)}),this.selectComposedCommon(e,t,n)}_selectComposedMixed(e,t,i,n){n.addMessage("Select Composed Mixed"),this.selectComposedCommon(e,t,n)}selectRootFirstChildSelectable(e){if(this.containsSelection()){const e=this.getFirstSelectableEntry(),t=e.isSelected(),i=this.getSelectionCount();this.unselectAll(),!t||t&&i>1?e.setSelected(!0):t&&1===i&&e.setSelected(!1)}else this.getFirstSelectableEntry().toggleSelection(e)}debugPrint(e){this.getRootEntry().debugPrint(e)}selectComposedCommon(e,t,i){e.setChildrenSelectionRecursively(!1),this.unselectPath(e,!0),e.toggleSelection(t),this.canSimplifySelection(e)&&this.escalateSelectionIfPossible(e)}isButtonMenu(){return this.hasDisplayPosition()&&!this.isDisplayPositionHeader()}getDisplayType(){return this.topicMenu.display_type}getFirstVisibleEntry(){return this.getRootEntry().getChildren().find(e=>e.isVisible())}getLastVisibleEntry(){const e=r.findLastIndex(this.getRootEntry().getChildren(),e=>e.isVisible());return-1!==e?this.getRootEntry().getChildren()[e]:void 0}shouldFetchFromServer(){return!0===this.topicMenu.fetch_content_from_server}canSimplifySelection(e){if(this.hasNoSelectionEscalation())return!1;let t=e.getParent();for(;void 0!==t;){if(t.hasMaxSelection()&&1===t.getMaxSelection())return!1;t=t.getParent()}return!0}unselectPath(e,t=!1){const i=e.getParent();if(s.logService.assert(void 0!==i||e===this.getRootEntry(),"Parent was not set for this topic entry",g.twCommon.logFeatures.TopicMenu,e),void 0!==i&&i!==this.getRootEntry()&&(i!==this.getAllNode()||t)){if(i.isSelected()){i.setSelected(!1);const e=i.getParent();void 0!==e&&e.setHits(e.getHits()-1)}this.unselectPath(i,t)}}escalateSelectionIfPossible(e){if(s.logService.assert(void 0!==e,"entry is required"),this.hasNoSelectionEscalation())return;let t;if((t=e.getParent())&&t.allChildrenSelected()&&t.getChildrenCount()>1&&t!==this.getRootEntry()){t.setChildrenSelectionRecursively(!1),t.setSelected(!0),t.setHits(0);const e=t.getParent();void 0!==e&&e!==this.getRootEntry()&&e!==this.getAllNode()&&(e.setHits(e.getHits()+1),this.escalateSelectionIfPossible(t))}}hasNoSelectionEscalation(){return void 0!==this.topicMenu.root_entry.selection_strategy_parameters&&this.topicMenu.root_entry.selection_strategy_parameters.no_selection_escalation}hasForceRootSelection(){return void 0!==this.topicMenu.root_entry.selection_strategy_parameters&&void 0!==this.topicMenu.root_entry.selection_strategy_parameters.force_root_selection&&this.topicMenu.root_entry.selection_strategy_parameters.force_root_selection}hasLeafSelectionOnly(){return void 0!==this.topicMenu.root_entry.selection_strategy_parameters&&this.topicMenu.root_entry.selection_strategy_parameters.leaf_selection_only}getType(){return this.topicMenu.type}getOrder(){return this.topicMenu.order}getParentEntry(e){return e.getParent()}countSelectionRecursively(){return this.getRootEntry().countSelectionRecursively()}getSelectionCount(){return this.getSelectedEntriesRecursively().length}containsSelection(){return this.getRootEntry().containsSelection()}getEntryByMappedId(e,t){return this.getRootEntry().getEntryByMappedId(e,t)}hasEntryByMappedId(e){return this.getRootEntry().hasEntryByMappedId(e)}getEntryByName(e){return this.getRootEntry().getEntryByName(e)}hasEntryByName(e){return this.getRootEntry().hasEntryByName(e)}getEntriesByMappedId(e){return this.getRootEntry().getEntriesByMappedId(e)}getRootEntry(){if(this.hasRootEntry())return s.logService.assert(!0===this.hasRootEntry(),"topic menu has no root entry"),void 0===this.rootEntry&&(this.rootEntry=new p.TopicEntryWrapper(this.topicMenu.root_entry,this)),this.rootEntry}hasJoinedMenuTypes(){return void 0!==this.joinedMenuTypes&&this.joinedMenuTypes.length>0}getJoinedMenuTypes(){return void 0===this.joinedMenuTypes&&(this.joinedMenuTypes=[]),this.joinedMenuTypes}resetFilterHits(){this.getRootEntry().resetFilterHits()}setPostSelectionfunction(e){this.postSelectionProcessing=e}isDisabled(){return this.topicMenu.disabled}isForceShowFilter(){return this.topicMenu.force_show_filter}getDisplayPosition(){return this.topicMenu.display_position}hasDisplayPosition(){return void 0!==this.topicMenu.display_position}isDisplayPositionTop(){return this.topicMenu.display_position===constants.topic_menu.display_position.top}isDisplayPositionRight(){return this.topicMenu.display_position===constants.topic_menu.display_position.right}isDisplayPositionBottom(){return this.topicMenu.display_position===constants.topic_menu.display_position.bottom}isDisplayPositionLeft(){return this.topicMenu.display_position===constants.topic_menu.display_position.left}isDisplayPositionHeader(){return this.topicMenu.display_position===constants.topic_menu.display_position.header}setFilterBehaviour(e){this.topicMenu.filter_behaviour=e}getFilterBehaviour(){return this.topicMenu.filter_behaviour}getAllMappedId(){return this.topicMenu.all_mapped_id}hasAllMappedId(){return void 0!==this.getAllMappedId()}validate(){void 0===this.topicMenu.root_entry&&s.logService.warn("Topic menu has no root entry",g.twCommon.logFeatures.TopicMenu,this)}hasInvertFilter(){return void 0!==this.topicMenu.invert_filter}get invertFilter(){return this.topicMenu.invert_filter}set invertFilter(e){this.topicMenu.invert_filter=e}isRefreshEntries(){return this.topicMenu.refresh_entries}setRefreshEntries(e){this.topicMenu.refresh_entries=e}}__decorate([o.debounce(30),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],h.prototype,"publishSelection",null),t.TopicMenuWrapper=h,t.default=r.constant(h)}),define("services/export",["require","exports","services/rest_form_service","common_constants","other/tw","classes/application/application"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{async shareWidget(e,t){const n=(t=t.clone()).getPageState().copyAndPrune(!1);t.prune(),n.deleteAllWidgets(),n.getSections()[0].addWidget(t),n.setShareMode(!0,e);try{return(await i.restFormService.postRForm("page_state_sharing","share",{page_state:n.toProto()})).data}catch(e){return e.data}finally{n.dispose()}}async exportReport(e){return await i.restFormService.getRForm("report","export",e)}async exportPage(e){const t=s.tw.pageState.copyAndPrune(!1);t.setExportMode(!0,!0,e);try{return(await i.restFormService.postRForm("report","export",{page_state:t.toProto()})).data}catch(e){return e.data}finally{t.dispose()}}async exportWholePage(e,t,n){const o=s.tw.pageState.copyAndPrune(!1);o.setExportMode(!0,!0,e),n=n||"page_state_full_exporting";try{return(await i.restFormService.postRForm(n,"export",Object.assign({page_state:o.toProto()},t))).data}catch(e){return e.data}finally{o.dispose()}}async requestWholePageExportPreview(e,t,n){const s=o.mainApplication.getPageState().copyAndPrune(!1);s.setExportMode(!0,!0,e);try{return await i.restFormService.postRForm(t,"preview",Object.assign({page_state:s.toProto()},n))}catch(e){return e}finally{s.dispose()}}async exportWidget(e,t){(t=t.clone()).getApplication()&&t.getApplication().getWidgetSettings().displayFullSizeWidget&&(t.forceSizeChange(12),t.isTable()&&t.isInfluencerTableOptionPresent()&&t.setHeaderHidden(!1));const n=t.getPageState().copyAndPrune(!1);if(t.hasUf()){const e=t.getUf();e.overrideFilters(t.getPageState().getUserFilterSettings()),e.toProto()}t.prune(),n.getAllowedPages().setGroupPage(t.getPageState().getAllowedPages().getGroupPage()),n.getAllowedPages().setPageType(t.getPageState().getAllowedPages().getPageType()),n.getAllowedPages().setCustomPageId(t.getPageState().getAllowedPages().getCustomPageId()),n.deleteAllWidgets(),n.getSections()[0].addWidget(t),n.setExportMode(!0,!1,e);try{return(await i.restFormService.postRForm("page_state_exporting","export",{page_state:n.toProto()})).data}catch(e){return e.data}finally{n.dispose()}}async exportStreamingFct(e,t){const o=s.tw.pageState.copyAndPrune(!1),r=o.toProto();o.dispose(),r.data_input_configuration=e,r.exportr=!0,r.output_type=t;try{return(await i.restFormService.post(routes.controllers.tw.Streaming.streamURL(n.source_context.project,s.tw.project_id).url,r)).data}catch(e){return e.data}}}t.ExportService=r,t.exportService=new r}),define("react_components/filter_menu/default_filter_bar_controller",["require","exports","filter_menu","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","classes/application/application","canvas_engine"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultFilterBarController=class extends i.AbstractFilterBarController{resetChanges(){throw new Error("Method not implemented.")}saveChanges(){this.refreshPageData()}async refreshPageData(){const e={strategy:n.ModelRefreshStrategy.REFRESH},t=r.modelRefreshDecoratorFactory.getDecorator(a.mainApplication.getPageState(),a.mainApplication,o.ModelType.PAGE_STATE,e);try{return await s.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&c.logService.error(e.message)}}}}),define("react_components/filter_menu/click_toggle_filter_bar_controller",["require","exports","react_components/filter_menu/default_filter_bar_controller","filter_menu"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ClickToggleFilterBarController=class extends i.DefaultFilterBarController{handleMenuClose(){}wrapOnMenuClick(e){e.onMenuClick=(t=>{const i=this.getMenuControllerById(t);return e===i&&this.handleOnMenuClick(i),!0})}wrapOnMenuHovered(e){e.onMenuHovered=(()=>void 0)}handleOnMenuClick(e){const t=e.getId();this.menuControllers.forEach(e=>{e.getId()===t&&e.getState().openState!==n.FilterMenuState.OPEN_WITH_CLICK?e.setOpenState(n.FilterMenuState.OPEN_WITH_CLICK):e.setOpenState(n.FilterMenuState.CLOSED)})}}}),define("components/page/quick_search/controllers/lazily_saved_filter_menu_controller",["require","exports","react_components/filter_menu/default_filter_menu_controller"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.LazilySavedFilterMenuController=class extends i.DefaultFilterMenuController{shouldPersistChanges(){return!1}}}),define("react_components/filters/components/responsive_filters/responsive_filters_component_style",["require","exports","emotion","composable_styles"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.responsiveFiltersContainer=i.css`
    position: fixed;
    overflow: auto;
    width: 100vw;
    height: calc(100vh - 39px);
    z-index: 20;
`,t.responsiveFilterBackground=(e=>i.css`
    background-color: ${e.bgColor};
`),t.responsiveFilterClosePanel=(e=>i.css`
    padding: 2em;
    text-align: center;
    font-size: 1.5em;

    opacity: ${e.opacity};
    background-color: ${e.bgColor};
`),t.responsiveFiltersCustomMenusContainer=(e=>n.dynamicStyle((e,t)=>e`
            display: flex;
            flex-wrap: wrap;
            font-size: 13px;
            padding: 0 1.4em;
            border-bottom: 1px solid rgb(215, 219, 221);
            background-color: ${t.bgColor};
            color: ${t.color};

            .label {
                color: ${t.color};
            }

            label: responsiveFiltersCustomMenusContainer;
        `)(n.composeProps(e,{color:"#707070"}))),t.responsiveFilterCustomFilterMenuStyle=(e=>n.dynamicStyle((e,t)=>e`
            padding: ${t.padding};

            ${n.mediaQueries.PHONE} {
                flex: 1 1 100%;
            }

            ${n.mediaQueries.TABLET} {
                flex: 1 1 50%;
            }

            label: responsiveFilterCustomFilterMenuStyle;
        `)(n.composeProps(e,{padding:"1.4em 0"})))}),define("react_components/label_select/time_filter/time_filter_wrapper_label_select_adapter",["require","exports","reusable_components"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TimeFilterWrapperLabelSelectAdapter=class extends i.LabelSelectAdapter{update(e){this.data=e}getItems(){return this.data.getTimeFilterMenu().getRootEntry().getChildren().map(e=>({id:e.getMappedId(),label:e.getName(),selected:e.isSelected(),visible:e.isVisible(),disabled:e.isDisabled()}))}}}),define("react_components/label_select/time_filter/time_filter_label_select_controller",["require","exports","label_select/controller/abstract_label_select_controller","react_components/label_select/time_filter/time_filter_wrapper_label_select_adapter"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TimeFilterLabelSelectController=class extends i.AbstractLabelSelectController{constructor(e,t=n.TimeFilterWrapperLabelSelectAdapter){super(e,t)}onSelectItem(e){const t=this.adapter.getData(),i=t.getTimeFilterMenu().getEntryByMappedId(e.id);t.getTimeFilterMenu().selectEntryByMappedId(e.id),i.isSelected()?t.setTimeInterval(i.getMappedId(),!1):t.setTimeInterval(void 0,!1)}}}),define("react_components/label_select/topic_menu_wrapper_label_select_adapter",["require","exports","reusable_components"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuWrapperLabelSelectAdapter=class extends i.LabelSelectAdapter{update(e){this.data=e}getItems(){return this.data.getRootEntry().getChildren().map(e=>({id:e.getMappedId(),label:e.getName(),selected:e.isSelected(),visible:e.isVisible(),disabled:e.isDisabled()}))}}}),define("react_components/label_select/sentiment/sentiment_label_select_adapter",["require","exports","classnames","react_components/label_select/topic_menu_wrapper_label_select_adapter"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.SentimentLabelSelectAdapter=class extends n.TopicMenuWrapperLabelSelectAdapter{getItems(){return this.data.getRootEntry().getChildren().filter(e=>"NONE"!==e.getMappedId()).map(e=>({id:e.getMappedId(),label:void 0,selected:e.isSelected(),visible:e.isVisible(),disabled:e.isDisabled(),icon:this.determineIcon(e)}))}determineIcon(e){return i({"tw-btn-icon-rounded":!0,"icon-tw-exclamation important":"IMPORTANT"===e.getMappedId(),"icon-tw-flag sentiment":"IMPORTANT"!==e.getMappedId(),active:e.isSelected(),positive:"POSITIVE"===e.getMappedId(),neutral:"NEUTRAL"===e.getMappedId(),negative:"NEGATIVE"===e.getMappedId()})}}}),define("react_components/label_select/default_label_select_controller",["require","exports","label_select/controller/abstract_label_select_controller","common_constants","react_components/label_select/topic_menu_wrapper_label_select_adapter"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultLabelSelectController=class extends i.AbstractLabelSelectController{constructor(e,t=s.TopicMenuWrapperLabelSelectAdapter){super(e,t)}onSelectItem(e){const t=this.adapter.getData(),i=t.getEntryByMappedId(e.id),s=t.getRootEntry(),o=s.getSelectionType()||n.topic_menu.select_type.single,r=s.hasChildrenUnselectAvailable()&&s.isChildrenUnselectAvailable()||o===n.topic_menu.select_type.multiple;!r&&i.isSelected()||(o===n.topic_menu.select_type.single&&r?(t.unselectAll(),i.toggleSelection()):o!==n.topic_menu.select_type.single||r?t.selectEntry(i):(t.unselectAll(),t.selectEntry(i)))}}}),define("react_components/filters/components/responsive_filters/responsive_filters_component",["require","exports","react","flux","filter_menu","classes/context_data/context_data","react_components/filters/components/responsive_filters/responsive_filters_component_style","services/theme","event_bus","services/navbar","reusable_components","react_components/label_select/time_filter/time_filter_label_select_controller","react_components/label_select/sentiment/sentiment_label_select_adapter","react_components/label_select/default_label_select_controller"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.ResponsiveFiltersComponent=class extends n.BaseComponent{constructor(e){super(e),this.state={visible:!1}}componentDidMount(){this.cancellationToken.subscribeToStream(c.eventBus,c.EVENT_TYPES.FILTER_STATE_CHANGE,e=>this.setState({visible:e.value}))}render(){if(this.state.visible){const e=a.themeService.getCurrentThemeModel();return i.createElement(i.Fragment,null,i.createElement("div",{className:r.responsiveFiltersContainer},this.renderCustomFilterMenus(),i.createElement("div",{className:r.responsiveFilterBackground({bgColor:e.none})},i.createElement(s.FilterBarContainer,Object.assign({},this.props,{messages:{msgNoFiltersSelected:o.contextData.getMessage("_1663547"),msgSearchHint:o.contextData.getMessage("_1663548"),msgSearchResults:o.contextData.getMessage("_1663549"),msgTopResults:o.contextData.getMessage("_1663550"),msgNoSearchResults:o.contextData.getMessage("_1663551"),msgSearchPlaceholder:o.contextData.getMessage("_1586942"),msgMore:o.contextData.getMessage("_1695865"),msgApplyChanges:o.contextData.getMessage("_1589501"),msgCancelChanges:o.contextData.getMessage("_1589500")},showPageFilters:!0}))),this.renderFilterClosePanel()))}return null}renderCustomFilterMenus(){const e=a.themeService.getCurrentThemeModel(),t=tw.pageState.getUserFilterSettings(),n=t.getTimeFilter(),s=t.getTopicMenuByType("SENTIMENT");return i.createElement("div",{className:r.responsiveFiltersCustomMenusContainer({bgColor:e.none})},i.createElement("div",{className:r.responsiveFilterCustomFilterMenuStyle({})},i.createElement(d.LabelSelectComponent,{controller:new g.TimeFilterLabelSelectController(n)})),i.createElement("div",{className:r.responsiveFilterCustomFilterMenuStyle({})},i.createElement(d.LabelSelectComponent,{controller:new p.DefaultLabelSelectController(s,u.SentimentLabelSelectAdapter)})))}renderFilterClosePanel(){return i.createElement("div",{className:r.responsiveFilterClosePanel({opacity:.7,bgColor:"#e6f5fb"}),onClick:this.closeFilters.bind(this)},i.createElement("div",null,o.contextData.getMessage("_384105")))}closeFilters(){l.navbarService.setFilterState(l.FilterState.CLOSE)}}}),define("classes/dashboard_actions/dashboard_actions",["require","exports","wrappers/page_state/page_state_wrapper","classes/custom_pages/custom_page_factory","services/rest_form_service","services/tw_routing","services/modal","reusable_utilities","services/confirmation_service","classes/context_data/context_data","services/filter"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});class g{static async revertToLegacyDashboard(e){c.confirmationService.display({message:{message:l.contextData.getMessage("_321943"),ok:l.contextData.getMessage("_697024"),cancel:l.contextData.getMessage("_348105")}},{fadeOtherBubbles:!0}).then(async()=>{const t=n.CustomPageFactory.getPageFromPageState(e);await s.restFormService.postRForm("custom_pages","restore",{type:constants.custom_page.type.dashboard,dashboard_container:{mapped_id:t.getId()}}),t.refreshPage()}).catch()}static toggleEditMode(e){e.setEditMode(!e.isEditMode()),o.twRoutingService.refresh({applicationRefresh:!0,forceRebuild:!0})}static showDashboardUsers(e){r.modalService.display("DASHBOARD_USERS",{mapped_id:e},{size:r.ModalSize.LARGE})}static copyDashboard(e){r.modalService.display("COPY_DASHBOARD",e)}static shareDashboard(e){r.modalService.display("SHARE_DASHBOARD",e)}static overrideDashboard(e){c.confirmationService.display({message:l.contextData.getMessage("_144879")}).then(()=>{const t=n.CustomPageFactory.getPageFromPageState(e),i=e.copyAndPrune(!1),s={mapped_id:t.getId(),page_state:i.toProto()};t.override(s).then(()=>{d.filterService.clearFilters()})},()=>void 0)}}__decorate([a.debounce(100),__metadata("design:type",Function),__metadata("design:paramtypes",[i.PageStateWrapper]),__metadata("design:returntype",void 0)],g,"toggleEditMode",null),t.DashboardActions=g}),define("react_components/menu/topic_menu_select_component_strategies/report_widget_additions_menu_strategy",["require","exports","services/custom_pages","classes/application/application","log"],function(e,t,i,n,s){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NEW_REPORT="NEW_REPORT",e.EXISTING_REPORT="EXISTING_REPORT"}(o=t.ReportWidgetAdditionsType||(t.ReportWidgetAdditionsType={}));t.ReportWidgetAdditionsMenuStrategy=class{onSelect(e,t,r){return new Promise((e,r)=>{switch(t.mapped_id){case o.NEW_REPORT:i.customPagesService.showMultipageModalForNewReport(n.mainApplication.getPageState());break;case o.EXISTING_REPORT:i.customPagesService.showModalToAddWidgetsToReport(n.mainApplication.getPageState());break;default:s.logService.error("ReportWidgetAdditionsType does not exist or is not implemented")}r()})}onMouseEnter(e){return new Promise((e,t)=>{e({openPath:void 0,changedEntry:void 0})})}isActionsDisabled(){return!1}}}),define("classes/report_actions/report_actions",["require","exports","services/bubble_dialog","jquery","services/configuration"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.ReportActions=class{static createAlertReport(){i.bubbleDialogService.destroyAllNonPersistent(),i.bubbleDialogService.createByType(constants.bubble_dialog.id.alert,n("#page_content"),constants.bubble_dialog.id.alert,void 0,s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.alert),{fadeBackground:!0})}}}),define("classes/base_page",["require","exports","jquery","react","react-dom","moment-timezone","services/broker","wrappers/topic_menu/topic_menu_wrapper","services/rest_form_service","services/modal","services/configuration","notifications","services/fullscreen","services/directive","services/context","services/application_mode","services/export","classes/context_data/context_data","services/navbar","services/custom_pages","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","react_components/filter_menu/click_toggle_filter_bar_controller","filter_menu","react_components/filter_menu/topic_menu_wrapper_adapter","components/page/quick_search/controllers/lazily_saved_filter_menu_controller","react_components/filters/components/responsive_filters/responsive_filters_component","reusable_components","classes/dashboard_actions/dashboard_actions","classes/report_actions/report_actions"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.$scope=e}isMonitor(){return S.mainApplication.getPageState().getAllowedPages().isMonitor()}isDashboard(){return S.mainApplication.getPageState().getAllowedPages().isDashboard()}isReport(){return S.mainApplication.getPageState().getAllowedPages().isReport()}isSearch(){return S.mainApplication.getPageState().getAllowedPages().isSearch()}isSearchAdvanced(){return S.mainApplication.getPageState().getAllowedPages().isSearchAdvanced()}isTriggerEdit(){return S.mainApplication.getPageState().getAllowedPages().isTriggerEdit()}isWidgetEdit(){return S.mainApplication.getPageState().getAllowedPages().isWidgetEdit()}sendPageEmail(){const e=routes.controllers.tw.TWRestForm.get(h.contextService.getCurrentContext().scope,h.contextService.getCurrentContext().id,"page_state_emailing","send","","rform").url;c.restFormService.post(e,{page_state:this.pageState.toProto()})}$onInit(){void 0===this.pageState&&(this.pageState=S.mainApplication.getPageState()),this.configuration=this.getPageControllerConfiguration(),Object.defineProperty(this.$scope,"filtersOpen",{get:()=>y.navbarService.getFilterState()===y.FilterState.OPEN}),o.locale(S.mainApplication.getPageState().getLanguage()),o.tz.setDefault(S.mainApplication.getPageState().getTimezone()),this.$scope.allowedExport=[],this.$scope.filterMenus=void 0,this.$scope.sidebarMenus=void 0,this.$scope.filterMenuProps=void 0,this.$scope.filterBarController=void 0,this.$scope.sortableOptions={connectWith:"ul.is-sortable",items:"li.widget",cancel:"li.unsortable"},this.$scope.isFullScreen=function(){return u.fullscreenService.isFullscreen()},this.$scope.isHootSuite=function(){return m.applicationMode.getCurrentAppMode()===m.AppMode.HOOTSUITE_DASHBOARD},this.$scope.canExportWholePage=function(){return d.configurationService.getPageConfiguration().canExportWholePage()},this.$scope.exportWholePage=function(){if([constants.page_category.instant_discovery_category,constants.page_category.trend_discovery_category].includes(this.pageState.getAllowedPages().getPageCategory())){const e=this.buildExportDiscoveryModalData();l.modalService.display("DISCOVERY_EXPORT",e)}else{const e=_.exportService.exportWholePage(constants.output_type.docx_pdf),t='<i class="fa fa-refresh fa-spin"></i> '+f.contextData.getMessage("_498245");g.notificationService.warning(t,{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(e=>{g.notificationService.success(e.message,{permanent:!1})},e=>{g.notificationService.display(e.notification)})}},this.$scope.getBreadCrumb=(()=>this.pageState.getBreadCrumb()),this.$scope.getAllowedPages=(()=>this.pageState.getAllowedPages()),this.$scope.getUserFilterSettings=(()=>this.pageState.getUserFilterSettings()),this.$scope.getSidebarSections=(()=>this.pageState.isEditMode()?this.pageState.getUserFilterSettings().getTopics():this.pageState.getUserFilterSettings().getTopics().filter(this.filterSidebarMenus)),this.$scope.isEditMode=(()=>this.pageState.isEditMode()),this.$scope.isTriggerEdit=(()=>this.pageState.getAllowedPages().isTriggerEdit()),this.$scope.isWidgetEdit=(()=>this.pageState.getAllowedPages().isWidgetEdit()),this.$scope.isEmbeddedWidget=(()=>this.pageState.getAllowedPages().isEmbeddedWidget()),this.$scope.getDisplayPages=(()=>this.pageState.getAllowedPages().getDisplayPages()),this.$scope.isSortable=(e=>e.children_orderable),this.$scope.saveAsNewDashboard=(()=>{this.buildDashboardPageModalPayload().then(e=>{e.isDashboard=!0,l.modalService.display("DASHBOARD_PAGE",e)})}),this.$scope.toggleAlertReport=(()=>{F.ReportActions.createAlertReport()}),this.$scope.shareDashboard=(()=>{const e=this.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.dashboard).getFirstSelectedEntryRecursively();R.DashboardActions.shareDashboard(e.toProto())}),this.$scope.togglePageReport=(()=>{v.customPagesService.showMultipageModalForNewReport(this.pageState)}),this.$scope.togglePageDashboard=(()=>{this.buildDashboardPageModalPayload().then(e=>{l.modalService.display("DASHBOARD_PAGE",e)})}),this.$scope.sendPageEmail=(()=>{this.sendPageEmail()}),this.$scope.refreshNoCache=(async()=>{const e={strategy:w.ModelRefreshStrategy.REFRESH_NO_CACHE},t=E.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),T.ModelType.PAGE_STATE,e);try{await b.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&C.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}});const e=r.brokerService.subscribe(constants.events.filters.menu.add,e=>{this.$scope.filterMenus.middle.push(e),this.sortFiltersMiddle()}),t=r.brokerService.subscribe(constants.events.filters.menu.remove,e=>{for(let t=0;t<this.$scope.filterMenus.middle.length;t++)if(this.$scope.filterMenus.middle[t].getType()===e){this.$scope.filterMenus.middle.splice(t,1);break}});if(this.initializeFilters(),this.initializeFilterBar(),this.initializeSidebar(),!this.configuration.hidePageHeaderFilters)if(m.applicationMode.isMobile()){let e=i(".page__header #filterbar");e.length||(e=i(".page__header").append('<div id="filterbar"/>')),this.$scope.responsiveFilters=s.render(n.createElement(I.ResponsiveFiltersComponent,{menus:this.$scope.filterMenuProps,controller:this.$scope.filterBarController,configuration:{color:f.contextData.projectSettings.branding.color}}),e.get(0))}else this.$scope.responsiveFilters&&s.unmountComponentAtNode(this.$scope.responsiveFilters),p.directiveService.inject(i(".page__header"),"tw-filters",{"ng-show":'"filtersOpen"',menus:'"filterMenus"',id:'"filters"',class:'"tw-filters ng-hide"'},this.$scope);this.$scope.$on("$destroy",function(){r.brokerService.unsubscribe(constants.events.filters.menu.add,e),r.brokerService.unsubscribe(constants.events.filters.menu.remove,t)})}sortFiltersMiddle(){this.$scope.filterMenus.middle.sort((e,t)=>e.getOrder()-t.getOrder())}canShowMenuInMiddleFilters(e){return void 0!==e.getOrder()}canForceShowMenu(e){return e.isForceShowFilter()}initializeSidebar(){this.$scope.sidebarMenus=this.pageState.isEditMode()?this.pageState.getUserFilterSettings().getTopics():this.pageState.getUserFilterSettings().getTopics().filter(this.filterSidebarMenus)}filterSidebarMenus(e){return![constants.topic_menu.TYPE.event,constants.topic_menu.TYPE.filter,constants.topic_menu.TYPE.topic_pm_composed].includes(e.getType())}buildDashboardPageModalPayload(){const e=routes.controllers.tw.TWRestForm.get(h.contextService.getCurrentContext().scope,h.contextService.getCurrentContext().id,"dashboard_groups","show","","rform").url;return c.restFormService.get(e).then(e=>({name:void 0,description:void 0,widget_title_suffix:"",description_filters_allowed:!1,groups:new a.TopicMenuWrapper(e.groups)}))}buildExportDiscoveryModalData(){const e={};return this.pageState.getAllowedPages().getPageCategory()===constants.page_category.instant_discovery_category?e.headerTitle=f.contextData.getMessage("_845166"):this.pageState.getAllowedPages().getPageCategory()===constants.page_category.trend_discovery_category&&(e.headerTitle=f.contextData.getMessage("_184686")),e}initializeFilters(){this.$scope.filterMenus={top:[],middle:[]};const e=S.mainApplication.getPageState().getUserFilterSettings();let t;if(e.hasFilters()&&e.getTopicMenus().forEach(e=>{if(!e.isDisabled()||this.canForceShowMenu(e))switch(e.getType()){case constants.topic_menu.TYPE.content_contains_type:case constants.topic_menu.TYPE.countries:case constants.topic_menu.TYPE.generator_device:case constants.topic_menu.TYPE.languages:case constants.topic_menu.TYPE.media_type:case constants.topic_menu.TYPE.mention_type:case constants.topic_menu.TYPE.named_entity_types:case constants.topic_menu.TYPE.custom_entities:case constants.topic_menu.TYPE.pmg_publication_issue:case constants.topic_menu.TYPE.pmg_publication_unit:case constants.topic_menu.TYPE.pmg_source_brandgroup:case constants.topic_menu.TYPE.pmg_source_distribution_type:case constants.topic_menu.TYPE.pmg_deduplication:case constants.topic_menu.TYPE.score_tags:case constants.topic_menu.TYPE.source_panel:case constants.topic_menu.TYPE.tags:case constants.topic_menu.TYPE.topic_pm_composed:case constants.topic_menu.TYPE.visual_entity_type:case constants.topic_menu.TYPE.workflow_tags:case constants.topic_menu.TYPE.demographics_and_gender:case constants.topic_menu.TYPE.near_filter:this.canShowMenuInMiddleFilters(e)&&this.$scope.filterMenus.middle.push(e);break;case constants.topic_menu.TYPE.sentiment:t=e}}),e.hasTopics()){let t=e.getTopicMenuByType(constants.topic_menu.TYPE.filter);void 0!==t&&this.$scope.filterMenus.middle.push(t),void 0!==(t=e.getTopicMenuByType(constants.topic_menu.TYPE.predefined_filters))&&this.$scope.filterMenus.middle.push(t)}this.sortFiltersMiddle(),this.$scope.filterMenus.top.push(e.getSearchbarFilter()),this.$scope.filterMenus.top.push(e.getTimeFilter()),void 0!==t&&this.$scope.filterMenus.top.push(t)}initializeFilterBar(){this.$scope.filterBarController=new M.ClickToggleFilterBarController,this.$scope.filterMenuProps=this.$scope.filterMenus.middle.filter(e=>e.getRootEntry().isVisible()).map(e=>this.buildMenuAttributes(e)).map(e=>this.buildFilterMenuProps(e))}buildFilterMenuProps(e){const{topicMenu:t}=e;return{controller:new(this.getFilterMenuController(t))(e,D.TopicMenuWrapperMenuAdapter)}}getFilterMenuController(e){return A.LazilySavedFilterMenuController}buildMenuAttributes(e,t){return{topicMenu:e,config:{component:{renderable:P.IntegratedFilterMenuRenderable,props:{}},entries:{[x.MenuConfigKeys.DEFAULT]:{style:P.integratedFilterFormStyle}},showSearchBar:!1,showTopResults:!1,shouldHideSeparatorLine:!0},selectionModes:[]}}getFilterMenuColor(){return f.contextData.projectSettings.branding.color}}}),define("services/commons",["require","exports","angular","d3","moment-timezone","underscore"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{checkPopupBlocked(e){return!e||void($(e).ready=function(){setTimeout(function(){return 0===e.screenX},0)})}selectRange(e,t,n,r){let a=s(Number(e)).tz(t),c=a.hour().toString(),l=((Number(c)+1).toString(),a.minute().toString(),i.copy(a));return o.isUndefined(r)?n===constants.time_filter.TIME_AXIS_OPTION.month?l.add(1,"months"):n===constants.time_filter.TIME_AXIS_OPTION.week?l.add(1,"weeks"):n===constants.time_filter.TIME_AXIS_OPTION.day?l.hour(Number("24")):n===constants.time_filter.TIME_AXIS_OPTION.hour?l.add(1,"hours"):n===constants.time_filter.TIME_AXIS_OPTION.min15?l.add(15,"minutes"):n===constants.time_filter.TIME_AXIS_OPTION.min5?l.add(5,"minutes"):n===constants.time_filter.TIME_AXIS_OPTION.min?l.add(1,"minutes"):n===constants.time_filter.TIME_AXIS_OPTION.sec&&l.add(1,"seconds"):l.add(r,"milliseconds"),{from_ts:a.toDate().getTime(),to_ts:l.toDate().getTime()}}toRGB(e){return n.rgb(e)}}t.default=r,t.commons=new r}),define("classes/cropper",["require","exports","services/commons","jquery","underscore","classes/context_data/context_data"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$window",function(e){function t(e){this.canvas=n("<canvas style='position: absolute; z-index: 1;'></canvas>"),this.context=this.canvas[0].getContext("2d"),this.startingPoint={x:0,y:0},this.endingPoint={x:e.outerWidth(),y:e.outerHeight()},this.element=e,e.prepend(this.canvas),this.clear()}return t.prototype={clear:function(){this.canvas.css("width",0),this.canvas.css("height",0)},setStartingPoint:function(e){this.startingPoint=e},setEndingPoint:function(e){this.endingPoint=e},startCrop:function(t,i){0===t.button&&(this.started=!0,this.initialized=!1,this.startX=t.clientX-this.canvas.offset().left+e.pageXOffset,this.startY=t.clientY-this.canvas.offset().top+e.pageYOffset,this.startX<this.startingPoint.x&&(this.startX=this.startingPoint.x),this.startY<this.startingPoint.y&&(this.startY=this.startingPoint.y),this.widget=i)},updateCrop:function(t){0===t.button&&(!0===this.started&&(this.initialized||(this.canvas.css("width",this.element.outerWidth()),this.canvas.css("height",this.element.outerHeight()),this.canvas.attr("width",this.element.outerWidth()),this.canvas.attr("height",this.element.outerHeight()),this.initialized=!0),this.endX=t.clientX-this.canvas.offset().left+e.pageXOffset,this.endX>this.endingPoint.x?this.endX=this.endingPoint.x:this.endX<this.startingPoint.x&&(this.endX=this.startingPoint.x),this.endY=t.clientY-this.canvas.offset().top+e.pageYOffset,this.endY>this.endingPoint.y?this.endY=this.endingPoint.y:this.endY<this.startingPoint.y&&(this.endY=this.startingPoint.y),this._drawCrop()),t.preventDefault())},cancel:function(){this.started=!1,this.clear()},endCrop:function(t){if(!this.started||0!==t.button)return;this.started=!1,this.endX=t.clientX-this.canvas.offset().left+e.pageXOffset,this.endY=t.clientY-this.canvas.offset().top+e.pageYOffset;const i=Math.min(this.startX,this.endX),n=Math.min(this.startY,this.endY),s=Math.max(this.startX,this.endX),o=Math.max(this.startY,this.endY);return this.clear(),{top_left:{x:i,y:n},bottom_right:{x:s,y:o}}},_drawCrop:s.throttle(function(){const e=Math.min(this.startX,this.endX),t=Math.max(this.startX,this.endX)-e,n=Math.min(this.startY,this.endY),s=Math.max(this.startY,this.endY)-n;if(this.context.save(),this.context.clearRect(0,0,this.canvas.outerWidth(),this.canvas.outerHeight()),e>=this.startingPoint.x&&e+t<=this.endingPoint.x&&n>=this.startingPoint.y&&n+s<=this.endingPoint.y){const r=i.commons.toRGB(o.contextData.projectSettings.branding.color);this.context.strokeStyle="rgba("+r.r+","+r.g+","+r.b+",0.6)",this.context.strokeRect(e,n,t,s),this.context.fillStyle="rgba("+r.r+","+r.g+","+r.b+",0.3)",this.context.fillRect(e,n,t,s)}this.context.restore()},50)},t}]}),define("classes/graph_slicer",["require","exports","moment-timezone","services/commons","underscore","classes/context_data/context_data"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=o.contextData;t.default=["navigationService","$window","NavigationParams",function(e,t,o){function a(e){this.canvas=$("<canvas style='position: absolute;'></canvas>"),this.context=this.canvas[0].getContext("2d"),this.startingPoint=40,this.endingPoint=e.outerWidth()-40,this.graphDomElement=e,e.prepend(this.canvas),this.clear()}return a.prototype={clear:function(){s.isUndefined(this.canvas)||(this.canvas.css("width",0),this.canvas.css("height",0))},dispose:function(){this.canvas&&(this.canvas.remove(),this.canvas=void 0)},setStartingPoint:function(e){this.startingPoint=e+2},setEndingPoint:function(e){this.endingPoint=e+2},startSlice:function(e,i){if(0!==e.button)return;this.started=!0,this.initialized=!1,this.startX=e.clientX-this.canvas.offset().left+t.pageXOffset,this.startX<this.startingPoint&&(this.startX=this.startingPoint),this.widget=i;const n=i.getDataGraph();this.columns=n.getColumns()},updateSlice:function(e){1!==e.buttons||0===e.originalEvent.movementX&&0===e.originalEvent.movementY||(!0===this.started&&(this.initialized||(this.canvas.css("width",this.graphDomElement.outerWidth()+20),this.canvas.css("height",this.graphDomElement.outerHeight()),this.canvas.attr("width",this.graphDomElement.outerWidth()+20),this.canvas.attr("height",this.graphDomElement.outerHeight()),this.initialized=!0),this.endX=e.clientX-this.canvas.offset().left+t.pageXOffset,this.endX>this.endingPoint&&(this.endX=this.endingPoint),this.endX<this.startingPoint&&(this.endX=this.startingPoint),this._drawSlice()),e.preventDefault())},cancel:function(){this.started=!1,this.clear()},endSlice:function(i){if(!this.started||0!==i.button)return!1;if(this.started=!1,this.endX=i.clientX-this.canvas.offset().left+t.pageXOffset,!s.isUndefined(this.columns)&&this.columns.length>1){const t=this._getDataPoint(this.columns,Math.max(this.startingPoint,Math.min(this.startX,this.endX))),i=this._getDataPoint(this.columns,Math.max(this.startX,this.endX));if(t.code===i.code)return this.clear(),!0;const n=new o;n.setWidget(this.widget),n.setFilters([[{key:"TIME_INTERVAL",begin:Number(t.code),interval:i.code-t.code}]]),e.clickHandler(n)}return this.clear(),!1},_getDataPoint:function(e,t){t-=this.startingPoint;const i=(this.canvas.outerWidth()-this.startingPoint-(this.canvas.outerWidth()-this.endingPoint))/this.columns.length;let n=Math.floor(t/i);return n>=this.columns.length&&(n=this.columns.length-1),e[n]},_getDateLines:function(e){const t=this._getDataPoint(this.columns,e);if(t){const e=parseInt(t.code),n=i(e);return[n.format(r.commonPropertiesContainer.date_format.date_format),n.format("HH:mm:ss")]}return[]},_drawTooltip:function(e,t,i){this.context.save(),this.context.font="13px RobotoR";const n=this.context;let o=0;s.each(e,function(e){o=Math.max(o,n.measureText(e).width+10)});this.context.strokeStyle="rgba(0,0,0,0.5)",this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(t-o/2,i,o,36),this.context.beginPath(),this.context.moveTo(t-5,i+36),this.context.lineTo(t,i+36+5),this.context.lineTo(t+5,i+36),this.context.closePath(),this.context.fill(),this.context.textBaseline="top",this.context.fillStyle="rgba(255,255,255,1)";for(let s=0;s<e.length;s++)this.context.fillText(e[s],t-n.measureText(e[s]).width/2,i+1+16*s);this.context.restore()},_drawSlice:s.throttle(function(){const e=Math.min(this.startX,this.endX),t=Math.max(this.startX,this.endX)-e,i=this._getDateLines(e),s=this._getDateLines(Math.max(this.startX,this.endX));if(this.context.save(),this.context.clearRect(0,0,this.canvas.outerWidth(),this.canvas.outerHeight()),e>=this.startingPoint&&e+t<=this.endingPoint){const o=n.commons.toRGB(r.projectSettings.branding.color);this.context.fillStyle="rgba("+o.r+","+o.g+","+o.b+",0.3)",this.context.fillRect(e,0,t,this.canvas.outerHeight()),this.context.fillRect(e,0,4,this.canvas.outerHeight()),this.context.fillRect(e+t-4,0,4,this.canvas.outerHeight()),this._drawTooltip(i,e+2,40),t<80?this._drawTooltip(s,e+t-2,90):this._drawTooltip(s,e+t-2,40)}this.context.restore()},50)},a}]}),define("classes/access_rights/user/page/access_rights_option",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AccessRightsOption=class{constructor(e){this.topicEntry=e,this.optionSelected="NODE"===this.entry.selected}toggleCallback(e){this.topicEntry.selected=!0===e?constants.topic_entry.selected.node:constants.topic_entry.selected.none}get entry(){return this.topicEntry}set selected(e){this.optionSelected=e}get selected(){return this.optionSelected}}}),define("classes/access_rights/user/page/access_rights_entry",["require","exports","components/form/common/topic_menu"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AccessRightsEntry=class{constructor(e,t){this.topicEntry=e,this.accessRightsOptions=t}shouldDisplayIndividualEntries(){if(this.hasChildren()){const e=this.entry.children.find(e=>"NODE"===e.selected);if(void 0!==e)return"CUSTOM"===e.mapped_id}return!1}hasOptions(){return void 0!==this.accessRightsOptions}isReadAccessSelected(){return i.getFirstSelectedMappedId(this.entry)===constants.access_level.read}get entry(){return this.topicEntry}get options(){return this.accessRightsOptions}hasChildren(){return void 0!==this.entry&&void 0!==this.entry.children&&this.entry.children.length>0}}}),define("classes/access_rights/user/page/user_access_rights_page",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.UserAccessRightsPage=class{constructor(e,t){this.pageTitle=e,this.accessRightsEntries=t}get title(){return this.pageTitle}get entries(){return this.accessRightsEntries}}}),define("classes/access_rights/user/project/project_user_access_rights",["require","exports","components/form/common/topic_menu"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ProjectUserAccessRights=class{constructor(e,t,i){this.title=e,this.accessLevels=t,this.userAccessRightsPages=i}isCustomLevelSelected(){return i.getFirstSelectedMappedId(this.accessLevelMenu.root_entry)===constants.user_access.level.custom}get projectTitle(){return this.title}get accessLevelMenu(){return this.accessLevels}get pages(){return this.userAccessRightsPages}}}),define("classes/bounding_box/bounding_box",["require","exports","log","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BoundingBox=class{constructor(e,t,s){i.logService.assertDefined(e,n.twCommon.logFeatures.BoundingBox),this._boundingBox=e,this._canvasWidth=t,this._canvasHeight=s}toProto(){return this._boundingBox}getCanvasWidth(){return this._canvasWidth}getCanvasHeight(){return this._canvasHeight}getLabel(){return this._label}getX(){return this._boundingBox.top_left.x*this.getCanvasWidth()}getY(){return this._boundingBox.top_left.y*this.getCanvasHeight()}getX2(){return this._boundingBox.bottom_right.x*this.getCanvasWidth()}getY2(){return this._boundingBox.bottom_right.y*this.getCanvasHeight()}getWidth(){return this.getX2()-this.getX()}getHeight(){return this.getY2()-this.getY()}getLineWidth(){return this.getWidth()<8||this.getHeight()<8?1:2}getBounds(){return{x:this.getX(),y:this.getY(),w:this.getWidth(),h:this.getHeight()}}}}),define("classes/calendar/calendar",["require","exports","kalendae","underscore","services/configuration","services/bubble_dialog"],function(e,t,i,n,s,o){return[function(){function e(e,t){i.call(this,e[0],t),this._element=e;const n=this;this.onDateCaptionClick.subscribe(function(){const t=constants.bubble_dialog.id.months,i=s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.months);i.setAbsoluteX(e.offset().left),i.setAbsoluteY(e.offset().top),o.bubbleDialogService.destroyById(t),this._bubble=o.bubbleDialogService.createByType(t,e,"months",void 0,i),this._bubble.onMessage.subscribe(function(e){this.viewStartDate.month(e),this.draw()},n)},this)}return e.prototype=Object.create(i.prototype),e.prototype=$.extend(e.prototype,{dispose:function(){this._element&&(this._element.remove(),this._element=null),this.unsubscribe("date-clicked"),this.unsubscribe("change"),this.closeMonthsPopup(),this.onDateCaptionClick.cancelAll()},closeMonthsPopup:function(){n.isUndefined(this._bubble)||this._bubble.destroy()}}),e}]}),define("classes/canvas_engine/tween_performance_test",["require","exports","canvas_engine","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s=document.createElement("canvas");s.style.position="absolute",s.style["z-index"]=1e4,s.style.left="0px",s.style.top="0px";const o=i.Stage.build(s,1920,1200),r=[],a=o.scene,c=new i.AnimationComponent;for(let e=0;e<3e3;e++)r.push(new i.CircleComponent(i.Circle.zero()));a.addComponents(r),a.addComponent(c);const l=c.getChainBase([5e3]);r.forEach((e,t)=>l.chainSequence(c.tween(e,[{key:i.Style.Radius,value:50*Math.random(),duration:5e3},{key:"presence",value:new i.Point(1820*Math.random()+50,1100*Math.random()+50),duration:5e3},{key:i.Style.Color,value:n.Color.fromRGB(255*Math.random(),255*Math.random(),255*Math.random()),duration:5e3}]))),document.body.appendChild(s),o.stage.start(),setTimeout(()=>l.resume(),5e3)}),define("classes/canvas_engine/charts/src/implementations/default_chart",["require","exports","services/navigation","canvas_chart_utilities","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends n.Chart{constructor(e,t,i=new n.DefaultChartSettings,s){super(e,i,s),this.widget=t}openDrilldown(e,t,n){const s=this.getWidget();if(this.hasStageFacade()){const o=this.getStageFacade().getCanvas(),r=()=>this.getStageFacade().unblockEvents();this.revert(),this.getStageFacade().blockEvents(),i.navigationService.openDrilldown(e,t,n,o,s,r)}else i.navigationService.openDrilldown(e,t,n,void 0,s)}getWidget(){return this.widget}}t.DefaultChart=o,t.default=s.constant(o)}),define("classes/canvas_engine/settings/charts/pie_chart_settings",["require","exports","canvas_chart_utilities","canvas_engine","jquery","reusable_utilities"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends i.PopoverChartSettings{constructor(e={model:void 0,labelSettings:void 0}){super(e.model,e.labelSettings,i.PopoverChartSettings.pieType),this.angleMod=10,this.sourceAngle=0,this.endAngle=360,this.radiusMod=10,this.depthMod=10,this.borderMod=1,this.margin=0,this.radiusTweenEnabled=!1,this.depthTweenEnabled=!1,this.colorTweenEnabled=!1,this.sourceAngleTweenEnabled=!1,this.endAngleTweenEnabled=!1,this.borderTweenEnabled=!1,this.clearLayerOnMouseOutAnimationEnd=!1,this.pointerOnSlices=!1,this.sliceBBupdate=!0,this.staticBigSlices=!1,this.piePopoversEnabled=!1,this.dataSetWatch=!1,this.replayEnabled=!0,this.sliceLimitEnabled=!1,this.maxRelevantSlices=Number.POSITIVE_INFINITY,this.isLabelRotationEnabled=!1,this.isValueRecalculationAllowed=!0,this.labelOrientation=n.Constants.Orientation.HORIZONTAL;const{model:t,radiusMod:s,depthMod:r,angleMod:a,sourceAngle:c,endAngle:l}=e;void 0!==s&&this.setRadiusMod(s),void 0!==r&&this.setDepthMod(r),void 0!==a&&this.setAngleMod(a),void 0!==c&&this.setSourceAngle(c),void 0!==l&&this.setEndAngle(l),this.pointerOnSlices=o.ObjectUtils.applyFunctionIfAble(t,"isClickable")}static fromJson(e,t={},n=r){e.type=i.PopoverChartSettings.pieType;const s=super.fromJson(e,t,n);return s.enablePointerOnSlices(o.ObjectUtils.applyFunctionIfAble(e.model,"isClickable")),s}toJson(){return s.extend(super.toJson(),{radiusMod:this.radiusMod,depthMod:this.depthMod,angleMod:this.angleMod,margin:this.getMargin(),sourceAngle:this.sourceAngle,endAngle:this.endAngle,borderMod:this.borderMod,radiusTweenEnabled:this.radiusTweenEnabled,depthTweenEnabled:this.depthTweenEnabled,colorTweenEnabled:this.colorTweenEnabled,sourceAngleTweenEnabled:this.sourceAngleTweenEnabled,endAngleTweenEnabled:this.endAngleTweenEnabled,borderTweenEnabled:this.borderTweenEnabled,pointerOnSlices:this.pointerOnSlices,sliceBBupdate:this.sliceBBupdate,staticBigSlices:this.staticBigSlices,piePopoversEnabled:this.piePopoversEnabled,dataSetWatch:this.dataSetWatch,replayEnabled:this.replayEnabled,sliceLimitEnabled:this.sliceLimitEnabled,maxRelevantSlices:this.maxRelevantSlices,isLabelRotationEnabled:this.isLabelRotationEnabled,labelOrientation:this.labelOrientation,isValueRecalculationAllowed:this.isValueRecalculationAllowed,numberFormatter:this.numberFormatter})}getLabelOrientation(){return this.labelOrientation}setLabelOrientation(e){return this.labelOrientation=e,this}getNumberFormatter(){return this.numberFormatter}setNumberFormatter(e){return this.numberFormatter=e,this}getMargin(){return this.margin}setMargin(e){return this.margin=e,this}enableClearLayerOnMouseOutSequenceEnd(e){return this.clearLayerOnMouseOutAnimationEnd=e,this}shouldClearLayerOnMouseOutAnimationEnd(){return this.clearLayerOnMouseOutAnimationEnd}setModel(e){return super.setModel(e),this.enablePointerOnSlices(o.ObjectUtils.applyFunctionIfAble(e,"isClickable")),this}limitRelevantSlicesTo(e){return this.maxRelevantSlices=e,this}getSliceLimit(){return this.maxRelevantSlices}hasSliceLimit(){return this.sliceLimitEnabled&&this.maxRelevantSlices!==Number.POSITIVE_INFINITY}enableTween(){return this.enableRadiusTween(!1,!0),this.enableRadiusTween(!0),this}enableReplay(e){return this.replayEnabled=e,this}enableValueRecalculation(e){return this.isValueRecalculationAllowed=e,this}enablePointerOnSlices(e){return this.pointerOnSlices=e,this}enableSliceBBupdate(e){return this.sliceBBupdate=e,this}isDataSetWatchEnabled(){return this.dataSetWatch}enableDataSetWatch(e){return this.dataSetWatch=e,this}enableSliceLimit(e){return this.sliceLimitEnabled=e,this}enablePiePopovers(e){return this.piePopoversEnabled=e,this}disableTween(){return this.enableRadiusTween(!0,!0),this.enableRadiusTween(!1),this}enableLabelRotation(e){return this.isLabelRotationEnabled=e,this}enableColorTween(e,t){return this.colorTweenEnabled=e,t&&(this.enableRadiusTween(!e),this.enableSourceAngleTween(!e),this.enableEndAngleTween(!e),this.enableDepthTween(!e),this.enableBorderTween(!e)),this}enableRadiusTween(e,t){return this.radiusTweenEnabled=e,t&&(this.enableColorTween(!e),this.enableSourceAngleTween(!e),this.enableEndAngleTween(!e),this.enableDepthTween(!e),this.enableBorderTween(!e)),this}enableDepthTween(e,t){return this.depthTweenEnabled=e,t&&(this.enableColorTween(!e),this.enableSourceAngleTween(!e),this.enableEndAngleTween(!e),this.enableRadiusTween(!e),this.enableBorderTween(!e)),this}enableAngleTween(e,t){return this.enableSourceAngleTween(e,t),this.enableEndAngleTween(e),this}enableStaticBigSlices(e){return this.staticBigSlices=e,this}enableSourceAngleTween(e,t){return this.sourceAngleTweenEnabled=e,t&&(this.enableRadiusTween(!e),this.enableColorTween(!e),this.enableEndAngleTween(!e),this.enableDepthTween(!e),this.enableBorderTween(!e)),this}enableEndAngleTween(e,t){return this.endAngleTweenEnabled=e,t&&(this.enableRadiusTween(!e),this.enableSourceAngleTween(!e),this.enableColorTween(!e),this.enableDepthTween(!e),this.enableBorderTween(!e)),this}enableBorderTween(e,t){return this.borderTweenEnabled=e,t&&(this.enableRadiusTween(!e),this.enableEndAngleTween(!e),this.enableSourceAngleTween(!e),this.enableColorTween(!e),this.enableDepthTween(!e)),this}isColorTweenEnabled(){return this.colorTweenEnabled}isRadiusTweenEnabled(){return this.radiusTweenEnabled}isDepthTweenEnabled(){return this.depthTweenEnabled}isSourceAngleTweenEnabled(){return this.sourceAngleTweenEnabled}isEndAngleTweenEnabled(){return this.endAngleTweenEnabled}isReplayEnabled(){return this.replayEnabled}isBorderTweenEnabled(){return this.borderTweenEnabled}isPointerOnSliceEnabled(){return this.pointerOnSlices}isSliceBBupdateEnabled(){return this.sliceBBupdate}arePiePopoversEnabled(){return this.piePopoversEnabled}isTweenEnabled(){return this.isColorTweenEnabled()&&this.isDepthTweenEnabled()&&this.isEndAngleTweenEnabled()&&this.isRadiusTweenEnabled()&&this.isSourceAngleTweenEnabled()}setSourceAngle(e){return this.sourceAngle=e||0,this}enableDefaultLabels(e){return this.getModel().enableDefaultLabels(e),this}enablePopoverFooterAsLabel(e){return this.getModel().enablePopoverFooterAsLabel(e),this}getSourceAngle(){return this.sourceAngle}setEndAngle(e){return this.endAngle=e||360,this}getEndAngle(){return this.endAngle}setRadiusMod(e){return this.radiusMod=e||10,this}getRadiusMod(){return this.radiusMod}setDepthMod(e){return this.depthMod=e||10,this}getDepthMod(){return this.depthMod}setBorderMod(e=1){return this.borderMod=e,this}keepBigSlicesStatic(){return this.staticBigSlices}getBorderMod(){return this.borderMod}setAngleMod(e=10){return this.angleMod=e,this}getAngleMod(){return this.angleMod}getActiveSliceAmount(){const e=this.getModel().getDatasets().length;return this.hasSliceLimit?Math.min(e,this.getSliceLimit()):e}merge(e){return super.merge(e),this.radiusMod=e.radiusMod,this.depthMod=e.depthMod,this.angleMod=e.angleMod,this.sourceAngle=e.sourceAngle,this.endAngle=e.endAngle,this.borderMod=e.borderMod,this.radiusTweenEnabled=e.radiusTweenEnabled,this.depthTweenEnabled=e.depthTweenEnabled,this.colorTweenEnabled=e.colorTweenEnabled,this.sourceAngleTweenEnabled=e.sourceAngleTweenEnabled,this.endAngleTweenEnabled=e.endAngleTweenEnabled,this.borderTweenEnabled=e.borderTweenEnabled,this.pointerOnSlices=e.pointerOnSlices,this.sliceBBupdate=e.sliceBBupdate,this.staticBigSlices=e.staticBigSlices,this.piePopoversEnabled=e.piePopoversEnabled,this.dataSetWatch=e.dataSetWatch,this.replayEnabled=e.replayEnabled,this.sliceLimitEnabled=e.sliceLimitEnabled,this.maxRelevantSlices=e.maxRelevantSlices,this}}t.PieChartSettings=r,t.default=_.constant(r)}),define("classes/canvas_engine/charts/src/implementations/pie_chart",["require","exports","canvas_engine","data_structures","event","reusable_services","reusable_utilities","underscore","services/bubble_dialog","services/configuration","services/tw_common","classes/canvas_engine/charts/src/implementations/default_chart","reusable_services"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){var p;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DESELECT=0]="DESELECT",e[e.SELECTION_CHANGED=1]="SELECTION_CHANGED",e[e.SELECT=2]="SELECT"}(p||(p={}));class h extends g.DefaultChart{constructor(e,t,i,n){super(e,t,i,n),this.emojiCount=0,this.emojisReady=0,this.isReady=!1,this.checkCursorPredicate=((e,t)=>this.containsPoint(e,t)),this.canResetCursor=!0,this.isAnimationActive=!1,this.legendIsClicked=!1,this.disposableSubscriptions=[],this.onReady=new s.Event,this.onSegmentEnter=new s.Event,this.onSegmentLeave=new s.Event,this.onSegmentInflated=new s.Event,this.onSegmentDeflated=new s.Event,this.fadedSegments=[],this.compute()}setCursorPredicate(e){return this.checkCursorPredicate=e,this}setAdditionalFilter(e){return this.additionalfilters=e,this}buildShape(e,t,n,s){return n%360==s%360?this.pie=new i.CircleComponent(new i.Circle(0,0,e,t)):(this.pie=new i.CircleSegmentComponent(new i.CircleSegment(0,0,e,n,s,t)),this.pie.setClassType("PieShape")),this.pie.hide(),this.addComponent(this.pie),this}getSettings(){return super.getSettings()}adjustData(e,t,i){const n=this.getSettings();return n.isSliceBBupdateEnabled()||e.disableBBUpdate(),e.setData(t),this.computeLabel(e),this.setPopoverData(t),n.isDataSetWatchEnabled()&&this.setDataSetWatch(t),void 0!==i&&e.setStageFacade(i),this.addDefaultSegmentAnimation(e),this}adjustOpacity(){return this.getSettings().isInitialAnimationEnabled()&&this.setStyle(i.Style.Opacity,0),this}buildAnimation(e){const t=e.getStyle(i.Style.Color).clone().setSaturation(0),n=this.buildAnimationParams(i.Style.Color,t);return this.animationComponent.tween(e,n,e.getNodeId()),this}greyInOut(e,t,n=!1){if(!n)return this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).forEach(i=>{void 0!==t&&t.getNodeId()===i.getNodeId()||this.applySequence(e,i)}),this;this.applySequence(e,t)}applySequence(e,t){const i=this.animationComponent.accessSequenceFor(t.getNodeId());return i.setReverseState(!e),i.isPlaying()||i.resume(),this}buildSegment(e,t,n,s,o){const r=this.stageFacade,c=this.getStyle(i.Style.EndAngle)-this.getStyle(i.Style.SourceAngle),l=e.getValue(),d=e.getColor(),g=a.isUndefined(t)?{key:i.Style.SourceAngle,target:this}:{key:i.Style.EndAngle,target:t},u=g.target.getStyle(g.key),p=c*l/o+u,h=new i.CircleSegment(0,0,n,u,p,s),m=new i.CircleSegmentComponent(h).setStyle(i.Style.Color,d).setStyle(i.Style.BorderColor,d.clone().lighten(10,!0).setAlpha(.7*d.a)).setStyle(i.Style.BorderThickness,0).setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Outside);this.addComponent(m).addShape(h).adjustData(m,e,r).buildAnimation(m).addFadeoutAnimation(m);m.getData().getId();return m}compute(){this.emojiCount=0,this.emojisReady=0,this.animationComponent=new i.AnimationComponent,this.addComponent(this.animationComponent).clearShape();const e=this.getSettings().getModel(),t=this.getTotalValue(e);let n;if(t>0){this.calculatePercentageValues(e);const s=this.getStyle(i.Style.Radius),o=this.getStyle(i.Style.Depth);this.buildShape(s,o,this.getStyle(i.Style.SourceAngle),this.getStyle(i.Style.EndAngle)),e.getDatasets().forEach((e,i)=>{(!this.getSettings().hasSliceLimit||i<this.getSettings().getSliceLimit())&&(n=this.buildSegment(e,n,s,o,t))}),this.computeReplay(e)}return this}buildFrames(e){const t=e.getAdditionalFrames();let i=0;return t.forEach((e,n)=>{if(0===n){let e=0;const n=function(){return t[i].getDatasets().reduce((e,t)=>Math.max(e,t.getValue()),e)};for(n();0===e;)i++,e=n();this.timeline.addSequence(this.switchModel(t[i],!0,0),0)}else n>i&&this.timeline.addSequence(this.switchModel(e,!0),this.getChartSettings().getTransitionDuration()*(n-i))}),this}computeReplay(e){if(this.getSettings().isReplayEnabled()&&e.hasAdditionalFrames()&&this.getWidget().hasReplayManager()){this.timeline=new i.Timeline,this.buildFrames(e),this.subscriptions.push(this.timeline.onStep.subscribe(()=>{this.calculatePercentageValues(e),this.recomputeSize()}));const t=this.getWidget().getReplayManager().timeline;this.timeline.syncToTimeline(t,!0),this.subscriptions.push(t.onPlay.subscribe(()=>this.isAnimationActive=!0)),this.subscriptions.push(t.onPause.subscribe(()=>{this.isAnimationActive=!1,this.updatePopovers(e)})),this.subscriptions.push(t.onDone.subscribe(()=>{this.isAnimationActive=!1,this.updatePopovers(e)})),this.subscriptions.push(t.onSetProgressCall.subscribe(()=>{this.updatePopovers(e),this.recomputeSize()}))}return this}calculatePercentageValues(e){const t=this.getSettings();t.hasSliceLimit()?n.ModelEnhancer.calculatePercentages(e,t.getNumberFormatter(),t.getSliceLimit()):n.ModelEnhancer.calculatePercentages(e,t.getNumberFormatter())}updatePopovers(e){return this.calculatePercentageValues(e),a.each(e.getDatasets(),e=>{this.setPopoverData(e)}),this}setPopoverData(e){if(this.getSettings().arePiePopoversEnabled()){const t=e.getTendency();let i;e.hasPopOverData()?(i=e.getPopOverData()).clearValues().setTitle(e.getPopoverFooter()).setColor(e.getColor().toHex6()):(i=new n.PopoverData(e.getColor().toHex6(),e.getPopoverFooter(),!0),e.setPopOverData(i));const s=Math.round(e.getValue());if(e.hasOldValue())i.addValue(e.getSubLabel(),d.twCommon.formatNumberValue(s),t),i.setCorner(e.getPercentageValue());else{const t=e.getPopoverValue();e.hasPopoverValue()?i.addValue(e.getSubLabel(),d.twCommon.formatNumberValue(t)):i.addValue(e.getSubLabel(),d.twCommon.formatNumberValue(s))}e.hasAdditionalMetric()&&i.addValue(e.getAdditionalMetric().label,e.getAdditionalMetric().value)}return this}setDataSetWatch(e){return this.getSettings().isDataSetWatchEnabled()&&this.subscriptions.push(e.onChange.subscribe(()=>{this.legendMouseClick(void 0),this.fadedSegments=[],this.recomputeSize(),this.setPopoverData(e)})),this}adjustLabel(e){const t=e.getSegmentLabel(),n=e.getData(),s=n.getLabel();return t instanceof i.ImageComponent||(s!==t.getText()?(t.setText(s),n.hasPopOverData()&&n.getPopOverData().setCorner(s)):t.reformat()),this}buildEmoji(e,t){const n=window.tw.inject("$q").defer();this.emojiCount++,t.setOrigin(i.Constants.Origin.TOP_LEFT);const s=new i.ImageComponent($(e)[0].src,!1,t);return u.emojiService.parseTextForCanvasEmoji(e).then(e=>{s.onLoad.subscribeOnce(()=>{s.buildShape(i.Constants.Shape.Rectangle).setResizeArea(this.getShapes()[0]).setMargin(1).setStyle(i.Style.Radius,this.getSettings().getLabelSettings().getFontSize()/2).setAllowGrowing(!0),this.incrementEmojiReadyCounter(),n.resolve(s)}),s.changeUrl($(e)[0].src)}),n.promise}checkForEmoji(e){const t=o.emojiService.parseTextForEmoji(e);return r.StringUtils.isIMGOnly(t)?t:""}applyPresenceAdaptations(e,t){if(void 0!==e&&!(e instanceof i.CurvedLabelComponent)){e.getPresence().resetCoordinates();const n=t.getRelativeContentCenter();let s;s=e instanceof i.ImageComponent?e.getBoundingBox(!0):e.getBoundingBox(),e.translate(n.getX()-s.width/2,n.getY()-s.height/2),i.ObjectCache.recycleObject(s)}return this}tryAutoOrientation(e,t){if(!this.hasInflatedSegment()&&this.getSettings().isLabelRotationEnabled&&(void 0===e.getOrientation()||!e.fitsInBoundingShape())){const n=e.getOrientation()||i.Constants.Orientation.VERTICAL,s=n===i.Constants.Orientation.VERTICAL?i.Constants.Orientation.HORIZONTAL:i.Constants.Orientation.VERTICAL,o=t.getShape().meanAngle%360;e.setOrientation(s,o),this.applyPresenceAdaptations(e,t),e.fitsInBoundingShape()||(e.setOrientation(n,o),this.applyPresenceAdaptations(e,t))}return this}setTextLabelRotation(e,t){if(this.getSettings().isLabelRotationEnabled&&!(e instanceof i.CurvedLabelComponent)){const n=this.getSettings();e.setStyle(i.Style.RotationOrigin,i.Constants.Origin.CENTER),n.getLabelOrientation()===i.Constants.Orientation.AUTO?(this.tryAutoOrientation(e,t),e.reformat()):e.setOrientation(n.getLabelOrientation(),t.getShape().meanAngle%360)}return this}setLabelInitialAnimation(e){e.setStyle(i.Style.Opacity,0);const t=[{key:i.Style.Opacity,value:1,duration:1e3}];return e.setData(this.animationComponent.tween(e,t,e)),this}setUpLabel(e,t,n){const s=this.stageFacade;return t.setSegmentLabel(e),this.addComponent(e),e instanceof i.CurvedLabelComponent?t.enableComputationOfCentralCurves(!1):this.applyPresenceAdaptations(e,t),void 0!==s&&e.setStageFacade(s),n.isInitialAnimationEnabled()&&this.setLabelInitialAnimation(e),e.setStyle(i.Style.Layer,()=>t.getLayer()+1),e}buildLabel(e,t){const n=i.Presence.zeroTopLeft().setOrigin(i.Constants.Origin.CENTER),s=this.checkForEmoji(t),o=s.length>0,r=window.tw.inject("$q").defer(),a=this.getSettings();let c;if(o)this.buildEmoji(s,n).then(t=>{r.resolve(this.setUpLabel(t,e,a))});else{const s=a.getLabelSettings().clone();c=new i.LabelComponent(n,t,s),a.isInitialAnimationEnabled()&&(c.pauseAdaptation(),c.setStyle(i.Style.Opacity,0)),c.setShapeFetchPredicate(()=>e.getShape()),r.resolve(this.setUpLabel(c,e,a))}return r.promise}buildCurvedLabel(e,t,n){const s=e.getShapes()[0].getCentralPathCurves();n.getFont().setMaxSize(Math.floor(.85*e.getThickness()));const o=e.getShape().meanAngle%360;o<180&&n.setReversedState(!0),o>0&&o<180&&n.flipText(!0);const r=i.CurvedLabelComponent.fromPath(t,s,n);return this.addComponent(r),r}computeLabel(e){const t=e.getData();if(void 0!==e.getSegmentLabel())this.adjustLabel(e);else{let i=t.getLabel();""!==i&&(i=r.StringUtils.replaceUnicodeValues(i),this.buildLabel(e,i))}return this}getPie(){return this.pie}getTotalValue(e){return this.getSettings().hasSliceLimit()?e.getTotal(this.getSettings().getSliceLimit()):e.getTotal()}adjustSegment(e,t,n,s,o,r){const c=e.getData().getValue(),l=e.getData().getColor(),d=a.isUndefined(t)?this.getStyle(i.Style.SourceAngle):t.getStyle(i.Style.EndAngle),g=r*c/o+d;e.getStyleMap().setStyleIfDifferent(i.Style.SourceAngle,d).setStyleIfDifferent(i.Style.EndAngle,g).setStyleIfDifferent(i.Style.Radius,n).setStyleIfDifferent(i.Style.Depth,s).setStyleIfDifferent(i.Style.BorderThickness,0),this.adjustDefaultSegmentAnimation(e).computeLabel(e),e.getStyleMap().hasOwnStyle(i.Style.Color)?e.getStyle(i.Style.Color).extractChroma(l):e.getStyleMap().setStyleIfDifferent(i.Style.Color,l.clone()),e.getStyleMap().hasOwnStyle(i.Style.BorderColor)?e.getStyle(i.Style.BorderColor).extractChroma(l).lighten(10,!0).setAlpha(.7*l.a):e.getStyleMap().setStyleIfDifferent(i.Style.BorderColor,l.clone().lighten(10,!0).setAlpha(.7*l.a)),e.invalidate();e.getData().getId();return e}recomputeSize(){const e=this.getStyle(i.Style.Radius),t=this.getStyle(i.Style.Depth),n=this.getSettings().getModel(),s=this.getTotalValue(n),o=this.getStyle(i.Style.EndAngle)-this.getStyle(i.Style.SourceAngle);if(a.isUndefined(this.getPie())||(this.pie.getStyleMap().setStyleIfDifferent(i.Style.Radius,e),this.pie.getStyleMap().setStyleIfDifferent(i.Style.Depth,t)),s>0){let n;this.queryAllComponents(i=>n=this.adjustSegment(i,n,e,t,s,o),i.Constants.ComponentClasses.CircleSegment)}return this.invalidate(),this}buildAnimationParams(e,t,i=this.getSettings().getAnimationDuration()){return{key:e,value:t,duration:i}}addFadeoutAnimation(e){const t=this.buildAnimationParams(i.Style.Opacity,.3);return this.animationComponent.tween(e,t,this.buildFadeOutId(e.getNodeId())),this}buildFadeOutId(e){return e+"FADE_OUT"}fadeOut(e){const t=this.animationComponent.accessSequenceFor(this.buildFadeOutId(e.getNodeId()));return void 0!==t&&-1===this.fadedSegments.indexOf(e)&&(this.fadedSegments.push(e),t.isReversed()?t.setReverseState(!1):t.reset(),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()),this}fadeIn(e){const t=this.animationComponent.accessSequenceFor(this.buildFadeOutId(e.getNodeId())),n=this.fadedSegments.indexOf(e);return void 0!==t&&n>-1&&(this.fadedSegments.splice(n,1),t.isReversed()?t.reset():t.setReverseState(!0),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()),this}addDefaultSegmentAnimation(e){const t=this.animationComponent.accessSequenceFor(e);a.isUndefined(t)||t.reset();const n=[],s=this.getSettings(),o=e.getStyle(i.Style.EndAngle)-e.getStyle(i.Style.SourceAngle);if(s.isRadiusTweenEnabled()){const e=this.getStyle(i.Style.Radius);n.push(this.buildAnimationParams(i.Style.Radius,e+s.getRadiusMod()))}if(s.isDepthTweenEnabled()){const e=this.getStyle(i.Style.Depth);n.push(this.buildAnimationParams(i.Style.Depth,Math.max(0,e-s.getDepthMod())))}if(s.isSourceAngleTweenEnabled()&&(!s.keepBigSlicesStatic()||o<180)){const t=e.getStyle(i.Style.SourceAngle)-s.getAngleMod();n.push(this.buildAnimationParams(i.Style.SourceAngle,t))}if(s.isEndAngleTweenEnabled()&&(s.keepBigSlicesStatic()||o<180)){const t=e.getStyle(i.Style.EndAngle)+s.getAngleMod();n.push(this.buildAnimationParams(i.Style.EndAngle,t))}if(s.isColorTweenEnabled()){const t=e.getStyle(i.Style.Color).clone().lighten(20);n.push(this.buildAnimationParams(i.Style.Color,t))}if(s.isBorderTweenEnabled()){const t=e.getStyle(i.Style.BorderThickness)+s.getBorderMod();n.push(this.buildAnimationParams(i.Style.BorderThickness,t))}return n.length>0&&(this.animationComponent.unregisterSequence(e),this.animationComponent.tween(e,n,e)),this}adjustDefaultSegmentAnimation(e){const t=this.animationComponent.accessSequenceFor(e);if(a.isUndefined(t))return this.addDefaultSegmentAnimation(e);{t.reset();const n=t.getAnimations()[0].getModels(),s=this.getSettings(),o=e.getStyle(i.Style.EndAngle)-e.getStyle(i.Style.SourceAngle);if(s.isRadiusTweenEnabled()){const e=n.filter(e=>e.key===i.Style.Radius)[0];void 0!==e&&e.setValue(this.getStyle(i.Style.Radius)+s.getRadiusMod())}if(s.isDepthTweenEnabled()){const e=n.filter(e=>e.key===i.Style.Depth)[0];void 0!==e&&e.setValue(this.getStyle(i.Style.Depth)-s.getDepthMod())}if(s.isSourceAngleTweenEnabled()&&(!s.keepBigSlicesStatic()||o<180)){const t=n.filter(e=>e.key===i.Style.SourceAngle)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.SourceAngle)-s.getAngleMod())}if(s.isEndAngleTweenEnabled()&&(s.keepBigSlicesStatic()||o<180)){const t=n.filter(e=>e.key===i.Style.EndAngle)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.EndAngle)+s.getAngleMod())}if(s.isColorTweenEnabled()){const t=n.filter(e=>e.key===i.Style.Color)[0];void 0!==t&&t.getValue().extractChroma(e.getStyle(i.Style.Color)).lighten(20)}if(s.isBorderTweenEnabled()){const t=n.filter(e=>e.key===i.Style.BorderThickness)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.BorderThickness)+s.getBorderMod())}return this}}normalizeDatasets(e,t,s){if(s.length>t.length){const o=s.length-t.length;for(let t=0;t<o;t++){const t=new n.Dataset(0,new r.Color);t.setOldValue(0),e.addDataset(t),this.setPopoverData(t).setDataSetWatch(t);const s=new i.CircleSegmentComponent(new i.CircleSegment(0,0,0,0,0,0)).setStyle(i.Style.Color,new r.Color).setData(t);this.buildLabel(s,"0").then(e=>{e.setDefaultStyle(i.Style.Opacity),this.addComponents([s,e]).addSegmentEvents(s)})}}return this}buildTransitionChain(e,t,i,n,s=this.getSettings().getTransitionDuration()){return t.forEach((t,o)=>{const a=[],c=i[o];t.hasOldValue()||t.setOldValue(0),void 0!==c?(a.push(this.buildAnimationParams("value",c.getValue(),s)),c.hasOldValue()&&a.push(this.buildAnimationParams("oldValue",c.getOldValue(),s)),a.push(this.buildAnimationParams("color",c.getColor(),s))):(a.push(this.buildAnimationParams("value",0,s)),a.push(this.buildAnimationParams("oldValue",0,s)),a.push(this.buildAnimationParams("color",r.Color.TRANSPARENT_COLOR(),s))),n.chainSequence(this.animationComponent.tween(t,a,t.getId()+e.getId()))}),this}checkAnimationState(){void 0!==this.activeTransitionSequence&&this.activeTransitionSequence.isPlaying()&&(this.activeTransitionSequence.stop(),this.activeTransitionSequence.onDone.fire(),this.animationComponent.unregisterSequence(this.activeTransitionSequence),this.activeTransitionSequence=void 0)}switchModel(e,t=!1,n){this.checkAnimationState(),this.hasStageFacade()&&this.legendMouseClick(void 0),this.fadedSegments=[];const s=[this.buildAnimationParams(i.Style.Phantom,Math.round(10*Math.random()),this.getSettings().getTransitionDuration())],o=this.animationComponent.tween(this,s,"transition"+e.getId()),r=this.getSettings().getModel();let a=r.getDatasets();const c=e.getDatasets();this.normalizeDatasets(r,a,c),a=r.getDatasets(),this.buildTransitionChain(e,a,c,o,n);const l=()=>{this.isDisposed()||(this.getSettings().isValueRecalculationAllowed&&this.calculatePercentageValues(r),this.recomputeSize())};this.activeTransitionSequence=o;let d=this.subscriptions;return t||((d=this.disposableSubscriptions).forEach(e=>e.cancel()),d.length=0),d.push(o.onDone.subscribe(()=>{this.isAnimationActive=!1,c.forEach((e,t)=>{t<a.length&&(a[t].merge(e),this.setPopoverData(a[t]))}),l(),this.queryAllComponents(e=>this.addDefaultSegmentAnimation(e),i.Constants.ComponentClasses.CircleSegment),this.activeTransitionSequence=void 0,this.animationComponent.unregisterSequence(o)})),d.push(o.onStop.subscribe(l.bind(this))),d.push(o.onAnimationStep.subscribe(l.bind(this))),t?(o.onPlay.subscribe(()=>this.isAnimationActive=!0),o):(this.isAnimationActive=!0,void o.resume())}runAnimation(e){const t=this.getChartSettings();this.animationComponent.hasSequenceFor(this)&&this.animationComponent.unregisterSequence(this),this.isAnimationActive=!0;const n=this.getStyle(i.Style.EndAngle);this.setStyle(i.Style.EndAngle,this.getStyle(i.Style.SourceAngle)+1);const s=t.getTransitionDuration(),o=[this.buildAnimationParams(i.Style.EndAngle,n,s),this.buildAnimationParams(i.Style.Opacity,1,s)];this.getStageFacade().getActiveCamera();this.setData(this.animationComponent.tween(this,o,this));const r=this.getData().onDone.subscribe(()=>{this.animationComponent.unregisterSequence(this),e.forEach((t,n)=>{const s=t.getSegmentLabel(),o=s.getData();s instanceof i.LabelComponent&&(s instanceof i.CurvedLabelComponent?(t.enableComputationOfCentralCurves(!0),s.reformat()):s.resumeAdaptation()),s instanceof i.ImageComponent&&this.applyPresenceAdaptations(s,t),o.onDone.subscribeOnce(()=>{this.animationComponent.unregisterSequence(o),n===e.length-1&&(this.isAnimationActive=!1),this.hasStageFacade()&&this.getStageFacade().processUpdate()}),s.setStyle(i.Style.Opacity,.01),s.update(),s instanceof i.LabelComponent&&s.resumeConditionalHide(),o.resume()}),this.getStageFacade().unblockEvents(),r.cancel()});this.getData().resume()}animate(){const e=this.getChartSettings(),t=this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment);return t.forEach(t=>{const n=t.getSegmentLabel();n instanceof i.LabelComponent&&(this.setTextLabelRotation(n,t),n.onFontSizeAdapted.subscribe(e=>{this.tryAutoOrientation(e,t),this.applyPresenceAdaptations(e,t)}),n.onBeforeApplyAdaptations.subscribe(e=>{this.tryAutoOrientation(e,t),this.applyPresenceAdaptations(e,t)}),n.onMultilineAdapted.subscribe(e=>{this.tryAutoOrientation(e,t),this.applyPresenceAdaptations(e,t)}),n.show(),e.isInitialAnimationEnabled()?(n.pauseConditionalHide(),n.setStyle(i.Style.Opacity,0)):(n.forceApplyAdaptations(this.getStageFacade().getActiveCamera()),void 0!==n&&this.applyPresenceAdaptations(n,t)))}),this.animationComponent.reset(),e.isInitialAnimationEnabled()&&this.runAnimation(t),this}addEvents(){const e=this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment);return this.getSettings().isInitialAnimationEnabled()&&this.getStageFacade().blockEvents(),this.subscriptions.push(this.onMouseEnter.subscribe(this.setCursor.bind(this))),this.subscriptions.push(this.onMouseLeave.subscribe(this.resetCursor.bind(this))),this.setInteractiveState(!0),e.forEach(e=>this.addSegmentEvents(e)),this.invalidate(),this}getLegendClickAction(e){return this.legendIsClicked&&e===this.getInflatedSegment()?p.DESELECT:this.legendIsClicked&&e!==this.getInflatedSegment()?p.SELECTION_CHANGED:p.SELECT}legendMouseClick(e){const t=this.getSegmentById(e);if(void 0!==t)switch(this.getLegendClickAction(t)){case p.DESELECT:this.legendIsClicked=!1,this.queryAllComponents(e=>{e!==t&&this.fadeIn(e)},i.Constants.ComponentClasses.CircleSegment);break;case p.SELECTION_CHANGED:this.legendIsClicked=!1,void 0!==this.getInflatedSegment()&&(this.fadeOut(this.getInflatedSegment()),this.handleSegmentLeave(this.getInflatedSegment(),void 0,!0)),this.fadeIn(t),this.handleSegmentEnter(t),this.legendIsClicked=!0;break;case p.SELECT:default:this.queryAllComponents(e=>{e!==t&&this.fadeOut(e)},i.Constants.ComponentClasses.CircleSegment),this.legendIsClicked=!0}else this.legendIsClicked=!1,this.queryAllComponents(e=>{this.fadeIn(e)},i.Constants.ComponentClasses.CircleSegment)}getSegmentById(e){return this.getAllComponentsOf("CircleSegment").filter(t=>t.getData().getId()===e)[0]}legendMouseEnter(e){if(!this.legendIsClicked){const t=this.getSegmentById(e);void 0!==t&&this.handleSegmentEnter(t,!0)}}legendMouseLeave(e){if(!this.legendIsClicked){const t=this.getSegmentById(e);void 0!==t&&this.handleSegmentLeave(t,!0)}}showBubble(e){if(this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer){void 0!==this.bubbleOwner&&this.closePopover();const t=this.getStageFacade().getActiveCamera();void 0!==t&&this.openPopover(t,e,this.getStageFacade().getCanvas());const i=e.getDoneSub();void 0!==i&&(i.cancel(),e.setDoneSub(void 0))}return this}handleSegmentEnter(e,t=!1){if(this.showBubble(e),!this.legendIsClicked&&this.inflatedSegment!==e){if(!e.getStyleMap().isFunctionStyle(i.Style.Layer)){const t=this.getStageFacade().getActiveCamera().getLayerAmount();e.setStyle(i.Style.Layer,e=>Math.min(e+2,t))}const n=e.getSegmentLabel();if(n instanceof i.LabelComponent&&n.pauseConditionalHide(),(this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer)&&(e.setIsInflated(!0),this.getStageFacade().activate(),this.animationComponent.hasSequenceFor(e))){let n=e.getSequence();void 0===n&&(e.setSequence(this.animationComponent.accessSequenceFor(e)),n=e.getSequence()),n.onDone.subscribeOnce(()=>{const t=e.getSegmentLabel();t instanceof i.LabelComponent&&t.formatText()}),n.getState()!==i.Constants.State.Animation.Playing?(n.reset(),n.resume()):n.setReverseState(!1),this.setInflatedSegment(e),t||this.onSegmentInflated.fire(e.getData().getId())}}return this}handleSegmentLeave(e,t,n=!1){if(this.bubbleOwner===e&&this.closePopover(),!this.legendIsClicked){this.onSegmentLeave.fire(e,t),this.isInflatedSegment(e)&&this.setInflatedSegment(void 0);const s=e.getSequence();void 0!==s&&(s.setReverseState(!0),void 0===e.getDoneSub()&&e.setDoneSub(s.onDone.subscribe(()=>{a.isUndefined(s)||(s.isReversed()&&e.setSequence(void 0),e.getDoneSub().cancel(),e.setDoneSub(void 0));const t=e.getSegmentLabel();t instanceof i.LabelComponent&&(t.formatText(),t.resumeConditionalHide()),this.getSettings().shouldClearLayerOnMouseOutAnimationEnd()&&e.setStyle(i.Style.Layer,this.getStyleMap()),this.getStageFacade().deActivate()})),s.isPlaying()?Date.now()-e.lastAnimation>1e6&&s.reset():s.resume()),n||this.onSegmentDeflated.fire(e.getData().getId()),this.getSettings().shouldClearLayerOnMouseOutAnimationEnd()||e.setStyle(i.Style.Layer,this.getStyleMap()),e.invalidate()}return this}addSegmentEvents(e){return e.getData().areEventsDisabled()||(e.setInteractiveState(!0),this.subscriptions.push(e.onMouseEnter.subscribe(t=>{this.onSegmentEnter.fire(e,t),this.isAnimationActive||this.hasInflatedSegment()&&!this.legendIsClicked||this.handleSegmentEnter(e)})),this.subscriptions.push(e.onMouseClick.subscribe(()=>{if(this.getSettings().isPointerOnSliceEnabled()&&this.inflatedSegment===e&&i.Utilities.compareToMultipleSingleMatch(this.getStageFacade().getCanvas().style.cursor,[i.Constants.Mouse.Cursor.Default,i.Constants.Mouse.Cursor.Pointer],i.Constants.Comparators.Equal)){const t=e.getData().getFilters();a.isUndefined(t)||this.getStageFacade().isInteractionBlocked||this.widget.getDataGraph()&&this.widget.getDataGraph().payloadDataGraph&&this.widget.getDataGraph().payloadDataGraph.rows&&this.widget.getDataGraph().payloadDataGraph.rows.some(e=>e.drilldown_disabled)||this.openDrilldown(t)}})),this.subscriptions.push(e.onMouseMove.subscribe(()=>{this.hasInflatedSegment()||e.onMouseEnter.fire()})),this.subscriptions.push(e.onMouseLeave.subscribe(t=>this.handleSegmentLeave(e,t))),this.subscriptions.push(this.getStageFacade().onHoverEnd.subscribe(e=>{setTimeout(()=>{this.hasInflatedSegment()&&this.bubble&&!this.bubble.isMouseOver()&&this.handleSegmentLeave(this.getInflatedSegment(),e)},100)}))),this}setCursor(){if(this.getSettings().isPointerOnSliceEnabled()&&!this.getStageFacade().isCursorPointer()){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());this.checkCursorPredicate(n,t)&&this.getStageFacade().setCursor(i.Constants.Mouse.Cursor.Pointer),i.ObjectCache.recycleObject(n)}return this}resetCursor(){if(this.getSettings().isPointerOnSliceEnabled()){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());this.canResetCursor&&!this.checkCursorPredicate(n,t)&&this.getStageFacade().resetCursor(),i.ObjectCache.recycleObject(n)}return this}revert(){return this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).forEach(e=>e.onMouseLeave.fire()),this}verifyStyleChange(e){if(super.verifyStyleChange(e),e===i.Style.Radius||e===i.Style.Depth||e===i.Style.SourceAngle||e===i.Style.EndAngle){const e=this.getInflatedSegment();if(void 0!==e){const t=e.getSequence();void 0!==t&&(t.stop(),e.resetStyle(i.Style.Layer),t.reset(),e.setSequence(void 0))}this.recomputeSize()}}openPopover(e,t,n){const s=this.getSettings();if(s.arePiePopoversEnabled()){c.bubbleDialogService.destroyById(s.getBubbleId());const o=l.configurationService.getBubbleDialogConfiguration().getStyle(s.getBubbleId()),r=i.ObjectCache.PointPool.getObject().addFast(t.getContentCenter()).addFast(this.getPresence()),a=t.getBoundingBox();r.setX(a.getX());const g=e.cameraToWindowCoordinates(r.getX(),r.getY());o.setArrowSide(d.twCommon.sides.RIGHT),o.setVirtualObjectPresence(a.getWidth()+2*(s.getAngleMod()+s.getBorderMod()),a.getHeight()+2*(s.getAngleMod()+s.getBorderMod())),o.setAbsoluteXOrigin(d.twCommon.sides.LEFT),o.setAbsoluteYOrigin(d.twCommon.sides.CENTER),o.setAbsoluteX(g.getX()),o.setAbsoluteY(g.getY()),o.setPositionOffsetX(0),o.setPositionOffsetY(0),i.ObjectCache.recycleObjects([r,g,a]);const u=c.bubbleDialogService.createByType(s.getBubbleId(),$(n),s.getBubbleType(),t.getData().getPopOverData().build(),o);u.onDestroy.subscribe(()=>{this.bubbleOwner===t&&(this.bubbleOwner=void 0),this.bubble===u&&(this.bubble=void 0)}),u.onMouseEnter.subscribe(this.handleBubbleEnter.bind(this,u,t)),this.bubbleOwner=t,this.bubble=u}return this}handleBubbleEnter(e,t){e.onMouseLeave.subscribeOnce(()=>{this.hasInflatedSegment()&&t===this.getInflatedSegment()&&this.handleSegmentLeave(t,void 0)})}draw(e){this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).map(e=>{const t=e.getSegmentLabel();if(this.applyPresenceAdaptations(t,e),!this.isAnimationActive&&t instanceof i.ImageComponent&&t.hasShapes()){const i=e.getShapes()[0],n=t.getShapes()[0].clone();n.setCoordinates(t.getPresence().getRelativeX(),t.getPresence().getRelativeY());const s=t.fitsIn(i,n);t.isHidden()&&s?t.show():t.isHidden()||s||t.hide()}}),this.getSettings().getModel().getTotal()>0?this.isHidden()&&this.show():this.isHidden()||this.hide(),super.draw(e)}ready(){return this.isReady}incrementEmojiReadyCounter(){this.emojisReady++,this.hasStageFacade()&&this.getStageFacade().processUpdate()}update(){!this.isReady&&this.emojiCount<=this.emojisReady&&!this.isAnimationActive&&(this.isReady=!0,this.getStageFacade().onDrawEnd.subscribeOnce(()=>{this.onReady.fire()})),super.update()}closePopover(){return this.getSettings().arePiePopoversEnabled()&&c.bubbleDialogService.scheduleDestructionById(this.getSettings().getBubbleId(),500),this}hasInflatedSegment(){return void 0!==this.inflatedSegment}getInflatedSegment(){return this.inflatedSegment}setInflatedSegment(e){return this.inflatedSegment=e,this}isInflatedSegment(e){return this.getInflatedSegment()===e}dispose(){this.disposed=!0,void 0!==this.timeline&&(this.timeline.unsync(),this.timeline.dispose()),this.onReady.cancelAll(),this.onSegmentDeflated.cancelAll(),this.onSegmentInflated.cancelAll(),this.onSegmentEnter.cancelAll(),this.onSegmentLeave.cancelAll(),this.closePopover(),super.dispose()}}t.PieChart=h,t.default=a.constant(h)}),define("classes/canvas_engine/settings/charts/wheel_chart_settings",["require","exports","jquery","classes/canvas_engine/settings/charts/pie_chart_settings"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends n.PieChartSettings{constructor(e){super(e),this.labelType=o.default,this.minArcRange=0,this.maxArcRange=72}static fromJson(e){const t=super.fromJson(e,{},s);return t.labelType=e.labelType,t.minArcRange=e.minArcRange,t.maxArcRange=e.maxArcRange,t}toJson(){return i.extend(super.toJson(),{labelType:this.labelType,minArcRange:this.minArcRange,maxArcRange:this.maxArcRange})}merge(e){return super.merge(e),this.labelType=e.labelType,this.minArcRange=e.minArcRange,this.maxArcRange=e.maxArcRange,this}setLabelType(e=o.default){return this.labelType=e,this}getLabelType(){return this.labelType}setMinArcRange(e=0){return this.minArcRange=Math.min(e,this.maxArcRange),this}getMinArcRange(){return this.minArcRange}}var o;t.WheelChartSettings=s,function(e){e.default="DEFAULT",e.curved="CURVED",e.vertical="VERTICAL"}(o=t.LabelType||(t.LabelType={})),t.default=_.constant(n.PieChartSettings)}),define("classes/canvas_engine/charts/src/models/wheel_chart_model",["require","exports","data_structures","map","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o extends i.AbstractDatamodel{constructor(e,t=!1,s=!1){if(super(e),this.modelMap=new n.Map,this.isMultiLayered=!1,void 0!==e.chart_data_graph?this.datagraph=new i.DataGraphWrapper(e.chart_data_graph):void 0!==e.data_graph?this.datagraph=new i.DataGraphWrapper(e.data_graph):e instanceof i.DataGraphWrapper&&(this.datagraph=e),this.datagraph.getColumns().length>1){this.isMultiLayered=!0;const e=[];this.datagraph.getColumns().forEach((t,n)=>{const s=t.toDataset();e.push([]),this.datagraph.getRows().forEach(o=>{const r=o.getCells()[n],a=new i.Dataset(r.getNumericData(),s.getColor().clone());a.setSubLabel(t.getLabel()).setLabel(o.getLabel()).setId(o.getCode()).setPopoverFooter(o.getLabel()).setOldValue(r.getOldNumericData()).setFilters(o.getFilters()).setAdditionalMetric(r.getAdditionalMetric()),e[n].push(a)});const o=new i.Datamodel(e[n]);o.enableDefaultLabels(this.allowsDefaultLabels).sort(),this.modelMap.set(s,o),this.addDataset(s)}),this.sort()}else this.addDatasets(new i.Datamodel(this.datagraph).getDatasets());t||this.datagraph.getAdditionalFrames().forEach(e=>this.additionalFrames.push(new o(e))),s||(this.original=new o(this.datagraph,!0,!0)),this.isSampleData=this.datagraph.isSampleData(),this.setLabel(this.datagraph.getLabel())}enableDefaultLabels(e){return this.modelMap.forEach(t=>t.enableDefaultLabels(e)),super.enableDefaultLabels(e),this}getSubModel(e){return this.modelMap.get(e)}}t.WheelChartModel=o,t.default=s.constant(o)}),define("classes/canvas_engine/charts/src/implementations/wheel_pie",["require","exports","canvas_engine","data_structures","event","reusable_services","reusable_utilities","underscore","services/bubble_dialog","services/configuration","services/tw_common","classes/canvas_engine/settings/charts/wheel_chart_settings","classes/canvas_engine/charts/src/implementations/default_chart","reusable_services"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){var h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DESELECT=0]="DESELECT",e[e.SELECTION_CHANGED=1]="SELECTION_CHANGED",e[e.SELECT=2]="SELECT"}(h||(h={}));t.WheelPie=class extends u.DefaultChart{constructor(e,t,i,n){super(e,t,i,n),this.emojiCount=0,this.emojisReady=0,this.isReady=!1,this.checkCursorPredicate=((e,t)=>this.containsPoint(e,t)),this.canResetCursor=!0,this.isAnimationActive=!1,this.legendIsClicked=!1,this.disposableSubscriptions=[],this.onReady=new s.Event,this.onSegmentEnter=new s.Event,this.onSegmentLeave=new s.Event,this.onSegmentInflated=new s.Event,this.onSegmentDeflated=new s.Event,this.fadedSegments=[],this.compute()}setCursorPredicate(e){return this.checkCursorPredicate=e,this}setAdditionalFilter(e){return this.additionalfilters=e,this}buildShape(e,t,n,s){return n%360==s%360?this.pie=new i.CircleComponent(new i.Circle(0,0,e,t)):(this.pie=new i.CircleSegmentComponent(new i.CircleSegment(0,0,e,n,s,t)),this.pie.setClassType("PieShape")),this.pie.hide(),this.addComponent(this.pie),this}getSettings(){return super.getSettings()}adjustData(e,t,i){const n=this.getSettings();return n.isSliceBBupdateEnabled()||e.disableBBUpdate(),e.setData(t),this.computeLabel(e),this.setPopoverData(t),n.isDataSetWatchEnabled()&&this.setDataSetWatch(t),void 0!==i&&e.setStageFacade(i),this.addDefaultSegmentAnimation(e),this}buildAnimation(e){const t=e.getStyle(i.Style.Color).clone().setSaturation(0),n=this.buildAnimationParams(i.Style.Color,t);return this.animationComponent.tween(e,n,e.getNodeId()),this}greyInOut(e,t,n=!1){if(!n)return this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).forEach(i=>{void 0!==t&&t.getNodeId()===i.getNodeId()||this.applySequence(e,i)}),this;this.applySequence(e,t)}applySequence(e,t){const i=this.animationComponent.accessSequenceFor(t.getNodeId());return i.setReverseState(!e),i.isPlaying()||i.resume(),this}buildSegment(e,t,n,s,o){const r=this.stageFacade,c=e.getColor(),l=a.isUndefined(t)?{key:i.Style.SourceAngle,target:this}:{key:i.Style.EndAngle,target:t},d=l.target.getStyle(l.key),u=o+d,p=new i.CircleSegment(0,0,n,d,u,s,this.getSettings().getLabelType()===g.LabelType.curved),h=new i.CircleSegmentComponent(p).setStyle(i.Style.Color,c).setStyle(i.Style.BorderColor,c.clone().lighten(10,!0).setAlpha(.7*c.a)).setStyle(i.Style.BorderThickness,0).setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Outside);this.addComponent(h).addShape(p).adjustData(h,e,r).buildAnimation(h).addFadeoutAnimation(h);const m=h.getData().getPopoverFooter();return void 0!==m&&(this.segmentMap[m]=h),h}calculateArcRange(e,t){const n=this.getSettings(),s=n.getMinArcRange(),o=this.getStyle(i.Style.EndAngle)-this.getStyle(i.Style.SourceAngle),r=e.getValue()/t,a=o-n.getActiveSliceAmount()*s;return Math.max(s+a*r,0)}compute(){this.emojiCount=0,this.emojisReady=0,this.segmentMap={},this.animationComponent=new i.AnimationComponent,this.addComponent(this.animationComponent).clearShape();const e=this.getSettings().getModel(),t=this.getTotalValue(e);let n;if(t>0){this.calculatePercentageValues(e);const s=this.getStyle(i.Style.Radius),o=this.getStyle(i.Style.Depth);this.buildShape(s,o,this.getStyle(i.Style.SourceAngle),this.getStyle(i.Style.EndAngle)),e.getDatasets().forEach((e,i)=>{if(!this.getSettings().hasSliceLimit||i<this.getSettings().getSliceLimit()){const i=this.calculateArcRange(e,t);n=this.buildSegment(e,n,s,o,i)}}),this.computeReplay(e)}return this}buildFrames(e){const t=e.getAdditionalFrames();let i=0;return t.forEach((e,n)=>{if(0===n){let e=0;const n=function(){return t[i].getDatasets().reduce((e,t)=>Math.max(e,t.getValue()),e)};for(n();0===e;)i++,e=n();this.timeline.addSequence(this.switchModel(t[i],!0,0),0)}else n>i&&this.timeline.addSequence(this.switchModel(e,!0),this.getChartSettings().getTransitionDuration()*(n-i))}),this}computeReplay(e){if(this.getSettings().isReplayEnabled()&&e.hasAdditionalFrames()&&this.getWidget().hasReplayManager()){this.timeline=new i.Timeline,this.buildFrames(e),this.subscriptions.push(this.timeline.onStep.subscribe(()=>{this.calculatePercentageValues(e),this.recomputeSize()}));const t=this.getWidget().getReplayManager().timeline;this.timeline.syncToTimeline(t,!0),this.subscriptions.push(t.onPlay.subscribe(()=>this.isAnimationActive=!0)),this.subscriptions.push(t.onPause.subscribe(()=>{this.isAnimationActive=!1,this.updatePopovers(e)})),this.subscriptions.push(t.onDone.subscribe(()=>{this.isAnimationActive=!1,this.updatePopovers(e)})),this.subscriptions.push(t.onSetProgressCall.subscribe(()=>{this.updatePopovers(e),this.recomputeSize()}))}return this}calculatePercentageValues(e){const t=this.getSettings();t.hasSliceLimit()?n.ModelEnhancer.calculatePercentages(e,t.getNumberFormatter(),t.getSliceLimit()):n.ModelEnhancer.calculatePercentages(e,t.getNumberFormatter())}updatePopovers(e){return this.calculatePercentageValues(e),a.each(e.getDatasets(),e=>{this.setPopoverData(e)}),this}setPopoverData(e){if(this.getSettings().arePiePopoversEnabled()){const t=e.getTendency();let i;e.hasPopOverData()?(i=e.getPopOverData()).clearValues().setTitle(e.getPopoverFooter()).setColor(e.getColor().toHex6()):(i=new n.PopoverData(e.getColor().toHex6(),e.getPopoverFooter(),!0),e.setPopOverData(i));const s=Math.round(e.getValue());if(e.hasOldValue()){const n=this.isBestThemesWheel()?"% occurance":e.getSubLabel();i.addValue(n,d.twCommon.formatNumberValue(s),t),i.setCorner(e.getPercentageValue())}else{const t=e.getPopoverValue();e.hasPopoverValue()?i.addValue(e.getSubLabel(),d.twCommon.formatNumberValue(t)):i.addValue(e.getSubLabel(),d.twCommon.formatNumberValue(s))}e.hasAdditionalMetric()&&i.addValue(e.getAdditionalMetric().label,e.getAdditionalMetric().value)}return this}setDataSetWatch(e){return this.getSettings().isDataSetWatchEnabled()&&this.subscriptions.push(e.onChange.subscribe(()=>{this.legendMouseClick(void 0),this.fadedSegments=[],this.recomputeSize(),this.setPopoverData(e)})),this}adjustLabel(e){const t=e.getSegmentLabel(),n=e.getData(),s=n.getLabel();return t instanceof i.ImageComponent||(s!==t.getText()?(t.setText(s),n.hasPopOverData()&&n.getPopOverData().setCorner(s)):t.reformat()),this}buildEmoji(e,t,n,s){return new Promise(o=>{this.emojiCount++,n.setOrigin(i.Constants.Origin.TOP_LEFT);const r=new i.ImageComponent($(t)[0].src,!1,n);p.emojiService.parseTextForCanvasEmoji(e).then(e=>{r.onLoad.subscribeOnce(()=>{r.buildShape(i.Constants.Shape.Rectangle).setResizeArea(this.getShapes()[0]).setMargin(1).setStyle(i.Style.Radius,s/2.2).setAllowGrowing(!0).setAllowShrinking(!0),this.incrementEmojiReadyCounter(),o(r)}),r.changeUrl($(e)[0].src),r.setOrigin(i.Constants.Origin.CENTER)})})}checkForEmoji(e){const t=o.emojiService.parseTextForEmoji(e);return r.StringUtils.isIMGOnly(t)?t:""}setTextLabelRotation(e,t){if(this.getSettings().isLabelRotationEnabled&&!(e instanceof i.CurvedLabelComponent)){const n=this.getSettings();e.setStyle(i.Style.RotationOrigin,i.Constants.Origin.CENTER);let s=t.getShape().meanAngle%360;e.setOrientation(n.getLabelOrientation(),-s),s>90&&s<270&&(s+=180),e.setStyle(i.Style.RotationAngle,-s)}return this}setLabelInitialAnimation(e){e.setStyle(i.Style.Opacity,0);const t=[{key:i.Style.Opacity,value:1,duration:1e3}];return e.setData(this.animationComponent.tween(e,t,e)),this}setUpLabel(e,t,n){const s=this.stageFacade;return t.setSegmentLabel(e),this.addComponent(e),e instanceof i.CurvedLabelComponent&&t.enableComputationOfCentralCurves(!1),void 0!==s&&e.setStageFacade(s),n.isInitialAnimationEnabled()&&this.setLabelInitialAnimation(e),e.setStyle(i.Style.Layer,()=>t.getLayer()+1),e}buildLabel(e,t){t.length>12&&(t=t.substring(0,12)+"...");const n=e.getContentCenter(),s=i.Presence.fromPoint(n),o=this.checkForEmoji(t),a=o.length>0,c=this.getSettings();return new Promise(n=>{let l;if(a)this.buildEmoji(t,o,s,e.getContentDiameter()).then(t=>{n(this.setUpLabel(t,e,c))});else{const o=c.getLabelSettings().clone();if(c.getLabelType()===g.LabelType.curved){l=this.buildCurvedLabel(e,t,o);const n=Math.floor(e.getShape().arcAngle/90),s=o.getShadowBlur()*Math.min(1,n);l.setStyle(i.Style.ShadowBlur,Math.floor(s))}else c.getLabelType()===g.LabelType.vertical&&o.setFontSize(13).setAdaptive(!1).setColor(r.Color.BLACK(.7)).setAdaptiveMultiLine(!1).showOnFit(!1).setOrigin(i.Constants.Origin.CENTER),l=new i.LabelComponent(s,t,o),this.setTextLabelRotation(l,e),c.isInitialAnimationEnabled()&&(l.pauseAdaptation(),l.setStyle(i.Style.Opacity,0)),l.setShapeFetchPredicate(()=>e.getShape());n(this.setUpLabel(l,e,c))}})}buildCurvedLabel(e,t,n){const s=e.getShapes()[0].getCentralPathCurves();n.getFont().setMaxSize(Math.floor(.85*e.getThickness()));const o=e.getShape().meanAngle%360;o>0&&o<180&&(n.setReversedState(!0),n.flipText(!0));const r=i.CurvedLabelComponent.fromPath(t,s,n);return this.addComponent(r),r}computeLabel(e){const t=e.getData();if(void 0!==e.getSegmentLabel())this.adjustLabel(e);else{let i=t.getLabel();""!==i&&(i=r.StringUtils.replaceUnicodeValues(i),this.buildLabel(e,i))}return this}getPie(){return this.pie}getTotalValue(e){return this.getSettings().hasSliceLimit()?e.getTotal(this.getSettings().getSliceLimit()):e.getTotal()}adjustSegment(e,t,n,s,o){const r=e.getData().getColor(),c=a.isUndefined(t)?this.getStyle(i.Style.SourceAngle):t.getStyle(i.Style.EndAngle),l=o+c;e.getStyleMap().setStyleIfDifferent(i.Style.SourceAngle,c).setStyleIfDifferent(i.Style.EndAngle,l).setStyleIfDifferent(i.Style.Radius,n).setStyleIfDifferent(i.Style.Depth,s).setStyleIfDifferent(i.Style.BorderThickness,0),this.adjustDefaultSegmentAnimation(e).computeLabel(e),e.getStyleMap().hasOwnStyle(i.Style.Color)?e.getStyle(i.Style.Color).extractChroma(r):e.getStyleMap().setStyleIfDifferent(i.Style.Color,r.clone()),e.getStyleMap().hasOwnStyle(i.Style.BorderColor)?e.getStyle(i.Style.BorderColor).extractChroma(r).lighten(10,!0).setAlpha(.7*r.a):e.getStyleMap().setStyleIfDifferent(i.Style.BorderColor,r.clone().lighten(10,!0).setAlpha(.7*r.a)),e.invalidate();const d=e.getData().getPopoverFooter();return void 0!==d&&(this.segmentMap[d]=e),e}recomputeSize(){const e=this.getStyle(i.Style.Radius),t=this.getStyle(i.Style.Depth),n=this.getSettings().getModel(),s=this.getTotalValue(n);if(a.isUndefined(this.getPie())||(this.pie.getStyleMap().setStyleIfDifferent(i.Style.Radius,e),this.pie.getStyleMap().setStyleIfDifferent(i.Style.Depth,t)),s>0){let n;this.segmentMap={},this.queryAllComponents(i=>n=this.adjustSegment(i,n,e,t,this.calculateArcRange(i.getData(),s)),i.Constants.ComponentClasses.CircleSegment)}return this.invalidate(),this}buildAnimationParams(e,t,i=this.getSettings().getAnimationDuration()){return{key:e,value:t,duration:i}}addFadeoutAnimation(e){const t=this.buildAnimationParams(i.Style.Opacity,.3);return this.animationComponent.tween(e,t,this.buildFadeOutId(e.getNodeId())),this}buildFadeOutId(e){return e+"FADE_OUT"}fadeOut(e){const t=this.animationComponent.accessSequenceFor(this.buildFadeOutId(e.getNodeId()));return void 0!==t&&-1===this.fadedSegments.indexOf(e)&&(this.fadedSegments.push(e),t.isReversed()?t.setReverseState(!1):t.reset(),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()),this}fadeIn(e){const t=this.animationComponent.accessSequenceFor(this.buildFadeOutId(e.getNodeId())),n=this.fadedSegments.indexOf(e);return void 0!==t&&n>-1&&(this.fadedSegments.splice(n,1),t.isReversed()?t.reset():t.setReverseState(!0),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()),this}addDefaultSegmentAnimation(e){const t=this.animationComponent.accessSequenceFor(e);a.isUndefined(t)||t.reset();const n=[],s=this.getSettings(),o=e.getStyle(i.Style.EndAngle)-e.getStyle(i.Style.SourceAngle);if(s.isRadiusTweenEnabled()){const e=this.getStyle(i.Style.Radius);n.push(this.buildAnimationParams(i.Style.Radius,e+s.getRadiusMod()))}if(s.isDepthTweenEnabled()){const e=this.getStyle(i.Style.Depth);n.push(this.buildAnimationParams(i.Style.Depth,Math.max(0,e-s.getDepthMod())))}if(s.isSourceAngleTweenEnabled()&&(!s.keepBigSlicesStatic()||o<180)){const t=e.getStyle(i.Style.SourceAngle)-s.getAngleMod();n.push(this.buildAnimationParams(i.Style.SourceAngle,t))}if(s.isEndAngleTweenEnabled()&&(s.keepBigSlicesStatic()||o<180)){const t=e.getStyle(i.Style.EndAngle)+s.getAngleMod();n.push(this.buildAnimationParams(i.Style.EndAngle,t))}if(s.isColorTweenEnabled()){const t=e.getStyle(i.Style.Color).clone().lighten(20);n.push(this.buildAnimationParams(i.Style.Color,t))}if(s.isBorderTweenEnabled()){const t=e.getStyle(i.Style.BorderThickness)+s.getBorderMod();n.push(this.buildAnimationParams(i.Style.BorderThickness,t))}return n.length>0&&(this.animationComponent.unregisterSequence(e),this.animationComponent.tween(e,n,e)),this}adjustDefaultSegmentAnimation(e){const t=this.animationComponent.accessSequenceFor(e);if(a.isUndefined(t))return this.addDefaultSegmentAnimation(e);{t.reset();const n=t.getAnimations()[0].getModels(),s=this.getSettings(),o=e.getStyle(i.Style.EndAngle)-e.getStyle(i.Style.SourceAngle);if(s.isRadiusTweenEnabled()){const e=n.filter(e=>e.key===i.Style.Radius)[0];void 0!==e&&e.setValue(this.getStyle(i.Style.Radius)+s.getRadiusMod())}if(s.isDepthTweenEnabled()){const e=n.filter(e=>e.key===i.Style.Depth)[0];void 0!==e&&e.setValue(this.getStyle(i.Style.Depth)-s.getDepthMod())}if(s.isSourceAngleTweenEnabled()&&(!s.keepBigSlicesStatic()||o<180)){const t=n.filter(e=>e.key===i.Style.SourceAngle)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.SourceAngle)-s.getAngleMod())}if(s.isEndAngleTweenEnabled()&&(s.keepBigSlicesStatic()||o<180)){const t=n.filter(e=>e.key===i.Style.EndAngle)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.EndAngle)+s.getAngleMod())}if(s.isColorTweenEnabled()){const t=n.filter(e=>e.key===i.Style.Color)[0];void 0!==t&&t.getValue().extractChroma(e.getStyle(i.Style.Color)).lighten(20)}if(s.isBorderTweenEnabled()){const t=n.filter(e=>e.key===i.Style.BorderThickness)[0];void 0!==t&&t.setValue(e.getStyle(i.Style.BorderThickness)+s.getBorderMod())}return this}}normalizeDatasets(e,t,s){if(s.length>t.length){const o=s.length-t.length;for(let t=0;t<o;t++){const t=new n.Dataset(0,new r.Color);t.setOldValue(0),e.addDataset(t),this.setPopoverData(t).setDataSetWatch(t);const s=new i.CircleSegmentComponent(new i.CircleSegment(0,0,0,0,0,0)).setStyle(i.Style.Color,new r.Color).setData(t);this.buildLabel(s,"0").then(e=>{e.setDefaultStyle(i.Style.Opacity),this.addComponents([s,e]).addSegmentEvents(s)})}}return this}buildTransitionChain(e,t,i,n,s=this.getSettings().getTransitionDuration()){return t.forEach((t,o)=>{const a=[],c=i[o];t.hasOldValue()||t.setOldValue(0),void 0!==c?(a.push(this.buildAnimationParams("value",c.getValue(),s)),c.hasOldValue()&&a.push(this.buildAnimationParams("oldValue",c.getOldValue(),s)),a.push(this.buildAnimationParams("color",c.getColor(),s))):(a.push(this.buildAnimationParams("value",0,s)),a.push(this.buildAnimationParams("oldValue",0,s)),a.push(this.buildAnimationParams("color",r.Color.TRANSPARENT_COLOR(),s))),n.chainSequence(this.animationComponent.tween(t,a,t.getId()+e.getId()))}),this}checkAnimationState(){void 0!==this.activeTransitionSequence&&this.activeTransitionSequence.isPlaying()&&(this.activeTransitionSequence.stop(),this.activeTransitionSequence.onDone.fire(),this.animationComponent.unregisterSequence(this.activeTransitionSequence),this.activeTransitionSequence=void 0)}switchModel(e,t=!1,n){this.checkAnimationState(),this.hasStageFacade()&&this.legendMouseClick(void 0),this.fadedSegments=[];const s=[this.buildAnimationParams(i.Style.Phantom,Math.round(10*Math.random()),this.getSettings().getTransitionDuration())],o=this.animationComponent.tween(this,s,"transition"+e.getId()),r=this.getSettings().getModel();let a=r.getDatasets();const c=e.getDatasets();this.normalizeDatasets(r,a,c),a=r.getDatasets(),this.buildTransitionChain(e,a,c,o,n);const l=()=>{this.isDisposed()||(this.getSettings().isValueRecalculationAllowed&&this.calculatePercentageValues(r),this.recomputeSize())};this.activeTransitionSequence=o;let d=this.subscriptions;return t||((d=this.disposableSubscriptions).forEach(e=>e.cancel()),d.length=0),d.push(o.onDone.subscribe(()=>{this.isAnimationActive=!1,c.forEach((e,t)=>{t<a.length&&(a[t].merge(e),this.setPopoverData(a[t]))}),l(),this.queryAllComponents(e=>this.addDefaultSegmentAnimation(e),i.Constants.ComponentClasses.CircleSegment),this.activeTransitionSequence=void 0,this.animationComponent.unregisterSequence(o)})),d.push(o.onStop.subscribe(l.bind(this))),d.push(o.onAnimationStep.subscribe(l.bind(this))),t?(o.onPlay.subscribe(()=>this.isAnimationActive=!0),o):(this.isAnimationActive=!0,void o.resume())}runAnimation(e){const t=this.getChartSettings();this.animationComponent.hasSequenceFor(this)&&this.animationComponent.unregisterSequence(this),this.isAnimationActive=!0;const n=this.getStyle(i.Style.EndAngle);this.setStyle(i.Style.EndAngle,this.getStyle(i.Style.SourceAngle));const s=t.getTransitionDuration(),o=[this.buildAnimationParams(i.Style.EndAngle,n,s),this.buildAnimationParams(i.Style.Opacity,1,s)];this.setData(this.animationComponent.tween(this,o,this));const r=this.getData().onDone.subscribe(()=>{this.animationComponent.unregisterSequence(this),e.forEach((t,n)=>{const s=t.getSegmentLabel(),o=s.getData();s instanceof i.LabelComponent&&(s instanceof i.CurvedLabelComponent?(t.enableComputationOfCentralCurves(!0),s.reformat()):s.resumeAdaptation()),o.onDone.subscribeOnce(()=>{this.animationComponent.unregisterSequence(o),n===e.length-1&&(this.isAnimationActive=!1),this.hasStageFacade()&&this.getStageFacade().processUpdate()}),s.setStyle(i.Style.Opacity,.01),s.update(),s instanceof i.LabelComponent&&s.resumeConditionalHide(),o.resume()}),this.getStageFacade().unblockEvents(),r.cancel()});this.getData().resume()}animate(){const e=this.getChartSettings(),t=this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment);return this.animationComponent.reset(),e.isInitialAnimationEnabled()&&this.runAnimation(t),this}addEvents(){const e=this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment);return this.getSettings().isInitialAnimationEnabled()&&this.getStageFacade().blockEvents(),this.subscriptions.push(this.onMouseEnter.subscribe(this.setCursor.bind(this))),this.subscriptions.push(this.onMouseLeave.subscribe(this.resetCursor.bind(this))),this.setInteractiveState(!0),e.forEach(e=>this.addSegmentEvents(e)),this.invalidate(),this}getLegendClickAction(e){return this.legendIsClicked&&e===this.getInflatedSegment()?h.DESELECT:this.legendIsClicked&&e!==this.getInflatedSegment()?h.SELECTION_CHANGED:h.SELECT}legendMouseClick(e){const t=this.segmentMap[e];if(void 0!==t)switch(this.getLegendClickAction(t)){case h.DESELECT:this.legendIsClicked=!1,this.queryAllComponents(e=>{e!==t&&this.fadeIn(e)},i.Constants.ComponentClasses.CircleSegment);break;case h.SELECTION_CHANGED:this.legendIsClicked=!1,void 0!==this.getInflatedSegment()&&(this.fadeOut(this.getInflatedSegment()),this.handleSegmentLeave(this.getInflatedSegment(),void 0,!0)),this.fadeIn(t),this.handleSegmentEnter(t),this.legendIsClicked=!0;break;case h.SELECT:default:this.queryAllComponents(e=>{e!==t&&this.fadeOut(e)},i.Constants.ComponentClasses.CircleSegment),this.legendIsClicked=!0}else this.legendIsClicked=!1,this.queryAllComponents(e=>{this.fadeIn(e)},i.Constants.ComponentClasses.CircleSegment)}legendMouseEnter(e){this.legendIsClicked||void 0!==this.segmentMap[e]&&this.handleSegmentEnter(this.segmentMap[e],!0)}legendMouseLeave(e){this.legendIsClicked||void 0!==this.segmentMap[e]&&this.handleSegmentLeave(this.segmentMap[e],!0)}showBubble(e){if(this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer){void 0!==this.bubbleOwner&&this.closePopover();const t=this.getStageFacade().getActiveCamera();void 0!==t&&this.openPopover(t,e,this.getStageFacade().getCanvas());const i=e.getDoneSub();void 0!==i&&(i.cancel(),e.setDoneSub(void 0))}return this}handleSegmentEnter(e,t=!1){if(this.showBubble(e),!this.legendIsClicked&&this.inflatedSegment!==e){e.getStyleMap().isFunctionStyle(i.Style.Layer)||e.setStyle(i.Style.Layer,e=>e+1);const n=e.getSegmentLabel();if(n instanceof i.LabelComponent&&n.pauseConditionalHide(),(this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer)&&(e.setIsInflated(!0),this.getStageFacade().activate(),this.animationComponent.hasSequenceFor(e))){let n=e.getSequence();void 0===n&&(e.setSequence(this.animationComponent.accessSequenceFor(e)),n=e.getSequence()),n.onDone.subscribeOnce(()=>{const t=e.getSegmentLabel();t instanceof i.LabelComponent&&t.formatText()}),n.getState()!==i.Constants.State.Animation.Playing?(n.reset(),n.resume()):n.setReverseState(!1),this.setInflatedSegment(e),t||this.onSegmentInflated.fire(e.getData().getPopoverFooter())}}return this}isBestThemesWheel(){return void 0!==this.getWidget().getMenu().getHashtagMenu()&&void 0!==this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0]&&this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0].getMappedId()===constants.root_id.sampled_themes}handleSegmentLeave(e,t,n=!1){if(this.bubbleOwner===e&&this.closePopover(),!this.legendIsClicked){this.onSegmentLeave.fire(e,t),this.isInflatedSegment(e)&&this.setInflatedSegment(void 0);const s=e.getSequence();void 0!==s&&(s.setReverseState(!0),void 0===e.getDoneSub()&&e.setDoneSub(s.onDone.subscribe(()=>{a.isUndefined(s)||(s.isReversed()&&e.setSequence(void 0),e.getDoneSub().cancel(),e.setDoneSub(void 0));const t=e.getSegmentLabel();t instanceof i.LabelComponent&&(t.formatText(),t.resumeConditionalHide()),this.getSettings().shouldClearLayerOnMouseOutAnimationEnd()&&e.setStyle(i.Style.Layer,this.getStyleMap()),this.getStageFacade().deActivate()})),s.isPlaying()?Date.now()-e.lastAnimation>1e6&&s.reset():s.resume()),n||this.onSegmentDeflated.fire(e.getData().getPopoverFooter()),this.getSettings().shouldClearLayerOnMouseOutAnimationEnd()||e.setStyle(i.Style.Layer,this.getStyleMap()),e.invalidate()}return this}addSegmentEvents(e){return e.getData().areEventsDisabled()||(e.setInteractiveState(!0),this.subscriptions.push(e.onMouseEnter.subscribe(t=>{this.onSegmentEnter.fire(e,t),this.isAnimationActive||this.hasInflatedSegment()&&!this.legendIsClicked||this.handleSegmentEnter(e)})),this.subscriptions.push(e.onMouseClick.subscribe(()=>{if(this.getSettings().isPointerOnSliceEnabled()&&this.inflatedSegment===e&&i.Utilities.compareToMultipleSingleMatch(this.getStageFacade().getCanvas().style.cursor,[i.Constants.Mouse.Cursor.Default,i.Constants.Mouse.Cursor.Pointer],i.Constants.Comparators.Equal)){const t=[...e.getData().getFilters()];void 0!==this.additionalfilters&&t.push(...this.additionalfilters),a.isUndefined(t)||this.getStageFacade().isInteractionBlocked||this.openDrilldown(t)}})),this.subscriptions.push(e.onMouseMove.subscribe(()=>{this.hasInflatedSegment()||e.onMouseEnter.fire()})),this.subscriptions.push(e.onMouseLeave.subscribe(t=>this.handleSegmentLeave(e,t))),this.subscriptions.push(this.getStageFacade().onHoverEnd.subscribe(e=>{setTimeout(()=>{this.hasInflatedSegment()&&this.bubble&&!this.bubble.isMouseOver()&&this.handleSegmentLeave(this.getInflatedSegment(),e)},100)}))),this}setCursor(){if(this.getSettings().isPointerOnSliceEnabled()&&!this.getStageFacade().isCursorPointer()){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());this.checkCursorPredicate(n,t)&&this.getStageFacade().setCursor(i.Constants.Mouse.Cursor.Pointer),i.ObjectCache.recycleObject(n)}return this}resetCursor(){if(this.getSettings().isPointerOnSliceEnabled()){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());this.canResetCursor&&!this.checkCursorPredicate(n,t)&&this.getStageFacade().resetCursor(),i.ObjectCache.recycleObject(n)}return this}revert(){return this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).forEach(e=>e.onMouseLeave.fire()),this}verifyStyleChange(e){if(super.verifyStyleChange(e),e===i.Style.Radius||e===i.Style.Depth||e===i.Style.SourceAngle||e===i.Style.EndAngle){const e=this.getInflatedSegment();if(void 0!==e){const t=e.getSequence();void 0!==t&&(t.stop(),e.resetStyle(i.Style.Layer),t.reset(),e.setSequence(void 0))}this.recomputeSize()}}openPopover(e,t,n){const s=this.getSettings();if(s.arePiePopoversEnabled()){c.bubbleDialogService.destroyById(s.getBubbleId());const o=l.configurationService.getBubbleDialogConfiguration().getStyle(s.getBubbleId()),r=i.ObjectCache.PointPool.getObject().addFast(t.getContentCenter()).addFast(this.getPresence()),a=t.getBoundingBox();r.setX(a.x);const g=e.cameraToWindowCoordinates(r.getX(),r.getY());o.setArrowSide(d.twCommon.sides.RIGHT),o.setVirtualObjectPresence(a.width+2*(s.getAngleMod()+s.getBorderMod()),a.height+2*(s.getAngleMod()+s.getBorderMod())),o.setAbsoluteXOrigin(d.twCommon.sides.LEFT),o.setAbsoluteYOrigin(d.twCommon.sides.CENTER),o.setAbsoluteX(g.getX()),o.setAbsoluteY(g.getY()),o.setPositionOffsetX(0),o.setPositionOffsetY(0),i.ObjectCache.recycleObjects([r,g,a]);const u=c.bubbleDialogService.createByType(s.getBubbleId(),$(n),s.getBubbleType(),t.getData().getPopOverData().build(),o);u.onDestroy.subscribe(()=>{this.bubbleOwner===t&&(this.bubbleOwner=void 0),this.bubble===u&&(this.bubble=void 0)}),u.onMouseEnter.subscribe(this.handleBubbleEnter.bind(this,u,t)),this.bubbleOwner=t,this.bubble=u}return this}handleBubbleEnter(e,t){e.onMouseLeave.subscribeOnce(()=>{this.hasInflatedSegment()&&t===this.getInflatedSegment()&&this.handleSegmentLeave(t,void 0)})}draw(e){this.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).map(e=>{const t=e.getSegmentLabel();if(!this.isAnimationActive&&t instanceof i.ImageComponent&&t.hasShapes()){const i=e.getShapes()[0],n=t.getShapes()[0].clone();n.setCoordinates(t.getPresence().getRelativeX(),t.getPresence().getRelativeY());const s=t.fitsIn(i,n);t.isHidden()&&s?t.show():t.isHidden()||s||t.hide()}}),this.getSettings().getModel().getTotal()>0?this.isHidden()&&this.show():this.isHidden()||this.hide(),super.draw(e)}ready(){return this.isReady}incrementEmojiReadyCounter(){this.emojisReady++,this.hasStageFacade()&&this.getStageFacade().processUpdate()}update(){!this.isReady&&this.emojiCount<=this.emojisReady&&!this.isAnimationActive&&(this.isReady=!0,this.getStageFacade().onDrawEnd.subscribeOnce(()=>{this.onReady.fire()})),super.update()}closePopover(){return this.getSettings().arePiePopoversEnabled()&&c.bubbleDialogService.scheduleDestructionById(this.getSettings().getBubbleId(),500),this}hasInflatedSegment(){return void 0!==this.inflatedSegment}getInflatedSegment(){return this.inflatedSegment}setInflatedSegment(e){return this.inflatedSegment=e,this}isInflatedSegment(e){return this.getInflatedSegment()===e}dispose(){this.disposed=!0,void 0!==this.timeline&&(this.timeline.unsync(),this.timeline.dispose()),this.onReady.cancelAll(),this.onSegmentDeflated.cancelAll(),this.onSegmentInflated.cancelAll(),this.onSegmentEnter.cancelAll(),this.onSegmentLeave.cancelAll(),this.closePopover(),super.dispose()}}}),define("classes/canvas_engine/charts/src/implementations/wheel_chart",["require","exports","canvas_engine","event","map","underscore","classes/canvas_engine/settings/charts/wheel_chart_settings","classes/canvas_engine/charts/src/implementations/default_chart","classes/canvas_engine/charts/src/implementations/pie_chart","classes/canvas_engine/charts/src/implementations/wheel_pie"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=.5,g=.75;class u extends a.DefaultChart{constructor(e,t,i,n){super(e,t,i,n),this.isReady=!1,this.compute()}getSettings(){return super.getSettings()}compute(){this.chartMap=new s.Map,this.onReady=new n.Event;const e=this.getSettings(),t=e.getModel(),o=this.getSettings().toJson(),a=this.getPresence().generateChild();this.applyGeneralStyle(a);const d=this.getStyle(i.Style.Radius),g=this.getStyle(i.Style.Depth),u=g+(d-e.getMargin()-g)/2,p=u+e.getMargin();if(t.isMultiLayered){const e=r.WheelChartSettings.fromJson(o);t.getAmountOfRelevantDatasets()!==t.getDatasets().length&&(e.enableSliceLimit(!0),e.limitRelevantSlicesTo(Math.min(e.getSliceLimit(),t.getAmountOfRelevantDatasets()))),e.enableValueRecalculation(!1),this.isBestThemesWheel()&&e.enablePiePopovers(!1),a.setStyle(i.Style.Radius,u),this.mainChart=new l.WheelPie(a,this.getWidget(),e)}else a.setStyle(i.Style.Depth,u),this.mainChart=new c.PieChart(a,this.getWidget(),r.WheelChartSettings.fromJson(o));if(this.mainChart.setCursorPredicate(this.containsPoint.bind(this)),this.addChild(this.mainChart),t.isMultiLayered){const n=new i.CircleComponent(new i.Circle(0,0,d,p));n.setClassType("outerRing"),this.mainChart.addComponent(n),this.mainChart.queryAllComponents(n=>{const s=r.WheelChartSettings.fromJson(o),c=t.getSubModel(n.getData());s.setLabelType(r.LabelType.vertical).setModel(c).setMinArcRange(Math.min(5,n.getStyle(i.Style.Radius)/e.getActiveSliceAmount())),c.getAmountOfRelevantDatasets()!==c.getDatasets().length&&(s.enableSliceLimit(!0),s.limitRelevantSlicesTo(Math.min(s.getSliceLimit(),c.getAmountOfRelevantDatasets()))),this.adaptSubSliceColors(s,n);const g=a.generateChild();this.applyGeneralStyle(g),a.setStyle(i.Style.BorderColor,this.getStyle(i.Style.BorderColor)).setStyle(i.Style.BorderThickness,this.getStyle(i.Style.BorderThickness)),g.setStyle(i.Style.Depth,p).setStyle(i.Style.Radius,d),g.setStyle(i.Style.SourceAngle,n.getStyle(i.Style.SourceAngle)),g.setStyle(i.Style.EndAngle,n.getStyle(i.Style.EndAngle));const u=new l.WheelPie(g,this.getWidget(),s);u.setCursorPredicate(this.containsPoint.bind(this)),u.setAdditionalFilter(n.getData().getFilters()),this.mainChart.addChild(u),this.chartMap.set(n,u)},i.Constants.ComponentClasses.CircleSegment),this.addEvents()}return this}getCharts(){const e=[this.mainChart];return this.chartMap.forEach(t=>{e.push(t)}),e}legendMouseEnter(e){this.mainChart.legendMouseEnter(e),this.chartMap.forEach(t=>{t.legendMouseEnter(e)})}legendMouseLeave(e){this.mainChart.legendMouseLeave(e),this.chartMap.forEach(t=>{t.legendMouseLeave(e)})}legendMouseClick(e){this.mainChart.legendMouseClick(e),this.chartMap.forEach(t=>{t.legendMouseClick(e)})}ready(){return this.isReady}addEvents(){if(this.getSettings().getModel().isMultiLayered){const e=this.getChildren()[0];this.chartReset=(()=>{e.greyInOut(!1),this.queryChartMap(e=>{e.greyInOut(!1)})}),e.onSegmentEnter.subscribe(e=>{this.greyInOut(e)}),e.onMouseLeave.subscribe(()=>{this.chartReset()}),e.queryAllComponents(e=>{const t=this.chartMap.get(e);void 0!==t&&(t.onMouseLeave.subscribe(()=>t.queryAllComponents(e=>e.resetStyle(i.Style.Layer),i.Constants.ComponentClasses.CircleSegment)),t.onSegmentEnter.subscribe(i=>{const n=this.getOtherHoveredSegment(i);n!==i&&(void 0!==n&&n.onMouseLeave.fire(),this.greyInOut(e),t.greyInOut(!0),t.greyInOut(!1,i,!0))}),t.onSegmentLeave.subscribe(e=>e.resetStyle(i.Style.Layer)))},i.Constants.ComponentClasses.CircleSegment)}return this}greyInOut(e){const t=this.getChildren()[0];t.greyInOut(!0),t.greyInOut(!1,e,!0),this.queryChartMap(t=>{t.greyInOut(t!==this.chartMap.get(e))})}getOtherHoveredSegment(e){return this.queryChartMap(t=>t.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment).filter(t=>t.isHovering()&&t!==e)[0]).filter(e=>void 0!==e)[0]}adaptSubSliceColors(e,t){const n=t.getData().getColor();e.getModel().getDatasets().forEach((e,s)=>{const o=e.getColor();n.l!==d&&(n.setLuminosity(d),t.getStyle(i.Style.Color).setLuminosity(d)),o.setLuminosity(g)})}queryChartMap(e){const t=[];return Array.from(this.chartMap.keys()).forEach(i=>{t.push(e(this.chartMap.get(i)))}),t}checkReadiness(){const e=this.getStageFacade();this.isReady=this.mainChart.isReady,this.queryChartMap(e=>this.isReady=this.isReady&&e.isReady),this.isReady&&(this.onReady.fire(),e.onMouseLeave.subscribe(()=>{o.isFunction(this.chartReset)&&this.chartReset()})),this.requestUpdate(e)}update(){super.update(),this.isReady||this.checkReadiness()}requestUpdate(e){void 0===e||e.isPlaying()||requestAnimationFrame(()=>{e.invalidateAll(),e.processUpdate()})}isBestThemesWheel(){return void 0!==this.getWidget().getMenu().getHashtagMenu()&&void 0!==this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0]&&this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0].getMappedId()===constants.root_id.sampled_themes}containsPoint(e,t){const i=super.containsPoint(e,t)||this.getChildren()[0].containsPoint(e,t);return this.queryChartMap(i=>i.containsPoint(e,t)).reduce((e,t)=>e||t,i)}applyGeneralStyle(e){e.setStyle(i.Style.BorderColor,this.getStyle(i.Style.BorderColor)).setStyle(i.Style.BorderThickness,this.getStyle(i.Style.BorderThickness))}animate(){this.getChildArray().forEach(e=>e.animate())}}t.WheelChart=u,t.default=o.constant(u)}),define("classes/canvas_engine/charts/src/models/default_chart_model",["require","exports","underscore","data_structures"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends n.Datamodel{constructor(e,t,i=!1,n=!1){super(e,i,n),this.widget=t}getWidget(){return this.widget}}t.TwDataModel=s,t.default=i.constant(s)}),define("classes/canvas_engine/core/entities/circle",["require","exports","canvas_engine"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.CircleEntity=class extends i.Entity{constructor(e,t,n){super(e);const s=this.getStyle(i.Style.Radius);i.logService.assertDefined(s,i.Constants.Feature.Entities.Circle,this);const o=i.Presence.zero(this.getPresence());o.getStyleMap().setStyleIfDifferent(i.Style.Radius,s).linkStyles([i.Style.BorderThickness,i.Style.BorderColor,i.Style.Color],e.getStyleMap()),this.circleShape=new i.CircleComponent(o),this.circleShape.getStyleMap().setStyleIfDifferent(i.Style.Opacity,function(e){return e}),this.addComponent(this.circleShape),_.isUndefined(t)||(this.label=new i.LabelComponent(i.Presence.zeroTopLeft(),t,n||new i.LabelSettings),this.label.setStyle(i.Style.Opacity,function(e){return e}),this.addComponent(this.label),this.hiddenLabel=!1)}getLabel(){return this.label}hasLabel(){return void 0!==this.label}setText(e,t){return this.hasLabel()&&this.label.setText(e,t),this}verifyStyleChange(e){(!_.isUndefined(this.circleShape)&&e===i.Style.Radius||e===i.Style.Depth)&&(this.circleShape.getStyleMap().setStyleIfDifferent(e,this.getStyle(e)),this.hasLabel()&&this.label.invalidateContainingShape())}setCircleData(e){return this.circleData=e,this}getCircleData(){return this.circleData}getText(){if(this.hasLabel())return this.label.getText()}getShape(){return this.circleShape.getShape()}getCircleShape(){return this.circleShape}containsPoint(e,t){return this.circleShape.containsPoint(e,t)}setInteractiveState(e){return this.getPresence().setInteractiveState(e),this.circleShape.setInteractiveState(e),this}update(){super.update(),_.isUndefined(this.label)||this.hiddenLabel&&(this.label.isHidden()||this.label.hide())}hideLabel(){this.lockOnLabel||(this.hiddenLabel=!0)}hideShape(){this.circleShape.hide()}showShape(){this.circleShape.show()}setLockOnLabel(e){this.lockOnLabel=e}showLabelIfAble(){this.lockOnLabel||(this.hiddenLabel=!1,this.label.show())}}}),define("classes/canvas_engine/core/entities/cutoff_rectangle",["require","exports","canvas_engine","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends i.Entity{constructor(e,t=[],n){super(e,t,n),this.addComponent(new i.RectangleComponent(new i.Rectangle(0,0,this.getStyle(i.Style.Width),this.getStyle(i.Style.Height))).setStyle(i.Style.Color,o.light.color)),this.buildStripes()}buildStripes(){const e=Math.max(this.getStyle(i.Style.Width),this.getStyle(i.Style.Height))+2*o.getStripeInterval();for(let t=0;t<e;t+=o.getStripeInterval())this.buildStripe(t,o.dark)}buildStripe(e,t){const n=e-t.thickness/2,s={x:Math.min(n,this.getStyle(i.Style.Width)),y:Math.max(0,n-this.getStyle(i.Style.Width))},o=s.x+s.y,r={x:Math.max(0,o-this.getStyle(i.Style.Height)),y:Math.min(o,this.getStyle(i.Style.Height))},a=this.getPresence().generateChild().translate(s.x,s.y).setStyle(i.Style.BorderColor,t.color).setStyle(i.Style.BorderThickness,t.thickness),c=this.getPresence().generateChild().translate(r.x,r.y);this.addComponent(i.LineComponent.fromSourceTarget(a,c))}draw(e){e.saveAll(),e.clipAll(this.presence),super.draw(e),e.restoreAll()}}t.CutoffRectangle=s,t.default=_.constant(s);const o={dark:{color:n.Color.fromARGB(.6,180,180,175),thickness:3},light:{color:n.Color.fromARGB(.7,235,230,220),thickness:6},getStripeInterval:()=>9}}),define("classes/canvas_engine/core/entities/slider",["require","exports","canvas_engine","underscore","services/tw_common","canvas_engine","data_structures"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["TwPresence","TwStyle","TwColor","engineConstants","bubbleDialogService","configurationService","TwCanvasUtilities","$timeout","TwCutoffRectangle",function(e,t,a,c,l,d,g,u,p){const h=String.fromCharCode(61516),m=String.fromCharCode(61473),_=String.fromCharCode(61515),f=String.fromCharCode(61666),y=a.WHITE(),v=a.ICON_GREY(),S=v.clone().setAlpha(.9),b=new a,w=a.getCustomColor("BRANDING_COLOR")(),C=a.LIGHT_GREY(),E=w.clone().darken(40).lighten(40,!0),T=w.clone().darken(40,!0),M=T.clone().lighten(10),P=[T,E,T];return class extends o.Entity{constructor(e,t){super(e),this.settings=t,this.replay=t.getModel().getReplayManager(),this.bubbleId=constants.bubble_dialog.id.replay_speed,this.frameTicks=[],this.cutoffAreas=[],this.activeIndex=0,this.minTick=0,this.progressFactor=1,this.labelSettings=(new o.LabelSettings).setOrigin(c.Origin.CENTER_TOP).setColor(v).setFontSize(11),this._initialize(),this.setInteractiveState(!0),this.replay.enablePausingOnStepChange(this.replay.isDiscrete()),this.replay.setPauseDuration(300),this.replay.onTickRequest.subscribe(this.createTick.bind(this)),this.replay.onDispose.subscribe(this.dispose.bind(this))}getSettings(){return this.settings}_createControls(){const t=new e(Math.floor(60-57.6),0),i=new o.Font;i.setFamily("FontAwesome");const n=new o.LabelSettings;n.setFont(i).setOrigin(c.Origin.CENTER).setFontSize(24).setColor(v),this.playButton=this._createPlayButton(n.clone()),this.replayButton=this._createReplayButton(n.clone());const s=new o.Entity(t,[this.playButton.button,this.playButton.label,this.replayButton.button,this.replayButton.label]);this.addChild(s)}update(){o.Entity.prototype.update.apply(this),this._updateCursorPosition(this.getTimeline().getProgress())}_updateCursorPosition(e){const t=this.lineWidth*e;this.cursorComponent.getPresence().setX(t),this.innerCursor.getPresence().setX(t)}_setupEvents(){this.subscriptions.push(this.getTimeline().onPlay.subscribe(function(){this.playButton.label.setText(h)},this)),this.subscriptions.push(this.getTimeline().onPause.subscribe(function(){this.playButton.label.setText(_)},this)),this.getSettings().isCursorDragEnabled()&&(this.cursorComponent.onMouseDown.subscribe(function(){this.isDragging=!0,this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Move,this.getTimeline().isPlaying()&&this.getTimeline().pause()},this),this.cursorComponent.onMouseUp.subscribe(function(){this.isDragging=!1,this.getSettings().isLineClickEnabled()||this.cursorComponent.isHovering()?this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer:this.getSettings().isLineClickEnabled()||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default)},this),this.cursorComponent.onMouseDrag.subscribe(function(e){this.isDragging&&this._handleMouseClick(e)},this),this.cursorComponent.onMouseEnter.subscribe(function(e){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer)},this),this.cursorComponent.onMouseLeave.subscribe(function(e){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default)},this)),this.interactiveComponent.onMouseClick.subscribe(function(e){this._handleMouseClick(e)},this),this.interactiveComponent.onMouseDrag.subscribe(function(e){this.isDragging=!0,this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Move,this.getTimeline().isPlaying()&&this.getTimeline().pause(),this.interactiveComponent.onMouseClick.fire(e)},this),this.interactiveComponent.onMouseUp.subscribe(function(e){this.isDragging&&(this.isDragging=!1),this.getStageFacade().getCanvas().style.cursor!==c.Mouse.Cursor.Pointer&&(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer)},this),this.getSettings().isLineClickEnabled()&&(this.subscriptions.push(this.interactiveComponent.onMouseEnter.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer)},this)),this.subscriptions.push(this.interactiveComponent.onMouseLeave.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default)},this)))}_handleMouseClick(e){this.getTimeline().isPlaying()&&this.playButton.button.onMouseClick.fire();let i=!0;this.cutoffAreas.forEach(function(n){const s=n.getPresence().getAbsoluteX(),o=s+n.getStyle(t.Width);e.mouse.x>=s&&e.mouse.x<=o&&(i=!1)},this),i&&this._calculateSliderState(e)}_calculateSliderState(e){const i=this.interactiveComponent.getPresence(),s=e.mouse.getX()-i.getAbsoluteX();let o=g.clamp(s/(this.lineWidth-1.5),this.minProgress,this.progressFactor);if(o!==this.getTimeline().getProgress()){let i,s;const r=!n.isUndefined(this.getSettings().getWidget())&&this.getSettings().getWidget().isWorldMap();if(r&&o<.01)o=0;else if(this.settings.isLineClickEnabled()&&1!==o){i=n.filter(this.frameTicks,function(e){return e.getData()>o&&e.previousStep.getData()<=o})[0];const e=r?[]:[i.previousStep].concat(i.previousStep.subSteps);s=n.reduce(e,function(e,t){return Math.abs(t.getData()-o)<Math.abs(e.getData()-o)?t:e},i),o=s.getData()}if(this.getTimeline().setProgress(o),this.replay.isDiscrete()){const t=!n.isUndefined(s)&&this.frameTicks.indexOf(s)>0&&!e.cutoffSkip;if(this._setLinePosition(t),t){const e=this.frameTicks[Math.max(this.activeIndex,this.minTick)];this.tickPredicate=function(){e.deActivate(),n.each(e.subSteps,function(e){e.deActivate()})}}else n.isUndefined(this.tickPredicate)||(this.tickPredicate=void 0)}this.done&&o<.999?(this.done=!1,this.playButton.button.setStyle(t.Color,y),this.playButton.label.getSettings().setColor(v),this.playButton.label.setText(_)):o>=.999&&(this.done=!0,this.playButton.button.setStyle(t.Color,y),this.playButton.button.isHovering()?this.playButton.label.getSettings().setColor(w):this.playButton.label.getSettings().setColor(v),this.playButton.label.setText(f))}}_setLinePosition(e){this.activeIndex=this.replay.currentStep,(this.activeIndex===this.replay.getNumberOfFrames()||e)&&0!==this.activeIndex&&this.activeIndex--;const n=Math.max(this.activeIndex,this.minTick),s=i.ObjectCache.PointPool.getObject().addFast(this.frameTicks[n].getPresence());this.cutoffAreas.forEach(function(e){const i=e.getPresence().getAbsoluteX(),n=i+e.getStyle(t.Width);s.x>=i&&s.x<n&&(s.x=n)},this),this.lineComponent.getPresence().setPositionRelativeTo(s),i.ObjectCache.recycleObject(s)}_createPlayButton(i){const s={},r=new e(16,16),a=new o.LabelComponent(r,_,i),l=new o.RectangleComponent(new o.Rectangle(0,0,32,32)).setStyle(t.Color,y).setStyle(t.StrokeAlignment,c.StrokeAlignment.Inside).setStyle(t.BorderColor,C).setStyle(t.BorderThickness,1).setInteractiveState(!0),d=this;this.subscriptions.push(l.onMouseClick.subscribe(function(e){this.isDragging||(this.replay.isStepWatchEnabled()||this.replay.enableStepWatch(!0),d.done?(a.setText(_),this._onReset(e),this.done=!1,this.replay.isDiscrete()&&(this.activeIndex=0,this._setLinePosition()),this.getSettings().isAutoReplayEnabled()&&l.onMouseClick.fire()):(n.isUndefined(this.tickPredicate)||(this.tickPredicate(),this.tickPredicate=void 0),this.getTimeline().isPlaying()||this.getTimeline().getState().isWaiting?(this._onPause(e),l.setStyle(t.Color,y),l.isHovering()?(i.setColor(w),g()):(i.setColor(v),l.setStyle(t.BorderColor,C))):(this.replay.isDiscrete()&&(this.activeIndex=0,this._setLinePosition()),this._onPlay(e),l.setStyle(t.Color,w),i.setColor(y))))},this)),this.subscriptions.push(this.replay.onSpeedChange.subscribe(function(){l.onMouseClick.fire()},this)),this.subscriptions.push(this.getTimeline().onDone.subscribe(function(){this.getSettings().getAnimationAxis().loop_forever?(this._onReset(),this._onPlay()):(l.setStyle(t.Color,y),a.setText(f),l.isHovering()?(i.setColor(w),g()):(i.setColor(v),l.setStyle(t.BorderColor,C)),d.done=!0)},this)),this.subscriptions.push(l.onMouseEnter.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer,i.getColor()!==y&&(i.setColor(w),l.setStyle(t.BorderColor,w)),this.getTimeline().isPlaying()||this.getTimeline().isDelayed()||g())},this));const g=function(){s.hoverTimeout=u(function(){null===this||this.isDisposed()||d._openPopover(d.getStageFacade().getCanvas())},1e3,!1)};return this.subscriptions.push(l.onMouseMove.subscribe(function(){this.isDragging||this.getStageFacade().getCanvas().style.cursor===c.Mouse.Cursor.Pointer||l.onMouseEnter.fire()},this)),this.subscriptions.push(l.onMouseLeave.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default,l.getStyle(t.Color)!==w&&(i.setColor(v),l.setStyle(t.BorderColor,C)),u.cancel(s.hoverTimeout))},this)),s.button=l,s.label=a,s}_createReplayButton(i){const n={},s=new e(16,44);i.setFontSize(Math.floor(i.getFontSize()/2));const r=new o.LabelComponent(s,m,i),a=new o.RectangleComponent(new o.Rectangle(8,36,16,16)).setInteractiveState(!0),l=this.getSettings().getAnimationAxis();return l.loop_forever?(i.setColor(y),a.setStyle(t.Color,w).setStyle(t.StrokeAlignment,c.StrokeAlignment.Inside).setStyle(t.BorderColor,w).setStyle(t.BorderThickness,1)):a.setStyle(t.Color,y).setStyle(t.StrokeAlignment,c.StrokeAlignment.Inside).setStyle(t.BorderColor,C).setStyle(t.BorderThickness,1),this.subscriptions.push(a.onMouseClick.subscribe(function(e){l.loop_forever?(l.loop_forever=!1,a.setStyle(t.Color,y),i.setColor(w)):(l.loop_forever=!0,a.setStyle(t.Color,w),i.setColor(y))},this)),this.subscriptions.push(a.onMouseEnter.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer,i.getColor()!==y&&(i.setColor(w),a.setStyle(t.BorderColor,w)))},this)),this.subscriptions.push(a.onMouseLeave.subscribe(function(){this.isDragging||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default,a.getStyle(t.Color)!==w&&(i.setColor(v),a.setStyle(t.BorderColor,C)))},this)),n.button=a,n.label=r,n}_createBar(i,n){const s=new e(60,8.55);this.animationComponent=new o.AnimationComponent;const r=new o.Rectangle(-24.6,0,i+51.2-2,n),a=new o.RectangleComponent(r).setStyle(t.Color,y).setStyle(t.BorderColor,C).setStyle(t.BorderThickness,1),c=this._createCursor();this.innerCursor=c.inner,this.cursorComponent=c.cursor;const l=new o.Rectangle(0,0,i,n);this.interactiveComponent=new o.RectangleComponent(l).setStyle(t.Color,b).setInteractiveState(!0),this.lineComponent=new o.RectangleComponent(l),this.lineComponent.setStyle(t.Width,this._getSliderWidth.bind(this));let d=[a,this.lineComponent,this.interactiveComponent,this.animationComponent];(d=d.concat(this._createSteps(i,n))).push(this.cursorComponent,this.innerCursor),this.barEntity=new o.Entity(s,d).setInteractiveState(!0),this.addChild(this.barEntity),this.lineComponent.startPoint=o.Point.zero(),this.lineComponent.endPoint=o.Point.zero();const g=this._getGradient();this.lineComponent.setStyle(t.Gradient,g)}_checkTickLabelSize(){const e=n.reduce(this.frameTicks,function(e,i){if(!n.isUndefined(i.label)){const n=i.label.getStyle(t.Width);return e.getStyle(t.Width)>n?e:i}},{getStyle:function(){return Number.MIN_VALUE}});if(!n.isUndefined(e)&&!n.isUndefined(e.label)){const s=e.label.getStyle(t.Width)*this.frameTicks.length;if(this.lineWidth<s){const t=e.label.getText(),s=e.label.getSettings().getFont(),o=s.clone();o.setSize(1);const r=g.measureText(t,o,1),a=Math.floor(this.lineWidth/this.frameTicks.length),c=s.getSize(),l=i.ObjectCache.RectanglePool.getObject().setWidth(a).setHeight(c),d=l.getInnerRectForRatio(r.width,1),u=d.getWidth()/r.width;if(Math.floor(u)!==c){const e=c-Math.floor(u);n.map(this.frameTicks,function(t){t.label.getSettings().getFont().setSize(Math.max(1,s.getSize()-e)),t.label.formatText(),t.label.invalidate()})}i.ObjectCache.recycleObject(d),i.ObjectCache.recycleObject(l),i.ObjectCache.recycleObject(r)}}}_getGradient(){const e=this;let t;if(this.replay.isCumulative())t=new o.Gradient(this.lineComponent.getPresence().toPoint(),i,P);else{if(!this.replay.isDiscrete())throw new Error("Unknown replay type detected");t=new o.Gradient(function(){return e.lineComponent.startPoint.merge(e.lineComponent.getPresence().toPoint()),e.lineComponent.startPoint},i,P)}function i(){return e.cursorComponent.getPresence().toPoint()}return t}_getSliderWidth(){return this.cursorComponent.getPresence().getAbsoluteX()-this.lineComponent.getPresence().getAbsoluteX()}_createCursor(){const e=new o.Circle(0,Math.floor(7.45),Math.floor(10.43)),i=new o.Circle(0,Math.floor(7.45),Math.floor(3.84));return{inner:new o.CircleComponent(i).setStyle(t.Color,M).setStyle(t.BorderColor,M).setStyle(t.BorderThickness,1.5).setStyle(t.Layer,function(e){return e+1}),cursor:new o.CircleComponent(e).setStyle(t.Color,E).setStyle(t.BorderColor,M).setStyle(t.BorderThickness,1.5).setInteractiveState(!0).setStyle(t.Layer,function(e){return e+1})}}createTick(e,i){const n=this.interactiveComponent.getStyle(t.Width)*e;this.barEntity.addComponents(this._createStep(e,n,0,1.5,14.9,this.labelSettings.clone(),i))}_createStep(i,s,r,a,l,d,g){let u,p;1!==i&&0!==i||(u=s,p=a,s-=1.5,a=3);const h=new o.Rectangle(s,r,a,l),m=0===i||1===i?w:y,_=0===i||1===i?S:v,f=new o.RectangleComponent(h).setStyle(t.Color,_).setInteractiveState(!0).setData(i),b=[f];let C,E,M;const P=this.getSettings().getModel().getTotalAnimationDuration();let D=P*i;if(!n.isUndefined(g)){M=d.getColor();const c=11===d.getFont().getSize()?4:6,h=p||a,m=n.isUndefined(u)?s:u-h/2,_=new o.Rectangle(m,r+l,h,c);C=new o.RectangleComponent(_).setStyle(t.Color,d.getColor()).setInteractiveState(!0),E=new o.LabelComponent(new e(u||s,r+l+4),g,d),b.push(C,E),f.label=E,f.timedProgress=Math.min(1.001*i,1),D=P*f.timedProgress}const A=this;return this.replay.isDiscrete()&&!n.isUndefined(g)&&0!==i&&1!==i&&this.getTimeline().addPause(i,function(){return A.replay.getPauseDuration()},function(){return A.replay.isPausingOnStepChangeEnabled()},function(){A._setLinePosition(),A.replay.getTimeline().isReturning()?n.each(f.subSteps,function(e){e.deActivate()}):n.isUndefined(f.previousStep)||(f.previousStep.deActivate(),n.each(f.previousStep.subSteps,function(e){e.deActivate()}))},[],A,this.token),this.getTimeline().addCallback(function(e){e?f.deActivate():f.activate(),A.replay.isDiscrete()&&!A.replay.getTimeline().isPlaying()&&(n.isUndefined(f.previousStep)||(e?(A._setLinePosition(),f.previousStep.timedProgress<=A.replay.getTimeline().getProgress()&&f.previousStep.activate(),n.each(f.previousStep.subSteps,function(e){e.getData()<=A.replay.getTimeline().getProgress()?e.activate():e.deActivate()})):1!==i&&(f.previousStep.deActivate(),n.each(f.previousStep.subSteps,function(e){e.deActivate()}))))},D,this.token),this.getSettings().isLineClickEnabled()||(this.subscriptions.push(f.onMouseEnter.subscribe(function(){this.isDragging||this.getSettings().isLineClickEnabled()||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Pointer)},this)),this.subscriptions.push(f.onMouseLeave.subscribe(function(){this.isDragging||this.getSettings().isLineClickEnabled()||(this.getStageFacade().getCanvas().style.cursor=c.Mouse.Cursor.Default)},this)),this.subscriptions.push(f.onMouseClick.subscribe(function(){this.isDragging||this.getSettings().isLineClickEnabled()||this.getTimeline().setProgress(i)},this))),f.activate=function(){let e=!1;A.cutoffAreas.forEach(function(i){const n=i.getPresence().getAbsoluteX(),s=n+i.getStyle(t.Width),o=f.getPresence().getAbsoluteX()+f.getStyle(t.Width);o>n&&o<s&&(e=!0)}),e||(this.setStyle(t.Color,m),n.isUndefined(E)||(C.setStyle(t.Color,T),E.getSettings().setColor(T),E.getSettings().getFont().setWeight(c.Font.Weight.Bold),E.getStyle(t.Font).setWeight(c.Font.Weight.Bold)))},f.deActivate=function(){let e=!1;A.cutoffAreas.forEach(function(i){const n=i.getPresence().getAbsoluteX(),s=n+i.getStyle(t.Width),o=f.getPresence().getAbsoluteX()+f.getStyle(t.Width);o>n&&o<s&&(e=!0)}),e||(this.setStyle(t.Color,_),n.isUndefined(E)||(C.setStyle(t.Color,M),E.getSettings().setColor(M),E.getSettings().getFont().setWeight(c.Font.Weight.Default),E.getStyle(t.Font).setWeight(c.Font.Weight.Default)))},b}_createSteps(e,t){const i=this.replay.getDataModel(),o=this.replay.getNumberOfFrames();this.interval=e/o,this.subInterval=this.interval/10;let a=[];const c=1.5,l=.15*t;if(i instanceof r.NetworkModel)return this.getSettings().enableLineClick(!1),[this._createStep(0,-.75,0,c,t)[0],this._createStep(1,e-.75,0,c,t)[0]];for(let e=0;e<=o;e++){const r=this.labelSettings.clone(),d=e/Math.max(o,1),g=Math.round(0+this.interval*e);let u,p;n.isUndefined(i)||(i.hasAdditionalFrames()?p=i.getAdditionalFrames()[e].getAnimationFrameTimestamp():0===d?p=i.getAnimationRangeStartTimestamp():1===d&&(p=i.getAnimationRangeEndTimestamp()),n.isUndefined(p)||(u=s.twCommon.formatTimestamp(p,this.replay.getTimeFormat()))),!n.isUndefined(p)&&s.twCommon.isMidnight(p)&&r.setFontSize(13);const h=this._createStep(d,g,0,c,t,r,u);if(h[0].subSteps=[],e>0&&(h[0].previousStep=this.frameTicks[this.frameTicks.length-1],this.frameTicks[this.frameTicks.length-1].nextStep=h[0]),this.frameTicks.push(h[0]),a=a.concat(h),e!==o&&!n.isUndefined(this.getSettings().getWidget())&&!this.getSettings().getWidget().isWorldMap())for(let e=1;e<10;e++){const i=d+e/10/o,n=this._createStep(i,Math.round(g+this.subInterval*e),l,c,.7*t);h[0].subSteps.push(n[0]),a=a.concat(n)}}return a}_openPopover(e){l.destroyById(this.bubbleId);const t=this.getStageFacade().getActiveCamera(),n=i.ObjectCache.PointPool.getObject().addFast(this.playButton.button.getPresence());n.translate(38.4,16);const o=t.cameraToWindowCoordinates(n.getX(),n.getY()),r=d.getBubbleDialogConfiguration().getStyle(this.bubbleId);r.setAbsoluteX(o.getX()),r.setAbsoluteY(o.getY()),r.setArrowSide(s.twCommon.sides.LEFT),r.setAbsoluteXOrigin(s.twCommon.sides.LEFT),r.setAbsoluteYOrigin(s.twCommon.sides.CENTER),i.ObjectCache.recycleObject(n),i.ObjectCache.recycleObject(o);l.createByType(this.bubbleId,$(e),"replay_speed",{speeds:this.getSettings().getModel().getAllSpeeds(),replay:this.replay,dispose:!0},r)}_closePopover(){u.cancel(this.playButton.hoverTimeout),l.destroyById(this.bubbleId)}_onPlay(e,t){if(this._closePopover(),this.hasTimeline()){const e=Math.min(t||1,this.progressFactor);this.getTimeline().playOverTime(this.getSettings().getModel().getTotalAnimationDuration(),e)}this.getStageFacade().activate()}_onPause(e){this.hasTimeline()&&this.getTimeline().pause(),this.getStageFacade().deActivate()}_goToStart(){this._calculateSliderState({mouse:{getX:function(){return 0}}}),this.frameTicks.forEach(function(e){e.deActivate(),e.subSteps.forEach(function(e){e.deActivate()})})}_onReset(){this._goToStart(),this.tickPredicate=void 0}_initialize(){this.replay.isStepWatchEnabled()||this.replay.enableStepWatch(!0),this.lineWidth=this.getStyle(t.Width)-120,this._createControls(),this._createBar(this.lineWidth,14.9),this._checkTickLabelSize(),this._handleBlockedIntervals(),this._setupEvents(),this._goToStart()}_handleBlockedIntervals(){const e=n.clone(this.getSettings().getBlockedIntervals());0===e[0]&&e.splice(0,1);const t=this._extractInitialCutoffs(e),i=this._extractEndCutoffs(e),s=this._extractIntermittentCutoffs(e);this._handleInitialBlocks(t),this._handleEndBlocks(i),this._handleIntermittentBlocks(s)}_extractInitialCutoffs(e){const t=e.filter(function(e,t){return t===e-1});return e.splice(0,t.length),t}_handleInitialBlocks(e){this.minProgress=e.length/(this.frameTicks.length-1),e.length>0&&(this._buildCutoffArea(e),this.minTick=e[e.length-1])}_extractEndCutoffs(e){const t=[];for(let i=this.frameTicks.length-1;i>0&&e.indexOf(i)>=0;i--)t.unshift(i);return e.splice(e.length-t.length,t.length),t}_handleEndBlocks(e){e.length>0&&(this._buildCutoffArea(e),this.progressFactor=(this.frameTicks.length-1-e.length)/(this.frameTicks.length-1))}_extractIntermittentCutoffs(e){const t=[];let i=[];for(;e.length>0;){const n=e[0];0===i.length||i[i.length-1]===n-1?i.push(e.splice(0,1)[0]):(t.push(i),i=e.splice(0,1))}return i.length>0&&t.push(i),t}_handleIntermittentBlocks(e){e.length>0&&this._buildCutoffArea(e)}_buildCutoffArea(e){const i=e[0]-1,n=this.frameTicks[i].getPresence().subtract(this.barEntity.getPresence()).setStyle(t.Width,this.interval*e.length+1).setStyle(t.Height,this.lineComponent.getStyle(t.Height)),s=new p(n);this.barEntity.addChild(s),this.cutoffAreas.push(s);const o=this;this.getTimeline().addPause((e[0]-1)/(this.frameTicks.length-1)+.002,function(){return o.replay.getPauseDuration()},function(){return!0},function(){o._calculateSliderState({mouse:{getX:function(){return s.getPresence().getAbsoluteX()+s.getStyle(t.Width)}},cutoffSkip:!0});for(let t=e[0]-1;t<=e[e.length-1]-1;t++)o.frameTicks[t].deActivate(),o.frameTicks[t].subSteps.forEach(function(e){e.deActivate()})},[],o,this.token)}getTimeline(){return this.replay.getTimeline()}hasTimeline(){return!n.isUndefined(this.getTimeline())}}}]}),define("classes/canvas_engine/core/entities/charts/data_gauge",["require","exports","canvas_engine","event","log","map","underscore","services/bubble_dialog","services/configuration","services/tw_common","classes/canvas_engine/charts/src/implementations/default_chart","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});const u=l.twCommon;t.default=["TwPopoverData","$timeout","Tendency",function(e,t,l){return class extends d.DefaultChart{constructor(e,t,o,r){super(e,t,o,r),s.logService.assertDefined(e.getStyle(i.Style.Width),i.Constants.Feature.Entities.DataGauge,this),s.logService.assertDefined(e.getStyle(i.Style.Height),i.Constants.Feature.Entities.DataGauge,this),s.logService.assertDefined(e.getStyle(i.Style.Orientation),i.Constants.Feature.Entities.DataGauge,this),this.onSegmentEnter=new n.Event,this.onSegmentLeave=new n.Event}compute(){this.segmentCoordinates=new o.Map,this.clearShape();const t=this.stageFacade,n=this.getChartSettings().getModel(),s=n.getTotal();let a;const c=this.getStyle(i.Style.Orientation);return this.setStyle(i.Style.Font,this.getChartSettings().getLabelSettings().getFont()).setStyle(i.Style.TextBaseLine,this.getChartSettings().getLabelSettings().getTextBaseLine()),this.animationComponent=new i.AnimationComponent,this.addComponent(this.animationComponent),r.each(n.getDatasets(),function(n){let o,d,u,p;const h=n.getValue(),m=n.getColor();if(h>0){c===i.Constants.Orientation.HORIZONTAL?(o=a?a.getPresence().getRelativeX()+a.getStyle(i.Style.Width):0,d=a?a.getPresence().getRelativeY():0,u=this.getStyle(i.Style.Width)*h/s,p=this.getStyle(i.Style.Height)):(o=a?a.getPresence().getRelativeX():0,d=a?a.getPresence().getRelativeY()+a.getStyle(i.Style.Height):0,u=this.getStyle(i.Style.Width),p=this.getStyle(i.Style.Height)*h/s);const _=new i.Rectangle(o,d,u,p),f=new i.RectangleComponent(_).setStyle(i.Style.Color,m).setStyle(i.Style.Opacity,this.getStyleMap()).setStyle(i.Style.Layer,this.getStyleMap());this.addComponent(f);const y=this.getChartSettings().getLabelSettings();let v=n.getLabel();if(""!==v){"&#"===v.substring(0,2)&&(v=String.fromCharCode(parseInt(v.substring(2))));const e=f.getPresence().clone(!0).translate(u/2,p/2-1).translate(y.getOffset().getX(),y.getOffset().getY()),n=y.getOrigin()||i.Constants.Origin.CENTER,s=new i.LabelComponent(e,v,y.clone());s.setStyle(i.Style.Color,y.getColor()),s.setOrigin(n),s.setStyle(i.Style.BorderColor,y.getBorderColor()),f.label=s,s.setShapeFetchPredicate(function(){return _}),s.setStyle(i.Style.Layer,f.getStyleMap()).setStyle(i.Style.Opacity,f.getStyleMap()),this.addComponent(s),r.isUndefined(t)||s.setStageFacade(t)}this.addShape(new i.Rectangle(o,d,u,p)),a=f;const S=n.showsColor?new e(g.Color.WHITE(0).toRGBAString(),n.getPopoverFooter(),!0):new e(m.toHex6(),n.getPopoverFooter(),!0),b=n.getPreviousValue(),w=n.getValue();if(0!==b){const e=new l(w,b);S.addValue(n.getSubLabel(),Math.round(100*w)/100,e.build())}else if(this.getChartSettings().isSentiment())S.addValue(n.getSubLabel(),{hits:n.getPopoverValue().total,isTotal:!0}).addValue("Positive",{hits:n.getPopoverValue().positive,isPositive:!0}).addValue("Neutral",{hits:n.getPopoverValue().neutral,isNeutral:!0}).addValue("Negative",{hits:n.getPopoverValue().negative,isNegative:!0});else{let e=n.getPopoverValue();r.isUndefined(e)&&(e=Math.round(100*w)/100),S.addValue(n.getSubLabel(),e)}a.setPopoverData(S),a.setData(n),r.isUndefined(t)||a.setStageFacade(t),this.segmentCoordinates.set(a,a.getPresence().toPoint());const C=this.getChartSettings().getAnimationDuration(),E=[];if(this.getChartSettings().isWidthTweenEnabled()&&E.push({key:i.Style.Width,value:1.1*u,duration:C}),this.getChartSettings().isHeightTweenEnabled()&&E.push({key:i.Style.Height,value:1.1*p,duration:C}),this.getChartSettings().isPositionTweenEnabled()){const e=a.getPresence().toRelativePoint().subtract(new i.Point(.05*u,.05*p));E.push({key:"presence",value:e,duration:C})}this.getChartSettings().isColorTweenEnabled()&&E.push({key:i.Style.Color,value:m.clone().lighten(20),duration:C}),E.length>0&&this.animationComponent.tween(a,E,a)}},this),this}addEvents(){const e=this.getAllComponentsOf(i.Constants.ComponentClasses.Rectangle);return this.subscriptions.push(this.onMouseEnter.subscribe(this._setCursor.bind(this))),this.subscriptions.push(this.onMouseLeave.subscribe(this._resetCursor.bind(this))),r.each(e,function(e){e.setInteractiveState(!0),this.subscriptions.push(e.onMouseEnter.subscribe(function(n){if(e.entered=!0,this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer){r.isUndefined(e.label)||r.isFunction(e.getStyle(i.Style.Layer))||e.setStyle(i.Style.Layer,function(e){return e+1}),e.isInflated=!0,r.isUndefined(this.bubbleOwner)||this.bubbleOwner.onMouseLeave.fire();const n=this.getStageFacade().getActiveCamera();r.isUndefined(n)||this._openPopover(n,e,this.getStageFacade().getCanvas()),r.isUndefined(e.doneSub)||e.doneSub.cancel(),this.animationComponent.hasSequenceFor(e)&&(e.enterTimeout=t(function(){this.onSegmentEnter.fire(e)}.bind(this),100),r.isUndefined(e.sequenceFacade)&&(e.sequenceFacade=this.animationComponent.accessSequenceFor(e)),e.sequenceFacade.getState()!==i.Constants.State.Animation.Playing?(e.sequenceFacade.reset(),e.sequenceFacade.resume()):e.sequenceFacade.setReverseState(!1),this.inflatedSegment=e)}},this)),this.getChartSettings().isClickable()&&this.subscriptions.push(e.onMouseClick.subscribe(function(t){if(this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Default||this.getStageFacade().getCanvas().style.cursor===i.Constants.Mouse.Cursor.Pointer){const t=e.getData().getFilters();r.isUndefined(t)||this.openDrilldown(t)}},this)),this.subscriptions.push(e.onMouseMove.subscribe(function(t){this.getStageFacade().getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Default&&this.getStageFacade().getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Pointer||r.isUndefined(this.inflatedSegment)&&this.getChartSettings().isWidthTweenEnabled()&&e.onMouseEnter.fire()},this)),this.subscriptions.push(e.onMouseLeave.subscribe(function(n){e.entered&&(this.bubbleOwner===e&&this._closePopover(),r.isUndefined(e.sequenceFacade)||(t.cancel(e.enterTimeout)||this.onSegmentLeave.fire(e),e.sequenceFacade.setReverseState(!0),e.sequenceFacade.getState()!==i.Constants.State.Animation.Playing?e.sequenceFacade.resume(this.getStageFacade()):Date.now()-e.lastAnimation>1e6&&(e.sequenceFacade.reset(),e.getPresence().setPositionRelativeTo(this.segmentCoordinates.get(e)),e.getStyleMap().isFunctionStyle(i.Style.Layer)&&e.setStyle(i.Style.Layer,this.getStyleMap())),e.doneSub=e.sequenceFacade.onDone.subscribeOnce(function(){r.isUndefined(e.sequenceFacade)||(this.inflatedSegment===e&&(this.inflatedSegment=void 0),e.sequenceFacade.isReversed()&&(this.getSettings().isPositionTweenEnabled()&&e.getPresence().setPositionRelativeTo(this.segmentCoordinates.get(e)),e.sequenceFacade=void 0,e.getStyleMap().isFunctionStyle(i.Style.Layer)&&e.setStyle(i.Style.Layer,this.getStyleMap())))},this)))},this))},this),this}_setCursor(){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());!this.containsPoint(n,t)||this.getStageFacade().isCursorPointer()||this.getStageFacade().isCursor(i.Constants.Mouse.Cursor.Move)||(this.getStageFacade().getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer),i.ObjectCache.recycleObject(n)}_resetCursor(){const e=this.getStageFacade(),t=e.getActiveCamera(),n=t.stageToCameraCoordinates(e.getCurrentMousePosition());!this.containsPoint(n,t)&&this.getStageFacade().isCursorPointer()&&this.getStageFacade().resetCursor(),i.ObjectCache.recycleObject(n)}setStyle(e,t){return e===i.Style.Width&&this.adjustWidthValues(t/this.getStyle(i.Style.Width)),e===i.Style.Height&&this.adjustHeightValues(t/this.getStyle(i.Style.Height)),super.setStyle(e,t),this}adjustWidthValues(e){this.getAllComponentsOf(i.Constants.ComponentClasses.Rectangle).forEach(function(t){t.setX(t.getX()*e),t.setStyle(i.Style.Width,t.getStyle(i.Style.Width)*e)})}adjustHeightValues(e){this.getAllComponentsOf(i.Constants.ComponentClasses.Rectangle).forEach(function(t){t.setY(t.getY()*e),t.setStyle(i.Style.Height,t.getStyle(i.Style.Height)*e)})}recompute(){this.removeEvents(),this.clearComponents(),this.compute(),this.subscribeToStage()}_openPopover(e,t,n){a.bubbleDialogService.destroyById(this.getChartSettings().getBubbleId());const s=c.configurationService.getBubbleDialogConfiguration().getStyle(this.getChartSettings().getBubbleId()),o=i.ObjectCache.PointPool.getObject().addFast(t.getPresence()),r=i.ObjectCache.PointPool.getObject();let l;this.getStyle(i.Style.Orientation)===i.Constants.Orientation.HORIZONTAL?(r.setX(o.getX()+t.getStyle(i.Style.Width)/2),(l=e.cameraToWindowCoordinates(r.getX(),r.getY())).translate(-3,0),s.setArrowSide(u.sides.BOTTOM),s.setVirtualObjectPresence(t.getStyle(i.Style.Width),t.getStyle(i.Style.Height)),s.setAbsoluteXOrigin(u.sides.CENTER),s.setAbsoluteYOrigin(u.sides.BOTTOM)):(r.setX(o.getX()+1.5*t.getStyle(i.Style.Width)).setY(o.getY()+t.getStyle(i.Style.Height)/5),l=e.cameraToWindowCoordinates(r.getX(),r.getY()),s.setArrowSide(u.sides.LEFT),s.setAbsoluteXOrigin(u.sides.LEFT),s.setAbsoluteYOrigin(u.sides.CENTER)),s.setAbsoluteX(l.getX()),s.setAbsoluteY(l.getY()),s.setPositionOffsetX(0),s.setPositionOffsetY(0),i.ObjectCache.recycleObjects([o,r,l]),a.bubbleDialogService.createByType(this.getChartSettings().getBubbleId(),$(n),this.getChartSettings().getBubbleType(),t.getPopoverData().build(),s),this.bubbleOwner=t}_closePopover(){a.bubbleDialogService.scheduleDestructionById(this.getChartSettings().getBubbleId(),500),this.bubbleOwner=void 0}dispose(){this.onSegmentEnter.cancelAll(),this.onSegmentLeave.cancelAll(),super.dispose(),this._closePopover()}}}]}),define("components/tools/d3_helper",["require","exports","d3","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s={scale:{}};s.scale.logZeroSafe=function(){const e=i.scale.log().clamp(!0),t=function(t){return n.isFinite(t)?n.isUndefined(e.domain)||n.isUndefined(e.range)?NaN:e.domain().length<=1||e.range().length<=1?(console.error("Wrong size of range or domain array - expected 2 elements."),NaN):e(t<1?1:t):NaN};return t.domain=function(){return e.domain()},t.range=function(){return e.range()},t.domain=function(t){return e.domain(t),this},t.range=function(t){return e.range(t),this},t},s.scale.multiscale=function(){const e={scale:i.scale.linear()},t=function(t){if(!n.isFinite(t))return NaN;if(n.isUndefined(e.domains)||n.isUndefined(e.ranges))return NaN;if(e.domains.length<=1||e.ranges.length<=1)return console.error("Wrong size of ranges or domains array - minimum elements: 2"),NaN;if(e.domains.length!==e.ranges.length)return console.error("Different size of ranges and domains array - the sizes have to match!"),NaN;if(t<=e.domains[0])return e.ranges[0];if(e.domains[e.domains.length-1]<=t)return e.ranges[e.ranges.length-1];for(let i=0;i<e.domains.length-1;i++)if(e.domains[i]<t&&t<=e.domains[i+1])return e.scale.domain([e.domains[i],e.domains[i+1]]).range([e.ranges[i],e.ranges[i+1]])(t);return NaN};return t.domains=function(){return e.domains},t.ranges=function(){return e.rangess},t.scale=function(){return e.scale},t.domains=function(t){return e.domains=t,this},t.ranges=function(t){return e.ranges=t,this},t.scale=function(t){return e.scale=t,this},t},t.default=s}),define("classes/color_palette_builder/kpi_color_palette_builder",["require","exports","underscore","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.KpiColorPaletteBuilder=class extends n.ColorPaletteBuilder{build(){switch(this.themeId){case 2:return this.buildDarkColorPalette();case 3:return this.buildNavyColorPalette();default:return this.buildLightColorPalette()}}buildLightColorPalette(){return{positive:n.Color.LIGHT_GREEN(),neutral:n.Color.LIGHT_GREY(),negative:n.Color.RED(),shadedPositive:new n.Color("#cce6cc"),shadedNegative:new n.Color("#ffcccc"),labelTendencyPositive:n.Color.POSITIVE_SENTIMENT_COLOR(),labelTendencyNegative:n.Color.NEGATIVE_SENTIMENT_COLOR(),labelTendencyNeutral:new n.Color("#33465e"),labelPreviousValue:new n.Color("#808080"),needleLine:n.Color.GREY().darken(5),needleBase:n.Color.BLACK()}}buildDarkColorPalette(){return i.assign(this.buildLightColorPalette(),{neutral:new n.Color("#292929"),shadedPositive:new n.Color("#133313"),shadedNegative:new n.Color("#531313"),labelTendencyNeutral:new n.Color("#aaaaaa"),needleLine:new n.Color("#565656")})}buildNavyColorPalette(){return this.buildDarkColorPalette()}}}),define("classes/canvas_engine/settings/charts/kpi_chart_settings",["require","exports","canvas_chart_utilities","services/tw_number_formatter","data_structures","other/tw","services/tw_common","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c extends i.PopoverChartSettings{constructor(e){super(e)}getLabel(){return(this.model.getWidget().getDic().unit_labels||[r.twCommon.extractAxisYLabel(this.model.getData(),a.contextData.getMessage("_281677"))])[0]}getTotal(){return this.getCurrentDataGraph().total}getCurrentValue(){return this.getCurrentDataGraph().rows[0].cells[0].value.numeric_data}getDataType(){return this.getCurrentDataGraph().column_groups[0].data_columns[0].data_type}findFormatterForDataType(){return"time_in_s"===this.getDataType()?n.twNumberFormatter.getInstance().toTime.bind(n.twNumberFormatter.getInstance()):"percentage"===this.getDataType()?function(e){return n.twNumberFormatter.getInstance().toPercentage(e/100)}:n.twNumberFormatter.getInstance().toDecimal.bind(n.twNumberFormatter.getInstance())}getCurrentValueFormatted(e=this.getCurrentValue()){return this.findFormatterForDataType()(e)}getOldValue(){return this.getCurrentDataGraph().rows[0].cells[0].value.numeric_data_old||0}getOldValueFormatted(e){return this.findFormatterForDataType()(e||this.getOldValue())}getTendency(e=this.getOldValue(),t=this.getCurrentValue()){return(t-e)/e}getChange(e=this.getOldValue(),t=this.getCurrentValue()){return new s.Tendency(t,e).build()}getTendencyFormatted(e,t,i){if(!_.isUndefined(i))return n.twNumberFormatter.getInstance().toPercentage(Math.abs(i)/100);const s=this.getChange(e,t);return s.is_old_value_zero?" ":n.twNumberFormatter.getInstance().toPercentage(s.value_abs_percentage)}getPreviousPeriod(){const e=this.model.getData().getPreviousPeriodMappedId(),t=o.tw.pageState.getUserFilterSettings();if(!_.isUndefined(t)){const i=t.getTimeFilter().getTimeFilterMenu().getEntryByMappedId(e);if(!_.isUndefined(i))return i.getName()}return""}getTimePeriodInformation(){const e=new s.Tendency(this.getCurrentValue(),this.getOldValue());if(e.isOldValueZero()||e.isOldValueUndefined())return constants.project.settings.showComparisonWithPreviousPeriod?a.contextData.getMessage("_207343",[this.getPreviousPeriod(),this.getModel().getWidget().getTitle().toLowerCase()]):"";{let e;return e=this.getPreviousPeriod()?a.contextData.getMessage("_351182",[this.getPreviousPeriod()]):a.contextData.getMessage("_001127")}}}t.KpiChartSettings=c,t.default=_.constant(c)}),define("classes/canvas_engine/core/models/kpi_model",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.data=e,this.widget=t}getData(){return this.data}getWidget(){return this.widget}}t.KpiModel=i,t.default=_.constant(i)}),define("classes/canvas_engine/core/entities/charts/kpi_chart",["require","exports","canvas_engine","components/tools/d3_helper","components/tools/data_graph","data_structures","log","reusable_utilities","widget_base","services/bubble_dialog","services/configuration","services/tw_common","classes/canvas_engine/charts/src/implementations/default_chart","classes/canvas_engine/charts/src/implementations/pie_chart","classes/canvas_engine/charts/src/models/default_chart_model","classes/canvas_engine/settings/charts/kpi_chart_settings","classes/canvas_engine/settings/charts/pie_chart_settings","classes/canvas_engine/core/models/kpi_model"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y){Object.defineProperty(t,"__esModule",{value:!0});const v=String.fromCharCode(58941),S=String.fromCharCode(58940);class b extends u.DefaultChart{constructor(e,t,n,s,o){super(e,t,n),this.labelSettings=(new i.LabelSettings).setOrigin(i.Constants.Origin.TOP_LEFT).setTextBaseLine(i.Constants.TextBaseLine.HANGING).setBorderThickness(0),this.chartCircle=i.Circle.zero(),this.needleBaseCircle=i.Circle.zero(),this.needleRectangle=i.Rectangle.zero(),this.previousValueLabelPosition=i.Point.zero(),this.currentValueLabelPosition=i.Point.zero(),this.tendencyIconLabelPosition=i.Point.zero(),this.tendencyLabelPosition=i.Point.zero(),this.timeInfoLabelPosition=i.Point.zero(),this.tendencyIconLabelSizeFactor=.3,this.currentValueLabelSizeFactor=1,this.tendencyLabelSizeFactor=.4,this.previousValueLabelSizeFactor=.36,this.colorPalette=s.style.colorPalette,this.drawSettings=s,this.depthRatio=.6,this.labelSettings.setMinFontSize(o),this.updateConstants(),r.logService.assertDefined(e.getStyle(i.Style.Radius),i.Constants.Feature.Entities.Charts.Kpi,this),this.buildAnimationStrategies(),this.initialize()}updateConstants(){this.timeInfoLabelSizeFactor=.33,this.verticalLabelMargin=.038*this.getStyle(i.Style.Height),this.tendencyArrowMargin=.002*this.getStyle(i.Style.Height),this.topPadding=.11*this.getStyle(i.Style.Height),this.labelPositionY=this.getStyle(i.Style.Radius)+this.topPadding+this.verticalLabelMargin,this.chartCircle.setCoordinates(.5*this.getStyle(i.Style.Width),this.getStyle(i.Style.Radius)+this.topPadding).setRadius(this.getStyle(i.Style.Radius)).setDepth(this.getStyle(i.Style.Radius)*this.depthRatio),this.needleBaseCircle.setCoordinates(.5*this.getStyle(i.Style.Width),this.getStyle(i.Style.Radius)+this.topPadding).setRadius(.06*this.getStyle(i.Style.Radius));const e=this.needleBaseCircle.getRadius();this.initialTendencyOffset=this.needleBaseCircle.getX()+1.25*e,this.topOffset=.33*e;const t=Math.floor(this.getStyle(i.Style.Height)-this.labelPositionY-this.topOffset-this.tendencyArrowMargin);this.defaultLabelSize=Math.max(Math.ceil(Math.min(Math.floor(.95*t),.3*this.getStyle(i.Style.Radius))),this.labelSettings.getMinFontSize())*this.getFontScale(),this.needleRectangle.setCoordinates(.5*this.getStyle(i.Style.Width),this.getStyle(i.Style.Radius)+this.topPadding).setWidth(.05*this.getStyle(i.Style.Radius)).setHeight(this.getStyle(i.Style.Radius)+.015*this.getStyle(i.Style.Height)),this.previousValueLabelPosition.setCoordinates(.5*this.getStyle(i.Style.Width),this.topPadding-.026*this.getStyle(i.Style.Height)),this.currentValueLabelPosition.setCoordinates(.5*this.getStyle(i.Style.Width)-this.getStyle(i.Style.Radius),this.labelPositionY+this.topOffset),this.tendencyIconLabelPosition.setCoordinates(this.initialTendencyOffset,this.labelPositionY+this.topOffset+this.tendencyArrowMargin-this.getStyle(i.Style.Height)/268*4),this.tendencyLabelPosition.setCoordinates(this.initialTendencyOffset+.3*this.defaultLabelSize+this.getStyle(i.Style.Height)/268*8,this.labelPositionY+this.topOffset-this.getStyle(i.Style.Height)/268*4),this.timeInfoLabelPosition.setCoordinates(this.initialTendencyOffset,this.labelPositionY+this.topOffset+.4*this.defaultLabelSize)}buildScaleNegativeNumbers(e){return t=>{const i=e(Math.abs(t));return Math.round(i)}}calculateArcRange(e,t){let i;return i=_.isFinite(t)&&0!==t?e<0?n.default.scale.multiscale().domains([0,100]).ranges([0,90]):n.default.scale.multiscale().domains([0,10,100,1e3]).ranges([0,10,45,90]):n.default.scale.logZeroSafe().domain([1,Math.pow(10,10)]).range([-90,90]),this.buildScaleNegativeNumbers(i)(e)}getAllSegments(){return this.background.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment)}getMainSegment(){return this.getAllSegments()&&this.getAllSegments()[1]}getNeedleAttachSegment(){return this.needleAttachSegment}getSettings(){return super.getSettings()}updateNeedlePosition(){const e=this.getNeedleAttachSegment();_.isUndefined(e)||(this.attachRight?this.needle.setStyle(i.Style.RotationAngle,-(e.getStyle(i.Style.EndAngle)+90)):this.needle.setStyle(i.Style.RotationAngle,-(e.getStyle(i.Style.SourceAngle)+90)))}buildNeedle(){this.needleBase=new i.CircleComponent(this.needleBaseCircle).setStyle(i.Style.Color,this.colorPalette.needleBase).setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Center).setStyle(i.Style.Layer,1),this.needle=new i.RectangleComponent(this.needleRectangle).setOrigin(i.Constants.Origin.CENTER_BOTTOM).setStyle(i.Style.Color,this.colorPalette.needleLine).setStyle(i.Style.RotationOrigin,i.Constants.Origin.CENTER_BOTTOM).setStyle(i.Style.RotationAngle,0).setStyle(i.Style.Layer,1),this.addComponent(this.needle),this.addComponent(this.needleBase),this.needleAttachSegment=this.getAllSegments()[1]}getFontScale(){switch(this.drawSettings.style.fontSize){case c.FontSize.SMALL:return 1;case c.FontSize.MEDIUM:return 1.5;case c.FontSize.LARGE:return 2;default:throw new Error("Font size not supported")}}updateLabels(){this.tendencyIconLabel.setX(this.tendencyIconLabelPosition.getX()).setY(this.tendencyIconLabelPosition.getY()).getSettings().setMinFontSize(this.labelSettings.getMinFontSize()).setFontSize(this.defaultLabelSize*this.tendencyIconLabelSizeFactor),this.tendencyLabel.setX(this.tendencyLabelPosition.getX()).setY(this.tendencyLabelPosition.getY()).getSettings().setMinFontSize(this.labelSettings.getMinFontSize()).setFontSize(this.defaultLabelSize*this.tendencyLabelSizeFactor),this.currentValLabel.setX(this.currentValueLabelPosition.getX()).setY(this.currentValueLabelPosition.getY()).getSettings().setMinFontSize(this.labelSettings.getMinFontSize()).setFontSize(this.defaultLabelSize*this.currentValueLabelSizeFactor),this.currentValLabel.getStyle(i.Style.Font).setSize(this.defaultLabelSize*this.currentValueLabelSizeFactor),this.prevValueLabel.setX(this.previousValueLabelPosition.getX()).setY(this.previousValueLabelPosition.getY()).getSettings().setMinFontSize(this.labelSettings.getMinFontSize()).setFontSize(this.defaultLabelSize*this.previousValueLabelSizeFactor),this.updateTimePeriodLabels(),this.getWidget().getPageState().getAllowedPages().isCommandCenter()&&this.switchToCommandCenterStyle()}switchToCommandCenterStyle(){this.timeInfoLabel.isHidden()||this.timeInfoLabel.hide();const e=this.background.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment)[0],t=this.background.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment)[1],n=this.background.getAllComponentsOf(i.Constants.ComponentClasses.CircleSegment)[2],s=n.getShape().arcAngle>0?n:t,o=e.getShape().getArcSource(i.ObjectCache.PointPool.getObject()),r=s.getShape().getArcEnd(i.ObjectCache.PointPool.getObject()),a=o.getX(),c=r.getX();i.ObjectCache.recycleObject(o),i.ObjectCache.recycleObject(r),this.isTendencyPositive?(this.currentValLabel.setOrigin(i.Constants.Origin.TOP_RIGHT).setX(c),this.tendencyIconLabel.setOrigin(i.Constants.Origin.TOP_LEFT).setX(a).setY(.979*this.currentValLabel.getY()),this.tendencyLabel.setOrigin(i.Constants.Origin.TOP_LEFT).setX(a+1.05*this.tendencyIconLabel.getStyle(i.Style.Width)+this.tendencyArrowMargin).setY(this.currentValLabel.getY())):(this.currentValLabel.setOrigin(i.Constants.Origin.TOP_LEFT).setX(a),this.tendencyLabel.setOrigin(i.Constants.Origin.TOP_RIGHT).setX(c+.05*this.tendencyIconLabel.getStyle(i.Style.Width)).setY(this.currentValLabel.getY()),this.tendencyIconLabel.setOrigin(i.Constants.Origin.TOP_RIGHT).setX(c-this.tendencyLabel.getStyle(i.Style.Width)-this.tendencyArrowMargin).setY(.973*this.currentValLabel.getY())),this.tendencyLabel.fontSize=this.defaultLabelSize,this.tendencyIconLabel.fontSize=Math.ceil(.75*this.tendencyLabel.fontSize)}buildLabels(){this.buildPrevValueLabel(),this.buildCurrentValueLabel(),this.buildTendencyLabels(),this.buildTimeInformation(),this.updateLabels()}buildPrevValueLabel(){const e=this.labelSettings.clone().setOrigin(i.Constants.Origin.CENTER_BOTTOM).setTextBaseLine(i.Constants.TextBaseLine.TOP).setColor(this.colorPalette.labelPreviousValue).setFontSize(this.defaultLabelSize*this.previousValueLabelSizeFactor).setFontFamily('RobotoR, "Helvetica Neue", Helvetica, Arial, sans-serif');this.prevValueLabel=new i.LabelComponent(new i.Presence(this.previousValueLabelPosition.getX(),this.previousValueLabelPosition.getY())," ",e),this.addComponent(this.prevValueLabel)}buildCurrentValueLabel(){const e=this.labelSettings.clone().setFontFamily(i.Constants.Font.Family.Digits).setFontSize(this.defaultLabelSize),t=i.Utilities.measureText(this.getSettings().getCurrentValueFormatted(this.getSettings().getCurrentValue()),e.getFont());t.width>this.getStyle(i.Style.Radius)&&(this.currentValueLabelSizeFactor=this.getStyle(i.Style.Radius)/t.width);let n="000.0M";constants.project.settings.useHighPrecisionFormatting&&(n="000.00000M"),this.currentValLabel=new i.LabelComponent(new i.Presence(this.currentValueLabelPosition.getX(),this.currentValueLabelPosition.getY()),n,e),this.addComponent(this.currentValLabel)}buildTimeInformation(){const e=this.labelSettings.clone().setMultiline(!0).setFontFamily(i.Constants.Font.Family.Content).setFontSize(this.defaultLabelSize*this.timeInfoLabelSizeFactor);this.timeInfoLabel=new i.LabelComponent(new i.Presence(this.timeInfoLabelPosition.getX(),this.timeInfoLabelPosition.getY())," ",e),this.addComponent(this.timeInfoLabel)}buildTendencyLabels(){const e=(new i.Font).setFamily(i.Constants.Font.Family.TwAwesome).setSize(1),t=this.colorPalette.labelTendencyNeutral,n=this.labelSettings.clone().setTextBaseLine(i.Constants.TextBaseLine.TOP).setColor(t).setBorderColor(t).setFont(e);this.tendencyIconLabel=new i.LabelComponent(new i.Presence(this.tendencyIconLabelPosition.getX(),this.tendencyIconLabelPosition.getY()),"17",n);const s=(new i.Font).setSize(1);this.getWidget().getPageState().getAllowedPages().isCommandCenter()?s.setFamily(i.Constants.Font.Family.Digits):s.setFamily('RobotoR, "Helvetica Neue", Helvetica, Arial, sans-serif');const o=this.labelSettings.clone().setColor(t).setBorderThickness(0).setFont(s);this.tendencyLabel=new i.LabelComponent(new i.Presence(this.tendencyLabelPosition.getX(),this.tendencyLabelPosition.getY()),"00.0%",o),this.addComponent(this.tendencyLabel),this.addComponent(this.tendencyIconLabel),o.setMinFontSize(this.labelSettings.getMinFontSize()),n.setMinFontSize(this.labelSettings.getMinFontSize())}updateTendencyLabels(e,t,n){r.logService.verbose("updating tendency labels",g.twCommon.logFeatures.Charts.Kpi,{tendency:e,previousValue:t,value:n});const s=this.tendencyLabel.getSettings(),o=this.tendencyIconLabel.getSettings();let a;a=void 0!==t&&void 0!==n?n>=t:e>0,this.isTendencyPositive=a;const c=a?this.colorPalette.labelTendencyPositive:this.colorPalette.labelTendencyNegative;s.setColor(c),o.setBorderColor(c).setColor(c),this.tendencyIconLabel.setStyle(i.Style.Color,c),this.tendencyIconLabel.setStyle(i.Style.BorderColor,c),this.tendencyIconLabel.setText(a?v:S),void 0!==t&&t>0?(this.tendencyLabel.isHidden()&&constants.project.settings.showComparisonWithPreviousPeriod&&(this.tendencyLabel.show(),this.tendencyIconLabel.show()),this.tendencyLabel.setText(this.getSettings().getTendencyFormatted(t,n,e))):(this.tendencyLabel.setText(" "),constants.project.settings.showComparisonWithPreviousPeriod||(this.tendencyLabel.hide(),this.tendencyIconLabel.hide()))}updateTimePeriodLabels(){let e=this.getSettings().getTimePeriodInformation();""!==e&&constants.project.settings.showComparisonWithPreviousPeriod?(this.timeInfoLabel.isHidden()&&this.timeInfoLabel.show(),this.timeInfoLabel.getSettings().setFontSize(Math.floor(this.defaultLabelSize*this.timeInfoLabelSizeFactor)),e=this.evaluateTimePeriodText(e),this.timeInfoLabel.setText(e),this.timeInfoLabel.getPresence().setX(this.timeInfoLabelPosition.getX()).setY(this.timeInfoLabelPosition.getY())):this.timeInfoLabel.hide()}evaluateTimePeriodText(e){const t=this.getStyle(i.Style.Width)-this.timeInfoLabel.getPresence().getX();let n=i.Utilities.measureText(e,this.timeInfoLabel.getSettings().getFont()),s=1;if(n.width>t){let o,r,a=e.split(" ");for(;n.width>t&&s<a.length;)o=a.slice(0,-s).join(" "),r=a.slice(-s).join(" "),i.ObjectCache.recycleObject(n),n=i.Utilities.measureText(o,this.timeInfoLabel.getSettings().getFont()),s++;i.ObjectCache.recycleObject(n),_.isUndefined(o)||_.isUndefined(r)||(e=o+this.timeInfoLabel.getSettings().getSplitCharacter()+r,(n=i.Utilities.measureText(r,this.timeInfoLabel.getSettings().getFont())).width>t&&(this.timeInfoLabelSizeFactor-=.01,this.timeInfoLabel.getSettings().setFontSize(Math.floor(this.defaultLabelSize*this.timeInfoLabelSizeFactor)),e=this.evaluateTimePeriodText(e)),i.ObjectCache.recycleObject(n))}return e}attachNeedleRight(){this.attachRight=!0,r.logService.verbose("Set needle attach to right",g.twCommon.logFeatures.Charts.Kpi,{context:this})}attachNeedleLeft(){this.attachRight=!1,r.logService.verbose("Set needle attach to left",g.twCommon.logFeatures.Charts.Kpi,{context:this})}tweenAllSets(e,t,i){e=e||[],t=t||[];const n=[];return _.forEach(e,(e,s)=>{const o=t[s];if(!_.isUndefined(e)||!_.isUndefined(o)){const t=this.tweenDataSet(s,"_value",e,o,i);t&&n.push(t)}},this),n}buildAnimationStrategies(){this.strategies={},Object.keys(w).forEach(e=>{const t=w[e],i=a.StringUtils.snakeCaseToCamelCase(t)+"Strategy";this.strategies[t]=this[i].bind(this)})}discoverStrategy(e,t,i,n,s,o){if(n&&0===o.getOldValue()&&0!==s.getOldValue())return w.FAN_IN_OUT;if(n&&0!==o.getOldValue()&&0===s.getOldValue()){return this.getMainSegment().getData().getValue()>=90?e>0?w.FILL_LEFT:w.REDUCE:e>0?w.COLLAPSE:w.FILL_RIGHT}return 0===i.getOldValue()?w.FAN_OUT:e>=0?t?w.LEFT_TO_RIGHT:w.EXTEND_RIGHT:e<0?t?w.RIGHT_TO_LEFT:w.EXTEND_LEFT:void r.logService.error("Unknown animation strategy!")}fanInOutStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;return{primarySequences:s=this.tweenAllSets([0,0,180],[n.clone(),n.clone(),n.clone()],i/2),secondarySequences:o=this.tweenAllSets([0,90+t,Math.max(0,90-t)],[this.colShaded.clone(),this.colDiff.clone(),n.clone()],i/2),functions:[{func:this.attachNeedleRight.bind(this),delay:i/2}]}}fillLeftStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;const r=this.getAllSegments()[1].getData().getValue();return{primarySequences:s=this.tweenAllSets([90,r-90,void 0],[n.clone()],i/2),secondarySequences:o=this.tweenAllSets([void 0,t,Math.max(0,90-t)],[void 0,this.colDiff.clone(),this.colShaded.clone()],i/2),functions:[{func:this.attachNeedleRight.bind(this),delay:0}]}}fillRightStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;const r=this.getAllSegments()[1].getData().getValue();return{primarySequences:s=this.tweenAllSets([90-t,r,180-r],[this.colShaded.clone(),n,n],i/2),secondarySequences:o=this.tweenAllSets([90-t,t,90],[this.colShaded.clone(),this.colDiff.clone(),n.clone()],i/2),functions:[{func:this.attachNeedleLeft.bind(this),delay:0}]}}reduceStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;const r=this.getAllSegments()[1].getData().getValue();return{primarySequences:s=this.tweenAllSets([Math.max(90-t),r-Math.max(90-t),void 0],[n.clone()],i/2),secondarySequences:o=this.tweenAllSets([void 0,t,90],[void 0,this.colDiff.clone(),this.colShaded.clone()],i/2),functions:[{func:this.attachNeedleLeft.bind(this),delay:0}]}}collapseStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;return{primarySequences:s=this.tweenAllSets([90,0,90],[n],i/2),secondarySequences:o=this.tweenAllSets([void 0,t,Math.max(0,90-t)],[void 0,this.colDiff.clone(),this.colShaded.clone()],i/2),functions:[{func:this.attachNeedleRight.bind(this),delay:0}]}}fanOutStrategy(e,t,i){const n=this.colorPalette.neutral;let s;return{primarySequences:s=this.tweenAllSets([0,90+t,Math.max(0,90-t)],[n.clone(),this.colDiff.clone(),this.colShaded.clone()],i),functions:[{func:this.attachNeedleRight.bind(this),delay:0}]}}extendRightStrategy(e,t,i){const n=this.colorPalette.neutral;let s;return{primarySequences:s=this.tweenAllSets([90,t,Math.max(0,90-t)],[n.clone(),this.colDiff.clone(),this.colShaded.clone()],i),functions:[{func:this.attachNeedleRight.bind(this),delay:0}]}}extendLeftStrategy(e,t,i){const n=this.colorPalette.neutral;let s;return{primarySequences:s=this.tweenAllSets([Math.max(0,90-t),t,90],[this.colShaded.clone(),this.colDiff.clone(),n.clone()],i),functions:[{func:this.attachNeedleLeft.bind(this),delay:0}]}}leftToRightStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;return{primarySequences:s=this.tweenAllSets([90,0,90],void 0,i/2),secondarySequences:o=this.tweenAllSets([90,t,Math.max(0,90-t)],[n.clone(),this.colDiff.clone(),this.colShaded.clone()],i/2),functions:[{func:this.attachNeedleLeft.bind(this),delay:0},{func:e=>{e?this.attachNeedleLeft():this.attachNeedleRight()},delay:i/2},{func:this.attachNeedleRight.bind(this),delay:i}]}}rightToLeftStrategy(e,t,i){const n=this.colorPalette.neutral;let s,o;return{primarySequences:s=this.tweenAllSets([90,0,90],void 0,i/2),secondarySequences:o=this.tweenAllSets([Math.max(0,90-t),t,90],[this.colShaded.clone(),this.colDiff.clone(),n.clone()],i/2),functions:[{func:this.attachNeedleRight.bind(this),delay:0},{func:e=>{e?this.attachNeedleRight():this.attachNeedleLeft()},delay:i/2},{func:this.attachNeedleLeft.bind(this),delay:i}]}}constructSequences(e,t){r.logService.assert(this.dataSets&&this.dataSets.length>0,"no data sets defined!");const n=this.getSettings();let s,o;_.isUndefined(t)||(s=new m.KpiChartSettings(n.getModel()),o=new m.KpiChartSettings(t),n.setModel(t));const a=void 0!==n.getChange().value_abs?n.getChange().value_abs:n.getCurrentValue(),c=n.getTendency(),l=this.calculateArcRange(a,n.getOldValue());let d;c>0||!n.getOldValue()?(this.colDiff=this.colorPalette.positive.clone(),this.colShaded=this.colorPalette.shadedPositive.clone(),d="green"):(this.colDiff=this.colorPalette.negative.clone(),this.colShaded=this.colorPalette.shadedNegative.clone(),d="red");const u=this.currentTendency;let p,h,f;this.currentTendency=c,this.crossZero=u*this.currentTendency<0;const y=this.discoverStrategy(c,this.crossZero,n,t,s,o);if(!y)return r.logService.error("Could not find a valid strategy!",g.twCommon.logFeatures.Charts.Kpi,{tendency:c,crossZero:this.crossZero,settings:n,newModel:t,oldSettings:s,newSettings:o}),[];{const t=this.strategies[y].call(this,c,l,e);r.logService.debug("Chosen strategy:",g.twCommon.logFeatures.Charts.Kpi,{strategy:y,sequences:t,colors:{color:d,colDiff:this.colDiff,colShaded:this.colShaded}}),p=t.primarySequences,h=t.secondarySequences,f=t.functions||[]}this.animationComponent.hasSequenceFor(this.displayValues)&&this.animationComponent.unregisterSequence(this.displayValues);const v=this.animationComponent.tween(this.displayValues,[{key:"value",value:n.getCurrentValue(),duration:e},{key:"previous",value:n.getOldValue(),duration:e},{key:"tendency",value:a,duration:e}],this.displayValues);return v.onSetProgressCall.subscribe(()=>{r.logService.verbose("Updating display values",g.twCommon.logFeatures.Charts.Kpi,{_displayValues:this.displayValues}),this.currentValLabel.setText(n.getCurrentValueFormatted(this.displayValues.value));const e=i.Utilities.measureText(this.currentValLabel.getText(),n.getLabelSettings().getFont());e.width>this.getStyle(i.Style.Radius)&&(this.currentValueLabelSizeFactor=this.getStyle(i.Style.Radius)/e.width),i.ObjectCache.TextMetricsObjectPool.recycleObject(e),this.displayValues.previous>0?(this.prevValueLabel.setText(n.getOldValueFormatted(this.displayValues.previous)),this.prevValueLabel.getPresence().setStyle(i.Style.Opacity,1)):this.prevValueLabel.getPresence().setStyle(i.Style.Opacity,0),this.updateTendencyLabels(this.displayValues.tendency,this.displayValues.previous,this.displayValues.value),r.logService.verbose("Tendency: "+n.getTendencyFormatted(this.displayValues.previous,this.displayValues.value),g.twCommon.logFeatures.Charts.Kpi),this.updateLabels()},this),{sequences:[{delay:0,sequences:p.concat([v])},{delay:e/2,sequences:h}],functions:f}}tweenDataSet(e,t,i,n,s){const o=this.dataSets[e];this.animationComponent.hasSequenceFor(o)&&this.animationComponent.unregisterSequence(o);const a=[];_.isUndefined(i)||a.push({key:t,value:i,duration:s}),_.isUndefined(n)||a.push({key:"_color",value:n.clone(),duration:0}),r.logService.verbose("tweening dataset",g.twCommon.logFeatures.Charts.Kpi,{dataSet:o,keyValues:a});const c=this.animationComponent.tween(o,a,o);return _.isUndefined(c)||c.onSetProgressCall.subscribe(this.updateNeedlePosition,this),c}addEvents(e){return this.background.onSegmentEnter.subscribe(e=>{if(e===this.getNeedleAttachSegment()){e.isHovered=!0;const t=this;setTimeout(()=>{void 0!==e.getSequence()&&(e.popoverSub=e.getSequence().onDone.subscribeOnce(()=>{if(!0===e.isHovered){const i=t.getStageFacade().getActiveCamera();_.isUndefined(i)||t.openPopover(i,e,t.getStageFacade().getCanvas())}}))})}},this),this.background.onSegmentLeave.subscribe(e=>{e.isHovered=!1,this.bubbleOwner===e&&this.closePopover(),void 0!==e.popoverSub&&e.popoverSub.cancel()}),this}addTimelineEvents(e){(e=e||this.timeline).onPlay.subscribe(()=>{this.getStageFacade().blockEvents()}),e.onDone.subscribe(()=>{this.getStageFacade().unblockEvents()}),e.onPause.subscribe(()=>{this.getStageFacade().unblockEvents()})}openPopover(e,t,n){const s=this.getSettings();l.bubbleDialogService.destroyById(s.getBubbleId());const r=d.configurationService.getBubbleDialogConfiguration().getStyle(s.getBubbleId()),a=t.getData(),c=i.ObjectCache.PointPool.getObject().addFast(t.getContentCenter()).addFast(this.background.getPresence()),u=e.cameraToWindowCoordinates(c.getX(),c.getY());r.setArrowSide(g.twCommon.sides.BOTTOM),r.setVirtualObjectPresence(0,0),r.setAbsoluteXOrigin(g.twCommon.sides.CENTER),r.setAbsoluteYOrigin(g.twCommon.sides.TOP),r.setAbsoluteX(u.getX()),r.setAbsoluteY(u.getY()),r.setPositionOffsetX(0),r.setPositionOffsetY(0),i.ObjectCache.recycleObject(c),i.ObjectCache.recycleObject(u);const p=new o.PopoverData,h=s.getChange();h.old_value=s.getOldValue(),p.addValue(s.getLabel(),s.getCurrentValueFormatted(),h),a.setPopOverData(p),l.bubbleDialogService.createByType(s.getBubbleId(),$(n),s.getBubbleType(),a.getPopOverData().build(),r),this.bubbleOwner=t}closePopover(){l.bubbleDialogService.scheduleDestructionById(this.getSettings().getBubbleId(),500),this.bubbleOwner=void 0}createDataSet(e,t,i){const n=new o.Dataset(e,t.clone());n.disableEvents(i),this.dataSets.push(n)}createDataSets(){this.dataSets=[],this.displayValues={value:0,previous:0,tendency:0};const e=this.colorPalette.neutral;this.getSettings().getOldValue()?(this.createDataSet(90,e,!0),this.createDataSet(0,e,!1),this.createDataSet(90,e,!0)):(this.createDataSet(0,e,!0),this.createDataSet(0,e,!1),this.createDataSet(180,e,!0))}updateComponents(){this.background.getPresence().setX(this.chartCircle.getX()).setY(this.chartCircle.getY()).setStyle(i.Style.Radius,this.chartCircle.getRadius()).setStyle(i.Style.Depth,this.chartCircle.getDepth()),this.needleBase.setX(this.needleBaseCircle.getX()).setY(this.needleBaseCircle.getY()).setStyle(i.Style.Radius,this.needleBaseCircle.getRadius()),this.needle.setX(this.needleRectangle.getX()).setY(this.needleRectangle.getY()).setStyle(i.Style.Width,this.needleRectangle.getWidth()).setStyle(i.Style.Height,this.needleRectangle.getHeight())}buildMainComponent(){if(!this.background){const e=new i.Presence(this.chartCircle.getX(),this.chartCircle.getY(),i.Constants.Origin.TOP_LEFT);this.background=new p.PieChart(e,this.getWidget(),this.pieSettings).setStyle(i.Style.SourceAngle,180).setStyle(i.Style.EndAngle,360).setStyle(i.Style.Radius,this.chartCircle.getRadius()).setStyle(i.Style.Depth,this.chartCircle.getDepth()),this.addComponent(this.animationComponent),this.addChild(this.background)}}dispose(){super.dispose(),this.timeline&&this.timeline.dispose()}initialize(){this.animationComponent=new i.AnimationComponent,this.timeline=new i.Timeline,this.addTimelineEvents(),this.isReplay=!1,this.createDataSets();const e=new h.TwDataModel(this.dataSets);this.pieSettings=new f.PieChartSettings({model:e}).setAnimationDuration(400).enableDepthTween(!0).enableRadiusTween(!0).enableSourceAngleTween(!0).enableDataSetWatch(!0).setDelayComputation(!0).enableEndAngleTween(!0).enableColorTween(!0).enablePointerOnSlices(!1).setAngleMod(8).enableInitialAnimation(!1).setNumberFormatter(this.drawSettings.style.formatting.numberFormatter).enableClearLayerOnMouseOutSequenceEnd(!0),this.labelSettings.setColor(this.colorPalette.labelTendencyNeutral),this.buildMainComponent(),this.buildNeedle(),this.buildLabels()}buildTimeline(e,t,i){const n=this.constructSequences(e,i);_.each(n.sequences,e=>{const i=(t||0)+e.delay;e.sequences&&e.sequences.length>0&&_.each(e.sequences,e=>{e&&this.timeline.addSequence(e,i)})}),_.each(n.functions,e=>{if(e.func){const i=(t||0)+e.delay;this.timeline.addCallback(e.func,i>0?i:.1)}})}initializeFirstFrame(){this.timeline.setProgress(1e-6),this.timeline.setProgress(0)}playInitialAnimation(){this.isReplay||this.refresh()}refresh(e){r.logService.debug("Received new model, refreshing chart",g.twCommon.logFeatures.Charts.Kpi,{newModel:e,currentDataSets:this.dataSets});const t=this.getSettings().getTransitionDuration();this.timeline=new i.Timeline,this.addTimelineEvents(),this.buildTimeline(t,0,e),this.timeline.playOverTime(this.getSettings().getTransitionDuration())}switchModel(e,t){this.drawSettings=t,this.isDisposed()||(this.isReplay?(this.getSettings().setModel(e),this.syncTimeline()):this.refresh(e))}syncTimeline(e){this.isReplay=!0,this.sliderTimeline=this.sliderTimeline||e,this.timeline=new i.Timeline;const t=this.getSettings().getModel(),n=t.getData(),o=this.sliderTimeline.getDuration()/n.getAdditionalFrames().length,r=t.getWidget();_.each(n.getAdditionalFrames(),(e,t)=>{const i=new s.default(e),n=new y.KpiModel(i,r);0===t?this.buildTimeline(0,0,n):this.buildTimeline(o,(t-1)*o,n)}),e&&(this.timeline.syncToTimeline(e,!0),this.addTimelineEvents(e)),this.initializeFirstFrame()}updateDimensions(e){this.getPresence().setStyle(i.Style.Width,e.width).setStyle(i.Style.Height,e.height).setStyle(i.Style.Radius,e.radius),this.labelSettings.setMinFontSize(e.minFontSize),this.updateConstants(),this.updateComponents(),this.updateLabels()}}var w;t.KpiChart=b,function(e){e.FAN_OUT="FAN_OUT",e.FAN_IN_OUT="FAN_IN_OUT",e.EXTEND_RIGHT="EXTEND_RIGHT",e.EXTEND_LEFT="EXTEND_LEFT",e.LEFT_TO_RIGHT="LEFT_TO_RIGHT",e.RIGHT_TO_LEFT="RIGHT_TO_LEFT",e.FILL_LEFT="FILL_LEFT",e.FILL_RIGHT="FILL_RIGHT",e.REDUCE="REDUCE",e.COLLAPSE="COLLAPSE"}(w=t.KpiAnimationStrategy||(t.KpiAnimationStrategy={})),t.default=_.constant(b)}),define("classes/canvas_engine/core/entities/charts/pack_chart",["require","exports","canvas_engine","data_structures","event","map","reusable_services","reusable_utilities","services/bubble_dialog","services/configuration","services/confirmation_service","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","services/tw_number_formatter","classes/application/application","classes/custom_pages/custom_page_factory","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/canvas_engine/charts/src/implementations/default_chart","classes/canvas_engine/core/entities/circle"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w){Object.defineProperty(t,"__esModule",{value:!0});t.default=[function(){return class extends b.DefaultChart{constructor(e,t,i,n){i.delayComputation=!0,super(e,t,i),this.compute(),this.hasBubbles=!1,this.bubbleDelay=500,this.subscribed=!1,this.inflatedCircles=[],this.hoverBubble=void 0,this.onOrderedZoom=new s.Event,this.onReady=new s.Event,this._colorPalette=n,this.themeHighlightColor=n.themeHighlightColor.clone(),this.isAnimating=this.getChartSettings().isInitialAnimationEnabled(),this.isAnimating&&this.hide()}compute(){this.nodes=[],this.onOverlayStateChange=new s.Event,this.maxCircleRadius=Number.NEGATIVE_INFINITY,this.emojiCount=0,this.emojisReady=0,this.isReady=!1,this.animationComponent=new i.AnimationComponent,this.fadingAnimationComponent=new i.AnimationComponent,this.addComponent(this.animationComponent),this.addComponent(this.fadingAnimationComponent);const e=this.getChartSettings().getModel().getDataRoot();this._inflateNodes(e);const t=this._computeRoot(this,e);return this._computeStructure(t,e),e.children.length>0&&t.hideShape(),this.addChild(t),t.translate(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()),this.prepareInteractionWithHub(),this._setToInitialState(t),this}isEmojiTree(){return this.getWidget().isEmojiTree()}disableDetails(){this.noDetails=!0}enableDetails(){this.noDetails=!1}detailsDisabled(){return this.noDetails||!1}hasGauge(){return void 0!==this.gauge}addEvents(e){const t=this.getStageFacade();_.isUndefined(e)||(this._prepareInteractionWithGauge(e),this._addGaugeEvents()),this._addCircleEvents(this),this.subscriptions.push(t.onMouseClick.subscribe(function(e){let n=!1;this.queryChildTree(function(t){const i=t.getCircleShape,s=_.isFunction(i)?i.apply(t):t.component;n=n||s.containsPoint(e.mouse,e.camera)},function(e){return n}),t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Default||n||this._handleCircleClick(this.getChildren()[0])},this)),this.subscriptions.push(t.onMouseUp.subscribe(function(e){setTimeout(()=>{t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Default&&t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Pointer&&(t.getCanvas().style.cursor=i.Constants.Mouse.Cursor.Default)},100)},this)),this.subscriptions.push(t.onMouseLeave.subscribe(function(e){this._deflateCircles(),this._closeDialogs()},this)),this.subscriptions.push(t.onMouseEnter.subscribe(function(e){this._deflateCircles(),this._closeDialogs()},this));const n=t.getCameras()[0].getCameraSettings().getButtons(),s=this;return _.each(n,function(){s.subscriptions.push(t.onMouseEnter.subscribe(function(e){setTimeout(()=>{s._closeDialogs()},100)}))}),this.getChartSettings().isInitialAnimationEnabled()&&this.getStageFacade().blockEvents(),this}_addGaugeEvents(){const e=this,t=this.getStageFacade();void 0!==this.gauge&&this.gauge.setInteractiveState(!0),_.isUndefined(this.gauge.onMouseLeave)?i.logService.verbose("gauge was not initialized for interaction before being treated by packchart",i.Constants.Feature.Entities.Charts.PackChart,e.gauge):this.subscriptions.push(e.gauge.onMouseLeave.subscribe(function(n){e.initialState||t.getActiveCamera().enableZoom([i.Constants.ZoomType.Wheel]),e.fetchEntry=!0})),_.isUndefined(this.gauge.onMouseEnter)?i.logService.verbose("gauge was not initialized for interaction before being treated by packchart",i.Constants.Feature.Entities.Charts.PackChart,e.gauge):this.subscriptions.push(e.gauge.onMouseEnter.subscribe(n=>{t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Move&&(setTimeout(()=>{t.getActiveCamera().disableZoom([i.Constants.ZoomType.Wheel]),e._closeDialogs()},100),e.reset())})),_.isUndefined(this.gauge.onMouseUp)?i.logService.verbose("gauge was not initialized for interaction before being treated by packchart",i.Constants.Feature.Entities.Charts.PackChart,e.gauge):this.subscriptions.push(e.gauge.onMouseUp.subscribe(t=>{if(e.gauge.isHovering()){e.gauge.onMouseEnter.fire(),(e.gauge.getAllComponentsOf(i.Constants.ComponentClasses.Rectangle)||[]).forEach(e=>{e.isHovering()&&e.onMouseEnter.fire()})}}))}_addCircleEvents(e){const t=this.getStageFacade();_.each(e.getChildren(),function(n){if(n instanceof w.CircleEntity||this.isEmojiTree()||n.isEmoji){this._addCircleEvents(n);const s=n.getCircleShape;let o,r;_.isFunction(s)?r=o=s.apply(n):(o=n.component,r=n),o.setInteractiveState(!0),this.subscriptions.push(o.onMouseEnter.subscribe(function(e){this.hasGauge()&&this.gauge.isHovering()||(t.getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer,(e.id!==this.previousEnterId||void 0!==this.currentButton&&this.nodes.indexOf(o.getOwner())>-1)&&(this.fetchEntry&&(this.fetchEntry=!1),e.camera.isZooming()||(this._generateDialogs(n),this._inflateCircleShape(o,r)),this.previousEnterId=e.id))},this)),this.subscriptions.push(o.onMouseMove.subscribe(function(e){t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Pointer&&t.getCanvas().style.cursor!==i.Constants.Mouse.Cursor.Move&&(t.getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer),this.previousMoveId===e.id&&(this.previousMoveId=void 0,this.previousEnterId=void 0,this.fetchEntry=!0),this.fetchEntry&&(o.onMouseEnter.fire(e),this.previousMoveId=e.id)}.bind(this))),this.subscriptions.push(o.onMouseClick.subscribe(function(e){o.getOwner()!==this.getChildren()[0]&&this.previousClickId!==e.id&&(this.hasGauge()&&this.gauge.isHovering()||e.camera.areButtonsHovering()||t.getCanvas().style.cursor===i.Constants.Mouse.Cursor.Move||(this.previousClickId=e.id,this._handleCircleClick(n)))}.bind(this))),this.subscriptions.push(o.onMouseLeave.subscribe(function(){this.bubbleOwner===n&&(e!==this.getChildren()[0]?this._generateDialogs(e):(this.hasGauge()&&this.gauge.isHovering()||(t.getCanvas().style.cursor=i.Constants.Mouse.Cursor.Default),this._closeDialogs())),this._deflateCircleShape(o,r)},this))}},this)}_checkThemeState(){const e=this.getChartSettings().getModel(),t=e.getEmergingListElement(),i=e.getDecreasingListElement(),n=e.getNewListElement();_.isUndefined(t)||this._checkSingleThemeState(t),_.isUndefined(i)||this._checkSingleThemeState(i),_.isUndefined(n)||this._checkSingleThemeState(n)}_checkSingleThemeState(e){const t=$(e),i=this.inflatedCircles.map(function(e){return(void 0!==e.component?e.getData():e.getParent()&&e.getParent().getCircleData()).name}),n=this.themeHighlightColor.toRGBAString();t.find("li").each(function(){const e=$(this),t=0===e.find("img").size()?e.children("div.name").text():e.find("img").attr("alt");-1===i.indexOf(t)?e.css("background-color",""):e.css("background-color",n)})}getThemeHighlightColor(){return this.themeHighlightColor}_inflateCircleShape(e,t){if(this.animationComponent.hasSequenceFor(e)){const n=e instanceof i.ImageComponent?e:e.getParent();if(_.isFunction(n.getStyle(i.Style.Layer))||n.setStyle(i.Style.Layer,function(e){return e+1}),_.isUndefined(e.doneSub)||(e.doneSub.cancel(),e.doneSub=void 0),_.isUndefined(e.sequenceFacade)){const t=this.animationComponent.accessSequenceFor(e);t.reset(),t.resume(),e.sequenceFacade=t}else e.sequenceFacade.isPlaying()||(e.sequenceFacade.reset(),e.sequenceFacade.resume());this.inflatedCircles.indexOf(t)<0&&this.inflatedCircles.push(t),this._checkThemeState()}}_deflateCircleShape(e,t){if(!_.isUndefined(e)){const n=this;e.getParent().resetStyle(i.Style.Layer),_.isUndefined(e.sequenceFacade)||(e.sequenceFacade.setReverseState(!0),e.sequenceFacade.isPlaying()||e.sequenceFacade.resume(),n.inflatedCircles.splice(n.inflatedCircles.indexOf(t),1),e instanceof i.ImageComponent?e.resetStyle(i.Style.Layer):e.hasParent()&&e.getParent().resetStyle(i.Style.Layer),n._checkThemeState())}}_deflateCircles(e){const t=e||this.inflatedCircles;for(let e=t.length-1;e>=0;e--){const i=void 0!==t[e].component?t[e].component:t[e];this._deflateCircleShape(i,t[e])}}deflateCirclesDelayed(e,t){setTimeout(function(e){this._deflateCircles(t)}.bind(this),e)}_inflateCircles(e){const t=e||this.nodes,i=this;_.each(t,function(e,t){const n=void 0!==e.component?e.component:e;i._inflateCircleShape(n,e)})}_handleCircleClick(e){this._removeHoverBubble(),this._closeDialogs(),this.maxDepth<2&&e!==this.getChildren()[0]?this.detailsDisabled()||(this.getStageFacade().blockEvents(),this.openDrilldownByEntity(e)):e===this.getChildren()[0]?(this.activeCircle=e,this.previousCircle=void 0,this.previousParent=void 0,this.invalidate()):_.isUndefined(this.previousCircle)||this.previousCircle!==e&&(!_.isUndefined(this.previousParent)&&this.previousParent!==e&&this.previousParent!==e.getParent()||_.isUndefined(this.previousParent)&&this.previousCircle!==e.getParent())?(e.getChildren().length>1?(this.activeCircle=e,this.previousParent=e):(this.activeCircle=e.getParent(),this.previousParent=e.getParent()),this.initialState||(this.previousCircle=e,this._generateDialogs(e,!0)),this.invalidate()):e!==this.getChildren()[0]&&(this.detailsDisabled()||(this._deflateCircles(),this.getStageFacade().blockEvents(),this.openDrilldownByEntity(e)))}isBestThemesTree(){return void 0!==this.getWidget().getMenu().getHashtagMenu()&&void 0!==this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0]&&this.getWidget().getMenu().getHashtagMenu().getSelectedEntriesRecursively()[0].getMappedId()===constants.root_id.sampled_themes}_generateDialogs(e,t){if(e!==this.getChildren()[0]){this._closeDialogs(),this.bubbleOwner=e;let n=this.bubbleDelay;t&&(n+=1e3*this.zoomDuration);const s=this,o=s.getStageFacade().getCanvas();if(!m.mainApplication.getPageState().getAllowedPages().isSearch()&&_.isUndefined(this.contextMenuTimeout)){const t=s.previousParent!==e.getParent()&&e.getParent()!==s.getChildren()[0];this.contextMenuTimeout=setTimeout(function(){if(!_.isUndefined(o)&&_.isUndefined(s.hoverBubble)){const n=s.getStageFacade(),r=n.getActiveCamera(),a=r.getZoom(),g=i.Utilities.computeScaledLength(e.getStyle(i.Style.Radius),r.getStyleMap()),u=s.getChartSettings().getBubblePadding(),h=i.Utilities.computeDrawSettings(e.getPresence(),r.getStyleMap(),r.getOffset()),m=i.ObjectCache.PointPool.getObject().setCoordinates(h.x,h.y);i.ObjectCache.DrawSettingsPool.recycleObject(h);const f=i.ObjectCache.PointPool.getObject().addFast(r.getStageOrigin()),y=r.cameraToWindowCoordinates(f,void 0),v=y.getX(),S=y.getY(),b=y.getX()+n.getStyle(i.Style.Width),w=y.getY()+n.getStyle(i.Style.Height);i.ObjectCache.recycleObject(f),i.ObjectCache.recycleObject(y);let C=2;if(!s.detailsDisabled()||t){const n={buttons:[]};t&&n.buttons.push({icon:"fa fa-search-plus",text:"zoom to parent",onClick:function(){s._removeHoverBubble(),setTimeout(()=>{s._handleCircleClick(e)},150),this.close(),s.contextMenuTimeout=void 0}}),s.detailsDisabled()||n.buttons.push({icon:"fa fa-bars",text:window.messages.get("_489448"),onClick:function(){s._removeHoverBubble(),s.getStageFacade().blockEvents(),s.openDrilldownByEntity(e,this)}}),tw.pageState.getAllowedPages().isSearchAdvanced()||n.buttons.push({icon:"fa fa-ban",text:window.messages.get("_973823"),onClick:function(){s._removeHoverBubble(),s._closeDialogs(),d.confirmationService.display({message:window.messages.get("_117793")}).then(()=>{s._blockTheme(e)},()=>{})}}),(tw.pageState.isEditMode()&&tw.pageState.getAllowedPages().isDashboard()||tw.pageState.getAllowedPages().isReport())&&n.buttons.push({icon:"fa fa-trash",text:window.messages.get("_914504"),onClick:function(){s._removeHoverBubble(),s._closeDialogs(),d.confirmationService.display({message:window.messages.get("_510062")}).then(()=>{s._deleteTheme(e)},()=>{})}});const h=s.getChartSettings().getMenuId(),f=l.configurationService.getBubbleDialogConfiguration().getStyle(h);f.setArrowSide(p.twCommon.sides.TOP),f.setAbsoluteXOrigin(p.twCommon.sides.CENTER),f.setAbsoluteYOrigin(p.twCommon.sides.TOP);const y=i.ObjectCache.PointPool.getObject().addFast(m);_.isFunction(e.getCircleData)?y.translate(0,g):y.translate(e.component.getStyle(i.Style.Width)*a/2,e.component.getStyle(i.Style.Height)*a);const S=r.cameraToWindowCoordinates(y.getX(),y.getY()).translate(0,u);for(w<S.getY()&&S.setY(w);v>S.getX()||b<S.getX();){for(;v>S.getX();)S.translate(g/C,0),C*=2;for(;b<S.getX();)S.translate(-g/C,0),C*=2}f.setAbsoluteX(S.getX()),f.setAbsoluteY(S.getY()),i.ObjectCache.recycleObject(S),i.ObjectCache.recycleObject(y),c.bubbleDialogService.destroyById(h);const E=c.bubbleDialogService.createDropDownMenu(h,o,n,f);E.onMouseEnter.subscribeOnce(function(){s._setHoverBubble(E)}),E.onMouseLeave.subscribeOnce(function(){s.fetchEntry=!0,s._removeHoverBubble()})}if(!s.isBestThemesTree()||0===e.getChildren().length){const t=i.ObjectCache.PointPool.getObject().addFast(m);_.isFunction(e.getCircleData)?t.translate(0,-g):t.translate(e.component.getStyle(i.Style.Width)*a/2,0);const n=r.cameraToWindowCoordinates(t.getX(),t.getY()).translate(0,-u);for(S>n.getY()&&n.setY(S),C=2;v>n.getX()||b<n.getX();){for(;v>n.getX();)n.translate(g/C,0),C*=2;for(;b<n.getX();)n.translate(-g/C,0),C*=2}s._openPopover(n,e,o),i.ObjectCache.recycleObject(m),i.ObjectCache.recycleObject(t),i.ObjectCache.recycleObject(n),s.hasBubbles=!0}}},n)}}}_blockTheme(e){e.getParent().removeChild(e);const t=e.getCircleData,n=_.isFunction(t)?t.apply(e):e.getData();let s;if(this._isNamedEntity(e)){const e=n.id.split("\t");if(e.length>1){s={name:e[1]}}}if(_.isUndefined(s)){s={name:n.name}}const o={tag_cloud_panel_entries:[s]},r=this.getChartSettings().getModel().getBlockedThemesLink(),a=this;u.restFormService.post(r,o,constants.events.form.action.add_one).then(function(){e.dispose();const t=a.getWidget();if(t.prepareReload(),t.hasPageState()&&t.getPageState().getApplication()){const e={strategy:v.ModelRefreshStrategy.REFRESH},n=y.modelRefreshDecoratorFactory.getDecorator(t.getPageState(),t.getApplication(),S.ModelType.WIDGET,e);g.modelRefreshService.refresh(n,e).then(function(){},function(e){e instanceof Error&&i.logService.error("Error when refreshing widget!",void 0,e)})}else i.logService.error("reload attempted on widget without page state, this could be due to a memory leak",p.twCommon.logFeatures.WidgetWrapper)})}_deleteTheme(e){e.getParent().removeChild(e);const t=this.getWidget().getExtendedConfiguration()._extendedConfiguration;_.isUndefined(t.blocked_themes)&&(t.blocked_themes=[]);const i=e.getText();t.blocked_themes.push(i),f.CustomPageFactory.getPageFromPageState(tw.pageState).saveWidget(this.widget),e.dispose()}_isNamedEntity(e){const t=e.getCircleData,i=_.isFunction(t)?t.apply(e):e.getData(),n=a.StringUtils.parseFilters(i.filter);return p.twCommon.isSmartTheme(n)}openDrilldownByValue(e){const t=this,i=_.filter(t.nodes,function(i){return t._getNodeName(i.getParent().getCircleData())===e});if(i.length>0){const e=[];let n;_.each(i,function(i){e.push(a.StringUtils.parseFilters(i.getParent().getCircleData().filter)),n=t._getRequestedPageType(i.getParent())});const s=new o.Map;_.each(e,function(e){_.each(e,function(e){_.isUndefined(s.get(e.key))&&s.set(e.key,[]);const t=s.get(e.key);_.filter(t,function(t){return t.key===e.key&&t.value===e.value}).length<=0&&t.push(e)})});const r=[];_.each(s.keys(),function(e){r.push(s.get(e))}),t.openDrilldown(r,void 0,n)}}openDrilldownByEntity(e,t){const i=e.getCircleData,n=_.isFunction(i)?i.apply(e):e.getData(),s=[a.StringUtils.parseFilters(n.filter)];this.openDrilldown(s,t,this._getRequestedPageType(e))}_getRequestedPageType(e){const t=e.getCircleData,i=function(e){return e.getCircleData().requested_page_type},n=function(e){return!(_.isUndefined(e.getCircleData().requested_page_type)&&e.getParent()instanceof w.CircleEntity)};let s=(_.isFunction(t)?t.apply(e):e.getData()).requested_page_type;return _.isUndefined(s)&&(s=e.queryParentChain(i,n)),s}_setHoverBubble(e){this.hoverBubble=e}_removeHoverBubble(){this.hoverBubble=void 0,this.fetchEntry=!0}getLegend(){return this.legend}getMaxCircleRadius(){return this.maxCircleRadius}_getConcernedNodes(e){return _.filter(this.nodes,function(t){const i=void 0!==t.component?t.getData():t.getParent()&&t.getParent().getCircleData();return e.indexOf(i.name)>-1})}adaptListPointer(e){void 0!==e&&void 0!==e.children[1]&&(e.children[1].style.cursor=i.Constants.Mouse.Cursor.Pointer)}prepareInteractionWithHub(){const e=this.getChartSettings().getModel().getEmergingThemes();void 0!==e&&(this.emergingThemes=this._getConcernedNodes(e),this.adaptListPointer(this.getChartSettings().getModel().getEmergingListElement()));const t=this.getChartSettings().getModel().getDecreasingThemes();void 0!==t&&(this.decreasingThemes=this._getConcernedNodes(t),this.adaptListPointer(this.getChartSettings().getModel().getDecreasingListElement()));const i=this.getChartSettings().getModel().getNewThemes();void 0!==i&&(this.newThemes=this._getConcernedNodes(i),this.adaptListPointer(this.getChartSettings().getModel().getNewListElement()))}_prepareInteractionWithGauge(e){this.gauge=e;const t=this;_.each(e.getAllComponentsOf(i.Constants.ComponentClasses.Rectangle),function(i){const n=e.animationComponent.accessSequenceFor(i),s=i.getData().getData();_.each(t.nodes,function(e){let i;void 0!==e.component?(i=e.getData().id,e=e.component):i=e.getParent().getCircleData().id,s.indexOf(i)>-1&&n.chainSequence(t.animationComponent.accessSequenceFor(e))})})}inflateEmergingThemes(e){this.isAnimating||this.inflateCirclesFromMetrics(this.emergingThemes,e)}inflateDecreasingThemes(e){this.isAnimating||this.inflateCirclesFromMetrics(this.decreasingThemes,e)}inflateNewThemes(e){this.isAnimating||this.inflateCirclesFromMetrics(this.newThemes,e)}inflateCirclesFromMetrics(e,t){if(!this.isAnimating&&this.hasStageFacade()&&!this.getStageFacade().isPressed()){const i=function(e){return(void 0!==e.component?e.getData():e.getParent()&&e.getParent().getCircleData()).name===t},n=this,s=_.filter(e,i);s.length>0&&n._inflateCircles(s)}}_inflateNodes(e){const t=this.getStyle(i.Style.Radius);e.center_x*=t,e.center_y*=t,e.radius*=t,e.children.length>0&&_.each(e.children,function(e){this._inflateNodes(e)},this),0!==e.depth&&(this.maxCircleRadius=Math.max(this.maxCircleRadius,e.radius))}update(e){if(super.update(),!this.isReady&&this.emojiCount===this.emojisReady){this.isReady=!0;const e=this;this.getStageFacade().onDrawEnd.subscribeOnce(function(){e.onReady.fire()}),requestAnimationFrame(function(){e.hasStageFacade()&&(e.invalidate(),e.getStageFacade().processUpdate())})}}_handleCircleZoom(e){if(!_.isUndefined(this.activeCircle)){if(this.initialState)this._dropInitialState(e),this.previousParent=void 0;else if(!(this.activeCircle===this.getChildren()[0]&&e.getZoom()<=1)){let t=this.activeCircle.getStyle(i.Style.Radius);this.activeCircle.hasChildren()?this.activeCircle.getCircleData().radius===this.getMaxCircleRadius()?t=.9*this.getMaxCircleRadius():t+=Math.log(t)/Math.log(5):t+=this.getChartSettings().getBubblePadding();const n=this._normalizeZoom(this.getMaxCircleRadius()/t);let s;s=this.activeCircle!==this.getChildren()[0]?e.getCenter().subtract(this.activeCircle.getPresence().toPoint().multiply(n)):new i.Point(0,0),this._normalizeOffset(s,n),e.zoomTo(n,this.zoomDuration,s),i.ObjectCache.recycleObject(s)}this.activeCircle=void 0}}scheduleOrderedZoom(e){this.orderedZoom=e,this.invalidate()}_handleOrderedZoom(e){if(!_.isUndefined(this.orderedZoom)){_.isUndefined(this.previousClickId)||(this.previousClickId=void 0);const t=e.getCameraSettings().regulateZoom(this.orderedZoom.cameraScale),i=e.getCameraSettings().regulateOffset(this.orderedZoom.cameraOffset,t),n=this.orderedZoom.duration||this.getChartSettings().getTransitionDuration();e.zoomTo(t,n,i,this.getChartSettings().isInitialAnimationEnabled()),t>1&&this._dropInitialState(e),this.orderedZoom=void 0,this.onOrderedZoom.fire(e.sequenceFacade)}}_normalizeOffset(e,t){const n=this.getStageFacade(),s=.9*n.getWidth()*t,o=.9*n.getHeight()*t;e.setX(i.Utilities.clamp(e.getX(),-s,s)),e.setY(i.Utilities.clamp(e.getY(),-o,o))}_normalizeZoom(e){return i.Utilities.clamp(e,1,100)}_dropInitialState(e){this.initialState&&(this.initialState=!1,this.maxDepth>1&&(this._initializeZoomState(this.getChildren()[0]),this.onOverlayStateChange.fire(this.initialState)),void 0===e&&this.hasStageFacade()&&(e=this.getStageFacade().getActiveCamera()),void 0!==e&&e.enableZoom([i.Constants.ZoomType.Button],!0))}_initializeZoomState(e){if(e.hasChildren())e.hasLabel()&&(e.getLabel().unlock(),e.getLabel().hide(),e.getLabel().lock()),_.each(e.getChildren(),function(e){(e instanceof w.CircleEntity||void 0!==e.component)&&this._initializeZoomState(e)},this);else if(e!==this.getChildren()[0])if(e instanceof w.CircleEntity){if(e.hasLabel()&&(e.getLabel().getSettings().getColor().darken(100,!0),e.getLabel().getSettings().getBorderColor().darken(100,!0)),e.hasStyle(i.Style.Color)){const t=e.getStyle(i.Style.Color);_.isUndefined(t)||(t.setAlpha(1),e.setStyle(i.Style.Color,t))}if(e.hasStyle(i.Style.BorderColor)){const t=e.getStyle(i.Style.BorderColor);t.setAlpha(t.a/.6),e.setStyle(i.Style.BorderColor,t)}}else void 0!==e.component&&e.component.setStyle(i.Style.Opacity,1);this._updateHoverColor(e),e.invalidate()}_updateHoverColor(e){if(e instanceof w.CircleEntity){const t=e.getCircleShape();if(this.animationComponent.hasSequenceFor(t)){this.animationComponent.accessSequenceFor(t).getAnimations()[0].getModels()[2].setOriginalValue(e.getStyle(i.Style.Color))}}}draw(e){if(!this.subscribed){const t=this;t.subscriptions.push(e.onZoomEnd.subscribe(function(n){n.zoomLevelX<=1&&!t.initialState&&(t._setToInitialState(t.getChildren()[0]),t.maxDepth>1&&e.disableZoom(i.Constants.ZoomType.Button,!0),t.getStageFacade().setCursor(i.Constants.Mouse.Cursor.Default)),t.invalidate(),t.fetchEntry=!0})),t.subscriptions.push(e.onZoom.subscribe(_.throttle(function(e){this.isAnimating||(t._closeDialogs(10),t.previousClickId=void 0,t._deflateCircles())}),33)),t.subscriptions.push(e.onDisabledZoom.subscribe(function(n){!t.initialState||t.hasGauge()&&t.gauge.isHovering()||(n.type===i.Constants.ZoomType.Wheel&&n.data.value>0||n.type===i.Constants.ZoomType.Button&&!n.data.zoomOut||n.type===i.Constants.ZoomType.Triggered)&&t._dropInitialState(e)})),t.subscriptions.push(e.onButtonZoom.subscribe(function(i){t.initialState&&(i.zoomOut||t._dropInitialState(e)),t.previousCircle=void 0,t.previousParent=void 0})),t.subscriptions.push(e.onWheelZoom.subscribe(function(e){t.previousCircle=void 0,t.previousParent=void 0})),t.subscriptions.push(e.onTranslate.subscribe(function(e){t._closeDialogs(),t.invalidate()}));const n=function(){return!_.isUndefined(t.activeCircle)},s=function(){return!_.isUndefined(t.orderedZoom)};e.registerZoomTrigger(t._handleCircleZoom.bind(t),n.bind(t)),e.registerZoomTrigger(t._handleOrderedZoom.bind(t),s.bind(t)),this.maxDepth<=1&&e.enableZoom([i.Constants.ZoomType.Button],!0),t.subscribed=!0}super.draw(e)}_setToInitialState(e,t){if(!this.initialState){const n=this.getChildren()[0];if(this.maxDepth>1&&this.getSettings().shouldDrawParentNames()){if(e!==this.getChildren()[0])if(e.hasChildren())e.hasLabel()&&(e.getLabel().unlock(),e.getLabel().show(),e.getLabel().lock());else if(e instanceof w.CircleEntity){e.hasLabel()&&(e.getLabel().getSettings().getColor().lighten(100),e.getLabel().setStyle(i.Style.Color,e.getLabel().getSettings().getColor()),e.getLabel().getSettings().getBorderColor().lighten(100),e.getLabel().setStyle(i.Style.BorderColor,e.getLabel().getSettings().getBorderColor()));const t=e.getStyle(i.Style.Color),n=e.getStyle(i.Style.BorderColor);_.isUndefined(t)||(t.setAlpha(.6*t.a),e.setStyle(i.Style.Color,t)),_.isUndefined(n)||(n.setAlpha(.6*n.a),e.setStyle(i.Style.BorderColor,n))}else void 0!==e.component&&e.component.setStyle(i.Style.Opacity,.5);_.each(e.getChildren(),function(e){(e instanceof w.CircleEntity||void 0!==e.component)&&this._setToInitialState(e,!0)},this)}else e.hasLabel()&&(e.getLabel().unlock(),e.getLabel().hide()),n.hasLabel()&&n.getLabel().lock();this._updateHoverColor(e),t||(this.initialState=!0,this.onOverlayStateChange.fire(this.initialState))}}_computeStructure(e,t){_.each(t.children,function(t){const i=this._computeNode(e,t);t.children.length>0&&this._computeStructure(i,t),e.addChild(i,0)},this)}_getNodeName(e){const t=this.getWidget();let i;return i=t&&t.isTranslateAll()&&e.translated_name?e.translated_name:e.name,a.StringUtils.recoverApostrophes(i)}reset(e){this.animationComponent.reset(),e||this._closeDialogs(),this.inflatedCircles=[],this._checkThemeState()}revert(e){this._deflateCircles(),setTimeout(function(t){this.reset(e)}.bind(this),500)}_computeRoot(e,t){if(t.children.length>0)return this._computeNode(e,t)}_prepareAnimation(e,t){if(this.getChartSettings().isInitialAnimationEnabled()){t=t||this.getChartSettings().getTransitionDuration(),this.fadingSequence=this.fadingAnimationComponent.getChainBase([t]),_.isUndefined(e)||e.chainSequence(this.fadingSequence),this.firstSequence=e||this.fadingSequence;const n=this;this.getChildren()[0].queryChildTree(function(e){const s=[];let o=e;if(void 0!==e.component)if((o=e.component)instanceof i.ImageComponent){const e=o.getStyle(i.Style.Width),n=o.getStyle(i.Style.Height);o.setStyle(i.Style.Width,1),o.setStyle(i.Style.Height,1),s.push({key:i.Style.Width,value:e,duration:t},{key:i.Style.Height,value:n,duration:t})}else{const e=o.fontSize;o.fontSize=1,s.push({key:"fontSize",value:e,duration:t})}else{e.setStyle(i.Style.Opacity,1);const n=e.getStyle(i.Style.Radius);e.setStyle(i.Style.Radius,1),s.push({key:i.Style.Radius,value:n,duration:t})}if(0===e.getChildren().length){let r=1;n.maxDepth>=2&&n.initialState&&o instanceof i.ImageComponent&&(r=.5),o.setStyle(i.Style.Opacity,0);const a=o.getPresence().toRelativePoint();o.getPresence().setPositionRelativeTo(e.getParent().getPresence()),s.push({key:i.Style.Opacity,value:r,duration:t},{key:"presence",value:a,duration:t})}else s.push({key:i.Style.Opacity,value:1,duration:t});const r=n.fadingAnimationComponent.tween(o,s,e);n.fadingSequence.chainSequence(r)})}}animate(e,t,i){if(this.getChartSettings().isInitialAnimationEnabled()){this._prepareAnimation(e,t),this.isAnimating=!0;const n=this.initialState,s=this,o=this.fadingSequence.onDone.subscribe(function(){requestAnimationFrame(function(){s.isAnimating=!1,s.getStageFacade().unblockEvents(),s.firstSequence=void 0,o.cancel(),n||(s.initialState=!0,s._dropInitialState(i)),s.invalidate()})});this.show(),this.firstSequence.resume()}this.invalidate()}setOverlayStateActive(e){e?this._setToInitialState(this.getChildren()[0]):this._dropInitialState()}_computeCircle(e,t,n,s,o){let r,a;const c=this.getChartSettings().getLabelSettings().clone(),l=c.getFont();if(l.setSize(Math.ceil(Math.max(l.getMinSize(),Math.pow(t.radius,1/(1.1+1/t.radius))))),t.children.length>0)if(s.setStyle(i.Style.LineDash,[Math.log(Math.max(t.radius,Math.E))]).setStyle(i.Style.Radius,t.radius+3).setStyle(i.Style.Layer,1).setStyle(i.Style.BorderColor,e).setStyle(i.Style.BorderThickness,1.8),0===t.depth)r=new w.CircleEntity(s);else{c.setColor(e.clone().setAlpha(.9*e.a)).setBorderColor(e.clone().setAlpha(.5*e.a)).setBorderThickness(.1);const t=this.getChartSettings().shouldDrawParentNames()?n:void 0;(r=new w.CircleEntity(s,t,c)).hasLabel()&&r.getLabel().setStyle(i.Style.Layer,function(e){return e+2}),this.legend.push({label:n,color:e.toHex6()})}else{const o=this.getChartSettings().getAnimationDuration(),l=e.clone().setAlpha(.5*e.a);s.setStyle(i.Style.Color,e).setDefaultStyle(i.Style.LineDash).setStyle(i.Style.Radius,t.radius).setStyle(i.Style.BorderColor,l).setStyle(i.Style.BorderZoom,!0).setStyle(i.Style.BorderThickness,0);const d=(a=(r=new w.CircleEntity(s,n,c)).getCircleShape()).getStyle(i.Style.Radius),g=[{key:i.Style.Radius,value:1.07*d,duration:o},{key:i.Style.BorderThickness,value:1+.15*d,duration:o},{key:i.Style.Color,value:e.clone().lighten(10,!0),originalValue:e,duration:o}],u=this.animationComponent.tween(r,g,a);a.subscriptions.push(u.onDone.subscribe(function(){u.isReversed()&&u.setReverseState(!1)})),this.nodes.push(a)}return this.getChartSettings().isInitialAnimationEnabled()&&r.setStyle(i.Style.Opacity,0),r.setPopoverData(o),r.setCircleData(t),r}_computeNode(e,t){_.isUndefined(this.maxDepth)&&(this.maxDepth=0),this.maxDepth=t.depth>this.maxDepth?t.depth:this.maxDepth;const n=new a.Color(t.color),s=this._getNodeName(t),o=t.center_x-e.getPresence().getAbsoluteX(),r=t.center_y-e.getPresence().getAbsoluteY(),c=i.Presence.zero(e.getPresence());c.translate(o,r);const l=this._computePopoverdata(t,n,s);return t.children.length>0||!this.isEmojiTree()&&!a.StringUtils.containsHTML(this._extractEmojiContent(s))?this._computeCircle(n,t,s,c,l):this._computeEmoji(t,s,c,n,l)}_extractEmojiContent(e){return r.emojiService.parseTextForEmoji(e)}_computeEmoji(e,t,n,s,o){const c=this;let l;const d=this.getChartSettings().getLabelSettings().clone(),g=d.getFont();g.setSize(1.8*e.radius);const u=new i.Entity(n),p=this.getChartSettings().getAnimationDuration(),h=1.8*e.radius,m=1.8*e.radius;g.setSize(h);const _=n.generateChild().setStyle(i.Style.BorderColor,s.clone().setAlpha(.5*s.a)).setStyle(i.Style.BorderZoom,!0).setStyle(i.Style.BorderThickness,0);n.translate(-h/2,-m/2);const f=[{key:i.Style.BorderThickness,value:1+.15*e.radius,duration:p}],y=this._extractEmojiContent(t);if(a.StringUtils.containsHTML(y)&&0===y.trim().indexOf("<")){this.emojiCount++,l=new i.ImageComponent($(y)[0].src,!1,_),r.emojiService.parseTextForCanvasEmoji(t).then(function(e){l.changeUrl($(e)[0].src),c.emojisReady++,c.emojiCount===c.emojisReady&&c.hasStageFacade()&&requestAnimationFrame(function(){c.hasStageFacade()&&c.getStageFacade().processUpdate()})}),l.buildShape(i.Constants.Shape.Rectangle),l.setStyle(i.Style.Width,h).setStyle(i.Style.Height,m);const e=_.toRelativePoint().subtractFast(.075*h,.075*m);u.addComponent(l),f.push({key:i.Style.Width,value:1.15*h,duration:p},{key:i.Style.Height,value:1.15*m,duration:p},{key:"presence",value:e,duration:p})}else l=new i.LabelComponent(_,t,d),u.addComponent(l),f.push({key:i.Style.Color,value:s.clone().lighten(10,!0),originalValue:s,duration:p},{key:"fontSize",value:1.15*h,originalValue:s,duration:p});const v=this.animationComponent.tween(l,f,l);return l.subscriptions.push(v.onDone.subscribe(function(){v.isReversed()&&v.setReverseState(!1)})),this.nodes.push(u),u.component=l,this.getChartSettings().isInitialAnimationEnabled()&&u.setStyle(i.Style.Opacity,0),u.isEmoji=!0,u.setPopoverData(o),u.setData(e),u}_computePopoverdata(e,t,i){const s=new n.PopoverData(t.toHex6(),i,!0),o=e.metric.label;if(this.getChartSettings().isSentiment())s.addValue(o,{hits:h.twNumberFormatter.getInstance().toDecimal(e.metric.value),isTotal:!0}).addValue("Positive",{hits:h.twNumberFormatter.getInstance().toDecimal(e.positive_hits),isPositive:!0}).addValue("Neutral",{hits:h.twNumberFormatter.getInstance().toDecimal(e.neutral_hits),isNeutral:!0}).addValue("Negative",{hits:h.twNumberFormatter.getInstance().toDecimal(e.negative_hits),isNegative:!0});else{const t=e.metric.previous_value,i=e.metric.value;let r="";r=this.isBestThemesTree()?h.twNumberFormatter.getInstance().toPercentage(i/e.total_document_count):h.twNumberFormatter.getInstance().toDecimal(i),_.isUndefined(t)?s.addValue(o,r):s.addValue(o,r,new n.Tendency(i,t).build())}return s}_openPopover(e,t,i){c.bubbleDialogService.destroyById(this.getChartSettings().getBubbleId());const n=l.configurationService.getBubbleDialogConfiguration().getStyle(this.getChartSettings().getBubbleId());n.setAbsoluteX(e.getX()),n.setAbsoluteY(e.getY()),n.setPositionOffsetY(0),n.setArrowSide(p.twCommon.sides.BOTTOM),n.setAbsoluteXOrigin(p.twCommon.sides.CENTER),n.setAbsoluteYOrigin(p.twCommon.sides.BOTTOM);const s=c.bubbleDialogService.createByType(this.getChartSettings().getBubbleId(),$(i),this.getChartSettings().getBubbleType(),t.getPopoverData().build(),n),o=this;s.onMouseEnter.subscribeOnce(function(){o._setHoverBubble(s)}),s.onMouseLeave.subscribeOnce(function(){o.fetchEntry=!0,o._removeHoverBubble()})}_closeDialogs(e){if(e=e||500,clearTimeout(this.contextMenuTimeout),this.contextMenuTimeout=void 0,this.hasBubbles){const t=this.getChartSettings().getMenuId(),i=this.getChartSettings().getBubbleId(),n=!_.isUndefined(this.hoverBubble);n&&this.hoverBubble.getId()===t||c.bubbleDialogService.scheduleDestructionById(t,e),n&&this.hoverBubble.getId()===i||c.bubbleDialogService.scheduleDestructionById(i,e),this.hasBubbles=!1}}_clearEvents(){this.onOverlayStateChange.cancelAll(),this.onOrderedZoom.cancelAll(),this.onReady.cancelAll()}dispose(){this._closeDialogs(),this._clearEvents(),this.animationComponent.dispose(),this.fadingAnimationComponent.dispose(),super.dispose()}}}]}),define("classes/canvas_engine/core/entities/charts/line_chart/line_chart_plot",["require","exports","canvas_engine"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TwLineChartPlot=class extends i.Entity{constructor(e,t,n,s){super(i.Presence.zeroTopLeft()),this._abscissaValue=e,this._ordinateValue=t,this._color=n,this._predicted=s||!1}getAbscissaValue(){return this._abscissaValue}getOrdinateValue(){return this._ordinateValue}isPredicted(){return this._predicted}getColor(){return this._color}}}),define("classes/canvas_engine/core/entities/charts/line_chart/line_chart",["require","exports","canvas_engine","underscore","classes/canvas_engine/core/entities/charts/line_chart/line_chart_plot"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=20;t.LineChart=class extends i.Entity{constructor(e,t,i,n){super(e),this.plots=[],this._initialize(t,i,n)}_initialize(e,t,i){this._initializeCartesianPlane(e,t,i),this._initializePlots(e),this.cartesianPlane.refresh(),this._createPolygons(t,i),this._createLegend(e,t,i)}_createLegend(e,t,n){const s=new i.Presence(t/2,n-o+4),r=new i.LabelSettings;r.setOrigin(i.Constants.Origin.CENTER_TOP);const a=new i.Font;a.setFamily(i.Constants.Font.Family.Content).setSize(12),r.setFont(a);const c=new i.LabelComponent(s,e.getSubLabel(),r);this.addComponent(c)}_initializeCartesianPlane(e,t,n){this.cartesianPlane=new i.CartesianPlane(i.Presence.zero(this.getPresence()),t,n-o,0,0),this.cartesianPlane.setAbscissaGetter(function(e){return e.getAbscissaValue()}),this.cartesianPlane.setOrdinateGetter(function(e){return e.getOrdinateValue()}),this.cartesianPlane.addAbscissaBounds(e.getStartTimestamp(),e.getEndTimestamp(),t,0);const s=e.getRows()[0].getValueBounds();this.cartesianPlane.addOrdinateBounds(s.min,1.1*s.max,n-o,0),this.addChild(this.cartesianPlane)}_initializePlots(e){n.each(e.getRows()[0].getCells(),function(e){if(e.hasValue()){const t=e.isPredicted()?e.getPredictedTwColor():e.getTwColor();this.addPlot(e.getTimestamp(),e.getValue(),t,e.isPredicted())}},this)}addPlot(e,t,i,n){const o=new s.TwLineChartPlot(e,t,i,n);return this.cartesianPlane.addChild(o),this.plots.push(o),o}_createPolygons(e,t){if(this.cartesianPlane.hasChildren()){let e,t,s,o,r,a,c=i.Polygon.zero(),l=i.Polygon.zero(),d=i.Polygon.zero(),g=0,u=i.Polygon.zero(),p=0;this.plots.forEach(h=>{const m=h.getPresence().toPoint();if(h.isPredicted()){if(n.isUndefined(a)&&(a=m),n.isUndefined(s)){const e=n.last(c.getPoints());l=new i.Polygon(e.getX(),e.getY()),u=new i.Polygon(m.getX(),m.getY()),s=h.getColor().clone().setAlpha(.1,!0),o=h.getColor()}l.addPoint(m),u.addPoint(m),p++}else n.isUndefined(r)&&(r=m),n.isUndefined(e)&&(c=new i.Polygon(m.getX(),m.getY()),d=new i.Polygon(m.getX(),m.getY()),e=h.getColor().clone().setAlpha(.1,!0),t=h.getColor()),c.addPoint(m),d.addPoint(m),g++});const h=d.getPoints()[g-1].clone(),m=h.clone();if(m.setY(r.getY()),d.addPoint(m),d=new i.PolygonComponent(d),c=new i.PolygonComponent(c),d.setStyle(i.Style.Color,e),c.setStyle(i.Style.BorderColor,t),c.setStyle(i.Style.BorderThickness,1),this.addComponent(d),this.addComponent(c),!n.isUndefined(s)){const e=u.getPoints()[p-1].clone();e.setY(r.getY()),u.addPoint(e),u.addPoint(m.clone()),u.addPoint(h),(u=new i.PolygonComponent(u)).setStyle(i.Style.Color,s),this.addComponent(u),(l=new i.PolygonComponent(l)).setStyle(i.Style.BorderColor,o),l.setStyle(i.Style.BorderThickness,1.5),l.setStyle(i.Style.LineDash,[3]),this.addComponent(l)}}}}}),define("services/widgets/widget_communication",["require","exports","widget_base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.mediator=new i.WidgetMediator,this.widgets=[]}dispatchToWidget(e,t,i){this.mediator.dispatch(t,i,e)}registerWidget(e,t){this.widgets.push(e),this.mediator.pipe(e.getId(),t,"page"),t.cancellationToken.registerCleanupFunction(()=>{const t=this.widgets.indexOf(e);t>-1&&this.widgets.splice(t,1)})}broadcastByWidgetType(e,t,i){this.widgets.forEach(n=>{n.getType()===e&&this.dispatchToWidget(n.getId(),t,i)})}broadcastToAllWidgets(e,t){this.mediator.broadcast(e,t)}}t.WidgetCommunicationService=n,t.widgetCommunicationService=new n}),define("classes/widget/interfaces/load_urls_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("services/message_diffusion_service",["require","exports","classes/navigation/nav_params","services/navigation","services/widgets/widget_communication"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{clickAction(e,t,i){t.hasEventProducerType()&&this.processProducerEvent(e,t,i)}processProducerEvent(e,t,i){switch(t.getEventProducerStrategyType()){case constants.widget_linking_system.producer_strategy.message_diffusion_entry_urls:this.diffusionUrlClick(e,t);break;case constants.widget_linking_system.producer_strategy.message_diffusion_new_bubble:this.openMessageDiffusion(i);break;default:_.noop()}}openMessageDiffusion(e){const t=new i.NavigationParams;t.setWidget(this),t.setWidgetToSend(this),t.setFilters([]),t.setClickTarget(e),n.navigationService.clickHandler(t,e[0],constants.page_type.context_menu_diffusion_and_velocity)}diffusionUrlClick(e,t){const i={fullIndex:e.isFromFullIndex(),urls:e.getUrls(),id:t.getId()};s.widgetCommunicationService.broadcastToAllWidgets(t.getEventProducerType(),i)}}t.MessageDiffusionService=o,t.messageDiffusionService=new o}),define("classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion_node",["require","exports","canvas_engine","data_structures","reusable_utilities","services/bubble_dialog","services/configuration","services/message_diffusion_service","wrappers/widget/widget_wrapper"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});let l=class extends i.Entity{constructor(e,t,n,s,o){super(e),this.animationConfiguration=o,this._initializeStyle(t),this.addComponents(this._createComponents(t)),this.nodeModel=t,this.widget=n,this.getPresence().setStyle(i.Style.Layer,1),this._addEvents(),this.links=[],this.incomingLinks=[],this.title=s,this.selectCircle=void 0,this.fadedOut=!0,this.replayGlow=this._highlight(20,500,!0),this.setInteractiveState(!0)}_initializeStyle(e){this.alpha=e.isOrigin()?1:.5,this.color=e.isOrigin()?s.Color.BLACK():new s.Color(e.getColor()).setAlpha(this.alpha),this.radius=6+9*Math.min(1,(e.getClusterSize()-1)/15)}getTimestamp(){return this.nodeModel.getTimestamp()}getModel(){return this.nodeModel}getReplayGlow(){return this.replayGlow}_addEvents(){const e=this.getFirstComponentOf(i.Constants.ComponentClasses.Animation).accessSequenceFor("inflate"),t=this.getFirstComponentOf(i.Constants.ComponentClasses.Circle);t.setInteractiveState(!0),t.onMouseClick.subscribe(()=>{a.messageDiffusionService.clickAction(this.nodeModel,this.widget,$(this.getStageFacade().getCanvas()))}),t.onMouseEnter.subscribe(()=>{this._openPopover(),e.setReverseState(!1),e.resume(),this.links.concat(this.incomingLinks).forEach(e=>{e.line.setReverseState(!1),e.line.resume()})}),t.onMouseLeave.subscribe(()=>{this._closePopover(),e.setReverseState(!0),e.resume(),_.each(this.links.concat(this.incomingLinks),e=>{e.line.setReverseState(!0),e.line.resume()})})}_openPopover(){this._closePopover();const e=this.getStageFacade().getActiveCamera().cameraToWindowCoordinates(this.getPresence().getAbsoluteX()-2,this.getPresence().getAbsoluteY()-this.radius-6),t=r.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.message_diffusion);t.setAbsoluteX(e.getX()),t.setAbsoluteY(e.getY()),i.ObjectCache.recycleObject(e),o.bubbleDialogService.createByType(constants.bubble_dialog.id.message_diffusion,$(this.getStageFacade().getCanvas()),"message-diffusion",{results:this.nodeModel.getClusterSize(),label:this.title},t)}getLinks(){return this.links}getRadius(){return this.radius}getIncomingLinks(){return this.incomingLinks}_closePopover(){o.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.message_diffusion,300)}_createComponents(e){const t=new i.CircleComponent(new i.Circle(0,0,this.radius));t.getPresence().setOrigin(i.Constants.Origin.CENTER),t.setStyle(i.Style.BorderColor,new s.Color(e.getColor()).setAlpha(.2)),t.setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Outside),t.setStyle(i.Style.Color,this.color);const n=new i.AnimationComponent;return n.tween(t,[{key:i.Style.BorderThickness,value:8,duration:200}],"inflate"),n.tween(t,[{key:i.Style.Opacity,value:1,duration:500}],"fadeIn"),[t,n]}select(){if(void 0!==this.selectCircle)return;this.selectCircle=new i.CircleComponent(new i.Circle(0,0,this.radius)),this.selectCircle.setStyle(i.Style.BorderColor,s.Color.getCustomColor("BRANDING_COLOR")),this.selectCircle.setStyle(i.Style.Opacity,1),this.selectCircle.setStyle(i.Style.Layer,0),this.selectCircle.setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Outside);const e=this.getFirstComponentOf(i.Constants.ComponentClasses.Animation).tween(this.selectCircle,[{key:i.Style.BorderThickness,value:3,duration:500}]);this.addComponent(this.selectCircle),e.resume()}unselect(){const e=this,t=this.getFirstComponentOf(i.Constants.ComponentClasses.Animation).tween(this.selectCircle,[{key:i.Style.BorderThickness,value:0,duration:500}]);t.onDone.subscribeOnce(()=>{this.removeComponent(e.selectCircle),this.selectCircle=void 0}),t.resume()}highlight(){this._highlight(40,1e3).resume()}getSmallHighlight(){return this._highlight(20,500)}_highlight(e,t,n=!1){const s=new i.CircleComponent(new i.Circle(0,0,this.radius));s.setStyle(i.Style.Radius,0).setStyle(i.Style.Color,this.color).setStyle(i.Style.Opacity,1).setStyle(i.Style.Layer,1);const o=this.getFirstComponentOf(i.Constants.ComponentClasses.Animation).tween(s,[{key:i.Style.Radius,value:e,duration:t},{key:i.Style.Opacity,value:0,duration:t}]);return n||o.onDone.subscribeOnce(()=>{this.removeComponent(s)}),this.addComponent(s),o}isFadedOut(){return this.fadedOut}getFadeIn(){return this.fadedOut=!1,this.getFirstComponentOf(i.Constants.ComponentClasses.Animation).accessSequenceFor("fadeIn")}_getDistance(e,t,i,n){return Math.sqrt((e-i)*(e-i)+(t-n)*(t-n))}_calculateCurvaturePoint(e,t,n,s){const o=this._getDistance(e,t,n,s),r=new i.Point((e+n)/2,(t+s)/2),a=Math.abs(e-n);let c="HORIZONTAL";Math.abs(t-s)<a&&(c="VERTICAL");let l=o/1380*(.7-.05)+.05;return o>60&&("VERTICAL"===c?(s>t&&(l*=-1),r.y*=1-l):(n>e&&(l*=-1),r.x*=1-l)),r}linkTo(e,t){const n=this.getPresence().getPositionRelativeTo(this.getParent().getParent().getPresence()),o=e.getPresence().getPositionRelativeTo(this.getParent().getParent().getPresence()),r=this._getDistance(n.getX(),n.getY(),o.getX(),o.getY()),a=this._calculateCurvaturePoint(n.getX(),n.getY(),o.getX(),o.getY()),c=i.Presence.zero(this.getPresence()),l=i.Presence.zero(e.getPresence()),d=Math.atan2(a.getX()-e.getPresence().getAbsoluteX(),a.getY()-e.getPresence().getAbsoluteY())+Math.PI;let g;l.setX(-Math.sin(d)*e.getRadius()),l.setY(-Math.cos(d)*e.getRadius()),g=r>60?i.LineComponent.fromAbsolutePoints(c,[a,l.toPoint()]):i.LineComponent.fromPresences(c,l),c.setStyle(i.Style.Layer,0);const u=this.getFirstComponentOf(i.Constants.ComponentClasses.Animation),p=u.tween(g,[{key:i.Style.BorderThickness,value:2,duration:200},{key:i.Style.Opacity,value:.7,duration:200}]);let h={line:p,target:e,fadeIn:(t,n)=>u.tween(g,[{key:i.Style.FillRatio,value:1,duration:Math.max(150,Math.abs(n*(e.getTimestamp()-t)))}])};this.links.push(h),h={line:p,target:this,fadeIn(){}},e.incomingLinks.push(h),r>60&&g.addArrowHead(10,Math.PI/6),g.setStyle(i.Style.BorderColor,new s.Color(t).setAlpha(.5)),g.setStyle(i.Style.BorderThickness,1),g.setStyle(i.Style.Opacity,.3),g.setStyle(i.Style.FillRatio,0),this.addComponent(g)}};l=__decorate([s.meta({name:"MessageDiffusionNode"}),__metadata("design:paramtypes",[i.Presence,n.NetworkNodeModel,c.WidgetWrapper,String,Object])],l),t.MessageDiffusionNode=l}),define("classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion_plot",["require","exports","canvas_engine","classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion_node"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.MessageDiffusionPlot=class extends i.Entity{constructor(e,t,s,o,r,a){super(i.Presence.zeroTopLeft()),this._abscissaValue=e,this._ordinateValue=t,this._id=s.getClusterId(),this._node=new n.MessageDiffusionNode(i.Presence.zero(this.getPresence()),s,o,r,a),this.addChild(this._node),this.setInteractiveState(!0)}getAbscissaValue(){return this._abscissaValue}getOrdinateValue(){return this._ordinateValue}getNode(){return this._node}linkTo(e,t){this.getNode().linkTo(e.getNode(),t)}getId(){return this._id}getNodeModel(){return this._node.getModel()}}}),define("classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion",["require","exports","reusable_utilities","widget_base","canvas_engine","classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion_plot","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=20,c="#E0E0E0",l="#777",d=[6,6],g=1,u=10,p=16,h=12,m=80,f=120,y=280;class v extends s.Entity{constructor(e,t,i,n,o,r,a){super(e,v._initializeComponents(e,n,o,a)),this.intPlots=[],this.intIterationMode=r,this.intNetworkModel=t,this.intWidget=i,this.intHighlightedAuthors=[],this.intSelectedNode=void 0,this.drawSettings=a,this.timeline=new s.Timeline,this._initialize(t,i,n,o,a),i.hasReplayManager()?(this.timeline.syncToTimeline(i.getReplayManager().timeline),this.timeline.setProgress(1)):this.timeline.playOverTime(0!==this.drawSettings.animationDuration?this.drawSettings.animationDuration+500:0)}dispose(){this.timeline.dispose()}static getFontScale(e){switch(e.style.fontSize){case n.FontSize.SMALL:return 1;case n.FontSize.MEDIUM:return 1.5;case n.FontSize.LARGE:return 2;default:throw new Error("unknown font size")}}static _initializeComponents(e,t,n,o){const r=[],c=s.Presence.zero(e),l=s.Presence.zero(e);c.setX(0),c.setY(n-a*v.getFontScale(o)-6),l.setX(t),l.setY(n-a*v.getFontScale(o)-6);const d=s.LineComponent.fromPresences(c,l);return d.setStyle(s.Style.BorderColor,i.Color.BLACK()),d.setStyle(s.Style.BorderThickness,g),r.push(d),r}_addAbscissaExtremumLabels(e,t,n,o){const r=s.Presence.zero(this.getPresence()),c=s.Presence.zero(this.getPresence());r.setX(0),r.setY(o-a*v.getFontScale(this.drawSettings)),c.setX(n),c.setY(o-a*v.getFontScale(this.drawSettings));const d=new s.LabelSettings;d.setColor(new i.Color(l)),d.setFontSize(u*v.getFontScale(this.drawSettings));const g=new s.LabelComponent(r,moment(e).format("D MMM"),d),p=new s.LabelComponent(c,moment(t).format("D MMM"),d);this.addComponent(g),this.addComponent(p)}_initialize(e,t,i,n,s){this._initializeCartesianPlane(e,i,n),this._initializePlots(e,t,i,n,s),this.intCartesianPlane.refresh(),this._initializeLinks(e,i,n),this._initializeAnimation(e.getMinimumTimestamp(),1e3/(e.getMaximumTimestamp()-e.getMinimumTimestamp())),this._selectNode(this._getOriginPlot().getNode())}highlightPlotById(e){this.getPlotById(e).getNode().highlight()}highlightPlotsByAuthorId(e){const t=this.intNetworkModel.getNodesByAuthorId(e);_.each(t,e=>{this.highlightPlotById(e.getClusterId())})}_highlightAuthor(e){this.intHighlightedAuthors[e]=!0}_unhighlightAuthor(e){this.intHighlightedAuthors[e]=!1}getHighlightedAuthors(){return this.intHighlightedAuthors}_initializeAnimation(e,t){const i=this._getRoots();_.each(i,i=>{this._lightUpNodeAndLinks(i,e,t)})}_lightUpNodeAndLinks(e,t,i){e.isFadedOut()&&(this.timeline.addSequence(e.getFadeIn(),i*(e.getTimestamp()-t)),this.timeline.addSequence(e.getReplayGlow(),i*(e.getTimestamp()-t)),_.each(e.getLinks(),n=>{this.timeline.addSequence(n.fadeIn(e.getTimestamp(),i),i*(e.getTimestamp()-t)),this._lightUpNodeAndLinks(n.target,t,i)}))}_getRoots(){return this._crawlToRoots(this._getOriginPlot().getNode(),[],[])}_crawlToRoots(e,t,i){return i.push(e),0===e.getIncomingLinks().length?t.push(e):_.each(e.getIncomingLinks(),e=>{_.contains(i,e.target)||this._crawlToRoots(e.target,t,i)}),t}_getOriginPlot(){return _.find(this.intPlots,e=>e.getNodeModel().isOrigin())}_initializeLinks(e,t,i){_.each(e.getEdgeModels(),e=>{const t=this.getPlotById(e.getStartUid()),i=this.getPlotById(e.getEndUid());t.linkTo(i,e.getColor())})}getPlotById(e){return _.find(this.intPlots,t=>t.getId()===e)}_initializeCartesianPlane(e,t,n){this.intCartesianPlane=new s.CartesianPlane(s.Presence.zero(this.getPresence()),t,n,120*v.getFontScale(this.drawSettings),25),this.intCartesianPlane.setAbscissaGetter(e=>e.getAbscissaValue()),this.intCartesianPlane.setOrdinateGetter(e=>e.getOrdinateValue());let o=this.intCartesianPlane.getOrdinateTickSettings();o.setLineColor(new i.Color(c)),o.setLineThickness(g),o.setDashSize(d),o.setShowLine(!0),o.setLabelBold(!0),o.setLabelColor(new i.Color(l)),o.setLabelFontSize(u*v.getFontScale(this.drawSettings)),o.setLabelOffset(new s.Point(0,4)),o.setLabelFunction(t=>{e.getMetaData().getBreakdown();try{return Object.values(e.getMetaData().getBreakdown()).sort((e,t)=>t.order-e.order)[t-1].label.toUpperCase()}catch(e){return""}}),(o=this.intCartesianPlane.getAbscissaTickSettings()).setLineColor(new i.Color(c)),o.setLineThickness(g),o.setDashSize(d),o.setShowLine(!0),o.setLabelColor(new i.Color(l)),o.setLabelCentered(!0),this.intIterationMode?this._configureCartesianPlaneIterationMode(e,t,n):this._configureCartesianPlaneDefaultMode(e,t,n),this.intCartesianPlane.addOrdinateBounds(0,_.keys(e.getMetaData().getBreakdown()).length,n-50,0,1,s.CartesianPlane.SKIP_ITERATOR(1)),this.addChild(this.intCartesianPlane)}_configureCartesianPlaneIterationMode(e,t,i){const n=this.intCartesianPlane.getAbscissaTickSettings();n.setLabelUseEndPoint(!0),n.setLabelOffset(new s.Point(0,6)),this.intCartesianPlane.setAbscissaTickSettingsEnhancer((e,t,i)=>(Math.floor(t)===t?(e.setShowLabel(!0),e.setShowLine(!1)):(e.setShowLabel(!1),e.setShowLine(!0)),e.setLabelFontSize(u*v.getFontScale(this.drawSettings)),e.setLabelOffset(new s.Point(0,8-16*(v.getFontScale(this.drawSettings)-1))),e)),n.setLabelFunction(e=>0===e?r.contextData.getMessage("_497846"):`${r.contextData.getMessage("_497845")} ${e}`);const o=e.getMinimumIteration(),a=e.getMaximumIteration();this.intCartesianPlane.addAbscissaBounds(o,a,t-y,0,.5,s.CartesianPlane.DEFAULT_ITERATOR);const c=(e,t)=>(i,n)=>{!i.isOrigin()&&e.length>1&&i.setIteration(t-.4+n/(e.length-1)*.8)},l=a-.5;for(let t=o+.5;t<=l;t++){const i=e.getNodesByIteration(t);_.each(i,c(i,t))}}_configureCartesianPlaneDefaultMode(e,t,n){const o=this.intCartesianPlane.getAbscissaTickSettings();this.intCartesianPlane.setAbscissaTickSettingsEnhancer((e,t,i)=>{const n=i>=moment.duration(1,"days").asMilliseconds();return e.setShowLine(0===moment(t).hours()||n),e.setLabelUseEndPoint(0!==moment(t).hours()||n),0!==moment(t).hours()||n?(e.setLabelFontSize(u*v.getFontScale(this.drawSettings)),e.setLabelAngle(0),e.setLabelOffset(new s.Point(0,8-16*(v.getFontScale(this.drawSettings)-1)))):(e.setLabelFontSize(p*v.getFontScale(this.drawSettings)),e.setLabelAngle(90),e.setLabelOffset(new s.Point(-14,76+60*(v.getFontScale(this.drawSettings)-1)))),e}),o.setLabelFunction((e,t)=>0===moment(e).hours()||t>=moment.duration(1,"days").asMilliseconds()?moment(e).format("D MMM"):moment(e).format("HH:mm")),_.each(this._partitionSpace(e.getTimeAxes(),e,t),(t,n)=>{if(this.intCartesianPlane.addAbscissaBounds(t.start,t.end,t.width,0,this._calculateStep(t.start,t.end,t.ticks),this._dateIterator(0)),n<e.getTimeAxes().length-1){const s=Math.floor((e.getTimeAxes()[n+1].start-t.end)/36e5);let o="";o=s>72?r.contextData.getMessage("_442171")[0].toUpperCase()+"+"+Math.floor(s/24):r.contextData.getMessage("_699539")[0].toUpperCase()+"+"+s,this.intCartesianPlane.addAbscissaSeparator(f,new i.Color(c),new i.Color(l),o,moment(e.getTimeAxes()[n+1].start).format("D MMM"))}}),this._addAbscissaExtremumLabels(e.getMinimumTimestamp(),e.getMaximumTimestamp(),t,n)}_partitionSpace(e,t,i){let n=i-y-(e.length-1)*f;const s=t.getNodeModels().length;if((n-=m*e.length)<0)throw new Error("Too many time axes to fit into this chart");return _.each(e,e=>{e.width=m+n*e.number_of_clusters/s,e.ticks=Math.ceil(h*e.number_of_clusters/s)}),e}_dateIterator(e){return(t,i,n)=>{const s=n>=moment.duration(1,"days").asMilliseconds();let o,r=t+e;const a={current:void 0,next:()=>{a.current=r>i?void 0:o||r;let e=!1;return o&&(o=void 0,e=!0),!s&&moment(r).hours()>moment(r+n).hours()&&(o=r+moment.duration(24-moment(r).hours(),"hours").asMilliseconds()),e||(r+=n),a.current}};return a}}_calculateStep(e,t,i){const n=t-e;return n/moment.duration(1,"minute").asMilliseconds()<i?moment.duration(1,"minute").asMilliseconds():n/moment.duration(5,"minute").asMilliseconds()<i?moment.duration(5,"minute").asMilliseconds():n/moment.duration(15,"minute").asMilliseconds()<i?moment.duration(15,"minute").asMilliseconds():n/moment.duration(1,"hour").asMilliseconds()<i?moment.duration(1,"hour").asMilliseconds():n/moment.duration(3,"hour").asMilliseconds()<i?moment.duration(3,"hour").asMilliseconds():n/moment.duration(6,"hour").asMilliseconds()<i?moment.duration(6,"hour").asMilliseconds():n/moment.duration(12,"hour").asMilliseconds()<i?moment.duration(12,"hour").asMilliseconds():n/moment.duration(1,"day").asMilliseconds()<i?moment.duration(1,"day").asMilliseconds():n/moment.duration(7,"day").asMilliseconds()<i?moment.duration(7,"day").asMilliseconds():n/moment.duration(15,"day").asMilliseconds()<i?moment.duration(15,"day").asMilliseconds():n/moment.duration(30,"day").asMilliseconds()<i?moment.duration(30,"day").asMilliseconds():n/moment.duration(45,"day").asMilliseconds()<i?moment.duration(45,"day").asMilliseconds():n/moment.duration(90,"day").asMilliseconds()<i?moment.duration(90,"day").asMilliseconds():n/moment.duration(180,"day").asMilliseconds()<i?moment.duration(180,"day").asMilliseconds():moment.duration(365,"day").asMilliseconds()}_calculateIterateOffset(){return 0}_initializePlots(e,t,i,n,s){_.each(e.getNodeModels(),i=>{let n;n=i.isOrigin()?.5:i.getPosition();const o=e.getMetaData().getBreakdown()[i.getBreakdownCode()];let r;r=this.intIterationMode?i.getIteration():i.getTimestamp(),this.addPlot(s,r,_.keys(e.getMetaData().getBreakdown()).length-o.order-n,i,t,o.label)})}_selectNode(e){this.intSelectedNode!==e&&(void 0!==this.intSelectedNode&&this.intSelectedNode.unselect(),e.select(),this.intSelectedNode=e)}addPlot(e,t,i,n,r,a){const c=new o.MessageDiffusionPlot(t,i,n,r,a,e);return c.getNode().onMouseEnter.subscribe(()=>{const e=n.getAuthorIds();_.each(e,e=>{this._highlightAuthor(e)})}),c.getNode().onMouseLeave.subscribe(()=>{const e=n.getAuthorIds();_.each(e,e=>{this._unhighlightAuthor(e)})}),c.getNode().onMouseClick.subscribe(()=>{this._selectNode(c.getNode())}),c.getNode().setStyle(s.Style.Opacity,0),this.intCartesianPlane.addChild(c),this.intPlots.push(c),c}}t.MessageDiffusion=v}),define("classes/canvas_engine/core/models/pack_chart_model",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e,t,n,s){this.payload=e,this.dataRoot=e.tree.root,this.emergingThemes=[],this.decreasingThemes=[],this.newThemes=[],this.emergingListElement=t,this.decreasingListElement=n,this.newListElement=s;const o=this;i.each(e.emerging_themes.rows,function(e){o.emergingThemes.push(e.code)}),i.each(e.decreasing_themes.rows,function(e){o.decreasingThemes.push(e.code)}),i.each(e.new_themes.rows,function(e){o.newThemes.push(e.code)})}return e.prototype={getDataRoot:function(){return this.dataRoot},getBlockedThemesLink:function(){return this.payload.delete_link},getEmergingThemes:function(){return this.emergingThemes},getDecreasingThemes:function(){return this.decreasingThemes},getNewThemes:function(){return this.newThemes},getEmergingListElement:function(){return this.emergingListElement},getDecreasingListElement:function(){return this.decreasingListElement},getNewListElement:function(){return this.newListElement}},e}}),define("classes/canvas_engine/core/models/slider_model",["require","exports","underscore","map"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=String.fromCharCode(61524),t=e+String.fromCharCode(61524),s=t+String.fromCharCode(61524);function o(i){this.replay=i,this.speedLabels=new n.Map,this.speedLabels.set(this.getReplayManager().SPEEDS.SLOWER,e+" "+window.messages.get("_153344")),this.speedLabels.set(this.getReplayManager().SPEEDS.NORMAL,t+" "+window.messages.get("_494471")),this.speedLabels.set(this.getReplayManager().SPEEDS.FASTER,s+" "+window.messages.get("_273426"))}return o.prototype={getReplayManager:function(){return this.replay},getNumberOfSteps:function(){return this.replay.numberOfSteps},setNumberOfSteps:function(e){this.replay.numberOfSteps=e},getSpeed:function(){return this.replay.speed},getIcon:function(){return this.speedLabels.get(this.replay.speed)},setSpeed:function(e){this.replay.speed=e},getAllSpeeds:function(){if(!this.sortedSpeeds){const e=this;this.sortedSpeeds=i.sortBy(i.map(this.getReplayManager().SPEEDS,function(t,i){return{label:e.speedLabels.get(t),multiplier:t}}),function(e){return e})}return this.sortedSpeeds},getStepAnimationDuration:function(){return this.replay.stepAnimationDuration},getTotalAnimationDuration:function(){return this.replay.duration},getTimeline:function(){return this.replay.timeline}},o}}),define("classes/canvas_engine/core/models/worldmap_model",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e,t){this.data=e,this.widget=t}return e.prototype={getData:function(){return this.data},getWidget:function(){return this.widget}},e}}),define("classes/canvas_engine/settings/axis_settings",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["TwVelocityChartSettings",function(e){function t(t,i){t instanceof e?e.call(this,t.getModel()):e.call(this,t),this.type=i}return t.prototype=Object.create(e.prototype),t.prototype=$.extend(t.prototype,{getType:function(){return this.type}}),t}]}),define("classes/canvas_engine/settings/charts/data_gauge_settings",["require","exports","canvas_chart_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return class extends i.PopoverChartSettings{constructor(e,t,i,n){super(e,t,i),this.colorTweenEnabled=!0,this.positionTweenEnabled=!0,this.heightTweenEnabled=!0,this.widthTweenEnabled=!0,this.clickable=void 0===n||n}enableColorTween(e,t){return this.colorTweenEnabled=e,t&&(this.enablePositionTween(!e),this.enableHeightTween(!e),this.enableWidthTween(!e)),this}enablePositionTween(e,t){return this.positionTweenEnabled=e,t&&(this.enableColorTween(!e),this.enableHeightTween(!e),this.enableWidthTween(!e)),this}enableHeightTween(e,t){return this.heightTweenEnabled=e,t&&(this.enablePositionTween(!e),this.enableColorTween(!e),this.enableWidthTween(!e)),this}enableWidthTween(e,t){return this.widthTweenEnabled=e,t&&(this.enablePositionTween(!e),this.enableHeightTween(!e),this.enableColorTween(!e)),this}isColorTweenEnabled(){return this.colorTweenEnabled}isPositionTweenEnabled(){return this.positionTweenEnabled}isHeightTweenEnabled(){return this.heightTweenEnabled}isWidthTweenEnabled(){return this.widthTweenEnabled}isClickable(){return this.clickable}}}]}),define("classes/canvas_engine/settings/charts/slider_settings",["require","exports","canvas_chart_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TwSliderSettings=class extends i.DefaultChartSettings{constructor(e,t){super(e),this.cursorDragEnabled=!0,this.widget=t,this.lineClickEnabled=!0,this.autoReplayEnabled=!0,this.blockedIntervals=[]}enableLineClick(e){return this.lineClickEnabled=e,this}isLineClickEnabled(){return this.lineClickEnabled}blockIntervals(e){e.forEach(function(e){this.blockedIntervals.indexOf(e)<0&&this.blockedIntervals.push(e)},this)}unblockIntervals(e){e.forEach(function(e){this.blockedIntervals.splice(this.blockedIntervals.indexOf(e),1)},this)}getBlockedIntervals(){return this.blockedIntervals}enableCursorDrag(e){return this.cursorDragEnabled=e,this}getWidget(){return this.widget}getAnimationAxis(){return void 0!==this.getWidget()&&this.getWidget().getAnimationAxis()}isCursorDragEnabled(){return this.cursorDragEnabled}enableAutoReplay(e){return this.getModel().getReplayManager().enableAutoReplay(e),this}isAutoReplayEnabled(){return this.getModel().getReplayManager().isAutoReplayEnabled()}}}),define("classes/canvas_engine/settings/charts/velocity_chart_settings",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["TwChartSettings",function(e){function t(t){e.call(this,t),this.adaptiveLegend=t.metaData.attributes[constants.data_graph.meta_data.attrs.adaptive_legend],this.timeInterval=t.metaData.attributes[constants.data_graph.meta_data.attrs.time_interval],this.inPercent=t.metaData.attributes[constants.data_graph.meta_data.attrs.resulting_values_in_percentage],this.stackingMode=t.metaData.attributes[constants.data_graph.meta_data.attrs.stacking_mode]}return t.prototype=Object.create(e.prototype),t.prototype=$.extend(t.prototype,{getInterval:function(){return this.timeInterval},getStackingMode:function(){return this.stackingMode},hasAdaptiveLegend:function(){return this.adaptiveLegend},isInPercent:function(){return this.inPercent}}),t}]}),define("classes/color_palette_builder/cloud_color_palette_builder",["require","exports","reusable_utilities","cloud"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.CloudColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){switch(this.themeId){case 2:return{themeType:n.CloudThemeType.DARK};case 3:return{themeType:n.CloudThemeType.NAVY};default:return{themeType:n.CloudThemeType.LIGHT}}}}}),define("classes/color_palette_builder/globe_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.GlobeColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){switch(this.themeId){case 2:return this.buildDarkColorPalette();case 3:return this.buildNavyColorPalette();default:return this.buildLightColorPalette()}}buildLightColorPalette(){return{land:{fill:new i.Color("#aab1ba")},oceans:{fill:new i.Color("#d7dade")},borders:{stroke:new i.Color("#aab1ba").darken(7.5)},pings:{fill:new i.Color("#061b2e").fadeOut(60)},places:{circles:{fill:i.Color.fromARGB(0,0,0,.3),stroke:i.Color.TRANSPARENT_COLOR()},text:{fill:i.Color.fromRGBA(10,10,10,.66),stroke:i.Color.fromRGBA(255,255,255,.33),font:"14px RobotoR"}}}}buildDarkColorPalette(){return{land:{fill:new i.Color("#424344")},oceans:{fill:new i.Color("#222222")},borders:{stroke:new i.Color("#353637")},pings:{fill:new i.Color("#d6ff00").fadeOut(60)},places:{circles:{fill:i.Color.fromRGBA(20,20,20,.15),stroke:i.Color.TRANSPARENT_COLOR()},text:{fill:i.Color.fromRGBA(255,255,255,.55),stroke:i.Color.fromRGBA(0,0,0,.33),font:"14px RobotoR"}}}}buildNavyColorPalette(){return{land:{fill:i.Color.fromRGBA(33,53,68,1)},oceans:{fill:new i.Color("#0b1923")},borders:{stroke:new i.Color("#1a1d29")},pings:{fill:new i.Color("#d6ff00").fadeOut(60)},places:{circles:{fill:i.Color.fromRGBA(20,20,20,.15),stroke:i.Color.TRANSPARENT_COLOR()},text:{fill:i.Color.fromRGBA(255,255,255,.55),stroke:i.Color.fromRGBA(0,0,0,.33),font:"14px RobotoR"}}}}}}),define("classes/color_palette_builder/pack_chart_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PackChartColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){return 2===this.themeId?this.buildDarkColorPalette():this.buildLightColorPalette()}buildLightColorPalette(){return{themeHighlightColor:i.Color.getCustomColor("BRANDING_COLOR")(.4).desaturate(40,!0)}}buildDarkColorPalette(){return{themeHighlightColor:new i.Color("#2f2f2f").setAlpha(.4)}}}}),define("classes/context_data/containers/keyboard_shortcuts",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.KeyboardShortcuts=class{constructor(e){this.shortcuts=e}getSelectAll(){return this.shortcuts.select_all}getSetPositive(){return this.shortcuts.set_positive}getSetPositiveComments(){return this.shortcuts.set_positive_comments}getSetNeutral(){return this.shortcuts.set_neutral}getSetNeutralComments(){return this.shortcuts.set_neutral_comments}getSetNegative(){return this.shortcuts.set_negative}getSetNegativeComments(){return this.shortcuts.set_negative_comments}getShowAuthorPanel(){return this.shortcuts.show_author_panel}getShowSourcePanel(){return this.shortcuts.show_source_panel}getToggleChecked(){return this.shortcuts.toggle_checked}getToggleCheckedComments(){return this.shortcuts.toggle_checked_comments}getToggleImportant(){return this.shortcuts.toggle_important}getToggleImportantComments(){return this.shortcuts.toggle_important_comments}getToggleRead(){return this.shortcuts.toggle_read}getToggleReadComments(){return this.shortcuts.toggle_read_comments}}}),define("classes/dashboard_actions/dashboard_action_restrictions",["require","exports","services/application_mode","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.DashboardActionRestrictions=class{static canEditDashboard(e){return this.isEditable(e)}static canShowUserAccess(){return n.contextData.rules.isDashboardUsersEnabled()&&!i.applicationMode.isMobile()}static canCopyDashboard(e){return!e.isEditMode()&&this.isEditable(e)}static canShowReportActions(e){return!e.isEditMode()&&(this.canCreateNewReport()||this.canAddToExistingReport())}static canCreateNewReport(){return n.contextData.accesses.hasAccess(constants.user_access.entity_type.reports,constants.user_access.access_action.create_new_entity)}static canAddToExistingReport(){return n.contextData.accesses.hasAccess(constants.user_access.entity_type.reports,constants.user_access.access_action.add_to_existing_entity)}static canCreateAlert(e){return!e.isEditMode()&&this.canCreateNewReport()}static canShareDashboard(e){return!e.isEditMode()&&this.isEditable(e)}static canOverrideFilters(e){const t=e.getUserFilterSettings();return t.isAnyFilterActive()||t.getTopicMenuByPredicate(e=>"TOPIC_PM_COMPOSED"===e.getType()&&e.getRootEntry().containsSelection(!0)).length>0}static isEditable(e){return e.getAllowedPages().isCustomPageEditable()&&!i.applicationMode.isMobile()}}}),define("react_components/menu/topic_menu_select_component_strategies/grid_dashboard_page_menu_strategy",["require","exports","log","classes/report_actions/report_actions","classes/dashboard_actions/dashboard_actions","services/custom_pages"],function(e,t,i,n,s,o){var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LEGACY_REVERT="legacy_revert",e.EDIT_TOGGLE="edit_toggle",e.USER_ACCESS="user_accesss",e.CLONE="clone",e.ADD_TO_NEW_REPORT="add_to_new_report",e.ADD_TO_EXISTING_REPORT="add_to_existing_report",e.ALERT_CREATION="alert_creation",e.SHARE="share",e.OVERRIDE_FILTERS="override_filters"}(r=t.GridDashboardPageOption||(t.GridDashboardPageOption={}));t.GridDashboardPageMenuStrategy=class{constructor(e,t){this.menuWrapper=e,this.pageState=t}onSelect(e,t,a){return new Promise((e,a)=>{switch(t.mapped_id){case r.ADD_TO_NEW_REPORT:o.customPagesService.showMultipageModalForNewReport(this.pageState);break;case r.ADD_TO_EXISTING_REPORT:o.customPagesService.showModalToAddWidgetsToReport(this.pageState);break;case r.ALERT_CREATION:n.ReportActions.createAlertReport();break;case r.CLONE:s.DashboardActions.copyDashboard(t);break;case r.EDIT_TOGGLE:s.DashboardActions.toggleEditMode(this.pageState);break;case r.LEGACY_REVERT:s.DashboardActions.revertToLegacyDashboard(this.pageState);break;case r.OVERRIDE_FILTERS:s.DashboardActions.overrideDashboard(this.pageState);break;case r.SHARE:s.DashboardActions.shareDashboard(t);break;case r.USER_ACCESS:s.DashboardActions.showDashboardUsers(t.mapped_id);break;default:i.logService.error("ReportWidgetAdditionsType does not exist or is not implemented")}a()})}onMouseEnter(e){return new Promise((t,i)=>{t({openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0})})}isActionsDisabled(){return!1}}}),define("classes/dashboard_actions/grid_dashboard_page_options_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/dashboard_actions/dashboard_page_options_menu_factory",["require","exports","reusable_utilities","react_components/menu/topic_menu_select_component_strategies/grid_dashboard_page_menu_strategy","wrappers/topic_menu/topic_menu_wrapper","classes/context_data/context_data","classes/dashboard_actions/dashboard_action_restrictions"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.DashboardPageOptionsMenuFactory=class{static buildDashboardPageOptionsMenuProps(e){const t=this.buildGridDashboardPageOptionsMenu(e);return{gridDashboardPageOptionsMenu:t,gridDashboardPageOptionsStyleModel:i.TopicMenuSelectStyleUtils.buildButtonStyleModel("fa fa-rotate-90 icon-tw-ellipsis"),gridDashboardPageOptionsStrategy:new n.GridDashboardPageMenuStrategy(t,e)}}static buildGridDashboardPageOptionsMenu(e){const t=[];return this.buildLegacyRevertEntry(t),this.buildEditToggleEntry(e,t),this.buildUserAccessEntry(t),this.buildOverrideFiltersEntry(e,t),this.buildCloneEntry(e,t),this.buildAddToReportEntry(e,t),this.buildAlertCreationEntry(e,t),this.buildShareEntry(e,t),new s.TopicMenuWrapper({root_entry:{selection_type:"SINGLE",children:t}})}static buildLegacyRevertEntry(e){const t={name:o.contextData.getMessage("_1321942"),mapped_id:n.GridDashboardPageOption.LEGACY_REVERT};e.push(t)}static buildEditToggleEntry(e,t){const i={get name(){return e.isEditMode()?o.contextData.getMessage("_904523"):o.contextData.getMessage("_687848")},mapped_id:n.GridDashboardPageOption.EDIT_TOGGLE,get visibility(){return r.DashboardActionRestrictions.canEditDashboard(e)?"VISIBLE":"NOT_VISIBLE"}};t.push(i)}static buildUserAccessEntry(e){const t={name:o.contextData.getMessage("_887435"),mapped_id:n.GridDashboardPageOption.USER_ACCESS,get visibility(){return r.DashboardActionRestrictions.canShowUserAccess()?"VISIBLE":"NOT_VISIBLE"}};e.push(t)}static buildOverrideFiltersEntry(e,t){const i={name:o.contextData.getMessage("_115464"),mapped_id:n.GridDashboardPageOption.OVERRIDE_FILTERS,get visibility(){return r.DashboardActionRestrictions.canOverrideFilters(e)?"VISIBLE":"NOT_VISIBLE"}};t.push(i)}static buildCloneEntry(e,t){const i={name:o.contextData.getMessage("_687416"),mapped_id:n.GridDashboardPageOption.CLONE,get visibility(){return r.DashboardActionRestrictions.canCopyDashboard(e)?"VISIBLE":"NOT_VISIBLE"}};t.push(i)}static buildAddToReportEntry(e,t){const i={name:o.contextData.getMessage("_589171"),mapped_id:n.GridDashboardPageOption.ADD_TO_NEW_REPORT,get visibility(){return r.DashboardActionRestrictions.canShowReportActions(e)?"VISIBLE":"NOT_VISIBLE"},children:this.buildAddToReportEntryChildren()};t.push(i)}static buildAddToReportEntryChildren(){const e=[];return r.DashboardActionRestrictions.canCreateNewReport()&&e.push({name:o.contextData.getMessage("_589171"),mapped_id:n.GridDashboardPageOption.ADD_TO_NEW_REPORT}),r.DashboardActionRestrictions.canAddToExistingReport()&&e.push({name:o.contextData.getMessage("_1862094"),mapped_id:n.GridDashboardPageOption.ADD_TO_EXISTING_REPORT}),e}static buildAlertCreationEntry(e,t){const i={name:o.contextData.getMessage("_687468"),mapped_id:n.GridDashboardPageOption.ALERT_CREATION,get visibility(){return r.DashboardActionRestrictions.canCreateAlert(e)?"VISIBLE":"NOT_VISIBLE"}};t.push(i)}static buildShareEntry(e,t){const i={name:o.contextData.getMessage("_687417"),mapped_id:n.GridDashboardPageOption.SHARE,get visibility(){return r.DashboardActionRestrictions.canShareDashboard(e)?"VISIBLE":"NOT_VISIBLE"}};t.push(i)}}}),define("services/icons",["require","exports","log","talkwalker_constants","underscore","services/tw_common","reusable_components"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(){this.iconIds=this._createIconMappedIdsList(),this.iconMap=this._initIconMap(),this.icons=this._initIcons()}getIcon(e,t="default"){return this.iconMap[e][t]}getIconMapForGroupMenu(){return this.icons.groupByIcons}getIconMapForSortMenu(){return this.icons.sortByIcons}isIcon(e){return s.contains(this.iconIds,e)}getIconForMediaType(e,t){return i.logService.assertDefined(e,o.twCommon.logFeatures.IconsService),constants.media_type.group[e.toLowerCase()]?this.getIconForMediaTypeGroup(e,t):this.getIconForMediaTypeUngrouped(e,t)}getIconForJobState(e){switch(e){case constants.user_metrics.state.ok:return this.icons.jobStateIcons.ok;case constants.user_metrics.state.suspended:return this.icons.jobStateIcons.suspended;case constants.user_metrics.state.failing:return this.icons.jobStateIcons.failing;default:return}}initSortByIcons(){return{REACH:this.iconMap.reach,ENGAGEMENT:this.iconMap.engagement,"ENGAGEMENT|ASC":this.iconMap.engagement,ENGAGEMENT_GROUP:this.iconMap.engagement,PUBLISHED_DATE:this.iconMap.publishedDate,PUBLISHED_DATE_GROUP:this.iconMap.publishedDate,"PUBLISHED_DATE|ASC":this.iconMap.publishedDate,SEARCH_INDEXED_DATE:this.iconMap.searchIndexedDate,SEARCH_INDEXED_DATE_GROUP:this.iconMap.searchIndexedDate,"SEARCH_INDEXED_DATE|ASC":this.iconMap.searchIndexedDate,COMMENT_COUNT:this.iconMap.commentCount,VELOCITY:this.iconMap.velocity,VELOCITY_12H:this.iconMap.velocity,VELOCITY_1W:this.iconMap.velocity,VELOCITY_SPOT:this.iconMap.velocity,FACEBOOK:this.iconMap.facebook,FACEBOOK_SHARES:this.iconMap.facebook,FACEBOOK_LIKES:this.iconMap.facebook,FI_REACH:this.iconMap.facebook_insights,FI_IMPRESSIONS:this.iconMap.facebook_insights,FI_CONSUMPTIONS:this.iconMap.facebook_insights,TWITTER:this.iconMap.twitter,TWITTER_LIKES:this.iconMap.twitter,TWITTER_SHARES:this.iconMap.twitter,TWITTER_RETWEETS_COUNT:this.iconMap.twitter,TWITTER_FOLLOWERS:this.iconMap.twitter,YOUTUBE:this.iconMap.youtube,YOUTUBE_LIKES:this.iconMap.youtube,YOUTUBE_DISLIKES:this.iconMap.youtube,YOUTUBE_VIEWS:this.iconMap.youtube,INSTAGRAM:this.iconMap.instagram,INSTAGRAM_LIKES:this.iconMap.instagram,INSTAGRAM_FOLLOWERS:this.iconMap.instagram,PINTEREST:this.iconMap.pinterest,PINTEREST_FOLLOWERS:this.iconMap.pinterest,PINTEREST_SHARES:this.iconMap.pinterest,PMG_SOURCE_DATE:this.iconMap.pmgSourceDate,PMG_DATE_SOURCE:this.iconMap.pmgDateSource,PMG_AVE:this.iconMap.pmgAve,PMG_WORTCOUNT:this.iconMap.pmgWortCount,ALEXA:this.iconMap.viewIcon,ALEXA_PAGEVIEWS:this.iconMap.viewIcon,ALEXA_MONTHLY_UNIQUE_VISITORS:this.iconMap.viewIcon,VINE:this.iconMap.vine,VINE_LIKES:this.iconMap.vine,VINE_LOOPS:this.iconMap.vine,VINE_FOLLOWERS:this.iconMap.vine,VINE_REPOSTS:this.iconMap.vine,CLUSTER_SIZE:this.iconMap.clusterSize,CUSTOM_FIELDS_GROUP:this.iconMap.customFields,RATING:this.iconMap.reviewRating,"RATING|ASC":this.iconMap.reviewRating,CUSTOM_SCORES_GROUP:this.iconMap.customScores,"CUSTOM_SCORES_GROUP|ASC":this.iconMap.customScores}}_initIconMap(){return{group:{default:"fa fa-group"},clusterSize:{sort:"icon2-tw-cluster-size"},commentCount:{sort:"fa fa-comments-o"},engagement:{default:"icon2-tw-engagement",sort:"icon2-tw-engagement"},influence:{sort:"icon-tw-influence"},publishedDate:{sort:"icon-tw-published"},reach:{default:"icon2-tw-reach",sort:"icon2-tw-reach"},searchIndexedDate:{sort:"icon-tw-search"},velocity:{default:"icon2-tw-velocity-increasing",sort:"icon2-tw-velocity-increasing"},pinterest:{sort:"fa fa-pinterest-p"},pmgSourceDate:{sort:"fa fa-angle-double-right"},pmgDateSource:{sort:"fa fa-angle-double-left"},pmgAve:{sort:"fa fa-money"},pmgWortCount:{sort:"fa fa-list-ol"},csv:{default:"icon-tw-csv"},csvUK:{default:"icon-tw-csv"},csvDE:{default:"icon-tw-csv-de"},csvFR:{default:"icon-tw-csv-fr"},csvTab:{default:"icon-tw-csv-tab"},docx:{default:"icon-tw-docx"},pptx:{default:"icon-tw-pptx"},pdf:{default:"icon-tw-pdf"},png:{default:"icon-tw-png"},xls:{default:"icon-tw-xls"},xlsx:{default:"icon2-tw-export-xlsx"},rss:{default:"icon2-tw-rss"},mrss:{default:"icon2-tw-mrss"},json:{default:"icon-tw-json"},xml:{default:"icon-tw-xml"},html:{default:"icon-tw-email"},facebook:{default:"icon-tw-facebook-simple facebook-export",sort:"icon-tw-facebook-simple"},facebook_insights:{default:"icon2-tw-facebook-insights",sort:"icon2-tw-facebook-insights"},twitter:{default:"icon-tw-twitter-simple",sort:"icon-tw-twitter-simple"},youtube:{sort:"fa fa-video-camera"},instagram:{sort:"icon2-tw-instagram"},hootsuite:{default:"icon2-tw-icon-add-hootsuite"},tableau:{default:"icon2-tw-tableau"},viewIcon:{sort:"fa fa-eye"},star:{default:"icon-tw-star"},favorite:{default:"icon-tw-heart"},vine:{sort:"fa fa-vine"},customFields:{default:"fa fa-list-alt",sort:"fa fa-list-alt"},customScores:{default:"icon2-tw-customscores",sort:" icon2-tw-customscores"},reviewRating:{default:"fa fa-star-half-o",sort:"fa fa-star-half-o"}}}_initGroupByIcons(){return{NONE:this.iconMap.group,THREAD:this.iconMap.group,THREAD_AND_SIMILAR:this.iconMap.group,SIMILAR_STORIES:this.iconMap.group,PMG_THREAD:this.iconMap.group,PMG_SOURCE_MAIN_EDITION:this.iconMap.group,PMG_SOURCE_BRANDGROUP:this.iconMap.group,PMG_SOURCE_PUBLICATION_UNIT:this.iconMap.group}}_createIconMappedIdsList(){return[constants.important.id,...s.values(constants.sentiment),...s.values(constants.stars).map(e=>e.id)]}_initIcons(){return{mediaTypes:this.initMediaTypeIcons(),metricIcons:this._initMetricIcons(),chartIcons:this.initChartIcons(),exportIcons:this.initExportIcons(),groupByIcons:this._initGroupByIcons(),sortByIcons:this.initSortByIcons(),specialActionIcons:this.initSpecialActionIcons(),jobStateIcons:this.initJobStateIcons(),textAlignmentIcons:this.initTextAlignmentIcons(),documentFormatIcons:this.initDocumentFormatIcons()}}getIconForMetrics(e){if(constants.sort_by[e.toLowerCase()])return this.getIconForMetricsByMappedId(e);{const t=e.split("_");return t.length>0&&this.getIconForMetricsByMappedId(t[0])}}getIconForChart(e,t){switch(e){case constants.data_type_categories.line_chart_group:case constants.data_type.line_chart:case constants.data_type.line_chart_area:case constants.data_type.line_chart_multiple:case constants.data_type.line_chart_multiple_area:return!0===t?this.icons.chartIcons.lineChart.alt:this.icons.chartIcons.lineChart.square;case constants.data_type_categories.v_bar_chart_group:case constants.data_type.column_chart_vertical:case constants.data_type.column_chart_vertical_perc:case constants.data_type.column_chart_vertical_stacked:case constants.data_type.column_chart_vertical_stacked_perc:case constants.data_type.column_chart_vertical_not_stacked:case constants.data_type.column_chart_vertical_not_stacked_perc:return!0===t?this.icons.chartIcons.verticalBarChart.alt:this.icons.chartIcons.verticalBarChart.square;case constants.data_type_categories.h_bar_chart_group:case constants.data_type.column_chart_horizontal:case constants.data_type.column_chart_horizontal_perc:case constants.data_type.column_chart_horizontal_stacked:case constants.data_type.column_chart_horizontal_stacked_perc:case constants.data_type.column_chart_horizontal_not_stacked:case constants.data_type.column_chart_horizontal_not_stacked_perc:return!0===t?this.icons.chartIcons.horizontalBarChart.alt:this.icons.chartIcons.horizontalBarChart.square;case constants.data_type.counter:return!0===t?this.icons.chartIcons.counter.alt:this.icons.chartIcons.counter.square;case constants.data_type_categories.data_table_group:case constants.data_type.fancy_datatable:case constants.data_type.datatable:return!0===t?this.icons.chartIcons.dataTable.alt:this.icons.chartIcons.dataTable.square;case constants.data_type.bubble:case constants.data_type.activity:return!0===t?this.icons.chartIcons.bubbleChart.alt:this.icons.chartIcons.bubbleChart.square;case constants.data_type.theme_pie_chart:case constants.data_type.pie_chart:return!0===t?this.icons.chartIcons.pieChart.alt:this.icons.chartIcons.pieChart.square;case constants.data_type_categories.radar_chart_group:case constants.data_type.radar_chart_row_axes:case constants.data_type.radar_chart_column_axes:return!0===t?this.icons.chartIcons.radarChart.alt:this.icons.chartIcons.radarChart.square;case constants.data_type.tagcloud_old:return!0===t?this.icons.chartIcons.horizontalCloud.alt:this.icons.chartIcons.horizontalCloud.square;case constants.data_type.tagcloud_list:return!0===t?this.icons.chartIcons.mixedCloud.alt:this.icons.chartIcons.mixedCloud.square;case constants.data_type.gender:return!0===t?this.icons.chartIcons.genderChart.alt:this.icons.chartIcons.genderChart.square;case constants.data_type.map_geo_centroid:return!0===t?this.icons.chartIcons.worldMapGeocentroid.alt:this.icons.chartIcons.worldMapGeocentroid.square;case constants.data_type.map_heatmap:return!0===t?this.icons.chartIcons.worldMapHeatmap.alt:this.icons.chartIcons.worldMapHeatmap.square;case constants.data_type.map_choropleth:return t?this.icons.chartIcons.worldMapChoroplethmap.alt:this.icons.chartIcons.worldMapChoroplethmap.square;case constants.data_type.map_emoji:return t?this.icons.chartIcons.worldMapEmojimap.alt:this.icons.chartIcons.worldMapEmojimap.square;case constants.data_type.map_default:return!0===t?this.icons.chartIcons.worldMap.alt:this.icons.chartIcons.worldMap.square;case constants.data_type.result:return!0===t?this.icons.chartIcons.kpi.alt:this.icons.chartIcons.kpi.square;case constants.data_type.result_simple:return!0===t?this.icons.chartIcons.kpiSimple.alt:this.icons.chartIcons.kpiSimple.square;case constants.data_type.data_set:case constants.root_id.external_data_data_set:return!0===t?this.icons.chartIcons.dataSet.alt:this.icons.chartIcons.dataSet.square;case constants.root_id.external_data_google_analytics:return!0===t?c.googleAnalyticsIcon.alt:c.googleAnalyticsIcon.square;case constants.data_type.influencors_data_type:return!0===t?this.icons.chartIcons.influencerTable.alt:this.icons.chartIcons.influencerTable.square;case constants.data_type.stream_graph:return t?this.icons.chartIcons.streamGraph.alt:this.icons.chartIcons.streamGraph.square;case constants.data_type_categories.themetree_group:case constants.data_type.theme_tree:case constants.data_type.theme_tree_with_trends:return!0===t?this.icons.chartIcons.themeTree.alt:this.icons.chartIcons.themeTree.square;case constants.data_type.theme_tree_only_trends:return!0===t?this.icons.chartIcons.themeTrends.alt:this.icons.chartIcons.themeTrends.square;case constants.data_type.velocity_line_chart:return!0===t?this.icons.chartIcons.velocityLineChart.alt:this.icons.chartIcons.velocityLineChart.square;case constants.data_type.theme_wheel_chart:case constants.data_type.wheel_chart:return!0===t?this.icons.chartIcons.wheelChart.alt:this.icons.chartIcons.wheelChart.square;case constants.data_type.result_progress_graph:case constants.data_type.progress_graph:case constants.data_type.progress_graph_perc:return!0===t?this.icons.chartIcons.progressGraph.alt:this.icons.chartIcons.progressGraph.square;case constants.data_type.multi_metrics:return!0===t?this.icons.chartIcons.multiMetrics.alt:this.icons.chartIcons.multiMetrics.square;case constants.data_type.impact_bubble:return!0===t?this.icons.chartIcons.impactGraph.alt:this.icons.chartIcons.impactGraph.square;default:return}}getIconForWidget(e,t=!1){const i=this.icons.chartIcons;switch(e){case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_SORTED:return t?i.sortedThemes.alt:i.sortedThemes.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ACTIVITY_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_BUBBLE_DEFAULT:return t?i.bubbleChart.alt:i.bubbleChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG__THEME_BAR_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_BAR_CHART_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_BAR_CHART_STACKED_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_HORIZONTAL:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_NOT_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED_PERC:return t?i.horizontalBarChart.alt:i.horizontalBarChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_COLUMN_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_COLUMN_CHART_STACKED:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_COLUMN_CHART_STACKED_PERC:return t?i.verticalBarChart.alt:i.verticalBarChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_COUNTER:return t?i.counter.alt:i.counter.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_DATA_TABLE_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_DATA_TABLE_FANCY:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ISSUE_TRACKER_ITEMS_TABLE:return t?i.dataTable.alt:i.dataTable.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_COMPACT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_IMAGE_GRID:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_IMAGE_TILES:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_STORIES:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_STORY_TILES:return t?i.results.alt:i.results.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_WORLD_MAP:return t?i.globe.alt:i.globe.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_CLOUD:return t?i.mixedCloud.alt:i.mixedCloud.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_CLOUD_HORIZONTAL:return t?i.horizontalCloud.alt:i.horizontalCloud.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_WITH_TRENDS:return t?i.themeTree.alt:i.themeTree.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_THEME_TREE_ONLY_TRENDS:return t?i.themeTrends.alt:i.themeTrends.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_GENDER_DEFAULT:return t?i.genderChart.alt:i.genderChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCER_OVERVIEW_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_TABLE_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_INFLUENCERS_NETWORK:return t?i.influencerTable.alt:i.influencerTable.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_DATA:case n.ConfigurationDefaultsEnum.UUID_CONFIG_LINE_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_LINE_CHART_AREA:case n.ConfigurationDefaultsEnum.UUID_CONFIG_LINE_CHART_MULTIPLE:case n.ConfigurationDefaultsEnum.UUID_CONFIG_LINE_CHART_MULTIPLE_AREA:return t?i.lineChart.alt:i.lineChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MAP:case n.ConfigurationDefaultsEnum.UUID_CONFIG_SECTION_MAP:return t?i.worldMap.alt:i.worldMap.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MAP_GEO_CENTROID:return t?i.worldMapGeocentroid.alt:i.worldMapGeocentroid.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MAP_CHOROPLETH:return t?i.worldMapChoroplethmap.alt:i.worldMapChoroplethmap.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MAP_EMOJI:return t?i.worldMapEmojimap.alt:i.worldMapEmojimap.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MAP_HEATMAP:return t?i.worldMapHeatmap.alt:i.worldMapHeatmap.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_TREEMAP:case n.ConfigurationDefaultsEnum.UUID_CONFIG_ENTRIES_RESULTS_TREE_MAP:return t?i.treeMap.alt:i.treeMap.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MESSAGE_DIFFUSION_ENTRIES:case n.ConfigurationDefaultsEnum.UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS:case n.ConfigurationDefaultsEnum.UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS_ENTRIES:return t?i.messageDiffusion.alt:i.messageDiffusion.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_WHEEL_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_WHEEL_CHART:return t?i.wheelChart.alt:i.wheelChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_PIE_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_PIE_CHART_LEGEND_BOTTOM:case n.ConfigurationDefaultsEnum.UUID_CONFIG_PIE_CHART_LEGEND_RIGHT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_THEME_PIE_CHART:return t?i.pieChart.alt:i.pieChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT_SIMPLE:return t?i.kpiSimple.alt:i.kpiSimple.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_MULTI_METRICS:return t?i.multiMetrics.alt:i.multiMetrics.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_SUMMARY_WIDGET:return t?i.summary.alt:i.summary.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_HEADLINE:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_HEADLINE_PARAGRAPH:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_PARAGRAPH:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_TEXT_BOTTOM:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_TEXT_LEFT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_TEXT_RIGHT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_TEXT_TOP:return t?i.textHeadline.alt:i.textHeadline.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_IMAGE:return t?i.textImage.alt:i.textImage.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_VIDEO:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_VIDEO_TOP:return t?i.textVideo.alt:i.textVideo.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_INFLUENCERS_OVERVIEW_DEFAULT:return t?i.topInfluencers.alt:i.topInfluencers.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_RADAR_CHART_COLUMN_AXES:case n.ConfigurationDefaultsEnum.UUID_CONFIG_RADAR_CHART_ROW_AXES:return t?i.radarChart.alt:i.radarChart.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_STREAM_GRAPH:return t?i.streamGraph.alt:i.streamGraph.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_LIST:case n.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_CLOUD:return t?i.externalTrends.alt:i.externalTrends.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_PROGRESS_GRAPH:case n.ConfigurationDefaultsEnum.UUID_CONFIG_PROGRESS_GRAPH_PERC:case n.ConfigurationDefaultsEnum.UUID_CONFIG_RESULT_PROGRESS_GRAPH:return t?i.progressGraph.alt:i.progressGraph.square;case n.ConfigurationDefaultsEnum.UUID_CONFIG_PAGE_BREAK:case n.ConfigurationDefaultsEnum.UUID_CONFIG_PAGE_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_SECTION_DEFAULT:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_IMAGES:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TOPIC_COUNT_RENDERING:case n.ConfigurationDefaultsEnum.UUID_CONFIG_TRENDS_TABLE:case n.ConfigurationDefaultsEnum.UUID_CONFIG_VELOCITY_CHART:case n.ConfigurationDefaultsEnum.UUID_CONFIG_EDTION:case n.ConfigurationDefaultsEnum.UUID_CONFIG_COMPOSER:default:return"fa fa-question"}}getGridAnchorIcon(e){return r.IconMaps.pageIconMap.has(e)?r.IconMaps.pageIconMap.get(e):(i.logService.info(`No icon found for page anchor ${e}`),"")}getIconForExport(e){switch(e){case constants.output_type.domo:return this.icons.exportIcons.domo;case constants.root_id.export:case constants.root_id.export_complete:return this.icons.exportIcons.export;case constants.root_id.export_replay:return this.icons.exportIcons.animatedExport;case constants.root_id.share:return this.icons.exportIcons.embed;case constants.output_type.csv_fr:return this.icons.exportIcons.csvFR;case constants.output_type.csv_de:return this.icons.exportIcons.csvDE;case constants.output_type.csv_tab:return this.icons.exportIcons.csvTab;case constants.output_type.csv_uk:return this.icons.exportIcons.csvUK;case constants.output_type.csv:case constants.output_type.csv_row_data:return this.icons.exportIcons.csv;case constants.output_type.docx:return this.icons.exportIcons.docx;case constants.output_type.facebook:return this.icons.exportIcons.facebook;case constants.output_type.facelift:return this.icons.exportIcons.facelift;case constants.output_type.gexf:return this.icons.exportIcons.gexf;case constants.output_type.gif:return this.icons.exportIcons.gif;case constants.output_type.hootsuite_stream:return this.icons.exportIcons.hootsuite;case constants.output_type.html_page:return this.icons.exportIcons.html;case constants.output_type.json_newest:case constants.output_type.json_rank:case constants.output_type.exposed_json:return this.icons.exportIcons.json;case constants.output_type.linked_in:return this.icons.exportIcons.linkedin;case constants.output_type.mp4:return this.icons.exportIcons.mp4;case constants.output_type.pdf:case constants.output_type.docx_pdf:case constants.output_type.pptx_pdf:case constants.output_type.png_to_pdf:return this.icons.exportIcons.pdf;case constants.output_type.pinterest:return this.icons.exportIcons.pinterest;case constants.output_type.png:return this.icons.exportIcons.png;case constants.output_type.pptx:return this.icons.exportIcons.pptx;case constants.output_type.rss_newest:case constants.output_type.rss_rank:case constants.output_type.exposed_rssfeed:return this.icons.exportIcons.rss;case constants.output_type.exposed_mrssfeed:return this.icons.exportIcons.mrss;case constants.output_type.tableau_connector_json:return this.icons.exportIcons.tableau;case constants.output_type.twitter:return this.icons.exportIcons.twitter;case constants.output_type.xls:return this.icons.exportIcons.xls;case constants.output_type.xlsx:case constants.output_type.full_xlsx:return this.icons.exportIcons.xlsx;case constants.output_type.xml_newest:case constants.output_type.xml_rank:case constants.output_type.exposed_xml:return this.icons.exportIcons.xml;case constants.output_type.exposed_analytics_api:return this.icons.exportIcons.exposedAnalyticsApi;case constants.output_type.pptx_grid:case constants.output_type.pptx_grid_pdf:return this.icons.exportIcons.table;default:return}}getIconForReportOutputType(e){switch(e){case constants.output_type.html:return this.iconMap.html.default;case constants.output_type.docx:return this.iconMap.docx.default;case constants.output_type.pptx:case constants.output_type.pptx_grid:return this.iconMap.pptx.default;case constants.output_type.docx_pdf:case constants.output_type.pptx_pdf:case constants.output_type.pptx_grid_pdf:return this.iconMap.pdf.default;default:return}}getIconForReportFormat(e){switch(e){case constants.report_format.landscape:return this.icons.documentFormatIcons.landscape;case constants.report_format.portrait:return this.icons.documentFormatIcons.portait;case constants.report_format.screen:return this.icons.documentFormatIcons.scrollable;default:return}}getIconForSpecialAction(e){switch(e){case constants.special_actions.s_create_press_release:return this.icons.specialActionIcons.createPressRelease;case constants.special_actions.s_edit_axis_label:return this.icons.specialActionIcons.editAxisLabels;default:return}}getIconForTextAlignment(e){switch(e){case"JUSTIFY":return this.icons.textAlignmentIcons.alignJustify;case"RIGHT":return this.icons.textAlignmentIcons.alignRight;case"CENTER":return this.icons.textAlignmentIcons.alignCenter;default:return this.icons.textAlignmentIcons.alignLeft}}getIconForMediaTypeGroup(e,t){switch(i.logService.assertDefined(e,o.twCommon.logFeatures.IconsService),e){case constants.media_type.group.onlinenews.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.onlinenewsIcon.square:this.icons.mediaTypes.onlinenewsIcon.alt;case constants.media_type.group.newsletter.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.newsletterIcon.square:this.icons.mediaTypes.newsletterIcon.alt;case constants.media_type.group.blog.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.blogIcon.square:this.icons.mediaTypes.blogIcon.alt;case constants.media_type.group.messageboard.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.messageboardIcon.square:this.icons.mediaTypes.messageboardIcon.alt;case constants.media_type.group.socialmedia_facebook.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.facebookIcon.square:this.icons.mediaTypes.facebookIcon.alt;case constants.media_type.group.socialmedia_twitter.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.twitterIcon.square:this.icons.mediaTypes.twitterIcon.alt;case constants.media_type.group.socialmedia_googleplus.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.googleplusIcon.square:this.icons.mediaTypes.googleplusIcon.alt;case constants.media_type.group.socialmedia_youtube.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.youtubeIcon.square:this.icons.mediaTypes.youtubeIcon.alt;case constants.media_type.group.socialmedia_linkedin.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.linkedinIcon.square:this.icons.mediaTypes.linkedinIcon.alt;case constants.media_type.group.socialmedia_flickr.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.flickrIcon.square:this.icons.mediaTypes.flickrIcon.alt;case constants.media_type.group.socialmedia_foursquare.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.foursquareIcon.square:this.icons.mediaTypes.foursquareIcon.alt;case constants.media_type.group.socialmedia_instagram.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.instagramIcon.square:this.icons.mediaTypes.instagramIcon.alt;case constants.media_type.group.socialmedia_mixcloud.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.mixcloudIcon.square:this.icons.mediaTypes.mixcloudIcon.alt;case constants.media_type.group.socialmedia_soundcloud.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.soundcloudIcon.square:this.icons.mediaTypes.soundcloudIcon.alt;case constants.media_type.group.socialmedia_vimeo.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.vimeoIcon.square:this.icons.mediaTypes.vimeoIcon.alt;case constants.media_type.group.socialmedia_dailymotion.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.dailymotionIcon.square:this.icons.mediaTypes.dailymotionIcon.alt;case constants.media_type.group.socialmedia_weibo.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.weiboIcon.square:this.icons.mediaTypes.weiboIcon.alt;case constants.media_type.group.socialmedia_vkontakte.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.vkontakteIcon.square:this.icons.mediaTypes.vkontakteIcon.alt;case constants.media_type.group.monitoredsite.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.monitoredSiteIcon.square:this.icons.mediaTypes.monitoredSiteIcon.alt;case constants.media_type.group.socialmedia_pinterest:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.pinterestIcon.square:this.icons.mediaTypes.pinterestIcon.alt;case constants.media_type.group.print.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.printIcon.square:this.icons.mediaTypes.printIcon.alt;case constants.media_type.group.broadcast.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.broadcastIcon.square:this.icons.mediaTypes.broadcastIcon.alt;case constants.media_type.group.other.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.otherMediaIcon.square:this.icons.mediaTypes.otherMediaIcon.alt;case constants.media_type.group.socialmedia_vine:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.vineIcon.square:this.icons.mediaTypes.vineIcon.alt;case constants.media_type.group.socialmedia_douban:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.doubanIcon.square:this.icons.mediaTypes.doubanIcon.alt;default:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.otherMediaIcon.square:this.icons.mediaTypes.otherMediaIcon.alt}}getIconForMediaTypeUngrouped(e,t){i.logService.assertDefined(e,o.twCommon.logFeatures.IconsService);const n=this.getIconForSingleMediaType(e,t);if(n!==this.icons.mediaTypes.otherMediaIcon.alt&&n!==this.icons.mediaTypes.otherMediaIcon.square)return n;let r;return s.any(constants.media_type.group,t=>!!(r=(s.find(t.children,t=>t.mapped_id===e)||{}).mapped_id)),s.isUndefined(r)?n:this.getIconForMediaTypeGroup(r,t)}getIconForSingleMediaType(e,t){switch(e){case constants.media_type.blog_other.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.blogIcon.square:this.icons.mediaTypes.blogIcon.alt;case constants.media_type.broadcast_radio.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.radioIcon.square:this.icons.mediaTypes.radioIcon.alt;case constants.media_type.messageboard_other.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.messageboardIcon.square:this.icons.mediaTypes.messageboardIcon.alt;case constants.media_type.monitoredsite_other.mapped_id:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.monitoredSiteIcon.square:this.icons.mediaTypes.monitoredSiteIcon.alt;default:return s.isUndefined(t)||!0!==t?this.icons.mediaTypes.otherMediaIcon.square:this.icons.mediaTypes.otherMediaIcon.alt}}initMediaTypeIcons(){return c}getIconForMetricsByMappedId(e){switch(i.logService.assertDefined(e,o.twCommon.logFeatures.IconsService),e){case constants.sort_by.alexa:case constants.sort_by.alexa_pageviews:case constants.sort_by.alexa_monthly_unique_visitors:return this.icons.metricIcons.viewIcon;case constants.sort_by.cluster_size:return this.icons.metricIcons.clusterSizeIcon;case constants.sort_by.comment_count:return this.icons.metricIcons.commentCountIcon;case constants.sort_by.engagement:return this.icons.metricIcons.engagementIcon;case constants.sort_by.facebook:return this.icons.metricIcons.facebookSortIcon;case constants.sort_by.influence:return this.icons.metricIcons.influenceIcon;case constants.sort_by.instagram:return this.icons.metricIcons.instagramSortIcon;case constants.sort_by.pmg_ave:return this.icons.metricIcons.pmgAveIcon;case constants.sort_by.pmg_source_date:return this.icons.metricIcons.pmgSourceDateIcon;case constants.sort_by.pmg_date_source:return this.icons.metricIcons.pmgDateSourceIcon;case constants.sort_by.pmg_wortcount:return this.icons.metricIcons.pmgWortCountIcon;case constants.sort_by.published_date:return this.icons.metricIcons.publishedDateIcon;case constants.sort_by.reach:return this.icons.metricIcons.reachIcon;case constants.sort_by.search_indexed_date:return this.icons.metricIcons.searchIndexedDateIcon;case constants.sort_by.twitter:return this.icons.metricIcons.twitterSortIcon;case constants.sort_by.velocity:case constants.sort_by.velocity_score:case constants.sort_by.velocity_12h:case constants.sort_by.velocity_spot:return this.icons.metricIcons.velocitySortIcon;case constants.sort_by.youtube:return this.icons.metricIcons.youtubeSortIcon;default:return"fa-question-circle"}}_initMetricIcons(){return{clusterSizeIcon:"fa fa-th",commentCountIcon:"fa fa-comments-o",engagementIcon:this.iconMap.engagement.default,facebookSortIcon:"icon-tw-facebook-simple",influenceIcon:"icon-tw-influence",instagramSortIcon:"icon2-tw-instagram",publishedDateIcon:"icon-tw-published",reachIcon:this.iconMap.reach.default,searchIndexedDateIcon:"icon-tw-search",twitterSortIcon:"icon-tw-twitter-simple",velocitySortIcon:this.iconMap.velocity.default,youtubeSortIcon:"fa fa-video-camera",pmgSourceDateIcon:"fa fa-angle-double-right",pmgDateSourceIcon:"fa fa-angle-double-left",pmgAveIcon:"fa fa-money",pmgWortCountIcon:"fa fa-list-ol",viewIcon:"fa fa-eye",customFieldsIcon:this.iconMap.customFields.default,customScoresIcon:this.iconMap.customScores.default,reviewRatingIcon:this.iconMap.reviewRating.default}}initChartIcons(){return{lineChart:{square:"icon-tw-line-chart",alt:""},verticalBarChart:{square:"icon-tw-vertical-bar-chart",alt:""},horizontalBarChart:{square:"icon-tw-horizontal-bar-chart",alt:""},dataTable:{square:"icon-tw-icons-table",alt:""},bubbleChart:{square:"icon-tw-bubble-chart",alt:""},counter:{square:"icon2-tw-counter",alt:""},externalTrends:{square:"icon2-tw-theme-trend",alt:""},pieChart:{square:"icon-tw-pie-chart",alt:""},radarChart:{square:"icon2-tw-radar-chart",alt:""},horizontalCloud:{square:"icon-tw-horizontal-word-cloud",alt:""},mixedCloud:{square:"icon-tw-icons-mixed-word-cloud",alt:""},genderChart:{square:"icon-tw-gender-chart",alt:""},dataSet:{square:"fa fa-database",alt:""},worldMapGeocentroid:{square:"icon2-tw-geocentroid",alt:""},worldMapHeatmap:{square:"icon2-tw-heatmap",alt:""},worldMapChoroplethmap:{square:"icon2-tw_choroplethmap",alt:""},worldMapEmojimap:{square:"icon2-tw_emojimap",alt:""},worldMap:{square:"icon2-tw-worldmap",alt:""},kpi:{square:"icon-tw-kpi",alt:""},kpiSimple:{square:"icon2-tw-simple-kpi",alt:""},influencerTable:{square:"icon2-tw-show-details",alt:""},velocityLineChart:{square:"icon2-tw-velocity",alt:""},themeTree:{square:"icon2-tw-theme-tree2",alt:""},themeTrends:{square:"icon2-tw-theme-trend",alt:""},wheelChart:{square:"icon2-tw-wheel-chart"},results:{square:"fa fa-th-list"},globe:{square:"fa fa-globe"},messageDiffusion:{square:"icon2-tw-message-diffusion fa-rotate-90"},multiMetrics:{square:"icon2-tw-multi-metrics",alt:""},progressGraph:{square:"icon2-tw-progress-graph",alt:""},streamGraph:{square:"icon2-tw-streamgraph",alt:""},summary:{square:"icon2-tw-summary",alt:""},treeMap:{square:"icon2-tw-treemap",alt:""},topInfluencers:{square:"icon2-tw-top-influencer-list",alt:""},textHeadline:{square:"icon2-tw-headline",alt:""},textImage:{square:"icon2-tw-image",alt:""},textVideo:{square:"icon2-tw-video",alt:""},impactGraph:{square:"icon2-tw-impact-graph",alt:"icon2-tw-impact-graph"},sortedThemes:{square:"icon2-tw-sorted-themes",alt:"icon2-tw-sorted-themes"}}}initExportIcons(){return{exposedAnalyticsApi:"icon2-tw-yeti-feet",animatedExport:"icon2-tw-animated-export",csv:"icon-tw-csv",csvUK:"icon-tw-csv",csvDE:"icon-tw-csv-de",csvFR:"icon-tw-csv-fr",csvTab:"icon-tw-csv-tab",docx:"icon-tw-docx",domo:"icon2-tw-domo",export:"icon2-tw-export",embed:"icon2-tw-embedded",gexf:"icon2-tw-gexf",gif:"icon2-tw-gif",mp4:"icon2-tw-mp4",pptx:"icon-tw-pptx",pdf:"icon-tw-pdf",png:"icon-tw-png",xls:"icon-tw-xls",xlsx:"icon2-tw-export-xlsx",rss:"icon-tw-rss",mrss:"icon2-tw-mrss",json:"icon-tw-json",xml:"icon-tw-xml",html:"icon-tw-email",facebook:"icon-tw-facebook-simple facebook-export",twitter:"icon-tw-twitter-simple",linkedin:"fa fa-linkedin linkedin",pinterest:"fa fa-pinterest pinterest",hootsuite:"icon2-tw-icon-add-hootsuite",tableau:"icon2-tw-tableau",table:"fa fa-table",facelift:"icon2-tw-brand-facelift"}}initSpecialActionIcons(){return{createPressRelease:"fa fa-file-text-o",editAxisLabels:"fa fa-pencil"}}initJobStateIcons(){return{ok:"fa fa-check",suspended:"fa fa-warning",failing:"fa fa-times"}}initTextAlignmentIcons(){return{alignLeft:"fa fa-align-left",alignCenter:"fa fa-align-center",alignRight:"fa fa-align-right",alignJustify:"fa fa-align-justify"}}initDocumentFormatIcons(){return{portait:"icon2-tw-doc-portrait",landscape:"icon2-tw-doc-landscape",scrollable:"icon2-tw-doc-scrollable"}}}t.default=a;const c={onlinenewsIcon:{square:"fa fa-file-text-o blog",alt:"fa fa-file-text-o blog alt"},newsletterIcon:{square:"fa fa-newspaper-o newsletter",alt:"fa fa-newspaper-o newsletter alt"},blogIcon:{square:"icon2-tw-blog-V2 blog",alt:"icon2-tw-blog-V2 blog alt"},messageboardIcon:{square:"icon2-tw-message-board blog",alt:"icon2-tw-message-board blog alt"},facebookIcon:{square:"fa fa-facebook facebook",alt:"fa fa-facebook facebook alt"},facebookInsightsIcon:{square:"icon2-tw-facebook-insights",alt:"icon2-tw-facebook-insights"},twitterIcon:{square:"fa fa-twitter twitter",alt:"fa fa-twitter twitter alt"},googleplusIcon:{square:"fa fa-google-plus google-plus",alt:"fa fa-google-plus google-plus alt"},googleAnalyticsIcon:{square:"icon2-tw-google-analytics",alt:"icon2-tw-google-analytics"},googleSpreadsheetsIcon:{square:"icon2-tw-google-sheets"},youtubeIcon:{square:"fa fa-youtube youtube",alt:"fa fa-youtube youtube alt"},linkedinIcon:{square:"fa fa-linkedin linkedin",alt:"fa fa-linkedin linkedin alt"},flickrIcon:{square:"fa fa-flickr flickr",alt:"fa fa-flickr flickr alt"},foursquareIcon:{square:"fa fa-foursquare foursquare",alt:"fa fa-foursquare foursquare alt"},instagramIcon:{square:"fa fa-instagram instagram",alt:"fa fa-instagram instagram alt"},mixcloudIcon:{square:"icon-tw-mixcloud mixcloud",alt:"icon-tw-mixcloud mixcloud alt"},soundcloudIcon:{square:"icon-tw-soundcloud sound-cloud",alt:"icon-tw-soundcloud sound-cloud alt"},vimeoIcon:{square:"fa fa-vimeo-square vimeo",alt:"fa fa-vimeo-square vimeo alt"},dailymotionIcon:{square:"icon-tw-dailymotion dailymotion",alt:"icon-tw-dailymotion dailymotion alt"},weiboIcon:{square:"fa fa-weibo weibo",alt:"fa fa-weibo weibo alt"},vkontakteIcon:{square:"fa fa-vk vkontakte",alt:"fa fa-vk vkontakte alt"},monitoredSiteIcon:{square:"fa fa-file-text-o blog",alt:"fa fa-file-text-o blog alt"},pinterestIcon:{square:"fa fa-pinterest-p pinterest",alt:"fa fa-pinterest-p pinterest alt"},printIcon:{square:"fa fa-newspaper-o newsletter",alt:"fa fa-newspaper-o newsletter alt"},broadcastIcon:{square:"fa fa-television broadcast",alt:"fa fa-television broadcast alt"},radioIcon:{square:"fa fa-microphone broadcast",alt:"fa  fa-microphone broadcast alt"},otherMediaIcon:{square:"fa fa-file-text-o blog",alt:"fa fa-file-text-o blog alt"},vineIcon:{square:"fa fa-pinterest-p vine",alt:"fa fa-pinterest-p vine alt"},doubanIcon:{square:"icon2-tw-douban douban",alt:"icon2-tw-douban douban alt"},eksiSozlukIcon:{square:"icon2-tw-eksi-drop eksi-drop",alt:"icon2-tw-eksi-drop eksi-drop alt"},twitchIcon:{square:"icon2-tw-twitch-purple twitch-purple",alt:" icon2-tw-twitch-purple twitch-purple alt"},kakaoStoryIcon:{square:"icon2-tw-kakaostory-yellow kakaostory-yellow",alt:"icon2-tw-kakaostory-yellow kakaostory-yellow alt"},acFunIcon:{square:"icon2-tw-acfun-kawaii acfun-kawaii",alt:"icon2-tw-acfun-kawaii acfun-kawaii alt"}};t.iconService=new a}),define("classes/dashboard_grid_converter/dashboard_grid_converter_model",["require","exports","subdivision_editor","services/icons","talkwalker_constants","event"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=10;t.DashboardGridConverterModel=class extends i.DivisionModel{constructor(e){super(e.getAllowedPages().getDisplayingTitle(),12),this.pageState=e,this.wasChanged=!1,this.onLoadingFinished=new o.Event,this.parsePageState(e.clone()),this.onChange.subscribeOnce(()=>{this.wasChanged=!0})}parsePageState(e){let t,i=0,o=!0,r=!1;this.sortWidgetsInPageState(e),e.getWidgets().forEach(e=>{if(o&&(t=e.getSectionId(),o=!1),t!==e.getSectionId()&&i++,e.getConfigurationRenderingUuid()!==s.ConfigurationDefaultsEnum.UUID_CONFIG_EDTION){[s.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_HEADLINE,s.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_HEADLINE_PARAGRAPH].includes(e.getConfigurationRenderingUuid())&&e.getWidth()===this.getMaxWidth()&&!r?(this.addSubdivision(e.hasPayloadValue()?e.getPayloadValue().display_headline:""),r=!0):r=!1,this.hasSubdivisions()||this.addSubdivision(this.getTitle()),t=e.getSectionId();const o={id:e.getId(),title:e.getTitle()||e.hasPayloadValue()&&e.getPayloadValue().display_headline||"",icon:n.iconService.getIconForWidget(e.getConfigurationRenderingUuid()),width:e.getWidth()};this.addItem(i,o)}else o=!0});let a=this.getLargeSubdivisionIndex();for(;this.canCreateNewSubdivision()&&a>=0;)this.splitSubdivisionBySize(a),a=this.getLargeSubdivisionIndex()}sortWidgetsInPageState(e){e.getWidgets().sort((t,i)=>{const n=e.getSections().indexOf(e.getSectionById(t.getSectionId())),s=e.getSections().indexOf(e.getSectionById(i.getSectionId()));return n===s?t.getDic().position_id-i.getDic().position_id:n-s})}splitSubdivisionBySize(e){if(!this.canCreateNewSubdivision())return;const t=this.getSubdivision(e),i=t.firstRowIndex,n=i+t.numRows;let s=0,o=0;for(let a=i;a<=n;++a){if((s+=this.getItemCountByRow(a))>r){this.splitSubdivision(t,Math.max(o,1));const i=e+1;return void(this.getItemCountBySubdivision(this.getSubdivision(i))>r&&this.splitSubdivisionBySize(e+1))}o++}}getLargeSubdivisionIndex(){return this.getSubdivisions().findIndex(e=>this.getItemCountBySubdivision(e)>r)}toAnchorContainers(){const e=[];return this.getSubdivisions().forEach(t=>{const i=this.getWidgetIdsOfSubdivision(t);e.push({widget_ids:i,anchor:{icon:t.icon.type,title:t.title,custom_icon_data:t.icon.type===s.PageIcon.CUSTOM?{type:t.icon.customIconData.type,content:t.icon.customIconData.content}:void 0}})}),e}}}),define("classes/dashboard_grid_converter/dashboard_grid_converter_controller",["require","exports","services/bubble_dialog","classes/dashboard_grid_converter/dashboard_grid_converter","classes/custom_pages/custom_page_factory","event","services/confirmation_service","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.DashboardGridConverterController=class{constructor(){this.confirmationOpen=!1,this.onCancel=new o.Event}async apply(e){const t=s.CustomPageFactory.getPageFromPageState(e.pageState),i=e.toAnchorContainers();await t.convertToGrid({mapped_id:t.getId(),anchors:i}),this.closeDialog(),t.refreshPage()}async cancel(e){e.wasChanged?this.confirmationOpen||(this.confirmationOpen=!0,r.confirmationService.display({message:{message:a.contextData.getMessage("_451020"),ok:a.contextData.getMessage("_697024"),cancel:a.contextData.getMessage("_348105")}},{fadeOtherBubbles:!0}).then(()=>{setTimeout(()=>{this.onCancel.fire(),this.closeDialog(),this.confirmationOpen=!1})}).catch(()=>{setTimeout(()=>{this.confirmationOpen=!1})})):(this.onCancel.fire(),this.closeDialog())}closeDialog(){i.bubbleDialogService.getFirstBubbleById(n.DASHBOARD_GRID_CONVERTER_BUBBLE_DIALOG_ID).destroy()}}}),define("react_components/bubble_dialogs/components/dashboard_grid_converter_dialog",["require","exports","flux","subdivision_editor","react","reusable_utilities"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends i.BaseComponent{render(){const{model:e,controller:t,headline:i}=this.props;return s.createElement("div",{className:"dashboard-converter"},s.createElement("div",{className:"headline"},s.createElement("div",{className:"headline-item header-text"},i),s.createElement("button",{type:"button pull-right",className:"headline-item close",onClick:()=>t.cancel(e)},"×")),s.createElement("div",null,s.createElement(n.SubdivisionEditor,Object.assign({},this.props))))}clickInside(e){}clickOutside(e){this.props.controller.cancel(this.props.model)}}t.DashboardGridConverterDialog=r,o.applyMixins(r,[i.DocumentClickTracker])}),define("classes/dashboard_grid_converter/dashboard_grid_converter",["require","exports","jquery","services/bubble_dialog","services/tw_common","bubble_dialogs","react","classes/dashboard_grid_converter/dashboard_grid_converter_controller","classes/dashboard_grid_converter/dashboard_grid_converter_model","talkwalker_constants","services/icons","classes/context_data/context_data","react_components/bubble_dialogs/components/dashboard_grid_converter_dialog","services/theme","event","reusable_components"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.DASHBOARD_GRID_CONVERTER_BUBBLE_DIALOG_ID="dashboard_grid_converter";t.DashboardGridConverter=class{constructor(e){this.model=new c.DashboardGridConverterModel(e),this.onCancel=new h.Event}spawnBubble(){this.bubble&&this.bubble.destroy();const e=p.themeService.getCurrentThemeModel(),c=new a.DashboardGridConverterController;c.onCancel.link(this.onCancel),this.bubble=n.bubbleDialogService.createReactBubble(t.DASHBOARD_GRID_CONVERTER_BUBBLE_DIALOG_ID,i("#page_content"),{},t=>r.createElement(u.DashboardGridConverterDialog,{headline:g.contextData.getMessage("_451101"),controller:c,model:this.model,icons:this.generateSubdivisionIcons(),messages:{labels:{icon:g.contextData.getMessage("_451004"),title:g.contextData.getMessage("_451003")},buttons:{apply:g.contextData.getMessage("_451001"),cancel:g.contextData.getMessage("_451002")},tooltips:{createPageBreak:g.contextData.getMessage("_451010"),removePageBreak:g.contextData.getMessage("_451011")}},theme:{separator:{color:e.highlight,iconColor:e.shadeLight},subdivision:{secondaryColor:e.tableColorEven}}}),(new o.BubbleDialogStyle).setArrowSide(s.twCommon.sides.CENTER).setAbsoluteY(80).setMinWidth(1200).setMaxWidth(1200).setMinHeight(350).setDisplay("block"),{fadeBackground:!0})}generateSubdivisionIcons(){const e=[];return e.push({type:l.PageIcon.CUSTOM,customIconData:{type:m.CustomPageIconType.FIGURE}}),e.push({type:l.PageIcon.CUSTOM,customIconData:{type:m.CustomPageIconType.FROM_TITLE}}),e.push({type:l.PageIcon.CUSTOM,customIconData:{type:m.CustomPageIconType.CUSTOM_LETTERS,content:"Aa"}}),Object.keys(l.PageIcon).forEach(t=>{d.iconService.getGridAnchorIcon(t)&&e.push({type:t})}),e}}}),define("classes/directives/directive_wrapper",["require","exports","underscore","services/tw_common","services/directive"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","$rootScope","$q","$timeout",function(e,t,o,r){function a(e,t,i){this.constructor=t;const n=Object.getPrototypeOf(this);e.constants=constants,this.$scope=e,e.$element=i,this._enhanceScope(e,n),this.deployDelay=void 0,this._deployFinished=!1,this._deployOngoing=!1}return a.prototype={_deployAsync:function(e,t){const n=o.defer();for(let o=e;o<t;o++){const e=this.$scope._deployments[o];if(void 0===e)return n.resolve(),n.promise;const t=e.element.attr("directive");e.element.removeAttr("directive");const r={};$(e.element[0].attributes).each(function(){~this.nodeName.indexOf("ng-")||(r[this.nodeName]='"'+this.nodeValue+'"')}),i.each(i.keys(r),function(t){e.element.removeAttr(t)}),s.directiveService.inject(e.element,t,r,e.scope)}return this._rushingDeploy?n.resolve():r(function(){n.resolve()},250),n.promise},_rushDeploy:function(){this._rushingDeploy=!0,this._deploy(10)},_deploy:function(t){if(this._deployOngoing||this._deployFinished)return;const i=o.defer(),s=this;if(this._deployOngoing=!0,this.$scope._deployments&&this.$scope._deployments.length>0){!function t(o,r){e.debug("deploying: "+o+" total:"+s.$scope._deployments.length+" batchsize:"+r,n.twCommon.logFeatures.DirectiveWrapper),s._deployAsync(o,o+r).then(function(){(o+=r)<=s.$scope._deployments.length?s._rushingDeploy?t(o,r):(new Date).getTime()<s._deployDelay?setTimeout(function e(){(new Date).getTime()<s._deployDelay?setTimeout(e,s._deployDelay-(new Date).getTime()):t(o,r)},s._deployDelay-(new Date).getTime()):t(o,r):(s._deployFinished=!0,s._deployOngoing=!1,s.$scope._deployments.length=0,i.resolve())})}(0,t)}return i.promise},_enhanceScope:function(e,t){e._controller=this;const n=Object.getPrototypeOf(t);if(n&&this._enhanceScope(e,n),t.$scope){const n=t.$scope.call(e,this);i.each(i.keys(n),function(t){"$destroy"===t?e.$on("$destroy",n[t].bind(e)):e[t]=n[t]})}}},a}]}),define("wrappers/content_structure/content_structure_entry_wrapper",["require","exports","underscore","wrappers/abstract_wrapper","log","services/tw_common"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends n.AbstractWrapper{constructor(e,t){super("ContentStructureEntryWrapper"),this.dropZoneConfiguration=[o.twCommon.sides.RIGHT,o.twCommon.sides.LEFT,o.twCommon.sides.CENTER],this.contentStructureEntry=e,this.associatedSection=t,this.children=[]}toProto(){return this.contentStructureEntry}getContentStructureEntry(){return this.contentStructureEntry}getTitle(){return this.contentStructureEntry.title}setTitle(e){this.contentStructureEntry.title=e}getDescription(){return this.contentStructureEntry.description}setDescription(e){this.contentStructureEntry.description=e}getColor(){return this.contentStructureEntry.color}getUrl(e){return e?void 0!==this.contentStructureEntry.url&&this.isClickActionUrl()?this.contentStructureEntry.url:"#":this.contentStructureEntry.url}getAlternateUrl(e){return e?void 0!==this.contentStructureEntry.alternate_url&&this.isClickActionUrl()?this.contentStructureEntry.alternate_url:"#":this.contentStructureEntry.alternate_url}getPageId(){return this.contentStructureEntry.page_id}getPageCategory(){return this.contentStructureEntry.page_category}getMappedId(){return this.contentStructureEntry.mapped_id}getChildren(){return void 0===this.contentStructureEntry.children&&(this.contentStructureEntry.children=[]),this.children.length!==this.contentStructureEntry.children.length&&(this.children=this.initializeWrappedChildren()),this.children}initializeWrappedChildren(){return this.contentStructureEntry.children.map(e=>new r(e,this.associatedSection))}hasChildren(){return this.getChildren().length>0}isClickActionUrl(){const{click_action:e}=this.contentStructureEntry;return void 0===e||e===constants.cse_click_action.url}isClickActionBubbleDialog(){const{click_action:e}=this.contentStructureEntry;return e===constants.cse_click_action.bubble_dialog}isClickActionToggle(){const{click_action:e}=this.contentStructureEntry;return e===constants.cse_click_action.toggle}getStateIconNormal(){return this.contentStructureEntry.state_icons.normal}getStateIconSelectred(){return this.contentStructureEntry.state_icons.normal}getStateIcon(){return this.isSelected()?this.contentStructureEntry.state_icons.selected:this.getStateIconNormal()}getSection(){return this.associatedSection}getActions(){return this.contentStructureEntry.actions}hasActions(){return void 0!==this.getActions()&&this.getActions().length>0}debugPrint(){this._debugPrint(this,"",!0)}_debugPrint(e,t,i){const n=e.getMappedId()+e.getTitle();e.isSelected()?console.log(t+(i?"└──[X] ":"├──[X] ")+n):console.log(t+(i?"└──[] ":"├──[] ")+n);for(let n=0;n<e.getChildrenCount();n++)this._debugPrint(e.getChildren()[n],t+(i?"    ":"│   "),n+1===e.getChildrenCount())}getFirstSelectedEntry(){return this.getChildren().find(e=>e.isSelected())}getSelectedChildren(){return this.getChildren().filter(e=>e.isSelected())}getUnselectedChildren(){return this.getChildren().filter(e=>!e.isSelected())}getChildIndex(e){return s.logService.assert(void 0!==e,"entry is required",o.twCommon.logFeatures.ContentStructureEntry),s.logService.assert(e instanceof r,"entry must be wrapped",o.twCommon.logFeatures.ContentStructureEntry),this.contentStructureEntry.children.indexOf(e.toProto())}toggleSelection(){this.setSelected(!this.isSelected())}getEntryByMappedId(e){if(s.logService.assert(void 0!==e,"mapped id is required",o.twCommon.logFeatures.ContentStructureEntry),this.getMappedId()===e)return this;{let t=void 0;for(const i of this.getChildren()){const n=i.getEntryByMappedId(e);if(void 0!==n){t=n;break}}return t}}containsEntry(e){return void 0!==this.getEntryByMappedId(e.getMappedId())}getParentEntry(e){let t=void 0;return this.getChildren().forEach(i=>{if(i.getContentStructureEntry()!==e.getContentStructureEntry()){const n=i.getParentEntry(e);if(void 0!==n)return void(t=n)}else t=this}),t}getChildrenCount(){return void 0!==this.contentStructureEntry.children?this.contentStructureEntry.children.length:0}allChildrenSelected(){return this.getChildren().every(e=>e.isSelected())}isCollapsed(){return!0===this.collapsed}toggleCollapse(){this.collapsed=!this.isCollapsed()}containsSelection(e=!1){return!(!this.isSelected()||e)||this.getChildren().some(e=>e.containsSelection())}isSelected(){return!0===this.contentStructureEntry.selected}setSelected(e){s.logService.assert(void 0!==e,"selected is required",o.twCommon.logFeatures.ContentStructureEntry),this.contentStructureEntry.selected=e}isMovable(){const e=this.associatedSection.type;return e===constants.stateless.type.dashboards||e===constants.stateless.type.command_center}setDropZoneConfiguration(e){this.dropZoneConfiguration=e}getDropZoneConfiguration(){return this.dropZoneConfiguration}attachTemplate(e){s.logService.assert(void 0!==e,"element is required",o.twCommon.logFeatures.ContentStructureEntry),this.element=e}getId(){return this.contentStructureEntry.mapped_id}isEqualTo(e){return this.contentStructureEntry.mapped_id===e.contentStructureEntry.mapped_id}getTemplate(){return this.element}hasTemplate(){return void 0!==this.getTemplate()}removeChildAt(e){this.contentStructureEntry.children.splice(e,1),this.children.splice(e,1)}removeChild(e){const t=this.getChildren().findIndex(t=>t===e);t>-1&&this.removeChildAt(t)}removeEntry(e){return this.getChildren().includes(e)?(this.removeChild(e),!0):this.getChildren().some(t=>t.removeEntry(e))}addChildAt(e,t){this.contentStructureEntry.children.splice(e,0,t.getContentStructureEntry()),this.children.splice(e,0,t)}addChild(e){this.contentStructureEntry.children.push(e.getContentStructureEntry()),this.children.push(e)}isEditable(){return!0===this.contentStructureEntry.editable}}t.ContentStructureEntryWrapper=r,t.default=i.constant(r)}),define("wrappers/content_structure/content_structure_wrapper",["require","exports","wrappers/abstract_wrapper","log","services/tw_common","wrappers/content_structure/content_structure_entry_wrapper"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends i.AbstractWrapper{constructor(e,t){super("ContentStructureWrapper"),n.logService.assert(void 0!==e,"contentStructure is required"),n.logService.assert(void 0!==t,"section is required"),this.contentStructure=e,this.associatedSection=t,this.validate()}validate(){n.logService.assert(void 0!==this.contentStructure.root_entry,"Content Structure has no root entry",s.twCommon.logFeatures.ContentStructure,this)}toProto(){return this.contentStructure}getContentStructure(){return this.contentStructure}hasRootEntry(){return void 0!==this.contentStructure.root_entry}setRootEntry(e){this.contentStructure.root_entry=e.toProto(),this.rootEntry=void 0}getParentEntry(e){if((e=this.getEntryByMappedId(e.getMappedId())).getContentStructureEntry()!==this.getRootEntry().getContentStructureEntry())return this.getRootEntry().getParentEntry(e)}getEntryByMappedId(e){return this.getRootEntry().getEntryByMappedId(e)}getRootEntry(){return n.logService.assert(!0===this.hasRootEntry(),"topic menu has no root entry",s.twCommon.logFeatures.ContentStructure),void 0===this.rootEntry&&(this.rootEntry=new o.ContentStructureEntryWrapper(this.contentStructure.root_entry,this.associatedSection)),this.rootEntry}debugPrint(){this.getRootEntry().debugPrint()}isShowingAll(){return this.contentStructure.show_all_content||!1}isEditable(){return this.contentStructure.editable}removeEntry(e){return this.getRootEntry().removeEntry(e)}addEntry(e){this.getRootEntry().addChild(e)}}t.ContentStructureWrapper=r,t.default=_.constant(r)}),define("classes/floating_content/floating_content_structure",["require","exports","log","underscore","wrappers/content_structure/content_structure_wrapper"],function(e,t,i,n,s){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CATEGORIES=0]="CATEGORIES",e[e.UNCATEGORIZED_ENTRIES=1]="UNCATEGORIZED_ENTRIES"}(o=t.InternalSectionType||(t.InternalSectionType={}));const r={ColoredSectionBlock:"COLORED_SECTION_BLOCK"};class a{constructor(e){this.editing=!1,this.section=e,this.showMore=!1,this.maxRows=3,this.entriesPerRow={4:1,6:2,8:2,12:4},this.uncategorizedEntries=[],this.categories=[],this.internalSections={},this.internalSections[o.CATEGORIES]={showMore:!1},this.internalSections[o.UNCATEGORIZED_ENTRIES]={showMore:!1},this.initializeContent()}toProto(){return this.section}setEditing(e){this.editing=e}isEditing(){return!0===this.editing}merge(e){this.section.content=e.content,this.initializeContent()}initializeContent(){void 0!==this.section.content&&(this.content=new s.ContentStructureWrapper(this.section.content,this.section))}isLoaded(){return!0===this.section.loaded}setLoaded(e){this.section.loaded=e}getWidth(){return this.section.width}getType(){return this.section.type}getTitle(){return this.section.title}getDescription(){return this.section.description}hasHeader(){return void 0!==this.getTitle()&&this.getTitle().length>0||void 0!==this.getDescription()&&this.getDescription().length>0}getContent(){return this.content}hasContent(){return void 0!==this.section&&void 0!==this.section.content&&void 0!==this.content}getStateIconNormal(){return this.section.state_icons.normal}hasStateIconNormal(){const e=this.section.state_icons;return void 0!==e&&void 0!==e.normal&&e.normal.length>0}getUrl(){return this.section.url}canShowMore(e){return!n.isUndefined(this.content)&&!this.content.isShowingAll()&&0===this.getCategories().length&&this.getNumRows(e)>this.maxRows}isShowMore(e){return void 0!==this.internalSections[e]&&!0===this.internalSections[e].showMore}toggleShowMore(e){const t=this.internalSections[e];t.showMore=!t.showMore}canShowRow(e,t){return this.content.isShowingAll()||e<this.maxRows||this.getCategories().length>0&&e>=this.maxRows||this.isShowMore(t)}getRows(e){if(!n.isUndefined(this.content)){const t=this.getNumRows(e);return t>0?n.range(t):void 0}}getRowEntries(e,t){const s=[],o=this.entriesPerRow[this.section.width];if(n.isUndefined(o))return void i.logService.debug(`Number of categories per row for section width ${this.section.width} is not defined !`);let r=0;for(let i=e*o;i<t.length&&r<o;i++)s.push(t[i]),r++;return s}getNumRows(e){switch(this.section.width){case 4:case 6:case 8:return Math.ceil(e.length/2);case 12:return Math.ceil(e.length/this.entriesPerRow[12]);default:return i.logService.debug(`Number of rows for section width ${this.section.width} is not defined !`),0}}getCategoryWidth(){const e=this.entriesPerRow[this.section.width];if(!n.isUndefined(e))return 12/e;i.logService.debug(`Number of categories per row for section width ${this.section.width} is not defined !`)}getCategories(){return this.categories.length=0,this.categories.push.apply(this.categories,this.filterCategories()),this.categories}getUncategorizedEntries(){return this.uncategorizedEntries.length=0,this.uncategorizedEntries.push.apply(this.uncategorizedEntries,this.filterUncategorizedEntries()),this.uncategorizedEntries}addNewCategory(e){const t=this.findLastGroupIndex();this.content.getRootEntry().addChildAt(t+1,e)}filterCategories(){return n.filter(this.content.getRootEntry().getChildren(),e=>e.isClickActionToggle())}filterUncategorizedEntries(){return n.filter(this.content.getRootEntry().getChildren(),e=>!e.isClickActionToggle())}findLastGroupIndex(){return n.findIndex(this.content.getRootEntry().getChildren(),e=>e.isClickActionToggle())}setStyleType(e){this.styleType=e,this.applyStyleChanges()}applyStyleChanges(){switch(this.styleType){case r.ColoredSectionBlock:this.entriesPerRow[12]=3}}overrideEntriesPerRow(e,t){this.entriesPerRow[e]=t}}a.internalSectionType={CATEGORIES:0,UNCATEGORIZED_ENTRIES:1},t.FloatingContentStructure=a,t.default=n.constant(a)}),define("classes/draggable/strategy/stateless_screen_strategy",["require","exports","classes/draggable/strategy/draggable_strategy","reusable_utilities","log","services/tw_common"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends i.DraggableStrategy{constructor(e,t){super(void 0,t),this.type=e,this.sideThickness=60,this.dropTarget={target:void 0,side:void 0,isSection:void 0}}startDragging(e,t){if(this.isActive()){if(this.showDropzones(t),this.attachModel(t),this.isUnsortable(e))return;this.initStartValues(e),this.addDragHandle(),this.addDraggingStyles(this.model.getTemplate()),this.move(e)}}move(e){if(this.isDragging()){this.moveDragHandle(this.dragHandle,e);const t=this.getTargetSideByPoint({x:e.clientX,y:e.clientY},this.model);void 0!==this.dropTarget.target&&(void 0===t||void 0===t.side&&this.dropTarget.target!==t.target||this.dropTarget.target!==t.target)&&this.clearDropzoneStyle(),void 0!==t?this.handleHoverModel(t.target,t.side):(void 0!==this.dropTarget.target&&this.clearDropzoneStyle(),this.dropTarget.target=void 0,this.dropTarget.side=void 0,this.dropTarget.isSection=void 0)}}stopDragging(){this.hideDropzones(),this.dragging&&(this.removeDraggingStyles(this.model.getTemplate()),this.toggleDragging(),this.removeDragHandle(),void 0!==this.dropTarget.target&&(this.clearDropzoneStyle(),0===this.model.getTemplate().parent().length&&s.logService.error("dropped item is not in the DOM",o.twCommon.logFeatures.DraggableDashboardsStrategy),this.dropItem(this.model,this.dropTarget.target,this.dropTarget.side),this.saveOrder(this.model)))}dropItem(e,t,i){s.logService.assert(void 0!==e,"droppedItem argument is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(void 0!==t,"dropTarget argument is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(e!==t,"item can't be the target of itself",o.twCommon.logFeatures.DraggableDashboardsStrategy);const n=this.getFloatingContentStructure().getCategories();_.contains(n,t)&&!_.contains(n,e)?this.canMoveToNewParent()&&this.moveToNewParent(e,t):i===o.twCommon.sides.CENTER?this.switchModels(e,t):"DROPZONE"===i?this.moveToNewParent(e,t):this.isSideZone(i)&&this.moveToNewPosition(e,t,i)}isSideZone(e){return e===o.twCommon.sides.RIGHT||e===o.twCommon.sides.LEFT}moveToNewParent(e,t){const i=this.getFloatingContentStructure().getContent().getParentEntry(e),n=i.getChildren().indexOf(e);-1===n&&s.logService.error("droppedItem "+e.getMappedId()+" not found!",o.twCommon.logFeatures.DraggableDashboardsStrategy),i.removeChildAt(n),t.addChild(e)}switchModels(e,t){const i=this.getFloatingContentStructure().getContent(),n=i.getParentEntry(e),r=n.getChildren().indexOf(e);-1===r&&s.logService.error("droppedItem "+e.getMappedId()+" not found!",o.twCommon.logFeatures.DraggableDashboardsStrategy);const a=i.getParentEntry(t),c=a.getChildren().indexOf(t);-1===c&&s.logService.error("droptarget "+t.getMappedId()+" not found!",o.twCommon.logFeatures.DraggableDashboardsStrategy),n.removeChildAt(r),n.addChildAt(r,t),a.removeChildAt(c),a.addChildAt(c,e)}moveToNewPosition(e,t,i){const n=this.getFloatingContentStructure().getContent(),r=n.getParentEntry(e),a=r.getChildren().indexOf(e);-1===a&&s.logService.error("droppedItem "+e.getMappedId()+" not found!",o.twCommon.logFeatures.DraggableDashboardsStrategy),r.removeChildAt(a);const c=n.getParentEntry(t),l=c.getChildren().indexOf(t);-1===l&&s.logService.error("droptarget "+t.getMappedId()+" not found!",o.twCommon.logFeatures.DraggableDashboardsStrategy),this.isSideBefore(i)?c.addChildAt(Math.max(0,l),e):c.addChildAt(l+1,e)}isSideBefore(e){return e===o.twCommon.sides.LEFT}getTargetSideByPoint(e,t){s.logService.assert(void 0!==e,"point argument is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(void 0!==t,"draggedItem argument is required",o.twCommon.logFeatures.DraggableDashboardsStrategy);const i=this.getFloatingContentStructure().getCategories();let n,r,a;return _.contains(i,t)?this.findTarget(e,t,i):_.contains(n=this.getFloatingContentStructure().getUncategorizedEntries(),t)?(a=this.findTarget(e,t,n),_.isUndefined(a)&&_.isUndefined(a=this.findTarget(e,t,i))?(r=this.getFloatingContentStructure().getContent().getRootEntry().getFirstSelectedEntry(),_.isUndefined(r)?void 0:this.findTarget(e,t,r.getChildren())):a):(r=this.getFloatingContentStructure().getContent().getRootEntry().getFirstSelectedEntry(),this.findTarget(e,t,r.getChildren())||this.findTarget(e,t,n)||this.findTarget(e,t,i,e=>this.getFloatingContentStructure().getContent().getRootEntry().getParentEntry(t)!==e)||this.findTargetDropzone(e,t))}setFloatingContentStructure(e){this.floatingContentStructure=e}getFloatingContentStructure(){return this.floatingContentStructure}findTarget(e,t,i,n=_.constant(!0)){for(const r of i)if(s.logService.assert(void 0!==r.getTemplate(),"target has no element reference",o.twCommon.logFeatures.DraggableDashboardsStrategy),void 0!==r.getTemplate()&&r!==t&&o.twCommon.isPointOnElement(e,r.getTemplate())&&n(r))return this.getCommonTargetSideByPoint(r,e)}handleHoverModel(e,t){s.logService.assert(void 0!==e,"target is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(void 0!==t,"side is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),this.dropTarget.target=e,this.dropTarget.side=t,this.applyDropzoneStyle()}applyDropzoneStyle(){s.logService.assert(void 0!==this.dropTarget,"dropTarget is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",o.twCommon.logFeatures.DraggableDashboardsStrategy);const e=this.getFloatingContentStructure().getCategories(),t=_.contains(e,this.dropTarget.target)&&!_.contains(e,this.model);void 0===this.dropTarget.side||"DROPZONE"===this.dropTarget.side||t?t&&!this.canMoveToNewParent()||this.dropTarget.target.getTemplate().addClass("draggable highlight-section"):this.highlightTarget(this.dropTarget.target,this.dropTarget.side)}clearDropzoneStyle(){s.logService.assert(void 0!==this.dropTarget,"dropTarget is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),s.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",o.twCommon.logFeatures.DraggableDashboardsStrategy),this.removeHighlight(),this.dropTarget.target.getTemplate().removeClass("draggable highlight-section")}addDragHandle(){this.removeDragHandle();const e=this.model.getTitle()?this.model.getTitle():"";this.dragHandle=this.getDragHandle(e),$("body").prepend(this.dragHandle)}}__decorate([n.throttle(20,{leading:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent]),__metadata("design:returntype",void 0)],r.prototype,"move",null),t.StatelessScreenStrategy=r}),define("classes/draggable/strategy/dashboards_strategy",["require","exports","underscore","classes/draggable/strategy/stateless_screen_strategy","log","services/tw_common","common_constants","other/tw"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c extends n.StatelessScreenStrategy{constructor(e){super(constants.draggable.strategy.dashboards,e)}saveOrder(){s.logService.info("Saving dashboards order...",o.twCommon.logFeatures.DraggableDashboardsStrategy);const e={root_entry:{children:[]},type:r.topic_menu.TYPE.dashboard};this.getFloatingContentStructure().getContent().getRootEntry().getChildren().forEach(t=>{const n={mapped_id:t.getMappedId()};t.hasChildren()&&i.each(t.getChildren(),e=>{i.isUndefined(n.children)&&(n.children=[]),n.children.push({mapped_id:e.getMappedId()})}),e.root_entry.children.push(n)}),a.tw.inject("topicService").saveOrder([e],!1)}canMoveToNewParent(){return!0}}t.DraggableDashboardsStrategy=c,t.default=i.constant(c)}),define("services/command_center",["require","exports","log","reusable_utilities","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","services/fullscreen","services/live_refresh","services/presentation_service","services/refresh/model_refresh_service","services/rest_form_service","services/theme","services/tw_common","services/tw_routing","reusable_utilities","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0});const v=routes.controllers.tw.TWRestForm,S=7500;class b{constructor(){this.fullscreenSetupRunning=!1}createCommandCenter(e){return p.restFormService.postMultipart(v.post("project",c.tw.project_id,"command_center_manage","new","0","rform").url,e)}updateCommandCenter(e){return p.restFormService.postMultipart(v.post("project",c.tw.project_id,"command_center_manage","update","0","rform").url,e)}updateCommandCentersOrder(e){return p.restFormService.postRForm("command_center_ordering","update",e)}removeCommandCenter(e){return p.restFormService.deleter(v.deleter("project",c.tw.project_id,"command_center_manage","remove",e.custom_page_id,"rform").url,e)}getDefaultCommandCenterSettings(){return p.restFormService.get(v.get("project",c.tw.project_id,"command_center_manage","show","","rform").url)}createScreen(e){return p.restFormService.postRForm("command_center_screen_manage","new",e)}updateScreen(e){return p.restFormService.postMultipart(v.post("project",c.tw.project_id,"command_center_screen_manage","update","0","rform").url,e)}removeScreen(e){return p.restFormService.deleter(v.deleter("project",c.tw.project_id,"command_center_screen_manage","remove",e.custom_page_id,"rform").url,e)}getCommandCenterScreenInfo(){return p.restFormService.get(v.get("project",c.tw.project_id,"command_center_screen_manage","info",0,"rform").url)}addWidgetsToScreen(e){return p.restFormService.postRForm("command_center_screen_widgets","add",e)}updateWidgets(e){return p.restFormService.postRForm("command_center_screen_widgets","update",e)}removeWidget(e){return p.restFormService.deleter(v.deleter("project",c.tw.project_id,"command_center_screen_widgets","remove",e.widget_id,"rform").url,e)}cloneWidget(e){return p.restFormService.postRForm("command_center_screen_widgets","copy",e)}unstack(e){return e.dics.forEach(e=>delete e.slot_configuration.grid_z),p.restFormService.postRForm("command_center_screen_widgets","split",e)}async enterFullscreenMode(e,t){const i=e?decodeURIComponent(window.location.href):void 0,s=new n.CancellationToken;s.addCleanupFunction(async()=>{await this.onExitFullscreen(i)}),l.fullscreenService.onEnter.subscribeOnce(async()=>{await this.onEnterFullscreen(s,e,t)}),l.fullscreenService.onExit.subscribeOnce(()=>{s.cancel()}),y.applicationMode.getCurrentAppMode()!==y.AppMode.SHARED_COMMAND_CENTER&&await l.fullscreenService.goFullscreen(void 0,!1)}async enterPresentationMode(){await g.presentationService.enterPresentationMode({actions:{},conditions:{},style:{hideNotifications:!0}})}async getLastUpdateTimestamp(){return c.tw.pageState?y.applicationMode.getCurrentAppMode()===y.AppMode.SHARED_COMMAND_CENTER?(await p.restFormService.get(window.validateUrl)).last_updated_timestamp:(await p.restFormService.getRForm("command_center_screen_manage","validate",c.tw.pageState.getAllowedPages().getCustomPageId())).last_updated_timestamp:Promise.resolve(-1)}async onEnterFullscreen(e,t,i){try{this.fullscreenSetupRunning=!0,i&&await f.PromiseUtils.cancellationPromise(h.themeService.changeTheme(i),e),t?(await f.PromiseUtils.cancellationPromise(_.twRoutingService.changePageByUrl(t),e),await f.PromiseUtils.cancellationPromise(new Promise((e,t)=>{_.twRoutingService.onPageBuilt.subscribeOnce(async()=>{await this.enterPresentationMode(),e()})}),e)):y.applicationMode.getCurrentAppMode()!==y.AppMode.SHARED_COMMAND_CENTER&&await f.PromiseUtils.cancellationPromise(this.enterPresentationMode(),e),this.refreshCheckToken=new n.CancellationToken,this.currentStateTimestamp=await f.PromiseUtils.cancellationPromise(this.getLastUpdateTimestamp(),e);const s=this.startUpdatePolling();this.refreshCheckToken.registerCleanupFunction(()=>{clearInterval(s)})}catch(e){if(!e.isCancelled)throw e}finally{this.fullscreenSetupRunning=!1}}async onExitFullscreen(e){await n.promiseTimeout(new Promise(async e=>{for(;this.fullscreenSetupRunning;)await n.waitFor(100);e()}),1e3,"Fullscreen setup was never finished");try{await g.presentationService.exitPresentationMode()}catch(e){i.logService.info(e)}this.refreshCheckToken&&this.refreshCheckToken.cancel(),await h.themeService.changeTheme(h.themeService.getDefaultTheme()),s.mainApplication.hasPageState()&&s.mainApplication.getPageState().getAllowedPages().isCommandCenterScreen()&&!e?(s.mainApplication.getPageState().setEditMode(!0),await this.refreshPageData("Error when refreshing page state when exiting fullscreen !")):e&&_.twRoutingService.changePageByUrl(e)}isUpdateTimestampInitialized(){return-1!==this.currentStateTimestamp}startUpdatePolling(){return setInterval(async()=>{const e=await this.getLastUpdateTimestamp();if(!this.isUpdateTimestampInitialized())return i.logService.debug("Pagestate was not available when we requested last TS, ignoring update for now...",m.twCommon.logFeatures.CommandCenter),void(this.currentStateTimestamp=e);if(e>this.currentStateTimestamp&&!this.refreshCheckToken.isCanceled()){i.logService.debug("Newer ts detected, refreshing",m.twCommon.logFeatures.CommandCenter,{ts:e,currentTs:this.currentStateTimestamp}),this.currentStateTimestamp=e,d.liveRefreshService.pause(),this.refreshPageData("Error when refreshing page state during polling !").then(e=>{e.getWidgets().forEach(e=>e.onLayoutChange.fire()),d.liveRefreshService.resume()})}},S)}async refreshPageData(e){const t={strategy:r.ModelRefreshStrategy.REFRESH},n=o.modelRefreshDecoratorFactory.getDecorator(s.mainApplication.getPageState(),s.mainApplication,a.ModelType.PAGE_STATE,t);try{return await u.modelRefreshService.refresh(n,t)}catch(t){t instanceof Error&&i.logService.error(e,void 0,t)}}}t.default=b,t.commandCenterService=new b}),define("classes/draggable/strategy/draggable_command_center_screens_strategy",["require","exports","classes/draggable/strategy/stateless_screen_strategy","services/tw_common","services/command_center"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.DraggableCommandCenterScreensStrategy=class extends i.StatelessScreenStrategy{constructor(e){super(constants.draggable.strategy.command_center_screens,e)}isSideZone(e){return e===n.twCommon.sides.TOP||e===n.twCommon.sides.BOTTOM}isSideBefore(e){return e===n.twCommon.sides.TOP}saveOrder(e){const t=this.getFloatingContentStructure().getContent().getParentEntry(e).getChildren().map(e=>e.getMappedId());s.commandCenterService.updateCommandCentersOrder({screens:t})}canMoveToNewParent(){return!1}}}),define("classes/draggable/strategy/draggable_command_centers_strategy",["require","exports","classes/draggable/strategy/stateless_screen_strategy","services/command_center"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.DraggableCommandCentersStrategy=class extends i.StatelessScreenStrategy{constructor(e){super(constants.draggable.strategy.command_centers,e)}saveOrder(){const e=this.getFloatingContentStructure().getContent().getRootEntry().getChildren().map(e=>e.getMappedId());n.commandCenterService.updateCommandCentersOrder({command_centers:e})}canMoveToNewParent(){return!1}}}),define("classes/draggable/strategy/group_select_strategy",["require","exports","jquery","underscore","services/context","reusable_utilities","classes/draggable/strategy/draggable_strategy","services/tw_common","services/rest_form_service","log"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});class d extends r.DraggableStrategy{constructor(e,t){super(void 0,t),this._topicMenu=e,this.type=constants.draggable.strategy.group_select_items,this.sideThickness=60,this.dropTarget={target:void 0,side:void 0}}startDragging(e,t){if(this.active){if(this.attachModel(t),this.isUnsortable(e))return!0;this.initStartValues(e),this.addDragHandle(),this.addDraggingStyles(this.model.element),this.move(e)}return!1}move(e){if(this.dragging){this.moveDragHandle(this.dragHandle,e);const t=this._getTargetSideByPoint({x:e.clientX,y:e.clientY},this.model);void 0!==this.dropTarget.target&&(void 0===t||void 0===t.side&&this.dropTarget.target!==t.target||t.side!==this.dropTarget.side&&this.dropTarget.target!==t.target)&&this.clearDropzoneStyle(),void 0!==t?this._handleHoverModel(t.target,t.side):(void 0!==this.dropTarget.target&&this.clearDropzoneStyle(),this.dropTarget.target=void 0,this.dropTarget.side=void 0,this.dropTarget.isSection=void 0)}}stopDragging(){if(this.dragging&&(this.removeDraggingStyles(this.model.element),this.toggleDragging(),this.removeDragHandle(),void 0!==this.dropTarget.target)){this.clearDropzoneStyle(),0===this.model.element.parent().length&&l.logService.error("dropped item is not in the DOM",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy);const e=this.model.getParent();this._dropItem(this.model,this.dropTarget.target,this.dropTarget.side),this._saveTagMoving(this.model,this.dropTarget.target,e)}}applyDropzoneStyle(){l.logService.assert(void 0!==this.dropTarget,"dropTarget is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),void 0===this.dropTarget.side?this.dropTarget.target.element.addClass("draggable highlight-section"):this.highlightTarget(this.dropTarget.target,this.dropTarget.side)}clearDropzoneStyle(){l.logService.assert(void 0!==this.dropTarget,"dropTarget is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),this.removeHighlight(),this.dropTarget.target.element.removeClass("draggable highlight-section")}addDragHandle(){this.removeDragHandle();const e=this.model.getName()?this.model.getName():"";this.dragHandle=this.getDragHandle(e,"group-select-items"),i("body").prepend(this.dragHandle)}_handleHoverModel(e,t){l.logService.assert(void 0!==e,"target is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(void 0!==t,"side is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),this.dropTarget.target=e,this.dropTarget.side=t,this.applyDropzoneStyle()}_dropItem(e,t,i){l.logService.assert(void 0!==e,"droppedItem argument is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(void 0!==t,"dropTarget argument is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(e!==t,"item can't be the target of itself",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),i===a.twCommon.sides.CENTER&&this._switchModels(e,t)}_switchModels(e,t){this._getTopicMenu().removeEntry(e),t.addChild(e),t.getChildren().sort(function(e,t){const i=e.getName().toLowerCase(),n=t.getName().toLowerCase();return i>n?1:i<n?-1:0})}_getTargetSideByPoint(e,t){l.logService.assert(void 0!==e,"point argument is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),l.logService.assert(void 0!==t,"draggedItem argument is required",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy);for(let i=0;i<this._getGroups().length;i++){const n=this._getGroups()[i];if(l.logService.assert(n.element,"target has no element reference",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy),a.twCommon.isPointOnElement(e,n.element)&&n!==t.getParent())return this.getCommonTargetSideByPoint(n,e)}}_saveTagMoving(e,t,i){l.logService.info("Saving tags order...",a.twCommon.logFeatures.DraggableGroupSelectItemsStrategy);const o=this,r=routes.controllers.tw.TWRestForm.post(s.contextService.getCurrentContext().scope,s.contextService.getCurrentContext().id,"tag_management","move","","rform").url,d={};d.tag={code:e.getMappedId(),name:e.getName(),parent:{code:t.getMappedId(),name:t.getName()}},c.restFormService.post(r,d).then(n.noop,function(){o._switchModels(e,i)})}_getTopicMenu(){return this._topicMenu}_getGroups(){const e=this._getTopicMenu().getEntryByMappedId("predefined").getChildren()[0],t=this._getTopicMenu().getEntryByMappedId("custom"),i=[];return i.push.apply(i,e.getChildren()),i.push.apply(i,t.getChildren()),i}}__decorate([o.throttle(20,{leading:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],d.prototype,"move",null),t.DraggableGroupSelectItemsStrategy=d}),define("classes/draggable/strategy/widgets_strategy",["require","exports","jquery","underscore","log","classes/draggable/strategy/draggable_strategy","classes/application/application","reusable_utilities","services/tw_common"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends o.DraggableStrategy{constructor(e,t,i){super(e,i),this.beforeSortCallback=t,this.type=constants.draggable.strategy.widgets,this.dropTarget={target:void 0,side:void 0}}startDragging(e,t){if(this.active){if(this.attachModel(t),r.mainApplication.getPageState().isLayoutBeingEdited())return;if(this.isUnsortable(e))return!0;this.initStartValues(e),this.addDragHandle(),this.addDraggingStyles(this.model.element),this.move(e)}return!1}move(e){if(this.dragging){this.moveDragHandle(this.dragHandle,e);const t=this._getTargetSideByPoint({x:e.clientX,y:e.clientY},this.model);void 0!==this.dropTarget.target&&(void 0===t||void 0===t.side&&this.dropTarget.target!==t.target||t.side!==this.dropTarget.side&&this.dropTarget.target!==t.target)&&this.clearDropzoneStyle(),void 0!==t&&t.isSection?this._handleHoverSection(t.target):void 0!==t?this._handleHoverWidget(t.target,t.side):(void 0!==this.dropTarget.target&&this.clearDropzoneStyle(),this.dropTarget.target=void 0,this.dropTarget.side=void 0,this.dropTarget.isSection=void 0)}}stopDragging(){if(this.dragging&&(this.removeDraggingStyles(this.model.element),this.toggleDragging(),this.removeDragHandle(),void 0!==this.dropTarget.target&&(!this.dropTarget.target.getDropZoneConfiguration||this.dropTarget.target.getDropZoneConfiguration().length>0))){if(this.clearDropzoneStyle(),0===this.model.element.parent().length&&s.logService.error("dropped item is not in the DOM",c.twCommon.logFeatures.DraggableWidgetsStrategy),!1===this.beforeSortCallback(this.model,this.dropTarget.target,this.dropTarget.side))return;r.mainApplication.getPageState().beginEditingPageLayout(),this._dropItem(this.model,this.dropTarget.target,this.dropTarget.side),r.mainApplication.getPageState().endEditingPageLayout(),this.sortCallback(void 0,void 0,void 0)}}applyDropzoneStyle(){s.logService.assert(void 0!==this.dropTarget,"dropTarget is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),void 0===this.dropTarget.side?this.dropTarget.target.element.addClass("draggable highlight-section"):this.highlightTarget(this.dropTarget.target,this.dropTarget.side)}clearDropzoneStyle(){s.logService.assert(void 0!==this.dropTarget,"dropTarget is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==this.dropTarget.target,"dropTarget target is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),this.removeHighlight(),this.dropTarget.target.element.removeClass("draggable highlight-section")}addDragHandle(){this.removeDragHandle();const e=this.model.getTitle()?this.model.getTitle():"";this.dragHandle=this.getDragHandle(e),i("body").prepend(this.dragHandle)}_handleHoverWidget(e,t){s.logService.assert(void 0!==e,"target is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"side is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),this.dropTarget.target=e,this.dropTarget.isSection=!1,this.dropTarget.side=t,this.applyDropzoneStyle()}_handleHoverSection(e){s.logService.assert(void 0!==e,"target is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),this.dropTarget.target=e,this.dropTarget.isSection=!0,this.dropTarget.side=void 0,this.applyDropzoneStyle()}_dropItem(e,t,i){s.logService.assert(void 0!==e,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"dropTarget argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(e!==t,"item can't be the target of itself",c.twCommon.logFeatures.DraggableWidgetsStrategy);const n=e.getSection();if(void 0===i)n.removeWidget(e),t.isEmpty()?t.addWidget(e):this._addWidgetToSection(t,e,t.getLastWidget(),c.twCommon.sides.RIGHT);else{const s=t.getSection();i===c.twCommon.sides.CENTER?this._replaceWidget(n,s,e,t):i===c.twCommon.sides.BOTTOM||i===c.twCommon.sides.TOP?(n.removeWidget(e),this._pushToNewSection(s,t,i,e)):(n.removeWidget(e),this._addWidgetToSection(s,e,t,i))}n.isEmpty()&&r.mainApplication.getPageState().deleteSection(n,!1)}_calculateImpactedWidgets(e,t,i,n){s.logService.assert(void 0!==e,"dropTargetSection argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"dropTarget argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy);const o=[t];if(t.getWidth()<i.getWidth()&&(i.requestSizeChange(t.getWidth()),t.getWidth()<i.getWidth())){let r=i.getWidth()-t.getWidth();const a=e.getWidgets().indexOf(t);let l;for(s.logService.assert(-1!==a,"something went wrong, target widget is not part of target section",c.twCommon.logFeatures.DraggableWidgetsStrategy),l=a+1;l<e.getWidgets().length&&(r-=e.getWidgets()[l].getWidth(),o.push(e.getWidgets()[l]),!(r<=0));l++);if(!n)for(l=a-1;l>=0&&(r-=e.getWidgets()[l].getWidth(),o.push(e.getWidgets()[l]),!(r<=0));l--);}return o}_addWidgetToSectionWithOverflow(e,t,i,n){let o;if(s.logService.assert(void 0!==e,"targetSection argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"widget argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==n,"side argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),n===c.twCommon.sides.RIGHT?o=e.getRightNeighbour(i):n!==c.twCommon.sides.LEFT&&s.logService.error("this method is not meant to be used for other directions than left or right",c.twCommon.logFeatures.DraggableWidgetsStrategy),void 0===o&&n===c.twCommon.sides.LEFT&&(o=i),void 0!==o&&this._pushToNewSection(e,o,c.twCommon.sides.TOP,t,!0),void 0===o&&n===c.twCommon.sides.RIGHT){const i=this._createAdjacentSection(e,c.twCommon.sides.BOTTOM);i.addWidget(t),i.repartitionSpace()}}_createAdjacentSection(e,t){s.logService.assert(void 0!==e,"sourceSection argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"side argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy);const i=r.mainApplication.getPageState()._createSection(!0);return t===c.twCommon.sides.BOTTOM?r.mainApplication.getPageState().insertSectionBelow(e,i):r.mainApplication.getPageState().insertSectionAbove(e,i),i}_pushToNewSection(e,t,i,o,r){let a;if(s.logService.assert(void 0!==e,"dropTargetSection argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"dropTarget argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"side argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==o,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),!e.isSortable())return void(a=this._createAdjacentSection(e,i)).addWidget(o);const l=this._calculateImpactedWidgets(e,t,o,r);let d=0;n.each(l,function(e){d+=e.getWidth()});let g=!1;d+e.getRemainingWidth()<o.getWidth()&&!r&&s.logService.error("this should never happen: not enough space to drop widget from top",c.twCommon.logFeatures.DraggableWidgetsStrategy),d+e.getRemainingWidth()<o.getWidth()&&r&&(g=!0),a=i===c.twCommon.sides.TOP?this._createAdjacentSection(e,c.twCommon.sides.BOTTOM):this._createAdjacentSection(e,c.twCommon.sides.TOP),g||e.addWidget(o,t,c.twCommon.sides.LEFT,!0),n.each(l,function(t){e.removeWidget(t),a.addWidget(t)}),g&&(o.setSectionId(a.getId()),this._addWidgetToSection(a,o,a.getWidgets()[0],c.twCommon.sides.LEFT)),e.repartitionSpace(),a.repartitionSpace()}_replaceWidget(e,t,i,o){s.logService.assert(void 0!==t,"targetSection  argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==e,"sourceSection argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==o,"dropTarget  argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(i!==o,"item can't be the target of itself",c.twCommon.logFeatures.DraggableWidgetsStrategy);const r=i.getWidth();i.requestSizeChange(o.getWidth()),o.requestSizeChange(r);const a=n.indexOf(e.getWidgets(),i),l=n.indexOf(t.getWidgets(),o);if(e===t){if(e.swapWidgets(a,l),e.getRemainingWidth()<0){const t=e.getLastWidget();e.removeWidget(t),this._addWidgetToSectionWithOverflow(e,t,e.getLastWidget(),c.twCommon.sides.RIGHT)}}else s.logService.assert(a<e.getWidgets().length," unexpected error: indexA out of bounds "+a+" "+e.getWidgets().length,c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(l<t.getWidgets().length," unexpected error: indexB out of bounds "+l+" "+t.getWidgets().length,c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(-1!==a,"widget "+i.getId()+" not found in section"+e.getId(),c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(-1!==l,"widget "+o.getId()+" not found in section"+t.getId(),c.twCommon.logFeatures.DraggableWidgetsStrategy),e.removeWidget(i),t.removeWidget(o),this._addWidgetToSectionByIndex(t,i,l),this._addWidgetToSectionByIndex(e,o,a)}_addWidgetToSectionByIndex(e,t,i){s.logService.assert(void 0!==e,"targetSection  argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"index argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),0===i?e.isEmpty()?e.addWidget(t):(s.logService.assert(void 0!==e.getWidgets()[0],"reference widget not found",c.twCommon.logFeatures.DraggableWidgetsStrategy),this._addWidgetToSection(e,t,e.getWidgets()[0],c.twCommon.sides.LEFT)):(s.logService.assert(void 0!==e.getWidgets()[i-1],"reference widget not found",c.twCommon.logFeatures.DraggableWidgetsStrategy),this._addWidgetToSection(e,t,e.getWidgets()[i-1],c.twCommon.sides.RIGHT))}_addWidgetToSection(e,t,i,n){if(s.logService.assert(void 0!==e,"targetSection  argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"droppedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==i,"dropTarget argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==n,"side argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),e.canAddWidget(t))e.addWidget(t,i,n);else{i.requestSizeChange(i.getWidth()-t.getWidth()+e.getRemainingWidth()),e.canAddWidget(t)||t.requestSizeChange(e.getRemainingWidth());for(let s=0;s<e.getWidgets().length;s++){if(e.canAddWidget(t))return void e.addWidget(t,i,n);e.getWidgets()[s].requestSizeChange(e.getRemainingWidth()-t.getWidth())}e.canAddWidget(t)?e.addWidget(t,i,n):this._addWidgetToSectionWithOverflow(e,t,i,n)}}_getTargetSideByPoint(e,t){s.logService.assert(void 0!==e,"point argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy),s.logService.assert(void 0!==t,"draggedItem argument is required",c.twCommon.logFeatures.DraggableWidgetsStrategy);for(let i=0;i<r.mainApplication.getPageState().getSections().length;i++){for(let n=0;n<r.mainApplication.getPageState().getSections()[i].getWidgets().length;n++){const o=r.mainApplication.getPageState().getSections()[i].getWidgets()[n];if(s.logService.assert(o.element,"target has no element reference",c.twCommon.logFeatures.DraggableWidgetsStrategy),void 0!==o.element&&o!==t&&c.twCommon.isPointOnElement(e,o.element))return this.getCommonTargetSideByPoint(o,e)}if(r.mainApplication.getPageState().getSections()[i].isSortable()&&c.twCommon.isPointOnElement(e,r.mainApplication.getPageState().getSections()[i].element))return{target:r.mainApplication.getPageState().getSections()[i],isSection:!0}}}}__decorate([a.throttle(20,{leading:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],l.prototype,"move",null),t.DraggableWidgetsStrategy=l}),define("classes/grid/grid_expansion_point",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.GridExpansionPoint=class{constructor(e){}}}),define("classes/help_choice/help_choice_option",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONTACT=0]="CONTACT",e[e.HELP_PAGE=1]="HELP_PAGE"}(t.HelpChoiceOption||(t.HelpChoiceOption={}))}),define("components/tools/results",["require","exports","underscore","log"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s=n.logService;function o(){}o.constructor.formatWithUnit=function(e,t,n,o){s.warn("formatWithUnit is deprecated. Use the number formatter instead!");const r=["","K","M","G","T"];let a=(e=+e)<0?-1:1,c=Math.abs(e),l=0;for(o=i.isUndefined(o)?-1:o;c>=1e3&&l<r.length-1&&0!==o;)c/=1e3,l++,o--;return t=i.isUndefined(t)?1:t,(n=!!i.isUndefined(n)||n)?parseFloat(c.toFixed(t))*a+r[l]:(c*a).toFixed(t)+r[l]},o.constructor.getAxisFormatter=function(e,t){let n;if(i.isUndefined(t)||0===t)n=function(e){return o.constructor.formatWithUnit(e)};else{let i=(e-t).toString().length;i=Math.pow(10,i);let s=0;for(;i>1e3;)s++,i/=1e3;n=function(e){return o.constructor.formatWithUnit(e,1,!0,s)}}return n},o.constructor.getValueChange=function(e,t){if(s.warn("getValueChange is deprecated. Use the Tendency class instead!"),i.isUndefined(e))return new o.constructor.ValueChange(!1);let n;if(0===(e=+e)&&0===t)n=0;else{if(0===e)return new o.constructor.ValueChange(!0,!1,t>0?1:-1);n=(t-e)/e*100}return o.constructor.ValueChange(!0,!0,n)},o.constructor.ValueChange=function(e,t,i){s.warn("ValueChange is deprecated. Use the Tendency class instead!");const n={is_available:e};return e&&(n.is_old_value_zero=!t,t?(n.value=parseFloat(i.toFixed(1)),n.is_positive=n.value>0,n.is_negative=n.value<0,n.value_raw=i,n.sign=n.is_positive?"+":n.is_negative?"-":"",n.value_abs=parseFloat(Math.abs(n.value).toFixed(1)),n.value_abs_formatted=o.constructor.formatWithUnit(n.value_abs),n.postfix="%",n.value_all_formatted=n.sign+n.value_abs_formatted+n.postfix):(n.is_positive=i>0,n.is_negative=i<0)),n},o.constructor.roundUpPower=function(e){let t=1;for(;e>t;)t*=10;return t},o.constructor.getAllFilters=function(e,t){let n=[];return i.each(t,function(t){n=i.union(n,e.getRowFilters(t.rowIdx)),n=i.union(n,e.getColumnFilters(t.cellIdx))}),n},t.default=o}),define("classes/influencer/profile/influencer_profile",["require","exports","underscore","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s=n.twCommon;t.default=["logService","twNumberFormatter",function(e,t){function n(t,i){e.assertDefined(t,s.logFeatures.InfluencerProfile),this._influencerPayload=t,this._influencerConfig=i,this._initialize()}return n.prototype={getId:function(){return this._influencerPayload.id},hasNameObject:function(){return!i.isUndefined(this._influencerPayload.name)},getNameObject:function(){return this._influencerPayload.name},hasNameUrl:function(){return!i.isUndefined(this.getNameObject().url)},getNameUrl:function(){return this.hasNameUrl()?this.getNameObject().url:void 0},hasNameValue:function(){return!i.isUndefined(this.getNameObject().value)},getNameValue:function(){return this.hasNameValue()?this.getNameObject().value:void 0},hasShortNameObject:function(){return!i.isUndefined(this._influencerPayload.short_name)},getShortNameObject:function(){return this.hasShortNameObject()?this._influencerPayload.short_name:void 0},hasShortNameUrl:function(){return this.hasShortNameObject()&&!i.isUndefined(this.getShortNameObject().url)},getShortNameUrl:function(){return this.hasShortNameUrl()?this.getShortNameObject().url:void 0},hasShortNameValue:function(){return this.hasShortNameObject()&&!i.isUndefined(this.getShortNameObject().value)},getShortNameValue:function(){return this.hasShortNameValue()?this.getShortNameObject().value:void 0},hasImageObject:function(){return!i.isUndefined(this.getImageObject())},getImageObject:function(){return this._influencerPayload.image},getImageValue:function(){return this.hasImageObject()?this.getImageObject().value:void 0},hasDescriptions:function(){return!i.isUndefined(this._influencerPayload.description)&&this._influencerPayload.description.length>0},getSourceObject:function(){return this._influencerPayload.source},hasSourceObject:function(){return!i.isUndefined(this.getSourceObject())},hasSourceUrl:function(){return this.hasSourceObject()&&!i.isUndefined(this.getSourceObject().url)},getSourceUrl:function(){return this.hasSourceUrl()?this.getSourceObject().url:void 0},hasSourceValue:function(){return this.hasSourceObject()&&!i.isUndefined(this.getSourceObject().value)},getSourceValue:function(){return this.hasSourceValue()?this.getSourceObject().value:void 0},getDescriptions:function(){return this._influencerPayload.description},hasStats:function(){return!i.isUndefined(this._influencerPayload.stats)&&this._influencerPayload.stats.length>0},getStats:function(){return this._influencerPayload.stats},isVerified:function(){return!1!==this._influencerPayload.verified},isLoaded:function(){return!0===this._loaded},setLoaded:function(e){this._loaded=e},getFilters:function(){return this._influencerPayload.filter},getRequestedPageType:function(){return this._influencerPayload.requested_page_type},isMostActiveAuthor:function(){return this.hasInfluencerConfig()&&this.getInfluencerConfig().show_enum===constants.show_enum.author&&this.getInfluencerConfig().top_function===constants.search_data_functions.nb_post_total},isMostInfluentialAuthor:function(){return this.hasInfluencerConfig()&&this.getInfluencerConfig().show_enum===constants.show_enum.author&&this.getInfluencerConfig().top_function===constants.search_data_functions.engagement_author},isMostActiveSite:function(){return this.hasInfluencerConfig()&&this.getInfluencerConfig().show_enum===constants.show_enum.source&&this.getInfluencerConfig().top_function===constants.search_data_functions.nb_post_total},isMostInfluentialSite:function(){return this.hasInfluencerConfig()&&this.getInfluencerConfig().show_enum===constants.show_enum.source&&this.getInfluencerConfig().top_function===constants.search_data_functions.engagement_author},hasInfluencerConfig:function(){return!i.isUndefined(this._influencerConfig)},getInfluencerConfig:function(){return this._influencerConfig},isClickable:function(){return!0===this._influencerPayload.clickable},_initialize:function(){let e;if(this.hasImageObject()&&this.getImageValue()&&(this._influencerPayload.image.value=this._influencerPayload.image.value.replace("_normal","_400x400")),this.hasStats())for(e=0;e<this.getStats().length;e++){const t=this.getStats()[e];t.value=isNaN(t.value)?t.value:this._formatCellValue(t.value)}if(this.hasDescriptions())for(e=0;e<this.getDescriptions().length;e++){const t=this.getDescriptions()[e];t.value=isNaN(t.value)?t.value:this._formatCellValue(t.value)}},_formatCellValue:function(e){const n=i.isNumber(e)?e:parseInt(e);return i.isFinite(n)?t.getInstance().toDecimal(n):n}},n}]}),define("classes/report_actions/report_creation_menu_options_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/report_actions/report_creation_menu_factory",["require","exports","wrappers/topic_menu/topic_menu_wrapper","classes/context_data/context_data","react_components/menu/topic_menu_select_component_strategies/report_widget_additions_menu_strategy","reusable_utilities","classes/dashboard_actions/dashboard_action_restrictions"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.ReportCreationMenuFactory=class{static buildReportOptionsMenuProps(){return{reportOptionsMenu:new i.TopicMenuWrapper({root_entry:{selection_type:"SINGLE",children:this.buildAddToReportEntryChildren()}}),reportOptionsStyleModel:o.TopicMenuSelectStyleUtils.buildButtonStyleModel("icon2-tw-report-add"),reportOptionsStrategy:new s.ReportWidgetAdditionsMenuStrategy}}static buildAddToReportEntryChildren(){const e=[];return r.DashboardActionRestrictions.canCreateNewReport()&&e.push({name:n.contextData.getMessage("_589171"),mapped_id:s.ReportWidgetAdditionsType.NEW_REPORT}),r.DashboardActionRestrictions.canAddToExistingReport()&&e.push({name:n.contextData.getMessage("_1862094"),mapped_id:s.ReportWidgetAdditionsType.EXISTING_REPORT}),e}}}),define("classes/restform_click_action/restform_click_action_default_handler",["require","exports","event_bus","event","services/rest_form_service","services/confirmation_service"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.RestformClickActionDefaultHandler=class{constructor(e){this.options=e,this.options.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.POST_CALL_RESTFORM_CLICK_ACTION,this.handlePostCall.bind(this)),this.options.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.GET_CALL_RESTFORM_CLICK_ACTION,this.handleGetCall.bind(this)),this.options.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.DELETE_CALL_RESTFORM_CLICK_ACTION,this.handleDeleteCall.bind(this))}async handlePostCall(e){this.prePostCallEvent.fire(e);const{action_url:t,post_data:i}=e.value.action_payload,n=await s.restFormService.post(t,i||void 0);this.postPostCallEvent.fire(e,n)}async handleGetCall(e){this.preGetCallEvent.fire(e);const t=await s.restFormService.get(e.value.action_payload.action_url);this.postGetCallEvent.fire(e,t)}async handleDeleteCall(e){this.options.widgetId===e.value.widget_id&&(this.preDeleteCallEvent.fire(e),await o.confirmationService.display({message:e.value.confirmation_message}).then(async()=>{const t=await s.restFormService.deleter(e.value.action_payload.action_url);this.postDeleteCallEvent.fire(e,t)}))}get prePostCallEvent(){return void 0===this.internalPrePostCallEvent&&(this.internalPrePostCallEvent=new n.Event),this.internalPrePostCallEvent}get preGetCallEvent(){return void 0===this.internalPreGetCallEvent&&(this.internalPreGetCallEvent=new n.Event),this.internalPreGetCallEvent}get preDeleteCallEvent(){return void 0===this.internalPreDeleteCallEvent&&(this.internalPreDeleteCallEvent=new n.Event),this.internalPreDeleteCallEvent}get postPostCallEvent(){return void 0===this.internalPostPostCallEvent&&(this.internalPostPostCallEvent=new n.Event),this.internalPostPostCallEvent}get postGetCallEvent(){return void 0===this.internalPostGetCallEvent&&(this.internalPostGetCallEvent=new n.Event),this.internalPostGetCallEvent}get postDeleteCallEvent(){return void 0===this.internalPostDeleteCallEvent&&(this.internalPostDeleteCallEvent=new n.Event),this.internalPostDeleteCallEvent}}}),define("classes/widget/blueprint_utilities",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.BlueprintUtilities=class{static hasFragment(e,t){return void 0!==_.find(_.values(e.layout),e=>_.find(e,e=>e===t))}}}),define("classes/widget/fragment_bases/abstract_directive_fragment",["require","exports","widget_base","services/directive","jquery","log","services/tw_common"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDirectiveFragment=class{constructor(e){this.model=e}initialize(e,t,i,a){const c=document.createElement("div");return e.appendChild(c),this.cancellationToken=a,new Promise((a,l)=>{this.drawSettings=i,this.model.widget.onDispose.subscribeOnce(()=>this.dispose()),o.logService.debug(`Initializing directive fragment ${this.directiveData.selector}`,r.twCommon.logFeatures.WidgetInitializer,{fragment:this,chartContainer:e,mediator:t,settings:i});const d=n.directiveService.inject(s(c),this.directiveData.selector,_.assign({mediator:t},this.directiveData.args),void 0,!0);void 0!==d.template?this.postInject(e,t,i,c,d.parentScope,d.template,a,l):d.then(n=>{this.postInject(e,t,i,c,n.parentScope,n.template,a,l)})})}applyFontClasses(){return!1}update(e){return this.model=e,o.logService.debug("Updating widget fragment",r.twCommon.logFeatures.WidgetInitializer,{fragment:this,model:e}),Promise.resolve(this)}draw(e){return this.drawSettings=e,e.heightMode!==i.WidgetHeightMode.LEGACY?(this.template.css({position:"absolute",top:e.dimensions.y,left:e.dimensions.x,width:"inherit"}),e.heightMode===i.WidgetHeightMode.FULLSCREEN&&this.template.css({width:"inherit"})):this.template.css({"min-height":e.dimensions.height,display:"block"}),o.logService.debug("Calling draw in widget fragment",r.twCommon.logFeatures.WidgetInitializer,{fragment:this,settings:e}),Promise.resolve(this)}dispose(){this.scope&&this.scope.$destroy(),this.template&&this.template.remove()}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:e.dimensions.height||0}}getDrawSettings(){return this.drawSettings}postInject(e,t,n,a,c,l,d,g){o.logService.debug(`Directive injected ${this.directiveData.selector}`,r.twCommon.logFeatures.WidgetInitializer,{fragment:this,chartContainer:e,mediator:t,settings:n}),this.scope=c,this.template=l;const u=this.scope.$watch(()=>l.children().length,e=>{if(e>0)if(u(),this.model.widget.isDisposed())this.dispose(),g(this);else{if(s(a.children[0]).unwrap(),this.applyFontClasses())switch(n.style.fontSize){case i.FontSize.SMALL:break;case i.FontSize.MEDIUM:this.template.children().first().addClass("fontsize-medium");break;case i.FontSize.LARGE:this.template.children().first().addClass("fontsize-large");break;default:throw new Error("unknown font size")}d(this)}})}}}),define("classes/widget/fragments/directive/bottom_widget_menus_fragment",["require","exports","classes/widget/fragment_bases/abstract_directive_fragment","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.BottomWidgetMenusFragment=class extends i.AbstractDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:1,minHeight:36,minWidth:0}],e=>this.getDimensionsForLayout(e))}get directiveData(){return{selector:"tw-widget-menus-bottom",args:{widget:this.model.widget}}}}}),define("classes/widget/fragments/directive/no_data_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.NoDataFragment=class extends n.AbstractDirectiveFragment{constructor(e){super(e)}get directiveData(){return{selector:"no-data",args:{widget:this.model.widget}}}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:100,minWidth:0}],e=>this.getDimensionsForLayout(e))}}}),define("classes/widget/fragments/directive/result_count_fragment",["require","exports","classes/widget/fragment_bases/abstract_directive_fragment","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ResultCountFragment=class extends i.AbstractDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:1,minHeight:30,minWidth:0}],e=>this.getDimensionsForLayout(e))}applyFontClasses(){return!0}get directiveData(){return{selector:"tw-result-count",args:{widget:this.model.widget}}}}}),define("classes/widget/fragments/directive/top_widget_menus_fragment",["require","exports","classes/widget/fragment_bases/abstract_directive_fragment","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TopWidgetMenusFragment=class extends i.AbstractDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:1,minHeight:48,minWidth:0}],e=>this.getDimensionsForLayout(e))}get directiveData(){return{selector:"tw-widget-menus-top",args:{widget:this.model.widget}}}}}),define("classes/widget/widget_fragment_factory/default_build_configurations",["require","exports","map","canvas_chart_utilities","classes/context_data/context_data"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultBuildConfigurations=new i.ExtendableMap,t.defaultBuildConfigurations.set(n.LegendFragment,{axis:n.LegendDataAxisType.BY_ROW,iconType:n.LegendItemIconType.CIRCLE,legendType:void 0,enableItemSelection:!1,enableItemHover:!1,dotted:!1,numColumns:void 0,itemFilter:()=>!0,colorFactory:(e,t)=>e.getTwColor(),legendRangeFormatter:(e,t)=>[...e],tryTabularFirst:!1,sentimentColors:{positive:s.contextData.sentimentColors.positive,negative:s.contextData.sentimentColors.negative}})}),define("classes/widget/widget_fragment_factory/widget_fragment_draw_style_factory",["require","exports","canvas_chart_utilities","widget_base","services/application_mode","services/theme","services/tw_number_formatter","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.WidgetFragmentDrawStyleFactory=class{static createFragmentDrawStyle(e,t,i){return{colorPalette:this.createColorPalette(i),fontSize:this.createFontSize(e.getPageState()),formatting:this.createFormatting(i),placement:this.createPlacementStyle(t),margin:this.createMarginStyle(i),showWidgetUI:this.checkCreateWidgetUI(e),resolutionScale:this.getWidgetResolutionScale()}}static createMarginStyle(e){const{left:t=0,top:i=0,right:n=0,bottom:s=0}=e.margin||{};return{left:t,right:n,top:i,bottom:s}}static getWidgetResolutionScale(){return s.applicationMode.getCurrentAppMode()!==s.AppMode.IMAGE_EXPORT?1:2}static checkCreateWidgetUI(e){return s.applicationMode.getCurrentAppMode()!==s.AppMode.IMAGE_EXPORT&&(!this.isGridReportOrCommandCenterScreen(e.getPageState())||e.isEditMode())}static isGridReportOrCommandCenterScreen(e){if(!e)return!1;const t=e.getAllowedPages();return e.isGridPage()&&t.isReport()||t.isCommandCenterScreen()}static createFormatting(e){return{dateFormat:a.contextData.commonPropertiesContainer.date_format.date_format,dateTimeFormat:a.contextData.commonPropertiesContainer.date_format.date_time_format,numberFormatter:void 0!==e.numberFormatter?e.numberFormatter:r.twNumberFormatter.getInstance(),lowPrecisionFormatter:r.twNumberFormatter.getLowPrecisionFormatter(),shortDateFormat:a.contextData.commonPropertiesContainer.date_format.short_date_format,timeFormat:a.contextData.commonPropertiesContainer.date_format.time_format}}static createColorPalette(e){return e.colorPaletteBuilder?new e.colorPaletteBuilder(o.themeService.getCurrentThemeId()).build():void 0}static createFontSize(e){if(!e)return n.FontSize.SMALL;if(!e.hasScreenConfiguration())return n.FontSize.SMALL;switch(e.getScreenConfiguration().font_size){case"SMALL":return n.FontSize.SMALL;case"MEDIUM":return n.FontSize.MEDIUM;case"LARGE":return n.FontSize.LARGE;default:throw new Error("unknown font size")}}static createPlacementStyle(e){return{centeredHorizontally:!1,centeredVertically:e instanceof i.LegendFragment&&0!==e.getXOrder()}}}}),define("classes/widget/widget_fragment_factory/widget_fragment_factory",["require","exports","log","map","underscore","widget_base","services/tw_common","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","classes/widget/types/widget_type","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_fragment_draw_style_factory"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g="classes/widget/widget_fragment_factory/widget_blueprints/",u={NO_DATA:{path:"no_data_blueprint"},[c.WidgetType.BUBBLE_CHART]:{path:"bubble_chart_blueprint"},[c.WidgetType.LINE_CHART]:{path:"line_chart_blueprint"},[c.WidgetType.AREA_CHART]:{path:"area_chart_blueprint"},[c.WidgetType.RADAR_CHART]:{path:"radar_chart_blueprint"},[c.WidgetType.KPI_CHART]:{path:"kpi_blueprint"},[c.WidgetType.HORIZONTAL_BAR_CHART]:{path:"horizontal_bar_chart_blueprint"},[c.WidgetType.VERTICAL_BAR_CHART]:{path:"vertical_bar_chart_blueprint"},[c.WidgetType.ARTICLES]:{path:"articles_blueprint"},[c.WidgetType.DATA_TABLE]:{path:"table_blueprint"},[c.WidgetType.MESSAGE_DIFFUSION]:{path:"message_diffusion_blueprint"},[c.WidgetType.INFLUENCER_TABLE]:{path:"influencer_table_blueprint"},[c.WidgetType.TOP_INFLUENCERS_OVERVIEW]:{path:"top_influencer_overview_blueprint"},[c.WidgetType.SINGLE_METRIC]:{path:"single_metric_blueprint"},[c.WidgetType.EMOJI_TREE]:{path:"theme_tree_blueprint"},[c.WidgetType.THEME_TREE]:{path:"theme_tree_blueprint"},[c.WidgetType.THEME_CLOUD]:{path:"theme_cloud_blueprint"},[c.WidgetType.SORTED_THEME_CLOUD]:{path:"sorted_theme_cloud_blueprint"},[c.WidgetType.GENDER]:{path:"gender_blueprint"},[c.WidgetType.PAYLOAD_EDITION]:{path:"payload_edition_blueprint"},[c.WidgetType.PAGE_BREAK]:{path:"page_break_blueprint"},[c.WidgetType.TEXT]:{path:"text_blueprint"},[c.WidgetType.ACTIVITY_CHART]:{path:"activity_blueprint"},[c.WidgetType.COMPOSED_GRAPH]:{path:"composed_graph_blueprint"},[c.WidgetType.TREEMAP]:{path:"treemap_blueprint"},[c.WidgetType.SUMMARIES]:{path:"summary_blueprint"},[c.WidgetType.VELOCITY_CHART]:{path:"line_chart_blueprint"},[c.WidgetType.INFLUENCER_OVERVIEW]:{path:"influencer_overview_blueprint"},[c.WidgetType.MULTI_METRICS]:{path:"metric_multiple_blueprint"},[c.WidgetType.TOP_IMAGES]:{path:"top_images_blueprint"},[c.WidgetType.PIE_CHART]:{path:"pie_chart_blueprint"},[c.WidgetType.WHEEL_CHART]:{path:"wheel_chart_blueprint"},[c.WidgetType.TRENDS_TABLE]:{path:"trends_table_blueprint"},[c.WidgetType.INFLUENCER_NETWORK]:{path:"influencer_network_blueprint"},[c.WidgetType.DOCUMENT_CLUSTER]:{path:"document_cluster_blueprint"},[c.WidgetType.COUNTER]:{path:"counter_blueprint"},[c.WidgetType.TEXT_BOX]:{path:"text_box_blueprint"},[c.WidgetType.IMAGE_BOX]:{path:"image_box_blueprint"},[c.WidgetType.VIDEO_BOX]:{path:"video_box_blueprint"},[c.WidgetType.RESTFORM]:{path:"restform_blueprint"},[c.WidgetType.OPENLAYERS_WORLD_MAP]:{path:"openlayers_world_map_blueprint"},[c.WidgetType.STREAM_GRAPH]:{path:"stream_graph_blueprint"},[c.WidgetType.IMPACT_GRAPH]:{path:"impact_graph_blueprint"},[c.WidgetType.PROGRESS_GRAPH]:{path:"progress_graph_blueprint"},[c.WidgetType.BLOCK_INFLUENCERS]:{path:"block_influencers_blueprint"},[c.WidgetType.BLOCK_ISSUES]:{path:"block_issues_blueprint"},[c.WidgetType.CAMPAIGNS_TABLE]:{path:"campaigns_table_blueprint"},[c.WidgetType.TRENDS_CONFIGURABLE]:{path:"trends_configurable_blueprint"},[c.WidgetType.EXTERNAL_TREND_TABLE]:{path:"external_trend_table_blueprint"},[c.WidgetType.EXTERNAL_TREND_WORD_CLOUD]:{path:"external_trend_theme_cloud_blueprint"},[c.WidgetType.COMPARED_TOPICS]:{path:"compared_topics_blueprint"}};class p{constructor(){this.bluePrintPromises={},this.widgetDirectiveMap={}}async createFragments(e){i.logService.debug(`creating fragments for widget ${e.getType()}`,r.twCommon.logFeatures.Widget,e);let t=await this.getBlueprint(e);if(void 0!==t){const i=this.createEnhancer(t);(t=this.enhance(e,t,i)).layout=this.pruneLayout(t.layout);const n=t.buildConfigurations||l.defaultBuildConfigurations;e.blueprint=t;const r=s.mapObject(t.layout,i=>this.buildFragments(i,t,e));return i.initialize(r),{fragments:r,config:n,layoutStrategy:new o.DefaultFragmentLayoutStrategy(t.layoutStrategySettings),unmanaged:t.unmanaged||!1,transitionOnNewData:t.transitionOnNewData,hasMargin:!t.noMargin,enhancer:i}}throw new Error(`No widget instance data defined for widget ${e.getType()}!\n            The widget cannot be displayed. Go to widget_fragment_factory.ts and define the data for the widget`)}createFragmentMetadata(e,t,i){const s=new n.Map;return Object.values(t).forEach(t=>t.forEach(t=>{const n=Object.getPrototypeOf(t).constructor,o=d.WidgetFragmentDrawStyleFactory.createFragmentDrawStyle(e,t,i.get(n)||{});s.set(t,o)})),s}buildFragments(e,t,i){return e.map(e=>{const n=(t.buildConfigurations||l.defaultBuildConfigurations).get(e)||{};return new e({widget:i,buildConfiguration:n,subFragments:this.createSubFragments(i,n)})})}pruneLayout(e){return e=s.pick(e,e=>e.length)}async loadBluePrintFactory(t){return void 0===this.widgetDirectiveMap[t]&&(void 0===this.bluePrintPromises[t]&&(this.bluePrintPromises[t]=new Promise((i,n)=>{e([g+u[t].path],i,n)}).then(async e=>e.default)),this.widgetDirectiveMap[t]=await this.bluePrintPromises[t]),this.widgetDirectiveMap[t]}async getBlueprint(e){let t;const i=await this.loadBluePrintFactory(e.getType());if(void 0===i)throw new Error(`no blueprint factory defined for ${e.getType()}`);if(t=i(),e.isDisposed())throw new Error("disposed");return e.isEmptyWidget()&&!t.showEvenIfNoData&&(void 0===this.widgetNoDataBlueprintFactory&&(this.widgetNoDataBlueprintFactory=await this.loadBluePrintFactory("NO_DATA")),t.layout=this.widgetNoDataBlueprintFactory().layout),t}createEnhancer(e){return new(e.enhancer||a.DefaultWidgetBlueprintEnhancer)}enhance(e,t,i){return(t=i.enhanceBlueprint(t,e)).layout=i.filterWidgetDivisions(t.layout,e),t.layout=s.mapObject(t.layout,n=>n.filter(n=>i.canShowFragment(n,{widget:e,buildConfiguration:t.buildConfigurations&&t.buildConfigurations.get(n)||{},subFragments:{}}))),t}createSubFragments(e,t){return s.mapObject(t.subFragments||{},t=>new o.PortableFragment(t.fragment,t.confiugration,i=>d.WidgetFragmentDrawStyleFactory.createFragmentDrawStyle(e,i,t.confiugration||{})))}}t.WidgetFragmentFactory=p,t.widgetFragmentFactory=new p}),define("services/widgets/widget_menu_configuration_entry_filters",["require","exports","canvas_chart_utilities","classes/context_data/context_data","classes/widget/blueprint_utilities","classes/widget/fragments/directive/result_count_fragment","classes/widget/widget_fragment_factory/widget_fragment_factory","wrappers/topic_menu/topic_menu_wrapper","services/configuration","classes/application/abstract_application","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d){var g;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MENU=0]="MENU",e[e.HEADER=1]="HEADER"}(g=t.WidgetMenuConfigurationType||(t.WidgetMenuConfigurationType={}));const u={sort_menu:"getSortByMenu",tree_map_sort:"getTreemapSortByMenu",group_menu:"getGroupByMenu",number_results_menu:"getNumResultsMenu"};t.widgetMenuConfigurationEntryFilters={[g.MENU]:async(e,t,a,c)=>{const l=a.isDocumentCluster()&&!(a.hasPayload()&&a.hasPayloadValue()&&a.getPayloadValue().graph),d=a.getPageState().getAllowedPages().isDashboard(),g=a.getPageState().getAllowedPages().isReport();if(l&&c.isEditMode&&!(d&&"dashboard_page_menu"===e||g&&"report_actions"===e)||l&&!c.isEditMode||l&&a.getPageState().getAllowedPages().isDocumentClusterIqApp())return!1;switch(e){case"cluster_labels_menu":return a.hasMenu()&&a.getMenu().hasClusterLabelsMenu();case"y_axis_types":return(a.isLineChart()||a.isAreaChart()||a.isBarChart()||a.isBubbleChart())&&a.hasExtendedConfiguration()&&a.getExtendedConfiguration().hasYAxisConfiguration()&&a.getExtendedConfiguration().getYAxisConfiguration().hasAxisTypeMenu();case"content_contains_type":return!1;case"choropleth_map_menu":return c.widgetMenu.hasChoroplethMapMenu;case"add_to_source_panel":return n.contextData.rules.isArticleSourcePanelEnabled()&&a.hasMenu();case"export_share_menu":return!(a.isDocumentCluster()&&!(a.hasPayload()&&a.hasPayloadValue()&&a.getPayloadValue().graph))&&(a.hasMenu()&&void 0!==a.getMenu().getExportShareMenu()&&t.export_share_menu&&!a.isText());case"select_search_data_function_menu":return a.hasMenu()&&a.getMenu().hasSelectSearchDataFunctionMenu()&&!a.isStreamGraph();case"export_menu":return!(a.isDocumentCluster()&&!(a.hasPayload()&&a.hasPayloadValue()&&a.getPayloadValue().graph))&&(a.hasMenu()&&void 0!==a.getMenu().getExportMenu()&&t.export_menu&&!a.isText()&&n.contextData.rules.isExportEnabled());case"share":return a.hasMenu()&&void 0!==a.getMenu().getShareMenu()&&t.share&&!a.isText()&&n.contextData.rules.isExportEnabled();case"export_complete_menu":return a.hasMenu()&&void 0!==a.getMenu().getExportCompleteMenu()&&t.export_complete_menu&&!a.isText()&&n.contextData.rules.isExportEnabled();case"transformations_menu":return c.extendedMenu.hasTransformationsMenu;case"external_data_menu":return a.hasMenu()&&a.getMenu().hasExternalDataMenu()&&!a.isStreamGraph();case"hide_widget_metrics":return(c.application.isCommandCenterWidgetPreview||a.getPageState().getAllowedPages().isReport())&&s.BlueprintUtilities.hasFragment(await r.widgetFragmentFactory.getBlueprint(a),o.ResultCountFragment);case"legend_configuration_position":return a.canBeSaved()&&a.hasLegendConfiguration()&&!a.isText()&&void 0!==a.getLegendConfiguration().legendPositionMenu&&s.BlueprintUtilities.hasFragment(await r.widgetFragmentFactory.getBlueprint(a),i.LegendFragment);case"legend_configuration_type":return a.canBeSaved()&&a.hasLegendConfiguration()&&void 0!==a.getLegendConfiguration().legendTypeMenu&&s.BlueprintUtilities.hasFragment(await r.widgetFragmentFactory.getBlueprint(a),i.LegendFragment);case"compatible_data_types":return!a.isNetSentiment()&&(a.isInfluencerNetwork()?c.application.isReport||c.application.isDashboard:c.application.isReport||c.application.isInstantDiscovery||c.application.isSearch?c.widgetMenu.hasCompatibleDataTypes&&(a.isArticles()&&!a.isSmallArticlesWidget()||a.isTreeMap()&&12===a.getWidth()||!a.isArticles()&&!a.isTreeMap()||a.isSmallArticlesWidget()||a.isSmallTreemap()):t.compatible_data_types&&c.widgetMenu.hasCompatibleDataTypes&&(!a.isArticles()&&!a.isTreeMap()||a.isSmallArticlesWidget()||a.isSmallTreemap()));case"breakdown_options":return t.breakdown_options&&!a.isMessageDiffusion();case"sort_menu":return c.application.isReport||c.application.isInstantDiscovery||c.application.isSearch?t.sort_menu&&!a.isSmallArticlesWidget()&&a.hasMenu()&&a.getMenu().hasSortMenu():c.application.isInfluencerNetwork?c.extendedMenu.hasSortByMenu:t.sort_menu&&(a.isSmallArticlesWidget()||a.isSmallTreemap());case"group_menu":return c.application.isReport||c.application.isInstantDiscovery||c.application.isSearch?c.widgetMenu.hasGroupMenu&&!a.isSmallArticlesWidget():t.group_menu&&a.isSmallArticlesWidget();case"number_results_menu":return c.extendedMenu.hasNumResultsMenu&&!c.widgetMenu.hasNumberResultsMenu&&c.extendedMenu.hasNumResultsMenu&&a.getExtendedConfiguration().getNumResultsMenu().getAllLeavesRecursively().length>1&&([a.isArticles(),a.isTreeMap()].every(e=>!e)||c.page.isReport||a.getWidth()<12);case"command_center_menu":return c.page.hasCommandCenterMenu;case"report_actions":return a.hasMenu()&&(c.widgetMenu.hasReportActionsMenu||c.page.hasReportPageMenu);case"clone_dashboard_menu":return t.clone_dashboard_menu&&!c.isEditMode;case"dashboard_page_menu":return c.isEditMode?c.page.hasDashboardPageMenu:!c.page.isDashboard&&c.page.hasDashboardPageMenu;case"hashtag_menu":return c.application.isReport&&!a.isSkeleton()&&!a.isTopImagesList()&&c.widgetMenu.hasHashtagMenu;case"theme_options":if(!c.application.isReport||!a.hasMenu()||!a.getMenu().hasThemeOptionsMenu()||a.isWheelChart())return!1;return a.getMenu().getThemeOptionsMenu().getEntriesRecursively().filter(e=>e.isVisible()).length>2;case"theme_sampling_mode_menu":return!!(a.hasMenu()&&a.getMenu().hasHashtagMenu()&&a.getMenu().hasThemeSamplingModeMenu()&&a.getMenu().getHashtagMenu().getSelectionCount()>0)&&a.getMenu().getHashtagMenu().getFirstSelectedEntryRecursively().getMappedId()===constants.root_id.sampled_themes;default:return!!a.getDicWrapper().hasMenu()&&(void 0!==t[e]&&"boolean"!=typeof t[e])}},[g.HEADER]:(e,t,i,n)=>{if(function(e,t,i){if(d.applicationMode.isMobile())return!1;if(i.getPageState().getAllowedPages().isReport()||i.getPageState().getAllowedPages().isInstantDiscovery())return!1;if(void 0===t&&i.hasExtendedConfiguration()&&void 0!==u[e]){const n=i.getExtendedConfiguration()[u[e]]();void 0!==n&&(t=n.toProto())}if(void 0!==t&&"boolean"!=typeof t){const e=new a.TopicMenuWrapper(t);return e.hasRootEntry()&&e.getRootEntry().isVisible()&&!e.isButtonMenu()&&c.configurationService.getPageConfiguration().canShowWidgetHeaderMenu(e.getType(),i.getPageState().getApplication().getType()!==l.ApplicationType.MAIN)&&c.configurationService.getWidgetConfiguration(i.getType()).canShowHeaderMenu(i,e.getType())&&c.configurationService.getApplicationConfiguration(i.getPageState().getApplication()).isWidgetMenuAllowed(e.getType())}return!0}(e,t[e],i))switch(e){case"sort_menu":return n.widgetMenu.hasSortMenu&&!i.isTreeMap()&&!i.isSmallArticlesWidget();case"view_mode":return!i.isSkeleton()&&n.widgetMenu.hasViewModeMenu;case"number_results_menu":return n.extendedMenu.hasNumResultsMenu&&!n.widgetMenu.hasNumberResultsMenu&&n.extendedMenu.hasNumResultsMenu&&i.getExtendedConfiguration().getNumResultsMenu().getAllLeavesRecursively().length>1&&[i.isArticles(),i.isTreeMap()].some(e=>e)&&i.getWidth()>=12&&!n.page.isReport;case"group_menu":return n.widgetMenu.hasGroupMenu&&!i.isSmallArticlesWidget();case"select_search_data_function_menu":return i.hasMenu()&&i.getMenu().hasSelectSearchDataFunctionMenu()&&i.isStreamGraph();case"hashtag_menu":return!i.isSkeleton()&&!i.isTopImagesList()&&n.widgetMenu.hasHashtagMenu;case"compatible_data_types":return(i.isArticles()&&!i.isSmallArticlesWidget()||i.isTreeMap()&&12===i.getWidth())&&n.widgetMenu.hasCompatibleDataTypes;case"breakdown_options":return!i.isSkeleton()&&i.isMessageDiffusion()&&n.widgetMenu.hasBreakDownOptionsMenu;case"tree_map_sort":return n.extendedMenu.hasTreemapSortByMenu;case"theme_options":if(!i.hasMenu()||!i.getMenu().hasThemeOptionsMenu()||i.isWheelChart())return!1;return i.getMenu().getThemeOptionsMenu().getEntriesRecursively().filter(e=>e.isVisible()).length>2;case"custom_menus":return i.hasMenu()&&i.getMenu().hasCustomMenus();default:return!1}return!1}}}),define("services/widgets/widget_menu_configuration_entry_enhancers",["require","exports","common_constants","classes/context_data/context_data","services/widgets/widget_menu_configuration_entry_filters"],function(e,t,i,n,s){function o(e){return e.hasPageState()?e.getPageState().getAllowedPages():tw.pageState.getAllowedPages()}Object.defineProperty(t,"__esModule",{value:!0}),t.widgetMenuConfigurationEntryEnhancers={[s.WidgetMenuConfigurationType.MENU]:{always:(e,t,n,s)=>(void 0!==n&&("boolean"==typeof n?e.model=n:(e.isEmpty=function(e){return void 0===e.root_entry||void 0===e.root_entry.children||0===e.root_entry.children.length}(n),e.isDisabled=function(e){return void 0!==e.root_entry&&!0===e.root_entry.disabled}(n),e.isVisible=function(e){return void 0!==e.root_entry&&(void 0===e.root_entry.visibility||e.root_entry.visibility===i.topic_entry.visibility.visible)}(n),e.name=function(e){return void 0!==e.root_entry?e.root_entry.name:""}(n),e.model=n)),e),transformations_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getTransformationsMenu(),e.name=e.model.getRootEntry().getName(),e),y_axis_types:(e,t,i,n)=>(t.getExtendedConfiguration().hasYAxisConfiguration()&&(e.name=t.getExtendedConfiguration().getYAxisConfiguration().getAxisTypeMenu().getRootEntry().getName(),e.model=t.getExtendedConfiguration().getYAxisConfiguration().toProto().axis_type_menu),e),number_results_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getNumResultsMenu(),e.name=e.model.getRootEntry().getName(),e),legend_configuration_type:(e,t,i,n)=>(e.name=t.getLegendConfiguration().legendTypeMenu.getRootEntry().getName(),e.model=t.getLegendConfiguration().legendTypeMenu.topicMenu,e),legend_configuration_position:(e,t,i,n)=>(e.name=t.getLegendConfiguration().legendPositionMenu.getRootEntry().getName(),e.model=t.getLegendConfiguration().legendPositionMenu.topicMenu,e),sort_menu:(e,t,i,n)=>(t.isSmallArticlesWidget()?e.model=t.getExtendedConfiguration().getSortByMenu().getRootEntry():t.isSmallTreemap()&&(e.model=t.getExtendedConfiguration().getTreemapSortByMenu().getRootEntry()),(n.application.isReport||n.application.isInstantDiscovery)&&!t.isSmallArticlesWidget()&&n.widgetMenu.hasSortMenu&&(e.model=t.getExtendedConfiguration().getSortByMenu()),(n.application.isReport||n.application.isInstantDiscovery)&&!t.isSmallArticlesWidget()&&t.getMenu().hasSortMenu()&&(e.model=e.model.getRootEntry()),n.extendedMenu.hasSortByMenu&&n.application.isInfluencerNetwork&&(e.model=t.getExtendedConfiguration().getSortByMenu(),e.name=e.model.getRootEntry().getName()),e),group_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getGroupByMenu(),e),author_source_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().toProto().author_source,e),page_monitoring:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().toProto().page_monitoring_menu,e),hide_widget_metrics:(e,t,i,s)=>(e.name=n.contextData.getMessage("_1232356"),e),compatible_data_types:(e,t,i,n)=>(e.model=t.getMenu().getCompatibleDataTypes().getRootEntry(),e),filters:(e,t,i,n)=>(e.model=t.getMenu().getFiltersMenu().getRootEntry(),e),hashtag_menu:(e,t,i,n)=>(e.model=t.getMenu().getHashtagMenu().getRootEntry(),e),cluster_labels_menu:(e,t,i,n)=>(e.model=t.getMenu().getClusterLabelsMenu().getRootEntry(),e),view_mode:(e,t,i,n)=>(e.model=t.getMenu().getViewModeMenu().getRootEntry(),e),time_axis_options:(e,t,i,n)=>(e.isVisible=t.getMenu().getTimeAxisOptions().getRootEntry().isVisible(),e),display_on_map_menu:(e,t,i,n)=>(e.model=t.getMenu().getFiltersMenu().getRootEntry(),e),nested_graph_type_menu:(e,t,i,n)=>(e.model=t.getMenu().getNestedGraphTypeMenu().getRootEntry(),e),external_data_menu:(e,t,i,n)=>(e.model=t.getMenu().getExternalDataMenu().getRootEntry(),e),export_menu:(e,t,i,n)=>(e.model=t.getMenu().getExportMenu().getRootEntry(),e),special_actions:(e,t,i,s)=>(e.model=t.getMenu().getSpecialActionsMenu().getRootEntry(),e.name=n.contextData.getMessage("_492512"),e),export_share_menu:(e,t,i,n)=>(e.model=t.getMenu().getExportShareMenu().getRootEntry(),e),share:(e,t,i,n)=>(e.model=t.getMenu().getShareMenu().getRootEntry(),e),export_complete_menu:(e,t,i,n)=>(e.model=t.getMenu().getExportCompleteMenu().getRootEntry(),e),result_rule_menu:(e,t,i,n)=>(e.model=t.getMenu().getResultRuleMenu().getRootEntry(),e),report_actions:(e,t,i,n)=>{if(n.widgetMenu.hasReportActionsMenu)e.model=t.getMenu().getReportActionsMenu().getRootEntry(),e.name=t.getMenu().getReportActionsMenu().getRootEntry().getName();else if(n.page.hasReportPageMenu){const i=o(t);e.model=i.getReportPageMenu().getRootEntry(),e.name=i.getReportPageMenu().getRootEntry().getName()}return e},dashboard_page_menu:(e,t,i,n)=>{const s=o(t);return e.model=s.getDashboardPageMenu().getRootEntry(),e.name=s.getDashboardPageMenu().getRootEntry().getName(),e},clone_dashboard_menu:(e,t,i,n)=>(e.model=t.getMenu().getCloneDashboardMenu().getRootEntry(),e.name=t.getMenu().getCloneDashboardMenu().getRootEntry().getName(),e),add_to_source_panel:(e,t,i,s,o)=>(e.model=o,e.name=n.contextData.getMessage("_697046"),e),command_center_menu:(e,t,i,n)=>{const s=o(t);return e.model=s.getCommandCenterMenu().getRootEntry(),e.name=s.getCommandCenterMenu().getRootEntry().getName(),e},theme_sampling_mode_menu:(e,t,i,n)=>(e.model=t.getMenu().getThemeSamplingModeMenu().getRootEntry(),e)},[s.WidgetMenuConfigurationType.HEADER]:{always:(e,t,i,n)=>{if(void 0!==i)if("boolean"==typeof i)e.model=i;else{const n=t.getMenu().getWrapperForTopicMenu(i);e.model=n,e.name=n.getRootEntry().getName()}return e},sort_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getSortByMenu(),e),group_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getGroupByMenu(),e),tree_map_sort:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getTreemapSortByMenu(),e.name=e.model.getRootEntry().getName(),e),number_results_menu:(e,t,i,n)=>(e.model=t.getExtendedConfiguration().getNumResultsMenu(),e.name=e.model.getRootEntry().getName(),e),custom_menus:(e,t,i,n)=>(e.model=t.getMenu().getCustomMenus(),e),theme_sampling_mode_menu:(e,t,i,n)=>(e.model=t.getMenu().getThemeSamplingModeMenu(),e.name=e.model.getRootEntry().getName(),e)}}}),define("services/widgets/widget_menu_configuration",["require","exports","services/widgets/widget_menu_configuration_entry_enhancers","other/tw","services/widgets/widget_menu_configuration_entry_filters","log","event_bus","services/application_mode","services/widgets/widget_menu_configuration_entry_filters"],function(e,t,i,n,s,o,r,a,c){var l;Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetMenuConfigurationType=c.WidgetMenuConfigurationType,function(e){e[e.translation_target_language_menu=0]="translation_target_language_menu",e[e.number_results_menu=1]="number_results_menu",e[e.y_axis_types=2]="y_axis_types",e[e.comment_display_type_menu=3]="comment_display_type_menu",e[e.hide_widget_metrics=4]="hide_widget_metrics",e[e.breakdown_options=5]="breakdown_options",e[e.sort_menu=6]="sort_menu",e[e.legend_configuration_type=7]="legend_configuration_type",e[e.legend_configuration_position=8]="legend_configuration_position",e[e.group_menu=9]="group_menu",e[e.select_search_data_function_menu=10]="select_search_data_function_menu",e[e.author_source_menu=11]="author_source_menu",e[e.page_monitoring=12]="page_monitoring",e[e.tree_map_sort=13]="tree_map_sort",e[e.dashboard_actions=14]="dashboard_actions",e[e.animation_menu=15]="animation_menu",e[e.nested_graph_type_menu=16]="nested_graph_type_menu",e[e.content_contains_type=17]="content_contains_type",e[e.export_share_menu=18]="export_share_menu",e[e.time_axis_options=19]="time_axis_options",e[e.theme_bubble_sizes=20]="theme_bubble_sizes",e[e.transformations_menu=21]="transformations_menu",e[e.clone_dashboard_menu=22]="clone_dashboard_menu",e[e.coloring_options_menu=23]="coloring_options_menu",e[e.top_results_menu=24]="top_results_menu",e[e.view_mode=25]="view_mode",e[e.display_on_map_menu=26]="display_on_map_menu",e[e.refresh_period_menu=27]="refresh_period_menu",e[e.share=28]="share",e[e.theme_options=29]="theme_options",e[e.text_widget_layout_menu=30]="text_widget_layout_menu",e[e.navbar_settings_menu=31]="navbar_settings_menu",e[e.report_actions=32]="report_actions",e[e.hashtag_menu=33]="hashtag_menu",e[e.result_rule_menu=34]="result_rule_menu",e[e.special_actions=35]="special_actions",e[e.compatible_data_types=36]="compatible_data_types",e[e.search_mode=37]="search_mode",e[e.widget_width=38]="widget_width",e[e.export_menu=39]="export_menu",e[e.timefilter_mode=40]="timefilter_mode",e[e.external_data_menu=41]="external_data_menu",e[e.custom_menus=42]="custom_menus",e[e.filters=43]="filters",e[e.export_complete_menu=44]="export_complete_menu",e[e.newsletter_actions=45]="newsletter_actions",e[e.geodata_precision_types=46]="geodata_precision_types",e[e.zoom_level_menu=47]="zoom_level_menu",e[e.theme_sampling_mode_menu=48]="theme_sampling_mode_menu",e[e.cluster_labels_menu=49]="cluster_labels_menu",e[e.influencer_highlight_by_source_panel=50]="influencer_highlight_by_source_panel",e[e.dashboard_page_menu=51]="dashboard_page_menu",e[e.command_center_menu=52]="command_center_menu",e[e.add_to_source_panel=53]="add_to_source_panel"}(l=t.WIDGET_MENU_TYPES||(t.WIDGET_MENU_TYPES={}));const d=[];for(const e in l)"number"==typeof l[e]&&d.push(e);function g(e){return{page:function(e){const t={isReplay:!1,isReport:!1,isSearch:!1,isSearchAdvanced:!1,isMonitor:!1,isTopicSetup:!1,isHomeScreen:!1,isBubbleDialog:!1,isWidgetEdit:!1,isEmbeddedWidget:!1,isCustomPage:!1,isNonPredefinedPage:!1,isDashboardTemplate:!1,isIqApp:!1,isDashboard:!1,isEditFiltersPage:!1,isSettings:!1,isUserWorkflow:!1,isCommandCenter:!1,isCommandCenterWidgetPreview:!1,isVelocity:!1,isMessageDiffusion:!1,isInfluencerOverview:!1,isTrendDiscovery:!1,isTrendDiscoveryDemographics:!1,isTrendDiscoveryInfluencers:!1,isTrendDiscoveryOverview:!1,isInfluencerNetwork:!1,isTrendDiscoveryResults:!1,isTrendDiscoveryThemes:!1,isVisualDiscovery:!1,isVisualDiscoveryResults:!1,isVisualDiscoveryAnalytics:!1,isVisualDiscoveryInfluencers:!1,isVisualDiscoveryDemographics:!1,isVisualDiscoveryWorldmap:!1,isInstantDiscovery:!1,isPreview:!1,isThemeOverview:!1,isCommandCenterScreen:!1,isCommandCenterScreenEditMode:!1,hasDashboardPageMenu:!1,hasReportPageMenu:!1,hasCommandCenterMenu:!1,hasBookmarkMenu:!1},i=e.hasPageState()?e.getPageState().getAllowedPages():n.tw.pageState.getAllowedPages();return Object.keys(t).reduce((e,t)=>(e[t]=void 0!==i[t]&&i[t](),e),t)}(e),application:function(e){const t={isReplay:!1,isReport:!1,isSearch:!1,isSearchAdvanced:!1,isMonitor:!1,isTopicSetup:!1,isHomeScreen:!1,isBubbleDialog:!1,isWidgetEdit:!1,isEmbeddedWidget:!1,isCustomPage:!1,isNonPredefinedPage:!1,isDashboardTemplate:!1,isIqApp:!1,isDashboard:!1,isEditFiltersPage:!1,isSettings:!1,isUserWorkflow:!1,isCommandCenter:!1,isCommandCenterWidgetPreview:!1,isVelocity:!1,isMessageDiffusion:!1,isInfluencerOverview:!1,isTrendDiscovery:!1,isTrendDiscoveryDemographics:!1,isTrendDiscoveryInfluencers:!1,isTrendDiscoveryOverview:!1,isTrendDiscoveryResults:!1,isTrendDiscoveryThemes:!1,isVisualDiscovery:!1,isVisualDiscoveryResults:!1,isInfluencerNetwork:!1,isVisualDiscoveryAnalytics:!1,isVisualDiscoveryInfluencers:!1,isVisualDiscoveryDemographics:!1,isVisualDiscoveryWorldmap:!1,isInstantDiscovery:!1,isPreview:!1,isThemeOverview:!1,isCommandCenterScreen:!1,isCommandCenterScreenEditMode:!1,hasDashboardPageMenu:!1,hasReportPageMenu:!1,hasCommandCenterMenu:!1,hasBookmarkMenu:!1},i=e.getPageState().getAllowedPages();return Object.keys(t).reduce((e,t)=>(e[t]=void 0!==i[t]&&i[t](),e),t)}(e),widgetMenu:function(e){let t={hasSearchModeMenu:!1,hasTimeFilterModeMenu:!1,hasViewModeMenu:!1,hasBreakDownOptionsMenu:!1,hasThemeOptionsMenu:!1,hasCompatibleDataTypes:!1,hasTimeAxisOptions:!1,hasNumberResultsMenu:!1,hasSortMenu:!1,hasGroupMenu:!1,hasContentContainsType:!1,hasThemeBubbleSizes:!1,hasAuthorSourceMenu:!1,hasPageMonitoringMenu:!1,hasHashtagMenu:!1,hasFiltersMenu:!1,hasDisplayOnMapMenu:!1,hasResultRuleMenu:!1,hasExportMenu:!1,hasExportCompleteMenu:!1,hasShareMenu:!1,hasSpecialActionsMenu:!1,hasReportActionsMenu:!1,hasWidgetAnimationMenu:!1,hasWidgetRefreshPeriodMenu:!1,hasGeodataPrecisionTypesMenu:!1,hasExportShareMenu:!1,hasNestedGraphTypeMenu:!1,hasTranslationTargetLanguageMenu:!1,hasCommentDisplayTypeMenu:!1,hasTextWidgetLayoutMenu:!1,hasCustomMenus:!1,hasSelectSearchDataFunctionMenu:!1,hasZoomLevelMenu:!1,hasColoringOptionsMenu:!1,hasCloneDashboardMenu:!1,hasChoroplethMapMenu:!1};return e.hasMenu()&&(t=Object.keys(t).reduce((t,i)=>(t[i]=void 0!==e.getMenu()[i]&&e.getMenu()[i](),t),t)),t}(e),extendedMenu:function(e){let t={hasSortByMenu:!1,hasTreemapSortByMenu:!1,hasGroupByMenu:!1,hasNumResultsMenu:!1,hasTransformationsMenu:!1};return e.hasExtendedConfiguration()&&(t=Object.keys(t).reduce((t,i)=>(t[i]=void 0!==e.getExtendedConfiguration()[i]&&e.getExtendedConfiguration()[i](),t),t)),t}(e),isEditMode:n.tw.pageState.isEditMode()}}class u{constructor(){this.configMaps={[s.WidgetMenuConfigurationType.MENU]:new WeakMap,[s.WidgetMenuConfigurationType.HEADER]:new WeakMap},this.hasSubs=new WeakMap,r.eventBus.subscribe(r.EVENT_TYPES.CLEAR_WIDGET_MENU_CACHE,e=>this.updateCache(e.value))}getMenuId(e){return l[e].replace(/\_/g,"-")}hasCachedConfig(e,t=s.WidgetMenuConfigurationType.MENU){return this.configMaps[t].has(e)}getCachedConfig(e,t=s.WidgetMenuConfigurationType.MENU){return this.configMaps[t].get(e)}async getConfiguration(e,t=s.WidgetMenuConfigurationType.MENU){return this.configMaps[t].has(e)||this.configMaps[t].set(e,Object.assign({},await this.getEntries(e,t))),this.hasSubs.has(e)||(e.onSetConfigurationChanged.subscribe(()=>this.updateCache(e)),e.onPayloadChange.subscribe(()=>this.updateCache(e)),e.onLayoutChange.subscribe(()=>this.updateCache(e)),e.onDispose.subscribeOnceAsPromise().then(()=>{this.configMaps[t].delete(e),this.hasSubs.delete(e)}),this.hasSubs.set(e,!0)),this.getCachedConfig(e,t)}clearCache(){[s.WidgetMenuConfigurationType.HEADER,s.WidgetMenuConfigurationType.MENU].forEach(async e=>{this.configMaps[e]=new WeakMap})}updateCache(e){e?[s.WidgetMenuConfigurationType.HEADER,s.WidgetMenuConfigurationType.MENU].forEach(async t=>{this.configMaps[t].delete(e),this.configMaps[t].set(e,Object.assign({},await this.getEntries(e,t)))}):this.clearCache()}getSourcePanelsData(e){const t={authors:[],sources:[],sourcePanels:[]};if(e.hasPayloadValue())if(e.isInfluencerOverview()){const i=e.getPayloadValue();if(void 0===i.influencer)return o.logService.error(`No influencer found on influencer widget ${e.getId()}`),t;t.authors.length=0,i.influencer.id&&t.authors.push(i.sources[i.influencer.id]),t.sources.length=0,i.influencer.source_id&&t.sources.push(i.sources[i.influencer.source_id]),t.sourcePanels.length=0,t.sourcePanels.push.apply(t.sourcePanels,i.panels_groups)}else if(e.isInfluencerTable()){const i=e.getPayloadValue();t.sources.length=0,t.sources.push.apply(t.sources,Object.values(i.sources).filter(e=>!e.author)),t.authors.length=0,t.authors.push.apply(t.authors,Object.values(i.sources).filter(e=>e.author)),t.sourcePanels.length=0,t.sourcePanels.push.apply(t.sourcePanels,i.panels_groups)}return t}async getEntries(e,t){if(!(a.applicationMode.getCurrentAppMode()!==a.AppMode.IMAGE_EXPORT||e.hasPayload()&&e.hasPayloadValue()))return{};const n=e.hasMenu()?e.getMenu().toProto():{},o=this.getSourcePanelsData(e),r=g(e),c=(await this.getDefinedEntryNames(n,e,r,o,t)).reduce((s,a)=>{let c={isEmpty:!1,isDisabled:!1,isVisible:!0,name:"",model:void 0,id:this.getMenuId(l[a])};return c=i.widgetMenuConfigurationEntryEnhancers[t].always(c,e,n[a],r,o),void 0!==i.widgetMenuConfigurationEntryEnhancers[t][a]&&(c=i.widgetMenuConfigurationEntryEnhancers[t][a](c,e,n[a],r,o)),s[a]=c,s},{});return t===s.WidgetMenuConfigurationType.MENU&&(e.hasEmptyWidgetMenu=0===Object.keys(c).length),c}hasHeaderMenus(e){if(!(a.applicationMode.getCurrentAppMode()!==a.AppMode.IMAGE_EXPORT||e.hasPayload()&&e.hasPayloadValue()))return!1;const t=e.hasMenu()?e.getMenu().toProto():{},i=this.getSourcePanelsData(e),n=g(e);for(const o of d)if(s.widgetMenuConfigurationEntryFilters[s.WidgetMenuConfigurationType.HEADER](o,t,e,n)&&"add_to_source_panel"!==o||"add_to_source_panel"===o&&(i.authors.length>0||i.sources.length>0))return!0;return!1}async getDefinedEntryNames(e,t,i,n,o){const r=[];for(const a of d){const c=s.widgetMenuConfigurationEntryFilters[o](a,e,t,i);((c instanceof Promise?await c:c)&&"add_to_source_panel"!==a||"add_to_source_panel"===a&&(n.authors.length>0||n.sources.length>0))&&r.push(a)}return r}}t.WidgetMenuConfigurationService=u,t.widgetMenuConfigurationService=new u}),define("classes/widget/fragments/directive/widget_header_fragment",["require","exports","widget_base","services/widgets/widget_menu_configuration","services/widgets/widget_menu_configuration_entry_filters","classes/widget/fragment_bases/abstract_directive_fragment"],function(e,t,i,n,s,o){var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UPDATE_EVENT_TYPE="UPDATE_EVENT_TYPE"}(r=t.WidgetHeaderMediatorEventTypes||(t.WidgetHeaderMediatorEventTypes={}));t.WidgetHeaderFragment=class extends o.AbstractDirectiveFragment{constructor(e){super(e)}async initialize(e,t,i,n){const s=await super.initialize(e,t,i,n);return this.mediator=t,await this.updateWidgetMenuConfig(this.model),s}async updateWidgetMenuConfig(e){n.widgetMenuConfigurationService.updateCache(e.widget),this.config=await n.widgetMenuConfigurationService.getConfiguration(e.widget,s.WidgetMenuConfigurationType.HEADER),this.mediator.isDisposed()||this.mediator.dispatch(r.UPDATE_EVENT_TYPE,this.config)}get directiveData(){return{selector:"widget-header",args:{widget:this.model.widget,config:this.model.buildConfiguration,"menu-config":this.config}}}async update(e){return await this.updateWidgetMenuConfig(e),super.update(e)}getDimensionsForLayout(e){let t=e.dimensions.width||0;return void 0!==this.config&&0===Object.keys(this.config).length&&(t=0,this.model.widget.hasTitle()&&this.model.widget.isDataLoaded()&&!this.model.widget.isHideWidgetTitle()&&(t=12*this.model.widget.getTitle().length+18)),{width:t,height:this.calculateHeight(e.dimensions.width||void 0)}}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:0,minHeight:this.calculateHeight(),minWidth:0}],e=>this.getDimensionsForLayout(e))}applyFontClasses(){return!0}headerPadding(){const e=this.model.widget,t=e.getPageState().getAllowedPages();return t.isCommandCenterScreen()?10:t.isReport()&&e.getPageState().isGridPage()?0:t.isQuickSearch()||t.isFreeSearch()?12:24}hasMenu(){return n.widgetMenuConfigurationService.hasHeaderMenus(this.model.widget)}hasTitle(){const e=this.model.widget;return e.hasTitle()&&(e.getPageState().getApplication().getConfiguration().canShowWidgetTitle()||e.getPageState().isWholePageExport())&&e.isDataLoaded()&&!e.isHideWidgetTitle()}hasDescription(){const e=this.model.widget;return e.getPageState().isGridPage()?e.hasDescription():e.getSection().getWidgets().some(e=>e.hasDescription())}getDescriptions(){return this.model.widget.getSection().getWidgets().map(e=>e.getDisplayDescription()||e.getDescription())}hasCutoffMessage(){return this.model.widget.hasDataGraph()&&void 0!==this.model.widget.getCutoffMessage()}getDescriptionHeight(e,t){if(void 0===t)return 18;{const i=document.createElement("canvas").getContext("2d");return i.fillStyle='font-family: "RobotoR"; font-size: 12px;',18*Math.ceil(i.measureText(e).width/t)}}calculateHeight(e){const t=this.model.widget;let i=0;return this.hasMenu()?i=37:this.hasCutoffMessage()?i=30:this.hasTitle()&&(i=27),t.getApplication().isMainApplication()&&(i+=10),this.hasDescription()&&(i+=Math.max(...this.getDescriptions().map(t=>this.getDescriptionHeight(t,e)))),i>0?i+this.headerPadding():.1}}}),define("classes/widget/fragments/legacy_directive/replay_date_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ReplayDateFragment=class extends n.AbstractLegacyDirectiveFragment{directiveName(){return"tw-replay-date"}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:0,minHeight:52,minWidth:0}],e=>this.getDimensionsForLayout(e))}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:52}}}}),define("classes/widget/fragments/legacy_directive/replay_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ReplayFragment=class extends n.AbstractLegacyDirectiveFragment{directiveName(){return"tw-replay-slider"}getSizePriority(){return 0}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:0,minHeight:84,minWidth:0}],e=>this.getDimensionsForLayout(e))}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:84}}}}),define("classes/widget/widget_fragment_factory/widget_layout_block_id",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HEADER=0]="HEADER",e[e.BODY=1]="BODY",e[e.FOOTER=2]="FOOTER"}(t.WidgetLayoutBlockId||(t.WidgetLayoutBlockId={}))}),define("classes/widget/fragment_controllers/default_widget_blueprint_enhancer",["require","exports","canvas_chart_utilities","influencer_network","map","widget_base","services/application_mode","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/no_data_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/types/widget_type"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});class _ extends o.AbstractWidgetBlueprintEnhancer{enhanceBlueprint(e,t){return t.getPageState().isGridPage()&&t.hasSlotConfiguration()&&this.gridPageModifications(e,t),t.getPageState().getAllowedPages().isReport()&&t.getPageState().isGridPage()&&this.gridReportModifications(e,t),this.shouldWidgetTransitionOnNewData(t)&&(e.transitionOnNewData=o.WidgetTransitionType.FADE_OUT_IN),e}canShowFragment(e,t){const s=t.widget;return e===n.InfluencerNetworkSidebarFragment?!(r.applicationMode.getCurrentAppMode()===r.AppMode.IMAGE_EXPORT&&!s.getPageState().getAllowedPages().isReport()||s.getPageState().getAllowedPages().isCommandCenter()||s.getPageState().getAllowedPages().isCommandCenterWidgetPreview())&&[n.InfluencerNetworkLayout.DEFAULT,n.InfluencerNetworkLayout.GRAPH_HIDDEN,n.InfluencerNetworkLayout.INFLUENCER_ONE].includes(s.getPrimarySource().data_type_configuration_uuid):e===p.ReplayFragment?s.isReplayable()&&(s.getPageState().getApplication().getWidgetSettings().displayFullSizeWidget||r.applicationMode.getCurrentAppMode()===r.AppMode.IMAGE_EXPORT)&&s.hasReplayManager():e===c.NoDataFragment?s.isEmptyWidget()&&(s.getType()!==m.WidgetType.INFLUENCER_NETWORK||r.applicationMode.getCurrentAppMode()===r.AppMode.IMAGE_EXPORT):e===n.InfluencerNetworkFragment?!s.isEmptyWidget():e===u.ReplayDateFragment?s.hasAdditionalFrames():e===d.TopWidgetMenusFragment?s.hasMenu()&&s.getMenu().getButtonMenusTop().length>0:e===a.BottomWidgetMenusFragment?s.hasMenu()&&s.getMenu().getButtonMenusBottom().length>0:e===i.LegendFragment?!(s.hasLegendConfiguration()&&s.getLegendConfiguration().isHidden()||s.isHideWidgetLegend()):e===g.WidgetHeaderFragment?r.applicationMode.getCurrentAppMode()!==r.AppMode.IMAGE_EXPORT||s.getPageState().isGridPage():e!==l.ResultCountFragment||t.widget.hasMenu()&&t.widget.getMenu().showWidgetMetrics()&&s.hasDataGraph()&&void 0!==s.getDataGraph().total_label&&void 0!==s.getDataGraph().total_results}shouldWidgetTransitionOnNewData(e){return _.allowWidgetTransitioning&&e.getPageState().getAllowedPages().isCommandCenterScreen()&&-1!==["table","messageDiffusion","influencerTable","influencerOverview","influencerNetwork","topInfluencersOverview"].indexOf(e.getType())}gridPageModifications(e,t){this.setMargin(e,t)}setMargin(e,t){e.layout[h.WidgetLayoutBlockId.BODY].forEach(n=>{n!==i.LegendFragment&&(void 0===e.buildConfigurations&&(e.buildConfigurations=new s.ExtendableMap),e.buildConfigurations=e.buildConfigurations.extend([{key:n,value:{margin:{top:0,left:0,right:0,bottom:18*(t.getSlotConfiguration().trailing_whitespace||0)}}}]))})}gridReportModifications(e,t){e.noMargin=!0}}_.allowWidgetTransitioning=!1,t.DefaultWidgetBlueprintEnhancer=_}),define("classes/widget/fragments/directive/sidenote_fragment",["require","exports","classes/widget/fragment_bases/abstract_directive_fragment","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.SidenoteFragment=class extends i.AbstractDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:.3,heightScalePriority:1,minHeight:400,minWidth:200,aspectRatio:1}],e=>this.getDimensionsForLayout(e))}get directiveData(){return{selector:"tw-comment-list",args:{widget:this.model.widget,fragment:this}}}getXOrder(){return 2}}}),define("classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_grid_ticks",["require","exports","abstract_canvas_chart","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentCanvasChartGridTicks=class extends i.CanvasChartGridTicks{constructor(e){super(),this.checksum=0,this.ticks=[],this.ticks=e.map((e,t)=>({label:e.getName(),formattedLabel:e.getColumn().name_formatted_compressed||e.getName(),newDay:e.getColumn().new_day||!1,value:e.getColumn().has_time_stamp?e.getColumn().timestamp:t,hasTimeStamp:e.getColumn().has_time_stamp,isCutOff:void 0!==e.getMetadata().getAssociatedColumn().cut_off_type})),this.checksum=n.StringUtils.calculateHash(this.ticks.reduce((e,t)=>e+=t.value.toString()+t.formattedLabel+t.hasTimeStamp+t.label+t.newDay+t.isCutOff,""))}}}),define("classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_grid_range",["require","exports","reusable_utilities","abstract_canvas_chart"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s extends n.CanvasChartGridRange{constructor(e,t){if(super(),this.checksum=0,this.percentageBased=!1,this.min=Number.MAX_VALUE,this.max=-Number.MAX_VALUE,e.forEach(e=>{isFinite(e.getValueBounds().max)?(this.min=Math.min(this.min,e.getValueBounds().min),this.max=Math.max(this.max,e.getValueBounds().max)):e.getCells().forEach(e=>{this.min=Math.min(e.getNumericData(),this.min),this.max=Math.max(e.getNumericData(),this.max)})},{min:Number.MAX_VALUE,max:-Number.MAX_VALUE}),this.percentageBased=void 0!==e[0]&&void 0!==e[0].getCells()[0]&&e[0].getCells()[0].isPercentageBased(),this.min>0&&(this.min=0),t&&this.adapt(),this.min<0){const e=Math.max(Math.abs(-this.min),this.max);this.min=-e,this.max=e}0===this.min&&0===this.max&&(this.max=100),this.checksum=i.StringUtils.calculateHash(""+this.percentageBased+this.max+this.min)}adapt(){const e=Math.max(...[this.min,this.max].map(e=>{const t=String(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return void 0===t||t.length<2?0:[1].length})),t=Math.max(10,this.max-this.min),i=Math.pow(10,t.toFixed(e).length-1);this.max=0===e?this.max+i-this.max%i:s.customMax(this.max);const n=Math.abs(this.min),o=0===e?n+i-n%i:s.customMax(n);this.min<0?this.min=-o:this.min=o}static customMax(e){const t=e<0;e=Math.abs(e);const i=Math.max(1,Math.floor(Math.log(e)/Math.log(10))-(e>=1e4?1:0)),n=Math.pow(10,i)/2;if(e%Math.pow(10,i)==0||e<10)return Math.ceil(e);{let s=Math.ceil(e/n)*n;return s>=1e4&&(s=Math.ceil(s/Math.pow(10,i))*Math.pow(10,i)),s*(t?-1:1)}}}t.FragmentCanvasChartGridRange=s}),define("classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_model",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentCanvasChartModel=class{constructor(e,t){this.internalCheckSum=0,this.widget=t,void 0!==t&&(this.id=t.getId()),this.calculateChecksum()}get timeInterval(){return void 0!==this.widget&&void 0!==this.widget.getDic()&&void 0!==this.widget.getDic().primary_source.tw_data_source&&void 0!==this.widget.getDic().primary_source.tw_data_source.x_axis&&this.widget.getDic().primary_source.tw_data_source.x_axis.time_interval||"d1"}get checkSum(){return void 0===this.internalCheckSum&&this.calculateChecksum(),this.internalCheckSum}set checkSum(e){this.internalCheckSum=e}calculateChecksum(){this.internalCheckSum=i.StringUtils.calculateHash(`${this.timeInterval}`)}toSerializable(){return{id:this.id}}}}),define("classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model",["require","exports","reusable_utilities","abstract_canvas_chart","classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_grid_ticks","classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_grid_range","classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_model"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentCanvasGridChartModel=class extends r.FragmentCanvasChartModel{constructor(e,t,i=n.CanvasChartGridDirection.NORMAL){if(super(e,t),this.logarithmicX=!1,this.logarithmicY=!1,this.comments=[],this.gradientLegendItems=[],this.nestedIndex=0,this.cutOffMessage=t.getCutoffMessage(),this.nestedId=e.getDataGraph().widget_id,this.commentDisplayMode=this.getCommentDisplayMode(t),this.isExternalData=e.hasMetaData()&&e.getMetaData().attributes&&e.getMetaData().attributes.dataframe_type===constants.data_graph.meta_data.attributes.dataframe_type.external,this.isNestedData=e.hasMetaData()&&e.getMetaData().attributes&&e.getMetaData().attributes.dataframe_type===constants.data_graph.meta_data.attributes.dataframe_type.nested,this.isExternalData||this.isNestedData||(this.nestedId=void 0),this.logarithmicY=t.hasExtendedConfiguration()&&t.getExtendedConfiguration().hasYAxisConfiguration()&&t.getExtendedConfiguration().getYAxisConfiguration()&&t.getExtendedConfiguration().getYAxisConfiguration().isLogarithmic(),void 0!==e){this.grid=this.buildGridData(e,t,i);let n=0;const s=[];e.getColumns().forEach(t=>t.getCells().forEach(i=>{const n=e.findComment(i.getRow().getCode(),parseInt(t.getCode(),10));n&&s.push(n)})),this.comments=_.sortBy(s,({timestamp:e})=>e).map(e=>(e.pinned&&(e.marker=String.fromCharCode("a".charCodeAt(0)+n),n++),e)),this.events=e.getDataGraph().events||[],this.calculateChecksum()}}getCommentDisplayMode(e){if(!e.hasMenu()||!e.getMenu().hasCommentDisplayTypeMenu())return;const t=e.getMenu().getCommentDisplayTypeMenu().getFirstSelectedEntryRecursively();return void 0!==t?t.getMappedId():void 0}calculateChecksum(){this.internalCheckSum=i.StringUtils.calculateHash(`${JSON.stringify(this.grid)}${this.logarithmicY}${this.logarithmicX}${this.timeInterval}${JSON.stringify(this.events)}`)}buildGridData(e,t,i){const r=void 0!==t.getDataSource()&&t.getDataSource().adaptive_legend,a=new s.FragmentCanvasChartGridTicks(e.getColumns()),c=new o.FragmentCanvasChartGridRange(e.getRows(),r),l=t.getPageState().getAllowedPages().isInstantDiscovery()?5:Number.MAX_VALUE;return i===n.CanvasChartGridDirection.NORMAL?{xAxis:a,yAxis:c,direction:i,xAxisPlacement:c.min<0?n.CanvasChartGridAxisPlacement.CENTER:n.CanvasChartGridAxisPlacement.START,yAxisPlacement:n.CanvasChartGridAxisPlacement.START,ticks:a,range:c,maxTickLines:l}:{xAxis:c,yAxis:a,direction:i,xAxisPlacement:n.CanvasChartGridAxisPlacement.START,yAxisPlacement:c.min<0?n.CanvasChartGridAxisPlacement.CENTER:n.CanvasChartGridAxisPlacement.START,ticks:a,range:c,maxTickLines:l}}}}),define("classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment",["require","exports","widget_base","reusable_utilities","data_structures","abstract_canvas_chart","xstream","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model","font_saver_service"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractCanvasChartFragment=class extends o.AbstractCanvasChartContainer{constructor(e,t=[]){super(),this.disposeToken=new n.CancellationToken,this.mediatorMessageConfigs=[],this.mediatorMessageConfigs=t.map(e=>"string"==typeof e?{type:e}:e),this.fragmentModel=e}getDataGraph(e){let t=e.getDataGraph().payloadDataGraph;return e.getPayloadValue().chart_data_graph&&(t=e.getPayloadValue().chart_data_graph),new s.DataGraphWrapper(t)}async initialize(e,t,n){this.settings=n,this.chartContainer=e,this.mediator=t;const s=document.createElement("span");this.chartContainerSpan=s;const a=$(e);a.find(".canvas-container-placeholder").length>0?a.find(".canvas-container-placeholder").replaceWith(s):a.append(s),void 0!==this.fragmentModel.widget.getDataGraph()&&(this.model=await this.modelFactory(this.getDataGraph(this.fragmentModel.widget),this.fragmentModel.widget,n)),this.chart=this.chartFactory(s,n,this.createMediatorStream(t,this.mediatorMessageConfigs),this.fragmentModel.widget.isClickable()),this.chart.setLowPrecisionFormatter(n.style.formatting.lowPrecisionFormatter),this.fragmentModel.widget.hasReplayManager()&&(this.chart.enableReplay(),t.listen(i.REPLAY_ACTIONS.PROGRESS,({progress:e})=>{this.chart&&!this.chart.rendering&&this.chart.updateReplayProgress(e)},{token:this.disposeToken})),e.querySelector("canvas").chart=this.chart;const c=this.chart.initialize();if(c instanceof r.Stream){const e=c.subscribe(o.CanvasChartUtils.createStreamListener(e=>{t.dispatch(e.type,e.message,e.channel)}));this.disposeToken.addCleanupFunction(()=>{e.unsubscribe()})}return Promise.resolve(this)}async reInitialize(e){return this.chartContainerSpan&&$(this.chartContainerSpan).replaceWith($('<span class="canvas-container-placeholder"></span>')),this.reset(),this.disposeToken.cancel(),this.disposeToken=new n.CancellationToken,await this.initialize(this.chartContainer,this.mediator,e)}createMediatorStream(e,t){return r.Stream.createWithMemory({start:i=>{t.forEach(t=>{e.listen(t.type,e=>{i.next({type:t.type,message:e})},{channelFilter:t.channel,token:t.cancellationToken})})},stop:()=>{}})}async update(e){return this.fragmentModel=e,void 0!==e.widget.getDataGraph()&&(this.model=await this.modelFactory(new s.DataGraphWrapper(e.widget.getDataGraph().payloadDataGraph),e.widget,this.settings)),this}async draw(e){this.model instanceof a.FragmentCanvasGridChartModel&&await c.fontSaverService.saveFont(c.SaveableFontName.RobotoR,this.model.grid.ticks.ticks.map(e=>e.formattedLabel+e.label).join("").split(""),this),this.settings=e;const{width:t,height:i,x:n,y:s}=e.dimensions;return await this.drawChart(t,i,n,s,this.model),this}dispose(){super.dispose(),this.model instanceof a.FragmentCanvasGridChartModel&&c.fontSaverService.freeFont(c.SaveableFontName.RobotoR,this),this.disposeToken.cancel();const e=this.chartContainer.querySelector("canvas");e&&delete e.chart,this.chartContainer=void 0,this.chart=void 0}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1.55,heightScalePriority:1,minWidth:0,minHeight:0}],e=>({width:e.dimensions.width||0,height:e.dimensions.height||0}))}}}),define("classes/widget/fragments/canvas_chart/models/fragment_line_chart_model",["require","exports","event_bus","graphics_utilities","reusable_utilities","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentLineChartModel=class extends o.FragmentCanvasGridChartModel{constructor(e,t){super(e,t),this.datagraph=e,this.showArea=!1,this.canShowBackground=!1,this.isStacked=!1,this.isCurved=!0,this.highestCommentValue=0,this.lines=this.buildLineData(e,t)}buildLineData(e,t){const i={};return e.getColumns().forEach(o=>{o.getCells().forEach(r=>{const a=r.getRow().getCode();void 0===i[a]&&(i[a]={min:r.getRow().getValueBounds().min,max:r.getRow().getValueBounds().max,values:[],totalPositive:0,totalNegative:0,color:{top:n.Color.fromARGBString(r.getRow().getColor()),bottom:n.Color.fromARGBString(r.getRow().getColor())}});const c=isNaN(r.getValue())?0:r.getValue();c>0?i[a].totalPositive+=c:i[a].totalNegative+=c;const l=this.comments.filter(({row_key:e,timestamp:t})=>o.getCode()&&parseInt(o.getCode(),10)===t&&e===r.getRow().getCode());let d;l.length>0&&(d=d={comments:l,displayType:this.commentDisplayMode,widgetId:t.getId()},"SHOW_ALL_COMMENTS"!==this.commentDisplayMode&&"ALWAYS_OPEN"!==this.commentDisplayMode||(this.highestCommentValue=Math.max(this.highestCommentValue,c))),i[a].values.push({value:c,percentageBased:r.isPercentageBased(),popoverHeader:"datetime"===r.getColumn().getColumn().data_type?r.getColumn().getColumn().name_formatted_full+(r.getColumn().getColumn().name_formatted_time?" ("+r.getColumn().getColumn().name_formatted_time+")":""):null,formattedLabel:o.getFormattedLabel(),color:n.Color.fromARGBString(r.getColor()),filters:[s.StringUtils.parseFilters(r.getRow().getFilters()),o.getFilter()].filter(e=>e.length>0),commentInfo:d,dropdownData:this.createDropDownData(t,r.getRow(),o,r),comments:l.map(e=>(e.display_type=this.commentDisplayMode,e)),subLabel:r.getRow().getLabel(!0),requestedPageType:r.getRequestedPageType(),isCutOff:void 0!==o.getMetadata().getAssociatedColumn().cut_off_type,drilldownEnabled:e.isClickable()&&!0!==o.getColumn().drilldown_disabled}),i[a].values[i[a].values.length-1].isCutOff&&(i[a].values[i[a].values.length-1]=Object.assign({},i[a].values[i[a].values.length-1],{value:0,formattedLabel:""}))})}),i}createDropDownData(e,t,n,o){const r=[];if(e.canEditComments()&&e.hasDataGraph()){const a=this.datagraph.getCommentsWithMarkers(!0).length,c=this.datagraph.findComment(t.getCode(),parseInt(n.getCode(),10));!0!==n.getColumn().drilldown_disabled&&r.push({text:"_489448",icon:"fa fa-bars",onClick(){i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_SHOW_DETAILS,value:{filters:[s.StringUtils.parseFilters(o.getRow().getFilters()),n.getFilter()].filter(e=>e.length>0),requestedPageType:o.getRequestedPageType()}})}}),c||r.push({text:"_1745684",icon:"fa fa-comment-o",onClick:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_COMMENT_ADD,value:{row:t,column:n,widget:e,nestedId:this.nestedId,isIndicator:this.isExternalData&&!this.isNestedData,nestedIndex:this.isNestedData?0:void 0}})}}),c&&r.push({text:"_1745676",icon:"fa fa-pencil",onClick:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_COMMENT_EDIT,value:{row:t,column:n,widget:e,nestedId:this.nestedId,isIndicator:this.isExternalData&&!this.isNestedData}})}}),void 0!==c&&!c.pinned&&a<5&&r.push({text:"_1745686",icon:"fa fa-thumb-tack",onClick:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_COMMENT_PIN,value:{comment:c,widget:e,nestedId:this.nestedId,isIndicator:this.isExternalData&&!this.isNestedData}})}}),void 0!==c&&!0===c.pinned&&r.push({text:"_1745687",icon:"fa fa-thumb-tack fa-rotate-90",onClick:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_COMMENT_UNPIN,value:{comment:c,widget:e,nestedId:this.nestedId,isIndicator:this.isExternalData&&!this.isNestedData}})}}),c&&r.push({text:"_1745680",icon:"fa fa-trash-o",onClick:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.LINE_CHART_COMMENT_REMOVE,value:{comment:c,widget:e,nestedId:this.nestedId,isIndicator:this.isExternalData&&!this.isNestedData}})}})}return r}}}),define("classes/widget/fragments/canvas_chart/line_chart_fragment",["require","exports","line_chart","math_utils","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","classes/widget/fragments/canvas_chart/models/fragment_line_chart_model"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.COMMENT_BUBBLE_HEIGHT=64;t.LineChartFragment=class extends s.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"]),this.isEditMode=!1,this.shouldReinitialize=!1}async modelFactory(e,t){return this.isEditMode=t.getPageState().isEditMode(),new o.FragmentLineChartModel(e,t)}async update(e){const t=this.model?this.model.highestCommentValue:0,i=this.model&&this.model.logarithmicY;return await super.update(e),(t!==this.model.highestCommentValue||i&&this.model.highestCommentValue>0&&i!==this.model.logarithmicY)&&(this.shouldReinitialize=!0),this}async draw(e){const{width:t,height:i,x:n,y:s}=e.dimensions;return this.shouldReinitialize&&await super.reInitialize(e),this.shouldReinitialize=!1,this.settings=e,await this.drawChart(t,i,n,s,this.model),this}chartFactory(e,s,o,r){$(e).addClass("canvas-line-chart");let a=15;if(this.model.highestCommentValue>0){const e=s.dimensions.height-(a+30),i=n.generalMathUtils.linearScale({min:0,max:this.model.grid.range.max},{min:0,max:e},this.model.logarithmicY?n.generalMathUtils.reverseLog({min:0,max:this.model.grid.range.max},{min:0,max:this.model.grid.range.max},this.model.highestCommentValue):this.model.highestCommentValue);a=Math.max(a,5+t.COMMENT_BUBBLE_HEIGHT-(s.dimensions.height-i-t.COMMENT_BUBBLE_HEIGHT))}return new i.LineChart({size:new n.Vector2D(s.dimensions.width,s.dimensions.height),position:new n.Vector2D(s.dimensions.x,s.dimensions.y),model:this.model},{containerSpan:e,enableGraphSlicer:r&&!this.isEditMode,initialAnimationEnabled:1===s.animationStrategy,initialAnimationDuration:s.animationDuration,margins:new n.Vector4D(a,30,0,0),resolutionScale:s.style.resolutionScale,numberFormatter:s.style.formatting.numberFormatter,mediatorStream:o,isClickable:r,yAxis:{hideBaseLine:!0,hideZeroLabel:!0,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasYAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels()},xAxis:{hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasXAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels()},showDaySeparators:!0,synchronizeLeftGridMargins:!0,closeCommentsOnStart:!0})}}}),define("classes/widget/fragments/canvas_chart/net_sentiment_chart_fragment",["require","exports","abstract_canvas_chart","graphics_utilities","line_chart","math_utils","classes/widget/fragments/canvas_chart/line_chart_fragment","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.NetSentimentChartFragment=class extends r.LineChartFragment{async modelFactory(e,t){const s=await super.modelFactory(e,t);s.isCurved=!1;const o=s.grid.yAxis;o.min=-100,s.grid.xAxisPlacement=i.CanvasChartGridAxisPlacement.CENTER,o.max=100,s.checkSum=void 0,s.showArea=1===Object.keys(s.lines).length,s.canShowBackground=!0,s.isCurved=!0;const r=Object.keys(s.lines);if(1===r.length){const e=n.Color.fromHex(a.contextData.sentimentColors.positive),t=n.Color.fromHex(a.contextData.sentimentColors.negative);s.lines[r[0]].color={top:e,bottom:t}}return s}chartFactory(e,t,i,r){return $(e).removeClass("canvas-line-chart").addClass("canvas-net-sentiment-chart"),new s.LineChart({size:new o.Vector2D(t.dimensions.width,t.dimensions.height),position:new o.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{containerSpan:e,enableGraphSlicer:r,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:new o.Vector4D(15,30,0,0),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:i,isClickable:r,yAxis:{hideBaseLine:!1,hideZeroLabel:!1},showDaySeparators:!1,synchronizeLeftGridMargins:!0,sentimentColors:{positive:n.Color.fromHex(a.contextData.sentimentColors.positive),negative:n.Color.fromHex(a.contextData.sentimentColors.negative)}})}}}),define("classes/widget/fragment_controllers/area_chart_widget_blueprint_enhancer",["require","exports","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","classes/widget/fragments/directive/sidenote_fragment","services/comments","classes/widget/widget_fragment_factory/widget_layout_block_id","canvas_chart_utilities","classes/widget/fragments/directive/no_data_fragment","classes/widget/fragments/canvas_chart/net_sentiment_chart_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.AreaChartWidgetBlueprintEnhancer=class extends i.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const i=t.widget;return e===n.SidenoteFragment?i.hasDataGraph()&&i.getDataGraph().hasComments()&&s.commentsService.getCommentDisplayMode(i)===constants.comments.display_type.show_as_footnote:super.canShowFragment(e,t)}enhanceBlueprint(e,t){return t.isNetSentiment()&&e.layout[o.WidgetLayoutBlockId.BODY][0]!==a.NoDataFragment&&(t.getPageState().getAllowedPages().isInstantDiscovery()?e.layout[o.WidgetLayoutBlockId.BODY]=[c.NetSentimentChartFragment,n.SidenoteFragment]:e.layout[o.WidgetLayoutBlockId.BODY]=[c.NetSentimentChartFragment,r.LegendFragment,n.SidenoteFragment]),super.enhanceBlueprint(e,t)}}}),define("classes/widget/fragments/directive/globe_fragment",["require","exports","classes/widget/fragment_bases/abstract_directive_fragment","widget_base","reusable_utilities"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.GlobeFragment=class extends i.AbstractDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:1.16,heightScalePriority:1,minHeight:500,minWidth:200,aspectRatio:1}],e=>this.getDimensionsForLayout(e))}get directiveData(){return{selector:"tw-globe",args:{widget:this.model.widget,fragment:this}}}async draw(e){return super.draw(e),await s.waitFor(1e3),this}getXOrder(){return-1}}}),define("classes/widget/fragment_controllers/article_widget_blueprint_enhancer",["require","exports","talkwalker_constants","classes/widget/fragments/directive/globe_fragment","classes/widget/fragment_controllers/default_widget_blueprint_enhancer"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.ArticleWidgetBlueprintEnhancer=class extends s.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const s=t.widget;return e===n.GlobeFragment?s.getDataTypeUuid()===i.DataType.RESULTSLIST_WORLD_MAP:super.canShowFragment(e,t)}}}),define("classes/widget/fragment_controllers/counter_widget_blueprint_enhancer",["require","exports","counter","reusable_components","classes/widget/fragment_controllers/default_widget_blueprint_enhancer"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.CounterWidgetBlueprintEnhancer=class extends s.DefaultWidgetBlueprintEnhancer{enhanceBlueprint(e,t){const s=t.getPageState().getAllowedPages();let o=i.PartitionedValueItemPoolStrategy;return s.isCommandCenterScreen()||(o=n.SingleValueNoPoolStrategy),e.buildConfigurations=e.buildConfigurations.extend([{key:i.CounterFragment,value:{itemPoolStrategy:o}}]),e}}}),define("classes/widget/fragment_controllers/line_chart_widget_blueprint_enhancer",["require","exports","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","classes/widget/fragments/directive/sidenote_fragment","services/comments"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.LineChartWidgetBlueprintEnhancer=class extends i.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const i=t.widget;return e===n.SidenoteFragment?i.hasDataGraph()&&i.getDataGraph().hasComments()&&s.commentsService.getCommentDisplayMode(i)===constants.comments.display_type.show_as_footnote:super.canShowFragment(e,t)}}}),define("classes/widget/fragments/legacy_directive/message_diffusion_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.MessageDiffusionChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-message-diffusion"}}}),define("classes/widget/fragment_controllers/message_diffusion_widget_blueprint_enhancer",["require","exports","classes/widget/fragments/directive/globe_fragment","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","classes/widget/fragments/legacy_directive/message_diffusion_chart_fragment","canvas_chart_utilities"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.MessageDiffusionWidgetBlueprintEnhancer=class extends n.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const n=t.widget;return n.getMenu().getViewModeMenu().getFirstSelectedEntryRecursively(),e===i.GlobeFragment||e===o.LegendFragment?n.isGlobe():e===s.MessageDiffusionChartFragment?!n.isGlobe():super.canShowFragment(e,t)}}}),define("classes/widget/fragment_controllers/openlayers_world_map_blueprint_enhancer",["require","exports","classes/widget/fragment_controllers/default_widget_blueprint_enhancer"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.OpenlayersWorldMapBlueprintEnhancer=class extends i.DefaultWidgetBlueprintEnhancer{enhanceBlueprint(e,t){return t.isChoroplethMap()&&(e.showEvenIfNoData=!1),super.enhanceBlueprint(e,t)}}}),define("classes/widget/fragment_controllers/text_blueprint_enhancer",["require","exports","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","talkwalker_constants"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TextBlueprintEnhancer=class extends i.DefaultWidgetBlueprintEnhancer{enhanceBlueprint(e,t){return t.getPageState().getAllowedPages().isCommandCenterScreen()&&this.isImage(t)&&(e.noMargin=!0),e}isImage(e){return e.getConfigurationRenderingUuid()===n.ConfigurationDefaultsEnum.UUID_CONFIG_TEXT_IMAGE}}}),define("classes/widget/fragment_controllers/wheel_chart_widget_blueprint_enhancer",["require","exports","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","canvas_chart_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.WheelChartWidgetBlueprintEnhancer=class extends i.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const i=t.widget;return(e!==n.LegendFragment||void 0===i.getPayloadValue().chart_data_graph||void 0===i.getPayloadValue().chart_data_graph.column_groups||i.getPayloadValue().chart_data_graph.column_groups.length<2)&&super.canShowFragment(e,t)}}}),define("classes/widget/fragments/canvas_chart/models/fragment_activity_chart_grid_ticks",["require","exports","abstract_canvas_chart","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentActivityChartGridTicks=class extends i.CanvasChartGridTicks{constructor(e){super(),this.checksum=0,this.ticks=[],this.ticks=e.slice().reverse().map((e,t)=>({label:e.getLabel(),formattedLabel:e.getFormattedLabel().substr(0,3).toUpperCase(),newDay:!1,value:t,hasTimeStamp:!1})).reverse(),this.checksum=n.StringUtils.calculateHash(this.ticks.reduce((e,t)=>e+=t.value.toString()+t.formattedLabel+t.hasTimeStamp+t.label+t.newDay+t.isCutOff,""))}}}),define("classes/widget/fragments/canvas_chart/models/fragment_fixed_grid_range",["require","exports","reusable_utilities","abstract_canvas_chart"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentFixedGridRange=class extends n.CanvasChartGridRange{constructor(e,t,n){super(),this.checksum=0,this.percentageBased=!1,this.min=e,this.max=t,this.numRangeSteps=n,this.checksum=i.StringUtils.calculateHash(""+this.percentageBased+this.max+this.min)}}}),define("classes/widget/fragments/canvas_chart/models/fragment_activity_chart_model",["require","exports","abstract_canvas_chart","classes/widget/fragments/canvas_chart/models/fragment_activity_chart_grid_ticks","classes/widget/fragments/canvas_chart/models/fragment_fixed_grid_range","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a extends o.FragmentCanvasGridChartModel{constructor(e,t){super(e,t),this.min=Number.MAX_VALUE,this.max=0,this.totalLabel="",this.frames=[],this.parseData(e,t)}parseData(e,t){let i=!1;this.activities=[],this.totalLabel=e.getLabel()?e.getLabel():r.contextData.getMessage("_281677"),e.getRows().slice().reverse().forEach((e,t)=>{e.getCells().forEach((e,n)=>{this.activities[n]||(this.activities[n]=[]);const s=e.getValue();s&&(i=!0,this.min=Math.min(this.min,s),this.max=Math.max(this.max,s)),this.activities[n][t]={value:e.getValue(),day:e.getRow().getLabel(),hour:e.getColumn().getFormattedLabel()}})}),i||(this.min=0,this.max=0),e.getAdditionalFrames().forEach(e=>{this.frames.push(new a(e,t))})}buildGridData(e,t){const o=new n.FragmentActivityChartGridTicks(e.getRows()),r=new s.FragmentFixedGridRange(0,23,24);return{xAxis:r,yAxis:o,direction:i.CanvasChartGridDirection.INVERTED,xAxisPlacement:i.CanvasChartGridAxisPlacement.START,yAxisPlacement:i.CanvasChartGridAxisPlacement.START,range:r,ticks:o,maxTickLines:Number.MAX_VALUE}}}t.FragmentActivityChartModel=a}),define("classes/widget/fragments/canvas_chart/activity_chart_fragment",["require","exports","math_utils","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","activity_chart","classes/widget/fragments/canvas_chart/models/fragment_activity_chart_model"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.ActivityChartFragment=class extends n.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"])}async modelFactory(e,t){return new o.FragmentActivityChartModel(e,t)}chartFactory(e,t,n,o){return new s.ActivityChart({size:new i.Vector2D(t.dimensions.width,t.dimensions.height),position:new i.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{containerSpan:e,xAxis:{hideBaseLine:!0,hideDashedLines:!0,hideZeroLine:!0,startLinesAtMargin:!0,labelMargin:15},yAxis:{hideZeroLine:!0,labelMargin:15,hideBaseLine:!0,hideZeroLabel:!0,centerLabelsOnDashedLines:!0},showAllTicks:!0,putAxisLayerOnTop:!0,enableGraphSlicer:o,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:new i.Vector4D(20,30,20,10),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:n,isClickable:o},t.style.colorPalette)}}}),define("classes/widget/fragments/canvas_chart/area_chart_fragment",["require","exports","classes/widget/fragments/canvas_chart/line_chart_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AreaChartFragment=class extends i.LineChartFragment{async modelFactory(e,t){const i=await super.modelFactory(e,t);return i.showArea=!0,i}}}),define("classes/widget/fragments/canvas_chart/models/fragment_bar_chart_model",["require","exports","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model","reusable_utilities","graphics_utilities"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentBarChartModel=class extends i.FragmentCanvasGridChartModel{constructor(e,t,i){super(e,t,i),this.groups={},this.biggestGroupTotal=0,this.barTotals={},this.totalResults=0,this.allItems=[],this.hasTimeStamps=e.getStartTimestamp()>0;const n="d1"===this.timeInterval&&this.hasTimeStamps;let o=0;e.getColumns().forEach(t=>{if(!n||t.getColumn().new_day){const i={items:{},total:0,numItems:0,biggestValue:0};t.getCells().forEach(n=>{const o=isNaN(n.getNumericData())?0:n.getNumericData();i.total+=o,i.biggestValue=Math.max(i.biggestValue,o),i.numItems++;const r=n.getRow().getCode();void 0===this.barTotals[r]&&(this.barTotals[r]=0),this.barTotals[r]+=o,this.totalResults+=o,i.items[r]={columnLabel:t.getFormattedLabel(),cellLabel:n.getRow().getFormattedLabel(!0),requestedPageType:n.getRequestedPageType(),value:o,formattedValue:n.getFormattedValue(),oldValue:n.getOldNumericData(),isPercentageBased:n.isPercentageBased(),color:s.Color.fromARGBString(n.getColor()),drillDownEnabled:e.isClickable()&&!0!==t.getColumn().drilldown_disabled,popoverHeader:n.getCell().popover?n.getCell().popover.title:"datetime"===n.getColumn().getColumn().data_type?n.getColumn().getColumn().name_formatted_full+(n.getColumn().getColumn().name_formatted_time?" ("+n.getColumn().getColumn().name_formatted_time+")":""):null,popoverValueLabel:n.getCell().popover?n.getCell().popover.label:t.getFormattedLabel(),popoverDisplayValue:n.getFormattedValue()||0,rowCode:r,isCutOff:void 0!==t.getMetadata().getAssociatedColumn().cut_off_type,filters:this.buildFilters(n,t)},i.items[r].isCutOff&&(i.items[r].value=0,i.items[r].cellLabel="",i.items[r]=Object.assign({},i.items[r],{value:0,columnLabel:"",cellLabel:"",formattedValue:"",popoverValueLabel:"",popoverDisplayValue:0})),this.allItems.push(i.items[r])}),this.biggestGroupTotal=Math.max(i.total,this.biggestGroupTotal),this.groups[this.hasTimeStamps?t.getCode():o]=i,o++}})}buildFilters(e,t){let i=[];const s=t.getFilter();s&&s.length>0&&(i=i.concat([s]));const o=n.StringUtils.parseFilters(e.getRow().getFilters());return o&&o.length>0&&(i=i.concat([o])),i.filter(e=>e.length>0)}}}),define("classes/widget/fragments/canvas_chart/bar_chart_fragment",["require","exports","widget_base","bar_chart","math_utils","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","abstract_canvas_chart","classes/widget/fragments/canvas_chart/models/fragment_bar_chart_model"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=30;class l extends o.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"]),this.isAnalytics=!1,this.shouldReinitialize=!1,this.renderConfig=this.fragmentModel.widget.getDic().configuration_rendering.bar_chart,this.model=this.createModel(this.getDataGraph(this.fragmentModel.widget),this.fragmentModel.widget),this.isAnalytics=!this.fragmentModel.widget.getPageState().isGridPage()&&!this.fragmentModel.widget.getPageState().getAllowedPages().isCommandCenterScreen()}async update(e){await super.update(e);const t=this.fragmentModel.widget.getDic().configuration_rendering.bar_chart;return this.renderConfig.stacking_mode===t.stacking_mode&&this.renderConfig.orientation_mode===t.orientation_mode||(this.shouldReinitialize=!0),this.renderConfig=t,this}static adjustTicks(e,t,i){let s=e.grid.ticks.ticks;if(t&&"d1"===e.timeInterval&&(s=s.filter(e=>e.newDay)),i.orientation_mode===n.BarChartOrientation.HORIZONTAL&&(e.logarithmicX=e.logarithmicY,e.logarithmicY=!1),s.length>0){const i=s[0].value,n=s.length>1?s[1].value:t?2*i:i+1,o=s[s.length-1].value,r=n-i;e.grid.ticks.ticks.unshift({label:"",value:i-r/2,formattedLabel:"",hasTimeStamp:t,newDay:t}),e.grid.ticks.ticks.push({label:"",value:o+r/2,formattedLabel:"",hasTimeStamp:t,newDay:t})}}createModel(e,t){const i=new a.FragmentBarChartModel(e,t,this.renderConfig.orientation_mode===n.BarChartOrientation.VERTICAL?r.CanvasChartGridDirection.NORMAL:r.CanvasChartGridDirection.INVERTED);if(l.adjustTicks(i,i.hasTimeStamps,this.renderConfig),this.renderConfig.stacking_mode.indexOf("STACK")>-1)i.grid.range.max=i.biggestGroupTotal,this.renderConfig.stacking_mode.indexOf("PERCENT")>-1&&(i.grid.range.percentageBased=!0,i.grid.range.min=i.grid.range.min<0?-100:0,i.grid.range.max=100),i.grid.range.adapt();else if(this.renderConfig.stacking_mode.indexOf("PERCENT")>-1){i.grid.range.percentageBased=!0;let e=0;i.allItems.forEach(t=>{t.popoverValueLabel=`${t.value}`,t.value=t.value/i.totalResults*100,e=Math.max(t.value,e)}),i.grid.range.max=e>10?10*Math.ceil(e/10):Math.ceil(e),i.grid.range.min=i.grid.range.min<0?-i.grid.range.max:0}return i}async modelFactory(e,t){return this.createModel(e,t)}chartFactory(e,t,i,o){return $(e).addClass("canvas-bar-chart"),new n.BarChart({size:new s.Vector2D(t.dimensions.width,t.dimensions.height),position:new s.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{containerSpan:e,enableGraphSlicer:o,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:r.canvasMargin({top:this.isAnalytics||this.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL?15:0,left:0,right:30,bottom:0}),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:i,isClickable:o,yAxis:{hideBaseLine:this.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL,hideZeroLabel:!(this.model.grid.range.min<0),centerLabelsOnDashedLines:this.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL,hideDashedLines:this.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasYAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels()},xAxis:{hideBaseLine:this.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL,hideDashedLines:this.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasXAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels()},showDaySeparators:!0,renderConfig:this.renderConfig,showAllTicks:!this.model.hasTimeStamps||this.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL,minBarHeight:c,synchronizeLeftGridMargins:this.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL,labelSettings:{showLabel:!0,showResults:!0}})}async draw(e){return(e.dimensions.height!==this.settings.dimensions.height||e.dimensions.width!==this.settings.dimensions.width||this.shouldReinitialize)&&await super.reInitialize(e),this.shouldReinitialize=!1,super.draw(e)}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1.55,heightScalePriority:1,minWidth:0,minHeight:0}],e=>{let t=e.dimensions.height||0;if(this.isAnalytics){const e=33;t=t>0?t:2*c;const i=this.renderConfig.stacking_mode.indexOf("STACK")>-1;if(this.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL){const n=Object.keys(this.model.groups);t=i?Math.max(t,n.length*c)+e:Math.max(t,this.model.allItems.length*c)+e}}return{width:e.dimensions.width||0,height:t}})}}t.BarChartFragment=l}),define("classes/widget/fragments/canvas_chart/models/fragment_cloud_model",["require","exports","classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_model","cloud","data_structures","graphics_utilities","reusable_utilities","reusable_services","classes/context_data/context_data","font_saver_service"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentCloudModel=class extends i.FragmentCanvasChartModel{constructor(e,t,i,s=!1,a){super(e,t),this.items=[],this.isGradientCloud=!1,this.imageLoadPromises=[],this.isAnalytics=!1;const d=t.getPayloadValue(),g=d.tree;if(this.isGradientCloud=s,this.isAnalytics=!t.getPageState().isGridPage(),void 0===g)return;this.isGradientCloud&&(this.cloudGradientNames=a,this.gradientWrapper=new n.GradientWrapper([g.root.positive_hits>0&&{hsl:o.Color.fromHex(c.contextData.sentimentColors.positive).toHSL(),name:a.positive,maxValue:g.root.positive_hits},g.root.neutral_hits>0&&{hsl:o.Color.fromHex(c.contextData.sentimentColors.neutral).toHSL(),name:a.neutral,maxValue:g.root.neutral_hits},g.root.negative_hits>0&&{hsl:o.Color.fromHex(c.contextData.sentimentColors.negative).toHSL(),name:a.negative,maxValue:g.root.negative_hits}].filter(e=>e)));const u=r.TWTreeUtils.retrieveAllLeavesRecursively(g),p=void 0!==t.getMenu().getHashtagMenu()&&void 0!==t.getMenu().getHashtagMenu().getSelectedEntriesLeavesRecursively()&&void 0!==t.getMenu().getHashtagMenu().getSelectedEntriesLeavesRecursively()[0]&&t.getMenu().getHashtagMenu().getSelectedEntriesLeavesRecursively()[0].getMappedId();this.items=this.createItems(u,d.delete_link,p,i,e.getRows()[0].getRow().requested_page_type),this.orientation=1===t.getConfigurationRendering().theme_cloud.orientation_count?n.CloudModelOrientation.HORIZONTAL:n.CloudModelOrientation.MIXED;let h=!1;for(const{text:e}of this.items)if(e.length>20){h=!0;break}this.settings={fontFamily:l.SaveableFontName.SourceSansProB,padding:this.isGradientCloud?2:3,fontSizingStrategy:h&&this.items.length>=100?n.CloudFontSizingStrategy.MIXED:n.CloudFontSizingStrategy.LOGARITHMIC,fontWeight:o.DrawableTextWeight.NORMAL,positioningShape:n.CloudPositioningShape.CIRCLE}}get checkSum(){return r.StringUtils.calculateHash(JSON.stringify(this.toSerializable()))}toSerializable(){const e=super.toSerializable();return e.orientation=this.orientation,e.items=this.items.map(e=>Object.assign({},e)),e}createItems(e,t,i,o,c){return e.map(e=>{const l=this.getNodeText(e),d=a.emojiService.parseTextForEmoji(e.name),g=r.StringUtils.isIMGOnly(d)?n.CloudModelItemType.IMAGE:n.CloudModelItemType.TEXT;let u,p=void 0===o||o.style.colorPalette.themeType!==n.CloudThemeType.DARK&&o.style.colorPalette.themeType!==n.CloudThemeType.NAVY||void 0===e.alternate_light_color?e.alternate_color||e.color:e.alternate_light_color;if(this.isGradientCloud){const t=this.gradientWrapper.getColorForValues({[this.cloudGradientNames.positive]:e.positive_hits,[this.cloudGradientNames.neutral]:e.neutral_hits,[this.cloudGradientNames.negative]:e.negative_hits});p=t.toHex8(),u=Math.round(100*t.toHSL().x)/100}const h={text:l,color:p,metric:Object.assign({},e.metric),tendency:new s.Tendency(e.metric.value,e.metric.previous_value),filter:[r.StringUtils.parseFilters(e.filter)],requestedPageType:c,deleteLink:t,id:e.id,type:g,percentageBasedValue:e.metric.value/e.total_document_count,hashTagMappeId:i,hue:u,name:e.name,popoverData:{header:"",node:{color:p,label:l},values:[e.metric]}};return g===n.CloudModelItemType.IMAGE&&this.imageLoadPromises.push(new Promise((t,i)=>{a.emojiService.parseTextForCanvasEmoji(e.name).then(e=>{h.imageElement=$(e)[0],h.imageElement.addEventListener("load",()=>{t()}),h.imageElement.addEventListener("error",()=>{i()})})})),h})}getNodeText(e){let t;return t=void 0!==e.translated_name?e.translated_name:e.name,r.StringUtils.recoverApostrophes(t)}get shouldShowBlockThemeButton(){return!this.widget.getPageState().getAllowedPages().isSearchAdvanced()&&!this.widget.getPageState().getAllowedPages().isFreeSearch()}get shouldShowDeleteThemeButton(){return this.widget.getPageState().getAllowedPages().isDashboard()||this.widget.getPageState().getAllowedPages().isCommandCenterWidgetPreview()}}}),define("classes/widget/fragments/canvas_chart/cloud_fragment",["require","exports","cloud","math_utils","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","classes/widget/fragments/canvas_chart/models/fragment_cloud_model","font_saver_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.CloudFragment=class extends s.AbstractCanvasChartFragment{constructor(e){super(e),this.fontPromise=Promise.resolve()}async modelFactory(e,t,i){const n=new o.FragmentCloudModel(e,t,i);for(const e of n.imageLoadPromises)await e;return n}chartFactory(e,t,s,o){return this.fontPromise=r.fontSaverService.saveFont(r.SaveableFontName.SourceSansProB,this.model.items.filter(e=>e.type!==i.CloudModelItemType.IMAGE).map(e=>e.text),this),new i.Cloud({size:new n.Vector2D(t.dimensions.width,t.dimensions.height),position:new n.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{resolutionScale:t.style.resolutionScale,containerSpan:e,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:s,isClickable:o})}dispose(){super.dispose(),r.fontSaverService.freeFont(r.SaveableFontName.SourceSansProB,this)}async draw(e){return await this.fontPromise,super.draw(e)}}}),define("classes/widget/fragments/canvas_chart/models/composed_graph_model",["require","exports","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model","classes/widget/fragments/canvas_chart/models/fragment_line_chart_model","classes/widget/fragments/canvas_chart/models/fragment_bar_chart_model","abstract_canvas_chart"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentComposedGraphModel=class extends i.FragmentCanvasGridChartModel{constructor(e,t){if(super(e,t),this.highestCommentValue=0,this.highestRangeValue=0,this.mainType=t.getGraphType(),this.secondaryType=t.getNestedGraphType(),this.primaryModel=this.createModel(this.mainType,e,t),this.secondaryModel=this.createModel(this.secondaryType,e.getAdditionalFrames()[0],t),this.primaryModel instanceof n.FragmentLineChartModel&&this.secondaryModel instanceof n.FragmentLineChartModel?this.primaryModel.highestCommentValue/this.primaryModel.grid.range.max>this.secondaryModel.highestCommentValue/this.secondaryModel.grid.range.max?(this.highestCommentValue=this.primaryModel.highestCommentValue,this.highestRangeValue=this.primaryModel.grid.range.max):(this.highestCommentValue=this.secondaryModel.highestCommentValue,this.highestRangeValue=this.secondaryModel.grid.range.max):[this.primaryModel,this.secondaryModel].forEach(e=>{e instanceof n.FragmentLineChartModel&&(this.highestCommentValue=e.highestCommentValue,this.highestRangeValue=e.grid.range.max)}),t.hasExtendedConfiguration()&&t.getExtendedConfiguration().hasZAxisConfiguration()&&t.getExtendedConfiguration().getZAxisConfiguration().shouldUseMainAxis()&&(this.secondaryModel.grid.range.max>this.primaryModel.grid.range.max?this.primaryModel.grid=this.secondaryModel.grid:this.secondaryModel.grid=this.primaryModel.grid),this.primaryModel instanceof n.FragmentLineChartModel&&this.secondaryModel instanceof n.FragmentLineChartModel){const e=this.primaryModel,t=this.secondaryModel,i=[];Object.keys(e.lines).forEach(t=>{e.lines[t].values.forEach(e=>{i.push(...e.comments)})}),Object.keys(t.lines).forEach(e=>{t.lines[e].values.forEach(e=>{i.push(...e.comments)})});let n=0;_.sortBy(i,({timestamp:e})=>e).forEach(e=>{e.pinned&&(e.marker=String.fromCharCode("a".charCodeAt(0)+n),n++)})}this.primaryModel.grid.yAxis2=this.secondaryModel.grid.yAxis}createModel(e,t,i){if(e.indexOf("AREA")>-1||e.indexOf("LINE")>-1){const s=new n.FragmentLineChartModel(t,i);return s.showArea=e.indexOf("AREA")>-1,s}if(e.indexOf("BAR")>-1||e.indexOf("COLUMN")>-1)return new s.FragmentBarChartModel(t,i,o.CanvasChartGridDirection.NORMAL);throw new Error(`Unknow composed graph widget type: ${e}`)}}}),define("classes/widget/fragments/canvas_chart/composed_graph_fragment",["require","exports","line_chart","math_utils","data_structures","xstream","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","abstract_canvas_chart","bar_chart","classes/widget/fragments/canvas_chart/models/composed_graph_model","classes/widget/fragments/canvas_chart/models/fragment_bar_chart_model","reusable_utilities","classes/widget/fragments/canvas_chart/bar_chart_fragment","classes/widget/fragments/canvas_chart/models/fragment_line_chart_model","classes/widget/fragments/canvas_chart/line_chart_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.ComposedGraphFragment=class extends r.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"]),this.isAnalytics=!1,this.shouldReinitialize=!1,this.renderConfig=this.getRenderconfig(this.fragmentModel.widget),this.isAnalytics=!this.fragmentModel.widget.getPageState().isGridPage()}getRenderconfig(e){const t=e.getDic().configuration_rendering.bar_chart,i=e.getNestedDics()&&e.getNestedDics()[0].getDic().configuration_rendering&&e.getNestedDics()[0].getDic().configuration_rendering.bar_chart,n=e.getDic().nested_data_input_configurations&&e.getDic().nested_data_input_configurations[0].configuration_rendering&&e.getDic().nested_data_input_configurations[0].configuration_rendering.bar_chart;return t||i||n||{orientation_mode:c.BarChartOrientation.VERTICAL,stacking_mode:c.BartChartStackingMode.NONE}}adjustRange(e){if(this.renderConfig.stacking_mode.indexOf("STACK")>-1)e.grid.range.max=e.biggestGroupTotal,this.renderConfig.stacking_mode.indexOf("PERCENT")>-1&&(e.grid.range.percentageBased=!0,e.grid.range.min=e.grid.range.min<0?-100:0,e.grid.range.max=100),e.grid.range.adapt();else if(this.renderConfig.stacking_mode.indexOf("PERCENT")>-1){e.grid.range.percentageBased=!0;let t=0;e.allItems.forEach(i=>{i.popoverValueLabel=`${i.value}`,i.value=i.value/e.totalResults*100,t=Math.max(i.value,t)}),e.grid.range.max=t>10?10*Math.ceil(t/10):Math.ceil(t),e.grid.range.min=e.grid.range.min<0?-e.grid.range.max:0}}async modelFactory(e,t){const i=this.model&&this.model.logarithmicY,n=this.model?this.model.highestCommentValue:0,s=new l.FragmentComposedGraphModel(e,t);return(n!==s.highestCommentValue||i&&s.highestCommentValue>0&&i!==s.logarithmicY)&&(this.shouldReinitialize=!0),s.primaryModel instanceof d.FragmentBarChartModel&&this.adjustRange(s.primaryModel),s.secondaryModel instanceof d.FragmentBarChartModel&&this.adjustRange(s.secondaryModel),(s.primaryModel instanceof d.FragmentBarChartModel||s.secondaryModel instanceof d.FragmentBarChartModel)&&(u.BarChartFragment.adjustTicks(s.primaryModel,s.primaryModel.grid.ticks.ticks[0].hasTimeStamp,this.renderConfig),u.BarChartFragment.adjustTicks(s.secondaryModel,s.secondaryModel.grid.ticks.ticks[0].hasTimeStamp,this.renderConfig)),s}createChart(e,t,s,o,{isClickable:r,isPrimary:l,rightOffset:d,closeCommentsOnStart:g}){let u=15;if(this.model.highestCommentValue>0){const e=s.dimensions.height-(u+30),t=n.generalMathUtils.linearScale({min:0,max:this.model.highestRangeValue},{min:0,max:e},this.model.logarithmicY?n.generalMathUtils.reverseLog({min:0,max:this.model.highestRangeValue},{min:0,max:this.model.highestRangeValue},this.model.highestCommentValue):this.model.highestCommentValue);u=Math.max(u,5+h.COMMENT_BUBBLE_HEIGHT-(s.dimensions.height-t-h.COMMENT_BUBBLE_HEIGHT))}const m={containerSpan:t,enableGraphSlicer:!1,initialAnimationEnabled:1===s.animationStrategy,initialAnimationDuration:s.animationDuration,margins:a.canvasMargin({top:u,left:0,right:30+d,bottom:30}),resolutionScale:s.style.resolutionScale,numberFormatter:s.style.formatting.numberFormatter,mediatorStream:o,isClickable:r,showDaySeparators:!0,hideGrid:!l,enforceGridMargins:!l,synchronizeLeftGridMargins:!0};return e instanceof p.FragmentLineChartModel?new i.LineChart({size:new n.Vector2D(s.dimensions.width,s.dimensions.height),position:new n.Vector2D(s.dimensions.x,s.dimensions.y),model:e},Object.assign({},m,{yAxis:{hideBaseLine:!0,hideZeroLabel:!0,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasYAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels()},xAxis:{hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasXAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels()},dashedLines:!l,closeCommentsOnStart:g})):new c.BarChart({size:new n.Vector2D(s.dimensions.width,s.dimensions.height),position:new n.Vector2D(s.dimensions.x,s.dimensions.y),model:e},Object.assign({},m,{yAxis:{hideBaseLine:this.renderConfig.orientation_mode!==c.BarChartOrientation.HORIZONTAL,hideZeroLabel:!0,centerLabelsOnDashedLines:this.renderConfig.orientation_mode===c.BarChartOrientation.HORIZONTAL,hideDashedLines:this.renderConfig.orientation_mode===c.BarChartOrientation.HORIZONTAL,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasYAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels()},xAxis:{hideBaseLine:this.renderConfig.orientation_mode===c.BarChartOrientation.HORIZONTAL,hideDashedLines:this.renderConfig.orientation_mode!==c.BarChartOrientation.HORIZONTAL,hideLabels:!(!this.fragmentModel.widget.hasExtendedConfiguration()||!this.fragmentModel.widget.getExtendedConfiguration().hasXAxisConfiguration())&&this.fragmentModel.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels()},renderConfig:this.renderConfig,showAllTicks:!e.hasTimeStamps||this.renderConfig.orientation_mode===c.BarChartOrientation.HORIZONTAL,minBarHeight:30,labelSettings:{showLabel:!0,showResults:!0},dashedLines:!l}))}chartFactory(e,t,i,n,s=!0){let o=0;this.model.primaryModel.grid.yAxis2 instanceof a.CanvasChartGridTicks?o=this.model.primaryModel.grid.yAxis2.ticks.reduce((e,t)=>Math.max(e,10*t.formattedLabel.length),0):this.model.primaryModel.grid.yAxis2 instanceof a.CanvasChartGridRange&&(o=this.model.primaryModel.grid.yAxis2.percentageBased?10*t.style.formatting.numberFormatter.toPercentage(this.model.primaryModel.grid.yAxis2.max/100).length:10*t.style.formatting.numberFormatter.toDecimal(this.model.primaryModel.grid.yAxis2.max).length);const r=s&&this.model.primaryModel instanceof p.FragmentLineChartModel||!s&&this.model.primaryModel instanceof d.FragmentBarChartModel;return this.createChart(s?this.model.primaryModel:this.model.secondaryModel,e,t,i,{isClickable:n,isPrimary:s,rightOffset:o,closeCommentsOnStart:r})}dispose(){super.dispose(),this.primaryChart.dispose(),this.secondaryChart.dispose()}async initialize(e,t,i){this.settings=i,this.chartContainer=e,this.mediator=t;const n=document.createElement("span"),r=$(e);if(r.find(".composed-graph-wrapper").length>0)r.find(".composed-graph-wrapper").children().remove(),r.find(".composed-graph-wrapper").append(n);else{const t=document.createElement("div");t.className="composed-graph-wrapper",t.appendChild(n),e.appendChild(t)}void 0!==this.fragmentModel.widget.getDataGraph()&&(this.model=await this.modelFactory(new s.DataGraphWrapper(this.fragmentModel.widget.getDataGraph().payloadDataGraph),this.fragmentModel.widget));const c=this.createMediatorStream(t,this.mediatorMessageConfigs);this.primaryChart=this.chartFactory(n,i,c,this.fragmentModel.widget.isClickable(),!0),this.primaryChart.setLowPrecisionFormatter(i.style.formatting.lowPrecisionFormatter),this.secondaryChart=this.chartFactory(n,i,c,this.fragmentModel.widget.isClickable(),!1),this.secondaryChart.setLowPrecisionFormatter(i.style.formatting.lowPrecisionFormatter);const l=o.Stream.merge(this.primaryChart.initialize(),this.secondaryChart.initialize());if(l instanceof o.Stream){const e=l.subscribe(a.CanvasChartUtils.createStreamListener(e=>{t.dispatch(e.type,e.message,e.channel)}));this.disposeToken.addCleanupFunction(()=>{e.unsubscribe()})}return Promise.resolve(this)}reset(){this.drawToken&&this.drawToken.cancel(),this.drawToken=void 0,this.primaryChart.dispose(),this.secondaryChart.dispose(),this.chart=void 0}updateChart(e,t,i,n){c.BarChart,e.update({size:i,position:n,model:t})}async update(e){if(this.fragmentModel=e,void 0!==e.widget.getDataGraph()){const e=this.model.primaryModel,t=this.model.secondaryModel;this.model=await this.modelFactory(new s.DataGraphWrapper(this.fragmentModel.widget.getDataGraph().payloadDataGraph),this.fragmentModel.widget),this.model.primaryModel instanceof i.LineChart==e instanceof i.LineChart&&this.model.secondaryModel instanceof i.LineChart==t instanceof i.LineChart||(this.shouldReinitialize=!0);const n=this.getRenderconfig(this.fragmentModel.widget);this.renderConfig.stacking_mode===n.stacking_mode&&this.renderConfig.orientation_mode===n.orientation_mode||(this.shouldReinitialize=!0),this.renderConfig=n}return this}async draw(e){const{width:t,height:i,x:n,y:s}=e.dimensions;return this.shouldReinitialize&&await super.reInitialize(e),this.shouldReinitialize=!1,this.settings=e,await this.drawChart(t,i,n,s,this.model),this}async drawChart(e,t,i,s,o){if(void 0!==this.animationPromise&&(await this.animationPromise,this.animationPromise=void 0),void 0!==o&&this.primaryChart&&this.secondaryChart){const o=Promise.all([this.primaryChart.afterUpdate.subscribeOnceAsPromise(),this.secondaryChart.afterUpdate.subscribeOnceAsPromise()]),r=new n.Vector2D(e,t),a=new n.Vector2D(i,s);this.updateChart(this.primaryChart,this.model.primaryModel,r,a),this.updateChart(this.secondaryChart,this.model.secondaryModel,r,a),await o,void 0===this.drawToken&&(this.drawToken=new g.CancellationToken,this.primaryChart.start(this.drawToken),this.secondaryChart.start(this.drawToken)),this.animationPromise=Promise.all([this.primaryChart.animate(),this.secondaryChart.animate()]),await this.animationPromise,this.primaryChart.rendering&&await this.primaryChart.afterRenderPromise,this.secondaryChart.rendering&&await this.secondaryChart.afterRenderPromise}return this}}}),define("classes/widget/fragments/canvas_chart/models/fragment_impact_graph_model",["require","exports","abstract_canvas_chart","graphics_utilities","math_utils","reusable_utilities","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model"],function(e,t,i,n,s,o,r){var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NET_SENTIMENT="NET_SENTIMENT",e.IMPACT_SCORE="IMPACT_SCORE",e.COUNT="COUNT"}(a||(a={}));t.FragmentImpactGraphModel=class extends r.FragmentCanvasGridChartModel{constructor(e,t){super(e,t),this.items=[],this.gradientLegendItems=[{label:"POSITIVE",labelColor:"white",position:1,color:new n.Color(new s.Vector4D(62,206,110,255))},{label:"NEUTRAL",labelColor:"white",position:.5,color:new n.Color(new s.Vector4D(242,193,0,255))},{label:"NEGATIVE",labelColor:"white",position:0,color:new n.Color(new s.Vector4D(242,67,53,255))}],this.grid.ticks.ticks=[{formattedLabel:"a",hasTimeStamp:!1,label:"a",newDay:!1,value:-100},{formattedLabel:"b",hasTimeStamp:!1,label:"b",newDay:!1,value:0},{formattedLabel:"c",hasTimeStamp:!1,label:"c",newDay:!1,value:100}],this.grid.xAxisPlacement=i.CanvasChartGridAxisPlacement.START,this.grid.yAxisPlacement=i.CanvasChartGridAxisPlacement.CENTER,this.grid.range.min=0,this.grid.range.percentageBased=!1,this.buildItems(e),this.grid.range.numRangeSteps=this.grid.range.max+1,this.grid.range.numRangeSteps>5&&(this.grid.range.hideInbetweenSteps=!0)}buildItems(e){let t=-100,i=0,s=!0;_.sortBy(e.getRows(),e=>{let t;for(const i of e.getCells())if(i.getColumn().getCode()===a.IMPACT_SCORE){t=i.getNumericData();break}return t}).forEach((e,r)=>{let c=0,l=0;const d=[];let g;e.getCells().forEach(e=>{const n=e.getColumn(),o={label:e.getColumn().getFormattedLabel(),value:e.getNumericData(),isPercentageBased:!1};switch(n.getCode()){case a.IMPACT_SCORE:0===i&&e.getNumericData()>0&&(i++,s=!1),l=i,e.getNumericData()!==t&&i++,t=e.getNumericData(),o.value=e.getNumericData(),o.isPercentageBased=!1;break;case a.NET_SENTIMENT:c=e.getNumericData(),o.isPercentageBased=!0}d.push(o),g||(g=e.getRequestedPageType())}),this.items.push({code:e.getCode(),color:n.Color.fromARGBString(e.getColor()),xValue:c,yValue:l,filters:[o.StringUtils.parseFilters(e.getFilters())],label:e.getFormattedLabel(),popoverEntries:d,requestedPageType:g})}),this.grid.range.max=s?i:i-1}}}),define("classes/widget/fragments/canvas_chart/impact_graph_fragment",["require","exports","math_utils","abstract_canvas_chart","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","impact_graph","classes/widget/fragments/canvas_chart/models/fragment_impact_graph_model"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.ImpactGraphFragment=class extends s.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"])}async modelFactory(e,t){return new r.FragmentImpactGraphModel(e,t)}chartFactory(e,t,s,r){return new o.ImpactGraph({size:new i.Vector2D(t.dimensions.width,t.dimensions.height),position:new i.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{containerSpan:e,enableGraphSlicer:!1,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:n.canvasMargin({top:30,right:30,bottom:10,left:0}),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:s,isClickable:r,xAxis:{hideLabels:!0},yAxis:{hideLabels:!0,centerLabelsOnBaseline:!0,hideZeroLabel:!0},putAxisLayerOnTop:!1})}}}),define("classes/widget/fragments/canvas_chart/progress_graph_fragment",["require","exports","math_utils","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","progress_graph","graphics_utilities","font_saver_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.ProgressGraphFragment=class extends n.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"]),this.fontPromise=Promise.resolve(),this.buildConfiguration=e.buildConfiguration}async modelFactory(e,t){const i=t.getPrimarySource().data_type_configuration_uuid;let n;return n="RESULT_PROGRESS_GRAPH"===i?this.getProgressGraphOptionsForResultPayload(e):{progressValues:[{value:e.getColumns()[0].getCells()[0].getNumericData(),maxValue:e.getColumns()[1].getCells()[0].getNumericData(),color:e.getRows()[0].hasColor()?o.Color.fromHex(e.getRows()[0].getTwColor().toHex6()):void 0}],layout:i},new s.ProgressGraphModel(n)}saveFonts(){const e=String.fromCharCode(58941),t=String.fromCharCode(58940),i=r.fontSaverService.saveFont(r.SaveableFontName.RobotoB,"1234567890.,:+-%KMGT".split(""),this),n=r.fontSaverService.saveFont(r.SaveableFontName.RobotoR,`1234567890.,:+-%KMGT${this.buildConfiguration.messages.previousPeriod}`.split(""),this),s=r.fontSaverService.saveFont(r.SaveableFontName.twAwesome,[e,t],this);this.fontPromise=Promise.all([i,n,s])}chartFactory(e,t,n,o){this.saveFonts();const r={size:new i.Vector2D(t.dimensions.width,t.dimensions.height),position:new i.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},a={containerSpan:e,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:new i.Vector4D(0,0,10,0),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:n,isClickable:o};switch(this.model.layout){case s.ProgressGraphLayout.PROGRESS_GRAPH_PLAIN:return new s.CircularProgressGraph(r,a,t.style.colorPalette,s.ProgressGraphType.PLAIN,!1,!1);case s.ProgressGraphLayout.PROGRESS_GRAPH:return new s.CircularProgressGraph(r,a,t.style.colorPalette,s.ProgressGraphType.FRACTION,!1,!0);case s.ProgressGraphLayout.PROGRESS_GRAPH_PERC:return new s.CircularProgressGraph(r,a,t.style.colorPalette,s.ProgressGraphType.PERCENTAGE,!1,!1);case s.ProgressGraphLayout.PROGRESS_GRAPH_COMPARE:return new s.ComparisonProgressGraph(r,a,t.style.colorPalette,this.buildConfiguration.messages.previousPeriod);default:throw new Error("Unknown layout for progress graph")}}getProgressGraphOptionsForResultPayload(e){const t=e.getColumns()[0].getCells()[0];let i=s.ProgressGraphLayout.PROGRESS_GRAPH_PLAIN;const n=t.getNumericData();let r=n;const a=[{value:n,maxValue:r,color:e.getRows()[0].hasColor()?o.Color.fromHex(e.getRows()[0].getTwColor().toHex6()):void 0}];if(t.hasOldNumericData()){i=s.ProgressGraphLayout.PROGRESS_GRAPH_COMPARE;const e=t.getOldNumericData();r=Math.max(n,e),a[0].maxValue=r,a.push({value:e,maxValue:r})}else t.isPercentageBased()&&(i=s.ProgressGraphLayout.PROGRESS_GRAPH_PERC,a[0].maxValue=100);return{progressValues:a,layout:i}}async draw(e){return await this.fontPromise,super.draw(e)}dispose(){super.dispose(),r.fontSaverService.freeFont(r.SaveableFontName.RobotoB,this),r.fontSaverService.freeFont(r.SaveableFontName.RobotoR,this),r.fontSaverService.freeFont(r.SaveableFontName.twAwesome,this)}}}),define("classes/widget/fragments/canvas_chart/sorted_cloud_fragment",["require","exports","classes/widget/fragments/canvas_chart/cloud_fragment","classes/context_data/context_data","classes/widget/fragments/canvas_chart/models/fragment_cloud_model"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.SortedCloudFragment=class extends i.CloudFragment{async modelFactory(e,t,i){const o=new s.FragmentCloudModel(e,t,i,!0,{positive:n.contextData.getMessage("_1441232"),neutral:n.contextData.getMessage("_1441233"),negative:n.contextData.getMessage("_1441234")});for(const e of o.imageLoadPromises)await e;return o}}}),define("classes/widget/fragments/canvas_chart/models/fragment_stream_graph_model",["require","exports","math_utils","reusable_utilities","graphics_utilities","classes/widget/fragments/canvas_chart/models/fragment_canvas_grid_chart_model"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentStreamGraphModel=class extends o.FragmentCanvasGridChartModel{constructor(e,t){super(e,t),this.lines={},this.totalThickness=[],this.maxValue=0;const s=t.getMenu().hasSelectSearchDataFunctionMenu()?t.getMenu().getSelectSearchDataFunctionMenu().getSelectedEntriesLeavesRecursively()[0].getName():"";this.lines=this.buildLineData(e.getColumns(),s);let o=1;if(this.maxValue<=1){let e=0;const t=`${this.maxValue}`;t.includes(".")&&(e=t.match(/\.[0]*/g)[0].length-1),o=Math.pow(10,e+2)}Object.keys(this.lines).forEach(e=>{const t=this.lines[e];let n=-Number.MAX_VALUE,s=Number.MAX_VALUE;t.values.forEach((e,t)=>{this.logarithmicY&&(e.drawValue=i.generalMathUtils.reverseLog({min:0,max:this.maxValue},{min:0,max:this.maxValue},e.drawValue)),e.drawValue*=o,void 0===this.totalThickness[t]&&(this.totalThickness[t]=0),s=Math.min(s,e.drawValue),n=Math.max(n,e.drawValue),this.totalThickness[t]+=e.drawValue}),t.min=s,t.max=n}),this.max=Math.ceil(Math.max(...this.totalThickness)/2),this.min=-this.max;const r=this.grid.yAxis;0===this.min&&0===this.max&&(this.max=100,this.min=-100),r.min=this.min,r.max=this.max,this.checkSum=n.StringUtils.calculateHash(JSON.stringify(this.lines))}buildLineData(e,t){const i={};return e.forEach((e,o)=>{e.getCells().forEach(r=>{const a=r.getRow().getLabel(!0),c=r.getRow().getCode(),l=isNaN(r.getValue())?0:r.getValue();this.maxValue=Math.max(l,this.maxValue),void 0===i[c]&&(i[c]={min:r.getRow().getValueBounds().min,max:r.getRow().getValueBounds().max,values:[],color:s.Color.fromARGBString(r.getRow().getColor()),isPositive:l>0,name:a,code:c}),i[c].values.push({value:l,code:c,drawValue:l,timestamp:e.getTimestamp()>0?e.getTimestamp():o,popoverHeader:"datetime"===r.getColumn().getColumn().data_type?r.getColumn().getColumn().name_formatted_full+(r.getColumn().getColumn().name_formatted_time?" ("+r.getColumn().getColumn().name_formatted_time+")":""):null,formattedLabel:r.getRow().getLabel(!0),popoverMetricLabel:t,color:s.Color.fromARGBString(r.getColor()),filters:[n.StringUtils.parseFilters(r.getRow().getFilters()),e.getFilter()].filter(e=>e.length>0),requestedPageType:r.getRequestedPageType()})})}),i}}}),define("classes/widget/fragments/canvas_chart/stream_graph_fragment",["require","exports","classes/widget/fragments/canvas_chart/abstract_canvas_chart_fragment","math_utils","stream_graph","classes/widget/fragments/canvas_chart/models/fragment_stream_graph_model"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.StreamGraphFragment=class extends i.AbstractCanvasChartFragment{constructor(e){super(e,["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK"])}async modelFactory(e,t){return new o.FragmentStreamGraphModel(e,t)}chartFactory(e,t,i,o){return new s.StreamGraph({size:new n.Vector2D(t.dimensions.width,t.dimensions.height),position:new n.Vector2D(t.dimensions.x,t.dimensions.y),model:this.model},{containerSpan:e,enableGraphSlicer:!1,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,margins:new n.Vector4D(15,30,10,0),resolutionScale:t.style.resolutionScale,numberFormatter:t.style.formatting.numberFormatter,mediatorStream:i,isClickable:o,yAxis:{hideLabels:!0,hideDashedLines:!0,hideBaseLine:!0},xAxis:{hideBaseLine:!0}})}}}),define("classes/widget/fragments/canvas_chart/models/fragment_trend_cloud_model",["require","exports","data_structures","cloud","classes/widget/fragments/canvas_chart/models/fragment_canvas_chart_model","reusable_utilities","graphics_utilities","font_saver_service"],function(e,t,i,n,s,o,r,a){var c;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RANK="Rank",e.DESCRIPTION="Description",e.PICTURE="Picture",e.TRAFFIC="Traffic",e.URL="Url"}(c||(c={}));t.FragmentTrendCloudModel=class extends s.FragmentCanvasChartModel{constructor(e,t,i){super(e,t),this.isGradientCloud=!1,this.imageLoadPromises=[],this.isAnalytics=!1,this.initializeItems(e,i),this.orientation=n.CloudModelOrientation.HORIZONTAL,this.settings={fontFamily:a.SaveableFontName.SourceSansProB,padding:2,fontSizingStrategy:n.CloudFontSizingStrategy.LOGARITHMIC,fontWeight:r.DrawableTextWeight.NORMAL,positioningShape:n.CloudPositioningShape.CIRCLE}}get checkSum(){return o.StringUtils.calculateHash(JSON.stringify(this.toSerializable()))}initializeItems(e,t){const s=void 0!==t&&(t.style.colorPalette.themeType===n.CloudThemeType.DARK||t.style.colorPalette.themeType===n.CloudThemeType.NAVY);this.items=[];let o=110;e.getRows().forEach(e=>{const t={};e.getCells().forEach(e=>{t[e.getColumn().getCode()]=e.getCell().value.value});const r=t[c.TRAFFIC]?t[c.TRAFFIC].replace(/[,\.\+]/g,""):"",a=r?parseInt(r):o,l=s?e.getAlternateLightColor().toHex6():e.getAlternateDarkColor().toHex6(),d={text:e.getLabel(!0),name:e.getLabel(),color:l,metric:{value:a,formatted_value:t[c.TRAFFIC],label:"",previous_value:a},tendency:new i.Tendency(a,a),filter:[],requestedPageType:"",deleteLink:"",id:e.getCode(),type:n.CloudModelItemType.TEXT,percentageBasedValue:a,hashTagMappeId:e.getCode(),hue:100};o-=10,this.items.push(d)})}get shouldShowBlockThemeButton(){return!this.widget.getPageState().getAllowedPages().isSearchAdvanced()}get shouldShowDeleteThemeButton(){return this.widget.getPageState().getAllowedPages().isDashboard()}}}),define("classes/widget/fragments/canvas_chart/trend_cloud_fragment",["require","exports","classes/widget/fragments/canvas_chart/cloud_fragment","classes/widget/fragments/canvas_chart/models/fragment_trend_cloud_model"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TrendCloudFragment=class extends i.CloudFragment{async modelFactory(e,t,i){return new n.FragmentTrendCloudModel(e,t,i)}chartFactory(e,t,i,n){return super.chartFactory(e,t,i,!1)}}}),define("services/form",["require","exports","notifications"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{shouldShowFieldErrors(e,t,i){const n=e&&e[t];return i=!!_.isUndefined(i)||i,!!n&&(!i||i&&n.$dirty)&&n.$invalid&&(!n.hasFocus||n.timeout_field)}showMessagesAsNotifications(e){const t=_.keys(e);t.length>0&&_.each(t,t=>{i.notificationService.display(e[t])})}}t.FormService=n,t.formService=new n}),define("services/articles",["require","exports","event_bus","log","map","notifications","underscore","classes/application/abstract_application","classes/application/application","classes/context_data/context_data","classes/navigation/nav_params","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","wrappers/widget/widget_wrapper","services/bubble_dialog","services/context","services/custom_pages","services/form","services/modal","services/navigation","services/presentation_service","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","services/widgets/widget_factory","services/grid_spacial"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P){Object.defineProperty(t,"__esModule",{value:!0});const D=r.range(1,11);class A{constructor(){this.resizeInfoMap=new s.Map}performLoadMore(e,t,i=!0,n=!0){const s=c.mainApplication.getWidgetById(e);if(s&&this.canLoadMore(s,t)){const e=s.getExtendedConfiguration();if(!s.getPageState().isEditMode()){const o=this.getSelectedNumberOfResults(s),r=e.getOffset();i?e.setOffset(r+o):e.setOffset(Math.max(0,r-o)),n&&e.setLoadMoreFlag(!0),e.setLoadedUrls(this.generateLoadedUrls(s,t.articles)),s.setConfigurationChanged(!0),s.isArticlesStoryTiles()?(s.prepareReload(T.twCommon.reloadingStrategy.BUBBLE_NO_FADE),this.refreshWidgetData(s)):s.isArticlesKeyStories()?(s.prepareReload(T.twCommon.reloadingStrategy.SPINNER),this.refreshWidgetData(s)):(s.prepareReload(T.twCommon.reloadingStrategy.BUBBLE),this.refreshWidgetData(s))}}}loadUrls(e,t){e.hasPrimarySource()&&(e.getDicWrapper().getExtendedConfiguration().setEntryUrls(t.urls),e.getDicWrapper().getExtendedConfiguration().setUseFullIndexForUrls(t.fullIndex),e.setConfigurationChanged(!0),e.prepareReload(),this.refreshWidgetData(e))}canLoadMoreChildren(e,t,i){if(c.mainApplication.isLoading())return!1;const n=r.find(i.articles,t=>t.entry_id===e);return!!n&&(t?this.canLoadMoreComments(n):this.canLoadMoreClusters(n))}canLoadMoreComments(e){return e.comment_articles.length<e.metadata.total_comments}canLoadMoreClusters(e){return e.cluster_articles.length<e.metadata.total_clusters}async performChildLoadMore(e,t,i,s,o){const r=c.mainApplication.getWidgetById(e);if(r&&this.canLoadMoreChildren(t,s,o)){const e=this.findOrCreateClusterConfiguration(r,t,i);e.load_more=!0,s?(e.comment_offset=(e.comment_offset||0)+e.num_results,delete e.cluster_offset):(e.cluster_offset=(e.cluster_offset||0)+e.num_results,delete e.comment_offset),r.getDic().config_changed=!0,r.getDic().reload=!0;const o={strategy:u.ModelRefreshStrategy.LOAD_MORE_CONTENT},a=g.modelRefreshDecoratorFactory.getDecorator(r.getPageState(),r.getApplication(),p.ModelType.WIDGET,o);try{await C.modelRefreshService.refresh(a,o)}catch(e){e instanceof Error&&n.logService.error("Error when loading more articles",void 0,e)}}}async translateArticle(e,t,i,n){const s=r.find(i.articles,e=>e.entry_id===t);return c.mainApplication.hasPageState()&&(n=void 0!==n?n:c.mainApplication.getPageState().getLanguage()||"en"),r.isUndefined(s)?[]:s.already_has_alt_text?[s]:E.restFormService.post(routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"translate_result","update","","settings").url,{articles:[s],target_language:n}).then(e=>e.articles)}mergeArticle(e,t,i,n){const s=r.first(i.articles),o=r.find(n.articles,e=>e.entry_id===t),a=c.mainApplication.getWidgetById(e),l=this.findOrCreateClusterConfiguration(a,t,s.metadata.cluster_id);return r.isUndefined(s)||r.isUndefined(o)||(0===l.comment_offset&&(o.comment_articles=[]),0===l.cluster_offset&&(o.cluster_articles=[]),o.metadata.total_comments=s.metadata.total_comments,o.metadata.total_clusters=s.metadata.total_clusters,s.cluster_articles&&$.merge(o.cluster_articles,s.cluster_articles),s.comment_articles&&$.merge(o.comment_articles,s.comment_articles)),l.load_more=!1,n}toggleChildFilter(e,t,i,n){const s=c.mainApplication.getWidgetById(e);if(!r.isUndefined(s)){const e=this.findOrCreateClusterConfiguration(s,t,i);e.no_filter=!e.no_filter,e.load_more=!0,n?(e.comment_offset=0,delete e.cluster_offset):(e.cluster_offset=0,delete e.comment_offset),s.getDic().config_changed=!0,s.getDic().reload=!0,s.prepareReload(),this.refreshWidgetData(s)}}findOrCreateClusterConfiguration(e,t,i){let n=this.findClusterConfiguration(e,t);if(!n){n={id:t,cluster_id:i,num_results:5};let s=e.getDic().primary_source.tw_result_source.cluster_configuration;s&&0!==s.length||(s=[]),s.push(n),e.getDic().primary_source.tw_result_source.cluster_configuration=s}return n}findClusterConfiguration(e,t){const i=e.getDic().primary_source.tw_result_source.cluster_configuration;return r.find(i,e=>e.id===t)}toggleTag(e,t,i,n,s){return r.every(t,e=>this.hasTag(e,i))?this.removeTag(e,t,i,n):this.addTag(e,t,i,n,s)}addCustomTag(e,t,i,n,s){return i&&i.name.match(/^(10|\d)$/)?this.toggleScore(e,t,parseInt(i.name,10)):this.addTag(e,t,i,n,s)}removeCustomTag(e,t,i,n){return this.isScoreTag(i)?this.setScore(t,0):this.removeTag(e,t,i,n)}setSentiment(e,t,i,n,s){if(t&&t.length>0){const r=c.mainApplication.getWidgetById(e).getPageState().toProto(),a={sentiment:i,entries:this.pluckArticles(t),apply_to_comments:n,apply_to_comments_future:s,page_state_id:n&&r.id},d=E.restFormService.post(routes.controllers.tw.TWRestForm.post("project",r.project.main_project_id,"articles_sentiment","update",h.tw.pageState.getId(),"rform").url,a),g='<i class="fa fa-refresh fa-spin"></i> '+l.contextData.getMessage("_498245");return o.notificationService.warning(g,{permanent:!0,singleInstance:!0,closeOnResolve:d}),d.then(this.handleSentiment.bind(this,t))}}toggleImportant(e,t,i,n){if(t&&t.length>0){const s={name:constants.tags.marking.important.content,code:constants.tags.marking.important.code,marking_tag:!0};return this.getImportant(t)?this.removeTag(e,t,s,i):this.addTag(e,t,s,i,n)}}toggleScore(e,t,i){if(r.isEmpty(t)||0!==i&&!r.contains(D,i))return Promise.resolve(!1);i=0===i?10:i;const n=this.getCurrentScore(t);return this.setScore(t,n===i?0:i)}deleteArticles(e,t,i){if(r.isEmpty(t))return Promise.resolve(!1);const n=c.mainApplication.getWidgetById(e).getPageState().copyAndPrune(!0),s={entries:this.pluckArticles(t),page_state:n.toProto(),remove_comments:i},a=E.restFormService.post(routes.controllers.tw.TWRestForm.post("project",n.getProject().getId(),"articles_remove","remove","","rform").url,s),d='<i class="fa fa-refresh fa-spin"></i> '+l.contextData.getMessage("_498245");return o.notificationService.warning(d,{permanent:!0,singleInstance:!0,closeOnResolve:a}),a.then(this.handleArticleDeletion.bind(this,t))}undeleteArticles(e,t){const i={code:constants.tags.marking.deleted.code,name:constants.tags.marking.deleted.content,marking_tag:!0};return this.removeTag(e,t,i,!1)}removeArticlesBySources(e){const t=[];let i=e.articles;return r.each(e.articles,i=>{let n;n=e.author?r.find(e.sources,e=>e.id_hash===i.author.id_hash):r.find(e.sources,e=>e.id_hash===i.source.id_hash),r.isUndefined(n)||t.push(i)}),r.each(t,e=>{i=i.filter(t=>t.hash!==e.hash)}),i}setRead(e,t){if(r.isEmpty(t))return Promise.resolve(!1);const i={code:constants.tags.marking.read.code,name:constants.tags.marking.read.content,marking_tag:!0},n=r.filter(t,e=>!this.hasTag(e,i));return this.addTag(e,n,i)}openShareUrl(e,t,i){t&&1===t.length&&window.open(i,"mywin","width=500,height=360,toolbar=1,resizable=0")}convertArticleToTopic(e,t){if(t&&1===t.length){const i=c.mainApplication.getWidgetById(e),n=i.getPageState(),s=r.first(t);if(i&&s){const e=this.determineArticleConversionTitle(s),i={entries:this.pluckArticles(t),name_channel:e||"?"};return E.restFormService.post(routes.controllers.tw.TWRestForm.post("project",n.toProto().project.main_project_id,"articles_convert_in_topic","convert",0,"rform").url,i)}}else;}openArticleDetails(e,t,i,n,s){const o=c.mainApplication.getWidgetById(e);if(!r.isUndefined(o)){const e=o.clone();e.getExtendedConfiguration().setEntryUrls([t]),e.setConfigurationChanged(!0);const r=new d.NavigationParams;r.setWidget(e),r.setWidgetToSend(e),r.setClickTarget(null);const a=[];this.setClusteringIdAndParentUrl(e,a,t,n,s),r.setFilters(a),b.navigationService.clickHandler(r,null,i)}}setClusteringIdAndParentUrl(e,t,i,n,s){if(void 0!==s){const o=e.getExtendedConfiguration();if(!0===s&&void 0!==i){const n=this.findArticleInPayloadById(e,i);let s=i;void 0!==n&&(s=n.metadata.parent_url),t.push([{key:"QUERY",value:`parenturl:"${s}"`}]),o.setParentUrl(i)}else!1===s&&void 0!==n?(t.push([{key:"QUERY",value:`cluster_id:"${n}"`}]),o.setClusterId(n)):(o.setClusterId(void 0),o.setParentUrl(void 0))}}findArticleInPayloadById(e,t){if(e.hasPayloadValue()&&void 0!==e.getPayloadValue().articles)return e.getPayloadValue().articles.find(e=>e.entry_id===t)}addToCustomPage(e,t,i){const n="0"===i?"ADD_WIDGET_TO_NEW_REPORT":"CUSTOM_PAGE_REPORT",s=c.mainApplication.getWidgetById(e),o=s.clone().clearPayload().toProto(),r=M.widgetFactory.wrapWidget(o,s.getPageState());r.setEditMode(!1),"0"===i?y.customPagesService.showMultipageModalForWidgetToNewReport(r).then(e=>{this.handleArticleAdditionRequestFromModal(s,t,i,e)}):S.modalService.display(n,r).then(e=>{this.handleArticleAdditionRequestFromModal(s,t,i,e)})}handleArticleAdditionRequestFromModal(e,t,i,n){let s;s=n instanceof m.WidgetWrapper?JSON.parse(JSON.stringify(n.getDic())):JSON.parse(JSON.stringify(n.dic));const o=e.getPayloadValue();o.articles=t,delete o.entries,s.payload.value=JSON.stringify(o),s.payload.keep_payload=!0;const r=M.widgetFactory.wrapWidget(s,e.getPageState());if("0"===i){const t=e.getPageState().clone(),i=t.toProto();i.data_input_configuration=[];const s={title:n.title,description:n.description,groups:n.groups,output_types_and_templates:n.output_types_and_templates,page_state:i};y.customPagesService.createCustomPageWithWidgets(constants.custom_page.type.report,s,[r],e.getPageState()),t.dispose()}else y.customPagesService.addWidgetsToCustomPage(constants.custom_page.type.report,{mapped_id:i},[r],e.getPageState())}async toggleEntryUserWorkflow(e,t,i,n){const s=c.mainApplication.getWidgetById(e);if(s){const e=!n,o=s.getPageState().toProto(),r=!0===e?"add":"remove",a={entry_id:t,ts:i};return E.restFormService.post(routes.controllers.tw.TWRestForm.post("project",o.project.main_project_id,"user_workflow",r,"","rform").url,a).then(()=>e)}}reportImageMismatch(e,t){S.modalService.display("IMAGE_MISMATCH",t,{keepBubbleDialogs:!0})}async addTag(e,t,i,n,s){if(r.isEmpty(t)||r.isEmpty(i.code)&&r.isEmpty(i.name))return!1;let a,d;const g=i.name.split("/");g.length>1?(a=g[0],d=g[1]):d=g[0];const u=c.mainApplication.getWidgetById(e).getPageState().toProto(),p={code:i.code,name:d,group:a,entries:this.pluckArticles(t),page_state:n?u:void 0,tag_comments:n,tag_comments_future:s},m=E.restFormService.post(routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"articles_tag","add",h.tw.pageState.getId(),"rform").url,p),_='<i class="fa fa-refresh fa-spin"></i> '+l.contextData.getMessage("_498245");return o.notificationService.warning(_,{permanent:!0,singleInstance:!0,closeOnResolve:m}),m.then(this.handleTagAddition.bind(this,t)).catch(e=>{e.field_messages&&v.formService.showMessagesAsNotifications(e.field_messages)})}async removeTag(e,t,i,n){if(r.isEmpty(t)||r.isEmpty(i.code))return;const s=c.mainApplication.getWidgetById(e).getPageState().toProto(),a={code:i.code,entries:this.pluckArticles(t),page_state:n?s:void 0,tag_comments:n},d=E.restFormService.post(routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"articles_tag","remove",h.tw.pageState.getId(),"rform").url,a),g='<i class="fa fa-refresh fa-spin"></i> '+l.contextData.getMessage("_498245");return o.notificationService.warning(g,{permanent:!0,singleInstance:!0,closeOnResolve:d}),d.then(this.handleTagRemoval.bind(this,t))}setScore(e,t){const i={entries:this.pluckArticles(e),score:t};return E.restFormService.post(routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"articles_score","update",h.tw.pageState.getId(),"rform").url,i).then(this.handleScoreToggle.bind(this,e))}handleTagAddition(e,t){const{tags_to_add:i,entries:n}=t;if(!(n&&0===n.length||void 0!==i&&0===i.length))return r.each(n,t=>{const n=r.findWhere(e,{hash:t.hash});if(n){let e=!1;n.tags=[].concat(n.tags),r.each(i,t=>{const i=t.code!==constants.tags.marking.important.code;switch(t.code){case constants.tags.marking.important.code:n.metadata.important=!0;break;case constants.tags.marking.read.code:case constants.tags.marking.checked.code:t.marking_tag=!0}i&&(e=this.addArticleTag(n,t)||e)}),e&&(n.tags=this.getSortedArticleTags(n))}}),e}handleTagRemoval(e,t){const{tags_to_remove:i,entries:n}=t;if(!(n&&0===n.length||void 0!==i&&0===i.length))return r.each(n,t=>{const n=r.findWhere(e,{hash:t.hash});n&&n.tags&&r.each(i,e=>{switch(e.code){case constants.tags.marking.important.code:n.metadata.important=!1;break;case constants.tags.marking.checked.code:case constants.tags.marking.read.code:case constants.tags.marking.deleted.code:}n.tags=n.tags.filter(t=>t.code!==e.code)})}),e}handleSentiment(e,t){const{entries:i}=t;i&&0===i.length||r.each(i,i=>{const n=r.findWhere(e,{hash:i.hash});n&&(n.metadata.sentiment=t.sentiment,t.checked_tag&&this.addArticleTag(n,t.checked_tag)&&(n.tags=this.getSortedArticleTags(n)))})}handleScoreToggle(e,t){r.each(t.entries,i=>{const n=r.findWhere(e,{hash:i.hash});if(n&&(n.tags=[].concat(n.tags),n.tags=n.tags.filter(e=>!this.isScoreTag(e)),t.score>0)){const e={code:"score"+t.score,name:""+t.score,marking_tag:!0};let i=this.addArticleTag(n,e);t.checked_tag&&(i=this.addArticleTag(n,t.checked_tag)||i),i&&(n.tags=this.getSortedArticleTags(n))}})}handleArticleDeletion(e,t){return t.entries}addArticleTag(e,t){return!this.hasTag(e,t)&&(e.tags.push(t),t.code!==constants.tags.marking.read.code&&t.code!==constants.tags.marking.checked.code&&i.eventBus.dispatch({type:i.EVENT_TYPES.ADDED_NEW_TAG,value:{name:t.name,mappedId:t.code}}),!0)}getSortedArticleTags(e){return r.sortBy(e.tags,e=>this.isScoreTag(e)||e.marking_tag)}canLoadMore(e,t){return!this.preventLoadMore(e)&&!e.isReloading()&&this.isLoadMoreAllowed(e,t)}preventLoadMore(e){return!!window.embedded_mode||(c.mainApplication.isLoading()||e.getPageState().getAllowedPages().isReport())}isLoadMoreInGridAllowed(e){const t=e.getPageState().getPageConfiguration();if(void 0===t)return!1;const i=e.getSlotConfiguration(),n=(t.pages.find(e=>e.id===i.page)||{}).grid||t.grid;return P.gridSpacialService.isAtTheBottomEdge(n.height,e)&&0===e.getPageState().getWidgets().filter(t=>t.isArticles()&&t!==e&&P.gridSpacialService.isAtTheBottomEdge(n.height,t)).length}isLoadMoreAllowed(e,t){if(!e.hasPageState())return!1;if(e.getPageState().isGridPage()&&e.getPageState().getAllowedPages().isDashboard())return this.isLoadMoreInGridAllowed(e);if(12===e.getWidth()&&!w.presentationService.isPresentationEnabled&&!this.hasLoadedAllArticles(t,e))switch(e.getPageState().getApplication().getType()){case a.ApplicationType.MAIN:return 0===_.bubbleDialogService.getBubbles().length&&(this.isLastWidget(e)||e.isArticlesKeyStories()||e.getPageState().getAllowedPages().isInfluencerManagementModule());case a.ApplicationType.BUBBLE:return!0;case a.ApplicationType.SINGLE_PAGE_BUBBLE:return 12===e.getWidth()&&this.isLastWidget(e)}return!1}generateLoadedUrls(e,t){return this.getClusterMode(e)===constants.group_by.similar_stories?t.map(e=>{const{metadata:t}=e;return t&&t.cluster_id?t.cluster_id:e.entry_id}):t.map(e=>e.entry_id)}getSelectedNumberOfResults(e){return parseInt(e.getExtendedConfiguration().getNumResultsMenu().getFirstSelectedEntry().getMappedId(),10)}fullLoadedArticleCount(e){return r.reduce(e.articles,(e,t)=>(e++,e+=t.comment_articles.length,e+=t.cluster_articles.length),0)}hasLoadedAllArticles(e,t){return this.getClusterMode(t)!==constants.group_by.none?t.hasPayloadValue()&&0===t.getPayloadValue().articles.length:0===e.articles.length||this.fullLoadedArticleCount(e)>=e.total}isLastWidget(e){return!!e.hasPageState()&&e.getPageState().getLastContentSection().getLastContentWidget().getId()===e.getId()}getClusterMode(e){const t=e.getExtendedConfiguration().getGroupByMenu();if(t){const e=t.getFirstSelectedEntryRecursively();return e?e.getMappedId():constants.group_by.none}return constants.group_by.none}pluckArticles(e){return(e||[]).map(e=>({hash:e.hash,routing_ts:e.routing_ts,entry_id:e.entry_id,fake:e.metadata.is_fake_root}))}getImportant(e){return!r.isEmpty(e)&&(e||[]).every(e=>e.metadata.important)}getCurrentScore(e){if(r.isEmpty(e))return 0;const t=this.getArticleScore(e[0]);return r.reduce(e,(e,t)=>e===this.getArticleScore(t)?e:void 0,t)}getArticleScore(e){const t=(e.tags||[]).find(e=>this.isScoreTag(e));return t?parseInt(t.name,10):void 0}isScoreTag(e){return e&&e.marking_tag&&D.includes(parseInt(e.name,10))}hasTag(e,t){return!(!e||!e.tags||0===e.tags.length)&&(e.tags||[]).some(e=>e.code===t.code||e.name===t.name)}determineArticleConversionTitle(e){return(r([e.title,e.subtitle]).flatten().filter(e=>!!e).map(e=>e.text)||[]).find(e=>void 0!==e&&e.trim().length>0)}async getArticleLayoutInfo(e){return E.restFormService.postRForm("article_layout_resizing","info",e)}getResizeInfo(e){return this.resizeInfoMap.get(e.getId())}shouldRequestArticleLayoutInfo(e,t,i){if(!e||!e.hasPageState())return!1;const n=e.hasPageState()?e.getPageState():c.mainApplication.getPageState();return n.isGridPage()&&n.getAllowedPages().isReport()&&(void 0===t||!t.dimensions.size.isEqual(i.dimensions.size))}async fetchArticleResizeLayoutInfo(e,t,i){if(this.shouldRequestArticleLayoutInfo(e,t,i)){const t=e.getSlotConfiguration(),i=e.hasPageState()?e.getPageState().getAllowedPages().getCustomPageId():c.mainApplication.getPageState().getAllowedPages().getCustomPageId(),n=await this.getArticleLayoutInfo({widget_id:e.getId(),configuration_default:e.getConfigurationRenderingUuid().toLowerCase(),report_mapped_id:i,rendering_context:e.getPayloadValue().rendering_context,width:t.width,height:t.height});this.resizeInfoMap.set(e.getId(),n)}return this.resizeInfoMap.get(e.getId())}emailArticles(e,t){const i=c.mainApplication.getWidgetById(e),n=JSON.parse(JSON.stringify(i.toProto())),s=i.getPageState().copyAndPrune(!1).toProto();s.data_input_configuration=[n];const o=Object.assign({},i.getPayloadValue());return o.articles=t,n.payload.keep_payload=!0,n.payload.value=JSON.stringify(o),E.restFormService.get(routes.controllers.tw.TWRestForm.get("project",h.tw.project_id,"page_state_emailing","show","","rform").url).then(e=>(e.page_state=s,S.modalService.display("SEND_ARTICLES",e).then(r.constant(!0),r.constant(!0))))}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:u.ModelRefreshStrategy.LOAD_MORE_CONTENT},i=g.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),p.ModelType.WIDGET,t);try{return await C.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&n.logService.error("Error when refreshing widget!",void 0,e)}}else n.logService.error("reload attempted on widget without page state, this could be due to a memory leak",T.twCommon.logFeatures.WidgetWrapper)}}t.default=A,t.articlesService=new A}),define("react_components/articles/articles_settings_factory",["require","exports","articles","widget_base","classes/application/abstract_application","classes/context_data/context_data","services/application_mode","services/articles","services/fullscreen","services/icons","services/theme"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g=1,u=235,p=115;class h{static build(e,t,i){const n=t.getDrawSettings(),s=n.dimensions;return{layout:h.getSelectedLayout(e),numResults:h.getSelectedNumberOfResults(e),useVirtualList:!0,isTranslated:e.isTranslateAll(),isDeletedMode:h.checkIfDeletedMode(e),canShowImage:!0,size:h.getWidgetSize(e),width:s.width,height:s.height,theme:d.themeService.isDarkTheme()?"dark":"light",refreshDelay:h.getRefreshDelay(e),gridImageDimensions:h.calculateGridImageDimensions(e,s),tileColumnCount:h.calculateColumnCount(s),showReportingActions:h.checkShowReportingActions(e),canTagMatchingComments:h.checkCanTagMatchingComments(e),showTaggingActions:h.canShowTaggingActions(e),showScoreActions:h.canShowScoreActions(e),showSentimentActions:h.canShowSentimentActions(e),showSourcePanelActions:h.canShowSourcePanelActions(),showCustomPagePanel:h.canShowCustomPagePanel(e),isAnimated:h.checkIsAnimated(e,n),useItemPooling:h.shouldUseItemPooling(e),canShowSeparator:h.checkCanShowSeparator(e),canShowEndOfResults:h.checkCanShowEndOfResults(e),useLoadingFlag:h.isPhantomJS(),customPages:h.getCustomPages(e),canConvertArticleToTopic:h.canConvertArticleToTopic(e),canDeleteOrUndelete:h.canDeleteOrUndelete(e),translationTargetLanguage:h.getTranslationTargetLanguage(e),canSendArticlesByEmail:h.canSendArticlesByEmail(e),iconMap:h.getIconMap(),messages:h.generateMessagesObject(),markingTags:h.generateMarkingTags(),keyboardMap:h.generateKeyboardMap(),fontSizeClass:h.getFontSizeClass(n),imageUrlEnhancer:h.getImageUrlEnhancer(),shouldAddExtraSpace:h.shouldAddExtraSpace(e),backgroundStyle:h.getBackgroundStyle(e,n),dynamicLayout:h.createDynamicLayoutSettings(i),canShowEngagementChart:h.canShowEngagementChart(e),shouldBeResponsive:h.shouldMakeResponsive(),isHootsuiteDashboard:r.applicationMode.getCurrentAppMode()===r.AppMode.HOOTSUITE_DASHBOARD,isAutoSentimentEnabled:h.isAutoSentimentEnabled(e)}}static shouldMakeResponsive(){return r.applicationMode.getCurrentAppMode()===r.AppMode.HOOTSUITE_DASHBOARD||r.applicationMode.isMobile()}static getWidgetSize(e){if(h.isCommandCenter(e)&&h.getSelectedLayout(e)!==i.WidgetLayoutTypes.ARTICLE_LIST){if(r.applicationMode.isMobile())return 12;{const t=e.getSlotConfiguration(),i=t.dimension_limit;return 12*Math.floor(i.max_width/t.width)}}return e.getWidth()}static isCommandCenter(e){if(!e.hasPageState())return!1;return e.getPageState().getAllowedPages().isCommandCenterScreen()&&c.fullscreenService.isFullscreen()}static getSelectedLayout(e){const t=e.getDataTypeUuid();return this.isCommandCenter(e)&&_.contains([i.WidgetLayoutTypes.ARTICLE_LIST_COMPACT,i.WidgetLayoutTypes.ARTICLE_WORLD_MAP],t)?i.WidgetLayoutTypes.ARTICLE_LIST_SLEEK:t}static getSelectedNumberOfResults(e){return parseInt(e.getExtendedConfiguration().getNumResultsMenu().getFirstSelectedEntry().getMappedId(),10)}static checkIfDeletedMode(e){if(!e.hasPageState())return!1;const t=e.getPageState().getUserFilterSettings();if(!_.isUndefined(t)){const e=t.getTopicMenuByType(constants.topic_menu.TYPE.deleted_results_option);if(!_.isUndefined(e)&&e.getRootEntry().hasChildren()){const t=_.first(e.getRootEntry().getChildren());return!_.isUndefined(t)&&t.isSelected()}}return!1}static getRefreshDelay(e){return e.getRefreshPeriodTime()||0}static checkShowReportingActions(e){return!h.checkIfDeletedMode(e)&&o.contextData.rules.isInToolReportingEnabled()}static checkCanTagMatchingComments(e){const t=e.getExtendedConfiguration();if(!t.hasGroupByMenu())return!1;if(!e.hasPageState())return!1;if(e.getPageState().getAllowedPages().isLoadMoreStoryClustering())return!1;const i=t.getGroupByMenu();return void 0!==i.getFirstSelectedEntry()&&i.getFirstSelectedEntry().getMappedId()!==constants.topic_entry.selected.none}static canShowTaggingActions(e){return o.contextData.rules.isArticleTaggingEnabled()&&(!e.hasMenu()||!e.getMenu().shouldHideWidgetTagging())}static canShowScoreActions(e){return!e.hasMenu()||!e.getMenu().shouldHideWidgetTagging()}static canShowSentimentActions(e){return o.contextData.rules.isArticleSentimentEnabled()&&(!e.hasMenu()||!e.getMenu().shouldHideWidgetTagging())}static canShowSourcePanelActions(){return o.contextData.rules.isArticleSourcePanelEnabled()}static canShowCustomPagePanel(e){if(!e.hasPageState())return!1;const t=e.getPageState().getAllowedPages();return!h.checkIfDeletedMode(e)&&!t.isReport()}static checkIsAnimated(e,t){return h.hasAnimation(e)&&void 0!==t.animationStrategy&&t.animationStrategy>0}static hasAnimation(e){if(!e.hasPageState())return!1;const t=e.getPageState().getAllowedPages();if(!e||!t)return!1;const n=t.isCommandCenterScreen()||c.fullscreenService.isFullscreen()&&t.isDashboard();switch(h.getSelectedLayout(e)){case i.WidgetLayoutTypes.ARTICLE_STORIES:case i.WidgetLayoutTypes.ARTICLE_STORY_TILES:case i.WidgetLayoutTypes.ARTICLE_WORLD_MAP:return!0;case i.WidgetLayoutTypes.ARTICLE_LIST_SLEEK:case i.WidgetLayoutTypes.ARTICLE_IMAGE_GRID:return n;case i.WidgetLayoutTypes.ARTICLE_LIST_COMPACT:return n&&e.getWidth()<12;default:return!1}}static checkCanShowSeparator(e){return a.articlesService.isLoadMoreAllowed(e,e.getPayloadValue())}static checkCanShowEndOfResults(e){if(e.getWidth()<12||!a.articlesService.isLastWidget(e))return!1;const t=h.getSelectedNumberOfResults(e);return!a.articlesService.preventLoadMore(e)&&t>1&&e.getPageState().getApplication().getType()===s.ApplicationType.MAIN}static isPhantomJS(){return!_.isUndefined(window.phantomjs)}static canConvertArticleToTopic(e){return _.contains([constants.group_by.thread,constants.group_by.similar,constants.group_by.thread_and_similar],a.articlesService.getClusterMode(e))}static canDeleteOrUndelete(e){return!!e.hasPageState()&&(!e.getPageState().getAllowedPages().isInfluencerManagementModule()&&(e.hasExtendedConfiguration()&&!e.getExtendedConfiguration().canUseFullIndexForUrls()&&!e.getPageState().getAllowedPages().isInstantDiscovery()))}static getTranslationTargetLanguage(e){if(e.hasMenu()&&e.getMenu().hasTranslationTargetLanguageMenu()){const t=e.getMenu().getTranslationTargetLanguageMenu().getFirstSelectedEntryRecursively();return t&&t.getMappedId()}}static getCustomPages(e){if(e.hasPageState())return e.getPageState().getAllowedPages().toProto().report_page_menu}static getIconMap(){const e={};return h.addIcons(_.values(constants.media_type.group),e,!0),h.addIcons(_.values(constants.media_type),e,!0),e}static addIcons(e,t,i){_.forEach(e,e=>{const n=e.mapped_id;_.isUndefined(n)||t[n]||(t[n]={icon:l.iconService.getIconForMediaType(n,i)})})}static canSendArticlesByEmail(e){if(e.hasPayloadValue()&&e.hasPayload()){const{allow_send_by_email:t=!1}=e.getPayloadValue();return t}return!1}static generateMessagesObject(){return{fiveResultsPerSlide:{author:o.contextData.getMessage("_1777656"),post:o.contextData.getMessage("_1777657"),otherMetrics:o.contextData.getMessage("_1777658")},metrics:{matches:o.contextData.getMessage("_958983"),metrics:o.contextData.getMessage("_892215"),tags:o.contextData.getMessage("_188741"),flags:o.contextData.getMessage("_1000012"),panels:o.contextData.getMessage("_274629"),printMetrics:o.contextData.getMessage("_307359"),deviceInfo:o.contextData.getMessage("_418065"),ruleCount:o.contextData.getMessage("_1623645"),aiRule:o.contextData.getMessage("_1623225"),showVideo:o.contextData.getMessage("_2156984")},contextMenu:{article:o.contextData.getMessage("_669620"),delete:o.contextData.getMessage("_148463"),undelete:o.contextData.getMessage("_942126"),changeSentiment:o.contextData.getMessage("_387104"),tagThisArticle:o.contextData.getMessage("_814045"),reportImageDetection:o.contextData.getMessage("_1000000"),reportLogoMismatch:o.contextData.getMessage("_1000001"),shareUrls:{facebook:o.contextData.getMessage("_666430"),linkedin:o.contextData.getMessage("_193646"),pinterest:o.contextData.getMessage("_669556"),twitter:o.contextData.getMessage("_733499")},convertToTopic:o.contextData.getMessage("_1520143"),sendEmail:o.contextData.getMessage("_1663543")},translatedByGoogle:o.contextData.getMessage("_489474"),loadMoreChildren:o.contextData.getMessage("_558040"),messageDiffusion:o.contextData.getMessage("_885872"),saveEntryForLater:o.contextData.getMessage("_474992"),removeSavedEntry:o.contextData.getMessage("_1000013"),reportArticle:o.contextData.getMessage("_1000001"),seeTranslation:o.contextData.getMessage("_416854"),seeOriginal:o.contextData.getMessage("_489714"),readArticle:o.contextData.getMessage("_1884564"),previewComingSoon:o.contextData.getMessage("_1663346")}}static generateMarkingTags(){return{checked:{code:constants.tags.marking.checked.code,name:constants.tags.marking.checked.content,marking_tag:!0},read:{code:constants.tags.marking.read.code,name:constants.tags.marking.read.content,marking_tag:!0},important:{code:constants.tags.marking.important.code,name:constants.tags.marking.important.content,marking_tag:!0}}}static generateKeyboardMap(){const e=o.contextData.userSettings.shortcuts.articles;return{navigation:{up:"up",down:"down",left:"left",right:"right"},sourcePanel:{author:e.show_author_panel,source:e.show_source_panel},scores:_.reduce(_.range(1,11),(e,t)=>{const i=t%10,n=`num_${i}`;return e[`${t}`]=[i,n],e},{}),delete:"delete",selection:{unselect:"escape",all:e.select_all},tagging:{quick:e.custom_tag,checked:e.toggle_checked,important:e.toggle_important,read:e.toggle_read,negative:e.set_negative,neutral:e.set_neutral,positive:e.set_positive,important_comments:e.toggle_important_comments,positive_comments:e.set_positive_comments,neutral_comments:e.set_neutral_comments,negative_comments:e.set_negative_comments,checked_comments:e.toggle_checked_comments,read_comments:e.toggle_read_comments}}}static calculateGridImageDimensions(e,t){return e.hasPageState()&&(e.getPageState().getAllowedPages().isCommandCenterScreen()||h.shouldMakeResponsive())?h.getGridImageDimensionsByAvailableSpace(t):h.getGridImageDimensionsByWidgetWidth(e)}static getGridImageDimensionsByAvailableSpace(e){const t=e.width;if(t<=400)return 90;{const e=8,i=t-20,n=Math.round(i/(p+e));return Math.floor(i/n)-e}}static getGridImageDimensionsByWidgetWidth(e){if(!e.hasPageState())return;const t=e.getPageState().getAllowedPages(),i=e.getPageState().getApplication().getType()===s.ApplicationType.MAIN;switch(e.getWidth()){case 12:return t.isDashboard()||t.isTrendDiscovery()?148:t.isReport()?115:t.isInstantDiscovery()?118:120;case 9:case 8:return 148;case 6:return t.isDashboard()||t.isTrendDiscovery()?146:i?118:128;default:return}}static calculateColumnCount(e){return Math.max(g,Math.floor(e.width/u))}static getFontSizeClass(e){const{fontSize:t=n.FontSize.SMALL}=e.style||{};switch(t){case n.FontSize.SMALL:return"fontsize-small";case n.FontSize.MEDIUM:return"fontsize-medium";case n.FontSize.LARGE:case n.FontSize.EXTRA_LARGE:return"fontsize-large";default:return""}}static getImageUrlEnhancer(){return(e,t)=>e}static shouldUseItemPooling(e){if(!e.hasPageState())return!1;return e.getPageState().getAllowedPages().isCommandCenterScreen()}static shouldAddExtraSpace(e){return!!e.hasPageState()&&e.getPageState().getLastContentSection()===e.getSection()}static getBackgroundStyle(e,t){if(!e.hasPageState())return{};const i=e.getPageState().getAllowedPages();return i.isInstantDiscovery()||i.isSearch()?{backgroundColor:"#fff"}:{}}static createDynamicLayoutSettings(e){if(!e||!e.article_box_info)return;const{number_of_columns:t,display_metric:i,number_of_articles_per_slide:n,number_of_rows:s}=e.article_box_info;return{columnCount:t,articleCount:n,displayMetric:i,numberOfRows:s}}static canShowEngagementChart(e){const t=e.getPayloadValue();if(e.getWidth()<12||!e.hasPayloadValue())return!1;const{articles:i=[]}=t;return i.some(e=>!!e.engagement_chart)}static isAutoSentimentEnabled(e){return e.hasPayloadValue()&&e.getPayloadValue().auto_sentiment_enabled}}t.ArticlesSettingsFactory=h}),define("classes/widget/fragments/directive/article_widget_fragment",["require","exports","articles","flux","log","notifications","reusable_utilities","widget_base","react_components/articles/articles_settings_factory","services/application_mode","services/articles","services/tw_common","classes/context_data/context_data","classes/widget/fragment_bases/abstract_directive_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.ArticleWidgetFragment=class extends p.AbstractDirectiveFragment{getLayoutIterator(){return new a.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}initialize(e,t,s,r){return console.log("articles fragment init"),this.mediator=t,this.chartContainer=e,super.initialize(e,t,s,r).then(e=>{const{widget:s}=this.model;if(s.hasPayloadValue()){const e=d.articlesService.getResizeInfo(this.getWidget());n.dispatcher.unsafeDispatch(i.ArticleActions.article_onPayloadRefresh,{widgetId:s.getId(),payload:s.getPayloadValue(),settings:c.ArticlesSettingsFactory.build(s,this,e)})}return t.listen(i.ArticleMediatorActions.ARTICLE_SELECTION_CHANGE,e=>{const{widgetId:t,selectionCount:i}=e;if(s.getId()===t)if(i>1){const e=u.contextData.getMessage("_1443432",[i]);void 0===this.selectionNotificationId?this.selectionNotificationId=o.notificationService.info(e,{singleInstance:!0,hideCloseButton:!0,permanent:!0}):o.notificationService.changeMessage(this.selectionNotificationId,e)}else void 0!==this.selectionNotificationId&&(o.notificationService.dismiss(this.selectionNotificationId),this.selectionNotificationId=void 0)}),console.log("articles fragment init done"),e})}update(e){console.log("articles fragment update"),this.model=e,s.logService.debug("Updating widget fragment",g.twCommon.logFeatures.WidgetInitializer,{fragment:this,model:e});const t=this.getWidget(),o=d.articlesService.getResizeInfo(this.getWidget()),r=t.getExtendedConfiguration(),a=_.find(this.getClusterConfigurations(t),e=>e.load_more);return r.getOffset()>0&&!0===r.getLoadMoreFlag()?(this.payload=t.getPayloadValue(),n.dispatcher.unsafeDispatch(i.ArticleActions.article_onLoadMore,{widgetId:t.getId(),payload:this.payload,settings:c.ArticlesSettingsFactory.build(this.getWidget(),this,o)})):a?n.dispatcher.unsafeDispatch(i.ArticleActions.article_onReceiveChildArticles,{entryId:a.id,widgetId:t.getId(),payload:t.getPayloadValue()}):(this.payload=t.getPayloadValue(),n.dispatcher.unsafeDispatch(i.ArticleActions.article_onPayloadRefresh,{widgetId:t.getId(),payload:this.payload,settings:c.ArticlesSettingsFactory.build(this.getWidget(),this,o)})),r.setLoadMoreFlag(!1),Promise.resolve(this)}async draw(e){console.log("articles fragment draw");const t=this.getWidget(),s=await d.articlesService.fetchArticleResizeLayoutInfo(t,this.previousDrawSettings,e);if(await super.draw(e),this.cancellationToken.isCanceled())return Promise.resolve(this);if(u.contextData.projectSettings.is_free_search){this.template.css({position:"relative",top:0});const e=this.template.closest(".widget-column");e.css({height:"auto !important","max-height":"none !important"}),e.parent(".widget-division").css({height:"auto !important"})}return this.setupMediatorListeners(this.mediator),n.dispatcher.dispatch(i.ArticleActions.article_onRedraw,{widgetId:t.getId(),settings:c.ArticlesSettingsFactory.build(t,this,s)}),this.previousDrawSettings=this.drawSettings,l.applicationMode.getCurrentAppMode()===l.AppMode.IMAGE_EXPORT&&await new Promise(e=>{setTimeout(()=>{e()},1200)}),console.log("articles fragment draw done"),this}get directiveData(){return{selector:"tw-articles",args:{widget:this.model.widget,fragment:this}}}getWidget(){return this.model.widget}getClusterConfigurations(e){return!_.isUndefined(e.getDic().primary_source)&&e.getDic().primary_source.tw_result_source.cluster_configuration}setupMediatorListeners(e){const t=this.model.widget;void 0!==this.mediatorToken&&this.mediatorToken.cancel(),this.mediatorToken=new r.CancellationToken,this.cancellationToken.chain(this.mediatorToken),t.hasEventConsumerType()&&e.listen(t.getEventConsumerType(),e=>{t.hasAllowedEventSources()&&!_.contains(t.getAllowedEventSources(),e.id)||t.getEventConsumerStrategyType()===constants.widget_linking_system.consumer_strategy.results_entry_urls&&d.articlesService.loadUrls(t,e)},{token:this.mediatorToken})}}}),define("wrappers/cluster_configuration/cluster_configuration_wrapper",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.ClusterConfigurationWrapper=class{constructor(e){this.clusterConfiguration=e}getData(){return this.clusterConfiguration.cluster_configuration_data}getBottomLeft(e){const{longitude:t,latitude:i}=this.clusterConfiguration.world_map_view_port[`${e}`].bottom_left;return[Number(t),Number(i)]}getTopRight(e){const{longitude:t,latitude:i}=this.clusterConfiguration.world_map_view_port[`${e}`].top_right;return[Number(t),Number(i)]}}}),define("services/cluster_config_service",["require","exports","wrappers/cluster_configuration/cluster_configuration_wrapper","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ClusterConfigService=class{constructor(){}async getClusterConfigurationWrapper(){return this.clusterConfigurationWrapper?this.clusterConfigurationWrapper:(this.clusterConfigurationWrapper=new i.ClusterConfigurationWrapper(await n.restFormService.getRForm("cluster_configuration","info")),this.clusterConfigurationWrapper)}static get instance(){return this.serviceInstance||(this.serviceInstance=new this)}}}),define("react_components/menu/topic_menu_select_component_strategies/default_selection_menu_strategy",["require","exports","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/application/application","classes/refresh/model_type","services/refresh/model_refresh_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultSelectionMenuStrategy=class{constructor(e,t={}){this.menuWrapper=e,this.config=t}onSelect(e,t,i){return new Promise((e,n)=>{this.menuWrapper.selectEntryByMappedId(t.mapped_id,void 0!==i?i.mapped_id:void 0),this.config.refreshDataOnCloseOnly||this.refreshPageData(),e(this.menuWrapper.toModel())})}onMouseEnter(e){return new Promise((t,i)=>{t({openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0})})}isActionsDisabled(){return!1}refreshPageData(){const e={strategy:i.ModelRefreshStrategy.REFRESH},t=n.modelRefreshDecoratorFactory.getDecorator(s.mainApplication.getPageState(),s.mainApplication,o.ModelType.PAGE_STATE,e);r.modelRefreshService.refresh(t,e).then(()=>void 0,()=>void 0)}}}),define("react_components/menu/topic_menu_select_component_strategies/default_widget_selection_menu_strategy",["require","exports","react_components/menu/topic_menu_select_component_strategies/default_selection_menu_strategy"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultWidgetSelectionMenuStrategy=class extends i.DefaultSelectionMenuStrategy{constructor(e,t={}){super(e.getMenu().getGeodataPrecisionTypesMenu(),t),this.widget=e}onSelect(e,t,i){return new Promise((e,n)=>{this.menuWrapper.selectEntryByMappedId(t.mapped_id,void 0!==i?i.mapped_id:void 0),this.widget.setConfigurationChanged(!0),this.config.refreshDataOnCloseOnly||this.refreshPageData(),e(this.menuWrapper.toModel())})}isActionsDisabled(){return!1}}}),define("services/embedded_widget",["require","exports","other/tw","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{async update(e){const t=i.tw.pageState.toProto(),s=t.sub_ids[0],o={id:s,page_state:t};return n.restFormService.post(routes.controllers.tw.TWRestForm.post("project",e.getProject().getId(),"embedded_widget","override",s,"settings").url,o)}},Object.defineProperty(t,"embeddedWidgetService",{get:()=>i.tw.inject("embeddedWidgetService")})}),define("services/map_preview_service",["require","exports","services/rest_form_service"],function(e,t,i){var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEFAULT="DEFAULT",e.LATEST="LATEST",e.NEW="NEW"}(n||(n={}));class s{constructor(){this.defaultTiles=[{north_east:[180,80],south_west:[-180,-80],zoom_type:"AUTO"}],this.latestPreviewTiles=[],this.defineFetchMethod=(e=>async t=>{switch(this.getTileType(e.tiles,!0)){case n.DEFAULT:t({choropleth_map_data_list:[this.defaultPreview]});break;case n.LATEST:this.latestPreviewTiles=e.tiles,t({choropleth_map_data_list:[this.latestPreview]});break;default:this.latestPreviewTiles=e.tiles,t(i.restFormService.postRForm("choropleth_shapes","preview",e))}})}async getChoroplethPreview(e){return new Promise(this.defineFetchMethod(e)).then(t=>{switch(this.getTileType(e.tiles)){case n.DEFAULT:return this.defaultPreview=t.choropleth_map_data_list[0],this.defaultPreview;default:return this.latestPreview=t.choropleth_map_data_list[0],this.latestPreview}})}getTileType(e,t){return JSON.stringify(e)!==JSON.stringify(this.defaultTiles)||t&&!this.defaultPreview?JSON.stringify(e)!==JSON.stringify(this.latestPreviewTiles)||t&&!this.latestPreview?n.NEW:n.LATEST:n.DEFAULT}}t.MapPreviewService=s,t.mapPreviewService=new s}),define("classes/country_popups",["require","exports","services/bubble_dialog","react","query_system","bubble_dialogs","canvas_chart_utilities","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=25,l=175,d=45,g=d+5,u=150,p=20;t.CountryPopups=class{constructor(e){this.targetElement=e,this.dialogs=[],this.style=(new o.BubbleDialogStyle).setWidth(l).setMinHeight(d).setMaxHeight(d).setArrowSide("CENTER")}addPopUp(e,t){this.style.zIndex=1e3-t,this.style.setPositionOffsetX(-this.targetElement.width()/2+155),this.style.setPositionOffsetY(-p-g*t);const o=i.bubbleDialogService.createReactBubble(e.countryId,this.targetElement,new s.ProviderQuery(e),e=>n.createElement(r.CountryDialog,Object.assign({},e.data)),this.style.clone(),{persist:!0,watchElement:{autoUpdate:!0,enable:!0,interval:100,threshold:5}});o.count=e.results,o.color=e.data.map(e=>e.color.toHex6()).sort().join("|"),o.cells=e.data.length,o.onDestroy.subscribeOnce(()=>{const e=this.dialogs.indexOf(o);e>=0&&this.dialogs.splice(e,1),0===this.dialogs.length&&this.titleDialog&&(this.titleDialog.destroy(),this.titleDialog=void 0)}),this.dialogs.splice(t,0,o),this.updateTitleDialog();const a=[];for(let e=t;e<this.dialogs.length;e++)a.push(this.dialogs[e]);return o.onReady.subscribeOnce(()=>{setTimeout(()=>{a.forEach(e=>{e.move(0,-g,u),e.getStyle().positionOffsetY-=g}),this.titleDialog&&(this.titleDialog.move(0,-g,u),this.titleDialog.getStyle().positionOffsetY-=g)},100)}),o}setPopups(e){const t=e.map(e=>e.countryId);this.removePopUps(this.dialogs.filter(e=>-1===t.indexOf(e.getId())).map(e=>e.getId())),this.removePopUps(e.filter(e=>this.getDialog(e.countryId)&&(this.getDialog(e.countryId).count!==e.results||this.getDialog(e.countryId).color!==e.data.map(e=>e.color.toHex6()).sort().join("|")||this.getDialog(e.countryId).cells!==e.data.length)).map(e=>e.countryId)),e.forEach(e=>{this.hasDialog(e.countryId,e.results)||this.addPopUp(e,this.findIndex(e.results))})}reset(){this.titleDialog&&(this.titleDialog.destroy(),this.titleDialog=void 0),this.dialogs.slice().forEach(e=>e.destroy()),this.dialogs.length=0}removePopUps(e){e.forEach(t=>{const i=this.dialogs.map(e=>e.getId()).indexOf(t),n=this.dialogs.splice(i,1)[0];if(n){this.titleDialog&&(this.titleDialog.move(0,g,u),this.titleDialog.getStyle().positionOffsetY+=g),i>0&&n.move(0,g,u),n.destroy(),this.style.zIndex++;for(let t=i;t<this.dialogs.length;t++)-1===e.indexOf(this.dialogs[t].getId())&&this.dialogs[t].move(0,g,u)}})}getDialog(e){return _.find(this.dialogs,t=>t.getId()===e)}hasDialog(e,t){return void 0!==this.getDialog(e)&&this.getDialog(e).count===t}updateTitleDialog(){this.dialogs.length>0&&void 0===this.titleDialog&&this.createTitleDialog()}createTitleDialog(){this.style.setPositionOffsetY(-p-(this.dialogs.length-1)*g-c-5),this.style.setMinHeight(c).setMaxHeight(c),this.titleDialog=i.bubbleDialogService.createReactBubble("country.title",this.targetElement,{title:a.contextData.getMessage("_1897444")},e=>n.createElement(r.CountryDialogTitle,Object.assign({},e)),this.style.clone(),{persist:!0,watchElement:{autoUpdate:!0,enable:!0,interval:100,threshold:5}}),this.style.setMinHeight(d).setMaxHeight(d)}findIndex(e){let t=_.findIndex(this.dialogs,t=>t.count>e);return-1===t&&(t=0),t}}}),define("classes/widget/fragments/directive/open_layers_map_controller_default",["require","exports","event","event_bus","log","openlayers","open_layers_map","reusable_utilities","other/tw","react_components/menu/topic_menu_select_component_strategies/default_widget_selection_menu_strategy","services/application_mode","services/bubble_dialog","services/cluster_config_service","services/configuration","services/embedded_widget","services/map_preview_service","services/refresh/model_refresh_service","services/rest_form_service","services/tw_common","wrappers/user_filter_settings/user_filter_settings_wrapper","wrappers/widget/dic_wrapper","classes/context_data/context_data","classes/country_popups","classes/custom_pages/custom_page_factory","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P){Object.defineProperty(t,"__esModule",{value:!0});class D{constructor(e,t,n){this.widget=e,this.model=t,this.intDrawSettings=n,this.bubbleDialogHoverTimeout=void 0,this.popupDialogHoverTimeout=void 0,this.intSelectionMenuStrategy=void 0,this.countryPopups=void 0,this.intInitialData=void 0,this.oldDataLoadingWasSkipped=void 0,this.oldSelectedFilterMappedIds=void 0,this.newSelectedFilterMappedIds=void 0,this.oldSelectedGeoDataSelectionMappedId=void 0,this.oldSelectedMetric=void 0,this.LOG_PREFIX_BUILDER=(e=>`[OpenLayersMapControllerDefault.${e}]`),this.LOG_HANDLER_PREFIX_BUILDER=((e,t)=>`[OpenLayersMapControllerDefault.${e}: ${t}]`),this.onLegendRangesUpdates=new i.Event,this.showingResultsWithImpreciseLocationUpdate=new i.Event,this.fetchedTiles=void 0,this.hasUnavailableLocationFilter=(e=>e.properties.location_identifier.subregion&&-1!==e.properties.location_identifier.subregion.indexOf("DBP_UNAVAILABLE_REGION"))}get widgetInfo(){return{selectedMetrics:this.widget.getMenu().getSelectSearchDataFunctionMenu().getSelectedEntriesRecursively()[0].getName(),isCropped:()=>this.isCropped,clearCropFilter:()=>this.widget.getPageState().getUserFilterSettings().getSearchbarFilter().removeGeoboxQuery(!0),getCropFilter:()=>this.widget.getPageState().getUserFilterSettings().getSearchbarFilter().getGeoboxQuery()}}get initialData(){return this.intInitialData||(this.intInitialData={getMapType:()=>this.mapType,payload:{data:this.widget.hasPayloadValue()?this.preparePayloadData(this.widget.getPayloadValue()):void 0,bucketColors:this.widget.hasPayloadValue()?this.preparePayloadLegendColorBuckets(this.widget.getPayloadValue()):void 0}}),this.intInitialData}get mapType(){return this.widget.isGeoCentroidMap()?r.OpenLayersMapType.DOT_DENSITY:this.widget.isHeatmap()?r.OpenLayersMapType.HEAT:this.widget.isDefaultMap()?r.OpenLayersMapType.PIE_CHART:this.widget.isEmojiMap()?r.OpenLayersMapType.EMOJI:r.OpenLayersMapType.CHOROPLETH}get show(){return{hoverMenus:this.showHoverMenus.bind(this),bubbleDialog:this.showBubbleDialog.bind(this),popupDialog:this.showBubblePopup.bind(this),showBubbleDialogByType:this.showBubbleDialogByType.bind(this),featureDetails:this.getShowDetailsClick.bind(this)}}showHoverMenus(e){e.map.controlsHovered||(this.bubbleDialogHoverTimeout=setTimeout(()=>{clearTimeout(this.bubbleDialogHoverTimeout),this.showBubbleDialog(e)},500),e.showPopover&&(this.popupDialogHoverTimeout=setTimeout(()=>{clearTimeout(this.popupDialogHoverTimeout),this.showBubblePopup(e)},500)))}get isCropped(){return this.widget.getPageState().getUserFilterSettings().getSearchbarFilter().hasGeoboxQuery()||this.widget.getPageState().getUserFilterSettings().getSearchbarFilter().hasProfileCoordinateQuery()}showBubbleDialog(e){const{bubbleDialogId:t}=this.model,{feature:i,map:n,choropleth:s,event:r}=e,a={buttons:[this.getZoomButton(i,n,s),this.getShowDetailsButton(i)]};let c=this.extractCoordinatesFromFeature(i,s);const l=n.map.getView().calculateExtent(n.map.getSize());o.extent.containsCoordinate(l,c)||(c=r.coordinate);const d=n.getPixelFromCoordinate(c);this.destroyBubbleDialog(t);const g=i.getProperties().result,u=g||n.numberOfResults;u&&0!==u&&this.showBubbleDialogDropdown(t,a,d,e)}showBubblePopup(e){const{bubbleDialogPopupId:t}=this.model,{feature:i,map:n,choropleth:s,event:r}=e;let a=this.extractCoordinatesFromFeature(i,s);const c=n.map.getView().calculateExtent(n.map.getSize());o.extent.containsCoordinate(c,a)||(a=r.coordinate);const l=n.getPixelFromCoordinate(a);this.destroyBubbleDialog(t);const d=i.getProperties().result,g=d||n.numberOfResults;if(g){const n={centerData:!0,header:this.extractHeaderFromFeature(i),values:[{label:w.contextData.getMessage("_295682"),value:this.drawSettings.style.formatting.numberFormatter.toDecimal(g),tendency:void 0}]};this.showBubbleDialogByType(t,n,l,e)}}extractHeaderFromFeature(e){let t=e.getProperties().name;if(t){let e=t.split("_");t=(e=e.map(e=>e[0].toUpperCase()+e.slice(1).toLowerCase())).join(" ")}return t}extractCoordinatesFromFeature(e,t){return t?r.OlUtils.transformDataCoordToFeatureCoord(e.getProperties().coordinate.coordinates):e.getGeometry().getCoordinates()}showBubbleDialogDropdown(e,t,i,n){const{style:o}=this.getStyle(e,i,n.map.map.getViewport());s.logService.debug(`${this.LOG_PREFIX_BUILDER("showBubbleDialogDropdown")} calling bubbleDialogService.createDropDownMenu`,r.openLayersLogFeature,{id:e,element:this.widget.element,payload:t,style:o}),g.bubbleDialogService.createDropDownMenu(e,this.widget.element,t,o)}showBubbleDialogByType(e,t,i,n){const{style:o}=this.getStyle(e,i,n.map.map.getViewport());s.logService.debug(`${this.LOG_PREFIX_BUILDER("showBubbleDialogByType")} calling bubbleDialogService.createByType`,r.openLayersLogFeature,{id:e,element:this.widget.element,payload:t,style:o}),g.bubbleDialogService.createByType(e,this.widget.element,"bars",t,o)}getStyle(e,t,i){const n=p.configurationService.getBubbleDialogConfiguration().getStyle(e),s=this.widget.element.offset(),o=t[0]+s.left,r=t[1]+s.top+i.offsetTop;return n.setAbsoluteX(o),n.setAbsoluteY(r),{style:n}}getZoomButton(e,t,i){const{zoom:n}=this.model.messages;return{icon:"fa fa-search-plus",text:n,onClick:()=>{const{bubbleDialogId:n}=this.model,s=this.extractCoordinatesFromFeature(e,i);t.zoomToCoordinates(s),this.destroyBubbleDialog(n)}}}getShowDetailsButton(e){const{showDetails:t}=this.model.messages;return{icon:"fa fa-bars",text:t,onClick:t=>{const{bubbleDialogId:i}=this.model;this.getShowDetailsClick(t,e.getProperties().filters),this.destroyBubbleDialog(i)}}}get clearTimeout(){return{hoverMenus:this.clearHoverMenuTimeouts.bind(this),bubbleDialog:()=>window.clearTimeout(this.bubbleDialogHoverTimeout),popupDialog:()=>window.clearTimeout(this.popupDialogHoverTimeout)}}closeBubbleDialogs(){this.clearTimeout.hoverMenus(),g.bubbleDialogService.scheduleDestructionById(this.model.bubbleDialogId,500),g.bubbleDialogService.scheduleDestructionById(this.model.bubbleDialogPopupId,500)}clearHoverMenuTimeouts(){window.clearTimeout(this.bubbleDialogHoverTimeout),window.clearTimeout(this.popupDialogHoverTimeout)}async fetchData(e){return a.PromiseUtils.conditionalAwait(()=>!this.widget.isDisposed(),[async()=>{this.fetchDataPromise&&await this.fetchDataPromise},async()=>{this.widget.canBeSaved()&&!1===e&&await this.saveWidgetOrUpdateIfEmbedded()},async()=>{this.isInImageExport()||this.isInReportPreview()||this.isEmbeddedWidget()?(this.fetchedData=this.preparePayloadData(this.widget.getPayloadValue()),void 0===this.fetchedData&&(this.fetchedData={type:"FeatureCollection",features:[],bbox:[0,0]})):await this.fetchDataFromServer()}]).then(()=>this.fetchedData).catch(()=>({type:"FeatureCollection",features:[],bbox:[0,0]}))}async fetchHighlights(e){return await this.waitForHighlights(),this.highlights}async waitForHighlights(){return new Promise((e,t)=>{const i=setInterval(()=>{this.checkHighlights()&&(clearInterval(i),e())},500)})}checkHighlights(){return this.hasHighlights()||this.shouldNotHaveHighlights()}hasHighlights(){return this.highlights&&this.highlights.features&&0!==this.highlights.features.length}shouldNotHaveHighlights(){return this.fetchedData&&this.fetchedData.features&&0===this.fetchedData.features.length&&this.highlights&&this.highlights.features&&0===this.highlights.features.length}async saveWidgetOrUpdateIfEmbedded(){const e=c.tw.pageState.getAllowedPages().isEmbeddedWidget();s.logService.debug(`${this.LOG_PREFIX_BUILDER("fetchData")} saving widget`,r.openLayersLogFeature,{isEmbeddedWidget:e,pageState:e?c.tw.pageState:this.widget.getPageState()}),e?h.embeddedWidgetService.update(c.tw.pageState).then(()=>{this.reload()}):await E.CustomPageFactory.getPageFromPageState(this.widget.getPageState()).saveWidget(this.widget)}isInImageExport(){return d.applicationMode.getCurrentAppMode()===d.AppMode.IMAGE_EXPORT}isInReportPreview(){return this.widget.getPageState().getAllowedPages().isReportPreview()}isEmbeddedWidget(){return d.applicationMode.getCurrentAppMode()===d.AppMode.EMBEDDED}async fetchDataFromServer(){const[e,t]=await this.prepareFetchingOfData(!1);if(this.shouldCallNavigate(e,t)){this.fetchDataPromise=this.callNavigateEndpoint(e,t);const i=(await this.fetchDataPromise).payloads[0].value;this.highlights={type:"FeatureCollection",features:[]},this.fetchedData={type:"FeatureCollection",features:[]},i&&(this.fetchedData=this.preparePayloadData(JSON.parse(i)),this.highlights=JSON.parse(i).choropleth_map_data)}}shouldCallNavigate(e,t){if(!(this.fetchedTiles&&this.fetchedData&&this.coordinatesEqual(t)&&this.selectedFiltersEqual(e)&&this.skipDataLoadingEqual(e)&&this.oldSelectedGeoDataSelectionMappedId===this.widget.getSelectedGeodataPrecisionType()&&this.selectedMetricEqual(e))){this.fetchedTiles=t,this.oldSelectedFilterMappedIds=this.newSelectedFilterMappedIds,this.oldSelectedMetric=this.getSelectedMetric(e),this.oldSelectedGeoDataSelectionMappedId=this.widget.getSelectedGeodataPrecisionType();const i=new b.DicWrapper(e.data_input_configuration[0]).getExtendedConfiguration();return this.oldDataLoadingWasSkipped=i.getSkipDataLoading(),!0}return!1}coordinatesEqual(e){const[t,i]=this.fetchedTiles.map(e=>[[e.north_east[0].toFixed(5),e.north_east[1].toFixed(5)],[e.south_west[0].toFixed(5),e.south_west[1].toFixed(5)]])[0],[n,s]=e.map(e=>[[e.north_east[0].toFixed(5),e.north_east[1].toFixed(5)],[e.south_west[0].toFixed(5),e.south_west[1].toFixed(5)]])[0];return t[0]===n[0]&&t[1]===n[1]&&i[0]===s[0]&&i[1]===s[1]}selectedFiltersEqual(e){const t=new S.UserFilterSettingsWrapper(e.user_filter_settings);return this.newSelectedFilterMappedIds=_.flatten(t.getTopicMenus().map(e=>e.getSelectedEntriesRecursively().map(e=>e.getMappedId()))),JSON.stringify(this.oldSelectedFilterMappedIds)===JSON.stringify(this.newSelectedFilterMappedIds)}skipDataLoadingEqual(e){const t=new b.DicWrapper(e.data_input_configuration[0]).getExtendedConfiguration();return this.oldDataLoadingWasSkipped===t.getSkipDataLoading()}getSelectedMetric(e){const t=e.data_input_configuration.find(e=>e.widget_id===this.widget.getId());return t&&t.primary_source&&t.primary_source.tw_data_source&&t.primary_source.tw_data_source.y_axis&&t.primary_source.tw_data_source.y_axis.function}selectedMetricEqual(e){return this.getSelectedMetric(e)===this.oldSelectedMetric}async callNavigateEndpoint(e,t){return y.restFormService.postRForm("geojson_world_map","navigate",{page_state:e,tiles:t,force_coordinates_mode:!0})}async prepareTilesFromExtendedConfig(){const e=[],t=this.widget.getExtendedConfiguration(),[i,n]=t.getTopRightLonLat(),[s,o]=t.getBottomLeftLonLat();return e.push({north_east:[i,n],south_west:[s,o],zoom_type:"AUTO"}),e}async reload(e=!1){this.widget.prepareReload(),await this.refreshWidgetData()}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:M.ModelRefreshStrategy.REFRESH},t=T.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),P.ModelType.WIDGET,e);try{return s.logService.debug(`${this.LOG_PREFIX_BUILDER("refreshWidgetData")} refreshing`,r.openLayersLogFeature,{refreshOptions:e,widgetDecorator:t}),await f.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing widget!",void 0,e)}}else s.logService.error("reload attempted on widget without page state, this could be due to a memory leak",v.twCommon.logFeatures.WidgetWrapper)}async preparePageStateProto(e,t,i){const n=e.clone();n.getWidgets().forEach(e=>e.clearPayloadValue()),i&&this.unselectCountryFiltersIfNeeded(n);const s=n.toProto();return s.data_input_configuration=s.data_input_configuration.filter(e=>e.widget_id===t),s.data_input_configuration[0].primary_source.tw_data_source.extended_configuration.skip_data_loading=!1,s}unselectCountryFiltersIfNeeded(e){const t=e.getUserFilterSettings().getTopicMenuByType("COUNTRIES");t.getSelectedEntriesRecursively().length>1&&(t.unselectAll(),t.getRootEntry().getChildren()[0].setSelected(!0))}async fetchChoroplethPreview(){if(this.fetchedPreviewTimestamp&&Date.now()-this.fetchedPreviewTimestamp<1e3){for(;!this.fetchedPreview;)await new Promise(e=>setTimeout(e,200));return this.fetchedPreview}this.fetchedPreviewTimestamp=Date.now();const[e,t]=await this.prepareFetchingOfData(!0);return this.fetchedPreview=m.mapPreviewService.getChoroplethPreview({page_state:e,tiles:t,force_coordinates_mode:!0}),this.fetchedPreview}async prepareFetchingOfData(e){return Promise.all([this.preparePageStateProto(this.widget.getPageState(),this.widget.getId(),e),this.prepareTilesFromExtendedConfig()])}async applyDataGraphFilters(e){if(!this.isCropped){this.widget.getPageState().getUserFilterSettings().applyDatagraphFilters(e);const t={strategy:M.ModelRefreshStrategy.REFRESH},i=T.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),P.ModelType.PAGE_STATE,t);try{await f.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after cropping region !",void 0,e)}}}get selectionMenuStrategy(){return this.intSelectionMenuStrategy=new l.DefaultWidgetSelectionMenuStrategy(this.widget)}get destroy(){return{bubbleDialogById:this.destroyBubbleDialog.bind(this)}}destroyBubbleDialog(e){g.bubbleDialogService.scheduleDestructionById(e,500)}getShowDetailsClick(e,t){u.ClusterConfigService.instance.getClusterConfigurationWrapper().then(i=>{const o=i.getData();if("string"==typeof t&&!t.startsWith("sourcegeo")){const[e,i]=t.split("="),n=o.features.filter(e=>e.properties.region_id&&-1!==e.properties.region_id.indexOf(i))[0].properties.parent_region_id;t={[n]:[[{key:e,value:i}]]}}const a={type:n.EVENT_TYPES.OPEN_MAP_DRILLDOWN,value:{filters:t||[],container:e.target,id:this.widget.getId()}};s.logService.debug(`${this.LOG_HANDLER_PREFIX_BUILDER("getShowDetailsClick","handleDropdownShowDetailsClick")} opening drilldown`,r.openLayersLogFeature,{event:e,filters:t,eventBusPayload:a}),n.eventBus.dispatch(a)})}get allNodeAndSelectedNodeMappedIds(){const e=this.widget.getPageState().getUserFilterSettings(),t=this.getSelectedCountryFilters(e);return{allNodeMappedId:this.getCountryFiltersRoot(e).getMappedId(),selectedMappedIds:t.map(e=>e.getMappedId())}}getCountryFiltersRoot(e){return e.getTopicMenuByType(constants.topic_menu.TYPE.countries).getRootEntry().getChildren()[0]}getSelectedCountryFilters(e){return e.getTopicMenuByType(constants.topic_menu.TYPE.countries).getSelectedEntriesRecursively()}initCountryPopups(e){this.countryPopups=new C.CountryPopups(this.widget.getTemplate().find(e))}updateCountryPopups(e){if(this.mapType===r.OpenLayersMapType.PIE_CHART){const t=[];e.filter(this.hasUnavailableLocationFilter).forEach(e=>{const{label:i,filters:n,id:s,slices:o,result:r}=e.properties,[c,l]=n.split("=");t.push({widget:this.widget,filter:[{key:c,value:l}],countryId:s,countryName:i,data:o.map(e=>({color:new a.Color(e.color),value:e.result})),results:r.toString(10),resultCount:r})}),this.countryPopups.setPopups(t)}}get drawSettings(){return this.intDrawSettings}set drawSettings(e){this.intDrawSettings=e}async getViewOptions(){u.ClusterConfigService.instance.getClusterConfigurationWrapper();const e=Object.assign({},await this.getViewOptionsFromClusterConfig(),await this.getViewOptionsFromExtendedConfig(),await this.getViewOptionsFromUfs(),await this.getViewOptionsFromSourceGeoBox());return e.width=this.drawSettings.dimensions.width,e}async getViewOptionsFromClusterConfig(){const e={},t="ja"===w.contextData.commonPropertiesContainer.interface_language?"ja":"standard",i=await u.ClusterConfigService.instance.getClusterConfigurationWrapper(),n=r.OlUtils.transformDataCoordToFeatureCoord(i.getBottomLeft(t)),s=r.OlUtils.transformDataCoordToFeatureCoord(i.getTopRight(t));return e.extent=o.extent.boundingExtent([n,s]),e}async getViewOptionsFromExtendedConfig(){const e=this.widget.getExtendedConfiguration(),[t,i]=e.getCenterLonLat(),n={};if(void 0!==t&&void 0!==i&&(n.lon=Number(t),n.lat=Number(i),n.zoom=e.getZoomLevel(),0!==t&&0!==i&&e.hasBottomLeft()&&e.hasTopRight())){const t=r.OlUtils.transformDataCoordToFeatureCoord(e.getBottomLeftLonLat()),i=r.OlUtils.transformDataCoordToFeatureCoord(e.getTopRightLonLat());n.extent=o.extent.boundingExtent([t,i])}return n}async getViewOptionsFromUfs(){const{allNodeMappedId:e,selectedMappedIds:t}=this.allNodeAndSelectedNodeMappedIds,i={};if(1===t.length&&e!==t[0]){const e=(await u.ClusterConfigService.instance.getClusterConfigurationWrapper()).getData().features.filter(e=>e.properties.region_id===t[0])[0];if(e){const{geometry:t,properties:n}=e;if([i.lon,i.lat]=t.coordinates,0===n.parent_region_id.length?i.zoom=3:2===n.region_id.length&&(i.zoom=5),e.properties.bounding_box){const t=e.properties.bounding_box,{southWestCoord:n,northEastCoord:s}=r.OlUtils.extractCoordinatesFromBoundingBox(t);i.extent=o.extent.boundingExtent([n,s])}}}return i}async getViewOptionsFromSourceGeoBox(){const e={};if(this.isCropped){const t=this.widget.getPageState().getUserFilterSettings().getSearchbarFilter().getGeoboxQuery(),{southWestCoord:i,northEastCoord:n}=r.OlUtils.extractCoordinatesFromBoundingBox(t);e.extent=o.extent.boundingExtent([i,n])}return e}get extendedConfigHasExtent(){return this.widget.getExtendedConfiguration().hasTopRight()&&this.widget.getExtendedConfiguration().hasBottomLeft()}setExtendedConfigurationExtent(e){if(180===Math.abs(e.bottomLeftLonLat[0])&&180===Math.abs(e.topRightLonLat[0])){const t="ja"===w.contextData.commonPropertiesContainer.interface_language?"ja":"standard";u.ClusterConfigService.instance.getClusterConfigurationWrapper().then(i=>{const n=this.widget.getExtendedConfiguration();n.setBottomLeftLonLat(i.getBottomLeft(t)),n.setTopRightLonLat(i.getTopRight(t)),n.setCenterLonLat(e.centerLonLat),n.setZoomLevel(e.zoomLevel),this.widget.setConfigurationChanged(!0)})}else{const t=this.widget.getExtendedConfiguration();t.setCenterLonLat(e.centerLonLat),t.setZoomLevel(e.zoomLevel),t.setTopRightLonLat(e.topRightLonLat),t.setBottomLeftLonLat(e.bottomLeftLonLat),this.widget.setConfigurationChanged(!0)}}get extendedConfigBottomLeftLonLat(){return this.widget.getExtendedConfiguration().getBottomLeftLonLat()}get extendedConfigTopRightLonLat(){return this.widget.getExtendedConfiguration().getTopRightLonLat()}get skipDataLoading(){return void 0!==this.widget.getExtendedConfiguration().getSkipDataLoading()&&this.widget.getExtendedConfiguration().getSkipDataLoading()}set skipDataLoading(e){this.widget.getExtendedConfiguration().setSkipDataLoading(e)}get widgetId(){return this.widget.getId()}get widgetIsDisposed(){return this.widget.isDisposed()}preparePayloadData(e){switch(this.showingResultsWithImpreciseLocationUpdate.fire(e.can_use_geo_box_breakdown),this.mapType){case r.OpenLayersMapType.PIE_CHART:return e.pie_chart_map_data;case r.OpenLayersMapType.DOT_DENSITY:return e.dot_density_map_data;case r.OpenLayersMapType.HEAT:return e.heat_map_data;case r.OpenLayersMapType.EMOJI:return e.emoji_map_data;case r.OpenLayersMapType.CHOROPLETH:const t=e.choropleth_map_data.features.reduce((e,t)=>e+t.properties.result,0);return this.onLegendRangesUpdates.fire(e.legend_ranges.map(({color:e,min:i,max:n})=>({min:i,max:n,total:t,color:e}))),e.choropleth_map_data;default:throw new Error("Unknown map type!")}}preparePayloadLegendColorBuckets(e){return e.bucket_colors}get removeFeaturesWithEmptySlices(){return this.mapType===r.OpenLayersMapType.PIE_CHART}get showTopResults(){return this.mapType===r.OpenLayersMapType.PIE_CHART||this.mapType===r.OpenLayersMapType.CHOROPLETH}get showGroupingContainer(){return this.mapType===r.OpenLayersMapType.PIE_CHART}get useGeometryCoordinatesForTopResults(){return this.mapType!==r.OpenLayersMapType.CHOROPLETH}dispose(){this.onLegendRangesUpdates.cancelAll(),this.showingResultsWithImpreciseLocationUpdate.cancelAll()}get logFeature(){return r.openLayersLogFeature}get tileServerLang(){return w.contextData.commonPropertiesContainer.interface_language}}__decorate([a.throttle(200,{trailing:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[Boolean]),__metadata("design:returntype",Promise)],D.prototype,"fetchData",null),t.OpenLayersMapControllerDefault=D}),define("classes/widget/fragments/directive/open_layer_map_fragment",["require","exports","canvas_chart_utilities","open_layers_map","react-dom","underscore","widget_base","services/application_mode","services/cluster_config_service","classes/context_data/context_data","classes/widget/fragments/directive/open_layers_map_controller_default"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});t.OpenLayerMapFragment=class{constructor(e){this.fragmentModel=e,this.mapId=o.uniqueId("worldMap-")}async initialize(e,t,s,o){return this.chartContainer=e,this.mapDiv=document.createElement("div"),this.mapDiv.id=this.mapId,this.mapDiv.className="ol-map",e.appendChild(this.mapDiv),this.map=n.MapFactory.createMap(n.MapType.OPEN_LAYERS),this.intDrawSettings=s,this.controller.onLegendRangesUpdates.subscribe(e=>{const n=this.fragmentModel.widget;void 0!==n&&(n.setPayloadValue(Object.assign({},n.getPayloadValue(),{legend_ranges:e})),t.dispatch(i.LegendFragmentActions.RERENDER,void 0))}),this.map.initialize(this.mapFragmentModel,this.controller,(await c.ClusterConfigService.instance.getClusterConfigurationWrapper()).getData(),s),this}async update(e){return this.fragmentModel=e,Promise.resolve(this)}async draw(e){return this.intDrawSettings=e,this.controller.drawSettings=e,await this.map.render(this.mapId,e),this}dispose(){s.unmountComponentAtNode(this.chartContainer),this.map.dispose(),$(`#${this.mapId}`).remove(),this.intController&&this.intController.dispose(),this.map=void 0}getLayoutIterator(){return new r.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minWidth:0,minHeight:0}],e=>{const{width:t,height:i}=e.dimensions;return{width:t||0,height:i||0}})}get mapFragmentModel(){if(void 0===this.intMapFragmentModel){const e=a.applicationMode.getCurrentAppMode(),t=a.applicationMode.isMobile();this.intMapFragmentModel={messages:{show:l.contextData.getMessage("_1967468"),results:l.contextData.getMessage("_1967469"),groupBubbles:l.contextData.getMessage("_1967470"),groupBubblesOff:l.contextData.getMessage("_1967471"),groupBubblesOn:l.contextData.getMessage("_1967472"),zoom:l.contextData.getMessage("_196874"),showDetails:l.contextData.getMessage("_489448"),unavailableLocations:l.contextData.getMessage("_1984654"),zoomDesc:l.contextData.getMessage("_1552856"),zoomLevel:{country:l.contextData.getMessage("_1552857"),region:l.contextData.getMessage("_1552858"),coordinate:l.contextData.getMessage("_1552859")},metrics:l.contextData.getMessage("_1652316"),topResultsControlHeadline:l.contextData.getMessage("_1698412"),showImpreciseLocationsMessage:l.contextData.getMessage("_1252560")},configuration:{disableInteraction:e===a.AppMode.EMBEDDED||t,disableControls:e===a.AppMode.EMBEDDED||t},geodataPrecisionTypesMenu:this.fragmentModel.widget.getMenu().getGeodataPrecisionTypesMenu(),bubbleDialogId:constants.bubble_dialog.id.context_menu,bubbleDialogPopupId:constants.bubble_dialog.id.popup}}return this.intMapFragmentModel}get controller(){return void 0===this.intController&&(this.intController=new d.OpenLayersMapControllerDefault(this.fragmentModel.widget,this.mapFragmentModel,this.intDrawSettings)),this.intController}}}),define("classes/widget/fragments/legacy_directive/activity_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ActivityChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-activity"}}}),define("classes/widget/fragments/legacy_directive/area_chart_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.AreaChartFragment=class extends n.AbstractLegacyDirectiveFragment{getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:5,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}directiveName(){return"tw-lines"}get additionalDirectiveArgs(){return{area:!0}}}}),define("classes/widget/fragments/legacy_directive/composed_graph_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.ComposedGraphFragment=class extends n.AbstractLegacyDirectiveFragment{getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:5,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}directiveName(){return"tw-composed"}}}),define("classes/widget/fragments/legacy_directive/data_table_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.DataTableFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-data-table"}}}),define("classes/widget/fragments/legacy_directive/gender_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.GenderChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-gender"}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:0}}}}),define("classes/widget/fragments/legacy_directive/influencer_overview_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerOverviewFragment=class extends n.AbstractLegacyDirectiveFragment{directiveName(){return"tw-influencer-overview"}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:100}}applyFontClasses(){return!0}}}),define("classes/widget/fragments/legacy_directive/influencer_table_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerTableFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-influencer-table"}applyFontClasses(){return!0}}}),define("classes/widget/fragments/legacy_directive/kpi_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.KpiChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-kpi"}}}),define("classes/widget/fragments/legacy_directive/line_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment","widget_base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.LineChartFragment=class extends i.AbstractLegacyDirectiveFragment{getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:5,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}directiveName(){return"tw-lines"}get additionalDirectiveArgs(){return{area:!1}}}}),define("classes/widget/fragments/legacy_directive/map_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.MapFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-map"}}}),define("classes/widget/fragments/legacy_directive/metric_multiple_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.MetricMultipleFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-metric-multiple"}}}),define("classes/widget/fragments/legacy_directive/page_break_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PageBreakFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-page-break"}}}),define("classes/widget/fragments/legacy_directive/payload_edition_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PayloadEditionFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-edition"}async update(e){return e.widget.redraw(!0),Promise.resolve(this)}}}),define("classes/widget/fragments/legacy_directive/pie_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.PieChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-pie"}}}),define("classes/widget/fragments/legacy_directive/single_metric_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.SingleMetricFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-metric-single"}}}),define("classes/widget/fragments/legacy_directive/summary_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.SummaryFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-summary"}}}),define("classes/widget/fragments/legacy_directive/text_editor_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TextEditorFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-text"}}}),define("classes/widget/fragments/legacy_directive/theme_cloud_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ThemeCloudFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-cloud"}}}),define("classes/widget/fragments/legacy_directive/theme_tree_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.ThemeTreeFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-pack"}}}),define("classes/widget/fragments/legacy_directive/top_images_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TopImagesFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-top-images"}}}),define("classes/widget/fragments/legacy_directive/top_influencer_overview_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TopInfluencerOverviewFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-influencer-list-widget"}applyFontClasses(){return!0}}}),define("classes/widget/fragments/legacy_directive/treemap_fragment",["require","exports","widget_base","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.TreemapFragment=class extends n.AbstractLegacyDirectiveFragment{directiveName(){return"tw-treemap"}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:.7,minWidth:0,minHeight:0}],e=>this.getDimensionsForLayout(e))}async initialize(e,t,i,n){return this.mediator=t,super.initialize(e,t,i,n)}async draw(e){return this.mediator.dispatch(constants.treemap.events.draw,!0),super.draw(e)}}}),define("classes/widget/fragments/legacy_directive/trends_table_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TrendsTableFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-trends-table"}}}),define("classes/widget/fragments/legacy_directive/wheel_chart_fragment",["require","exports","classes/widget/fragment_bases/abstract_legacy_directive_fragment"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.WheelChartFragment=class extends i.AbstractLegacyDirectiveFragment{directiveName(){return"tw-wheel"}}}),define("classes/widget/widget_fragment_factory/factory_utilities",["require","exports","canvas_chart_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.setLineIfReplay=function(e,t){return e.hasReplayManager()?i.LegendTypes.LINE:t||i.LegendTypes.TABULAR}}),define("classes/widget/widget_fragment_factory/widget_blueprints/activity_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/canvas_chart/activity_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","activity_chart","classes/widget/widget_fragment_factory/default_build_configurations"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g={colorPaletteBuilder:l.ActivityChartColorPaletteBuilder};t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[r.WidgetHeaderFragment,a.TopWidgetMenusFragment,n.ReplayDateFragment],[i.WidgetLayoutBlockId.BODY]:[s.ActivityChartFragment],[i.WidgetLayoutBlockId.FOOTER]:[c.BottomWidgetMenusFragment,o.ReplayFragment]},buildConfigurations:d.defaultBuildConfigurations.extend([{key:s.ActivityChartFragment,value:g}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/area_chart_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragment_controllers/area_chart_widget_blueprint_enhancer","classes/widget/fragments/directive/sidenote_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/area_chart_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[r.WidgetHeaderFragment,d.TopWidgetMenusFragment,a.ResultCountFragment],[s.WidgetLayoutBlockId.BODY]:[u.AreaChartFragment,n.LegendFragment,l.SidenoteFragment],[s.WidgetLayoutBlockId.FOOTER]:[g.BottomWidgetMenusFragment,o.ReplayFragment]},enhancer:c.AreaChartWidgetBlueprintEnhancer,buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{enableItemHover:!0,colorPaletteBuilder:n.LegendColorPaletteBuilder,enableItemSelection:!0,iconType:n.LegendItemIconType.LINE}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/articles_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/article_widget_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/globe_fragment","classes/widget/fragment_controllers/article_widget_blueprint_enhancer","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,a.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[o.GlobeFragment,n.ArticleWidgetFragment],[i.WidgetLayoutBlockId.FOOTER]:[c.BottomWidgetMenusFragment]},noMargin:!0,enhancer:r.ArticleWidgetBlueprintEnhancer,layoutStrategySettings:{minimumChartSize:0},buildConfigurations:l.defaultBuildConfigurations.extend([{key:s.WidgetHeaderFragment,value:{hideUi:d.applicationMode.getCurrentAppMode()===d.AppMode.HOOTSUITE_DASHBOARD}}])}}}),define("react_components/block_influencers/interfaces/block_influencers_widget_container_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_influencers/block_influencers_widget_container",["require","exports","block_influencers","event_bus","flux","math_utils","react"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersWidgetContainer=class extends s.BaseComponent{constructor(e){super(e),this.controller=this.props.controller}render(){return r.createElement(i.BlockInfluencersContainer,{mediator:this.props.mediator,payload:this.controller.payload,widgetId:this.props.widgetId,settings:this.props.settings,controller:this.controller})}componentDidMount(){this.triggerGridExpansion(),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.TRIGGER_GRID_EXPANSION,this.triggerGridExpansion.bind(this))}triggerGridExpansion(){const e=$(this.props.root).find(".tw-block-influencers-container");n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.widgetId,expectedSize:this.props.settings.dimensions.size,realSize:new o.Vector2D(e.outerWidth(),e.outerHeight())}})}}}),define("components/bubble_dialog/influencers_list/selection/directive",["require","exports","angular","angular_utilities","jquery","notifications","reusable_utilities","classes/context_data/context_data","services/rest_form_service","services/template_source","services/tw_common"],function(e,t,i,n,s,o,r,a,c,l,d){function g(){return{templateUrl:l.templateSourceFactory("components/bubble_dialog/influencers_list/selection"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:p,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:u}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=g,t.InfluencersListSelectionDirective=g;let u=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.bottomBtn={name:a.contextData.getMessage("_1695432")}}$onInit(){this.cancellationToken=new r.CancellationToken,this.cancellationToken.addDomEvent(s(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(s(document),"mousedown",e=>this.handleMouseDown()),this.formLoaded=!1,this.saving=!1,this.newInfluencersListForm={name:"",influencer_list:this.payload.selectedInfluencers},this.initFormData(),this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}close(){this.facade.onMessage.fire({save:!1}),this.facade.destroy()}async save(){let e;this.saving=!0,e=this.newListFieldShown?c.restFormService.post(this.formData.create_list_link,this.newInfluencersListForm):this.addMultipleInfluencersToList(),o.notificationService.warning(`<i class="fa fa-refresh fa-spin"></i> ${a.contextData.getMessage("_498245")}`,{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(e=>{this.newListFieldShown&&this.handleNewListCreation(e),this.facade.onMessage.fire({result:e})},()=>void 0),this.facade.destroy()}handleNewListCreation(e){void 0===this.formData.influencer_lists.root_entry.children&&(this.formData.influencer_lists.root_entry.children=[]),this.formData.influencer_lists.root_entry.children.push({mapped_id:e.list_id,name:e.name}),this.newInfluencersListForm.name="",r.TopicEntryUtils.recursiveUnselectAndSelect(this.formData.influencer_lists.root_entry,e.list_id),this.hideNewListField(),this.applyScope()}canSave(){let e;if(this.newListFieldShown)e=this.isNewListValid();else{e=void 0!==r.TopicMenuUtils.getFirstSelectedEntry(this.formData.influencer_lists)}return!this.saving&&e}hideNewListField(){this.newListFieldShown=!1}displayNewListField(){r.TopicEntryUtils.setSelectionRecursive(this.formData.influencer_lists.root_entry,!1),this.newListFieldShown=!0}hasInfluencerLists(){return void 0!==this.formData.influencer_lists&&void 0!==this.formData.influencer_lists.root_entry&&void 0!==this.formData.influencer_lists.root_entry.children&&this.formData.influencer_lists.root_entry.children.length>0}redirect(){window.location.href=this.formData.redirect_link}isNewListValid(){return void 0!==this.newInfluencersListForm.name&&this.newInfluencersListForm.name.trim().length>0}async addMultipleInfluencersToList(){const e=c.restFormService.postRForm("influencer_list","include",{influencer_list:this.payload.selectedInfluencers,list_id:r.TopicMenuUtils.getFirstSelectedEntry(this.formData.influencer_lists).mapped_id});return await e}handleClick(e){this.$element.is(e.target)||0!==this.$element.has(e.target).length||d.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close()}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}async initFormData(){this.formData=await c.restFormService.post(this.payload.fetchUrl,{profile_image:this.payload.profileImage,profile_url:this.payload.profileUrl,influencer_id:this.payload.profileId,profile_name:this.payload.name}),this.formLoaded=!0,this.formData.disallow_adding_influencer||(this.newListFieldShown=void 0===r.TopicMenuUtils.getFirstSelectedEntry(this.formData.influencer_lists)),this.applyScope()}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}};function p(){return{post(e,t){setTimeout(()=>{e.styleInformation.setAbsoluteY(window.innerHeight/2-t.height()/2),e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}u=__decorate([n.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],u)}),define("react_components/block_based_widget/highlighted_unit",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CLASSNAME="unit-highlighted"}(t.HighlightedUnit||(t.HighlightedUnit={}))}),define("react_components/block_based_widget/toggle_options",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_based_widget/navigation_direction",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NEXT="NEXT",e.PREVIOUS="PREVIOUS",e.ABOVE="ABOVE",e.BELOW="BELOW"}(t.NavigationDirection||(t.NavigationDirection={}))}),define("react_components/block_based_widget/navigation_direction_parameters",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_based_widget/block_based_widget_default_controller",["require","exports","event_bus","keypress","log","reusable_components","reusable_utilities","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/refresh/model_refresh_service","services/tw_common","react_components/block_based_widget/highlighted_unit","react_components/block_based_widget/navigation_direction"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.BlockBasedWidgetDefaultController=class{constructor(e){this.widget=e,this.cancellationToken=new r.CancellationToken,this.widgetId=this.widget.getId(),this.payload=this.widget.getPayloadValue(),this.widgetLayout=this.widget.getDicWrapper().getConfigurationRenderingUuid(),this.selectedUnitsIds=[],this.highlightedUnitId="",this.keypressListener=void 0,this.isLoadingMore=!1,0!==this.getUnits().length&&void 0!==this.getUnits()[0]&&(this.unitIdToStartHighlighting=this.getUnitId(this.getUnits()[0]))}mergePayloads(e,t){const i=this.getUnitsByPayload(e),n=this.getUnitsByPayload(t);this.mergeUnits(i,n),n.length>0&&this.updateSelectionCheckboxAfterMerge(),this.notifyWidgetOfUpdatedPayload()}mergeUnits(e,t){e=t.reduce((e,t)=>(e.push(t),e),e||[]),this.replaceUnits(e)}setupListeners(){this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOGGLE_ALL_SELECTION,this.onToggleAllSelection.bind(this)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOGGLE_UNIT_SELECTION,this.onToggleUnitSelection.bind(this)),this.keypressListener=new n.Listener,this.registerCombos(this.generateKeyCombos())}async loadMore(e){if(!this.isLoadingMore){this.isLoadingMore=!0,document.getElementById(this.widget.getId()).style.display="block",this.widget.prepareReload(g.twCommon.reloadingStrategy.BUBBLE).getExtendedConfiguration().setLoadMoreFlag(!0).setLoadedUrls(e);const t={strategy:c.ModelRefreshStrategy.LOAD_MORE_CONTENT},i=a.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),l.ModelType.WIDGET,t);try{await d.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing widget!",void 0,e)}document.getElementById(this.widget.getId())&&(document.getElementById(this.widget.getId()).style.display="none"),this.isLoadingMore=!1}}updateSelectionCheckboxAfterMerge(){this.payload.selectionCheckboxState===o.StateButtonState.CHECKED&&(this.payload.selectionCheckboxState=o.StateButtonState.INDETERMINATE)}replacePayload(e){this.payload=e,this.notifyWidgetOfUpdatedPayload()}dispose(){this.keypressListener.reset(),this.keypressListener.destroy(),this.cancellationToken.cancel()}onToggleAllSelection(e){if(e.value===this.widgetId)switch(void 0!==this.payload.selectionCheckboxState?this.payload.selectionCheckboxState:o.StateButtonState.UNCHECKED){case o.StateButtonState.CHECKED:this.unselectAllUnits(e.value);break;case o.StateButtonState.INDETERMINATE:case o.StateButtonState.UNCHECKED:this.selectAllUnits(e.value);break;default:throw new Error("no checkbox state")}}unselectAllUnits(e){this.handleAllSelectionToggle(e,!1)}selectAllUnits(e){this.handleAllSelectionToggle(e,!0)}handleAllSelectionToggle(e,t){const i=this.getUnits();this.widgetId!==e||this.allUnitsAlreadySelected(t,i)||(this.selectedUnitsIds=t?i.map(e=>this.getUnitId(e)):[],i.forEach(e=>e.selected=t),this.payload.selectionCheckboxState=t?o.StateButtonState.CHECKED:o.StateButtonState.UNCHECKED,this.notifyWidgetOfUpdatedPayload())}allUnitsAlreadySelected(e,t){return this.selectedUnitsIds.length===(e?t.length:0)}onToggleUnitSelection(e){const{widgetId:t,toBeToggledUnitId:i,forceUpdate:n,keepSelected:s,keepUnselected:o}=e.value;if(this.widgetId===t){const e=this.selectedUnitsIds.findIndex(e=>e===i);-1===e?o||(this.selectedUnitsIds.push(i),this.getUnits().find(e=>this.getUnitId(e)===i).selected=!0,this.updateThreeStateSelectAfterUnitSelect(n)):s||(this.selectedUnitsIds.splice(e,1),this.getUnits().find(e=>this.getUnitId(e)===i).selected=!1,this.updateThreeStateSelectAfterUnitUnselect(n))}}updateThreeStateSelectAfterUnitSelect(e){this.handleThreeStateSelectUpdate(!0,e)}updateThreeStateSelectAfterUnitUnselect(e){this.handleThreeStateSelectUpdate(!1,e)}handleThreeStateSelectUpdate(e,t){const i=this.selectedUnitsIds.length,n=this.getUnits().length;i===(e?n:0)?(this.payload.selectionCheckboxState=e?o.StateButtonState.CHECKED:o.StateButtonState.UNCHECKED,this.notifyWidgetOfUpdatedPayload()):i===(e?1:n-1)?(this.payload.selectionCheckboxState=o.StateButtonState.INDETERMINATE,this.notifyWidgetOfUpdatedPayload()):t&&this.notifyWidgetOfUpdatedPayload()}notifyWidgetOfUpdatedPayload(){i.eventBus.dispatch({type:i.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE,value:void 0})}registerCombos(e){e&&e.forEach(e=>{this.keypressListener.register_combo(e)})}generateKeyCombo(e,t){return{keys:e,on_keydown:e=>t(e),prevent_default:!0}}navigateToNextUnit(e){this.navigateInDirection(p.NavigationDirection.NEXT,e)}navigateToPreviousUnit(e){this.navigateInDirection(p.NavigationDirection.PREVIOUS,e)}navigateToUnitBelow(e){this.navigateInDirection(p.NavigationDirection.BELOW,e)}navigateToUnitAbove(e){this.navigateInDirection(p.NavigationDirection.ABOVE,e)}navigateInDirection(e,t){const i=this.generateNavigationDirectionParameters(e),n=this.getUnits();if(""===this.highlightedUnitId)return void this.highlightUnit(this.unitIdToStartHighlighting);const s=this.getHighlightedUnitIndex();i.isAtBoundary()?this.handleShiftCtrlNavigation(t):(e!==p.NavigationDirection.NEXT&&e!==p.NavigationDirection.PREVIOUS||this.handleShiftCtrlNavigation(t),this.highlightUnit(this.getUnitId(n[s+i.nextToHighlightRelativeIndex])),this.handleShiftCtrlNavigation(t,i.selectOthersAroundHighlightedOffsets))}generateNavigationDirectionParameters(e){const t=this.getHighlightedUnitIndex(),i=this.getUnits();switch(e){case p.NavigationDirection.NEXT:return this.generateNextNavigationParameters(t,i);case p.NavigationDirection.PREVIOUS:return this.generatePreviousNavigationParameters(t);case p.NavigationDirection.BELOW:return this.generateBelowNavigationParameters(t,i);case p.NavigationDirection.ABOVE:return this.generateAboveNavigationParameters(t)}}handleShiftCtrlNavigation(e,t){const i=this.generateToggleOptions(e);if(void 0!==t&&void 0!==i){const e=this.getUnits(),n=this.getHighlightedUnitIndex();t.forEach(t=>this.toggleUnitSelection(this.getUnitId(e[n+t]),i))}else void 0!==i&&this.toggleHighlightedUnitSelection(i)}generateToggleOptions(e){if(!e.shiftKey||!e.ctrlKey){if(e.shiftKey)return{keepSelected:!0};if(e.ctrlKey)return{keepUnselected:!0}}}generateNextNavigationParameters(e,t){return{isAtBoundary:()=>e===t.length-1,nextToHighlightRelativeIndex:1}}generatePreviousNavigationParameters(e){return{isAtBoundary:()=>0===e,nextToHighlightRelativeIndex:-1}}generateBelowNavigationParameters(e,t){return{isAtBoundary:()=>_.range(1,5).some(i=>e===t.length-i),nextToHighlightRelativeIndex:4,selectOthersAroundHighlightedOffsets:_.range(-4,1)}}generateAboveNavigationParameters(e){return{isAtBoundary:()=>_.range(0,4).some(t=>e===t),nextToHighlightRelativeIndex:-4,selectOthersAroundHighlightedOffsets:_.range(0,5)}}toggleAllSelection(){i.eventBus.dispatch({type:i.EVENT_TYPES.TOGGLE_ALL_SELECTION,value:this.widgetId})}toggleHighlightedUnitSelection(e){this.toggleUnitSelection(this.highlightedUnitId,e)}toggleUnitSelection(e,t){if(void 0!==e&&""!==e){const{keepSelected:n,keepUnselected:s}=t;i.eventBus.dispatch({type:i.EVENT_TYPES.TOGGLE_UNIT_SELECTION,value:{widgetId:this.widgetId,toBeToggledUnitId:e,forceUpdate:!0,keepSelected:n,keepUnselected:s}})}}removeHighlighting(){this.highlightUnit("")}isHighlightedUnitNotSelected(){return 0!==this.selectedUnitsIds.length&&this.selectedUnitsIds.includes(this.highlightedUnitId)}getUnitById(e){return this.getUnits().find(t=>this.getUnitId(t)===e)}getHighlightedUnit(){return this.getUnitById(this.highlightedUnitId)}getUnitIndex(e){return this.getUnits().findIndex(t=>e===this.getUnitId(t))}getHighlightedUnitIndex(){return this.getUnitIndex(this.highlightedUnitId)}highlightUnit(e){""!==this.highlightedUnitId&&document.getElementById(r.StringUtils.sanitizeInputForHtmlAttribute(this.highlightedUnitId)).classList.remove(u.HighlightedUnit.CLASSNAME),""===e&&(this.unitIdToStartHighlighting=this.highlightedUnitId),this.highlightedUnitId=e,""!==this.highlightedUnitId&&(document.getElementById(r.StringUtils.sanitizeInputForHtmlAttribute(this.highlightedUnitId)).classList.add(u.HighlightedUnit.CLASSNAME),this.centerViewOnHighlightedUnit())}centerViewOnHighlightedUnit(){if(""!==this.highlightedUnitId){const e=document.getElementById(this.highlightedUnitId);if(e){const t=$(e).offset().top-$(window).height()/2;$(window).scrollTop(t)}}}}}),define("react_components/form/progress_button/progress_button_container",["require","exports","flux","react","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.ProgressButtonContainer=class extends i.BaseComponent{constructor(e){super(e),this.state=this.initializeState()}initializeState(){return{isClicked:!1,isCalling:!1}}isDisabled(){return this.isProgressing()||this.props.disabled}isProgressing(){return this.state.isClicked&&this.state.isCalling}getName(){return this.isProgressing()?this.props.textCalling:this.props.text}onClick(e){this.props.clickEvent&&this.props.clickEvent(),this.setState({isClicked:!0})}render(){const e=s.omit(this.props,["text","textCalling","clickEvent"]);return n.createElement("button",Object.assign({},e,{type:"button",disabled:this.isDisabled(),onClick:this.onClick.bind(this),className:"btn btn-primary "+e.className}),this.getName())}}}),define("react_components/bubble_dialogs/components/interfaces/add_influencer_to_campaign_bubble_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/add_influencer_to_campaign_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/add_influencer_to_campaign_dialog",["require","exports","event_bus","flux","react","reusable_components","reusable_utilities","classes/context_data/context_data","services/rest_form_service","wrappers/topic_menu/topic_entry_wrapper","react_components/form/progress_button/progress_button_container"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g="create-campaign";class u extends n.BaseComponent{constructor(e){super(e),this.campaigns=this.props.payload.campaignsTopicMenu,this.injectCampaignCreationOptionIntoCampaigns();const t=new l.TopicEntryWrapper(this.campaigns.root_entry.children[0]);this.mappedIdOfFirstCampaign=t.getMappedId(),this.state={canSaveInfluencerToCampaign:this.mappedIdOfFirstCampaign!==g,selectedCampaignMappedId:this.mappedIdOfFirstCampaign,selectedCampaignLabel:t.getName(),createNewCampaign:this.mappedIdOfFirstCampaign===g,newCampaignName:"",newCampaignQuery:""}}injectCampaignCreationOptionIntoCampaigns(){this.campaigns.root_entry&&this.campaigns.root_entry.children||(this.campaigns.root_entry.children=[]);const{children:e}=this.campaigns.root_entry;e.push({name:a.contextData.getMessage("_1586555"),mapped_id:g,selected:"NONE"})}render(){const e=this.state.createNewCampaign?this.renderCreateCampaignBody():this.renderCampaignsBody();return s.createElement("div",{className:"tw-bubble-dialog-add-influencer-to-campaign"},this.renderHeader(),e)}renderHeader(){return s.createElement("div",{className:"header"},s.createElement("h2",null,this.state.createNewCampaign?a.contextData.getMessage("_1586555"):a.contextData.getMessage("_1256333"),s.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}renderCampaignsBody(){return s.createElement("div",{className:"body"},s.createElement("form",{className:"form-horizontal"},s.createElement("div",{className:"form-group no-border-bottom"},s.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1211064")),s.createElement("div",{className:"col-xs-10"},s.createElement(o.SingleSelectComponent,{model:this.campaigns,selectCallback:this.selectCallback.bind(this),allowEmptySelection:!1,defaultValue:this.mappedIdOfFirstCampaign})))),s.createElement("div",{className:"tw-buttons clearfix"},s.createElement(d.ProgressButtonContainer,{text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),clickEvent:this.handleAddInfluencerToCampaignSave.bind(this),className:"tw-button pull-right",disabled:!this.state.canSaveInfluencerToCampaign})))}selectCallback(e){this.setState({selectedCampaignLabel:e.name,selectedCampaignMappedId:e.mapped_id,canSaveInfluencerToCampaign:void 0!==e.mapped_id&&e.mapped_id!==g,createNewCampaign:e.mapped_id===g})}handleAddInfluencerToCampaignSave(){if(this.state.canSaveInfluencerToCampaign){const{addInfluencerToCampaignLink:e,influencerId:t,widgetId:n}=this.props.payload,{selectedCampaignMappedId:s,selectedCampaignLabel:o}=this.state;c.restFormService.post(e,{influencer_id:t,campaign_id:s}).then(()=>{this.props.destroy(),i.eventBus.dispatch({type:i.EVENT_TYPES.ADD_TO_CAMPAIGN_BUBBLE_CLOSED,value:n}),i.eventBus.dispatch({type:i.EVENT_TYPES.INFLUENCER_WAS_ADDED_TO_CAMPAIGN,value:{influencerId:t,campaignId:s,campaignName:o}})},()=>{throw new Error("Influencer could not be added to campaign.")})}}renderCreateCampaignBody(){return s.createElement("div",{className:"body"},s.createElement("form",{className:"form-horizontal"},s.createElement("div",{className:"form-group no-border-bottom"},s.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1450686")),s.createElement("div",{className:"col-xs-10"},s.createElement("p",{className:"help-block"},a.contextData.getMessage("_1840845")),s.createElement("input",{type:"text",className:"form-control",value:this.state.newCampaignName,onChange:this.handleNameInputChange.bind(this)}))),s.createElement("div",{className:"form-group no-border-bottom"},s.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1564457")),s.createElement("div",{className:"col-xs-10"},s.createElement("p",{className:"help-block"},a.contextData.getMessage("_1589461")),s.createElement("textarea",{value:this.state.newCampaignQuery,className:"form-control",onChange:this.handleQueryInputChange.bind(this)})))),s.createElement("div",{className:"tw-buttons clearfix"},this.generateCampaignCreationButton(),this.generateCancelButton()))}handleNameInputChange(e){this.setState({newCampaignName:e.target.value})}handleQueryInputChange(e){this.setState({newCampaignQuery:e.target.value})}generateCampaignCreationButton(){return this.state.createNewCampaign?s.createElement(d.ProgressButtonContainer,{text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),clickEvent:this.handleCampaignCreationButtonClick.bind(this),className:"tw-button pull-right",disabled:!this.canCreateNewCampaign()}):void 0}handleCampaignCreationButtonClick(){if(this.canCreateNewCampaign()){const{influencerId:e,addInfluencerToNewCampaignLink:t}=this.props.payload,{newCampaignName:n,newCampaignQuery:s}=this.state;c.restFormService.post(t,{influencer_id:e,name:n,search_query:{search_query_item:{include:{search_query_items:[{text:s}]}}}}).then(t=>{this.props.destroy(),i.eventBus.dispatch({type:i.EVENT_TYPES.ADD_TO_CAMPAIGN_BUBBLE_CLOSED,value:this.props.payload.widgetId}),i.eventBus.dispatch({type:i.EVENT_TYPES.INFLUENCER_WAS_ADDED_TO_CAMPAIGN,value:{influencerId:e,campaignId:t.campaign_id,campaignName:n}})},()=>{throw this.props.destroy(),i.eventBus.dispatch({type:i.EVENT_TYPES.ADD_TO_CAMPAIGN_BUBBLE_CLOSED,value:this.props.payload.widgetId}),new Error("Could not create campaign and/or add influencer to it")})}}canCreateNewCampaign(){return""!==this.state.newCampaignQuery&&this.state.newCampaignName.length>1&&this.state.newCampaignName.length<81}generateCancelButton(){return this.state.createNewCampaign&&this.campaigns.root_entry.children.length>1?s.createElement("button",{type:"button",className:"btn btn-default pull-right",onClick:this.cancel.bind(this)},a.contextData.getMessage("_1352521")):void 0}cancel(){this.setState({createNewCampaign:!1,canSaveInfluencerToCampaign:void 0!==this.mappedIdOfFirstCampaign&&this.mappedIdOfFirstCampaign!==g})}clickInside(e){}clickOutside(e){e.preventDefault(),i.eventBus.dispatch({type:i.EVENT_TYPES.ADD_TO_CAMPAIGN_BUBBLE_CLOSED,value:this.props.payload.widgetId}),this.props.destroy()}}t.AddInfluencerToCampaignDialog=u,r.applyMixins(u,[n.DocumentClickTracker])}),define("react_components/block_based_widget/remove_tag_event_bus_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_based_widget/add_tag_event_bus_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_influencers/block_influencers_default_controller",["require","exports","block_influencers","event_bus","log","notifications","react","reusable_utilities","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/bubble_dialog","services/configuration","services/confirmation_service","services/navigation","services/refresh/model_refresh_service","services/rest_form_service","react_components/block_based_widget/block_based_widget_default_controller","react_components/bubble_dialogs/components/add_influencer_to_campaign_dialog"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersDefaultController=class extends v.BlockBasedWidgetDefaultController{constructor(e){super(e),this.findActionToSavePredicate=(e=>"fa fa-save"===e.icon),this.refreshPageStateOnBubbleClose=!1,this.isDetailedLayout()&&(this.highlightedUnitId=this.payload.influencers[0].influencer_id)}setupListeners(){super.setupListeners(),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SHOW_INFLUENCER_LISTS,this.addSingleInfluencerToList.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SAVE_SELECTED_INFLUENCERS_TO_LIST,this.addSelectedInfluencersToList.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SHOW_INFLUENCER_CAMPAIGNS,this.onShowInfluencerCampaigns.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.INFLUENCER_WAS_ADDED_TO_CAMPAIGN,this.handleInfluencerGotAddedToCampaign.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ADD_TO_CAMPAIGN_BUBBLE_CLOSED,this.onAddToCampaignBubbleClosed.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SHOW_INFLUENCER_DETAILED,this.onOpenInfluencerDetailed.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ON_REMOVE_INFLUENCER_FROM_LIST,this.onRemoveInfluencerFromList.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ADD_TAG,this.onAddTag.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.REMOVE_TAG,this.onRemoveTag.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.DISABLE_BLOCK_INFLUENCERS_KEYBINDS,()=>{this.keypressListener.stop_listening(),s.logService.debug("influencer keybinds disabled")}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ENABLE_BLOCK_INFLUENCERS_KEYBINDS,()=>{this.keypressListener.listen(),s.logService.debug("influencer keybinds enabled")})}addSingleInfluencerToList(e){this.generateInfluencerToListBubble({fetchUrl:e.value.actionPayload.action_url,profileId:e.value.actionPayload.profile_id,profileImage:e.value.actionPayload.profile_image,profileUrl:e.value.actionPayload.profile_url,name:e.value.actionPayload.name,selectedInfluencers:[{influencer_id:e.value.actionPayload.profile_id,profile_name:e.value.actionPayload.name,profile_url:e.value.actionPayload.profile_url}]},e.value.widgetId)}addSelectedInfluencersToList(e){let t;const i=[];this.selectedUnitsIds.forEach(e=>{const t=this.payload.influencers.find(t=>t.influencer_id===e);i.push({influencer_id:t.influencer_id,profile_name:t.metadata.profile_name,profile_url:t.metadata.profile_url})}),0!==i.length&&(t=1!==i.length?{selectedInfluencers:i,fetchUrl:e.value.fetchUrl}:{selectedInfluencers:i,fetchUrl:e.value.fetchUrl,profileId:i[0].influencer_id,profileUrl:i[0].profile_url,name:i[0].profile_name},this.generateInfluencerToListBubble(t,e.value.widgetId))}generateInfluencerToListBubble(e,t){if(void 0!==this.listBubble&&this.listBubble.destroy(),this.widgetId===t){this.keypressListener.stop_listening();const t=constants.bubble_dialog.id.influencers_list_selection,i=h.configurationService.getBubbleDialogConfiguration().getStyle(t);this.listBubble=p.bubbleDialogService.createByType(t,$("body"),t,e,i,{preventOutsideClickActions:!0,fadeOtherBubbles:!0,fadeBackground:!0}),this.handleBubbleGotClosed()}}handleBubbleGotClosed(){this.cancellationToken.subscribe(this.listBubble.onMessage,e=>{if(this.keypressListener.listen(),void 0!==e.result){const{result:t}=e;this.handleInfluencersGotSavedToList(t)}})}handleInfluencersGotSavedToList(e){e.influencer_id_list.forEach(t=>{this.injectMatchingListIntoInfluencerPayload({label:e.list_name,list_id:e.list_id},t)}),this.notifyWidgetOfUpdatedPayload()}injectMatchingListIntoInfluencerPayload(e,t){const i=this.payload.influencers.find(e=>e.influencer_id===t);if(void 0===i)throw new Error("No influencer to inject new payload into found");void 0===i.matching_lists?i.matching_lists=[e]:this.wasNotPartOfListYet(i,e)&&i.matching_lists.push(e)}wasNotPartOfListYet(e,t){return-1===e.matching_lists.findIndex(e=>e.label===t.label&&e.list_id===t.list_id)}async onShowInfluencerCampaigns(e){if(void 0!==this.campaignBubble&&this.campaignBubble.destroy(),this.widgetId===e.value.widgetId){this.keypressListener.stop_listening();const{profile_id:t,action_url:i}=e.value.actionPayload,n=constants.bubble_dialog.id.influencer_add_to_campaign,s=await y.restFormService.get(i),o=h.configurationService.getBubbleDialogConfiguration().getStyle(n);o.setAbsoluteY(window.innerHeight/2.5-o.minHeight/2.5);const{campaigns:a,add_influencer_link:c,add_influencer_to_new_campaign_link:l}=s,d={campaignsTopicMenu:a,influencerId:t,addInfluencerToCampaignLink:c,addInfluencerToNewCampaignLink:l,widgetId:this.widgetId};this.campaignBubble=p.bubbleDialogService.createReactBubble(n,$("body"),d,e=>(e.payload=d,r.createElement(S.AddInfluencerToCampaignDialog,{payload:e.payload,destroy:e.destroy})),o,{preventOutsideClickActions:!0})}}handleInfluencerGotAddedToCampaign(e){const t=e.value.campaignName,i=e.value.campaignId,n=e.value.influencerId;this.injectCampaignIntoInfluencerPayload({label:t,list_id:i},n),this.notifyWidgetOfUpdatedPayload()}injectCampaignIntoInfluencerPayload(e,t){const i=this.payload.influencers.find(e=>e.influencer_id===t);if(void 0===i)throw new Error("No influencer to inject new payload into found");void 0===i.matching_campaigns?i.matching_campaigns=[e]:i.matching_campaigns.push(e)}onAddToCampaignBubbleClosed(e){this.widgetId===e.value&&this.keypressListener.listen()}onOpenInfluencerDetailed(e){if(this.widgetId===e.value.widgetId){this.keypressListener.stop_listening();const t=[[{key:"QUERY",value:e.value.query}]];_.navigationService.openDrilldown(t,void 0,e.value.pageType,void 0,this.widget,()=>this.handleInfluencerDetailedClose(),void 0,!0)}}onRemoveInfluencerFromList(e){this.widgetId===e.value.widgetId&&(this.keypressListener.stop_listening(),m.confirmationService.display({message:e.value.confirmationMessage}).then(()=>{const t=y.restFormService.get(e.value.actionPayload.action_url);o.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+l.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:t}),t.then(()=>{this.handleInfluencerGotDeletedFromList(e.value.actionPayload.profile_id)},()=>{throw this.keypressListener.listen(),new Error("could not delete influencer")})},()=>{this.keypressListener.listen()}))}handleInfluencerDetailedClose(){this.keypressListener.listen(),this.refreshPageStateOnBubbleClose&&this.refreshPageData()}handleInfluencerGotDeletedFromList(e){const t=this.getUnitIndex(e);if(-1===t)throw new Error("could not find influencer to delete");{this.payload.influencers.splice(t,1);const{influencers:i}=this.payload;e===this.highlightedUnitId&&(void 0!==i[t]?this.highlightUnit(i[t].influencer_id):t-1>=0&&void 0!==i[t-1]?this.highlightUnit(i[t-1].influencer_id):(this.highlightedUnitId="",this.unitIdToStartHighlighting="",this.keypressListener.stop_listening())),this.notifyWidgetOfUpdatedPayload()}this.keypressListener.listen()}async onAddTag(e){const{name:t,unitId:i}=e.value,n=this.getUnitById(i),{labels:s=[]}=n;if(void 0===s.find(e=>e.name===t)){if(e.value.widgetId===this.widgetId)try{await y.restFormService.postRForm("influencer_labels","add",{influencer_id:i,label:t})}catch(e){throw e}s.push({name:t,code:t,marking_tag:!1}),this.notifyWidgetOfUpdatedPayload(),!this.refreshPageStateOnBubbleClose&&this.isTagNotInProjectYet(t)&&(this.refreshPageStateOnBubbleClose=!0)}}isTagNotInProjectYet(e){return void 0===this.payload.project_labels.find(t=>t.name===e)}async onRemoveTag(e){const{tag:t,unitId:i}=e.value;if(e.value.widgetId===this.widgetId)try{await y.restFormService.deleterRForm("influencer_labels","remove",{label:t.name,influencer_id:i})}catch(e){throw e}const n=this.getUnitById(i);n.labels.splice(n.labels.findIndex(e=>e.name===t.name),1),this.notifyWidgetOfUpdatedPayload()}generateKeyCombos(){switch(this.widgetLayout){case i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID:return this.generateGridLayoutKeyCombos();case i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST:return this.generateListLayoutKeyCombos();case i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED:return this.generateDetailedLayoutKeyCombos();case i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LABELS:return;default:throw new Error("No influencer widget layout")}}generateGridLayoutKeyCombos(){return[this.generateKeyCombo(a.KeyCodes.RIGHT,this.navigateToNextUnit.bind(this)),this.generateKeyCombo(a.KeyCodes.LEFT,this.navigateToPreviousUnit.bind(this)),this.generateKeyCombo(a.KeyCodes.DOWN,this.navigateToUnitBelow.bind(this)),this.generateKeyCombo(a.KeyCodes.UP,this.navigateToUnitAbove.bind(this)),this.generateKeyCombo(a.KeyCodes.SPACE,this.toggleHighlightedUnitSelection.bind(this)),this.generateKeyCombo(a.KeyCodes.A,this.toggleAllSelection.bind(this)),this.generateKeyCombo(a.KeyCodes.S,this.handleSaveToList.bind(this)),this.generateKeyCombo(a.KeyCodes.CTRL+" "+a.KeyCodes.S,this.handleSaveMultipleToList.bind(this)),this.generateKeyCombo(a.KeyCodes.ENTER,this.openHighlightedInfluencerDetailedView.bind(this)),this.generateKeyCombo(a.KeyCodes.NUM_ENTER,this.openHighlightedInfluencerDetailedView.bind(this)),this.generateKeyCombo(a.KeyCodes.F,this.openHighlightedInfluencerProfile.bind(this)),this.generateKeyCombo(a.KeyCodes.ESCAPE,this.removeHighlighting.bind(this))]}generateListLayoutKeyCombos(){return[this.generateKeyCombo(a.KeyCodes.DOWN,this.navigateToNextUnit.bind(this)),this.generateKeyCombo(a.KeyCodes.UP,this.navigateToPreviousUnit.bind(this)),this.generateKeyCombo(a.KeyCodes.ENTER,this.openHighlightedInfluencerDetailedView.bind(this)),this.generateKeyCombo(a.KeyCodes.NUM_ENTER,this.openHighlightedInfluencerDetailedView.bind(this)),this.generateKeyCombo(a.KeyCodes.F,this.openHighlightedInfluencerProfile.bind(this)),this.generateKeyCombo(a.KeyCodes.RIGHT,this.openHighlightedInfluencerProfile.bind(this)),this.generateKeyCombo(a.KeyCodes.D,this.addHighlightedInfluencerToCampaign.bind(this)),this.generateKeyCombo(a.KeyCodes.X,this.removeHighlightedInfluencerFromList.bind(this)),this.generateKeyCombo(a.KeyCodes.DELETE,this.removeHighlightedInfluencerFromList.bind(this)),this.generateKeyCombo(a.KeyCodes.ESCAPE,this.removeHighlighting.bind(this))]}generateDetailedLayoutKeyCombos(){return[this.generateKeyCombo(a.KeyCodes.F,this.openHighlightedInfluencerProfile.bind(this)),this.generateKeyCombo(a.KeyCodes.RIGHT,this.openHighlightedInfluencerProfile.bind(this)),this.generateKeyCombo(a.KeyCodes.S,this.handleSaveToList.bind(this)),this.generateKeyCombo(a.KeyCodes.D,this.addHighlightedInfluencerToCampaign.bind(this))]}handleSaveToList(e){if(!e.ctrlKey){const e=this.getUnitById(this.highlightedUnitId);if(e){const t=e.action_links.find(this.findActionToSavePredicate).click_action.action_payload;n.eventBus.dispatch({type:n.EVENT_TYPES.SHOW_INFLUENCER_LISTS,value:{widgetId:this.widgetId,actionPayload:t}})}}}handleSaveMultipleToList(){this.selectedUnitsIds.length>0&&n.eventBus.dispatch({type:n.EVENT_TYPES.SAVE_SELECTED_INFLUENCERS_TO_LIST,value:{widgetId:this.widgetId,fetchUrl:this.payload.action_links[0].action_url}})}openHighlightedInfluencerDetailedView(){if(""!==this.highlightedUnitId){const e=this.payload.influencers.find(e=>e.influencer_id===this.highlightedUnitId);n.eventBus.dispatch({type:n.EVENT_TYPES.SHOW_INFLUENCER_DETAILED,value:{influencerId:e.influencer_id,widgetId:this.widgetId,pageType:e.drilldown_page_type}})}}openHighlightedInfluencerProfile(){const e=this.getHighlightedUnit();if(void 0!==e&&0!==e.alias.length&&void 0!==e.alias[0]&&void 0!==e.alias[0].click_action&&void 0!==e.alias[0].click_action.url){const{url:t,safe_redirect_url:i}=e.alias[0].click_action;window.open(void 0!==i?i:t,"blank")}}addHighlightedInfluencerToCampaign(){const e=this.getHighlightedUnit();if(void 0===e)return;const t=e.action_links.find(e=>"icon-tw-plus-sign"===e.icon);void 0!==t&&void 0!==t.click_action&&void 0!==t.click_action.action_payload&&(this.keypressListener.stop_listening(),n.eventBus.dispatch({type:n.EVENT_TYPES.SHOW_INFLUENCER_CAMPAIGNS,value:{widgetId:this.widgetId,actionPayload:e.action_links[0].click_action.action_payload}}))}removeHighlightedInfluencerFromList(){const e=this.getHighlightedUnit();if(void 0===e)return;const t=e.action_links.find(e=>"fa fa-trash"===e.icon);void 0!==t&&void 0!==t.click_action&&void 0!==t.click_action.action_payload&&void 0!==t.click_action.confirmation_message&&n.eventBus.dispatch({type:n.EVENT_TYPES.ON_REMOVE_INFLUENCER_FROM_LIST,value:{confirmationMessage:t.click_action.confirmation_message,widgetId:this.widgetId,actionPayload:t.click_action.action_payload}})}isGridLayout(){return this.widgetLayout===i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID}isDetailedLayout(){return this.widgetLayout===i.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED}canLoadMore(){return this.payload.influencers.length<this.payload.influencer_count&&this.isGridLayout()}mergePayloads(e,t){let i=e.influencers;const n=t.influencers;i=n.reduce((e,t)=>(e.push(t),e),i||[]),this.replaceUnits(i),t.influencer_count&&t.formatted_influencer_count&&(this.payload.influencer_count=t.influencer_count,this.payload.formatted_influencer_count=t.formatted_influencer_count),n.length>0&&this.updateSelectionCheckboxAfterMerge(),this.notifyWidgetOfUpdatedPayload()}buildSettings(e){const t=this.widget.getDicWrapper().getConfigurationRenderingUuid(),i=this.payload.influencer_count,n=this.payload.formatted_influencer_count,s=this.widget.getWidth(),o=e.dimensions.width,r=e.dimensions.height,a=this.payload.project_labels;return{layout:t,numUnits:i,size:s,width:o,height:r,messages:{selectionOptionsMessages:{selectAll:l.contextData.getMessage("_1653543"),unselectAll:l.contextData.getMessage("_1354655"),selectSome:l.contextData.getMessage("_1436534"),selectAllTooltip:l.contextData.getMessage("_1353232"),unselectAllTooltip:l.contextData.getMessage("_1435856"),numberOfUnits:l.contextData.getMessage("_1206515",[n])},unitSelectionOptionsMessages:{selectOne:l.contextData.getMessage("_1645654"),unselectOne:l.contextData.getMessage("_1745654")},matchingListsHelpText:l.contextData.getMessage("_1365235"),noMoreToLoad:l.contextData.getMessage("_1353233"),currentCampaignsHeader:l.contextData.getMessage("_1654789"),noCurrentCampaigns:l.contextData.getMessage("_1654791"),tooManyCampaignsToDisplay:l.contextData.getMessage("_1654790"),avatarTooltip:l.contextData.getMessage("_1584764"),matchingListsHeader:l.contextData.getMessage("_1365235"),newLabelPlaceholder:l.contextData.getMessage("_1056847")},formattedNumUnits:n,projectLabels:a}}replaceUnits(e){this.payload.influencers=e}getUnits(){return this.payload.influencers}getUnitsByPayload(e){return e.influencers}getUnitId(e){return e.influencer_id}async refreshPageData(){const e={strategy:g.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(c.mainApplication.getPageState(),c.mainApplication,u.ModelType.PAGE_STATE,e);try{return await f.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error(e.message)}}}}),define("classes/widget/fragments/directive/block_influencers_fragment",["require","exports","react","react-dom","widget_base","react_components/block_influencers/block_influencers_widget_container","react_components/block_influencers/block_influencers_default_controller","event_bus"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersFragment=class extends s.AbstractReactFragment{constructor(e){super(e),this.controller=new r.BlockInfluencersDefaultController(e.widget)}renderIntoContainer(e,t,s,r){n.render(i.createElement(o.BlockInfluencersWidgetContainer,{mediator:r,controller:this.controller,settings:s,widgetId:this.fragmentModel.widget.getId(),widget:this.fragmentModel.widget,root:this.chartContainer}),this.chartContainer)}update(e,t){const i=e.widget.getPayloadValue();return t===s.DataAction.MORE_DATA&&i.influencers.length>0&&this.controller.mergePayloads(this.controller.payload,i),(i.influencers.length<=0||this.controller.payload.influencers.length>=this.fragmentModel.widget.getPayloadValue().influencer_count)&&(this.controller.canLoadMore=(()=>!1),a.eventBus.dispatch({value:void 0,type:a.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE})),t===s.DataAction.DATA_CHANGED&&(this.controller.replacePayload(i),a.eventBus.dispatch({value:void 0,type:a.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE})),a.eventBus.dispatch({value:void 0,type:a.EVENT_TYPES.TRIGGER_GRID_EXPANSION}),super.update(e,t)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/block_influencers_blueprint",["require","exports","classes/widget/fragments/directive/block_influencers_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[r.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,n.TopWidgetMenusFragment],[r.WidgetLayoutBlockId.BODY]:[i.BlockInfluencersFragment],[r.WidgetLayoutBlockId.FOOTER]:[]},buildConfigurations:o.defaultBuildConfigurations.extend([{key:i.BlockInfluencersFragment,value:{}}])}}}),define("react_components/block_issues/interfaces/block_issues_widget_container_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/block_issues/block_issues_widget_container",["require","exports","block_issue","event_bus","flux","math_utils","react"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesWidgetContainer=class extends s.BaseComponent{constructor(e){super(e),this.controller=this.props.controller}render(){return r.createElement(i.BlockIssuesContainer,{mediator:this.props.mediator,payload:this.controller.payload,widgetId:this.props.widget.getId(),settings:this.props.settings,controller:this.controller})}componentDidMount(){this.triggerGridExpansion(),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.TRIGGER_GRID_EXPANSION,this.triggerGridExpansion.bind(this))}triggerGridExpansion(){const e=$(this.props.root).find(".tw-block-issues-container");n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.widget.getId(),expectedSize:this.props.settings.dimensions.size,realSize:new o.Vector2D(e.outerWidth(),e.outerHeight())}})}}}),define("react_components/block_issues/block_issues_batch_size",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BLOCK_ISSUES_BATCH_SIZE=24}),define("forms/query_validator",["require","exports","angular","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),o.$inject=["$q","$http"];const s={delay:500};function o(e,t){return o.$inject=["$scope","$element","$attrs","ngModelController"],{restrict:"A",require:"ngModel",link:o};function o(o,r,a,c){let l;const d=n.debounce((e,n)=>{t(e).then(e=>(function(e,t){const n=e.data.query_error_info;return i.isUndefined(n)?(c.errorData.query=void 0,o.$evalAsync(),t.resolve(!0)):(c.errorData.query={message:n.message,start:{line:n.position.start_line-1,ch:n.position.start_column},end:{line:n.position.end_line-1,ch:n.position.end_column}},o.$evalAsync(),t.reject("queryErrorInfo.exception_message"))})(e,n))},s.delay);return l="0"!==window.tw.project_id?routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,"query_editor","validate","","rform").url:void 0,c.$asyncValidators.query=g,void(c.errorData=c.errorData||{});function g(t,i){if(void 0!==l){const i={method:"POST",url:l,data:{text:t,modify:"true"===a.modifyQuery,context:{location:a.queryValidator||"UNKNOWN"}}},s=e.defer();return function(e,t,i){n([void 0,""]).contains(t)?e.resolve(!0):d(i,e)}(s,t,i),s.promise}return e.defer().promise}}}t.default=o}),define("forms/code_container/directive",["require","exports","angular","underscore","reusable_utilities","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),a.$inject=["CodeSuggestions"];const r={UP:38,DOWN:40,ESC:27,TAB:9,ENTER:13};function a(e){return a.$inject=["$element","$scope","$timeout"],{replace:!0,restrict:"E",transclude:!0,scope:{formData:"=?",configuration:"=?",location:"@?"},controller:a,controllerAs:"ctrl",link:function(e){e.formData=e.formData||{errorData:{}},e.getErrorData=(t=>e.formData&&e.formData.errorData[t]),e.getErrorMap=(()=>i.isDefined(e.formData)?e.formData.$error:{}),e.isPending=(()=>e.formData&&!0===e.formData.$pending),e.isPristine=(()=>e.formData&&!0===e.formData.$pristine)},templateUrl:o.templateSourceFactory("forms/code_container")};function a(o,a,c){const l=this;let d,g;const u=n(y).throttle(25);return(()=>{void 0===a.configuration&&(a.configuration=t.defaultCodeContainerConfiguration),c(()=>{const t="0"!==window.tw.project_id?routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,"query_editor","show","","rform").url:void 0;void 0!==t&&(d=new e(t,{location:a.location||a.configuration.location}))}),l.input={configuration:a.configuration},l.suggestions={updateSuggestions:n.debounce(m,500)},a.getRelativeSuggestionBoxPosition=f,a.hasFocus=p,a.shouldDisplayErrorMessages=(()=>!a.configuration.hideErrorMessages);const i=new s.CancellationToken,g=void 0===a.configuration.stopEscapePropagation||a.configuration.stopEscapePropagation;i.addDomEvent(o.get(0),"keydown",function(e,t){try{switch(t.keyCode){case r.DOWN:l.suggestions.selectNext(),t.stopPropagation();break;case r.UP:l.suggestions.selectPrevious(),t.stopPropagation();break;case r.ENTER:case r.TAB:!function(){const e=l.suggestions.getSelected();void 0!==e&&(l.suggestions.resetSuggestions(),t.preventDefault(),t.stopPropagation(),l.input.editor.insertSuggestion(e))}();break;case r.ESC:l.suggestions.resetSuggestions(),e&&t.stopPropagation()}a.$evalAsync()}catch(e){}}.bind(this,g),!0),i.addDomEvent(o.get(0),"keyup",_),i.registerCleanupFunction(a.$watch(()=>a.formData&&a.formData.errorData.query,h)),i.registerCleanupFunction(a.$on("searchExecuted",()=>l.suggestions.resetSuggestions())),a.$on("$destroy",()=>{i.cancel()})})();function p(){return n(o.find("textArea")).filter(e=>e===document.activeElement).length>0}function h(e,t){i.isDefined(l.input.editor)&&(l.input.editor.resetErrorRegion(),n([t,void 0]).contains(e)||l.input.editor.highlightErrorRegion(e.start,e.end))}function m(e,t){void 0!==d&&d.getSuggestions(e,t).then(e=>l.suggestions.setSuggestions(e))}function _(e){e.stopPropagation()}function f(){return i.isDefined(g)?(u(),g):y()}function y(){const e=o.offset(),t=i.isDefined(l.input.editor)?l.input.editor.getSuggestionBoxPosition():{x:0,y:0};return g={left:5+t.x-e.left,top:5+t.y-e.top}}}}t.defaultCodeContainerConfiguration={inputMode:!1,isReadOnly:!1,forceFocus:!1,selectAll:!1,stopEscapePropagation:!1,hideErrorMessages:!1},t.default=a}),define("components/modals/generic_text_input/directive",["require","exports","map","services/template_source"],function(e,t,i,n){function s(){return{restrict:"A",bindToController:{payload:"=",ok:"&",cancel:"=",modalOptions:"="},controllerAs:"vm",controller:r,templateUrl:n.templateSourceFactory("components/modals/generic_text_input"),scope:{}}}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.GenericTextInputDirective=s,function(e){e.INPUT="input",e.LINK="link_field",e.TEXTAREA="textarea",e.SINGLE_SELECT="single_select",e.TREE_SELECT="tree_select",e.TOPIC_MENU_SELECT="topic_menu_select",e.COLOR_PICKER="color_picker",e.COLOR_SELECT="color_select",e.MULTIPLE_CHECKBOX="multiple_checkbox",e.FILE_UPLOAD="file_upload"}(o=t.InputTypes||(t.InputTypes={}));class r{constructor(){}$onInit(){this.codeContainerConfiguration=new i.Map,this.payload.fields.forEach(e=>{e.type=e.type||o.INPUT,e.type===o.INPUT&&(e.initialValue=e.initialValue||"",e.useCodeCompletion=e.useCodeCompletion||!1),e.type===o.TEXTAREA&&(e.rows=e.rows||4),e.required=void 0===e.required||e.required,e.useCodeCompletion&&this.codeContainerConfiguration.set(e.name,{maxLength:e.maxLength,inputMode:!0})})}getTitle(){return this.payload.title}getFields(){return this.payload.fields}handleKeyDown(e,t){13===t.keyCode&&e&&this.save()}save(){this.ok({values:_.flatten(this.payload.fields.map(e=>this.getFieldValue(e)))})}close(){this.cancel(void 0,this.modalOptions)}hasPostTitleIcon(){return void 0!==this.payload.postTitleIcon}hasDescription(e){return void 0!==e.description&&e.description.length>0}postTitleIconClick(){const{action:e}=this.payload.postTitleIcon;e&&e().then(()=>this.close())}getPostTitleStyle(){return`${this.getPostTitleIconLabel()}`}getPostTitleContainerStyle(){const{action:e}=this.payload.postTitleIcon;return e?"button":""}changeColor(e,t){e.initialValue=t}getPostTitleIconLabel(){return this.payload.postTitleIcon.label}getFieldValue(e){switch(e.type){case"file_upload":const t=e;return[t.initialValue,t.placeholder];default:return[e.initialValue]}}getFieldInputName(e){return e.name.trim().toLowerCase().replace(/\s/g,"_")}getCodeContainerConfiguration(e){return this.codeContainerConfiguration.get(e.name)}}t.GenericTextInputController=r}),define("react_components/block_issues/block_issues_default_controller",["require","exports","event_bus","reusable_utilities","wrappers/topic_menu/topic_menu_wrapper","react_components/block_based_widget/block_based_widget_default_controller","block_issue","classes/application/application","services/navigation","services/modal","services/issue_tracker_service","services/rest_form_service","classes/context_data/context_data","classes/restform_click_action/restform_click_action_default_handler"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesDefaultController=class extends o.BlockBasedWidgetDefaultController{constructor(e){super(e),this.findActionToSavePredicate=(e=>"fa fa-crosshairs"===e.icon),this.restformClickActionCancellationTokenChannelId="restformClickActionHandler",this.restformClickActionHandler=new p.RestformClickActionDefaultHandler({cancellationToken:this.cancellationToken.createChannel(this.restformClickActionCancellationTokenChannelId),shouldHandleDelete:!0,shouldHandleGet:!0,shouldHandlePost:!0,widgetId:this.widgetId})}buildSettings(e){const t=this.widget.getDicWrapper().getConfigurationRenderingUuid(),i=this.widget.getWidth(),n=e.dimensions.width,s=e.dimensions.height,o=e.style.formatting.numberFormatter;return{layout:t,numUnits:void 0,size:i,width:n,height:s,messages:{selectionOptionsMessages:{selectAll:u.contextData.getMessage("_1753543"),unselectAll:u.contextData.getMessage("_1754655"),selectSome:u.contextData.getMessage("_1736534"),selectAllTooltip:u.contextData.getMessage("_1753232"),unselectAllTooltip:u.contextData.getMessage("_1735856")},unitSelectionOptionsMessages:{selectOne:u.contextData.getMessage("_1845654"),unselectOne:u.contextData.getMessage("_1845655")},noMoreToLoad:u.contextData.getMessage("_1353234")},numberFormatter:o}}setupListeners(){super.setupListeners(),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.SHOW_WATCHLISTS,this.onShowWatchLists.bind(this)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.SHOW_ISSUE_DETAILED,this.onOpenIssueDetailed.bind(this)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.ISSUE_WAS_ADDED_TO_WATCHLIST,this.handleIssueGotSavedToList.bind(this)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.OPEN_EDIT_ITEM,this.editItem.bind(this)),this.cancellationToken.subscribe(this.restformClickActionHandler.postDeleteCallEvent,this.postDeleteCall.bind(this))}async onShowWatchLists(e){if(this.widgetId===e.value.widgetId){this.keypressListener.stop_listening();const t=await l.modalService.display("ADD_TO_WATCHLIST",{ufs:a.mainApplication.getPageState().getUserFilterSettings(),issues:[].concat(this.payload.issues.filter(t=>-1!==this.selectedUnitsIds.indexOf(t.id)||e.value.issueId===t.id))});if(t)if(this.isAddSingleIssueToWatchlist(t)){const{watchlistMappedId:e,label:i,description:n,colors:s,id:o}=t;await d.issueTrackerService.addToSpecificWatchlist({ufs:a.mainApplication.getPageState().getUserFilterSettings().toProto(),watch_list_mapped_id:e,name:i,colors:s,description:n,watch_item_mapped_id:o})}else{const{issues:e,watchlistMappedId:i}=t,n=e.map(e=>e.id);await d.issueTrackerService.addMultipleToWatchList({ufs:a.mainApplication.getPageState().getUserFilterSettings().toProto(),watch_list_mapped_id:i,codes:n})}this.keypressListener.listen()}}async editItem(e){this.keypressListener.stop_listening();try{const t=await g.restFormService.getRForm("issue","show",e.value.issue_id),i=this.buildModalPayload(t),n=await l.modalService.display("GENERIC_TEXT_INPUT",i),[s,o,r,a,c]=n;t.name=r,t.description=c;const d=await g.restFormService.postRForm("issue","update",t,e.value.issue_id);this.payload.issues[this.getUnitIndex(e.value.issue_id)].name[0].text=d.name}catch(e){}this.notifyWidgetOfUpdatedPayload(),this.keypressListener.listen()}buildModalPayload(e){const{brand_name:t,issue_name:i,name:n,description:s,colors:o}=e;return{title:n,fields:[{name:u.contextData.getMessage("_789509"),type:"message",description:t},{name:u.contextData.getMessage("_789571"),type:"message",description:i},{name:u.contextData.getMessage("_994620"),initialValue:n,errorTooLong:u.contextData.getMessage("_789485",["60"]),errorEmpty:u.contextData.getMessage("_789484"),maxLength:60,autoFocus:!1},{name:u.contextData.getMessage("_789402"),type:"color_select",colors:o,required:!1},{name:u.contextData.getMessage("_994621"),type:"textarea",initialValue:s,rows:4,required:!1}]}}isAddSingleIssueToWatchlist(e){return void 0!==e.label||void 0!==e.description||void 0!==e.colors}handleIssueGotSavedToList(e){const{value:t}=e,i=new s.TopicMenuWrapper(t.watchlists).getFirstSelectedEntry();e.value.selected_issues.map(e=>this.injectMatchingListIntoIssuePayload({label:i.getName(),list_id:i.getMappedId()},e.id)),this.notifyWidgetOfUpdatedPayload()}injectMatchingListIntoIssuePayload(e,t){const i=this.payload.issues.find(e=>e.id===t);if(void 0===i)throw new Error("No issue to inject new payload into found");void 0===i.watchlists?i.watchlists=[e]:this.wasNotPartOfListYet(i,e)&&i.watchlists.push(e)}wasNotPartOfListYet(e,t){return e.watchlists.filter(e=>_.isEqual(e,t)).length>0}onOpenIssueDetailed(e){if(this.widgetId===e.value.widgetId){this.keypressListener.stop_listening();const t=[n.StringUtils.parseFilters(e.value.filterString)];c.navigationService.openDrilldownWithPayload({filters:t,requestedPageType:e.value.pageType,widget:this.widget,closeBubbleHandler:()=>this.keypressListener.listen(),fadeBackground:!0})}}generateKeyCombos(){switch(this.widgetLayout){case r.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID:return this.generateGridLayoutKeyCombos();default:throw new Error("No issue widget layout")}}generateGridLayoutKeyCombos(){return[this.generateKeyCombo(n.KeyCodes.RIGHT,this.navigateToNextUnit.bind(this)),this.generateKeyCombo(n.KeyCodes.LEFT,this.navigateToPreviousUnit.bind(this)),this.generateKeyCombo(n.KeyCodes.DOWN,this.navigateToUnitBelow.bind(this)),this.generateKeyCombo(n.KeyCodes.UP,this.navigateToUnitAbove.bind(this)),this.generateKeyCombo(n.KeyCodes.SPACE,this.toggleHighlightedUnitSelection.bind(this)),this.generateKeyCombo(n.KeyCodes.A,this.toggleAllSelection.bind(this)),this.generateKeyCombo(n.KeyCodes.S,this.handleSaveToList.bind(this)),this.generateKeyCombo(n.KeyCodes.ESCAPE,this.removeHighlighting.bind(this))]}handleSaveToList(){let e;if(""===this.highlightedUnitId){if(0===this.selectedUnitsIds.length)return;e=this.getIssueIdToSaveFromPayload(this.selectedUnitsIds[0])}else this.isHighlightedUnitNotSelected()&&this.toggleHighlightedUnitSelection(),e=this.getIssueIdToSaveFromPayload(this.highlightedUnitId);i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_WATCHLISTS,value:{widgetId:this.widgetId,actionPayload:e}})}getIssueIdToSaveFromPayload(e){return this.payload.issues.find(t=>t.id===e).action_links.find(this.findActionToSavePredicate).click_action.issue_id}isGridLayout(){return this.widgetLayout===r.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID}canLoadMore(){return!1}replaceUnits(e){this.payload.issues=e}getUnits(){return this.payload.issues}getUnitId(e){return e.id}mergeIssues(e,t){e=t.reduce((e,t)=>(e.push(t),e),e||[]),this.replaceUnits(e),t.length>0&&this.updateSelectionCheckboxAfterMerge(),this.notifyWidgetOfUpdatedPayload()}addToCurrentPayload(e){this.mergeUnits(this.payload.issues,e.issues)}getUnitsByPayload(e){return e.issues}async postDeleteCall(e){const t=e.value.action_payload.action_url.split("/"),i=t[t.length-1].split("%7C").join("|"),n=this.getUnits().filter(e=>e.id!==i);this.replaceUnits(n),n.length>0&&this.updateSelectionCheckboxAfterMerge(),this.notifyWidgetOfUpdatedPayload()}}}),define("classes/widget/fragments/directive/block_issues_fragment",["require","exports","react","react-dom","widget_base","event_bus","react_components/block_issues/block_issues_widget_container","react_components/block_issues/block_issues_batch_size","react_components/block_issues/block_issues_default_controller"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesFragment=class extends s.AbstractReactFragment{constructor(e){super(e),this.controller=new c.BlockIssuesDefaultController(e.widget)}renderIntoContainer(e,t,s,o){n.render(i.createElement(r.BlockIssuesWidgetContainer,{mediator:o,controller:this.controller,settings:s,widget:this.fragmentModel.widget,root:this.chartContainer}),this.chartContainer)}update(e,t){const i=e.widget.getPayloadValue();return i.issues.length>0?t===s.DataAction.MORE_DATA&&(i.issues.length<a.BLOCK_ISSUES_BATCH_SIZE&&(this.controller.canLoadMore=(()=>!1)),this.controller.addToCurrentPayload(i)):(this.controller.canLoadMore=(()=>!1),o.eventBus.dispatch({value:void 0,type:o.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE})),t===s.DataAction.DATA_CHANGED&&(this.controller.replacePayload(i),o.eventBus.dispatch({value:void 0,type:o.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE})),o.eventBus.dispatch({value:void 0,type:o.EVENT_TYPES.TRIGGER_GRID_EXPANSION}),super.update(e,t)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/block_issues_blueprint",["require","exports","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/block_issues_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[o.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,i.TopWidgetMenusFragment],[o.WidgetLayoutBlockId.BODY]:[r.BlockIssuesFragment],[o.WidgetLayoutBlockId.FOOTER]:[]},buildConfigurations:s.defaultBuildConfigurations.extend([{key:r.BlockIssuesFragment,value:{}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/bubble_chart_blueprint",["require","exports","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","bubble_chart","canvas_axes","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[n.WidgetLayoutBlockId.HEADER]:[c.WidgetHeaderFragment,d.TopWidgetMenusFragment,s.ReplayDateFragment],[n.WidgetLayoutBlockId.BODY]:[o.BubbleChartFragment,i.LegendFragment],[n.WidgetLayoutBlockId.FOOTER]:[g.BottomWidgetMenusFragment,a.ReplayFragment]},buildConfigurations:l.defaultBuildConfigurations.extend([{key:i.LegendFragment,value:{colorPaletteBuilder:i.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!1,type:i.LegendTypes.LINE}},{key:o.BubbleChartFragment,value:{colorPaletteBuilder:u.combineColorPalettes([o.BubbleColorPaletteBuilder,r.CanvasAxesColorPaletteBuilder])}}])}}}),define("components/form_fragments/campaign/info/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/form_fragments/campaign/info"),scope:{}}};class n{}t.CampaignInfoFormFragmentController=n}),define("components/form_fragments/campaign/schedule/directive",["require","exports","angular","angular_utilities","jquery","services/configuration","reusable_utilities","moment-timezone","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:d,templateUrl:l.templateSourceFactory("components/form_fragments/campaign/schedule"),scope:{}}};let d=class{constructor(e,t,i,n,s){this.$scope=e,this.$element=t,this.$rootScope=i,this.calendarService=n,this.Calendar=s}$onInit(){this.onBulletSelection=this.handleBulletChange.bind(this),this.calendarValues={from:{hours:"",minutes:""},to:{hours:"",minutes:""}},this.calendarService.initializeCalendarTimeValues(this.calendarValues,this.payload.campaign.start,this.payload.campaign.end),this.initializeBulletsMenu(),this.buildRangeCalendar(),this.$scope.$on("$destroy",()=>{void 0!==this.calendar&&this.calendar.dispose()})}isCampaignScheduled(){return"scheduled"===r.TopicMenuUtils.getFirstSelectedEntry(this.bulletsMenu).mapped_id}selectTimeFieldText(e){e.stopPropagation(),s(e.target).select()}setDefaultFromHours(){void 0!==this.calendarValues.from.hours&&0===this.calendarValues.from.hours.length&&(this.calendarValues.from.hours=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesFrom().hours,this.fromHoursChanged())}setDefaultFromMinutes(){void 0!==this.calendarValues.from.minutes&&0===this.calendarValues.from.minutes.length&&(this.calendarValues.from.minutes=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesFrom().minutes,this.fromMinutesChanged())}setDefaultToHours(){void 0!==this.calendarValues.to.hours&&0===this.calendarValues.to.hours.length&&(this.calendarValues.to.hours=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesTo().hours,this.toHoursChanged())}setDefaultToMinutes(){void 0!==this.calendarValues.to.minutes&&0===this.calendarValues.to.minutes.length&&(this.calendarValues.to.minutes=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesTo().minutes,this.toMinutesChanged())}fromHoursChanged(){void 0!==this.calendarValues.from.hours&&2===this.calendarValues.from.hours.length&&(this.calendarService.fromHoursChanged(this.calendarValues,this.calendar),this.changeRangeTimestamps())}toHoursChanged(){void 0!==this.calendarValues.to.hours&&2===this.calendarValues.to.hours.length&&(this.calendarService.toHoursChanged(this.calendarValues,this.calendar),this.changeRangeTimestamps())}fromMinutesChanged(){void 0!==this.calendarValues.from.minutes&&2===this.calendarValues.from.minutes.length&&(this.calendarService.fromMinutesChanged(this.calendarValues,this.calendar),this.changeRangeTimestamps())}toMinutesChanged(){void 0!==this.calendarValues.to.minutes&&2===this.calendarValues.to.minutes.length&&(this.calendarService.toMinutesChanged(this.calendarValues,this.calendar),this.changeRangeTimestamps())}changeRangeTimestamps(){const e=this.calendar.getSelectedAsText(),t=1===e.length?e[0]:e[1];this.payload.campaign.start=this.calendarService.changeTimePart(e[0],c.contextData.commonPropertiesContainer.timezone,this.calendarValues,"from"),this.payload.campaign.end=this.calendarService.changeTimePart(t,c.contextData.commonPropertiesContainer.timezone,this.calendarValues,"to")}buildRangeCalendar(){const e=this.$element.find('div[id="range-calendar"]');if(0!==this.payload.campaign.start&&0!==this.payload.campaign.end){const t=a(this.payload.campaign.start).format("YYYY-MM-DD"),i=a(this.payload.campaign.end);0===i.hour()&&0===i.minute()&&i.subtract(1,"days");const n=i.format("YYYY-MM-DD");this.calendar=new this.Calendar(e,{months:2,mode:"range",viewStartDate:t,selected:[t,n],useYearNav:!1,format:"YYYY-MM-DD"})}else this.calendar=new this.Calendar(e,{months:2,mode:"range",useYearNav:!1,format:"YYYY-MM-DD"});this.calendar.subscribe("change",()=>{this.$scope.$apply(()=>{this.changeRange()})})}changeRange(){const e=this.calendar.getSelectedAsText(),t=a(e[0]),i=a(e[e.length-1]);this.fromHoursChanged(),t.hour(Number(this.calendarValues.from.hours)).minute(Number(this.calendarValues.from.minutes)).second(0).millisecond(0),i.hour(Number(this.calendarValues.to.hours)).minute(Number(this.calendarValues.to.minutes)).second(0).millisecond(0),this.payload.campaign.start=t.toDate().getTime(),this.payload.campaign.end=i.toDate().getTime()}initializeBulletsMenu(){this.bulletsMenu={root_entry:{selection_type:"SINGLE",children_unselect_available:!1,children:[{mapped_id:"ongoing",name:c.contextData.getMessage("_1894124"),selected:"NODE"},{mapped_id:"scheduled",name:c.contextData.getMessage("_1894042")}]}}}handleBulletChange(e,t){this.isCampaignScheduled()||(this.payload.campaign.start=void 0,this.payload.campaign.end=void 0,this.calendarService.initializeCalendarTimeValues(this.calendarValues,this.payload.campaign.start,this.payload.campaign.end)),this.applyScope()}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}};d=__decorate([n.ngInject(["$scope","$element","$rootScope","calendarService","Calendar"]),__metadata("design:paramtypes",[Object,Object,Object,Object,Object])],d),t.CampaignScheduleFormFragmentController=d}),define("components/form_fragments/campaign/budget/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{payload:"=",form:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/form_fragments/campaign/budget"),scope:{}}};class n{}t.CampaignBudgetFormFragmentController=n}),define("services/influencer_mgmt/campaign_form_service",["require","exports","classes/context_data/context_data","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{buildCampaignModalModel(e,t){const n=this.buildCampaignInfoStep(e),s=this.buildCampaignScheduleStep(e),o=this.buildCampaignBudgetStep(e);return{disable:!1,lastStepButtonLabel:i.contextData.getMessage("_612374"),lastStepButtonProgressLabel:i.contextData.getMessage("_911337"),steps:[n,s,o],finishCondition:()=>!0,headerIcon:"fa fa-handshake-o",headerTitle:this.getHeaderTitle(t),headerDescription:i.contextData.getMessage("_1841035"),callback:async()=>{await this.saveCampaign(e,t)}}}buildCampaignInfoStep(e){return{label:i.contextData.getMessage("_1846351"),directiveName:"campaign-info-form-fragment",model:{campaign:e}}}buildCampaignScheduleStep(e){return{label:i.contextData.getMessage("_1857451"),directiveName:"campaign-schedule-form-fragment",model:{campaign:e}}}buildCampaignBudgetStep(e){return{label:i.contextData.getMessage("_1271898"),directiveName:"campaign-budget-form-fragment",model:{campaign:e}}}getHeaderTitle(e){return!0===e?i.contextData.getMessage("_1940654"):i.contextData.getMessage("_1874564")}async saveCampaign(e,t){const i=n.restFormService.getRFormUrl("campaign",t?"update":"create"),s=await n.restFormService.post(i,e);t||(e.campaign_id=s.campaign_id)}}t.CampaignFormService=s,t.campaignFormService=new s}),define("services/influencer_mgmt/influencer_state_service",["require","exports","services/rest_form_service"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n{moveModel(e,t){let i;const n=this.findStateModel(e.oldStateModel.column.type,t),s=this.findStateModel(e.state,t),o=this.findInfluencerIndex(e.influencer,n.column.influencers);return n.column.influencers.splice(o,1),void 0!==e.targetInfluencer?(i=this.findInfluencerIndex(e.targetInfluencer,s.column.influencers),s.column.influencers.splice(i,0,e.influencer)):(i=s.column.influencers.length,s.column.influencers.push(e.influencer)),i}async requestMove(e,t,n){await i.restFormService.post(e.moveLink,{influencer_id:e.influencer.id,campaign_id:t,new_influencer_order:n})}findStateModel(e,t){return t.find(t=>t.column.type===e)}findInfluencerIndex(e,t){return t.findIndex(t=>t.id===e.id)}}t.InfluencerStateService=n,t.influencerStateService=new n}),define("components/bubble_dialog/influencers/add_to_campaign/directive",["require","exports","angular","reusable_utilities","angular_utilities","services/rest_form_service","event_bus","jquery","services/tw_common","services/influencer_mgmt/influencer_state_service","services/loading_bubble","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g){function u(){return{templateUrl:g.templateSourceFactory("components/bubble_dialog/influencers/add_to_campaign"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:h,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:p}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=u,t.AddInfluencersToCampaignDirective=u;let p=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i}$onInit(){this.cancellationToken=new n.CancellationToken,this.initSubscriptions(),this.loadInfluencerLists(),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}isInfluencerListSelected(){return void 0!==this.influencerListsMenu&&void 0!==n.TopicMenuUtils.getFirstSelectedEntry(this.influencerListsMenu)}async handleInfluencerListSelection(e){const t=await o.restFormService.post(o.restFormService.getRFormUrl("campaign_influencers","show"),{influencer_list_topic_menu:this.influencerListsMenu,campaign_id:this.payload.campaignId,table_type:"add_influencers_to_campaign"});this.influencerTable=t.influencer_table,this.buildInfluencerStateModels(),this.applyScope()}close(){this.facade.destroy()}async loadInfluencerLists(){d.loadingBubbleService.showSpinner();const e=await o.restFormService.get(o.restFormService.getRFormUrl("influencer_lists","show"));this.influencerListsMenu=e.influencer_list_topic_menu,d.loadingBubbleService.hideSpinner()}buildInfluencerStateModels(){this.influencerStateModels=this.influencerTable.columns.map(e=>({column:JSON.parse(JSON.stringify(e))}))}async handleInfluencerMove(e){const t=e.value;l.influencerStateService.moveModel(t,this.influencerStateModels);try{const e=l.influencerStateService.requestMove(t,this.payload.campaignId);this.applyScope(),await e}catch(e){this.buildInfluencerStateModels(),this.applyScope()}}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}handleClick(e){this.protectFromClosing||c.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(c.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.ON_DRAG_STOP_INFLUENCER,this.handleInfluencerMove.bind(this)),this.cancellationToken.addDomEvent(a(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(a(document),"mousedown",e=>this.handleMouseDown(e))}};function h(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}p=__decorate([s.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],p)}),define("react_components/influencers_lists_mgmt/campaigns_table_container",["require","exports","influencers_list_mgmt","react","event_bus","reusable_utilities","classes/application/application","classes/refresh/model_type","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","log","services/rest_form_service","services/confirmation_service","classes/context_data/context_data","widget_base","math_utils","services/modal","services/influencer_mgmt/campaign_form_service","services/configuration","services/bubble_dialog","services/tw_number_formatter"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignsTableContainer=class extends m.AbstractFragmentLayer{constructor(e){super(e),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.ENTER_CAMPAIGN,this.handleEnterCampaign.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.EDIT_CAMPAIGN,this.handleEditCampaign.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.DELETE_CAMPAIGN,this.handleDeleteCampaign.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.OPEN_ADD_INFLUENCERS_TO_CAMPAIGN_DIALOG,this.handleOpenAddInfluencersToCampaignDialog.bind(this)),this.state=this.buildState(e.widget.getPayloadValue().data_graph)}draw(e){this.setState({drawSettings:e})}update(e){this.setState(this.buildState(e.widget.getPayloadValue().data_graph))}componentDidUpdate(){if(this.state.drawSettings){const e=$(this.refs.root);s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.id,expectedSize:this.state.drawSettings.dimensions.size,realSize:new _.Vector2D(e.outerWidth(),e.outerHeight())}})}}render(){return void 0!==this.state.drawSettings?n.createElement("div",{ref:"root"},n.createElement(i.CampaignsTableRenderable,{columns:this.state.columns,rows:this.state.rows,messages:this.state.messages})):null}buildColumns(e){const t=[];return e.column_groups.forEach(e=>t.push(...e.data_columns)),t.push({code:"actions"}),t}buildRows(e){return e.rows.map(t=>{const i=o.StringUtils.parseFilters(t.filter)[0].value,n={type:s.EVENT_TYPES.ENTER_CAMPAIGN,payload:i};return{cells:this.buildCells(t,e.column_groups),rowAction:n}})}buildCells(e,t){const i=this.createCampaignsTableCells(e,t);return this.addActionItems(i,e),i}createCampaignsTableCells(e,t){return e.cells.map((e,i)=>{const n={},s=t[i].data_columns[0];return"number"===s.data_type?n.value=b.twNumberFormatter.getInstance().toDecimal(e.value.numeric_data):"percentage"===s.data_type?n.value=b.twNumberFormatter.getInstance().toPercentage(e.value.numeric_data/100):void 0!==e.value.string_data?n.value=e.value.string_data:n.value=e.value.formatted_value,i>0&&(n.defaultStyleFlags={boldText:!0}),n})}addActionItems(e,t){e.push({actionItems:[{icon:"icon-tw-trash-bin",action:s.EVENT_TYPES.DELETE_CAMPAIGN,actionPayload:t.meta_data.attributes.remove_link,tooltipMessage:h.contextData.getMessage("_1543548")},{icon:"fa fa-user-plus",action:s.EVENT_TYPES.OPEN_ADD_INFLUENCERS_TO_CAMPAIGN_DIALOG,actionPayload:t.meta_data.attributes.edit_link,tooltipMessage:h.contextData.getMessage("_1236542")},{icon:"fa fa-pencil",action:s.EVENT_TYPES.EDIT_CAMPAIGN,actionPayload:t.meta_data.attributes.edit_link,tooltipMessage:h.contextData.getMessage("_1354423")}]})}handleEnterCampaign(e){r.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType("INFLUENCER_CAMPAIGN").unselectAllAndSelectByMappedId(e.value),this.refreshPageData()}async handleEditCampaign(e){const t=await u.restFormService.get(e.value);this.createCampaignEditionDialog(t)}handleDeleteCampaign(e){p.confirmationService.display({message:h.contextData.getMessage("_1694504")}).then(async()=>{await this.deleteCampaign(e.value),this.props.widget.prepareReload(),this.refreshWidgetData()})}async handleOpenAddInfluencersToCampaignDialog(e){if(void 0===this.influencersDialog){const t=await u.restFormService.get(e.value);this.createAddInfluencersToCampaignDialog(t)}}async deleteCampaign(e){await u.restFormService.deleter(e)}async createCampaignEditionDialog(e){await f.modalService.display("MULTIPAGE_MODAL",y.campaignFormService.buildCampaignModalModel(e,!0)),this.props.widget.prepareReload(),this.refreshWidgetData()}createAddInfluencersToCampaignDialog(e){const t=constants.bubble_dialog.id.add_influencers_to_campaign,i=v.configurationService.getBubbleDialogConfiguration().getStyle(t),n={campaignId:e.campaign_id};this.influencersDialog=S.bubbleDialogService.createByType(t,$("body"),t,n,i),this.influencersDialog.onDestroy.subscribeOnce(()=>{this.influencersDialog=void 0,this.props.widget.prepareReload(),this.refreshWidgetData()})}async refreshWidgetData(){const e={strategy:l.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(this.props.pageState,this.props.pageState.getApplication(),a.ModelType.WIDGET,e);try{await c.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&g.logService.error("Error when refreshing widget!",void 0,e)}}async refreshPageData(){const e={strategy:l.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(this.props.pageState,this.props.pageState.getApplication(),a.ModelType.PAGE_STATE,e);try{await c.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&g.logService.error("Error when refreshing page!",void 0,e)}}buildState(e){const t={noCampaigns:h.contextData.getMessage("_1810649")};return{columns:this.buildColumns(e),rows:this.buildRows(e),messages:t}}}}),define("classes/widget/fragments/directive/campaigns_table_fragment",["require","exports","widget_base","react-dom","react_components/influencers_lists_mgmt/campaigns_table_container","classes/application/application","react"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignsTableFragment=class extends i.AbstractReactFragment{constructor(e){super(e)}renderIntoContainer(e,t){n.render(r.createElement(s.CampaignsTableContainer,{id:this.fragmentModel.widget.getId(),widget:this.fragmentModel.widget,pageState:o.mainApplication.getPageState(),onUpdate:e,onDraw:t}),this.chartContainer)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/campaigns_table_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/campaigns_table_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[o.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[r.CampaignsTableFragment],[i.WidgetLayoutBlockId.FOOTER]:[n.BottomWidgetMenusFragment]},noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("react_components/compared_topics_widget/compared_topics_widget_container",["require","exports","widget_base","colored_items_blocks","react"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.ComparedTopicsWidgetContainer=class extends i.AbstractFragmentLayer{constructor(e){super(e),this.state=this.buildState(e.widget)}update(e){this.setState(this.buildState(e.widget))}draw(e){this.setState({drawSettings:e})}render(){return s.createElement(n.ColoredItemsBlocksRenderable,{items:this.state.items})}buildState(e){return{items:this.buildItemsBlocks(e)}}buildItemsBlocks(e){return[...e.getPayloadValue().compare_entries.map(e=>({label:e.name,color:e.color}))]}}}),define("classes/widget/fragments/directive/compared_topics_fragment",["require","exports","react-dom","react","widget_base","react_components/compared_topics_widget/compared_topics_widget_container"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.ComparedTopicsFragment=class extends s.AbstractReactFragment{constructor(e){super(e)}renderIntoContainer(e,t){i.render(n.createElement(o.ComparedTopicsWidgetContainer,{widget:this.fragmentModel.widget,onUpdate:e,onDraw:t}),this.chartContainer)}getLayoutIterator(){return new s.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:0,minWidth:0}],e=>this.getDimensionsForLayout(e))}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/compared_topics_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/compared_topics_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[o.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[r.ComparedTopicsFragment],[i.WidgetLayoutBlockId.FOOTER]:[n.BottomWidgetMenusFragment]},noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/composed_graph_blueprint",["require","exports","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/sidenote_fragment","classes/widget/fragment_controllers/line_chart_widget_blueprint_enhancer","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/composed_graph_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[n.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,l.TopWidgetMenusFragment,r.ResultCountFragment],[n.WidgetLayoutBlockId.BODY]:[g.ComposedGraphFragment,i.LegendFragment,a.SidenoteFragment],[n.WidgetLayoutBlockId.FOOTER]:[d.BottomWidgetMenusFragment]},enhancer:c.LineChartWidgetBlueprintEnhancer,buildConfigurations:o.defaultBuildConfigurations.extend([{key:i.LegendFragment,value:{colorPaletteBuilder:i.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!0,iconType:()=>(e,t)=>{if(void 0!==t.dataGraph&&void 0!==t.dataGraph.type_graph)switch(t.dataGraph.type_graph){case"BAR_CHART":case"COLUMN_CHART":return i.LegendItemIconType.SQUARE;case"AREA":case"LINE_CHART":return i.LegendItemIconType.LINE;default:return i.LegendItemIconType.CIRCLE}return i.LegendItemIconType.CIRCLE}}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/counter_blueprint",["require","exports","counter","services/tw_number_formatter","classes/widget/fragment_controllers/counter_widget_blueprint_enhancer","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[g.WidgetLayoutBlockId.HEADER]:[a.WidgetHeaderFragment,r.TopWidgetMenusFragment,c.ReplayDateFragment],[g.WidgetLayoutBlockId.BODY]:[i.CounterFragment],[g.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment,l.ReplayFragment]},buildConfigurations:d.defaultBuildConfigurations.extend([{key:i.CounterFragment,value:{numberFormatter:n.twNumberFormatter.getCounterNumberFormatter()}}]),enhancer:s.CounterWidgetBlueprintEnhancer,layoutStrategySettings:{minimumChartSize:0}}}}),define("services/widgets/widget_api",["require","exports","services/rest_form_service","services/router"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.lastJobCreationTs=0,n.routerService.router.onRoutingFinish.subscribe(()=>{this.resetDeferredWidgetRefreshJob()})}resetDeferredWidgetRefreshJob(){this.lastJobCreationTs=0}createDeferredWidgetRefreshJob(e){e.setConfigurationChanged(!0);const t=e.getPageState().clone();return t.clearWidgetsByPredicate(t=>t.getId()!==e.getId()),t.getAllowedPages().setReload(!0),t.getWidgets()[0].setReloading(!0),t.prune(!0),this.lastJobCreationTs=Date.now(),i.restFormService.postRForm("page_state_async","refresh",{page_state:t.toProto(),context_type:e.getDicWrapper().hasWidgetContext()?e.getDicWrapper().getWidgetContext().contextType:"USER"})}async isDeferredRefreshJobAlreadyRunning(e){const t=await this.getDeferredWidgetRefreshJobStatus(e);return"FINISHED"!==t.status&&!!t.status&&"FAILED"!==t.status}getDeferredWidgetRefreshJobStatus(e){return i.restFormService.postRForm("page_state_async","info",{widget_id:e.getId(),submit_timestamp:this.lastJobCreationTs,context_type:e.getDicWrapper().hasWidgetContext()?e.getDicWrapper().getWidgetContext().contextType:"USER"})}}t.WidgetApiService=s,t.widgetApiService=new s}),define("classes/widget/widget_fragment_factory/widget_blueprints/document_cluster_blueprint",["require","exports","document_cluster","log","other/tw","services/configuration","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/no_data_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/context_data/context_data","services/widgets/widget_api","services/confirmation_service","services/rest_form_service","reusable_utilities","classes/application/single_page_bubble_application","classes/application/application","wrappers/page_state/page_state_wrapper","classes/widget/fragments/directive/article_widget_fragment","services/navigation","classes/widget/fragment_controllers/default_widget_blueprint_enhancer","math_utils","classes/navigation/nav_params","services/application_mode","services/router"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I){Object.defineProperty(t,"__esModule",{value:!0});class x extends M.DefaultWidgetBlueprintEnhancer{canShowFragment(e,t){const n=w.mainApplication.getPageState()&&w.mainApplication.getPageState().getAllowedPages()&&w.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp();return!(n||e!==g.NoDataFragment||t.widget.hasPayloadValue()&&!t.widget.isEmptyWidget())||!!(n||e!==i.DocumentClusterFragment||t.widget.hasPayloadValue()&&!t.widget.isEmptyWidget())&&(!!(e!==i.DocumentClusterFragment&&e!==g.NoDataFragment||t.widget.hasPayloadValue()&&!t.widget.isEmptyWidget())&&super.canShowFragment(e,t))}}t.default=function(){return{layout:{[m.WidgetLayoutBlockId.HEADER]:[p.WidgetHeaderFragment,u.TopWidgetMenusFragment],[m.WidgetLayoutBlockId.BODY]:[g.NoDataFragment,i.DocumentClusterFragment,i.DocumentClusterSidebarFragment],[m.WidgetLayoutBlockId.FOOTER]:[d.BottomWidgetMenusFragment]},get showEvenIfNoData(){return!window.isExport&&w.mainApplication.getPageState()&&w.mainApplication.getPageState().getAllowedPages()&&w.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp()},buildConfigurations:h.defaultBuildConfigurations.extend([{key:i.DocumentClusterFragment,value:O},{key:i.DocumentClusterSidebarFragment,value:k}]),enhancer:x}};const R=e=>e.getPrimarySource().data_type_configuration_uuid;I.routerService.router.onRoutingFinish.subscribe(()=>{k.triedGeneration=!1});const F=async(e,t=!1)=>{const i=e.getExtendedConfiguration().getClusterLabelsShown();localStorage.setItem("cluster_config",JSON.stringify({canShowLabels:void 0===i||i,colorScheme:e.getExtendedConfiguration().getColorScheme()})),t&&e.getExtendedConfiguration().setWidgetCameraState(new P.Vector2D(0,0),1),e.setReloading(!0),e.setConfigurationChanged(!0);const s=e.getBlueprint();k.triedGeneration=!0,void 0===s.__alwaysDisposeOnPayloadChange&&Object.defineProperty(s,"alwaysDisposeOnPayloadChange",{get:()=>!(s.__hadPayload||e.hasPayload()&&e.hasPayloadValue()&&e.getPayloadValue().graph)||s.__alwaysDisposeOnPayloadChange,set:e=>{s.__alwaysDisposeOnPayloadChange=e}}),s.__hadPayload=e.hasPayloadValue(),s.__alwaysDisposeOnPayloadChange=t;const o={strategy:c.ModelRefreshStrategy.REFRESH,force:!0},d=a.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),l.ModelType.WIDGET,o);try{await r.modelRefreshService.refresh(d,o),s.__alwaysDisposeOnPayloadChange=!1}catch(e){e instanceof Error&&n.logService.error("Error when reloading Document cluster",void 0,e)}},O={messages:{},canDrilldown:!window.isExport,showInfluencerMenu:!window.isExport,get isInfluencerManagementModule(){return s.tw.pageState.getAllowedPages().isInfluencerManagementModule()},getLayout:R,configurationService:o.configurationService,get isInteractive(){return!(window.isExport&&"SHARED_DASHBOARD"!==s.tw.pageState.getAllowedPages().getPageType()||s.tw.pageState.getAllowedPages().isReport())}},k={subFragments:{noData:{fragment:g.NoDataFragment},articles:{fragment:E.ArticleWidgetFragment}},messages:{noData:{idle:_.contextData.getMessage("_984484"),loading:_.contextData.getMessage("_2231263"),noResults:_.contextData.getMessage("_2135361"),noResultsTitle:_.contextData.getMessage("_2135362")},refresh:{generation:_.contextData.getMessage("_984490"),init:_.contextData.getMessage("_015949"),idle:_.contextData.getMessage("_015948"),busy:_.contextData.getMessage("_2231263"),failed:_.contextData.getMessage("_984491"),period:_.contextData.getMessage("_984511")},warning:{legacyData:_.contextData.getMessage("_984495"),noSourcePanels:_.contextData.getMessage("_984497"),noHashtags:_.contextData.getMessage("_984498"),noTopicsOrChannels:_.contextData.getMessage("_984503")},reach:_.contextData.getMessage("_131873"),engagement:_.contextData.getMessage("_587686"),metrics:_.contextData.getMessage("_892215"),topKeywords:_.contextData.getMessage("_1978461"),smartThemes:_.contextData.getMessage("_370307"),editColor:_.contextData.getMessage("_2231250"),editName:_.contextData.getMessage("_2231251"),articles:_.contextData.getMessage("_2231252"),stories:_.contextData.getMessage("_2231253"),conversations:_.contextData.getMessage("_2231254"),mergeWith:_.contextData.getMessage("_2231255"),selectAnotherCluster:_.contextData.getMessage("_2231256"),mainStories:_.contextData.getMessage("_2231257"),mainSources:_.contextData.getMessage("_2231258"),story:_.contextData.getMessage("_2231259"),mainArticles:_.contextData.getMessage("_2231260"),seeAll:_.contextData.getMessage("_2231261")},showRefreshButton:!window.isExport,triedGeneration:!1,get isInteractive(){return!(window.isExport&&"SHARED_DASHBOARD"!==s.tw.pageState.getAllowedPages().getPageType()||s.tw.pageState.getAllowedPages().isReport())},getLayout:R,reloadGraph:e=>F(e,!0),async changeCustomization(e,t){try{await v.restFormService.postRForm("document_cluster","update",{customization:t,widget_id:e.getId()}),await F(e)}catch(e){console.log(e)}},isEmbedded:()=>A.applicationMode.getCurrentAppMode()===A.AppMode.EMBEDDED,applyScope:()=>{s.tw.inject("$rootScope").$apply()},openAllArticles(e,t){o.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.widget).setAbsoluteY(window.pageYOffset+50);const i=new D.NavigationParams,n=t.clone();n.getExtendedConfiguration().setEntryUrls(e),n.setConfigurationChanged(!0),i.setWidgetToSend(n),i.setWidget(n),i.setFilters([[]]),T.navigationService.clickHandler(i,null,"CONTEXT_MENU_CONVERSATION_CLUSTER_STORIES")},async loadArticles(e,t,i,n=!1){const o=await v.restFormService.postRForm("article_fetching","search",{entry_ids:t,is_story_scope:n,latest_task_id:e.getPayloadValue().latest_task_id,widget_id:t.join(""),cluster_widget_id:e.getId()});o.articles.section_id=1,o.articles.widget_id=t.join("");const r=new b.SinglePageBubbleApplication(w.mainApplication);r.injectPageState(new C.PageStateWrapper(Object.assign({},s.tw.pageState.toProto(),{data_input_configuration:[o.articles]}),r));const a=new S.CancellationToken;return a.registerDisposable(r),{widget:r.getPageState().getWidgets()[0],cancellationToken:a,id:i}},getStatus:e=>f.widgetApiService.getDeferredWidgetRefreshJobStatus(e),async canRefreshCheck(e){if(await f.widgetApiService.isDeferredRefreshJobAlreadyRunning(e))try{await y.confirmationService.display({message:_.contextData.getMessage("_718026")})}catch(e){return!1}return!0},async onRefreshClick(e){const t=(await f.widgetApiService.createDeferredWidgetRefreshJob(e)).page_state.data_input_configuration[0].payload.missing_data_reason;if(t&&"SEARCH_NOT_AVAILABLE"===t)return f.widgetApiService.resetDeferredWidgetRefreshJob(),Promise.reject(t)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/external_trend_table_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/context_data/context_data","external_trend_table","classes/widget/fragments/directive/widget_header_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.EXTERNAL_TREND_TABLE_BUILD_CONFIGURATION={colorPaletteBuilder:a.ExternalTrendTableColorPaletteBuilder,messages:{countryTrends:e=>r.contextData.getMessage("_442001",[e]),searchCounter:e=>r.contextData.getMessage("_442002",[e]),lastUpdated:e=>r.contextData.getMessage("_442003",[e]),relatedSearches:()=>r.contextData.getMessage("_442004"),top:e=>r.contextData.getMessage("_442005",[e]),twitterTrends:()=>r.contextData.getMessage("_442006")}},t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[c.WidgetHeaderFragment,n.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[a.ExternalTrendTableFragment],[i.WidgetLayoutBlockId.FOOTER]:[s.BottomWidgetMenusFragment]},buildConfigurations:o.defaultBuildConfigurations.extend([{key:a.ExternalTrendTableFragment,value:t.EXTERNAL_TREND_TABLE_BUILD_CONFIGURATION}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/external_trend_theme_cloud_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/color_palette_builder/cloud_color_palette_builder","classes/widget/fragments/canvas_chart/trend_cloud_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[c.TrendCloudFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},buildConfigurations:r.defaultBuildConfigurations.extend([{key:c.TrendCloudFragment,value:{colorPaletteBuilder:a.CloudColorPaletteBuilder}}]),noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/gender_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/gender_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[c.WidgetHeaderFragment,l.TopWidgetMenusFragment,o.ReplayDateFragment],[s.WidgetLayoutBlockId.BODY]:[r.GenderChartFragment,n.LegendFragment],[s.WidgetLayoutBlockId.FOOTER]:[a.ReplayFragment,d.BottomWidgetMenusFragment]},buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{colorPaletteBuilder:n.LegendColorPaletteBuilder,axis:n.LegendDataAxisType.BY_COLUMN}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/horizontal_bar_chart_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/bar_chart_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[a.WidgetHeaderFragment,l.TopWidgetMenusFragment,o.ReplayDateFragment,c.ResultCountFragment],[s.WidgetLayoutBlockId.BODY]:[g.BarChartFragment,n.LegendFragment],[s.WidgetLayoutBlockId.FOOTER]:[d.BottomWidgetMenusFragment,r.ReplayFragment]},layoutStrategySettings:{minimumChartSize:0},buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{colorPaletteBuilder:n.LegendColorPaletteBuilder,iconType:n.LegendItemIconType.SQUARE,enableItemHover:!0,enableItemSelection:!0,type:n.LegendTypes.LINE}}])}}}),define("services/video_service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.hosts=this.configureHosts()}getHosts(){return this.hosts}configureHosts(){return{dailymotion:{patterns:[/^(?:http:\/\/)?(?:www\.)?dailymotion\.com\/(?:video|hub)\/([a-zA-Z0-9]+)_?.*$/,/^(?:http:\/\/)?(?:www\.)?dai\.ly\/([a-zA-Z0-9]+)_?.*$/],template:"//www.dailymotion.com/embed/video/<%- id %>",className:"video-dailymotion",html5video:!1,transformUrl:!0},youtube:{patterns:[/^(?:(?:http[s]?:\/\/)?(?:www\.)?)youtube\.com\/watch\?v=([^\/"'>]+)$/,/^(?:(?:http[s]?:\/\/)?(?:www\.)?)youtu\.be\/([^\/"'>]+)$/,/^(?:(?:http[s]?:\/\/)?(?:www\.)?)youtube\.com\/v\/([^\/"'>]+)$/],template:"//www.youtube.com/embed/<%- id %>",className:"video-youtube",html5video:!1,transformUrl:!0},vimeo:{patterns:[/^(?:http[s]?:\/\/)?(?:www\.)?vimeo\.com\/(?:channels\/staffpicks\/)?(\d+)$/],template:"//player.vimeo.com/video/<%- id %>?badge=0",className:"video-vimeo",html5video:!1,transformUrl:!0},unicepta:{patterns:[/^(?:http[s]?:\/\/)?(?:www\.)?download\.unicepta-presse\.de\/AV\/([^\/"'>]+)\.mp4/],className:"video-unicepta",html5video:!0,transformUrl:!0},googleDrive:{patterns:[/^(?:http[s]?:\/\/)?(?:www\.)?drive\.google\.com\/file.d.(\w+)/],className:"video-google-drive",html5video:!1,transformUrl:!1}}}}t.VideoService=i,t.videoService=new i}),define("services/resources/resource",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.freeToolCtaPng="Free-tool-CTA.png",e.talkwalkerSearchSignupbackgroundJpg="Talkwalker_Search_SignupBackground.jpg",e.talkwalkerTrialSignupbackgroundJpg="Talkwalker_Trial_SignupBackground.jpg",e.ajaxLoadSnakeGreyGif="ajax-load-snake-grey.gif",e.articlesAvatarPng="articles/avatar.png",e.articlesDefaultThumbnailPng="articles/default_thumbnail.png",e.articlesNewspaperPng="articles/newspaper.png",e.bannerTalkwalkerPng="banner_talkwalker.png",e.changelegendPng="changeLegend.png",e.checkboardJpg="checkboard.jpg",e.cutoffPng="cutoff.png",e.deadlinkPng="deadlink.png",e.defaultAvatarPng="default-avatar.png",e.defaultavatar24Png="defaultavatar24.png",e.dotPng="dot.png",e.dummyUseCasesTwScreenshotPng="dummy_use_cases_tw-screenshot.png",e.exportGrayAlexaIconGrayPng="export/gray/alexa_icon_gray.png",e.exportGrayCommentCountIconGrayPng="export/gray/comment_count_icon_gray.png",e.exportGrayEngagementIconGrayPng="export/gray/engagement_icon_gray.png",e.exportGrayFacebookIconGrayPng="export/gray/facebook_icon_gray.png",e.exportGrayFoundIconGrayPng="export/gray/found_icon_gray.png",e.exportGrayInstagramIconGrayPng="export/gray/instagram_icon_gray.png",e.exportGrayPinterestIconGrayPng="export/gray/pinterest_icon_gray.png",e.exportGrayPotentialReachIconGrayPng="export/gray/potential_reach_icon_gray.png",e.exportGrayPublishedIconGrayPng="export/gray/published_icon_gray.png",e.exportGrayTrendingScoreIconGrayPng="export/gray/trending_score_icon_gray.png",e.exportGrayTwitterIconGrayPng="export/gray/twitter_icon_gray.png",e.exportGrayYoutubeIconGrayPng="export/gray/youtube_icon_gray.png",e.exportIconEngagementPng="export/icon_engagement.png",e.exportIconEngagementWhitePng="export/icon_engagement_white.png",e.exportIconReachPng="export/icon_reach.png",e.exportIconReachWhitePng="export/icon_reach_white.png",e.exportIconTrendingScorePng="export/icon_trending_score.png",e.exportWhiteAlexaIconWhitePng="export/white/alexa_icon_white.png",e.exportWhiteCommentCountIconWhitePng="export/white/comment_count_icon_white.png",e.exportWhiteEngagementIconWhitePng="export/white/engagement_icon_white.png",e.exportWhiteFacebookIconWhitePng="export/white/facebook_icon_white.png",e.exportWhiteFoundIconWhitePng="export/white/found_icon_white.png",e.exportWhiteInstagramIconWhitePng="export/white/instagram_icon_white.png",e.exportWhitePinterestIconWhitePng="export/white/pinterest_icon_white.png",e.exportWhitePotentialReachIconWhitePng="export/white/potential_reach_icon_white.png",e.exportWhitePublishedIconWhitePng="export/white/published_icon_white.png",e.exportWhiteTrendingScoreIconWhitePng="export/white/trending_score_icon_white.png",e.exportWhiteTwitterIocnWhitePng="export/white/twitter_iocn_white.png",e.exportWhiteYoutubeIconWhitePng="export/white/youtube_icon_white.png",e.externalSourcePng="external_source.png",e.faviconIco="favicon.ico",e.faviconPng="favicon.png",e.flagsImportantPng="flags/important.png",e.flagsNegativePng="flags/negative.png",e.flagsNeutralPng="flags/neutral.png",e.flagsNonePng="flags/none.png",e.flagsPositivePng="flags/positive.png",e.flagsSpritePng="flags/sprite.png",e.fullBannerPng="full_banner.png",e.googleTrendsColorPng="google_trends_color.png",e.googleTrendsLightPng="google_trends_light.png",e.headerLogoYetiPng="header_logo_yeti.png",e.heartPng="heart.png",e.iconsYetiTestAppIconBigPng="icons/yeti_test_app_icon-big.png",e.imagespritePng="imagesprite.png",e.imagespritespacedPng="imagespritespaced.png",e.lexisNexisLogoGif="lexis_nexis_logo.gif",e.lexisnexisGif="lexisnexis.gif",e.loadGif="load.gif",e.logoTrendictionPng="logo_trendiction.png",e.moreUseCasesPng="more_use_cases.png",e.notavailablePng="notavailable.png",e.phantomjsErrorPng="phantomjs_error.png",e.sentimentlegendPng="sentimentLegend.png",e.smalllogoPng="smalllogo.png",e.sourcesBlogPng="sources/blog.png",e.sourcesFacebIconPng="sources/faceb-icon.png",e.sourcesForumPng="sources/forum.png",e.sourcesGoogleplusPng="sources/googleplus.png",e.sourcesInstagramPng="sources/instagram.png",e.sourcesLinkedinPng="sources/linkedin.png",e.sourcesNewsPng="sources/news.png",e.sourcesPinterestPng="sources/pinterest.png",e.sourcesReviewsAlatestPng="sources/reviews/alatest.png",e.sourcesReviewsAmazonJpg="sources/reviews/amazon.jpg",e.sourcesReviewsAoJpg="sources/reviews/ao.jpg",e.sourcesReviewsCiaoPng="sources/reviews/ciao.png",e.sourcesReviewsDooyooPng="sources/reviews/dooyoo.png",e.sourcesReviewsEbayJpeg="sources/reviews/ebay.jpeg",e.sourcesReviewsGooglePlayPng="sources/reviews/google-play.png",e.sourcesReviewsItunesPng="sources/reviews/itunes.png",e.sourcesReviewsKununuPng="sources/reviews/kununu.png",e.sourcesReviewsOttoPng="sources/reviews/otto.png",e.sourcesReviewsPagesJaunesJpg="sources/reviews/pages_jaunes.jpg",e.sourcesReviewsRedcoonPng="sources/reviews/redcoon.png",e.sourcesReviewsTripAdvisorPng="sources/reviews/trip_advisor.png",e.sourcesTumblrPng="sources/tumblr.png",e.sourcesTwiIconPng="sources/twi-icon.png",e.sourcesVinePng="sources/vine.png",e.sourcesYoutubePng="sources/youtube.png",e.starsSpritePng="stars/sprite.png",e.starsStar0Png="stars/star0.png",e.starsStar1Png="stars/star1.png",e.starsStar2Png="stars/star2.png",e.starsStar3Png="stars/star3.png",e.starsStarsPng="stars/stars.png",e.tagCloudImagespriteTagcloudPng="tag_cloud/imagesprite_tagcloud.png",e.talkwalkerPng="talkwalker.png",e.talkwalkerSignupPng="talkwalker_signup.png",e.treemapTestImagesAbstractHC_200_400_4Jpg="treemap_test_images/abstract-h-c-200-400-4.jpg",e.treemapTestImagesFoodQC_400_200_1Jpg="treemap_test_images/food-q-c-400-200-1.jpg",e.treemapTestImagesNatureHC_480_640_3Jpg="treemap_test_images/nature-h-c-480-640-3.jpg",e.treemapTestImagesNightlifeQC_1080_800_7Jpg="treemap_test_images/nightlife-q-c-1080-800-7.jpg",e.treemapTestImagesNightlifeQC_640_480_6Jpg="treemap_test_images/nightlife-q-c-640-480-6.jpg",e.treemapTestImagesPeopleQC_600_200_1Jpg="treemap_test_images/people-q-c-600-200-1.jpg",e.treemapTestImagesPeopleQC_640_480_10Jpg="treemap_test_images/people-q-c-640-480-10.jpg",e.treemapTestImagesPeopleQC_640_480_9Jpg="treemap_test_images/people-q-c-640-480-9.jpg",e.treemapTestImagesTechnicsHC_200_600_7Jpg="treemap_test_images/technics-h-c-200-600-7.jpg",e.tryOurAwardWiningPlatformNowBadgePng="try_our_award_wining_platform_now_badge.png",e.twitterCertfiedPartner_140x140BluePng="twitter_certfied_partner_140x140_blue.png",e.twitterCertfiedPartnerLargeBluePng="twitter_certfied_partner_large_blue.png",e.upgradeIconPng="upgrade_icon.png",e.yetiFeetRgbPng="yeti_feet_RGB.png",e.cta_background="background_cta.png"}(t.ImageResource||(t.ImageResource={}))}),define("services/resources/resources",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.baseUrl="/app/assets"}getImageUrl(e){return this.baseUrl+"/images/"+e}}t.ResourcesService=i,t.resourcesService=new i}),define("services/text",["require","exports","flux","log","services/rest_form_service","underscore","services/confirmation_service","services/widgets/widget_factory","classes/context_data/context_data","report_components","services/icons","event_bus","services/presentation_service","services/video_service","constants/page_size_constants","services/context","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f){Object.defineProperty(t,"__esModule",{value:!0});const y=1.2;class v{constructor(){this.isContextBody=this.isTypeClosure(constants.report.element_context.body),this.isContextFooter=this.isTypeClosure(constants.report.element_context.footer),this.isContextHeader=this.isTypeClosure(constants.report.element_context.header),this.isHeadline=this.isTypeClosure(dataTypeConf.TEXT_HEADLINE.data_type),this.isHeadlineParagraph=this.isTypeClosure(dataTypeConf.TEXT_HEADLINE_PARAGRAPH.data_type),this.isImage=this.isTypeClosure(dataTypeConf.TEXT_IMAGE.data_type),this.isVideo=this.isTypeClosure(dataTypeConf.TEXT_VIDEO.data_type),this.isParagraph=this.isTypeClosure(dataTypeConf.TEXT_PARAGRAPH.data_type),this.isTextLeft=this.isTypeClosure(dataTypeConf.TEXT_TEXT_LEFT.data_type),this.isTextRight=this.isTypeClosure(dataTypeConf.TEXT_TEXT_RIGHT.data_type)}isTypeClosure(e){return t=>t===e}addTextWidget(e,t,i){if(t.getPageState().isLayoutBeingEdited())return;t.getPageState().beginEditingPageLayout();let n=constants.topic_menu.TYPE.report,o=constants.custom_page.type.report;t.getPageState().getAllowedPages().isDashboard()&&(o=constants.custom_page.type.dashboard,n=constants.topic_menu.TYPE.dashboard);const r=t.getPageState().getUserFilterSettings().getTopicMenuByType(n).getFirstSelectedEntryRecursively().getMappedId();let a;void 0!==t&&(a={id:t.getLastWidget().getId(),custom_page_id:r,custom_page_type:o,page_state:{allowed_pages:t.getPageState().getAllowedPages().toProto(),user_filter_settings:t.getPageState().getUserFilterSettings().toProto()},widget_type:e,section_id:1,report_element_context:i},s.restFormService.post(routes.controllers.tw.TWRestForm.post(m.contextService.getCurrentContext().scope,m.contextService.getCurrentContext().id,"text_widget","new",r,"rform").url,a).then(e=>this.handleNewWidgetResponse(e,t.getPageState())))}removeTextWidget(e,t,i){i.isLayoutBeingEdited()||r.confirmationService.display({message:c.contextData.getMessage("_705442")}).then(()=>{const n={id:e.widget_id,custom_page_id:i.getAllowedPages().getCustomPageId(),custom_page_type:t};i.beginEditingPageLayout(),s.restFormService.post(routes.controllers.tw.TWRestForm.post(m.contextService.getCurrentContext().scope,m.contextService.getCurrentContext().id,"text_widget","remove",0,"rform").url,n).then(e=>this.handleRemoveWidgetResponse(e,i))},()=>void 0)}changeConfig(e,t){e.primary_source.data_type_configuration_uuid=t.data_type,e.configuration_rendering=dataTypeConf[t.data_type].configuration,e.configuration_rendering.uuid_configuration=dataTypeConf[t.data_type].configuration_type}buildTextboxModel(e){const t=this.findPageForWidget(e),i=this.buildTextBoxStyles(e,t),n=this.buildTextBoxDefaultStyles(),s=e.isHeadline()?e.getPayloadValue().headline:e.getPayloadValue().text,o=e.isHeadline()?e.getPayloadValue().display_headline:e.getPayloadValue().display_text,r=this.getPlaceholderText(e),a=this.buildTextBoxToolbarBlocks(e,i);return{id:e.getId(),text:s,displayText:o,placeholderText:r,optionalToolbarBlocks:a,styles:i,defaultStyles:n}}buildTextBoxSettings(e){return{editable:!u.presentationService.isPresentationEnabled,fillBoxOnly:!0,disableAlignToolbarItems:!0,connectedSelectorWhiteList:[".toolbar"]}}buildTextBoxToolbarBlocks(e,t){const i=[];return i.push(this.buildTextAlignmentBlock(e,t)),i.push(this.buildFontBlock(e,t)),i}buildTextAlignmentBlock(e,t){return{id:o.uniqueId("toolbar-block-"),type:l.OptionalToolbarBlockType.TEXT_ALIGNMENT,ownerType:l.ToolbarOwnerType.TEXT_BOX,show:!1,items:this.buildTextAlignmentOptions(e,t)}}buildTextAlignmentOptions(e,t){const i=[];return this.findPageForWidget(e).slide_metadata.text_alignment_menu.root_entry.children.forEach(n=>{i.push(this.buildTextAlignmentOption(n.mapped_id,e,t))}),i}buildTextAlignmentOption(e,t,i){return{id:o.uniqueId("toolbar-item-"),icon:d.iconService.getIconForTextAlignment(e),selected:i.textAlign===e,type:l.ToolbarItemType.BUTTON,eventType:g.EVENT_TYPES.TEXT_ALIGN,actionPayload:{sourceId:t.getId(),data:e}}}buildFontBlock(e,t){return{id:o.uniqueId("toolbar-block-"),type:l.OptionalToolbarBlockType.FONT,ownerType:l.ToolbarOwnerType.TEXT_BOX,show:!1,items:this.buildFontOptions(e,t)}}buildFontOptions(e,t){const i=[],n=this.findPageForWidget(e);return i.push(this.buildFontWeightOption(e,t)),i.push(this.buildFontStyleOption(e,t)),i.push(this.buildFontFamilyOption(n,e,t)),i.push(this.buildFontSizeOption(n,e,t)),i.push(this.buildColorOption(n,e,t)),i}buildFontWeightOption(e,t){return{id:o.uniqueId("toolbar-item-"),icon:"fa fa-bold",selected:"bold"===t.fontWeight,unselectable:!0,type:l.ToolbarItemType.BUTTON,eventType:g.EVENT_TYPES.FONT_WEIGHT_CHANGED,actionPayload:{sourceId:e.getId(),data:"bold"}}}buildFontStyleOption(e,t){return{id:o.uniqueId("toolbar-item-"),icon:"fa fa-italic",selected:"italic"===t.fontStyle,unselectable:!0,type:l.ToolbarItemType.BUTTON,eventType:g.EVENT_TYPES.FONT_STYLE_CHANGED,actionPayload:{sourceId:e.getId(),data:"italic"}}}buildFontFamilyOption(e,t,i){const n={id:o.uniqueId("toolbar-item-"),icon:"fa fa-caret-down",title:i.fontFamily,selected:!1,type:l.ToolbarItemType.DROPDOWN_BUTTON,eventType:g.EVENT_TYPES.FONT_FAMILY_CHANGED,actionPayload:{sourceId:t.getId()},subItems:[]};return e.slide_metadata.font_family_menu.root_entry.children.forEach(e=>{const t=JSON.parse(JSON.stringify(e));n.subItems.push(t)}),n}buildFontSizeOption(e,t,i){const n=i.fontSizeModel,s={id:o.uniqueId("toolbar-item-"),icon:"fa fa-caret-down",title:n.substring(0,n.indexOf("pt")),selected:!1,type:l.ToolbarItemType.DROPDOWN_BUTTON_NUMBER_INPUT,eventType:g.EVENT_TYPES.FONT_SIZE_CHANGED,actionPayload:{sourceId:t.getId()},subItems:[]};return e.slide_metadata.font_sizes.forEach(e=>{const t={name:e.toString(),mapped_id:e.toString()};s.subItems.push(t)}),s}buildColorOption(e,t,i){const n=i.color,s={id:o.uniqueId("toolbar-item-"),icon:"fa fa-caret-down",title:"A",selected:!1,color:n,type:l.ToolbarItemType.DROPDOWN_BUTTON_COLOR,eventType:g.EVENT_TYPES.COLOR_CHANGED,actionPayload:{sourceId:t.getId()},subItems:[]};return e.slide_metadata.color_menu.root_entry.children.forEach(e=>{s.subItems.push(e)}),s}findPageForWidget(e){const t=e.getPageState().getPageConfiguration().pages;return o.find(t,t=>t.id===e.getSlotConfiguration().page)}buildImageBoxModel(e){return{id:e.getId(),uploadLabel:c.contextData.getMessage("_1000704"),separatorLabel:c.contextData.getMessage("_1846342"),inputLabel:c.contextData.getMessage("_1845241"),imageUrl:e.getPayloadValue().content_url,errorUrl:_.resourcesService.getImageUrl(f.ImageResource.deadlinkPng)}}buildImageBoxSettings(e){return{editable:e.isEditMode(),blockSvg:!0,mimeFilter:"image/*"}}buildVideoBoxModel(e){return{id:e.getId(),inputLabel:c.contextData.getMessage("_534534"),placeholerLabel:c.contextData.getMessage("_534535"),url:e.getPayloadValue().content_url}}buildVideoBoxSettings(e){return{editable:e.isEditMode(),hosts:p.videoService.getHosts()}}getPlaceholderText(e){return e.isHeadline()?c.contextData.getMessage("_1682886"):c.contextData.getMessage("_1161393")}getRelevantStyle(e,t){return e.isHeadline()?t.slide_metadata.heading_style:t.slide_metadata.body_style}buildTextBoxStyles(e,t){const i=this.getRelevantStyle(e,t),n=e.getPayloadValue().ppt_text_style,s=void 0!==n&&n.align?n.align:i.align,o=void 0!==n&&n.color?n.color:i.color,r=void 0!==n&&n.font_family?n.font_family:i.font_family,a=(void 0!==n&&n.font_size?n.font_size:i.font_size)+"pt",c=this.computeFontSize(void 0!==n&&n.font_size?n.font_size:i.font_size,e.getPageState().getPageConfiguration().grid)+"px",l=void 0!==n&&void 0!==n.bold?n.bold:i.bold,d=void 0!==n&&void 0!==n.italic?n.italic:i.italic;let g=void 0!==n&&n.line_spacing?n.line_spacing:i.line_spacing;return g=Math.max(1,g)*y,{textAlign:s,color:o,fontFamily:r,fontSize:c,fontSizeModel:a,fontWeight:l?"bold":"normal",fontStyle:d?"italic":"normal",lineHeight:g}}computeFontSize(e,t){return h.PAGE_WITH_SIDEBAR_WIDTH/t.aspect_ratio/t.slide_height_in_inches/72*e}buildTextBoxDefaultStyles(){return{fontFamily:"Arial"}}handleNewWidgetResponse(e,t){const s=e.id,r=e.data_input_configuration;n.logService.assert(void 0!==s,"page break widget_id containing add element button is required"),n.logService.assert(void 0!==r,"created data_input_configuration is required"),n.logService.assert(o.isString(s),"created data_input_configuration is required");const c=t.getWidgetById(s);n.logService.assert(void 0!==c,"reference widget not found"),t.insertSectionBelow(c.getSection()).addWidget(a.widgetFactory.wrapWidget(r,t)),t.endEditingPageLayout().then(()=>{setTimeout(()=>{i.dispatcher.dispatch("textEditor_onEdit",{widgetId:e.data_input_configuration.widget_id})})})}handleRemoveWidgetResponse(e,t){t.deleteWidget(t.getWidgetById(e.id)),t.endEditingPageLayout()}}t.default=v,t.textService=new v}),define("react_components/report_components/image_box_container",["require","exports","widget_base","event_bus","react","report_components","services/context","services/rest_form_service","reusable_utilities","services/text","services/bubble_dialog","services/configuration","classes/context_data/context_data","classes/application/application"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.ImageBoxContainer=class extends i.AbstractFragmentLayer{constructor(e){super(e),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.IMAGE_BOX_SAVE,this.saveImageBox.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.IMAGE_LOADED,e=>this.updateImageBox(e.value)),this.state={model:this.props.model,settings:this.props.settings}}componentDidMount(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.IMAGE_BOX_EDITABLE_CHANGED,e=>{e.value.id===this.props.model.id&&(n.eventBus.dispatch({type:n.EVENT_TYPES.SET_WIDGET_EDIT,value:{state:e.value.editable,id:this.props.model.id}}),void 0!==this.editBubble&&(this.editBubble.destroy(),this.editBubble=void 0))}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SET_WIDGET_EDIT,e=>{if(e.value.id===this.props.model.id&&e.value.state){const e=JSON.parse(JSON.stringify(this.state));e.model.saveLabel=u.contextData.getMessage("_612374"),e.model.savingLabel=u.contextData.getMessage("_911337"),e.model.cancelLabel=u.contextData.getMessage("_691638"),e.settings.editable=!0,this.editBubble=d.bubbleDialogService.createReactBubble(constants.bubble_dialog.image_box_edition,$("body"),e,t=>s.createElement(o.ImageBoxRenderable,{model:e.model,settings:e.settings}),g.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.image_box_edition),{fadeBackground:!0})}})}render(){return s.createElement(o.ImageBoxRenderable,{model:this.state.model,settings:this.state.settings})}update(e){this.updateImageBox(e.widget)}draw(e){this.setState({})}saveImageBox(e){if(this.state.model.id===e.value.id){let t;void 0!==this.editBubble&&(this.editBubble.destroy(),this.editBubble=void 0),n.eventBus.dispatch({type:n.EVENT_TYPES.TOGGLE_EDIT_WIDGET,value:{id:this.state.model.id}});const i=p.mainApplication.getWidgetById(e.value.id);i.getPayloadValue().content_url=e.value.dataUrl;const s=new c.Url(e.value.dataUrl);s.isDataURL()&&(t=s.getBase64(),delete i.getPayloadValue().content_url),i.setPayloadValue(i.getPayloadValue());const o={image_attachment:t,data_input_configuration:i.toProto(),custom_page_id:i.getPageState().getAllowedPages().getCustomPageId(),custom_page_type:i.getPageState().getAllowedPages().getCustomPageType(),id:e.value.id},l=routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"text_widget","update","","rform").url;a.restFormService.postMultipart(l,o).then(e=>{const t=p.mainApplication.getWidgetById(this.state.model.id);t.getPayload().image_id=e.image_id,t.hasImageId()?t.loadImage():this.updateImageBox(t)})}}updateImageBox(e){if(this.state.model.id===e.getId()){const t=l.textService.buildImageBoxModel(e),i=l.textService.buildImageBoxSettings(e);this.setState({model:t,settings:i}),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:e.getSlotConfiguration().page}})}}}}),define("classes/widget/fragments/directive/image_box_fragment",["require","exports","react-dom","react","widget_base","services/text","react_components/report_components/image_box_container"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.ImageBoxFragment=class extends s.AbstractReactFragment{constructor(e){super(e)}renderIntoContainer(e,t){const s=o.textService.buildImageBoxModel(this.fragmentModel.widget),a=o.textService.buildImageBoxSettings(this.fragmentModel.widget);i.render(n.createElement(r.ImageBoxContainer,{model:s,settings:a,onUpdate:e,onDraw:t}),this.chartContainer)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/image_box_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/image_box_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[r.ImageBoxFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},buildConfigurations:n.defaultBuildConfigurations,noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/impact_graph_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/impact_graph_fragment"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[o.WidgetHeaderFragment,a.TopWidgetMenusFragment,r.ResultCountFragment],[s.WidgetLayoutBlockId.BODY]:[l.ImpactGraphFragment,n.LegendFragment],[s.WidgetLayoutBlockId.FOOTER]:[c.BottomWidgetMenusFragment]},buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{enableItemHover:!0,colorPaletteBuilder:n.LegendColorPaletteBuilder,enableItemSelection:!0,iconType:n.LegendItemIconType.CIRCLE}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/influencer_network_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","influencer_network","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/navigation/nav_params","services/navigation","services/bubble_dialog","services/configuration","classes/widget/fragments/directive/no_data_fragment","classes/context_data/context_data","other/tw","services/loading_bubble","classes/widget/fragments/directive/article_widget_fragment","classes/application/single_page_bubble_application","services/rest_form_service","wrappers/page_state/page_state_wrapper","reusable_utilities","services/confirmation_service","classes/widget/fragments/legacy_directive/theme_cloud_fragment","services/widgets/widget_api","services/broker","services/widgets/widget_factory","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[u.NoDataFragment,n.InfluencerNetworkFragment,n.InfluencerNetworkSidebarFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},showEvenIfNoData:!window.isExport,alwaysDisposeOnPayloadChange:!0,buildConfigurations:a.defaultBuildConfigurations.extend([{key:n.InfluencerNetworkFragment,value:N},{key:n.InfluencerNetworkSidebarFragment,value:L}])}};const O=e=>window.isExport&&!e.getPageState().getAllowedPages().isReport()&&"SHARED_DASHBOARD"!==e.getPageState().getAllowedPages().getPageType()?n.InfluencerNetworkLayout.SIDEBAR_HIDDEN:e.getPrimarySource().data_type_configuration_uuid,k=async e=>{e.setReloading(!0),e.setConfigurationChanged(!0);const t={strategy:P.ModelRefreshStrategy.REFRESH,force:!0},i=I.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),x.ModelType.WIDGET,t);try{await M.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&D.logService.error("Error when reloading Influencer Network graph",void 0,e)}},N={messages:{followers:p.contextData.getMessage("_051895"),sourcePanelHeader:p.contextData.getMessage("_540506").toUpperCase(),sourcePanelInclude:p.contextData.getMessage("_644521"),sourcePanelSelectionInclude:p.contextData.getMessage("_984505"),sourcePanelExclude:p.contextData.getMessage("_984212"),sourcePanelSelectionExclude:p.contextData.getMessage("_984506"),sourcePanelAddNew:p.contextData.getMessage("_306883"),sourcePanelSelectionAddNew:p.contextData.getMessage("_984507"),totalCrowdSize:p.contextData.getMessage("_718023",["{0}"])},canDrilldown:!window.isExport,showInfluencerMenu:!window.isExport,get isInfluencerManagementModule(){return h.tw.pageState.getAllowedPages().isInfluencerManagementModule()},defaultAvatarUrl:R.resourcesService.getImageUrl(F.ImageResource.defaultAvatarPng),onHistoryClick:async(e,t)=>{m.loadingBubbleService.showSpinner(),e.getExtendedConfiguration().setHistoryId(t),await k(e)},onInfluencerClick:(e,t,i)=>{i.dispatch("INFLUENCER_NETWORK_DISABLE_UNSELECT",{});const n=new c.NavigationParams;n.setFilters([[{key:"QUERY",value:`author_id:"${t}"`}]]),n.setWidget(e),n.setClickTarget(e.getTemplate()),l.navigationService.clickHandler(n,void 0,constants.page_type.context_menu_influencer_overview,void 0,void 0,!1).onDestroy.subscribeOnce(()=>{i.dispatch("INFLUENCER_NETWORK_ENABLE_UNSELECT",{})})},onAddInfluencerToList:(e,t)=>{t.dispatch("INFLUENCER_NETWORK_DISABLE_UNSELECT",{});const i={fetchUrl:y.restFormService.getRFormUrl("influencer_management","show"),profileId:e.influencerId,profileImage:e.imageUrl,profileUrl:e.profileUrl,name:e.name,selectedInfluencers:[{influencer_id:e.influencerId,profile_url:e.profileUrl,profile_name:e.name}]},n=constants.bubble_dialog.id.influencers_list_selection,s=g.configurationService.getBubbleDialogConfiguration().getStyle(n);d.bubbleDialogService.createByType(n,$("body"),n,i,s,{preventOutsideClickActions:!0,fadeOtherBubbles:!0,fadeBackground:!0}).onDestroy.subscribeOnce(()=>{t.dispatch("INFLUENCER_NETWORK_ENABLE_UNSELECT",{})})},getLayout:O},L={subFragments:{articles:{fragment:_.ArticleWidgetFragment},themeCloud:{fragment:w.ThemeCloudFragment},noData:{fragment:u.NoDataFragment}},messages:{settings:{theme:p.contextData.getMessage("_984483")},views:{default:p.contextData.getMessage("_984502"),sourcePanel:p.contextData.getMessage("_984482"),topicAndChannel:p.contextData.getMessage("_984501"),hashtag:p.contextData.getMessage("_984508")},noData:{idle:p.contextData.getMessage("_984484"),loading:p.contextData.getMessage("_984485"),noResults:p.contextData.getMessage("_718024")},pages:{people:p.contextData.getMessage("_984486"),interaction:p.contextData.getMessage("_984487"),hashTags:p.contextData.getMessage("_984488"),advancedSettings:p.contextData.getMessage("_984489"),views:p.contextData.getMessage("_984500")},refresh:{generation:p.contextData.getMessage("_984490"),init:p.contextData.getMessage("_015949"),idle:p.contextData.getMessage("_015948"),busy:p.contextData.getMessage("_890987"),failed:p.contextData.getMessage("_984491"),period:p.contextData.getMessage("_984511")},onoff:{off:p.contextData.getMessage("_167946"),on:p.contextData.getMessage("_679432")},peopleTypes:{influencer:p.contextData.getMessage("_984492"),amplifier:p.contextData.getMessage("_984493")},peopleTypesInfluencerOne:{influencer:p.contextData.getMessage("_984509"),amplifier:p.contextData.getMessage("_984510")},labels:{level:p.contextData.getMessage("_984499",["{0}","{1}"]),allSourcePanels:p.contextData.getMessage("_984496"),allTopicsAndChannels:p.contextData.getMessage("_984504")},warning:{legacyData:p.contextData.getMessage("_984495"),noSourcePanels:p.contextData.getMessage("_984497"),noHashtags:p.contextData.getMessage("_984498"),noTopicsOrChannels:p.contextData.getMessage("_984503")}},get availableFilterViews(){if(h.tw.pageState.getAllowedPages().isInfluencerManagementModule())return[n.InfluencerNetworkFilterViewType.Hashtags]},showRefreshButton:!window.isExport,get isInteractive(){return!(window.isExport&&"SHARED_DASHBOARD"!==h.tw.pageState.getAllowedPages().getPageType()||h.tw.pageState.getAllowedPages().isReport())},getLayout:O,getPageFilter:()=>window.isExport&&"SHARED_DASHBOARD"!==h.tw.pageState.getAllowedPages().getPageType()||h.tw.pageState.getAllowedPages().isReport()?[n.InfluencerSidebarPage.INTERACTIONS,n.InfluencerSidebarPage.VIEWS]:h.tw.pageState.getAllowedPages().isDashboard()?[n.InfluencerSidebarPage.INTERACTIONS]:[],reloadGraph:k,getStatus:e=>C.widgetApiService.getDeferredWidgetRefreshJobStatus(e),async onRefreshClick(e){await C.widgetApiService.isDeferredRefreshJobAlreadyRunning(e)&&await b.confirmationService.display({message:p.contextData.getMessage("_718026")});const t=(await C.widgetApiService.createDeferredWidgetRefreshJob(e)).page_state.data_input_configuration[0].payload.missing_data_reason;if(t&&"SEARCH_NOT_AVAILABLE"===t)return C.widgetApiService.resetDeferredWidgetRefreshJob(),Promise.reject(t)},loadFragmentData(e,t){switch(t){case"articles":return this.loadArticles(e);case"themeCloud":return this.loadHashTags(e)}},async loadArticles(e){const t=await y.restFormService.postRForm("article_fetching","search",{entry_ids:e});t.articles.section_id=1;const i=new f.SinglePageBubbleApplication(A.mainApplication);i.injectPageState(new v.PageStateWrapper(Object.assign({},h.tw.pageState.toProto(),{data_input_configuration:[t.articles]}),i));const n=new S.CancellationToken;return n.registerDisposable(i),{widget:i.getPageState().getWidgets()[0],cancellationToken:n}},async loadHashTags(e){const t=await y.restFormService.postRForm("hashtags_fetching","search",{entry_ids:e});t.hashtags.section_id=1;const i=T.widgetFactory.wrapWidget(t.hashtags,h.tw.pageState),n=new S.CancellationToken;return n.registerDisposable(i),{widget:i,cancellationToken:n}},onFilterEnter(e,t){d.bubbleDialogService.createSelectedFilters(e.getId(),$(t),e.getUf(),g.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1)},onFilterLeave(e){d.bubbleDialogService.destroyById(e.getId())},onTimeFilterChange(e,t,i){E.brokerService.subscribe(constants.events.time_filter.select.range,()=>{const i=new Date(2017,5,1).getTime(),n=e.getPageState().hasUserFilterSettings()&&e.getPageState().getUserFilterSettings().hasTimeFilter()&&e.getPageState().getUserFilterSettings().getTimeFilter().getFrom()<i;t(n)},i)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/influencer_overview_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/influencer_overview_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.InfluencerOverviewFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/influencer_table_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/influencer_table_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.InfluencerTableFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/kpi_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/kpi_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/color_palette_builder/kpi_color_palette_builder","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[r.WidgetHeaderFragment,l.TopWidgetMenusFragment,n.ReplayDateFragment],[i.WidgetLayoutBlockId.BODY]:[s.KpiChartFragment],[i.WidgetLayoutBlockId.FOOTER]:[d.BottomWidgetMenusFragment,o.ReplayFragment]},buildConfigurations:a.defaultBuildConfigurations.extend([{key:s.KpiChartFragment,value:{colorPaletteBuilder:c.KpiColorPaletteBuilder}}]),layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/line_chart_blueprint",["require","exports","canvas_chart_utilities","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/sidenote_fragment","classes/widget/fragment_controllers/line_chart_widget_blueprint_enhancer","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/line_chart_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[r.WidgetHeaderFragment,d.TopWidgetMenusFragment,a.ResultCountFragment],[s.WidgetLayoutBlockId.BODY]:[u.LineChartFragment,i.LegendFragment,c.SidenoteFragment],[s.WidgetLayoutBlockId.FOOTER]:[g.BottomWidgetMenusFragment,o.ReplayFragment]},enhancer:l.LineChartWidgetBlueprintEnhancer,buildConfigurations:n.defaultBuildConfigurations.extend([{key:i.LegendFragment,value:{colorPaletteBuilder:i.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!0,iconType:i.LegendItemIconType.LINE}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/message_diffusion_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/message_diffusion_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/globe_fragment","classes/widget/fragment_controllers/message_diffusion_widget_blueprint_enhancer","canvas_chart_utilities","classes/widget/widget_fragment_factory/default_build_configurations","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[o.WidgetHeaderFragment,r.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.MessageDiffusionChartFragment,c.GlobeFragment,d.LegendFragment],[i.WidgetLayoutBlockId.FOOTER]:[a.BottomWidgetMenusFragment,s.ReplayFragment]},enhancer:l.MessageDiffusionWidgetBlueprintEnhancer,buildConfigurations:g.defaultBuildConfigurations.extend([{key:d.LegendFragment,value:{iconType:d.LegendItemIconType.SQUARE,colorPaletteBuilder:d.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!1,type:d.LegendTypes.LINE,labelBuilder:()=>e=>`${e}. ${u.contextData.getMessage("_497845")}`}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/metric_multiple_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/metric_multiple_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.MetricMultipleFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/no_data_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/no_data_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[s.NoDataFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/openlayers_world_map_blueprint",["require","exports","canvas_chart_utilities","reusable_utilities","services/tw_number_formatter","classes/context_data/context_data","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/open_layer_map_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragment_controllers/openlayers_world_map_blueprint_enhancer","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{showEvenIfNoData:!0,layout:{[h.WidgetLayoutBlockId.HEADER]:[l.WidgetHeaderFragment,c.TopWidgetMenusFragment,d.ReplayDateFragment],[h.WidgetLayoutBlockId.BODY]:[a.OpenLayerMapFragment,i.LegendFragment],[h.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment,g.ReplayFragment]},noMargin:!0,enhancer:u.OpenlayersWorldMapBlueprintEnhancer,buildConfigurations:p.defaultBuildConfigurations.extend([{key:i.LegendFragment,value:{colorPaletteBuilder:i.LegendColorPaletteBuilder,enableItemHover:!1,enableItemSelection:!1,iconType:i.LegendItemIconType.CIRCLE,colorFactory:(e,t)=>t.isDefaultMap()?e.getTwColor():n.Color.BLACK,legendRangeFormatter:(e,t)=>{let i;void 0!==t.getDataGraph().total&&(i=t.getDataGraph().total.numeric_data);let n=0;const r=s.twNumberFormatter.getLowPrecisionFormatter();let a=e.length;return e.map(({min:e,max:t,total:s,color:c},l)=>{if(void 0===s){if(!i)return;s=i}const d=0===s?0:e/s,g=0===s?0:t/s;if(0===d&&0===g)return n=1,a--,{color:c,label:o.contextData.getMessage("_1698685")};let u=r.toPercentage(d)+" - "+r.toPercentage(g);return l===n&&a>1?{color:c,label:"0%"===(u=r.toPercentage(g))?`~${u}`:`≤ ${u}`}:(e===t&&(u=r.toPercentage(g)),{color:c,label:u})}).filter(e=>e)}}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/page_break_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/page_break_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.BODY]:[n.PageBreakFragment]},unmanaged:!0,noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/payload_edition_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/payload_edition_fragment"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.BODY]:[n.PayloadEditionFragment]},noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/pie_chart_blueprint",["require","exports","classes/widget/widget_fragment_factory/factory_utilities","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/pie_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","data_structures","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[o.WidgetLayoutBlockId.HEADER]:[l.WidgetHeaderFragment,g.TopWidgetMenusFragment,r.ReplayDateFragment],[o.WidgetLayoutBlockId.BODY]:[a.PieChartFragment,s.LegendFragment],[o.WidgetLayoutBlockId.FOOTER]:[u.BottomWidgetMenusFragment,c.ReplayFragment]},buildConfigurations:n.defaultBuildConfigurations.extend([{key:s.LegendFragment,value:{colorPaletteBuilder:s.LegendColorPaletteBuilder,numColumns:1,enableItemHover:!0,enableItemSelection:!0,legendType:(e,t)=>{if(!e.getApplication().getPageState().isGridPage())return i.setLineIfReplay(e,t)},itemFilter:e=>!(e instanceof d.DataGraphRow)||e.getMin()+e.getMax()>0}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/progress_graph_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","progress_graph","classes/widget/widget_fragment_factory/default_build_configurations","classes/context_data/context_data","classes/widget/fragments/canvas_chart/progress_graph_fragment"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g={colorPaletteBuilder:a.ProgressGraphColorPaletteBuilder,messages:{get previousPeriod(){return l.contextData.getMessage("_001127")}}};t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment,n.ReplayDateFragment],[i.WidgetLayoutBlockId.BODY]:[d.ProgressGraphFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},buildConfigurations:c.defaultBuildConfigurations.extend([{key:d.ProgressGraphFragment,value:g}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/radar_chart_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","radar","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[o.WidgetLayoutBlockId.HEADER]:[c.WidgetHeaderFragment,l.TopWidgetMenusFragment,r.ReplayDateFragment],[o.WidgetLayoutBlockId.BODY]:[s.RadarFragment,n.LegendFragment],[o.WidgetLayoutBlockId.FOOTER]:[d.BottomWidgetMenusFragment,a.ReplayFragment]},buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{axis:e=>"UUID_CONFIG_RADAR_CHART_COLUMN_AXES"===e.getConfigurationRendering().uuid_configuration?n.LegendDataAxisType.BY_ROW:n.LegendDataAxisType.BY_COLUMN,colorPaletteBuilder:n.LegendColorPaletteBuilder,enableItemSelection:!0,enableItemHover:!0}},{key:s.RadarFragment,value:{colorPaletteBuilder:s.RadarColorPaletteBuilder}}])}}}),define("components/bubble_dialog/influencers_list/creation/directive",["require","exports","angular","jquery","reusable_utilities","services/tw_common","angular_utilities","services/rest_form_service","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){function d(){return{templateUrl:l.templateSourceFactory("components/bubble_dialog/influencers_list/creation"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:u,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:g}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=d,t.InfluencersListCreationDirective=d;let g=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent(n(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(n(document),"mousedown",e=>this.handleMouseDown()),this.saving=!1,this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}close(){this.facade.onMessage.fire({save:!1}),this.facade.destroy()}save(){this.saving=!0,a.restFormService.post(this.payload.saveUrl,this.payload.formData).then(e=>{this.saving=!1,this.facade.onMessage.fire({result:e,save:!0}),this.facade.destroy()},e=>{this.fieldMessages=e.field_messages,this.saving=!1})}canSave(){return!this.saving}getTitle(){return this.payload.editMode?c.contextData.getMessage("_1741106"):c.contextData.getMessage("_1846531")}handleClick(e){o.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close()}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}};function u(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}g=__decorate([r.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object])],g)}),define("react_components/influencers_lists_mgmt/influencer_list_overviews_container",["require","exports","react","flux","influencers_list_mgmt","event_bus","services/bubble_dialog","services/configuration","classes/context_data/context_data","classes/application/application","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log","services/rest_form_service","services/confirmation_service","math_utils"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencersListOverviewsContainer=class extends n.BaseComponent{constructor(e){super(e),this.state={loadingStates:{}},this.initSubscriptions()}componentDidMount(){this.loadMetrics(),this.resizeParentContainer()}componentWillReceiveProps(e){e.influencersListsData.influencer_lists.forEach(e=>{this.hasMetrics(e)&&!0===this.state.loadingStates[e.list_id]&&this.handleStateForLoadedMetric(e,!1)})}componentDidUpdate(){this.loadMetrics(),this.resizeParentContainer()}redrawWidget(e){return new Promise((e,t)=>{e()})}render(){return i.createElement("div",{ref:"root",className:"influencer-list-overviews-container"},this.renderRenderable())}renderRenderable(){return i.createElement(s.InfluencerListOverviewsRenderable,{influencersLists:this.props.influencersListsData.influencer_lists,messages:this.getMessages(),loadingStates:this.state.loadingStates})}getMessages(){return{influencerListMessages:{moreLabel:c.contextData.getMessage("_1943213"),descriptionLabel:c.contextData.getMessage("_185901"),influencerCountLabel:c.contextData.getMessage("_1956124"),editTooltip:c.contextData.getMessage("_1365432"),deleteTooltip:c.contextData.getMessage("_1654355"),inspectTooltip:c.contextData.getMessage("_1354258")}}}handleCreateInfluencersListManagementBubble(e){this.spawnInfluencerListBubbleDialog({},!1)}spawnInfluencerListBubbleDialog(e,t){const i=constants.bubble_dialog.id.influencers_list_creation,n=!0===t?e.save_link:this.props.influencersListsData.create_list_url;r.bubbleDialogService.createByType(i,$("body"),i,{formData:e,saveUrl:n,editMode:t},a.configurationService.getBubbleDialogConfiguration().getStyle(i),{preventOutsideClickActions:!0}).onMessage.subscribeOnce(async e=>{!0===e.save&&(await this.refreshWidget(this.props.widget),this.resetLoadingStates())})}async handleEnterInfluencerList(e){const t=e.value;l.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType("INFLUENCER_LIST").unselectAllAndSelectByMappedId(t.list_mapped_id),this.refreshPageData(t)}handleDeleteInfluencerList(e){_.confirmationService.display({message:c.contextData.getMessage("_705442")}).then(async()=>{await m.restFormService.deleter(e.value.remove_url),await this.refreshWidget(this.props.widget),this.resetLoadingStates()})}handleEditInfluencerList(e){this.spawnInfluencerListBubbleDialog(JSON.parse(JSON.stringify(e.value)),!0)}resizeParentContainer(){o.eventBus.dispatch({type:o.EVENT_TYPES.RESIZE_INFLUENCER_LIST_OVERVIEWS,value:$(this.refs.root)})}async refreshPageData(e){const t={strategy:d.ModelRefreshStrategy.REFRESH,pageNavigation:{page_category:e.category,page_type:e.page_type}},i=p.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,g.ModelType.PAGE_STATE,t);try{await u.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state when entering influencer list !",void 0,e)}}async loadMetrics(){this.props.influencersListsData.influencer_lists.forEach(e=>{this.hasMetrics(e)||void 0!==this.state.loadingStates[e.list_id]||this.loadMetricsForList(e)})}async loadMetricsForList(e){this.handleStateForLoadedMetric(e,!0);const t=(await m.restFormService.post(e.load_metrics_url,{page_state:l.mainApplication.getPageState().toProto()})).metrics;this.updateMetricsOnOwner(t,e),this.handleStateForLoadedMetric(e,!1)}initSubscriptions(){this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.CREATE_INFLUENCER_MGMT_LIST,this.handleCreateInfluencersListManagementBubble.bind(this)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.ENTER_INFLUENCER_LIST,this.handleEnterInfluencerList.bind(this)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.DELETE_INFLUENCER_LIST,this.handleDeleteInfluencerList.bind(this)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.EDIT_INFLUENCER_LIST,this.handleEditInfluencerList.bind(this)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.RESIZE_INFLUENCER_LIST_OVERVIEWS,e=>{const t=e.value;o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.widget.getId(),expectedSize:this.props.drawSettings.dimensions.size,realSize:new f.Vector2D(t.outerWidth(),t.outerHeight())}})})}hasMetrics(e){return void 0!==e.metrics&&e.metrics.length>0}async refreshWidget(e){e.prepareReload();const t={strategy:d.ModelRefreshStrategy.REFRESH},i=p.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),g.ModelType.WIDGET,t);try{return await u.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&h.logService.error("Error when refreshing widget!",void 0,e)}}updateMetricsOnOwner(e,t){const i=this.props.widget.getPayloadValue();t.metrics=e,this.props.widget.setPayloadValue(i)}handleStateForLoadedMetric(e,t){const i=this.state.loadingStates;i[e.list_id]=t,this.setState({loadingStates:i})}resetLoadingStates(){this.setState({loadingStates:{}})}}}),define("components/influencers_list_mgmt/campaign_influencers/controllers/influencer_lists_filter_menu_controller",["require","exports","react_components/filter_menu/default_filter_menu_controller"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerListsFilterMenuController=class extends i.DefaultFilterMenuController{constructor(e,t,i={}){super(e,t),this.callbacks=i}shouldPersistChanges(){return!1}onMenuClose(){super.onMenuClose(),this.callbacks.onMenuClose&&(this.markAsUnmodified(),this.callbacks.onMenuClose(this.adapter.getData()))}}}),define("components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filter_menu_adapter",["require","exports","react_components/filter_menu/topic_menu_wrapper_adapter","filter_menu"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignInfluencersFilterMenuAdapter=class extends i.TopicMenuWrapperMenuAdapter{remapTopicMenu(e){const t=e.getRootEntry(),i={mappedId:t.getMappedId(),name:t.getName(),selected:t.isSelected(),isNotSelectable:t.isNotSelectable(),children:[{mappedId:"",name:"",selected:t.isSelected(),isNotSelectable:t.isNotSelectable(),parent:void 0,children:t.getChildren().filter(e=>e.isVisible()).map(e=>this.remapTopicEntry(e)),needsToken:!1,significance:0}]};return n.AbstractFilterMenuController.getFilterInputsRecursively(i)}remapTopicEntry(e){const t=super.remapTopicEntry(e);return t.isNotUnselectable=e.getMappedId()===e.getAssociatedTopicMenu().getAllMappedId(),t}}}),define("components/influencers_list_mgmt/campaign_influencers/styles/campaign_influencers_style_utils",["require","exports","services/theme"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignInfluencersStyleUtils=class{static buildSquareFilterMenuStyles(){return{minWidth:"285px",customStyle:{baseStyle:{display:"flex",color:i.themeService.getCurrentThemeModel().shadeDarkest,alignItems:"center",padding:"0 15px 0 0",borderRadius:"2px",border:"1px solid #d7dbdd",height:"39px"},baseLabelStyle:{fontSize:"14px",padding:"0 15px",flexGrow:1,overflow:"hidden",textOverflow:"ellipsis"},baseIconStyle:{fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"1px 0 0 1px",height:"100%",width:"39px"},closedWithSelectionMenuStyle:{backgroundColor:"#ffffff",minWidth:"285px",borderBottom:"1px solid #d7dbdd"},openMenuStyle:{backgroundColor:"#ffffff",minWidth:"285px",borderBottom:"0"},normalButtonStyle:{display:"none"},hoveredButtonStyle:{display:"none"}}}}}}),define("react_components/influencers_lists_mgmt/campaign_influencers_container",["require","exports","flux","react","influencers_list_mgmt","classes/context_data/context_data","wrappers/topic_menu/topic_menu_wrapper","services/influencer_mgmt/influencer_state_service","services/navigation","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/application/application","classes/refresh/model_type","services/refresh/model_refresh_service","reusable_utilities","event_bus","log","reusable_components","components/influencers_list_mgmt/campaign_influencers/controllers/influencer_lists_filter_menu_controller","components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filter_menu_adapter","components/influencers_list_mgmt/campaign_influencers/styles/campaign_influencers_style_utils"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignInfluencersContainer=class extends i.BaseComponent{constructor(e){super(e);const t=this.buildInfluencerStateModels(),i=t,n=new r.TopicMenuWrapper(this.props.formEntry.influencer_list_topic_menu),s={defaultStateModels:t,influencerStateModels:i,influencerOptions:{showDetails:!0,canBeReordered:!0},influencerListsTopicMenu:n,selectedListsIds:this.initSelectedListsIds(n)};this.state=s}componentDidMount(){const e=new r.TopicMenuWrapper(this.props.formEntry.influencer_list_topic_menu);this.initSubscriptions(),m.eventBus.dispatch({type:m.EVENT_TYPES.ADD_FILTER_MENU_FROM_OTHER_SRC,value:this.createInfluencerListsMenu(e)})}render(){return n.createElement("div",{className:"campaign-influencers"},n.createElement("div",{className:"campaign-influencers-filter-bar"},n.createElement("div",{className:"influencer-filtering"},n.createElement("div",{className:"form-group"},n.createElement("div",{className:"influencer-filtering-field-wrapper"},n.createElement("input",{placeholder:o.contextData.getMessage("_1874651"),value:this.state.influencerFilter,onChange:this.searchInfluencer.bind(this),className:"form-control"})))),n.createElement(s.InfluencersListStatesRenderable,{stateModels:this.state.influencerStateModels,options:this.state.influencerOptions})))}componentWillUnmount(){super.componentWillUnmount(),void 0!==this.filterInputToken&&this.filterInputToken.cancel()}searchInfluencer(e){const t=e.target.value;void 0!==this.filterInputToken&&this.filterInputToken.cancel(),this.filterInputToken=new h.CancellationToken,this.filterInputToken.setTimeout(()=>{t.length>0?this.filterInfluencersModel(t):this.resetInfluencersModel()},300),this.setState({influencerFilter:t})}buildInfluencerStateModels(){return this.props.formEntry.influencer_table.columns.map(e=>({column:JSON.parse(JSON.stringify(e))}))}cloneDefaultStateModels(){return JSON.parse(JSON.stringify(this.state.defaultStateModels))}filterInfluencersModel(e){const t=this.cloneDefaultStateModels();this.filterInfluencersByPredicate(t,t=>void 0!==t.profile_data.name&&t.profile_data.name.toLowerCase().includes(e.trim().toLowerCase())),this.setState({influencerStateModels:t,filteredStateModels:t})}resetInfluencersModel(){this.setState({influencerStateModels:this.state.defaultStateModels,filteredStateModels:void 0})}initSelectedListsIds(e){return[...this.getSelectedMappedIds(e)]}initSubscriptions(){this.cancellationToken.subscribeToStream(m.eventBus,m.EVENT_TYPES.ON_DRAG_STOP_INFLUENCER,this.handleInfluencerMove.bind(this)),this.cancellationToken.subscribeToStream(m.eventBus,m.EVENT_TYPES.SHOW_INFLUENCER_DETAILED,this.handleShowInfluencerDetailedView.bind(this))}async handleInfluencerMove(e){const t=e.value;let i;void 0!==this.state.filteredStateModels&&(i=JSON.parse(JSON.stringify(this.state.filteredStateModels)));const n=this.applyMoveOnStateModels(t);try{const e=a.influencerStateService.requestMove(t,this.props.formEntry.campaign_id,n);await e}catch(e){this.revertMoveOnStateModels(i)}}applyMoveOnStateModels(e){const t=[...this.state.defaultStateModels],i=void 0!==this.state.filteredStateModels?[...this.state.filteredStateModels]:void 0;let n=a.influencerStateService.moveModel(e,t);return void 0!==i&&(n=a.influencerStateService.moveModel(e,i)),this.setState({defaultStateModels:t,filteredStateModels:i}),n}revertMoveOnStateModels(e){const t=this.buildInfluencerStateModels();let i,n=t;void 0!==this.state.filteredStateModels&&(n=i=e),this.setState({defaultStateModels:t,filteredStateModels:i,influencerStateModels:n})}createInfluencerListsMenu(e){const t={topicMenu:e,allNodeId:e.getAllMappedId(),rootId:e.getRootEntry().getMappedId(),config:{menuLabelProvider:()=>o.contextData.getMessage("_1895415"),showSearchBar:!1,showSelectedFilters:!0,showTopResults:!1,showSelectionAsLabel:!0,hideAllNodeFromSelections:!0,component:{renderable:f.SquareFilterMenuRenderable,props:S.CampaignInfluencersStyleUtils.buildSquareFilterMenuStyles()}}};return{controller:new y.InfluencerListsFilterMenuController(t,v.CampaignInfluencersFilterMenuAdapter,{onMenuClose:e=>{const{topicMenu:t}=e,i=this.getSelectedMappedIds(t);this.isListSelectionsChanged(i)&&(this.setState({selectedListsIds:i}),this.filterInfluencersByLists(t))}})}}handleShowInfluencerDetailedView(e){const t=[[{key:"QUERY",value:`author_id:"${e.value.influencerId}"`}]];c.navigationService.openDrilldown(t,void 0,"CONTEXT_INFLUENCER_DETAILS",void 0,this.props.widget,void 0,!1)}getSelectedMappedIds(e){return e.getSelectedEntriesRecursively().map(e=>e.getMappedId())}isListSelectionsChanged(e){return e.length!==this.state.selectedListsIds.length||e.some(e=>!this.state.selectedListsIds.includes(e))}isCampaignSelectionChanged(){const e=this.props.widget.getPageState().getUserFilterSettings().getTopicMenuByType("INFLUENCER_CAMPAIGN").getFirstSelectedEntryRecursively();return void 0===e||e.getMappedId()!==this.props.formEntry.campaign_id}filterInfluencersByLists(e){const t=this.getSelectedMappedIds(e),i=this.cloneDefaultStateModels();t.length>1||t[0]!==e.getAllMappedId()?(this.filterInfluencersByPredicate(i,e=>void 0!==e.listIds&&e.listIds.some(e=>t.includes(e))),this.setState({filteredStateModels:i,influencerStateModels:i})):this.resetInfluencersModel()}filterInfluencersByPredicate(e,t){e.forEach(e=>{e.column.influencers=e.column.influencers.filter(t)})}async refreshPageData(){const e={strategy:l.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(g.mainApplication.getPageState(),g.mainApplication,u.ModelType.PAGE_STATE,e);try{return await p.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&_.logService.error("Error when refreshing page state after changing campaign !",void 0,e)}}}}),define("react_components/notes/simple_note_container",["require","exports","flux","react","notes","classes/context_data/context_data","services/rest_form_service","classnames"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.SimpleNoteContainer=class extends i.BaseComponent{constructor(e){super(e),this.progressButtonProps=this.buildProgressButtonProps()}render(){return n.createElement(s.SimpleNoteComponent,{text:this.props.formEntry.note,onChange:this.onChange.bind(this),progressButtonProps:this.progressButtonProps})}onChange(e){this.props.formEntry.note=e,this.progressButtonProps.isDisabled=!this.isNoteValid(),this.progressButtonProps.className=this.prepareProgressButtonClassNames(this.progressButtonProps.isDisabled),this.forceUpdate()}buildProgressButtonProps(){const e=!this.isNoteValid(),t=this.prepareProgressButtonClassNames(e);return{text:o.contextData.getMessage("_612374"),loadingText:o.contextData.getMessage("_911337"),isDisabled:!this.isNoteValid(),onClick:this.onSaveClick.bind(this),className:t}}prepareProgressButtonClassNames(e){return a({"btn btn-primary pull-right":!0,disabled:e})}isNoteValid(){return void 0!==this.props.formEntry.note&&this.props.formEntry.note.length>1}async onSaveClick(e){await r.restFormService.post(r.restFormService.getRFormUrl("notes_simple","update"),this.props.formEntry)}}}),define("react_components/influencer/contact/influencer_contacts.css",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createInfluencerContactsStyle=function(e){return{root:{position:"relative",marginTop:10},title:{display:"inline-block",backgroundColor:e.titleBackgroundColor,color:e.titleColor,fontFamily:"RobotoB",fontSize:14,margin:0,padding:"3px 9px",textTransform:"uppercase"},editButton:{position:"absolute",right:0,top:0,padding:"5px 10px"},contactBlocks:{marginTop:10}}}}),define("react_components/influencer/contact/influencer_contacts_container",["require","exports","flux","react","contact_components","services/theme","react_components/influencer/contact/influencer_contacts.css","reusable_components","classes/context_data/context_data","classnames","event_bus","log","influencer_contacts","services/rest_form_service","services/loading_bubble","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerContactContainer=class extends i.StyledBaseComponent{constructor(e){super(e,r.createInfluencerContactsStyle);const t=this.isContactsEmpty();this.configMap={},this.state={blocks:this.buildContactBlocks(t),editMode:t,theme:this.buildTheme(),savingContacts:!1,newContactsToSave:[],persistedContactsEmpty:t}}componentDidMount(){this.initSubscriptions()}render(){return n.createElement("div",{className:this.style.root},this.renderTitle(),this.renderEditButton(),this.renderContactBlocks(),this.renderSaveButton())}renderTitle(){return n.createElement("div",{className:this.style.title},c.contextData.getMessage("_1308947"))}renderEditButton(){if(this.state.persistedContactsEmpty)return null;{const e=!0===this.state.editMode?c.contextData.getMessage("_1968064"):c.contextData.getMessage("_1487405"),t=l(["btn btn-primary",this.style.editButton]);return n.createElement(a.TooltipComponent,{text:e,position:"top"},n.createElement("button",{onClick:this.toggleEditMode.bind(this),className:t},this.renderEditButtonIcon()))}}renderEditButtonIcon(){const e=!0===this.state.editMode?"fa fa-times":"fa fa-pencil";return n.createElement("i",{className:e})}renderContactBlocks(){return n.createElement("div",{className:this.style.contactBlocks},n.createElement(s.ContactBlocksComponent,{blocks:this.state.blocks,configMap:this.configMap,theme:this.state.theme,editable:this.state.editMode}))}renderSaveButton(){if(this.state.editMode){const e={"btn btn-primary pull-right":!0,disabled:this.state.savingContacts},t=l(e);return n.createElement(a.ProgressButton,{onClick:this.onSaveContacts.bind(this),className:t,text:c.contextData.getMessage("_612374"),loadingText:c.contextData.getMessage("_911337")})}return null}initSubscriptions(){this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.CONTACT_ITEM_EDIT,this.handleContactItemEdit.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.CONTACT_ITEM_CHANGED,this.handleContactItemChange.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.CONTACT_ITEM_DELETE,this.handleContactItemDelete.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.CONTACT_ITEM_ADD_NEW_FIELD,this.handleContactItemAddNewField.bind(this))}handleContactItemEdit(e){const t=this.getContactsByType(e.value.item.type),i=this.findItemInList(e.value.item.id,t),n=this.findBlockBySubTypeOrType(e.value.item.subType,e.value.item.type);n.items[this.findContactItemIndex(n,i)]=e.value.item,this.forceUpdate()}handleContactItemChange(e){const t=this.getContactsByType(e.value.item.type),i=this.findItemInList(e.value.item.id,t),n=this.findBlockBySubTypeOrType(e.value.item.subType,e.value.item.type);void 0!==i?u.influencerContactItemUtils.updateContactItem(e.value.item,i):t.push(u.influencerContactItemUtils.createContactContainerByType(e.value.item.type,e.value.item)),this.modifyNewPayloadValueItem(e.value.item),n.items[this.findContactItemIndexById(e.value.item.id,n)]=e.value.item,this.forceUpdate()}modifyNewPayloadValueItem(e){e.placeholderText=this.getPlaceholderText(e.subType),"media_contact"===e.type&&(e.icon=u.influencerContactItemIconUtils.getIconByMediaType(e.subType),e.iconStyles=u.influencerContactItemIconUtils.createIconStyleForMediaType(e.subType,this.findMediaItemIconColor(e.subType)))}getContactsByType(e){switch(e){case"address":return this.props.formEntry.address_contacts;case"media_contact":return this.props.formEntry.media_contacts;case"other_contact":return this.props.formEntry.other_contacts;case"phone":return this.props.formEntry.phone_contacts;default:return g.logService.error("InfluencerContactType has no matching contact items list !"),[]}}findItemInList(e,t){return t.find(t=>t.contact_object_id===e)}async handleContactItemDelete(e){const t=this.getContactsByType(e.value.item.type),i=this.findItemInList(e.value.item.id,t);e.value.item.isNew||(h.loadingBubbleService.showSpinner(),await p.restFormService.deleter(this.props.formEntry.remove_contact_link,u.influencerContactItemUtils.buildSaveRequestPayload(i,e.value.item.type))),this.handleDeleteResponse(i,e.value.item.subType,t),e.value.item.isNew||h.loadingBubbleService.hideSpinner()}handleDeleteResponse(e,t,i){const n=this.state.newContactsToSave.splice(this.state.newContactsToSave.indexOf(e),1);this.setState({newContactsToSave:[...n]}),i.splice(i.indexOf(e),1);const s=this.findBlockBySubTypeOrType(t,e.type);s.items.splice(this.findContactItemIndex(s,e),1)}handleContactItemAddNewField(e){const t=this.getContactsByType(e.value.type),i=this.findBlockBySubTypeOrType(e.value.subType,e.value.type),n=this.buildDefaultContactItem(e.value.type,e.value.subType);this.assignConfigForItem(n.id,{saveable:!1,editable:!0,deletable:!0,canCreateNewBlank:!1}),this.addSubTypeMenuProps(n.type,n),i.items.push(n),t.push(u.influencerContactItemUtils.createContactContainerByType(n.type,n)),this.setState({newContactsToSave:[...this.state.newContactsToSave,t[t.length-1]]})}async onSaveContacts(e){this.setState({savingContacts:!0});try{const e=await p.restFormService.postRForm("influencer_contacts","save",this.props.formEntry);this.mergeFormEntry(e);const t=this.isContactsEmpty();this.setState({editMode:t,savingContacts:!1,blocks:this.buildContactBlocks(t),newContactsToSave:[],persistedContactsEmpty:t,persistedFormEntry:void 0})}catch(e){const t=this.isContactsEmpty();this.setState({editMode:t,savingContacts:!1,blocks:this.buildContactBlocks(t),newContactsToSave:[],persistedContactsEmpty:t})}}toggleEditMode(e){const t=!this.state.editMode;this.state.editMode&&(this.cleanLists(),void 0!==this.state.persistedFormEntry&&this.mergeFormEntry(this.state.persistedFormEntry)),this.setState({editMode:t,blocks:this.buildContactBlocks(t),newContactsToSave:[],persistedContactsEmpty:this.isContactsEmpty(),persistedFormEntry:!0===t?this.cloneFormEntry(this.props.formEntry):void 0})}findContactItemIndex(e,t){return e.items.findIndex(e=>e.id===t.contact_object_id)}findContactItemIndexById(e,t){return t.items.findIndex(t=>t.id===e)}buildTheme(){return{borderColor:o.themeService.getCurrentThemeModel().shadeDark,defaultBlockTheme:this.buildDefaultBlockTheme(),specificBlockThemes:this.buildSpecificBlockThemes()}}buildDefaultBlockTheme(){return{defaultTextColor:o.themeService.getCurrentThemeModel().shadeDarkest,inputBorderColor:o.themeService.getCurrentThemeModel().shade,iconColor:o.themeService.getCurrentThemeModel().shadeDarkest,iconActionColor:o.themeService.getCurrentThemeModel().shadeDark,iconHoverColor:o.themeService.getBrandingColor(),borderColor:o.themeService.getCurrentThemeModel().shadeFaded,borderFocusColor:o.themeService.getBrandingColor(),placeholderColor:o.themeService.getCurrentThemeModel().shadeMedium}}buildSpecificBlockThemes(){const e={};return this.buildSpecificBlockTheme("blog",e),this.buildSpecificBlockTheme("socialmedia_facebook",e),this.buildSpecificBlockTheme("socialmedia_instagram",e),this.buildSpecificBlockTheme("socialmedia_pinterest",e),this.buildSpecificBlockTheme("socialmedia_twitter",e),this.buildSpecificBlockTheme("socialmedia_youtube",e),e}buildSpecificBlockTheme(e,t){const i=u.influencerContactItemIconUtils.createIconStyleForMediaType(e,this.findMediaItemIconColor(e));t[e]={iconColor:i.color,iconBackground:i.background}}buildContactBlocks(e){return[this.buildEmailBlock(e),this.buildWebsiteBlock(e),this.buildPhoneBlock(e),this.buildSkypeBlock(e),this.buildHomeAddressBlock(e),this.buildWorkAddressBlock(e),this.buildMediaBlock(e)]}buildEmailBlock(e){return this.buildOtherBlock("EMAIL",e)}buildSkypeBlock(e){return this.buildOtherBlock("SKYPE",e)}buildWebsiteBlock(e){return this.buildOtherBlock("WEB_SITE",e)}buildOtherBlock(e,t){const i=this.buildItems(u.influencerContactItemUtils.filterOhterContainersByType(e,this.props.formEntry.other_contacts));if(0===i.length&&t){const t=this.buildDefaultOtherContactItem(e);this.assignConfigForItem(t.id,this.buildDefaultContactItemConfig()),i.push(t)}return{id:e,icon:u.influencerContactItemIconUtils.getIconByOtherType(e),items:i,isInlineBlock:!0,type:s.BlockType.SINGLE_BLOCK}}buildPhoneBlock(e){const t=this.buildItems(this.props.formEntry.phone_contacts);if(0===t.length&&e){const e=this.buildDefaultPhoneContactItem("PRO");this.assignConfigForItem(e.id,this.buildDefaultContactItemConfig()),t.push(e)}return{id:"phone",icon:u.influencerContactItemIconUtils.getIconByPhoneType("PRO"),items:t,isInlineBlock:!0,type:s.BlockType.SINGLE_BLOCK}}buildAddressBlock(e,t){const i=this.buildItems(u.influencerContactItemUtils.filterAddressContainersByType(e,this.props.formEntry.address_contacts));if(0===i.length&&t){const t=this.buildDefaultAddressContactItem(e);this.assignConfigForItem(t.id,this.buildDefaultContactItemConfig()),i.push(t)}return{id:e,icon:u.influencerContactItemIconUtils.getIconByAddressType(e),items:i,isInlineBlock:!0,type:s.BlockType.SINGLE_BLOCK}}buildHomeAddressBlock(e){return this.buildAddressBlock("HOME",e)}buildWorkAddressBlock(e){return this.buildAddressBlock("WORK",e)}findBlockBySubTypeOrType(e,t){let i=this.state.blocks.find(t=>t.id===e);return void 0===i&&void 0!==t&&(i=this.state.blocks.find(e=>e.id===t)).type===s.BlockType.GROUPED_BLOCKS&&(i=i.blocks.find(t=>t.id===e)),i}buildItems(e){return e.map((e,t)=>(this.assignConfigForItem(e.contact_object_id,{saveable:!1,editable:!1,deletable:t>0,canCreateNewBlank:0===t}),this.buildItem(e)))}buildItem(e){const t="media_contact"===e.type?this.findMediaItemIconColor(e.media_contact_type):void 0,i="media_contact"===e.type,n=u.influencerContactItemUtils.createContactItemForContainer(e,!1,i,t);return n.placeholderText=this.getPlaceholderText(n.subType),this.addSubTypeMenuProps(e.type,n),n}buildMediaBlock(e){const t=this.buildItems(this.props.formEntry.media_contacts);if(0===t.length&&e){const e=this.buildDefaultMediaContactItem("socialmedia_facebook");this.assignConfigForItem(e.id,this.buildDefaultContactItemConfig()),this.addSubTypeMenuProps(e.type,e),t.push(e)}return{id:"media_contact",label:c.contextData.getMessage("_1648904"),items:t,isInlineBlock:!1,type:s.BlockType.SINGLE_BLOCK}}assignConfigForItem(e,t){this.configMap[e]=t}findMediaItemIconColor(e){switch(e){case"blog":return o.themeService.getCurrentThemeModel().blog;case"socialmedia_facebook":return o.themeService.getCurrentThemeModel().facebook;case"socialmedia_instagram":return o.themeService.getCurrentThemeModel().instagramBackgroundGradients;case"socialmedia_linkedin":return o.themeService.getCurrentThemeModel().linkedin;case"socialmedia_pinterest":return o.themeService.getCurrentThemeModel().pinterest;case"socialmedia_twitter":return o.themeService.getCurrentThemeModel().twitter;case"socialmedia_youtube":return o.themeService.getCurrentThemeModel().youtube;default:return void g.logService.error(`No icon color defined for ${e} !`)}}buildDefaultContactItemConfig(){return{canCreateNewBlank:!0,saveable:!1,deletable:!1,editable:!0}}buildDefaultOtherContactItem(e){const t=u.influencerContactItemUtils.buildDefaultContactItem("other_contact",e);return t.placeholderText=this.getPlaceholderText(e),t}buildDefaultPhoneContactItem(e){const t=u.influencerContactItemUtils.buildDefaultContactItem("phone",e);return t.placeholderText=this.getPlaceholderText(e),t}buildDefaultAddressContactItem(e){const t=u.influencerContactItemUtils.buildDefaultContactItem("address",e);return t.placeholderText=this.getPlaceholderText(e),t}buildDefaultMediaContactItem(e){const t=u.influencerContactItemUtils.buildDefaultContactItem("media_contact",e,!0,this.findMediaItemIconColor(e));return t.placeholderText=this.getPlaceholderText(e),t}buildDefaultContactItem(e,t){switch(e){case"address":return this.buildDefaultAddressContactItem(t);case"phone":return this.buildDefaultPhoneContactItem(t);case"other_contact":return this.buildDefaultOtherContactItem(t);case"media_contact":return this.buildDefaultMediaContactItem(t);default:return}}getPlaceholderText(e){switch(e){case"EMAIL":return c.contextData.getMessage("_1350984");case"WEB_SITE":return c.contextData.getMessage("_1560884");case"PRO":return c.contextData.getMessage("_1521501");case"SKYPE":return c.contextData.getMessage("_1348134");case"HOME":case"WORK":return c.contextData.getMessage("_1491032");case"socialmedia_facebook":return"https://www.facebook.com/";case"socialmedia_instagram":return"https://www.instagram.com/";case"socialmedia_youtube":return"https://www.youtube.com/";case"socialmedia_twitter":return"https://www.twitter.com/";case"socialmedia_pinterest":return"https://www.pinterest.com";case"blog":return"https://www.yourblogdomain.com/";default:return}}mergeFormEntry(e){this.props.formEntry.address_contacts=e.address_contacts,this.props.formEntry.media_contacts=e.media_contacts,this.props.formEntry.other_contacts=e.other_contacts,this.props.formEntry.phone_contacts=e.phone_contacts}addSubTypeMenuProps(e,t){if("media_contact"===e){const e=JSON.parse(JSON.stringify(this.props.formEntry.channels_menu)),i=m.TopicEntryUtils.getEntryByMappedId(e.root_entry,t.subType);void 0!==i?(m.TopicEntryUtils.setSelection(i,!0),t.subTypeMenuProps=this.buildSingleSelectProps(e)):(g.logService.error(`Media type ${t.subType} is missing in the model of the selector !`),t.subTypeMenuProps=this.buildSingleSelectProps(e))}}buildSingleSelectProps(e){return{model:e,placeholder:c.contextData.getMessage("_1590841")}}cleanLists(){this.state.newContactsToSave.forEach(e=>{let t=this.cleanContainersList(this.props.formEntry.address_contacts,e);t||(t=this.cleanContainersList(this.props.formEntry.media_contacts,e))||(t=this.cleanContainersList(this.props.formEntry.other_contacts,e))||this.cleanContainersList(this.props.formEntry.phone_contacts,e)})}cleanContainersList(e,t){const i=e.findIndex(e=>t.contact_object_id===e.contact_object_id);return i>-1&&(e.splice(i,1),!0)}isContactsEmpty(){return this.isAddressListEmpty()&&this.isMediaListEmpty()&&this.isPhoneListEmpty()&&this.isOtherListEmpty()}isAddressListEmpty(){return this.isListEmpty(this.props.formEntry.address_contacts)}isMediaListEmpty(){return this.isListEmpty(this.props.formEntry.media_contacts)}isPhoneListEmpty(){return this.isListEmpty(this.props.formEntry.phone_contacts)}isOtherListEmpty(){return this.isListEmpty(this.props.formEntry.other_contacts)}isListEmpty(e){return void 0===e||0===e.length}cloneFormEntry(e){return JSON.parse(JSON.stringify(e))}}}),define("react_components/notes/css/notes_feed.css",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createNotesFeedContainerStyle=function(e){return{root:{marginTop:10},title:{display:"inline-block",backgroundColor:e.titleBackgroundColor,color:e.titleColor,fontFamily:"RobotoB",fontSize:14,marginLeft:20,padding:"3px 9px",textTransform:"uppercase"}}}}),define("react_components/notes/notes_feed_container",["require","exports","flux","notes_feed","services/theme","react","event_bus","services/rest_form_service","classes/context_data/context_data","react_components/notes/css/notes_feed.css"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.NotesFeedContainer=class extends i.StyledBaseComponent{constructor(e){super(e,l.createNotesFeedContainerStyle),this.state={disableCreationBox:!1}}componentDidMount(){this.initSubscriptions()}render(){return o.createElement("div",{className:this.style.root},this.renderTitle(),this.renderNotesFeed())}renderTitle(){return o.createElement("div",{className:this.style.title},c.contextData.getMessage("_1984904"))}renderNotesFeed(){const e=this.buildNotesFeedItems();return o.createElement(n.NotesFeedComponent,{notes:e,theme:this.buildNotesFeedTheme(),messages:this.buildNotesFeedMessages(),config:this.buildNotesFeedConfig()})}initSubscriptions(){this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.CREATE_NOTE_FROM_NOTES_FEED,this.handleCreateNote.bind(this)),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.SAVE_NOTE_FROM_NOTES_FEED,this.handleSaveNote.bind(this)),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.DELETE_NOTE_FROM_NOTES_FEED,this.handleDeleteNote.bind(this))}buildNotesFeedItems(){return void 0!==this.props.formEntry.note_list?this.props.formEntry.note_list.map(e=>({id:e.id,header:this.buildNoteFeedItemHeader(e),content:e.text,editable:e.editable,deletable:e.deletable,updating:this.state.updatedItemId===e.id})):[]}buildNoteFeedItemHeader(e){return`${e.formatted_timestamp}, ${e.user_name} added:`}buildNotesFeedTheme(){return{defaultColor:s.themeService.getCurrentThemeModel().shadeDarkest,brandedColor:s.themeService.getBrandingColor(),clearButtonColor:s.themeService.getCurrentThemeModel().shadeMedium,noteHeaderColor:s.themeService.getCurrentThemeModel().shade,feedItemActionColor:s.themeService.getCurrentThemeModel().shadeMedium,placeholderColor:s.themeService.getCurrentThemeModel().shadeMedium,leftBorderColor:s.themeService.getCurrentThemeModel().shadeFaded,borderColor:s.themeService.getCurrentThemeModel().shadeFaded,borderFocusColor:s.themeService.getBrandingColor()}}buildNotesFeedConfig(){return{showCreationBox:!0,disableCreationBox:this.state.disableCreationBox,maxChars:250,showClearButton:!1,scrollable:!0}}buildNotesFeedMessages(){return{creationBoxPlaceholder:c.contextData.getMessage("_1519018")}}async handleCreateNote(e){this.setState({disableCreationBox:!0});try{const t=await a.restFormService.postRForm("notes","create",{note:e.value,type:this.props.formEntry.type,record_id:this.props.formEntry.record_id});this.handleActionResponse(t)}catch(e){this.setState({disableCreationBox:!1})}}async handleSaveNote(e){this.setState({disableCreationBox:!0,updatedItemId:e.value.id});try{const t=await a.restFormService.postRForm("notes","update",{note:e.value.content,note_id:e.value.id,type:this.props.formEntry.type,record_id:this.props.formEntry.record_id});this.handleActionResponse(t)}catch(e){this.setState({disableCreationBox:!1,updatedItemId:void 0})}}async handleDeleteNote(e){this.setState({disableCreationBox:!0});try{const t=await a.restFormService.deleterRForm("notes","remove",{note_id:e.value,type:this.props.formEntry.type,record_id:this.props.formEntry.record_id});this.handleActionResponse(t)}catch(e){this.setState({disableCreationBox:!1})}}handleActionResponse(e){this.props.formEntry.note_list=e.note_list,this.setState({disableCreationBox:!1,updatedItemId:void 0})}}}),define("react_components/influencer/files/influencer_files.css",["require","exports","composable_styles"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createInfluencerFilesStyle=function(e){return{root:{display:"flex",flexDirection:"column",padding:10},header:{display:"flex",alignItems:"center"},title:{marginRight:10,marginLeft:10},description:{marginTop:10,marginBottom:10,marginLeft:23},content:{display:"flex"},fullWidth:{width:"100% !important"},uploadSection:{"& .form-control":{minHeight:54}},[i.mediaQueries.PHONE]:{uploadSection:{width:"100%"},listSection:{width:"100%"}},[i.mediaQueries.TABLET]:{uploadSection:{width:"50%",paddingRight:10},listSection:{width:"50%",paddingLeft:10}},[i.mediaQueries.DESKTOP]:{uploadSection:{width:"50%",paddingRight:10},listSection:{width:"50%",paddingLeft:10}}}}}),define("react_components/influencer/files/influencer_files_container",["require","exports","react","flux","react_components/influencer/files/influencer_files.css","files_list_component","file_upload","classes/context_data/context_data","services/rest_form_service","services/theme","event_bus","file_extensions","classnames"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerFilesContainer=class extends n.StyledBaseComponent{constructor(e){super(e,s.createInfluencerFilesStyle),this.state={theme:this.buildInfluencerFilesTheme(),items:this.buildItems(this.props.formEntry),savingNewFile:!1,filesListMessages:this.buildMessages()}}componentDidMount(){this.subscribeEvents()}render(){return i.createElement("div",{className:this.style.root},i.createElement("div",{className:this.style.header},i.createElement("i",{className:"fa fa-asterisk"}),i.createElement("div",{className:this.style.title},a.contextData.getMessage("_1618187"))),i.createElement("div",{className:this.style.description},a.contextData.getMessage("_1808461")),i.createElement("div",{className:this.style.content},this.renderFileUpload(),this.renderFilesList()))}subscribeEvents(){this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.DOWNLOAD_FILE_ITEM,this.handleDownloadContactFile.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.DELETE_FILE_ITEM,this.handleDeleteContactFile.bind(this)),this.cancellationToken.subscribeToStream(d.eventBus,d.EVENT_TYPES.UPDATE_FILE_ITEM,this.handleUpdateContactFile.bind(this))}renderFilesList(){return this.hasItems()?i.createElement("div",{className:this.style.listSection},i.createElement(o.FilesListComponent,{items:this.state.items,theme:this.state.theme.listTheme,messages:this.state.filesListMessages})):null}renderFileUpload(){const e=a.contextData.getMessage("_1480185"),t=u({"file-upload":!0,[this.style.uploadSection]:!0,[this.style.fullWidth]:!this.hasItems()});return i.createElement("div",{className:t},i.createElement(r.FileUpload,{id:"influencer-file-uploader",label:e,onLoad:this.onFileLoad.bind(this)}))}async onFileLoad(e){await this.save(e)}buildItems(e){return void 0!==e.files&&e.files.length>0?e.files.map(e=>this.buildItem(e)):[]}buildItem(e){return{id:e.file_id,label:e.title,fileName:e.file_name,description:e.description,deletable:e.deletable,icon:g.FileExtensionIconUtils.getIcon(e.extension)}}async uploadFile(e){return await c.restFormService.postMultipartRForm("influencer_files","add",{influencer_id:this.props.formEntry.influencer_id,file_import:e.files})}async save(e){this.setState({savingNewFile:!0});try{const t=await this.uploadFile(e);this.setState({items:this.buildItems(t),savingNewFile:!1})}catch(e){this.setState({savingNewFile:!1})}}buildInfluencerFilesTheme(){return{listTheme:this.buildListTheme(),uploadIconTheme:this.buildIconUploadTheme()}}buildListTheme(){return{defaultItemTheme:this.buildDefaultItemTheme()}}buildIconUploadTheme(){return{uploadIconColor:l.themeService.getCurrentThemeModel().shadeDark,uploadIconHoverColor:l.themeService.getBrandingColor()}}buildDefaultItemTheme(){return{backgroundColor:l.themeService.getCurrentThemeModel().shade,placeholderColor:l.themeService.getCurrentThemeModel().shadeMedium,borderColor:l.themeService.getCurrentThemeModel().shadeFaded,borderFocusColor:l.themeService.getBrandingColor()}}buildMessages(){return{fileTitlePlaceholder:a.contextData.getMessage("_1985134"),fileDescriptionPlaceholder:a.contextData.getMessage("_1704654")}}async handleDownloadContactFile(e){const t=await c.restFormService.postRForm("influencer_files","export",{file_id:e.value.id,influencer_id:this.props.formEntry.influencer_id});window.open(t.download_link,"_blank")}async handleDeleteContactFile(e){await c.restFormService.deleterRForm("influencer_files","remove",{file_id:e.value.id,influencer_id:this.props.formEntry.influencer_id}),this.state.items.splice(this.state.items.indexOf(e.value),1),this.setState({items:this.state.items})}async handleUpdateContactFile(e){await c.restFormService.postRForm("influencer_files","update",{file_id:e.value.id,influencer_id:this.props.formEntry.influencer_id,title:e.value.newTitle,description:e.value.newDescription});const t=this.state.items.find(t=>t.id===e.value.id);t.label=e.value.newTitle,t.description=e.value.newDescription,this.forceUpdate()}hasItems(){return void 0!==this.state.items&&this.state.items.length>0}}}),define("react_components/influencer/meta/css/influencer_meta.css",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createInfluencerMetaStyle=function(e){return{rowOne:{display:"flex"},rowTwo:{display:"flex"},contacts:{width:"50%"},notes:{width:"50%"},files:{width:"100%"}}}}),define("react_components/influencer/meta/influencer_meta_container",["require","exports","react","flux","react_components/influencer/meta/css/influencer_meta.css","services/theme","react_components/influencer/contact/influencer_contacts_container","react_components/influencer/files/influencer_files_container","react_components/notes/notes_feed_container"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerMetaContainer=class extends n.StyledBaseComponent{constructor(e){super(e,s.createInfluencerMetaStyle);const t={titleColor:o.themeService.getCurrentThemeModel().shadeDarkest,titleBackgroundColor:o.themeService.getCurrentThemeModel().widgetHeadTitleBackground};this.state={notesTheme:t}}render(){return i.createElement("div",null,i.createElement("div",{className:this.style.rowOne},this.renderContacts(),this.renderNotes()),i.createElement("div",{className:this.style.rowTwo},this.renderFiles()))}renderContacts(){const e={titleColor:o.themeService.getCurrentThemeModel().shadeDarkest,titleBackgroundColor:o.themeService.getCurrentThemeModel().widgetHeadTitleBackground};return i.createElement("div",{className:this.style.contacts},i.createElement(r.InfluencerContactContainer,{formEntry:this.props.formEntry.contacts,theme:e}))}renderNotes(){return i.createElement("div",{className:this.style.notes},i.createElement(c.NotesFeedContainer,{formEntry:this.props.formEntry.notes,theme:this.state.notesTheme}))}renderFiles(){return i.createElement("div",{className:this.style.files},i.createElement(a.InfluencerFilesContainer,{formEntry:this.props.formEntry.files,theme:void 0}))}}}),define("classes/widget/fragments/directive/restform_fragment",["require","exports","widget_base","react-dom","react","react_components/influencers_lists_mgmt/influencer_list_overviews_container","react_components/influencers_lists_mgmt/campaign_influencers_container","react_components/notes/simple_note_container","react_components/influencer/contact/influencer_contacts_container","react_components/notes/notes_feed_container","event_bus","math_utils","react_components/influencer/files/influencer_files_container","services/theme","react_components/influencer/meta/influencer_meta_container"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.RestformFragment=class extends i.AbstractReactFragment{constructor(e){super(e)}getLayoutIterator(){return new i.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:100,minWidth:0}],e=>this.getDimensionsForLayout(e))}renderIntoContainer(e,t,i){this.fragmentModel.widget.getPayloadValue().form_containers.forEach(e=>this.createComponentforContainer(e,i)),this.cancellationToken.isCanceled()||d.eventBus.dispatch({type:d.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.fragmentModel.widget.getId(),expectedSize:i.dimensions.size,realSize:new g.Vector2D($(this.chartContainer.children).outerWidth(),$(this.chartContainer.children).outerHeight())}})}update(e,t){return this.fragmentModel=e,this.updated=!0,this.onUpdate.fire(e,t),Promise.resolve(this)}draw(e){return this.onDraw.fire(e),this.updated&&(this.updated=!1,this.renderIntoContainer(this.onUpdate,this.onDraw,e)),Promise.resolve(this)}createComponentforContainer(e,t){switch(e.form_name){case"influencer_lists":return this.renderComponent(o.InfluencersListOverviewsContainer,{widget:this.fragmentModel.widget,influencersListsData:e.form_entry,drawSettings:t});case"campaign_influencers":return this.renderComponent(r.CampaignInfluencersContainer,{widget:this.fragmentModel.widget,formEntry:e.form_entry});case"notes_simple":return this.renderComponent(a.SimpleNoteContainer,{formEntry:e.form_entry});case"notes":{const t={titleColor:p.themeService.getCurrentThemeModel().shadeDarkest,titleBackgroundColor:p.themeService.getCurrentThemeModel().widgetHeadTitleBackground};return this.renderComponent(l.NotesFeedContainer,{formEntry:e.form_entry,theme:t})}case"influencer_contacts":{const t={titleColor:p.themeService.getCurrentThemeModel().shadeDarkest,titleBackgroundColor:p.themeService.getCurrentThemeModel().widgetHeadTitleBackground};return this.renderComponent(c.InfluencerContactContainer,{formEntry:e.form_entry,theme:t})}case"influencer_files":return this.renderComponent(u.InfluencerFilesContainer,{formEntry:e.form_entry,theme:void 0});case"influencer_meta":return this.renderComponent(h.InfluencerMetaContainer,{formEntry:e.form_entry,theme:void 0})}}renderComponent(e,t){const i=s.createElement(e,t);n.render(i,this.chartContainer)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/restform_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/restform_fragment"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[],[i.WidgetLayoutBlockId.BODY]:[o.RestformFragment],[i.WidgetLayoutBlockId.FOOTER]:[s.BottomWidgetMenusFragment]},buildConfigurations:n.defaultBuildConfigurations,noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/single_metric_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/single_metric_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[r.WidgetHeaderFragment,a.TopWidgetMenusFragment,n.ReplayDateFragment],[i.WidgetLayoutBlockId.BODY]:[s.SingleMetricFragment],[i.WidgetLayoutBlockId.FOOTER]:[c.BottomWidgetMenusFragment,o.ReplayFragment]},layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/sorted_theme_cloud_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/color_palette_builder/cloud_color_palette_builder","classes/widget/fragments/canvas_chart/sorted_cloud_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[c.SortedCloudFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},buildConfigurations:r.defaultBuildConfigurations.extend([{key:c.SortedCloudFragment,value:{colorPaletteBuilder:a.CloudColorPaletteBuilder}}]),noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/stream_graph_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/canvas_chart/stream_graph_fragment","classes/widget/fragments/legacy_directive/replay_fragment"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[s.WidgetLayoutBlockId.HEADER]:[o.WidgetHeaderFragment,a.TopWidgetMenusFragment,r.ResultCountFragment],[s.WidgetLayoutBlockId.BODY]:[l.StreamGraphFragment,n.LegendFragment],[s.WidgetLayoutBlockId.FOOTER]:[c.BottomWidgetMenusFragment,d.ReplayFragment]},buildConfigurations:i.defaultBuildConfigurations.extend([{key:n.LegendFragment,value:{enableItemHover:!0,colorPaletteBuilder:n.LegendColorPaletteBuilder,enableItemSelection:!0,iconType:n.LegendItemIconType.LINE}}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/summary_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/summary_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.SummaryFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},unmanaged:!0}}}),define("classes/widget/fragments/directive/data_table_fragment",["require","exports","widget_base","react-dom","react","data_table","data_structures","components/tools/data_graph","classes/navigation/nav_params","services/navigation","services/custom_pages","services/tw_number_formatter","reusable_services","services/refresh/model_refresh_service","log","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","classes/context_data/context_data","event_bus","reusable_utilities","services/configuration","services/bubble_dialog","services/tw_common","reusable_services"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E){Object.defineProperty(t,"__esModule",{value:!0});const T="ROW_LABEL";t.DataTableFragment=class extends i.AbstractReactFragment{constructor(e){super(e);let t=this.fragmentModel.widget.getDataGraph();(t.hasIndicatorFrames()||t.hasNestedFrames())&&(t=t.mergeIndicatorFrames()),this.dataGraphWrapper=new r.DataGraphWrapper(t.payloadDataGraph),this.typeString=this.getWidgetTypeString(this.fragmentModel),this.isEditMode=this.checkForEditMode(),this.isInitialized=!1,this.initSortingConfiguration(!1),this.buildDataTableModel(),this.sortDataTableModel()}initialize(e,t,i,n){return n.subscribeToStream(v.eventBus,v.EVENT_TYPES.SHOW_SENTIMENT_POPUP,this.showSentimentPopup.bind(this)),n.subscribeToStream(v.eventBus,v.EVENT_TYPES.HIDE_SENTIMENT_POPUP,this.hideSentimentPopup.bind(this)),n.subscribeToStream(v.eventBus,v.EVENT_TYPES.DATA_TABLE_RELOAD_REQUESTED,this.handleReloadRequest.bind(this)),super.initialize(e,t,i,n)}renderIntoContainer(e,t,i,r){this.isInitialized&&(this.updateGroups(),n.render(s.createElement(o.DataTableContainer,{widgetId:this.fragmentModel.widget.getId(),element:this.fragmentModel.widget.element,model:this.dataTableModel,settings:i,isEditMode:this.isEditMode,isSidePadding:this.fragmentModel.widget.hasSection()&&this.fragmentModel.widget.getSection().getWidgets().length>1,isFancy:"fancy_datatable"===this.typeString,onUpdate:e,onDraw:t,drillDownOnColumnCallback:this.drillDownOnColumn.bind(this),drillDownOnCellCallback:this.fragmentModel.widget.isClickable()?this.drillDownOnCell.bind(this):void 0,hideColumnCallback:this.removeColumn.bind(this),sortOnColumnCalback:this.sortByColumn.bind(this),sortOnRowLabelsCallback:this.sortByRowLabels.bind(this)}),this.chartContainer))}update(e,t){this.fragmentModel=e;let i=e.widget.getDataGraph();return(i.hasIndicatorFrames()||i.hasNestedFrames())&&(i=i.mergeIndicatorFrames()),this.dataGraphWrapper=new r.DataGraphWrapper(i.payloadDataGraph),this.isEditMode=this.checkForEditMode(),this.initSortingConfiguration(!1),this.buildDataTableModel(),this.sortDataTableModel(),this.onUpdate.fire(this.dataTableModel),Promise.resolve(this)}async draw(e){this.drawSettings=e,this.onDraw.fire(e),this.isInitialized=!0,this.renderIntoContainer(this.onUpdate,this.onDraw,e,void 0);const t=$(this.chartContainer).find(".tw-new-data-table");return e.animationStrategy!==C.twCommon.visualizationInitializationStrategy.INSTANT&&(t.addClass("animated"),t.css("transition-duration",`${e.animationDuration}ms`)),await E.fontDetectionService.waitUntilLoaded("CabinCondensedM"),await S.waitFor(1e3),this}dispose(){this.cancellationToken.cancel(),super.dispose()}checkForEditMode(){return this.fragmentModel.widget.getPageState().isEditMode()||this.fragmentModel.widget.getPageState().getAllowedPages().isReport()}buildDataTableModel(){const e=this.dataGraphWrapper,t=this.fragmentModel.widget.getExtendedConfiguration(),i=t.getType(),n="UUID_CONFIG_INFLUENCORS_CONFIGURATION"===i,s=this.checkForRowLabels(i),o=this.checkForRowLabelShortening(e,s),r=this.buildHeaderItems(e,t),a=this.buildRows(e,s);this.dataTableModel={header:{items:r},rows:a,hasRowLabels:s,hasGroups:n,isShortened:o},this.updateModelFlags()}buildHeaderItems(e,t){const i=t.getSortingConfig().getSortOnColumnCode(),n=t.getSortingConfig().getSortDirection();return e.getColumns().filter(e=>this.canShowColumn(e)).map(e=>{const t=i===e.getCode(),s=u.emojiService.parseTextForEmoji(e.getName()),o=e.getCode(),r=e.getColumn().sortable,a=t?n:void 0,c=!e.getColumn().drilldown_disabled;return{label:s,dataType:e.getColumn().data_type,colCode:o,color:e.getColor(),isSortable:r,sorted:a,isDrilldown:c,groupId:e.getColumn().parent?e.getColumn().parent.name:void 0}})}buildRows(e,t){return e.getRows().map(e=>{let i=void 0;const n=e.getRow().actions;return n&&n.length>0&&(i=[],n.forEach(e=>{i.push({description:e.description,text:e.text,icon:e.icon,click_action:e.click_action})})),{rowCode:e.getCode(),label:t?this.getRowLabel(e):void 0,actions:i,cells:e.getCells().filter(e=>this.canShowColumn(e.getColumn())).map(t=>({colCode:t.getColumn().getCode(),rowCode:e.getCode(),label:this.formatLabel(t),value:t.getValue(),tendency:this.createSimplifiedTendency(t)}))}})}getRowLabel(e){const t=e.getRow().translated_label||e.getFormattedLabel()||"";return u.emojiService.parseTextForEmoji(t)}checkForRowLabels(e){return"UUID_CONFIG_INFLUENCORS_CONFIGURATION"!==e&&void 0!==this.dataGraphWrapper.getRows().find(e=>void 0!==e.getLabel())}checkForRowLabelShortening(e,t){return!!e.getDataGraph().enable_ellipsis||!1!==t&&!!(e.getColumnGroups()&&e.getColumnGroups().length<5)}initSortingConfiguration(e){const t=this.fragmentModel.widget.getExtendedConfiguration();if(this.handleOldDataTableSettings(t),!1===t.hasSortingConfig()||void 0===t.getSortingConfig().getSortDirection()||void 0===t.getSortingConfig().getSortOnColumnCode())t.setSortingConfig({}),this.initSortingFromBackEnd();else{if(!e)return;this.initSortingFromBackEnd()}}handleOldDataTableSettings(e){if(e.hasSortingConfig()&&e.getSortingConfig().isSortOnRowLabel()){const t=e.getSortingConfig();t.setSortOnRowLabel(!1),t.setSortOnColumnCode(T)}}initSortingFromBackEnd(){const e=this.fragmentModel.widget.getExtendedConfiguration().getSortingConfig();let t=void 0,i=void 0;this.dataGraphWrapper.getColumns().filter(e=>this.canShowColumn(e)).forEach(e=>{const n=e.getColumn();void 0!==n.sort&&"NONE"!==n.sort&&(t=e.getCode(),i=e.getColumn().sort)}),e.setSortDirection(i),e.setSortOnColumnCode(t)}updateModelFlags(){this.dataTableModel.rows.forEach(e=>{e.cells.forEach(e=>{e.tendency&&(this.dataTableModel.useTrendCell=!0)})}),this.dataTableModel.rows.forEach(e=>{e.actions&&(this.dataTableModel.hasActions=!0)})}sortDataTableModel(){const e=this.fragmentModel.widget.getExtendedConfiguration(),t=e.getSortingConfig().getSortOnColumnCode(),i=e.getSortingConfig().getSortDirection();if(t&&i)if(t===T)this.sortDataTableModelByRowLabel(i);else{const e=this.dataGraphWrapper.getColumns().find(e=>e.getCode()===t);if(!e)return;const n=e.getColumn().data_type||"";"bar"===n||"number"===n||"datetime"===n?this.sortDataTableModelByNumber(i,e):"text"===n&&this.sortDataTableModelByText(i,e)}}sortDataTableModelByRowLabel(e){"DESC"===e?this.dataTableModel.rows.sort((e,t)=>e.label.localeCompare(t.label)):this.dataTableModel.rows.sort((e,t)=>t.label.localeCompare(e.label)),this.dataTableModel.header.rowLabelSort=e}sortDataTableModelByText(e,t){this.dataTableModel.rows.sort((i,n)=>{const s=t.getCells().find(e=>e.getRow().getCode()===i.rowCode).getValue(),o=t.getCells().find(e=>e.getRow().getCode()===n.rowCode).getValue();return"DESC"===e?s>o?-1:s<o?1:0:s<o?-1:s>o?1:0})}sortDataTableModelByNumber(e,t){this.dataTableModel.rows.sort((i,n)=>{const s=t.getCells().find(e=>e.getRow().getCode()===i.rowCode),o=t.getCells().find(e=>e.getRow().getCode()===n.rowCode);return"DESC"===e?o.getNumericData()-s.getNumericData():"ASC"===e?s.getNumericData()-o.getNumericData():0})}updateGroups(){!1!==this.dataTableModel.hasGroups&&(this.dataTableModel.header.groups?this.dataTableModel.header.groups.length=0:this.dataTableModel.header.groups=[],this.dataTableModel.header.items.forEach(e=>{if(e.groupId){let t=this.dataTableModel.header.groups.find(t=>t.name===e.groupId);if(void 0===t){const i=this.dataTableModel.header.groups.push({name:e.groupId,size:1,rendered:!1,highlighted:!1});t=this.dataTableModel.header.groups[i-1]}else t.size++;this.fragmentModel.widget.getExtendedConfiguration().getSortingConfig().getSortOnColumnCode()===e.colCode&&(t.highlighted=!0)}}))}sortByColumn(e){const t=this.fragmentModel.widget.getExtendedConfiguration().getSortingConfig();e.sorted?"DESC"===t.getSortDirection()?(t.setSortDirection("ASC"),e.sorted="ASC",this.dataTableModel.rows.reverse()):(e.sorted=void 0,this.initSortingConfiguration(!0),this.buildDataTableModel()):(this.dataTableModel.header.items.forEach(e=>e.sorted=void 0),this.dataTableModel.header.rowLabelSort=void 0,e.sorted="DESC",t.setSortDirection("DESC"),t.setSortOnColumnCode(e.colCode),this.sortDataTableModel()),this.onUpdate.fire(this.dataTableModel),this.renderIntoContainer(this.onUpdate,this.onDraw,this.drawSettings,void 0)}sortByRowLabels(){const e=this.fragmentModel.widget.getExtendedConfiguration().getSortingConfig();e.getSortOnColumnCode()===T?"DESC"===e.getSortDirection()?(e.setSortDirection("ASC"),this.dataTableModel.header.rowLabelSort="ASC",this.dataTableModel.rows.reverse()):(this.initSortingConfiguration(!0),this.buildDataTableModel()):(this.dataTableModel.header.items.forEach(e=>e.sorted=void 0),e.setSortDirection("DESC"),e.setSortOnColumnCode(T),this.dataTableModel.header.rowLabelSort="DESC",this.dataTableModel.rows.sort((e,t)=>e.label.localeCompare(t.label))),this.onUpdate.fire(this.dataTableModel),this.renderIntoContainer(this.onUpdate,this.onDraw,this.drawSettings,void 0)}drillDownOnColumn(e){const t=this.dataGraphWrapper.getColumns().find(t=>t.getColumn().code===e.colCode);this.drillDown([t.getFilter()],void 0)}drillDownOnCell(e){const t=this.dataGraphWrapper.getRows().find(t=>t.getRow().code===e.rowCode);let i=a.default.constructor.parseFilters(t.getFilters());const n=this.dataGraphWrapper.getColumns().find(t=>t.getColumn().code===e.colCode);i=i.concat(n.getFilter());const s=t.getCells().find(t=>t.getRow().getCode()===e.rowCode&&t.getColumn().getCode()===e.colCode);i=i.concat(a.default.constructor.parseFilters(s.getCell().filter));const o=s.getRequestedPageType();this.drillDown([i],o)}drillDown(e,t){const i=new c.NavigationParams;i.setWidget(this.fragmentModel.widget),i.setFilters(e),i.setClickTarget(this.fragmentModel.widget.getTemplate()),l.navigationService.clickHandler(i,void 0,t)}async removeColumn(e){const t=e.colCode,i=this.fragmentModel.widget.getExtendedConfiguration(),n=i.getSortingConfig().getSortOnColumnCode();i.addHiddenColumn(e.colCode),await d.customPagesService.saveWidget(tw.pageState.getAllowedPages().getCustomPageType(),{mapped_id:tw.pageState.getAllowedPages().getCustomPageId()},this.fragmentModel.widget),t===n&&this.initSortingConfiguration(!0),this.buildDataTableModel(),this.onUpdate.fire(this.dataTableModel),this.renderIntoContainer(this.onUpdate,this.onDraw,this.drawSettings,void 0),this.fragmentModel.widget.redraw()}async reloadWidget(e){e.setReloading(!0),e.setConfigurationChanged(!0);const t=e.getPageState(),i={strategy:m.ModelRefreshStrategy.REFRESH},n=f.modelRefreshDecoratorFactory.getDecorator(t,t.getApplication(),_.ModelType.PAGE_STATE,i);try{await p.modelRefreshService.refresh(n,i)}catch(e){e instanceof Error&&h.logService.error("Error when reloading data table widget",void 0,e)}}canShowColumn(e){const t=e.getCode();return-1===this.fragmentModel.widget.getExtendedConfiguration().getHiddenColumns().indexOf(t)&&(!e.getColumn().hidable_for_types||-1===e.getColumn().hidable_for_types.indexOf(this.typeString))}getWidgetTypeString(e){switch(e.widget.dic.dic.configuration_rendering.uuid_configuration){case"UUID_CONFIG_DATA_TABLE_FANCY":case"UUID_CONFIG_ISSUE_TRACKER_ITEMS_TABLE":return"fancy_datatable";case"UUID_CONFIG_DATA_TABLE_DEFAULT":return"datatable";default:return""}}formatLabel(e){const t=e.getCell();if(e.getColumn().getColumn().data_type)switch(e.getColumn().getColumn().data_type){case"number":return e.getCell().value&&e.getCell().value.formatted_value?e.getCell().value.formatted_value:g.twNumberFormatter.getInstance().toDecimal(e.getNumericData()||e.getValue());case"text":return u.emojiService.parseTextForEmoji(t.value.formatted_value);case"icon":return t.value.formatted_value;case"datetime":return void 0===e.getNumericData()&&isNaN(e.getValue())?y.contextData.getMessage("_714772"):t.value.formatted_value}return`${e.getValue()}`}createSimplifiedTendency(e){if(e.hasNumericData()&&e.hasOldNumericData()){const t=new r.Tendency(e.getNumericData(),e.getOldNumericData());return{change:t.getValueAbsPercentage(),isPositive:t.isPositive()}}if(e.hasValue()&&e.getOldValue()){const t=new r.Tendency(e.getValue(),e.getOldValue());return{change:t.getValueAbsPercentage(),isPositive:t.isPositive()}}}async showSentimentPopup(e){this.popuphandle&&this.popuphandle.destroy();const{event:t,cell:i}=e.value,n=b.configurationService.getBubbleDialogConfiguration().getStyle("popup"),s=$(t.target);n.setAbsoluteX(s.offset().left+i.xOffset+i.width/2),n.setAbsoluteY(s.offset().top+s.height()/2),this.popuphandle=w.bubbleDialogService.createByType("popup",$(t.target),"bars",i.popupPayload,n)}async hideSentimentPopup(e){this.popuphandle.destroy()}async handleReloadRequest(){await this.fragmentModel.widget.prepareReload(),await this.reloadWidget(this.fragmentModel.widget),this.onUpdate.fire(this.dataTableModel),this.renderIntoContainer(this.onUpdate,this.onDraw,this.drawSettings,void 0)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/table_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/data_table_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[r.DataTableFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/text_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/text_editor_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragment_controllers/text_blueprint_enhancer"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.TextEditorFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},layoutStrategySettings:{minimumChartSize:0},enhancer:r.TextBlueprintEnhancer}}}),define("react_components/report_components/text_box_container",["require","exports","react","report_components","event_bus","services/rest_form_service","services/context","widget_base","services/text","classes/refresh/model_type","services/tw_common","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.TextBoxContainer=class extends a.AbstractFragmentLayer{constructor(e){super(e),this.stylesChanged=!1,this.props.settings.editable&&(this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TEXT_BOX_SAVE,this.handleSaveTextBox.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TEXT_ALIGN,this.changeTextAlign.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.FONT_FAMILY_CHANGED,this.changeFontFamily.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.FONT_SIZE_CHANGED,this.changeFontSize.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.COLOR_CHANGED,this.changeColor.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.FONT_STYLE_CHANGED,this.changeFontStyle.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.FONT_WEIGHT_CHANGED,this.changeFontWeight.bind(this))),this.state={model:this.props.model,settings:this.props.settings}}render(){return i.createElement(n.TextBoxRenderable,{model:this.state.model,settings:this.state.settings})}update(e){const t=e.widget,i=t.isHeadline()?t.getPayloadValue().headline:t.getPayloadValue().text,n=t.isHeadline()?t.getPayloadValue().display_headline:t.getPayloadValue().display_text,s=JSON.parse(JSON.stringify(this.state.model));s.text=i,s.optionalToolbarBlocks=c.textService.buildTextboxModel(t).optionalToolbarBlocks,s.displayText=n,this.setState({model:s})}draw(e){this.setState({})}componentDidMount(){this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TEXT_BOX_FOCUS_CHANGED,this.handleTextBoxFocusChanged.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.SET_WIDGET_EDIT,this.handleSetWidgetEdit.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,this.handleGridItemSelectionChanged.bind(this))}handleSaveTextBox(e){this.state.model.id===e.value.id&&this.saveTextBox(e.value.text)}handleTextBoxFocusChanged(e){e.value.id===this.props.model.id&&(this.props.settings.editable&&(this.updateToolbar(e.value.focused),this.stylesChanged&&!e.value.focused&&this.saveTextBox()),s.eventBus.dispatch({type:s.EVENT_TYPES.SET_WIDGET_EDIT,value:{state:e.value.focused,id:this.props.model.id}}))}handleSetWidgetEdit(e){e.value.id===this.props.model.id&&this.setState({settings:Object.assign({},this.state.settings,{forceFocus:e.value.state})})}handleGridItemSelectionChanged(e){void 0!==e.value.item?e.value.item.getCurrentItemId()===this.props.model.id&&this.props.settings.editable&&this.updateToolbar(!0):this.props.settings.editable&&(this.updateToolbar(!1),this.stylesChanged&&this.saveTextBox())}saveTextBox(e){const t=this.props.widget;void 0!==e&&(t.isHeadline()?t.getPayloadValue().headline=e:t.getPayloadValue().text=e),t.setPayloadValue(t.getPayloadValue());const i={data_input_configuration:t.toProto(),custom_page_id:t.getPageState().getAllowedPages().getCustomPageId(),custom_page_type:t.getPageState().getAllowedPages().getCustomPageType(),id:t.getId()},n=routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"text_widget","update","","rform").url;this.stylesChanged&&(this.stylesChanged=!1),o.restFormService.postMultipart(n,i).then(()=>{t.prepareReload(),this.refreshWidgetData(t)})}updateToolbar(e){this.state.model.optionalToolbarBlocks.forEach(t=>{t.show=e});const t={optionalItemBlocks:this.state.model.optionalToolbarBlocks};s.eventBus.dispatch({type:s.EVENT_TYPES.UPDATE_TOOLBAR,value:t})}changeTextAlign(e){if(this.state.model.id===e.value.sourceId){const t=this.props.widget;this.initPptTextSyleIfAbsent(t),t.getPayloadValue().ppt_text_style.align=e.value.data,this.state.model.styles=Object.assign({},this.state.model.styles,{textAlign:e.value.data}),this.stylesChanged=!0,this.forceUpdate()}}changeFontFamily(e){if(this.state.model.id===e.value.sourceId){const t=this.props.widget;this.initPptTextSyleIfAbsent(t),t.getPayloadValue().ppt_text_style.font_family=e.value.data,this.state.model.styles=Object.assign({},this.state.model.styles,{fontFamily:e.value.data}),this.stylesChanged=!0,this.forceUpdate()}}changeFontSize(e){if(this.state.model.id===e.value.sourceId){const t=this.props.widget;this.initPptTextSyleIfAbsent(t),t.getPayloadValue().ppt_text_style.font_size=Number(e.value.data),this.state.model.styles=Object.assign({},this.state.model.styles,{fontSize:c.textService.computeFontSize(e.value.data,this.props.widget.getPageState().getPageConfiguration().grid)+"px"}),this.stylesChanged=!0,this.forceUpdate()}}changeColor(e){if(this.state.model.id===e.value.sourceId){const t=this.props.widget;this.initPptTextSyleIfAbsent(t),t.getPayloadValue().ppt_text_style.color=e.value.data,this.state.model.styles=Object.assign({},this.state.model.styles,{color:e.value.data}),this.stylesChanged=!0,this.forceUpdate()}}changeFontStyle(e){if(this.state.model.id===e.value.sourceId){const e=this.props.widget;this.initPptTextSyleIfAbsent(e),void 0!==e.getPayloadValue().ppt_text_style.italic&&e.getPayloadValue().ppt_text_style.italic?e.getPayloadValue().ppt_text_style.italic=!1:e.getPayloadValue().ppt_text_style.italic=!0,this.state.model.styles=Object.assign({},this.state.model.styles,{fontStyle:e.getPayloadValue().ppt_text_style.italic?"italic":"normal"}),this.stylesChanged=!0,this.forceUpdate()}}changeFontWeight(e){if(this.state.model.id===e.value.sourceId){const e=this.props.widget;this.initPptTextSyleIfAbsent(e),void 0!==e.getPayloadValue().ppt_text_style.bold&&e.getPayloadValue().ppt_text_style.bold?e.getPayloadValue().ppt_text_style.bold=!1:e.getPayloadValue().ppt_text_style.bold=!0,this.state.model.styles=Object.assign({},this.state.model.styles,{fontWeight:e.getPayloadValue().ppt_text_style.bold?"bold":"normal"}),this.stylesChanged=!0,this.forceUpdate()}}initPptTextSyleIfAbsent(e){void 0===e.getPayloadValue().ppt_text_style&&(e.getPayloadValue().ppt_text_style={})}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:g.ModelRefreshStrategy.REFRESH},i=p.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),l.ModelType.WIDGET,t);try{await u.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&h.logService.error("Error when refreshing widget!",void 0,e)}}else h.logService.error("reload attempted on widget without page state, this could be due to a memory leak",d.twCommon.logFeatures.WidgetWrapper)}}}),define("classes/widget/fragments/directive/text_box_fragment",["require","exports","react-dom","react","widget_base","react_components/report_components/text_box_container","services/text"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.TextBoxFragment=class extends s.AbstractReactFragment{constructor(e){super(e)}renderIntoContainer(e,t){const s=r.textService.buildTextboxModel(this.fragmentModel.widget),a=r.textService.buildTextBoxSettings(this.fragmentModel.widget);i.render(n.createElement(o.TextBoxContainer,{widget:this.fragmentModel.widget,model:s,settings:a,onUpdate:e,onDraw:t}),this.chartContainer)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/text_box_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","services/tw_number_formatter","classes/widget/fragments/directive/text_box_fragment"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[a.TextBoxFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},buildConfigurations:n.defaultBuildConfigurations.extend([{key:a.TextBoxFragment,value:{numberFormatter:r.twNumberFormatter.getCounterNumberFormatter()}}]),noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/theme_cloud_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/color_palette_builder/cloud_color_palette_builder","classes/widget/fragments/canvas_chart/cloud_fragment"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[n.WidgetHeaderFragment,s.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[c.CloudFragment],[i.WidgetLayoutBlockId.FOOTER]:[o.BottomWidgetMenusFragment]},buildConfigurations:r.defaultBuildConfigurations.extend([{key:c.CloudFragment,value:{colorPaletteBuilder:a.CloudColorPaletteBuilder}}]),noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/theme_tree_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/theme_tree_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.ThemeTreeFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]},noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/top_images_blueprint",["require","exports","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/top_images_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[i.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,o.TopWidgetMenusFragment],[i.WidgetLayoutBlockId.BODY]:[n.TopImagesFragment],[i.WidgetLayoutBlockId.FOOTER]:[r.BottomWidgetMenusFragment]}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/top_influencer_overview_blueprint",["require","exports","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/top_influencer_overview_fragment","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[r.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,n.TopWidgetMenusFragment],[r.WidgetLayoutBlockId.BODY]:[o.TopInfluencerOverviewFragment],[r.WidgetLayoutBlockId.FOOTER]:[i.BottomWidgetMenusFragment]},layoutStrategySettings:{minimumChartSize:100},noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/treemap_blueprint",["require","exports","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/treemap_fragment","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[r.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,n.TopWidgetMenusFragment],[r.WidgetLayoutBlockId.BODY]:[o.TreemapFragment],[r.WidgetLayoutBlockId.FOOTER]:[i.BottomWidgetMenusFragment]}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/trends_configurable_blueprint",["require","exports","external_trend_table","log","trends_configurable","other/tw","services/refresh/model_refresh_service","classes/color_palette_builder/cloud_color_palette_builder","classes/context_data/context_data","classes/custom_pages/custom_page_factory","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/widget/fragments/canvas_chart/trend_cloud_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/widget_fragment_factory/widget_blueprints/external_trend_table_blueprint"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0});const v={colorPaletteBuilder:a.CloudColorPaletteBuilder},S={subFragments:{table:{fragment:i.ExternalTrendTableFragment,confiugration:y.EXTERNAL_TREND_TABLE_BUILD_CONFIGURATION},themeCloud:{fragment:p.TrendCloudFragment,confiugration:v}},messages:{labels:{country:c.contextData.getMessage("_441001"),display:c.contextData.getMessage("_441002"),layout:c.contextData.getMessage("_441003"),source:c.contextData.getMessage("_441004"),timeframe:c.contextData.getMessage("_441005"),title:c.contextData.getMessage("_441006"),twitter:c.contextData.getMessage("_441011"),google:c.contextData.getMessage("_441012"),wordCloud:c.contextData.getMessage("_441013"),table:c.contextData.getMessage("_441014"),topTrends:c.contextData.getMessage("_441021"),save:c.contextData.getMessage("_612374"),cancel:c.contextData.getMessage("_691638")}},get displayEditButtons(){return o.tw.pageState.getAllowedPages().isCommandCenterScreenEditMode()},async saveWidget(e){const t=l.CustomPageFactory.getPageFromPageState(o.tw.pageState);await t.saveWidget(e),e.setReloading(!0),e.setConfigurationChanged(!0);const i={strategy:g.ModelRefreshStrategy.REFRESH,force:!0},s=d.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),u.ModelType.WIDGET,i);try{await r.modelRefreshService.refresh(s,i)}catch(e){n.logService.error("Error while saving trends")}}};t.default=function(){return{layout:{[f.WidgetLayoutBlockId.HEADER]:[m.TopWidgetMenusFragment],[f.WidgetLayoutBlockId.BODY]:[s.TrendsConfigurableFragment],[f.WidgetLayoutBlockId.FOOTER]:[h.BottomWidgetMenusFragment]},showEvenIfNoData:!1,buildConfigurations:_.defaultBuildConfigurations.extend([{key:s.TrendsConfigurableFragment,value:S}])}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/trends_table_blueprint",["require","exports","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/trends_table_fragment","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[r.WidgetLayoutBlockId.HEADER]:[s.WidgetHeaderFragment,n.TopWidgetMenusFragment],[r.WidgetLayoutBlockId.BODY]:[o.TrendsTableFragment],[r.WidgetLayoutBlockId.FOOTER]:[i.BottomWidgetMenusFragment]},unmanaged:!0,noMargin:!0}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/vertical_bar_chart_blueprint",["require","exports","canvas_chart_utilities","classes/widget/fragments/canvas_chart/bar_chart_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/result_count_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[g.WidgetLayoutBlockId.HEADER]:[a.WidgetHeaderFragment,r.TopWidgetMenusFragment,c.ReplayDateFragment,o.ResultCountFragment],[g.WidgetLayoutBlockId.BODY]:[n.BarChartFragment,i.LegendFragment],[g.WidgetLayoutBlockId.FOOTER]:[s.BottomWidgetMenusFragment,l.ReplayFragment]},buildConfigurations:d.defaultBuildConfigurations.extend([{key:i.LegendFragment,value:{iconType:i.LegendItemIconType.SQUARE,colorPaletteBuilder:i.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!0,type:i.LegendTypes.LINE}}])}}}),define("react_components/report_components/video_box_container",["require","exports","widget_base","report_components","event_bus","services/text","services/context","other/tw","services/rest_form_service","react","services/configuration","classes/context_data/context_data","services/bubble_dialog","services/video_service","classes/application/application","classes/refresh/model_type","services/tw_common","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0});t.VideoBoxContainer=class extends i.AbstractFragmentLayer{constructor(e){super(e),this.cancellationToken.addCleanupFunction(s.eventBus.subscribe(s.EVENT_TYPES.VIDEO_BOX_SAVE,this.saveVideoBox.bind(this)).unsubscribe),this.state={model:this.props.model,settings:this.props.settings}}componentDidMount(){this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.VIDEO_BOX_EDITABLE_CHANGED,this.handleVideoBoxEditableChanged.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.SET_WIDGET_EDIT,this.handleSetWidgetEdit.bind(this))}render(){return l.createElement(n.VideoBoxRenderable,{model:this.state.model,settings:this.state.settings})}update(e){const t=o.textService.buildVideoBoxModel(e.widget),i=o.textService.buildVideoBoxSettings(e.widget);this.setState({model:t,settings:i})}draw(e){this.setState({})}saveVideoBox(e){if(this.state.model.id===e.value.id){void 0!==this.editBubble&&(this.editBubble.destroy(),this.editBubble=void 0),s.eventBus.dispatch({type:s.EVENT_TYPES.TOGGLE_EDIT_WIDGET,value:{id:this.state.model.id}});const t=a.tw.pageState.getWidgetById(e.value.id);t.getPayloadValue().content_url=e.value.mediaUrl,t.setPayloadValue(t.getPayloadValue());const i={data_input_configuration:t.toProto(),custom_page_id:a.tw.pageState.getAllowedPages().getCustomPageId(),custom_page_type:a.tw.pageState.getAllowedPages().getCustomPageType(),id:e.value.id},n=routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"text_widget","update","","rform").url;c.restFormService.postMultipart(n,i).then(()=>{const t=h.mainApplication.getWidgetById(e.value.id);t.prepareReload(),this.refreshWidgetData(t)})}}handleSetWidgetEdit(e){if(e.value.id===this.props.model.id&&e.value.state){const e=JSON.parse(JSON.stringify(this.state));e.model.saveLabel=g.contextData.getMessage("_612374"),e.model.savingLabel=g.contextData.getMessage("_911337"),e.model.cancelLabel=g.contextData.getMessage("_691638"),e.settings.editable=!0,e.settings.hosts=p.videoService.getHosts(),this.editBubble=u.bubbleDialogService.createReactBubble(constants.bubble_dialog.video_box_edition,$("body"),e,t=>l.createElement(n.VideoBoxRenderable,{model:e.model,settings:e.settings}),d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.video_box_edition),{fadeBackground:!0})}}handleVideoBoxEditableChanged(e){e.value.id===this.props.model.id&&(s.eventBus.dispatch({type:s.EVENT_TYPES.SET_WIDGET_EDIT,value:{state:e.value.editable,id:this.props.model.id}}),void 0!==this.editBubble&&(this.editBubble.destroy(),this.editBubble=void 0))}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:f.ModelRefreshStrategy.REFRESH},i=v.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),m.ModelType.WIDGET,t);try{await y.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&S.logService.error("Error when refreshing widget!",void 0,e)}}else S.logService.error("reload attempted on widget without page state, this could be due to a memory leak",_.twCommon.logFeatures.WidgetWrapper)}}}),define("classes/widget/fragments/directive/video_box_fragment",["require","exports","react-dom","react","widget_base","services/text","react_components/report_components/video_box_container"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.VideoBoxFragment=class extends s.AbstractReactFragment{constructor(e){super(e)}renderIntoContainer(e,t){const s=o.textService.buildVideoBoxModel(this.fragmentModel.widget),a=o.textService.buildVideoBoxSettings(this.fragmentModel.widget);i.render(n.createElement(r.VideoBoxContainer,{model:s,settings:a,onUpdate:e,onDraw:t}),this.chartContainer)}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/video_box_blueprint",["require","exports","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/video_box_fragment","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/widget_layout_block_id"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[r.WidgetLayoutBlockId.HEADER]:[n.TopWidgetMenusFragment],[r.WidgetLayoutBlockId.BODY]:[s.VideoBoxFragment],[r.WidgetLayoutBlockId.FOOTER]:[i.BottomWidgetMenusFragment]},buildConfigurations:o.defaultBuildConfigurations,noMargin:!0,layoutStrategySettings:{minimumChartSize:0}}}}),define("classes/widget/widget_fragment_factory/widget_blueprints/wheel_chart_blueprint",["require","exports","classes/widget/widget_fragment_factory/default_build_configurations","classes/widget/widget_fragment_factory/factory_utilities","canvas_chart_utilities","classes/widget/widget_fragment_factory/widget_layout_block_id","classes/widget/fragments/legacy_directive/replay_date_fragment","classes/widget/fragments/legacy_directive/wheel_chart_fragment","classes/widget/fragments/legacy_directive/replay_fragment","classes/widget/fragments/directive/widget_header_fragment","classes/widget/fragments/directive/top_widget_menus_fragment","classes/widget/fragments/directive/bottom_widget_menus_fragment","classes/widget/fragment_controllers/wheel_chart_widget_blueprint_enhancer"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{layout:{[o.WidgetLayoutBlockId.HEADER]:[l.WidgetHeaderFragment,d.TopWidgetMenusFragment,r.ReplayDateFragment],[o.WidgetLayoutBlockId.BODY]:[a.WheelChartFragment,s.LegendFragment],[o.WidgetLayoutBlockId.FOOTER]:[g.BottomWidgetMenusFragment,c.ReplayFragment]},enhancer:u.WheelChartWidgetBlueprintEnhancer,buildConfigurations:i.defaultBuildConfigurations.extend([{key:s.LegendFragment,value:{numColumns:3,colorPaletteBuilder:s.LegendColorPaletteBuilder,enableItemHover:!0,enableItemSelection:!0,legendType:n.setLineIfReplay}}])}}}),define("components/append",["require","exports","jquery"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"A",link:function(e,t,i){t=$(t);const n=e.$watch(i.ngAppend,function(e){e instanceof jQuery&&0!==e.length?t.appendTo(e):t.detach()});e.$on("$destroy",function(){n()})}}}}),define("components/overlay",["require","exports","jquery","keypress","underscore"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$document","$timeout",function(e,t){return o.$inject=["$element","$scope"],{restrict:"A",scope:{handleBlur:"&onBlur",handleLoad:"&onLoad"},controller:o,link:function(s,o){o=i(o),e=i(e);let r=new n.Listener;const a=function(e){s.handleBlur&&o.is(":visible")&&!o.is(e.target)&&0===o.has(e.target).length&&s.$apply(function(){s.handleBlur({event:e})})},c={keys:"escape",on_release:function(e){s.$apply(function(){s.handleBlur({event:e})})}};t(function(){r.register_combo(c),e.on("click",a)}),s.$on("$destroy",function(){r.reset(),r.destroy(),r=void 0,o.off(),e.off("click",a)})}};function o(e,t){e=i(e),s.isUndefined(t.handleLoad)||t.handleLoad()}}]}),define("components/sortable",["require","exports","underscore","angular","jquery.ui"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{scope:{ngModel:"=",isSortable:"=",uiSortableConfig:"=?",uiSortable:"=",filter:"="},link:function(e,t,s){let o;function r(e,t){return t&&"function"==typeof t?function(i,n){e(i,n),t(i,n)}:e}e.filter&&e.isSortable&&(o=e.$eval("ngModel | "+e.filter));const a={},c={receive:null,start:null,stop:null,update:null},l=function(t,i){(i.item.sortable.resort||i.item.sortable.relocate)&&e.$apply()};e.createdOnce=!1;const d=e.$watch("ngModel",function(t){o=i.isUndefined(e.filter)?e.$eval("ngModel"):e.$eval("ngModel | "+e.filter)},!0),g=e.$watch("isSortable",function(i){i?e.createOnce?$(t).sortable("enable"):(e.uiSortableConfig&&n.extend(a,e.uiSortableConfig),c.start=function(e,t){t.item.sortable={index:t.item.index()}},c.update=function(t,i){i.item.sortable.resort=o||e.ngModel},c.receive=function(e,t){t.item.sortable.relocate=!0},c.stop=function(e,t){if(t.item.sortable.resort){let e,i;i=t.item.sortable.index,e=t.item.index();const n=$(t.item[0]).attr("section-id"),s=$(t.item[0]).parent().attr("section-id");t.item.sortable.startSection=n,t.item.sortable.endSection=s;for(let e=0;e<t.item.sortable.resort.length;e++)if(t.item.sortable.resort[e].section_id===n){i+=e;break}for(let i=0;i<t.item.sortable.resort.length;i++)if(t.item.sortable.resort[i].section_id===s){e+=i;break}t.item.sortable.resort.splice(e,0,t.item.sortable.resort.splice(i,1)[0])}},n.forEach(c,function(e,t){a[t]=r(e,a[t])}),a.stop=r(a.stop,l),$(t).sortable(a),e.uiSortable&&n.forEach(e.uiSortable,function(e,i){c[i]&&(e=r(c[i],e),"stop"===i&&(e=r(e,l))),$(t).sortable("option",i,e)}),e.createOnce=!0):e.createOnce&&$(t).sortable("disable")},!0);e.$on("$destroy",function(){d(),g()})}}}}),define("components/visible",["require","exports","reusable_utilities","jquery","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return{replace:!1,restrict:"A",scope:!0,link:function(t,n,s){const o=$(window),r=new i.CancellationToken,a=e=>{if(!e)return!1;const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},c=()=>{a(n.get(0))&&t.$apply(()=>{t.$eval(s.ngVisible)})},l=e(()=>{r.addDomEvent(o,"scroll",c)},500);r.addCleanupFunction(()=>e.cancel(l));const d=e(()=>{a(n.get(0))&&t.$eval(s.ngVisible)},500);r.addCleanupFunction(()=>e.cancel(d)),t.$on("$destroy",()=>{r.cancel()})}}}]}),define("components/access_rights/project/directive",["require","exports","classes/access_rights/user/page/user_access_rights_page","classes/access_rights/user/page/access_rights_entry","reusable_utilities","classes/access_rights/user/page/access_rights_option","classes/access_rights/user/project/project_user_access_rights","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",bindToController:{projectAccessLevels:"=",disable:"=?",fieldMessages:"="},scope:{},controller:l,controllerAs:"vm",templateUrl:c.templateSourceFactory("components/access_rights/project")}},t.PAGE_TITLES={ANALYTICS:"_871760",DASHBOARD:"_940342",REPORT:"_653333",IQ_APPS:"_795065",SETTINGS:"_656929",COMMAND_CENTER:"_804169"};class l{constructor(e){this.$scope=e}$onInit(){this.onOffType="yes_no",this.initialize()}initialize(){this.projectsUserAccessRights=this.projectAccessLevels.map(e=>{const t=this.buildProjectPages(e);return new r.ProjectUserAccessRights(e.project_title,e.project_access_level,t)})}buildProjectPages(e){const i=[];return this.buildGeneralPagePermission(a.contextData.getMessage(t.PAGE_TITLES.ANALYTICS),e.analytics_permissions,i),this.buildPagePermissionsWithOptions(a.contextData.getMessage(t.PAGE_TITLES.DASHBOARD),e.dashboard_permissions,e.dashboard_options,i),this.buildPagePermissions(a.contextData.getMessage(t.PAGE_TITLES.REPORT),e.report_permissions,i),this.buildPagePermissionsWithOptions(a.contextData.getMessage(t.PAGE_TITLES.IQ_APPS),e.dash_template_category_permissions,e.dash_template_options,i),this.buildPagePermissions(a.contextData.getMessage(t.PAGE_TITLES.SETTINGS),e.settings_permissions,i),this.buildPagePermissions(a.contextData.getMessage(t.PAGE_TITLES.COMMAND_CENTER),e.command_center_permissions,i),i}buildPagePermissions(e,t,s){const o=t.root_entry.children.map(e=>new n.AccessRightsEntry(e));s.push(new i.UserAccessRightsPage(e,o))}buildPagePermissionsWithOptions(e,t,r,a){const c=t.root_entry.children.map(e=>{const t=s.TopicMenuUtils.getEntryByMappedId(r,e.mapped_id).children.map((e,t)=>new o.AccessRightsOption(e));return new n.AccessRightsEntry(e,t)});a.push(new i.UserAccessRightsPage(e,c))}buildGeneralPagePermission(e,t,s){s.push(new i.UserAccessRightsPage(e,[new n.AccessRightsEntry(t.root_entry)]))}}l.$inject=["$scope"],t.ProjectAccessRightsController=l}),define("components/activity/directive",["require","exports","angular","d3","lazy","components/tools/data_graph","data_structures","services/template_source","services/navigation","services/bubble_dialog","services/configuration"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g=Object.freeze({margins:Object.freeze({top:20,right:1,bottom:30,left:60,inner_left:10}),bubbleRadius:Object.freeze({max:12.5,min:7.5}),colors:["#CCDFE8","#66A0B9","#3281A1","#00618A"],rowNames:[window.messages.get("_255523"),window.messages.get("_772693"),window.messages.get("_723051"),window.messages.get("_401988"),window.messages.get("_300549"),window.messages.get("_272164"),window.messages.get("_852131")]}),u=4;t.default=[function(){t.$inject=["$element","$scope","$timeout"];const e=s.range(24).invoke("toString").value();return{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:t,templateUrl:a.templateSourceFactory("components/activity")};function t(t,a,f){a.redrawWidget=S,a.fragment.attach(a,t),a.mediator.listen("REPLAY_PROGRESS",function(){a.currentReplayStep!==a.widget.replayManager.frameIndex&&(a.currentReplayStep=a.widget.replayManager.frameIndex,S(a.drawSettings))}),Object.defineProperty(a,"dic",{get:function(){return a.widget.getDic()}}),Object.defineProperty(a,"id",{get:function(){return a.dic.widget_id}});let y=0,v=0;function S(S){const b=a.widget.getPayloadValue();let w=new o.default(b.data_graph);w=!a.init&&a.widget.hasReplayManager()?new o.default(b.data_graph.additional_frames[a.widget.replayManager.frameIndex]):new o.default(b.data_graph),a.isSampleData=w.sample_data||!1;const C=new function(e){const t=this;return t.getLimits=function(){if(i.isUndefined(t.limits)){const e=n.extent(s(o()).flatten().pluck("z").value());t.limits={zmin:e[0],zmax:e[1]}}return t.limits},t.getBubblesTable=o,t;function o(){let n;return i.isUndefined(t.data)&&(n=e.getColumns(),t.data=e.payloadDataGraph.rows.map(function(e,t){return e.cells.map(function(i,s){let o,r;isNaN(i.value.value)?(o=0,r="n/a"):(o=parseFloat(i.value.value),r=i.value.value);return{x:n[s].name,y:e.label,z:o,tooltip:r,indices:new _(t,s)}})})),t.data}}(w),E=C.getLimits(),T=t.find(".xaxis")[0],M=t.find(".yaxis")[0],P=t.find(".ygrid")[0],D=S.dimensions.width,A=S.dimensions.height,I=g.colors[0],x={};x.top=g.margins.top,x.bottom=A-g.margins.bottom,x.left=g.margins.left,x.right=D-g.margins.right,x.height=x.bottom-x.top,x.width=x.right-x.left,x.hmiddle=x.left+x.width/2,x.vmiddle=x.top+x.height/2;const R={};R.x=R.y=n.scale.ordinal,R.z=n.scale.linear;const F={};F.x=R.x().domain(e).rangeBands([x.left,x.right]),F.y=R.y().domain(g.rowNames).rangeBands([x.top,x.bottom]),F.z=R.z().domain([E.zmin,E.zmax]).range([g.bubbleRadius.min,g.bubbleRadius.max]),F.color=n.scale.quantize().domain([E.zmin,E.zmax]).range(g.colors.slice(1));const O=n.svg.axis().scale(F.x).orient("bottom"),k=n.svg.axis().scale(F.y).orient("left").tickFormat(function(e){return e.substring(0,3).toUpperCase()});n.select(P).attr("transform","translate("+x.right+",0)").call(n.svg.axis().scale(F.y).orient("left").tickSize(x.width,0).tickFormat("")),n.select(T).attr("transform","translate(0,"+x.bottom+")").call(O),n.select(M).attr("transform","translate("+(x.left-g.margins.inner_left)+",0)").call(k),a.svg={width:D,height:A},a.nodes=[];const N=C.getBubblesTable(),L=function(e){const t=e.payloadDataGraph;return t.total_label?t.total_label:window.messages.get("_281677")}(w);return i.forEach(g.rowNames||[],function(t,s){i.forEach(e||[],function(e,i){let o;const c=N[s][i],l=F.x(e)+F.x.rangeBand()/2,d=F.y(t)+F.y.rangeBand()/2;if(s>=N.length||i>=N[s].length)o=new p(l,d,c.tooltip,new h(new _(s,i),L));else{const e=new h(c.indices,L,c.x,c.y,function(e,t){if(Math.abs(e)>0&&Math.abs(e)<1)return e.toFixed(t||1);const i=n.formatPrefix(e);return parseFloat(i.scale(e).toFixed(t||1))+i.symbol}(c.z),new r.Tendency(c.z,c.valueOld).build()),t=new m(c.z?F.z(c.z):u,c.z?F.color(c.z):I);o=new p(l,d,c.tooltip,e,t)}a.nodes.push(o)})}),function(){y===S.dimensions.width&&v===S.dimensions.height||t.find(".canvas.chart > .nodes").html("");const e=n.select(t.find(".canvas.chart > .nodes").get(0)).selectAll("circle.bubble").data(a.nodes);y=S.dimensions.width,v=S.dimensions.height;const i=a.widget.hasReplayManager()&&0!==a.widget.replayManager.progress?a.widget.replayManager.duration/(a.widget.replayManager.numberOfSteps-1):a.drawSettings.animationDuration;e.enter().append("circle").each(function(e){n.select(this).classed({bubble:!0,clickable:a.widget.isClickable()}).attr({r:0,cx:e.x,cy:e.y,fill:e.bubble.fill,"stroke-opacity":0,"stroke-width":0,stroke:e.bubble.fill})}),e.each(function(e){const t=n.select(this);t.on({mouseenter:function(){t.transition().duration(200).attr({r:e.bubble.r+5,"stroke-opacity":.4,"stroke-width":10}),a.popoverWidget=l.bubbleDialogService.createByType(constants.bubble_dialog.id.activity,this,"activity",e,d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.activity))},mouseleave:function(){t.transition().duration(200).attr({r:e.bubble.r,"stroke-opacity":0,"stroke-width":0}),l.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.activity,500)},click:function(){window.isExport||a.widget.isClickable()&&c.navigationService.datagraphClick(w,a.widget,e.data.data_graph.rowIdx,e.data.data_graph.colIdx,this)}}).transition().duration(i).attr({r:e.bubble.r,fill:e.bubble.fill,stroke:e.bubble.fill})}),e.exit().each(function(){n.select(this).transition().duration(S.animationDuration).attr({r:0,"stroke-opacity":0,"stroke-width":0}).remove()})}(),new Promise(function(e){f(function(){e()},S.animationDuration)})}}function p(e,t,i,n,s){this.x=e,this.y=t,this.tooltip=i,this.data=n,this.bubble=s||new m}function h(t,i,n,s,o,r){this.data_graph=t,this.results_label=i,this.x=n||e[t.colIdx],this.y=s||g.rowNames[t.rowIdx],this.z=o||0,this.value_change=r}function m(e,t){this.r=e||5,this.fill=t||"lightgray"}function _(e,t){this.rowIdx=e,this.colIdx=t}}]}),define("components/activity/popup/directive",["require","exports","d3","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/activity/popup"),compile:function(){return{pre:s,post:o}}};function t(e,t){e.format=function(e){return isFinite(e)?i.format(",")(e):e},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)}}function s(e,t){t.css({opacity:"0"})}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/allowed_pages/directive",["require","exports","underscore","services/template_source","services/navigation"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"E",scope:{pages:"=",validationForm:"@?"},controller:e,templateUrl:n.templateSourceFactory("components/allowed_pages")};function e(e){e.select=function(t){s.navigationService.moveToDisplayPage(t,e.validationForm)};let t=[];e.getPages=function(){return void 0!==e.pages?(i.isEqual(t,e.pages.getRootEntry().getChildren())||(t=e.pages.getRootEntry().getChildren()),t):void 0}}}]}),define("components/animated_label/directive",["require","exports","canvas_engine","log"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",scope:{start:"=",end:"=?",duration:"=?",ready:"=",onStep:"&?",onDone:"&?"},controller:["$scope","$element",function(e,t){const s=[];function o(e){t.get(0).innerHTML=e}e.initialize=(t=>{t=t||e.end,e.target={_value:e.start},void 0===e.animationComponent&&(e.animationComponent=new i.AnimationComponent,e.animationComponent.attach(e)),e.sequence=e.animationComponent.tween(e.target,{key:"_value",value:parseFloat(t),duration:e.duration||0}),e.play()}),e.play=function(){if(void 0===e.animationComponent||void 0===e.sequence)return void n.logService.warn("Animation component not setup or sequence undefined!");s.forEach(e=>e.cancel()),s.length=0;const t=e.sequence.getAnimations()[0],i=e.onStep&&e.onStep(),r=e.onDone&&e.onDone();s.push(t.onAnimationStep.subscribe(()=>{o(void 0!==i?i(e.target._value):e.target._value)})),s.push(t.onDone.subscribe(()=>{if(e.animationComponent.destroyAll(),void 0!==r){o(r(e.target._value))}})),e.animationComponent.play(e.sequence)},e.ready.subscribe(t=>{e.initialize(t)}),void 0!==e.end&&e.initialize(e.end),e.$on("$destroy",()=>{void 0!==e.animationComponent&&e.animationComponent.dispose()})}]}}]}),define("components/autofocus/directive",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"A",link:(e,t,i)=>{if(!0===e.$eval(i.twAutofocus)){const i=t[0];e.$emit("focus",i),i.focus()}}}}}),define("components/bars/popup/directive",["require","exports","reusable_services","underscore","services/template_source","services/tw_common"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout","twNumberFormatter",function(e,t){return r.$inject=["$scope","$document","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:r,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/bars/popup"),compile:function(){return{pre:a,post:c}}};function r(e,s,r){function a(t){o.twCommon.isPointOnElement({x:t.clientX,y:t.clientY},r)||e.facade.destroy()}e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)},e.parseTextForEmoji=function(e){return!n.isUndefined(e)&&e.length>0?i.emojiService.parseTextForEmoji(e):""},s.on("mousedown",a),e.$on("$destroy",function(){s.off("mousedown",a)}),e.getClassObject=function(){return e.classes||(e.classes={"popover-content__chart-data":e.hasPayloadCorner(),"popover-content_chart-data-no-space":!e.hasPayloadCorner(),"popover-content_chart-data-center":e.payload.centerData,"popover-content__left":e.hasPayloadComments()}),e.classes},e.hasPayloadCorner=function(){return!n.isUndefined(e.payload.corner)},e.hasPayloadComments=function(){return!n.isUndefined(e.payload.commentInfo)},e.getPayloadComments=function(){return e.payload.commentInfo},e.formatTendencyValue=function(e){return void 0!==e&&void 0!==e.value_abs_percentage?t.getInstance().toPercentage(e.value_abs_percentage):""},e.getTruncatedLabel=function(e){return e&&e.toString().length>56?e.toString().substring(0,56)+"...":e}}function a(e,t){t.css({opacity:"0"})}function c(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bars/sentiment_popup/directive",["require","exports","d3","reusable_services","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/bars/sentiment_popup"),compile:function(){return{post:o}}};function t(e){e.format=function(e){return isFinite(e)?i.format(",")(e):e},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)},e.parseTextForEmoji=function(e){return!_.isUndefined(e)&&e.length>0?n.emojiService.parseTextForEmoji(e):""}}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/breadcrumb/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","TopicMenuWrapper"],{replace:!0,restrict:"A",transclude:!0,scope:{breadcrumbModel:"=breadcrumb"},controller:e,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/breadcrumb")};function e(e,t){const n=e.$watch(function(){return e.breadcrumbModel},function(e,t){s()});function s(){i.isFunction(e.breadcrumbModel.toProto)?e.breadcrumb=e.breadcrumbModel:e.breadcrumb=new t(e.breadcrumbModel)}s(),e.hasIcon=function(){return e.breadcrumb&&void 0!==e.breadcrumb.getRootEntry().getMappedId()},e.getIcon=function(){return e.breadcrumb.getRootEntry().getMappedId()},e.getColorStyleClass=function(e){const t=tw.pageState.getAllowedPages();return t.isDashboardTemplate()||t.isSearchAdvanced()||t.isSearch()?e.getMappedId()+"__icon":""},e.getIconStyles=function(){return{backgroundColor:e.breadcrumb.getRootEntry().getColor()}},e.$on("$destroy",function(){n()})}}]}),define("services/sma_service",["require","exports","underscore","other/tw","wrappers/topic_menu/topic_menu_wrapper","services/commons","services/rest_form_service","notifications","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{sharePageCallBack(e,t,n,o){const r=new s.TopicMenuWrapper(e.projects.root_entry).getFirstSelectedEntryRecursively(),a=void 0!==r?r.getMappedId():void 0;if(a){t.social_media_pages=i(t.social_media_pages).without(i(t.social_media_pages).findWhere({id:n.id}));const e=i(o).findWhere({id:a});let s=i(e.social_media_accounts).findWhere({id:t.id});void 0===s&&((s=JSON.parse(JSON.stringify(t))).social_media_pages=[],e.social_media_accounts.push(s)),s.social_media_pages.push(n)}}extractProtocol(e){return 0===e.indexOf("https")?"https":0===e.indexOf("http")?"http":void 0}async connectExternalAccount(e,t,i,n){const s={client_name:constants.social_media_accounts[e].client_name,source:i?"project":"none",source_id:i||"none",type:t,user_id:n,protocol:this.extractProtocol(window.location.protocol)},l=routes.controllers.tw.TWRestForm.post(s.source,s.source_id,"external_authentication","new","","settings").url;return r.restFormService.post(l,s).then(e=>{const t=window.open(e.url,`${e.client_name}- connection`,"width=800,height=600");o.commons.checkPopupBlocked(t)&&a.notificationService.success(c.contextData.getMessage("_817156"),{permanent:!0})})}},Object.defineProperty(t,"smaService",{get:function(){return n.tw.inject("smaService")}})}),define("components/bubble_dialog/account_details/directive",["require","exports","angular","reusable_utilities","angular_utilities","jquery","services/tw_common","services/template_source","services/sma_service"],function(e,t,i,n,s,o,r,a,c){function l(){return{templateUrl:a.templateSourceFactory("components/bubble_dialog/account_details"),replace:!0,restrict:"AE",scope:{referenceElement:"=",styleInformation:"="},compile:g,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:d}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=l,t.AccountDetailsDialogDirective=l;let d=class{constructor(e,t,i,n){this.$scope=e,this.$element=t,this.$rootScope=i,this.smaService=n}$onInit(){this.saving=!1,this.cancellationToken=new n.CancellationToken,this.initSubscriptions(),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}cancel(){this.facade.destroy()}async save(){this.saving=!1,this.applyScope()}canSave(){return!1}updateToken(){this.smaService.connectExternalAccount(this.payload.site_code,"SMA",this.payload.projectId,this.payload.userId)}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}handleClick(e){this.protectFromClosing||r.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.cancel(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(r.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.addDomEvent(o(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(o(document),"mousedown",e=>this.handleMouseDown(e))}};function g(){return{post(e,t){setTimeout(()=>{e.styleInformation.setAbsoluteY(window.innerHeight/2-t.height()/2),e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}d=__decorate([s.ngInject(["$scope","$element","$rootScope","smaService"]),__metadata("design:paramtypes",[Object,Object,Object,c.default])],d)}),define("components/bubble_dialog/alert/directive",["require","exports","classes/context_data/context_data","services/template_source","services/tw_common"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","bubbleDialogService","$element","restFormService"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/alert"),compile:function(){return{pre:o,post:r}}};function t(e,t,n){function o(t){t.keyCode===s.twCommon.keys.ESCAPE&&e.close()}e.loaded=!1,e.isLoaded=function(){return e.loaded},e.close=function(){t.destroyAllNonPersistent()},e.getTitle=function(){return i.contextData.getMessage("_895419")},e.getHelpLink=function(){return i.contextData.getLink("ACADEMY_SUBSCRIBE_ALERT")};let r=!0;function a(e){r=!$.contains(n[0],e.target)&&n[0]!==e.target}function c(t){r&&!s.twCommon.isPointOnElement({x:t.clientX,y:t.clientY},n)&&e.close()}$(document).on("keydown",o),$(document).on("mouseup",c),$(document).on("mousedown",a),e.$on("$destroy",function(){$(document).off("mouseup",c),$(document).off("mousedown",a),$(document).off("keydown",o)})}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/colored_message/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/colored_message"),compile:function(){return{pre:s,post:o}}};function t(e,t){e.cancelDestruction=function(){e.payload.dispose&&e.facade.cancelDestruction()},e.destroy=function(){e.payload.dispose&&e.facade.scheduleDestruction(100)},i.isUndefined(e.payload.buttons)||e.payload.buttons.reverse(),e.isPrimary=function(e){return i.isFunction(e.isPrimary)&&e.isPrimary()},e.call=function(t,i){t.call(e,i)},e.close=function(){e.facade.destroy()}}function s(e,t){t.css({opacity:"0"})}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/comment_marker/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,templateUrl:n.templateSourceFactory("components/bubble_dialog/comment_marker"),compile:function(){return{pre:s,post:o}}};function t(e,t){e.cancelDestruction=function(){e.payload.dispose&&e.facade.cancelDestruction()},e.destroy=function(){e.payload.dispose&&e.facade.scheduleDestruction(100)},e.getClickAction=function(){return e.payload.clickAction},e.hasClickAction=function(){return void 0!==e.getClickAction()},e.getHoverAction=function(){return e.payload.hoverAction},e.hasHoverAction=function(){return void 0!==e.getHoverAction()},e.onClick=function(){return e.hasClickAction()?e.getClickAction():i.noop},e.doHover=function(){e.hasHoverAction()&&e.getHoverAction()(t.get(0))},e.$on("$destroy",function(){void 0!==e.subscription&&e.subscription.cancel()})}function s(e,t){t.css({opacity:"0"})}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i),void 0!==t.subscription&&t.subscription.cancel(),t.subscription=t.facade.onElementUpdate.subscribe(function(){t.styleInformation.apply(t.referenceElement,i)})},0,!1)}}]}),define("components/bubble_dialog/confirmation/directive",["require","exports","angular_utilities","services/template_source"],function(e,t,i,n){function s(e){return{replace:!0,restrict:"AE",bindToController:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controllerAs:"vm",controller:o,templateUrl:n.templateSourceFactory("components/bubble_dialog/confirmation"),scope:{},compile:function(){return{pre:t,post:i}}};function t(e,t){t.css({opacity:"0"})}function i(t,i){e(()=>{t.vm.styleInformation.setAbsoluteY(window.innerHeight/2-i.height()/2),t.vm.styleInformation.apply(t.vm.referenceElement,i)},0,!1)}}Object.defineProperty(t,"__esModule",{value:!0}),s.$inject=["$timeout"],t.default=s,t.ConfirmationBubbleDialogDirective=s;let o=class{constructor(e){this.$sce=e}ok(){this.facade.onMessage.fire(!0)}cancel(){this.facade.onMessage.fire(!1)}getTrustedMessage(e){return this.$sce.trustAsHtml(e)}};o=__decorate([i.ngInject(["$sce"]),__metadata("design:paramtypes",[Object])],o),t.ConfirmationBubbleDialogController=o}),define("components/bubble_dialog/drop_down_menu/directive",["require","exports","services/template_source","services/tw_common","classes/application/application","classes/application/bubble_application","canvas_engine","wrappers/page_state/page_state_request_wrapper"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,templateUrl:i.templateSourceFactory("components/bubble_dialog/drop_down_menu"),compile:function(){return{pre:c,post:l}}};function t(e,t){if(r.logService.assertDefined(e.referenceElement,n.twCommon.logFeatures.BubbleDialog),r.logService.debug("Bubble created",n.twCommon.logFeatures.BubbleDialog,e),void 0!==e.payload.groupPage&&void 0!==e.payload.pageType){const t=new a.PageStateRequestWrapper(s.mainApplication.getPageState(),void 0,{refreshAll:e.payload.refreshAll}),i=new o.BubbleApplication(void 0);t.setGroupPage(e.payload.groupPage),t.setPageType(e.payload.pageType),t.requestPageState(i).then(e.payload.handleRequest.bind(e))}function i(t){t.keyCode===n.twCommon.keys.ESCAPE&&e.close()}e.call=function(t,i){!0===t.call(e,i)&&e.close()},e.close=function(){e.facade.destroy()},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)};let c=!0;function l(e){c=!$.contains(t[0],e.target)&&t[0]!==e.target}function d(i){c&&!n.twCommon.isPointOnElement({x:i.clientX,y:i.clientY},t)&&e.close()}function g(){$(document).off("mouseup",d),$(document).off("mousedown",l),$(document).off("keydown",i)}$(document).on("keydown",i),$(document).on("mouseup",d),$(document).on("mousedown",l),e.$on("$destroy",g),t.on("$destroy",g)}function c(e,t){t.css({opacity:"0"})}function l(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/edit_topic/directive",["require","exports","angular","reusable_utilities","angular_utilities","jquery","services/tw_common","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{templateUrl:a.templateSourceFactory("components/bubble_dialog/edit_topic"),replace:!0,restrict:"AE",scope:{referenceElement:"=",styleInformation:"="},compile:d,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:l}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.EditTopicDialogDirective=c;let l=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.onCancel=this.cancel.bind(this),this.onSave=this.cancel.bind(this)}$onInit(){this.saving=!1,this.cancellationToken=new n.CancellationToken,this.initSubscriptions(),window.tw.project_id=this.payload.projectId,this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}cancel(){this.facade.destroy()}handleClick(e){this.protectFromClosing||r.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.cancel(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(r.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.addDomEvent(o(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(o(document),"mousedown",e=>this.handleMouseDown(e))}};function d(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t)},0)}}}l=__decorate([s.ngInject(["$scope","$element","$rootScope","smaService"]),__metadata("design:paramtypes",[Object,Object,Object])],l)}),define("components/bubble_dialog/entry/directive",["require","exports","underscore","services/template_source","wrappers/page_state/page_state_request_wrapper"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/entry"),compile:function(){return{pre:o,post:r}}};function t(e){e.pageState="",e.cancelDestruction=function(){e.payload.dispose&&e.facade.cancelDestruction()},e.destroy=function(){e.payload.dispose&&e.facade.scheduleDestruction(100)},i.isUndefined(e.payload.buttons)||e.payload.buttons.reverse(),e.isPrimary=function(e){return i.isFunction(e.isPrimary)&&e.isPrimary()},e.call=function(t,i){t.call(e,i)},e.close=function(){e.facade.destroy()};!function(){const t=e.payload.widget.getPageState().clone(),i=e.payload.entry,n=t.getUserFilterSettings();n.applyDatagraphQueryFilter(["url:"+i.attributes.entry_id]);let o=new s.PageStateRequestWrapper(t,void 0,{refreshAll:e.payload.refreshAll});o.setGroupPage("CONTEXT_MENU"),o.setUfs(n),o.requestPageState(e.application).then(function(t){e.pageState=t,o.dispose(),o=void 0})}()}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("react_components/menu/topic_menu_select_component_strategies/restform_post_menu_strategy",["require","exports","services/rest_form_service","event_bus"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.RestformPostMenuStrategy=class{constructor(e,t,i){this.menuWrapper=e,this.formParams=t,this.id=i}onSelect(e,t,s){return new Promise((e,o)=>{this.menuWrapper.selectEntryByMappedId(t.mapped_id,void 0!==s?s.mapped_id:void 0),i.restFormService.post(this.formParams.url,this.formParams.payload).then(t=>{n.eventBus.dispatch({type:n.EVENT_TYPES.RESTFORM_POST_MENU_STRATEGY_CLICK,value:{formEntry:t,id:this.id}}),e(this.menuWrapper.toModel())})})}onMouseEnter(e){return new Promise((t,i)=>{t({openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0})})}isActionsDisabled(){return!1}}}),define("react_components/menu/topic_menu_select_container",["require","exports","event_bus","flux","react","reusable_components"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuSelectContainer=class extends n.BaseComponent{constructor(e){super(e),this.state={topicMenu:e.topicMenu.toModel()}}componentDidMount(){this.cancellationToken.subscribe(o.TopicMenuSelectStore.getInstance().onChange,e=>{this.props.topicMenu.isDisposed()||(e.newPageState?this.setState({topicMenu:this.props.topicMenu.toProto()}):(e.topicMenu&&e.topicMenu===this.props.topicMenu&&this.setState({topicMenu:e.topicMenu.toModel()}),(e.changedEntry||e.openPath)&&i.eventBus.dispatch({type:i.EVENT_TYPES.UPDATE_DROPDOWN_MENU_ENTRY,value:e})))})}render(){const{styleModel:e,concatSelectionLabel:t,allowMultiSelection:i,updateSelectionLabelOnClose:n=!1,title:r,concatAllNode:a,menuStrategy:c,renderable:l,iconMap:d,dropdownClassName:g,openOnHover:u}=this.props,{topicMenu:p}=this.state;return s.createElement(o.TopicMenuSelect,{topicMenu:p,styleModel:e,title:r,concatSelectionLabel:t,allowMultiSelection:i,concatAllNode:a,updateSelectionLabelOnClose:n,menuStrategy:c,renderable:l,iconMap:d,dropdownClassName:g,openOnHover:u})}}}),define("react_components/topic_navbar/topic_navbar_container",["require","exports","event_bus","flux","log","multiple_topic_navbar","notifications","react","reusable_utilities","underscore","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","services/bubble_dialog","services/configuration","services/modal","services/navigation","services/quick_search","services/refresh/model_refresh_service","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","classes/refresh/model_state","react_components/menu/topic_menu_select_component_strategies/export_module_report_menu_strategy","react_components/menu/topic_menu_select_container"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P){Object.defineProperty(t,"__esModule",{value:!0});t.TopicNavbarContainer=class extends n.BaseComponent{constructor(e){super(e),this.maxItems=5,this.placeholderMappedId="0",this.dataFromHistory=!1,this.initialize()}shouldComponentUpdate(){return!this.state.preventRender}async initialize(){this.state={preventRender:!1},await Promise.all(S.quickSearchService.getComparedItems().map(e=>S.quickSearchService.getTopicInformation({mapped_id:e.mapped_id}))),void 0!==S.quickSearchService.getSelectedCategory()&&await S.quickSearchService.getCategoryInfo({mapped_id:S.quickSearchService.getSelectedCategory().getMappedId()}),this.forceUpdate()}componentDidMount(){const e=this.cancellationToken;e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_EDITING,this.toggleItemEditing.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_SAVE_SEARCH,this.saveSearch.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_EXPORT,this.exportToAnalytics.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_MODIFY_ITEM,this.editItemWithModal.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_UPDATE_QUERY,this.setItemQuery.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_DELETE_ITEM,this.deleteItem.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_SHOW_FILTERS,this.showFilters.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_ITEM_MUTE,this.toggleItemMute.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_INVALID_QUERY,this.showInvalidQueryNotification.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_DISABLED_CLICK,this.onDisabledItemClick.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_NEW_SEARCH_QUERY,this.setItemQueryNewSearch.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_APPLY_FILTER_AS_TOPIC,this.applyFilterAsTopic.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_CATEGORY,e=>{this.dataFromHistory=!0,this.selectCategoryFromQSMenu(e)}),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.QUICKSEARCH_DELETE_SAVED_ITEM,e=>{this.deleteSavedSearch(e)}),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_ITEM,e=>{this.dataFromHistory=!0,this.selectItemFromQSMenu(e)}),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,this.unselectAll.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_OTHERS,this.unselectOthers.bind(this)),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_CLEAR_SEARCH,()=>{S.quickSearchService.getTopicsMenuFromUFS().unselectAll(),this.forceUpdate()}),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.TOPIC_NAVBAR_RERENDER,()=>{this.forceUpdateIfAllowed()})}determineRenderPreventionState(e){const t=e||S.quickSearchService.getComparedItems();this.setState({preventRender:0===t.length})}allowRendering(){this.setState({preventRender:!1})}preventRendering(){this.setState({preventRender:!0})}forceUpdateIfAllowed(){this.state.preventRender||this.forceUpdate()}async selectCategoryFromQSMenu(e){const{mappedId:t,title:i}=e.value;if(t){const e={mapped_id:t};0===S.quickSearchService.getComparedItems().length?this.placeholderTitle=i:this.placeholderTitle=void 0,this.forceUpdateIfAllowed(),this.determineRenderPreventionState(),await S.quickSearchService.selectCategory(e),this.forceUpdateIfAllowed(),await this.refreshPage(T.ModelState.PARTIAL),await this.refreshPage(T.ModelState.FULL),this.placeholderTitle=void 0,this.allowRendering(),this.forceUpdate()}}async refreshPage(e){const t={strategy:p.ModelRefreshStrategy.REFRESH,modelState:e},i=u.modelRefreshDecoratorFactory.getDecorator(d.mainApplication.getPageState(),d.mainApplication,h.ModelType.PAGE_STATE,t);try{await b.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}async deleteSavedSearch(e){const{form:t,id:i}=e.value;await S.quickSearchService.deleteSavedSearch(t,i),this.forceUpdate()}async selectItemFromQSMenu(e){const{mappedId:t,title:i}=e.value;if(t){const e={mapped_id:t};0===S.quickSearchService.getComparedItems().length?this.placeholderTitle=i:this.placeholderTitle=void 0,this.forceUpdateIfAllowed(),this.determineRenderPreventionState(),await S.quickSearchService.selectItem(e),await S.quickSearchService.getTopicInformation(e),this.forceUpdateIfAllowed(),await this.refreshPage(T.ModelState.PARTIAL),await this.refreshPage(T.ModelState.FULL),this.placeholderTitle=void 0,this.allowRendering(),this.forceUpdate()}}async unselectAll(){S.quickSearchService.getTopicsMenuFromUFS().unselectAll(),this.determineRenderPreventionState([]),await this.refreshPage(T.ModelState.FULL),this.allowRendering(),this.forceUpdate()}async unselectOthers(e){const t=e.value;t&&(S.quickSearchService.getTopicsMenuFromUFS().unselectAllAndSelectByMappedId(t),this.forceUpdate(),this.refreshPage(T.ModelState.FULL))}async updateItem(e){await S.quickSearchService.updateSearchItem(e),this.setState({editedItemId:void 0}),await this.refreshPage(T.ModelState.FULL)}async deleteItem(e){if(1===S.quickSearchService.getComparedItems().length)this.unselectAll();else{const t=e.value;await S.quickSearchService.deleteItem(t),this.forceUpdate(),this.refreshPage(T.ModelState.FULL)}}async showFilters(e){const t=e.value.mapped_id,i=e.value.selector,n=e.value.editable,s=await S.quickSearchService.getTopicInformation({mapped_id:t});this.createFilterBubbleDialog(s,i,n)}onDisabledItemClick(e){const{disabled:t}=e.value;t&&v.navigationService.goToTrial(!0,"&cta=2")}async toggleItemMute(e){const t=e.value;t&&(await S.quickSearchService.toggleItemMute({mapped_id:t}),this.forceUpdate(),this.refreshPage(T.ModelState.FULL))}async applyFilterAsTopic(e){const{filter:t,label:i}=e.value,n=c.StringUtils.parseFilters(t),s=l.first(n).value;this.placeholderTitle=i,this.forceUpdateIfAllowed(),await this.addItem({title:i,query:s,selected:!0}),this.placeholderTitle=void 0,this.forceUpdateIfAllowed()}async saveSearch(e){let{form:t,id:i,title:n}=e.value;if("quick_search_topic_category"===t)try{const[e]=await y.modalService.display("GENERIC_TEXT_INPUT",{title:g.contextData.getMessage("_1713861"),fields:[{name:g.contextData.getMessage("_1713858"),type:"input",maxLength:24,initialValue:"",errorTooLong:g.contextData.getMessage("_868253",[24]),autoFocus:!0}]});n=e}catch(e){n=void 0}void 0!==n&&(await S.quickSearchService.saveSearch(t,i,n),this.forceUpdate())}async toggleItemEditing(e){const{mapped_id:t,editing:i}=e.value;i?(void 0!==this.editingTimeout&&clearTimeout(this.editingTimeout),this.editingTimeout=setTimeout(()=>this.setState({editedItemId:t}),50)):this.setState({editedItemId:void 0})}async setItemQueryNewSearch(e){const{mapped_id:t,query:i}=e.value;t===this.placeholderMappedId?(this.resetUFS({resetCountries:!0,resetTimeFilter:!0}),this.placeholderTitle=i,this.forceUpdate(),await this.addItem({title:i,query:i,selected:!0}),this.placeholderTitle=void 0,this.forceUpdate()):s.logService.error("Invalid use of setItemQueryNewSearch function! Must be used in placeholder item!")}async setItemQuery(e){const{mapped_id:t,query:i}=e.value;if(!await this.isQueryValid(i))return s.logService.error("Query is invalid!"),void this.forceUpdate();if(t===this.placeholderMappedId)await this.addItem({title:i,query:i,selected:!0});else{const e=await S.quickSearchService.getTopicInformation({mapped_id:t});e.query=i,await this.updateItem({mapped_id:t,title:i,query:i,ufs:e.ufs,selected:!0})}}async isQueryValid(e){return void 0===(await w.restFormService.postRForm("query_editor","validate",{modify:!1,text:e,context:{location:this.props.location}})).query_error_info}showInvalidQueryNotification(e){const t=`<a target="_blank" href="${g.contextData.getLink("ACADEMY_QUERY_SYNTAX")}">${g.contextData.getMessage("_154796")}</a>`,i=g.contextData.getMessage("_791169",[t]);r.notificationService.error(i,{singleInstance:!0,permanent:!1})}resetUFS(e){const t=d.mainApplication.getPageState().getUserFilterSettings(),{resetCountries:i=!1,resetTimeFilter:n=!0}=e;if(i){const e=t.getTopicMenuByType("COUNTRIES");void 0!==e&&e.selectEntryWithDefaultMappedId()}if(n){const e=t.getTimeFilter();void 0!==e&&e.selectDefaultTimeInterval()}t.toProto()}async editItemWithModal(e){const t=e.value,i=await this.buildEditionModalData(t);try{const[e,n,s]=await y.modalService.display("GENERIC_TEXT_INPUT",i,{size:y.ModalSize.MEDIUM}),o=Object.assign({},t,{color:n,title:e,query:s});void 0!==t.mapped_id?await this.updateItem(o):await this.addItem(o)}catch(e){}}async exportToAnalytics(e){const{form:t,id:i}=e.value,n=await S.quickSearchService.getExportInfo(t,{mapped_id:i}),s=await this.buildExportModalData(n);try{const e=await y.modalService.display("GENERIC_TEXT_INPUT",s);let n,o;"quick_search_topic_category_export"===t?[n,o]=e:[o]=e,await S.quickSearchService.exportTopics(t,{mapped_id:i,topics_menu:n,available_projects:o})}catch(e){}}async buildEditionModalData(e){let t=[];if(void 0!==e.mapped_id){const i=await S.quickSearchService.getTopicInformation(e);e.title=e.title||i.title,e.query=e.query||i.query,e.color=e.color||i.color,void 0!==i.colors&&(t=i.colors.root_entry.children)}return{title:g.contextData.getMessage("_1713857"),fields:[{name:g.contextData.getMessage("_1713858"),type:"input",maxLength:24,initialValue:e.title,errorTooLong:g.contextData.getMessage("_1554544",[24]),autoFocus:!0},{name:g.contextData.getMessage("_1231245"),type:"color_picker",initialValue:e.color,colors:t},{name:g.contextData.getMessage("_1713859"),type:"textarea",initialValue:e.query,required:!0,useCodeCompletion:!0,maxLength:1e3,errorEmpty:g.contextData.getMessage("_1901595")},{name:"",type:"link_field",link:g.contextData.getLink("ACADEMY_QUERY_SYNTAX"),linkClass:"link-field-link",linkDescription:g.contextData.getMessage("_1676080"),iconClass:"fa fa-question-circle link-field-icon",openInNewTab:!0}]}}async buildExportModalData(e){const t=[];if("quick_search_topic_category_export"===e.form){const i=e;t.push({name:g.contextData.getMessage("_1713863"),type:"multiple_checkbox",description:g.contextData.getMessage("_1713864"),initialValue:i.topics_menu})}return t.push({name:g.contextData.getMessage("_1816043"),type:"topic_menu_select",initialValue:e.available_projects,required:!0,flat:!1}),t.push({name:"",type:"message",description:g.contextData.getMessage("_1958797")}),{title:g.contextData.getMessage("_1713862"),postTitleIcon:{label:"fa icon-tw-analytics"},fields:t}}async addItem(e){let t=!1,n=void 0;this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,async()=>{if(t=!0,void 0!==n)try{await Promise.reject(n)}catch(e){}});let s=T.ModelState.FULL;const o=S.quickSearchService.getSelectedCategory()||S.quickSearchService.getCategoryWithPartialSelection();if(void 0===o||S.quickSearchService.isSpecialCategory(o)){const t=S.quickSearchService.getSelectedItemsFromSpecialCategory();if(0===t.length){const t=await S.quickSearchService.addSearchItem(e);e.mapped_id=t.mapped_id,this.preventRendering(),await S.quickSearchService.selectItem(e),s=T.ModelState.PARTIAL}else{const i=t.map(e=>({mapped_id:e.getMappedId()})),n=await S.quickSearchService.createCategory(i);await S.quickSearchService.addSearchItem(e,n.mapped_id),await S.quickSearchService.selectCategory({mapped_id:n.mapped_id})}}else{const t=await S.quickSearchService.addSearchItem(e,o.getMappedId());e.mapped_id=t.mapped_id;const i=S.quickSearchService.getCurrentCategory();i.containsSelection(!0)?i.getEntryByMappedId(e.mapped_id).setSelected(!0):await S.quickSearchService.selectCategory({mapped_id:t.parent_mapped_id||i.getMappedId()})}this.setState({editedItemId:void 0}),t||((n=this.refreshPage(s)).then(async()=>{this.allowRendering(),s===T.ModelState.PARTIAL&&await this.refreshPage(T.ModelState.FULL),this.forceUpdate()}),await n)}createFilterBubbleDialog(e,t,i){const{ufs:n}=e;_.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection),n.filters.topic_menu=n.filters.topic_menu.filter(e=>!e.disabled);const s=new E.UserFilterSettingsWrapper(n),o=_.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,$(t),s,f.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),i,void 0,!1,!i),r=s.getHashSelectionState();this.cancellationToken.subscribeOnce(o.onDestroy,async()=>{s.getHashSelectionState()!==r&&(await S.quickSearchService.updateSearchItem(Object.assign({},e,{ufs:s.toProto()})),this.forceUpdate(),this.refreshPage(T.ModelState.FULL))})}render(){const e=this.buildItems();void 0!==this.placeholderTitle&&(e.length=0);const t=S.quickSearchService.getItemSaveInformation(e),i=S.quickSearchService.getItemExportInformation(e),n=e.length;e.length<this.maxItems&&this.addPlaceholderItem(e);const s=e.some(e=>e.editing),r={maxItems:this.maxItems,items:e,menu:this.buildMenu(),messages:this.buildMessages(),sticky:!1,init:this.dataFromHistory,buttons:this.buildActionButtons(s,this.canExportFullPage(n),t,i),queryValidator:this.isQueryValid.bind(this)};return this.dataFromHistory=!1,a.createElement(o.TopicNavbarRenderable,Object.assign({},r))}canExportFullPage(e){return!m.tw.pageState.getAllowedPages().isSearch()&&e>0}buildActionButtons(e,t,n,s){const o=[];if(n&&n.canSave&&o.push({id:"save",icon:"fa fa-floppy-o",disabled:()=>!0===e,action:()=>{const e=l.first(S.quickSearchService.getComparedItems()).title;i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_SAVE_SEARCH,value:Object.assign({},n,{title:e})})}}),s&&s.canExport&&o.push({id:"export-to-analytics",icon:"fa icon-tw-analytics",disabled:()=>!0===e,action:()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_EXPORT,value:s})}}),t){const t=this.buildExportMenu(!0===e),i=c.TopicMenuSelectStyleUtils.buildButtonStyleModel("fa fa-download"),n=new M.ExportModuleReportMenuStrategy(t),s=this.buildIconMapForExportMenu();o.push({id:"export-page",icon:"fa fa-download",disabled:()=>!0===e||n.isActionsDisabled(),description:g.contextData.getMessage("_1212312"),customComponent:a.createElement(P.TopicMenuSelectContainer,{key:"export-page",topicMenu:t,menuStrategy:n,styleModel:i,title:void 0,allowMultiSelection:void 0,concatSelectionLabel:void 0,concatAllNode:void 0,iconMap:s,dropdownClassName:"export-module-report-menu",openOnHover:!0})})}else this.shouldShowAlertsRedirect()&&o.push({id:"alerts",icon:"fa fa-bell",disabled:()=>!1,description:g.contextData.getMessage("_1553434"),action:()=>this.redirectToFreeAlerts()});return o}shouldShowAlertsRedirect(){return m.tw.pageState.getAllowedPages().isSearch()&&S.quickSearchService.getComparedItems().length>0}redirectToFreeAlerts(){const{query:e=""}=l.first(S.quickSearchService.getComparedItems());window.open(`https://www.talkwalker.com/alerts?query=${encodeURIComponent(e)}`,"_blank")}buildExportMenu(e){return new C.TopicMenuWrapper({root_entry:{mapped_id:"root",name:"",children:[{mapped_id:M.ExportType.PDF_EXPORT,name:g.contextData.getMessage("_1945201"),disabled:e,children:[{mapped_id:M.ExportType.PDF_EXPORT,name:g.contextData.getMessage("_1964064"),disabled:e},{mapped_id:M.ExportType.POWER_POINT_EXPORT,name:g.contextData.getMessage("_1859046"),disabled:e}]}]}})}buildIconMapForExportMenu(){const e={icon:"fa fa-file-pdf-o",className:"export-module-report-entry-icon"},t={icon:"fa fa-file-powerpoint-o",className:"export-module-report-entry-icon"};return{[M.ExportType.PDF_PREVIEW]:e,[M.ExportType.PDF_EXPORT]:e,[M.ExportType.POWER_POINT_PREVIEW]:t,[M.ExportType.POWER_POINT_EXPORT]:t}}addPlaceholderItem(e){const t=0===e.length,i=this.getPlaceholderTitle(t);e.push({title:i,mapped_id:this.placeholderMappedId,isPlaceholder:!0,selected:!1,editing:this.state.editedItemId===this.placeholderMappedId,icon:t?"icon-tw-search":"fa fa-plus",showSearchButton:t})}getPlaceholderTitle(e){return e?void 0!==this.placeholderTitle?this.placeholderTitle:g.contextData.getMessage("_1338878"):g.contextData.getMessage("_1713851")}buildItems(){const e=S.quickSearchService.getComparedItems();return e.forEach(e=>{e.editing=this.state.editedItemId===e.mapped_id}),e}buildMenu(){const e=S.quickSearchService.getTopicsMenuFromUFS(),t=e.getRootEntry().getChildren().reduce((e,t)=>{if(!t.isDisabled())if(t.getMappedId()===S.quickSearchService.getSavedSearchesCategory().getMappedId()||void 0!==S.quickSearchService.getRecentSearchesCategory()&&t.getMappedId()===S.quickSearchService.getRecentSearchesCategory().getMappedId())e=e.concat(t.getChildren().map(e=>{const t={id:e.getMappedId(),form:"quick_search_topic"};return{text:e.getName(),selectAction:{type:i.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_ITEM,value:{mappedId:e.getMappedId(),title:e.getName()}},deleteAction:{type:i.EVENT_TYPES.QUICKSEARCH_DELETE_SAVED_ITEM,value:t},numItems:1}}));else{const n={id:t.getMappedId(),form:"quick_search_topic_category"};e.push({text:t.getName(),selectAction:{type:i.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_CATEGORY,value:{mappedId:t.getMappedId(),title:t.getName()}},deleteAction:{type:i.EVENT_TYPES.QUICKSEARCH_DELETE_SAVED_ITEM,value:n},numItems:t.getChildren().length})}return e},[]);let n=[];return e.getSelectedEntriesLeavesRecursively().length>0&&(n=[{text:g.contextData.getMessage("_1563634"),icon:"icon-tw-view-results",clickAction:{type:i.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,value:void 0}}]),{buttons:n,items:t,emptyLabel:g.contextData.getMessage("_1531521"),title:g.contextData.getMessage("_1713866"),width:1224}}buildMessages(){return{editItem:g.contextData.getMessage("_1713854"),editFilters:g.contextData.getMessage("_1713855"),removeItem:g.contextData.getMessage("_1713856"),muteItem:g.contextData.getMessage("_1713852"),unmuteItem:g.contextData.getMessage("_1713853"),muteOthers:g.contextData.getMessage("_1713860"),searchButtonLabel:g.contextData.getMessage("_1713865"),queryValidationFailed:g.contextData.getMessage("_505376")}}}}),define("services/quick_search",["require","exports","event_bus","log","map","notifications","classes/application/application","classes/context_data/context_data","other/tw","wrappers/topic_menu/topic_entry_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","services/export","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.topicInformationMap=new s.Map}async addSearchItem(e,t){n.logService.assertDefined(e.query);const i=await u.restFormService.postRForm("quick_search_topic","add",Object.assign({},e,{parent_mapped_id:t})),{parent_mapped_id:s}=i;if(void 0!==t&&s!==t?this.handleMovingOfSavedSearch(i,t,i.mapped_id):this.getCategoryByMappedId(i.parent_mapped_id||constants.predefined_category.query.default.mapped_id).addChild(new l.TopicEntryWrapper({mapped_id:i.mapped_id,name:i.title,selected:constants.topic_entry.selected.none,color:i.color})),this.topicInformationMap.set(i.mapped_id,Object.assign({},i)),i.parent_mapped_id){const e=await this.getCategoryInfo({mapped_id:i.parent_mapped_id});e.topics.forEach(e=>{this.topicInformationMap.set(e.mapped_id,Object.assign({},e))}),this.updateCategoryItems(this.getCurrentCategory(),e)}return i}isSelectedItem(e){if(void 0===this.getSelectedCategory()||this.getSelectedCategory().getMappedId()!==e){const t=this.getSelectedItemsFromSpecialCategory();for(const i of t)if(i.getMappedId()===e)return!0}return!1}async deleteSavedSearch(e,t){if(this.isSelectedItem(t)&&"quick_search_topic_category"===e)return await this.moveItemToCategory({mapped_id:t},this.getDefaultCategory().getMappedId());{const i=await u.restFormService.postRForm(e,"remove",{mapped_id:t});return this.topicInformationMap.set(i.mapped_id,Object.assign({},i,{saved:!1})),"quick_search_topic_category"===e?this.removeDeletedSavedCategory(i):this.removeDeletedSavedSearch(i),i}}removeDeletedSavedCategory(e){this.getTopicsMenuFromUFS().getRootEntry().removeChildByMappedId(e.mapped_id)}removeDeletedSavedSearch(e){const t=this.getCategoryByMappedId(e.mapped_id),n=this.isSelectedItem(e.mapped_id);1===t.getParent().getChildrenCount()&&n?i.eventBus.dispatch({type:i.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,value:void 0}):t.getParent().removeChildByMappedId(e.mapped_id)}async saveSearch(e,t,i){const n=await u.restFormService.postRForm(e,"save",{mapped_id:t,title:i});return this.topicInformationMap.set(n.mapped_id,Object.assign({},n,{saved:!0})),"quick_search_topic_category"===e?this.createNewSavedCategory(this.getCurrentCategory(),n):this.createNewSavedSearch(n),n}createNewSavedCategory(e,t){let i,n=this.getTopicsMenuFromUFS().getEntryByMappedId(t.mapped_id);void 0===n?(n=new l.TopicEntryWrapper({mapped_id:t.mapped_id}),this.getTopicsMenuFromUFS().getRootEntry().addChild(n),i=e):i=e.clone(),n.setName(t.title),n.setVisibility("VISIBLE"),n.setDisabled(!1),n.setChildren(t.topics.map(e=>new l.TopicEntryWrapper({name:e.title,mapped_id:e.mapped_id,color:e.color},n.getAssociatedTopicMenu(),n))),this.transferSelectionFromCategory(i,n)}createNewSavedSearch(e){const t=new l.TopicEntryWrapper({name:e.title,mapped_id:e.mapped_id,color:e.color,children:[],selected:constants.topic_entry.selected.node,visibility:"VISIBLE"}),i=this.getCategoryByMappedId(e.parent_mapped_id);i.addChild(t),i.setVisibility("VISIBLE"),i.setDisabled(!1),this.getTopicsMenuFromUFS().unselectAllAndSelectByMappedId(e.mapped_id)}transferSelectionFromCategory(e,t){e.isSelected()?(t.setSelected(!0),e.setSelected(!1)):(t.setSelected(!1),e.getChildren().forEach((e,i)=>{const n=t.getChildren()[i];n&&n.setSelected(e.isSelected()),e.setSelected(!1)}))}async exportTopics(e,t){return u.restFormService.postRForm(e,"export",t)}async getExportInfo(e,t){return u.restFormService.postRForm(e,"info",t)}async updateSearchItem(e){n.logService.assertDefined(e.mapped_id),n.logService.assertDefined(e.query);const t=this.getParentMappedId(e);void 0===e.ufs&&(e.ufs=this.getCachedTopicInformation({mapped_id:e.mapped_id}).ufs);const i=await u.restFormService.postRForm("quick_search_topic","update",e),{parent_mapped_id:s}=i;if(s!==t&&this.handleMovingOfSavedSearch(i,t,e.mapped_id),this.topicInformationMap.set(i.mapped_id,Object.assign({},i,{query:e.query})),i.parent_mapped_id){this.topicInformationMap.set(i.parent_mapped_id,Object.assign({},i));const e=await this.getCategoryInfo({mapped_id:i.parent_mapped_id});e.topics.forEach(e=>{this.topicInformationMap.set(e.mapped_id,Object.assign({},e))}),this.updateCategoryItems(this.getCurrentCategory(),e)}const o=this.getTopicsMenuFromUFS().getEntryByMappedId(i.mapped_id);return o&&(void 0!==e.color&&o.setColor(e.color),o.setName(e.title)),i}updateCategoryItems(e,t){if(e&&e.hasChildren()&&!this.isSpecialCategory(e)){const i=e.getChildren().map(e=>e.isSelected());e.getChildren().length=0,t.topics.map((t,n)=>{const s=new l.TopicEntryWrapper({mapped_id:t.mapped_id,name:t.title,color:t.color}),o=void 0===i[n]||i[n];s.setSelected(o),e.addChildAtIndex(s,n)})}}getParentMappedId(e){if(void 0!==e.parent_mapped_id)return e.parent_mapped_id;{const t=this.getTopicsMenuFromUFS().getEntryByMappedId(e.mapped_id).getParent();return void 0!==t&&t.getMappedId()}}handleMovingOfSavedSearch(e,t,i){const{parent_mapped_id:n}=e;let s=this.getTopicsMenuFromUFS().getEntryByMappedId(n);const o=this.getTopicsMenuFromUFS().getEntryByMappedId(t).clone();void 0===s&&(s=this.createNewInvisibleCategory(e));const r=this.getTopicsMenuFromUFS().getEntryByMappedId(t);let a=r.getChildren().findIndex(e=>e.getMappedId()===i);-1===a&&(a=r.getChildren().length),r&&r.hasChildren()&&r.getChildren().length>1&&this.copyExistingItemsToCategory(r,s,i),s.addChildAtIndex(new l.TopicEntryWrapper({name:e.title,mapped_id:e.mapped_id,color:e.color,children:[],selected:constants.topic_entry.selected.node,visibility:"VISIBLE"}),a),this.ensureCorrectSelectionOfItems(s,e.mapped_id,o)}copyExistingItemsToCategory(e,t,i){const n=e.getMappedId().replace("TOPIC_CATEGORY","TOPIC"),s=t.getMappedId().replace("TOPIC_CATEGORY","TOPIC");e.getChildren().filter(e=>e.getMappedId()!==i).forEach((e,i)=>{const o=e.clone();o.setMappedId(o.getMappedId().replace(n,s)),t.addChildAtIndex(o,i)})}ensureCorrectSelectionOfItems(e,t,i){this.getDefaultCategory()===e?this.getTopicsMenuFromUFS().unselectAllAndSelectByMappedId(t):(this.getTopicsMenuFromUFS().unselectAll(),this.transferSelectionFromCategory(i,e))}createNewInvisibleCategory(e){const t=new l.TopicEntryWrapper({mapped_id:e.parent_mapped_id,name:e.title,disabled:!0});return this.getTopicsMenuFromUFS().getRootEntry().addChild(t),t}async deleteItem(e){const t=await u.restFormService.postRForm("quick_search_topic","remove",{mapped_id:e.mapped_id}),i=this.getTopicsMenuFromUFS().getRootEntry(),n=i.getEntryByMappedId(e.mapped_id);return n&&i.removeEntry(n),t}async createCategory(e,t){const i=await u.restFormService.postRForm("quick_search_topic_category","new",{title:t,topics:e}),n=this.createNewInvisibleCategory({title:t,parent_mapped_id:i.mapped_id}),s=this.getTopicsMenuFromUFS();return e.forEach(e=>{const t=s.getEntryByMappedId(e.mapped_id);t&&(t.hasParent()&&t.getParent().removeChild(t),n.addChild(t))}),i}getCachedTopicInformation(e){return this.topicInformationMap.get(e.mapped_id)}getCachedCategoryInformation(e){return this.topicInformationMap.get(e.mapped_id)}async getTopicInformation(e){const t=await u.restFormService.postRForm("quick_search_topic","info",e);return this.topicInformationMap.set(t.mapped_id,Object.assign({},t)),t}async moveItemToCategory(e,t){const i=await u.restFormService.postRForm("quick_search_topic","move",{mapped_id:e.mapped_id,title:e.title,query:e.query,parent_mapped_id:t}),n=this.getCachedTopicInformation({mapped_id:i.mapped_id});return n&&(n.parent_mapped_id=t,this.topicInformationMap.set(i.mapped_id,n)),i}async getCategoryInfo(e){const t=await u.restFormService.postRForm("quick_search_topic_category","info",e);return this.topicInformationMap.set(e.mapped_id,t),t.topics.forEach(e=>{this.topicInformationMap.set(e.mapped_id,e)}),t}async selectItem(e){n.logService.assertDefined(e.mapped_id);const t=this.getTopicsMenuFromUFS();t.unselectAll(),t.selectEntryByMappedId(e.mapped_id)}async toggleItemMute(e){n.logService.assertDefined(e.mapped_id);const t=this.getTopicsMenuFromUFS().getEntryByMappedId(e.mapped_id);if(t){const e=t.getParent();if(e.isSelected())e.setSelected(!1),e.setChildrenSelectionRecursively(!0),t.setSelected(!1);else{const i=!t.isSelected();t.setSelected(i),e.getSelectedChildren().length===e.getMaxSelection()&&(e.setChildrenSelectionRecursively(!1),e.setSelected(!0))}}}async selectCategory(e){n.logService.assertDefined(e.mapped_id);const t=this.getTopicsMenuFromUFS();t.unselectAll(),t.selectEntryByMappedId(e.mapped_id),await this.getCategoryInfo({mapped_id:e.mapped_id})}isSpecialCategory(e){const t=e.getMappedId();return t===this.getDefaultCategory().getMappedId()||t===this.getSavedSearchesCategory().getMappedId()}getTopicsMenuFromUFS(){return r.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.topic)}getCategoryByMappedId(e){return this.getTopicsMenuFromUFS().getRootEntry().getEntryByMappedId(e)}getDefaultCategory(){return this.getCategoryByMappedId(constants.predefined_category.query.default.mapped_id)}getSavedSearchesCategory(){return this.getCategoryByMappedId(constants.predefined_category.query.saved.mapped_id)}getRecentSearchesCategory(){return this.getCategoryByMappedId(constants.predefined_category.query.recent.mapped_id)}getSelectedCategory(){return this.getTopicsMenuFromUFS().getRootEntry().getSelectedChildren()[0]}getCategoryWithPartialSelection(){return _.first(this.getTopicsMenuFromUFS().getRootEntry().getChildren().filter(e=>e.containsSelection(!0)))}getCurrentCategory(){return this.getSelectedCategory()||this.getCategoryWithPartialSelection()}getSelectedItemsFromSpecialCategory(){const e=this.getDefaultCategory(),t=this.getSavedSearchesCategory();return e.containsSelection(!0)?this.getDefaultCategory().getSelectedChildren():t.containsSelection(!0)?t.getSelectedChildren():[]}getComparedItems(){const e=this.getDefaultCategory(),i=this.getSavedSearchesCategory();if(e.containsSelection()||i.containsSelection()){const t=e.getFirstSelectedEntry()||i.getFirstSelectedEntry(),n=this.getCachedTopicInformation({mapped_id:t.getMappedId()});return[{mapped_id:t.getMappedId(),selected:!0,title:t.getName(),query:n?n.query:"",color:t.getColor(),showFilterIcon:!1,canMute:!1,canMuteOthers:!1}]}const n=t.quickSearchService.getSelectedCategory();if(void 0!==n){const e=n.getChildrenCount()>1;return n.getChildren().map(t=>{const i=this.getCachedTopicInformation({mapped_id:t.getMappedId()}),n=e&&this.shouldShowTopicFilters(i)&&!c.tw.pageState.getAllowedPages().isSearch();return{mapped_id:t.getMappedId(),selected:!0,title:t.getName(),query:i?i.query:"",color:t.getColor(),showFilterIcon:n,canMute:e||!t.isSelected(),canMuteOthers:!0}})}const s=t.quickSearchService.getCategoryWithPartialSelection();if(void 0!==s){const e=s.getSelectedChildren().length,t=e>1,i=s.getChildrenCount();return s.getChildren().map(n=>{const s=this.getCachedTopicInformation({mapped_id:n.getMappedId()}),o=1===e&&n.isSelected(),r=t&&this.shouldShowTopicFilters(s)&&!c.tw.pageState.getAllowedPages().isSearch();return{mapped_id:n.getMappedId(),selected:n.isSelected(),title:n.getName(),query:s?s.query:"",color:n.getColor(),showFilterIcon:r,canMute:!o,canMuteOthers:i>1&&!o}})}return[]}getItemSaveInformation(e){return{form:this.getSaveForm(e),id:this.getSaveId(e),canSave:this.canSaveItems(e)}}getItemExportInformation(e){return{form:this.getExportForm(e),id:this.getSaveId(e),canExport:this.canExportItems(e)}}isCategory(e){const t=this.getSelectedCategory();let i=e.length>1;if(void 0!==t&&!i)for(const n of e)if(void 0!==t.getChildByMappedId(n.mapped_id)){i=!0;break}return i}getSaveForm(e){if(e.length>0)return this.isCategory(e)?"quick_search_topic_category":"quick_search_topic"}getExportForm(e){if(e.length>0)return this.isCategory(e)?"quick_search_topic_category_export":"quick_search_topic_export"}getSaveId(e){if(e.length>0){if(!this.isCategory(e))return e[0].mapped_id;if(void 0!==t.quickSearchService.getCurrentCategory())return t.quickSearchService.getCurrentCategory().getMappedId()}}canSaveItems(e){if(e.length>0){if(!this.isCategory(e)){const i=t.quickSearchService.getCachedTopicInformation({mapped_id:e[0].mapped_id});return!!i&&!i.saved}if(void 0!==t.quickSearchService.getCurrentCategory()){const e=t.quickSearchService.getCachedTopicInformation({mapped_id:t.quickSearchService.getCurrentCategory().getMappedId()});return!!e&&!e.saved}}return!1}canExportItems(e){if(e.length>0){if(!this.isCategory(e)){const i=t.quickSearchService.getCachedTopicInformation({mapped_id:e[0].mapped_id});return!!i&&i.analytics_export_allowed}if(void 0!==t.quickSearchService.getCurrentCategory()){const e=t.quickSearchService.getCachedTopicInformation({mapped_id:t.quickSearchService.getCurrentCategory().getMappedId()});return!!e&&e.analytics_export_allowed}}return!1}shouldShowTopicFilters(e){return!(!e||!e.ufs)&&new d.UserFilterSettingsWrapper(e.ufs).getSelectedFilters(!0,!1).length>0}async exportPage(e,t){let i;return i=e?g.exportService.requestWholePageExportPreview("PPTX_GRID_PDF","quick_search_export",{direct_download:t}):g.exportService.requestWholePageExportPreview("PPTX_GRID","quick_search_export",{direct_download:t}),o.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+a.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:i}),i}},Object.defineProperty(t,"quickSearchService",{get:()=>c.tw.inject("quickSearchService")})}),define("react_components/menu/topic_menu_select_component_strategies/export_module_report_menu_strategy",["require","exports","services/quick_search","services/bubble_dialog","services/configuration"],function(e,t,i,n,s){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PDF_PREVIEW="pdf-export-preview",e.POWER_POINT_PREVIEW="powerpoint-export-preview",e.PDF_EXPORT="pdg-export",e.POWER_POINT_EXPORT="powerpoint-export"}(o=t.ExportType||(t.ExportType={}));t.ExportModuleReportMenuStrategy=class{constructor(e){this.menuWrapper=e,this.actionsDisabled=!1}onSelect(e,t,i){return new Promise(async(e,i)=>{if(!this.actionsDisabled&&!t.disabled){let e;switch(this.actionsDisabled=!0,t.mapped_id){case o.POWER_POINT_PREVIEW:e=await this.exportFullPageAsPowerPoint(!1),this.previewReport(e);break;case o.PDF_PREVIEW:e=await this.exportFullPageAsPdf(!1),this.previewReport(e);break;case o.PDF_EXPORT:e=await this.exportFullPageAsPdf(!0),this.actionsDisabled=!1;break;default:e=await this.exportFullPageAsPowerPoint(!0),this.actionsDisabled=!1}}e(this.menuWrapper.toModel())})}onMouseEnter(e){return new Promise((t,i)=>{t({openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0})})}isActionsDisabled(){return!0===this.actionsDisabled}exportFullPageAsPdf(e){return this.exportPage(!0,e)}exportFullPageAsPowerPoint(e){return this.exportPage(!1,e)}async exportPage(e,t){return await i.quickSearchService.exportPage(e,t)}previewReport(e){n.bubbleDialogService.createByType(constants.bubble_dialog.id.export_preview,$("body"),constants.bubble_dialog.id.export_preview,{pageState:e.page_state,applyTemplateMenu:e.refreshing_menu,templateId:e.template_id,globalTemplateUsed:e.global_template_used},s.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.export_preview),{fadeBackground:!0}).onDestroy.subscribeOnce(()=>this.actionsDisabled=!1)}}}),define("components/bubble_dialog/export_preview/directive",["require","exports","angular_utilities","services/template_source","wrappers/page_state/page_state_wrapper","reusable_utilities","services/loading_bubble","classes/application/application","services/tw_common","classes/application/bubble_application","services/context","services/rest_form_service","notifications","classes/context_data/context_data","services/confirmation_service","wrappers/topic_menu/topic_menu_wrapper","react_components/menu/topic_menu_select_component_strategies/restform_post_menu_strategy","event_bus","services/modal","react_components/menu/topic_menu_select_component_strategies/export_module_report_menu_strategy"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:n.templateSourceFactory("components/bubble_dialog/export_preview"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:b,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:S}};let S=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.cancellationToken=new o.CancellationToken,this.bubbleApplication=new l.BubbleApplication(a.mainApplication),this.confirmationOpen=!1}$onInit(){this.initSubscriptions(),this.preparePreview(this.payload.pageState),this.initApplyTemplateMenu(),this.templateId=this.payload.templateId,this.globalTemplateUsed=this.payload.globalTemplateUsed,this.$scope.$on("$destroy",()=>{this.bubbleApplication.dispose(),this.cancellationToken.cancel()})}exportReportAsPdf(){this.exportReport(v.ExportType.PDF_EXPORT)}exportReportAsPptx(){this.exportReport(v.ExportType.POWER_POINT_EXPORT)}async saveTemplate(){this.savingTemplate||this.startSaveCycle(!1)}async saveGlobalTemplate(){this.savingGlobalTemplate||this.startSaveCycle(!0)}canSaveGlobalTemplate(){return p.contextData.rules.isProductProjectRuleEnabled()}canSaveTemplate(){return p.contextData.rules.isProductProjectRuleEnabled()}async attemptClose(){if(!this.confirmationOpen){this.confirmationOpen=!0;try{await h.confirmationService.display({message:p.contextData.getMessage("_1896464")}),this.confirmationOpen=!1,this.close()}catch(e){this.confirmationOpen=!1}}}close(){this.facade.destroy()}preparePreview(e){r.loadingBubbleService.showSpinner();const t=new s.PageStateWrapper(e,this.bubbleApplication),i=void 0!==this.pageState;i||(this.pageState=t),this.bubbleApplication.injectPageState(t,i),this.applyScope(),r.loadingBubbleService.hideSpinner()}extractReportId(){const e=this.pageState.getAllowedPages().getCustomPageId().split("|");return e[e.length-1]}async requestTemplateCreation(e,t){const i=g.restFormService.getRFormUrl("powerpoint_placeholders_template","create"),n=await g.restFormService.post(i,e);this.templateId=n.template_id,this.globalTemplateUsed=!0===t}async requestTemplateUpdate(e){const t=g.restFormService.getRFormUrl("powerpoint_placeholders_template","update");await g.restFormService.post(t,e)}initApplyTemplateMenu(){if(void 0!==this.payload.applyTemplateMenu){this.applyTemplateMenu=new m.TopicMenuWrapper(this.payload.applyTemplateMenu),this.applyTemplateMenuStyleModel=o.TopicMenuSelectStyleUtils.buildButtonStyleModel("icon2-tw-template");const e=JSON.parse(JSON.stringify(this.payload.applyTemplateMenu));this.applyTemplateMenuStrategy=new _.RestformPostMenuStrategy(new m.TopicMenuWrapper(e),{url:g.restFormService.getRFormUrl("module_report_refreshing","refresh"),payload:{report_id:this.extractReportId(),page_state:this.pageState.toProto(),refreshing_menu:e}},"export_preview")}}handleRestformPostMenuStrategyClick(e){const t=e.value.formEntry;this.templateId=t.template_id,this.globalTemplateUsed=t.global_template_used,this.preparePreview(t.page_state)}createNewNameModal(){const e={title:p.contextData.getMessage("_1891962"),fields:[{name:p.contextData.getMessage("_001160"),description:p.contextData.getMessage("_1698478"),maxLength:24,errorEmpty:p.contextData.getMessage("_669046"),errorTooLong:p.contextData.getMessage("_1891054",["24"]),initialValue:""}]};return y.modalService.display("GENERIC_TEXT_INPUT",e,{keepBubbleDialogs:!0})}prepareTemplateFormRequestPayload(e,t){return{report_id:this.extractReportId(),name:e,global_saving:t,template_id:this.templateId}}async startSaveCycle(e){this.blockSaving();let t=[];const i=this.canCreateNewTemplate(e);if(i)try{t=await this.createNewNameModal()}catch(e){this.finishSaveCycle()}const n=this.prepareTemplateFormRequestPayload(t[0],e);void 0===this.templateId||i?await this.requestTemplateCreation(n,e):await this.requestTemplateUpdate(n),this.finishSaveCycle()}finishSaveCycle(){this.savingTemplate=!1,this.savingGlobalTemplate=!1,this.applyScope()}blockSaving(){this.savingTemplate=!0,this.savingGlobalTemplate=!0}canCreateNewTemplate(e){return void 0===this.templateId||!0===e&&!this.globalTemplateUsed||!e&&!0===this.globalTemplateUsed}exportReport(e){const t=this.extractReportId(),i=routes.controllers.tw.TWRestForm.get(d.contextService.getCurrentContext().scope,d.contextService.getCurrentContext().id,"quick_search_export","export",t,"rform").url,n=g.restFormService.post(i,{report_id:t,report_output_type:e===v.ExportType.PDF_EXPORT?"PPTX_GRID_PDF":"PPTX_GRID"});u.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+p.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:n}),n.then(e=>{e.data&&u.notificationService.success(e.download_message,{permanent:!0})},e=>{u.notificationService.display(e.notification)}),this.close()}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}handleClick(e){this.protectFromClosing||c.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.attemptClose(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(c.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.addDomEvent($(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown(e)),this.cancellationToken.subscribeToStream(f.eventBus,f.EVENT_TYPES.RESTFORM_POST_MENU_STRATEGY_CLICK,this.handleRestformPostMenuStrategyClick.bind(this))}};function b(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t)},0)}}}S=__decorate([i.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],S)}),define("components/bubble_dialog/filters/selection/directive",["require","exports","log","underscore","services/template_source","classes/context_data/context_data","services/broker","services/refresh/model_refresh_service","services/tw_common","classes/application/application","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","flux","reusable_components","services/icons","services/bubble_dialog"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element","filterService","topicMenuService","configurationService"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/bubble_dialog/filters/selection"),compile:function(){return{post:f}}};function t(t,s,f,y,v){const S=[],b=[],w=[];let C,E;const T=[constants.topic_menu.TYPE.event,constants.topic_menu.TYPE.page_monitoring,constants.topic_menu.TYPE.topic_pm_composed];t.editable=t.payload.editable,t.widget=t.payload.widget,t.isIcon=function(e){return m.iconService.isIcon(e.getMappedId())},t.isImportant=function(e){return e.getMappedId()===constants.important.id},t.isSentimentPositive=function(e){return e.getMappedId()===constants.sentiment.positive},t.isSentimentNeutral=function(e){return e.getMappedId()===constants.sentiment.neutral},t.isSentimentNegative=function(e){return e.getMappedId()===constants.sentiment.negative},t.isSentimentNone=function(e){return e.getMappedId()===constants.sentiment.none},t.isStarsOne=function(e){return e.getMappedId()===constants.stars.one.id},t.isStarsTwo=function(e){return e.getMappedId()===constants.stars.two.id},t.isStarsThree=function(e){return e.getMappedId()===constants.stars.three.id},t.isStarsFavorite=function(e){return e.getMappedId()===constants.stars.favorite.id},t.isTimeFilters=function(e){const t=e.getType();return t===constants.topic_menu.TYPE.time_filter||t===constants.topic_menu.TYPE.event},t.isSearchQuery=P,t.canEditMenu=D,t.canEditQuery=A,t.hasMenuButtons=function(e){return D(e)||I(e)||A(e)},t.canShowEntryList=function(e,i){return!0===t.showEntryList&&e.getType()===t.hoveredEditBtnTopicMenu.getType()&&t.hoveredBtnId===i},t.canShowNewFiltersList=function(e){return!0===t.showNewFilters&&t.hoveredBtnId===e},t.anySelectionExists=W,t.selectEntry=function(e){if(!e.isDisabled()){const t=e.getAssociatedTopicMenu();t.getType()===constants.topic_menu.TYPE.topic?(t.getRootEntry().isSelected()&&t.getRootEntry().setSelected(!1),t.selectEntryByStrategy(e,c.twCommon.selectionStrategies.MULTIPLE),t.getRootEntry().containsSelection(!0)||t.getRootEntry().setSelected(!0)):P(t)?(t.selectEntry(e.getChildren()[0]),x(t)):t.selectEntry(e)}},t.removeFilters=function(e,i,s){if(t.showEntryList||t.showNewFilters)return;s.stopPropagation();const o=e.ufs;if(I(i)){if(i.getType()===constants.topic_menu.TYPE.time_filter)o.getTimeFilter().reset(o);else if(i.getType()===constants.topic_menu.TYPE.event)i.unselectAll(),o.getTimeFilter().reset(o);else if(i.getType()===constants.root_id.searchbar){o.getSearchbarFilter().reset();const e=o.getQueryFilterMenu().getRootEntry().getFirstSelectedEntry();e.setName(void 0),e.setMappedId(void 0),o.getQueryFilterMenu().unselectAll()}else i.reset(o),i.getType()===constants.topic_menu.TYPE.topic&&(i.getRootEntry().containsSelection(!0)||i.getRootEntry().setSelected(!0));const s=n.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.event],i.getType());o.getHolderType()===c.twCommon.holderTypes.PAGE&&s&&r.brokerService.publish(constants.events.time_filter.update,[!0]),o.getHolderType()===c.twCommon.holderTypes.PAGE&&(f.updateFilter(i.getType(),!0),s&&r.brokerService.publish(constants.events.time_filter.reset,["time-id_1"])),i.getType()!==constants.topic_menu.TYPE.topic&&(e.filters.splice(n.indexOf(e.filters,i),1),!0===t.editable&&(s?e.unselectedFilters.push(o.getRelevantTimeMenu(o.getTimeFilter().getTimeFilterMenu())):e.unselectedFilters.push(i))),B()}},t.removeFilter=function(e,i,s,o){if(t.showEntryList||t.showNewFilters)return;o.stopPropagation(),y.unselectFilterEntry(e,i,s.ufs);const r=s.ufs,a=n.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.event],i.getType());(!a&&i.hasDefaultFilterState(r)||a&&r.getTimeFilter().hasDefaultState(r))&&(s.filters.splice(n.indexOf(s.filters,i),1),!0===t.editable&&i.getType()!==constants.root_id.searchbar&&(a?s.unselectedFilters.push(r.getRelevantTimeMenu(r.getTimeFilter().getTimeFilterMenu())):s.unselectedFilters.push(i)));B()},t.resetIsAllowed=I,t.cancelDestruction=function(){t.payload.selfDestructable&&t.facade.cancelDestruction()},t.attemptDestroy=function(){t.payload.selfDestructable&&void 0===E&&_.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.filters.selection,500)},t.getMenuName=function(e){return y.getMenuName(e)},t.getName=function(e,t){return L(t)?window.messages.get("_335841"):e.getName()},t.getEntryListItems=function(){return t.hoveredEditBtnTopicMenu.hasAllNode()?t.hoveredEditBtnTopicMenu.getAllNode().getChildren():t.hoveredEditBtnTopicMenu.getRootEntry().getChildren()},t.getTimeMenuItems=function(){return w.length=0,w.push(t.ufsClone.getTimeFilter().getTimeFilterMenu().getRootEntry()),w},t.getNewFiltersItems=function(e){return b.length=0,n.each(e,function(e){P(e)?b.push(t.ufsClone.getQueryFilterMenu().getRootEntry()):b.push(t.ufsClone.getTopicMenuByType(e.getType()).getRootEntry())}),b.sort(function(e,t){return e.getAssociatedTopicMenu().getOrder()-t.getAssociatedTopicMenu().getOrder()}),b},t.toggleShowEntryList=function(e,i,s){if(t.showNewFilters)return;n.isUndefined(s)||s.stopPropagation();t.showEntryList?(t.showEntryList=!1,t.hoveredBtnId=void 0,t.hoveredEditBtnTopicMenu=void 0,C=void 0,function(e){const i=e.getAssociatedUserFilterSettings();if(i.getHashSelectionState()!==t.ufsClone.getHashSelectionState()){i.merge(t.ufsClone),i.toProto(),i.getHolderType()!==c.twCommon.holderTypes.PAGE||e.getType()!==constants.topic_menu.TYPE.time_filter&&e.getType()!==constants.topic_menu.TYPE.event||r.brokerService.publish(constants.events.time_filter.update);const s=n.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.event],e.getType());!s&&e.hasDefaultFilterState(i)?function(e,i){for(let s=0;s<t.selectedTopicMenuFilters.length;s++)if(t.selectedTopicMenuFilters[s].ufs===i){const i=n.indexOf(t.selectedTopicMenuFilters[s].filters,e);t.selectedTopicMenuFilters[s].filters.splice(i,1),t.selectedTopicMenuFilters[s].unselectedFilters.push(e);break}}(e,i):s&&i.getTimeFilter().hasDefaultState(i)?function(e,i){for(let s=0;s<t.selectedTopicMenuFilters.length;s++)if(t.selectedTopicMenuFilters[s].ufs===i){const o=n.indexOf(t.selectedTopicMenuFilters[s].filters,e),r=i.getRelevantTimeMenu(i.getTimeFilter().getTimeFilterMenu());t.selectedTopicMenuFilters[s].filters.splice(o,1),t.selectedTopicMenuFilters[s].unselectedFilters.push(r);break}}(e,i):s&&function(e,i){for(let s=0;s<t.selectedTopicMenuFilters.length;s++)if(t.selectedTopicMenuFilters[s].ufs===i){const o=n.indexOf(t.selectedTopicMenuFilters[s].filters,e),r=i.getRelevantTimeMenu(i.getTimeFilter().getTimeFilterMenu());t.selectedTopicMenuFilters[s].filters.splice(o,1),t.selectedTopicMenuFilters[s].filters.splice(o,0,r);break}}(e,i),B()}}(e)):(t.showEntryList=!0,t.hoveredBtnId=i,t.ufsClone=e.getAssociatedUserFilterSettings().clone(),t.hoveredEditBtnTopicMenu=t.ufsClone.getTopicMenuByType(e.getType()),C=e,n.isUndefined(s)||V(s))},t.toggleShowNewFiltersList=function(e,i,s){if(t.showEntryList)return;n.isUndefined(s)||s.stopPropagation();t.showNewFilters?(t.showNewFilters=!1,t.hoveredBtnId=void 0,C=void 0,function(e){const i=e.ufs;if(i.getHashSelectionState()!==t.ufsClone.getHashSelectionState()){i.merge(t.ufsClone),i.toProto();const s=[];n.each(e.unselectedFilters,function(t){i.getHolderType()!==c.twCommon.holderTypes.PAGE||t.getType()!==constants.topic_menu.TYPE.time_filter&&t.getType()!==constants.topic_menu.TYPE.event||r.brokerService.publish(constants.events.time_filter.update),t.getType()===constants.topic_menu.TYPE.time_filter||t.hasDefaultFilterState(i)?t.getType()!==constants.topic_menu.TYPE.time_filter||i.getTimeFilter().hasDefaultState(i)||(s.push(t),e.filters.push(i.getRelevantTimeMenu(t))):(s.push(t),e.filters.push(t))}),n.each(s,function(t){e.unselectedFilters.splice(n.indexOf(e.unselectedFilters,t),1)})}}(e)):(t.showNewFilters=!0,t.hoveredBtnId=i,t.ufsClone=e.ufs.clone(),C=e,n.isUndefined(s)||V(s))},t.attemptEntryListClosing=R,t.editSearchQuery=x,t.getMaximumFilterContainerHeight=function(e){if(F(e))return window.innerHeight;{const e=n.flatten(t.selectedTopicMenuFilters.map(e=>e.filters)).length,i=.7*window.innerHeight/Math.max(e,1);return 25*Math.floor(i/25)}},t.showMoreFilters=F,t.getFilterRowId=O,t.getShowMoreButtonText=function(e){return N(e)?o.contextData.getMessage("talkwalker_menu_filter_less"):o.contextData.getMessage("talkwalker_menu_filter_more")},t.shouldDisplayExpandButton=function(e){return k(e)||N(e)},t.shouldDisplayShowMoreButton=k,t.shouldDisplayShowLessButton=N,t.toggleShowMore=function(t){const i=t.getRootEntry().getMappedId(),n=!!M.has(i)&&M.get(i);e(()=>{M.set(i,!n)})};const M=new Map;function P(e){return e.getType()===constants.root_id.searchbar}function D(e){return!0===t.editable&&e.getType()!==constants.root_id.searchbar&&(e.hasAllNode()&&e.getAllNode().hasChildren()||e.getRootEntry().hasChildren())}function A(e){return!0===t.editable&&e.getType()===constants.root_id.searchbar}function I(e){return!0!==t.payload.readOnly&&(t.editable&&!L(e)||e.hasAssociatedUserFilterSettings()&&e.getAssociatedUserFilterSettings().getHolderType()===c.twCommon.holderTypes.PAGE)}function x(e){const t=v.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.edit_search_query),i={query:e.getFirstSelectedEntry().getName()};(E=_.bubbleDialogService.createByType(constants.bubble_dialog.id.edit_search_query,$("#page_content"),"search-query-edit",i,t)).onDestroy.subscribeOnce(function(){const t=e.getFirstSelectedEntry();t.setName(i.query),e.getAssociatedUserFilterSettings().getSearchbarFilter().setQuery(t.getName(),!1),E=void 0})}function R(){n.isUndefined(C)||(t.showEntryList?t.toggleShowEntryList(C):t.showNewFilters&&t.toggleShowNewFiltersList(C))}function F(e){const t=e.getRootEntry().getMappedId();return M.has(t)&&!0===M.get(t)}function O(e){return e.hasRootEntry()&&e.getRootEntry().getMappedId()?e.getRootEntry().getMappedId():e.getType()}function k(e){const t=s.find(`.filter-content-row[id='${O(e)}'] .filter-selections`);return!!(t&&t.length&&t.parent())&&t.innerHeight()>t.parent().innerHeight()}function N(e){const t=e.getRootEntry().getMappedId();return M.has(t)&&!0===M.get(t)}function L(e){return e.getType()===constants.topic_menu.TYPE.topic&&e.getRootEntry().isSelected()}function B(){!W()&&(H(),_.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection))}function W(){return n.any(t.selectedTopicMenuFilters,function(e){return e.ufs.isAnyFilterActive()||e.ufs.getTopicMenuByPredicate(U).length>0})}function U(e){return l.mainApplication.hasPageState()&&l.mainApplication.getPageState().getAllowedPages().isCustomPage()?function(e){const t=e.getType();return t===constants.topic_menu.TYPE.topic?e.getRootEntry().containsSelection():n.contains(T,t)&&e.getRootEntry().containsSelection(!0)}(e):e.getType()!==constants.topic_menu.TYPE.event&&e.getRootEntry().containsSelection(!0)}function G(e){if(e.getHolderType()===c.twCommon.holderTypes.PAGE&&l.mainApplication.getPageState()){const e={strategy:d.ModelRefreshStrategy.REFRESH},t=g.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,u.ModelType.PAGE_STATE,e);a.modelRefreshService.refresh(t,e).then(j,function(e){e instanceof Error&&i.logService.error("Error when refreshing page state after editing filters !",void 0,e)})}else e.getHolderType()===c.twCommon.holderTypes.WIDGET&&t.widget&&(function(e){v.getPageConfiguration().shouldForceFilterOverride()&&e.getSelectedFilters().forEach(function(e){e.forceOverride(!0)})}(e),t.widget.setFiltersChanged(!0),t.widget.prepareReload(),function(){if(t.widget.hasPageState()&&t.widget.getPageState().getApplication()){const e={strategy:d.ModelRefreshStrategy.REFRESH},n=g.modelRefreshDecoratorFactory.getDecorator(t.widget.getPageState(),t.widget.getApplication(),u.ModelType.WIDGET,e);a.modelRefreshService.refresh(n,e).then(function(){},function(e){e instanceof Error&&i.logService.error("Error when refreshing widget!",void 0,e)})}else i.logService.error("reload attempted on widget without page state, this could be due to a memory leak",c.twCommon.logFeatures.WidgetWrapper)}())}function j(){p.dispatcher.dispatch(h.filterMenuActions.verticalFilters_onFiltersChanged,void 0)}function H(){n.each(t.selectedTopicMenuFilters,function(e,t){e.ufs.getHashSelectionState()!==S[t]&&G(e.ufs)})}function q(e){if(void 0===E&&!s.is(e.target)&&0===s.has(e.target).length){const i=_.bubbleDialogService.getFirstBubbleById(constants.bubble_dialog.id.months);(n.isUndefined(i)||!n.isUndefined(i)&&!i.getElement().is(e.target)&&0===i.getElement().has(e.target).length)&&t.facade.destroy()}}function V(e){$(e.target).offset().left<$(window).width()/2&&(t.subListSide="pull-right")}!function(){t.iconMappedIds=function(){const e=[];let t;for(t in e.push(constants.important.id),constants.sentiment)constants.sentiment.hasOwnProperty(t)&&e.push(constants.sentiment[t]);for(t in constants.stars)constants.stars.hasOwnProperty(t)&&e.push(constants.stars[t].id);return e}(),t.entryListConfig={noAllNodeMenuTypes:[constants.topic_menu.TYPE.filter]};const e=n.isArray(t.payload.ufs)?t.payload.ufs:[t.payload.ufs];t.selectedTopicMenuFilters=[],e.forEach(function(e){t.selectedTopicMenuFilters.push({ufs:e,filters:function(e){const i=e.getSelectedFilters(t.payload.showAll,t.payload.showAll);for(let e=i.length-1;e>=0;e--)i[e].containsSelection&&!i[e].containsSelection()&&i.splice(e,1);return i}(e),unselectedFilters:!0===t.editable?e.getNoSelectionFilters():void 0}),S.push(e.getHashSelectionState())}),t.facade.onDestroy.subscribeOnce(function(){R(),H(),$(document).off("mousedown",q)}),$(document).on("mousedown",q)}()}function f(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/group/creation/directive",["require","exports","angular","jquery","reusable_utilities","services/tw_common","angular_utilities","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{templateUrl:a.templateSourceFactory("components/bubble_dialog/group/creation"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:d,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:l}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.GroupCreationBubbleDialogDirective=c;let l=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i}$onInit(){this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent(n(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(n(document),"mousedown",e=>this.handleMouseDown(e)),this.saving=!1,this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}close(){this.facade.destroy()}async save(){this.saving=!0;try{const e=await this.payload.saveOperation(this.name);this.facade.onMessage.fire({category:{name:e.name,mapped_id:e.mapped_id}}),this.close()}catch(e){e instanceof Error||(this.fieldMessages=e.field_messages,this.saving=!1,this.applyScope())}}handleClick(e){this.protectFromClosing||this.$element.is(e.target)||0!==this.$element.has(e.target).length||o.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(o.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}};function d(){return{post(e,t){setTimeout(()=>{e.styleInformation.setAbsoluteY(window.innerHeight/2-t.height()/2),e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}l=__decorate([r.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],l)}),define("components/bubble_dialog/influencer/follower_info/directive",["require","exports","angular","angular_utilities","reusable_services","services/template_source"],function(e,t,i,n,s,o){function r(){return{templateUrl:o.templateSourceFactory("components/bubble_dialog/influencer/follower_info"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:c,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:a}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.InfluencerFollowerInfoDirective=r;let a=class{constructor(e){this.$rootScope=e,this.handleImageError=this.imageErrorHandler.bind(this)}$onInit(){this.displayErrorFallback=!1,this.parsedName=s.emojiService.parseTextForEmoji(this.payload.influencer.profile_data.name)}canShowFallbackImage(){return this.displayErrorFallback}imageErrorHandler(e,t){this.displayErrorFallback=!0,this.$rootScope.$$phase||this.$rootScope.$apply()}};function c(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}a=__decorate([n.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],a)}),define("components/bubble_dialog/mail_error/directive",["require","exports","services/template_source","services/tw_common","services/bubble_dialog"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"="},controller:t,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/bubble_dialog/mail_error"),compile:function(){return{pre:o,post:r}}};function t(e,t){function i(t){t.keyCode===n.twCommon.keys.ESCAPE&&e.close()}window.scrollTo(void 0,0),e.loaded=!1,e.error=void 0,e.canShowErrors=function(){return void 0!==e.error},e.errors=e.payload.filter(function(e){return!e.success}).map(function(e){return e.stacktraceOpen=!1,e}),e.toggleStackTrace=function(t,i){i.preventDefault(),i.stopPropagation(),e.errors.forEach(function(e){t!==e&&(e.stacktraceOpen=!1)}),t.stacktraceOpen=!t.stacktraceOpen},e.isLoaded=function(){return e.loaded},e.close=function(){s.bubbleDialogService.destroyAllNonPersistent()};let o=!0;function r(e){o=!$.contains(t[0],e.target)&&t[0]!==e.target}function a(i){o&&!n.twCommon.isPointOnElement({x:i.clientX,y:i.clientY},t)&&e.close()}function c(){$(document).off("mouseup",a),$(document).off("mousedown",r),$(document).off("keydown",i)}$(document).on("keydown",i),$(document).on("mouseup",a),$(document).on("mousedown",r),e.$on("$destroy",c),t.on("$destroy",c)}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/message/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/message"),compile:function(){return{pre:s,post:o}}};function t(e){e.cancelDestruction=function(){e.facade&&e.facade.cancelDestruction()},e.destroy=function(){e.facade&&!e.payload.persistent&&e.facade.scheduleDestruction(100)},i.isUndefined(e.payload.buttons)||e.payload.buttons.reverse(),e.isPrimary=function(e){return i.isFunction(e.isPrimary)&&e.isPrimary()},e.call=function(t,i){t.call(e,i)},e.close=function(){e.facade.destroy()}}function s(e,t){t.css({opacity:"0"})}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/months/directive",["require","exports","moment-timezone","services/template_source","services/bubble_dialog"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/months"),compile:function(){return{pre:o,post:r}}};function t(e,t){function n(){s.bubbleDialogService.destroyById(constants.bubble_dialog.id.months)}e.selectMonth=function(t,i){i.stopPropagation(),e.facade.onMessage.fire(t),n()},e.stopClicks=function(e){e.stopPropagation()},e.close=function(){n()},e.months=i.months()}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/new_dashboard/directive",["require","exports","angular","jquery","reusable_utilities","classes/context_data/context_data","services/custom_pages","services/tw_common","angular_utilities","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){function d(){return{templateUrl:l.templateSourceFactory("components/bubble_dialog/new_dashboard"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:u,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:g}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=d,t.NewDashboardDirective=d;let g=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.newGroupFieldShown=!1}$onInit(){this.newDashBoardGroupForm={label:""},this.groups=this.payload.groups.toProto(),this.add_action=constants.events.form.action.post,this.bottomBtn={name:o.contextData.getMessage("_569808")},this.protectFromClosing=!1,this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent(n(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(n(document),"mousedown",e=>this.handleMouseDown(e)),this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}async createNewDashBoardGroup(e){e.stopPropagation(),e.preventDefault();const t=(await r.customPagesService.createNewGroup(this.newDashBoardGroupForm.label)).groups;this.newDashBoardGroupForm.label="",this.groups=t,this.hideNewGroupField(),this.$rootScope.$$phase||this.$rootScope.$apply()}canSave(){return void 0!==this.groups&&void 0!==s.TopicMenuUtils.getFirstSelectedEntry(this.groups)}hideNewGroupField(){this.newGroupFieldShown=!1}displayNewGroupField(){s.TopicEntryUtils.setSelectionRecursive(this.groups.root_entry,!1),this.newGroupFieldShown=!0}close(){this.facade.onMessage.fire({save:!1}),this.facade.destroy()}save(){const e=this.payload.description_filters_allowed,t={title:this.payload.title,description:this.payload.description,dic:this.payload.dic,description_filters_allowed:e,groups:this.groups};this.facade.onMessage.fire({save:!0,result:t}),this.facade.destroy()}handleClick(e){this.protectFromClosing||a.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close(),this.protectFromClosing=!1}handleMouseDown(e){a.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}};function u(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}g=__decorate([c.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],g)}),define("components/bubble_dialog/react/articles_shortcuts_explanation_query",["require","exports","query_system","map","classes/context_data/context_data"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=new n.Map,r=s.contextData.userSettings.shortcuts.articles;o.set([r.toggle_important.toUpperCase()],s.contextData.getMessage("_1000408")),o.set([r.set_positive.toUpperCase()],s.contextData.getMessage("_1000405")),o.set([r.set_neutral.toUpperCase()],s.contextData.getMessage("_1000404")),o.set([r.set_negative.toUpperCase()],s.contextData.getMessage("_1000403")),o.set([r.custom_tag.toUpperCase()],s.contextData.getMessage("_1000401")),o.set([r.toggle_read.toUpperCase()],s.contextData.getMessage("_1000407")),o.set([r.toggle_checked.toUpperCase()],s.contextData.getMessage("_1000406")),o.set([r.show_source_panel.toUpperCase()],s.contextData.getMessage("_1000413")),o.set([r.show_author_panel.toUpperCase()],s.contextData.getMessage("_1000414")),o.set(["0 - 9"],s.contextData.getMessage("_1000415")),o.set(r.select_all.replace("meta","CTRL").toUpperCase().split(" "),s.contextData.getMessage("_1000402")),o.set(["▲"],s.contextData.getMessage("_1000409")),o.set(["▼"],s.contextData.getMessage("_1000410")),o.set(["►"],s.contextData.getMessage("_1000411")),o.set(["◄"],s.contextData.getMessage("_1000412")),t.articleShortcutsExplanationQuery=new i.ProviderQuery({keyMap:o,title:s.contextData.getMessage("_1000416")})}),define("queries/application_queries",["require","exports","query_system"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.queryApplicationGetMainPageState=[new i.TransformationQuery(e=>e.getPageState().toProto())]}),define("components/bubble_dialog/react/diff_history_query",["require","exports","common_constants","query_system","queries/application_queries","services/confirmation_service","classes/context_data/context_data","other/tw"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.topicHistoryQuery=function(e,t,c,l,d,g,u,p,h){const m=routes.controllers.tw.TWRestForm.get(i.source_context.project,a.tw.project_id,c,"search","","rform").url,_=routes.controllers.tw.TWRestForm.get(i.source_context.project,a.tw.project_id,c,"info","","rform").url,f=routes.controllers.tw.TWRestForm.get(i.source_context.project,a.tw.project_id,c,"override","","rform").url,y=routes.controllers.tw.TWRestForm.get(i.source_context.project,a.tw.project_id,c,"info","","rform").url,v={previous:constants.messages.previous,latest:constants.messages.latest,off:constants.messages.off,on:constants.messages.on};return new n.Query({history:[new n.ProviderQuery(e)],settings:{type:new n.ProviderQuery(c),asyncData:new n.ProviderQuery(!0),loadBatchSize:new n.ProviderQuery(10),displayType:new n.ProviderQuery(p),form:new n.ProviderQuery(h)},messages:new n.ProviderQuery(v),lastHistoryId:new n.ProviderQuery(l),projectId:[...s.queryApplicationGetMainPageState,"project","main_project_id"],topicId:new n.ProviderQuery(t),queryId:new n.ProviderQuery(u),endPoints:{loadHistoryEntry:new n.ProviderQuery(m),revertEntry:new n.ProviderQuery(f),loadMoreEntries:new n.ProviderQuery(_),loadDeletedEntries:new n.ProviderQuery(y)},showCompare:new n.ProviderQuery(d),showDeletedOption:new n.ProviderQuery(g),confirmFunctions:{revertConfirmation:new n.ProviderQuery(()=>o.confirmationService.display({message:r.contextData.getMessage("_1978945")}))},contextData:new n.ProviderQuery(r.contextData)})}}),define("components/bubble_dialog/rebuild_time_range/directive",["require","exports","angular","angular_utilities","reusable_utilities","services/rest_form_service","services/tw_common","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{templateUrl:a.templateSourceFactory("components/bubble_dialog/rebuild_time_range"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:d,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:l}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.RebuildTimeRangeDialogDirective=c;let l=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i}$onInit(){this.cancellationToken=new s.CancellationToken,this.initSubscriptions(),this.saving=!1,this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}async save(){this.saving=!0,await o.restFormService.post(this.payload.rule.recreate_rebuild_link,this.payload.rule),this.saving=!1,this.applyScope(),this.close()}canSave(){return void 0!==this.payload.rule.rebuild_time_range_menu&&void 0!==s.TopicMenuUtils.getFirstSelectedEntry(this.payload.rule.rebuild_time_range_menu)}close(){this.facade.destroy()}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}handleClick(e){this.protectFromClosing||r.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(r.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.addDomEvent($(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown(e))}};function d(){return{post(e,t){setTimeout(()=>{e.styleInformation.setAbsoluteY(window.innerHeight/2-t.height()/2),e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}l=__decorate([n.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],l)}),define("components/bubble_dialog/replay_speed/directive",["require","exports","services/tw_common","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/bubble_dialog/replay_speed"),compile:function(){return{pre:s,post:o}}};function t(t,n){t.setSpeed=function(i){e(function(){t.payload.replay.setSpeed(i)},0,!1),t.destroy()},t.isSelectedSpeed=function(e){return t.payload.replay.speed==e},t.cancelDestruction=function(){t.facade.cancelDestruction()},t.destroy=function(){t.facade.scheduleDestruction(100)},$(document).on("keydown",function(e){e.keyCode===i.twCommon.keys.ESCAPE&&t.destroy()}),$(document).on("click",function(e){i.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},n)||t.destroy()})}function s(e,t){t.css({opacity:"0"})}function o(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/rform/directive",["require","exports","services/template_source","services/rest_form_service","services/tw_common","services/bubble_dialog"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"="},controller:t,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/bubble_dialog/rform"),compile:function(){return{pre:r,post:a}}};function t(e,t){function i(t){t.keyCode===s.twCommon.keys.ESCAPE&&e.close()}e.loaded=!1,n.restFormService.get(e.payload.src.rform).then(function(t){e.formEntry=t,e.loaded=!0}),e.isLoaded=function(){return e.loaded},e.close=function(){o.bubbleDialogService.destroyAllNonPersistent()},e.send=function(){n.restFormService.post(e.formEntry.send_url,e.formEntry,constants.events.form.action.send).then(function(){e.close()})};let r=!0;function a(e){r=!$.contains(t[0],e.target)&&t[0]!==e.target}function c(i){r&&!s.twCommon.isPointOnElement({x:i.clientX,y:i.clientY},t)&&e.close()}function l(){$(document).off("mouseup",c),$(document).off("mousedown",a),$(document).off("keydown",i)}$(document).on("keydown",i),$(document).on("mouseup",c),$(document).on("mousedown",a),e.$on("$destroy",l),t.on("$destroy",l)}function r(e,t){t.css({opacity:"0"})}function a(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/search_query/edit/directive",["require","exports","angular","angular_utilities","services/template_source"],function(e,t,i,n,s){function o(){return{restrict:"EA",replace:!0,bindToController:{},compile:r,controllerAs:"vm",controller:a,templateUrl:s.templateSourceFactory("components/bubble_dialog/search_query/edit"),scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="}}}function r(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t)},0)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.SearchQueryEditBBDirective=o,t.Compile=r;let a=class{constructor(e,t){this.$element=e,this.$scope=t,this.save=this.saveEdition.bind(this),this.cancel=this.cancelEdition.bind(this)}saveEdition(){this.close()}cancelEdition(){this.close()}close(){this.$scope.facade.destroy()}};a=__decorate([n.ngInject(["$element","$scope"]),__metadata("design:paramtypes",[Object,Object])],a),t.SearchQueryEditBBController=a}),define("components/bubble_dialog/smtptest/directive",["require","exports","services/template_source","services/tw_common","services/rest_form_service","services/bubble_dialog"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"="},controller:t,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/bubble_dialog/smtptest"),compile:function(){return{pre:r,post:a}}};function t(e,t){function i(t){t.keyCode===n.twCommon.keys.ESCAPE&&e.close()}window.scrollTo(void 0,0),e.loaded=!1,e.error=void 0,e.canShowErrors=function(){return void 0!==e.error},s.restFormService.get(window.form_entry.send_test_email_links.edit_link).then(function(t){e.mail_form.recipient_email=t.recipient_email},function(){console.error(arguments)}),e.mailValidationPattern=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,e.submit=function(){e.error=void 0,e.mail_form.$valid&&""!==window.mail_form.recipient_email&&s.restFormService.post(window.form_entry.send_test_email_links.send_link,{recipient_email:e.mail_form.recipient_email}).then(function(){e.close()},function(t){e.$applyAsync(function(){e.error=t})})},e.isLoaded=function(){return e.loaded},e.close=function(){o.bubbleDialogService.destroyAllNonPersistent()};let r=!0;function a(e){r=!$.contains(t[0],e.target)&&t[0]!==e.target}function c(i){r&&!n.twCommon.isPointOnElement({x:i.clientX,y:i.clientY},t)&&e.close()}function l(){$(document).off("mouseup",c),$(document).off("mousedown",a),$(document).off("keydown",i)}$(document).on("keydown",i),$(document).on("mouseup",c),$(document).on("mousedown",a),e.$on("$destroy",l),t.on("$destroy",l)}function r(e,t){t.css({opacity:"0"})}function a(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/bubble_dialog/tag/creation/directive",["require","exports","angular","reusable_utilities","angular_utilities","services/rest_form_service","jquery","services/tw_common","classes/context_data/context_data","services/template_source","reusable_components"],function(e,t,i,n,s,o,r,a,c,l,d){function g(){return{templateUrl:l.templateSourceFactory("components/bubble_dialog/tag/creation"),replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:p,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:u}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=g,t.TagCreationDialogDirective=g;let u=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.newGroupFieldShown=!1}$onInit(){this.cancellationToken=new n.CancellationToken,this.initSubscriptions(),this.bottomBtn={name:c.contextData.getMessage("_1904802")},this.saving=!1,this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}async save(){this.saving=!0;const e=n.TopicMenuUtils.getFirstSelectedEntry(this.payload.groupsMenu);let t;try{t=await this.requestTagCreation(this.payload.tagName,!1,e),this.facade.onMessage.fire({newTag:t.tag,newGroup:this.newGroupTag}),this.close()}catch(e){}this.saving=!1,this.applyScope()}async createNewGroup(e){e.stopPropagation(),e.preventDefault();const t=await this.requestTagCreation(this.newGroupForm.label,!0);this.newGroupTag=t.tag;const i={name:this.newGroupForm.label,mapped_id:t.tag.code};this.addGroupToMenu(i),n.TopicEntryUtils.recursiveUnselectAndSelect(this.payload.groupsMenu.root_entry,i.mapped_id),this.newGroupForm.label="",this.hideNewGroupField(),this.applyScope()}hideNewGroupField(){this.newGroupFieldShown=!1}displayNewGroupField(){n.TopicEntryUtils.setSelectionRecursive(this.payload.groupsMenu.root_entry,!1),this.newGroupFieldShown=!0}canSave(){return void 0!==this.payload.groupsMenu&&void 0!==n.TopicMenuUtils.getFirstSelectedEntry(this.payload.groupsMenu)}close(){this.facade.destroy()}requestTagCreation(e,t,i){const n=void 0!==i?{name:i.name,code:i.mapped_id}:void 0;return o.restFormService.post(o.restFormService.getRFormUrl("tag_management","add"),{tag:{name:e,parent:n},is_group:t})}addGroupToMenu(e){void 0===this.payload.groupsMenu.root_entry.children&&(this.payload.groupsMenu.root_entry.children=[]),this.payload.groupsMenu.root_entry.children.push(e)}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}handleClick(e){this.protectFromClosing||a.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.close(),this.protectFromClosing=!1}handleMouseDown(e){const t={x:e.clientX,y:e.clientY};(a.twCommon.isPointOnElement(t,this.$element)||this.$element.is(e.target)||this.$element.has(e.target).length>0)&&(this.protectFromClosing=!0),this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}initSubscriptions(){this.cancellationToken.addDomEvent(r(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(r(document),"mousedown",e=>this.handleMouseDown(e))}getPattern(){return d.tagOrTagGroupRegex}};function p(){return{post(e,t){setTimeout(()=>{e.styleInformation.setAbsoluteY(window.innerHeight/2-t.height()/2),e.styleInformation.apply(e.referenceElement,t),t.find("input:first").focus()},0)}}}u=__decorate([s.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],u)}),define("components/bubble_dialog/tooltip/directive",["require","exports","services/template_source"],function(e,t,i){function n(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,templateUrl:i.templateSourceFactory("components/bubble_dialog/tooltip"),compile:function(){return{pre:function(e,t){t.css({opacity:"0"})},post:function(t,i){e(()=>t.styleInformation.apply(t.referenceElement,i),0,!1)}}}};function t(e,t){e.cancelDestruction=function(){e.payload.dispose&&e.facade.cancelDestruction()},e.destroy=function(){e.payload.dispose&&e.facade.scheduleDestruction(100)},e.call=function(t,i){t.call(e,i)},e.close=function(){e.facade.destroy()}}}Object.defineProperty(t,"__esModule",{value:!0}),n.$inject=["$timeout"],t.default=n,t.BarsDirective=n}),define("components/bubble_dialog/widget_menu/directive",["require","exports","angular","angular_utilities","reusable_utilities","services/bubble_dialog","services/tw_common","services/template_source"],function(e,t,i,n,s,o,r,a){function c(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t)},0)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"="},templateUrl:a.templateSourceFactory("components/bubble_dialog/widget_menu"),compile:function(){return{post:c}},controller:l}};let l=class{constructor(e,t){this.$element=e,this.$scope=t}$onInit(){this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent($(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown()),this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}handleClick(e){const t=this.$element.find(".dropdown-menu");r.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||t.is(e.target)||0!==t.has(e.target).length||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&o.bubbleDialogService.destroyById("widget_menu")}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}};l=__decorate([n.ngInject(["$element","$scope"]),__metadata("design:paramtypes",[Object,Object])],l),t.WidgetMenuController=l}),define("components/bulletin/directive",["require","exports","underscore","moment-timezone","classes/context_data/context_data","services/bulletin","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=s.contextData,c=o.bulletinService;t.default=[function(){return{replace:!0,restrict:"A",scope:{},controller:["$scope","$element",function(e,t){function s(i){e.open&&!t.is(i.target)&&0===t.has(i.target).length&&e.$apply(function(){e.open=!1})}function o(){return c.get()}function r(){return i.filter(o(),function(e){return e.status===constants.bulletin_message.status.not_read}).length}function l(){$(document).off("click",s)}e.oldSize=0,e.open=!1,$(document).on("click",s),e.$on("$destroy",l),e.toggle=function(t){e.open=!e.open,e.oldSize=r(),t.stopPropagation()},e.getEntriesToShow=function(){return o()},e.getBadgeNumber=function(){return r()-e.oldSize},e.getNoEntriesMsg=function(){return window.messages.get("_980845")},e.hasNoEntries=function(){return 0===o().length},e.isRead=function(e){return e.status===constants.bulletin_message.status.read},e.clickHandler=function(e,t){(i.isUndefined(e.details_url)||0===e.details_url.length)&&t.preventDefault(),function(e){e.status===constants.bulletin_message.status.not_read&&(e.status=constants.bulletin_message.status.read,c.dismiss(e.id))}(e)},e.markAllRead=function(e){e.preventDefault(),e.stopPropagation();const t=i.map(o(),function(e){return e.status=constants.bulletin_message.status.read,e.id});c.dismissAll(t)},e.getCreationDate=function(e){const t=a.commonPropertiesContainer.date_format;return n(e.creation_ts).format(t.date_format+" "+t.time_format)},e.canShowImage=function(e){return void 0!==e.image_url&&e.image_url.length>0}}],templateUrl:r.templateSourceFactory("components/bulletin")}}]}),define("components/calendar/directive",["require","exports","services/broker","services/tw_common","reusable_utilities","services/configuration","moment-timezone","classes/context_data/context_data","services/navbar","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","classes/application/application","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:m.templateSourceFactory("components/calendar"),restrict:"AE",scope:{},controllerAs:"vm",bindToController:{userFilterSettings:"=ufs",toggleAndUnselectEvents:"&",isEventsSelected:"&",embed:"=?",blackoutFunc:"=?",noInputs:"=?"},controller:f}};class f{constructor(e,t,i,n,s){this.$scope=e,this.$element=t,this.Calendar=i,this.calendarService=n,this.timeService=s}$onInit(){this.cancellationToken=new s.CancellationToken,this.$scope.$on("$destroy",()=>this.dispose()),this.$element.on("$destroy",()=>this.dispose()),this.timeFilter=this.userFilterSettings.getTimeFilter(),this.createCalendar(),i.brokerService.subscribe(constants.events.time_filter.select.range,e=>{void 0!==e&&this===e&&this._updateCalendar()},this.cancellationToken)}dispose(){this.cancellationToken.cancel(),this.calendar.dispose()}createCalendar(){const e={months:2,viewStartDate:r(this.timeFilter.getFrom()),mode:"range",direction:a.contextData.projectSettings.calendar_direction,format:"YYYY-MM-DD"};_.isUndefined(this.blackoutFunc)||(e.blackout=this.blackoutFunc),this.calendar=new this.Calendar(this.$element.find('div[id="time-calendar"]'),e),this.calendar.subscribe("date-clicked",()=>{setTimeout(()=>{this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData(),this.$scope.$$phase||this.$scope.$apply()})},100),this._updateCalendar()}getShortDateFrom(){return r(this.timeFilter.getFrom()).format(a.contextData.commonPropertiesContainer.date_format.short_date_format)}getShortDateTo(){return parseInt(this.timeFilter.getDayTime().to.hours,10)>=24?r(this.timeFilter.getTo()-1e3).format(a.contextData.commonPropertiesContainer.date_format.short_date_format):r(this.timeFilter.getTo()).format(a.contextData.commonPropertiesContainer.date_format.short_date_format)}setDefaultFromHours(){if(!_.isUndefined(this.timeFilter.getDayTime().from.hours)&&0===this.timeFilter.getDayTime().from.hours.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesFrom();this.timeFilter.getDayTime().from.hours=e.hours,this.fromHoursChanged()}}setDefaultFromMinutes(){if(!_.isUndefined(this.timeFilter.getDayTime().from.minutes)&&0===this.timeFilter.getDayTime().from.minutes.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesFrom();this.timeFilter.getDayTime().from.minutes=e.minutes,this.fromMinutesChanged()}}setDefaultFromSeconds(){if(!_.isUndefined(this.timeFilter.getDayTime().from.seconds)&&0===this.timeFilter.getDayTime().from.seconds.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesFrom();this.timeFilter.getDayTime().from.seconds=e.seconds,this.fromSecondsChanged()}}setDefaultToHours(){if(!_.isUndefined(this.timeFilter.getDayTime().to.hours)&&0===this.timeFilter.getDayTime().to.hours.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesTo();this.timeFilter.getDayTime().to.hours=e.hours,this.toHoursChanged()}}setDefaultToMinutes(){if(!_.isUndefined(this.timeFilter.getDayTime().to.minutes)&&0===this.timeFilter.getDayTime().to.minutes.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesTo();this.timeFilter.getDayTime().to.minutes=e.minutes,this.toMinutesChanged()}}setDefaultToSeconds(){if(!_.isUndefined(this.timeFilter.getDayTime().to.seconds)&&0===this.timeFilter.getDayTime().to.seconds.length){const e=o.configurationService.getCalendarConfiguration().getDefaultTimeValuesTo();this.timeFilter.getDayTime().to.seconds=e.seconds,this.toSecondsChanged()}}fromHoursChanged(){this.isTimeValid()&&(this.calendarService.fromHoursChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}toHoursChanged(){this.isTimeValid()&&(this.calendarService.toHoursChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}fromMinutesChanged(){this.isTimeValid()&&(this.calendarService.fromMinutesChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}toMinutesChanged(){this.isTimeValid()&&(this.calendarService.toMinutesChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}fromSecondsChanged(){this.isTimeValid()&&(this.calendarService.fromSecondsChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}toSecondsChanged(){this.isTimeValid()&&(this.calendarService.toSecondsChanged(this.timeFilter.getDayTime(),this.calendar),this._onCalendarChange(),this.embed||c.navbarService.getFilterState()!==c.FilterState.CLOSE||this.refreshPageData())}_onCalendarChange(){this._applyTimeFilter(),this.isEventsSelected()&&this.toggleAndUnselectEvents()}_applyTimeFilter(){this.hideDayTime=!1;const e=r(_.first(this.calendar.getSelectedAsDates()));e.hour(Number(this.timeFilter.getDayTime().from.hours)).minute(Number(this.timeFilter.getDayTime().from.minutes)).second(Number(this.timeFilter.getDayTime().from.seconds)).millisecond(0);const t=r(_.last(this.calendar.getSelectedAsDates()));t.hour(Number(this.timeFilter.getDayTime().to.hours)).minute(Number(this.timeFilter.getDayTime().to.minutes)).second(Number(this.timeFilter.getDayTime().to.seconds)).millisecond(0);let n=e.toDate().getTime();const s=t.toDate().getTime();if(n>=s){const i=e.diff(t);e.subtract(i,"milliseconds"),e.subtract(1,"hours"),n=e.toDate().getTime()}this.timeFilter.setTimeRange(n,s,!this.noInputs),this.userFilterSettings.checkFiltersChanged(),this.embed||i.brokerService.publish(constants.events.time_filter.select.range,[this])}_updateIfDifferent(e,t){const i=this.calendar.getSelectedAsDates();if(1===i.length){if(t.isSame(i[0].getTime(),"day"))return}else if(2===i.length&&e.isSame(i[0].getTime(),"day")&&t.isSame(i[1].getTime(),"day"))return;this.calendar.setSelected([e.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")])}_updateCalendar(){if(void 0===this.timeFilter.getFrom())return this.hideDayTime=!0,void this.calendar.setSelected([]);this.hideDayTime=!1;const e=r(this.timeFilter.getFrom()),t=r(this.timeFilter.getTo());this.timeFilter.getDayTime().from.hours=n.twCommon.formatNumberMinSize(e.hours(),2),this.timeFilter.getDayTime().from.minutes=n.twCommon.formatNumberMinSize(e.minutes(),2),this.timeFilter.getDayTime().from.seconds=n.twCommon.formatNumberMinSize(e.seconds(),2),0===t.hours()&&0===t.minutes()&&0===t.seconds()&&t.toDate().getTime()>e.toDate().getTime()?(this.timeFilter.getDayTime().to.hours="24",this.timeFilter.getDayTime().to.minutes="00",this.timeFilter.getDayTime().to.seconds="00",t.subtract(1,"days")):(this.timeFilter.getDayTime().to.hours=n.twCommon.formatNumberMinSize(t.hours(),2),this.timeFilter.getDayTime().to.minutes=n.twCommon.formatNumberMinSize(t.minutes(),2),this.timeFilter.getDayTime().to.seconds=n.twCommon.formatNumberMinSize(t.seconds(),2)),void 0!==this.calendar&&this._updateIfDifferent(e,t)}isTimeValid(){return _.all(["to.seconds","to.minutes","to.hours","from.seconds","from.minutes","from.hours"],e=>{const t=e.split(".").reduce((e,t)=>e[t],this.timeFilter.getDayTime());return void 0!==t&&2===t.length})}async refreshPageData(){if(g.mainApplication.hasPageState()&&g.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp()&&g.mainApplication.getPageState().getWidgets().length>0&&g.mainApplication.getPageState().getWidgets()[0].isDocumentCluster()&&g.mainApplication.getPageState().getWidgets()[0].hasPayloadValue()&&g.mainApplication.getPageState().getWidgets()[0].getPayloadValue().graph)return;const e={strategy:d.ModelRefreshStrategy.REFRESH,delay:a.contextData.projectSettings.slow_refresh_timeout},t=p.modelRefreshDecoratorFactory.getDecorator(g.mainApplication.getPageState(),g.mainApplication,h.ModelType.PAGE_STATE,e);try{await l.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&u.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}}f.$inject=["$scope","$element","Calendar","calendarService","timeService"]}),define("components/captchas/simple_math/simple_math_captcha.css",["require","exports","css_modules"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.simpleMathCaptchaStyleModel={captchaImageContainer:{marginBottom:20},captchaImage:{width:"100%"}},t.simpleMathCaptchaStyle=i.createCssModule(()=>t.simpleMathCaptchaStyleModel).compute({}).attach().getModule()}),define("components/captchas/simple_math/directive",["require","exports","components/captchas/simple_math/simple_math_captcha.css","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{formEntry:"="},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("components/captchas/simple_math"),scope:{}}};class s{constructor(){this.style=i.simpleMathCaptchaStyle}}}),define("components/stateless_screen/section/command_center/directive",["require","exports","services/command_center","wrappers/content_structure/content_structure_entry_wrapper","services/modal","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r){function a(){return{replace:!0,restrict:"A",bindToController:{section:"=",pageData:"="},controllerAs:"vm",scope:{},controller:c,templateUrl:r.templateSourceFactory("components/stateless_screen/section/command_center")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.CommandCenterSectionDirective=a,t.CommandCenterSettings={maxTitleLength:30,maxDescriptionLength:30};class c{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.styleType=constants.floating_content_structure.type.colored_section_block;const e=[()=>this.initialized=!1,this.$scope.$on("UPDATE_COMMAND_CENTER",(e,t)=>{e.stopPropagation(),this.addToSection(t)}),this.$scope.$on("$destroy",()=>e.forEach(e=>e())),this.$scope.$watch(()=>void 0!==this.section&&void 0!==this.section.getContent(),e=>{this.initialized||!0!==e||this.initialize()})]}createPermissions(e){return{canRename:!0,canEdit:this.section.getContent().isEditable(),canDelete:!0,canClone:e.cloning_enabled}}initialize(){this.selectFirstChild(),this.permissions=this.createPermissions(this.pageData),this.initialized=!0}selectFirstChild(){const e=void 0!==this.section&&this.section.getContent();if(e&&e.getRootEntry().hasChildren()){_.first(e.getRootEntry().getChildren()).setSelected(!0)}}getStateIconNormal(){return this.section.getStateIconNormal()}createCommandCenter(e){e.preventDefault(),i.commandCenterService.getDefaultCommandCenterSettings().then(e=>{this.formEntry=e,s.modalService.display("GENERIC_TEXT_INPUT",this.constructModalData()).then(e=>{const[t,n,s,o,r]=e;i.commandCenterService.createCommandCenter({title:t,stylesheets:s,description:n,background_image:o,background_image_placeholder:r}).then(this.addToSection.bind(this))})})}addToSection(e){const t=this.section.getContent();if(t){const i=new n.ContentStructureEntryWrapper(e.content_entry,this.section.toProto());t.addEntry(i)}}constructModalData(){return{title:o.contextData.getMessage("_1444455"),fields:[{name:o.contextData.getMessage("_1444450"),initialValue:"",errorTooLong:o.contextData.getMessage("_1444451",[t.CommandCenterSettings.maxTitleLength]),errorEmpty:o.contextData.getMessage("_1444452"),maxLength:t.CommandCenterSettings.maxTitleLength,autoFocus:!0},{name:o.contextData.getMessage("_1444453"),initialValue:"",errorTooLong:o.contextData.getMessage("_1444454",[t.CommandCenterSettings.maxDescriptionLength]),required:!1,maxLength:t.CommandCenterSettings.maxDescriptionLength},{name:o.contextData.getMessage("_1885611"),type:"single_select",initialValue:this.formEntry.stylesheets},{name:o.contextData.getMessage("_463888"),type:"file_upload",initialValue:this.formEntry.background_image,placeholder:this.formEntry.background_image_placeholder}]}}}c.$inject=["$scope","$element"],t.CommandCenterSectionController=c}),define("components/command_center/block/directive",["require","exports","angular","angular_utilities","reusable_utilities","classes/context_data/context_data","services/command_center","services/confirmation_service","services/tw_routing","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){function d(){return{templateUrl:l.templateSourceFactory("components/command_center/block"),replace:!0,restrict:"AE",bindToController:{model:"=",section:"=",permissions:"=",draggableStrategy:"=?"},scope:!0,controllerAs:"vm",controller:g}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=d,t.CommandCenterBlockDirective=d;let g=class{constructor(e,t){this.$scope=t}$onInit(){this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent(window,"hashchange",e=>{this.model.getMappedId()===new s.Url(e.originalEvent.newURL).getUrlParameter("cc")&&(this.unselectSiblings(),this.model.setSelected(!0))}),void 0!==this.draggableStrategy&&(this.draggableStrategy.setFloatingContentStructure(this.section),this.draggableStrategy.setDropzoneConfig("[special-dropzone]",(e,t)=>-1===e.scope.model.children.indexOf(t))),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}canRenameCommandCenter(){return this.permissions.canRename}canDeleteCommandCenter(){return this.permissions.canDelete}canCloneCommandCenter(){return this.permissions.canClone}clone(e){e.stopPropagation(),this.$scope.$emit("CLONE_COMMAND_CENTER")}getTitle(){return this.model.getTitle()}getDescription(){return this.model.getDescription()}getStateIcon(){return this.model.getStateIcon()}toggleCollapse(){this.unselectSiblings(),this.model.toggleSelection(),this.model.isSelected()?c.twRoutingService.setUrlParameter("cc",this.model.getMappedId()):c.twRoutingService.removeUrlParameter("cc")}unselectSiblings(){this.getAllSiblings().forEach(e=>{e.setSelected(!1)})}toggleView(){!0===this.section.isEditing()?(this.unselectSiblings(),this.model.setSelected(!0)):this.toggleCollapse(),this.section.setEditing(!1)}getAllSiblings(){return this.section.getContent().getRootEntry().getChildren().filter(e=>e.getMappedId()!==this.model.getMappedId())}getWidth(){return 3}isSelected(){return this.model.isSelected()}delete(e){e.preventDefault(),e.stopPropagation(),a.confirmationService.display({message:o.contextData.getMessage("_1444464")}).then(()=>r.commandCenterService.removeCommandCenter({custom_page_id:this.model.getMappedId()})).then(()=>{this.section.getContent().removeEntry(this.model)},()=>void 0)}edit(e){e.preventDefault(),e.stopPropagation(),this.unselectSiblings(),this.isSelected()?this.section.setEditing(!this.section.isEditing()):(this.model.setSelected(!1),this.section.setEditing(!1),setTimeout(()=>{this.model.setSelected(!0),this.section.setEditing(!0)}))}isEditing(){return this.isSelected()&&this.section.isEditing()}};g=__decorate([n.ngInject(["$rootScope","$scope"]),__metadata("design:paramtypes",[Object,Object])],g),t.CommandCenterBlockController=g}),define("components/command_center/home/directive",["require","exports","angular","angular_utilities","reusable_utilities","services/modal","classes/draggable/strategy/draggable_command_centers_strategy","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{templateUrl:a.templateSourceFactory("components/command_center/home"),replace:!1,restrict:"AE",bindToController:{model:"=",permissions:"="},controllerAs:"vm",controller:l,scope:!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.CommandCenterHomeDirective=c;let l=class{constructor(e){this.$scope=e}$onInit(){this.model.setStyleType(constants.floating_content_structure.type.colored_section_block),this.model.overrideEntriesPerRow(12,4),this.draggableStrategy=new r.DraggableCommandCentersStrategy(!0);const e=[this.$scope.$on("CLONE_COMMAND_CENTER",e=>this.cloneCommandCenter(e)),this.$scope.$on("CLONE_COMMAND_CENTER_SCREEN",(e,t)=>this.cloneCommandCenterScreen(e,t)),()=>this.draggableStrategy.dispose(),this.$scope.$on("$destroy",()=>e.forEach(e=>e()))];if(this.hasContent())this.setInitialSelection();else{const e=this.$scope.$watch(()=>this.getContent(),t=>{void 0!==t&&(e(),this.setInitialSelection())})}}cloneCommandCenter(e){e.stopPropagation();const t={commandcenterMappedId:this.getSelectedCommandCenterMappedId()};o.modalService.display("CLONE_COMMAND_CENTER",t,{}).then(e=>this.$scope.$emit("UPDATE_COMMAND_CENTER",e))}cloneCommandCenterScreen(e,t){e.stopPropagation();const i={commandcenterMappedId:this.getSelectedCommandCenterMappedId(),screenData:t};o.modalService.display("CLONE_COMMAND_CENTER_SCREEN",i,{}).then(e=>{this.$scope.$broadcast("UPDATE_COMMAND_CENTER_SCREEN",e)})}getSelectedCommandCenterMappedId(){return this.model.getContent().getRootEntry().getFirstSelectedEntry().getMappedId()}hasModel(){return void 0!==this.getModel()}getModel(){return this.model}getContent(){return this.model.getContent()}hasContent(){return void 0!==this.getContent()}getWidth(){return this.getModel().getWidth()}getCategoryWidth(){return this.model.getCategoryWidth()}hasChildren(){return this.hasContent()&&this.getChildren().length>0}getChildren(){return this.hasContent()?this.getContent().getRootEntry().getChildren():void 0}getRows(){return this.hasContent()?this.model.getRows(this.getChildren()):void 0}getRowEntries(e){return this.hasContent()?this.model.getRowEntries(e,this.getChildren()):void 0}getSelectedCategory(e){return _(this.getRowEntries(e)).find(e=>e.isSelected())}hasSelectedCategory(e){return void 0!==this.getSelectedCategory(e)}getFormEntryUrl(e){return this.hasSelectedCategory(e)?this.getSelectedCategory(e).getAlternateUrl(!1):void 0}isEditing(){return this.hasModel()&&this.getModel().isEditing()}setInitialSelection(){const e=new s.Url(location.href).getUrlParameter("cc");if(e&&this.hasContent()){const t=this.getContent().getRootEntry().getChildren();t&&t.find(t=>t.getMappedId()===e)&&t.forEach(t=>t.setSelected(t.getMappedId()===e))}}};l=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],l),t.CommandCenterHomeController=l}),define("components/command_center/home/screen/directive",["require","exports","angular","classes/context_data/context_data","classes/grid/grid","classes/grid/grid_configuration","classes/grid/grid_slot_item","services/command_center","services/confirmation_service","services/theme","services/tw_common","services/tw_routing","wrappers/page_state/page_state_wrapper","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){function h(){return{templateUrl:p.templateSourceFactory("components/command_center/home/screen"),replace:!0,restrict:"E",scope:!0,controllerAs:"vm",controller:m,bindToController:{model:"=",info:"=",permissions:"=",draggableStrategy:"=",removeCallback:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=h,t.CommandCenterHomeScreenDirective=h;class m{constructor(e){this.$scope=e}$onInit(){this.initializeWidgetGrid(),this.model.setDropZoneConfiguration([d.twCommon.sides.TOP,d.twCommon.sides.BOTTOM,d.twCommon.sides.CENTER])}initializeWidgetGrid(){if(void 0!==this.info&&void 0!==this.info.page_state){this.info.page_state.data_input_configuration.forEach(e=>{e.payload={type:constants.payload_type.payload_external_data}});const e=new u.PageStateWrapper(this.info.page_state,void 0,!1);if(this.widgets=e.getWidgets(),void 0!==this.info.page_state.screen_configuration){const t={id:"grid",width:this.info.page_state.screen_configuration.grid_width,height:this.info.page_state.screen_configuration.grid_height,dropzonePlaceholders:{},restrictedAreas:[],gridItemOptions:{showPlaceholder:o.PlaceholderMode.ALWAYS,interactive:!0},style:{grid:{},items:{showOutline:!0},background:{backgroundImage:this.info.page_state.screen_configuration.background_image}}};this.grid=new s.Grid(t),this.grid.addItems(r.GridSlotItem.generateSlotItems(this.widgets,r.GridSlotItem.getWidgetByIdFunction(e)))}this.$scope.$on("$destroy",()=>{this.widgets=void 0,e.dispose()})}}canCloneCommandCenterScreen(){return this.canEdit()&&this.permissions.canClone}getTitle(){return this.model.getTitle()}getDescription(){return this.model.getDescription()}getUrl(){return this.model.getAlternateUrl(!1)}getEditUrl(){return this.model.getUrl(!1)}getResolution(){return i.isDefined(this.info)?this.info.resolution_name:""}canEdit(){return!0===this.model.isEditable()}editScreen(e){e.preventDefault(),this.canEdit()&&g.twRoutingService.changePageByUrl(this.getEditUrl())}openScreen(e){e.preventDefault(),this.onEnterFullscreen()}async onEnterFullscreen(){let e;this.defaultTheme=l.themeService.getDefaultTheme();const{stylesheet:t}=this.info.screen_settings;void 0!==t&&t!==this.defaultTheme.cssFile&&(e=l.themeService.findThemeByCSSFile(t)),await a.commandCenterService.enterFullscreenMode(this.getUrl(),e)}removeScreen(e){e.preventDefault(),this.canEdit()&&this.info.mapped_id&&c.confirmationService.display({message:n.contextData.getMessage("_1444458")}).then(()=>a.commandCenterService.removeScreen({custom_page_id:this.info.mapped_id})).then(()=>this.removeCallback(this.info.mapped_id),()=>void 0)}getScreenResolutionClass(){return void 0!==this.info?"res-"+this.info.screen_settings.screen_resolution.toLowerCase():void 0}getWidgets(){return this.widgets}hasGrid(){return void 0!==this.getGrid()}getGrid(){return this.grid}hasGridConfiguration(){return this.hasGrid()&&void 0!==this.getGridConfiguration()}getGridConfiguration(){return this.grid.getConfiguration()}getOpenButtonText(){return n.contextData.getMessage("_1444460")}getEditButtonText(){return n.contextData.getMessage("_1444461")}handleCloneScreenClick(e){e.stopPropagation(),this.$scope.$emit("CLONE_COMMAND_CENTER_SCREEN",this.model)}}m.$inject=["$scope"],t.CommandCenterHomeScreenController=m}),define("components/command_center/home/screens/directive",["require","exports","lazy","services/command_center","services/loading_bubble","services/rest_form_service","wrappers/content_structure/content_structure_entry_wrapper","classes/draggable/strategy/draggable_command_center_screens_strategy","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d={maxNameLength:24,descriptionRequired:!1,maxDescriptionLength:100};function g(){return{replace:!1,restrict:"AE",bindToController:{model:"=",section:"=",permissions:"="},controllerAs:"vm",controller:u,templateUrl:l.templateSourceFactory("components/command_center/home/screens"),scope:{}}}t.default=g,t.CommandCenterHomeScreensDirective=g;class u{constructor(e,t){this.$scope=e,this.modalService=t}$onInit(){this.fetchScreenInformation(),this.setupDraggableStrategy();const e=[this.$scope.$watch(()=>this.model.getUrl(!1),(e,t)=>{i([void 0,t]).contains(e)||(this.screenInfos=void 0,this.fetchScreenInformation())}),this.$scope.$on("UPDATE_COMMAND_CENTER_SCREEN",(e,t)=>{this.fetchScreenInformation(),this.addScreen(t)}),this.$scope.$on("$destroy",()=>e.forEach(e=>e()))];this.onRemove=this.removeScreen.bind(this)}fetchScreenInformation(){s.loadingBubbleService.showSpinner(),o.restFormService.get(this.model.getUrl(!1)).then(e=>{this.screenInfos=e.screen_infos,s.loadingBubbleService.hideSpinner()})}removeScreen(e){const t=this.screenInfos.findIndex(t=>t.mapped_id===e);-1!==t&&(this.screenInfos.splice(t,1),this.model.removeChildAt(t))}isDoneLoading(){return void 0!==this.screenInfos}getCommandCenterMappedId(){return this.model.getMappedId()}getScreens(){return this.model.getChildren()}hasScreens(){const e=this.getScreens();return void 0!==e&&e.length>0}getScreenInfo(e){if(void 0!==this.screenInfos)return this.screenInfos[e]}getButtonText(){return c.contextData.getMessage("_1444459")}createScreen(){n.commandCenterService.getCommandCenterScreenInfo().then(e=>this.modalService.display("GENERIC_TEXT_INPUT",this.constructModalData(e)).then(t=>{const[i,s,o,r]=t,a=this.selectCommandCenter(e);return n.commandCenterService.createScreen({command_centers:a,resolution:o,title:i,description:s,stylesheets:r})})).then(e=>{this.fetchScreenInformation(),this.addScreen(e)})}addScreen(e){const t=new r.ContentStructureEntryWrapper(e.content_entry,this.model.getSection());this.model.addChild(t)}selectCommandCenter(e){const{command_centers:t}=e;return t.root_entry.children.find(e=>e.mapped_id===this.getCommandCenterMappedId()).selected=constants.topic_entry.selected.node,t}constructModalData(e){return e.resolution.root_entry.children[0].selected=constants.topic_entry.selected.node,{title:"New Command Center Screen",fields:[{name:c.contextData.getMessage("_1885606"),description:c.contextData.getMessage("_1885607"),type:"input",maxLength:d.maxNameLength,initialValue:"",errorEmpty:"This field is required",errorTooLong:c.contextData.getMessage("_868253",[d.maxNameLength]),autoFocus:!0},{name:c.contextData.getMessage("_1885608"),description:c.contextData.getMessage("_1885609"),type:"input",maxLength:d.maxDescriptionLength,initialValue:"",required:d.descriptionRequired,errorEmpty:"This field is required",errorTooLong:c.contextData.getMessage("_868253",[d.maxDescriptionLength])},{name:c.contextData.getMessage("_1885610"),type:"single_select",initialValue:e.resolution},{name:c.contextData.getMessage("_1885611"),type:"single_select",initialValue:e.stylesheets}]}}setupDraggableStrategy(){this.draggableStrategy=new a.DraggableCommandCenterScreensStrategy(!0),this.draggableStrategy.setFloatingContentStructure(this.section)}}u.$inject=["$scope","modalService"],t.CommandCenterHomeScreensController=u}),define("components/composed/directive",["require","exports","angular","canvas_chart_utilities","components/tools/data_graph","d3","lazy","reusable_utilities","underscore","widget_base","services/bubble_dialog","services/configuration","services/tw_common","services/widgets/widget_initializer","components/form/common/graph_helper","services/template_source","services/navigation","services/comments"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f){function y(e,t){return t&&-1!==t.indexOf(e)}Object.defineProperty(t,"__esModule",{value:!0});const v=y.bind(this,"AREA"),S=y.bind(this,"COLUMN_CHART"),b=y.bind(this,"LINE_CHART");function w(){y.$inject=["$element","$scope","$timeout","GraphSlicer"];let e,t,f=new a.CancellationToken;return{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"="},controller:y,templateUrl:m.templateSourceFactory("components/composed")};function y(m,y,w,C){let E,T,M;y.redrawWidget=me,y.type=y.widget.getGraphType(),y.secondaryType=y.widget.getNestedGraphType(),y.fragment.attach(y,m),y.fragment.cancellationToken.registerCleanupFunction(()=>h.clearCommentBubbles(O()));const P={},D=y.widget.getPageState().getProject().getId();h.getReloadFunction(me,y,m);let A,I;const x=constants.data_type,R={};R[x.column_chart_vertical_stacked]=constants.bar_chart.stacking.STACK,R[x.column_chart_vertical_perc]=constants.bar_chart.stacking.STACK_PERCENT,R[x.column_chart_vertical_stacked_perc]=constants.bar_chart.stacking.STACK_PERCENT,R[x.column_chart_vertical_not_stacked_perc]=constants.bar_chart.stacking.NONE_PERCENT;function F(){if(void 0===y.settings)return"font-size-normal";switch(y.settings.style.fontSize){case l.FontSize.SMALL:return"font-size-normal";case l.FontSize.MEDIUM:return"font-size-medium";case l.FontSize.LARGE:return"font-size-large";case l.FontSize.EXTRA_LARGE:return"font-size-extra-large"}return""}function O(){return{service:d.bubbleDialogService,styleService:g.configurationService.getBubbleDialogConfiguration(),styleType:constants.bubble_dialog.id.lines,menuStyle:g.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.context_menu).setArrowSide(u.twCommon.sides.TOP).setAbsoluteXOrigin(u.twCommon.sides.CENTER).setAbsoluteYOrigin(u.twCommon.sides.TOP)}}function k(e){y.widget&&y.widget.getPageState()&&!y.widget.getPageState().isEditMode()&&void 0!==y.graphSlicer&&y.graphSlicer.startSlice(e,y.widget)}function N(e){y.widget&&y.widget.getPageState()&&!y.widget.getPageState().isEditMode()&&y.graphSlicer.updateSlice(e)}function L(e){y.widget&&y.widget.getPageState()&&!y.widget.getPageState().isEditMode()&&y.graphSlicer.endSlice(e)}function B(e){y.widget&&y.widget.getPageState()&&!y.widget.getPageState().isEditMode()&&e.keyCode===u.twCommon.keys.ESCAPE&&y.graphSlicer.cancel()}function W(e,t){return e[t]=E.append("g").classed(t,!0),e}function U(e){return i.isUndefined(e.cut_off_type)}function G(e){return i.isDefined(e)}function j(){return y.widget.hasPayloadValue()&&y.widget.getPayloadValue().data_graph&&c.isUndefined(A)&&(A=new s.default(y.widget.getPayloadValue().data_graph)),A}function H(){return j()&&c.isUndefined(I)&&(I=new s.default(j().getDatasetFrame())),I}function q(e){return e?y.type:y.secondaryType}function V(e){return e.isClickable()}function z(e){if(S(q(e))){if(e)return y.widget.getDic().configuration_rendering.bar_chart.stacking_mode;{const e=y.widget.getMenu().getNestedGraphTypeMenu().getRootEntry().getChildren()[0];if(!c.isUndefined(e)&&e.containsSelection()){const t=e.getFirstSelectedEntry().getMappedId();return R[t]||constants.bar_chart.stacking.NONE}return constants.bar_chart.stacking.NONE}}return constants.bar_chart.stacking.NONE}function Y(){return constants.bar_chart.orientation.VERTICAL}function X(e){const t=y.widget.getExtendedConfiguration();return e?t.getYAxisConfiguration():t.getZAxisConfiguration()}function K(e,t,i,n){const s=function(e){if(!e&&H().isExternalDataFrame())return{fillOpacity:.4,strokeOpacity:.85,strokeDashArray:[4,2]}}(e),o=y.widget.getDic().primary_source.tw_data_source,r=X(e),a=z(e);return{isAdaptiveLegend:!e||o.adaptive_legend,canAddComments:i,hasLegendPaddingMin:(!t||!e)&&.95,isLegendAutoRenamed:n,isInPercent:o.resulting_values_in_percentage||"NONE_PERCENT"===a,isHorizontal:"HORIZONTAL"===Y(),stacking:a,isBarChart:!0,isComposedGraph:!0,timeInterval:c.isUndefined(o.x_axis)||o.x_axis.time_interval||"ordinal",isTranslated:y.widget.isTranslateAll(),style:s,truncateScale:r&&"TRUNCATE_MIN_MAX"===r.getAxisType(),logarithmicScale:r&&"LOGARITHMIC"===r.getAxisType()}}function Q(e,t,i,n){const s=function(e){if(!e&&H().isExternalDataFrame())return{strokeDashArray:[4,2]}}(e),o=y.widget.getDic().primary_source.tw_data_source,r=X(e);return{canAddComments:e||i,isLineChart:!0,isComposedGraph:!0,isAdaptiveLegend:!e||o.adaptive_legend,hasLegendPaddingMin:(!t||!e)&&.95,isLegendAutoRenamed:n,timeInterval:o.x_axis.time_interval,isInPercent:o.resulting_values_in_percentage,isTranslated:y.widget.isTranslateAll(),style:s,truncateScale:!1,logarithmicScale:r&&"LOGARITHMIC"===r.getAxisType()}}function J(e,t,i,n){return S(q(e))?K(e,t,!1,n):Q(e,t,i,n)}function Z(e){window.isExport||h.pointClick(e,_.navigationService,y.widget,y.widget.getDataGraph().isClickable())}function ee(e,t,i){!0!==window.isExport&&h.commentClick(e,_.navigationService,y.widget,!0,t,i)}function te(e){const t=y.widget.getDataGraph().getAdditionalFrames()[e];return i=>{window.isExport||h.pointClick(i,_.navigationService,y.widget,void 0!==t&&t.clickable,void 0,e)}}function ie(e){window.isExport||h.barClick(e,_.navigationService,y.widget,y.widget.getDataGraph().isClickable())}function ne(e,t,i,n,s,o){let r;if(S(q(t)))switch(z(t)){case"NONE_PERCENT":let i=0,l=0;oe(n,o).forEach(e=>{i=Math.max(i,e.reduce((e,t)=>(void 0!==t.value.value&&(e=Math.max(e,t.value.value),l+=t.value.value),e),0))});const d=i/l*100;r=d<=10?[0,Math.ceil(d)]:[0,10*Math.ceil(d/10)];break;case"NONE":r=a(e?c.flatten([n,s]):n);break;case"STACK":r=oe(n,o).map(function(e){return c.chain(e).pluck("value").pluck("value").reduce(se,0).value()});break;case"STACK_PERCENT":r=[0,100];break;default:throw new Error("invalid stacking mode")}else r=a(e?c.flatten([n,s]):n);if(i){const e=r[0],t=r[1];e>=0&&t>=0&&(r[0]=-t)}return r;function a(e){return c.chain(e).pluck("extent").flatten().value()}}function se(e,t){return e+t}function oe(e,t){return t.filter(U).map(function(t){return e.map(function(e){return e.items.filter(function(e){return t.name===e.column.name})[0]}).filter(G)})}function re(e,t,i,n,s,o,r,l,u,p,m,_,f){let S;const w=q(e);if(b(w)||v(w))S=t.map(e=>(function(e,t,i,n,s,o,r,a,c,l,d){const g=void 0!==d?te(d):Z,u=new h.Points(e.items,t,i,s,o,{comments:r,widgetId:a,options:o.canAddComments?h.createCommentsDropdownMenu(y.widget,c,l,g,ee):[],onClick:ee});let p;return p=o.isAdaptiveLegend?i.limits.min<0?i.limits.max:i.limits.min:0,{points:u,scaledBottom:n.graph.bottom-i.isCrossingZero?i.scale(p):0,color:e.metaData.color,style:o.style||{}}})(e,i,n,o,r,l,u,p,m,_,f));else{S=function(e,t,i,n,s,o,r){const l=new h.VerticalBars(e,t,i,o,n,s,r);if(r.useSingleAxis&&r.stackMode.indexOf("STACK")>-1){const e=c.max(l.map(e=>e.reduce((e,t)=>e+t.height,0)));e>n.graph.height&&l.forEach(t=>{let i=0;t.forEach(t=>{const s=t.height;t.height=a.MathUtils.linearScale({min:0,max:e},{min:0,max:n.graph.height},t.height),i+=s-t.height,t.y+=i})})}return{bars:l}}(oe(t,s),i,n,o,r,z(e),l)}return S.configurationService=g.configurationService,S.bubbleDialogService=d.bubbleDialogService,S.orientation=Y(),S.scaledBottom=n.scale(0),S}function ae(e){return new h.Dimensions(e.dimensions.width,60,60,e.dimensions.height,0,!0)}function ce(e){e.each(function(){const e=h.getSelection(this);e.style("pointer-events",""),h.showElement(e)})}function le(e){c.each(e,e=>{if(void 0!==e){ce(h.getSelection(e.elem))}})}function de(e){c.each(e,e=>{if(void 0!==e){!function(e){e.each(function(){const e=h.getSelection(this);e.style("pointer-events","none"),h.hideElement(e)})}(h.getSelection(e.elem))}})}function ge(e){c.each(e,e=>{if(void 0!==e){const t=h.getSelection(e.elem);"1"!==t.style("opacity")&&t.style("opacity",1)}})}function ue(e,t){c.each(t,t=>{void 0!==t&&h.transitionStyle(t.elem,"opacity",e,300)})}function pe(t,i,n){void 0===e?c.each(t,(e,t)=>{ue(1,[e,i[t]])}):c.each(t,(t,n)=>{ue(n!==e?.2:1,[t,i[n]])})}function he(t){void 0===e?h.transitionStyle(t.selectAll("rect.bar"),"opacity",1,300):t.selectAll("rect.bar").each(function(t){t.popoverData.node.rowCode===e?h.transitionStyle(this,"opacity",1,300):h.transitionStyle(this,"opacity",.2,300)})}function me(o){y.settings=o,e=void 0,t=void 0;const r={lines:[],bars:[]};A=void 0,I=void 0,y.type=y.widget.getGraphType(),y.secondaryType=y.widget.getNestedGraphType();const l=q(!0),d=q(!1);!function(e){e.forEach(function(e){e.selectAll(".area").remove(),e.selectAll(".bar").remove(),e.selectAll(".line").remove(),e.selectAll(".point").remove()})}([T.areas,T.bars,T.lines,T.points,T.secondary_areas,T.secondary_bars,T.secondary_lines,T.secondary_points]),i.isDefined(y.graphSlicer)&&y.graphSlicer.clear(),h.clearCommentBubbles(O());const g=new s.default(y.widget.getPayloadValue().data_graph),u=y.widget.getExtendedConfiguration();let m=!1,S=!1;u.hasZAxisConfiguration()&&(m=u.getZAxisConfiguration().shouldAutoRenameLegend(),S=u.getZAxisConfiguration().shouldUseMainAxis()),y.isSampleData=g.sample_data||!1;const w=g.getColumns(),C=g.extractData(),P=g.getAdditionalFrames().map(e=>new s.default(e)),x=c.chain(P).map(function(e){return e.extractData()}).flatten().value(),R=g.hasNegativeValues()||c(P).some(e=>e.hasNegativeValues());let k=ne(S,!0,R,C,x,w),N=c.chain(P).map(e=>{const t=e.getColumns();return ne(S,!1,R,x,C,t)}).flatten().value();const L=J(!0,g.hasIndicatorFrames(),!0,m),B=J(!1,g.hasIndicatorFrames(),!0,m);if(S&&"STACK_PERCENT"!==z(!1)&&"STACK_PERCENT"!==z(!0)){B.logarithmicScale=L.logarithmicScale,B.truncateScale=L.truncateScale;const e=[Math.min(...k,...N),Math.max(...k,...N)];k=e,N=e}B.useSingleAxis=S;const W=g.getEvents(),U=h.getStep(w.length,L.timeInterval,y.widget.getWidth()),G=function(e){return{x:e.payloadDataGraph.x_axis_name,y:e.payloadDataGraph.y_axis_name||" ",z:e.payloadDataGraph.z_axis_name||" "}}(g);let $,j;M=ae(o),$=new h.getSecondaryAxisData(k,M,y.widget.getWidth(),"left",L),M=ae(o);let H=new h.getMainAxisData(w,M,U,L);const Y=Math.floor(o.dimensions.width/h.getAxisLegendWidthFromVirtualNode(H,"tick",F()));if(void 0!==Y&&Y<H.axis.tickValues().length){const e=h.getStep(w.length,L.timeInterval,Y);H=new h.getMainAxisData(w,M,e,L)}let X=c(P).map(e=>({dataGraph:e,columns:e.getColumns(),dataSets:x,valueRanges:N,nestedId:e.widget_id}));j=new h.getSecondaryAxisData(N,M,y.widget.getWidth(),"right",B),M=ae(o);const K=re(!0,C,H,$,w,M,G.y,L,g.getCommentsWithMarkers(),y.widget.getId());if(X=X.map((e,t)=>(e.renderingData=re(!1,x,H,j,w,M,G.z,B,g.getCommentsWithMarkers(),y.widget.getId(),e.nestedId,e.dataGraph.isExternalDataFrame(),t),e)),R){const e=c([K,v(d)||b(d)?X.map(e=>e.renderingData):void 0]).chain().filter(e=>i.isDefined(e)).flatten().value(),t=e.reduce((e,t)=>Math.max(e,t.scaledBottom),Number.MIN_VALUE);e.forEach(function(e){e.scaledBottom=t})}if(E.attr({width:M.canvas.width,height:M.canvas.height}),y.series={main:h.update_legend(C,L),extra:c.union(c.flatten(X.map(function(e){return h.update_legend(e.dataSets,B)})))},h.drawXGrid(T.grid,H,M),h.drawYGrid(T.grid,$,M),h.drawYGrid(T.grid,j,M),h.drawNewDaySeparators(T.grid,w,H,M,L),h.drawEvents(T.grid,W,w,H,M,L),v(l)||b(l)){let e={};v(l)&&(e=h.drawAreas(T.areas,K));const t=h.drawLines(T.lines,K),i=h.drawPoints(T.points,K,O(),V(g),V(g)?Z:c.noop,(e,t)=>{y.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSEENTER,t.popoverData.node.rowCode)},(e,t)=>{y.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSELEAVE,t.popoverData.node.rowCode)});c.each(t,(t,n)=>{ge([t,e[n],i[n]])}),r.lines.push({linesMap:t,areaMap:e,pointsMap:i})}else h.drawBars(T.bars,K,V(g)?ie:c.noop,V(g),p.widgetInitializer.getAnimationDuration(),(e,t)=>{y.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSEENTER,t.popoverData.node.rowCode)},(e,t)=>{y.mediator.dispatch(n.LegendFragmentActions.WIDGET_MOUSELEAVE,t.popoverData.node.rowCode)}),r.bars.push(T.bars);v(d)||b(d)?(v(d)&&X.forEach(e=>{h.drawAreas(T.secondary_areas,e.renderingData)}),X.forEach((e,t)=>{let i={};v(l)&&(i=h.drawAreas(T.areas,K));const n=h.drawLines(T.secondary_lines,e.renderingData),s=h.drawPoints(T.secondary_points,e.renderingData,O(),V(e.dataGraph),V(e.dataGraph)?te(t):c.noop);c.each(n,(e,t)=>{ge([e,i[t],s[t]])}),r.lines.push({linesMap:n,areaMap:i,pointsMap:s})})):(X.forEach((e,t)=>{h.drawBars(T.secondary_bars,e.renderingData,V(e.dataGraph)?function(e){const t=y.widget.getDataGraph().getAdditionalFrames()[e];return i=>{window.isExport||h.barClick(i,_.navigationService,y.widget,void 0!==t&&t.clickable,void 0,e)}}(t):c.noop,V(e.dataGraph),p.widgetInitializer.getAnimationDuration())}),r.bars.push(T.secondary_bars)),function(i){void 0!==f&&f.cancel(),f=new a.CancellationToken,y.mediator.listen(n.LegendFragmentActions.LEGEND_MOUSEENTER,n=>{void 0===t&&(e=n,i.bars.forEach(e=>{he(e)}),i.lines.forEach(({linesMap:e,areaMap:t,pointsMap:i})=>{pe(e,t)}))},{token:f}).listen(n.LegendFragmentActions.LEGEND_MOUSELEAVE,n=>{void 0===t&&(e===n&&(e=void 0),i.bars.forEach(e=>{he(e)}),i.lines.forEach(({linesMap:e,areaMap:t,pointsMap:i})=>{pe(e,t)}))},{token:f}).listen(n.LegendFragmentActions.LEGEND_MOUSECLICK,n=>{t===n?(i.bars.forEach(e=>{ce(e)}),i.lines.forEach(({linesMap:e,areaMap:t,pointsMap:i})=>{c.each(e,(e,n)=>{le([e,t[n],i[n]])})}),t=void 0):(i.bars.forEach(e=>{ce(e)}),i.lines.forEach(({linesMap:e,areaMap:t,pointsMap:i})=>{c.each(e,(e,s)=>{s!==n?de([e,t[s],i[s]]):le([e,t[s],i[s]])})}),t=n,e=void 0)},{token:f})}(r),y.widget.getPageState().getAllowedPages().isCommandCenterScreen()||h.drawCutoffs(T.cutoffs,K,H,M,!1,D),h.drawBaseline(T.grid,$.scale,M);let Q=Math.max.apply(Math,j.axis.tickValues()),ee=Math.floor(Math.log(Q)/Math.log(10))+1;if(ee>3){for(;Q%1e3==0;)ee-=3,Q/=1e3;ee++,Math.min(ee,6)}return i.isDefined(y.graphSlicer)&&(y.graphSlicer.setStartingPoint(M.graph.left),y.graphSlicer.setEndingPoint(M.graph.right)),A.hasComments()?h.commentsFullyLoaded(y.widget):a.waitFor(500)}y.hasResultLabel=function(){const e=j();return i.isDefined(e)&&i.isDefined(e.total_label)&&i.isDefined(e.total_results)},y.getResultNumber=function(){return j().total_results},y.getResultLabel=function(){return j().total_label},y.getFontSize=F,y.$on("$destroy",function(){f&&f.cancel();r(P).values().each(e=>e())}),E=o.select(m[0]).append("svg").classed("chart",!0),(T=["grid","bars","secondary_bars","areas","secondary_areas","lines","secondary_lines","points","secondary_points","cutoffs","labels"].reduce(W,[])).grid.append("g").classed({axis:!0,"x-axis":!0}),T.grid.append("g").classed({axis:!0,"y-axis":!0,left:!0}),T.grid.append("g").classed({axis:!0,"y-axis":!0,right:!0}),T.grid.append("g").classed({axis:!0,baseline:!0}).append("line"),g.configurationService.getPageConfiguration().canDrillDown(y.widget.getPageState())&&!0!==window.isExport&&(y.graphSlicer=new C(m.find(".chart-container")),y.startSelection=k,y.moveSelection=N,y.releaseSelection=L,y.cancelSelection=B,m.on("mousemove",y.moveSelection),$(document).on("mouseup",y.releaseSelection),$(document).on("keydown",y.cancelSelection),m.on("$destroy",function(){m.off(),$(document).off("mouseup",y.releaseSelection),$(document).off("keydown",y.cancelSelection),y.graphSlicer.dispose()}))}}t.default=w,t.ComposedDirective=w}),define("components/constant/directive",["require","exports","classes/context_data/context_data"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[()=>({restrict:"A",scope:{twConstant:"@",html:"=?",params:"=?",asAttribute:"=?"},controller:["$scope","$element",(e,t)=>{const n=e.twConstant.split(".");(async function(){let t=null;if("messages"==n[0]||"messages1"==n[0])t=i.contextData.getMessage(n[1],e.params||[]);else if(t=n.reduce((e,t)=>e[t],constants),void 0!==e.params)for(let i=0;i<e.params.length;i++)t=t.replace("{"+i+"}",e.params[i]);return t})().then(i=>{e.html?t.html(i):void 0!==e.asAttribute?t.attr(e.asAttribute,i):t.text(i)})}]})]}),define("components/contact/form/new_use_cases/directive",["require","exports","underscore","services/template_source","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope"],{templateUrl:n.templateSourceFactory("components/contact/form/new_use_cases"),replace:!0,restrict:"EA",scope:{payload:"=",callback:"=?"},controller:e};function e(e){e.send=function(){i.isUndefined(e.callback)||e.callback()},e.getMessages=function(){return constants.messages},e.send_action=constants.events.form.action.send,e.email_validation_pattern=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,10}$/,e.useCaseImage=s.resourcesService.getImageUrl(o.ImageResource.moreUseCasesPng)}}}),define("components/contact/form/upgrade_enterprise/directive",["require","exports","underscore","services/template_source","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{payload:"=",callback:"=?"},controller:e,templateUrl:n.templateSourceFactory("components/contact/form/upgrade_enterprise")};function e(e){e.send=function(){i.isUndefined(e.callback)||e.callback()},e.getMessages=function(){return constants.messages},e.send_action=constants.events.form.action.send,e.useCaseImage=s.resourcesService.getImageUrl(o.ImageResource.dummyUseCasesTwScreenshotPng),e.email_validation_pattern=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,10}$/}}]}),define("components/modals/customtimefilter_timeslot/directive",["require","exports","lazy","moment","services/template_source"],function(e,t,i,n,s){function o(){return{templateUrl:s.templateSourceFactory("components/modals/customtimefilter_timeslot"),replace:!0,restrict:"E",controller:r,controllerAs:"ctrl",bindToController:!0,scope:{ok:"&",payload:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.CustomtimefilterTimeslotDirective=o;class r{constructor(e){this.$scope=e,this.timeRegex=/^(?:(?:[0-1]?[0-9]|2[0-3]):[0-5][0-9]|24:00)$/}get formController(){return this.$scope.handleTimeSlot}validateTimes(){const{startTime:e,endTime:t}=this.formController;n(t.$viewValue,"HH:mm").isBefore(n(e.$viewValue,"HH:mm"))?t.$setValidity("time-range",!1):t.$setValidity("time-range",!0),this.$scope.$applyAsync()}get formData(){return this.payload.formData}isValid(){const e=i(this.payload.formData.weekdays.root_entry.children).map(e=>e.selected).some(e=>"NODE"===e);return this.$scope.handleTimeSlot.$valid&&e}submit(){this.isValid()&&this.ok()}}r.$inject=["$scope"]}),define("components/custom_time_filters/directive",["require","exports","angular","lazy","angular_utilities","classes/context_data/context_data","services/confirmation_service","services/modal","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",bindToController:{customTimeFilters:"="},scope:{},controller:l,controllerAs:"vm",templateUrl:c.templateSourceFactory("components/custom_time_filters")}};let l=class{constructor(e){this.$scope=e,this.maximumDescriptionLength=100,this.editing=!1}toggleEditing(e){this.editing=!this.editing,this.editing?(this.editedCustomTimeFilter=e,this.editedTitle=e.name,this.editedDescription=e.description):this.isFormValid()&&(e.name=this.editedTitle,e.description=this.editedDescription),this.editing||(this.editedCustomTimeFilter=void 0)}deleteCustomTimeFilter(e){r.confirmationService.display({message:o.contextData.getMessage("_1968424")}).then(()=>{this.customTimeFilters.splice(e,1)},()=>void 0)}moveCustomTimeFilterUp(e){const[t]=this.customTimeFilters.splice(e,1);this.customTimeFilters.splice(e-1,0,t)}moveCustomTimeFilterDown(e){const[t]=this.customTimeFilters.splice(e,1);this.customTimeFilters.splice(e+1,0,t)}canMoveUp(e){return e>0}canMoveDown(e){return e<this.customTimeFilters.length-1}isEditingCustomTimeFilter(e){return void 0===this.editedCustomTimeFilter||e===this.editedCustomTimeFilter}openNewTimeslotPopup(e){const t={formData:JSON.parse(JSON.stringify(e.filter_template)),title:o.contextData.getMessage("_1846502")};a.modalService.display("CUSTOMTIMEFILTER_TIMESLOT",t).then(t=>{e.filters=[t,...e.filters]})}openEditTimeslotPopup(e,t){const n={formData:i.copy(t.filters[e],{}),title:o.contextData.getMessage("_1348164")};a.modalService.display("CUSTOMTIMEFILTER_TIMESLOT",n).then(i=>t.filters[e]=i)}deleteTimeSlot(e,t){t.filters.splice(e,1)}getFormattedWeekdays(e){return n(e.weekdays.root_entry.children).filter(e=>"NODE"===e.selected).map(e=>e.name).join(", ")}isFormValid(){return void 0!==this.editedTitle&&this.editedTitle.length>0&&void 0!==this.editedDescription&&this.editedDescription.length<this.maximumDescriptionLength}};l=__decorate([s.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],l),t.Controller=l}),define("components/data_table/directive",["require","exports","underscore","components/tools/data_graph","reusable_services","services/template_source","services/tw_common","table_sorter_ui","services/navigation","services/custom_pages","services/broker","classes/navigation/nav_params"],function(e,t,i,n,s,o,r,a,c,l,d,g){function u(e){p.$inject=["$scope","$element"];const t=s.emojiService;let u=!1;return{replace:!0,restrict:"E",scope:{widget:"=",fragment:"="},controller:p,templateUrl:o.templateSourceFactory("components/data_table")};function p(s,o){let p,h;s.loaded=!1,s.fragment.attach(s,o);const m={sortable:!0,sort:function(){if(s.widget.getExtendedConfiguration().hasSortingConfig()){const e=s.widget.getExtendedConfiguration().getSortingConfig();if(e.isSortOnRowLabel())return e.getSortDirection()}return}()};let _;function f(){void 0!==p&&u&&(p.destroy(),u=!1);const t=[];return s.widget.canShowRowLabel()&&t.push(m),i.each(s.widget.getTableHeader().getColumns(),function(e,i){t.push(e)}),t.push.apply(t,s.widget.getTableHeader().getSubColumns()),h={sortableColumns:t,displayBehaviour:s.isFancy()?a.SortDisplayBehaviour.ONE_COLUMN:a.SortDisplayBehaviour.ALL_COLUMNS,allColumnsSortable:!s.widget.isSortReloading()},e(function(){p=new a.TableSorter(o.find("table")[0],h),u=!0})}function y(){s.widget.isSortReloading()||void 0!==_||(_=s.widget.getDic().payload.value)}function v(e,t){s.widget.isSortReloading()||e!==constants.data_table.sorting.NONE||(t.stopImmediatePropagation(),s.widget.setPayloadValue(JSON.parse(_),!1),_=void 0)}s.onCellClick=window.isExport?i.noop:function(e,t,i){s.widget.isClickable()&&e.isClickable()&&c.navigationService.datagraphClick(s.widget.getDataGraph(),s.widget,s.widget.getTableBody().getRows().indexOf(e),e.getCellIndex(t),i.target)},s.hasUrl=function(e){return void 0!==e.row.meta_data&&void 0!==e.row.meta_data.attributes&&void 0!==e.row.meta_data.attributes.url},s.shortenRowHeaders=function(){return s.widget.getPayloadValue().data_graph.enable_ellipsis},s.rowHeaderClick=function(e){s.hasUrl(e)&&window.open(e.row.meta_data.attributes.url)},s.getTableClass=function(e,t){const i=[];if(void 0===s.settings||void 0===s.settings.style.fontSize)i.push("font-size-normal");else switch(s.settings.style.fontSize){case 0:i.push("font-size-normal");break;case 1:i.push("font-size-medium");break;case 2:i.push("font-size-large");break;case 3:i.push("font-size-extra-large")}return void 0===e&&e||i.push("small-widget"),void 0!==t&&t&&i.push("fancy"),s.widget.hasSection()&&s.widget.getSection().getWidgets().length>1&&i.push("side-paddings"),s.shortenRowHeaders()&&i.push("no-scroll"),i.join(" ")},s.sortByColumn=function(e,t){if(s.isColumnClickable(e)){y();const i=function(e){let t;if(s.widget.isSortReloading())t=constants.data_table.sorting.DESC;else switch(e.sort){case constants.data_table.sorting.DESC:t=constants.data_table.sorting.ASC;break;case constants.data_table.sorting.ASC:t=constants.data_table.sorting.NONE;break;default:t=constants.data_table.sorting.DESC}return t}(e);s.widget.sort(e,i),s.widget.isSortReloading()?s.widget.prepareReload():s.widget.redraw(),d.brokerService.publish(constants.events.influencer_table_view_mode.change),v(i,t)}},s.canShowColumn=function(e){if(s.widget.getTableHeader().getSubColumns().length>0)return!0;const t=s.widget.getTableHeader().getColumns()[e];return-1===s.widget.getExtendedConfiguration().getHiddenColumns().indexOf(t.code)},s.drillDownOnColumn=function(e,t){t.stopPropagation(),function(e,t){const i=new g.NavigationParams,o=n.default.constructor.parseFilters(e.filter);i.setFilters([o]),i.setWidget(s.widget),i.setClickTarget(t.target),c.navigationService.clickHandler(i,t.target)}(e,t)},s.hideColumn=function(e,t){t.stopPropagation(),s.widget.getExtendedConfiguration().addHiddenColumn(e.code),l.customPagesService.saveWidget(tw.pageState.getAllowedPages().getCustomPageType(),{mapped_id:tw.pageState.getAllowedPages().getCustomPageId()},s.widget)},s.sortByRowLabels=function(e){let t;if(y(),s.widget.getExtendedConfiguration().hasSortingConfig()&&s.widget.getExtendedConfiguration().getSortingConfig().isSortOnRowLabel()){t=s.widget.getExtendedConfiguration().getSortingConfig().getSortDirection()===constants.data_table.sorting.DESC?constants.data_table.sorting.ASC:constants.data_table.sorting.NONE}else t=constants.data_table.sorting.DESC;s.widget.sortByRowLabels(t),m.sort=t,v(t,e)},s.isColumnClickable=function(e){return!window.isExport&&(!s.widget.isSortReloading()||s.widget.isSortReloading()&&!0===e.sortable)},s.canShowExternalIcon=function(e){return!i.isUndefined(e.filter)&&e.filter.length>0},s.canShowHideIcon=function(e){return 0===s.widget.getTableHeader().getSubColumns().length&&s.widget.getApplication().pageState.isEditMode()},s.getColSpan=function(e){return s.widget.getTableHeader().getColumnSpan(e)},s.setTransitionDuration=function(e){s.transitionDuration=e},s.getTransitionDuration=function(){return s.animationEnabled&&s.transitionDuration?s.transitionDuration+"ms":0},s.enableInitialAnimation=function(e){s.animationEnabled=e},s.isAnimationEnabled=function(){return s.animationEnabled},s.isFancy=function(){return s.widget.isFancyDataTable()},s.isSortedBy=function(e){return!i.isUndefined(e)&&(s.widget.isSortedDesc(e.sort)||s.widget.isSortedAsc(e.sort))},s.applyCSSRules=function(e){e.style["overflow-x"]="auto",e.style.opacity=1},s.redrawWidget=function(t){s.settings=t;const n=o.find("div.table-responsive").get(0);return i.isUndefined(n)?s.enableInitialAnimation(!1):(s.setTransitionDuration(t.animationDuration),s.enableInitialAnimation(t.animationStrategy!==r.twCommon.visualizationInitializationStrategy.INSTANT),e(function(){s.applyCSSRules(n),s.handleRowHeaderWidths()},0)),e(function(){s.handleRowHeaderWidths()})},s.handleRowHeaderWidths=function(){void 0!==s.settings&&void 0!==s.settings.dimensions&&s.widget.canShowRowLabel()&&s.shortenRowHeaders()&&o.find("tbody tr").each(function(){const e=$(this).scope();let t=0;const i=$(this).children().first();i.nextAll().each(function(){t+=$(this).outerWidth()});const n=Math.floor(s.settings.dimensions.width-t-40);$(i.children()[0]).width()>n&&(e.shorten=!0,e.maxWidth=n+"px")})},s.parseTextForEmoji=function(e){return t.parseTextForEmoji(e)},f();const S=s.widget.onPayloadChange.subscribe(function(){s.widget.hasPayloadValue()&&f()});s.$on("$destroy",function(){S.cancel(),u&&p.destroy()})}}Object.defineProperty(t,"__esModule",{value:!0}),u.$inject=["$timeout"],t.default=u}),define("components/deploy/directive",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$element","logService"],{replace:!1,scope:!1,controller:e};function e(e,t,i){let n=e;for(;void 0===n._controller;)if(void 0===(n=n.$parent))return void i.error("Deploy can only be used in conjunction with DirectiveWrapper");n._deployments=n._deployments||[],n._deployments.push({element:t,scope:e}),n._controller._deployFinished&&(n._controller._deployFinished=!1,n._controller._rushDeploy())}}}),define("components/document_template_manager/ppt_placeholder_templates/directive",["require","exports","reusable_components","react-dom","react","angular","services/template_source","angular_utilities","services/confirmation_service","services/rest_form_service","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"EA",replace:!0,scope:{},controllerAs:"vm",bindToController:{pptPlaceholderTemplatesMap:"=templatesMap",messages:"="},controller:g,link:u,templateUrl:r.templateSourceFactory("components/document_template_manager/ppt_placeholder_templates")}};let g=class{constructor(e,t){this.$rootScope=e,this.$element=t}removePptPlaceholderTemplate(e){c.confirmationService.display({message:e.confirm_question}).then(async()=>{await this.deleteTemplateFromServer(e);const t=this.pptPlaceholderTemplatesMap[e.type];t.splice(t.indexOf(e),1),this.$rootScope.$$phase||this.$rootScope.$apply()},()=>void 0)}getTableTitleForType(e){switch(e){case"QUICK_SEARCH":return d.contextData.getMessage("_981294");case"INFLUENCER_MANAGEMENT":return d.contextData.getMessage("_1252635");case"ISSUE_TRACKER":return d.contextData.getMessage("_1423853");default:return d.contextData.getMessage("_981294")}}canShowTableTitle(){return Object.keys(this.pptPlaceholderTemplatesMap).length>1}renderStateButtonComponents(){if(void 0!==this.pptPlaceholderTemplatesMap)for(const e in this.pptPlaceholderTemplatesMap){const t=this.pptPlaceholderTemplatesMap[e];for(const e of t)this.renderStateButtonComponent(e)}}handleTemplateToggling(e,t){const i=this.pptPlaceholderTemplatesMap[t.type];for(const e of i)e.enabled=e===t&&!e.enabled,this.renderStateButtonComponent(e);this.saveTemplateToggling(t)}saveTemplateToggling(e){l.restFormService.post(e.enable_link,{template_id:e.template_id,type:e.type,enabled:e.enabled})}renderStateButtonComponent(e){const t={type:i.StateButtonType.RADIO_BUTTON,model:{owner:e,stateButtonState:this.determineStateButtonState(e.enabled)},toggleCallback:this.handleTemplateToggling.bind(this),customClasses:{container:""}};n.render(s.createElement(i.StateButtonComponent,t),this.$element.find(`[id="${e.template_id}"]`).get(0))}determineStateButtonState(e){return e?i.StateButtonState.CHECKED:i.StateButtonState.UNCHECKED}async deleteTemplateFromServer(e){await l.restFormService.deleter(e.remove_link)}};function u(e,t,i,n){setTimeout(()=>{n.renderStateButtonComponents()})}__decorate([a.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],g.prototype,"deleteTemplateFromServer",null),g=__decorate([a.ngInject(["$rootScope","$element"]),__metadata("design:paramtypes",[Object,Object])],g),t.PptPlaceholderTemplatesController=g}),define("components/document_template_manager/directive",["require","exports","services/rest_form_service","services/tw_routing","angular_utilities","services/confirmation_service","classes/context_data/context_data","notifications","services/form","services/template_source","angular"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",replace:!0,scope:{},controllerAs:"vm",bindToController:{formData:"="},controller:g,templateUrl:l.templateSourceFactory("components/document_template_manager")}};let g=class{constructor(e){this.$rootScope=e,this.filter={items:"tbody"},this.sort={stop:(e,t)=>{const n=this.formData.templates,s=t.item.index()-2,o=t.item.sortable.index-2,r=n.splice(o,1)[0];n.splice(s,0,r);const a={id:r.id,new_index:s};i.restFormService.postRForm("report_template","move",a)}}}async $onInit(){this.creatingReportTemplate=!1,this.editingReportTemplate=!1,this.formModel={},this.includeUrlReportTemplate=BASE_TEMPLATE_URL+"components/document_template_manager/report_template.html",await this.fetchPptPlaceholderTemplates(),this.initPptPlaceholderMessages(),this.initProductPlaceholderMessages(),this.$rootScope.$$phase||this.$rootScope.$apply()}canShowTable(){return!this.editingReportTemplate&&!this.creatingReportTemplate}canImport(){return!(void 0!==this.formModel.title&&this.formModel.title.length>0&&void 0!==this.formModel.ppt_attachment&&this.formModel.ppt_attachment.length>0)}canSave(){return!(void 0!==this.formModel.title&&this.formModel.title.length>0)}async saveEdit(){await this.importFile(),this.cancelEdit()}cancelEdit(){this.formModel={},this.editingReportTemplate=!1}startEditing(e){this.formModel={id:e.id,title:e.title,description:e.description,export_link:e.export_link},this.editingReportTemplate=!0}startCreating(e){e.preventDefault(),this.formModel={},this.creatingReportTemplate=!0}remove(e){o.confirmationService.display({message:e.confirm_question}).then(async()=>{await this.deleteTemplateFromServer(e),this.formData.templates=this.formData.templates.filter(t=>t.id!==e.id)},()=>void 0)}importFile(){const e=i.restFormService.postMultipartRForm("report_template",this.editingReportTemplate?"update":"import",this.formModel);return a.notificationService.warning(`<i class="fa fa-refresh fa-spin"></i> ${r.contextData.getMessage("_498245")}`,{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(()=>{n.twRoutingService.reloadPageAndContext()},e=>{this.formData.field_messages=e.field_messages,c.formService.showMessagesAsNotifications(e.field_messages)})}handleDownloadClick(e){i.restFormService.get(this.formModel.export_link,"export").then(e=>window.location.href=e.exported_file_link)}generateTemplateFromBranding(e){e.preventDefault(),i.restFormService.get(i.restFormService.getRFormUrl("document_template","export"),"export").then(e=>window.location.href=e.exported_file_link)}canShowProductPlaceholderTemplates(){return r.contextData.rules.isProductProjectRuleEnabled()}async fetchPptPlaceholderTemplates(){this.pptPlaceholderTemplatesForm=await i.restFormService.get(i.restFormService.getRFormUrl("powerpoint_placeholders_templates","show"),"show")}initPptPlaceholderMessages(){this.pptPlaceholderTemplatesMsgs={headerTitle:r.contextData.getMessage("_1954165"),headerDescription:r.contextData.getMessage("_1560689"),noTemplateMessage:this.pptPlaceholderTemplatesForm.no_template_message}}initProductPlaceholderMessages(){this.productPlaceholderTemplatesMgs={headerTitle:r.contextData.getMessage("_1840948"),headerDescription:r.contextData.getMessage("_1580986"),noTemplateMessage:this.pptPlaceholderTemplatesForm.no_template_message}}async deleteTemplateFromServer(e){await i.restFormService.deleter(e.delete_link)}};__decorate([s.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],g.prototype,"saveEdit",null),__decorate([s.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],g.prototype,"deleteTemplateFromServer",null),g=__decorate([s.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],g),t.DocumentTemplateController=g}),define("components/download/directive",["require","exports","components/form/common/topic_menu","services/template_source","notifications","services/export"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{restrict:"AE",scope:{menu:"=",group:"=",toggling:"&"},controller:e,templateUrl:n.templateSourceFactory("components/download")};function e(e){e.exports=e.menu.export_menu,e.save_action=constants.events.form.action.post,e.exportDocument=function(t,n){const r=o.exportService.exportPage(i.getSelectedValue(t.root_entry).mapped_id);s.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+window.messages.get("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:r}),r.then(function(e){s.notificationService.success(e.message,{permanent:!1})},function(e){s.notificationService.display(e.notification)}),e.toggling()}}}]}),define("components/draggable/directive",["require","exports","angular","underscore","services/directive"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService",function(e){return t.$inject=["$scope","$element","$rootScope","$document"],{restrict:"A",scope:{model:"=",strategy:"=",config:"=?"},controller:t,link:function(e,t,i){}};function t(t,o,r,a){let c,l,d;e.assert(void 0!==t.model,"model attribute is required");function g(){if(t.strategy.stopDragging(),void 0!==t.strategy.postDrag&&t.strategy.postDrag(),t.strategy.stopDragging(),r.$$phase||t.$apply(),a.off("mousemove",p),a.off("mousemove",u),a.off("mouseup",g),!n.isUndefined(l)){const e=i.element(l.template).scope();n.isUndefined(e)||e.$destroy(),l.template.remove()}}function u(e){return t.strategy.move(e),e.preventDefault(),!1}function p(e){return void 0!==t.strategy&&(!!t.strategy.isUnsortable(e)||(e.preventDefault(),(!t.config.requireMouseMovement||Math.abs(e.clientX-d.x)>t.config.minXMovement||Math.abs(e.clientY-d.y)>t.config.minYMovement)&&($(document).on("mousemove",u),l=s.directiveService.inject($("body"),"tw-draggable-overlay"),a.off("mousemove",p),t.strategy.startDragging(n.assign({button:1},e),t.model)),!1))}function h(e){1===e.which&&(d={x:e.clientX,y:e.clientY},a.on("mousemove",p),a.on("mouseup",g),t.strategy.onMouseDown(n.assign({button:1},e),t.model))}t.config=t.config||{requireMouseMovement:!0,minXMovement:10,minYMovement:10},!0===t.model.isMovable()&&_();const m=t.$watch(function(){return t.model.isMovable()},function(e,i){e!==i&&(!0===e?_():(o.removeClass("movable"),t.model.template=void 0,c&&c()))});function _(){o.addClass("movable"),t.model.attachTemplate(o),o.on("mousedown",h),c=function(){a.off("mouseup",g),a.off("mousemove",u),o.off("mouseleave",p),o.off("mousedown",h)},t.$on("$destroy",function(){c()}),o.on("$destroy",function(){c()})}t.$on("$destroy",function(){t.model=void 0,t.strategy=void 0,m()})}}]}),define("components/draggable/overlay/directive",["require","exports","underscore","services/template_source","services/broker","services/tw_common"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","$rootScope","$timeout"],{restrict:"AE",replace:!0,scope:{},controller:e,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/draggable/overlay")};function e(e,t,n,r){const a=s.brokerService.subscribe(constants.events.draggable.highlight,function(o,a,c){e.target=o,e.side=a,e.type=c,t.css("top",e.getTopPosition()+"px"),t.css("left",e.getLeftPosition()+"px"),t.css("width",e.getWidth()+"px"),t.css("height",e.getHeight()+"px"),n.$$phase||e.$apply(),i.isUndefined(e.target)||r(function(){s.brokerService.publish(constants.events.draggable.side_thickness,$(".draggable.updown").length?$(".draggable.updown").first().height():$(".draggable.sides").length?$(".draggable.sides").first().width():void 0)})});e.$on("$destroy",function(){s.brokerService.unsubscribe(constants.events.draggable.highlight,a)}),e.canDropTop=function(){return e.target&&i.contains(e.target.getDropZoneConfiguration(),o.twCommon.sides.TOP)},e.canDropLeft=function(){return e.target&&i.contains(e.target.getDropZoneConfiguration(),o.twCommon.sides.LEFT)},e.canDropRight=function(){return e.target&&i.contains(e.target.getDropZoneConfiguration(),o.twCommon.sides.RIGHT)},e.canDropBottom=function(){return e.target&&i.contains(e.target.getDropZoneConfiguration(),o.twCommon.sides.BOTTOM)},e.canDropCenter=function(){return e.target&&i.contains(e.target.getDropZoneConfiguration(),o.twCommon.sides.CENTER)},e.getWidth=function(){return void 0!==e.target?e.target.element.outerWidth():0},e.getHeight=function(){return void 0!==e.target?e.target.element.outerHeight():0},e.getTopPosition=function(){return void 0!==e.target?e.target.element.offset().top:0},e.getLeftPosition=function(){return void 0!==e.target?e.target.element.offset().left:0},e.highlightTop=function(){return e.side===o.twCommon.sides.TOP},e.highlightRight=function(){return e.side===o.twCommon.sides.RIGHT},e.highlightBottom=function(){return e.side===o.twCommon.sides.BOTTOM},e.highlightLeft=function(){return e.side===o.twCommon.sides.LEFT},e.highlightCenter=function(){return e.side===o.twCommon.sides.CENTER},e.isTextWidget=function(){return void 0!==e.target&&e.target.isText&&e.target.isText()},e.isDashboards=function(){return e.type===constants.draggable.strategy.dashboards},e.isCommandCenters=function(){return e.type===constants.draggable.strategy.command_centers},e.isCommandCenterScreens=function(){return e.type===constants.draggable.strategy.command_center_screens},e.isGroupSelectItems=function(){return e.type===constants.draggable.strategy.group_select_items}}}]}),define("components/draggable/owner/directive",["require","exports","jquery"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService",function(e){return t.$inject=["$scope","$element"],{restrict:"A",scope:{model:"=",strategy:"="},controller:t,link:function(e,t,i){}};function t(t,n){function s(e){t.strategy.dragging&&(e.stopImmediatePropagation(),i(n)[0].style["pointer-events"]="none")}function o(e){t.strategy.dragging&&(i(n)[0].style["pointer-events"]="")}e.assert(void 0!==t.model,"model attribute is required"),_.isUndefined(t.strategy)||(n.on("mouseenter",s),n.on("mouseleave",o)),t.$on("$destroy",function(){t.model=void 0,t.strategy=void 0,_.isUndefined(t.strategy)||(n.off("mouseenter",s),n.off("mouseleave",o))}),t.model.attachTemplate(n)}}]}),define("react_components/bubble_dialogs/components/deleted_categories_bubble_dialog",["require","exports","flux","react","classes/context_data/context_data","reusable_utilities","services/rest_form_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a extends i.BaseComponent{constructor(e){super(e),this.state={}}async componentDidMount(){this.updateBubbleStyles();const e=await r.restFormService.post(r.restFormService.getRFormUrl("topic_category_history","info"),{category_history_type:this.props.payload.categoryType});this.setState({deletedCategories:e.histories})}componentDidUpdate(){this.updateBubbleStyles()}render(){return n.createElement("div",{ref:"root",className:"tw-bubble-dialog-deleted-categories"},n.createElement("div",{className:"header"},n.createElement("h2",null,s.contextData.getMessage("_1877604"),n.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×"))),n.createElement("div",{className:"body"},n.createElement("table",{className:"common-table"},n.createElement("colgroup",null,n.createElement("col",{className:"col-xs-4 col-sm-4 col-md-4 col-lg-4"}),n.createElement("col",{className:"col-xs-3 col-sm-3 col-md-3 col-lg-3"}),n.createElement("col",{className:"col-xs-1 col-sm-1 col-md-1 col-lg-1"}),n.createElement("col",{className:"col-xs-3 col-sm-3 col-md-3 col-lg-3"}),n.createElement("col",{className:"col-xs-1 col-sm-1 col-md-1 col-lg-1"})),n.createElement("thead",null,n.createElement("tr",{className:"headers"},n.createElement("th",null,s.contextData.getMessage("_1846041")),n.createElement("th",null,s.contextData.getMessage("_1984704")),n.createElement("th",null,s.contextData.getMessage("_1840941")),n.createElement("th",null,s.contextData.getMessage("_1410964")),n.createElement("th",null,s.contextData.getMessage("_1840694")))),n.createElement("tbody",null,this.renderDeletedCategories())),this.renderLoadingSpinner()))}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}renderDeletedCategories(){return void 0!==this.state.deletedCategories?this.state.deletedCategories.map(e=>this.renderCategory(e)):null}renderCategory(e){return n.createElement("tr",{className:"row-hover row-bottom-border"},n.createElement("td",null,n.createElement("span",null,e.user_name),n.createElement("span",null,"(",e.user_email,")")),n.createElement("td",null,n.createElement("span",null,e.category_name)),n.createElement("td",null,n.createElement("span",null,e.number_topics)),n.createElement("td",null,n.createElement("span",null,e.timestamp)),n.createElement("td",{className:"actions"},n.createElement("span",null,n.createElement("i",{onClick:()=>this.onRestoreCategoryClick(e),className:"fa fa-history icons-action"}))))}renderLoadingSpinner(){return void 0===this.state.deletedCategories?n.createElement("div",{className:"loading-spinner"},n.createElement("i",{className:"fa fa-spinner fa-spin"})):null}async onRestoreCategoryClick(e){await r.restFormService.get(e.revert_link);const t=this.state.deletedCategories;t.splice(this.state.deletedCategories.indexOf(e),1),this.setState({deletedCategories:t})}updateBubbleStyles(){this.props.styleInformation.setAbsoluteY(window.innerHeight/2-$(this.refs.root).height()/2),this.props.refreshStyle()}}t.DeletedCategoriesBubbleDialog=a,o.applyMixins(a,[i.DocumentClickTracker])}),define("components/edit_mode/topic_setup/topic_setup_message_factory",["require","exports","classes/context_data/context_data"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.topicSetupMessageFactory=new class{constructor(){this.debug=!1}getMessages(e){switch(e){case"topic":case"topic_category":return this.createTopicMessages();case"filter":case"filter_category":return this.createFilterMessages();case"event":return this.createEventMessages();case"issue_tracker_brand":return this.createBrandMessages();case"issue_tracker_brand_category":return this.createBrandCategoryMessages();case"issue_tracker_issue":return this.createIssueMessages();case"issue_tracker_issue_category":return this.createIssueCategoryMessages();case"issue":case"issue_watch_list":return this.createWatchlistMessages()}return this.debug?this.generateMessageTemplate(e):{}}createTopicMessages(){return{label:i.contextData.getMessage("_827560"),labelHelp:i.contextData.getMessage("_951386"),labelRequired:i.contextData.getMessage("_694677"),description:i.contextData.getMessage("_975358"),queryLabel:i.contextData.getMessage("_964210"),queryHelp:i.contextData.getMessage("_657300"),queryAcademyLabel:i.contextData.getMessage("_484746"),noQueryAdded:i.contextData.getMessage("_451854"),excludedQueriesHelp:i.contextData.getMessage("_774458"),groupLabel:i.contextData.getMessage("_699700"),groupHelp:i.contextData.getMessage("_553890"),importTooltip:i.contextData.getMessage("_810600"),exportTooltip:i.contextData.getMessage("_674804"),convertTooltip:i.contextData.getMessage("_1841653")}}createFilterMessages(){return{label:i.contextData.getMessage("_936065"),labelHelp:i.contextData.getMessage("_217480"),labelRequired:i.contextData.getMessage("_546523"),description:i.contextData.getMessage("_567869"),queryHelp:i.contextData.getMessage("_657301"),groupLabel:i.contextData.getMessage("_699700"),queryLabel:i.contextData.getMessage("_964210"),queryAcademyLabel:i.contextData.getMessage("_484746"),excludedQueriesHelp:i.contextData.getMessage("_774459"),groupHelp:i.contextData.getMessage("_588718"),proximitySearchHelp:i.contextData.getMessage("_871478"),importTooltip:i.contextData.getMessage("_362536"),noQueryAdded:i.contextData.getMessage("_948968"),exportTooltip:i.contextData.getMessage("_841016")}}createEventMessages(){return{description:i.contextData.getMessage("_283485")}}createBrandMessages(){return{label:i.contextData.getMessage("_1994500"),labelHelp:i.contextData.getMessage("_1994501"),labelRequired:i.contextData.getMessage("_1994502"),description:i.contextData.getMessage("_1994503"),queryHelp:i.contextData.getMessage("_1994504"),queryLabel:i.contextData.getMessage("_964210"),queryAcademyLabel:i.contextData.getMessage("_484746"),excludedQueriesHelp:i.contextData.getMessage("_1994505"),groupLabel:i.contextData.getMessage("_699700"),groupHelp:i.contextData.getMessage("_1994506"),proximitySearchHelp:i.contextData.getMessage("_1994507"),exportTooltip:i.contextData.getMessage("_1994508"),noQueryAdded:i.contextData.getMessage("_1994509")}}createBrandCategoryMessages(){return{groupLabel:i.contextData.getMessage("_699700"),groupHelp:i.contextData.getMessage("_1994506")}}createIssueMessages(){return{label:i.contextData.getMessage("_1994700"),labelHelp:i.contextData.getMessage("_1994701"),labelRequired:i.contextData.getMessage("_1994702"),description:i.contextData.getMessage("_1994703"),queryHelp:i.contextData.getMessage("_1994704"),queryLabel:i.contextData.getMessage("_964210"),queryAcademyLabel:i.contextData.getMessage("_484746"),excludedQueriesHelp:i.contextData.getMessage("_1994705"),groupLabel:i.contextData.getMessage("_699700"),groupHelp:i.contextData.getMessage("_1994706"),proximitySearchHelp:i.contextData.getMessage("_1994707"),exportTooltip:i.contextData.getMessage("_1994708"),importTooltip:i.contextData.getMessage("_1994710"),noQueryAdded:i.contextData.getMessage("_1994709")}}createIssueCategoryMessages(){return{groupLabel:i.contextData.getMessage("_699700"),groupHelp:i.contextData.getMessage("_1994706")}}createWatchlistMessages(){return{groupLabel:i.contextData.getMessage("_1994622"),label:i.contextData.getMessage("_1994620"),itemDescription:i.contextData.getMessage("_1994621")}}generateMessageTemplate(e){const t=Object.assign({},this.createTopicMessages());return Object.keys(t).forEach(i=>{t[i]=`${e}_${i}`}),t}}}),define("components/edit_mode/edit_mode_interfaces",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("components/edit_mode/directive",["require","exports","angular_utilities","classes/context_data/context_data","services/confirmation_service","services/rest_form_service","log","services/broker","notifications","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/application/application","classes/refresh/model_type","services/refresh/model_refresh_service","wrappers/topic_menu/topic_entry_wrapper","flux","reusable_components","services/bubble_dialog","classes/bubble_dialog/widget_dialog_config","services/configuration","react_components/bubble_dialogs/components/deleted_categories_bubble_dialog","react","services/template_source","components/edit_mode/topic_setup/topic_setup_message_factory","map"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T){function M(){return{replace:!1,restrict:"EA",bindToController:{fragment:"=",widget:"="},controllerAs:"vm",controller:P,templateUrl:C.templateSourceFactory("components/edit_mode"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),M.$inject=["topicService"],t.default=M;let P=class{constructor(e,t,i,n){this.$scope=e,this.$timeout=t,this.topicService=i,this.$element=n}$onInit(){const e=this.widget.getPayloadValue();this.formEntries=e.form_entries,this.initializeMessages(this.formEntries),this.fragment.attach(this,this.$element)}initializeMessages(e){this.formMessages=new T.Map,e.forEach(e=>{const t=e.element;this.formMessages.set(t.id,E.topicSetupMessageFactory.getMessages(t.form))})}getMessages(e){return this.formMessages.get(e.element.id)}redrawWidget(){return Promise.resolve(this)}isFormExportAllowed(e){return void 0!==e.export_link||void 0!==e.element&&void 0!==e.element.export_link}isFormImportAllowed(e){return void 0!==e.import_link||void 0!==e.element&&void 0!==e.element.import_link}isImportExportAllowed(e){return(this.isTopics(e.element)||this.isTopic(e)||this.isFilters(e.element)||this.isFilter(e))&&(this.isFormImportAllowed(e)||this.isFormExportAllowed(e))}isTopic(e){return e.element.type===constants.edit_type.topic}isFilter(e){return e.element.type===constants.edit_type.filter}isSearch(e){return e.element.type===constants.edit_type.search}isEvent(e){return"EVENT"===e.selected_element||"EVENTS"===e.selected_element}isPageMonitoring(e){return"PAGE_MONITORED"===e.selected_element||"PAGE_MONITOR_ALL"===e.selected_element}isTopics(e){return e&&e.form===constants.rform.topic_categories.TOPIC}isFilters(e){return e&&e.form===constants.rform.topic_categories.FILTER}isRemovableForm(e){const t=constants.rform.topic_entry;return _([t.TOPIC,t.FILTER,t.WEB_CONNECTOR,t.ISSUE_TRACKER_BRAND,t.ISSUE_TRACKER_ISSUE]).contains(e.form)}canConvertTopic(e){if(this.isTopic(e)){const e=tw.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.topic).getFirstSelectedEntryRecursively();return void 0!==e&&e.hasParent()&&e.getParent().hasParent()}return!1}hasHistory(e){const t=this.isTopics(e.element)||this.isTopic(e),i=this.isFilters(e.element)||this.isFilter(e);if(t||i){const e=t?constants.topic_menu.TYPE.topic:constants.topic_menu.TYPE.filter,i=tw.pageState.getUserFilterSettings().getTopicMenuByType(e);return i&&i.hasRootEntry()&&(i.getRootEntry().isSelected()||void 0!==i.getFirstSelectedEntryRecursively())}return!1}hasShareeInfo(e){return void 0!==e.element.sharee_info}canBePreviewed(e){return void 0!==e.element.preview_link}canShowBreadcrumbButtons(e){return this.isRemovableForm(e.element)||this.hasHistory(e)||this.hasShareeInfo(e)}getExportTooltip(e){return this.getMessages(e).exportTooltip}getImportTooltip(e){return this.getMessages(e).importTooltip}getConvertTooltip(e){return this.getMessages(e).convertTooltip}getDescription(e){return this.getMessages(e).description}async exportDataFromForm(e){if(this.isFormExportAllowed(e)){const t=void 0!==e.element?e.element:e,i=o.restFormService.get(t.export_link);c.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+n.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:i});const s=await i;c.notificationService.success(s.export_message,{permanent:!0})}else c.notificationService.error(n.contextData.getMessage("_890153"),{permanent:!1})}async prepareImport(e,t){void 0!==this.inputField&&(this.inputField.off("change"),this.inputField=void 0);let i=$(t.target).find("[tw-button]");0===i.length&&(i=$(t.target).closest("[tw-button]")),this.inputField=i.next("input"),this.$timeout(()=>{this.inputField.click()}),this.inputField.on("change",t=>{const i=t.target;(i.files||t.originalEvent.dataTransfer.files)&&(e.file_import=i.files||t.originalEvent.dataTransfer.files),this.$scope.$apply(()=>{o.restFormService.postMultipart(e.import_link,e).then(async()=>{try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after importing!",void 0,e)}})})})}async convertFilterTopic(e){try{const t=o.restFormService.get(e.element.convert_link);c.notificationService.warning(`<i class="fa fa-refresh fa-spin"></i> ${n.contextData.getMessage("_498245")}`,{permanent:!0,singleInstance:!0,closeOnResolve:t});const i=await t;this.addConvertedItemToUFSAndSidebar(i,this.isFilter(e),this.isTopic(e)),c.notificationService.success(n.contextData.getMessage("_1810861"),{permanent:!0})}catch(e){r.logService.error("Something went wrong when converting filter / topic",void 0,e)}}showHistory(e){e.preventDefault();const t=g.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(this.formEntries[0].element.type.toUpperCase()),i=t.getRootEntry().isSelected()?t.getRootEntry():t.getFirstSelectedEntryRecursively();a.brokerService.publish(constants.events.topic.show_history,[i.getMappedId()])}canShowDeletedCategories(e){return this.isTopics(e.element)||this.isFilters(e.element)}async previewFullTopic(e,t){t.preventDefault();const i=e.preview_link,n=await o.restFormService.post(i,e);this.displayTopicPreview(n)}displayTopicPreview(e){const t=this.preparePageStateForPreview(e.preview_topic_id),i=S.configurationService.getBubbleDialogConfiguration().getStyle(window.constants.bubble_dialog.id.widget);i.setAbsoluteY(window.pageYOffset+50),y.bubbleDialogService.destroyById(window.constants.bubble_dialog.id.widget);const n=new v.WidgetDialogConfig(t,{groupPage:"CONTEXT_MENU",pageType:window.constants.page_type.context_menu_preview,ufs:t.getUserFilterSettings(),setAllowedPagesReloadFlag:!0,style:i});n.setTargetElement($(".page__content")),y.bubbleDialogService.createWidgetDialogBubble(n)}preparePageStateForPreview(e){return this.topicService.preparePageStateForPreview(g.mainApplication.getPageState().clone(),e)}addConvertedItemToUFSAndSidebar(e,t,i){let n;t?n=constants.topic_menu.TYPE.topic:i&&(n=constants.topic_menu.TYPE.filter);const s=h.TopicEntryWrapper.create(e.mapped_id,e.name),o=tw.pageState.getUserFilterSettings().getTopicMenuByType(n);let r=o.getEntryByMappedId(e.parent_mapped_id);void 0===r&&(r=h.TopicEntryWrapper.create(e.parent_mapped_id,""),o.getRootEntry().addChild(r)),r.addChild(s),r.toProto(),m.dispatcher.dispatch(f.sidebarActions.sidebar_onAddEntry,{menuUpdated:!0,menuType:o.getType()})}goToOwnerProject(e,t){t.preventDefault(),s.confirmationService.display({message:n.contextData.getMessage("_1654068")}).then(()=>window.open(e.sharee_info.sharer_entity_link,"_blank"),()=>void 0)}async removeTopic(e,t){t.preventDefault();try{await s.confirmationService.display({message:e.confirm_question}),this.deleteTopicFromServer(e)}catch(e){}}showDeletedCategories(e,t){t.preventDefault();const i={categoryType:this.isTopics(e.element)?"topics_category":"filter_category"},n=S.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.deleted_categories);y.bubbleDialogService.createReactBubble(constants.bubble_dialog.id.deleted_categories,$("body"),i,e=>(e.payload=i,w.createElement(b.DeletedCategoriesBubbleDialog,{payload:e.payload,destroy:e.destroy,styleInformation:e.styleInformation,refreshStyle:e.refreshStyle})),n).onDestroy.subscribeOnce(async()=>{try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after closing deleted categories dialog !",void 0,e)}})}async deleteTopicFromServer(e){try{await o.restFormService.deleter(e.links.link_remove),this.publishDeletionBrokerEvent(e),e={}}catch(t){e.field_messages=t.field_messages}}publishDeletionBrokerEvent(e){const t=this.getTopicType(e);a.brokerService.publish(constants.events.topic.remove,[e.parent_mapped_id,e.mapped_id,t,!0])}getTopicType(e){switch(e.form){case constants.rform.topic_entry.TOPIC:return constants.topic_menu.TYPE.topic;case constants.rform.topic_entry.FILTER:return constants.topic_menu.TYPE.filter;case constants.rform.topic_entry.WEB_CONNECTOR:return constants.topic_menu.TYPE.web_connector;case constants.rform.topic_entry.ISSUE_TRACKER_ISSUE:return constants.topic_menu.TYPE.issue_tracker_issue;case constants.rform.topic_entry.ISSUE_TRACKER_BRAND:return constants.topic_menu.TYPE.issue_tracker_brand;default:return void r.logService.error("topic_type not found for form",void 0,e)}}async refreshPageData(){const e={strategy:l.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(g.mainApplication.getPageState(),g.mainApplication,u.ModelType.PAGE_STATE,e);return await p.modelRefreshService.refresh(t,e)}};P=__decorate([i.ngInject(["$scope","$timeout","topicService","$element"]),__metadata("design:paramtypes",[Object,Function,Object,Object])],P)}),define("components/edit_mode/command_center/directive",["require","exports","services/command_center","services/rest_form_service","services/theme","wrappers/topic_menu/topic_menu_wrapper","reusable_utilities","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{replace:!1,restrict:"AE",bindToController:{section:"=",model:"="},controllerAs:"vm",controller:l,templateUrl:a.templateSourceFactory("components/edit_mode/command_center"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.EditCommandCenterDirective=c;class l{constructor(){}$onInit(){this.loadFormEntry(this.model.getAlternateUrl())}loadFormEntry(e){n.restFormService.get(e).then(e=>{this.formEntry=e,this.oldFormEntry=JSON.parse(JSON.stringify(e)),this.stylesheets=new o.TopicMenuWrapper(this.formEntry.stylesheets),this.slideShowTopicMenu=new o.TopicMenuWrapper(this.formEntry.slide_show_display_times);const t=this.slideShowTopicMenu.getFirstSelectedEntryRecursively();this.slideShowDisplayTime=void 0!==t?parseInt(t.getMappedId(),10):1})}save(){this.slideShowTopicMenu.unselectAllAndSelectByMappedId(""+this.slideShowDisplayTime),this.formEntry.slide_show_display_times=this.slideShowTopicMenu.toProto(),i.commandCenterService.updateCommandCenter(this.formEntry).then(()=>{this.updateModel(this.formEntry),this.updateItemInSection(this.formEntry)})}getMinDisplayTime(){return void 0!==this.slideShowTopicMenu&&parseInt(this.slideShowTopicMenu.getFirstVisibleEntry().getMappedId(),10)}getMaxDisplayTime(){return void 0!==this.slideShowTopicMenu&&parseInt(this.slideShowTopicMenu.getLastVisibleEntry().getMappedId(),10)}updateModel(e){this.model.title=e.title,this.model.description=e.description}updateItemInSection(e){const t=this.section.content.getRootEntry().getEntryByMappedId(e.custom_page_id);t&&(t.setTitle(e.title),t.setDescription(e.description))}getSelectedTheme(){if(this.stylesheets){const e=this.stylesheets.getFirstSelectedEntryRecursively();return s.themeService.findThemeByCSSFile(e?e.getMappedId():void 0)}}hasFormChanged(){const e=r.TopicMenuUtils.getFirstSelectedEntry(this.formEntry.stylesheets),t=r.TopicMenuUtils.getFirstSelectedEntry(this.oldFormEntry.stylesheets);return this.oldFormEntry.enable_slide_show!==this.formEntry.enable_slide_show||!e||!t||e&&t&&e.mapped_id!==t.mapped_id}}t.EditCommandCenterController=l}),define("components/edit_mode/command_center_screen/directive",["require","exports","log","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/command_center","services/refresh/model_refresh_service","services/template_source","services/theme","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g){function u(){return{replace:!1,restrict:"AE",bindToController:{formEntry:"="},controllerAs:"vm",controller:p,templateUrl:l.templateSourceFactory("components/edit_mode/command_center_screen"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=u,t.EditCommandCenterScreenDirective=u;class p{constructor(){}$onInit(){this.stylesheets=new g.TopicMenuWrapper(this.formEntry.stylesheets)}remove(e){e.preventDefault(),a.commandCenterService.removeScreen({custom_page_id:this.getScreenId()})}save(){a.commandCenterService.updateScreen(Object.assign({},this.formEntry,{custom_page_id:this.getScreenId()})).then(async()=>{const e={strategy:o.ModelRefreshStrategy.REFRESH_NO_CACHE},t=s.modelRefreshDecoratorFactory.getDecorator(n.mainApplication.getPageState(),n.mainApplication,r.ModelType.PAGE_STATE,e);try{return await c.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&i.logService.error("Error when refreshing page state after saving command center screen !",void 0,e)}})}getScreenId(){return this.formEntry.custom_page_id}getSelectedTheme(){if(this.formEntry){const{effective_stylesheet:e}=this.formEntry;return d.themeService.findThemeByCSSFile(e)}}}t.EditCommandCenterScreenController=p}),define("components/edit_mode/dashboard/directive",["require","exports","services/confirmation_service","services/custom_pages","services/modal","wrappers/topic_menu/topic_menu_wrapper","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){function p(){return{replace:!0,restrict:"AE",bindToController:{formEntry:"="},controllerAs:"vm",controller:h,templateUrl:u.templateSourceFactory("components/edit_mode/dashboard"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=p,t.EditDashboardDirective=p;class h{constructor(){this.saveAction=constants.events.form.action.post,this.editMode=!0}getContainer(){return this.formEntry.dashboard_container}remove(e){e.preventDefault(),i.confirmationService.display({message:this.getContainer().confirm_question}).then(async()=>{await n.customPagesService.removeDashboard(this.getContainer()),n.customPagesService.selectNextDashboard()})}edit(){this.editMode=!0}isEditMode(){return!0===this.editMode}async save(){await n.customPagesService.updateDashboard(this.getContainer());const e={strategy:a.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,g.ModelType.PAGE_STATE,e);try{await r.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&c.logService.error("Error when refreshing page state after saving dashboard !",void 0,e)}}cancel(){this.editMode=!1}isEmpty(){return 0===this.getContainer().number_widget}addToNewGroup(){s.modalService.display("ADD_TOPICS_CATEGORY",{name:""}).then(async e=>{const t=(await n.customPagesService.createNewGroup(e.name)).group_content_entry;_.isUndefined(this.getContainer().groups.root_entry.children)&&(this.getContainer().groups.root_entry.children=[]),new o.TopicMenuWrapper(this.getContainer().groups).unselectAll(),this.getContainer().groups.root_entry.children.push({mapped_id:t.mapped_id,name:t.title,selected:constants.topic_entry.selected.node})})}}t.EditDashboardController=h}),define("components/edit_mode/event/directive",["require","exports","underscore","moment-timezone","services/confirmation_service","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","components/form/common/topic_menu","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});const h=s.confirmationService,m=o.mainApplication,_=r.modelRefreshService,f=a.modelRefreshDecoratorFactory,y=l.ModelType,v=c.ModelRefreshStrategy;t.default=["$timeout","Calendar",function(e,t){return s.$inject=["$scope","$window","restFormService","configurationService","calendarService","TopicMenuWrapper","modalService","$rootScope"],{restrict:"AE",replace:!0,scope:{event:"=",removeEvent:"=",settingsMode:"=?"},controller:s,link:function(s,o,r){(function(){const i=$(o).find('div[id="range-calendar"]');if(0!==s.initialEvent.start&&0!==s.initialEvent.end){const e=n(s.initialEvent.start).format("YYYY-MM-DD"),o=n(s.initialEvent.end);0===o.hour()&&0===o.minute()&&o.subtract(1,"days");const r=o.format("YYYY-MM-DD");s.rangeCalendar=new t(i,{months:2,mode:"range",viewStartDate:e,selected:[e,r],useYearNav:!1,format:"YYYY-MM-DD"})}else s.rangeCalendar=new t(i,{months:2,mode:"range",useYearNav:!1,format:"YYYY-MM-DD"});s.noRangeSelected=!c(),s.rangeCalendar.subscribe("change",function(){s.$apply(function(){s.noRangeSelected=!c(),function(){const t=s.rangeCalendar.getSelectedAsText(),i=n(t[0]),o=n(t[t.length-1]);s.startRange=i.format("DD/MM/YYYY"),s.endRange=o.format("DD/MM/YYYY"),s.fromHoursChanged(),i.hour(Number(s.values.from.hours)).minute(Number(s.values.from.minutes)).second(0).millisecond(0),o.hour(Number(s.values.to.hours)).minute(Number(s.values.to.minutes)).second(0).millisecond(0),s.event.start=i.toDate().getTime(),s.event.end=o.toDate().getTime(),e(function(){s.dateCalendar.setSelected([i.format("YYYY-MM-DD")])},0,!1)}()})})})(),function(){const e=$(o).find('div[id="date-calendar"]');if(0!==s.initialEvent.date){const i=n(s.initialEvent.date).tz(s.initialEvent.timezone).format("YYYY-MM-DD");s.dateCalendar=new t(e,{months:2,mode:"single",viewStartDate:i,selected:[i],useYearNav:!1,blackout:l,format:"YYYY-MM-DD"})}else s.dateCalendar=new t(e,{months:2,mode:"single",useYearNav:!1,blackout:l,format:"YYYY-MM-DD"});s.noDateSelected=!a(),s.dateCalendar.subscribe("change",function(){s.$apply(function(){s.noDateSelected=!a(),function(){const e=i.first(s.dateCalendar.getSelectedAsText()),t=n.tz(e,s.event.timezone);t.hour(Number(s.eventTime.hours)).minute(Number(s.eventTime.minutes)).second(0).millisecond(0),s.event.date=t.toDate().getTime(),s.eventDate=t.format("DD/MM/YYYY")}()})})}(),i.isUndefined(r.settingsMode)||("true"===r.settingsMode&&(s.settingsMode=!0),"false"===r.settingsMode&&(s.settingsMode=!1));function a(){const e=s.dateCalendar.getSelectedAsText();return!!(e&&e.length>0)}function c(){const e=s.rangeCalendar.getSelectedAsText();if(e&&e.length>0){if(2===e.length&&e[0]!==e[1])return!0;if(s.values.to.hours>s.values.from.hours)return!0;if(s.values.to.hours===s.values.from.hours&&s.values.to.minutes>s.values.from.minutes)return!0}return!1}function l(e){const t=s.rangeCalendar.getSelectedAsText();return!function(e,t){const o=n(i.first(e)),r=n(i.last(e)),a=n(t).format("YYYY-MM-DD"),c=n(a).diff(o),l=r.diff(n(a));return c>=0&&l>=0?(s.dateInRange=!0,s.dateInRange):(s.dateInRange=!1,s.dateInRange)}(t,e.toDate().getTime())}},templateUrl:u.templateSourceFactory("components/edit_mode/event")};function s(e,t,s,o,r,a,c,l){const u=constants.topic_menu.TYPE.event;C(e.event),e.values={from:{},to:{}},e.eventTime={},e.currentTopicName=e.event.name,e.showDateCalendar=!1,e.showRangeCalendar=!1,r.initializeCalendarTimeValues(e.values,e.event.start,e.event.end),w(),e.progressOptions={action:constants.events.form.action.update,isDisabled:e.isSaveDisabled,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")};function S(){return new a(e.event.event_type_menu).getFirstSelectedEntry().getMappedId()}function b(){const t=e.rangeCalendar.getSelectedAsText(),i=1===t.length?t[0]:t[1];e.event.start=r.changeTimePart(t[0],e.event.timezone,e.values,"from"),e.event.end=r.changeTimePart(i,e.event.timezone,e.values,"to")}function w(){if(0!==e.event.date){const t=n(e.event.date).tz(e.event.timezone);e.eventDate=t.format("DD/MM/YYYY"),e.eventTime.hours=t.format("HH"),e.eventTime.minutes=t.format("mm")}else e.eventDate="-";if(0!==e.event.start&&0!==e.event.end){e.startRange=n(e.event.start).format("DD/MM/YYYY");const t=n(e.event.end);0===t.hour()&&0===t.minute()&&t.subtract(1,"days"),e.endRange=t.format("DD/MM/YYYY")}else e.startRange="",e.endRange=""}function C(t){e.initialEvent={name:JSON.parse(JSON.stringify(e.event.name)),description:JSON.parse(JSON.stringify(e.event.description)),date:JSON.parse(JSON.stringify(e.event.date)),start:JSON.parse(JSON.stringify(e.event.start)),end:JSON.parse(JSON.stringify(e.event.end)),timezone:JSON.parse(JSON.stringify(e.event.timezone))}}e.save=function(){s.post(e.event.save_link,e.event,constants.events.form.action.update).then(function(t){if(e.settingsMode)l.redirect(e.event.root_link_back);else{e.event=t,e.currentTopicName=e.event.name,e.toggleDateCalendar(!1),e.toggleRangeCalendar(!1),C(e.event);const i={strategy:v.REFRESH},n=f.getDecorator(m.getPageState(),m,y.PAGE_STATE,i);_.refresh(n,i).then(function(){},function(e){e instanceof Error&&d.logService.error("Error when refreshing page state after saving event !",void 0,e)})}},function(e){})},e.cancel=function(){if(e.settingsMode)t.location.href=e.event.root_link_back;else{for(const t in e.initialEvent)e.initialEvent.hasOwnProperty(t)&&(e.event[t]=e.initialEvent[t]);w(),e.toggleDateCalendar(!1),e.toggleRangeCalendar(!1)}},e.remove=function(t,i){i.preventDefault(),h.display({message:t.confirm_question}).then(function(){!function(t){s.deleter(t.link_delete).then(function(i){e.removeEvent?e.removeEvent(t,e.event.mapped_id):(e.settingsMode&&l.redirect(e.event.root_link_back),p.brokerService.publish(constants.events.topic.remove,[e.event.parent_mapped_id,e.event.mapped_id,u,!0]),e.event={})},function(t){e.event.field_messages=t.field_messages})}(t)},function(){})},e.toggleDateCalendar=function(t){e.showDateCalendar=void 0!==t?t:!e.showDateCalendar},e.toggleRangeCalendar=function(t){e.showRangeCalendar=void 0!==t?t:!e.showRangeCalendar},e.eventHoursChanged=function(){if(void 0!==e.eventTime.hours&&2===e.eventTime.hours.length)if(function(e){return/([0-1][0-9]|2[0-3])/.test(e)}(e.eventTime.hours)){const t=n(e.event.date);t.hour(Number(e.eventTime.hours)),e.event.date=t.toDate().getTime()}else e.eventTime.hours=""},e.eventMinutesChanged=function(){if(void 0!==e.eventTime.minutes&&2===e.eventTime.minutes.length)if(r.validateMinutes(e.eventTime.minutes,e.eventTime.hours)){const t=n(e.event.date).tz(e.event.timezone);t.minute(Number(e.eventTime.minutes)),e.event.date=t.toDate().getTime()}else e.eventTime.minutes=""},e.fromHoursChanged=function(){i.isUndefined(e.values.from.hours)||2!==e.values.from.hours.length||(r.fromHoursChanged(e.values,e.rangeCalendar),b(),e.event.start>e.event.date&&(e.event.date=e.event.start,e.eventTime.hours=e.values.from.hours))},e.toHoursChanged=function(){i.isUndefined(e.values.to.hours)||2!==e.values.to.hours.length||(r.toHoursChanged(e.values,e.rangeCalendar),b(),e.event.end<e.event.date&&(e.event.date=e.event.end))},e.fromMinutesChanged=function(){i.isUndefined(e.values.from.minutes)||2!==e.values.from.minutes.length||(r.fromMinutesChanged(e.values,e.rangeCalendar),b(),e.event.start>e.event.date&&(e.event.date=e.event.start,e.eventTime.minutes=e.values.from.minutes))},e.toMinutesChanged=function(){i.isUndefined(e.values.to.minutes)||2!==e.values.to.minutes.length||(r.toMinutesChanged(e.values,e.rangeCalendar),b(),e.event.end<e.event.date&&(e.event.date=e.event.end))},e.selectText=function(e){e.stopPropagation(),$(e.target).select()},e.setDefaultFromHours=function(){i.isUndefined(e.values.from.hours)||0!==e.values.from.hours.length||(e.values.from.hours=o.getCalendarConfiguration().getDefaultTimeValuesFrom().hours,e.fromHoursChanged())},e.setDefaultFromMinutes=function(){i.isUndefined(e.values.from.minutes)||0!==e.values.from.minutes.length||(e.values.from.minutes=o.getCalendarConfiguration().getDefaultTimeValuesFrom().minutes,e.fromMinutesChanged())},e.setDefaultToHours=function(){i.isUndefined(e.values.to.hours)||0!==e.values.to.hours.length||(e.values.to.hours=o.getCalendarConfiguration().getDefaultTimeValuesTo().hours,e.toHoursChanged())},e.setDefaultToMinutes=function(){i.isUndefined(e.values.to.minutes)||0!==e.values.to.minutes.length||(e.values.to.minutes=o.getCalendarConfiguration().getDefaultTimeValuesTo().minutes,e.toMinutesChanged())},e.setDefaultEventTime=function(){if(void 0!==e.eventTime.hours&&0===e.eventTime.hours.length||void 0!==e.eventTime.minutes&&0===e.eventTime.minutes.length){const t=n(e.event.date);e.eventTime.hours=t.format("HH"),e.eventTime.minutes=t.format("mm")}},e.isSaveDisabled=function(){return!i.isUndefined(e.event.event_type_menu)&&S()===constants.event_form.event_type.fixed_period&&(e.noRangeSelected||e.noDateSelected)},e.isTrailingPeriodSelected=function(){return!i.isUndefined(e.event.event_type_menu)&&S()===constants.event_form.event_type.trailing_period},e.isFixedPeriodSelected=function(){return!i.isUndefined(e.event.event_type_menu)&&S()===constants.event_form.event_type.fixed_period},e.changeCustomColor=function(t){c.display("TOPIC_CUSTOM_COLOR",t).then(function(t){e.changeEventColor(t.mapped_id),g.recursiveChildrenSelect(e.event.colors_menu.root_entry,constants.topic_entry.selected.none),t.selected=constants.topic_entry.selected.node})},e.changeEventColor=function(t){e.event.color=t},e.$on("$destroy",function(){e.dateCalendar.dispose(),e.rangeCalendar.dispose()})}}]}),define("components/edit_mode/events/directive",["require","exports","underscore","services/template_source","services/broker"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{templateUrl:n.templateSourceFactory("components/edit_mode/events"),replace:!0,restrict:"AE",scope:{eventsContainer:"="},controller:["$scope","restFormService","topicService",function(e,t,n){const o=constants.root_id.my_events,r=constants.topic_menu.TYPE.event;e.newEvent=function(t){t.preventDefault(),n.addTopicEntry(r,void 0,!1,!1).then(function(t){e.eventsContainer.events.push(t)},function(e){})},e.removeEvent=function(t,n){e.eventsContainer.events=i.without(e.eventsContainer.events,i.findWhere(e.eventsContainer.events,{id:t.id})),s.brokerService.publish(constants.events.topic.remove,[o,n,r])}}]}}]}),define("components/edit_mode/page_monitoring/directive",["require","exports","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","notifications","services/commons","services/refresh/model_refresh_service","underscore","services/context","services/loading_bubble","services/template_source","services/tw_common"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});const m=h.twCommon,_=a.notificationService,f=g.contextService,y=i.mainApplication,v=l.modelRefreshService,S=n.modelRefreshDecoratorFactory,b=o.ModelType,w=s.ModelRefreshStrategy;t.default=["$window","topicMenuService",function(e,t){return i.$inject=["$scope","$q","restFormService"],{restrict:"AE",scope:{pagesMonitoring:"="},controller:i,templateUrl:p.templateSourceFactory("components/edit_mode/page_monitoring")};function i(i,n,s){i.canFetchOwnedPages=a,i.canShowSearchbar=function(){return l()&&!g(i.social_media_accounts.facebook_insights.code)&&!g(i.social_media_accounts.linked_in.code)&&!g(i.social_media_accounts.review_trackers.code)&&!g(i.social_media_accounts.instagram_insights.code)},i.isSitePageFeatureAllowed=l,i.suggestionPages=function(e){const t=n.defer();return e.input_object&&e.input_object.url?s.post(i.pagesMonitoring.suggestion_page_url,e).then(function(i){e.children=i.children,t.resolve(e.children)},function(i){e.input_object.field_messages=i.field_messages,t.reject()}):t.reject(),t.promise};const o=function(){const e={name:i.selectedSitePage.name,site_pages:[i.selectedSitePage]},n=y.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.page_monitoring);u.loadingBubbleService.showSpinner(),t.addTopicEntry(n,e,void 0,!0).then(function(){const e={strategy:w.REFRESH},t=S.getDecorator(y.getPageState(),y,b.PAGE_STATE,e);v.refresh(t,e).then(function(){},function(e){e instanceof Error&&r.logService.error("Error when refreshing page state after adding group !",void 0,e)})}).then(function(){})};function a(e){if(void 0===e){if(i.noSelection&&!i.pagesMonitoring.one_site_only)return!1;{const e=i.getSitePages(!0);for(const t in i.pagesMonitoring.owned_pages_searches)if(e[t])return!0;return!1}}return void 0!==i.pagesMonitoring.owned_pages_searches[e]}function l(){return!0===i.pagesMonitoring.one_site_only||!i.noSelection&&!i.pagesMonitoring.one_site_only}function g(e){let t=!1;if(i.noSelection)return i.pagesMonitoring.site_code===e;{const n=i.getSitePages(!0);for(const i in n)if(i===e){t=!0;break}return t}}function p(t,n){const o=constants.social_media_accounts[t].client_name,r=constants.social_media_accounts[t].oauth_enabled;!function(e,t){const i={client_name:"none",source:f.getCurrentContext().scope,source_id:f.getCurrentContext().id,type:"SMA"};s.get(routes.controllers.tw.TWRestForm.post(i.source,i.source_id,"page_monitoring","validate","","rform").url,i).then(function(i){e.external_connection={},d.each(d.keys(i.external_connection),function(t){e.external_connection[t]=i.external_connection[t]}),t()})}(i.pagesMonitoring,function(){!i.pagesMonitoring.external_connection[t]&&r?function(t,i){e.socialMediaAccountCallBack=function(e){i()};const n={client_name:t,source:f.getCurrentContext().scope,source_id:f.getCurrentContext().id,type:"SMA",protocol:m.extractProtocol(e.location.protocol)};s.post(routes.controllers.tw.TWRestForm.post(n.source,n.source_id,"external_authentication","new","","settings").url,n).then(function(t){const i=e.open(t.url,t.client_name+"- connection","width=800,height=600");c.commons.checkPopupBlocked(i)&&_.error(window.messages.get("_817156"),{permanent:!0})})}(o,function(){n(t)}):n(t)})}function h(e){const t=JSON.parse(JSON.stringify(i.getSitePages(!1)));t.input_object.url=i.pagesMonitoring.owned_pages_searches[e],i.isOwnedPagesLoading=!0,i.suggestionPages(t).then(function(e){i.ownedPagesSuggestions=e,i.isOwnedPagesLoading=!1},function(){i.isOwnedPagesLoading=!1})}i.addGroup=function(e){i.selectedSitePage=e,p(e.icon_type,o)},i.isSelectedMediaType=function(){return i.pagesMonitoring.specific_search.length>0},i.getSitePages=function(e,t){if(t)return d.map(i.pagesMonitoring.specific_search,function(e){return e.search_list});{let t;for(let n=0;n<i.pagesMonitoring.specific_search.length;n++){const s=i.pagesMonitoring.specific_search[n];let o=!1;for(const i in s.search_list)if(d.has(constants.social_media_accounts,i)&&(o=s.search_list[i])){t=!0===e?s.search_list:s;break}if(o)break}return t}},i.getSitePagesKeys=function(e){const t=[];for(const i in e)d.has(constants.social_media_accounts,i)&&t.push(i);return t},i.switchFilter=function(e){if(i.ownedPagesSuggestions=void 0,i.noSelection)for(let t=0;t<i.pagesMonitoring.specific_search.length;t++){const n=i.pagesMonitoring.specific_search[t];if(d.has(n.search_list,e)){n.input_object.url=i.currentFilterObject.input_object.url,i.currentFilterObject=n,n.search_list[e]=!0,i.noSelection=!1,a(e)?p(e,h):p(e,()=>void 0);break}}else d.each(i.pagesMonitoring.specific_search,function(t){for(const n in t.search_list)d.has(constants.social_media_accounts,n)&&(n===e?(t.search_list[e]=!0,t.input_object.url=i.currentFilterObject.input_object.url,i.currentFilterObject=t,a(e)?p(e,h):p(e,()=>void 0)):t.search_list[n]=!1)})},i.getReviewSites=function(){return constants.review_sites},i.isExternalUrlSelected=function(){return g(i.social_media_accounts.external_url.code)},_.display(i.pagesMonitoring.notification),i.selectedSitePage={},i.social_media_accounts=constants.social_media_accounts,i.isOwnedPagesLoading=!1,i.noSelection=!1,i.currentFilterObject=d.first(i.pagesMonitoring.specific_search),i.socialMediaList=i.getSitePages(!0,!0),a()&&p(i.pagesMonitoring.site_code,h)}}]}),define("components/edit_mode/page_monitoring/group/directive",["require","exports","underscore","services/commons","components/form/common/topic_menu","classes/context_data/context_data","notifications","services/confirmation_service","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});const m=o.contextData,_=r.notificationService,f=a.confirmationService,y=c.mainApplication,v=l.modelRefreshService,S=d.modelRefreshDecoratorFactory,b=u.ModelType,w=g.ModelRefreshStrategy;t.default=["topicService","restFormService","navigationService","modalService",function(e,t,o,r){return a.$inject=["$scope","$window","$q"],{restrict:"A",scope:{group:"="},controller:a,templateUrl:h.templateSourceFactory("components/edit_mode/page_monitoring/group")};function a(o,a,c){const l=constants.topic_menu.TYPE.page_monitoring;o.social_media_accounts=constants.social_media_accounts,o.save_action=constants.events.form.action.update,o.suggestion_pages=[],o.advancedOptions=!1,o.hasName=function(e){return!(!e.name||/^\s*$/.test(e.name))},o.isSearch=function(e){return"search"===e.monitored_page.site_mon_keys[0].type.type||"email"===e.monitored_page.site_mon_keys[0].type.type},o.isSearchResults=function(e){return"search_results"===e.monitored_page.site_mon_keys[0].type.type},o.removePage=function(e,t){t.preventDefault(),f.display({message:e.confirm_question}).then(function(){d(e)},function(){})};const d=function(t){e.removeTopicEntry(l,t.link_delete).then(function(e){o.group.site_pages=i.without(o.group.site_pages,i.findWhere(o.group.site_pages,{mapped_id:t.mapped_id}))},function(e){o.group.field_messages=e.field_messages})};o.remove=function(e){e.preventDefault(),f.display({message:o.group.confirm_remove_question}).then(function(){g()},function(){})};const g=function(){e.removeTopicEntry(l,o.group.remove_url,o.group.parent_mapped_id,o.group.mapped_id,!0).then(function(e){o.group={}},function(e){o.group.field_messages=e.field_messages})};function u(){t.post(o.group.add_page_url,o.selectedSitePage).then(function(e){o.group.site_pages.push(e),o.one_page={},o.group.searchs.input_object={}},function(e){o.group.field_messages={},o.group.field_messages.url=e.field_messages.url})}o.suggestionPages=function(e){const i=c.defer();return e.input_object&&e.input_object.url?t.post(o.group.suggestion_page_url,e).then(function(t){e.children=t.children,i.resolve(e.children)},function(t){e.input_object.field_messages=t.field_messages,i.reject()}):i.reject(),i.promise},o.save=function(){e.saveTopicEntry(l,o.group,o.group.save_link,!1,o.save_action).then(function(e){const t={strategy:w.REFRESH},i=S.getDecorator(y.getPageState(),y,b.WIDGET,t);v.refresh(i,t).then(function(){},function(e){e instanceof Error&&p.logService.error("Error when refreshing page state after saving !",void 0,e)})},function(e){o.group.field_messages=e.field_messages})},o.connectExternalAccount=function(e){const i=tw.project_id,s={client_name:e,source:i?"project":"none",source_id:i||"none",type:"SMA",protocol:function(e){if(0===e.indexOf("https"))return"https";if(0===e.indexOf("http"))return"http";return null}(a.location.protocol)};t.post(routes.controllers.tw.TWRestForm.post(s.source,s.source_id,"external_authentication","new","","settings").url,s).then(function(e){const t=a.open(e.url,e.client_name+"- connection","width=800,height=600");n.commons.checkPopupBlocked(t)&&_.success(window.messages.get("_817156"),{permanent:!0})})},a.socialMediaAccountCallBack=function(e){u()},o.addOnePage=function(e){o.selectedSitePage=e;const n=constants.social_media_accounts[e.icon_type].client_name,s=constants.social_media_accounts[e.icon_type].oauth_enabled;!function(e,t,n){const s=tw.project_id,o={client_name:"none",source:s?"project":"none",source_id:s||"none",type:"SMA"};t.get(routes.controllers.tw.TWRestForm.post(o.source,o.source_id,"group_site_page","validate","","rform").url,o).then(function(t){e.external_connection={},i.each(i.keys(t.external_connection),function(i){e.external_connection[i]=t.external_connection[i]}),n()})}(o.group,t,function(){!o.group.external_connection[e.icon_type]&&s?o.connectExternalAccount(n):u()})},o.userRebuildsAvailable=function(){return m.rules.isRebuildsEnabled()},o.toggleAdvancedOptions=function(){o.advancedOptions=!o.advancedOptions},o.cancel=function(){const e={strategy:w.REFRESH},t=S.getDecorator(y.getPageState(),y,b.PAGE_STATE,e);v.refresh(t,e).then(function(){},function(e){e instanceof Error&&p.logService.error("Error when refreshing page state after cancel !",void 0,e)})},o.group.name=o.group.name?o.group.name.substring(0,24):o.group.name,o.updateTopicMenuName=function(t){e.updateTopicMenuName(t)},o.changeCustomColor=function(e){r.display("TOPIC_CUSTOM_COLOR",e).then(function(e){o.changeGroupColor(e.mapped_id),s.recursiveChildrenSelect(o.group.colors_menu.root_entry,constants.topic_entry.selected.none),e.selected=constants.topic_entry.selected.node})},o.changeGroupColor=function(e){o.group.color=e},o.showUpdatedTimeStamp=function(){return!m.rules.isOriginalUserEnabled()}}}]}),define("components/edit_mode/page_monitoring/logo/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",replace:!0,scope:{group:"="},controller:["$scope",function(e){constants.topic_menu.TYPE.page_monitoring;e.social_media_accounts=constants.social_media_accounts,e.getTimestamp=function(){return window.bootPayload.version}}],templateUrl:i.templateSourceFactory("components/edit_mode/page_monitoring/logo")}}]}),define("queries/page_state_queries",["require","exports","query_system"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.queryPageStateGetWidgets="data_input_configuration",t.queryPageStateGetUfs="user_filter_settings",t.queryPageStateIsEditMode="edit_mode",t.queryPageStateGetWidgetByIndex=(e=>new i.Query([t.queryPageStateGetWidgets,i.queryArrayIndex(e)])),t.queryPageStateGetWidgetById=(e=>new i.Query([t.queryPageStateGetWidgets,i.queryFilterByProperty("widget_id",e)]))}),define("queries/ufs_queries",["require","exports","query_system"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.queryUfsGetTopics="topics",t.queryUfsGetTopicByType=(e=>new i.Query([t.queryUfsGetTopics,i.queryUnderscore.filter(t=>t.type===e)]))}),define("components/sidebar/sidebar_query",["require","exports","query_system","reusable_components","underscore","classes/context_data/context_data","queries/application_queries","queries/page_state_queries","queries/ufs_queries","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=constants.topic_menu.TYPE,g=[...r.queryApplicationGetMainPageState,a.queryPageStateGetUfs,c.queryUfsGetTopics],u=new i.ProviderQuery([constants.root_id.default_search,constants.root_id.default_filter,constants.root_id.default_report]),p={[d.topic]:o.contextData.getMessage("_1969876"),[d.page_monitoring]:o.contextData.getMessage("_1852063"),[d.filter]:o.contextData.getMessage("_1809355"),[d.event]:o.contextData.getMessage("_1845065"),[d.web_connector]:o.contextData.getMessage("_1477986"),[d.issue_tracker_brand]:o.contextData.getMessage("_1618886"),[d.issue_tracker_issue]:o.contextData.getMessage("_1237341"),[d.issue_watchlist]:o.contextData.getMessage("_1874984")},h={[d.topic]:o.contextData.getMessage("_1276792"),[d.filter]:o.contextData.getMessage("_1276792")},m={[d.topic]:constants.root_id.default_search,[d.event]:constants.root_id.my_events,[d.filter]:constants.root_id.default_filter},_=[...r.queryApplicationGetMainPageState,a.queryPageStateIsEditMode,new i.TransformationQuery(e=>!!e)],f=[...r.queryApplicationGetMainPageState,"allowed_pages","group_page",new i.TransformationQuery(e=>"REPORT"===e)],y=new i.TransformationQuery(e=>(s.each(e,e=>{!function e(t){t.children=s.filter(t.children,e=>"NOT_VISIBLE"!==e.visibility),s.each(t.children,e)}(e.root_entry)}),e)),v=new i.TransformationQuery(e=>(s.each(e,e=>{!function e(t){t.children=s.filter(t.children,e=>"NEVER_VISIBLE"!==e.visibility),s.each(t.children,e)}(e.root_entry)}),e));const S=new i.TransformationQuery(e=>{const t=[];return s.each(e,e=>{[d.issue_tracker_brand,d.issue_tracker_issue,d.issue_watchlist].includes(e.type)?t.push(function(e){const t=Object.assign({},e),i=t.root_entry;return t.root_entry=Object.assign({},i,l.TopicMenuUtils.getAllNode(e)),t}(e)):t.push(e)}),t}),b=new i.ProviderQuery({sort_group:o.contextData.getMessage("_1334350"),sort_all:o.contextData.getMessage("_1334351"),uncategorized:o.contextData.getMessage("_1892048")}),w=new i.ForkQuery(_,{true:[i.queryFilterByProperty("type",[d.topic,d.page_monitoring,d.filter,d.event,d.web_connector,d.issue_tracker_brand,d.issue_tracker_issue,d.issue_watchlist]),v,S],false:[i.queryExcludeByProperty("type",[d.event,d.filter,d.topic_pm_composed]),y]},g),C=new i.ProviderQuery((e,t)=>s.contains([constants.topic_menu.TYPE.event,constants.topic_menu.TYPE.report],e.type)?!!e.root_entry.children&&s.any(e.root_entry.children,e=>e.topic_add===constants.topic_entry.add_strategy.add):t&&e.root_entry.topic_add===constants.topic_entry.add_strategy.add),E=new i.ProviderQuery((e,t)=>t&&s.contains([constants.topic_menu.TYPE.topic,constants.topic_menu.TYPE.filter],e.type)),T=i.queryUnderscore.map(e=>e.type);t.sidebarQuery=new i.Query({settings:new i.QueryArrayToMap([w,T],e=>({hideCategories:u,canAdd:C,canAddGroup:E,canEnableGrouping:new i.ProviderQuery((e=>s.contains([d.filter,d.topic],e))(e)),canSortChildren:new i.ProviderQuery((e=>s.contains([d.page_monitoring,d.topic,d.filter],e))(e)),canShowRootName:new i.ProviderQuery(!0),canCollapseAll:new i.ProviderQuery(!0),groupDropzoneConfig:new i.ProviderQuery((()=>{const t={[e+"children"]:{type:n.DropzoneType.children,typeSpecificConfig:{childrenSelector:"li",canChangeParent:e!==d.page_monitoring,canDropOnParent:!0}}};return e!==d.page_monitoring&&(t[e+"categories"]={type:n.DropzoneType.self}),t})()),addButtonLabel:new i.ProviderQuery(p[e]),addGroupButtonLabel:new i.ProviderQuery(h[e]),defaultCategory:new i.ProviderQuery(m[e]),canHighlightRoot:_,canDragAndDrop:i.queryAnd(i.queryOr(_,f),new i.ProviderQuery((e=>!s.contains([d.issue_tracker_brand,d.issue_tracker_issue],e))(e))),highlightDirectChildren:i.queryAnd(_,new i.ProviderQuery((e=>d.page_monitoring===e)(e))),highlightChildrenRecursive:[..._,i.queryNegate]})),messages:[b],editMode:_,menus:[w],getMenuSubQuery:new i.ProviderQuery((e,t)=>e.createSubQuery({messages:"messages",editMode:"editMode",settings:["settings",t],menu:["menus",i.queryFindByProperty("type",t)]}))})}),define("components/edit_mode/project/setup_description/directive",["require","exports","components/sidebar/sidebar_query","flux","reusable_components","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=i.sidebarQuery,c=n.dispatcher,l=s.sidebarActions,d=o.mainApplication;t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{form:"="},controller:e,link:function(e,t){},templateUrl:r.templateSourceFactory("components/edit_mode/project/setup_description")};function e(e){e.requestAdd=function(e){const t=a.execute();c.dispatch(l.sidebar_onAddButtonClicked,{query:t.getMenuSubQuery(a,e.getType()),containerQuery:a})},e.getTopics=function(){return d.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.topic)},e.getPagemonitoring=function(){return d.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.page_monitoring)},e.getFilters=function(){return d.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.filter)},e.getEvents=function(){return d.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.event)}}}]}),define("components/edit_mode/report/configuration_ui/directive",["require","exports","reusable_utilities","services/icons","event_bus","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",bindToController:{menu:"="},scope:{},controller:r,controllerAs:"vm",templateUrl:o.templateSourceFactory("components/edit_mode/report/configuration_ui")}};class r{constructor(){}$onInit(){this.outputTypes=[],this.templates={type:"REPORT_OUTPUT_TYPE_AND_TEMPLATES",root_entry:{children:[]}};const e=i.TopicEntryUtils.getFirstSelectedChild(this.menu.root_entry);if(void 0!==e&&i.TopicEntryUtils.hasChildren(e)){this.outputTypes.push(...e.children);const t=i.TopicEntryUtils.getFirstSelectedChild(e);void 0!==t&&i.TopicEntryUtils.hasChildren(t)&&this.templates.root_entry.children.push(...t.children)}}changeOutputTypesForOrientation(e){i.TopicEntryUtils.recursiveUnselectAndSelect(this.menu.root_entry,e.mapped_id),this.unselectOutputTypes(),this.outputTypes.length=0,this.unselectTemplates(),this.templates.root_entry.children.length=0,i.TopicEntryUtils.hasChildren(e)&&(this.outputTypes.push(...e.children),this.selectOutputType(this.outputTypes[0]))}selectOutputType(e){this.unselectOutputTypes(),i.TopicEntryUtils.setSelection(e,!0),this.unselectTemplates(),this.templates.root_entry.children.length=0,i.TopicEntryUtils.hasChildren(e)&&(this.templates.root_entry.children.push(...e.children),i.TopicEntryUtils.setSelection(this.templates.root_entry.children[0],!0),s.eventBus.dispatch({type:s.EVENT_TYPES.IMAGE_SELECTOR_LIST_UPDATE,value:{menu:this.templates}}))}isEntrySelected(e){return i.TopicEntryUtils.isSelected(e)}getOutputTypeIcon(e){return n.iconService.getIconForReportOutputType(e.mapped_id)}getReportFormatIcon(e){return n.iconService.getIconForReportFormat(e.mapped_id)}canShowTemplatesAvailable(){return void 0!==this.templates&&this.templates.root_entry.children.length>1}isTemplatesAvailable(){return void 0!==this.templates&&this.templates.root_entry.children.length>0}canShowNoTemplatesMessage(){if(!this.isTemplatesAvailable()){const e=i.TopicEntryUtils.getFirstSelectedChild(this.menu.root_entry);if(void 0!==e&&i.TopicEntryUtils.hasChildren(e)){const t=i.TopicEntryUtils.getFirstSelectedChild(e);return!["DOCX","HTML","PPTX","PPTX_PDF"].includes(t.mapped_id)}}return!1}hasTooltip(e){return void 0!==e.description&&e.description.length>0}unselectOutputTypes(){this.outputTypes.forEach(e=>i.TopicEntryUtils.setSelection(e,!1))}unselectTemplates(){this.templates.root_entry.children.forEach(e=>i.TopicEntryUtils.setSelection(e,!1))}}t.ReportConfigurationUiController=r}),define("components/edit_mode/report/layout/directive",["require","exports","angular_utilities","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,scope:{outputTypes:"="},controllerAs:"vm",bindToController:{},controller:s,templateUrl:n.templateSourceFactory("components/edit_mode/report/layout")}};let s=class{constructor(e){this.$scope=e}$onInit(){this.$scope.selectOutputType=function(e){this.$scope.outputTypes.selectEntry(e)},this.$scope.isEmail=function(e){return e.getMappedId()===constants.output_type.html},this.$scope.isDocx=function(e){return e.getMappedId()===constants.output_type.docx},this.$scope.isPptx=function(e){return e.getMappedId()===constants.output_type.pptx},this.$scope.isPdf=function(e){return e.getMappedId()===constants.output_type.docx_pdf||e.getMappedId()===constants.output_type.pptx_pdf},this.$scope.isGrid=function(e){return e.getMappedId()===constants.output_type.pptx_grid||e.getMappedId()===constants.output_type.pptx_grid_pdf}}};s=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],s)}),define("components/edit_mode/report/schedule/directive",["require","exports","underscore","components/form/common/topic_menu","common_constants","services/confirmation_service","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=o.confirmationService;t.default=[function(){return e.$inject=["$scope","$window","modalService","UserFilterSettingsWrapper","configurationService","bubbleDialogService","restFormService"],{restrict:"AE",scope:{report:"="},controller:e,link:function(e,t,i){},templateUrl:r.templateSourceFactory("components/edit_mode/report/schedule")};function e(e,t,o,r,c,l,d){const g=e;function u(){n.getSelectedValue(e.report.trigger_type.root_entry).mapped_id===e.report.trigger_results_constant_new_results&&e.report.show_sorting_warning?(e.warn_sort_by_message=window.messages.get("_931329",[e.report.results_threshold,e.report.sorting_type.toLowerCase()]),e.warn_sort_by=!0):e.warn_sort_by=!1}function p(){return!(g.isTimeUnitDayOptionSelected()||g.isTimeUnitWeekDayOptionSelected()||g.isTimeUnitHourOptionSelected())}function h(){if(!e.report||!e.report.trigger_type)return!1;const t=n.getSelectedValue(e.report.trigger_type.root_entry),s=[e.report.trigger_time_constant];return t&&i.contains(s,t.mapped_id)}function m(){if(!e.report||!e.report.trigger_type)return!1;const t=n.getSelectedValue(e.report.trigger_type.root_entry),s=[e.report.trigger_results_constant_new_results,e.report.trigger_results_constant_irregular_absolute,e.report.trigger_results_constant_irregular_percent,e.report.trigger_results_constant_irregular_week_percent,e.report.trigger_results_constant_smart_spike];return t&&i.contains(s,t.mapped_id)}function _(t){return function(){if(m()&&e.report&&e.report.trigger_results){u();const i=n.getSelectedValue(e.report.trigger_type.root_entry),s=constants.alert_trigger_result[i.mapped_id];if(s)switch(t){case"pourcents":return s.pourcents_required;case"days":return s.day_required;case"results_threshold":return s.results_threshold;case"smart_spike_level":return s.smart_spike_level_required;default:return!1}}return!1}}function f(t){return function(){if(h()&&e.report&&e.report.trigger_time_unit){const i=n.getSelectedValue(e.report.trigger_time_unit.root_entry),s=constants.alert_timeunit_result[i.mapped_id];if(s)switch(t){case"hour":return s.hour;case"day":return s.day;case"week_day":return s.week_days;case"interval":return s.interval;default:return!1}}return!1}}function y(t,i){e.report.report_scheduled=t,e.report.silence_notifications=!!i,d.post(e.report.update_link,e.report).then(function(t){e.report.silence_notifications=!1,v(t)},function(t){e.report.silence_notifications=!1,v(t)})}function v(t){for(const i in t)t.hasOwnProperty(i)&&(e.report[i]=t[i]);u()}function S(){return(e.isResultsThresholdOptionSelected()||e.isPourcentsOptionSelected())&&!e.report.has_page_state_trigger_condition}g.warn_sort_by=!1,g.updateWarningSortBy=u,g.removeMailingList=function(e,t){t.preventDefault(),e.selected=s.topic_entry.selected.none},g.save=y,g.saveForm=function(){y(!0)},g.showMailingLists=function(){const t={mailing_lists:e.report.mailing_lists,no_list_message:e.report.no_list_message};o.display("MAILING_LISTS",t).then(function(){})},g.getMailingLists=function(){return n.getSelectedEntries(e.report.mailing_lists.root_entry)},g.showSendIfNoResultsOnOff=function(){return h()&&!p()&&e.report.results_page},g.showIncludeOnlyNewResultsInScheduledOnOff=function(){return h()&&!p()&&e.report.results_page},g.showSendFailingWeekWarning=function(){return e.isResultsThresholdOptionSelected()||e.isPourcentsOptionSelected()||e.isSmartSpikeLevelSelected()},g.editTriggerCondition=function(i){i.preventDefault();const n=e.report.link_trigger_page_state;e.save(!0,!0),t.location.href=n},g.isTriggerResultsSelected=m,g.isTriggerTimeUnitSelected=h,g.isDayOptionSelected=_("days"),g.isPourcentsOptionSelected=_("pourcents"),g.isResultsThresholdOptionSelected=_("results_threshold"),g.isSmartSpikeLevelSelected=_("smart_spike_level"),g.isTimeUnitDayOptionSelected=f("day"),g.isTimeUnitHourOptionSelected=f("hour"),g.isTimeUnitIntervalOptionSelected=f("interval"),g.isTimeUnitNowOptionSelected=p,g.isTimeUnitWeekDayOptionSelected=f("week_day"),g.showTimeZone=function(){return!m()},g.savingDisabled=S,g.confirmOverrideSorting=function(t){t.preventDefault(),a.display({message:window.messages.get("_554992")}).then(function(){e.report.override_sorting_type=!0,e.saveForm()},function(){})},g.showFilters=function(){if(e.filters){const t=c.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection);l.createSelectedFilters(constants.bubble_dialog.id.filters.selection,$("#filter"),e.filters,t,!1,void 0,!0)}},g.hideFilters=function(){l.scheduleDestructionById(constants.bubble_dialog.id.filters.selection,500)},g.progressOptions={action:constants.events.form.action.post,isDisabled:S,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")},g.report.trigger_user_filter_settings&&(g.filters=new r(g.report.trigger_user_filter_settings))}}]}),define("components/edit_mode/report/settings/directive",["require","exports","wrappers/topic_menu/topic_menu_wrapper","angular_utilities","classes/context_data/context_data","underscore","other/tw","wrappers/topic_menu/topic_entry_wrapper","services/custom_pages","services/widgets/widget_factory","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","classes/application/application","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","jquery","services/configuration","services/bubble_dialog","angular","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){function b(){return{replace:!0,restrict:"E",bindToController:{report:"="},controllerAs:"vm",controller:w,templateUrl:S.templateSourceFactory("components/edit_mode/report/settings"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=b,t.EditReportSettingsDirective=b;let w=class{constructor(e,t){this.topicService=e,this.$rootScope=t}$onInit(){this.oldCategory=this.getSelectedCategory(),this.progressOptions={action:constants.events.form.action.post,text:s.contextData.getMessage("_612374"),textCalling:s.contextData.getMessage("_911337")},this.initializeWidgetWrappers(),this.saveAction=this.save.bind(this)}getContainer(){return this.report.report_container}addToNewGroup(){if(void 0===this.reportGroupCreationDialog){const e=this.getContainer().groups,t={saveOperation:t=>this.topicService.addTopicCategory(e.type,!1,!1,{name:t})};this.reportGroupCreationDialog=y.bubbleDialogService.createByType(constants.bubble_dialog.id.group_creation,_("body"),constants.bubble_dialog.id.group_creation,t,f.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.group_creation)),this.reportGroupCreationDialog.onMessage.subscribe(t=>{this.reportGroupCreationDialog=void 0;const n=new i.TopicMenuWrapper(e);n.unselectAll(),n.getRootEntry().addChild(new a.TopicEntryWrapper({name:t.category.name,mapped_id:t.category.mapped_id,selected:constants.topic_entry.selected.node})),this.getContainer().groups=n.toProto(),this.$rootScope.$$phase||this.$rootScope.$apply()}),this.reportGroupCreationDialog.onDestroy.subscribeOnce(()=>this.reportGroupCreationDialog=void 0)}}async save(){const e=this.getSelectedCategory(),t=this.getContainer().mapped_id,i=r.tw.pageState.getUserFilterSettings(),n=o.first(i.getTopicMenuByPredicate(e=>!o.isUndefined(e.getEntryByMappedId(t)))),s=n.getEntryByMappedId(t);if(e.mapped_id!==this.oldCategory.mapped_id){const t=n.getEntryByMappedId(this.oldCategory.mapped_id),i=n.getEntryByMappedId(e.mapped_id);o.isUndefined(t)||o.isUndefined(i)||o.isUndefined(s)||(t.removeChild(s),i.addChild(s))}s.setName(this.getContainer().title),this.report=await c.customPagesService.updateReport(this.getContainer()),s.getTopicEntry().mapped_id=this.report.report_container.mapped_id,this.initializeWidgetWrappers(),this.oldCategory=this.getSelectedCategory(),this.refreshPageData()}async refreshPageData(){const e={strategy:g.ModelRefreshStrategy.REFRESH},t=h.modelRefreshDecoratorFactory.getDecorator(u.mainApplication.getPageState(),u.mainApplication,m.ModelType.PAGE_STATE,e);try{await d.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&p.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}showTemplateSelection(){return s.contextData.rules.isOriginalUserEnabled()}isOmitUnsubscribeAvailable(){return void 0!==this.getContainer().email_omit_unsubscribe}isDocxReport(){const e=this.getSelectedOutputType().toUpperCase();return e===constants.renderer_enum.word.name||e===constants.renderer_enum.pdf_for_doc.name}isPptxReport(){const e=this.getSelectedOutputType().toUpperCase();return e===constants.renderer_enum.ppt.name||e===constants.renderer_enum.pdf_for_ppt.name}initializeWidgetWrappers(){void 0!==this.reportHeader&&this.reportHeader.dispose(),void 0!==this.reportFooter&&this.reportFooter.dispose();const e=r.tw.pageState;this.getContainer().report_header&&(this.reportHeader=l.widgetFactory.wrapWidget(this.getContainer().report_header,e)),this.getContainer().report_footer&&(this.reportFooter=l.widgetFactory.wrapWidget(this.getContainer().report_footer,e))}getSelectedCategory(){return new i.TopicMenuWrapper(this.getContainer().groups).getFirstSelectedEntry().toProto()}getSelectedOutputType(){return this.getContainer().output_renderer}};w=__decorate([n.ngInject(["topicService","$rootScope"]),__metadata("design:paramtypes",[Object,Object])],w),t.EditReportSettingsController=w}),define("components/edit_mode/report_categories/directive",["require","exports","underscore","services/loading_bubble","services/template_source","services/broker"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){t.$inject=["$scope","restFormService"];const e=n.loadingBubbleService;return{replace:!0,restrict:"AE",scope:{reportCategories:"=",editMode:"="},controller:t,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/edit_mode/report_categories")};function t(t,n){t.currentFormEntry=t.reportCategories,t.partial_template=use_minified_templates?"components/edit_mode/report_categories/partial":BASE_TEMPLATE_URL+"components/edit_mode/report_categories/partial/template.html",t.reportsLoaded=!0,t.logLoaded=!1,t.deletedReportsLoaded=!1,t.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")},t.removeCategory=function(e){t.currentFormEntry.report_categories=i.without(t.currentFormEntry.report_categories,i.findWhere(t.currentFormEntry.report_categories,{category_id:e.category_id}))},t.showCategoryTitleEdit=function(){return 1===t.currentFormEntry.report_categories.length&&t.currentFormEntry.report_categories[0].show_title_edit},t.getCategory=function(e){return t.currentFormEntry.report_categories[e]},t.updateCategory=function(){const e=t.getCategory(0);n.post(e.update_link,e).then(function(e){t.currentFormEntry.report_categories[0]=e,o.brokerService.publish(constants.events.topic.update,[e.menu.root_entry.mapped_id,constants.topic_menu.TYPE.report,e.menu.root_entry])})},t.hasReports=function(){for(let e=0;e<t.currentFormEntry.report_categories.length;e++)if(t.currentFormEntry.report_categories[e].reports.length>0)return!0;return!1},t.isDeletedMode=function(){return t.currentFormEntry.deleted_mode},t.showReports=function(){n.get(t.reportCategories.report_categories_link).then(function(e){t.currentFormEntry=e,t.reportsLoaded=!0,t.logLoaded=!1,t.deletedReportsLoaded=!1})},t.showLog=function(){e.showSpinner(),n.get(t.reportCategories.report_history_link).then(function(i){t.currentFormEntry=i,t.reportsLoaded=!1,t.deletedReportsLoaded=!1,t.logLoaded=!0,e.hideSpinner()})},t.showDeletedReports=function(){n.get(t.reportCategories.deleted_reports_link).then(function(e){t.currentFormEntry=e,t.reportsLoaded=!1,t.logLoaded=!1,t.deletedReportsLoaded=!0})}}}]}),define("components/edit_mode/report_category/directive",["require","exports","underscore","notifications","services/confirmation_service","classes/custom_pages/custom_page_factory","services/icons","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});const m=n.notificationService,_=s.confirmationService,f=o.CustomPageFactory,y=r.iconService,v=a.mainApplication,S=c.modelRefreshService,b=l.modelRefreshDecoratorFactory,w=g.ModelType,C=d.ModelRefreshStrategy,E=u.logService;t.default=[function(){return e.$inject=["$scope","restFormService","modalService"],{replace:!0,restrict:"AE",scope:{reportCategory:"=",removeCategory:"="},controller:e,link:function(e,t,i){},templateUrl:p.templateSourceFactory("components/edit_mode/report_category")};function e(e,t,n){function s(){const e={strategy:C.REFRESH},t=b.getDecorator(v.getPageState(),v,w.PAGE_STATE,e);S.refresh(t,e).then(function(){},function(){})}function o(e,t){f.getPageByType(constants.custom_page.type.report,{mapped_id:e.mapped_id}).remove(t).then(function(){try{s()}catch(e){e instanceof Error&&E.error("Error when refreshing page state after removing report !",void 0,e)}})}e.handleRemoveCategory=function(i){i.preventDefault(),i.stopPropagation(),_.display({message:e.reportCategory.confirm_question}).then(function(){t.deleter(e.reportCategory.remove_link).then(function(t){e.removeCategory&&e.removeCategory(e.reportCategory)})})},e.editReport=function(t,i){if(e.reportCategory.deleted_mode)return;i.stopPropagation(),i.preventDefault();const n=v.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report);n.setEntriesSelectionRecursively(!1),n.selectEntryByMappedId(t.mapped_id),h.brokerService.publish(constants.events.page.title,[t.name]);try{s()}catch(e){e instanceof Error&&E.error("Error when refreshing page state after selecting report !",void 0,e)}},e.duplicateReport=function(e,t){t.stopPropagation(),t.preventDefault(),n.display("COPY_REPORT",e).then(function(e){if(void 0!==e)try{s()}catch(e){e instanceof Error&&E.error("Error when refreshing page state after duplicating report !",void 0,e)}})},e.sendReport=function(e,i){i.stopPropagation(),i.preventDefault();const s=e.mapped_id.split("|"),o=s[s.length-1];t.get(routes.controllers.tw.TWRestForm.get("project",tw.project_id,"report_send_later_schedule","show",o,"rform").url).then(function(e){n.display("SEND_REPORT",e)})},e.downloadReport=function(e,i){i.stopPropagation(),i.preventDefault();const n=t.get(e.export_link);m.warning('<i class="fa fa-refresh fa-spin"></i> '+window.messages.get("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:n}),n.then(function(e){e.data&&m.success(e.download_message,{permanent:!0})})},e.removeReport=function(t,i){i.stopPropagation(),i.preventDefault(),_.display({message:e.reportCategory.confirm_question}).then(function(){!function(e){return e.report_scheduled}(t)?o(t,!1):_.display({message:{message:window.messages.get("_484105"),ok:window.messages.get("_697024"),cancel:window.messages.get("_348105")}}).then(function(){o(t,!0)},function(){o(t,!1)})},function(){})},e.getOutputTypeIcon=function(e){return y.getIconForReportOutputType(e.report_output_type)||""},e.restoreReport=function(n,s){s.stopPropagation(),s.preventDefault(),t.get(n.restore_link).then(function(t){e.reportCategory.reports=i.without(e.reportCategory.reports,i.findWhere(e.reportCategory.reports,{report_id:n.report_id}))},function(e){})},e.purgeReport=function(n,s){s.stopPropagation(),s.preventDefault(),_.display({message:e.reportCategory.confirm_question}).then(function(){t.deleter(n.purge_link).then(function(t){e.reportCategory.reports=i.without(e.reportCategory.reports,i.findWhere(e.reportCategory.reports,{report_id:n.report_id}))},function(e){})},function(){})}}}]}),define("components/edit_mode/report_history/directive",["require","exports","underscore","notifications","classes/context_data/context_data","event_bus","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=n.notificationService,c=s.contextData;t.default=[function(){return{replace:!0,restrict:"AE",scope:{log:"="},controller:["$scope","restFormService",function(e,t){e.remove=function(n,s){s.preventDefault(),t.deleter(n.delete_link,e.log).then(function(t){e.log.log_items=i.without(e.log.log_items,i.findWhere(e.log.log_items,{log_item_id:n.log_item_id}))})},e.download=function(e,i){i.preventDefault();const n=t.get(e.download_link);a.warning('<i class="fa fa-refresh fa-spin"></i> '+window.messages.get("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:n}),n.then(function(e){e.data&&a.success(e.data.message,{permanent:!0})})},e.getLogItems=function(e){return e.log_items},e.hasLogItems=function(e){return e.log_items.length>0},e.isCurrentTimezone=function(e){return!(!e||!c.commonPropertiesContainer.timezone||e!==c.commonPropertiesContainer.timezone)},e.canShowReportKey=function(){return c.rules.isImpersonate()},e.canShowErrorLink=function(e){return"success"!==e.status},e.openErrorModal=function(e,i){i.preventDefault(),i.stopPropagation(),t.get(e.info_link).then(function(e){o.eventBus.dispatch({type:o.EVENT_TYPES.BUBBLE_MODAL,value:{type:"mail_error",data:e.detailed_log_item.recipient_results}})})},e.showDBKey=function(e,t){t.preventDefault(),t.stopPropagation(),a.info(e.db_key,{displayDuration:15e3,permanent:void 0})}}],templateUrl:r.templateSourceFactory("components/edit_mode/report_history")}}]}),define("components/edit_mode/topic_categories/directive",["require","exports","underscore","components/bubble_dialog/react/diff_history_query","reusable_components","react","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});const h=r.mainApplication,m=a.modelRefreshService,_=c.modelRefreshDecoratorFactory,f=d.ModelType,y=l.ModelRefreshStrategy,v=g.logService;t.default=[function(){return{restrict:"AE",scope:{topicCategories:"=",editMode:"="},controller:["$scope","restFormService","configurationService","bubbleDialogService",function(e,t,r,a){let c=constants.root_id.topic,l=constants.topic_menu.TYPE.topic;e.topicCategories.form!==constants.rform.topic_categories.TOPIC&&(c=constants.root_id.filter,l=constants.topic_menu.TYPE.filter);const d=p.brokerService.subscribe(constants.events.topic.show_history,function(){t.postRForm("topic","info",{displaying_type:"DISPLAY_ALL_TOPICS",form:e.topicCategories.form,id:c,length_histories:10,show_deleted:!1}).then(function(t){const i=t.search_query_histories,d=r.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.diff_explorer);d.setAbsoluteY(window.pageYOffset+50),a.createReactBubble(constants.bubble_dialog.id.diff_explorer,$("#page_content"),{query:n.topicHistoryQuery(i,c,l.toLowerCase(),t.last_history_id,!1,!0,void 0,"DISPLAY_ALL_TOPICS",e.topicCategories.form)},function(e){return o.createElement(s.DiffExplorer,{query:e.query,close:function(e){return function(){e.destroy(),function(){const e={strategy:y.REFRESH},t=_.getDecorator(h.getPageState(),h,f.PAGE_STATE,e);m.refresh(t,e).then(function(){},function(e){e instanceof Error&&v.error("Error when refreshing page state after closing diff explorer !",void 0,e)})}()}}(e)})},d)})});e.removeCategory=function(t){e.topicCategories.topic_categories=i.without(e.topicCategories.topic_categories,i.findWhere(e.topicCategories.topic_categories,{id:t.id}))},e.$on("$destroy",function(){p.brokerService.unsubscribe(constants.events.topic.show_history,d)})}],templateUrl:u.templateSourceFactory("components/edit_mode/topic_categories")}}]}),define("components/edit_mode/topic_category/directive",["require","exports","underscore","components/bubble_dialog/react/diff_history_query","classes/context_data/context_data","reusable_components","react","services/confirmation_service","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});const _=s.contextData,f=a.confirmationService,y=c.mainApplication,v=l.modelRefreshService,S=d.modelRefreshDecoratorFactory,b=u.ModelType,w=g.ModelRefreshStrategy,C=p.logService;t.default=[function(){return e.$inject=["$scope","restFormService","topicService","navigationService","configurationService","bubbleDialogService","modalService"],{replace:!0,restrict:"AE",scope:{topicCategory:"=",removeCategory:"=",messages:"="},controller:e,link:function(e,t,i){e.new_category={},e.new_topic={}},templateUrl:h.templateSourceFactory("components/edit_mode/topic_category")};function e(e,t,s,a,c,l,d){e.save_action=constants.events.form.action.post,e.currentCategoryName=JSON.parse(JSON.stringify(e.topicCategory.name));const g=function(){switch(e.topicCategory.form){case constants.rform.topic_category.TOPIC:return constants.topic_menu.TYPE.topic;case constants.rform.topic_category.ISSUE_TRACKER_BRAND:return constants.topic_menu.TYPE.issue_tracker_brand;case constants.rform.topic_category.ISSUE_TRACKER_ISSUE:return constants.topic_menu.TYPE.issue_tracker_issue;case constants.rform.topic_category.ISSUE_WATCHLIST:return constants.topic_menu.TYPE.issue_watchlist;default:return constants.topic_menu.TYPE.filter}}(),u=m.brokerService.subscribe(constants.events.topic.show_history,function(i){i===e.topicCategory.mapped_id&&t.postRForm("topic","info",{displaying_type:"DISPLAY_ONE_CATEGORY",form:e.topicCategory.form,id:e.topicCategory.mapped_id,length_histories:10,show_deleted:!1}).then(function(t){const i=t.search_query_histories,s=c.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.diff_explorer);s.setAbsoluteY(window.pageYOffset+50),l.createReactBubble(constants.bubble_dialog.id.diff_explorer,$("#page_content"),{query:n.topicHistoryQuery(i,e.topicCategory.mapped_id,g.toLowerCase(),t.last_history_id,!1,!0,void 0,"DISPLAY_ONE_CATEGORY",e.topicCategory.form)},function(e){return r.createElement(o.DiffExplorer,{query:e.query,close:function(e){return function(){e.destroy(),h()}}(e)})},s)})});const p=function(i){const n=i.mapped_id;t.deleter(i.link_remove_category).then(function(t){e.removeCategory?e.removeCategory(i):(e.topicCategory={},a.selectTopic(constants.root_id.topic,g)),m.brokerService.publish(constants.events.topic.remove,[function(e){switch(e){case constants.topic_menu.TYPE.topic:return constants.root_id.topic;case constants.topic_menu.TYPE.issue_watchlist:return constants.root_id.issue_watchlist;default:return constants.root_id.filter}}(g),n,g])},function(e){})};function h(){const e={strategy:w.REFRESH},t=S.getDecorator(y.getPageState(),y,b.PAGE_STATE,e);v.refresh(t,e).then(function(){},function(e){e instanceof Error&&C.error("Error when refreshing page state after closing diff explorer !",void 0,e)})}e.cancel=function(){e.topicCategory.name=e.currentCategoryName},e.save=function(){t.post(e.topicCategory.save_link,e.topicCategory).then(function(t){e.topicCategory=t;const i={mapped_id:e.topicCategory.mapped_id,name:e.topicCategory.name};m.brokerService.publish(constants.events.topic.update,[e.topicCategory.mapped_id,g,i]),h()},function(e){})},e.isReadOnlyCategory=function(){return e.topicCategory.read_only},e.isTopicCategory=function(){return e.topicCategory.type===constants.edit_type.topic},e.isFilterCategory=function(){return e.topicCategory.type===constants.edit_type.filter},e.isSearchCategory=function(){return e.topicCategory.type===constants.edit_type.search},e.shouldShowColorPicker=function(){return e.topicCategory.form!==constants.rform.topic_category.ISSUE_WATCHLIST},e.changeTopicCategoryColor=function(t){e.topicCategory.color=t},e.changeCustomColor=function(t){d.display("TOPIC_CUSTOM_COLOR",t).then(function(t){e.changeTopicCategoryColor(t.mapped_id)})},e.createTopic=function(){s.addTopicEntry(g,e.topicCategory.id,!1,!1).then(function(t){e.topicCategory.topics.push(t)},function(e){})},e.remove=function(e,t){t.preventDefault(),f.display({message:e.confirm_question}).then(function(){p(e)},function(){})},e.removeTopicFromCategory=function(t,n){e.topicCategory.topics=i.without(e.topicCategory.topics,i.findWhere(e.topicCategory.topics,{id:t.id})),m.brokerService.publish(constants.events.topic.remove,[e.topicCategory.mapped_id,t.mapped_id,n])},e.userRebuildsAvailable=function(){return _.rules.isRebuildsEnabled()},e.updateTopicMenuName=function(e){s.updateTopicMenuName(e)},e.$on("$destroy",function(){m.brokerService.unsubscribe(constants.events.topic.show_history,u)})}}]}),define("wrappers/stateless/stateless_screen_row_wrapper",["require","exports","classes/floating_content/floating_content_structure"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.StatelessScreenRowWrapper=class{constructor(e){this.row=e,this.sections=this.row.sections.map(e=>new i.FloatingContentStructure(e))}getSections(){return this.sections}}}),define("services/content_structure_service",["require","exports","classes/refresh/model_state","classes/refresh/model_type","services/broker","services/refresh/model_refresh_service"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{async fetchSectionData(e,t){return Promise.all(e.map(e=>this.lazyLoadSection(e,t)))}async lazyLoadSection(e,t){if(!e.isLoaded()){const r={modelState:i.ModelState.FULL,modelType:n.ModelType.STATELESS_SCREEN_SECTION,url:e.toProto().content_loading_url,id:t.groupPage,application:t.application,applicationModule:t.applicationModule},a=await o.modelRefreshService.downloadData(r);e.merge(a),e.setLoaded(!0),s.brokerService.publish(constants.content_structure.loaded)}}}t.ContentStructureService=r,t.contentStructureService=new r}),define("components/edit_mode/topic_setup/screen/directive",["require","exports","wrappers/stateless/stateless_screen_row_wrapper","angular_utilities","services/content_structure_service","services/template_source"],function(e,t,i,n,s,o){function r(){return{replace:!1,restrict:"AE",bindToController:{formEntry:"="},controllerAs:"vm",controller:a,templateUrl:o.templateSourceFactory("components/edit_mode/topic_setup/screen"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.EditTopicSetupScreenDirective=r;let a=class{constructor(e){this.$rootScope=e}$onInit(){const e=tw.pageState.getAllowedPages();this.rows=[],this.formEntry.rows.forEach(async t=>{const n=new i.StatelessScreenRowWrapper(t);await s.contentStructureService.fetchSectionData(n.getSections(),{groupPage:this.formEntry.group_page,application:e.getApplication(),applicationModule:e.getModule()}),this.rows.push(n),this.$rootScope.$$phase||this.$rootScope.$apply()})}};a=__decorate([n.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],a),t.TopicSetupController=a}),define("components/edit_mode/watchlist_item/directive",["require","exports","services/template_source","underscore","services/rest_form_service","canvas_engine","classes/refresh/model_refresh_strategy","classes/application/application","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","services/refresh/model_refresh_service","services/confirmation_service"],function(e,t,i,n,s,o,r,a,c,l,d,g){function u(){return{replace:!1,restrict:"AE",bindToController:{watchlistItem:"=",messages:"="},controllerAs:"vm",controller:p,templateUrl:i.templateSourceFactory("components/edit_mode/watchlist_item"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=u,t.EditWatchlistItemDirective=u;class p{constructor(){}$onInit(){this.originalWatchlistItemData=Object.assign({},this.watchlistItem)}canRemove(){return void 0!==this.watchlistItem.link_remove_category}async remove(e){e.preventDefault();try{await g.confirmationService.display({message:"BLSPOLBmrsbs"}),await s.restFormService.deleter(this.watchlistItem.link_remove_category),this.refreshPageData()}catch(e){}}async save(){try{this.watchlistItem=await s.restFormService.post(this.watchlistItem.save_link,this.watchlistItem),this.refreshPageData()}catch(e){o.logService.error(e)}}cancel(){this.watchlistItem=Object.assign({},this.originalWatchlistItemData)}refreshPageData(){const e={strategy:r.ModelRefreshStrategy.REFRESH},t=l.modelRefreshDecoratorFactory.getDecorator(a.mainApplication.getPageState(),a.mainApplication,c.ModelType.PAGE_STATE,e);d.modelRefreshService.refresh(t,e).then(n.noop,function(e){e instanceof Error&&o.logService.error("Error when refreshing page state",void 0,e)})}}t.EditWatchlistItemController=p}),define("components/save_buttons/directive",["require","exports","services/broker","angular_utilities","services/template_source"],function(e,t,i,n,s){function o(){return{restrict:"AE",replace:!0,bindToController:{saveLink:"=",cancelLink:"=",form:"=",disabled:"&disabled",progressOptions:"=",cancelMethod:"=",clickevent:"="},scope:{},controller:r,controllerAs:"vm",templateUrl:s.templateSourceFactory("components/save_buttons")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.SaveButtonsDirective=o;let r=class{constructor(e){this.$scope=e,this.saving=!1,this.directiveCancel=this.handleCancel.bind(this)}$onInit(){this.init()}canCancel(){return void 0!==this.cancelLink&&this.cancelLink.length>0||void 0!==this.cancelMethod}init(){const e=i.brokerService.subscribe(constants.events.form.action.post,(e,t)=>{t===constants.events.form.action.post&&(constants.events.form.status.doing===e?this.saving=!0:this.saving=!1)});this.$scope.$on("$destroy",()=>i.brokerService.unsubscribe(constants.events.form.action.post,e))}handleCancel(){this.cancelMethod?this.cancelMethod():window.location.href=this.cancelLink}};r=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],r),t.SaveButtonsController=r}),define("components/edit_mode/web_connector/adobe_analytics/directive",["require","exports","angular","angular_utilities","classes/refresh/model_type","wrappers/topic_menu/topic_entry_wrapper","services/refresh/model_refresh_service","services/rest_form_service","classes/refresh/model_refresh_strategy","wrappers/topic_menu/topic_menu_wrapper","classes/application/application","services/tw_routing","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","log","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{formEntry:"="},controllerAs:"vm",controller:_,templateUrl:m.templateSourceFactory("components/edit_mode/web_connector/adobe_analytics"),scope:{}}};let _=class{constructor(e){this.$scope=e,this.save=this.saveForm.bind(this)}$onInit(){this.initializeReportSuitesMenu(),this.initSaveButton(),this.redirectToSmaEntry={name:u.contextData.getMessage("_1480685"),params:{url:this.formEntry.social_media_account_settings_link}}}handleAccountSelection(){a.restFormService.post(this.formEntry.refresh_view_link,this.formEntry).then(e=>{this.formEntry=e,this.initializeReportSuitesMenu()})}saveForm(){const e=void 0!==this.formEntry.create_link?this.formEntry.create_link:this.formEntry.save_link,t=a.restFormService.post(e,this.formEntry);void 0!==this.formEntry.create_link&&t.then(e=>{const t=d.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.web_connector);t.unselectAll();let i=t.getEntryByMappedId(e.parent_mapped_id);void 0===i&&(i=new o.TopicEntryWrapper({mapped_id:e.parent_mapped_id,name:e.parent_name},t),t.getRootEntry().addChild(i)),i.addChild(new o.TopicEntryWrapper(e.created_entry,t)),i.toProto(),t.toProto(),this.refreshPageData()})}get socialMediaAccounts(){return this.formEntry.social_media_accounts.root_entry.children||[]}redirectToSmaSettingsPage(e){g.twRoutingService.changePageByUrl(e.url)}isImpersonate(){return u.contextData.rules.isImpersonate()}initializeReportSuitesMenu(){this.formEntry.aa_report_suites_menu&&(this.aaReportSuitesMenu=new l.TopicMenuWrapper(this.formEntry.aa_report_suites_menu))}initSaveButton(){this.progressOptions={action:constants.events.form.action.post,text:u.contextData.getMessage("_612374"),textCalling:u.contextData.getMessage("_911337"),isDisabled:()=>void 0===this.aaReportSuitesMenu||void 0===this.aaReportSuitesMenu.getFirstSelectedEntryRecursively()}}async refreshPageData(){const e={strategy:c.ModelRefreshStrategy.REFRESH},t=p.modelRefreshDecoratorFactory.getDecorator(d.mainApplication.getPageState(),d.mainApplication,s.ModelType.PAGE_STATE,e);try{await r.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state after saving AA web connector !",void 0,e)}}};_=__decorate([n.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],_)}),define("components/edit_mode/web_connector/ga/directive",["require","exports","angular_utilities","angular","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","classes/context_data/context_data","services/tw_routing","wrappers/topic_menu/topic_entry_wrapper","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"AE",bindToController:{formEntry:"="},controllerAs:"vm",controller:_,templateUrl:m.templateSourceFactory("components/edit_mode/web_connector/ga"),scope:{}}};let _=class{constructor(e){this.$scope=e,this.save=this.saveForm.bind(this)}$onInit(){this.initializeViewMenu(),this.initSaveButton(),this.redirectToSmaEntry={name:r.contextData.getMessage("_1480685"),params:{url:this.formEntry.social_media_account_settings_link}}}handleAccountSelection(){s.restFormService.post(this.formEntry.refresh_view_link,this.formEntry).then(e=>{this.formEntry=e,this.initializeViewMenu()})}saveForm(){const e=void 0!==this.formEntry.create_link?this.formEntry.create_link:this.formEntry.save_link,t=s.restFormService.post(e,this.formEntry);void 0!==this.formEntry.create_link&&t.then(e=>{const t=l.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.web_connector);t.unselectAll();let i=t.getEntryByMappedId(e.parent_mapped_id);void 0===i&&(i=new c.TopicEntryWrapper({mapped_id:e.parent_mapped_id,name:e.parent_name},t),t.getRootEntry().addChild(i)),i.addChild(new c.TopicEntryWrapper(e.created_entry,t)),i.toProto(),t.toProto(),this.refreshPageData()})}get socialMediaAccounts(){return this.formEntry.social_media_accounts.root_entry.children||[]}isUserMetricsJobStateOK(){return this.formEntry.job_state===constants.user_metrics.state.ok}getJobStateText(){return` - ${this.formEntry.last_error_message} (${this.formEntry.last_error_date||""})`}canShowScheduleDownload(){return this.isImpersonate()&&void 0!==this.formEntry.schedule_download_link}scheduleDownload(){s.restFormService.get(this.formEntry.schedule_download_link)}redirectToSmaSettingsPage(e){a.twRoutingService.changePageByUrl(e.url)}isImpersonate(){return r.contextData.rules.isImpersonate()}initializeViewMenu(){this.formEntry.ga_view_menu&&(this.viewMenu=new o.TopicMenuWrapper(this.formEntry.ga_view_menu))}initSaveButton(){this.progressOptions={action:constants.events.form.action.post,text:r.contextData.getMessage("_612374"),textCalling:r.contextData.getMessage("_911337"),isDisabled:()=>void 0===this.viewMenu||void 0===this.viewMenu.getFirstSelectedEntryRecursively()}}async refreshPageData(){const e={strategy:g.ModelRefreshStrategy.REFRESH},t=p.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,h.ModelType.PAGE_STATE,e);try{await d.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&u.logService.error("Error when refreshing page state after saving GA web connector !",void 0,e)}}};_=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],_),t.GaWebConnectorController=_}),define("components/edit_mode/web_connector/overview/directive",["require","exports","angular","angular_utilities","services/rest_form_service","services/loading_bubble","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"EA",bindToController:{formEntry:"="},controllerAs:"vm",controller:a,templateUrl:r.templateSourceFactory("components/edit_mode/web_connector/overview"),scope:{}}};let a=class{constructor(e){this.$rootScope=e}$onInit(){this.noSelection=!0,this.initFilterList()}async switchWebConnector(e){let t;this.filterList.forEach((i,n)=>{if(void 0!==i[e])i[e]=!i[e],t=n;else for(const e in i)i[e]=!1}),this.noSelection=!this.filterList[t][e],this.noSelection?(this.selectedEntryForm=void 0,this.selectedKey=void 0):(this.selectedKey=e,await this.loadSelectedForm(e),this.applyScope())}async loadSelectedForm(e){o.loadingBubbleService.showSpinner();const t=this.formEntry.web_connectors_links.find(t=>t.type===e);this.selectedEntryForm=await s.restFormService.get(t.new_link),o.loadingBubbleService.hideSpinner()}initFilterList(){this.filterList=this.formEntry.web_connectors.map(e=>{const t={};return t[e]=!1,t})}applyScope(){this.$rootScope.$$phase||this.$rootScope.$apply()}};a=__decorate([n.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],a)}),define("components/filter/entry_list/directive",["require","exports","angular","underscore","services/tw_common","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=s.twCommon,c=o.mainApplication;t.default=[function(){return e.$inject=["$scope","configurationService","bubbleDialogService","topicEntryLoaderService","$timeout","$element"],{restrict:"AE",replace:!0,scope:{allNode:"=?",entries:"=",showChildren:"=?",selectFunction:"=",iconMap:"=?",hideHits:"=?",iconState:"@?",title:"=?",firstLevelUnclickable:"=?",allowFirstLevelAllNode:"=?",subListSide:"=?",timeMenuUfs:"=?",ignoreTimeFiltersLabel:"=?",config:"=?"},controller:e,templateUrl:r.templateSourceFactory("components/filter/entry_list")};function e(e,t,s,o,r,l){e.partial_template=BASE_TEMPLATE_URL+"components/filter/entry_list/partial/template.html",n.isUndefined(e.subListSide)&&(e.subListSide="pull-left");const d=[];let g,u;function p(e){const t=e.getAssociatedTopicMenu().getType();return t===constants.topic_menu.TYPE.time_filter||t===constants.topic_menu.TYPE.event}function h(e){return!e.hasAssociatedTopicMenu()||e.hasAssociatedTopicMenu()&&e.getAssociatedTopicMenu().getType()!==constants.root_id.searchbar}function m(t){return e.subListSide.indexOf(t)>-1}function _(e){g=r(function(){const t=f(e.target);t[0].style.display="none",g=void 0;const i=n.indexOf(d,t);i>-1&&d.splice(i,1)},300)}function f(e){let t;const i=$(e);if(n.contains(e.classList,"entry"))t=i.children("ul");else{t=i.closest("li.entry").children("ul")}return t}function y(e){u=function(e){let t;return t=$(e).closest("ul.entries-container")}(e.target)}l.on("mousemove",y),e.isTimeFilters=p,e.canShowSubListForEntry=h,e.getEntryName=function(t){return!0!==e.ignoreTimeFiltersLabel&&p(t)?window.messages.get("_841654"):t.getName()},e.isOpeningLeft=function(){return m("left")},e.isOpeningRight=function(){return m("right")},e.getEntries=function(){return e.entries},e.getIcon=function(t){return e.iconMap[t.getMappedId()]||""},e.getIconState=function(t){return e.iconState},e.hasTitle=function(){return!n.isUndefined(e.title)&&e.title.trim().length>0},e.getTitle=function(){return e.title},e.hasIcon=function(t){return void 0!==e.iconMap&&e.iconMap[t.getMappedId()]},e.hasAllNode=function(t){return!0===e.allowFirstLevelAllNode&&function(t){return void 0===e.config||void 0===e.config.noAllNodeMenuTypes||void 0!==e.config.noAllNodeMenuTypes&&!n.contains(e.config.noAllNodeMenuTypes,t.getAssociatedTopicMenu().getType())}(t)&&n.isUndefined(e.allNode)&&t.hasAssociatedTopicMenu()&&t.getAssociatedTopicMenu().hasAllNode()},e.isSelectedOrHasSelection=function(e){return e.hasAssociatedTopicMenu()&&"MULTIPLE_INVERTED"===e.getAssociatedTopicMenu().selectionStrategy&&e.hasParent()?e.getParent().isSelected()||e.isSelected()||!n.isUndefined(e.getFirstSelectedEntryRecursively()):e.isSelected()||!n.isUndefined(e.getFirstSelectedEntryRecursively())},e.showChildrenOfEntry=function(t){return(!0===e.showChildren||void 0===e.showChildren)&&t.getVisibleChildrenCount()>0},e.getHitText=function(t){if(t.isSelected()||e.hideHits)return"";if(e.isSelectedOrHasSelection(t)){return t.getSelectedEntriesRecursively().length>0?"("+t.getSelectedEntriesRecursively().length+")":""}return""},e.selectEntry=function(t,i){i.stopPropagation(),e.closeDescriptionTooltip(t),!t.isSelected()&&t.getAssociatedTopicMenu().getType()!==constants.topic_menu.TYPE.countries&&t.getAssociatedTopicMenu().shouldFetchFromServer()&&function(t,i){let n;c.getPageState().getAllowedPages().isCustomPage()||(n=c.getPageState().getId());o.loadDynamicFilters(t,t.getAssociatedTopicMenu().getType(),n,function(){return e.openSubList(t,i)})}(t,i),e.selectFunction(t,i)},e.handleFirstLevelClick=function(t,i){!e.firstLevelUnclickable||t.hasAssociatedTopicMenu()&&t.getAssociatedTopicMenu().getType()===constants.root_id.searchbar?e.selectEntry(t,i):e.hasAllNode(t)&&e.selectEntry(t.getChildren()[0],i)},e.isFirstLevelClickable=function(t){return!e.firstLevelUnclickable||t.hasAssociatedTopicMenu()&&t.getAssociatedTopicMenu().getType()===constants.root_id.searchbar||e.hasAllNode(t)},e.isFirstLevelUnclickable=function(t){return e.firstLevelUnclickable&&!e.hasAllNode(t)&&(!t.hasAssociatedTopicMenu()||t.hasAssociatedTopicMenu()&&t.getAssociatedTopicMenu().getType()!==constants.root_id.searchbar)},e.preventClick=function(e){e.stopPropagation()},e.handleMouseEnter=function(i,n){if(i.hasDescription()){s.destroyById(constants.bubble_dialog.id.tooltip);const e={message:i.getDescription()};s.createByType(constants.bubble_dialog.id.tooltip,n.target,constants.bubble_dialog.id.tooltip,e,t.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tooltip))}i.getAssociatedTopicMenu().getType()!=constants.topic_menu.TYPE.countries||i.hasChildren()||2!==i.getMappedId().length||o.loadRegions(i,function(){return e.openSubList(i,n)})},e.closeDescriptionTooltip=function(e){e.hasDescription()&&s.scheduleDestructionById(constants.bubble_dialog.id.tooltip,250)},e.openSubList=function(e,t){t.stopPropagation(),h(e)&&(!function(e){if(d.length>0){const t=[];for(let i=d.length-1;i>=0;i--)d[i].is(e.target)||0!==d[i].has(e.target).length||(d[i][0].style.display="none",t.push(d[i]));n.each(t,function(e){d.splice(n.indexOf(d,e),1)}),r.cancel(g),g=void 0}}(t),e.hasChildren()&&e.getVisibleChildrenCount()>0&&(i.element(t.target).scope().subListBuilt=!0,r(function(){const e=f(t.target);e[0].style.display="block",d.push(e)},!1)))},e.closeSubList=function(t,i){if(h(t)){$(l).is(u)||i.stopPropagation(),e.isTimeFilters(t)?a.isPointOnElement({x:i.clientX,y:i.clientY},u)||(_(i),s.destroyById(constants.bubble_dialog.id.months)):t.hasChildren()&&t.getVisibleChildrenCount()>0&&_(i)}},e.$on("$destroy",function(){l.off("mousemove",y)})}}]}),define("components/filter/menu/buttons/directive",["require","exports","services/navigation","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","TwColor","bubbleDialogService"],{restrict:"AE",replace:!0,scope:{entries:"=",selectFunction:"="},controller:e,templateUrl:n.templateSourceFactory("components/filter/menu/buttons")};function e(e,t,n){const s=i.navigationService;e.isTimeFilters=r,e.getEntryName=function(e){const t=e.getAssociatedTopicMenu();return t.getType()===constants.topic_menu.TYPE.event||t.getType()===constants.topic_menu.TYPE.time_filter?constants.navbar.filter_translation.TIME_FILTER:r(e)?t.getRootEntry().getName():e.getName()};const o=t.getCustomColor("BRANDING_COLOR")();function r(e){const t=e.getAssociatedTopicMenu().getType();return t===constants.topic_menu.TYPE.time_filter||t===constants.topic_menu.TYPE.event}e.setHover=function(e,t){e.hover=t},e.isHovering=function(e){return e.hover},e.getSelectionStyle=function(t){return e.isHovering(t)?{"background-color":o.clone().darken(20).toHex6(),"border-color":o.toHex6(),color:"#FFFFFF"}:{"background-color":o.toHex6(),"border-color":o.toHex6(),color:"#FFFFFF"}},e.getEntries=function(){return e.entries},e.selectEntry=function(t,i){t.isDisabled()?s.goToTrial(!0,"&cta=4"):(i.stopPropagation(),e.closeDescriptionTooltip(t),e.selectFunction(t))},e.closeDescriptionTooltip=function(e){e.hasDescription()&&n.scheduleDestructionById(constants.bubble_dialog.id.tooltip,250)},e.$on("$destroy",function(){})}}]}),define("components/filter/menu/horizontal/label/directive",["require","exports","underscore","notifications","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});const u=n.notificationService,p=s.mainApplication,h=o.modelRefreshService,m=r.modelRefreshDecoratorFactory,_=c.ModelType,f=a.ModelRefreshStrategy,y=l.logService,v=d.contextData;t.default=[function(){return e.$inject=["$scope","$element"],{restrict:"A",scope:{menu:"="},controller:e,link:function(e,t,i){},templateUrl:g.templateSourceFactory("components/filter/menu/horizontal/label")};function e(e,t){e.show={},e.canShowAllCategory=s,e.canShowAllCategoryAsSelected=function(e){return 1===e.getChildrenCount()&&(e.getChildren()[0].isSelected()||e.getChildren()[0].hasHits())||e.isSelected()},e.selectAllCategory=function(t){t.getChildrenCount()>1?e.selectEntry(t):e.selectEntry(t.getChildren()[0])},e.getAllCategoryLabel=function(){return window.messages.get("_271981")},e.getLabelWidth=function(e){return t.find('[id="label\\|'+e.getMappedId().replace("|","\\|")+'"]').outerWidth()},e.showMore=function(t){return e.show[t.getMappedId()]},e.toggleMore=function(t){e.getMoreEntries(t).length>0&&(e.show[t.getMappedId()]=!e.show[t.getMappedId()])},e.getChildEntries=function(e){let t=[];return i.each(e.getChildren(),function(i){1===e.getChildren().length?t=t.concat(i.getChildren()):t.push(i)}),t},e.selectEntry=function(t){if(!t.isDisabled()){e.menu.selectEntryByMappedId(t.getMappedId())?function(){if(p.hasPageState()&&p.getPageState().getAllowedPages().isDocumentClusterIqApp()&&p.getPageState().getWidgets().length>0&&p.getPageState().getWidgets()[0].isDocumentCluster()&&p.getPageState().getWidgets()[0].hasPayloadValue()&&p.getPageState().getWidgets()[0].getPayloadValue().graph)return;const e={strategy:f.REFRESH,delay:v.projectSettings.slow_refresh_timeout},t=m.getDecorator(p.getPageState(),p,_.PAGE_STATE,e);h.refresh(t,e).then(function(){},function(e){e instanceof Error&&y.error("Error when refreshing page state after closing diff explorer !",void 0,e)})}():u.warning(window.messages.get("_156486"),{permanent:!1})}};const n={};function s(t){return 1===t.getChildren().length||!e.menu.hasNoSelectionEscalation()&&!t.hasMaxSelection()}e.getMoreEntries=function(o){const r=[],a=t.find('[id="'+o.getMappedId().replace("|","\\|")+'"]')[0].children;for(let t=1;t<a.length;t++)if(a[t].getBoundingClientRect().bottom>a[0].getBoundingClientRect().bottom){let i=t;s(o)&&--i,r.push(e.getChildEntries(o)[i])}return i.isEqual(r,n[o.getMappedId()])||(n[o.getMappedId()]=r),n[o.getMappedId()]},e.getHitText=function(e){return e.hasHits()?"("+e.getHits()+")":""}}}]}),define("components/filter/menu/two_columns/directive",["require","exports","components/form/common/topic_menu","underscore","components/tools/data_graph","reusable_utilities","services/context","classes/application/application","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=o.StringUtils,g=r.contextService,u=a.mainApplication;t.default=[function(){return e.$inject=["$scope","restFormService","configurationService"],{restrict:"A",scope:{menu:"="},controller:e,link:function(e,t){function i(i){if(e.menuVars.actionsBtnOpen){const n=$($(t).find(".menu-actions-btn")[0]),s=$($(t).find(".actions-container")[0]);n.is(i.target)||0!==n.has(i.target).length||s.is(i.target)||0!==s.has(i.target).length||e.$apply(function(){e.toggleActionsMenu()})}}$(document).on("click",i),e.$on("$destroy",function(){$(document).off("click",i)})},templateUrl:c.templateSourceFactory("components/filter/menu/two_columns")};function e(e,t,o){e.menuVars={actionsBtnOpen:!1},e.getPinLabel=function(){return window.messages.get("_479055")},e.toggleEntry=function(t,i){e.menu.selectEntry(t,i.target)},e.pinMenu=function(){e.menu.pin(u.getPageState().getProject().getId()),e.toggleActionsMenu()},e.toggleActionsMenu=function(){e.menuVars.actionsBtnOpen=!e.menuVars.actionsBtnOpen},e.isActionsMenuOpen=function(){return e.menuVars.actionsBtnOpen},e.columnOne=function(t){const i=e.menu.getAllNode().getChildren(),s=i.length;return n.indexOf(i,t)<Math.round(s/2)},e.columnTwo=function(t){return!e.columnOne(t)},e.canShowCount=function(){return o.getPageConfiguration().canShowFilterHits()},e.getCount=function(o){e.filterCountLoading=!0;const r={page_state:u.getPageState().toProto(),filter_type:o.getType()},a=JSON.parse(JSON.stringify(o.toProto()));t.post(routes.controllers.tw.TWRestForm.post(g.getCurrentContext().scope,g.getCurrentContext().id,"filter_count","search","","rform").url,r).then(function(t){const r=new s.default(t.data_graph);i.refresh_hits(o.toProto(),r),n.isEqual(a,o.toProto())||(l.brokerService.publish(constants.events.topic_menu.refresh_hits),l.brokerService.publish(constants.events.filters.selected)),e.filterCountLoading=!1},function(e){})},e.getFilterCountText=function(e){if(e.hasFilterHits()){return"("+d.formatNumber(e.getFilterHits(),1)+")"}return""}}}]}),define("components/filter/menu/vertical/inline_list/directive",["require","exports","underscore","components/tools/data_graph","flux","reusable_components","reusable_utilities","services/context","classes/application/application","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g=s.dispatcher,u=o.FilterOptionMenuActions,p=r.StringUtils,h=a.contextService,m=c.mainApplication;t.default=[function(){return e.$inject=["$scope","$element","restFormService","configurationService","bubbleDialogService"],{replace:!0,restrict:"A",scope:{menu:"=",rowIndex:"="},controller:e,link:function(e,t,i){const n=function(i){if(e.menuVars.actionsBtnOpen){const n=$($(t).find(".menu-actions-btn")[0]),s=$($(t).find(".actions-container")[0]);n.is(i.target)||0!==n.has(i.target).length||s.is(i.target)||0!==s.has(i.target).length||e.$apply(function(){e.toggleActionsMenu()})}};$(document).on("click",n),e.$on("$destroy",function(){$(document).off("click",n)})},templateUrl:l.templateSourceFactory("components/filter/menu/vertical/inline_list")};function e(e,t,s,o,r){let a,c,l;function _(t,i,n,s){if(s===c){e._numElementsToShow=t;const s=e.menu.hasAllNode()?e.getChildren().length+1:e.getChildren().length,o=constants.filters.entry_height,r=o*s;let c=Math.ceil(e._numElementsToShow/i*e.menu.getHeight())*o;i<e.menu.getHeight()?c+=o*(n+1):i>e.menu.getHeight()&&(c-=o*n),c<r?a.attr("style","height: "+c+"px !important;"):(e.showingAll=!0,a.css("height",""))}}function f(t,i){t!==c&&!0!==i||(a.css("height",""),e._numElementsToShow=void 0,e.showingAll=!1)}e._numElementsToShow=void 0,function(){e.menu.isFilter()&&(e.menu.hasAllNode()&&e.menu.getAllNode().containsSelection(!0)||!e.menu.hasAllNode()&&e.menu.getRootEntry().containsSelection(!0))&&d.brokerService.publish(constants.events.filters.selected,[e.menu.getType()]),e.menuVars={actionsBtnOpen:!1,showOnOff:!e.menu.isGroupingNotApplied()},e.menuVars.showOnOff&&(e.menuVars.onOrOff=e.menu.isGrouped()),e.showingAll=!1,a=t.find("ul"),c=e.rowIndex+1,(l={})[constants.events.filters.more]=d.brokerService.subscribe(constants.events.filters.more,_),l[constants.events.filters.less]=d.brokerService.subscribe(constants.events.filters.less,f)}.call(void 0),e.getPinLabel=function(){return window.messages.get("_479055")},e.handleOperatorClick=function(t){t.stopPropagation(),g.dispatch(u.filterOptions_onChangeFilterBehaviour,{menuType:e.menu.getType()})},e.isAndOperatorSelected=function(){return"AND"===e.menu.getFilterBehaviour()},e.isOrOperatorSelected=function(){return"OR"===e.menu.getFilterBehaviour()},e.canToggleFilterBehaviour=function(){return void 0!==e.menu.getFilterBehaviour()},e.getAllNode=function(){return e.menu.getAllNode()},e.getChildren=function(){return e.menu.hasAllNode()?e.menu.getAllNode().getChildren():e.menu.getRootEntry().getChildren()},e.getSelectedNodeAndNodeWithSelectedChild=function(e){return i.filter(e.getChildren(),function(e){return e.isSelected()||!i.isUndefined(e.getFirstSelectedEntryRecursively())})},e.select=function(t,i){i=i||{},e.menu.selectEntry(t,i.target)},e.showFilterCountTooltip=function(t,i){if(t.hasFilterHits()){r.destroyById(constants.bubble_dialog.id.tooltip);const n={message:e.getFilterCountText(t)};r.createByType(constants.bubble_dialog.id.tooltip,i.target,constants.bubble_dialog.id.tooltip,n,o.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tooltip))}},e.closeFilterCountTooltip=function(e){e.hasFilterHits()&&r.scheduleDestructionById(constants.bubble_dialog.id.tooltip,250)},e.pinMenu=function(){e.menu.pin(m.getPageState().getProject().getId()),e.toggleActionsMenu()},e.toggleActionsMenu=function(){e.menuVars.actionsBtnOpen=!e.menuVars.actionsBtnOpen},e.isActionsMenuOpen=function(){return e.menuVars.actionsBtnOpen},e.getCount=function(t){e.filterCountLoading=!0;const o={page_state:m.getPageState().toProto(),filter_type:t.getType()},r=JSON.parse(JSON.stringify(t.toProto()));s.post(routes.controllers.tw.TWRestForm.post(h.getCurrentContext().scope,h.getCurrentContext().id,"filter_count","search","","rform").url,o).then(function(s){const o=new n.default(s.data_graph);t.refreshFilterHits(o),i.isEqual(r,t.toProto())||(d.brokerService.publish(constants.events.topic_menu.refresh_hits),d.brokerService.publish(constants.events.filters.selected)),e.filterCountLoading=!1},function(e){})},e.getFilterCountText=function(e){return e.hasFilterHits()?"("+p.formatNumber(e.getFilterHits())+")":e.hasAdditionalInfo()?"("+e.getAdditionalInfo()+")":""},e.canShowActionsMenu=function(){return e.menu.isPinnable()||e.canToggleFilterBehaviour()},e.canShowCount=function(){return e.menu.getType()!==constants.topic_menu.TYPE.filter&&o.getPageConfiguration().canShowFilterHits()},e.$on("$destroy",function(){d.brokerService.unsubscribe(constants.events.filters.more,l[constants.events.filters.more]),d.brokerService.unsubscribe(constants.events.filters.less,l[constants.events.filters.less])})}}]}),define("components/filter/menu/vertical/label/directive",["require","exports","underscore","components/form/common/topic_menu","components/tools/data_graph","flux","reusable_components","services/context","services/template_source","reusable_utilities","classes/application/application","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){h.$inject=["$scope","$element","restFormService"];const e=r.FilterStore,t=r.FilterOptionMenuActions,u=o.dispatcher,p=a.contextService;return{restrict:"A",scope:{menu:"=",isShowingMore:"=",colIndex:"=",colLength:"=",rowIndex:"="},controller:h,link:function(e,t,i){function n(i){if(e.menuVars.actionsBtnOpen){const n=$($(t).find(".menu-actions-btn")[0]),s=$($(t).find(".actions-container")[0]);n.is(i.target)||0!==n.has(i.target).length||s.is(i.target)||0!==s.has(i.target).length||e.$apply(function(){e.toggleActionsMenu()})}}$(document).on("click",n),e.$on("$destroy",function(){$(document).off("click",n)})},templateUrl:c.templateSourceFactory("components/filter/menu/vertical/label")};function h(r,a,c){r.numSideWindowColumns={0:5,1:4,2:3,3:3,4:4,5:5},r.sideWindowColumns=i.range(r.numSideWindowColumns[r.colIndex]),r.menuVars={actionsBtnOpen:!1},r.showingAll=!1;const h=a.find("ul"),m=r.rowIndex+1,_=g.brokerService.subscribe(constants.events.filters.more,function(e,t,i,n){if(n===m){v=e;const n=r.getChildren().length,s=constants.filters.entry_height,o=s*n;let a=Math.ceil(v/t*r.menu.getHeight())*s;t<r.menu.getHeight()?a+=s*(i+1):t>r.menu.getHeight()&&(a-=s*i),a<o?h.attr("style","height: "+a+"px !important;"):(r.showingAll=!0,h.css("height",""))}}),f=g.brokerService.subscribe(constants.events.filters.less,function(e,t){e!==m&&!0!==t||(h.css("height",""),v=void 0,r.showingAll=!1)});function y(e){let t=0;return i.each(e,function(e){e.isVisible()&&++t}),t}let v;r.getPinLabel=function(){return window.messages.get("_479055")},r.isGroupable=function(){return e.getInstance().isGroupable(r.menu.getType())},r.toggleGrouping=function(e){e.stopPropagation(),o.dispatcher.dispatch(t.filterOptions_toggleGroupFilter,{topicMenu:r.menu.toProto()})},r.getGroupingLabel=function(){return window.messages.get("_549457",[""])},r.canDisplayMenuButtonAsActive=function(){return r.menu.isGrouped()||r.menu.getFilterBehaviour()===constants.topic_menu.filter_behaviour.and},r.handleOperatorClick=function(e){e.stopPropagation(),u.dispatch(t.filterOptions_onChangeFilterBehaviour,{menuType:r.menu.getType()})},r.isAndOperatorSelected=function(){return"AND"===r.menu.getFilterBehaviour()},r.isOrOperatorSelected=function(){return"OR"===r.menu.getFilterBehaviour()},r.canToggleFilterBehaviour=function(){return void 0!==r.menu.getFilterBehaviour()},r.select=function(e){r.menu.selectEntry(e),g.brokerService.publish(constants.events.filters.selected,[this.menu.getType(),!0])},r.getHitText=function(e){return e.hasHits()?"("+e.getHits()+")":""},r.getChildren=function(){let e=[];for(let t=0;t<r.menu.getRootEntry().getChildrenCount();t++)e.push(r.menu.getRootEntry().getChildren()[t]),e=e.concat(r.menu.getRootEntry().getChildren()[t].getChildren());return e},r.canShowMore=function(){let e=!1;const t=r.getChildren();if(t.length>0)switch(r.menu.getHeight()){case 1:case 2:e=y(t)>0;break;case 3:e=y(t)>3;break;case 4:e=y(t)>5;break;case 5:e=y(t)>7;break;case 6:e=y(t)>10;break;default:e=!1}return e},r.canShowActionsMenu=function(){return r.menu.isPinnable()||r.isGroupable()||r.canToggleFilterBehaviour()},r.canShowCount=function(){return!1},r.pinMenu=function(){r.menu.pin(d.mainApplication.getPageState().getProject().getId()),r.toggleActionsMenu()},r.toggleShowMore=function(e){if(e.stopPropagation(),r.showingAll=!r.showingAll,(r.showingAll&&!r.isShowingMore||!r.showingAll&&r.isShowingMore)&&(r.isShowingMore=!r.isShowingMore),r.showingAll&&h.css("height",""),r.isShowingMore){const e=r.getChildren().length;o.dispatcher.dispatch("verticalFilters_onMoreClick",{childrenCount:e,rowIndex:r.rowIndex}),g.brokerService.publish(constants.events.filters.more,[e,r.menu.getHeight(),r.colLength,m])}else g.brokerService.publish(constants.events.filters.less,[m]),o.dispatcher.dispatch("verticalFilters_onMoreClick",{childrenCount:0,rowIndex:r.rowIndex})},r.toggleActionsMenu=function(){r.menuVars.actionsBtnOpen=!r.menuVars.actionsBtnOpen},r.isActionsMenuOpen=function(){return r.menuVars.actionsBtnOpen},r.getColumnItems=function(e,t){if(0===t.getChildrenCount())return!1;const i=t.getUnselectedChildren(),n=r.sideWindowColumns.length,s=[],o=Math.ceil(i.length/n),a=o*e,c=a+o;for(let e=a;e<i.length&&e<c;e++)s.push(i[e]);return s},r.getCount=function(e){r.filterCountLoading=!0;const t={page_state:d.mainApplication.getPageState().toProto(),filter_type:e.getType()},o=JSON.parse(JSON.stringify(e.toProto()));c.post(routes.controllers.tw.TWRestForm.post(p.getCurrentContext().scope,p.getCurrentContext().id,"filter_count","search","","rform").url,t).then(function(t){const a=new s.default(t.data_graph);n.refresh_hits(e.toProto(),a),i.isEqual(o,e.toProto())||(g.brokerService.publish(constants.events.topic_menu.refresh_hits),g.brokerService.publish(constants.events.filters.selected)),r.filterCountLoading=!1},function(e){})},r.getFilterCountText=function(e){return e.hasFilterHits()?"("+l.StringUtils.formatNumber(e.getFilterHits())+")":""},r.getWidthClass=function(e){return"col-"+(r.showRight(e)?5-r.colIndex:r.colIndex)},r.showLeft=function(e){return e.getChildrenCount()>0&&r.colIndex>2},r.showRight=function(e){return e.getChildrenCount()>0&&r.colIndex<=2},r.hasNoBtns=function(){return!(r.canShowActionsMenu()||r.menu.isPinned())},r.$on("$destroy",function(){g.brokerService.unsubscribe(constants.events.filters.more,_),g.brokerService.unsubscribe(constants.events.filters.less,f)})}}]}),define("components/filter/menu/vertical/merged/directive",["require","exports","classes/application/application","components/form/common/topic_menu","components/tools/data_graph","reusable_utilities","services/context","underscore","services/broker","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=o.StringUtils,g=r.contextService,u=i.mainApplication;t.default=[function(){return e.$inject=["$scope","$element","restFormService","configurationService","iconsService","$q","bubbleDialogService"],{replace:!0,restrict:"A",scope:{menu:"=",isShowingMore:"=",colIndex:"=",colLength:"=",rowIndex:"=",containsIcons:"="},controller:e,link:function(e,t){const i=function(i){if(e.menuVars.actionsBtnOpen){const n=$($(t).find(".menu-actions-btn")[0]),s=$($(t).find(".actions-container")[0]);n.is(i.target)||0!==n.has(i.target).length||s.is(i.target)||0!==s.has(i.target).length||e.$apply(function(){e.toggleActionsMenu()})}};$(document).on("click",i),e.$on("$destroy",function(){$(document).off("click",i)})},templateUrl:l.templateSourceFactory("components/filter/menu/vertical/merged")};function e(e,t,i,o,r,l,p){let h,m,_,f,y;function v(e){let t=0;return a.each(e,function(e){e.isVisible()&&++t}),t}function S(t,i,n,s){if(s===_){m=t;const s=e.containsIcons?e.getAllNode().getOwnChildren().length+3:e.getChildren().length,o=constants.filters.entry_height,r=o*s;let a=Math.ceil(m/i*e.menu.getHeight())*o;i<e.menu.getHeight()?a+=o*(n+1):i>e.menu.getHeight()&&(a-=o*n),a<r?h.attr("style","height: "+a+"px !important;"):(e.showingAll=!0,h.css("height",""))}}function b(t,i){t!==_&&!0!==i||(h.css("height",""),m=void 0,e.showingAll=!1)}(function(){e.menuVars={actionsBtnOpen:!1},e.showingAll=!1,h=t.find("ul"),_=e.rowIndex+1,e.firstIconFound=!1,f=c.brokerService.subscribe(constants.events.filters.more,S),y=c.brokerService.subscribe(constants.events.filters.less,b)}).call(void 0),e.select=function(t,i){i=i||{},e.menu.selectEntry(t,i.target)},e.canShowMore=function(){let t=!1;return t=e.containsIcons?function(){let t;switch(e.menu.getHeight()){case 1:case 2:t=v(e.getAllNode().getOwnChildren())>0;break;case 3:t=v(e.getAllNode().getOwnChildren())>1;break;case 4:t=v(e.getAllNode().getOwnChildren())>3;break;case 5:t=v(e.getAllNode().getOwnChildren())>5;break;case 6:t=v(e.getAllNode().getOwnChildren())>8;break;default:t=!1}return t}():function(){let t;switch(e.menu.getHeight()){case 1:case 2:t=v(e.getChildren())>0;break;case 3:t=v(e.getChildren())>3;break;case 4:t=v(e.getChildren())>5;break;case 5:t=v(e.getChildren())>7;break;case 6:t=v(e.getChildren())>10;break;default:t=!1}return t}()},e.pinMenu=function(){e.menu.pin(u.getPageState().getProject().getId()),e.toggleActionsMenu()},e.toggleShowMore=function(t){if(t.stopPropagation(),e.showingAll=!e.showingAll,(e.showingAll&&!e.isShowingMore||!e.showingAll&&e.isShowingMore)&&(e.isShowingMore=!e.isShowingMore),e.showingAll&&h.css("height",""),e.isShowingMore){const t=e.containsIcons?e.getAllNode().getOwnChildren().length+3:e.getChildren().length;c.brokerService.publish(constants.events.filters.more,[t,e.menu.getHeight(),e.colLength,_])}else c.brokerService.publish(constants.events.filters.less,[_])},e.toggleActionsMenu=function(){e.menuVars.actionsBtnOpen=!e.menuVars.actionsBtnOpen},e.isActionsMenuOpen=function(){return e.menuVars.actionsBtnOpen},e.getAllNode=function(){return e.menu.getAllNode()},e.getMenuHeader=function(){return e.menu.getRootEntry()},e.getChildren=function(){return e.menu.getAllNode().getChildren()},e.getCount=function(){e.filterCountLoading=!0;const t=[e.menu];a.each(e.menu.getJoinedMenuTypes(),function(e){const i=u.getPageState().getUserFilterSettings().getTopicMenuByType(e);a.isUndefined(i)||t.push(i)});const o=[];a.each(t,function(e){const t={page_state:u.getPageState().toProto(),filter_type:e.getType()},r=JSON.parse(JSON.stringify(e.toProto()));o.push(i.post(routes.controllers.tw.TWRestForm.post(g.getCurrentContext().scope,g.getCurrentContext().id,"filter_count","search","","rform").url,t).then(function(t){const i=new s.default(t.data_graph);n.refresh_hits(e.toProto(),i),a.isEqual(r,e.toProto())||(c.brokerService.publish(constants.events.topic_menu.refresh_hits),c.brokerService.publish(constants.events.filters.selected))},function(e){}))}),l.all(o).then(function(){e.filterCountLoading=!1})},e.getFilterCountText=function(e){return e.hasFilterHits()?"("+d.formatNumber(e.getFilterHits())+")":""},e.canShowActionsMenu=function(){return e.menuVars.showOnOff||e.menu.isPinnable()},e.canShowCount=function(){return o.getPageConfiguration().canShowFilterHits()},e.isIcon=function(e){return r.isIcon(e.getMappedId())},e.isFirstIcon=function(t){return!(e.firstIconFound||!r.isIcon(t.getMappedId()))&&(e.firstIconFound=!0,!0)},e.showFilterCountTooltip=function(t,i){if(t.hasFilterHits()){p.destroyById(constants.bubble_dialog.id.tooltip);const n={message:e.getFilterCountText(t)};p.createByType(constants.bubble_dialog.id.tooltip,i.target,constants.bubble_dialog.id.tooltip,n,o.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tooltip))}},e.closeFilterCountTooltip=function(e){e.hasFilterHits()&&p.scheduleDestructionById(constants.bubble_dialog.id.tooltip,250)},e.$on("$destroy",function(){c.brokerService.unsubscribe(constants.events.filters.more,f),c.brokerService.unsubscribe(constants.events.filters.less,y)})}}]}),define("components/filter/pin_list/directive",["require","exports","underscore","classes/application/application","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=n.mainApplication;t.default=[function(){return e.$inject=["$scope"],{restrict:"A",scope:{filterMenus:"="},controller:e,templateUrl:s.templateSourceFactory("components/filter/pin_list")};function e(e){function t(){return o.getPageState().getUserFilterSettings().getSearchbarFilter().isPinned()}function n(){return o.getPageState().getUserFilterSettings().getTimeFilter().isPinned()}function s(){return o.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.sentiment).isPinned()}e.isDashboard=function(){return tw.pageState.getAllowedPages().isDashboard()},e.isSearchAdvanced=function(){return o.getPageState().getAllowedPages().isSearchAdvanced()},e.isEditMode=function(){return tw.pageState.isEditMode()},e.getPinnedMenus=function(){const t=o.getPageState().getUserFilterSettings().canShowFilters();return i.filter(i.union(e.filterMenus.top,e.filterMenus.middle),function(e){return(t||!t&&e.isForceShowFilter())&&e.isPinned()})},e.isLabelMenu=function(e){return e.getType()===constants.topic_menu.TYPE.topic_pm_composed||e.getType()===constants.topic_menu.TYPE.predefined_filters},e.hasSearchbar1NeighbourSentiments=function(){return t()&&!n()&&s()},e.hasSearchbar1NeighbourTimeFilter=function(){return t()&&n()&&!s()},e.hasSearchbarTwoNeighbours=function(){return t()&&n()&&s()},e.isSentimentsWithNeighboursPinned=function(e){return!i.isUndefined(e)&&e.getType()===constants.topic_menu.TYPE.sentiment&&e.isPinned()&&(t()||n())},e.getUserFilterSettings=function(){return o.getPageState().getUserFilterSettings()}}}]}),define("components/filters/directive",["require","exports","angular_utilities","common_constants","log","reusable_utilities","underscore","classes/application/application","services/broker","services/bubble_dialog","services/configuration","services/navbar","services/template_source","services/tw_common"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){function h(){return{templateUrl:u.templateSourceFactory("components/filters"),replace:!0,restrict:"A",bindToController:{menus:"="},controllerAs:"vm",controller:m,scope:!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=h,t.FiltersDirective=h;let m=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.cancellationToken=new o.CancellationToken,this.validateMenus(this.menus),this.buildVerticalMenusList(this.menus.middle),this.setupSubscriptions()}areFiltersOpen(){return g.navbarService.getFilterState()===g.FilterState.OPEN}getTopicHeightOffset(e,t){return r.take(e,t).map(e=>e.getHeight()).reduce((e,t)=>e+t,0)}getSentimentsMenu(){return a.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.sentiment)}getTimeFilterPinObject(){return this.getMenuByPinnedType(n.topic_menu.pinned_type.time_filter)}getSearchbarPinObject(){return this.getMenuByPinnedType(n.topic_menu.pinned_type.searchbar)}getUserFilterSettings(){return a.mainApplication.getPageState().getUserFilterSettings()}canShowSearchbar(){return d.configurationService.getPageConfiguration().canShowFiltersSearchbar()}validateMenus(e){e.middle.forEach(e=>{s.logService.assert(void 0!==e,"filter menus should not be undefined"),s.logService.assert(void 0!==e.getHeight()&&e.getHeight()>0,"filter menu "+e.getType()+" has no height"),s.logService.assert(void 0!==e.getOrder(),"filter menu "+e.getType()+" has no order"),e.recalculateHits()})}buildVerticalMenusList(e){e.sort((e,t)=>e.getOrder()-t.getOrder()),this.verticalMenusList=[],e.filter(e=>void 0!==e.getOrder()).forEach(e=>this.addMenuToList(this.verticalMenusList,e))}addMenuToList(e,t){const i=Math.floor(t.getOrder()/3);let n=Math.floor(i/6),s=i%6;this.initializeRowAndColumnsIfUndefined(e,n);let o=e[n][s];for(;!this.canMenuFitIntoColumn(t,o);)++s>=6&&(s=0,n++,this.initializeRowAndColumnsIfUndefined(e,n)),o=e[n][s];o.push(t)}initializeRowAndColumnsIfUndefined(e,t){void 0===e[t]&&(e[t]=r.range(0,6).map(()=>[]))}canMenuFitIntoColumn(e,t){return this.getColumnHeight(t)+e.getHeight()<=constants.filters.max_height}getColumnHeight(e){return e.reduce((e,t)=>e+t.getHeight(),0)}getMenuByPinnedType(e){return r.findWhere(this.menus.top,{pinned_type:e})}setupSubscriptions(){this.cancellationToken.subscribeToBrokerTopic(c.brokerService,constants.events.filters.menu.add,()=>this.buildVerticalMenusList(this.menus.middle)),this.cancellationToken.subscribeToBrokerTopic(c.brokerService,constants.events.filters.menu.remove,()=>this.buildVerticalMenusList(this.menus.middle)),this.cancellationToken.addDomEvent($(document),"mousedown",this.onClick.bind(this)),this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}onClick(e){this.shouldClickCloseFilterMenu(e)&&this.$scope.$apply(()=>{l.bubbleDialogService.destroyById(constants.bubble_dialog.id.topic_menu_message),g.navbarService.setFilterState(g.FilterState.CLOSE),this.isShowingMore=!1,c.brokerService.publish(constants.events.filters.less,[void 0,!0])})}shouldClickCloseFilterMenu(e){const t=e.target,i=$(".tw-navbar"),n=$(".filters-middle"),s=$(".time-container"),o={x:e.clientX,y:e.clientY};return g.navbarService.getFilterState()===g.FilterState.OPEN&&!p.twCommon.isPointOnElement(o,this.$element)&&!(i.is(t)||i.has(t).length>0||n.has(t).length>0||s.has(t).length>0)}};m=__decorate([i.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],m),t.FiltersController=m}),define("components/filters/close_overlay/directive",["require","exports","services/navbar","services/template_source"],function(e,t,i,n){return[function(){return e.$inject=["$scope"],{restrict:"AE",replace:!0,scope:{},controller:e,templateUrl:n.templateSourceFactory("components/filters/close_overlay")};function e(e){e.close=function(){i.navbarService.setFilterState(i.FilterState.CLOSE)}}}]}),define("components/filters_searchbar/directive",["require","exports","angular","underscore","services/template_source","event_bus","services/broker","reusable_utilities","classes/application/application","services/tw_common","classes/context_data/context_data","services/configuration"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$element","$scope"],{restrict:"E",replace:!0,scope:{hidePin:"=?",hideMenuSelector:"=?",placeholder:"=?",searchLabel:"=?",handleSearchSeparately:"=?"},controller:t,link:function(t,i){const n=e(()=>{t.isSearch()?($(i.find("#search_bar")).focus(),t.focusOn=!0):t.focusOn=!1},0,!1);t.$on("$destroy",()=>{e.cancel(n)})},templateUrl:s.templateSourceFactory("components/filters_searchbar")};function t(e,t){let s;t.clean=function(e){e.stopPropagation(),t.query="",t.lastQuery="",t.search("")},t.handleKeyDown=h,t.isPinnable=function(){return t.searchbar.isPinnable()},t.isSearch=function(){return g.configurationService.getPageConfiguration().useRecentSearches()},t.isValid=function(){return t.searchbarForm.$valid||!1},t.pinMenu=function(){t.searchbar.pin(c.mainApplication.getPageState().getProject().getId())},t.queryChange=p,t.search=function(e,i){if(t.handleSearchSeparately)o.eventBus.dispatch({type:o.EVENT_TYPES.SEARCH_BAR_SUBMIT,value:e});else{if(e===t.searchbar.getQuery()&&!i)return;t.$broadcast("searchExecuted"),e=e||"",t.searchbar.setQuery(e,!0)}},t.setDefaultValue=function(){t.searchbar.hasQuery()||t.searchbar.setQuery(t.searchbar.defaultValue)},t.setFocus=function(e){e.stopPropagation(),t.focusOn=!0},t.getHelpLink=function(){return _()?d.contextData.getLink("ACADEMY_QUERY_SYNTAX"):""},t.canShowHelpButton=_,t.getSearchbarClass=function(){return i.isDefined(t.resultClassificationTM)&&!t.hideMenuSelector?"menu-select-neighbor":t.getHelpLink().length>0?"academy-link-neighbor":""},t.getPlaceholder=function(){return void 0!==t.placeholder?t.placeholder:d.contextData.getMessage("getLabelSearchBar")},t.getSearchLabel=function(){return m()?t.searchLabel:""},t.hasSearchLabel=m,t.configuration={hideErrorMessages:!0,inputMode:!0},t.searchbar=c.mainApplication.getPageState().getUserFilterSettings().getSearchbarFilter(),(s=new a.CancellationToken).registerCleanupFunction(t.searchbar.onQueryChanged.subscribe(function(e){t.query=e}).cancel);const u=r.brokerService.subscribe(constants.events.filters.selected,()=>{t.query=t.searchbar.getQuery()});function p(){t.searchbar.setQuery(t.query,!1)}function h(e){if(e.keyCode===l.twCommon.keys.ENTER){const i=t.handleSearchSeparately?t.hack.query:t.query;t.search(i,!0),e.preventDefault()}e.stopPropagation()}function m(){return!!t.searchLabel}function _(){return c.mainApplication.getPageState().getAllowedPages().isSearchAdvanced()}s.registerCleanupFunction(()=>{r.brokerService.unsubscribe(constants.events.filters.selected,u)}),s.addDomEvent(e.get(0),"keydown",h),s.addDomEvent(document,"click",function(i){e.is(i.target)||0!==e.has(i.target).length||""!==i.target.id&&0!==e.has("#"+i.target.id).length||t.$apply(()=>{t.isSearch()&&t.setDefaultValue(),t.focusOn=!1})}),t.$on("$destroy",function(){s.cancel()}),t.hack={},void 0===t.handleSearchSeparately&&s.registerCleanupFunction(t.$watch(function(){return t.query},function(e){n([void 0,t.hack.query]).contains(e)||(t.hack.query=e)})),s.registerCleanupFunction(t.$watch(function(){return t.hack.query},function(e){n([void 0,t.query]).contains(e)||(t.query=e,p(),t.$evalAsync())})),t.query=t.searchbar.getQuery(),t.searchbar.hasQuery()&&r.brokerService.publish(constants.events.filters.selected,[constants.root_id.searchbar]),t.getSearchbarMaximumWidth=function(){return c.mainApplication.hasPageState()&&c.mainApplication.getPageState().hasAllowedPages()&&c.mainApplication.getPageState().getAllowedPages().isIssueTrackerModule()?270:null}}}]}),define("react_components/menu/topic_menu_select_component_strategies/lazy_loaded_menu_strategy",["require","exports","other/tw","services/topic_entry_loader","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/application/application","classes/refresh/model_refresh_decorator_factory","services/refresh/model_refresh_service"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.LazyLoadedMenuStrategy=class{constructor(e,t={}){this.menuWrapper=e,this.config=t}onSelect(e,t,i){return new Promise((e,n)=>{this.menuWrapper.selectEntryByMappedId(t.mapped_id,void 0!==i?i.mapped_id:void 0),this.config.refreshDataOnCloseOnly||this.refreshPageData(),e(this.menuWrapper.toModel())})}onMouseEnter(e){return new Promise((t,i)=>{this.fetchDataIfAllowed(e).then(i=>{const n={openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0};i&&(n.changedEntry=this.menuWrapper.getEntryByMappedId(e.mapped_id).toModel()),t(n)})})}isActionsDisabled(){return!1}fetchDataIfAllowed(e){return new Promise((t,s)=>{if(this.menuWrapper.shouldFetchFromServer()&&!this.menuWrapper.getEntryByMappedId(e.mapped_id).hasChildren()){let s;i.tw.pageState.getAllowedPages().isCustomPage()||(s=i.tw.pageState.getId()),n.topicEntryLoaderService.loadDynamicFilters(this.menuWrapper.getEntryByMappedId(e.mapped_id),this.menuWrapper.getType(),s,()=>{t(!0)})}else t(!1)})}refreshPageData(){const e={strategy:s.ModelRefreshStrategy.REFRESH},t=a.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,o.ModelType.PAGE_STATE,e);c.modelRefreshService.refresh(t,e).then(()=>void 0,()=>void 0)}}}),define("components/filters_searchbar/advanced/directive",["require","exports","angular","common_constants","services/template_source","react_components/menu/topic_menu_select_component_strategies/lazy_loaded_menu_strategy","reusable_utilities","react_components/menu/topic_menu_select_component_strategies/default_selection_menu_strategy","reusable_components","services/broker","classes/context_data/context_data","services/tw_common","services/rest_form_service","wrappers/user_filter_settings/build_parameters/build_parameters","canvas_engine","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","services/navigation"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$element","$scope","topicMenuService"],{restrict:"E",replace:!0,controller:e,controllerAs:"vm",templateUrl:s.templateSourceFactory("components/filters_searchbar/advanced")};function e(e,t,s){const w=this,C=[],E=[];let T,M="";return function(){e.get(0).addEventListener("keydown",I,!1);const n=A(constants.topic_menu.TYPE.topic);w.countriesTM=A(constants.topic_menu.TYPE.countries),w.countriesMenuStrategy=new o.LazyLoadedMenuStrategy(w.countriesTM),w.getBookmarkMenu=V,w.getHelpLink=D,w.handleCountrySelect=k,w.handleRecentSearchClick=O,w.handleResultClassificationSelect=k,w.handleSearchClick=x,w.isValid=P,w.canShowCountries=N,w.canShowResultClassification=L,w.hasOneMenu=W,w.isFullWidth=B,w.getSelectedFilters=U,w.getSelectedEntries=G,w.getMenuName=$,w.removeFilter=j,w.isSelectedFiltersDisplayAllowed=H,w.shouldDisplayBookmarks=q,w.handleBookmarkClick=z,w.configuration={hideErrorMessages:!0,inputMode:!0},w.topicMenuSelectStyleModel=r.TopicMenuSelectStyleUtils.buildBoxedStyleModel(),w.resultClassificationTM=A(constants.topic_menu.TYPE.media_topics),w.resultClassificationMenuStrategy=new a.DefaultSelectionMenuStrategy(w.resultClassificationTM),w.recentSearches=i.isDefined(n)?n.getEntryByMappedId(constants.root_id.recent_search):[],T=c.TopicMenuSelectStore.getInstance().onChange.subscribe(function(e){void 0!==e.topicMenu&&e.topicMenu===w.countriesTM?w.handleCountrySelect():void 0!==e.topicMenu&&e.topicMenu===w.resultClassificationTM&&w.handleResultClassificationSelect()});const s=l.brokerService.subscribe(constants.events.page_state.received,d);function d(e){e.getId()===m.mainApplication.getPageState().getId()&&F().hasVirtualSearch()&&(w.query=F().getVirtualSearch())}t.$on("$destroy",function(){l.brokerService.unsubscribe(constants.events.page_state.received,s),T.cancel()}),d(m.mainApplication.getPageState())}();function P(){return t.searchbarForm.$valid||!1}function D(){return d.contextData.getLink("ACADEMY_QUERY_SYNTAX")}function A(e){return F().getTopicMenuByType(e)}function I(e){e.keyCode===g.twCommon.keys.ENTER&&R(w.query)}function x(){R(w.query)}function R(e){const t=routes.controllers.tw.TWRestForm.get(n.source_context.project,tw.project_id,"recent_searches","add","","rform").url;u.restFormService.post(t,{searches:[w.query]});const i=F(),s=new p.BuildParametersWrapper({attributes:[{key:"virtual-search",value:e}]});i.setBuildParameters(s);try{Y()}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state after adding recent search !",void 0,e)}}function F(){return m.mainApplication.getPageState().getUserFilterSettings()}function O(e){w.query=e.name;try{Y()}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state after clicking recent search !",void 0,e)}}function k(){try{Y()}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state !",void 0,e)}}function N(){return!m.mainApplication.getPageState().getAllowedPages().isVisualDiscovery()}function L(){return!m.mainApplication.getPageState().getAllowedPages().isVisualDiscovery()}function B(){return!N()&&!L()}function W(){return N()&&!_.isUndefined(w.countriesTM)&&_.isUndefined(w.resultClassificationTM)||_.isUndefined(w.countriesTM)&&L()&&!_.isUndefined(w.resultClassificationTM)}function U(){return M!==F().getHashSelectionState()&&(M=F().getHashSelectionState(),C.length=0,C.push.apply(C,F().getSelectedFilters(!0,!1))),C}function G(e){return E.length=0,E.push.apply(E,e.getSelectedEntriesRecursively()),E}function $(e){return s.getMenuName(e)}function j(e,t){s.unselectFilterEntry(e,t,F());try{Y()}catch(e){e instanceof Error&&h.logService.error("Error when refreshing page state after removing filter !",void 0,e)}}function H(){return d.contextData.isRuleEnabled("models.tw.profiles.policies.rules.project.DisplayFilterSelectionOnPageProjectRule")&&!m.mainApplication.getPageState().getAllowedPages().isInstantDiscovery()}function q(){return m.mainApplication.getPageState().getAllowedPages().hasBookmarkMenu()}function V(){return m.mainApplication.getPageState().getAllowedPages().getBookmarkMenu()}function z(e,t){b.navigationService.loadBookmark(e.getMappedId())}function Y(){const e={strategy:S.ModelRefreshStrategy.REFRESH},t=v.modelRefreshDecoratorFactory.getDecorator(m.mainApplication.getPageState(),m.mainApplication,y.ModelType.PAGE_STATE,e);f.modelRefreshService.refresh(t,e).then(function(){},function(){})}}}}),define("components/filters_searchbar/menu/horizontal/directive",["require","exports","underscore","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d=n.mainApplication,g=s.modelRefreshService,u=o.modelRefreshDecoratorFactory,p=a.ModelType,h=r.ModelRefreshStrategy,m=c.logService;t.default=["DirectiveWrapper",function(e){function t(i){e.call(this,i,t)}return t.$inject=["$scope"],t.prototype=i.extend(Object.create(e.prototype),{$scope:function(e){return{handleClick:function(e){this.searchbarFilter.setQuery(e.getName()),this.mainEntry.setChildrenSelectionRecursively(!1),e.setSelected(!0);const t={strategy:h.REFRESH},i=u.getDecorator(d.getPageState(),d,p.PAGE_STATE,t);g.refresh(i,t).then(function(){},function(e){e instanceof Error&&m.error("Error when refreshing page state after closing diff explorer !",void 0,e)})}}}}),{restrict:"A",replace:!0,scope:{mainEntry:"=",searchbarFilter:"="},controller:t,link:function(e,t){},templateUrl:l.templateSourceFactory("components/filters_searchbar/menu/horizontal")}}]}),define("components/filters_searchbar/simple/directive",["require","exports","services/template_source","classes/application/application","reusable_utilities","classes/context_data/context_data","angular_utilities"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",replace:!0,scope:{},bindToController:{searchFields:"=?",placeholder:"=?"},controllerAs:"ctrl",controller:a,templateUrl:i.templateSourceFactory("components/filters_searchbar/simple")}};let a=class{constructor(e){this.$scope=e}$onInit(){this.cancellationToken=new s.CancellationToken,this.searchbarFilter=n.mainApplication.getPageState().getUserFilterSettings().getSearchbarFilter(),this.searchbarFilter.hasQuery()&&this.queryChangedHandler(this.searchbarFilter.getQuery()),this.cancellationToken.subscribe(this.searchbarFilter.onQueryChanged,this.queryChangedHandler.bind(this)),this.$scope.$on("$destroy",this.destroy.bind(this))}queryChangedHandler(e){e?this.searchFields?this.keyword=e.replace(new RegExp(`${this.searchFields[0]}: "(.*)" .*`,"i"),"$1").replace('\\"','"'):this.keyword=e.replace(/.*^"(.*)"$/i,"$1").replace('\\"','"'):this.keyword=""}getPlaceholder(){return this.placeholder||o.contextData.getMessage("_663548")}onKeyDown(e){e.keyCode===s.Keys.ENTER&&this.searchbarFilter.setQuery(this.buildQuery(),!0)}buildQuery(){const e=this.sanitize(this.keyword);return this.keyword?this.searchFields?this.searchFields.map(t=>`${t}: ${e}`).join(" OR "):e:""}sanitize(e){return`"${e.replace('"','\\"')}"`}destroy(){this.cancellationToken.cancel()}};a=__decorate([r.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],a),t.SimpleFilterSearchBarController=a}),define("components/form/accordeon_tree/directive",["require","exports","angular","angular_utilities","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:s.templateSourceFactory("components/form/accordeon_tree"),restrict:"E",replace:!0,require:"ngModel",scope:{},bindToController:{ngModel:"=",selectCallback:"=?"},controller:o,controllerAs:"vm",link:r}};let o=class{constructor(e,t){this.$scope=e,this.$element=t,this.selectEntry=this.clickEntryHandler.bind(this)}clickEntryHandler(e,t){t.stopPropagation(),this.isEntryClickable(e)?(this.ngModel.selectEntry(e),this.ngModel.containsSelection()&&this.$scope.ngModelCtrl.$setValidity("field_validity",!0),void 0!==this.selectCallback&&this.selectCallback(e,this.ngModel)):e.toggleCollapse()}isEntryClickable(e){return!this.ngModel.hasLeafSelectionOnly()||this.ngModel.hasLeafSelectionOnly()&&!e.hasChildren()}};function r(e,t,i,n){e.ngModelCtrl=n}o=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],o)}),define("components/form/accordeon_tree/children/directive",["require","exports","angular","services/directive","angular_utilities","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:o.templateSourceFactory("components/form/accordeon_tree/children"),restrict:"AE",scope:{},controller:r,controllerAs:"vm",bindToController:{entry:"=",ngModel:"=",selectEntry:"="}}};let r=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.init()}isEntryClickable(){return!this.ngModel.hasLeafSelectionOnly()||this.ngModel.hasLeafSelectionOnly()&&!this.entry.hasChildren()}init(){_.each(this.entry.getChildren(),e=>{n.directiveService.inject(this.$element.find(".children"),"tw-accordeon-tree-child",{entry:e,"ng-model":this.ngModel,"select-entry":this.selectEntry},this.$scope.$new(!0))})}};r=__decorate([s.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],r)}),define("components/form/all_fields_messages/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:n.templateSourceFactory("components/form/all_fields_messages"),restrict:"EA",scope:{allFieldsError:"="},link:function(e){e.errors=[];const t=e.$watch("allFieldsMessages",function(t,n){t&&(e.errors=[],i.each(i.keys(t),function(n){i.each(t[n],function(t){e.errors.push(t)})}))});e.$on("$destroy",function(){t()})}}}}),define("components/form/autofocus/directive",["require","exports"],function(e,t){function i(e){return{priority:0,replace:!1,transclude:!1,restrict:"AC",scope:{},link:function(t,i,n){e(function(){i[0].focus()},0)}}}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$timeout"],t.default=i}),define("components/form/color_select/directive",["require","exports","underscore","common_constants","components/form/common/topic_menu","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:o.templateSourceFactory("components/form/color_select"),replace:!0,require:"ngModel",restrict:"AE",scope:{ngModel:"=",customColor:"=",ngDisabled:"=?",bottomBtn:"=",bottomBtnCallback:"&",selectCallback:"&"},controller:["$scope","$element","$document",function(e,t,i){t=$(t),i=$(i),e.getSelectedValue=function(){if(e.ngModel){const t=s.getSelectedValue(e.ngModel.root_entry);return t||(void 0!==e.customColorEntry&&(e.customColorEntry.selected===n.topic_entry.selected.node?e.customColorEntry:{})||{})}return{}||{}},e.getValues=function(){return e.ngModel?e.ngModel.root_entry.children:null},e.addColor=function(t){if(e.customColorEntry||(e.customColorEntry={}),t){const i=s.findTopicEntry(e.ngModel.root_entry,t);null===i?(s.recursiveChildrenSelect(e.ngModel.root_entry,n.topic_entry.selected.none),e.customColorEntry.mapped_id=t,e.customColorEntry.selected=n.topic_entry.selected.node):s.recursiveUnselectAndSelect(e.ngModel.root_entry,i.mapped_id)}},i.click(function(i){t.is(i.target)||0!==t.has(i.target).length||e.$apply(function(){e.active=!1})}),e.addColor(e.color)}],link:function(e,t,o,r){o.$attr.required&&r.$setValidity("valid",!1),e.handleClick=function(t,a){e.ngDisabled||(e.customColorEntry&&e.customColorEntry.selected===n.topic_entry.selected.node?(e.customColorEntry.selected=n.topic_entry.selected.none,t.selected=n.topic_entry.selected.node):s.recursiveUnselectAndSelect(e.ngModel.root_entry,t.mapped_id),e.active=!1,o.$attr.required&&i.isEmpty(t.mapped_id)?r.$setValidity("valid",!1):r.$setValidity("valid",!0),e.selectCallback&&e.selectCallback({color:t.mapped_id}),a.stopPropagation())},e.handleBottomBtnClick=function(){e.bottomBtnCallback({customColor:e.customColorEntry})}}}}}),define("components/form/double_list_select/directive",["require","exports","underscore","components/form/common/topic_menu","common_constants","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","orderByFilter"],{templateUrl:o.templateSourceFactory("components/form/double_list_select"),restrict:"AE",scope:{topicMenu:"=",availableLabel:"=",selectedLabel:"=",checkVisibility:"=?"},controller:e,link:function(e,t,i){e.non_selected_lists=e.getNonSelectedLists(),e.selected_lists=e.getSelectedLists()}};function e(e,t){const o=JSON.parse(JSON.stringify(e.topicMenu)),r=function(e){return i.filter(e,function(e){return e.visibility!==s.topic_entry.visibility.not_visible&&e.visibility!==s.topic_entry.visibility.never_visible})};function a(e){return t(e,function(e){return void 0!==e.order?e.order:e.name},!1)}function c(t){e.non_selected_lists=i.without(e.non_selected_lists,t),t.selected=s.topic_entry.selected.none,e.selected_lists.push(t);const o=n.findTopicEntry(e.topicMenu.root_entry,t.mapped_id);null!==o&&void 0!==o&&(o.selected=s.topic_entry.selected.node)}function l(t){e.selected_lists=i.without(e.selected_lists,t),t.selected=s.topic_entry.selected.none,e.non_selected_lists.push(t);const o=n.findTopicEntry(e.topicMenu.root_entry,t.mapped_id);null!==o&&void 0!==o&&(o.selected=s.topic_entry.selected.none)}e.getSelectedLists=function(){let t=n.getSelectedEntries(o.root_entry);return void 0!==e.checkVisibility&&!0===e.checkVisibility&&(t=r(t)),i.each(t,function(e){e.selected=s.topic_entry.selected.none}),t=a(t)},e.getNonSelectedLists=function(){let t=n.getUnselectedEntries(o.root_entry);return void 0!==e.checkVisibility&&!0===e.checkVisibility&&(t=r(t)),t=a(t)},e.includeLists=function(t){t.preventDefault(),i.each(e.non_selected_lists,function(e){e.selected===s.topic_entry.selected.node&&c(e)}),e.selected_lists=a(e.selected_lists)},e.excludeLists=function(t){t.preventDefault(),i.each(e.selected_lists,function(e){e.selected===s.topic_entry.selected.node&&l(e)}),e.non_selected_lists=a(e.non_selected_lists)},e.includeList=function(t,i){i.preventDefault(),c(t),e.selected_lists=a(e.selected_lists)},e.excludeList=function(t,i){i.preventDefault(),l(t),e.non_selected_lists=a(e.non_selected_lists)},e.includeAllLists=function(t){t.preventDefault(),i.each(e.non_selected_lists,function(e){c(e)}),e.selected_lists=a(e.selected_lists)},e.excludeAllLists=function(t){t.preventDefault(),i.each(e.selected_lists,function(e){l(e)}),e.non_selected_lists=a(e.non_selected_lists)},e.handleSelect=function(e,t){t.preventDefault(),e.selected===s.topic_entry.selected.node?e.selected=s.topic_entry.selected.none:e.selected=s.topic_entry.selected.node},e.classItem=function(e){return e.selected===s.topic_entry.selected.node?"selectable active":"selectable"}}}}),define("components/form/error/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:n.templateSourceFactory("components/form/error"),restrict:"A",scope:{errorValidation:"="},link:function(e,t,n,s){e.errors=[];const o=e.$watch("errorValidation",function(t,n){t&&(e.errors=[],t.notification&&t.notification.length>0&&i.each(t.notification,function(t){e.errors.push(t)}))});e.$on("$destroy",function(){o()})}}}}),define("components/form/field_message/directive",["require","exports","underscore","common_constants","services/template_source"],function(e,t,i,n,s){function o(e){return t.$inject=["$scope"],{templateUrl:s.templateSourceFactory("components/form/field_message"),restrict:"A",scope:{fieldMessage:"=",nameField:"="},controller:t,link:function(e,t,n){e.notifications=[],e.elem=n.nameField;const s=e.$watch("fieldMessage",function(t){e.notifications={},t&&t[e.elem]&&t[e.elem].length>0&&i(t[e.elem]).each(function(t){e.notifications[t.type]||(e.notifications[t.type]=[]),e.notifications[t.type].push(t)})},!0);e.$on("$destroy",s)}};function t(t){t.isError=function(e){return e===n.notification.error},t.isWarning=function(e){return e===n.notification.warning},t.isInfo=function(e){return e===n.notification.info},t.isSuccess=function(e){return e===n.notification.success},t.getErrorMessage=function(t){return e.trustAsHtml(t.message)}}}Object.defineProperty(t,"__esModule",{value:!0}),o.$inject=["$sce"],t.default=o,t.FieldMessageDirective=o}),define("components/form/file_upload/directive",["require","exports","angular","common_constants","underscore","classes/context_data/context_data","services/broker","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return e.$inject=["$scope"],{templateUrl:a.templateSourceFactory("components/form/file_upload"),replace:!0,require:"ngModel",scope:{ngModel:"=",placeholder:"=?",isImage:"=?"},controller:e,link:function(e,t,s,o){const a=(t=$(t)).find(".form-control");let c=t.find("input[type=file]");const l=new FileReader,d=e.$watch("ngModel",(t,i)=>{if(t!==i&&t instanceof FileList)if(0!==t.length&&e.isValidUpload(t)){const t=e.ngModel[0];e.placeholder=void 0,e.local_placeholder={key:t.name,mime_type:t.type},/^image\//.test(t.type)&&l.readAsDataURL(t)}else g()});function g(){c.replaceWith(c=c.clone(!0)),o.$setViewValue(void 0),e.placeholder=void 0,e.local_placeholder=void 0}function u(e){return null!==e.match(/(^image\/(?!svg)).*/)}l.onload=(t=>{e.$apply(()=>{const i=t.target;e.local_placeholder.object=i.result,function(){const t=e.ngModel[0].type;return e.ngModel instanceof FileList&&u(t)}()&&(e.placeholder={mime_type:e.ngModel[0].type,object:i.result})})}),e.isValidUpload=(t=>{if(0===t.length)return!1;if(e.isImage){const e=t.item(0);return u(e.type)}return!0}),e.getPlaceholderType=(()=>void 0===e.local_placeholder?"empty":e.local_placeholder.mime_type&&e.local_placeholder.mime_type.match(/^image\//)?"image":e.local_placeholder.url&&!e.local_placeholder.url.match(/^data\:/)?"link":"name"),e.getPlaceholderImage=(()=>{if("image"===e.getPlaceholderType())return e.local_placeholder.url||e.local_placeholder.object}),e.handleFileSelect=(t=>{(t.target.files||t.originalEvent.dataTransfer.files)&&(e.ngModel=t.target.files||t.originalEvent.dataTransfer.files)}),e.getModelLength=(()=>i.isDefined(e.ngModel)?Object.keys(e.ngModel).length:0),e.handleCloseClick=(e=>{g(),e.stopPropagation()}),a.on("click",()=>{c.click(),r.brokerService.publish(n.event.btn.upload_click)}),c.on("change",t=>{e.$apply(()=>e.handleFileSelect(t))}),a.on("dragover",e=>{e.preventDefault(),e.stopPropagation()}),a.on("dragenter",t=>{e.$apply(()=>a.addClass("focus"))}),a.on("dragleave",t=>{e.$apply(()=>a.removeClass("focus"))}),a.on("drop",t=>{e.$apply(()=>{a.removeClass("focus"),e.handleFileSelect(t),t.preventDefault(),t.stopPropagation()})}),e.$on("$destroy",()=>{a.off("click"),c.off("change"),a.off("dragover"),a.off("dragenter"),a.off("dragleave"),a.off("drop"),d()})}};function e(e){e.local_placeholder=s.clone(e.placeholder),i.isDefined(e.isImage)&&!0===e.isImage?e.emptyText=o.contextData.getMessage("_751409"):e.emptyText=o.contextData.getMessage("_975124")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.FileUploadDirective=c}),define("components/form/flat_tag_select/directive",["require","exports","underscore","common_constants","components/form/common/topic_menu","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$element","$document"],{templateUrl:o.templateSourceFactory("components/form/flat_tag_select"),restrict:"AE",require:"ngModel",scope:{ngModel:"=",editable:"=",removeValidation:"=?",restoreValidation:"=?",removeEntryCallback:"&",restoreEntryCallback:"&",tagsManagement:"@",canDelete:"=?",canRestore:"=?",updateEvent:"=?"},controller:e,link:function(e){e.buildModel()}};function e(e){function t(t){e.parsedTopicMenu.root_entry.children=i.without(e.parsedTopicMenu.root_entry.children,i.findWhere(e.parsedTopicMenu.root_entry.children,{mapped_id:t.mapped_id}));const n=t.mapped_id.split("/"),o=s.findTopicEntry(e.inputTopicMenu.root_entry,n[n.length-1]),r=s.findTopicEntryParent(e.inputTopicMenu.root_entry,o.mapped_id);return r.children=i.without(r.children,i.findWhere(r.children,{mapped_id:o.mapped_id})),o}function o(i){const n=t(i);e.removeEntryCallback&&e.removeEntryCallback({entryMappedId:n.mapped_id})}function r(i){const n=t(i);e.restoreEntryCallback&&e.restoreEntryCallback({entryMappedId:n.mapped_id})}e.allowDelete=function(){return void 0===e.canDelete||!0===e.canDelete},e.allowRestore=function(){return void 0===e.canRestore||!0===e.canRestore},e.buildModel=function(){if(e.ngModel){e.inputTopicMenu=e.ngModel,e.parsedTopicMenu=JSON.parse(JSON.stringify(e.inputTopicMenu));const t=e.parsedTopicMenu.root_entry,o=s.findTopicEntry(e.inputTopicMenu.root_entry,"predefined");t.children=s.retrieveLeaves(o.children,!0);const r=s.findTopicEntry(e.inputTopicMenu.root_entry,"custom");i.each(r.children,function(e){const n=e.mapped_id,s=e.name;i.each(e.children,function(e){const i=JSON.parse(JSON.stringify(e));i.mapped_id=n+"/"+e.mapped_id,i.name=s+"/"+e.name,t.children.push(i)})}),s.levelFullySelected(t)&&(t.selected=n.topic_entry.selected.node)}},e.deleteEntry=function(t){e.removeValidation?e.removeValidation().then(function(){o(t)},function(){}):o(t)},e.restoreEntry=function(t){e.restoreValidation?e.restoreValidation().then(function(){r(t)},function(){}):r(t)},e.selectAll=function(){let t,i;e.parsedTopicMenu.root_entry.selected===n.topic_entry.selected.node?(e.parsedTopicMenu.root_entry.selected=n.topic_entry.selected.none,s.recursiveChildrenSelect(e.parsedTopicMenu.root_entry,n.topic_entry.selected.none),t=s.findTopicEntry(e.inputTopicMenu.root_entry,"predefined"),i=s.findTopicEntry(e.inputTopicMenu.root_entry,"custom"),s.recursiveChildrenSelect(t,n.topic_entry.selected.none),s.recursiveChildrenSelect(i,n.topic_entry.selected.none)):(e.parsedTopicMenu.root_entry.selected=n.topic_entry.selected.node,s.recursiveChildrenSelect(e.parsedTopicMenu.root_entry,n.topic_entry.selected.node),t=s.findTopicEntry(e.inputTopicMenu.root_entry,"predefined"),i=s.findTopicEntry(e.inputTopicMenu.root_entry,"custom"),s.recursiveChildrenSelect(t,n.topic_entry.selected.node),s.recursiveChildrenSelect(i,n.topic_entry.selected.node))},e.selectOneItem=function(t){if(e.ngModel.root_entry.selection_type!==n.topic_entry.select_type.none){const i=t.mapped_id.split("/"),o=s.findTopicEntry(e.inputTopicMenu.root_entry,i[0]);let r;2===i.length&&(r=s.findTopicEntry(o,i[1])),t.selected===n.topic_entry.selected.node?(t.selected=n.topic_entry.selected.none,r&&(r.selected=n.topic_entry.selected.none),o.selected=n.topic_entry.selected.none,e.parsedTopicMenu.root_entry.selected=n.topic_entry.selected.none):(t.selected=n.topic_entry.selected.node,r?r.selected=n.topic_entry.selected.node:o.selected=n.topic_entry.selected.node,e.parsedTopicMenu.root_entry.selected===n.topic_entry.selected.none&&s.levelFullySelected(e.parsedTopicMenu.root_entry)&&e.selectAll())}},function(){let t;e.updateEvent&&(t=e.updateEvent.subscribe(function(){e.buildModel()}));e.$on("$destroy",function(){e.updateEvent&&t&&t.cancel()})}()}}}),define("components/form/group_select/directive",["require","exports","common_constants","event_bus","reusable_components","underscore","classes/draggable/strategy/group_select_strategy","services/template_source","services/tw_common","wrappers/topic_menu/topic_entry_wrapper","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g=c.twCommon;t.default=function(){return e.$inject=["$scope","$element","$document","$timeout","bubbleDialogService","configurationService","$rootScope"],{templateUrl:a.templateSourceFactory("components/form/group_select"),restrict:"AE",require:"ngModel",scope:{ngModel:"=",editable:"=",tagsManagement:"=",singleSelectMode:"=?",addGroupCallback:"=?",removeGroupCallback:"&",addEntryCallback:"=?",removeEntryCallback:"&",restoreEntryCallback:"&",removeValidation:"=?",restoreValidation:"=?",saveCallback:"&",renameGroupItemCallback:"&",createEntry:"=?",canAdd:"=?",canDelete:"=?",canEdit:"=?",canRestore:"=?",updateEvent:"=?",colorManagement:"=?",dontShowAllEntriesSelector:"=?",dontShowNumberOfSelectedEntries:"=?"},controller:e,link:function(e,t,i,n){e.container=e.mode.read,e.customGroupValue="",e.rebuildModel(),e.ngModelCtrl=n}};function e(e,t,a,c,u){let p,h;function m(t){t.isSelected()&&e.selectedGroup.setHits(e.selectedGroup.getHits()-1),e.selectedGroup.removeChild(t),e.removeEntryCallback&&e.removeEntryCallback({entryMappedId:t.getMappedId()}),e.ngModelCtrl.$setValidity("field_validity",!0)}function _(t){e.parsedTopicMenu.removeEntry(t),e.parsedTopicMenu.toProto(),e.selectedGroup=void 0,e.changeContainerMode(e.container),e.changeGroup(),e.removeGroupCallback&&e.removeGroupCallback({entry:t}),e.ngModelCtrl.$setValidity("field_validity",!0)}function f(t){e.restoreEntryCallback({entryMappedId:t.getMappedId()}).then(function(){t.isSelected()&&e.selectedGroup.setHits(e.selectedGroup.getHits()-1),e.selectedGroup.removeChild(t),e.ngModelCtrl.$setValidity("field_validity",!0)})}function y(t){if(void 0!==e.selectedGroup)e.selectedGroup.addChild(t),e.selectedGroup.hasHits()||e.selectedGroup.setHits(0),e.selectedGroup.setHits(e.selectedGroup.getHits()+1);else{const i=e.entryPredefinedLevel.getEntryByMappedId("ungrouped");i.addChild(t),i.hasHits()||i.setHits(0),i.setHits(i.getHits()+1)}e.tagsManagement||(e.editButton=!0),e.parsedTopicMenu.toProto(),e.container=e.mode.read,e.singleSelectMode&&(p&&p.element&&p.parentGroup&&v(),p={element:t,parentGroup:e.selectedGroup},n.eventBus.dispatch({type:n.EVENT_TYPES.SINGLE_GROUP_SELECTED_ENTRY,value:t})),e.ngModelCtrl.$setValidity("field_validity",!0)}function v(){p.element&&p.element.isSelected()&&(p.parentGroup.setHits(p.parentGroup.getHits-1),e.parsedTopicMenu.unselectPath(p.element),p.element.setSelectionRecursively(!1))}function S(e){(e.getChildren()||[]).forEach(function(e){e.setSelected(!0)}),e.setHits(e.hasChildren()?e.getChildren().length:0)}function b(t){const i=e.parsedTopicMenu.getRootEntry().getChildren()[1];if(!0!==e.tagsManagement){const i=e.parsedTopicMenu.retrieveChildrenOnEntry(e.entryPredefinedLevel,!0),n=[];(i||[]).forEach(function(i){const s=e.createEntry(JSON.parse(JSON.stringify(i.toProto())),t);s.setSelected(!1),n.push(s)}),n.sort(w),t.setChildren(n)}e.selectedGroup=t,i.addChild(t),e.entryCustomLevel=i,e.editButton=!0,e.container=e.mode.read,e.parsedTopicMenu.toProto()}function w(e,t){return e.getName()<t.getName()?-1:e.getName()>t.getName()?1:0}function C(){e.$apply(function(){e.changeContainerMode(e.mode.read)})}e.mode={read:"read",edit:"edit"},!0===e.tagsManagement&&(e.draggableStrategy=new r.DraggableGroupSelectItemsStrategy(e.ngModel,!0)),e.deleteEntry=function(t){e.removeValidation?e.removeValidation({isGroup:!1}).then(function(){e.tagsManagement?function(t){e.removeEntryCallback({entryMappedId:t.getMappedId()}).then(function(){t.isSelected()&&e.selectedGroup.setHits(e.selectedGroup.getHits()-1),e.selectedGroup.removeChild(t),e.ngModelCtrl.$setValidity("field_validity",!0)})}(t):m(t)},function(){}):m(t)},e.deleteGroup=function(t){e.removeValidation?e.removeValidation({isGroup:!0}).then(function(){e.tagsManagement?function(t){e.removeGroupCallback({entry:t}).then(function(){e.parsedTopicMenu.removeEntry(t),e.selectedGroup=void 0,e.changeContainerMode(e.container),e.changeGroup(),e.ngModelCtrl.$setValidity("field_validity",!0)})}(t):_(t)},function(){}):_(t)},e.restoreEntry=function(t){e.restoreValidation?e.restoreValidation().then(function(){e.tagsManagement&&f(t)},function(){}):f(t)},e.allowDelete=function(){return void 0===e.canDelete||!0===e.canDelete},e.allowEdit=function(){return void 0===e.canEdit||!0===e.canEdit},e.allowAdd=function(){return void 0===e.canAdd||!0===e.canAdd},e.allowRestore=function(){return void 0===e.canRestore||!0===e.canRestore},e.changeContainerMode=function(t,i){t===e.mode.read?e.container=e.mode.read:t===e.mode.edit&&(e.container=e.mode.edit,e.entriesAdd=!1,i?e.customGroupValue=i.getName():(e.selectedGroup=void 0,e.customGroupValue=void 0))},e.editGroupItem=function(t){e.editedEntry=t,e.entryEditing=!0},e.addEntriesMenu=function(){e.entriesAdd=!0,e.container=e.mode.edit,e.customGroupValue=void 0},e.handleKeydown=function(t,i){if(13===t.keyCode){if(!i)return;if(i instanceof l.TopicEntryWrapper&&!i.getName())return;e.entriesAdd||e.entryEditing?o.isString(i)?e.addEntry(i):function(t){e.editedEntry=void 0,e.entryEditing=!1,e.renameGroupItemCallback({entry:t})}(i):e.saveCustomGroup(i),e.closeTooltip()}t.stopPropagation()},e.addEntry=function(t){const n={};if(n.mapped_id=o.uniqueId(),n.name=t,n.selected=i.topic_entry.selected.node,e.addEntryCallback){const t=e.selectedGroup;e.addEntryCallback(n,t).then(y,function(){e.container=e.mode.read,e.ngModelCtrl.$setValidity("field_validity",!0)})}else y(e.createEntry(n))},e.getPattern=function(){return e.tagsManagement?s.tagOrTagGroupRegex:""},e.selectOneGroupItem=function(t,s){e.singleSelectMode?function(t,i){if(void 0===i)return;t.isSelected()?(i.setHits(i.getHits-1),e.parsedTopicMenu.unselectPath(t),t.setSelectionRecursively(!1),n.eventBus.dispatch({type:n.EVENT_TYPES.SINGLE_GROUP_SELECTED_ENTRY,value:void 0})):(t.setSelected(!0),p&&p.element&&p.parentGroup&&v(),p={element:t,parentGroup:i},n.eventBus.dispatch({type:n.EVENT_TYPES.SINGLE_GROUP_SELECTED_ENTRY,value:t}));e.ngModelCtrl.$setValidity("field_validity",!0)}(t,s):e.ngModel.getRootEntry().getSelectionType()!==i.topic_entry.select_type.none&&(t.isSelected()?(void 0!==s?s.setHits(s.getHits-1):t.setHits(0),e.parsedTopicMenu.unselectPath(t),t.setSelectionRecursively(!1)):(t.setSelected(!0),void 0!==s?(s.hits||s.setHits(0),s.setHits(s.getHits()+1)):(t.hits||t.setHits(0),t.setHits(t.getChildren().length)),t.setChildrenSelectionRecursively(!0)),e.ngModelCtrl.$setValidity("field_validity",!0))},e.rebuildModel=function(){e.ngModel&&(e.parsedTopicMenu=e.ngModel,e.parsedTopicMenu.getRootEntry().hasChildren()&&(e.entryPredefinedLevel=e.parsedTopicMenu.getEntryByMappedId("predefined").getChildren()[0],e.entryPredefinedLevel.hasChildren()&&e.entryPredefinedLevel.getChildren().forEach(function(t){t.isSelected()?S(t):e.entryPredefinedLevel.isSelected()&&(t.setSelected(!0),S(t))}),e.parsedTopicMenu.getRootEntry().getChildren().length>1&&(e.entryCustomLevel=e.parsedTopicMenu.getEntryByMappedId("custom"),e.entryCustomLevel.hasChildren()&&(e.entryCustomLevel.getChildren()||[]).forEach(function(e){e.isSelected()&&S(e)}))))},e.changeGroup=function(t,i){e.selectedGroup=t,e.container=e.mode.read,e.editButton=!!i},e.saveCustomGroup=function(t){if(void 0!==t)if(void 0!==e.selectedGroup)e.selectedGroup.setName(t),void 0!==e.saveCallback&&c(function(){e.renameGroupItemCallback({entry:e.selectedGroup})}),e.editButton=!0,e.container=e.mode.read;else if(e.parsedTopicMenu.getRootEntry().hasChildren()){const i={mapped_id:o.uniqueId(),name:t,children:[]},n=e.createEntry(i);n.setSelected(!1),e.addGroupCallback?e.addGroupCallback(n).then(b,function(){e.editButton=!0,e.container=e.mode.read}):b(n)}else e.editButton=!0,e.container=e.mode.read},$(a).on("click",C),$(t).on("click",function(e){e.stopPropagation()}),$(a).on("keydown",function(e){e.keyCode===g.keys.ESCAPE&&$(".colorpicker").removeClass("colorpicker-visible")}),e.$on("$destroy",function(){a.off("click",C),t.off("click"),a.off("keydown"),e.updateEvent&&h&&h.cancel(),e.closeTooltip()}),e.updateEvent&&(h=e.updateEvent.subscribe(function(){e.changeGroup(),e.rebuildModel()})),e.spawnTooltip=(e=>{n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:document.getElementById(e),type:"tooltip",payload:{message:d.contextData.getMessage("_1354659")},placement:"top"}})}),e.closeTooltip=(()=>{n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})})}}}),define("components/form/input/autofill",["require","exports","jquery"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{require:"?ngModel",restrict:"A",link:function(e,t,n,s){const o=i(t);o[0].value.length>0&&s.$setViewValue(o[0].value)}}}}),define("components/form/input/constraint",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{link:function(e,t,i){function n(e){if(e.charCode>0){const t=e.target.value,n=i.twConstraint.replace(/\//g,""),s=function(e){if(e.createTextRange){const t=document.selection.createRange().duplicate();return t.moveEnd("character",e.value.length),t.text?e.value.lastIndexOf(t.text):e.value.length}return e.selectionStart}(e.target),o=function(e){if(e.createTextRange){const t=document.selection.createRange().duplicate();return t.moveStart("character",-e.value.length),t.text.length}return e.selectionEnd}(e.target);null===(t.substring(0,s)+String.fromCharCode(e.charCode)+t.substring(o)).match(n)&&e.preventDefault()}}t.on("keypress",function(t){e.$apply(function(){n(t)})}),t.on("paste",function(t){e.$apply(function(){!function(e){e.preventDefault()}(t)})}),e.$on("$destroy",function(){t.off("keypress"),t.off("paste"),t.unbind("keypress"),t.unbind("paste")})}}}}),define("components/form/input/field_validity",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{require:"ngModel",link:function(e,t,i,n){const s=e.$watch(i.fieldValidity,function(e,t){n.$setValidity("field_validity",!0),e&&(n.$setValidity("field_validity",!1),n.$pristine&&n.$setViewValue(n.$viewValue))});t.on("keyup",function(){n.$setValidity("field_validity",!0)}),e.$on("$destroy",function(){t.off(),t.unbind(),s()})}}}}),define("components/form/input/focus_form",["require","exports"],function(e,t){function i(e){return{restrict:"A",require:"?ngModel",link:function(t,i,n,s){if(!s)return;if(i.on("focus",function(){function n(){t.$apply(function(){s.hasFocus&&(s.timeout_field=!0)})}i.addClass("has-focus"),t.$apply(function(){s.hasFocus=!0,e(n,2e3)})}),i.on("blur",function(){i.removeClass("has-focus"),i.addClass("has-visited"),t.$root.$$phase||t.$apply(function(){s.hasFocus=!1,s.hasVisited=!0,s.timeout_field=!1})}),t.$on("$destroy",function(){i.off("blur")}),i.closest){const e=function(){i.addClass("has-visited"),t.$apply(function(){s.hasFocus=!1,s.hasVisited=!0,s.timeout_field=!1})};i.closest("form").on("submit",e),t.$on("$destroy",function(){i.closest("form").off("submit",e)})}}}}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$timeout"],t.default=i}),define("components/form/label_select/directive",["require","exports","common_constants","components/form/common/topic_menu","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$attrs"],{templateUrl:s.templateSourceFactory("components/form/label_select"),require:"ngModel",restrict:"AE",replace:!0,scope:{ngModel:"=",handleChange:"&onChange",canDisable:"="},controller:e};function e(e,t){Object.defineProperty(e,"topicMenu",{get:function(){return e.ngModel.toProto?e.ngModel.toProto():e.ngModel}}),e.isStacked=function(){return!!t.stacked},e.isSelected=function(e){return e.selected===i.topic_entry.selected.node},e.isVisible=function(e){return e.visibility!==i.topic_entry.visibility.not_visible},e.getRootEntry=function(){return e.topicMenu&&e.topicMenu.root_entry?e.topicMenu.root_entry:e.topicMenu},e.hasIcon=function(){return!!t.ngIcon},e.getIcon=function(){return t.ngIcon},e.handleClick=function(t,s){const o=e.getRootEntry(),r=o.selection_type||i.topic_menu.select_type.single,a=!!o.children_unselect_available||r===i.topic_menu.select_type.multiple||e.canDisable;(a||s.selected!==i.topic_entry.selected.node)&&(r===i.topic_menu.select_type.single&&a?n.recursiveUnselectAndToggle(o,s.mapped_id):r!==i.topic_menu.select_type.single||a?n.toggle(s):n.recursiveUnselectAndSelect(o,s.mapped_id),e.handleChange&&e.handleChange({entry:s,event:t}))}}}}),define("components/form/label_select_div/directive",["require","exports","common_constants","services/template_source"],function(e,t,i,n){function s(){return e.$inject=["$scope","$attrs","$element"],{templateUrl:n.templateSourceFactory("components/form/label_select_div"),restrict:"AE",replace:!0,scope:{topicMenu:"=",maxWidth:"=?",handleChange:"&onChange",canDisable:"=",blockDisabledEntries:"=?",handleDisabledAction:"=?"},controller:e};function e(e,t,n){const s=[];let o=!1;function r(){if(void 0!==e.maxWidth){const e=n.find(".item:last");if(e.length>0)return e.position().top>0}return!1}e.isStacked=function(){return!0===t.stacked},e.isVisible=function(e){return e.getVisibility()!==i.topic_entry.visibility.not_visible},e.hasIcon=function(){return!!t.ngIcon},e.getIcon=function(){return t.ngIcon},e.handleClick=function(t,n){n.stopPropagation();const s=e.topicMenu.getRootEntry(),o=s.getSelectionType()||i.topic_menu.select_type.single,r=s.hasChildrenUnselectAvailable()&&s.isChildrenUnselectAvailable()||o===i.topic_menu.select_type.multiple||e.canDisable,a=e.blockDisabledEntries;if(!r&&t.isSelected())return;if(t.isDisabled()&&a)return void(e.handleDisabledAction&&e.handleDisabledAction());o===i.topic_menu.select_type.single&&r?(e.topicMenu.unselectAll(),t.toggleSelection($(n.target))):o!==i.topic_menu.select_type.single||r?t.toggleSelection($(n.target)):(e.topicMenu.unselectAll(),e.topicMenu.selectEntry(t));e.handleChange&&e.handleChange({entry:t,event:n})},e.computeStyle=function(){return r()?{"max-width":e.maxWidth-9+"px"}:{}},e.hasMoreItems=r,e.getMoreItems=function(){return s.length=0,n.find(".item [data-mapped-id]").filter((e,t)=>$(t).position().top>=n.height()).each((t,i)=>{s.push(e.topicMenu.getEntryByMappedId($(i).attr("data-mapped-id")))}),s},e.toggleMoreItems=function(e){e.stopPropagation(),o=!o},e.canShowMoreItems=function(){return o}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.Directive=s}),define("components/form/on_off/directive",["require","exports","common_constants","angular_utilities","services/template_source"],function(e,t,i,n,s){function o(){return{templateUrl:s.templateSourceFactory("components/form/on_off"),replace:!0,restrict:"AE",scope:{},controller:r,controllerAs:"vm",bindToController:{ngModel:"=",type:"=?",id:"=?",disabled:"=?",onBeforeChange:"=?beforeChange",handleChange:"&onChange"}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.OnOffDirective=o;let r=class{constructor(e){this.$scope=e}$onInit(){this.type=this.type||i.toggle.on_off.type}handleClick(){!0!==this.disabled&&(void 0!==this.onBeforeChange&&this.ngModel?this.onBeforeChange().then(()=>{this.processChange()},()=>void 0):this.processChange())}getLabel(e){return i.toggle[this.type][e]}processChange(){if(this.ngModel=!this.ngModel,this.handleChange){const e=void 0===this.id?{value:this.ngModel}:{value:this.ngModel,id:this.id};this.handleChange(e)}}};r=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],r),t.OnOffController=r}),define("components/form/single_select/directive",["require","exports","underscore","common_constants","components/form/common/topic_menu","services/template_source"],function(e,t,i,n,s,o){function r(){return e.$inject=["$element","$scope","$timeout"],{templateUrl:o.templateSourceFactory("components/form/single_select"),require:"ngModel",restrict:"AE",replace:!0,scope:{ngDefault:"=?",ngDeselect:"=?",ngDisabled:"=?",ngModel:"=",placeholder:"=?",selectCallback:"&",showError:"=?",bottomBtn:"=?",bottomBtnCallback:"&"},controller:e,link:function(e,t,n,o){n.$attr.required&&(e.required=!0,s.getSelectedValue(e.internalModel)&&!i.isEmpty(s.getSelectedValue(e.internalModel).mapped_id)?(e.valid=!0,o.$setValidity("valid",!0)):(e.valid=!1,o.$setValidity("valid",!1)));e.handleClick=((t,r)=>{e.ngDisabled||(s.recursiveUnselectAndSelect(e.internalModel,t.mapped_id),e.active=!1,n.$attr.required&&i(t.mapped_id).isEmpty()?(e.valid=!1,o.$setValidity("valid",!1)):(e.valid=!0,o.$setValidity("valid",!0)),e.selectCallback&&e.selectCallback({params:t}),r.stopPropagation())}),e.$on("$destroy",()=>{$(document).off("click",e.documentClick),$(document).off("keydown",e.keydown),e.selectCallback=void 0,e.bottomBtnCallback=void 0}),e.handleBottomBtnClick=(()=>{e.active=!1,e.bottomBtnCallback({params:e.bottomBtn.params})})}};function e(e,t,o){const r=(e=$(e)).find("ol");return t.isClick=!1,Object.defineProperty(t,"internalModel",{get:function(){return void 0!==(t.ngModel||{}).root_entry?t.ngModel.root_entry:t.ngModel}}),t.ngDisabled=void 0!==t.ngDisabled&&t.ngDisabled,t.showPlaceholder=(()=>!t.getSelectedValue()&&!!t.placeholder),t.getPlaceholder=(()=>t.placeholder),t.getSelectedLabel=c,t.documentClick=u,t.getSelectedValue=a,t.getValues=l,t.keydown=g,t.isInvalid=(()=>t.required&&!t.valid&&t.showError),t.isSelected=(e=>e.selected===n.topic_entry.selected.node),t.ngDefault&&s.recursiveUnselectAndSelect(t.internalModel,t.ngDefault),t.hasBreakLine=d,t.handleFocus=p,t.handleBlur=h,t.handlePlaceholderClick=m,$(document).on("keydown",t.keydown),void $(document).on("click",t.documentClick);function a(){return t.internalModel?s.getSelectedValue(t.internalModel):{}||{}}function c(){const e=a();let i="";return null!==e?i=e.name:void 0!==t.bottomBtn&&(i=t.bottomBtn.name),i}function l(){return t.ngDeselect&&t.getSelectedValue()?["",...t.internalModel.children]:t.internalModel?t.internalModel.children:null}function d(e){return e.breakline===n.topic_entry.breakline.solid_line}function g(e){if(!t.active)return;if(9===e.keyCode)return void(t.active=!1);const o=String.fromCharCode(e.which).toUpperCase();let a,c=!1;i(t.internalModel.children).each(e=>{0===e.name.toUpperCase().indexOf(o)&&(a||(a=e),e.selected===n.topic_entry.selected.node?c=!0:c&&(c=!1,a=e))}),a&&t.$apply(()=>{s.recursiveUnselectAndSelect(t.internalModel,a.mapped_id),function(e){const t=r.find(`li[value="${e.mapped_id}"]`),i=r.scrollTop()+t.position().top;r.scrollTop(i)}(a)})}function u(i){t.active&&!e.is(i.target)&&0===e.has(i.target).length&&t.$apply(()=>t.active=!1)}function p(e){t.active||t.ngDisabled||(t.focusOpen=!0,o(()=>t.focusOpen=!1,500),t.active=!0)}function h(e){t.active=!1}function m(){t.active&&t.focusOpen||(t.active=!t.active&&!t.ngDisabled),t.focusOpen=!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.SingleSelectDirective=r}),define("components/form/tabs/common_tab_content/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{templateUrl:i.templateSourceFactory("components/form/tabs/common_tab_content"),restrict:"E",transclude:!0,replace:!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.CommonTabContentDirective=n}),define("components/form/tabs/tab/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return e.$inject=["elm","attrs","transclude"],{templateUrl:i.templateSourceFactory("components/form/tabs/tab"),restrict:"EA",replace:!0,transclude:!0,require:"^tabset",scope:{active:"=?",readOnly:"=?",mappedId:"=?",heading:"@",headingSvg:"@",headingFont:"@",onSelect:"&select",onDeselect:"&deselect"},compile:e};function e(e,t,i){return function(e,t,n,s){const o=e.$watch(()=>e.active,(t,i)=>{i!==t&&t&&s.select(e)});e.select=(()=>{e.readOnly||(e.active=!0)}),s.addTab(e),e.$on("$destroy",()=>{s.removeTab(e),o()}),e.$transcludeFn=i}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.TabDirective=n}),define("components/form/tabs/tab_content_transclude/directive",["require","exports","angular"],function(e,t,i){function n(){return{restrict:"A",link:function(e,t,n){const s=e.$eval(n.tabContentTransclude);s.$transcludeFn(s.$parent,e=>{i.forEach(e,e=>{!function(e){return e.tagName&&(e.hasAttribute("tab-heading")||e.hasAttribute("data-tab-heading")||"tab-heading"===e.tagName.toLowerCase()||"data-tab-heading"===e.tagName.toLowerCase())}(e)?t.append(e):s.headingElement=e})})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.TabContentTranscludeDirective=n}),define("components/form/tabs/tab_heading_transclude/directive",["require","exports"],function(e,t){function i(){return{restrict:"A",link:function(e,t,i){const n=e.$watch(()=>e.headingElement,e=>{e&&(t.html(""),t.append(e))});e.$on("$destroy",()=>n())}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,t.TabHeadingTranscludeDirective=i}),define("components/form/tabs/tab_list/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{templateUrl:i.templateSourceFactory("components/form/tabs/tab_list"),restrict:"E",transclude:!0,replace:!0,scope:{type:"@"}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.TabListDirective=n}),define("components/form/tabs/tabset/directive",["require","exports","underscore","reusable_utilities","event_bus","services/template_source"],function(e,t,i,n,s,o){function r(){return e.$inject=["$scope","$transclude"],{templateUrl:o.templateSourceFactory("components/form/tabs/tabset"),restrict:"EA",transclude:{"tab-list":"tabList","common-tab-content":"?commonTabContent"},replace:!0,scope:{activeTabOnly:"=?",id:"=?"},controller:e};function e(e,t){let o;const r=this,a=(r.tabs=e.tabs=[],new n.CancellationToken);a.subscribeToStream(s.eventBus,s.EVENT_TYPES.TAB_CHANGE_SELECTION,t=>{t.value.id===e.id&&this.select(this.tabs[t.value.tabIndex])}),e.$on("$destroy",()=>{o=!0,a.cancel()}),r.select=(t=>{i(e.tabs).each(e=>{e.active&&e!==t&&(e.active=!1,e.onDeselect())}),t.active=!0,t.onSelect()}),r.addTab=(t=>{e.tabs.push(t),1===e.tabs.length&&!1!==t.active?t.active=!0:t.active?r.select(t):t.active=!1}),r.removeTab=(t=>{const i=e.tabs.indexOf(t);if(t.active&&e.length>1&&!o){const t=i===e.length-1?i-1:i+1;r.select(e.tabs[t])}e.tabs.splice(i,1)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.TabsetDirective=r}),define("components/form/tree_select/directive",["require","exports","underscore","common_constants","components/form/common/topic_menu","selection","services/tw_common","services/broker","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=r.twCommon;t.default=function(){return e.$inject=["$scope","$document","$sce"],{templateUrl:c.templateSourceFactory("components/form/tree_select"),restrict:"AE",require:"ngModel",scope:{ngModel:"=",elemDisplayIndex:"@",flat:"@",keepDefaultSelected:"=",editable:"=",scrollable:"=?",singleSelection:"=?",minOneMustBeSelected:"=?",selectCallback:"=?",instanceId:"=?",allowNoSelections:"=?",disableMultiple:"=?",colorManagement:"=?"},controller:e,link:function(e,t,r,a){e.children_template=use_minified_templates?"components/form/tree_select/children":"assets/components/form/tree_select/children/template.html",e.refreshInternalStructure=function(){let t=null;if(t=e.elemDisplayIndex?e.ngModel.root_entry.children[0].children[0]:e.ngModel.root_entry.children,e.noneField=!!e.ngModel.root_entry.selection_strategy_parameters&&e.ngModel.root_entry.selection_strategy_parameters.none_selection_available,e.flat&&"true"===e.flat){const o=[],r={};r.mapped_id=t.mapped_id,r.name=t.name,r.hackParentAttribute=!0,r.selected=t.selected,r.children=s.retrieveLeaves(e.ngModel.root_entry.children,!1),r.children=s.pruneTopicEntryKeepingSelection(r.children,n.topic_entry.selected.node),r.children.sort(s.compareTopicMenu),o.push(r),e.entriesTree=o,function(t){s.levelFullySelected(t.children)?(i.each(t.children,function(e){e.selected=n.topic_entry.selected.none,i.each(e.children,function(e){e.selected=n.topic_entry.selected.none})}),t.selected=n.topic_entry.selected.node,e.entriesTree[0].selected=n.topic_entry.selected.node):i.each(t.children,function(e){i.isUndefined(e.children)||e.selected!==n.topic_entry.selected.node||(e.selected=n.topic_entry.selected.none,i.each(e.children,function(e){e.selected=n.topic_entry.selected.node}))})}(t)}else e.entriesTree=t;e.entriesTree.length>1?e.selection=new o.default(e.entriesTree,n.topic_entry.selected.node,n.topic_entry.selected.none):void 0===e.entriesTree[0].children?e.selection=new o.default([e.entriesTree[0]],n.topic_entry.selected.node,n.topic_entry.selected.none):e.selection=new o.default(e.entriesTree[0],n.topic_entry.selected.node,n.topic_entry.selected.none)},e.ngModel&&e.ngModel.root_entry&&(e.refreshInternalStructure(),e.ngModelCtrl=a)}};function e(e,t,o){const r=a.brokerService.subscribe(constants.events.tree_select.refresh,function(t,i){e.instanceId===i&&(e.ngModel=t,e.refreshInternalStructure())});function c(){return!i.isUndefined(e.ngModel.default_mapped_id)}function d(){const t=i.find(e.entriesTree,function(t){return t.mapped_id===e.ngModel.default_mapped_id}).selected===n.topic_entry.selected.node;e.ngModelCtrl.$setValidity("defaultSelected",t)}function g(e){i.each(e.children,g),e.selected=n.topic_entry.selected.none}function u(t){if(1===e.entriesTree.length){let i;i=e.flat?s.findTopicEntry(e.ngModel.root_entry,"predefined").children[0]:e.ngModel.root_entry.children[0],t.mapped_id!==e.entriesTree[0].mapped_id&&(i.selected=n.topic_entry.selected.none,e.entriesTree[0].selected=n.topic_entry.selected.none);const o=e.entriesTree[0].children;t.mapped_id===e.entriesTree[0].mapped_id||s.levelFullySelected(o)?(e.selection.clear(),s.recursiveChildrenSelect(e.entriesTree[0],n.topic_entry.selected.none),s.recursiveChildrenSelect(i,n.topic_entry.selected.none),i.selected=n.topic_entry.selected.node,e.entriesTree[0].selected=n.topic_entry.selected.node):e.entriesTree[0].selected===n.topic_entry.selected.node&&(i.selected=n.topic_entry.selected.none,e.entriesTree[0].selected=n.topic_entry.selected.none)}}$(t).on("keydown",function(e){e.keyCode===l.keys.ESCAPE&&$(".colorpicker").removeClass("colorpicker-visible")}),e.$on("$destroy",function(){t.off("keydown"),a.brokerService.unsubscribe(constants.events.tree_select.refresh,r)}),e.unselectAll=function(){void 0!==e.editable&&!0!==e.editable||(g(e.ngModel.root_entry),g(e.entriesTree[0]))},e.isNoneSelected=function(){const t=e.entriesTree[0].children;return s.levelFullyUnselected(t)&&e.entriesTree[0].selected===n.topic_entry.selected.none},e.isDefaultEntry=function(t){return e.ngModel.default_mapped_id===t.mapped_id},e.selectNode=function(t,o){if(!(e.keepDefaultSelected&&e.isDefaultEntry(t)||void 0!==e.editable&&!0!==e.editable)){if(e.noneField&&t.mapped_id===e.entriesTree[0].mapped_id&&t.selected===n.topic_entry.selected.node)return void e.unselectAll();if(function(e){return e.ctrlKey&&!e.shiftKey&&c()}(o))return e.ngModel.default_mapped_id=t.mapped_id,void d();if(!0===e.allowNoSelections||1===e.entriesTree.length&&t.mapped_id!==e.entriesTree[0].mapped_id||e.entriesTree.length>1){const r=void 0===e.singleSelection||(!e.singleSelection||!0!==e.disableMultiple&&o.ctrlKey);e.selection.toggle(i.indexOf(e.selection.list,t),r,o.shiftKey),t.selected===n.topic_entry.selected.node?u(t):function(t){if(e.entriesTree.length>1)t.selected=n.topic_entry.selected.none;else if(t.mapped_id!==e.entriesTree[0].mapped_id||e.noneField){t.selected=n.topic_entry.selected.none;const i=e.entriesTree[0].children;if(s.levelFullyUnselected(i)&&!e.noneField){let t;(t=e.flat?s.findTopicEntry(e.ngModel.root_entry,"predefined").children[0]:e.ngModel.root_entry.children[0]).selected=n.topic_entry.selected.node,e.entriesTree[0].selected=n.topic_entry.selected.node,e.selection.anchor=void 0}}}(t)}else{t.selected=n.topic_entry.selected.node,u(t);const s=i.indexOf(e.selection.list,t);s>-1&&(e.selection.anchor=s)}void 0!==e.selectCallback&&e.selectCallback(t),e.minOneMustBeSelected&&function(){const t=e.entriesTree.some(function(e){return e.selected===n.topic_entry.selected.node});e.ngModelCtrl.$setValidity("minOneSelected",t)}(),c()&&d(),e.ngModelCtrl.$setValidity("field_validity",!0)}},e.classItem=function(t){const i=!(void 0!==e.ngModel&&void 0===e.editable||!0===e.editable);let o;const r=n.topic_entry.selected.node;let a;return e.flat&&(o=s.findTopicEntry(e.ngModel.root_entry,"predefined").children[0]),t.selected===n.topic_entry.selected.node&&(!o||o.mapped_id===t.mapped_id&&o.selected===r||o.mapped_id!==t.mapped_id&&o.selected!==r)?(a="selectable active",i&&(a+=" disabled"),a):(a="selectable",i&&(a+=" disabled"),a)},e.getNoneFieldLabel=function(){let t=n.tree_select.none[e.ngModel.type];return i.isUndefined(t)&&(t=n.tree_select.none.default),o.trustAsHtml(t)}}}}),define("components/form/tree_select/topic_menu_select",["require","exports","underscore","common_constants","components/form/common/topic_menu","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope"],{templateUrl:o.templateSourceFactory("components/form/tree_select"),restrict:"AE",require:"ngModel",scope:{ngModel:"=",editable:"=",scrollable:"=?",selectCallback:"=?"},controller:e,link:function(e,t,i){e.children_template=use_minified_templates?"components/form/tree_select/children":"assets/components/form/tree_select/children/template.html",e.ngModel&&e.ngModel.root_entry&&(e.entriesTree=e.ngModel.root_entry.children)}};function e(e){e.selectNode=function(t,o){void 0!==e.editable&&!0!==e.editable||(t.selected===n.topic_entry.selected.node?function(e){e.selected=n.topic_entry.selected.none}(t):function t(o){o.selected=n.topic_entry.selected.node;s.recursiveChildrenSelect(o,n.topic_entry.selected.none);const r=s.getParentsOfEntry(o,e.ngModel);i.each(r,function(e){e.selected=n.topic_entry.selected.none});if(r.length>0){const e=r[r.length-1];s.levelFullySelected(e.children)&&(i.each(e.children,function(e){e.selected=n.topic_entry.selected.none}),t(e))}}(t),void 0!==e.selectCallback&&e.selectCallback(t))},e.classItem=function(t){const o=!(e.ngModel&&void 0===e.editable||!0===e.editable);let r;if(t.selected===n.topic_entry.selected.node)return r="selectable active",o&&(r+=" disabled"),r;{const a=s.getParentsOfEntry(t,e.ngModel),c=i.findWhere(a,{selected:n.topic_entry.selected.node});return r=void 0!==c?"selectable implicit":"selectable",o&&(r+=" disabled"),r}}}}}),define("components/form/validation/password_verify",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$element","$attrs","$transclude"],{require:"ngModel",scope:!0,controller:e,link:function(e,t,i,n){const s=e.$watch(function(){const t=e.$eval(i.ngModel),n=e.$eval(i.twPasswordVerify);return t===n},function(e,t){n.$setValidity("tw_password_check",e)});e.$on("$destroy",function(){s()})}};function e(e,t,i,n){}}}),define("components/ga_event/directive",["require","exports","services/google_analytics","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",scope:{category:"@",action:"@",label:"@?",value:"=?"},link:function(e,t,s){function o(t){i.googleAnalyticsService.sendEvent(e.category,e.action,e.label,e.value)}function r(t){t.keyCode===n.twCommon.keys.ENTER&&i.googleAnalyticsService.sendEvent(e.category,e.action,e.label,e.value)}t.on("click",o),t.on("keyup",r),t.on("$destroy",function(){t.off("click",o),t.off("keyup",r)})}}}]}),define("services/shared_entities",["require","exports","other/tw","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{getGroupListLabel(e){switch(e.type_code){case constants.shareable_entities.type.st:return n.contextData.getMessage("_1420668");case constants.shareable_entities.type.ft:return n.contextData.getMessage("_1984523");case constants.shareable_entities.type.tp:return n.contextData.getMessage("_1588235");case constants.shareable_entities.type.sp:return n.contextData.getMessage("_1922683");case constants.shareable_entities.type.ev:return n.contextData.getMessage("_1815986");case constants.shareable_entities.type.mg:return n.contextData.getMessage("_1404904");default:return""}}},Object.defineProperty(t,"sharedEntitiesService",{get:function(){return i.tw.inject("sharedEntitiesService")}})}),define("controllers/rest_form/shared/entities/group/shared_entities_group",["require","exports","components/form/common/topic_menu","services/rest_form_service","services/shared_entities","classes/context_data/context_data"],function(e,t,i,n,s,o){function r(e,t,r){function a(e){return s.sharedEntitiesService.getGroupListLabel(e)}function c(){n.restFormService.post(e.form_entry.share_group_entities_link,e.form_entry).then(e=>d)}function l(){d()}function d(){r.redirect(e.form_entry.show_groups_link)}e.form_entry=t.form_entry,e.progressOptions={text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337"),action:constants.events.form.action.post,isDisabled:()=>!(i.isAnyEntrySelected(e.form_entry.group.entities_menu)&&i.isAnyEntrySelected(e.form_entry.projects_menu))},e.getGroupListLabel=a,e.save=c,e.cancel=l}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$scope","$window","$rootScope"],t.default=r}),define("components/gender/directive",["require","exports","d3","underscore","components/tools/results","services/template_source","services/bubble_dialog","services/configuration","classes/navigation/nav_params","services/navigation","services/tw_number_formatter","reusable_utilities","canvas_engine"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});const p={backgroundColor:"lightgray",colors:{male:"#0092d2",female:"#cc006a"},basePathDimensions:{female:{width:92,height:181.9},male:{width:68.7,height:181.8}},shapes:{female:"M44.8,29c0-9.6,7.8-17.5,17.5-17.5c9.6,0,17.5,7.8,17.5,17.5c0,9.6-7.8,17.5-17.5,17.5C52.6,46.5,44.8,38.7,44.8,29z M107,107.1L88,58.6c-0.2-0.4-0.4-0.8-0.7-1.2c-1.7-4.5-6-7.6-11.1-7.6h-28c-5.1,0-9.4,3.2-11.1,7.6c-0.3,0.4-0.5,0.8-0.7,1.2l-19,48.5c-1.2,3,0.3,6.5,3.3,7.6c0.7,0.3,1.4,0.4,2.2,0.4c2.4,0,4.6-1.4,5.5-3.8l11.8-31c0.2-0.8,1-1.3,1.8-1.1c0.8,0.2,1.3,1,1.1,1.8l-12.7,53.6h13.6v51.9c0,3.8,3.1,6.9,6.9,6.9s6.9-3.1,6.9-6.9v-51.9h8.9v51.9c0,3.8,3.1,6.9,6.9,6.9s6.9-3.1,6.9-6.9v-51.9h13.6L81.5,81.1c-0.2-0.8,0.3-1.6,1.1-1.8c0.8-0.2,1.6,0.3,1.8,1.1l11.7,31c0.9,2.3,3.1,3.8,5.5,3.8c0.7,0,1.4-0.1,2.2-0.4C106.7,113.6,108.2,110.1,107,107.1z",male:"M44.8,29.1c0-9.6,7.8-17.4,17.4-17.4c9.6,0,17.4,7.8,17.4,17.4c0,9.6-7.8,17.4-17.4,17.4C52.6,46.5,44.8,38.7,44.8,29.1z M82.6,49.8H42c-7.8,0-14.1,6.3-14.1,14.1v45.4c0,3.3,2.6,5.9,5.9,5.9s5.9-2.6,5.9-5.9l0-30.7c0-0.8,0.7-1.5,1.5-1.5c0.8,0,1.5,0.7,1.5,1.5l0.1,45.8v10.4v49.9c0,4.9,4,8.8,8.8,8.8c4.9,0,8.8-4,8.8-8.8v-49.9h3.7v49.9c0,4.9,4,8.8,8.8,8.8c4.9,0,8.8-4,8.8-8.8v-49.9v-10.4V78.5c0-0.8,0.7-1.5,1.5-1.5c0.8,0,1.5,0.7,1.5,1.5l0.1,30.7c0,3.3,2.6,5.9,5.9,5.9s5.9-2.6,5.9-5.9V63.9C96.6,56.1,90.3,49.8,82.6,49.8z"}};t.default=[function(){return e.$inject=["$element","$scope"],{replace:!1,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:e,templateUrl:o.templateSourceFactory("components/gender")};function e(e,t){t.dimensions={height:225,width:130,sectionWidth:130,cellHeight:90,padding:20};const o=e.find("svg").toArray(),h=(new u.Font).setSize(100);function m(){return t.dimensions.sectionWidth-2*t.dimensions.padding}function _(){return.9*Math.min(t.dimensions.height,200*t.dimensions.pathFactor)}function f(i){const n=t.genderData[i];r.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),r.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,e.find("."+n.gender+" path.highlightable"),"bars",n.popoverData,a.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.lines))}function y(){r.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.popup,600)}function v(e){t.updateDimensions(e);const i=t.widget.getPayloadValue();return t.loaded=!1,t.series=[],t.values={},t.isSampleData=i.data_graph.sample_data||!1,t.genders=[],(b(i).column_groups||[]).forEach(function(e){t.genders.push(e.data_columns[0].code.toLowerCase())}),t.genders.length>0&&(S(i,e,"female",0),S(i,e,"male",1)),setTimeout(function(){t.updateLabelFont(),t.updateGenderPositions()},10),g.waitFor(e.animationDuration+10)}function S(e,r,a,u){const h=i.select(o[u]),m=function(e,i){let n=e.select("defs");n.empty()&&((n=e.append("defs")).append("clipPath").attr("id","clip-path-"+i+"-"+t.id).append("path").attr("d",p.shapes[i]),n.append("clipPath").attr("id","clip-box-"+i+"-"+t.id).append("rect"));return $(n[0][0]).find("rect").attr({height:t.dimensions.height/t.dimensions.pathFactor,width:t.dimensions.sectionWidth/t.dimensions.pathFactor,y:_()}),n}(h,a);!function(e,i){e.classed(i,!0).attr({height:t.dimensions.height,width:t.dimensions.sectionWidth})}(h,a),function(e,i){let n=e.select("rect.background-shape");n.empty()&&(e.append("rect").attr({class:"background-shape",fill:p.backgroundColor}).style({"clip-path":["url(#clip-path-",i,"-",t.id,")"].join("")}),n=e.select("rect.background-shape"));$(n[0][0]).attr({height:t.dimensions.height/t.dimensions.pathFactor,width:t.dimensions.sectionWidth/t.dimensions.pathFactor})}(h,a);const v=i.select(m[0][0].childNodes[1].childNodes[0]);if(!~t.genders.indexOf(a))return void v.transition().attr("y",_()).duration(r.animationDuration);const S=function(e,i){const o=function(){const i=t.genders.indexOf(e);if(i<0)throw new Error("Unknown Gender");return i}(),r=n(i.rows[0].cells).chain().pluck("value").pluck("value").map(Number).value().reduce((e,t)=>e+t,0),a=i.rows[0].cells[o].value,c={gender:i.column_groups[o].data_columns[0].code.toLowerCase(),value:Number(a.value),valueOld:Number(a.value_old),label:i.column_groups[o].data_columns[0].name};t.widget.isClickable()&&void 0!==i.column_groups[o].data_columns[0].filter&&(c.filter=g.StringUtils.parseFilters(i.column_groups[o].data_columns[0].filter));return c.percent=0===r?0:c.value/r,c.formatted_percentage=d.twNumberFormatter.getInstance().toPercentage(c.percent),c.height=Math.floor(c.percent*_()),c.valueChange=s.default.constructor.getValueChange(c.value,c.value_old),c.popoverData={node:{color:p.colors[e.toLocaleLowerCase()],label:c.label},values:[{label:i.total_label,value:d.twNumberFormatter.getInstance().toDecimal(c.value),tendency:c.valueChange}],corner:c.formatted_percentage},c}(a,b(e));t.values[a]={percent:S.percent,formatted_percentage:S.formatted_percentage},t.series.push({label:S.label,color:p.colors[a],valueChange:S.valueChange}),function(e,i){if(e.select("g").empty()){let n="highlightable";t.widget.isClickable()&&void 0!==i.filter&&(n+=" clickable"),e.append("g").append("path").classed(n,!0).style({"clip-path":["url(#clip-box-",i.gender,"-",t.id,")"].join(""),fill:p.colors[i.gender],stroke:p.colors[i.gender],"stroke-opacity":.4}).attr("d",p.shapes[i.gender]).on({click:function(e){const i=t.genderData[e];if(t.widget.isClickable()&&void 0!==i.filter){const e=new c.NavigationParams;e.setFilters([i.filter]),e.setWidget(t.widget),e.setClickTarget(t.widget.element),l.navigationService.clickHandler(e,t.widget.element)}}.bind(this,i.gender),mouseenter:f.bind(this,i.gender),mouseleave:y})}}(h,S),v.transition().attr("y",Math.max(0,_()-S.height)/t.dimensions.pathFactor).duration(r.animationDuration),t.genderData[a]=S}function b(e){if(!t.init&&t.widget.hasReplayManager()&&w()>=0){const i=t.widget.getDic().primary_source.tw_data_source;if(i.x_axis&&!0!==i.x_axis.use_time)return e.data_graph.additional_frames[w()]}return e.data_graph}function w(){return t.widget.replayManager.frameIndex}t.fragment.attach(t,e),t.redrawWidget=v,t.loaded=!1,t.id=t.widget.uuid,t.genderData=[],t.config=p,t.mediator.listen("REPLAY_PROGRESS",function(){t.currentReplayStep===w()&&1!==t.widget.replayManager.timeline.progress||(t.currentReplayStep=w(),v(t.drawSettings),t.$apply())}),t.hasMale=function(){return!(!t.genders||!t.genders.includes("male"))},t.hasFemale=function(){return!(!t.genders||!t.genders.includes("female"))},t.updateLabelFont=function(){const i=e.find(".metrics").find(".cell");h.setFamily(i.css("font-family"));const n=u.Utilities.measureText("100.0%",h),s=Math.min(Math.floor(t.dimensions.sectionWidth/(n.width/115)),t.dimensions.cellHeight);for(let e=0;e<i.length;e++)i.eq(e).css("font-size",s),i.eq(e).css("margin-top",s/3),i.eq(e).css("margin-bottom",s/6);u.ObjectCache.recycleObject(n)},t.updateDimensions=function(i){t.dimensions.width=i.dimensions.width,t.dimensions.height=i.dimensions.height,t.dimensions.padding=.05*i.dimensions.width,t.dimensions.sectionWidth=Math.floor(t.dimensions.width/3),t.dimensions.cellHeight=Math.floor(t.dimensions.height/3),e.find(".metrics").width(t.dimensions.sectionWidth),function(e){t.dimensions.pathFactor=Math.min(m()/p.basePathDimensions[e[0]].width,.9*t.dimensions.height/p.basePathDimensions[e[0]].height,m()/p.basePathDimensions[e[1]].width,.9*t.dimensions.height/p.basePathDimensions[e[1]].height)}(["female","male"])},t.updateGenderPositions=function(){const i=e.find(".graphic");i.css("transform","translate(0px,0px)"),i.find("svg").css({transform:"scale("+t.dimensions.pathFactor+")","transform-origin":"top left",width:t.dimensions.sectionWidth/t.dimensions.pathFactor+"px",height:t.dimensions.height/t.dimensions.pathFactor+"px"}),i.eq(0).css("transform","translate("+(Math.max($(e).offset().left-i.eq(0).offset().left,0)+(t.dimensions.sectionWidth<163*t.dimensions.pathFactor?t.dimensions.padding*(1-t.dimensions.pathFactor):t.dimensions.sectionWidth-p.basePathDimensions.female.width*t.dimensions.pathFactor)/Math.max(2*t.dimensions.pathFactor,2)).toString()+"px,0px)"),i.eq(1).css("transform","translate("+(Math.min($(e).offset().left+2*t.dimensions.sectionWidth-i.eq(1).offset().left,0)+(t.dimensions.sectionWidth<163*t.dimensions.pathFactor?-t.dimensions.padding*(1-t.dimensions.pathFactor):(t.dimensions.sectionWidth-p.basePathDimensions.male.width*t.dimensions.pathFactor)/Math.max(2*t.dimensions.pathFactor,2))).toString()+"px,0px)")}}}]}),define("components/grid/page/directive",["require","exports","angular_utilities","angular","reusable_utilities","event_bus","services/template_source","classes/application/application"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{scope:{},bindToController:{model:"=",pageState:"=?"},replace:!1,controllerAs:"vm",controller:c,templateUrl:r.templateSourceFactory("components/grid/page")}};let c=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.token=new s.CancellationToken,this.token.subscribeToStream(o.eventBus,o.EVENT_TYPES.ENTER_PRESENTATION_MODE,()=>{const e=this.model.getConfiguration().style.grid.aspectRatio;window.innerWidth/e>window.innerHeight?this.$element.css({"margin-left":`${50-window.innerHeight*e/window.innerWidth*50}vw`,width:`${window.innerHeight*e/window.innerWidth*100}vw`}):this.$element.css({width:"100vw","margin-top":`${50*(1-window.innerWidth/e/window.innerHeight)}vh`}),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_UPDATE_SIZE,value:{width:this.$element.width(),id:this.model.getId()}})}),this.token.subscribeToStream(o.eventBus,o.EVENT_TYPES.EXIT_PRESENTATION_MODE,()=>{this.$element.css({width:"","margin-left":"","margin-top":""}),o.eventBus.dispatch({type:o.EVENT_TYPES.GRID_UPDATE_SIZE,value:{width:this.$element.width(),id:this.model.getId()}})}),this.$scope.$watch(()=>this.model,(e,t)=>{t&&t.setHtmlElement(void 0),e&&e.setHtmlElement(this.$element[0])}),this.$scope.$on("$destroy",()=>{this.model&&this.model.setHtmlElement(void 0),this.token.cancel()})}hasGridPage(){return!!this.model}getGridPage(){if(void 0===this.model)throw new Error("illegal state");return this.model}canShowGridPageNumber(){return this.hasGridPage()&&this.getGridPage().getConfiguration().showPageNumber&&void 0!==this.getGridPage().getNumber()}isEditMode(){return void 0!==this.pageState?this.pageState.isEditMode():a.mainApplication.getPageState().isEditMode()}};c=__decorate([i.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],c)}),define("components/grid/pages/scrollable/directive",["require","exports","angular_utilities","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,scope:{},bindToController:{gridPageCollection:"="},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("components/grid/pages/scrollable")}};let s=class{constructor(e){this.$scope=e}getGridPages(){return this.gridPageCollection.getPages()}};s=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],s)}),define("components/grid/pages/switchable/directive",["require","exports","angular_utilities","event_bus","log","reusable_utilities","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/loading_bubble","services/presentation_service","services/refresh/model_refresh_service","services/template_source","services/widgets/widget_initializer","classes/refresh/model_state"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,scope:{},bindToController:{gridPageCollection:"=",cachedMode:"=",widgetLoadingConfiguration:"=?",activePageId:"=?",pageState:"=?"},controllerAs:"vm",controller:f,templateUrl:p.templateSourceFactory("components/grid/pages/switchable")}};let f=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i}$onInit(){this.cancellationToken=new o.CancellationToken,void 0!==this.activePageId&&this.gridPageCollection.setCurrentPageId(this.activePageId),this.gridPageCollection.hasPages()&&this.initItemSelectionForGrid(this.gridPageCollection.getCurrentPage()),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_UPDATE_CONFIGURATION,e=>{const t=this.gridPageCollection.findPage(e.value.id);t&&t.setConfiguration(Object.assign(t.getConfiguration(),e.value.configuration))}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,e=>{const{pageId:t}=e.value;this.gridPageCollection.hasPage(t)&&this.changeGridPageById(t)}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_PAGE_PAGE_TYPE_CHANGE,e=>{const{pageType:t}=e.value,i=_.compact(_.flatten(this.getPageState().getPageConfiguration().pages.map(e=>[e,e.pages]))).find(e=>e.navigation&&e.navigation.page_type===t);i&&this.gridPageCollection.hasPage(i.id)&&(this.gridPageCollection.getAnchorModel().selectNodeById(i.id,!1),this.changeGridPageById(i.id))}),this.$scope.$watch(()=>this.activePageId,e=>{void 0!==e&&this.gridPageCollection.setCurrentPageId(e)}),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel(),void 0!==this.itemsSelectionToken&&this.itemsSelectionToken.cancel()})}changeGridPageById(e){this.$element.find(".tw-grid")[0].style.height=null,g.presentationService.isPresentationEnabled&&this.getPageState().getWidgets().filter(t=>t.getSlotConfiguration()&&t.getSlotConfiguration().page===e).forEach(e=>e.redraw(!0)),this.gridPageCollection.setCurrentPageId(e),this.triggerWidgetReload(),this.initItemSelectionForGrid(this.gridPageCollection.findPage(e)),h.widgetInitializer.expediteGridPage(e,this.pageState),this.$rootScope.$$phase||this.$scope.$apply()}triggerWidgetReload(){this.widgetLoadingConfiguration&&this.widgetLoadingConfiguration.loadWidgetsOnGridVisible&&(this.pendingWidgetLoad&&clearTimeout(this.pendingWidgetLoad),this.pendingWidgetLoad=setTimeout(()=>{this.pendingWidgetLoad=void 0,this.loadWidgetsIfNecessary()}))}shouldWidgetBeLoaded(e){return e.isSkeleton()||e.isArticles()&&!e.getPageState().getAllowedPages().isCustomPage()}prepareWidgetForReload(e){e.setReloading(!0),e.isArticles()&&(e.setSkeleton(!0),e.clearPayloadValue(),e.hasExtendedConfiguration()&&(e.getExtendedConfiguration().clearLoadedUrls(),e.getExtendedConfiguration().setLoadMoreFlag(!1),e.getExtendedConfiguration().setOffset(0)))}async loadWidgetsIfNecessary(){const e=o.PageConfigurationUtils.getCurrentPage(this.getPageState().getPageConfiguration());void 0!==e.navigation&&void 0!==e.navigation.strategy&&"SKELETON_AND_REFRESH"===e.navigation.strategy&&await this.refreshPageData(m.ModelState.PARTIAL);const t=this.getWidgetsForPage(this.getActivePage().getId());let i;(i=this.pageState&&this.pageState.hasAllowedPages()&&this.pageState.getAllowedPages().isDashboard()?t.every(e=>!this.shouldWidgetBeLoaded(e)):t.length>0&&t.every(e=>!this.shouldWidgetBeLoaded(e)))?d.loadingBubbleService.hideSpinner():(t.forEach(e=>{this.prepareWidgetForReload(e)}),d.loadingBubbleService.showSpinner(),this.$scope.$apply(),this.pendingWidgetLoad=setTimeout(()=>{this.loadMoreData()},750))}async refreshPageData(e){const t={strategy:c.ModelRefreshStrategy.REFRESH,modelState:e},i=a.modelRefreshDecoratorFactory.getDecorator(this.getPageState(),this.getPageState().getApplication(),l.ModelType.PAGE_STATE,t);try{await u.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&s.logService.error(`Error when refreshing page state as ${e}!`,void 0,t)}}getWidgetsForPage(e){return this.getPageState().getWidgets().filter(t=>t.getSlotConfiguration().page===e)}async loadMoreData(){const e={strategy:c.ModelRefreshStrategy.LOAD_MORE_CONTENT},t=a.modelRefreshDecoratorFactory.getDecorator(this.getPageState(),this.getPageState().getApplication(),l.ModelType.PAGE_STATE,e);try{await u.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when loading widgets of grid page !",void 0,e)}}getActivePage(){return this.gridPageCollection.getCurrentPage()}getGridPages(){return this.gridPageCollection.getPages()}initItemSelectionForGrid(e){e.getConfiguration().gridItemOptions.selectable&&(void 0!==this.itemsSelectionToken&&this.itemsSelectionToken.cancel(),this.itemsSelectionToken=new o.CancellationToken,this.itemsSelectionToken.addDomEvent($(document),"keyup",e=>this.handleKeyUp(e)))}handleKeyUp(e){if(27===e.keyCode){const e=this.getActivePage().getGrid().getSelectedItem();void 0!==e&&e.selected&&(this.getActivePage().getGrid().unselectItem(e),this.$scope.$$phase||this.$scope.$apply())}}getPageState(){return void 0!==this.pageState?this.pageState:r.mainApplication.getPageState()}};f=__decorate([i.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],f)}),define("components/help/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",scope:{iconType:"=",gray:"=?",link:"=?",action:"=?"},templateUrl:i.templateSourceFactory("components/help")}}]}),define("components/icon/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["DirectiveWrapper",function(e){function t(i){e.call(this,i,t)}return t.$inject=["$scope"],t.prototype=i.extend(Object.create(e.prototype),{$scope:function(e){return{getIcon:function(){return this.model&&this.model[this.state||"default"]}}}}),{restrict:"E",scope:{model:"=",state:"=?"},controller:t,templateUrl:n.templateSourceFactory("components/icon")}}]}),define("components/image_bounding_box/directive",["require","exports","underscore","classes/application/application","classes/bounding_box/bounding_box","reusable_utilities","services/template_source","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=a.resourcesService.getImageUrl(c.ImageResource.deadlinkPng),d=n.mainApplication;t.default=["DirectiveWrapper","$timeout",function(e,t){function n(t,i){this._initialize(t,i),e.call(this,t,n,i)}return n.$inject=["$scope","$element"],n.prototype=i.extend(Object.create(e.prototype),{$scope:function(e){return{handleImageError:function(n){const s=this;n.hide(),t(function(){if(!i.isUndefined(e.imageFallback)&&!i.isUndefined(e.container)&&!i.isUndefined(e.canvasElement)){e.container.addClass("img-error-style"),e.canvasElement.remove(),e.imageFallback.show();const t=s.onError&&s.onError();t&&t()}},0,!1)}.bind(this)}},_initialize:function(e,t){this.container=t,this.canvasElement=t.find("canvas"),this.imageFallback=t.find(".fallback")}}),{replace:!0,restrict:"EA",scope:{entry:"=",onError:"&?"},controller:n,link:function(e,t){let n,r;t=$(t);const a=function(i){if(d.isIdle()||setTimeout(function(){a(i)},500),r.attr("src")===l)return;const n=r.outerWidth(),c=r.outerHeight();if((0===n||0===c)&&i<3)setTimeout(function(){a(i+1)},500);else{!function(i,n,r){if(i-=r.left+r.right,n-=r.top+r.bottom,e.entry.hasBoundingBoxes()){const a=t.find("canvas");a.attr("width",i),a.attr("height",n);const c=r.top+"px "+r.right+"px "+r.bottom+"px "+r.left+"px ";a.css("padding",c);const l=a[0].getContext("2d");e.entry.getBoundingBoxes().forEach(function(e){const t=new s.BoundingBox(e,i,n),r=t.getBounds(),a=new o.Color("#E74C3C");l.lineWidth=t.getLineWidth(),l.strokeStyle=a.toRGBAString(),l.fillStyle=a.setAlpha(.16).toRGBAString(),l.beginPath(),l.rect(r.x,r.y,r.w,r.h),l.fill(),l.stroke()})}}(n,c,{top:parseInt(r.css("padding-top"))||0,right:parseInt(r.css("padding-right"))||0,bottom:parseInt(r.css("padding-bottom"))||0,left:parseInt(r.css("padding-left"))||0})}};(r=t.find("img.thumbnail")).complete?a(1):n=r.on("load",function(){a(1)}),e.$on("$destroy",function(){i.isUndefined(n)||r.off("load",n)})},templateUrl:r.templateSourceFactory("components/image_bounding_box")}}]}),define("components/influencer/directive",["require","exports","underscore","reusable_services","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","$timeout"],{replace:!0,restrict:"EA",scope:{influencer:"=",loaded:"="},controller:e,link:function(e,t,i){e.redrawWidget()},templateUrl:s.templateSourceFactory("components/influencer")};function e(e,t,s){let o,r;const a=n.emojiService;e.redrawWidget=function(){e.loaded=!1,(o=t.find("img.avatar")).complete?e.loaded=!0:r=$(o).on("load error",function(){s(function(){e.loaded=!0},0)})},e.handleImageError=function(t){t.hide(),e.showDefaultAvatar=!0,s(function(){e.loaded=!0},0)},e.parseTextForEmoji=function(e){return a.parseTextForEmoji(e)},e.$on("$destroy",function(){i.isUndefined(r)||i.isUndefined(o)||$(o).off("load error",r)})}}]}),define("components/influencer/card/directive",["require","exports","underscore","reusable_services","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","$timeout"],{replace:!0,restrict:"EA",scope:{influencer:"="},controller:e,link:function(e,t,i){e.redrawWidget()},templateUrl:s.templateSourceFactory("components/influencer/card")};function e(e,t,s){let o,r;const a=n.emojiService;e.getCardIcon=function(){return e.influencer.isMostActiveAuthor()?"icon2-tw-most-active-author-3":e.influencer.isMostInfluentialAuthor()?"icon2-tw-most-influ-author":e.influencer.isMostActiveSite()?"icon2-tw-most-active-site-3":e.influencer.isMostInfluentialSite()?"icon2-tw-most-influ-site":void 0},e.parseTextForEmoji=function(e){return a.parseTextForEmoji(e)},e.redrawWidget=function(){e.influencer.hasInfluencerConfig()?e.influencer.setLoaded(!0):(e.influencer.setLoaded(!1),(o=t.find("img.avatar")).complete?e.influencer.setLoaded(!0):r=$(o).on("load",function(){e.influencer.setLoaded(!0)}))},e.handleImageError=function(t){t.hide(),e.showDefaultAvatar=!0,s(function(){e.influencer.setLoaded(!0)},0)},e.$on("$destroy",function(){i.isUndefined(r)&&!i.isUndefined(o)&&$(o).off("load",r)})}}]}),define("components/influencer/list/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{restrict:"EA",scope:{influencers:"=",onClick:"=?",highlightMap:"=?",onMouseEnter:"=?",onMouseLeave:"=?",fixedSlotCount:"=?"},controller:e,link:function(e){},templateUrl:i.templateSourceFactory("components/influencer/list")};function e(e){e.getWidthPerc=function(){return 100/((e.fixedSlotCount||e.influencers.length)>4?4:e.fixedSlotCount||e.influencers.length)+"%"},e.mouseEnter=function(t,i){void 0!==e.onMouseEnter&&e.onMouseEnter(t,i)},e.mouseLeave=function(t,i){void 0!==e.onMouseLeave&&e.onMouseLeave(t,i)},e.canHighlight=function(t){return void 0!==e.highlightMap&&e.highlightMap[t.id]},e.clickInfluencer=window.isExport?_.noop:function(t,i){void 0!==e.onClick&&t.isClickable()&&e.onClick(t,i)},e.isClickable=function(t){return!_.isUndefined(e.onClick)&&!window.isExport&&t.isClickable()}}}]}),define("components/influencer/list_widget/directive",["require","exports","underscore","components/tools/data_graph","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","NavigationParams","navigationService","InfluencerProfile"],{replace:!0,restrict:"E",scope:{widget:"=",fragment:"="},controller:e,templateUrl:s.templateSourceFactory("components/influencer/list_widget")};function e(e,t,s,o,r){e.fragment.attach(e,t),e.redrawWidget=function(n){const s=[];return i.each(e.widget.getPayloadValue().influencers,function(t,i){let n;e.widget.hasInfluencersConfiguration()&&(n=e.widget.getInfluencersConfiguration()[i]);const o=new r(t,n);s.push(o)}),e.influencers=s,e.widget.getPageState().isGridPage()&&function(e){const i=e.dimensions.width/1058;t.find(".chart-container").css({"transform-origin":"top left",transform:"scale("+i+")",width:1058})}(n),Promise.resolve()},e.isFullyLoaded=function(){const t=i.every(e.influencers,function(e){return e.isLoaded()});return t&&(e.widget.isFullyLoaded()||setTimeout(function(){e.widget.setFullyLoaded(!0),e.$apply()},1e3)),t},e.getWidthPerc=function(){return 100/(e.influencers.length>4?4:e.influencers.length)+"%"},e.openOverview=function(t,i){const r=new s,a=n.default.constructor.parseFilters(t.getFilters());r.setFilters([a]),r.setWidget(e.widget),r.setClickTarget(i.target),o.clickHandler(r,i.target,t.getRequestedPageType())}}}]}),define("components/influencer/overview/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","InfluencerProfile","$element"],{replace:!0,restrict:"EA",scope:{widget:"=",fragment:"="},controller:e,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/influencer/overview")};function e(e,t,i){e.influencerProfile=new t(e.widget.getPayloadValue().influencer||{}),e.redrawWidget=function(t){e.widget.getPageState().isGridPage()&&e.widget.getPageState().getAllowedPages().isReport()&&function(e){const t=Math.min(e.dimensions.width/1138,e.dimensions.height/340);i.css({"transform-origin":"top left",transform:"scale("+t+")",width:1138})}(t);return $.Deferred().resolve().promise()},e.fragment.attach(e,i)}}]}),define("components/influencer/table/directive",["require","exports","components/tools/data_graph","event_bus","math_utils","reusable_services","classes/navigation/nav_params","services/broker","services/configuration","services/icons","services/navigation","services/tw_common","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","services/refresh/model_refresh_service","log","services/template_source","services/custom_pages","font_saver_service","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","$timeout"],{replace:!0,restrict:"EA",scope:{widget:"=",fragment:"="},controller:e,templateUrl:y.templateSourceFactory("components/influencer/table")};function e(e,t,y){e.fragment.attach(e,t);let w=!1,C=0;function E(t){const i=e.widget.getTableHeader().getColumnById(t);if(void 0!==i)return i.id=t,T(i)?i:void 0}function T(t){return!e.widget.getTableHeader().isMinWidthInvalid(t)}async function M(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:u.ModelRefreshStrategy.REFRESH},i=h.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),p.ModelType.WIDGET,t);try{return await m.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&f.logService.error("Error when refreshing widget!",void 0,e)}}else f.logService.error("reload attempted on widget without page state, this could be due to a memory leak",g.twCommon.logFeatures.WidgetWrapper)}e.sampleDataPopupUrl=BASE_TEMPLATE_URL+"components/influencer/table/sample_data_popup.html",e.eventListeners=[],e.getTableClass=function(t){let i="";if(void 0===e.settings||void 0===e.settings.style.fontSize)i="font-size-normal";else switch(e.settings.style.fontSize){case 0:i="font-size-normal";break;case 1:i="font-size-medium";break;case 2:i="font-size-large";break;case 3:i="font-size-extra-large"}return void 0!==t&&t&&(i+=" fullscreen"),e.isSample&&(i+=" clickable"),i},e.redrawWidget=async function(i){if(e.isEditMode=e.widget.getPageState().isEditMode()||e.widget.getApplication().pageState.getAllowedPages().isReport(),e.settings=i,e.widget.isReloadingWithWidgetStrategy()&&e.widget.setReloadingStrategy(g.twCommon.reloadingStrategy.NONE),e.fragment.cancellationToken.setTimeout(()=>(function(){const i=t.find("table");i&&e.widget&&!e.widget.isDisposed()&&n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:e.widget.getId(),expectedSize:e.settings.dimensions.size,realSize:new s.Vector2D(i.width(),i.outerHeight())}})})(),500),e.updateData(),await async function(){const e=[];for(let t=33;t<127;t++)e.push(String.fromCharCode(t));await S.fontSaverService.saveFont(S.SaveableFontName.RobotoR,e,this)}(),e.widget.hasDataGraph()){(e.widget.getTableBody().getRows()||[]).forEach(i=>{y(function(){const n=t.find("img")[0];if(!n||n.complete)i.loaded=!0;else{const t=$(n).on("load",function(){i.loaded=!0});e.eventListeners.push({element:n,event:"load",listener:t})}},250)})}if(e.isQuickSearch()){const n=t.find("tbody tr");let s=0;n.each(function(){s=Math.max(s,$(this).height())});const o=i.dimensions.height-t.find("thead").height()-30;n.height(Math.min(s,o/n.length)),setTimeout(()=>{n.find(".quicksearch-cell .text-cell").each(function(){const t=$(this);t.width(140);const i=t.find(">div:first-child>span:first-child");let n=i.html();if(t.height()>40){let s=n.length;for(;t.height()>40&&s>0;)s--,n=e.insertHiddenSpan(n.substring(0,s)).trimRight(),i.html(n+"...");i.html(e.insertHiddenSpan(n)+"...")}else i.html(e.insertHiddenSpan(n))})},0)}else e.widget.getPageState().isGridPage()&&e.widget.getPageState().getAllowedPages().isReport()&&function(i){const n=e.widget.getTableBody().getRows().length+1,s=64*n,o=Math.min(i.dimensions.width/1018,i.dimensions.height/s);t.css({"transform-origin":"top left",transform:"scale("+o+")",width:1018})}(i);return await o.fontDetectionService.waitUntilLoaded("RobotoR"),b.waitFor(1e3)},e.isQuickSearch=function(){return e.widget.getPageState().getAllowedPages().isInstantDiscovery()},e.onClick=window.isExport?_.noop:function(t,i,n){e.widget.isClickable()&&d.navigationService.datagraphClick(e.widget.getDataGraph(),e.widget,t,i,n.target)},e.isClickable=function(){return!window.isExport&&e.widget.isClickable()},e.isRowClickable=function(t){return e.isClickable()&&!t.isDrilldownDisabled()},e.onClickShowInfluencers=function(){e.isSampleData&&d.navigationService.goToTrial(!0,"&cta=4")},e.sortTableBy=function(t){if(t.sortable&&!window.isExport){const i=constants.data_table.sorting.DESC;e.widget.sort(t,i),e.widget.isSortReloading()?(e.widget.prepareReload(),M(e.widget)):e.widget.redraw(),a.brokerService.publish(constants.events.influencer_table_view_mode.change)}},e.sortBySentiment=window.isExport?_.noop:function(){let t;t=(w=!w)?e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_positive):e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_negative),e.widget.sort(t,constants.data_table.sorting.DESC),e.widget.isSortReloading()?(e.widget.prepareReload(),M(e.widget)):e.widget.redraw(),a.brokerService.publish(constants.events.influencer_table_view_mode.change)},e.hideColumn=async function(t,i,n){t.preventDefault(),t.stopPropagation();const s=e.widget.getExtendedConfiguration();if(i)s.addHiddenColumn(i.code);else{if(!n)return;s.addHiddenColumn(n)}const o=tw.pageState.getAllowedPages();await v.customPagesService.saveWidget(o.getCustomPageType(),{mapped_id:o.getCustomPageId()},e.widget)},e.isSortedBySentiment=function(){const t=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_positive),i=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_negative);return e.isSortedBy(t)||e.isSortedBy(i)},e.isSortedBy=function(t){return void 0!==t&&(e.widget.isSortedDesc(t.sort)||e.widget.isSortedAsc(t.sort))},e.combineAvatarNameColumns=function(){return e.avatarColumn&&e.influencerNameColumn},e.getColumnClass=function(e){return void 0!==e&&void 0!==e.data_type?"col-"+e.data_type:""},e.getColumnIndex=function(t){return e.widget.getTableHeader().getColumnIndex(t)},e.getCellByIndex=function(e,t){return t.getVisibleCells()[e]},e.getCellForColumn=function(t,i){const n=e.getColumnIndex(t);return n>=0?i.getVisibleCells()[n]:void 0},e.getMediaTypeIcon=function(e){return void 0!==e?l.iconService.getIconForMediaType(e,!0):""},e.getInfluencerName=function(e){if(void 0!==e){const t=e.value_formatted.indexOf(" ("+e.value+")"),i=t>-1?e.value_formatted.substring(0,t):e.value_formatted;return o.emojiService.parseTextForEmoji(i)}return""},e.insertHiddenSpan=function(t){if(e.isQuickSearch())return t;{const e='<span class="tw-hidden-span"> </span>';return t.replace(/[.]+(?![^<]*\>)/g,`.${e}`).replace(/[-]+(?![^<]*\>)/g,`-${e}`)}},e.handleImageError=function(e,t){e.hide(),t.showDefaultAvatar=!0,y(function(){t.loaded=!0},0)},e.getSentimentData=function(t){const n=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_positive),s=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_neutral),o=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_negative),r=[],a=e.getCellByIndex(e.getColumnIndex(n),t),c=e.getCellByIndex(e.getColumnIndex(s),t),l=e.getCellByIndex(e.getColumnIndex(o),t),d=i.default.constructor.parseFilters(t.getFilter()),g=i.default.constructor.parseFilters(n.filter),u=i.default.constructor.parseFilters(s.filter),p=i.default.constructor.parseFilters(o.filter);return r.push({value:Number(a.value),color:n.color,label:n.name,filter:e.isClickable()?[d,g]:void 0,previousValue:a.value_change.is_available?Number(a.value_old):void 0}),r.push({value:Number(c.value),color:s.color,label:s.name,filter:e.isClickable()?[d,u]:void 0,previousValue:c.value_change.is_available?Number(c.value_old):void 0}),r.push({value:Number(l.value),color:o.color,label:o.name,filter:e.isClickable()?[d,p]:void 0,previousValue:l.value_change.is_available?Number(l.value_old):void 0}),r},e.getAbsolutePercentage=function(t,i){const n=e.getCellForColumn(t,i);return void 0!==n&&n.numeric_data/C*100},e.isVisible=function(t){return t&&-1===e.widget.getExtendedConfiguration().getHiddenColumns().indexOf(t.code)},e.canShowPerMention=function(t){if(c.configurationService.getPageConfiguration().canHideInfluencerColums()&&void 0!==e.settings&&void 0!==e.settings.dimensions&&void 0!==e.settings.style&&void 0!==e.settings.style.fontSize)switch(e.settings.style.fontSize){case 0:if(e.settings.dimensions.width<760)return!1;break;case 1:if(e.settings.dimensions.width<790)return!1;break;case 2:if(e.settings.dimensions.width<810)return!1;break;case 3:if(e.settings.dimensions.width<840)return!1}return void 0!==t},e.canShowSentiments=function(){if(c.configurationService.getPageConfiguration().canHideInfluencerColums()&&void 0!==e.settings&&void 0!==e.settings.dimensions&&void 0!==e.settings.style&&void 0!==e.settings.style.fontSize)switch(e.settings.style.fontSize){case 0:if(e.settings.dimensions.width<840)return!1;break;case 1:if(e.settings.dimensions.width<870)return!1;break;case 2:if(e.settings.dimensions.width<960)return!1;break;case 3:if(e.settings.dimensions.width<960)return!1}const t=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_positive),i=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_neutral),n=e.widget.getTableHeader().getSubColumnById(constants.search_data_functions.nb_post_negative);return void 0!==e.postsColumn&&void 0!==t&&T(t)&&void 0!==i&&T(i)&&void 0!==n&&T(n)},e.canShowEmv=function(){return void 0!==e.emvColumn},e.isTendencyAvailable=function(t,i){const n=e.getCellForColumn(t,i);return void 0!==n&&void 0!==n.value_change&&n.value_change.is_available&&!n.value_change.is_old_value_zero},e.drillDownOnInfluencers=window.isExport?_.noop:function(t){const n=new r.NavigationParams,s=i.default.constructor.parseFilters(e.influencerNameColumn.filter);n.setFilters([s]),n.setWidget(e.widget),n.setClickTarget(t.target),d.navigationService.clickHandler(n,t.target,constants.page_type.context_menu_influencer_overview)},e.isFullyLoaded=function(){const t=e.widget.getTableBody().getRows().every(function(e){return e.loaded});return t&&!e.widget.isFullyLoaded()&&y(function(){e.widget.setFullyLoaded(!0)},500,!1),t},e.getMediaTypeLabelForColumn=function(t,i){const n=e.getCellForColumn(t,i);if(void 0!==n&&void 0!==n.value){const e=n.value,t=constants.media_type.group[e.toLowerCase()];if(void 0!==t)return t.name;if(void 0!==constants.media_type[e.toLowerCase()])return constants.media_type[e.toLowerCase()].name}return""},e.getClass=function(t){const i={clickable:e.isClickable()};let n=!1;if(t.meta_data&&t.meta_data.attributes&&t.meta_data.attributes.rendering_instructions){const e=t.meta_data.attributes.rendering_instructions.reference;e&&e.css_class&&(i[e.css_class]=!0,n=!0)}return n||(i["img-circle"]=!0),i},e.isAuthorVerified=(t=>{if(e.avatarColumn){const i=e.getCellForColumn(e.avatarColumn,t);return void 0!==i.meta_data&&(void 0!==i&&!1!==i.meta_data.attributes.author_verified)}return!1}),e.updateData=(()=>{if(e.avatarColumn=e.widget.getTableHeader().getColumnByPredicate(function(e){return"avatar"===e.data_type}),e.colorBarColumn=e.widget.getTableHeader().getColumnByPredicate(function(e){return"color"===e.data_type}),e.influencerNameColumn=E(constants.search_data_functions.influencer),e.sourceTypeColumn=E(constants.search_data_functions.source_type),e.postsColumn=e.widget.getTableHeader().hasSubColumn(constants.search_data_functions.nb_post_total)?function(t){const i=e.widget.getTableHeader().getSubColumnById(t);if(void 0!==i)return i.id=t,T(i)?i:void 0}(constants.search_data_functions.nb_post_total):E(constants.search_data_functions.nb_post_total),e.reachColumn=E(constants.search_data_functions.reach_author),e.avgReachPerMentionColumn=E(constants.search_data_functions.avg_reach_per_mention),e.engagementColumn=E(constants.search_data_functions.engagement_author),e.engagementPerMentionColumn=E(constants.search_data_functions.avg_engagement_per_mention),e.emvColumn=E(constants.search_data_functions.campaign_emv),e.firstUseColumn=E(constants.search_data_functions.published_timestamp),e.auxipressAve=E(constants.search_data_functions.auxipress_ave),e.pmgAve=E(constants.search_data_functions.pmg_ave),e.pmgBrandgroup=E(constants.search_data_functions.pmg_brandgroup),C=0,e.widget.hasDataGraph()){e.isSampleData=e.widget.getDataGraph().sample_data||!1,e.widget.getTableBody().getRows().forEach(function(t){if(void 0!==e.postsColumn){const i=e.getCellForColumn(e.postsColumn,t).numeric_data;i>C&&(C=i)}})}}),e.getColor=function(t){return e.getCellForColumn(e.colorBarColumn,t).value.split(";")},e.getPostsColumnName=function(){return void 0!==e.postsColumn.parent?e.postsColumn.parent.name:e.postsColumn.name},e.fragment.cancellationToken.registerCleanupFunction(e.$watch(()=>e.widget.getTs()+":"+e.widget.getWidth(),(t,i)=>{t!==i&&e.updateData()})),e.$on("$destroy",()=>(function(){S.fontSaverService.freeFont(S.SaveableFontName.RobotoR,this)})())}}]}),define("components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filters_controller",["require","exports","react_components/filter_menu/default_filter_menu_controller","components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filter_menu_adapter"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignInfluencersFiltersController=class extends i.DefaultFilterMenuController{constructor(e){super(e,n.CampaignInfluencersFilterMenuAdapter)}}}),define("components/influencers_list_mgmt/campaign_influencers/controllers/campaign_influencers_filter_bar_controller",["require","exports","react_components/filter_menu/default_filter_bar_controller"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.CampaignInfluencersFilterBarController=class extends i.DefaultFilterBarController{saveChanges(){}overwriteMenuCallbacks(e){}}}),define("components/kpi/directive",["require","exports","underscore","services/template_source","canvas_engine","classes/canvas_engine/core/models/kpi_model","classes/canvas_engine/settings/charts/kpi_chart_settings","services/tw_common","classes/canvas_engine/core/entities/charts/kpi_chart"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$element","$scope","$timeout"],{replace:!0,restrict:"EA",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:e,link:function(e){e.$on("$destroy",function(){i.forEach(e.timeouts,function(t){void 0!==t&&e.timeoutClass.cancel(t)}),e.loaded=!1,e.destroyChart()})},templateUrl:n.templateSourceFactory("components/kpi")};function e(e,t,n){t.timeoutClass=n,t.id=t.widget.getDic().widget_id,t.isAnimated=!1,t.currentFrame=-1,t.timeouts=[],t.fragment.attach(t,e),t.getTimeline=function(){return t.widget.hasReplayManager()?t.widget.replayManager.timeline:void 0},t.destroyChart=function(){i.isUndefined(t)||i.isUndefined(t.stage)||(t.stage.dispose(),t.stage=void 0)},t.redrawWidget=function(n){let l,d=t.getTimeline();const g=function(t){const i=e.find("canvas");i.width(t.dimensions.width),i.height(t.dimensions.height);const n=Math.round(Math.max(.24*t.dimensions.height,2.33)),o=t.dimensions.width,r=Math.min(t.dimensions.height,Math.max(.5*o,220)+n);return{width:o,height:r,radius:s.Utilities.clamp(.95*r-n,0,.5*o*.95),minFontSize:1}}(n);let u;if(!i.isUndefined(t.chart)&&i.isUndefined(d))return l=new o.KpiModel(t.widget.getDataGraph(),t.widget),t.chart.getChartSettings().enableInitialAnimation(!1),t.chart.switchModel(l,n),t.chart.updateDimensions(g),$.Deferred().resolve().promise();{t.destroyChart();const i=e.find("canvas")[0];l=new o.KpiModel(t.widget.getDataGraph(),t.widget);const p=s.Stage.build(i,g.width,g.height,60,{layerAmount:1,relayEvents:[s.Constants.StageEvents.MouseWheel],scale:n.style.resolutionScale});t.stage=p.stage,(u=new s.Presence(0,0,s.Constants.Origin.TOP_LEFT)).setStyle(s.Style.Width,g.width).setStyle(s.Style.Height,g.height).setStyle(s.Style.Radius,g.radius);const h=new r.KpiChartSettings(l);return t.chart=new c.KpiChart(u,t.widget,h,n,g.minFontSize),p.scene.addChild(t.chart),t.loaded||(h.setTransitionDuration(n.animationDuration),h.enableInitialAnimation(n.animationStrategy!==a.twCommon.visualizationInitializationStrategy.INSTANT)),d&&d.onLoseInitialState.subscribeOnce(function(){t.chart.syncTimeline(d)}),t.stage.getCameras().forEach(function(e){e.disableTranslation(),e.disableZoom()}),t.chart.isDisposed()||t.chart.playInitialAnimation(),t.stage.start(),t.chart.updateDimensions(g),t.stage.onDrawEnd.subscribeOnceAsPromise()}}}}]}),define("components/legend/icon/directive",["require","exports","services/template_source","canvas_engine","reusable_utilities"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{restrict:"E",scope:{series:"=",orientation:"=",state:"=",inactiveColor:"=?"},controller:e,templateUrl:i.templateSourceFactory("components/legend/icon")};function e(e){e.state=e.state||n.Constants.Velocity.State.Inactive,e.inactiveColor=e.inactiveColor||s.Color.GREY().toHex6()}}]}),define("components/legend/widget/directive",["require","exports","underscore","reusable_services","services/template_source","reusable_utilities"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope"],{restrict:"E",scope:{series:"=",orientation:"=",label:"=?"},controller:e,templateUrl:s.templateSourceFactory("components/legend/widget")};function e(e){e.isLineChart=(e=>e.isLineChart),e.isBarChart=(e=>e.isBarChart),e.isOtherChart=(t=>!e.isBarChart(t)&&!e.isLineChart(t)),e.isDotted=function(t){return(e.isBarChart(t)||e.isLineChart(t))&&t.style&&!!t.style.strokeDashArray},e.getDottedFillColor=function(e){return e.dotted_color||(e.dotted_color=new o.Color(e.color).clone().fadeOut(60).toRGBAString()),e.dotted_color},e.getDottedStrokeColor=function(e){return e.stroke_color||(e.stroke_color=new o.Color(e.color).clone().darken(60).toRGBAString()),e.stroke_color},e.getLabel=function(){return e.hasLabel()&&e.label+":"},e.hasLabel=function(){return!i.isUndefined(e.label)&&!!e.label.trim()},e.parseTextForEmoji=function(e){return!i.isUndefined(e)&&e.length>0?n.emojiService.parseTextForEmoji(e):""},e.useCutoffLabels=function(e){return e.isLegendAutoRenamed}}}}),define("components/lines/directive",["require","exports","angular","d3","underscore","canvas_chart_utilities","log","reusable_utilities","widget_base","components/form/common/graph_helper","components/tools/data_graph","services/bubble_dialog","services/configuration","services/navigation","services/tw_common","other/tw","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"E",bindToController:{area:"=",widget:"=",fragment:"=",mediator:"="},controllerAs:"vm",controller:f,templateUrl:_.templateSourceFactory("components/lines")}};class f{constructor(e,t,i,n){this.$element=e,this.$timeout=t,this.$scope=n,this.GraphSlicer=i}$onInit(){r.logService.debug("line chart controller constructor",h.twCommon.logFeatures.Widget),this.fragment.attach(this,this.$element),this.fragment.cancellationToken.registerCleanupFunction(()=>l.clearCommentBubbles(this.getBubbleDialogConfig())),this.mediator.listen(c.REPLAY_ACTIONS.PROGRESS,this.updateCurtain.bind(this)),this.initSvg(),this.configureGraphSlicer()}getFontSize(){if(void 0===this.settings)return"font-size-normal";switch(this.settings.style.fontSize){case c.FontSize.SMALL:return"font-size-normal";case c.FontSize.MEDIUM:return"font-size-medium";case c.FontSize.LARGE:return"font-size-large";case c.FontSize.EXTRA_LARGE:return"font-size-extra-large"}}getBubbleDialogConfig(){return{service:g.bubbleDialogService,styleService:u.configurationService.getBubbleDialogConfiguration(),styleType:constants.bubble_dialog.id.lines,menuStyle:u.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.context_menu).setArrowSide(h.twCommon.sides.TOP).setAbsoluteXOrigin(h.twCommon.sides.CENTER).setAbsoluteYOrigin(h.twCommon.sides.TOP)}}configureGraphSlicer(){u.configurationService.getPageConfiguration().canDrillDown(this.widget.getPageState())&&!0!==window.isExport&&(this.graphSlicer=new this.GraphSlicer(this.$element),this.fragment.cancellationToken.addDomEvent(this.$element,"mousemove",this.moveSelection.bind(this)),this.fragment.cancellationToken.addDomEvent($(document),"mouseup",this.releaseSelection.bind(this)),this.fragment.cancellationToken.addDomEvent($(document),"keydown",this.cancelSelection.bind(this)),this.fragment.cancellationToken.registerCleanupFunction(()=>{this.$element.off(),this.graphSlicer.dispose()}))}getRenderingData(e,t,i,n,s,o,r,a){const c=new l.Points(e.items,t,i,s,o,{comments:r,widgetId:a,options:l.createCommentsDropdownMenu(this.widget,void 0,!1,this.pointClick.bind(this),this.commentClick.bind(this)),onClick:this.commentClick.bind(this)});let d;d=o.isAdaptiveLegend?i.limits.min<0?i.limits.max:i.limits.min:0,e.renderingData={points:c,color:e.metaData.color,scaledBottom:n.graph.bottom-i.isCrossingZero?i.scale(d):0}}recalculateDimensions(e,t=!1,i=!1){return new l.Dimensions(e.dimensions.width,60,30,e.dimensions.height,0,!0,t,i)}showWithTransition(e){s.each(e,e=>{if(void 0!==e){const t=l.getSelection(e.elem);t.style("pointer-events",""),l.showElement(t)}})}hideWithTransition(e){s.each(e,e=>{if(void 0!==e){const t=l.getSelection(e.elem);t.style("pointer-events","none"),l.hideElement(t)}})}showWithoutTransition(e){s.each(e,e=>{if(void 0!==e){const t=l.getSelection(e.elem);"1"!==t.style("opacity")&&t.style("opacity",1)}})}setOpacity(e,t){s.each(t,t=>{void 0!==t&&l.transitionStyle(t.elem,"opacity",e,300)})}handleLineFade(e,t,i){void 0===this.activeID?s.each(e,(e,i)=>{this.setOpacity(1,[e,t[i]])}):s.each(e,(e,i)=>{i!==this.activeID?this.setOpacity(.2,[e,t[i]]):this.setOpacity(1,[e,t[i]])})}setMediatorListeners(e,t,i){void 0!==this.token&&this.token.cancel(),this.token=new a.CancellationToken,this.mediator.listen(o.LegendFragmentActions.LEGEND_MOUSEENTER,n=>{this.activeID=n,this.handleLineFade(e,t,i)},{token:this.token}).listen(o.LegendFragmentActions.LEGEND_MOUSELEAVE,n=>{this.activeID===n&&(this.activeID=void 0),this.handleLineFade(e,t,i)},{token:this.token}).listen(o.LegendFragmentActions.LEGEND_MOUSECLICK,n=>{this.clickedID===n?(s.each(e,(e,n)=>{this.showWithTransition([e,t[n],i[n]])}),this.clickedID=void 0):s.each(e,(e,s)=>{s!==n?this.hideWithTransition([e,t[s],i[s]]):(this.clickedID=n,this.showWithTransition([e,t[s],i[s]]))})},{token:this.token})}redrawWidget(e){if(this.activeID=void 0,this.clickedID=void 0,this.settings=e,l.clearCommentBubbles(this.getBubbleDialogConfig()),this.payload=this.widget.getPayloadValue(!0),this.conf=this.widget.getDic().primary_source,this.id=this.widget.getDic().widget_id,this.width=this.widget.getDic().width,i.isDefined(this.graphSlicer)&&this.graphSlicer.clear(),i.isDefined(this.conf.tw_data_source.x_axis)){const t=this.widget.hasExtendedConfiguration()&&this.widget.getExtendedConfiguration().hasYAxisConfiguration(),n=this.widget.hasExtendedConfiguration()&&this.widget.getExtendedConfiguration().hasXAxisConfiguration(),r=t&&this.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisType()===constants.axis_type.truncate_min_max,c=t&&this.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisType()===constants.axis_type.logarithmic,p=n&&this.widget.getExtendedConfiguration().getXAxisConfiguration().hideLabels(),h=t&&this.widget.getExtendedConfiguration().getYAxisConfiguration().hideLabels(),_={isAdaptiveLegend:this.conf.tw_data_source.adaptive_legend,timeInterval:this.conf.tw_data_source.x_axis.time_interval,isInPercent:this.conf.tw_data_source.resulting_values_in_percentage,isTranslated:this.widget.isTranslateAll(),isLineChart:!0,truncateScale:r,logarithmicScale:c,isLegendAutoRenamed:!1,fontScale:this.getFontScale()},f=new d.default(this.payload.data_graph);this.isSampleData=f.sample_data||!1;const y=f.getColumns(),v=f.getEvents(),S=l.getStep(y.length,_.timeInterval,this.width),b=f.extractData(),w=s(b).chain().pluck("extent").flatten().value(),C=m.tw.project_id;this.dimensions=this.recalculateDimensions(e,p,h),i.isDefined(this.graphSlicer)&&(this.graphSlicer.setStartingPoint(this.dimensions.graph.left),this.graphSlicer.setEndingPoint(this.dimensions.graph.right));const E=new l.getSecondaryAxisData(w,this.dimensions,this.width,"left",_);this.mainAxisData=new l.getMainAxisData(y,this.dimensions,S,_);const T=Math.floor(e.dimensions.width/l.getAxisLegendWidthFromVirtualNode(this.mainAxisData,"tick",this.getFontSize()));if(void 0!==T&&T<this.mainAxisData.axis.tickValues().length){const e=l.getStep(y.length,_.timeInterval,T);this.mainAxisData=new l.getMainAxisData(y,this.dimensions,e,_)}i.forEach(b,e=>{this.getRenderingData(e,this.mainAxisData,E,this.dimensions,f.total_label,_,f.getCommentsWithMarkers(),this.widget.getId())});const M=b.map(e=>e.renderingData);M.configurationService=u.configurationService,M.bubbleDialogService=g.bubbleDialogService,this.chart.attr({width:this.dimensions.canvas.width,height:this.dimensions.canvas.height}),this.mainAxisData.scaledValuesMap=this.mainAxisData.labelMap.keys().reduce(this.mapKeyToScale.bind(this),{}),p||l.drawXGrid(this.canvases.grid,this.mainAxisData,this.dimensions),l.drawYGrid(this.canvases.grid,E,this.dimensions,!1,!1,!1,h),l.drawNewDaySeparators(this.canvases.grid,y,this.mainAxisData,this.dimensions,_),l.drawEvents(this.canvases.grid,v,y,this.mainAxisData,this.dimensions,_),this.chart.style("pointer-events","");let P={};this.area&&(P=l.drawAreas(this.canvases.areas,M));const D=l.drawLines(this.canvases.lines,M),A=l.drawPoints(this.canvases.points,M,this.getBubbleDialogConfig(),this.widget.isClickable(),this.pointClick.bind(this),(e,t)=>{this.mediator.dispatch(o.LegendFragmentActions.WIDGET_MOUSEENTER,t.popoverData.node.rowCode)},(e,t)=>{this.mediator.dispatch(o.LegendFragmentActions.WIDGET_MOUSELEAVE,t.popoverData.node.rowCode)});return s.each(D,(e,t)=>{this.showWithoutTransition([e,P[t],A[t]])}),this.setMediatorListeners(D,P,A),this.shouldDrawCutoffs()&&l.drawCutoffs(this.canvases.cutoffs,M,this.mainAxisData,this.dimensions,!1,C),l.drawBaseline(this.canvases.grid,E.scale,this.dimensions,void 0,_),f.hasComments()?l.commentsFullyLoaded(this.widget):a.waitFor(500)}}mapKeyToScale(e,t){return e[parseFloat(this.mainAxisData.scale(t))]=t,e}getFontScale(){switch(this.settings.style.fontSize){case c.FontSize.SMALL:return 1;case c.FontSize.MEDIUM:return 1.5;case c.FontSize.LARGE:return 2;default:throw new Error("Font size not supported")}}pointClick(e){!0!==window.isExport&&l.pointClick(e,p.navigationService,this.widget,this.widget.isClickable(),this.$element)}commentClick(e){!0!==window.isExport&&l.commentClick(e,p.navigationService,this.widget,!0)}startSelection(e){!m.tw.pageState.isEditMode()&&this.widget.isClickable()&&void 0!==this.graphSlicer&&this.graphSlicer.startSlice(e,this.widget)}moveSelection(e){!m.tw.pageState.isEditMode()&&this.widget.isClickable()&&void 0!==this.graphSlicer&&this.graphSlicer.updateSlice(e)}releaseSelection(e){!m.tw.pageState.isEditMode()&&this.widget.isClickable()&&void 0!==this.graphSlicer&&this.graphSlicer.endSlice(e)}cancelSelection(e){m.tw.pageState.isEditMode()||e.keyCode!==h.twCommon.keys.ESCAPE||this.graphSlicer.cancel()}initSvg(){this.chart=n.select(this.$element[0]).append("svg").classed("chart",!0),this.canvases=s({defs:this.chart.append("defs")}).extend(["grid","areas","lines","points","cutoffs","labels"].reduce(this.createSvgGroup.bind(this),{})),this.canvases.defs.append("mask").append("rect").classed("curtain",!0),this.canvases.grid.append("g").classed({axis:!0,"x-axis":!0}),this.canvases.grid.append("g").classed({axis:!0,"y-axis":!0,left:!0}),this.canvases.grid.append("g").classed({axis:!0,baseline:!0}).append("line")}createSvgGroup(e,t){return e[t]=this.chart.append("g").classed(t,!0),e}updateCurtain(e){if(this.widget.hasReplayManager()){const t=this.payload.data_graph.column_groups,i=Math.floor((t.length-1)*e.progress),s=t[i].data_columns[0].code;this.canvases.points.selectAll("g.serie").selectAll(".point").each(function(e,t){n.select(this).style("display",t<i?"inline":"none")}),this.canvases.defs.select("mask").attr("id","curtain-"+this.id).select(".curtain").attr({x:this.dimensions.bleed.left,y:0,fill:"white",height:this.dimensions.canvas.height,width:this.mainAxisData.scale(s)-this.dimensions.bleed.left}).style("transition","all 25ms linear"),this.canvases.lines.attr("mask","url(#curtain-"+this.id+")"),this.canvases.areas.attr("mask","url(#curtain-"+this.id+")"),this.canvases.points.attr("mask","url(#curtain-"+this.id+")")}else this.canvases.defs.select("mask").attr("id","curtain-"+this.id).select(".curtain").attr({fill:"none",width:0,height:this.dimensions?this.dimensions.canvas.height:0}).style("transition","all 200ms linear"),this.canvases.lines.attr("mask",void 0),this.canvases.areas.attr("mask",void 0),this.canvases.points.attr("mask",void 0)}shouldDrawCutoffs(){return!this.widget.getPageState().getAllowedPages().isCommandCenterScreen()}}f.$inject=["$element","$timeout","GraphSlicer","$scope"],t.LineChartController=f}),define("components/link/directive",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$element","$window"],{restrict:"A",scope:{url:"="},controller:e};function e(e,t,i){function n(t){(2===t.which||1===t.which&&(t.ctrlKey||t.metaKey))&&(t.stopImmediatePropagation(),t.preventDefault(),i.open("","_blank").location.href=e.url)}t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})}}}),define("components/message/directive",["require","exports","classes/context_data/context_data","angular_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[()=>({replace:!1,restrict:"A",scope:!1,link:(e,t)=>{const s=t.attr("tw-message");let o=(t.attr("params")||"").split(",");o=n.directiveService.interpolateParams(o,e);const r="true"===t.attr("html"),a=t.attr("as-attribute"),c=i.contextData.getMessage(s,o||[]);r?t.html(c):void 0!==a?t.attr(a,c):t.text(c)}})]}),define("components/message_diffusion/directive",["require","exports","underscore","services/bubble_dialog","classes/bubble_dialog/widget_dialog_config","canvas_engine","classes/canvas_engine/core/entities/charts/message_diffusion/message_diffusion","data_structures","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout","DirectiveWrapper","InfluencerProfile",function(e,t,l){function d(n,s){t.call(this,n,d,s),e(i.noop,1e3)}return d.$inject=["$scope","$element"],d.prototype=i.extend(Object.create(t.prototype),{$scope:function(e){return this.fragment.attach(this,this.$element),{messageDiffusionChart:void 0,stage:void 0,showChart:function(){return!0},showOnlyChart:function(){try{return this.widget.getMenu().getCompatibleDataTypes().getFirstSelectedEntry().getMappedId()===constants.data_type.message_diffusion_entries_data_type}catch(e){return!1}},openInfluencer:function(e){const t=new s.WidgetDialogConfig(tw.pageState);t.setPageType("CONTEXT_MENU_INFLUENCER_OVERVIEW"),t.setMode("SINGLE_PAGED"),t.setShowCompareBar(!1),t.setFilters(e.getFilters()),t.setReuseActiveBubbleIfAble(!0),n.bubbleDialogService.createWidgetDialogBubble(t)},$destroy:function(){void 0!==this.stage&&this.stage.dispose()},destroyMessageDiffusion:function(){void 0!==this.stage&&this.stage.dispose()},showInfluencerList:function(){return!1},isIterationMode:function(){return"VIEW_BY_ITERATION"===this.widget.getMenu().getViewModeMenu().getFirstSelectedEntry().getMappedId()},authorMouseEnter:function(t){e.$scope.messageDiffusionChart.highlightPlotsByAuthorId(t.getId())},redrawWidget:function(e){let t;if(this.destroyMessageDiffusion(),this.showChart()){const i=e.dimensions.width;let n;n=this.showOnlyChart()?e.dimensions.height:e.dimensions.width<1040?e.dimensions.height-225:e.dimensions.height-115;const s=this.$element.find("#chartCanvas")[0],c=o.Stage.build(s,i,n,60,{layerAmount:2,relayEvents:[o.Constants.StageEvents.MouseWheel],scale:e.style.resolutionScale});this.scene=c.scene,this.stage=c.stage,this.camera=c.camera,this.camera.disableTranslation(),this.stage.start(),this.messageDiffusionChart=new r.MessageDiffusion(o.Presence.zero(this.scene.getPresence()),new a.NetworkModel(this.widget.getPayloadValue()),this.widget,this.stage.getWidth(),this.stage.getHeight(),this.isIterationMode(),e),this.scene.addChild(this.messageDiffusionChart),t=this.stage.getFacade().onDrawEnd.subscribeOnceAsPromise()}else t=$.Deferred().resolve().promise();const n=[];return i.each(this.widget.getPayloadValue().leaders,function(e){n.push(new l(e))}),this.leaders=n,this.leaderHighlights=this.messageDiffusionChart.getHighlightedAuthors(),t}}}}),{replace:!0,restrict:"EA",scope:{widget:"=",mediator:"=",fragment:"=?"},controller:d,templateUrl:c.templateSourceFactory("components/message_diffusion")}}]}),define("components/message_diffusion/popup/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/message_diffusion/popup"),compile:function(){return{pre:n,post:s}}};function t(e,t){e.call=function(t,i){t.call(e,i)},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)}}function n(e,t){t.css({opacity:"0"})}function s(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/metric/list/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["DirectiveWrapper","$window",function(e,t){function s(n){e.call(this,n,s),n.mouseEnter=function(e){i.isUndefined(n.mouseEnterDelegate)||n.mouseEnterDelegate(e)},n.mouseLeave=function(){i.isUndefined(n.mouseLeaveDelegate)||n.mouseLeaveDelegate()},n.mouseClick=function(e){t.isExport||i.isUndefined(n.mouseClickDelegate)||n.mouseClickDelegate(e)}}return s.$inject=["$scope"],s.prototype=i.extend(Object.create(e.prototype),{}),{replace:!0,restrict:"EA",scope:{mouseEnterDelegate:"=?",mouseLeaveDelegate:"=?",mouseClickDelegate:"=?",title:"=",metrics:"="},controller:s,templateUrl:n.templateSourceFactory("components/metric/list")}}]}),define("components/metric/multiple/directive",["require","exports","underscore","services/tw_common","log","canvas_engine","widget_base","event","services/template_source","classes/navigation/nav_params","services/navigation","components/tools/data_graph","data_structures"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});const p=s.logService,h=o.Utilities,m=o.Font,_=o.Constants,f=r.WidgetHeightMode;t.default=["DirectiveWrapper","$timeout",function(e,t){function s(t,i){e.call(this,t,s,i),t.fragment.attach(t,i)}return s.$inject=["$scope","$element"],s.prototype=i.extend(Object.create(e.prototype),{$scope:function(e){return{$destroy:function(){e._releaseWatch&&e._releaseWatch()},redrawWidget:function(e){return this.drawSettings=e,this._refresh(),e.animationDuration?(this.setTransitionDuration(e.animationDuration),this.enableInitialAnimation(e.animationStrategy!==n.twCommon.visualizationInitializationStrategy.INSTANT)):this.enableInitialAnimation(!1),(this.widget.getPageState().isGridPage()||e.heightMode===f.FULLSCREEN)&&this.scaleFontSizes(e),t(function(){this._metrics.forEach(function(e){const t=this.getReadyEvent(e);t&&t.fire(this.getValue(e))}.bind(this)),t(function(){this.widget.setFullyLoaded(!0)}.bind(this),0,!1)}.bind(this),0,!1),t()},getMetrics:function(){return this._metrics},formatValue:function(){const e=this;return function(t){return p.info("Formatting value",n.twCommon.logFeatures.MultiMetrics,{val:t,display_in_percent_to_total:e.widget.getDataGraph().display_in_percent_to_total,total_value:e.widget.getDataGraph().total.value}),e.widget.getDataGraph().display_in_percent_to_total&&(t=Math.round(t/Number(e.widget.getDataGraph().total.value)*100)+"%"),t}},getValue:function(e){return e.value},getReadyEvent:function(e){return e.onAnimationReady},setTransitionDuration:function(e){this.transitionDuration=e},getTransitionDuration:function(){return this.animationEnabled&&this.transitionDuration?this.transitionDuration:0},enableInitialAnimation:function(e){this.animationEnabled=e},adaptFontSizes:function(e,t,n){const s={},o=[],r=[];e.forEach(function(e){o.push(h.measureText(this.formatValue()(e.value),n).width),r.push(h.measureText(e.label,n).width)}.bind(this));const a=i.min(o),c=i.min(r),l=t.width/e.length-20*e.length,d=a/100,g=Math.min(l/d,a);s.value=Math.floor(Math.min(.65*t.height,.85*g));const u=c/100,p=Math.min(l/u,c);return s.name=Math.floor(Math.min(.3*t.height,.85*p)),s},scaleFontSizes:function(e){const t=(new m).setFamily(_.Font.Family.Digits).setSize(100);this.fontSizes=this.adaptFontSizes(this.getMetrics(),e.dimensions,t)},getStyle:function(e,t){return{color:e.color,"font-size":t+"px","font-family":_.Font.Family.Digits}},onClick:function(e){if(this.isCickable()){const t=new l.NavigationParams,i=new u.DataGraphWrapper(this.widget.getDataGraph().payloadDataGraph),n=i.getRows()[e.index];let s=g.default.constructor.parseFilters(n.getFilters());const o=i.getColumns()[0];o&&(s=s.concat(o.getFilter()));const r=n.getCells()[0];r&&(s=s.concat(g.default.constructor.parseFilters(r.getCell().filter))),t.setWidget(this.widget),t.setFilters([s]),t.setClickTarget(this.widget.getTemplate()),d.navigationService.clickHandler(t,null,constants.page_type.context_menu_default)}},isCickable:function(){return this.widget.isClickable()},_refresh:function(){this._cleanUpMetricEvents(this._metrics),this._metrics=[],i.each(this.widget.getDataGraph().getRows(),function(e,t){const i=Number(this.widget.getDataGraph().getCell(e,0).value),n=new a.Event;this._metrics.push({index:t,color:e.color,label:e.label,value:i,onAnimationReady:n})}.bind(this))},_cleanUpMetricEvents:function(e){void 0!==e&&e.length>0&&e.forEach(function(e){e&&e.onAnimationReady&&e.onAnimationReady.cancelAll()})}}}}),{replace:!0,restrict:"E",scope:{widget:"=",fragment:"="},controller:s,templateUrl:c.templateSourceFactory("components/metric/multiple")}}]}),define("components/metric/single/directive",["require","exports","services/tw_number_formatter","services/tw_common","canvas_engine","widget_base","log","data_structures","classes/context_data/context_data","event","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d){return["DirectiveWrapper","$timeout","tendencyFilter",function(e,t,g){function u(t,i){e.call(this,t,u,i),t.fragment.attach(t,i)}return u.$inject=["$scope","$element"],u.prototype=_.extend(Object.create(e.prototype),{$scope:function(e){this.trendOffset=145,this.elementKeys={value:"value",tendency:"tendency",timeperiod:"timeperiod"},this.cssKeys={family:"font-family",size:"font-size",align:"text-align",left:"left",top:"top",width:"width",minHeight:"min-height"},this.tendencyCss={};const d=this;return this.$watch(function(){return d.$element.find(".tendency-block").height()},function(e){d.$element.find("."+d.elementKeys.value).css(d.cssKeys.minHeight,e)}),{$destroy:function(){e._releaseWatch&&e._releaseWatch()},isTimePeriodBelowMetrics:function(){return this.widget.getPageState().getAllowedPages().isCommandCenter()&&this.isComparisonActive()},isComparisonActive:function(){return constants.project.settings.showComparisonWithPreviousPeriod},getChange:function(){if(!_.isUndefined(this._change))return this._change},getValue:function(){if(!_.isUndefined(this._value))return this._value.value},getChangeMessage:function(){return this._changeMessage},getTransitionDuration:function(){const{animationEnabled:e=!0}=this;return e?this.drawSettings.animationDuration:0},formatValue:function(){const e=this._cell.formatted_value;return function(t){let n=i.twNumberFormatter.getInstance().toDecimal(t);return e.indexOf("%")>-1&&(n+="%"),n}},formatChangeValue:function(){return function(e){const t=new a.Tendency(100+e,100).build();return Object.keys(this.tendencyCss).length>0&&(t.css=this.tendencyCss),g(t)}.bind(this)},setTransitionDuration:function(e){this.transitionDuration=e},enableInitialAnimation:function(e){this.animationEnabled=e},redrawWidget:function(e){this._refresh(),e.animationDuration?(this.setTransitionDuration(e.animationDuration),this.enableInitialAnimation(e.animationStrategy!==n.twCommon.visualizationInitializationStrategy.INSTANT)):this.enableInitialAnimation(!1);const i=(new s.Font).setFamily(s.Constants.Font.Family.Digits).setSize(100);if(this.isTimePeriodBelowMetrics()||e.heightMode===o.WidgetHeightMode.FULLSCREEN||this.widget.getPageState().isGridPage()&&this.isComparisonActive()&&void 0!==this.getChange()&&this.getChange().is_available){const t=this.adaptFontSize(e.dimensions,i);Object.keys(t).forEach(function(e){const n=this.$element.find("."+e);if(n.length)switch(n.css(this.cssKeys.family,i.getFamily()),n.css(this.cssKeys.size,t[e]+"px"),e){case this.elementKeys.value:n.css(this.cssKeys.top,0);break;case this.elementKeys.tendency:this.tendencyCss[this.cssKeys.family]=i.getFamily(),this.tendencyCss[this.cssKeys.size]=t[e]+"px";break;case this.elementKeys.timeperiod:this.isTimePeriodBelowMetrics()&&n.css(this.cssKeys.align,"center");break;default:r.logService.error("Something went wrong and theres an unknown key mixed into the fontsizes object.")}}.bind(this));const n=this.$element.find(".tendency-block");n.css(this.cssKeys.align,"left"),n.css(this.cssKeys.left,"50%"),n.css(this.cssKeys.width,"auto"),this.isTimePeriodBelowMetrics()?n.css(this.cssKeys.top,"2px"):(n.css(this.cssKeys.top,"50%"),n.css("transform","translateY(-50%)"),n.css("-webkit-transform","translateY(-50%)"),n.css("opacity",0),n.css("transition","opacity "+this.getTransitionDuration()+"ms cubic-bezier(0.9, 0.01, 0.95, 0.1)"),setTimeout(function(){n.css("opacity",1)}))}else if(!this.isComparisonActive()||e.heightMode===o.WidgetHeightMode.FULLSCREEN||this.widget.getPageState().isGridPage()){const t={height:.8*e.dimensions.height,width:.8*e.dimensions.width},n=this.getNoCompareTextToMeasure(),o=s.Utilities.measureText(n,i),r=Math.min(t.height,Math.floor(t.width/(o.width/100)));s.ObjectCache.recycleObject(o);const a=this.$element.find("."+this.elementKeys.value);a.css(this.cssKeys.family,i.getFamily()),a.css(this.cssKeys.size,r+"px");const c=a.text();a.text(this.formatValue()(this.getValue())),this.trendOffset=a.width()+35,a.text(c)}else if(this.isComparisonActive()){const t=this.$element.find("."+this.elementKeys.value),n=s.Utilities.measureText(this.getValueFormat(),i),o={height:.95*(e.dimensions.height>0?e.dimensions.height:t.parents(".widget").height()),width:.95*e.dimensions.width},r=o.width/2,a=Math.floor(Math.min(o.height,r/(n.width/100)));t.css(this.cssKeys.size,a+"px");const c=t.text();t.text(this.formatValue()(this.getValue())),this.trendOffset=t.width()+35,t.text(c)}return t()},getNoCompareTextToMeasure:function(){return this.widget.getPageState().isGridPage()&&this.widget.getPageState().getAllowedPages().isReport()?this.formatValue()(this.getValue()):constants.project.settings.useHighPrecisionFormatting?"000000.0K":"000.0K"},adaptFontSize:function(e,t){const i={height:.95*e.height,width:.95*e.width},n={},o=s.Utilities.measureText(this.getValueFormat(),t),r=s.Utilities.measureText("1700.0%",t),a=s.Utilities.measureText(this._changeMessage,t),c=i.width/2;return n[this.elementKeys.value]=Math.floor(Math.min(i.height,this.isComparisonActive()?c/(o.width/100):i.width/(o.width/100))),n[this.elementKeys.tendency]=Math.floor(Math.min(.5*i.height,this.isComparisonActive()?.7*c/(r.width/100):i.width/(r.width/100))),n[this.elementKeys.timeperiod]=Math.floor(Math.min(.35*i.height,this.isComparisonActive()?c/(a.width/100):e.width/a.width)),s.ObjectCache.recycleObjects([o,r,a]),n},getValueFormat:function(){return constants.project.settings.useHighPrecisionFormatting?Math.abs(this.getValue())>=1e9?"0,000,000M":"0,000,000":"000.0K"},getStartValue:function(){return this.lastValue||0},getStartChangeValue:function(){return this.lastChangeValue||0},_refresh:function(){this._cell=this.widget.getDataGraph().getCell(this.widget.getDataGraph().getRow(0),0),_.isUndefined(this._cell)||(_.isNumber(this._cell.numeric_data)?(this._value={value:this._cell.numeric_data,isNumeric:!0},this.lastValue=this._cell.numeric_data,this._change=new a.Tendency(this._cell.numeric_data,this._cell.numeric_data_old).build(),this.lastChangeValue=this._change.value_abs_formatted):(this._value={value:this._cell.formatted_value,isNumeric:!1},this.enableInitialAnimation(!1))),this._setChangeMessage(this),this.onAnimationReady.fire(this.getValue())},_setChangeMessage:function(){const e=this.widget.getDataGraph().getPreviousPeriodMappedId(),t=this.widget.getPageState().getUserFilterSettings().getTimeFilter().getTimeFilterMenu().getEntryByMappedId(e);if(_.isUndefined(t)?this._previous_period_title=void 0:this._previous_period_title=t.getName(),this._change.is_old_value_zero)this._changeMessage=c.contextData.getMessage("_207343",[this._previous_period_title,this.widget.getTitle().toLowerCase()]);else{let e;e=_.isUndefined(this._previous_period_title)?c.contextData.getMessage("_001127"):c.contextData.getMessage("_351182",[this._previous_period_title]),this._changeMessage=e}},onAnimationReady:new l.Event}}}),{replace:!1,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:u,templateUrl:d.templateSourceFactory("components/metric/single")}}]}),define("components/modal/directive",["require","exports","keypress","services/modal","services/template_source","services/broker"],function(e,t,i,n,s,o){function r(e){return{templateUrl:s.templateSourceFactory("components/modal"),restrict:"A",replace:!0,transclude:!0,scope:{modal:"=",handleBlur:"&onBlur",handleEnter:"&onKeyEnter",persistent:"=persistent",fullscreen:"=fullscreen"},link:function(t,s){s=$(s),o.brokerService.publish(constants.events.keypress.disable);const r=s.find(".modal-dialog");let a=new i.Listener;if(t.isExpandWidgetModal=(()=>"WIDGET_EXPAND"===t.modal.type),t.isLargeModal=(()=>t.modal.options&&t.modal.options.size===n.ModalSize.LARGE),t.isMediumModal=(()=>t.modal.options&&t.modal.options.size===n.ModalSize.MEDIUM),t.handleClick=(e=>{0===s.has("[suggestion-box]").length&&!t.persistent&&t.handleBlur&&r.is(":visible")&&!r.is(e.target)&&0===r.has(e.target).length&&(o.brokerService.publish(constants.events.keypress.enable),t.handleBlur({event:e}))}),!t.persistent){const i={keys:"escape",on_release:function(e){!t.persistent&&t.handleBlur&&t.$apply(()=>{o.brokerService.publish(constants.events.keypress.enable),t.handleBlur({event:e})})}},n={keys:"enter",on_release:e=>t.handleEnter({event:e})};e(()=>{a.register_combo(i),a.register_combo(n)}),t.$on("$destroy",()=>{o.brokerService.publish(constants.events.keypress.enable),a.reset(),a.destroy(),a=void 0})}}}}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$timeout"],t.default=r,t.ModalDirective=r}),define("components/modals/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","modalService","bubbleDialogService","$sce"],{replace:!0,restrict:"A",scope:{},controller:e,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/modals")};function e(e,t,n,s){e.formsValid=!0,e.shareDashboardDescription=s.trustAsHtml(window.messages.get("_687418")),e.getModal=function(){return i.last(t.get(),1)},e.cancel=function(e,s){void 0!==s&&s.keepBubbleDialogs||n.destroyAllNonPersistent(),t.dismiss(i.last(t.get()),!1,e)},e.ok=function(e){t.dismiss(i.last(t.get()),!0,e)},e.getAddToSourcePanelDescription=function(e){return!i.isUndefined(e.data.sourceNames)&&e.data.sourceNames.length>1||!i.isUndefined(e.data.authorNames)&&e.data.authorNames.length>1?window.messages.get("_806556"):window.messages.get("_709959")},e.getMailingListsTitle=function(e){return i.isUndefined(e.type)||e.type!==constants.modal.mailing_lists.type.user_access_lists?window.messages.get("_975873"):window.messages.get("_718958")}}}]}),define("components/modals/command_center/base_modal/controller",["require","exports","angular","wrappers/topic_menu/topic_menu_wrapper","notifications","other/tw","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e,t,i,n){this.$element=e,this.$log=t,this.$scope=i,this.restFormService=n,this.formData={title:"",description:""},e.find("input:first").focus(),this.asyncSetup()}getMessage(e){return r.contextData.getMessage(`_${e}`)}handleRequestSuccess(e){s.notificationService.success("Screen successfully cloned",{permanent:!1}),this.ok()}handleRequestError(e){this.$log.warn("request failed",e)}canSelectDifferentProject(){return i.isDefined(this.projectsAllowedToCreateCommandCenters)&&this.projectsAllowedToCreateCommandCenters.getRootEntry().hasChildren()}canSelectDifferentCommandCenter(){return i.isDefined(this.commandCentersForAccount)&&this.commandCentersForAccount.getRootEntry().hasChildren()}static getUrl(e,t,i){return routes.controllers.tw.TWRestForm[e]("project",o.tw.project_id,t,i,"","rform").url}async getProjectsAllowedToCreateCommandCenters(){const e=a.getUrl("get","command_centers_for_account","navigate");return this.restFormService.get(e).then(e=>new n.TopicMenuWrapper(e.projects_allowed_to_create_command_centers)).catch(e=>this.handleRequestError(e))}async getCommandCentersForAccount(){const e=a.getUrl("post","command_centers_for_account","info"),t={projects_allowed_to_create_command_centers:this.projectsAllowedToCreateCommandCenters.containsSelection()?this.projectsAllowedToCreateCommandCenters.topicMenu:void 0};return this.restFormService.post(e,t).then(e=>new n.TopicMenuWrapper(e.command_centers_in_projects)).catch(e=>this.handleRequestError(e))}}a.$inject=["$element","$log","$scope","restFormService"],t.BaseModalController=a}),define("components/modals/add_to_watchlist/directive",["require","exports","services/template_source","components/modals/command_center/base_modal/controller","wrappers/user_filter_settings/user_filter_settings_wrapper","reusable_utilities","canvas_engine"],function(e,t,i,n,s,o,r){function a(){return{templateUrl:i.templateSourceFactory("components/modals/add_to_watchlist"),restrict:"E",replace:!0,scope:!0,controller:c,controllerAs:"vm",bindToController:{ok:"&",cancel:"=",modalData:"=",modalOptions:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.AddToWatchlistDirective=a;class c extends n.BaseModalController{constructor(){super(...arguments),this.issueWatchlistType=constants.topic_menu.TYPE.issue_watchlist,this.shouldDisplayCCSelector=!0,this.filters=[]}$onInit(){this.watchlistTopicMenu=this.createWatchListTopicMenu(),this.initPayload(),this.isUfsProto(this.modalData.ufs)&&(this.modalData.ufs=new s.UserFilterSettingsWrapper(this.modalData.ufs)),this.prepareDisplayedFilters(this.modalData.ufs),this.fetchColorsMenu()}isUfsProto(e){return void 0===e.getPageState}initPayload(){const e=o.TopicEntryUtils.getFirstSelectedChild(this.watchlistTopicMenu.root_entry).mapped_id;if(this.hasModalDataIssues())this.payload={watchlistMappedId:e,issues:[].concat(this.modalData.issues.map(e=>({id:e.id,label:e.issue_name[0].text,description:"",color:"white"})))};else{if(!this.hasIssueAndBrandMappedId())throw new Error("Could not initialize Payload! There where no issues given in the modalData!");{const{issue_mapped_id:t,brand_mapped_id:i}=this.modalData;this.payload={watchlistMappedId:e,issues:[].concat({issue_mapped_id:t,brand_mapped_id:i})}}}}prepareDisplayedFilters(e){e.getFilters().forEach(e=>{const t=e.getSelectedEntriesRecursively();if(!e.isRootEntrySelected()&&t&&t.length>0&&this.shouldDisplayFilter(e)){const i=e.getType();this.filters.push({key:i,header:e.getRootEntry().getName(),values:t})}})}shouldDisplayFilter(e){const t=e.getType();return!(c.filterTypesToHide.includes(t)||this.isSentiment(t)&&e.getRootEntry().isSelected())}async fetchColorsMenu(){try{const e=this.modalData.issues.map(e=>e.issue_mapped_id||e.id),{colors:t,name:i,description:n}=await this.restFormService.postRForm("issue","info",{codes:e});this.colorsTopicMenu=t,1===e.length&&(i&&(this.payload.label=i),n&&(this.payload.description=n))}catch(e){r.logService.error(`Could not fetch colors menu: ${e}`)}}createWatchListTopicMenu(){const e={root_entry:this.modalData.ufs.getTopicMenuByType(this.issueWatchlistType).getEntryByMappedId(constants.root_id.issue_watchlist_all).toProto()};return e.root_entry.children[0].selected=constants.topic_entry.selected.node,e}async clone(){}isFormValid(){if(this.isSingleIssue()){const{label:e}=this.payload;return e&&e.length>0&&this.payload&&void 0!==this.payload.watchlistMappedId}return!0}async handleWatchlistChanged(){this.payload.watchlistMappedId=this.getWatchlistMappedId()}async asyncSetup(){}isSentiment(e){return e===constants.topic_menu.TYPE.sentiment}close(){this.hasModalDataIssues()&&1===this.modalData.issues.length?this.payload.id=this.modalData.issues[0].id:this.hasIssueAndBrandMappedId()&&(this.payload.brand_mapped_id=this.modalData.brand_mapped_id,this.payload.issue_mapped_id=this.modalData.issue_mapped_id),this.ok({payload:this.payload})}getWatchlistMappedId(){return this.modalData.ufs.getTopicMenuByType(this.issueWatchlistType).getFirstSelectedEntryRecursively().getMappedId()}hasModalDataIssues(){return this.modalData&&this.modalData.issues&&0!==this.modalData.issues.length}hasIssueAndBrandMappedId(){return this.modalData&&void 0!==this.modalData.issue_mapped_id&&void 0!==this.modalData.brand_mapped_id}isSingleIssue(){return this.modalData&&this.modalData.issues&&1===this.modalData.issues.length}}c.filterTypesToHide=[constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.predefined_filters]}),define("components/modals/articles/send/directive",["require","exports","services/rest_form_service","other/tw","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o){function r(){return e.$inject=["$scope","$element"],{replace:!0,restrict:"EA",scope:{payload:"=",toggling:"="},controller:e,templateUrl:o.templateSourceFactory("components/modals/articles/send")};function e(e,t){e.send=function(){return i.restFormService.post(routes.controllers.tw.TWRestForm.post("project",n.tw.project_id,"page_state_emailing","send","","rform").url,e.payload)},e.send_action=constants.events.form.action.send,function(){const t=s.contextData.getMessage("_1774526");e.messages={emailsDescription:t,futureDeliveryDescription:s.contextData.getMessage("_693053")}}()}}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$timeout"],t.default=r,t.SendArticlesDirective=r}),define("components/modals/bulletin/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$window"],{replace:!0,restrict:"A",scope:{notification:"="},controller:e,templateUrl:i.templateSourceFactory("components/modals/bulletin")};function e(e,t){if(t.socialMediaAccountCallBack=function(e){t.location.reload()},e.notification.key===constants.bulletin.predefined.token_expires||e.notification.key===constants.bulletin.predefined.token_expired){e.site_codes_to_connect=[],e.site_name=constants.social_media_accounts[e.notification.argument_values_by_key.site].name,e.project_id=tw.project_id;const t=constants.social_media_accounts[e.notification.argument_values_by_key.site];t&&e.site_codes_to_connect.push(t.code)}e.isTokenExpiredShortly=function(e){return e.key===constants.bulletin.predefined.token_expires},e.isTokenExpired=function(e){return e.key===constants.bulletin.predefined.token_expired},e.isImpersonatingUserNotification=function(e){return e.key===constants.bulletin.predefined.impersonating_user}}}]}),define("components/modals/bulletin/impersonate/directive",["require","exports","underscore","services/context","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=n.contextService;t.default=[function(){return e.$inject=["$scope","$element","TopicMenuWrapper","restFormService"],{restrict:"A",scope:{userInfo:"="},controller:e,templateUrl:s.templateSourceFactory("components/modals/bulletin/impersonate")};function e(e,t,n,s){e.toggleUserSettings=function(t){t.stopPropagation(),!0===e.userSettingsShown?e.userSettingsShown=!1:(e.userAccessShown=!1,e.brandingShown=!1,e.recentSearchesShown=!1,e.partnerAccountShown=!1,e.userSettingsShown=!0)},e.toggleUserAccess=function(t){t.stopPropagation(),!0===e.userAccessShown?e.userAccessShown=!1:(e.userSettingsShown=!1,e.brandingShown=!1,e.recentSearchesShown=!1,e.partnerAccountShown=!1,e.userAccessShown=!0)},e.toggleRecentSearches=function(t){t.stopPropagation(),!0===e.recentSearchesShown?e.recentSearchesShown=!1:(e.recentSearchesShown=!0,e.userAccessShown=!1,e.brandingShown=!1,e.partnerAccountShown=!1,e.userSettingsShown=!1)},e.toggleBranding=function(t){t.stopPropagation(),!0===e.brandingShown?e.brandingShown=!1:(e.userSettingsShown=!1,e.userAccessShown=!1,e.recentSearchesShown=!1,e.partnerAccountShown=!1,e.brandingShown=!0)},e.togglePartnerAccount=function(t){t.stopPropagation(),!0===e.partnerAccountShown?e.partnerAccountShown=!1:(e.userSettingsShown=!1,e.userAccessShown=!1,e.recentSearchesShown=!1,e.brandingShown=!1,e.partnerAccountShown=!0)},e.getBranding=function(){return e.userInfoParsed.branding},e.toggleMessageKeyDisplaying=function(e){const t=routes.controllers.tw.TWRestForm.post(o.getCurrentContext().scope,o.getCurrentContext().id,"message_displaying","enable","","rform").url;s.post(t,{enable_message_key_displaying:e})},e.getPartnerAccountInfo=function(){return e.userInfoParsed.partner_account_info},function(){e.userAccessShown=!1,e.userSettingsShown=!1,e.brandingShown=!1,e.recentSearchesShown=!1,e.partnerAccountShown=!1,e.userInfoParsed=JSON.parse(e.userInfo),e.onOffModel=e.userInfoParsed.display_message_keys;const t=e.userInfoParsed.project_user_settings_info;i.isUndefined(t)||(e.recentSearches="",i.each(t.searches,function(t,i,n){e.recentSearches+=t,i<n.length-1&&(e.recentSearches+=", ")}));const s=e.userInfoParsed.project_access_levels;if(!i.isUndefined(s)){if(!i.isUndefined(s.dashboard_permissions)){const t=new n(s.dashboard_permissions);e.dashboardPermissions=t.getFirstSelectedEntryRecursively().getName()}if(!i.isUndefined(s.report_permissions)){const t=new n(s.report_permissions);e.reportPermissions=t.getFirstSelectedEntryRecursively().getName()}if(!i.isUndefined(s.dash_template_category_permissions)){const t=new n(s.dash_template_category_permissions);e.iQAppsPermissions=t.getFirstSelectedEntryRecursively().getName()}if(!i.isUndefined(s.settings_permissions)){const t=new n(s.settings_permissions);e.settingsPermissions=t.getFirstSelectedEntryRecursively().getName()}if(!i.isUndefined(s.analytics_permissions)){const t=new n(s.analytics_permissions);e.analyticsPermissions=t.getFirstSelectedEntryRecursively().getName()}if(!i.isUndefined(s.selected_dashboards)){e.selectedDashboards="";const t=new n(s.selected_dashboards);i.each(t.getSelectedEntriesRecursively(),function(t,i,n){e.selectedDashboards+=t.topicEntry.name,i<n.length-1&&(e.selectedDashboards+=", ")})}if(!i.isUndefined(s.selected_reports)){e.selectedReports="";const t=new n(s.selected_reports);i.each(t.getSelectedEntriesRecursively(),function(t,i,n){e.selectedReports+=t.topicEntry.name,i<n.length-1&&(e.selectedReports+=", ")})}if(!i.isUndefined(s.selected_settings_entities)){e.selectedSettings="";const t=new n(s.selected_settings_entities);i.each(t.getSelectedEntriesRecursively(),function(t,i,n){e.selectedSettings+=t.topicEntry.name,i<n.length-1&&(e.selectedSettings+=", ")})}if(!i.isUndefined(s.selected_dash_template_categories)){e.selectedIQApps="";const t=new n(s.selected_dash_template_categories);i.each(t.getSelectedEntriesRecursively(),function(t,i,n){e.selectedIQApps+=t.topicEntry.name,i<n.length-1&&(e.selectedIQApps+=", ")})}}}()}}]}),define("components/modals/command_center/clone_commandcenter/directive",["require","exports","components/modals/command_center/base_modal/controller","notifications","services/template_source"],function(e,t,i,n,s){function o(){return{templateUrl:s.templateSourceFactory("components/modals/command_center/base_modal"),restrict:"E",replace:!0,scope:!0,controller:r,controllerAs:"vm",bindToController:{ok:"&",cancel:"=",modalData:"=",modalOptions:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.ModalCloneCommandCenterDirective=o;class r extends i.BaseModalController{constructor(){super(...arguments),this.shouldDisplayCCSelector=!1}async clone(){const e=r.getUrl("post","command_center_manage","duplicate"),t={title:this.formData.title,description:this.formData.description,command_center_id:this.modalData.commandcenterMappedId,projects_allowed_to_create_command_centers:this.projectsAllowedToCreateCommandCenters.topicMenu};return this.restFormService.post(e,t).then(e=>{n.notificationService.success("Screen successfully cloned",{permanent:!1}),this.ok({newCommandCenter:e})}).catch(e=>this.handleRequestError(e))}isFormValid(){return this.formController.$valid}async handleProjectChanged(){}async asyncSetup(){this.projectsAllowedToCreateCommandCenters=await this.getProjectsAllowedToCreateCommandCenters()||void 0}}}),define("components/modals/command_center/clone_screen/directive",["require","exports","angular","components/modals/command_center/base_modal/controller","notifications","services/template_source"],function(e,t,i,n,s,o){function r(){return{templateUrl:o.templateSourceFactory("components/modals/command_center/base_modal"),restrict:"E",replace:!0,scope:!0,controller:a,controllerAs:"vm",bindToController:{ok:"&",cancel:"=",modalData:"=",modalOptions:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.ModalCloneCommandCenterScreenDirective=r;class a extends n.BaseModalController{constructor(){super(...arguments),this.shouldDisplayCCSelector=!0}async clone(){const e=a.getUrl("post","command_center_manage","duplicate"),t={title:this.formData.title,description:this.formData.description,screen_to_copy_id:this.modalData.screenData.getMappedId(),command_center_id:this.modalData.commandcenterMappedId,command_centers_in_projects:this.commandCentersForAccount.topicMenu,projects_allowed_to_create_command_centers:this.projectsAllowedToCreateCommandCenters.topicMenu};return this.restFormService.post(e,t).then(e=>{s.notificationService.success("Screen successfully cloned",{permanent:!1}),this.ok({updatedCommandCenter:e})}).catch(e=>this.handleRequestError(e))}isFormValid(){return this.formController.$valid&&i.isDefined(this.commandCentersForAccount)&&this.commandCentersForAccount.containsSelection()}async handleProjectChanged(){if(this.commandCentersForAccount=await this.getCommandCentersForAccount()||void 0,i.isDefined(this.commandCentersForAccount)){const e=this.commandCentersForAccount.getRootEntry().hasEntryByMappedId(this.modalData.commandcenterMappedId);this.commandCentersForAccount.unselectAll(),e?this.commandCentersForAccount.selectEntryByMappedId(this.modalData.commandcenterMappedId):this.commandCentersForAccount.selectFirstSelectableEntry()}this.$scope.$apply()}async asyncSetup(){this.projectsAllowedToCreateCommandCenters=await this.getProjectsAllowedToCreateCommandCenters()||void 0,await this.handleProjectChanged()}}}),define("components/modals/copy_dashboard/directive",["require","exports","classes/application/application","classes/context_data/context_data","classes/custom_pages/custom_page_factory","classes/custom_pages/pages/dashboard_page","services/context","services/custom_pages","wrappers/topic_menu/topic_menu_wrapper","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){function d(){return e.$inject=["$scope","restFormService","$rootScope"],{templateUrl:l.templateSourceFactory("components/modals/copy_dashboard"),replace:!0,restrict:"E",scope:{dashboard:"=",ok:"&",cancel:"=",modalOptions:"="},controller:e,link:function(e,t){t.find("input:first").focus()}};function e(e,t,l){return e.result={name:`${e.dashboard.name} - ${n.contextData.getMessage("_157371")}`,description:e.dashboard.description},e.send_action=constants.events.form.action.send,e.advancedOptions=!1,e.save=d,e.bottomBtn={name:n.contextData.getMessage("_569808")},e.close=(()=>e.cancel(void 0,e.modalOptions)),e.toggleAdvancedOptions=(()=>e.advancedOptions=!e.advancedOptions),e.isUserAdmin=(()=>n.contextData.rules.isProjectAdminEnabled()),e.getProjectSelectMsg=(()=>n.contextData.getMessage("_1816043")),e.fetchGroupsOfDashboards=m,e.newDashBoardGroupForm={},e.createNewDashBoardGroup=g,e.displayNewGroupField=h,e.hideNewGroupField=p,e.canSave=u,e.canHaveAdvancedOptions=f,void(e.isUserAdmin()&&function(){const i=_("get","projects_allowed_to_creates_custom_pages","info");t.get(i).then(t=>{void 0!==t.projects&&(e.projects=new c.TopicMenuWrapper(t.projects)),m()})}());function d(){const t=i.mainApplication.getPageState().copyAndPrune(!1),n=void 0!==e.dashboardGroups?e.dashboardGroups.toProto():void 0,r=e.projects?e.projects.toProto():void 0,a=s.CustomPageFactory.getPage(o.DashboardPage,{mapped_id:t.getAllowedPages().getCustomPageId()}),c={title:e.result.name,description:e.result.description,clone_project_target:r,page_state:t.toProto(),groups:n};a.clone(c).then(t=>{i.mainApplication.getPageState().getUserFilterSettings().setReload(!0),e.ok()})}async function g(t){t.stopPropagation(),t.preventDefault();const i=await a.customPagesService.createNewGroup(e.newDashBoardGroupForm.label,void 0!==e.projects?e.projects.topicMenu:void 0),n=i.groups?i.groups:i.other_project_group;e.newDashBoardGroupForm.label="",e.dashboardGroups=new c.TopicMenuWrapper(n),p(),l.$$phase||l.$apply()}function u(){return!e.isUserAdmin()||void 0!==e.dashboardGroups&&void 0!==e.dashboardGroups.getFirstSelectedEntryRecursively()}function p(){e.newGroupFieldShown=!1}function h(){e.dashboardGroups.unselectAll(),e.newGroupFieldShown=!0}function m(){const i=_("get","dashboard_groups","search"),n={projects:void 0!==e.projects?e.projects.toProto():void 0};t.post(i,n).then(t=>{e.dashboardGroups=new c.TopicMenuWrapper(t.groups)})}function _(e,t,i,n=""){return routes.controllers.tw.TWRestForm[e](r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,t,i,n,"rform").url}function f(){return e.isUserAdmin()&&(void 0!==e.projects||void 0!==e.dashboardGroups)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=d,t.ModalCopyDashboardDirective=d}),define("components/modals/copy_report/directive",["require","exports","classes/application/application","underscore","classes/custom_pages/custom_page_factory","classes/custom_pages/pages/report_page","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{replace:!0,restrict:"A",scope:{report:"=",ok:"&",cancel:"&"},controller:["$scope","restFormService","TopicMenuWrapper",function(e,t,r){let a;function c(){return!0===window.context_data.userSettings.admin}e.result={report_id:e.report.report_id,name:e.report.name+" - "+window.messages.get("_157371"),groups:void 0},e.errorDuplicate=!1,e.blacklist={},o.ReportPage.info().then(function(t){const i=t.report_container;e.result.groups=i.groups,e.blacklist=JSON.parse(JSON.stringify(i.reports.root_entry.children)),e.blacklist.shift(),e.$$phase||e.$apply()}),c()&&(e.advancedOptions=!1,function(){const n=i.mainApplication.getPageState().getProject().getId();t.get(routes.controllers.tw.TWRestForm.get("project",n,"projects_allowed_to_creates_custom_pages","info","","rform").url).then(function(t){e.projects=t.projects,void 0!==e.projects&&(a=new r(e.projects))})}()),e.toggleAdvancedOptions=function(){e.advancedOptions=!e.advancedOptions},e.isUserAdmin=c,e.getProjectSelectMsg=function(){return window.messages.get("_1816043")},e.save=function(){const t=s.CustomPageFactory.getPageByType(constants.custom_page.type.report,{mapped_id:e.report.mapped_id}),n={mapped_id:e.report.mapped_id,title:e.result.name,page_state:i.mainApplication.getPageState().copyAndPrune(!1).toProto(),groups:e.result.groups,clone_project_target:e.projects};t.clone(n).then(function(t){e.ok({result:t})})},e.close=function(){e.cancel()},e.checkDuplicate=function(){e.errorDuplicate=!1,n.each(e.blacklist,function(t){e.result.name===t.name&&(e.errorDuplicate=!0)})}}],link:function(e,t,i){t.find("input:first").focus()},templateUrl:r.templateSourceFactory("components/modals/copy_report")}}]}),define("components/modals/dashboard_page/directive",["require","exports","underscore","reusable_utilities","classes/context_data/context_data","services/custom_pages","classes/custom_pages/custom_page_factory","angular_utilities","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"A",bindToController:{payload:"=?",ok:"&"},controllerAs:"vm",controller:d,templateUrl:l.templateSourceFactory("components/modals/dashboard_page"),scope:{}}};class d{constructor(){this.useSuffix=!1,this.add_action=constants.events.form.action.post,this.newGroupFieldShown=!1}$onInit(){this.groups=this.payload.groups.toProto(),this.bottomBtn={name:s.contextData.getMessage("_569808")}}async add(){const e=void 0!==this.payload.pageState?this.payload.pageState.clone():c.mainApplication.getPageState().clone(),t=this.useSuffix&&this.payload.widget_title_suffix.length>0;return r.CustomPageFactory.createPage(constants.custom_page.type.dashboard,{title:this.payload.name,description:this.payload.description,page_state:e.toProto(),groups:this.groups,widget_suffix:t?this.payload.widget_title_suffix:void 0,add_active_filters:this.payload.description_filters_allowed}).then(()=>{e.dispose(),this.ok()})}handleKeyDown(e,t){13===t.keyCode&&e&&this.add()}allowSuffix(e){e.preventDefault(),e.stopPropagation(),this.useSuffix=!0}async createNewDashBoardGroup(e){e.stopPropagation(),e.preventDefault();const t=(await o.customPagesService.createNewGroup(this.newDashBoardGroupForm.label)).groups;this.newDashBoardGroupForm.label="",n.TopicEntryUtils.recursiveUnselectAndSelect(t.root_entry,i(t.root_entry.children).last().mapped_id),this.groups=t,this.hideNewGroupField()}canSave(){return void 0!==this.groups&&void 0!==n.TopicMenuUtils.getFirstSelectedEntry(this.groups)}hideNewGroupField(){this.newGroupFieldShown=!1}displayNewGroupField(){n.TopicEntryUtils.setSelectionRecursive(this.groups.root_entry,!1),this.newGroupFieldShown=!0}}__decorate([a.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],d.prototype,"add",null),t.DashboardPageModalController=d}),define("components/modals/discovery_export/directive",["require","exports","notifications","services/export","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=i.notificationService,r=n.exportService;t.default=[function(){return e.$inject=["$scope"],{restrict:"EA",scope:{ok:"&"},controller:e,templateUrl:s.templateSourceFactory("components/modals/discovery_export")};function e(e){e.payload={title:"",description:""},e.save_action=constants.events.form.action.post,e.exportQuickSearch=function(){const t=r.exportWholePage(constants.output_type.docx_pdf,e.payload);o.warning('<i class="fa fa-refresh fa-spin"></i> '+window.messages.get("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:t}),t.then(function(e){o.success(e.message,{permanent:!0})},function(e){o.display(e.notification)}),e.ok()}}}]}),define("components/modals/edit_axis_labels/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"A",scope:{widget:"=",ok:"&"},controller:t,link:function(t,i){e(function(){i.find("input:first").focus()},0)},templateUrl:i.templateSourceFactory("components/modals/edit_axis_labels")};function t(e){let t;e.add=function(){e.ok({result:e.configuration})},function(){if(t=e.widget.getExtendedConfiguration(),e.configuration={y:{},z:{},rowLabel:void 0},t.hasYAxisConfiguration()&&(e.configuration.y={label:t.getYAxisConfiguration().getLabel()||""}),e.widget.hasNestedDics()){t.hasZAxisConfiguration()&&(e.configuration.z={label:t.getZAxisConfiguration().getLabel()||"",auto_rename_legend:t.getZAxisConfiguration().shouldAutoRenameLegend(),use_main_axis:t.getZAxisConfiguration().shouldUseMainAxis()});const i=_.first(e.widget.getNestedDics());i&&i.hasDataSource()&&(e.configuration.rowLabel=i.getDataSource().row_label)}t.hasZAxisTypeMenuData()&&(e.configuration.scalingFunctionData=t.getZAxisTypeMenuData().toProto())}()}}]}),define("components/modals/export_all/directive",["require","exports","notifications","underscore","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=i.notificationService;t.default=[function(){return e.$inject=["$scope"],{restrict:"E",scope:{data:"=",toggling:"&"},controller:e,templateUrl:r.templateSourceFactory("components/modals/export_all")};function e(e){const t=e.data.widget.getPageState().copyAndPrune(!1).toProto();t.data_input_configuration=[e.data.widget.toProto()],s.restFormService.post(routes.controllers.tw.TWRestForm.post("project",tw.project_id,"export_dialog","show","","rform").url,{page_state:t}).then(t=>{switch(e.options=t.options,e.form=t,e.optionsWrapper=new o.TopicMenuWrapper(t.options),e.optionsWrapper.getFirstSelectedEntry().getMappedId()){case"RANDOM_SAMPLE":e.amount={value:e.form.export_limit};break;case"SAMPLE_RATE":e.amount={value:1}}}),e.showNumberInput=(()=>void 0!==e.optionsWrapper&&n.contains(["RANDOM_SAMPLE","SAMPLE_RATE"],e.optionsWrapper.getFirstSelectedEntry().getMappedId())),e.getMaxValue=(()=>{switch(e.optionsWrapper.getFirstSelectedEntry().getMappedId()){case"RANDOM_SAMPLE":return e.form.export_limit;case"SAMPLE_RATE":return e.form.percentage_limit||100;default:throw new Error("Unexpected case")}}),e.isRate=(()=>"SAMPLE_RATE"===e.optionsWrapper.getFirstSelectedEntry().getMappedId()),e.changingExportSampleOption=(t=>{switch(t.mapped_id){case"RANDOM_SAMPLE":e.amount={value:e.form.export_limit};break;case"SAMPLE_RATE":e.amount={value:1}}}),e.exportDocument=(()=>{switch(e.optionsWrapper.getFirstSelectedEntry().getMappedId()){case"RANDOM_SAMPLE":e.form.sample_size=e.amount.value;break;case"SAMPLE_RATE":e.form.sample_rate=e.amount.value/100}e.form.page_state.exportr=!0,e.form.page_state.output_type=e.data.outputType,s.restFormService.post(routes.controllers.tw.Streaming.streamURL("project",e.data.widget.getPageState().getProject().getId()).url,e.form).then(t=>{a.success(t.message,{permanent:!1}),e.toggling()},t=>{a.display(t.data.notification),e.toggling()})})}}]}),define("components/modals/ga/indicator/directive",["require","exports","classes/context_data/context_data","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope"],{replace:!0,restrict:"EA",scope:{payload:"=",ok:"=",cancel:"=",modalOptions:"="},controller:e,templateUrl:n.templateSourceFactory("components/modals/ga/indicator")};function e(e){e.metricsPlaceholder=i.contextData.getMessage("_1805695"),e.setLabelIfEmpty=function(t){void 0!==e.payload.indicator.label&&0!==e.payload.indicator.label.length||(e.payload.indicator.label=t.name)},e.close=function(){return e.cancel(void 0,e.modalOptions)}}}}),define("components/modals/generic/send_email/directive",["require","exports","underscore","moment-timezone","jquery","services/rest_form_service","components/form/common/topic_menu","wrappers/topic_menu/topic_menu_wrapper","services/template_source"],function(e,t,i,n,s,o,r,a,c){function l(e){return t.$inject=["$scope","$element","Calendar"],{replace:!0,restrict:"EA",scope:{payload:"=",messages:"=",processSend:"=",toggling:"=?"},controller:t,templateUrl:c.templateSourceFactory("components/modals/generic/send_email")};function t(e,t,c){let l;function d(){const e=l.getSelectedAsText();return e&&e.length>0}async function g(){const t=e.payload.emails.replace(/\s/g,"").split(",");if(t&&t.length>0){const i={mail:JSON.stringify(t)},n=await o.restFormService.postRForm("mail_banned","info",i),s=JSON.parse(n.mail);e.hasUnbannableEmails=!1,e.hasDisabledRecipients=!1,e.unbannableEmails.length=0,s.forEach(t=>{const i=n.state[t];i&&!0===i.hard_failure&&(e.hasDisabledRecipients=!0,i.unbannable&&(e.hasUnbannableEmails=!0,e.unbannableEmails.push(t)))}),e.$applyAsync()}}e.toggleShowSendLater=function(t){t.stopPropagation(),e.showSendLater=!e.showSendLater},e.removeFutureDelivery=function(){o.restFormService.deleter(e.payload.remove_link),e.toggling()},e.updateFutureDelivery=function(){o.restFormService.post(e.payload.update_link,e.payload,e.send_action).then(function(){e.toggling()},function(){e.toggling()})},e.canShowMailingLists=function(){return e.payload.mailing_lists&&e.payload.mailing_lists.root_entry&&e.payload.mailing_lists.root_entry.children&&e.payload.mailing_lists.root_entry.children.length>0},e.isAnyMailingListSelected=function(){if(void 0===e.payload.mailing_lists)return!1;return r.getSelectedEntries(e.payload.mailing_lists.root_entry).length>0},e.send=function(){e.processSend().then(()=>{void 0!==e.toggling&&e.toggling()},()=>{void 0!==e.toggling&&e.toggling()})},e.reEnableEmails=async function(){const t={mail:JSON.stringify(e.unbannableEmails)};await o.restFormService.postRForm("mail_banned","remove",t),await g()},e.hasDisabledRecipients=!1,e.unbannableEmails=[],e.hasUnbannableEmails=!1,e.showSendLater=!!e.payload.instant,e.hoursMenu=new a.TopicMenuWrapper(e.payload.hours),e.send_action=constants.events.form.action.send,function(){const o=s(t).find('div[id="date-calendar"]');if(e.payload.instant){const t=n(e.payload.instant).format("YYYY-MM-DD");l=new c(o,{months:2,mode:"single",viewStartDate:t,selected:[t],useYearNav:!1,format:"YYYY-MM-DD",direction:"today-future"})}else l=new c(o,{months:2,mode:"single",useYearNav:!1,format:"YYYY-MM-DD",direction:"today-future"});e.noDateSelected=!d(),l.subscribe("change",function(){e.$apply(()=>{e.noDateSelected=!d(),function(){const t=i.first(l.getSelectedAsText()),s=n(t);s.hour(0).minute(0).second(0).millisecond(0),e.payload.instant=s.toDate().getTime()}()})})}(),e.updateDisabledRecipients=i.debounce(g,500)}}Object.defineProperty(t,"__esModule",{value:!0}),l.$inject=["$timeout"],t.default=l,t.GenericSendEmailDirective=l}),define("components/modals/help/contact/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{restrict:"EA",bindToController:{payload:"=",ok:"=",cancel:"=",modalOptions:"="},controllerAs:"vm",controller:s,templateUrl:i.templateSourceFactory("components/modals/help/contact"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.HelpContactDirective=n;class s{send(){this.ok(this.payload)}close(){this.cancel(void 0,this.modalOptions)}}t.HelpContactController=s}),define("components/modals/hootsuite_sharing_options/directive",["require","exports","components/form/common/topic_menu","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"A",scope:{dic:"=",ok:"&"},controller:e,link:function(e,t,i){t.find("input:first").focus()},templateUrl:n.templateSourceFactory("components/modals/hootsuite_sharing_options")};function e(e){const t=e.dic.getPrimarySource().tw_result_source.extended_configuration.sort_by.root_entry;e.flat_sort={root_entry:{children:i.getTwoLevelFlatList(t)}},e.okSharing=function(t,i){i.$valid&&e.ok({dic:t})}}}]}),define("components/modals/image_sharing_options/directive",["require","exports","underscore","moment-timezone","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{replace:!0,restrict:"A",scope:{widget:"=",ok:"&"},controller:["$scope","modalService","restFormService","Calendar",function(e,t,s,o){const r=tw.project_id;s.get(routes.controllers.tw.TWRestForm.get("project",r,"image_sharing_options","show","","rform").url).then(function(t){e.form_entry=t,e.form_entry.name=e.widget.getTitle();const i=n().add(31,"days");e.validDate=i.format(e.form_entry.date_format),e.form_entry.valid_until=i.toDate().getTime();const s=$("body").find('div[id="date-calendar"]'),r=n(e.form_entry.valid_until).tz(e.form_entry.timezone).format("YYYY-MM-DD");e.dateCalendar=new o(s,{months:2,mode:"single",viewStartDate:r,selected:[r],useYearNav:!1,format:"YYYY-MM-DD"}),e.dateCalendar.subscribe("change",function(){e.changeDate()})}),e.toggleDateCalendar=function(t){e.showDateCalendar=void 0!==t?t:!e.showDateCalendar},e.changeDate=function(){const t=i.first(e.dateCalendar.getSelectedAsText()),s=n(t);e.form_entry.valid_until=s.toDate().getTime(),e.validDate=s.format(e.form_entry.date_format)},e.okSharing=function(t,i){i.$valid&&e.ok({settings:{widget:t,form_entry:e.form_entry}})},e.$on("$destroy",function(){e.dateCalendar.dispose()})}],link:function(e,t,i){t.find("input:first").focus()},templateUrl:s.templateSourceFactory("components/modals/image_sharing_options")}}]}),define("components/modals/information/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{replace:!0,restrict:"A",scope:{payload:"=",cancel:"=",modalOptions:"="},templateUrl:i.templateSourceFactory("components/modals/information"),controller:["$scope",function(e){e.close=function(){e.cancel(void 0,e.modalOptions)}}]}}]}),define("services/article_sources",["require","exports","angular_utilities","notifications","underscore","classes/context_data/context_data","other/tw","wrappers/topic_menu/topic_entry_wrapper","services/context","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});class d{async addSourcesToPanel(e,t,i){if(s.isEmpty(e)||s.isEmpty(t))return;const r={source_panel_entries:e.map(e=>e.source_panel_entry)},a="blocked"===t.id?"exclude":i?"include":"exclude",d=l.restFormService.post(routes.controllers.tw.TWRestForm.post(c.contextService.getCurrentContext().scope,c.contextService.getCurrentContext().id,"source_panel_entries",a,t.id,"settings").url,r);return e.length>=5&&n.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+o.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:d}),d.then((n=>{switch(t.id){case"star1":this.setStars(e,1);break;case"star2":this.setStars(e,2);break;case"star3":this.setStars(e,3);break;case"favourites":this.setAsFavorite(e,!0);break;case"blocked":break;default:const n=i?t.included_entries:t.excluded_entries;e.forEach(e=>{n.includes(e.id_hash)||n.push(e.id_hash)})}}).bind(this))}removeSourcesFromPanel(e,t,i){if(s.isEmpty(e)||s.isEmpty(t))return;const n={source_panel_entries:s.flatten(e.map(e=>{const t=[{mapped_id:e.id_hash}];return e.url_hash&&t.push({mapped_id:e.url_hash}),t}))},o=i?"include":"exclude";return l.restFormService.deleter(routes.controllers.tw.TWRestForm.post(c.contextService.getCurrentContext().scope,c.contextService.getCurrentContext().id,"source_panel_entries",o,t.id,"settings").url,n).then(function(n){switch(t.id){case"star1":case"star2":case"star3":this.setStars(e,0);break;case"favourites":this.setAsFavorite(e,!1);break;default:e.forEach(e=>{i?t.included_entries=this.removeSourceFromPanelEntries(e,t.included_entries):t.excluded_entries=this.removeSourceFromPanelEntries(e,t.excluded_entries)})}}.bind(this))}removeSourceFromPanelEntries(e,t){return t.filter(t=>t!==e.id_hash&&t!==e.url_hash)}async setFavorite(e,t){const i=this.createSpecialPanel("favourites");return t?this.addSourcesToPanel(e,i,!0):this.removeSourcesFromPanel(e,i,!0)}async setRating(e,t,i){const n=this.createSpecialPanel("star"+i);return t!==i?this.addSourcesToPanel(e,n,!0):this.removeSourcesFromPanel(e,n,!0)}async setPanel(e,t,i,n){return i?this.addSourcesToPanel(e,t,n):this.removeSourcesFromPanel(e,t,n)}async createPanel(e){const{title:t,groups:i}=e;return l.restFormService.postRForm("source_panel","new",{name:t,groups:i})}getFavorite(e){return!s.isEmpty(e)&&e.every(e=>e.favorite)}getUserRating(e){if(!s.isEmpty(e))return e.reduce((e,t)=>e===t.user_rating?t.user_rating:void 0,e[0].user_rating)}isPanel(e,t,i){if(s.isEmpty(e))return!1;const n=i?t.included_entries:t.excluded_entries;return e.every(e=>n.includes(e.id_hash)||n.includes(e.url_hash))}async toggleFavorite(e){return this.setFavorite(e,!this.getFavorite(e))}async toggleUserRating(e,t){return this.setRating(e,this.getUserRating(e),t)}async togglePanel(e,t,i){return this.setPanel(e,t,!this.isPanel(e,t,i),i)}addToIncludePanel(e,t){const i=this.isPanel(e,t,!0);if(!i)return this.setPanel(e,t,!i,!0)}async block(e){return this.addSourcesToPanel(e,this.createSpecialPanel("blocked"),!1)}setStars(e,t){e.forEach(e=>{e.user_rating=t})}setAsFavorite(e,t){e.forEach(e=>{e.favorite=t})}createSpecialPanel(e){return{id:e,name:"",included_entries:[],excluded_entries:[]}}async createSourcePanelGroup(e,t=!0){const i=(await l.restFormService.postRForm("source_panels_group","create",{title:e})).mapped_id,n=r.tw.pageState.getUserFilterSettings();if(t&&void 0!==n){n.getTopicMenuByType(constants.topic_menu.TYPE.source_panel).getRootEntry().getChildren()[1].addChild(a.TopicEntryWrapper.create(i,e))}return i}async createAndReturnSourcePanelGroups(e){return await this.createSourcePanelGroup(e,!0),(await l.restFormService.getRForm("source_panels_groups","info")).groups_menu}}__decorate([i.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],d.prototype,"createAndReturnSourcePanelGroups",null),t.default=d,Object.defineProperty(t,"articleSourcesService",{get:()=>r.tw.inject("articleSourcesService")})}),define("components/modals/panel/directive",["require","exports","angular_utilities","services/rest_form_service","classes/context_data/context_data","services/article_sources","reusable_utilities","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{payload:"="},controllerAs:"vm",controller:c,templateUrl:a.templateSourceFactory("components/modals/panel"),scope:{}}};let c=class{constructor(e){this.$rootScope=e,this.newGroupFieldShown=!1,this.bottomBtn={name:s.contextData.getMessage("_569808")}}$onInit(){this.payload.sourceNames=this.payload.sourceNames||[],this.payload.authorNames=this.payload.authorNames||[],this.initialize()}async initialize(){const e=await n.restFormService.getRForm("source_panels_groups","info");e.groups_menu&&(this.payload.groups=e.groups_menu,this.$rootScope.$$phase||this.$rootScope.$apply())}isSource(){return!0===this.payload.isSource}getSources(){return this.payload.sourceNames}getAuthors(){return this.payload.authorNames}getPlaceholder(){return""}getSourcesLabel(){return this.getSources().length>0?s.contextData.messages.getMessage("_185152"):s.contextData.messages.getMessage("_826819")}getAuthorsLabel(){return this.getAuthors().length>0?s.contextData.messages.getMessage("_714158"):s.contextData.messages.getMessage("_811668")}displayNewGroupField(){r.TopicEntryUtils.setSelectionRecursive(this.payload.groups.root_entry,!1),this.newGroupFieldShown=!0}hideNewGroupField(){this.newGroupFieldShown=!1}createNewPanelGroup(e){e.stopPropagation(),e.preventDefault(),o.articleSourcesService.createAndReturnSourcePanelGroups(this.newPanelGroupsForm.label).then(e=>{this.newPanelGroupsForm.label="",r.TopicEntryUtils.recursiveUnselectAndSelect(e.root_entry,_(e.root_entry.children).last().mapped_id),this.payload.groups=e||this.payload.groups,this.hideNewGroupField()})}};c=__decorate([i.ngInject(["$rootScope"]),__metadata("design:paramtypes",[Object])],c),t.PanelModalController=c}),define("components/modals/password/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{replace:!0,restrict:"A",scope:{ok:"&",cancel:"&"},controller:["$scope","restFormService",function(e,t){e.password="",e.field_messages=[],e.send_action=constants.events.form.action.send,e.submitPassword=function(){const i={password_sign_in:e.password},n=routes.controllers.tw.TWRestForm.post("none","","verify_password","info","","rform").url;t.post(n,i,e.send_action).then(function(t){e.ok({password:e.password})},function(t){e.field_messages=t.field_messages})},e.close=function(){e.cancel()}}],link:function(e,t,i){t.find("input:first").focus()},templateUrl:i.templateSourceFactory("components/modals/password")}}]}),define("components/modals/project/setup/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$window","restFormService"],{restrict:"A",scope:{formEntry:"="},controller:e,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/modals/project/setup")};function e(e,t,i){e.goToBasicSetup=function(){t.location.href=e.formEntry.basic_setup_url},e.goToTopicSetup=function(){t.location.href=e.formEntry.topic_setup_url}}}]}),define("components/modals/project/users/access/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","restFormService"],{restrict:"A",scope:{formEntry:"=",ok:"&"},controller:e,link:function(e,t,i){},templateUrl:i.templateSourceFactory("components/modals/project/users/access")};function e(e,t){e.save_level_action=constants.events.form.action.update,e.progressOptions={action:constants.events.form.action.update,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")},e.save=function(){t.post(e.formEntry.update_link,e.formEntry,e.save_level_action).then(function(t){e.formEntry=t,e.ok()},function(t){e.formEntry=t})},e.close=function(){e.ok()}}}]}),define("components/modals/report/alert/directive",["require","exports","underscore","components/form/common/topic_menu","classes/application/application","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=s.mainApplication;t.default=[function(){return e.$inject=["$scope","$window","restFormService","logService","bubbleDialogService"],{restrict:"A",scope:{toggling:"&",alert:"=",formName:"=?"},controller:e,link:function(e,t,i){t.find("input:first").focus()},templateUrl:o.templateSourceFactory("components/modals/report/alert")};function e(e,t,s,o,a){if(e.my_form={name:e.formName||"alert",alert:{},widget_title_suffix:""},e.editMode=!1,e.creatingAlert=!1,e.useSuffix=!1,e.add_action=constants.events.form.action.post,g()||(c.progressOptions={action:constants.events.form.action.update,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")}),e.alert)e.my_form.alert=e.alert,e.initialAlert=JSON.parse(JSON.stringify(e.my_form.alert)),e.editMode=!0;else{const t=tw.pageState.getAllowedPages().getPageType(),i=tw.pageState.getAllowedPages().getGroupPage(),n=routes.controllers.tw.TWRestForm.get("project",tw.project_id,e.my_form.name,"new","","rform").url;s.get(n+"?"+constants.keys.page+"="+t+"&"+constants.keys.group_page+"="+i+"&"+constants.keys.page_state+"="+encodeURIComponent(tw.pageState.getId())).then(function(t){e.my_form.alert=t,e.initialAlert=JSON.parse(JSON.stringify(e.my_form.alert))},function(t){e.toggling()})}const c=e;function l(t){return function(){if(c.isTriggerResultsSelected()&&e.my_form.alert&&e.my_form.alert.trigger_results){const i=n.getSelectedValue(e.my_form.alert.trigger_type.root_entry),s=constants.alert_trigger_result[i.mapped_id];if(s)switch(t){case"pourcents":return s.pourcents_required;case"days":return s.day_required;case"results_threshold":return s.results_threshold;case"smart_spike_level":return s.smart_spike_level_required;default:o.error("invalid trigger option!")}}return!1}}function d(t){return function(){if(c.isTriggerTimeUnitSelected()&&e.my_form.alert&&e.my_form.alert.trigger_time_unit){const i=n.getSelectedValue(e.my_form.alert.trigger_time_unit.root_entry),s=constants.alert_timeunit_result[i.mapped_id];if(s)switch(t){case"hour":return s.hour;case"day":return s.day;case"week_day":return s.week_days;case"interval":return s.interval;default:o.error("invalid time interval!")}}return!1}}function g(){return!e.my_form||!e.my_form.alert||!e.my_form.alert.id||"0"===e.my_form.alert.id}c.getLabel=function(e){e&&n.getSelectedValue(e.root_entry);return""},c.isNewAlert=g,c.showSendIfNoResultsOnOff=function(){return e.isTriggerTimeUnitSelected()&&!e.isTimeUnitNowOptionSelected()&&e.my_form.alert.results_page},c.showIncludeOnlyNewResultsInScheduledOnOff=function(){return e.isTriggerTimeUnitSelected()&&!e.isTimeUnitNowOptionSelected()&&e.my_form.alert.results_page},c.showSendFailingWeekWarning=function(){return e.isResultsThresholdOptionSelected()||e.isPourcentsOptionSelected()||e.isSmartSpikeLevelSelected()},c.add=function(t){e.creatingAlert=!0;const i=r.getPageState().copyAndPrune(!1);e.my_form.alert.page_state=i.toProto(),i.dispose();const n={name:e.my_form.alert.title,page_state:e.my_form.alert.page_state,output_type:e.my_form.alert.output_type,schedule:{emails:e.my_form.alert.emails,trigger_type:e.my_form.alert.trigger_type,trigger_time_unit:e.my_form.alert.trigger_time_unit,trigger_results:e.my_form.alert.trigger_results,num_results:e.my_form.alert.num_results,submit_scheduled_when_no_results:e.my_form.alert.submit_scheduled_when_no_results,include_only_new_results_in_scheduled:e.my_form.alert.include_only_new_results_in_scheduled,day:e.my_form.alert.day,hour:e.my_form.alert.hour,week_days:e.my_form.alert.week_days,pourcents:e.my_form.alert.pourcents,number_of_day:e.my_form.alert.number_of_day,results_threshold:e.my_form.alert.results_threshold,smart_spike_level_menu:e.my_form.alert.smart_spike_level_menu,notify_added_subscribers:e.my_form.alert.notify_added_subscribers,send_failing_week_warning:e.my_form.alert.send_failing_week_warning}};e.useSuffix&&e.my_form.widget_title_suffix.length>0&&(n.widget_title_suffix=e.my_form.widget_title_suffix);s.post(routes.controllers.tw.TWRestForm.post("project",tw.project_id,"report","add","","settings").url,n).then(function(t){e.my_form.alert=t,e.creatingAlert=!1,e.toggling()},function(t){e.my_form.alert.field_messages=t.field_messages,e.creatingAlert=!1}),a.destroyAllNonPersistent()},c.canBeAdded=function(){return e.my_form.alert.save_link&&""!==e.my_form.alert.save_link},c.save=function(){s.post(e.my_form.alert.save_link,e.my_form.alert,constants.events.form.action.update).then(function(i){e.alert?t.location.href=e.my_form.alert.root_link_back:e.my_form.alert=i},function(t){e.my_form.alert.field_messages=t.field_messages})},c.cancel=function(){e.alert?t.location.href=e.my_form.alert.root_link_back:(e.editMode=!1,e.my_form.alert=e.initialAlert)},c.allowSuffix=function(t){t.preventDefault(),t.stopPropagation(),e.useSuffix=!0},c.isTriggerResultsSelected=function(){if(!e.my_form.alert||!e.my_form.alert.trigger_type)return!1;const t=n.getSelectedValue(e.my_form.alert.trigger_type.root_entry),s=[e.my_form.alert.trigger_results_constant_new_results,e.my_form.alert.trigger_results_constant_irregular_absolute,e.my_form.alert.trigger_results_constant_irregular_percent,e.my_form.alert.trigger_results_constant_irregular_week_percent,e.my_form.alert.trigger_results_constant_smart_spike];return t&&i.contains(s,t.mapped_id)},c.isTriggerTimeUnitSelected=function(){if(!e.my_form.alert||!e.my_form.alert.trigger_type)return!1;const t=n.getSelectedValue(e.my_form.alert.trigger_type.root_entry),s=[e.my_form.alert.trigger_time_constant];return t&&i.contains(s,t.mapped_id)},c.isDayOptionSelected=l("days"),c.isPourcentsOptionSelected=l("pourcents"),c.isResultsThresholdOptionSelected=l("results_threshold"),c.isSmartSpikeLevelSelected=l("smart_spike_level"),c.isTimeUnitDayOptionSelected=d("day"),c.isTimeUnitHourOptionSelected=d("hour"),c.isTimeUnitIntervalOptionSelected=d("interval"),c.isTimeUnitNowOptionSelected=function(){return!(c.isTimeUnitDayOptionSelected()||c.isTimeUnitWeekDayOptionSelected()||c.isTimeUnitHourOptionSelected())},c.isTimeUnitWeekDayOptionSelected=d("week_day")}}]}),define("components/modals/report/alert_now/directive",["require","exports","components/form/common/topic_menu","services/template_source","services/rest_form_service","services/confirmation_service","wrappers/topic_menu/topic_entry_wrapper","classes/application/application","log"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l={formName:"discovery_report"};t.default=[function(){return e.$inject=["$scope"],{restrict:"A",scope:{toggling:"&",cancel:"=",alert:"=",identifier:"=",modalOptions:"=",formName:"=?"},controller:e,link:function(e,t){t.find("input:first").focus()},templateUrl:n.templateSourceFactory("components/modals/report/alert_now")};function e(e){e.add_action=constants.events.form.action.post;const t=tw.pageState.getAllowedPages().getPageType(),n=tw.pageState.getAllowedPages().getGroupPage();e.formName=e.formName||l.formName,e.progressOptions={action:constants.events.form.action.update,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")},async function(){const i=void 0!==e.identifier?routes.controllers.tw.TWRestForm.get("project",tw.project_id,e.formName,"show","","rform").url+"/"+e.identifier:routes.controllers.tw.TWRestForm.get("project",tw.project_id,e.formName,"new","","rform").url;try{const o=await s.restFormService.get(i+"?"+constants.keys.page+"="+t+"&"+constants.keys.group_page+"="+n+"&"+constants.keys.page_state+"="+encodeURIComponent(tw.pageState.getId()));e.$apply(()=>(function(t){e.my_form=Object.assign({hour:"08:00"},t)})(o))}catch(t){e.toggling()}}();const d=e;function g(t){return function(){if(d.isTriggerTimeUnitSelected()&&e.my_form.trigger_time_unit){const n=i.getSelectedValue(e.my_form.trigger_time_unit.root_entry),s=constants.alert_timeunit_result[n.mapped_id];if(s)switch(t){case"hour":return s.hour;case"day":return s.day;case"week_day":return s.week_days;case"interval":return s.interval;default:c.logService.error("invalid time interval!")}}return!1}}function u(){if(void 0!==e.my_form){const t=i.getSelectedValue(e.my_form.frequency_menu.root_entry);return null!==t&&"H24"==t.mapped_id}return!1}d.isTimeUnitDayOptionSelected=g("day"),d.isTimeUnitHourOptionSelected=g("hour"),d.isTimeUnitIntervalOptionSelected=g("interval"),d.isTimeUnitNowOptionSelected=function(){return!(d.isTimeUnitDayOptionSelected()||d.isTimeUnitWeekDayOptionSelected()||d.isTimeUnitHourOptionSelected())},d.isTriggerTimeUnitSelected=function(){if(!e.my_form||!e.my_form.trigger_type)return!1;const t=i.getSelectedValue(e.my_form.trigger_type.root_entry);return t&&["SCHEDULE"].includes(t.mapped_id)},d.isTimeUnitWeekDayOptionSelected=g("week_day"),d.onlyOneHourCanBeSelected=u,d.canShowFrequency=function(){if(void 0!==e.my_form&&void 0!==e.my_form.trigger_type){for(const t of e.my_form.trigger_type.root_entry.children)if("NEW_RESULTS"===t.mapped_id&&"NODE"===t.selected)return!1;return!0}return!1},d.fromToNeeded=function(){return!u()},d.save=function(){e.creatingAlert=!0;const t=a.mainApplication.getPageState().copyAndPrune(!1);e.my_form.page_state=t.toProto(),t.dispose(),u()&&(e.my_form.to_time=e.my_form.from_time);const i=e.isNewAlert()?routes.controllers.tw.TWRestForm.post("project",tw.project_id,e.formName,"add","","rform").url:e.my_form.save_link;s.restFormService.post(i,e.my_form).then(t=>{e.my_form.alert=t,e.creatingAlert=!1;const i=tw.pageState.getAllowedPages().getAlertsMenu();i.hasRootEntry()||(i.topicMenu.root_entry={mapped_id:"root"}),e.isNewAlert()?i.getRootEntry().addChild(r.TopicEntryWrapper.create(t.report_id,t.name+" - "+t.last_executed_date)):i.getRootEntry().getEntryByMappedId(t.report_id).setName(t.name+" - "+t.last_executed_date),i.toProto(),e.toggling()},()=>{e.creatingAlert=!1})},d.isNewAlert=function(){return void 0===e.identifier},d.delete=(()=>{o.confirmationService.display({message:window.messages.get("_1156486")}).then(()=>{s.restFormService.deleter(e.my_form.remove_link);const t=tw.pageState.getAllowedPages().getAlertsMenu();t.getRootEntry().removeChildByMappedId(e.identifier),t.toProto(),e.cancel(void 0,e.modalOptions)},()=>void 0)})}}]}),define("components/modals/report/convert_output_type/directive",["require","exports","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","other/tw","classes/custom_pages/pages/report_page","services/tw_routing","services/confirmation_service","services/template_source"],function(e,t,i,n,s,o,r,a,c){function l(){return{templateUrl:c.templateSourceFactory("components/modals/report/convert_output_type"),restrict:"E",replace:!0,scope:!0,controller:d,controllerAs:"vm",bindToController:{ok:"&",cancel:"=",modalData:"=",modalOptions:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=l,t.ModalCloneCommandCenterScreenDirective=l;class d{get post_action(){return constants.events.form.action.post}constructor(){}$onInit(){this.showLoader=!0,i.restFormService.getRForm("report_output_types","show",s.tw.pageState.getAllowedPages().getCustomPageId()).then(e=>{this.formEntryData=e,this.model=new n.TopicMenuWrapper(e.output_type_menu),this.showLoader=!1})}canShowLoader(){return this.showLoader}async save(){this.loading=!0,await new o.ReportPage({}).refresh({mapped_id:s.tw.pageState.getAllowedPages().getCustomPageId(),output_types_and_templates:this.model.toProto()}),this.loading=!1,this.ok(),r.twRoutingService.refresh({forceRebuild:!0,applicationRefresh:!0,noLoadingBubble:!1})}restoreReport(){a.confirmationService.display({message:this.formEntryData.restore_backup_confirmation_message}).then(()=>{i.restFormService.post(this.formEntryData.restore_backup_link,{report_id:s.tw.pageState.getAllowedPages().getCustomPageId()},"restore").then(()=>{this.ok(),r.twRoutingService.refresh({forceRebuild:!0,applicationRefresh:!0,noLoadingBubble:!1})})})}}}),define("components/modals/report/mailing_lists/directive",["require","exports","common_constants","underscore","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{replace:!0,restrict:"A",scope:{data:"=",ok:"&",cancel:"&"},controller:["$scope",function(e){const t=e;t.close=function(t){t.preventDefault(),e.ok()},t.hasNoMailingLists=function(){if(void 0===e.data.mailing_lists.root_entry.children||0===e.data.mailing_lists.root_entry.children.length)return!0;let t=!1;return n.each(e.data.mailing_lists.root_entry.children,function(e){e.visibility===i.topic_entry.visibility.visible&&(t=!0)}),!t},t.noListsMessage=e.data.no_list_message,t.getAvailableMsg=function(){if(!n.isUndefined(e.data.type)&&e.data.type===constants.modal.mailing_lists.type.user_access_lists)return window.messages.get("_584295");return window.messages.get("_784187")},t.getSelectedMsg=function(){if(!n.isUndefined(e.data.type)&&e.data.type===constants.modal.mailing_lists.type.user_access_lists)return window.messages.get("_841159");return window.messages.get("_250398")}}],templateUrl:s.templateSourceFactory("components/modals/report/mailing_lists")}}]}),define("components/modals/report/migration/directive",["require","exports","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","other/tw","classes/custom_pages/pages/report_page","services/tw_routing","services/template_source"],function(e,t,i,n,s,o,r,a){function c(){return{templateUrl:a.templateSourceFactory("components/modals/report/migration"),restrict:"EA",replace:!0,scope:!0,controller:l,controllerAs:"vm",bindToController:{ok:"&"}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=c,t.ReportMigrationModalDirective=c;class l{get post_action(){return constants.events.form.action.post}constructor(){}$onInit(){this.showLoader=!0,i.restFormService.getRForm("report_output_types","convert",s.tw.pageState.getAllowedPages().getCustomPageId()).then(e=>{this.model=new n.TopicMenuWrapper(e.output_type_menu),this.showLoader=!1})}canShowLoader(){return this.showLoader}async save(){this.loading=!0,await new o.ReportPage({}).refresh({mapped_id:s.tw.pageState.getAllowedPages().getCustomPageId(),output_types_and_templates:this.model.toProto()}),this.loading=!1,this.ok(),r.twRoutingService.refresh({forceRebuild:!0,applicationRefresh:!0,noLoadingBubble:!1})}}}),define("components/modals/report/send/directive",["require","exports","services/context","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s=i.contextService;t.default=[function(){return e.$inject=["$scope","restFormService"],{replace:!0,restrict:"A",scope:{report:"=",toggling:"="},controller:e,templateUrl:n.templateSourceFactory("components/modals/report/send")};function e(e,t){e.send=function(){const i={report_id:e.report.report_id,sender_addresses:e.report.emails,mailing_lists:e.report.mailing_lists};return t.post(routes.controllers.tw.TWRestForm.post(s.getCurrentContext().scope,s.getCurrentContext().id,"report","send","","rform").url,i,e.send_action)},e.send_action=constants.events.form.action.send,function(){const t=window.messages.get("_874968")+" "+e.report.name+" "+window.messages.get("_874967");e.messages={emailsDescription:t,futureDeliveryDescription:window.messages.get("_693053")}}()}}]}),define("components/modals/report/slide/layouts/directive",["require","exports","jquery","angular_utilities","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",scope:{},bindToController:{menu:"=",ok:"&"},controllerAs:"vm",controller:r,templateUrl:o.templateSourceFactory("components/modals/report/slide/layouts")}};let r=class{constructor(e,t){this.$scope=e,this.$element=t,this.save=this.saveButtonCallback.bind(this)}$onInit(){this.progressOptions={action:constants.events.form.action.post,text:s.contextData.getMessage("_612374"),textCalling:s.contextData.getMessage("_911337"),isDisabled:()=>!this.menu.getRootEntry().containsSelection(!0)}}getLayoutsStyle(){return{maxHeight:this.getMaxHeight()}}getMaxHeight(){const e=window.pageYOffset+i(window).outerHeight();return e-(135+Math.max(20,.05*e))+"px"}saveButtonCallback(){this.ok({entry:this.menu.getFirstSelectedEntryRecursively()})}};r=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],r)}),define("components/modals/report/widget/directive",["require","exports","underscore","reusable_utilities","services/rest_form_service","services/context","classes/context_data/context_data","classes/custom_pages/pages/report_page","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"E",bindToController:{widget:"=",ok:"&"},controllerAs:"vm",controller:l,templateUrl:c.templateSourceFactory("components/modals/report/widget"),scope:{}}};class l{constructor(){this.addAction=constants.events.form.action.post,this.bottomBtn={name:r.contextData.getMessage("_569808")}}$onInit(){this.result={title:void 0,dic:this.widget.getDic(),groups:void 0,reports:void 0,description_filters_allowed:!1},this.newReportGroupForm={label:void 0},this.initialize()}async initialize(){const e=(await a.ReportPage.info()).report_container;this.result=Object.assign({},this.result,{groups:e.groups,reports:e.reports}),this.existingReports=JSON.parse(JSON.stringify(e.reports.root_entry.children)),this.existingReports.shift()}checkDuplicateReportName(){this.errorDuplicate=i.any(this.existingReports,e=>e.name===this.result.title)}handleKeyDown(e,t){t.keyCode===n.Keys.ENTER&&e&&this.close()}canSave(){return void 0!==this.result.groups&&void 0!==n.TopicMenuUtils.getFirstSelectedEntry(this.result.groups)}hideNewGroupField(){this.newGroupFieldShown=!1}displayNewGroupField(){n.TopicEntryUtils.setSelectionRecursive(this.result.groups.root_entry,!1),this.newGroupFieldShown=!0}async createNewReportGroup(e){e.stopPropagation(),e.preventDefault();const t=routes.controllers.tw.TWRestForm.post(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,"report_category","new","","rform").url,r=(await s.restFormService.post(t,{name:this.newReportGroupForm.label})).report_groups;this.newReportGroupForm.label="",n.TopicEntryUtils.recursiveUnselectAndSelect(r.root_entry,i(r.root_entry.children).last().mapped_id),this.result.groups=r,this.hideNewGroupField()}close(){this.ok({result:this.result})}}t.AddWidgetToReportModalController=l}),define("components/modals/result_rule/add/directive",["require","exports","underscore","classes/context_data/context_data","other/tw","services/broker","services/bubble_dialog","services/configuration","services/rest_form_service","services/tw_common","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){function p(){return e.$inject=["$scope","$element","$timeout"],{replace:!0,restrict:"EA",scope:{pageState:"=?",formEntry:"=?",ok:"&"},controller:e,link:function(e,t){t.find("input:first").focus()},templateUrl:u.templateSourceFactory("components/modals/result_rule/add")};function e(e,t,u){let p,h,m,_;return(()=>{if(e.isFormLoaded=f,e.isSaveNew=y,e.isUpdate=v,e.isPastAllowed=S,e.isFutureAllowed=b,e.isTogglesDisabled=w,e.getSelectedRuleAction=C,e.getSaveNewMessage=E,e.getSaveNewProgressMsg=T,e.handleSelectedTagSuggestion=M,e.useCustomTag=P,e.getSuggestedTagsForInputValue=D,e.submit=I,e.cancel=x,e.showFilterSelection=R,e.attemptCloseFilterSelection=F,e.selectRuleActionCallback=A,e.checkEnter=O,e.isRuleActionTagRelated=k([constants.result_rule.action.add_customer_tags,constants.result_rule.action.remove_customer_tags]),e.isRuleActionSetScore=k([constants.result_rule.action.set_score]),e.isRuleSetSentiment=k([constants.result_rule.action.set_sentiment]),e.isRuleSetLanguage=k([constants.result_rule.action.set_language]),e.isRuleSetSourceGeo=k([constants.result_rule.action.set_source_geo]),e.isRuleWorkflowTagsRelated=k([constants.result_rule.action.add_marking_tags,constants.result_rule.action.remove_marking_tags]),e.isRuleDeleteResult=k([constants.result_rule.action.delete]),e.send_action=constants.events.form.action.send,e.progressButtonId=l.twCommon.generateUuid(),p=!i.isUndefined(e.formEntry),e.$on("suggestionInserted",(t,i)=>{e.boundValue=i.suggestion.label}),i.isUndefined(e.formEntry)){const i=routes.controllers.tw.TWRestForm.get("project",s.tw.project_id,"result_rule","new","","rform").url;c.restFormService.get(i).then(i=>{e.form_entry=i,m=new d.TopicMenuWrapper(i.rule_actions),p=!0,u(()=>h=t.find("#tagInput"))})}else e.form_entry=e.formEntry,m=new d.TopicMenuWrapper(e.form_entry.rule_actions),_=new g.UserFilterSettingsWrapper(e.form_entry.page_state.user_filter_settings),u(()=>h=t.find("#tagInput"))})();function f(){return p}function y(){return e.form_entry.save_new_link}function v(){return e.form_entry.save_link}function S(){return JSON.parse(m.getFirstSelectedEntry().getAdditionalInfo()).past}function b(){return JSON.parse(m.getFirstSelectedEntry().getAdditionalInfo()).future}function w(){const e=JSON.parse(m.getFirstSelectedEntry().getAdditionalInfo());return!e.past||!e.future}function C(){return m.getFirstSelectedEntry()}function E(){return n.contextData.getMessage("_180463")}function T(){return n.contextData.getMessage("_815226")}function M(){h.val(h.val()),e.form_entry.tag=h.val()}function P(t){e.form_entry.tag=t.alias,h.val(t.alias)}function D(){if(!i.isUndefined(h)&&!i.isEmpty(h.val()))return i(e.form_entry.existing_custom_project_tags).filter(t=>t.alias.indexOf(e.form_entry.tag)>=0)}function A(t){if(w()){const t=JSON.parse(m.getFirstSelectedEntry().getAdditionalInfo());e.form_entry.apply_past=t.past,e.form_entry.apply_future=t.future}}function I(){if(i.isUndefined(e.formEntry)){const t=function(){const t=e.pageState.copyAndPrune(!0);return e.form_entry.page_state=t.toProto(),t}();c.restFormService.post(e.form_entry.save_new_link,e.form_entry,constants.events.form.action.send).then(()=>{t.dispose(),e.ok()})}else c.restFormService.post(e.form_entry.save_link,e.form_entry,constants.events.form.action.send).then(e=>window.location.href=e.back_link)}function x(){window.location.href=e.form_entry.back_link}function R(e){r.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection),r.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,e.target,_,a.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1,void 0,!0)}function F(){r.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.filters.selection,500)}function O(t){13===t.which&&o.brokerService.publish(constants.events.progress_button.external_trigger,[e.progressButtonId])}function k(e){return()=>{const t=m.getFirstSelectedEntry().getMappedId();return i(e).contains(t)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=p,t.ResultRuleAddDirective=p}),define("components/modals/saveview/directive",["require","exports","angular_utilities","services/rest_form_service","angular","services/context","classes/context_data/context_data","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:c.templateSourceFactory("components/modals/saveview"),replace:!0,restrict:"A",scope:{},controller:l,controllerAs:"vm",bindToController:{payload:"=",ok:"&"},link:d}};let l=class{constructor(e,t){this.$scope=e,this.restFormService=t}$onInit(){this.add_action=constants.events.form.action.add_one,this.usersLoaded=!1}saveView(){const e=a.mainApplication.getPageState().copyAndPrune(!0),t={name:this.payload.name,make_default:this.payload.make_default,login_view:e.toProto(),users:this.payload.users,allowed_to_share_bookmark:this.payload.allowed_to_share_bookmark};e.dispose(),n.restFormService.post(routes.controllers.tw.TWRestForm.post(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,"bookmark","include","","rform").url,t,this.add_action).then(e=>{this.ok({data:e})})}getAvailableMsg(){return r.contextData.getMessage("_584295")}getSelectedMsg(){return r.contextData.getMessage("_841159")}loadSharingData(e){if(!this.usersLoaded&&!0===e){const e=routes.controllers.tw.TWRestForm.get(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,"bookmark_sharing","info","","rform").url;n.restFormService.get(e).then(e=>{void 0!==e.users&&(this.payload.users=e.users,this.usersLoaded=!0)})}}canShowUsers(){return void 0!==this.payload.users&&this.payload.allowed_to_share_bookmark}isBookmarkSharingEnabled(){return r.contextData.rules.isBookmarkSharingEnabled()}};function d(e,t,i){t.find("input:first").focus()}l=__decorate([i.ngInject(["$scope","restFormService"]),__metadata("design:paramtypes",[Object,String])],l),t.SaveViewController=l,t.SaveViewLink=d}),define("components/modals/share_dashboard/directive",["require","exports","underscore","moment-timezone","notifications","services/context","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=s.notificationService,l=o.contextService,d=r.mainApplication;function g(e,t,i){t.find("input:first").focus()}t.default=["restFormService","Calendar",function(e,t){return s.$inject=["$scope"],{replace:!0,restrict:"A",scope:{dashboard:"=",ok:"&"},controller:s,link:g,templateUrl:a.templateSourceFactory("components/modals/share_dashboard")};function s(s){function o(){let e;s.isUpdate()?e=n(s.form_entry.valid_until):(e=n().add(1,"month"),s.form_entry.valid_until=e.toDate().getTime()),s.validDate=e.format(s.form_entry.date_format);const i=$("body").find('div[id="date-calendar"]'),o=n(s.form_entry.valid_until).tz(s.form_entry.timezone).format("YYYY-MM-DD");s.dateCalendar=new t(i,{months:2,mode:"single",viewStartDate:o,selected:[o],useYearNav:!1,format:"YYYY-MM-DD",direction:"today-future"}),s.dateCalendar.subscribe("change",function(){s.$apply(function(){s.changeDate()})})}s.send_action=constants.events.form.action.send,s.save=function(){s.isUpdate()?function(){const t={id:s.form_entry.id,never_expires:s.form_entry.never_expires,valid_until:s.form_entry.valid_until,refresh_period:s.form_entry.refresh_period,name:s.form_entry.name};e.post(s.dashboard.save_link,t,s.send_action).then(function(e){window.location.href=s.dashboard.root_link})}():function(){const t=d.getPageState().clone();t.prune(!0),t.setExportMode(!0,!0,constants.output_type.html_page);const i={page_state:t.toProto(),never_expires:s.form_entry.never_expires,valid_until:s.form_entry.valid_until,refresh_period:s.form_entry.refresh_period,name:s.form_entry.name};t.dispose(),e.post(routes.controllers.tw.TWRestForm.post(l.getCurrentContext().scope,l.getCurrentContext().id,"page_state_sharing","share","","rform").url,i,s.send_action).then(function(e){e.data&&c.success(e.data.message,{permanent:!0}),s.ok()})}()},s.toggleDateCalendar=function(e){s.showDateCalendar=void 0!==e?e:!s.showDateCalendar},s.changeDate=function(){const e=i.first(s.dateCalendar.getSelectedAsText()),t=n(e);s.form_entry.valid_until=t.toDate().getTime(),s.validDate=t.format(s.form_entry.date_format)},s.isUpdate=function(){return!i.isUndefined(s.dashboard.save_link)},s.isUpdate()?(s.form_entry=s.dashboard,o(),s.progressOptions={action:s.send_action,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0}):e.get(routes.controllers.tw.TWRestForm.get(l.getCurrentContext().scope,l.getCurrentContext().id,"page_state_sharing","info","","rform").url).then(function(e){s.form_entry=e,s.form_entry.name=s.dashboard.name,o()}),s.$on("$destroy",function(){s.dateCalendar.dispose()})}}]}),define("components/modals/sharing/directive",["require","exports","components/form/common/topic_menu","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"A",scope:{dic:"=",ok:"&"},controller:e,link:function(e,t,i){t.find("input:first").focus()},templateUrl:n.templateSourceFactory("components/modals/sharing")};function e(e){const t=e.dic.getPrimarySource().tw_result_source.extended_configuration.sort_by.root_entry;e.flat_sort={root_entry:{children:i.getTwoLevelFlatList(t)}},e.okSharing=function(t,i){i.$valid&&e.ok({dic:t})}}}]}),define("components/modals/topic/color/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",replace:!0,scope:{color:"=",ok:"&"},controller:["$scope",function(e){e.temp=JSON.parse(JSON.stringify(e.color)),e.save=function(){e.color.mapped_id=e.temp.mapped_id,e.ok({color:e.color})}}],link:function(e,t,i){t.find("input:first").focus()},templateUrl:i.templateSourceFactory("components/modals/topic/color")}}]}),define("components/modals/topics/category/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{replace:!0,restrict:"A",templateUrl:i.templateSourceFactory("components/modals/topics/category"),controllerAs:"vm",bindToController:{category:"=",ok:"&",cancel:"=",modalOptions:"=",messages:"="},scope:{},controller:s,link:function(e,t,i){t.find("input:first").focus()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.TopicsCategoryModalDirective=n;class s{save(){this.ok({category:this.category})}close(){this.cancel(void 0,this.modalOptions)}handleKeyDown(e,t){13===t.keyCode&&e&&this.save()}}}),define("components/modals/widget/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"A",scope:{widget:"=",formsValid:"="},controller:t,link:function(t,i,n){e(function(){i.find("input:first").focus()},0)},templateUrl:i.templateSourceFactory("components/modals/widget")};function t(e){e.getTitleLimitMsg=function(){return window.messages.get("_551988",[e.widget.getConfigurationRendering().title_character_limit])},e.getDescriptionLimitMsg=function(){return window.messages.get("_436696",[e.widget.getConfigurationRendering().description_character_limit])},e.setDisplayActiveFilters=function(){e.widget.getDicWrapper().setDisplayActiveFilters(e.displayActiveFilters)},e.displayActiveFilters=e.widget.getDicWrapper().isDisplayActiveFilters()||!1;const t=e.$watch("widget_form.$valid",function(t,i){e.formsValid=t});e.$on("$destroy",function(){t()})}}]}),define("components/navbar/directive",["require","exports","other/tw","services/bubble_dialog","services/filter","services/configuration","services/navigation","services/context","services/rest_form_service","services/modal","services/tw_routing","flux","reusable_components","notifications","components/form/common/topic_menu","services/embedded_widget","services/broker","controllers/routing/page_state_page","classes/context_data/context_data","services/navbar","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source","services/application_mode","services/confirmation_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$rootScope","$scope"],{replace:!0,restrict:"A",scope:{navbarOptions:"="},controller:e,templateUrl:P.templateSourceFactory("components/navbar")};function e(e,t){function P(){return void 0!==i.tw.pageState}function I(e){return!_.isUndefined(d.twRoutingService.getGroupPage())&&e===d.twRoutingService.getGroupPage()}Object.defineProperty(t,"filterState",{get:function(){return S.navbarService.getFilterState()===S.FilterState.OPEN},set:function(e){S.navbarService.setFilterState(e?S.FilterState.OPEN:S.FilterState.CLOSE)}}),Object.defineProperty(t,"showOpenFilter",{get:function(){return S.navbarService.showOpenFilters()}}),t.selectedTab=void 0,t.requestHelpContactModal=function(){event.stopPropagation(),l.modalService.display("HELP_CONTACT",{contact_entities:t.model.contact_entities,subject:"",message:""}).then(function(e){c.restFormService.post(routes.controllers.tw.TWRestForm.post(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"help_contact","send","","rform").url,e)})},t.goToAcademy=function(e){e.stopPropagation(),R()&&window.open(v.contextData.getLink("ACADEMY_USER_MANUAL"),"_blank")},t.canShowAcademy=R,t.isAlertEditMode=function(){return P()&&i.tw.pageState.getAllowedPages().isTriggerEdit()},t.isDashboard=function(){return P()&&i.tw.pageState.getAllowedPages().isDashboard()},t.isDashboardTemplate=function(){return P()&&i.tw.pageState.getAllowedPages().isDashboardTemplate()},t.isHomeScreen=function(){return P()&&i.tw.pageState.getAllowedPages().isHomeScreen()},t.isMonitor=function(){return P()&&i.tw.pageState.getAllowedPages().isMonitor()},t.isReport=function(){return P()&&i.tw.pageState.getAllowedPages().isReport()},t.isSearch=function(){return P()&&i.tw.pageState.getAllowedPages().isSearch()},t.isSearchAdvanced=function(){return P()&&i.tw.pageState.getAllowedPages().isSearchAdvanced()},t.isEmbeddedWidgetEditMode=function(){return P()&&i.tw.pageState.getAllowedPages().getGroupPage()===constants.group_page.embedded_widget},t.isWidgetEditMode=function(){return P()&&i.tw.pageState.getAllowedPages().getGroupPage()===constants.group_page.widget_edit},t.isDashboardPage=function(){return t.isDashboard()&&i.tw.pageState.getAllowedPages().getPageType()},t.isDashboardTemplatePage=function(){return t.isDashboardTemplate()&&i.tw.pageState.getAllowedPages().getPageType()},function(){t.model=void 0,t.accounts=[],t.cleanUp=[],S.navbarService.load(t.navbarOptions).then(F),t.cleanUp.push(d.twRoutingService.onPageChangeEnd.subscribe((e,i)=>{void 0!==e&&e.getId()!==i.getId()&&(t.selectedTab=void 0,S.navbarService.setFilterState(S.FilterState.CLOSE),void 0!==e&&e.getId()!==i.getId()&&O(i))}).cancel),t.cleanUp.push(d.twRoutingService.onContextChange.subscribe((e,t,i)=>{O(i)}).cancel);const e=f.brokerService.subscribe(constants.events.bookmarks.add,e=>{k(e)});$(document).on("scroll",N),t.$on("$destroy",()=>{$(document).off("scroll",N),f.brokerService.unsubscribe(constants.events.bookmarks.add,e),_.invoke(t.cleanUp,"call")}),setTimeout(()=>{O(d.twRoutingService.getActivePage())})}(),t.showSaveDefaultView=function(){return angular.isDefined(t.model)&&t.model.can_save_project_view&&(t.isMonitor()||t.isDashboardPage()||t.isDashboardTemplatePage()||t.isSearch())},t.showDefaultViewList=function(){return angular.isDefined(t.model)&&t.hasProjectViews()&&t.model.can_change_project},t.getLabelIfNotActive=function(e){return t.isTabActive(e)?"":e.label},t.getTranslation=function(e){return e?"string"==typeof e?constants.navbar.filter_translation[e]:constants.navbar.filter_translation[e.type]:""},t.openAccountSwitch=function(e){$(e.currentTarget).find("#accountSwitchMenu").dropdown("toggle"),e.stopPropagation()},t.openRightDropdown=function(e){$(e.currentTarget).find("#rightDropdown").dropdown("toggle"),e.stopPropagation()},t.openTabMenu=function(e,t){$(t.currentTarget).find("#groupSubMenu").dropdown("toggle"),t.stopPropagation()},t.isPageTab=function(e){return e.group_page_style===constants.navbar.tab_style.page},t.isMenuTab=function(e){return e.group_page_style===constants.navbar.tab_style.menu},t.unselectFilters=function(e){e.stopPropagation(),n.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection),s.filterService.clearFilters(),g.dispatcher.dispatch(u.filterMenuActions.verticalFilters_onFiltersCleared,{})},t.openFilters=function(){n.bubbleDialogService.destroyById(constants.bubble_dialog.id.topic_menu_message),$(window).scrollTop(0),S.navbarService.getFilterState()===S.FilterState.OPEN?S.navbarService.setFilterState(S.FilterState.CLOSE):S.navbarService.setFilterState(S.FilterState.OPEN)},t.openSelectedFilters=function(e){angular.isUndefined(n.bubbleDialogService.getFirstBubbleById(constants.bubble_dialog.id.filters.selection))?n.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,e.target,b.mainApplication.getPageState().getUserFilterSettings(),o.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1):t.getMenusSetList().length>0&&t.cancelSelectedFilterClose()},t.attemptCloseSelectedFilters=function(){n.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.filters.selection,500)},t.cancelSelectedFilterClose=function(){n.bubbleDialogService.cancelDestructionById(constants.bubble_dialog.id.filters.selection)},t.isTabActive=function(e){return void 0!==t.selectedTab?t.selectedTab===e:I(e.group_page_type)&&e.distinct_on_page_category?e.page_category===(b.mainApplication.hasPageState()&&b.mainApplication.getPageState().getAllowedPages().getPageCategory()):I(e.group_page_type)},t.getMenusSetList=function(){return s.filterService.getClearableFilters()},t.hasProjectViews=function(){return t.model&&t.model.project_views&&t.model.project_views.length>0},t.getProjectViews=function(){return t.model.project_views},t.saveDefaultView=function(){const e={title:v.contextData.getMessage("_563451"),make_default:!1};l.modalService.display("SAVE_VIEW",e).then(function(e){k(e.new_view)})},t.openView=function(e){t.ignoreOpenDefault=!0,r.navigationService.loadBookmark(e)},t.openDefaultView=function(){t.ignoreOpenDefault?t.ignoreOpenDefault=!1:void 0!==t.getProjectViews()&&t.getProjectViews().length>0&&(r.navigationService.loadBookmark(t.getProjectViews()[0].id),c.restFormService.get(routes.controllers.tw.TWRestForm.get(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"bookmark","update","","rform").url).then(function(e){void 0!==e.view_id&&r.navigationService.loadBookmark(e.view_id)}))},t.isEditMode=function(){return P()&&i.tw.pageState.isEditMode()&&!t.selectedTab},t.isTopicSetup=function(e){return e===constants.group_page.topic_setup},t.isCommandCenterSetup=function(e){return e===constants.group_page.command_center},t.isReportLayoutMode=function(e){return i.tw.pageState&&i.tw.pageState.getAllowedPages().isReport()&&i.tw.pageState.getAllowedPages().getPageType()===constants.page_type.report_layout},t.returnToCommandCenterOverview=function(e,n){t.redirect(e,n,{cc:i.tw.pageState.getUserFilterSettings().getTopicMenuByType("COMMAND_CENTER").getFirstSelectedEntryRecursively().getParent().getMappedId()})},t.returnToReports=function(e,i){t.redirect(e,i)},t.closeEditMode=async function(){b.mainApplication.getPageState().setEditMode(!1),i.tw.pageState.hasAllowedPages()&&i.tw.pageState.getAllowedPages().isDashboard()&&i.tw.pageState.isGridPage()?d.twRoutingService.refresh({applicationRefresh:!1,forceRebuild:!0}):await L("Error when refreshing page state after closing edit mode !")},t.getNumLeftMenuElements=function(){let e=0;return t.model.all_accounts_projects.visible&&e++,_.each(t.model.all_accounts_projects.children,function(t){++e,_.each(t.children,function(){++e})}),e},t.computeLeftMenuHeight=function(e,i){let n,s,o,r=t.getNumLeftMenuElements();return s=e*i,o=r*i,n=_.min([o,s]),r-e>0&&(n+=5),n},t.isDeletedMode=function(){if(P()&&b.mainApplication.getPageState().hasUserFilterSettings()){const e=b.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.deleted_results_option);return void 0!==e&&e.getRootEntry().getChildren()[0].isSelected()}return!1},t.closeDeletedMode=function(){r.navigationService.toggleDeletedMode(!1)},t.saveAlertPageState=function(){const e=i.tw.pageState.getParentId(),n={new_page_state:i.tw.pageState.toProto()},s=routes.controllers.tw.TWRestForm.get(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"alert_edit_mode","update",e,"rform").url;c.restFormService.post(s,n).then(function(){t.closeAlertEditMode()},function(e){p.notificationService.display(e.notification)})},t.closeAlertEditMode=function(){const e=i.tw.pageState.toProto(),t={requested_handler:constants.routing.reports,requested_parameters:{a:e.allowed_pages.application,am:e.allowed_pages.module,id:e.sub_ids[0],page:constants.page_type.report_schedule}},n=routes.controllers.tw.TWRestForm.get(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"routing_service","create","","rform").url;c.restFormService.post(n,t).then(function(e){angular.isDefined(e.url)&&d.twRoutingService.changePageByUrl(e.url)})},t.updateWidgetDic=function(){const e=i.tw.pageState.toProto(),n=b.mainApplication.getPageState().getAllowedPages().isDashboard()?b.mainApplication.getPageState().getAllowedPages().getCustomPageId():"",s=routes.controllers.tw.TWRestForm.post(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"custom_page_widget_dashboards","update",n,"rform").url,o={page_state:e,update_from_page_state:!0};c.restFormService.post(s,o).then(function(){t.closeWidgetEditMode()},function(e){p.notificationService.display(e.notification)})},t.closeWidgetEditMode=function(){const e={requested_handler:constants.routing.dashboards,requested_parameters:{id:i.tw.pageState.getParentId(),e:"true"}},t=routes.controllers.tw.TWRestForm.get(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"routing_service","create","","rform").url;c.restFormService.post(t,e).then(function(e){angular.isDefined(e.url)&&(window.location.href=e.url)})},t.updateEmbeddedWidgetDic=function(){m.embeddedWidgetService.update(i.tw.pageState).then(function(){t.closeEmbeddedWidgetEditMode()},function(e){p.notificationService.display(e.notification)})},t.closeEmbeddedWidgetEditMode=function(){const e=i.tw.pageState.toProto(),t=routes.controllers.tw.TWRestForm.get(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"embedded_widget","edit",e.sub_ids[0],"settings").url;d.twRoutingService.changePageById(constants.sub_pages.settings.page.id,a.contextService.changeOldUrl(t))},t.isEditFiltersPage=function(){return b.mainApplication.getPageState().getAllowedPages().isEditFiltersPage()},t.saveEditFiltersPage=function(){const e=b.mainApplication.getPageState().toProto(),t=routes.controllers.tw.TWRestForm.post(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"page_state_edit","update",void 0!==e.parent_id?e.parent_id:"","settings").url,i={page_state:e};c.restFormService.post(t,i).then(function(e){"SETTINGS"===constants.sub_pages.settings.page.id&&(e.result.url="url="+e.result.url);d.twRoutingService.changePageById(constants.sub_pages.settings.page.id,e.result.url)},function(e){p.notificationService.display(e.notification)})},t.closeEditFiltersPage=function(){const e=b.mainApplication.getPageState().toProto(),t=routes.controllers.tw.TWRestForm.post(a.contextService.getCurrentContext().scope,a.contextService.getCurrentContext().id,"page_state_edit","dismiss",e.parent_id,"settings").url,i={page_state:e};c.restFormService.post(t,i).then(function(e){d.twRoutingService.changePageById(constants.sub_pages.settings.page.id,e.result.url)},function(e){p.notificationService.display(e.notification)})},t.getQuery=function(e){return e===constants.root_id.searchbar?b.mainApplication.getPageState().getUserFilterSettings().getSearchbarFilter().getQuery():void 0},t.getSelectedEntries=function(e){let t;if(angular.isDefined(e.topicMenus)){t=h.getSelectedEntries(e.topicMenus[0].root_entry);for(let i=1;i<e.topicMenus.length;i++)t.push.apply(t,h.getSelectedEntries(e.topicMenus[i].root_entry))}else t=h.getSelectedEntries(e.root_entry);return t},t.canShowFilters=function(){if(P()&&i.tw.pageState.hasUserFilterSettings()){const e=i.tw.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.topic_pm_composed),t=i.tw.pageState.getUserFilterSettings().canShowFilters();return t||!t&&void 0!==e&&!e.isDisabled()}return!1},t.canShowTabName=function(){return!D.applicationMode.isMobile()&&(!t.isReport()||t.isReport()&&t.canShowFilters()&&(!t.showOpenFilter||t.showOpenFilter&&0===t.getMenusSetList().length))},t.showShortClearMessage=function(){return D.applicationMode.isMobile()},t.getValidUrl=function(e){return e||"#"},t.changePage=function(e,i,n,s){return s&&(e=window.location.pathname+e),n.preventDefault(),angular.isDefined(e)&&(x(t.model.all_accounts_projects,i,t.model),d.twRoutingService.changePageByUrl(e)),!1};const x=function(e,t,i){e.mapped_id===t&&(e.selected=!0,i.project_title=e.title);for(let n=0;n<e.children.length;n++){const s=e.children[n];s.mapped_id===t?(s.selected=!0,i.project_title=s.title):s.selected=!1,void 0!==s.children&&s.children.length>0&&x(s,t,i)}};function R(){return v.contextData.rules.isAcademyEnabled()}function F(e){t.model=e.getModel(),void 0!==d.twRoutingService.getGroupPage()&&(t.model.group_pages||[]).forEach(e=>{e.filters_open_by_default&&t.openFilters(!0)})}function O(e){t.navbarOptions.setGroupPage(e.getGroupPage()),S.navbarService.reload(t.navbarOptions).then(F)}function k(e){t.model.project_views.push(e)}function N(){const e=$("#filters");if(S.navbarService.getFilterState()===S.FilterState.OPEN&&e.length){const i={};i.top=$(window).scrollTop(),i.bottom=i.top+$(window).height();const n={};n.top=e.offset().top,n.bottom=n.top+e.outerHeight(),n.top<=i.bottom&&n.bottom>=i.top||t.$apply(()=>{t.openFilters(!1)})}}async function L(e){const t={strategy:C.ModelRefreshStrategy.REFRESH},i=T.modelRefreshDecoratorFactory.getDecorator(b.mainApplication.getPageState(),b.mainApplication,M.ModelType.PAGE_STATE,t);try{await w.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&E.logService.error(e,void 0,t)}}t.redirect=async function(i,n,o){n.preventDefault(),f.brokerService.publish(constants.sidebar.reset_active_status,[!0]),S.navbarService.setFilterState(S.FilterState.CLOSE),s.filterService.clearMenusSetList(),t.isTabActive(i)&&i.reload_if_clicked?d.twRoutingService.getActivePage()instanceof y.PageStatePage&&await L("Error when refreshing page state when clicking active tab !"):(t.selectedTab=i,await d.twRoutingService.changePageByUrl(i.url,o),e.$$phase||e.$apply())},t.isVisibleToUser=function(){return!0!==v.contextData.userSettings.inconspicuous},t.isValidUrl=function(e){return void 0!==e},t.goToUrl=((e,t)=>{t.preventDefault(),window.location.href=e}),t.canShowMobileNavigation=(()=>D.applicationMode.hasMobileUserAgent()&&(!P()||i.tw.pageState.getAllowedPages().isDashboard())),t.isMobileMode=(()=>D.applicationMode.isMobile()),t.toggleMobileMode=(()=>{t.isMobileMode()?async function(){try{await async function(){const e=o.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.confirmation).clone(),t=$(document).innerWidth();return e.minWidth=Math.min(t-20,e.minWidth),e.maxWidth=t,A.confirmationService.display({message:v.contextData.getMessage("_1452223")},void 0,e)}(),D.applicationMode.setMobileMode(!1)}catch(e){}}():D.applicationMode.setMobileMode(!0)})}}]}),define("components/on_error_callback/directive",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"A",scope:{callback:"&twOnErrorCallback",data:"=twOnErrorCallbackData"},link:function(e,t,n){const s=e.callback()?e.callback():i.noop;t.on("error",function(){s(t,e.data)}),setTimeout(function(){if(!n.ngSrc)return s(t,e.data)},150)}}}}),define("components/on_error_src/directive",["require","exports","classes/context_data/context_data"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const n=i.contextData;t.default=function(){return{restrict:"A",link:function(e,t,i){function s(t){t[0].src=i.twOnErrorSrc,void 0!==i.twOnErrorClass&&(t.addClass(i.twOnErrorClass),void 0!==i.twOnErrorWatch&&function(t){void 0!==e.watcher&&e.watcher(),e.watcher=e.$watch(function(){return t.attr("src")},function(e){void 0!==i.twOnErrorClass&&e!==i.twOnErrorSrc&&t.removeClass(i.twOnErrorClass)})}(t))}n.projectSettings.branding.is_branded||(i.ngSrc||i.boSrc||s(t),t.on("error",function(){s(t)}))}}}}),define("components/pack/directive",["require","exports","canvas_engine","components/tools/data_graph","components/tools/results","data_structures","event_bus","reusable_services","reusable_utilities","widget_base","classes/application/application","classes/color_palette_builder/pack_chart_color_palette_builder","services/theme","services/template_source","canvas_chart_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){return[function(){return e.$inject=["$scope","$element","$rootScope","TwPackChart","TwDataSet","TwDataModel","TwDataGaugeSettings","TwPackChartModel","twNumberFormatter","TwDataGauge"],{restrict:"EA",replace:!0,scope:{fragment:"=",mediator:"=",widget:"="},controller:e,templateUrl:p.templateSourceFactory("components/pack")};function e(e,t,p,m,f,y,v,S,b,w){e.loaded=!1;const C=new c.CancellationToken;C.subscribeToStream(r.eventBus,r.EVENT_TYPES.SET_WIDGET_EDIT,t=>{t.value.id===e.widget.getId()&&e.redrawWidget(e.drawSettings)}),e.chart=void 0,e.canvas=void 0,e.dragging=!1,e.mouseInCanvas=!1,e.drawSettings=void 0,e.minUnscaledMetricsWidth=450,e.fragment.attach(e,t),e.noMetrics=e.widget.getDataTypeUuid()===constants.data_type.theme_tree,e.noTree=e.widget.getMenu().getCompatibleDataTypes().getSelectedEntriesRecursively()[0].getMappedId()===constants.data_type.theme_tree_only_trends,e.redrawWidget=function(r){e.drawSettings=r,e.series=[],e.destroyChart(),e.legendEnabled=!1;const E=r.dimensions.width;let T;e.metricsScale=r.dimensions.height<=155||r.dimensions.width<=e.minUnscaledMetricsWidth?Math.min(r.dimensions.height/155,r.dimensions.width/e.minUnscaledMetricsWidth):1,e.metricsSize=155*e.metricsScale,e.noMetrics?T=r.dimensions.height:(T=r.dimensions.height-e.metricsSize-15,function(i,n){t.find(".top-themes-variation").css({"transform-origin":"top left",width:i/e.metricsScale+"px"}),t.find(".top-themes-variation").css("transform","scale("+e.metricsScale+")"),e.metricsScale<1?t.find(".chart-container").css("transform","translate(0px,-"+(160-e.metricsSize)+"px)"):t.find(".chart-container").css("transform","translate(0px,-15px)")}(E)),r.heightMode===l.WidgetHeightMode.LEGACY&&(T=Math.max(500,T)),function(){const t=new n.default(e.widget.getPayloadValue().emerging_themes);let r;e.emergingThemesList=[],e.emergingThemesTitle=t.total_label,_.each(t.getRows(),function(i){const n=t.getCell(i,0);constants.project.settings.showComparisonWithPreviousPeriod&&(r=new o.Tendency(n.numeric_data,n.numeric_data_old).build()),e.emergingThemesList.push({label:i.label,value:b.getInstance().toDecimal(n.numeric_data),change:r})}),0===e.emergingThemesList.length&&e.emergingThemesList.push({label:i.Constants.SpecialCharacters.LongMinus,value:0,change:s.default.constructor.getValueChange()});const a=new n.default(e.widget.getPayloadValue().decreasing_themes);e.decreasingThemesList=[],e.decreasingThemesTitle=a.total_label,_.each(a.getRows(),function(t){const i=a.getCell(t,0);constants.project.settings.showComparisonWithPreviousPeriod&&(r=new o.Tendency(i.numeric_data,i.numeric_data_old).build()),e.decreasingThemesList.push({label:t.label,value:b.getInstance().toDecimal(i.numeric_data),change:r})}),0===e.decreasingThemesList.length&&e.decreasingThemesList.push({label:i.Constants.SpecialCharacters.LongMinus,value:0,change:s.default.constructor.getValueChange()});const c=new n.default(e.widget.getPayloadValue().new_themes);e.newThemesList=[],e.newThemesTitle=c.total_label,_.each(c.getRows(),function(t){const i=c.getCell(t,0);constants.project.settings.showComparisonWithPreviousPeriod&&(r=new o.Tendency(i.numeric_data,i.numeric_data_old).build()),e.newThemesList.push({label:t.label,value:b.getInstance().toDecimal(i.numeric_data),change:r})}),0===e.newThemesList.length&&e.newThemesList.push({label:i.Constants.SpecialCharacters.LongMinus,value:0,change:s.default.constructor.getValueChange()});p.$$phase||p.$apply();e.$on("$destroy",function(){e.destroyChart(),e.removeEvents(),e.widget=void 0,C.cancel()})}();const M=JSON.parse(JSON.stringify(e.widget.getPayloadValue()));let P,D;if(_.isUndefined(M)||(P=M.tree),_.isUndefined(P)||(D=P.root),!_.isUndefined(D)){if(e.legendEnabled=!0,e.noMetrics||setTimeout(()=>{e.emergingThemesListElement=t.find(".col-xs-4")[0],e.decreasingThemesListElement=t.find(".col-xs-4")[1],e.newThemesListElement=t.find(".col-xs-4")[2],function(t,i){_.forEach(t,function(e){_.forEach($(e).find("li"),function(e){const t=$(e).find(".name")[0];let i=a.emojiService.parseTextForEmoji(t.innerHTML);for(;i.indexOf("&#039;")>=0;)i=i.replace("&#039;","'");i!==t.innerHTML&&(t.innerHTML=i.substring(0,i.indexOf("<")),t.appendChild($(i.substring(i.indexOf("<")))[0]))})}),function(t,i){_.forEach(t,function(t,n){$(t).css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}),$(t).css({width:Math.floor(i/3)/e.metricsScale+"px","padding-left":"0px","padding-right":"0px"})})}(t,i)}([e.emergingThemesListElement,e.decreasingThemesListElement,e.newThemesListElement],E)}),T>=0){const n=P.meta_data.attributes.bounding_box,s=(n.bottom_right_x-n.top_left_x)/2,o=(n.top_left_y-n.bottom_right_y)/2,a=Math.abs(n.bottom_right_x)-Math.abs(n.top_left_x),l=Math.abs(n.top_left_y)-Math.abs(n.bottom_right_y),p=.95,b=Math.min(T/o,E/s)*p/2,C=new i.LabelSettings(!0,3," ");C.setOrigin(i.Constants.Origin.CENTER_TOP).setAdaptive(!0).setTextBaseLine(i.Constants.TextBaseLine.MIDDLE);const A=(E-b*a)/2,I=(T-b*l)/2,x=new i.Presence(A,I,i.Constants.Origin.TOP_LEFT);x.setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Outside).setStyle(i.Style.Radius,b);const R=new S(M,e.emergingThemesListElement,e.decreasingThemesListElement,e.newThemesListElement),F=e.widget.getMenu().getThemeOptionsMenu(),O=F?F.getFirstSelectedEntry():void 0;let k;void 0!==O&&(k=O.getMappedId());const N=new h.PackChartSettings(R,C,k);N.setTransitionDuration(r.animationDuration),N.setAnimationDuration(300),N.enableInitialAnimation(0!==r.animationStrategy);const L=new g.PackChartColorPaletteBuilder(u.themeService.getCurrentThemeId()).build(),B=d.mainApplication.getPageState().getAllowedPages();if(B.isInstantDiscovery()&&N.setParentNameDrawing(!1),e.chart=new m(x,e.widget,N,L),e.noTree)return e.legendEnabled=!1,Promise.resolve();{e.canvas=t.find(".chartCanvas")[0],e.canvas.style.position="relative";const n=i.Stage.build(e.canvas,E,T,60,i.StageSettings.fromJSON({layerAmount:5,cameraLayer:3,scale:r.style.resolutionScale}));e.stage=n.stage;const s=27,o=10,a=new i.Presence(o,o+(r.style.showWidgetUI||e.widget.isEditMode()?3*s:0),i.Constants.Origin.TOP_LEFT),l=(new i.LabelSettings).setColor(c.Color.WHITE()).setBorderColor(c.Color.WHITE()).setFontSize(16).setTextBaseLine(i.Constants.TextBaseLine.MIDDLE).setOrigin(i.Constants.Origin.CENTER_TOP);if(!e.widget.getPageState().getAllowedPages().isCommandCenter()&&!e.widget.isEmojiTree()&&void 0!==P.meta_data.attributes.legend){const t=P.meta_data.attributes.legend.legend,o=[];_.each(t.reverse(),function(t){let n;n=i.Utilities.mathSign(t.lower_bound)===i.Utilities.mathSign(t.upper_bound)?Math.abs(Math.abs(t.lower_bound)-Math.abs(t.upper_bound)):Math.abs(t.lower_bound)+Math.abs(t.upper_bound);let s=t.popover_footer;e.chart.getChartSettings().isSentiment()?o.push(new f(100*n,t.color,t.label).setSubLabel(t.unit).setData(t.node_ids).setPopoverFooter(s).setPopoverValue({total:t.metric,positive:t.count_positive,neutral:t.count_neutral,negative:t.count_negative})):e.chart.getChartSettings().isTrendingScore()?(l.setFontSize(11).setTextBaseLine(i.Constants.TextBaseLine.TOP).setOrigin(i.Constants.Origin.CENTER).setFontFamily(i.Constants.Font.Family.Digits).setOffset(new i.Point(0,1)),o.push(new f(100*n,t.color,t.label).setSubLabel(t.unit).setData(t.node_ids).setPopoverValue(t.metric).setColorVisibility(!1).setPopoverFooter(s))):(s=-1===t.lower_bound?"less than "+t.upper_bound_label:1===t.upper_bound?"more than "+t.lower_bound_label:t.lower_bound_label+" to "+t.upper_bound_label,o.push(new f(100*n,t.color,t.label).setSubLabel(D.metric.label).setData(t.node_ids).setPopoverValue(t.metric).setPopoverFooter(s)))});const c=new y(o);a.setStyle(i.Style.Width,s).setStyle(i.Style.Height,Math.min(5*s,b-(r.style.showWidgetUI||e.widget.isEditMode()?3*s:0))).setStyle(i.Style.Orientation,i.Constants.Orientation.VERTICAL);const d=new v(c,l,k);d.enableColorTween(!1).setAnimationDuration(300);const g=new w(a,e.widget,d);n.camera.addChild(g),e.chart.setEventParams(g)}n.camera.addFrame(2,c.Color.BLACK(0)),B.isReport()&&e.chart.disableDetails(),e.series=e.chart.getLegend(),e.camera=n.camera,n.camera.enableTranslation(),n.camera.enableZoom([i.Constants.ZoomType.Triggered]),(r.style.showWidgetUI||e.widget.isEditMode())&&n.camera.enableZoom([i.Constants.ZoomType.Button]),e.stage.unregisterEventRelay(i.Constants.StageEvents.MouseWheel);let d=e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.top_left;d=new i.Point(d&&d.x||0,d&&d.y||0),e.initialOffset=e.camera.getOffset(),d=d.add(e.initialOffset);let g=e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.top_right;(g=new i.Point(g&&g.x||0,g&&g.y||0)).setX(0!==g.getX()&&(e.stage.getWidth()-g.getX())/2||0).setY(0!==g.getY()&&(e.stage.getHeight()-g.getY())/2||0);const u=e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.bottom_right;let p=e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.overlay_active;_.isUndefined(p)&&(p=!0),e.chart.setOverlayStateActive(p);const h={cameraScale:1,cameraOffset:d,duration:void 0},m=$.Deferred();return e.addEvents(),n.scene.addChild(e.chart),e.stage.start(),e.chart.onReady.subscribeOnce(function(){_.isUndefined(u)?(e.animateChart(),e.stage.processUpdate(),m.resolve()):(e.chart.onOrderedZoom.subscribeOnce(function(t){e.animateChart(t)}),g.multiply(u.x),u.x>1&&(h.cameraOffset=d.subtract(g)),h.cameraScale*=u.x,h.duration=r.animationDuration,e.chart.scheduleOrderedZoom(h),requestAnimationFrame(function(){e.stage.processUpdate(),m.resolve()}))}),m.promise()}}return e.legendEnabled=!1,Promise.resolve()}},e.isEmojiSelection=function(){return e.widget.getMenu().getHashtagMenu().getFirstSelectedEntryRecursively().getMappedId()===constants.root_id.emoji},e.canShowLegend=function(){return e.legendEnabled&&!_.isUndefined(e.series)&&e.series.length>0},e.animateChart=function(t,i){requestAnimationFrame(function(){e.chart.animate(t,i,e.camera),requestAnimationFrame(function(){e.stage.processUpdate()})})},e.inflateEmergingThemesProxy=function(t){_.isUndefined(e.chart)||(e.chart.inflateEmergingThemes(t),e.highLightTheme(e.emergingThemesListElement,t))},e.inflateDecreasingThemesProxy=function(t){_.isUndefined(e.chart)||(e.chart.inflateDecreasingThemes(t),e.highLightTheme(e.decreasingThemesListElement,t))},e.inflateNewThemesProxy=function(t){_.isUndefined(e.chart)||(e.chart.inflateNewThemes(t),e.highLightTheme(e.newThemesListElement,t))},e.deflateCirclesDelayedProxy=function(){_.isUndefined(e.chart)||(e.chart._deflateCircles(),e.unselectThemes())},e.highLightTheme=function(t,i){if(e.noTree){const n=$(t).find("li");for(let t=0;t<n.length;t++){const s=n.eq(t).children("div.name");s.text()===i?s.css("background-color",e.chart.getThemeHighlightColor().toRGBAString()):s.css("background-color","")}}},e.unselectThemes=function(){if(e.noTree){const t=$(e.emergingThemesListElement).find("li");for(let e=0;e<t.length;e++)t.eq(e).children("div.name").css("background-color","");const i=$(e.decreasingThemesListElement).find("li");for(let e=0;e<i.length;e++)i.eq(e).children("div.name").css("background-color","");const n=$(e.newThemesListElement).find("li");for(let e=0;e<n.length;e++)n.eq(e).children("div.name").css("background-color","")}},e.openDrilldownProxy=function(t){_.isUndefined(e.chart)||e.chart.openDrilldownByValue(t)},e.saveSessionSettings=function(t){e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.top_left={x:t.offset.getX(),y:t.offset.getY()};const i=e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.bottom_right;_.isUndefined(i)||i.x===t.zoomLevelX&&i.y===t.zoomLevelY||e.chart.invalidate(),e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.bottom_right={x:t.zoomLevelX,y:t.zoomLevelY},e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.top_right={x:e.stage.getWidth(),y:e.stage.getHeight()},e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.center={x:e.chart.getPresence().getAbsoluteX(),y:e.chart.getPresence().getAbsoluteY()}},e.saveOverlayState=function(t){e.widget.getDic().primary_source.tw_multi_data_source.extended_configuration.overlay_active=t},e.addEvents=function(){_.isUndefined(e.canvas)||(e.cameraZoomEndSub=e.camera.onZoomEnd.subscribe(e.saveSessionSettings),e.cameraTranslateSub=e.camera.onTranslate.subscribe(e.saveSessionSettings),e.chartSub=e.chart.onOverlayStateChange.subscribe(e.saveOverlayState))},e.removeEvents=function(){_.isUndefined(e.canvas)||(e.cameraZoomEndSub.cancel(),e.cameraTranslateSub.cancel(),e.chartSub.cancel())},e.undoDrag=function(){e.dragging=!1},e.flipDrag=function(){e.dragging=!e.dragging},e.preventDefault=function(t){if(e.dragging)return t.preventDefault(),!1},e.mouseMove=function(t){if(e.dragging)return e.chart&&!e.mouseInCanvas&&e.chart.onMouseDrag.fire(t),t.preventDefault(),!1},e.destroyChart=function(){e.removeEvents(),_.isUndefined(e.stage)||(e.stage.dispose(),e.stage=void 0),_.isUndefined(e.canvas)||(e.canvas=void 0,e.dragging=!1,e.mouseInCanvas=!1),void 0!==e.chart&&e.chart.dispose()}}}]}),define("components/page/analytics_page/directive",["require","exports","classes/base_page","services/google_analytics","services/navigation","services/configuration","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/refresh/model_refresh_service","log","angular_utilities","services/template_source","services/resources/resources","services/resources/resource","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e=class extends i.default{constructor(e){super(e)}getPageControllerConfiguration(){return{}}$onInit(){super.$onInit();const e=r.mainApplication.getPageState().getUserFilterSettings();this.$scope.isMobile=function(){return _.applicationMode.isMobile()},this.$scope.try_our_award_wining_platform_now_badge=h.resourcesService.getImageUrl(m.ImageResource.tryOurAwardWiningPlatformNowBadgePng),this.$scope.deletedResultsOptionMenu=e.getTopicMenuByType(constants.topic_menu.TYPE.deleted_results_option),this.$scope.allowedPagesCompareTM=e.getTopicMenuByType(constants.topic_menu.TYPE.allowed_monitor_page_compare),this.$scope.goToTrial=(()=>{s.navigationService.goToTrial()}),this.$scope.compareChanged=(()=>{r.mainApplication.getPageState().getAllowedPages().setReload(!0),r.mainApplication.getPageState().getAllowedPages().setCompareSelected(this.$scope.allowedPagesCompareTM.getFirstSelectedEntry().getMappedId()),n.googleAnalyticsService.sendPageView(),function(){const e={strategy:c.ModelRefreshStrategy.REFRESH},t=a.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,l.ModelType.PAGE_STATE,e);d.modelRefreshService.refresh(t,e).then(()=>{},e=>{e instanceof Error&&g.logService.error("Error when refreshing page state after changing compare !",void 0,e)})}()}),this.$scope.toggleDeletedMode=(()=>{s.navigationService.toggleDeletedMode()}),this.$scope.canShowAllowedPages=(()=>o.configurationService.getPageConfiguration().canShowAllowedPages()),this.$scope.showCompare=(()=>!this.$scope.isEditMode()&&this.$scope.allowedPagesCompareTM&&this.$scope.allowedPagesCompareTM.getRootEntry().isVisible()&&this.$scope.allowedPagesCompareTM.getRootEntry().getChildrenCount()>0),this.$scope.canShowPageOptions=(()=>!this.$scope.isEditMode()&&o.configurationService.getPageConfiguration().canShowPageOptions()),this.$scope.canShowPoweredBy=(()=>window.context_data.projectSettings.branding.show_powered_by),this.$scope.getBranding=(()=>this.pageState.getProject().getBranding()),this.$scope.$on("$destroy",()=>{delete this.$scope.allowedPagesCompareTM,this.$scope.deletedResultsOptionMenu=void 0,this.$scope.allowedPagesCompareTM=void 0})}};return{replace:!1,scope:{pageData:"="},controller:e=__decorate([u.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],e),templateUrl:p.templateSourceFactory("components/page/analytics_page")}}}),define("components/page/command_center_screen_page/directive",["require","exports","angular","angular_utilities","event_bus","graphics_utilities","log","math_utils","reusable_utilities","underscore","classes/application/application","classes/base_page","classes/bubble_dialog/widget_dialog_config","classes/context_data/context_data","classes/grid/grid","classes/grid/grid_configuration","classes/grid/grid_slot_item","classes/grid/grid_toolbar_model","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","services/broker","services/browser_extension","services/bubble_dialog","services/command_center","services/fullscreen","services/live_refresh","services/presentation_service","services/refresh/model_refresh_service","services/theme","services/tw_common","services/tw_routing","services/widgets/widget_factory","wrappers/widget/widget_wrapper","services/template_source","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){return{replace:!1,scope:{pageData:"="},bindToController:{},controllerAs:"vm",controller:L,templateUrl:k.templateSourceFactory("components/page/command_center_screen_page")}};let L=class extends g.default{constructor(e,t,i){super(e),this.element=t,this.$scope=e,this.$timeout=i}getPageControllerConfiguration(){return{}}$onInit(){super.$onInit(),this.cancellationToken=new c.CancellationToken,this.dragAndDropEnabled=!0;const e=this.generateGridConfiguration();this.grid=new h.Grid(e),this.initialize(),this.cancellationToken.subscribe(this.grid.onRemoveSubItem,this.removeWidget.bind(this)),this.cancellationToken.subscribe(this.grid.onTransformItem,this.updateWidgets.bind(this)),this.cancellationToken.registerDisposable(this.grid),this.initializeToolbar(),this.sectionPredicate=this.displayOnlyEditSection.bind(this),this.subscribeClearOnExit()}async initialize(){this.setupWatcher(),!this.isEditMode()&&await C.browserExtensionService.isAvailable()&&(await M.fullscreenService.enableFullscreen(),this.setupFullscreen(this.getEffectiveStylesheet())),this.refreshWidgets(b.tw.pageState);const e=w.brokerService.subscribe(constants.events.page_state.received,e=>{if(e.getAllowedPages().isCommandCenter()){const t=this.generateGridConfiguration();return this.updateGridConfiguration(t),this.refreshWidgets(e)}});this.cancellationToken.registerCleanupFunction(()=>{w.brokerService.unsubscribe(constants.events.page_state.received,e)})}initializeToolbar(){N.applicationMode.getAppModeModelForCurrentMode().public||(this.cancellationToken.cancelChannel("TOOLBAR_CHANNEL"),this.cancellationToken.createChannel("TOOLBAR_CHANNEL"),f.GridToolbarModel.constructAsync().then(e=>{this.toolbarModel=e,this.cancellationToken.getChannel("TOOLBAR_CHANNEL").registerDisposable(e)}))}updateGridConfiguration(e){s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_UPDATE_CONFIGURATION,value:{id:e.id,configuration:e,rebuildItems:!0}})}generateGridConfiguration(){let e;D.presentationService.isPresentationEnabled||(e={gridDragAndDropReceiveChannels:["grid"],gridItemsDragAndDropChannels:["grid"],callbacks:{onDragStart:this.onDragStart.bind(this),onDragEnd:this.onDragEnd.bind(this),onSwap:this.onSwap.bind(this),onStack:this.onStack.bind(this)}});const t=d.mainApplication.getPageState().getScreenConfiguration();return{id:"grid",width:t.grid_width,height:t.grid_height,dropzonePlaceholders:{},restrictedAreas:[],style:this.getGridStyle(t,D.presentationService.isPresentationEnabled),gridItemOptions:{showPlaceholder:D.presentationService.isPresentationEnabled?m.PlaceholderMode.NEVER:m.PlaceholderMode.ALWAYS,interactive:!D.presentationService.isPresentationEnabled,selectable:!D.presentationService.isPresentationEnabled,swappable:!D.presentationService.isPresentationEnabled,stackable:!D.presentationService.isPresentationEnabled},gridActions:{onClone:this.cloneWidget.bind(this),onUnstack:this.unstackWidget.bind(this)},dragAndDrop:e}}getGridStyle(e,t){const i={grid:{},items:{showOutline:!1},background:{backgroundImage:e.background_image}};return t||(i.items.showOutline=!0,i.background.backgroundGrid={zoneGridColor:new o.Color(new a.Vector4D(200,200,200,255)),invalidGridColor:new o.Color(new a.Vector4D(255,0,0,255)),activeZoneGridColor:new o.Color(new a.Vector4D(0,0,0,84.15))}),i}refreshWidgets(e){this.widgets=e.getWidgetsByPredicate(e=>e.hasSlotConfiguration()&&!e.isTransitionWidget()),this.getGrid().addItems(_.GridSlotItem.generateSlotItems(this.widgets,_.GridSlotItem.getWidgetByIdFunction())),this.isFullscreen()&&(this.setupRotation(),this.setupSlideshow())}isFullscreen(){return M.fullscreenService.isFullscreen()}isFullscreenAllowed(){return!this.isFullscreen()&&M.fullscreenService.isFullscreenModeAllowed()}async openFullscreen(){const e=this.getEffectiveStylesheet();this.subscribeClearOnExit(),this.element.hide(),this.grid.clear(),b.tw.pageState.clearWidgets(!0),await M.fullscreenService.goFullscreen(void 0,!1),await T.commandCenterService.enterFullscreenMode(),await this.setupFullscreen(e)}async setupFullscreen(e){await this.setFullscreenTheme(e),d.mainApplication.getPageState().setEditMode(!1);try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after setting up fullscreen !",void 0,e)}this.element.show(),this.setupRotation(),this.setupSlideshow()}subscribeClearOnExit(){this.subscriptionOnFSExit||(this.cancellationToken.subscribeOnce(M.fullscreenService.onExit,()=>{this.getGrid().clear(),this.subscriptionOnFSExit=!1,I.themeService.changeTheme(I.themeService.getDefaultTheme()),this.clearRotation(),this.clearSlideshow(),this.initializeToolbar()}),this.subscriptionOnFSExit=!0)}async setFullscreenTheme(e){if(void 0!==e&&e!==I.themeService.getDefaultTheme().cssFile){const t=I.themeService.findThemeByCSSFile(e);await I.themeService.changeTheme(t)}}getEffectiveStylesheet(){const e=b.tw.pageState.getFirstWidgetByPredicate(e=>e.isPayloadEdition());if(e){const t=l.first(e.getPayloadValue().form_entries);return t&&t.element?t.element.effective_stylesheet:void 0}return b.tw.pageState.getStyleSheet()}async toggleEditMode(){d.mainApplication.getPageState().toggleEditMode();try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state when toggling edit mode !",void 0,e)}}isEditMode(){return b.tw.pageState.isEditMode()&&!this.isFullscreen()}getSelectedScreen(){const e=this.getCommandCenterScreens();return e&&e.getFirstSelectedEntryRecursively()}getCommandCenterScreens(){return d.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.command_center)}getGridConfiguration(){return this.grid.getConfiguration()}displayOnlyEditSection(e){return this.isEditMode()&&e.getWidgets().length&&e.getFirstWidget().isPayloadEdition()}getGrid(){return this.grid}onDragStart(e){E.bubbleDialogService.destroyAllNonPersistent()}async onDragEnd(e,t){try{-1===t.getCurrentItem().getSectionId()&&(this.dragAndDropEnabled=!1,await this.addNewWidget(e,t.getCurrentItem())),await this.updateWidgets()}finally{this.dragAndDropEnabled=!0}}async onSwap(e,t){return this.updateWidgets()}async onStack(e,t){if(-1===e.getCurrentItem().getSectionId()){const i=Object.assign({},l.omit(t.getSlotConfiguration(),["dimension_limit"]),{grid_z:t.getNextZPosition()}),n=await this.addNewWidget(i,e.getCurrentItem()),s=t.getCurrentItem().getId();this.getGrid().removeItemWithoutEvent(t);const o=this.getGrid().getItemsContainingSubItemId(s);return o.length>0&&o[0].next(),n}{const e=(new Date).getTime(),t=await this.updateWidgets(),i=Math.max(0,(new Date).getTime()-(e+750));return i>0?this.$timeout(l.noop,i,!0):this.$scope.$apply(),E.bubbleDialogService.destroyAllNonPersistent(),t}}async updateWidgets(){const e=b.tw.pageState.getWidgets().filter(e=>e.hasSlotConfiguration()).map(e=>e.prune(!1,!1).toProto());return await T.commandCenterService.updateWidgets({custom_page_id:this.getSelectedScreen().getMappedId(),dics:e})}async removeWidget(e){await T.commandCenterService.removeWidget({custom_page_id:this.getSelectedScreen().getMappedId(),widget_id:e.getId()}),b.tw.pageState.deleteWidget(e),this.widgets.splice(this.widgets.indexOf(e),1)}async unstackWidget(e){const t=e.getCurrentItem(),i=await T.commandCenterService.unstack({custom_page_id:this.getSelectedScreen().getMappedId(),dics:[t.toProto()]}),n=e.splitCurrent();n.updateSlotConfiguration(i.dics[0].slot_configuration),this.getGrid().addItem(n),e.validate()||await this.updateInvalidItems(e),E.bubbleDialogService.destroyAllNonPersistent()}async updateInvalidItems(e){return await T.commandCenterService.updateWidgets({custom_page_id:this.getSelectedScreen().getMappedId(),dics:e.getItems().map(e=>e.prune(!1,!1).toProto())})}async cloneWidget(e){const t=e.getCurrentItem(),i=await T.commandCenterService.cloneWidget({custom_page_id:this.getSelectedScreen().getMappedId(),widget_id:t.getId()});try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after cloning widget !",void 0,e)}return i}getLayoutTabHeading(){return p.contextData.getMessage("_1966345")}getSettingsTabHeading(){return p.contextData.getMessage("_1966346")}async addNewWidget(e,t){const i=F.widgetFactory.wrapWidget(t.getDic(),b.tw.pageState);i.updateSlotConfiguration(e);const n=b.tw.pageState.copyAndPrune(!0),s=await T.commandCenterService.addWidgetsToScreen({custom_page_id:this.getSelectedScreen().getMappedId(),page_state:n.toProto(),dics:[i.toProto()]});n.dispose();try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after adding new widget !",void 0,e)}return this.openWidgetPreview(this.findWidgetBySlotConfiguration(e)),s}openWidgetPreview(e){const t=e.clone(),i=new u.WidgetDialogConfig(e.getPageState(),{widgetToSend:t,ufs:e.getUf(),groupPage:"CONTEXT_MENU",pageType:"CONTEXT_COMMAND_CENTER_PREVIEW",mode:x.twCommon.WidgetBubbleMode.SINGLE_PAGE,showCompareBar:!1,showDrilldown:!1,forbidExpand:!0,displayFullSizeWidget:!0});i.getStyle().setWidth("90%").setMaxWidth(0),E.bubbleDialogService.destroyAllNonPersistent(),E.bubbleDialogService.createWidgetDialogBubble(i).onDestroy.subscribeOnce(async()=>{try{this.dragAndDropEnabled=!1,await this.refreshPageData(),this.getGrid().cleanupDuplicateSubItemsById(e.getId())}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after closing widget preview !",void 0,e)}finally{this.dragAndDropEnabled=!0}})}findWidgetBySlotConfiguration(e){const t=b.tw.pageState.getWidgetsByPredicate(t=>{const i=t.getSlotConfiguration();return void 0!==i&&i.grid_x===e.grid_x&&i.grid_y===e.grid_y&&(!e.grid_z||i.grid_z===e.grid_z)});return l.first(t)}isInvalidState(){return!this.isEditMode()&&!this.isFullscreen()&&!d.mainApplication.isLoading()}setupWatcher(){this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>this.isInvalidState(),async(e,t)=>{if(!0===e){R.twRoutingService.getActivePage();let e=!1;if(void 0===M.fullscreenService.fullscreenExitTs&&await C.browserExtensionService.isAvailable()&&(e=await C.browserExtensionService.forceFullscreenMode(!0),M.fullscreenService.enableFullscreen()),e){const e=this.getEffectiveStylesheet();await this.setFullscreenTheme(e)}else{d.mainApplication.getPageState().setEditMode(!0);try{await this.refreshPageData()}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after failed fullscreen !",void 0,e)}}}})),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}clearRotation(){void 0!==this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}animatedRotation(e){const t=e.getNextItem(),i=e.getCurrentItem(),n=t.getTemplate(),s=i.getTemplate();o.animate(i=>{n&&s&&(t.isArticles()&&t.clearCachedResults(),n.css({transform:`rotateY(${90-90*i}deg) translateZ(${s.width()/2}px)`}),s.css({transform:`rotateY(${-90*i}deg) translateZ(${n.width()/2}px)`})),i>=1&&e.next()},1e3)}setupRotation(){void 0===this.intervalHandle&&(this.getGrid().forEachItem(e=>{e.hasMultipleItems()&&e.setNextRotationTime(Date.now()+3e4)}),this.intervalHandle=setInterval(()=>{this.getGrid().forEachItem(async e=>{e.hasMultipleItems()&&Date.now()>e.getNextRotationTime()&&(e.setNextRotationTime(Date.now()+3e4),await c.waitFor(300*this.getGrid().indexOfItem(e)),this.animatedRotation(e))})},5e3),this.cancellationToken.registerCleanupFunction(()=>{this.clearRotation()}))}setupSlideshow(){const e=d.mainApplication.getPageState().getScreenConfiguration().slide_transition_time;r.logService.debug("Setting up CC slideshow",x.twCommon.logFeatures.CommandCenter,{slideShowHandle:this.slideShowHandle,transitionTime:e}),void 0!==e&&void 0===this.slideShowHandle?(this.startSlideshow(this.getSlideTransitionTime()),this.cancellationToken.registerCleanupFunction(()=>{this.clearSlideshow()})):r.logService.debug("Aborting CC slideshow setup",x.twCommon.logFeatures.CommandCenter,{slideShowHandle:this.slideShowHandle,transitionTime:e})}startSlideshow(e){r.logService.debug("Starting CC slideshow",x.twCommon.logFeatures.CommandCenter,{slideShowHandle:this.slideShowHandle,transitionTime:e}),this.slideShowHandle=setTimeout(()=>{this.clearSlideshow(),this.selectNextScreen()},e)}clearSlideshow(){void 0!==this.slideShowHandle&&(r.logService.debug("Clearing CC slideshow...",x.twCommon.logFeatures.CommandCenter,{slideShowHandle:this.slideShowHandle}),clearTimeout(this.slideShowHandle),this.slideShowHandle=void 0)}getSlideTransitionTime(){return 1e3*d.mainApplication.getPageState().getScreenConfiguration().slide_transition_time*60}selectNextScreen(){const e=this.getCommandCenterScreens();if(e){const t=e.getFirstSelectedEntryRecursively();t.unselectAndSelectNextSibling();const i=e.getFirstSelectedEntryRecursively();r.logService.debug("Selecting next CC screen",x.twCommon.logFeatures.CommandCenter,{currentScreenId:t.getMappedId(),nextScreenId:i&&i.getMappedId()}),P.liveRefreshService.pause(),R.twRoutingService.refresh({animationDuration:1e3,forceRebuild:!0,applicationRefresh:!0,noLoadingBubble:!0,waitForExitAnimationToFinishBeforeEntering:!0}),R.twRoutingService.onPageChangeEnd.subscribeOnce(()=>{P.liveRefreshService.resume()})}else r.logService.warn("Cannot find command center screen topic menu!")}async refreshPageData(){const e={strategy:v.ModelRefreshStrategy.REFRESH},t=y.modelRefreshDecoratorFactory.getDecorator(d.mainApplication.getPageState(),d.mainApplication,S.ModelType.PAGE_STATE,e);return await A.modelRefreshService.refresh(t,e)}isDragAndDropEnabled(){return this.dragAndDropEnabled}};__decorate([n.ngAsync(),__metadata("design:type",Function),__metadata("design:paramtypes",[O.WidgetWrapper]),__metadata("design:returntype",Promise)],L.prototype,"removeWidget",null),L=__decorate([n.ngInject(["$scope","$element","$timeout"]),__metadata("design:paramtypes",[Object,Object,Function])],L),t.CommandCenterScreenPageController=L}),define("components/page/content/directive",["require","exports","angular_utilities","log","reusable_utilities","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","services/application_mode","services/refresh/model_refresh_service","services/tw_common","classes/draggable/strategy/widgets_strategy","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,templateUrl:h.templateSourceFactory("components/page/content"),scope:{},bindToController:{sectionPredicate:"=?",loadMoreEnabledPredicate:"=?"},controllerAs:"vm",controller:m}};let m=class{constructor(e){this.$scope=e}$onInit(){this.cancellationToken=new s.CancellationToken,this.sectionPredicate=this.sectionPredicate||this.findLoadedVisibileSections,this.loadMoreEnabledPredicate=this.loadMoreEnabledPredicate||(()=>!0),this.cancellationToken.addDomEvent($(document),"wheel",()=>{document.body.scrollHeight-$(document.body).outerHeight()<20&&this.loadMore()}),this.cancellationToken.addCleanupFunction(this.$scope.$watch(()=>document.body.scrollTop/(document.body.scrollHeight-$(document.body).outerHeight()),e=>{e>.95&&this.loadMore()})),this.draggableStrategy=new p.DraggableWidgetsStrategy(_.noop,(e,t,i)=>{return!l.tw.pageState.getAllowedPages().isDashboard()&&!l.tw.pageState.getAllowedPages().isReport()||i!==u.twCommon.sides.CENTER||!e.canNest(t)||(t.addNestedWidget(e),!1)}),this.cancellationToken.registerDisposable(this.draggableStrategy),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}findLoadedVisibileSections(e){return e.isDataLoaded()&&!e.isHidden()}loadMore(){if(!this.loadMoreEnabledPredicate()||o.mainApplication.isLoading()||!o.mainApplication.hasPageState()||d.applicationMode.getCurrentAppMode()===d.AppMode.IMAGE_EXPORT)return;let e=l.tw.pageState.getNumberOfSectionsToLoad(),t=!1;l.tw.pageState.getSections().forEach(i=>{i.isDataLoaded()||e--<=0||i.getWidgets().forEach(e=>{e.isReloading()||(e.setReloading(!0),t=!0)})}),t&&this.loadMoreData()}serverDown(){return o.mainApplication.hasPageState()&&o.mainApplication.getPageState().isOffline()}hasPageMessage(){return o.mainApplication.hasPageState()&&o.mainApplication.getPageState().hasAllowedPages()&&o.mainApplication.getPageState().getAllowedPages().hasErrorMessage()}getPageMessage(){return o.mainApplication.getPageState().getAllowedPages().getErrorMessage()}getSections(){return void 0!==l.tw.pageState?l.tw.pageState.getSectionsByPredicate(this.sectionPredicate):void 0}isLoadingPage(){return o.mainApplication.isLoading()}isLoadingMore(){return o.mainApplication.hasPageState()&&o.mainApplication.getPageState().getWidgets().some(e=>e.isReloading()&&!e.isDataLoaded())}async loadMoreData(){const e={strategy:a.ModelRefreshStrategy.LOAD_MORE_CONTENT},t=r.modelRefreshDecoratorFactory.getDecorator(o.mainApplication.getPageState(),o.mainApplication,c.ModelType.PAGE_STATE,e);try{await g.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&n.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}};__decorate([s.debounce(50),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],m.prototype,"loadMore",null),m=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],m),t.PageContent=m}),define("components/page/dashboard_controller_picker/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.dashboardControllerPickerDirective=function(){return{controllerAs:"vm",bindToController:{pageData:"="},scope:{},controller:n,templateUrl:i.templateSourceFactory("components/page/dashboard_controller_picker")}};class n{isGridPage(){return this.pageData.isGridPage()}}}),define("components/page/dashboard_grid_controller/directive",["require","exports","angular_utilities","classnames","event_bus","graphics_utilities","math_utils","reusable_components","reusable_services","reusable_utilities","talkwalker_constants","classes/context_data/context_data","classes/custom_pages/pages/dashboard_page","classes/dashboard_actions/dashboard_actions","classes/dashboard_actions/dashboard_page_options_menu_factory","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_configuration","classes/grid/grid_page","classes/grid/grid_page_controller","classes/grid/grid_slot_item","constants/page_size_constants","other/tw","react_components/filter_menu/default_filter_bar_controller","services/confirmation_service","services/modal","services/pages/page_size_calculator","services/pin","services/template_source","services/widgets/widget_factory","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,controllerAs:"vm",scope:{},bindToController:{pageData:"="},controller:I,templateUrl:P.templateSourceFactory("components/page/dashboard_grid_controller")}};let I=class extends y.GridPageController{constructor(e,t){super(e,t),this.$scope=e,this.showFilters=!1,this.pageClasses=["dashboard-grid"],this.pageOptionIcons={legacy_revert:{icon:"fa fa-undo",className:"page-option-entry-icon"},edit_toggle:{className:"page-option-entry-icon",icon:"fa fa-gear"},user_accesss:{className:"page-option-entry-icon",icon:"fa fa-users"},override_filters:{className:"page-option-entry-icon",icon:"fa fa-save"},clone:{className:"page-option-entry-icon",icon:"fa fa-files-o"},add_to_new_report:{className:"page-option-entry-icon",icon:"fa icon2-tw-report-add clickable"},add_to_existing_report:{className:"page-option-entry-icon",icon:"fa icon2-tw-report-add clickable"},alert_creation:{className:"page-option-entry-icon",icon:"icon2-tw-alert-add"},share:{className:"page-option-entry-icon",icon:"icon2-tw-share"}}}getPageControllerConfiguration(){const e={respondToWidgetOverflow:!1,anchorConfiguration:{type:this.getAnchorType(),options:{previewScale:.14,gridWidth:S.PAGE_WITH_INTEGRATED_ANCHORS_WIDTH}},pageFilters:{enableFilterTypesReset:!0,userFilterSettings:this.pageData.getUserFilterSettings(),filterBarController:new w.DefaultFilterBarController,allowedFilterTypes:this.pageData.getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).map(e=>e.getType())},enableKeyNavigation:!1,sidebar:{previewAnchor:{deleteAction:this.deleteSlide.bind(this),moveItemToPageAction:this.moveItemToSlide.bind(this),addAction:this.addSlide.bind(this),editAction:this.editSlide.bind(this)}}};return this.pageState.isEditMode()?this.getEditModeConrollerConfiguration(e):e}getPageClass(){const e=super.getPageClass();return n({[e]:!0,"edit-mode":this.wasCreatedInEditMode})}getToolbarStyle(){let e=95;return this.canShowFilterBar()&&(e+=41),e>56?{top:`${e}px`}:void 0}getPageContainerStyle(){let e=56;return this.canShowFilterBar()&&(e+=41),this.wasCreatedInEditMode&&(e+=50),e>56?{top:`${e}px`}:void 0}getEditModeConrollerConfiguration(e){return e.toolbar={},e}$onInit(){super.$onInit(),this.pageOptionsProps=h.DashboardPageOptionsMenuFactory.buildDashboardPageOptionsMenuProps(this.pageState),this.wasCreatedInEditMode=this.pageData.isEditMode(),this.dashboards=this.pageData.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.dashboard),document.title+=" - "+this.getSelectedDashboard().getName(),setTimeout(()=>{this.adjustSizeToFitContent(this.wasCreatedInEditMode?1:0),this.recomputeGridSize()},600)}async addSlide(){const e={icon:{type:d.PageIcon.CUSTOM,customIconData:{type:a.CustomPageIconType.FROM_TITLE}},pageTitle:g.contextData.getMessage("_451202")};return E.modalService.display("DASHBOARD_PAGE_SETTINGS",{icon:e,pageNumber:this.pageData.getPageConfiguration().pages.length+1},{keepBubbleDialogs:!0}).then(async e=>{const t={title:e.pageTitle,icon:e.icon.type,custom_icon_data:e.icon.customIconData?{type:e.icon.customIconData.type,content:e.icon.customIconData.content}:void 0},{page:i}=(await new u.DashboardPage({}).createSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),anchor:t})).dashboard_container;i.grid||(i.grid={width:24,height:12,aspect_ratio:1}),this.pageData.getPageConfiguration().pages.push(i);const n=f.GridPage.generateGridPage(i,this.pageData.getWidgets().filter(e=>!e.isPayloadEdition()),this.generateGridConfiguration(i.grid,i.id),this.gridPageCollection.size+1,v.GridSlotItem.getWidgetByIdFunction(this.pageData));return this.gridPageCollection.addPage(n),this.gridPageCollection.setPageConfig(this.pageData.getPageConfiguration()),b.tw.inject("$rootScope").$applyAsync(),i})}async editSlide(e){b.tw.inject("$rootScope").$applyAsync();const t=this.pageData.getPageConfiguration().pages.find(t=>t.id===e.id),i=this.pageData.getPageConfiguration().pages.indexOf(t)+1;return E.modalService.display("DASHBOARD_PAGE_SETTINGS",{icon:e.icon,pageNumber:i},{keepBubbleDialogs:!0}).then(async e=>{const i={title:e.pageTitle,icon:e.icon.type,custom_icon_data:e.icon.customIconData?{type:e.icon.customIconData.type,content:e.icon.customIconData.content}:void 0},n=await new u.DashboardPage({}).updateSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),page:t,anchor:i});Object.assign(n.dashboard_container.page.anchor_metadata,i);const o=this.pageData.getPageConfiguration().pages.find(e=>e.id===t.id);Object.assign(o,n.dashboard_container.page),this.gridPageCollection.getPages().find(e=>e.getId()===o.id).setAnchorMetadata(i),s.eventBus.dispatch({type:s.EVENT_TYPES.ANCHOR_MODEL_CHANGED,value:this.getPreviewAnchorModel()})})}getPreviewAnchorModel(){const{width:e,height:t}=T.pageSizeCalculatorService.getGridCellSize(this.pageState,T.pageSizeCalculatorService.getCurrentGrid(this.pageData.getPageConfiguration())),i=super.getPreviewAnchorModel();return i.nodeSize.x=210,i.nodeSize.y=void 0,i.gridCellSize=new r.Vector2D(e,t),i.nodes.forEach(e=>{const t=this.gridPageCollection.getPages().find(t=>t.getId()===e.id);e.icon={icon:t.getPageIconModel(),pageTitle:t.getAnchorTitle()},e.gridSize=new r.Vector2D(t.getGrid().getWidth(),t.getGrid().getHeight())}),i}async deleteSlide(e){return b.tw.inject("$rootScope").$applyAsync(),C.confirmationService.display({message:g.contextData.getMessage("_1847324")}).then(async()=>{const t=this.pageData.getPageConfiguration().pages.find(t=>t.id===e.id);await new u.DashboardPage({}).removeSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),page:t}),this.pageData.getPageConfiguration().pages.splice(this.pageData.getPageConfiguration().pages.indexOf(t),1),s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_PAGE_REMOVE,value:t}),b.tw.inject("$rootScope").$applyAsync()})}onGridSizeChange(){this.recomputeGridSize()}async moveItemToSlide(e,t,i){const n=this.pageData.getPageConfiguration().pages.find(e=>e.id===i);if(!n)throw new Error(`Page ${i} is missing in pageState.`);const s=await new u.DashboardPage({}).changeWidgetSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),page:n,widget_to_move:{widget_id:e.getId()}});e.updateSlotConfiguration(s.dashboard_container.widget_to_move.slot_configuration)}isSharedDashboard(){return A.applicationMode.getCurrentAppMode()===A.AppMode.SHARED_DASHBOARD}createSubscriptions(){super.createSubscriptions(),this.cancellationToken.subscribe(this.gridPageCollection.onTransformItem,async(e,t)=>{const i=e.getSlotConfiguration();await this.updateWidgets([e],t.width!==i.width||t.height!==i.height)}),this.cancellationToken.subscribe(this.gridPageCollection.onSwapItem,async(e,t)=>{await this.updateWidgets([e,t])}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.WIDGET_DONE_DRAWING,e=>{const t=e.value.widget;if(t.hasSlotConfiguration()){const e=this.gridPageCollection.findPage(t.getSlotConfiguration().page);e&&e.getGrid().getItems().every(e=>e.getCurrentItem().isFullyLoaded())&&s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:e.getId()}})}}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.PAGE_STATE_BEFORE_MERGE,e=>{e.value.newPageState.setEditMode(this.wasCreatedInEditMode)}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.ANCHOR_PREVIEW_NODE_MOVED,async e=>{this.orderGridPages(e.value),await this.saveGridPagesOrder()}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,()=>{setTimeout(()=>{this.adjustSizeToFitContent(this.wasCreatedInEditMode?1:0),this.recomputeGridSize()})})}getPageBodyClass(){return""}canShowIconAnchorMenu(){return!this.wasCreatedInEditMode&&this.getIconAnchorModel()&&this.getIconAnchorModel().nodes&&this.getIconAnchorModel().nodes.length>1}canShowPreviewAnchor(){return this.wasCreatedInEditMode}getPageTitle(){return this.pageData.getAllowedPages().getDisplayingTitle()}canShowFilterBar(){return super.canShowPageFilters()||this.isSearchbarPinned()||this.canShowTimeFilter()}canShowTimeFilter(){return this.pageState.getUserFilterSettings().getTimeFilter().isPinned()}isSearchbarPinned(){return this.pageState.getUserFilterSettings().getSearchbarFilter().isPinned()}toggleEditMode(){p.DashboardActions.toggleEditMode(this.pageState)}generateGridConfiguration(e,t){return{width:e.width,height:e.height,id:t,restrictedAreas:[],dropzonePlaceholders:{},gridItemOptions:this.getGridItemOptions(),style:this.getGridStyle(),gridActions:this.getGridActions(),dragAndDrop:this.getDragAndDrop(t),multiSelect:!0}}handlePageStateRefresh(e){super.handlePageStateRefresh(e),M.pinService.initNumPinnedMenus(this.pageState)}getGridActions(){return{copyPaste:{channel:c.ClipboardChannel.GENERAL,onPaste:async e=>{if(e.isCutOperation)try{await this.moveWidgetToSlide(e.data.getCurrentItem(),this.getActivePageId(),e.data.getCurrentItem().getSlotConfiguration().page),c.clipboardService.clear(c.ClipboardChannel.GENERAL)}catch(e){}else this.copyWidgetToSlide(e.data.getCurrentItem(),this.getActivePageId())}}}}async copyWidgetToSlide(e,t){const i=this.pageData.getPageConfiguration().pages.find(e=>e.id===t),n=(await new u.DashboardPage({}).copyWidgetToSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),page:i,widget_to_move:{widget_id:e.getId()}})).dashboard_container.widget_to_move;this.fixClonedWidget(n,e);const o=D.widgetFactory.wrapWidget(n,this.pageData);this.pageData.getWidgets().push(o),s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:i.id,item:v.GridSlotItem.generateSlotItems([o],v.GridSlotItem.getWidgetByIdFunction(this.pageData))[0]}}),b.tw.inject("$rootScope").$applyAsync(),setTimeout(()=>{const e=this.gridPageCollection.findPage(i.id);e&&this.gridPageCollection.updatePreview(e)})}fixClonedWidget(e,t){e.payload=JSON.parse(JSON.stringify(t.getPayload())),e.menu=JSON.parse(JSON.stringify(t.getMenu().toProto())),e.display_title=t.getDisplayTitle(),e.saveable=t.canBeSaved();const i=e.primary_source;t.hasUf()&&((i.tw_data_source||i.tw_dynamic_source||i.tw_multi_data_source||i.tw_result_source).uf=JSON.parse(JSON.stringify(t.getUf().toProto()))),t.hasNestedDics()&&t.getNestedDics().forEach((i,n)=>{if(i.hasUf()){const i=e.nested_data_input_configurations[n].primary_source;(i.tw_data_source||i.tw_dynamic_source||i.tw_multi_data_source||i.tw_result_source).uf=JSON.parse(JSON.stringify(t.getUf().toProto()))}}),e.display_description=t.getDisplayDescription()}async moveWidgetToSlide(e,t,i){if(e.getSlotConfiguration().page!==t)try{const n=this.pageData.getPageConfiguration().pages.find(e=>e.id===t),o=await new u.DashboardPage({}).changeWidgetSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),page:n,widget_to_move:{widget_id:e.getId()}});s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_REMOVE_SUB_ITEM,value:{gridId:i,itemId:e.getId()}}),e.updateSlotConfiguration(o.dashboard_container.widget_to_move.slot_configuration),s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:n.id,item:v.GridSlotItem.generateSlotItems([e],v.GridSlotItem.getWidgetByIdFunction(this.pageData))[0]}}),b.tw.inject("$rootScope").$applyAsync(),setTimeout(()=>{const e=this.gridPageCollection.findPage(i),t=this.gridPageCollection.findPage(n.id);this.gridPageCollection.updatePreview(e),t&&this.gridPageCollection.updatePreview(t)})}catch(e){}}orderGridPages(e){const t=this.pageData.getPageConfiguration().pages.splice(e.oldIndex,1);this.pageData.getPageConfiguration().pages.splice(e.newIndex,0,t[0])}async saveGridPagesOrder(){await new u.DashboardPage({}).moveSlide({mapped_id:this.pageData.getAllowedPages().getCustomPageId(),pages:this.pageData.getPageConfiguration().pages})}getDragAndDrop(e){return this.pageState.isEditMode()?{expandGridAheadOfDragAndDrop:{down:5},callbacks:{onDragStart:()=>{},onDragEnd:async(e,t,i)=>{-1===t.getCurrentItem().getSectionId()&&await this.addNewWidget(e,t.getCurrentItem(),i)}},gridDragAndDropReceiveChannels:[e],gridItemsDragAndDropChannels:[e]}:void 0}async addNewWidget(e,t,i){const n=this.getActivePageId();e.page=n;const o=D.widgetFactory.wrapWidget(t.getDic(),this.pageData);o.updateSlotConfiguration(e);const r=await new u.DashboardPage({mapped_id:this.pageData.getAllowedPages().getCustomPageId()}).addWidgets([o],this.pageData),a=D.widgetFactory.wrapWidget(r.dashboard_widget_container.dics[0],this.pageData);o.setSectionId(1),o.setId(a.getId()),this.pageData.getWidgets().push(o),s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:n,item:v.GridSlotItem.generateSlotItems([o],v.GridSlotItem.getWidgetByIdFunction(this.pageData))[0],resize:!i}})}async updateWidgets(e,t=!0){try{this.$scope.$apply(),await l.PromiseUtils.cancellationPromise(l.waitFor(250),this.cancellationToken),this.adjustSizeToFitContent(this.wasCreatedInEditMode?1:0),await l.PromiseUtils.cancellationPromise(l.waitFor(250),this.cancellationToken),t?e.forEach(e=>{e.getCurrentItem().redraw()}):s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:this.getActivePageId()}}),await l.PromiseUtils.cancellationPromise(l.waitFor(450),this.cancellationToken),e.forEach(e=>{e.getItems().forEach(e=>{e.setConfigurationChanged(!0)})}),this.saveWidgets()}catch(e){if(!e.isCancelled)throw e}}saveWidgets(){new u.DashboardPage({}).saveWidgets(this.pageData.getAllowedPages().getCustomPageId(),this.pageData.copyAndPrune(!0).getWidgets().map(e=>e.toProto()))}getAnchorType(){return this.pageState.isEditMode()?m.GridAnchorType.PREVIEW:m.GridAnchorType.ICON}getGridItemOptions(){return this.pageState.isEditMode()?{interactive:!1,selectable:!0,showPlaceholder:_.PlaceholderMode.IF_SKELETON,stackable:!1,swappable:!0,nestable:!0}:{interactive:!0,selectable:!1,showPlaceholder:_.PlaceholderMode.NEVER,stackable:!1,swappable:!1,nestable:!1}}useCachedMode(){return this.wasCreatedInEditMode}getGridStyle(){return this.pageState.isEditMode()?{background:{backgroundGrid:{zoneGridColor:new o.Color(new r.Vector4D(200,200,200,255)),invalidGridColor:new o.Color(new r.Vector4D(255,0,0,255)),activeZoneGridColor:new o.Color(new r.Vector4D(0,0,0,84.15))}},items:{showOutline:!0},grid:{}}:void 0}async revertToLegacyDashboard(){await p.DashboardActions.revertToLegacyDashboard(this.pageState)}getSelectedDashboard(){let e;return void 0!==this.dashboards&&(e=this.dashboards.getFirstSelectedEntryRecursively()),void 0!==e?e:void 0}};I=__decorate([i.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],I)}),define("components/page/dashboard_page/directive",["require","exports","classes/base_page","services/fullscreen","angular_utilities","services/template_source","event_bus","services/application_mode"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:o.templateSourceFactory("components/page/dashboard_page"),replace:!1,controllerAs:"ctrl",bindToController:{pageData:"="},scope:{},controller:c}};let c=class extends i.default{constructor(e){super(e),this.$scope=e,this.isLoadMoreEnabled=(()=>this.loadMoreEnabled),this.canShowDashboardDescription=(()=>this.pageData.getAllowedPages().hasDisplayingDescription()&&!this.pageData.isEditMode()&&!n.fullscreenService.isFullscreen()),this.loadMoreEnabled=!0;const t=r.eventBus.subscribe(r.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_CLOSE,()=>{$(".articles-context-menu-open").removeClass("articles-context-menu-open")}),i=r.eventBus.subscribe(r.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_OPEN,()=>{$("#entryMenu").parents("li.section").addClass("articles-context-menu-open")});e.$on("destroy",()=>{$(".articles-context-menu-open").removeClass("articles-context-menu-open"),t.unsubscribe(),i.unsubscribe()})}getPageControllerConfiguration(){return{}}$onInit(){super.$onInit(),this.initialize()}isMobile(){return a.applicationMode.isMobile()}canShowPoweredBy(){return window.context_data.projectSettings.branding.show_powered_by}getPageName(){return this.pageData.getAllowedPages().getDisplayingTitle()}getPageDescription(){return this.pageData.getAllowedPages().getDisplayingDescription()}initialize(){this.dashboards=this.pageData.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.dashboard),document.title+=" - "+this.getSelectedDashboard().getName()}isEditMode(){return this.pageState.isEditMode()}getSelectedDashboard(){let e;return void 0!==this.dashboards&&(e=this.dashboards.getFirstSelectedEntryRecursively()),void 0!==e?e:void 0}};c.allowedFilterTypes=["MEDIA_TYPE","LANGUAGES","COUNTRIES","DEMOGRAPHICS_AND_GENDER","GENERATOR_DEVICE","SENTIMENT"],c=__decorate([s.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],c)}),define("components/page/dashboard_page/options/directive",["require","exports","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source","services/application_mode","classes/dashboard_grid_converter/dashboard_grid_converter","classes/dashboard_actions/dashboard_action_restrictions","classes/dashboard_actions/dashboard_actions","classes/report_actions/report_actions","services/fullscreen","classes/context_data/context_data","classes/report_actions/report_creation_menu_factory"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:a.templateSourceFactory("components/page/dashboard_page/options"),bindToController:{pageState:"=",dashboards:"=",loadMoreEnabled:"="},scope:{},controller:_,controllerAs:"ctrl"}};class _{$onInit(){const e=m.ReportCreationMenuFactory.buildReportOptionsMenuProps();this.reportOptionsMenu=e.reportOptionsMenu,this.reportOptionsStyleModel=e.reportOptionsStyleModel,this.reportOptionsStrategy=e.reportOptionsStrategy}canConvertDashboardToGrid(){return h.contextData.isFeatureEnabled("GRID_DASHBOARD")&&!c.applicationMode.isMobile()}convertDashboardToGrid(){this.loadMoreEnabled=!1;const e=new l.DashboardGridConverter(this.pageState);e.onCancel.subscribeOnce(()=>{this.loadMoreEnabled=!0}),e.spawnBubble()}refreshNoCache(){this.refreshPageDataNoCache()}isEditMode(){return this.pageState.isEditMode()}hasChangedFilters(){return d.DashboardActionRestrictions.canOverrideFilters(this.pageState)}overrideDashboard(){return g.DashboardActions.overrideDashboard(this.pageState)}canEditDashboard(){return d.DashboardActionRestrictions.canEditDashboard(this.pageState)}toggleEditMode(){this.pageState.toggleEditMode(),this.refreshPageData().then(()=>void 0,e=>{e instanceof Error&&s.logService.error("Error when refreshing page state when toggling edit mode !",void 0,e)})}canViewDashboardUsers(){return d.DashboardActionRestrictions.canShowUserAccess()}showDashboardUsers(){g.DashboardActions.showDashboardUsers(this.getSelectedDashboard().getMappedId())}canCopyDashboard(){return d.DashboardActionRestrictions.canCopyDashboard(this.pageState)}copyDashboard(){g.DashboardActions.copyDashboard(this.getSelectedDashboard().toProto())}canShowReportActions(){return d.DashboardActionRestrictions.canShowReportActions(this.pageState)}canShowAlertButton(){return d.DashboardActionRestrictions.canCreateAlert(this.pageState)}toggleAlertReport(){u.ReportActions.createAlertReport()}canShareDashboard(){return d.DashboardActionRestrictions.canShareDashboard(this.pageState)}shareDashboard(){g.DashboardActions.shareDashboard(this.getSelectedDashboard().toProto())}isFullscreenAllowed(){return d.DashboardActionRestrictions.isEditable(this.pageState)&&!p.fullscreenService.isFullscreen()&&p.fullscreenService.isFullscreenModeAllowed()&&h.contextData.rules.isLiveViewEnabled()}openFullscreen(){p.fullscreenService.goFullscreen()}refreshPageData(){const e={strategy:n.ModelRefreshStrategy.REFRESH},t=o.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),r.ModelType.PAGE_STATE,e);return i.modelRefreshService.refresh(t,e)}async refreshPageDataNoCache(){const e={strategy:n.ModelRefreshStrategy.REFRESH_NO_CACHE},t=o.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),r.ModelType.PAGE_STATE,e);try{await i.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state without cache !",void 0,e)}}getSelectedDashboard(){let e;return void 0!==this.dashboards&&(e=this.dashboards.getFirstSelectedEntryRecursively()),void 0!==e?e:void 0}}}),define("components/page/dashboard_template_page/directive",["require","exports","services/template_source","classes/base_page"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){class e extends n.default{constructor(e){super(e),e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.canShowPageRefresh=function(){return"DEEP_ANALYTICS_DT_CATEGORY"!==tw.pageState.getAllowedPages().getPageCategory()},e.canShowAddButtons=function(){return tw.pageState.getWidgets().findIndex(e=>e.hasPayload()&&e.hasPayloadValue())>-1}}getPageControllerConfiguration(){return{}}$onInit(){super.$onInit(),document.title+=" - "+this.$scope.getBreadCrumb().getRootEntry().getChildren()[this.$scope.getBreadCrumb().getRootEntry().getChildrenCount()-1].getName()}}return e.$inject=["$scope"],{replace:!1,scope:{pageData:"="},controller:e,templateUrl:i.templateSourceFactory("components/page/dashboard_template_page")}}}),define("components/page/discovery/directive",["require","exports","classes/base_page","angular_utilities","services/modal","services/broker","services/navigation","classes/context_data/context_data","angular","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{scope:{pageData:"="},replace:!1,controllerAs:"ctrl",controller:g,templateUrl:d.templateSourceFactory("components/page/discovery")}};let g=class extends i.default{constructor(e){super(e),this.$scope=e,this.handleAlertsSelection=this.handleAlertsClick.bind(this)}getPageControllerConfiguration(){return{}}canShowPoweredBy(){return window.context_data.projectSettings.branding.show_powered_by}saveDefaultView(){const e={title:a.contextData.getMessage("_563451"),make_default:!1};s.modalService.display("SAVE_VIEW",e).then(e=>{o.brokerService.publish(constants.events.bookmarks.add,e.new_view)})}getAllowedPages(){return l.mainApplication.getPageState().getAllowedPages()}isInstantDiscovery(){return this.getAllowedPages().isInstantDiscovery()}isVisualDiscovery(){return this.getAllowedPages().isVisualDiscovery()}isTrendDiscovery(){return this.getAllowedPages().isTrendDiscovery()}canShowTwitterToggle(){return!this.isInstantDiscovery()}goToTrial(){r.navigationService.goToTrial()}goToTrendDiscoverySignup(){r.navigationService.goToTrendDiscoverySignup()}isFreeSearch(){return a.contextData.projectSettings.is_free_search}isTrialBannerAllowed(){return(this.isTrendDiscovery()||this.isInstantDiscovery())&&!0===a.contextData.projectSettings.is_trial}alertsMenu(){return this.getAllowedPages().getAlertsMenu()}$onInit(){super.$onInit()}handleAlertsClick(e,t){s.modalService.display("REPORT_ALERT_NOW",{identifier:"root"!==t.mapped_id?t.mapped_id:void 0}),e.stopPropagation(),this.$scope.$apply()}};g=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],g)}),define("components/page/quick_search/controllers/topic_filter_bar_controller",["require","exports","react_components/filter_menu/default_filter_bar_controller","services/quick_search","event_bus"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.TopicFilterBarController=class extends i.DefaultFilterBarController{constructor(e,t,i,n){super(),this.topicUfs=e,this.filterMappedId=t,this.color=i,this.callbacks=n}handleMenuClose(){}saveChanges(){this.persistChanges(this.topicUfs,this.filterMappedId),this.callbacks.onSave&&this.callbacks.onSave()}resetChanges(){s.eventBus.dispatch({type:s.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_FILTER_MENU,value:{}}),this.callbacks.onReset&&this.callbacks.onReset()}async persistChanges(e,t){const i=await n.quickSearchService.getTopicInformation({mapped_id:t});this.menuControllers.forEach(t=>{const{topicMenu:i}=t.getAdapter().getData(),n=e.clone();n.getTopicMenuByType(i.getType()).merge(i),e.replaceFilters(n)}),i.ufs=e.toProto(),await n.quickSearchService.updateSearchItem(i),s.eventBus.dispatch({type:s.EVENT_TYPES.TOPIC_NAVBAR_RERENDER,value:void 0}),await this.refreshPageData()}getColor(){return this.color}getMappedId(){return this.filterMappedId}getTopicUfs(){return this.topicUfs}}}),define("components/page/quick_search/directive",["require","exports","angular","angular_utilities","classnames","event_bus","classes/context_data/context_data","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_page_controller","other/tw","services/broker","services/quick_search","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/user_filter_settings_wrapper","services/template_source","classes/application/application","react_components/filter_menu/default_filter_bar_controller","react_components/filter_menu/topic_menu_wrapper_adapter","components/page/quick_search/controllers/topic_filter_bar_controller","components/page/quick_search/controllers/lazily_saved_filter_menu_controller","react_components/filter_menu/default_filter_menu_controller","moment-timezone"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b){var w;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HOME=0]="HOME",e[e.SINGLE=1]="SINGLE",e[e.COMPARE=2]="COMPARE"}(w=t.QuickSearchPageMode||(t.QuickSearchPageMode={})),t.default=function(){return{replace:!1,controllerAs:"ctrl",controller:C,templateUrl:h.templateSourceFactory("components/page/quick_search"),link(e,t,i,n){n.handleMenuState()}}};let C=class extends c.GridPageController{constructor(e,t){super(e,t),this.$scope=e,this.navbarClass="",this.pageClasses=["quicksearch"],this.filterBarConfiguration={margin:"0 0 0 26px"},this.topicFilterBarControllers=new Map,this.trendingRegionFilterBar=new _.DefaultFilterBarController,this.initializeTrendingFilters(),this.determinePageMode(),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.QUICKSEARCH_SAVED_TOGGLE,e=>this.applyNavbarClass(e)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,e=>{this.closeFilterMenu()}),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.FILTER_MENU_SHOW,async e=>this.showFilterMenu(e)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.FILTER_CLOSE_MENUS,e=>{this.closeFilterMenu()});const i=d.brokerService.subscribe(constants.events.page_state.received,e=>{if(this.shouldHandleIncomingPageState(e)){const e=this.pageMode;this.determinePageMode(),this.pageMode!==e&&(this.pageMode===w.HOME?(o.eventBus.dispatch({type:o.EVENT_TYPES.TOPIC_NAVBAR_CLEAR_SEARCH,value:void 0}),this.handleMenuState()):this.rebuildMenus())}});this.cancellationToken.registerCleanupFunction(()=>{d.brokerService.unsubscribe(constants.events.page_state.received,i)})}get borderColor(){return r.contextData.projectSettings.branding.color}shouldHandleIncomingPageState(e){return m.mainApplication.getPageState().getId()===e.getId()&&e.hasAllowedPages()&&(e.getAllowedPages().isQuickSearch()||e.getAllowedPages().isSearch())}rebuildMenus(){this.initializePageFilters(),this.initializeTrendingFilters(),this.filterBarController.resetMenus(),this.trendingRegionFilterBar.resetMenus()}initializeTrendingFilters(){this.trendingRegionMenus=[];const e=this.createTrendingRegionMenu();e&&this.trendingRegionMenus.push({controller:new S.DefaultFilterMenuController(e,f.TopicMenuWrapperMenuAdapter)})}createTrendingRegionMenu(){const e=this.getUserFilterSettings().getTopicMenuByType("COUNTRIES");if(e&&e.getRootEntry().hasChildren()){const t=e.getRootEntry(),i=t.getChildren()[0];return{topicMenu:e,rootId:t.getMappedId(),allNodeId:i.getMappedId(),config:{showSearchBar:!0,showSelectedFilters:!0,showAllNodeAsDedicatedEntry:!0,shouldExpandSingleCategory:!0,showTopResults:!1,menuLabelProvider:this.getTrendingRegionMenuLabel.bind(this,e),allNodeLabel:r.contextData.getMessage("_1566534")}}}}getTrendingRegionsLabel(){return r.contextData.getMessage("_1566535")}getTrendingRegionMenuLabel(e,t,i,n){return e.containsSelection()&&0!==n?i.map(e=>e.name).join(", "):r.contextData.getMessage("_1566534")}getTopicFilterBarController(){if(void 0!==this.mappedIdOfOpenedFilters)return this.topicFilterBarControllers.get(this.mappedIdOfOpenedFilters)}getPageControllerConfiguration(){return{respondToWidgetOverflow:!0,anchorConfiguration:{type:a.GridAnchorType.ICON},pageFilters:{userFilterSettings:l.tw.pageState.getUserFilterSettings(),filterBarController:new _.DefaultFilterBarController,allowedFilterTypes:l.tw.pageState.getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).map(e=>e.getType())},enableKeyNavigation:!0}}handleMenuState(){this.pageMode===w.HOME&&(o.eventBus.dispatch({type:o.EVENT_TYPES.QUICKSEARCH_MENU_OPEN,value:void 0}),this.setNavbarClass(!0))}blackoutDates(e){const t=b(Date.now());return t.subtract(13,"months"),t.add(1,"days"),e.isBefore(t)}setNavbarClass(e){this.pageMode===w.HOME&&(this.navbarClass=e?"expanded":"")}applyNavbarClass(e){if(this.pageMode===w.HOME){const t=e.value;this.setNavbarClass(t),this.$scope.$apply()}}determinePageMode(){const e=g.quickSearchService.getComparedItems().filter(e=>!0===e.selected&&!e.isPlaceholder).length;this.pageMode=0===e?w.HOME:1===e?w.SINGLE:w.COMPARE}closeFilterMenu(){void 0===this.mappedIdOfOpenedFilters&&void 0===this.topicUFS||(this.topicUFS=void 0,this.mappedIdOfOpenedFilters=void 0,this.$scope.$apply())}async setupTopicFilterBarController(e){const t=await g.quickSearchService.getTopicInformation({mapped_id:e}),i=new p.UserFilterSettingsWrapper(t.ufs),n=new y.TopicFilterBarController(i,e,t.color,{onSave:this.closeFilterMenu.bind(this),onReset:()=>{this.closeFilterMenu()}});return this.topicFilterBarControllers.set(e,n),n}async showFilterMenu(e){const{mapped_id:t}=e.value;if(-1===t.indexOf(this.mappedIdOfOpenedFilters)){const e=await this.setupTopicFilterBarController(t);this.topicUFSMenus=e.getTopicUfs().getFilters().filter(e=>!e.isDisabled()).map(e=>({topicMenu:new u.TopicMenuWrapper(e.toProto(),void 0,this.topicUFS),selectionModes:this.buildFilterSelectionModes(e),config:{shouldInvertFilters:l.tw.pageState.getAllowedPages().isSearchAdvanced()}})).map(e=>this.createTopicFilterMenuProps(e)),this.mappedIdOfOpenedFilters=e.getMappedId(),this.topicColor=e.getColor(),this.$scope.$apply()}}createTopicFilterMenuProps(e){return{controller:new v.LazilySavedFilterMenuController(e,f.TopicMenuWrapperMenuAdapter)}}canShowPoweredBy(){return!1}isTrialBannerAllowed(){return!1}getPageContentClass(){return s({"home-content":this.pageMode===w.HOME})}getNavbarClass(){return s({animated:!0,home:this.pageMode===w.HOME,[this.navbarClass]:!!this.navbarClass})}getPageBodyClass(){return this.pageMode===w.HOME?"":super.getPageBodyClass()}canShowPageFilters(){return super.canShowPageFilters()&&void 0===this.getTopicFilterBarController()&&this.pageMode!==w.HOME}canShowTopicFilters(){return void 0!==this.getTopicFilterBarController()&&this.pageMode!==w.HOME}canShowTrendingRegionFilters(){return this.pageMode===w.HOME}getFilterBarConfiguration(){return this.filterBarConfiguration}getTrendingRegionFilters(){return this.trendingRegionMenus}getTrendingRegionBarController(){return this.trendingRegionFilterBar}getTopicUFSFilters(){return this.topicUFSMenus}getTopicColors(){return this.topicColor}getTopicFiltersLabel(){return r.contextData.getMessage("_1663546")}getPageFiltersLabel(){return r.contextData.getMessage("_1663552")}hasCustomFiltersSelected(e){return e.getTopicMenus().forEach(e=>!this.isRootSelected(e)),!1}isRootSelected(e){return e.getRootEntry().isSelected()}};C=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],C),t.QuickSearchPageController=C}),define("services/walkthrough/walkthrough_service",["require","exports","bootstrap-tour","classes/context_data/context_data","services/router","services/context","services/rest_form_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CONTAINER_ELEMENT="#tw-walkthroughs",t.WALKTHROUGH_TEMPLATE=`<div class='popover tour midstep'>\n        <div class='arrow_box'></div>\n        <h3 class='popover-title midstep'></h3>\n        <div class='popover-content'></div>\n        <div class='popover-navigation'>\n            <div class="btn-group">\n                <button class='btn btn-default' data-role='prev'><i class='fa fa-angle-double-left'/>&nbsp;${n.contextData.getMessage("_878790")}</button>\n                <button class='btn btn-default' data-role='next'>${n.contextData.getMessage("_121209")}&nbsp;<i class='fa fa-angle-double-right'/></button>\n            </div>\n            <button class='btn btn-default endtour' data-role='end'>${n.contextData.getMessage("_828234")}</button>\n        </div>\n    </div>`,t.FIRST_STEP_TEMPLATE=`<div class='popover tour'>\n    <h3 class='popover-title'></h3>\n    <div class='popover-content'></div>\n    <div class='popover-navigation'>\n        <div class="btn-group">\n        <button class='btn btn-default' data-role='prev'><i class='fa fa-angle-double-left'/>&nbsp;${n.contextData.getMessage("_878790")}</button>\n        <button class='btn btn-default' data-role='next'>${n.contextData.getMessage("_121209")}&nbsp;<i class='fa fa-angle-double-right'/></button>\n        </div>\n        <button class='btn btn-default endtour' data-role='end'>${n.contextData.getMessage("_828234")}</button>\n    </div>\n    </div>`,t.LAST_STEP_TEMPLATE=`<div class='popover tour'>\n    <h3 class='popover-title'></h3>\n    <div class='popover-content'></div>\n    <div class='popover-navigation'>\n        <div class="btn-group">\n        <button class='btn btn-default' data-role='prev'><i class='fa fa-angle-double-left'/>&nbsp;${n.contextData.getMessage("_878790")}</button>\n        <button class='btn btn-default' data-role='next'>${n.contextData.getMessage("_121209")}&nbsp;<i class='fa fa-angle-double-right'/></button>\n        </div>\n        <button class='btn btn-primary endtour' data-role='end'>${n.contextData.getMessage("_828234")}</button>\n    </div>\n    </div>`,t.WALKTHROUGH_NOCONTENT_TEMPLATE=`<div class='popover tour midstep'>\n    <div class='arrow_box'></div>\n    <h3 class='popover-title midstep'></h3>\n    <div class='popover-navigation'>\n        <div class="btn-group">\n            <button class='btn btn-default' data-role='prev'><i class='fa fa-angle-double-left'/>&nbsp;${n.contextData.getMessage("_878790")}</button>\n            <button class='btn btn-default' data-role='next'>${n.contextData.getMessage("_121209")}&nbsp;<i class='fa fa-angle-double-right'/></button>\n        </div>\n        <button class='btn btn-default endtour' data-role='end'>${n.contextData.getMessage("_828234")}</button>\n    </div>\n</div>`;class a{async start(e){if(this.tour){if(this.tourId===e)return this.tour.restart(),void this.tour.start(!0);delete this.tour}await this.configure(e),this.subscribe(),this.tour.start()}async shouldShow(e){const t=routes.controllers.tw.TWRestForm.get(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,"walkthrough_settings","show",e,"rform").url;return"finished"!==(await r.restFormService.get(t)).walkthrough_state}async configure(e){const n=await this.buildSteps(e);this.tour=new i({container:t.CONTAINER_ELEMENT,storage:!1,steps:n,template:t.WALKTHROUGH_TEMPLATE,smartPlacement:!1,onEnd:e=>this.onEnd(e),onShown:e=>this.onShown(e)}),this.tourId=e,this.numberOfSteps=n.length,this.tour.init()}subscribe(){this.subscription&&this.subscription.cancel(),this.subscription=s.routerService.router.onRoutingAccept.subscribe(()=>{this.tour&&(this.tour.end(),delete this.tour)})}async buildSteps(e){const t=await this.loadSpec(e);return t.forEach(e=>{e.title=n.contextData.getMessage(e.titleID),e.content=n.contextData.getMessage(e.contentID)}),t}async loadSpec(t){const i=`./specs/${t}.walkthrough`;return(await new Promise((t,n)=>{e([i],t,n)})).default}async onEnd(e){if(!0===e.ended()){this.subscription.cancel();const t=e.getCurrentStep();if(t===this.numberOfSteps-1){const e={walkthrough:this.tourId,walkthrough_state:"finished",walkthrough_step:t};await r.restFormService.postRForm("walkthrough_settings","update",e)}else{const e={walkthrough:this.tourId,walkthrough_state:"aborted",walkthrough_step:t};await r.restFormService.postRForm("walkthrough_settings","update",e)}}}onShown(e){const t=e.getStep(e.getCurrentStep()).element;if(t){const e=$(t),i=$(".popover.tour"),n=i.offset();n.left=e.offset().left,i.offset(n)}}}t.default=a,t.walkthroughService=new a}),define("react_components/bubble_dialogs/bubble_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/generic_message_bubble_dialog",["require","exports","react","classnames","flux","jquery","reusable_utilities"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});class a extends s.BaseComponent{render(){const e=n({"tw-bubble-dialog":!0,"bubble-dialog-generic-message":!0});return i.createElement("div",{ref:this.applyStyle.bind(this),className:e,style:this.props.payload.styleModel.dialogStyles},this.renderCloseCross(),this.renderIcon(),this.renderTitle(),this.generateContent(),this.renderCloseButton(),this.generatePointer())}generatePointer(){return[i.createElement("div",{className:"pointer",key:"pointer"}),i.createElement("div",{className:"pointerBorder",key:"border"})]}applyStyle(e){if(e){const{referenceElement:t,styleInformation:i}=this.props;if(t&&i){const n=o(e);i.apply(t,n),!0===this.props.payload.centerDialog&&this.cancellationToken.setTimeout(()=>{i.setAbsoluteY(window.innerHeight/2-n.height()/2),i.apply(t,n)})}}}renderCloseCross(){return!0===this.props.payload.showCloseButtons?i.createElement("div",{className:"clearfix"},i.createElement("button",{className:"close",style:this.props.payload.styleModel.crossIconStyles,onClick:this.clickOutside.bind(this)},"×")):null}renderIcon(){return this.props.payload.iconName?i.createElement("div",{style:this.props.payload.styleModel.iconStyles},i.createElement("i",{className:this.props.payload.iconName})):null}renderTitle(){return this.isStringNotEmpty(this.props.payload.title)?i.createElement("div",{style:this.props.payload.styleModel.titleStyles},this.props.payload.title):null}generateContent(){const{message:e,limited:t,styleModel:s}=this.props.payload,o=n({limited:_.isUndefined(t)||!0===t});if(void 0!==e.__html){const t=e;return i.createElement("div",{className:o,dangerouslySetInnerHTML:t,style:s.messageStyles})}return i.createElement("div",{className:o,style:s.messageStyles},e)}renderCloseButton(){return!0===this.props.payload.showCloseButtons?i.createElement("div",{style:this.props.payload.styleModel.closeButtonContainerStyles},i.createElement("button",{type:"button",onClick:this.clickOutside.bind(this),className:"btn btn-default",style:this.props.payload.styleModel.closeButtonStyles},this.props.payload.closeButtonMessage)):null}clickInside(e){}clickOutside(e){e.preventDefault(),this.props.facade.destroy()}isStringNotEmpty(e){return void 0!==e&&e.length>0}}t.GenericMessageBubbleDialog=a,r.applyMixins(a,[s.DocumentClickTracker])}),define("react_components/bubble_dialogs/components/css/tos_dialog_style_model",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createTosStyleModel=function(){return{dialogStyles:{backgroundColor:"#1E3589",padding:"5px 10px 20px 10px"},iconStyles:{textAlign:"center",color:"white",fontSize:"40px"},titleStyles:{textAlign:"center",color:"white",fontFamily:"RobotoB",marginTop:"10px",marginBottom:"5px"},messageStyles:{textAlign:"center",color:"white",fontFamily:"RobotoR",marginBottom:"20px"},closeButtonContainerStyles:{position:"relative",height:"35px"},closeButtonStyles:{backgroundColor:"white",color:"#1E3589",fontFamily:"RobotoB",left:"50%",bottom:"0px",transform:"translateX(-50%)",position:"absolute",fontSize:"14px !important"},crossIconStyles:{color:"#DDDDDD",cursor:"pointer",opacity:1}}}}),define("react_components/bubble_dialogs/components/cta_free_search",["require","exports","flux","react","services/resources/resources","services/resources/resource","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.CtaFreeSearch=class extends i.BaseComponent{render(){const e={color:"#ffffff"},t={position:"absolute",left:"32px"},i={backgroundImage:`url(${s.resourcesService.getImageUrl(o.ImageResource.cta_background)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"656px",height:"470px",padding:"50px",position:"relative"},a=Object.assign({},e,t,{fontFamily:"RobotoB",fontSize:"36px"}),c=Object.assign({},a,{top:"122px"}),l=Object.assign({},a,{top:"164px"}),d=Object.assign({},a,{top:"205px"}),g=Object.assign({},a,{fontSize:"18px",top:"268px"}),u=Object.assign({},e,t,{top:"312px",backgroundColor:"#33d9b2",borderColor:"#33d9b2",borderRadius:"5px",fontFamily:"RobotoB",fontSize:"18px",padding:"8px 20px"}),p=Object.assign({},e,t,{fontFamily:"RobotoR",fontSize:"14px",top:"400px",textDecoration:"underline"}),h=Object.assign({},e,t,{left:"635px",top:"10px",fontSize:"18px"});return n.createElement("div",{style:i},n.createElement("div",{style:c},r.contextData.getMessage("_494234")),n.createElement("div",{style:l},r.contextData.getMessage("_494235")),n.createElement("div",{style:d},r.contextData.getMessage("_494236")),n.createElement("div",{style:g},r.contextData.getMessage("_479045")),n.createElement("div",{style:u,onClick:e=>this.onYes(e),onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e)},r.contextData.getMessage("_420423")),n.createElement("div",{style:p,onMouseDown:e=>this.close(e),onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e)},r.contextData.getMessage("_429981")),n.createElement("i",{className:"fa fa-times",style:h,onMouseDown:e=>this.close(e),onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e)}))}onYes(e){window.open("https://www.talkwalker.com/free-search-to-quick-search","_blank")}onMouseEnter(e){$(e.target).css("cursor","pointer")}onMouseLeave(e){$(e.target).css("cursor","clear")}close(e){e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),this.props.destroy()}}});define("components/page/free_search/directive",["require","exports","angular","angular_utilities","services/navigation","components/page/quick_search/directive","services/template_source","services/bubble_dialog","services/walkthrough/walkthrough_service","classes/context_data/context_data","services/context","services/configuration","services/rest_form_service","react_components/bubble_dialogs/components/css/tos_dialog_style_model","bubble_dialogs","event_bus","react_components/bubble_dialogs/components/cta_free_search","react","services/tw_common"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,scope:{pageData:"="},controllerAs:"ctrl",controller:v,templateUrl:r.templateSourceFactory("components/page/free_search"),link(e,t,i,n){n.handleMenuState()}}};let v=class extends o.QuickSearchPageController{constructor(e,t){super(e,t),this.pageClasses=["quicksearch free-search"],this.checkForWalkthrough(),this.checkForToSUpdate(),this.setupCta(e)}goToTrial(){s.navigationService.goToTrial(!0,"&cta=1")}getBottomBannerHeight(){return 35}async checkForToSUpdate(){const e=routes.controllers.tw.TWRestForm.get(d.contextService.getCurrentContext().scope,d.contextService.getCurrentContext().id,"user_prefs","show","","rform").url;(await u.restFormService.get(e)).notified_free_search_tos_update||this.createTosUpdateBubbleDialog()}async checkForWalkthrough(){if(await c.walkthroughService.shouldShow("free_search")){m.eventBus.dispatch({type:m.EVENT_TYPES.TOPIC_NAVBAR_NEW_SEARCH_QUERY,value:{mapped_id:"0",query:"Talkwalker"}});const e=setInterval(()=>{0!==$("[tw-icon-anchor]").length&&(clearInterval(e),setTimeout(()=>{c.walkthroughService.start("free_search")},100))},250)}}createTosUpdateBubbleDialog(){a.bubbleDialogService.createByType(constants.bubble_dialog.id.tos_update,$("body"),constants.bubble_dialog.id.generic_message,{title:l.contextData.getMessage("_1987635"),iconName:"icon2-tw-yeti-feet",message:{__html:l.contextData.getMessage("_1846048",["https://www.talkwalker.com/terms-of-service-free-services"])},closeButtonMessage:l.contextData.getMessage("_1158904").toUpperCase(),limited:!1,styleModel:p.createTosStyleModel(),centerDialog:!0,showCloseButtons:!0},g.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tos_update),{fadeBackground:!0}).onDestroy.subscribeOnce(()=>{this.saveTosNotifiedUser()})}saveTosNotifiedUser(){const e=routes.controllers.tw.TWRestForm.post(d.contextService.getCurrentContext().scope,d.contextService.getCurrentContext().id,"user_prefs","update","","rform").url;u.restFormService.post(e,{notified_free_search_tos_update:!0})}setupCta(e){const t="CTA_free_search";sessionStorage.setItem(t,""),$(window).on("blur",()=>{""===sessionStorage.getItem(t)&&void 0===this.bubble&&!1===document.hasFocus()&&(this.bubble=a.bubbleDialogService.createReactBubble("CTA",$("#page_content"),{},e=>f.createElement(_.CtaFreeSearch,{destroy:()=>{e.destroy(),this.bubble=void 0}}),(new h.BubbleDialogStyle).setArrowSide(y.twCommon.sides.CENTER).setAbsoluteY(window.pageYOffset+250).setUseShadow(!0).setZIndex(1050).setDisplay("block"),{fadeBackground:!0}),sessionStorage.setItem(t,"showed"))}),e.$on("$destroy",()=>{$(window).off("blur")})}};v=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],v),t.FreeSearchPageController=v}),define("components/page/login/directive",["require","exports","classes/context_data/context_data","services/broker","services/rest_form_service","services/template_source","services/tw_common","fingerprintjs2"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{pageData:"="},templateUrl:o.templateSourceFactory("components/page/login"),controller:["$scope",function(e){e.canShowPoweredBy=function(){return i.contextData.projectSettings.branding.show_powered_by},e.contextData=i.contextData,e.getLogoUrl=function(){return i.contextData.links.getLogo()},e.signIn=function(t){e._connect(e.form_entry.sign_in_link,t)},e._connect=function(t,i){e.url&&(t+="?url="+e.url),new a({excludeFlashFonts:!0,excludeAudioFP:!0}).get(n=>{e.form_entry.fingerprint=n,s.restFormService.post(t,e.form_entry,e.send_action).then(function(t){e.form_entry=t;const n=t.redirect_url;""===t.redirect_url||i?(window.opener.callBack(n),window.close()):window.location.href=n},function(t){e.form_entry.field_messages=t.field_messages,e.form_entry.captcha=t.captcha})})},e.redirect=function(t){e._redirect_saml(e.form_entry.redirect_link,t)},e._redirect_saml=function(t,i){e.url&&(t+="?url="+e.url),s.restFormService.post(t,e.form_entry,e.send_action).then(function(t){e.form_entry=t})},e.register=function(){window.location.href=e.form_entry.register_link},e.resetPassword=function(){window.location.href=e.form_entry.link_reset_password},e.isLoginButtonDisabled=function(){return void 0!==e.form_entry.captcha&&!e.form_entry.captcha.result},e.checkEnter=function(t){13===t.which&&(e.form_entry.only_mail_enabled&&!e.form_entry.lock_email?e.form_entry.email_sign_in&&e.redirect():n.brokerService.publish(constants.events.progress_button.external_trigger,[e.loginButtonId]))},e.form_entry=e.pageData,e.signin=!0===e.form_entry.sign_in_only?1:0,e.form_entry.url&&(window.location.href=e.form_entry.url);const t=window.location.href.split("url=");t.length>1&&""!==t[1]&&"/"!==t[1]&&(e.url=t[1]),e.send_action=constants.events.form.action.send,e.loginButtonId=r.twCommon.generateUuid(),e.nextButtonId=r.twCommon.generateUuid(),window.socialMediaAccountCallBack=function(e){window.location.href=e}}]}}}),define("components/page/modules/influencer_mgmt/influencer_mgmt_page_titles",["require","exports","classes/context_data/context_data","log"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerManagementPageTitles=class{static getPageTitle(e){switch(e){case"IM_PAGE_MONITOR_LISTS":case"IM_PAGE_MONITOR_LIST":case"IM_PAGE_MONITOR_CONTENT":case"IM_PAGE_MONITOR_DISCOVERY":return i.contextData.getMessage("_1252632");case"IM_PAGE_OUTREACH":case"IM_PAGE_CAMPAIGN_STATUS":case"IM_PAGE_OUTREACH_CONTENT":case"IM_PAGE_MEASURE":return i.contextData.getMessage("_1252633");default:return void n.logService.debug(`No title message defined for ${e} !`)}}static getSubPageTitle(e){switch(e){case"IM_PAGE_MONITOR_LISTS":return i.contextData.getMessage("_1252636");case"IM_PAGE_MONITOR_LIST":return i.contextData.getMessage("_1534819");case"IM_PAGE_MONITOR_CONTENT":return i.contextData.getMessage("_1252637");case"IM_PAGE_MONITOR_DISCOVERY":return i.contextData.getMessage("_1252638");case"IM_PAGE_OUTREACH":return i.contextData.getMessage("_1510273");case"IM_PAGE_CAMPAIGN_STATUS":return i.contextData.getMessage("_1252663");case"IM_PAGE_OUTREACH_CONTENT":return i.contextData.getMessage("_1252637");case"IM_PAGE_MEASURE":return i.contextData.getMessage("_1252634");default:return void n.logService.debug(`No sub title message defined for ${e} !`)}}}}),define("components/page/modules/issue_tracker/directive",["require","exports","angular_utilities","event_bus","notifications","reusable_components","classes/application/application","classes/context_data/context_data","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_page_controller","other/tw","services/rest_form_service","services/template_source","react_components/filter_menu/topic_menu_wrapper_adapter","react_components/filter_menu/default_filter_bar_controller","react_components/filter_menu/default_filter_menu_controller","services/modal","services/confirmation_service","services/issue_tracker_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){var v;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,controllerAs:"ctrl",scope:{pageData:"="},controller:S,templateUrl:u.templateSourceFactory("components/page/modules/issue_tracker")}};let S=v=class extends l.GridPageController{constructor(e,t){super(e,t),this.monitorButtonMenus=[],this.discoveryButtonMenus=[],this.pageClasses=["issuetracker"],this.buttonMenuUpdateTimestamps={discovery:0,monitor:0},this.topicMenuBarController=new h.DefaultFilterBarController,this.setupButtonMenus(),this.setupEventSubscriptions(),this.handleAlertClick=this.addAlert.bind(this)}get alertsMenu(){return r.mainApplication.getPageState().getAllowedPages().getAlertsMenu()}getPageControllerConfiguration(){return{respondToWidgetOverflow:!0,anchorConfiguration:{type:c.GridAnchorType.ICON},enableKeyNavigation:!1,pageFilters:{userFilterSettings:r.mainApplication.getPageState().getUserFilterSettings(),filterBarController:new h.DefaultFilterBarController,allowedFilterTypes:r.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).map(e=>e.getType())}}}setupButtonMenus(){this.monitorButtonMenus=[],this.discoveryButtonMenus=[];const e=this.createWatchlistMenu();e&&this.monitorButtonMenus.push({controller:new m.DefaultFilterMenuController(e,p.TopicMenuWrapperMenuAdapter)});const t=this.createBrandsMenu();t&&this.discoveryButtonMenus.push({controller:new m.DefaultFilterMenuController(t,p.TopicMenuWrapperMenuAdapter)});const i=this.createIssuesMenu();i&&this.discoveryButtonMenus.push({controller:new m.DefaultFilterMenuController(i,p.TopicMenuWrapperMenuAdapter)})}createWatchlistMenu(){const e=this.getUserFilterSettings().getTopicMenuByType("ISSUE_WATCHLIST");if(this.buttonMenuUpdateTimestamps.monitor=Date.now(),e&&e.toProto().pinned&&e.getRootEntry().hasChildren()){const t=e.getRootEntry(),i=t.getChildren()[0];return{topicMenu:e,rootId:t.getMappedId(),allNodeId:i.getMappedId(),config:{showSearchBar:!0,showSelectedFilters:!0,showTopResults:!1,showAllNodeAsDedicatedEntry:!0,shouldExpandSingleCategory:!0,component:{renderable:o.SquareFilterMenuRenderable,props:{iconClass:"fa fa-crosshairs",minWidth:v.menuWidth}},menuLabelProvider:this.getWatchlistMenuLabel.bind(this,e),separatorLabel:a.contextData.getMessage("_1794791")}}}}createBrandsMenu(){const e=this.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_brand);if(this.buttonMenuUpdateTimestamps.discovery=Date.now(),e&&e.toProto().pinned){const t=e.getRootEntry(),i=t.getChildren()[0];return{topicMenu:e,rootId:t.getMappedId(),allNodeId:i.getMappedId(),config:{showSearchBar:!0,showSelectedFilters:!0,showTopResults:!1,shouldCountChildrenInSelection:!0,showAllNodeAsDedicatedEntry:!0,shouldExpandSingleCategory:!0,component:{renderable:o.SquareFilterMenuRenderable,props:{iconClass:"fa fa-search",minWidth:v.menuWidth}},menuLabelProvider:this.getBrandsMenuLabel.bind(this,e),separatorLabel:a.contextData.getMessage("_1156142")}}}}createIssuesMenu(){const e=this.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.issue_tracker_issue);if(this.buttonMenuUpdateTimestamps.discovery=Date.now(),e&&e.toProto().pinned){const t=e.getRootEntry(),i=t.getChildren()[0];return{topicMenu:e,rootId:t.getMappedId(),allNodeId:i.getMappedId(),config:{showSearchBar:!0,showSelectedFilters:!0,showTopResults:!1,shouldCountChildrenInSelection:!0,showAllNodeAsDedicatedEntry:!0,shouldExpandSingleCategory:!0,component:{renderable:o.SquareFilterMenuRenderable,props:{minWidth:v.menuWidth}},menuLabelProvider:this.getIssuesMenuLabel.bind(this,e),separatorLabel:a.contextData.getMessage("_1156145")}}}}getWatchlistMenuLabel(e,t,i,n){return e.containsSelection()?0===n?a.contextData.getMessage("_1156148"):i.map(e=>e.name).join(", "):a.contextData.getMessage("_1156149")}getBrandsMenuLabel(e,t,i,n){return e.containsSelection()?0===n?a.contextData.getMessage("_1156144"):i.map(e=>e.name).join(", "):a.contextData.getMessage("_1156143")}getIssuesMenuLabel(e,t,i,n){return e.containsSelection()?0===n?a.contextData.getMessage("_1156147"):i.map(e=>e.name).join(", "):a.contextData.getMessage("_1156146")}setupEventSubscriptions(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.PAGESTATE_REFRESH,()=>{this.setupButtonMenus()}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.CLICK_ACTION_TRIGGERED,e=>{this.handleClickActions(e)})}getPageCategory(){return this.hasParentPage()?this.getParentPage().getAnchorTitle():""}getUserFilterSettings(){return d.tw.pageState.getUserFilterSettings()}getIssuesRootEntry(){return this.getUserFilterSettings().getTopicMenuByType("PREDEFINED_FILTERS").getEntryByMappedId("issue-filters")}canShowSetupButton(){return a.contextData.rules.isImpersonate()}async setup(){try{await g.restFormService.postRForm("issue","enable",{}),s.notificationService.success("Success! Please refresh the page.",{permanent:!0})}catch(e){console.error(e)}}canShowMonitorMenus(){return this.monitorButtonMenus&&this.monitorButtonMenus.length>0}canShowDiscoveryMenus(){return this.discoveryButtonMenus&&this.discoveryButtonMenus.length>0}addAlert(e,t){_.modalService.display("REPORT_ALERT_NOW",{identifier:"root"!==t.mapped_id?t.mapped_id:void 0,formName:"issue_tracker_alert"}),e.stopPropagation(),this.$scope.$apply()}handleClickActions(e){const{action:t,issueName:i}=e.value;switch(t.icon){case"pencil":this.showEditIssueInWatchlist(t);break;case"trash":this.deleteIssueFromWatchlist(t);break;case"crosshairs":this.showAddIssueToWatchlist(t,i)}}async showAddIssueToWatchlist(e,t){const i=d.tw.pageState.getUserFilterSettings();try{const t=e.click_action.issue_id.split(":"),n=t[0],s=t[1],o=await _.modalService.display("ADD_TO_WATCHLIST",{ufs:i,issues:[{id:e.click_action.issue_id}]}),{label:r,colors:a,description:c,watchlistMappedId:l}=o,d={brand_mapped_id:n,issue_mapped_id:s,watch_list_mapped_id:l,name:r,description:c,colors:a,ufs:i.toProto()};await y.issueTrackerService.addToSpecificWatchlist(d)}catch(e){if(void 0!==e)throw new Error("Could not add issue to watchlist!")}}async deleteIssueFromWatchlist(e){try{await f.confirmationService.display({message:e.click_action.confirmation_message}),await g.restFormService.deleter(e.click_action.url),n.eventBus.dispatch({type:n.EVENT_TYPES.DATA_TABLE_RELOAD_REQUESTED,value:{}})}catch(e){if(void 0!==e)throw new Error("Could not delete issue in watchlist!")}}async showEditIssueInWatchlist(e){try{const t=await g.restFormService.getRForm("issue","show",encodeURI(e.click_action.issue_id)),i=this.buildModalPayload(t),s=await _.modalService.display("GENERIC_TEXT_INPUT",i),[o,r,a,c,l]=s;t.name=a,t.description=l,await g.restFormService.postRForm("issue","update",t,encodeURI(e.click_action.issue_id)),n.eventBus.dispatch({type:n.EVENT_TYPES.DATA_TABLE_RELOAD_REQUESTED,value:{}})}catch(e){}}buildModalPayload(e){const{brand_name:t,issue_name:i,name:n,description:s,colors:o}=e;return{title:n,fields:[{name:a.contextData.getMessage("_789509"),type:"message",description:t},{name:a.contextData.getMessage("_789571"),type:"message",description:i},{name:a.contextData.getMessage("_994620"),initialValue:n,errorTooLong:a.contextData.getMessage("_789485",["60"]),errorEmpty:a.contextData.getMessage("_789484"),maxLength:60,autoFocus:!1},{name:a.contextData.getMessage("_789402"),type:"color_select",colors:o,required:!1},{name:a.contextData.getMessage("_994621"),type:"textarea",initialValue:s,rows:4,required:!1}]}}};S.menuWidth="250px",S=v=__decorate([i.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],S),t.IssueTrackerModulePageController=S}),define("components/page/modules/issue_tracker/issue_tracker_filter_menu_controller",["require","exports","react_components/filter_menu/default_filter_menu_controller"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.IssueTrackerFilterMenuController=class extends i.DefaultFilterMenuController{}}),define("components/page/r_form_page/directive",["require","exports","angular_utilities","wrappers/stateless/stateless_screen_row_wrapper","services/content_structure_service","notifications","services/context","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,bindToController:{pageData:"="},controllerAs:"vm",scope:{},controller:c,templateUrl:a.templateSourceFactory("components/page/r_form_page")}};let c=class{constructor(e,t){this.NavBarOptionsWrapper=e,this.$rootScope=t}$onInit(){this.loadContentStructureData(),this.initializeNavBarOptions(),o.notificationService.display(this.pageData.notification)}canShowPoweredBy(){return window.context_data.projectSettings.branding.show_powered_by}loadContentStructureData(){this.rows=[],this.pageData.rows.forEach(async e=>{const t=new n.StatelessScreenRowWrapper(e);this.rows.push(t),await s.contentStructureService.fetchSectionData(t.getSections(),{groupPage:this.pageData.group_page}),this.$rootScope.$$phase||this.$rootScope.$apply()})}initializeNavBarOptions(){this.navBarOptions=new this.NavBarOptionsWrapper(!1,this.NavBarOptionsWrapper.NavBarContext.PROJECT,!1,void 0,r.contextService.getCurrentContext().id)}};c=__decorate([i.ngInject(["NavBarOptionsWrapper","$rootScope"]),__metadata("design:paramtypes",[Object,Object])],c),t.RFormPageController=c}),define("components/top_banner/directive",["require","exports","services/template_source","services/rest_form_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.topBannerDirective=function(){return{replace:!0,restrict:"EA",bindToController:{},controllerAs:"vm",controller:s,templateUrl:i.templateSourceFactory("components/top_banner"),scope:{}}};class s{static bannerCount(){return s.banners.length}$onInit(){}getBanners(){return s.banners}redirectTopBanner(e){window.location.href=e.url}removeTopBanner(e,t){e.stopPropagation();const i=s.banners.indexOf(t);i>=0&&s.banners.splice(i,1)}async loadBanners(){const e=await n.restFormService.getRForm("banner","show");s.banners=e.banners,s.bannersLoaded=!0}}s.banners=[],s.bannersLoaded=!1,t.TopBannerController=s}),define("components/page/report_page/report_page_controller",["require","exports","reusable_utilities","services/broker","classes/context_data/context_data","classes/base_page","angular_utilities","services/presentation_service","components/top_banner/directive"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});let l=class extends o.default{constructor(e){super(e),this.$scope=e,this.dynamicPageTitlePart=""}$onInit(){this.pageState=this.pageData,super.$onInit(),this.initScopeVariables(),this.initializePagetitle(),this.subscribePageTitleChange()}getPageControllerConfiguration(){return{}}canShowPoweredBy(){return s.contextData.projectSettings.branding.show_powered_by&&!this.pageState.getAllowedPages().isReportPreview()}destroy(){this.cancellationToken.cancel()}hasGrayPageBody(){return this.pageState&&this.pageState.hasPageConfiguration()&&this.pageState.isEditMode()&&!this.isPresenting()}isGridReport(){return this.pageState.isGridPage()&&this.isReportLayout()}isReportLayout(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_layout}isReportSettings(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_settings}isPresenting(){return a.presentationService.isPresentationEnabled}isEditMode(){return this.pageState.isEditMode()}canShowTopBanner(){return c.TopBannerController.bannerCount()>0}initScopeVariables(){this.$scope.toggleEditMode=(async()=>{this.pageState.toggleEditMode()})}initializePagetitle(){this.pageState.hasBreadCrumb()&&(this.dynamicPageTitlePart=" - "+this.$scope.getBreadCrumb().getRootEntry().getChildren()[this.$scope.getBreadCrumb().getRootEntry().getChildrenCount()-1].getName(),document.title+=this.dynamicPageTitlePart)}subscribePageTitleChange(){this.cancellationToken=new i.CancellationToken;const e=n.brokerService.subscribe(constants.events.page.title,e=>{let t="";e.length>0&&(t=" - "+e),this.dynamicPageTitlePart.length>0?document.title=document.title.replace(this.dynamicPageTitlePart,t):document.title+=t,this.dynamicPageTitlePart=t});this.cancellationToken.registerCleanupFunction(()=>n.brokerService.unsubscribe(constants.events.page.title,e)),this.$scope.$on("$destroy",()=>this.destroy())}};l=__decorate([r.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],l),t.default=l}),define("components/page/report_page/directive",["require","exports","components/page/report_page/report_page_controller","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:n.templateSourceFactory("components/page/report_page"),replace:!1,controllerAs:"vm",controller:i.default,bindToController:{pageData:"="},scope:{}}}}),define("components/page/report_page/modes/grid/report_page_grid_mode_controller",["require","exports","angular_utilities","event_bus","graphics_utilities","log","math_utils","reusable_components","reusable_services","reusable_utilities","classes/context_data/context_data","classes/custom_pages/pages/report_page","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_configuration","classes/grid/grid_page","classes/grid/grid_page_collection","classes/grid/grid_slot_item","classes/grid/grid_toolbar_model","classes/page_mode","other/tw","services/broker","services/confirmation_service","services/icons","services/modal","services/presentation_service","services/report_service","services/tw_common","services/widgets/widget_factory","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D){Object.defineProperty(t,"__esModule",{value:!0});let A=class{constructor(e){this.$scope=e,this.cancellationToken=new l.CancellationToken}$onInit(){this.gridPageCollection=new m.GridPageCollection(this.pageState.getPageConfiguration(),{type:u.GridAnchorType.PREVIEW},this.pageState.isWholePageExport()?y.PageMode.EXPORT_PREVIEW_PAGE:y.PageMode.REPORT_PAGE),this.initializeShortcuts(),this.initializeGridPages(),this.initPreviewAnchorModel(),this.subscribeEvents(),this.subscribeEventBusTypes(),f.GridToolbarModel.constructAsync().then(e=>{this.toolbarModel=e,this.cancellationToken.registerDisposable(e)}),this.getPreviewAnchorModel().addAction=this.addSlide.bind(this),this.getPreviewAnchorModel().deleteAction=this.deleteSlide.bind(this),this.getPreviewAnchorModel().editAction=this.editSlide.bind(this),this.getPreviewAnchorModel().moveItemToPageAction=this.moveItemToSlide.bind(this),this.$scope.$on("$destroy",()=>this.destroy())}async addSlide(){v.tw.inject("$rootScope").$applyAsync();const e=JSON.parse(JSON.stringify(this.pageState.getPageConfiguration().available_layouts));return C.modalService.display("REPORT_SLIDE_LAYOUTS",new D.TopicMenuWrapper(e),{keepBubbleDialogs:!0}).then(async e=>{const{page:t,new_text_widgets:i}=(await new g.ReportPage({}).createSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),layout:e.getMappedId()})).report_container;return i.forEach(e=>e.section_id=1),this.pageState.getPageConfiguration().pages.push(t),this.pageState.getWidgets().push(...i.map(e=>P.widgetFactory.wrapWidget(e,this.pageState))),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_PAGE_ADD,value:t}),v.tw.inject("$rootScope").$applyAsync(),t})}async deleteSlide(e){return v.tw.inject("$rootScope").$applyAsync(),b.confirmationService.display({message:d.contextData.getMessage("_1847324")}).then(async()=>{const t=this.pageState.getPageConfiguration().pages.find(t=>t.id===e.id);await new g.ReportPage({}).removeSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),page:t}),this.pageState.getPageConfiguration().pages.splice(this.pageState.getPageConfiguration().pages.indexOf(t),1),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_PAGE_REMOVE,value:t}),v.tw.inject("$rootScope").$applyAsync()})}async editSlide(e){v.tw.inject("$rootScope").$applyAsync();const t=this.pageState.getPageConfiguration().pages.find(t=>t.id===e.id),i=JSON.parse(JSON.stringify(this.pageState.getPageConfiguration().available_layouts)),s=new D.TopicMenuWrapper(i);return s.selectEntryByMappedId(t.slide_metadata.layout),C.modalService.display("REPORT_SLIDE_LAYOUTS",s,{keepBubbleDialogs:!0}).then(async e=>{t.slide_metadata.layout=e.getMappedId();const i=await new g.ReportPage({}).updateSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),page:t,layout:e.getMappedId()});n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_PAGE_UPDATE_LAYOUT,value:i})})}async moveItemToSlide(e,t,i){const n=this.pageState.getPageConfiguration().pages.find(e=>e.id===i);if(!n)throw new Error(`Page ${i} is missing in pageState.`);const s=await new g.ReportPage({}).changeWidgetSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),page:n,layout:n.slide_metadata.layout,widget_to_move:{widget_id:e.getId()}});e.updateSlotConfiguration(s.report_container.widget_to_move.slot_configuration)}getOutputTypeIcon(){return w.iconService.getIconForReportOutputType(this.pageState.getOutputType())}initializeGridPages(){this.gridPageCollection.resetPages(),this.pageState.getPageConfiguration().pages.forEach((e,t)=>{const i=h.GridPage.generateGridPage(e,this.pageState.getWidgets().filter(e=>!e.isPayloadEdition()),this.buildGridOption(e),t+1,_.GridSlotItem.getWidgetByIdFunction(this.pageState));this.gridPageCollection.addPage(i)})}updateGridPages(){const e=this.pageState.getWidgets().filter(e=>!e.isPayloadEdition());this.gridPageCollection.getPages().forEach(t=>{const i=e.filter(e=>e.getSlotConfiguration().page===t.getId());t.getGrid().clear(),t.getGrid().addItems(_.GridSlotItem.generateSlotItems(i,_.GridSlotItem.getWidgetByIdFunction(this.pageState)))})}getActivePageId(){return this.pageState.getPageConfiguration().pages[this.getActivePageIndex()].id}async addNewWidget(e,t,i){const s=this.getActivePageId();e.page=s;const r=P.widgetFactory.wrapWidget(t.getDic(),this.pageState);r.updateSlotConfiguration(e);const a=new g.ReportPage({mapped_id:this.pageState.getAllowedPages().getCustomPageId()});let c;try{c=await a.addWidgets([r],this.pageState)}catch(e){o.logService.error(e.message,M.twCommon.logFeatures.None,t.toProto())}const l=P.widgetFactory.wrapWidget(c.report_widget_container.dics[0],this.pageState);r.setSectionId(1),r.setId(l.getId()),this.pageState.getWidgets().push(r),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:s,item:_.GridSlotItem.generateSlotItems([r],_.GridSlotItem.getWidgetByIdFunction(this.pageState))[0],resize:!i}})}getActivePageIndex(){return this.getPreviewAnchorModel().nodes.findIndex(e=>e.selected)}isPresenting(){return E.presentationService.isPresentationEnabled}getGridPageCollection(){return this.gridPageCollection}getPreviewAnchorModel(){return this.gridPageCollection.getAnchorModel()}initPreviewAnchorModel(){this.deadScroll=this.getPreviewAnchorModel().setupScrollNavigation({allowScrollbar:!1}),this.cancellationToken.registerDisposable(this.deadScroll),this.getPreviewAnchorModel().disableDeadScrollOnMouseEnter(this.deadScroll),this.pageState.getAllowedPages().isReportPreview()&&!d.contextData.rules.isProductProjectRuleEnabled()&&(this.getPreviewAnchorModel().onEditButtonClick=void 0)}getPresentationAnchorModel(){return this.presentationAnchorModel}hasBreadCrumb(){return this.pageState.hasBreadCrumb()}getBreadCrumb(){return this.pageState.getBreadCrumb()}isEditMode(){return this.pageState.isEditMode()}removeReport(e){e.preventDefault(),T.reportService.openRemoveReportConfirmations()}canDeleteReport(){return!this.pageState.isWholePageExport()}subscribeEvents(){const e=S.brokerService.subscribe(constants.events.page_state.received,e=>{this.pageState.getId()===e.getId()&&e.isEditMode()&&(this.initializeGridPages(),this.gridPageCollection.setPageConfig(this.pageState.getPageConfiguration()),this.updateGridPages(),this.lastAnchorUpdate=Date.now())});this.cancellationToken.registerCleanupFunction(()=>{S.brokerService.unsubscribe(constants.events.page_state.received,e)}),this.cancellationToken.subscribe(this.gridPageCollection.onTransformItem,async e=>{await this.updateWidgets([e])}),this.cancellationToken.subscribe(this.gridPageCollection.onSwapItem,async(e,t)=>{await this.updateWidgets([e,t])}),this.cancellationToken.subscribe(this.gridPageCollection.onDeletePressed,e=>{b.confirmationService.display({message:d.contextData.getMessage("_1847325")}).then(async()=>{await this.removeWidget(e.getCurrentItem()),this.pageState.deleteWidget(e.getCurrentItem())})}),this.cancellationToken.registerDisposable(this.gridPageCollection),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.BEFORE_ENTER_PRESENTATION_MODE,()=>{this.generatePresentationAnchorModel(),this.refreshGridPagesConfiguration()}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.BEFORE_EXIT_PRESENTATION_MODE,()=>{this.refreshGridPagesConfiguration()})}refreshGridPagesConfiguration(){this.getPreviewAnchorModel().nodes.forEach(e=>{n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_UPDATE_CONFIGURATION,value:{configuration:this.buildGridOption(this.pageState.getPageConfiguration().pages.find(t=>t.id===e.id)),id:e.id}})})}destroy(){this.cancellationToken.cancel()}async updateWidgets(e){try{this.$scope.$apply(),await l.PromiseUtils.cancellationPromise(l.waitFor(500),this.cancellationToken),e.forEach(e=>{e.getCurrentItem().redraw()}),await l.PromiseUtils.cancellationPromise(l.waitFor(750),this.cancellationToken),e.forEach(e=>{e.getItems().forEach(e=>{e.setConfigurationChanged(!0)})}),this.saveWidgets()}catch(e){if(!e.isCancelled)throw e}}saveWidgets(){new g.ReportPage({}).saveWidgets(this.pageState.getAllowedPages().getCustomPageId(),this.pageState.copyAndPrune(!0).getWidgets().map(e=>e.toProto()))}async removeWidget(e){await new g.ReportPage({mapped_id:this.pageState.getAllowedPages().getCustomPageId()}).removeWidget(e)}subscribeEventBusTypes(){this.cancellationToken.registerCleanupFunction(n.eventBus.subscribe(n.EVENT_TYPES.GRID_PAGE_ADD,e=>{const t=h.GridPage.generateGridPage(e.value,this.pageState.getWidgets().filter(e=>!e.isPayloadEdition()),this.buildGridOption(e.value),this.gridPageCollection.size+1,_.GridSlotItem.getWidgetByIdFunction(this.pageState));this.gridPageCollection.addPage(t)}).unsubscribe),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_PAGE_UPDATE_LAYOUT,this.handleGridPageUpdateLayout.bind(this)),this.cancellationToken.registerCleanupFunction(n.eventBus.subscribe(n.EVENT_TYPES.GRID_PAGE_REMOVE,e=>{this.gridPageCollection.removePage(this.gridPageCollection.findPage(e.value.id))}).unsubscribe),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_ITEM_SELECTION_CHANGED,()=>{this.gridPageCollection.getCurrentPage().getGrid().getSelectedItem()?this.deadScroll.pause():this.deadScroll.resume()}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.GRID_REPORT_COPY_WIDGET,e=>{this.copyWidgetToSlide(e.value.widget,e.value.pageId)}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.WIDGET_DONE_DRAWING,e=>{const t=e.value.widget;if(t.hasSlotConfiguration()){const e=this.gridPageCollection.findPage(t.getSlotConfiguration().page);e&&e.getGrid().getItems().every(e=>e.getCurrentItem().isFullyLoaded())&&n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:e.getId()}})}}),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ANCHOR_PREVIEW_NODE_MOVED,async e=>{this.orderGridPages(e.value),await this.saveGridPagesOrder()})}handleGridPageUpdateLayout(e){const t=e.value,i=t.report_container.page,s=this.pageState.getPageConfiguration().pages.find(e=>e.id===i.id),o=this.gridPageCollection.findPage(i.id);Object.assign(s,i),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_UPDATE_CONFIGURATION,value:{id:o.getId(),configuration:this.buildGridOption(s),updateItems:!0}}),t.report_container.moved_widgets.forEach(e=>{const t=this.pageState.getWidgets().find(t=>t.getId()===e.widget_id);t.updateSlotConfiguration(e.slot_configuration),t.redraw()}),this.$scope.$$phase||this.$scope.$apply(),this.gridPageCollection.updatePreview(o)}showAvailablePlaceholders(e,t,i,n){return e&&this.isValidPlaceholder(i,t)&&this.isPlaceholderAvailable(i,t,n)}isPlaceholderAvailable(e,t,i){const n=new r.Rectangle(new r.Vector2D(e.offset.x,e.offset.y),e.size.width,e.size.height);return i.map(e=>e.getCurrentItem().getSlotConfiguration()).map(e=>new r.Rectangle(new r.Vector2D(e.grid_x,e.grid_y),e.width,e.height)).every(e=>!r.collisionCalculator.isOverlapping(n,e))}isValidPlaceholder(e,t){return t.getCurrentItem().isText()?["ANY","TEXT","TITLE","HEADER_TEXT","SUB_TITLE"].includes(e.type):"ANY"===e.type}removeDisabledPlaceholders(e,t){return e.filter(e=>("DATE"!==e.type||t.slide_metadata.date_enabled)&&("SLIDE_NR"!==e.type||t.slide_metadata.slide_nr_enabled))}buildGridOption(e){const t={zoneGridColor:new s.Color(new r.Vector4D(200,200,200,76.5)),activeZoneGridColor:new s.Color(new r.Vector4D(200,200,200,255)),invalidGridColor:new s.Color(new r.Vector4D(255,0,0,76.5))},i={callbacks:{onDragEnd:async(e,t,i)=>{-1===t.getCurrentItem().getSectionId()?(await this.addNewWidget(e,t.getCurrentItem(),i),i&&this.updateWidgets([t])):this.updateWidgets([t])}},gridDragAndDropReceiveChannels:[e.id],gridItemsDragAndDropChannels:[e.id]},n=void 0!==e.grid?e.grid:this.pageState.getPageConfiguration().grid;return{id:e.id,width:n.width,height:n.height,dragAndDrop:E.presentationService.isPresentationEnabled?void 0:i,restrictedAreas:(e.slide_metadata.restricted_areas||[]).map(e=>new r.Rectangle(new r.Vector2D(e.offset.x,e.offset.y),e.size.width,e.size.height)),gridActions:{copyPaste:{channel:c.ClipboardChannel.GENERAL,onPaste:async e=>{if(e.isCutOperation)try{await this.moveWidgetToSlide(e.data.getCurrentItem(),this.getActivePageId(),e.data.getCurrentItem().getSlotConfiguration().page),c.clipboardService.clear(c.ClipboardChannel.GENERAL)}catch(e){}else this.copyWidgetToSlide(e.data.getCurrentItem(),this.getActivePageId())}}},dropzonePlaceholders:{gridPlaceholders:this.removeDisabledPlaceholders(e.slide_metadata.placeholders||[],e),highlightCondition:(e,t,i,n)=>this.showAvailablePlaceholders(e,t,i,n)},gridItemOptions:{showPlaceholder:p.PlaceholderMode.NEVER,interactive:E.presentationService.isPresentationEnabled,selectable:!E.presentationService.isPresentationEnabled,swappable:!E.presentationService.isPresentationEnabled,stackable:!1},style:{items:{showOutline:!E.presentationService.isPresentationEnabled},grid:{aspectRatio:n.aspect_ratio},background:{backgroundImage:e.slide_metadata.background_image,backgroundGrid:E.presentationService.isPresentationEnabled?void 0:t}}}}async copyWidgetToSlide(e,t){const i=this.pageState.getPageConfiguration().pages.find(e=>e.id===t),s=(await new g.ReportPage({}).copyWidgetToSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),page:i,layout:i.slide_metadata.layout,widget_to_move:{widget_id:e.getId()}})).report_container.widget_to_move;this.fixClonedWidget(s,e);const o=P.widgetFactory.wrapWidget(s,this.pageState);this.pageState.getWidgets().push(o),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:i.id,item:_.GridSlotItem.generateSlotItems([o],_.GridSlotItem.getWidgetByIdFunction(this.pageState))[0]}}),v.tw.inject("$rootScope").$applyAsync(),setTimeout(()=>{const e=this.gridPageCollection.findPage(i.id);e&&this.gridPageCollection.updatePreview(e)})}fixClonedWidget(e,t){e.payload=JSON.parse(JSON.stringify(t.getPayload())),e.menu=JSON.parse(JSON.stringify(t.getMenu().toProto())),e.display_title=t.getDisplayTitle(),e.saveable=t.canBeSaved();const i=e.primary_source;t.hasUf()&&((i.tw_data_source||i.tw_dynamic_source||i.tw_multi_data_source||i.tw_result_source).uf=JSON.parse(JSON.stringify(t.getUf().toProto()))),t.hasNestedDics()&&t.getNestedDics().forEach((i,n)=>{if(i.hasUf()){const i=e.nested_data_input_configurations[n].primary_source;(i.tw_data_source||i.tw_dynamic_source||i.tw_multi_data_source||i.tw_result_source).uf=JSON.parse(JSON.stringify(t.getUf().toProto()))}}),e.display_description=t.getDisplayDescription()}async moveWidgetToSlide(e,t,i){if(e.getSlotConfiguration().page!==t)try{const s=this.pageState.getPageConfiguration().pages.find(e=>e.id===t),o=await new g.ReportPage({}).changeWidgetSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),page:s,layout:s.slide_metadata.layout,widget_to_move:{widget_id:e.getId()}});n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_REMOVE_SUB_ITEM,value:{gridId:i,itemId:e.getId()}}),e.updateSlotConfiguration(o.report_container.widget_to_move.slot_configuration),n.eventBus.dispatch({type:n.EVENT_TYPES.GRID_ADD_ITEM,value:{gridId:s.id,item:_.GridSlotItem.generateSlotItems([e],_.GridSlotItem.getWidgetByIdFunction(this.pageState))[0]}}),v.tw.inject("$rootScope").$applyAsync(),setTimeout(()=>{const e=this.gridPageCollection.findPage(i),t=this.gridPageCollection.findPage(s.id);this.gridPageCollection.updatePreview(e),t&&this.gridPageCollection.updatePreview(t)})}catch(e){}}orderGridPages(e){const t=this.pageState.getPageConfiguration().pages.splice(e.oldIndex,1);this.pageState.getPageConfiguration().pages.splice(e.newIndex,0,t[0])}async saveGridPagesOrder(){await new g.ReportPage({}).moveSlide({mapped_id:this.pageState.getAllowedPages().getCustomPageId(),pages:this.pageState.getPageConfiguration().pages})}initializeShortcuts(){this.cancellationToken.addDomEvent($(document.body),"keyup",e=>{this.pageState.getWidgets().find(e=>e.isEditMode()||e.isSelected())||C.modalService.isAnyModalOpen()||(e.keyCode===l.Keys.DOWN_ARROW||e.keyCode===l.Keys.RIGHT_ARROW||e.keyCode===l.Keys.PAGE_DOWN?this.getPreviewAnchorModel().selectNextAnchorNode(!1):e.keyCode!==l.Keys.UP_ARROW&&e.keyCode!==l.Keys.LEFT_ARROW&&e.keyCode!==l.Keys.PAGE_UP||this.getPreviewAnchorModel().selectPreviousAnchorNode())})}generatePresentationAnchorModel(){this.presentationAnchorModel={nodeSize:new r.Vector2D(20,20),nodeOffset:new r.Vector2D(0,20),fixedPosition:a.DisplayMode.FIXED,onClick:(e,t,i,n)=>{this.getPreviewAnchorModel().selectAnchorNode(this.getPreviewAnchorModel().nodes.find(e=>e.id===t.id))},nodes:this.pageState.getPageConfiguration().pages.map((e,t)=>({id:e.id,selected:this.getPreviewAnchorModel().nodes[t].selected}))}}};A=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],A),t.default=A}),define("components/page/report_page/modes/grid/directive",["require","exports","components/page/report_page/modes/grid/report_page_grid_mode_controller","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,controllerAs:"vm",controller:i.default,bindToController:{pageState:"="},scope:{},templateUrl:n.templateSourceFactory("components/page/report_page/modes/grid")}}}),define("components/page/report_page/modes/normal/report_page_normal_mode_controller",["require","exports","angular_utilities","event_bus","jquery","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/broker","services/bubble_dialog","services/configuration","services/context","services/refresh/model_refresh_service","services/report_service","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});let f=class{constructor(e,t){this.$scope=e,this.topicService=t,this.gridConfiguration={gridItemOptions:{interactive:!1}};const i=n.eventBus.subscribe(n.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_CLOSE,()=>{s(".articles-context-menu-open").removeClass("articles-context-menu-open")}),o=n.eventBus.subscribe(n.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_OPEN,()=>{s("#entryMenu").parents("li.section").addClass("articles-context-menu-open")});e.$on("destroy",()=>{s(".articles-context-menu-open").removeClass("articles-context-menu-open"),i.unsubscribe(),o.unsubscribe()})}get reportTemplate(){return this.pageState.getPageConfiguration().report_template}hasBreadCrumb(){return this.pageState.hasBreadCrumb()}getBreadCrumb(){return this.pageState.getBreadCrumb()}isAllowedForReportInstance(){return this.pageState.getAllowedPages().isPageOneOf([constants.page_type.report_layout,constants.page_type.report_schedule,constants.page_type.report_settings])}removeReport(e){e.preventDefault(),h.reportService.openRemoveReportConfirmations()}removeReportCategory(e){if(e.preventDefault(),void 0!==this.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report)){const e=this.pageState.getAllowedPages().getCustomPageId().split("|"),t=e[e.length-1];m.restFormService.deleter(routes.controllers.tw.TWRestForm.deleter(u.contextService.getCurrentContext().scope,u.contextService.getCurrentContext().id,"report_category","remove",t,"rform").url).then(()=>{l.brokerService.publish(constants.events.topic.remove,[constants.root_id.reports,t,constants.topic_menu.TYPE.report]),this.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report).getRootEntry().setSelected(!0)})}}isRemoveAllowedForCategory(){if(this.pageState.getAllowedPages().getPageType()!==constants.page_type.edit_reports_category)return!1;const e=this.pageState.getAllowedPages().getCustomPageId(),t=this.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report);if(void 0!==t&&!this.isPredefinedCategory()){const i=t.getEntryByMappedId(e);return void 0!==i&&0===i.getChildren().length}return!1}isReportSelectionPage(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.edit_reports_categories}isGridReport(){return this.pageState.hasPageConfiguration()}isReportLayout(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_layout}isReportSettings(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_settings}canShowSidebar(){return this.pageState.hasPageConfiguration()&&this.isReportLayout()}canShowBackButton(){return this.isReportSchedule()||this.isReportSettings()}goToLayoutPage(){h.reportService.goToLayoutPage()}createGroup(e){if(e.stopPropagation(),e.preventDefault(),void 0===this.reportGroupCreationDialog){const e={saveOperation:e=>this.topicService.addTopicCategory(constants.topic_menu.TYPE.report,!1,!1,{name:e})};this.reportGroupCreationDialog=d.bubbleDialogService.createByType(constants.bubble_dialog.id.group_creation,s("body"),constants.bubble_dialog.id.group_creation,e,g.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.group_creation)),this.reportGroupCreationDialog.onMessage.subscribe(e=>{this.reportGroupCreationDialog=void 0,this.refreshPageData()}),this.reportGroupCreationDialog.onDestroy.subscribeOnce(()=>this.reportGroupCreationDialog=void 0)}}isPredefinedCategory(){const e=this.pageState.getAllowedPages().getCustomPageId().split("|"),t=e[e.length-1];return _.contains(_.values(constants.predefined_category.report).map(e=>e.id),t.toLowerCase())}isReportSchedule(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_schedule}async refreshPageData(){const e={strategy:a.ModelRefreshStrategy.REFRESH},t=r.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),c.ModelType.PAGE_STATE,e);try{await p.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&o.logService.error("Error when refreshing page state after adding report group !",void 0,e)}}};f=__decorate([i.ngInject(["$scope","topicService"]),__metadata("design:paramtypes",[Object,Object])],f),t.default=f}),define("components/page/report_page/modes/normal/directive",["require","exports","components/page/report_page/modes/normal/report_page_normal_mode_controller","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,controllerAs:"vm",controller:i.default,bindToController:{pageState:"="},scope:{},templateUrl:n.templateSourceFactory("components/page/report_page/modes/normal")}}}),define("components/page/report_page/page_options/directive",["require","exports","services/fullscreen","services/presentation_service","graphics_utilities","math_utils","services/icons","services/modal","services/rest_form_service","services/context","notifications","classes/context_data/context_data","services/filter","services/confirmation_service","services/report_service","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:b.templateSourceFactory("components/page/report_page/page_options"),bindToController:{pageState:"="},scope:{},controller:w,controllerAs:"vm"}};class w{async enterPresentationMode(){await i.fullscreenService.goFullscreen(document.documentElement,!1),await n.presentationService.enterPresentationMode({actions:{exitPresentationOnEscape:!0,redrawWidgets:!0},conditions:{},style:{bodyColor:new s.Color(new o.Vector4D(0,0,0,0)),hideNavbar:!0,hideHeader:!0,hideSidebar:!0}})}getExportIcon(){return r.iconService.getIconForExport(this.pageState.getOutputType())}getExportTypeName(){return this.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.report_output_type).getFirstSelectedEntry().getName()}openConversionModal(){a.modalService.display("CHANGE_REPORT_OUTPUT_TYPE")}isReportLayout(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_layout}isGridReport(){return this.pageState.isGridPage()}isReportSchedule(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_schedule}isReportSettings(){return this.pageState.getAllowedPages().getPageType()===constants.page_type.report_settings}goToSchedule(){this.isReportSchedule()||h.reportService.goToSchedulePage()}goToSettings(){this.isReportSettings()||h.reportService.goToSettingsPage()}hasChangedFilters(){const e=this.pageState.getUserFilterSettings();return e.isAnyFilterActive()||e.getTopicMenuByPredicate(e=>(e.getType()===constants.topic_menu.TYPE.topic_pm_composed||e.getType()===constants.topic_menu.TYPE.event)&&e.getRootEntry().containsSelection(!0)).length>0}refreshNoCache(){this.refreshPageDataNoCache()}toggleSendReport(e){e.preventDefault();const t=this.pageState.getAllowedPages().getCustomPageId().split("|"),i=t[t.length-1];c.restFormService.get(routes.controllers.tw.TWRestForm.get(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,"report_send_later_schedule","show",i,"rform").url).then(e=>{a.modalService.display("SEND_REPORT",e)})}toggleDownload(e){const t=this.pageState.getAllowedPages().getCustomPageId().split("|"),i=t[t.length-1],n=routes.controllers.tw.TWRestForm.get(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,"report","export",i,"rform").url,s=c.restFormService.get(n);d.notificationService.warning('<i class="fa fa-refresh fa-spin"></i> '+g.contextData.getMessage("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:s}),s.then(e=>{e.data&&d.notificationService.success(e.download_message,{permanent:!0})},e=>{d.notificationService.display(e.notification)})}overrideReport(){p.confirmationService.display({message:g.contextData.getMessage("_144880")}).then(()=>{const e=this.pageState.copyAndPrune(!0),t={page_state:e.toProto(),mapped_id:this.pageState.getAllowedPages().getCustomPageId()};e.dispose(),c.restFormService.post(routes.controllers.tw.TWRestForm.post(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,"report","override","","rform").url,t).then(e=>{u.filterService.clearFilters()})},()=>{})}canBeMigrated(){return!this.isExport()&&_.contains(["PPTX","PPTX_PDF","DOCX_PDF"],this.pageState.getOutputType())}openMigrationModal(){a.modalService.display("REPORT_MIGRATION")}isExport(){return this.pageState.isWholePageExport()}async refreshPageDataNoCache(){const e={strategy:f.ModelRefreshStrategy.REFRESH_NO_CACHE},t=v.modelRefreshDecoratorFactory.getDecorator(this.pageState,this.pageState.getApplication(),S.ModelType.PAGE_STATE,e);try{await m.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&y.logService.error("Error when refreshing page state without cache !",void 0,e)}}}}),define("components/page/sandbox_page/directive",["require","exports","reusable_utilities","notifications","classes/application/application","wrappers/page_state/page_state_wrapper","services/template_source","services/rest_form_service"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=i.Url,l=o.PageStateWrapper,d=n.notificationService,g=s.mainApplication;t.default=function(){return t.$inject=["$scope","$timeout","$window"],{templateUrl:r.templateSourceFactory("components/page/sandbox_page"),replace:!1,controller:t};function e(){return"http:"===window.location.protocol?constants.debug.page_state_http_url:constants.debug.page_state_https_url}function t(t,i){t.setGroupPageToMonitor=function(){tw.pageState.getAllowedPages().setGroupPage("MONITOR"),d.success("Changed group page",{permanent:!1})},t.savePageState=function(){(function(t){t.toProto&&(t=t.toProto());return a.restFormService.post(e()+"/app/rform/page_state_store/save",{page_state:t})})(tw.pageState).then(function(e){t.psId=e.data_id;const i=new c(window.location.href);i.setUrlParameter("i",t.psId),window.location.href=i.getHref()})},i(function(){t.psId&&t.loadPs(!0)},500),t.loadPs=function(i){(void 0!==t.host&&""!==t.host?a.restFormService.get(t.host+"/app/rform/page_state_store/search/"+t.psId):a.restFormService.get(e()+"/app/rform/page_state_store/search/"+t.psId)).then(function(e){if(e.page_state){const i=new c(window.location.href);i.setUrlParameter("i",t.psId),window.location.href=i.getHref(),g.injectPageState(new l(e.page_state,void 0,!1))}else i||d.error("Page state not found",{permanent:!0})})};const n=new c(window.location.href);n.getUrlParameter("i")&&void 0!==n.getUrlParameter("i")?t.psId=n.getUrlParameter("i"):t.psId="",n.getUrlParameter("h")&&void 0!==n.getUrlParameter("h")&&(t.host=n.getUrlParameter("h"))}}}),define("components/page/settings_page/directive",["require","exports","underscore","reusable_utilities","notifications","services/context","services/confirmation_service","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=n.Url,d=s.notificationService,g=o.contextService,u=r.confirmationService;t.default=function(){return e.$inject=["$scope","$rootScope","$compile","$timeout","logService","bubbleDialogService","loadingBubbleService","restFormService","$window","twRoutingService"],{replace:!1,controller:e,templateUrl:c.templateSourceFactory("components/page/settings_page")};function e(e,t,n,s,o,r,c,p,h,m){let _,f;function y(e,t){return void 0!==t&&void 0!==e&&t.form===e}function v(e){return void 0!==e&&void 0!==e.import_link}function S(e){return void 0!==e&&void 0!==e.export_link}function b(t){!function(t,o){"undefined"===t&&(t=`/app/project/${g.getCurrentContext().id}/settings/project/edit`);const l=m.getActivePage().getId();if(_===t&&!o||""===t||"SETTINGS"!==l)return;c.showSpinner(),_=t,$.ajax({url:t,headers:{"content-type":"application/json"},type:"GET"}).then(function(t){const o=$("body").find(".page__content__main .content");!function(e){e.children().each(function(t,i){const n=$(i);n.scope()!==e.scope()&&n.scope().$destroy()})}(o),$("body").find("#payload").remove(),angular.element(".page__content__main .content").empty(),r.destroyAll(),function(t){window.form_entry=t,e.form_entry=t,e.location=e.location||{},e.location.value=i.isUndefined(e.form_entry.location)?"":e.form_entry.location.root_entry.mapped_id,e.$apply()}(t),$.get(t.template_url).then(function(t){!function(t,i){const o=$("body"),r=$("<div></div>"),l=o.find(".page__content__main .content");r.html(t),o.append(r.find("#payload"));const d=r.html(),g=a.contextData.replaceAllMetaLanguageTags(d);l.empty().hide();const u=l.html(g).scope();n(l)(u),s(function(){l.show(),c.hideSpinner()}),e.$apply()}(t)})})}(function(){const e=decodeURIComponent(new l(h.location.href).getUrlParameter("url"));return new l(e).moveSearchFromHashToMainUrl().getHref()}(),t)}h.addEventListener("hashchange",b),b(),e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.canShowExportButton=function(t){return e.isTagsForm(t)&&e.isFormExportAllowed(t)},e.isImportExportAllowed=function(e){return v(e)||S(e)},e.canShowImportButton=function(t){return(e.isTagsForm(t)||e.isProjectSettingsForm(t))&&e.isFormImportAllowed(t)},e.isFormImportAllowed=v,e.isFormExportAllowed=S,e.exportDataFromForm=function(t){if(e.isFormExportAllowed(t)){const e=p.get(t.export_link);d.warning('<i class="fa fa-refresh fa-spin"></i> '+window.messages.get("_498245"),{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(function(e){d.success(e.export_message,{permanent:!0})},function(e){d.display(e.notification)})}else d.error(window.messages.get("_890153"),{permanent:!1})},e.prepareImport=function(e,t){void 0!==f&&(f.off("change"),f=void 0);let i=$(t.target).find("[tw-button]");0===i.length&&(i=$(t.target).closest("[tw-button]"));f=i.next("input"),s(function(){f.click()}),f.on("change",function(t){(t.target.files||t.originalEvent.dataTransfer.files)&&(e.file_import=t.target.files||t.originalEvent.dataTransfer.files),p.postMultipart(e.import_link,e).then(function(){b(!0)})})},e.getImportTooltip=function(t){if(e.isTagsForm(t))return window.messages.get("_1999998");return},e.getExportTooltip=function(t){if(e.isTagsForm(t))return window.messages.get("_1999999");if(e.isProjectSettingsForm(t))return"export audit logs";return},e.isTagsForm=y.bind(void 0,constants.rform.form_type.tag_management),e.isProjectSettingsForm=y.bind(void 0,constants.rform.form_type.project),e.goToOwnerProject=function(t){t.preventDefault(),u.display({message:window.messages.get("_1654068")}).then(function(){h.open(e.form_entry.sharee_info.sharer_entity_link,"_blank")},function(){})},e.canShowBreadcrumbButtons=function(){return void 0!==e.form_entry&&void 0!==e.form_entry.sharee_info},e.getLogo=(()=>a.contextData.getLink("LOGO")),e.getLocationChildren=function(){return e.hasLocationValue()&&e.form_entry.location.root_entry.children.length>1?e.form_entry.location.root_entry.children:[]},e.hasLocationValue=function(){return void 0!==e.location&&e.location.value},e.getUrlByLocation=function(){if(e.hasLocationValue()){let t=e.form_entry.location.root_entry.mapped_id;if(void 0!==(t=t.split("|")))return a.contextData.getLink(t[0])}},t.redirect=function(e){!function(e){const t=new l(e);t.hasSearch()&&(t.storeSearchInHash(t.getSearch()),t.removeSearch());h.location=new l(h.location.href).setParameterHash(encodeURIComponent(t.getHref())).getHref()}(g.changeOldUrl(e))},t.reload=function(){b(!0)},e.$on("$destroy",function(){h.removeEventListener("hashchange",b)})}}}),define("components/page/topic_setup/directive",["require","exports","classes/base_page","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){class e extends i.default{constructor(e){super(e),e.canShowPoweredBy=this.canShowPoweredBy,e.getBranding=this.getBranding.bind(this)}getPageControllerConfiguration(){return{}}$onInit(){super.$onInit()}canShowPoweredBy(){return window.context_data.projectSettings.branding.show_powered_by}getBranding(){return this.pageState.getProject().getBranding()}}return e.$inject=["$scope"],{replace:!1,controller:e,templateUrl:n.templateSourceFactory("components/page/topic_setup")}}]}),define("components/page/user_workflow/directive",["require","exports","services/confirmation_service","classes/base_page","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=i.confirmationService,r=n.default;t.default=[function(){return e.$inject=["$scope"],{replace:!1,controller:e,templateUrl:s.templateSourceFactory("components/page/user_workflow")};function e(e){function t(){r.call(this,e),e.sendPageEmail=i,e.canShowPoweredBy=n}function i(){o.display({message:{message:window.messages.get("_1819832").replace("{0}",window.context_data.userSettings.email),ok:window.messages.get("_354115"),cancel:window.messages.get("_691638")}}).then(function(){r.prototype.sendPageEmail.call(this)},function(){})}function n(){return window.context_data.projectSettings.branding.show_powered_by}return t.prototype=Object.create(r.prototype),new t}}]}),define("components/page_break/directive",["require","exports","underscore","classes/application/application","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=n.mainApplication;t.default=[function(){return e.$inject=["$scope"],{replace:!0,restrict:"E",scope:{widget:"="},controller:e,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/page_break")};function e(e){e.payload=JSON.parse(e.widget.getDic().payload.value),e.getPageLabel=function(){if(e.isLast())return"";if(function(){const t=o.getPageState().getWidgets();for(let n=0;n<t.length;n++){const s=t[n];if(!i.isUndefined(s.getPrimarySource())&&s.getPayloadType()===constants.payload_type.payload_text&&s.isFooter())return n>0&&t[n-1].getId()===e.widget.getId()}return!1}())return window.messages.get("_607895");{const t=e.widget.getSection().getPage(),n=o.getPageState().getPages(),s=i.indexOf(n,t);return window.messages.get("_307492")+" "+s}},e.isHidden=function(){return e.payload.hidden},e.isLast=function(){const t=o.getPageState().getWidgets();return i.last(t).getId()===e.widget.getId()},e.isFirst=function(){const t=o.getPageState().getFirstWidgetByPredicate(function(e){return e.isPageBreak()});return void 0!==t&&t.getId()===e.widget.getId()}}}]}),define("components/pie/directive",["require","exports","classes/application/application","underscore","services/tw_common","services/template_source","canvas_engine"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=s.twCommon,c=i.mainApplication;t.default=[function(){return e.$inject=["$element","$scope","TwDataModel","PieChartSettings","TwPresence","TwPieChart","TwStyle","TwColor","engineConstants","$timeout","fullscreenService","logService"],{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:e,link:function(e){e.$on("$destroy",function(){e.loaded=!1,e.destroyChart(),e.sub.cancel()}),e.widget.hasReplayManager()&&e.widget.getReplayManager().onNewTimeline.subscribe(function(){e.rebuild=!0})},templateUrl:o.templateSourceFactory("components/pie")};function e(e,t,i,s,o,l,d,g,u,p,h,m){let _,f;t.id=t.widget.getDic().widget_id,t.element=e,t.fragment.attach(t,e),t.sub=t.widget.onPayloadChange.subscribe(function(){t.fullscreen&&(t.rebuild=!0)}),t.isSlim=function(){return!t.builtInFullscreen&&t.widget.getDic().width<=4},t.isLarge=function(){return t.builtInFullscreen||t.widget.getDic().width>4},t.redrawWidget=function(p){return function(p){t.payload=t.widget.getPayloadValue();const y=Object.freeze({marginRight:150,AngleMod:3,RadiusMod:3,BorderMod:2,AnimationDuration:100,DepthMod:3,MaxSize:250}),v=y.BorderMod+y.AngleMod+y.RadiusMod+1,S=new i(t.payload).enableDefaultLabels(!0);let b,w;3===p.heightMode&&(p.dimensions.height=Math.max(250,p.dimensions.height));b=w=Math.min(p.dimensions.width,p.dimensions.height),t.rebuild=b<=0||w<=0||n.isUndefined(t.chart)||c.getPageState().getAllowedPages().isReplay(),!_||_===w&&f===b||(t.rebuild=!0);return _=w,f=b,t.rebuild||0===p.animationDuration?function(i,c,p,m){let _,f;_=f=Math.min(m.dimensions.width,m.dimensions.height),t.rebuild=!1,t.destroyChart(),t.isSampleData=i.isSampleData;const y=Math.max(0,t.widget.getPageState().getAllowedPages().isReport()&&t.widget.getPageState().isGridPage()?Math.min(_/2-c/2,f/2-c/2):Math.min(_/2-c,f/2-c));if(_=Math.min(_,f),t.canvas=e.find("canvas")[0],t.canvas.style.position="relative",y>0){const e=r.Stage.build(t.canvas,_,f,30,{layerAmount:3,cameraLayer:2,relayEvents:[u.StageEvents.MouseWheel],scale:m.style.resolutionScale});e.camera.disableTranslation(),t.stage=e.stage,t.camera=e.camera;const v=.6,S=y*v,b=new o(_/2,f/2).setStyle(d.Radius,y).setStyle(d.Depth,S).setStyle(d.SourceAngle,270).setStyle(d.EndAngle,630);t.widget.getPageState().getAllowedPages().isReport()&&t.widget.getPageState().isGridPage()&&b.setStyle(d.Margins,c);const w=0!==m.animationDuration?m.animationDuration:700,C=new s({model:i}).enableDefaultLabels(!0).setAngleMod(p.AngleMod).setRadiusMod(p.RadiusMod).setDepthMod(p.DepthMod).enablePiePopovers(!0).setBorderMod(3).setAnimationDuration(p.AnimationDuration).setTransitionDuration(w).setDelayComputation(!0).enableColorTween(!1,!0).enableLabelRotation(!1).enableStaticBigSlices(!0).setNumberFormatter(m.style.formatting.numberFormatter),E=3,T=Math.ceil((y-S)/E);return C.getLabelSettings().showOnFit(!0).setAdaptive(!1).setShadowBlur(10).setShadowColor(g.SHADOW_GREY()).setTextBaseLine(u.TextBaseLine.TOP).setColor(g.WHITE()).setBorderColor(g.WHITE()).setFontFamily(u.Font.Family.Digits).setFontSize(T).setDefferredAdaptation(!0),!t.loaded&&n.isUndefined(window.phantomjs)&&C.enableInitialAnimation(m.animationStrategy!==a.visualizationInitializationStrategy.INSTANT&&0!==m.animationDuration),t.chart=new l(b,t.widget,C),e.scene.addChild(t.chart),t.stage.start().then(t.animateChart.bind(t)),t.loaded=!0,t.builtInFullscreen=h.isFullscreen(),void 0!==t.inflatedSubscription&&t.inflatedSubscription.cancel(),void 0!==t.deflatedSubscription&&t.deflatedSubscription.cancel(),t.inflatedSubscription=t.chart.onSegmentInflated.subscribe(function(e){t.mediator.dispatch("WIDGET_MOUSEENTER",e)}),t.deflatedSubscription=t.chart.onSegmentDeflated.subscribe(function(e){t.mediator.dispatch("WIDGET_MOUSELEAVE",e)}),t.chart.onReady.subscribeOnceAsPromise()}{const e=$.Deferred();return setTimeout(function(){t.loaded=!0,e.resolve()}),e.promise()}}(S,v,y,p):function(e){const i=$.Deferred();return t.$evalAsync(function(){t.chart.getChartSettings().enablePointerOnSlices(e.isClickable()),m.debug("model to switch to",u.Feature.Entities.Charts.Pie,e),m.debug("model switched from",u.Feature.Entities.Charts.Pie,t.chart.getChartSettings().getModel()),t.chart.switchModel(e),i.resolve()}),i.promise()}(S)}(p)},t.mediator.listen("LEGEND_MOUSEENTER",function(e){t.chart.legendMouseEnter(e)}),t.mediator.listen("LEGEND_MOUSELEAVE",function(e){t.chart.legendMouseLeave(e)}),t.mediator.listen("LEGEND_MOUSECLICK",function(e){t.chart.legendMouseClick(e)}),t.animateChart=function(){requestAnimationFrame(function(){t.chart.animate(),t.stage.processUpdate()})},t.destroyChart=function(){n.isUndefined(t.stage)||(t.stage.dispose(),t.stage=void 0),t.chart=void 0}}}]}),define("components/pie/popup/directive",["require","exports","d3","reusable_services","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element","bubbleDialogService"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/pie/popup"),compile:function(){return{pre:o,post:r}}};function t(e,t,s){e.format=function(e){return isFinite(e)?i.format(",")(e):e},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)},e.parseTextForEmoji=function(e){return!_.isUndefined(e)&&e.length>0?n.emojiService.parseTextForEmoji(e):""}}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/progress_button/directive",["require","exports","services/template_source","services/broker"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{replace:!1,restrict:"AE",scope:{action:"@",text:"@",textCalling:"@",loading:"=?",ngDisabled:"=?",buttonId:"=?",keepProgress:"=?",clickevent:"&"},controller:e,templateUrl:i.templateSourceFactory("components/progress_button")};function e(e){e.clicked=!1,e.calling=!1,e.getName=function(){return e.isProgressing()?e.textCalling:e.text},e.handleClick=function(){e.clicked=!0,e.clickevent()},e.isProgressing=function(){return e.clicked&&e.calling||e.loading},e.remove_post_subscription=n.brokerService.subscribe(constants.events.form.action.post,function(t,i){e.action===i&&(constants.events.form.status.doing===t?e.calling=!0:constants.events.form.status.error===t?(e.calling=!1,e.clicked&&(e.clicked=!1)):e.keepProgress||(e.calling=!1,e.clicked&&(e.clicked=!1)))}),e.remove_get_subscription=n.brokerService.subscribe(constants.events.form.action.get,function(t,i){e.action===i&&(constants.events.form.status.doing===t?e.calling=!0:constants.events.form.status.error===t?(e.calling=!1,e.clicked&&(e.clicked=!1)):e.keepProgress||e.ngDisabled||(e.calling=!1,e.clicked&&(e.clicked=!1)))});const t=n.brokerService.subscribe(constants.events.progress_button.external_trigger,function(t){t===e.buttonId&&e.handleClick()});e.$on("$destroy",function(){n.brokerService.unsubscribe(constants.events.form.action.post,e.remove_post_subscription),n.brokerService.unsubscribe(constants.events.form.action.get,e.remove_get_subscription),n.brokerService.unsubscribe(constants.events.progress_button.external_trigger,t)})}}]}),define("components/rebuild/directive",["require","exports","common_constants","services/confirmation_service","underscore","classes/context_data/context_data","services/context","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c=n.confirmationService;t.default=[function(){return e.$inject=["$scope","restFormService","UserFilterSettingsWrapper"],{replace:!0,restrict:"A",scope:{topic:"="},controller:e,link:function(e,t,i){},templateUrl:a.templateSourceFactory("components/rebuild")};function e(e,t,n){const a=e;a.scheduleRebuild=function(){c.display({message:o.contextData.getMessage("_292161")}).then(function(){const n={root_entry:{mapped_id:a.topic.mapped_id,name:a.topic.name,selected:i.topic_entry.selected.node}};void 0!==a.topic.topics&&(n.root_entry.children=[],s.each(a.topic.topics,function(e){n.root_entry.children.push({mapped_id:e.mapped_id,name:e.name,selected:i.topic_entry.selected.node})}));const o={month_options:a.month_options,topics:n,sample_percentage:a.sample,ufs:e.userFilterSettings.toProto()};t.post(routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"rebuilds","add","","settings").url,o).then(function(e){},function(e){})},function(){})},a.sample=5,a.toPercent=function(e){return e+"%"},a.disableSubmit=function(){return!e.userFilterSettings.getTimeFilter().hasTimeRange()&&e.userFilterSettings.getTimeFilter().hasNoInterval()},a.blackout=function(t){return t.toDate().getTime()<e.topic.earliest_rebuild_start_ts},e.userFilterSettings=new n(e.topic.ufs,void 0,void 0,!0),e.post_action=constants.events.form.action.post}}]}),define("components/replay_date/directive",["require","exports","angular_utilities","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"E",scope:{},bindToController:{widget:"=",fragment:"=",mediator:"="},controllerAs:"vm",controller:o,templateUrl:s.templateSourceFactory("components/replay_date")}};let o=class{constructor(e){this.$element=e}$onInit(){const e=this.$element.find("#replay-date");this.fragment.attach(this,this.$element),this.mediator.listen("REPLAY_STEP",()=>{e.html(this.getReplayDate())})}formatTs(e,t){const i=moment(e);return t?i.format(n.contextData.commonPropertiesContainer.date_format.date_format):i.format(n.contextData.commonPropertiesContainer.date_format.time_format)}getReplayDate(){let e;const t=this.widget.getReplayManager().getTimeData();let i="";const s=moment(t.start).isSame(moment(t.end),"day"),o=moment.duration(1,"day").asMilliseconds()>t.step;return s&&(i="("+this.formatTs(moment(t.start),!0)+")"),e=n.contextData.getMessage("_894182")+" "+this.formatTs(t.start,!s)+" "+n.contextData.getMessage("_894183")+" "+this.formatTs(t.end,!s)+" "+i+" <br />"+n.contextData.getMessage("_894184")+" ",o?(e+=moment(t.current).format(n.contextData.commonPropertiesContainer.date_format.time_format),t.next&&(e+=" - "+moment(t.next).format(n.contextData.commonPropertiesContainer.date_format.time_format)),i||(e+=" ("+this.formatTs(moment(t.current),!0)+")")):(e+=this.formatTs(t.current,!0),t.next&&(e+=" "+n.contextData.getMessage("_894183")+" "+this.formatTs(t.next,!0))),e}redrawWidget(e){return $.Deferred().resolve().promise()}};o=__decorate([i.ngInject(["$element"]),__metadata("design:paramtypes",[Object])],o)}),define("components/replay_slider/directive",["require","exports","underscore","canvas_engine","data_structures","angular_utilities","services/tw_common","classes/refresh/model_type","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log","classes/canvas_engine/settings/charts/slider_settings","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"E",scope:{},bindToController:{widget:"=",fragment:"=",mediator:"="},controllerAs:"vm",controller:h,templateUrl:p.templateSourceFactory("components/replay_slider")}},t.REPLAY_ACTIONS={PROGRESS:"REPLAY_PROGRESS",STEP:"REPLAY_STEP"};let h=class{constructor(e,t,i,n){this.$scope=e,this.TwSliderModel=i,this.TwSliderEntity=n,this.$element=t}$onInit(){this.fragment.attach(this,this.$element),this.refresh=this.refreshWidget.bind(this),this.$scope.$on("$destroy",()=>{i.isUndefined(this.stage)||(this.stage.dispose(),this.stage=void 0),this.widget.hasReplayManager()&&this.widget.getReplayManager().dispose()})}redrawWidget(e){return this.widget.getReplayManager().getTimeline().onStep.subscribe(e=>{this.mediator.dispatch(t.REPLAY_ACTIONS.PROGRESS,{progress:e})}),this.widget.getReplayManager().onStepChange.subscribe(e=>{this.mediator.dispatch(t.REPLAY_ACTIONS.STEP,{step:e})}),this.widget.getReplayManager().getTimeline().onPlay.subscribe(()=>{setTimeout(()=>{this.mediator.dispatch(t.REPLAY_ACTIONS.STEP,{step:1})})}),this.buildCanvas(e),$.Deferred().resolve().promise()}canShowAnimationMenu(){return this.widget.hasMenu()&&this.widget.getMenu().hasWidgetAnimationMenu()&&!this.widget.isComposedGraph()}async refreshWidget(){this.widget.prepareReload(r.twCommon.reloadingStrategy.WIDGET),await this.refreshWidgetData()}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:c.ModelRefreshStrategy.REFRESH},t=d.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),a.ModelType.WIDGET,e);try{await l.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&g.logService.error("Error when refreshing widget!",void 0,e)}}else g.logService.error("reload attempted on widget without page state, this could be due to a memory leak",r.twCommon.logFeatures.WidgetWrapper)}buildCanvas(e){const t=e.dimensions.width,o=e.dimensions.height-20,r=this.$element.find("canvas")[0];i.isUndefined(this.stage)||(this.stage.dispose(),this.stage=void 0);const a=n.Stage.build(r,t,o,60,n.StageSettings.fromJSON({layerAmount:1,scale:e.style.resolutionScale}));this.stage=a.stage;const c=new n.Presence(0,10,n.Constants.Origin.TOP_LEFT);c.setStyle(n.Style.Width,t).setStyle(n.Style.Height,o);const l=new this.TwSliderModel(this.widget.getReplayManager()),d=new u.TwSliderSettings(l,this.widget);if(this.widget.hasDataGraph()){const e=new s.DataGraphWrapper(this.widget.getPayloadValue().data_graph).getAdditionalFrames().map((e,t)=>e.hasCutoffs()?t:void 0).filter(e=>void 0!==e);e.length>0&&d.blockIntervals(e)}this.slider=new this.TwSliderEntity(c,d),a.scene.addChild(this.slider),this.stage.start()}randomizeCutoffs(e){e.getAdditionalFrames().forEach((e,t)=>{t>0&&1===Math.round(Math.random())&&(e.getDataGraph().cutoffs_in_time_range=["randomized"])})}};h=__decorate([o.ngInject(["$scope","$element","TwSliderModel","TwSliderEntity"]),__metadata("design:paramtypes",[Object,Object,Object,Object])],h)}),define("components/reports/historic/report/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",scope:{report:"=",removeMethod:"="},controller:["$scope","restFormService",function(e,t){e.remove=function(i){t.deleter(i.delete_link).then(function(t){e.removeMethod(t)},function(e){})}}],templateUrl:i.templateSourceFactory("components/reports/historic/report")}}]}),define("components/scroller/buttons/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:i.templateSourceFactory("components/scroller/buttons"),replace:!0,restrict:"A",transclude:!0,scope:{lengthData:"=",listSize:"=",elemHeight:"=",showFunct:"="},controller:["$scope","$element","$interval",function(e,t,i){e.scrollDown=function(n){n.stopPropagation(),e.timerPromise||(e.timerPromise=i(function(){const i=$(t).find(".scroller-content").css("top"),n=Number(i.substring(0,i.indexOf("px")));n>(e.lengthData-e.listSize)*-e.elemHeight&&$(t).find(".scroller-content").css("top","-="+e.elemHeight)},100))},e.scrollUp=function(n){n.stopPropagation(),e.timerPromise||(e.timerPromise=i(function(){const i=$(t).find(".scroller-content").css("top"),n=Number(i.substring(0,i.indexOf("px")));n<0&&$(t).find(".scroller-content").css("top","+="+e.elemHeight)},100))},e.clearTimerPromise=function(){e.timerPromise&&(i.cancel(e.timerPromise),e.timerPromise=void 0)},e.showScrollUp=function(){let i,n,s=$(t).find(".scroller-content").css("top");if(void 0!==s)return i=Number(s.substring(0,s.indexOf("px"))),n=i<0,e.showFunct&&(n=n&&e.showFunct()),n},e.showScrollDown=function(){let i,n,s=$(t).find(".scroller-content").css("top");if(void 0!==s)return i=Number(s.substring(0,s.indexOf("px"))),n=i>(e.lengthData-e.listSize)*-e.elemHeight,e.showFunct&&(n=n&&e.showFunct()),n}}]}}}),define("components/search_query/edit/directive",["require","exports","angular_utilities","classes/context_data/context_data","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"EA",replace:!0,bindToController:{payload:"=",queryRequired:"=?",saveMethod:"=?",cancelMethod:"=?"},controllerAs:"vm",controller:o,templateUrl:s.templateSourceFactory("components/search_query/edit"),scope:{}}};let o=class{constructor(e){this.$scope=e,this.bindedSave=this.save.bind(this)}$onInit(){this.hasSaveButton()&&(this.initSaveButton(),this.tempQuery=this.payload.query),this.configuration={hideErrorMessages:!0,inputMode:!0}}save(){this.payload.query=this.tempQuery,this.saveMethod()}handleKeyDown(e){e.stopPropagation()}isValid(){return!0===this.$scope.searchForm.$valid&&(!1===this.queryRequired||void 0!==this.queryModel&&this.queryModel.length>0)}hasSaveButton(){return void 0!==this.saveMethod}set queryModel(e){this.hasSaveButton()?this.tempQuery=e:this.payload.query=e}get queryModel(){return this.hasSaveButton()?this.tempQuery:this.payload.query}initSaveButton(){this.progressOptions={action:constants.events.form.action.post,text:n.contextData.getMessage("_612374"),textCalling:n.contextData.getMessage("_911337"),isDisabled:()=>!this.isValid()}}};o=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],o),t.SearchQueryEditionController=o}),define("components/section/directive",["require","exports","classes/context_data/context_data","services/text","classes/application/abstract_application","services/template_source","services/configuration","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=n.textService,d=i.contextData,g=s.ApplicationType;t.default=[function(){return e.$inject=["$scope","$element","navigationService","$window"],{restrict:"AE",scope:{model:"=",draggableStrategy:"="},controller:e,link:function(e,t,i){},templateUrl:o.templateSourceFactory("components/section")};function e(e,t,i,n){e.model.attachTemplate(t.children().first()),e.buttonText=tw.pageState.getAllowedPages().isDashboard()?window.messages.get("_488827"):window.messages.get("_304814"),e.sectionId=_.uniqueId(),e.cta=a.resourcesService.getImageUrl(c.ImageResource.freeToolCtaPng),e.canShowCreator=function(){return tw.pageState.getAllowedPages().isReport()?e.model.isDataLoaded()&&e.model.isContent():!!tw.pageState.getAllowedPages().isDashboard()&&(tw.pageState.isEditMode()&&e.model.getWidgets().length>0)},e.addTextWidget=function(t){t.stopPropagation(),l.addTextWidget(constants.widgets_enum.text_headline_paragraph,e.model,e.model.getContext())},e.isMainApplication=function(){return e.model.getPageState().getApplication().getType()===g.MAIN},e.isFreeSearch=function(){return d.projectSettings.is_free_search},e.isFreeTrialCTAAllowed=function(){return!0!==n.isExport&&e.isFreeSearch()},e.goToTrial=function(){i.goToTrial()},e.disableWidgetInteraction=function(e){return r.configurationService.getWidgetConfiguration(e.getType()).shouldDisableInteraction()},e.$on("$destroy",function(){e.draggableStrategy=void 0})}}]}),define("components/sentiments/directive",["require","exports","components/form/common/topic_menu","components/tools/data_graph","underscore","reusable_utilities","services/context","services/navbar","classes/application/application","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","classes/context_data/context_data","services/refresh/model_refresh_service","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_){Object.defineProperty(t,"__esModule",{value:!0});const f=o.StringUtils,y=r.contextService,v=a.navbarService,S=a.FilterState,b=c.mainApplication,w=l.modelRefreshDecoratorFactory,C=g.ModelType,E=d.ModelRefreshStrategy,T=u.logService;t.default=[function(){return e.$inject=["$scope","configurationService","restFormService","bubbleDialogService","$q"],{replace:!0,restrict:"AE",scope:{menu:"=",showPin:"="},controller:e,templateUrl:m.templateSourceFactory("components/sentiments")};function e(e,t,o,r,a){e.selectEntry=function(t){t.isDisabled()||(e.menu.selectEntry(t),v.getFilterState()===S.CLOSE&&function(){const e={strategy:E.REFRESH,delay:p.contextData.projectSettings.slow_refresh_timeout},t=w.getDecorator(b.getPageState(),b,C.PAGE_STATE,e);h.modelRefreshService.refresh(t,e).then(function(){},function(e){e instanceof Error&&T.error("Error when refreshing page state after selecting sentiment!",void 0,e)})}())},e.pinMenu=function(){e.menu.pin(b.getPageState().getProject().getId())},e.getChildren=function(){return e.menu.getRootEntry().getChildren().slice().reverse()},e.getCount=function(){e.filterCountLoading=!0;const t=[e.menu];s.each(e.menu.getJoinedMenuTypes(),function(e){const i=b.getPageState().getUserFilterSettings().getTopicMenuByType(e);s.isUndefined(i)||t.push(i)});const r=[];s.each(t,function(e){const t={page_state:b.getPageState().toProto(),filter_type:e.getType()},a=JSON.parse(JSON.stringify(e.toProto()));r.push(o.post(routes.controllers.tw.TWRestForm.post(y.getCurrentContext().scope,y.getCurrentContext().id,"filter_count","search","","rform").url,t).then(function(t){const o=new n.default(t.data_graph);i.refresh_hits(e.toProto(),o),s.isEqual(a,e)||(_.brokerService.publish(constants.events.topic_menu.refresh_hits),_.brokerService.publish(constants.events.filters.selected))},function(e){}))}),a.all(r).then(function(){e.filterCountLoading=!1})},e.getFilterCountText=function(e){return e.hasFilterHits()?"("+f.formatNumber(e.getFilterHits())+")":""},e.canShowCount=function(){return e.showPin&&t.getPageConfiguration().canShowFilterHits()},e.showFilterCountTooltip=function(i,n){if(i.hasFilterHits()){r.destroyById(constants.bubble_dialog.id.tooltip);const s={message:e.getFilterCountText(i)};r.createByType(constants.bubble_dialog.id.tooltip,n.target,constants.bubble_dialog.id.tooltip,s,t.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tooltip))}},e.closeFilterCountTooltip=function(e){e.hasFilterHits()&&r.scheduleDestructionById(constants.bubble_dialog.id.tooltip,250)}}}]}),define("components/sentiments/gauge/directive",["require","exports","underscore","services/widgets/widget_initializer","services/template_source","canvas_engine"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=n.widgetInitializer;t.default=[function(){return e.$inject=["$scope","$timeout","$element","TwPresence","engineConstants","TwDataGaugeSettings","TwDataGauge","TwDataSet","TwDataModel"],{replace:!0,restrict:"EA",scope:{cells:"=",width:"=",clickable:"="},controller:e,templateUrl:s.templateSourceFactory("components/sentiments/gauge")};function e(e,t,n,s,a,c,l,d,g){const u=n.children()[0],p=[];i.each(e.cells,function(e){const t=new d(e.value,e.color,"",e.previousValue,e.subLabel,e.label);i.isUndefined(e.filter)||t.setFilters(e.filter),p.push(t)});const h=new g(p),m=o.Stage.build(u,e.width+"%",15,60);e.stage=m.stage;const _=m.scene,f=new o.AnimationComponent;_.addComponent(f),_.setStyle(o.Style.Opacity,.2);const y=o.Rectangle.zero().setHeight(15),v=f.tween(y,[{key:"width",value:400,duration:r.getAnimationDuration()}]),S=f.tween(_,[{key:o.Style.Opacity,value:1,duration:r.getAnimationDuration()}]);_.setStyle(o.Style.Viewport,y),e.camera=m.camera;const b=s.zeroTopLeft().setStyle(o.Style.Width,e.stage.getWidth()).setStyle(o.Style.Height,e.stage.getHeight()).setStyle(o.Style.Opacity,_.getStyleMap()).setStyle(o.Style.Orientation,a.Orientation.HORIZONTAL),w=new c(h,void 0,void 0,e.clickable);w.enableColorTween(!0,!0).setAnimationDuration(300);const C=new l(b,e.$parent.$parent.widget,w);_.addChild(C),e.gauge=C,e.stage.onResize.subscribe(function(t){e.camera.setStyle(o.Style.Width,t.newWidth),e.gauge.setStyle(o.Style.Width,t.newWidth/t.scale)}),e.stage.start(_),t(function(){S.resume(),v.resume()},0,!1),e.clickable&&(e.gauge.onMouseEnter.subscribe(function(t){e.stage.getCanvas().style.cursor=a.Mouse.Cursor.Pointer}),e.gauge.onMouseLeave.subscribe(function(t){e.stage.getCanvas().style.cursor=a.Mouse.Cursor.Default})),e.$on("$destroy",function(){e.clickable&&(e.gauge.onMouseEnter.cancelAll(),e.gauge.onMouseLeave.cancelAll()),e.stage&&e.stage.dispose()})}}]}),define("components/settings/menu/directive",["require","exports","common_constants","components/form/common/topic_menu","services/context","services/template_source"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=s.contextService;t.default=["$rootScope",function(e){return t.$inject=["$scope","restFormService"],{restrict:"AE",scope:{location:"="},controller:t,link:function(e,t,i){},templateUrl:o.templateSourceFactory("components/settings/menu")};function t(t,s){const o=t.$watch(function(){return t.location.value},function(e,i){!function(){const e=r.getCurrentContext(),i=routes.controllers.tw.TWRestForm.get(e.scope,e.id,"settings_menu","show","","rform").url;s.get(i+"?location_id="+t.location.value).then(function(e){t.settings_menu=e.settings_menu},function(e){})}()});t.$on("$destroy",function(){o()}),t.getId=function(e){return e.mapped_id.split("/")[5].toUpperCase()},t.urlPresent=function(e){return void 0!==e.mapped_id&&""!==e.mapped_id},t.isSelected=function(e){return e.selected===i.topic_entry.selected.node},t.redirect=function(t){e.redirect(t)},t.iconType=function(e){return n.iconType(e)}}}]}),define("components/sign_up/free/directive",["require","exports","tzdetect","underscore","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["restFormService","$window",function(e,t){return o.$inject=["$scope"],{restrict:"A",scope:{displayDemo:"=?",formEntry:"="},controller:o,templateUrl:s.templateSourceFactory("components/sign_up/free")};function o(s){s.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},s.form_entry=s.formEntry,s.form_entry.timezone=i.determine().name(),void 0===s.displayDemo&&(s.displayDemo=!0),s.highlights_free=[window.messages.get("_283156"),window.messages.get("_104311"),window.messages.get("_146754")],s.signUp=n.debounce(function(i){i.preventDefault(),s.submitting=!0,e.post(s.form_entry.save_link,s.form_entry).then(function(e){const i=e.redirect_url;""!==e.redirect_url?t.location.href=i:s.form_entry=e},function(e){s.form_entry.field_messages=e.field_messages,s.form_entry.notification=e.notification,s.submitting=!1})},1e3,!0),s.isAnalyticsSignup=function(){return s.form_entry.talkwalker_project_type===constants.project_type.analytics}}}]}),define("components/sign_up/trial/page1/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope"],{restrict:"A",scope:{displayDemo:"=?",formEntry:"="},controller:e,templateUrl:i.templateSourceFactory("components/sign_up/trial/page1")};function e(e){e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.form_entry=e.formEntry,void 0===e.displayDemo&&(e.displayDemo=!0),e.highlights_trial=[window.messages.get("_286765"),window.messages.get("_927118"),window.messages.get("_602594"),window.messages.get("_791322"),window.messages.get("_235276")],e.goBack=function(){window.history.back()},e.clickYes=function(){e.form_entry.current_page="trial-2"}}}]}),define("components/sign_up/trial/page2/directive",["require","exports","tzdetect","underscore","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["restFormService","$window",function(e,t){return o.$inject=["$scope"],{restrict:"A",scope:{displayDemo:"=?",switchFormEntry:"=",formEntry:"="},controller:o,templateUrl:s.templateSourceFactory("components/sign_up/trial/page2")};function o(s){s.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},s.form_entry=s.formEntry,s.form_entry.timezone=i.determine().name(),void 0===s.displayDemo&&(s.displayDemo=!0),s.signUp=n.debounce(function(){s.showErrors=!0,s.register_form.$invalid||(s.submitting=!0,e.post(s.form_entry.save_link,s.form_entry).then(function(e){s.switchFormEntry(e)},function(e){s.form_entry.field_messages=e.field_messages,s.form_entry.notification=e.notification,s.submitting=!1}))},1e3,!0),s.goBack=function(e){e.preventDefault(),t.location.href=s.form_entry.back_url},s.getHref=function(){return t.location.href}}}]}),define("components/sign_up/trial/page3/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$window"],{restrict:"A",scope:{displayDemo:"=?",formEntry:"="},controller:e,templateUrl:i.templateSourceFactory("components/sign_up/trial/page3")};function e(e,t){e.form_entry=e.formEntry,e.goToAcademy=function(){t.location.href="http://www.talkwalker.com/en/academy/"},e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by}}}]}),define("components/social/accounts/directive",["require","exports","underscore","services/confirmation_service","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});const o=n.confirmationService;t.default=[function(){return e.$inject=["$scope","restFormService"],{restrict:"E",scope:{title:"=",confirmQuestion:"=",smaList:"=",showPages:"=",sharePageCallBack:"&"},controller:e,templateUrl:s.templateSourceFactory("components/social/accounts")};function e(e,t){e.social_media_accounts=constants.social_media_accounts,e.in_progress=!1;e.activateAccount=function(e){t.put(e.link_activate_status_oauth).then(function(){e.used_for_connection=!0},function(e){})},e.deactivateAccount=function(e){t.put(e.link_deactivate_status_oauth).then(function(){e.used_for_connection=!1},function(e){})},e.sharePage=function(i,n){t.put(n.link_share_page).then(function(t){e.sharePageCallBack({formEntry:t,account:i,page:n})},function(e){})},e.removeAccount=function(n){o.display({message:e.confirmQuestion}).then(function(){!function(n){e.in_progress=!0,t.deleter(n.link_delete_sma).then(function(){e.in_progress=!1,e.smaList=i.without(e.smaList,i.findWhere(e.smaList,{id:n.id}))},function(t){e.in_progress=!1})}(n)},function(){})},e.hasErrorStatus=function(e){return"ERROR"===e.status}}}]}),define("components/social/accounts/connect/directive",["require","exports","services/template_source","services/sma_service","classes/context_data/context_data","services/confirmation_service"],function(e,t,i,n,s,o){function r(){return e.$inject=["$scope","$attrs"],{templateUrl:i.templateSourceFactory("components/social/accounts/connect"),restrict:"E",scope:{siteCodes:"=",title:"=",projectId:"=",userId:"=?",selectedSma:"=?",externalTypeConnection:"=?"},controller:e};function e(e,t){return e.social_media_accounts=constants.social_media_accounts,e.connectExternalAccount=i,e.connectReviewTrackersAccount=r,e.getTimestamp=function(){return window.bootPayload.version},void(e.externalTypeConnection=e.externalTypeConnection||"SMA");function i(t){e.selectedSma=t,n.smaService.connectExternalAccount(t,e.externalTypeConnection,e.projectId,e.userId)}async function r(){if(!1===s.contextData.rules.isReviewTrackersEnabled())try{await o.confirmationService.display({message:{message:s.contextData.getMessage("_1563309"),hideCancel:!0}})}catch(e){}else try{await o.confirmationService.display({message:s.contextData.getMessage("_1563350")}),e.selectedSma=constants.social_media_accounts.review_trackers.code,await n.smaService.connectExternalAccount(constants.social_media_accounts.review_trackers.code,e.externalTypeConnection,e.projectId,e.userId)}catch(e){}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,t.SocialAccountsConnectDirective=r}),define("components/social/filters/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{restrict:"A",scope:{smallIcons:"=",socialList:"=",switchFilter:"&"},controller:["$scope",function(e){e.socialConstants=constants.social_media_accounts,e.getTimestamp=function(){return window.bootPayload.version}}],templateUrl:i.templateSourceFactory("components/social/filters")}}]}),define("components/sourcetypes/directive",["require","exports","components/form/common/topic_menu","common_constants","classes/application/application","services/template_source","services/broker"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=s.mainApplication;t.default=[function(){return e.$inject=["$scope","topicService"],{restrict:"A",scope:{filterMenuSet:"="},controller:e,templateUrl:o.templateSourceFactory("components/sourcetypes")};function e(e,t){e.getSourcetypesTM=function(e){return i.getTopicMenuByType(e.filters.topic_menu,constants.topic_menu.TYPE.media_type)};const s=a.getPageState().getUserFilterSettings().toProto();e.data=e.getSourcetypesTM(s),e.removeSelectSubscription=r.brokerService.subscribe(constants.events.filters.select,function(t,n){if(e.data.type===n){const n=i.findTopicEntry(e.data.root_entry,t);e.selectEntry(n)}}),e.selectEntry=function(i){e.isDisabled(i)||(t.selectTopicEntry(i.mapped_id,e.data.type,[e.data],void 0,!0),e.data.root_entry.selected===constants.topic_entry.selected.none?r.brokerService.publish(constants.events.filters.selected,[e.data.type]):r.brokerService.publish(constants.events.filters.selected,[e.data.type,!0]))},e.isSelected=function(e){return e?e.selected!==constants.topic_entry.selected.none:void 0},e.isDisabled=function(e){return e?!0===e.disabled:void 0},e.isVisible=function(e){return e?e.visibility===n.topic_entry.visibility.visible:void 0},e.$on("$destroy",function(){r.brokerService.unsubscribe(constants.events.filters.select,e.removeSelectSubscription)})}}]}),define("components/stateless_screen/section/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,restrict:"A",bindToController:{section:"=",pageData:"="},scope:{},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/stateless_screen/section")}};class n{isLoading(){return!this.section.isLoaded()}getAnalyticsSectionClass(){return"tw-stateless-analytics-section"}getReportsSectionClass(){return"tw-stateless-reports-section"}getSearchSectionClass(){return"tw-stateless-search-section"}}t.StatelessScreenSectionController=n}),define("components/stateless_screen/section/applications/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/stateless_screen/section/applications"),scope:{}}};class n{constructor(){this.styleType=constants.floating_content_structure.type.colored_section_block}}t.StatelessAppsSectionController=n}),define("components/stateless_screen/section/dashboards/directive",["require","exports","angular","angular_utilities","underscore","classes/floating_content/floating_content_structure","services/broker","services/modal","services/rest_form_service","wrappers/content_structure/content_structure_entry_wrapper","classes/context_data/context_data","services/confirmation_service","other/tw","services/custom_pages","services/template_source","services/application_mode"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:h.templateSourceFactory("components/stateless_screen/section/dashboards"),replace:!0,restrict:"AE",bindToController:{section:"="},scope:{},controllerAs:"vm",controller:_}};let _=class{constructor(e,t){this.$scope=e,this.DraggableDashboardsStrategy=t,this.styleType=constants.floating_content_structure.type.colored_section_block}$onInit(){this.draggableStrategy=new this.DraggableDashboardsStrategy(this.isDraggingAllowed());const e=r.brokerService.subscribe(constants.content_structure.loaded,()=>{this.draggableStrategy.active=this.isDraggingAllowed(),r.brokerService.unsubscribe(constants.content_structure.loaded,e)});this.$scope.$on("$destroy",()=>{this.draggableStrategy.dispose()}),this.editOptions=this.createEditOptions(),this.deleteOptions=this.createDeleteOptions()}hasUrl(){return void 0!==this.section.getUrl()}getStateIconNormal(){return this.section.getStateIconNormal()}createGroup(e){e.stopPropagation(),e.preventDefault();return a.modalService.display("ADD_TOPICS_CATEGORY",{name:""}).then(async e=>{const t=(await p.customPagesService.createNewGroup(e.name)).group_content_entry,i=new l.ContentStructureEntryWrapper(t,this.section.toProto());return new o.FloatingContentStructure(this.section.toProto()).addNewCategory(i),this.$scope.$applyAsync()})}createDeleteOptions(){return{onClick:e=>this.deleteEntry(e).then(()=>void 0),isAllowed:e=>!m.applicationMode.isMobile()&&this.section.getContent().isEditable()&&e.isEditable()&&!e.isClickActionToggle()}}isDraggingAllowed(){return!m.applicationMode.isMobile()&&this.section.hasContent()&&this.section.getContent().isEditable()&&!0===d.contextData.userSettings.admin}deleteEntry(e){const t=this.getIdFromMappedId(e.getMappedId());return e.isClickActionToggle()?g.confirmationService.display({message:d.contextData.getMessage("_810416")}).then(()=>p.customPagesService.removeGroup(t)):g.confirmationService.display({message:d.contextData.getMessage("_156847")}).then(()=>p.customPagesService.removeDashboard({mapped_id:e.getMappedId()}))}createEditOptions(){return{onClick:e=>{const t={title:d.contextData.getMessage("_1000202"),fields:[{name:d.contextData.getMessage("_1000203"),description:d.contextData.getMessage("_1000204"),maxLength:24,errorEmpty:d.contextData.getMessage("_484213"),errorTooLong:d.contextData.getMessage("_465328").replace("{0}","24"),initialValue:e.getTitle()}]};return this.section.getContent().isEditable()&&e.isEditable()&&(t.postTitleIcon={label:"icon-tw-trash-bin",action:this.deleteEntryFunction(e)}),a.modalService.display("GENERIC_TEXT_INPUT",t).then(t=>{const i=s(t).first(),n=this.getIdFromMappedId(e.getMappedId()),o=routes.controllers.tw.TWRestForm.post("project",u.tw.project_id,"custom_pages_group","update",n,"rform").url;return e.setTitle(i),c.restFormService.post(o,{id:n,title:i})})},isAllowed:e=>!m.applicationMode.isMobile()&&this.section.getContent().isEditable()&&e.isEditable()&&e.isClickActionToggle()}}deleteEntryFunction(e){return()=>this.deleteEntry(e).then(()=>r.brokerService.publish(constants.floating_content.entry.remove,[e]),()=>void 0)}getIdFromMappedId(e){const t=e.split("|");return t[t.length-1]}};_=__decorate([n.ngInject(["$scope","DraggableDashboardsStrategy"]),__metadata("design:paramtypes",[Object,Object])],_),t.StatelessDashboardsSectionController=_}),define("components/stateless_screen/section/discovery/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/stateless_screen/section/discovery"),scope:{}}};class n{constructor(){this.styleType=constants.floating_content_structure.type.colored_section_block}}t.StatelessDiscoverySectionController=n}),define("components/stateless_screen/section/generic/directive",["require","exports","classnames","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"=",classes:"=?",canLock:"=?"},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("components/stateless_screen/section/generic"),scope:{}}};class s{constructor(){this.styleType=constants.floating_content_structure.type.colored_section_block}$onInit(){this.canLock=void 0!==this.canLock&&this.canLock,this.allClasses=i({[this.classes]:!0,"floating-content-blocks panel":!0,locked:this.isLocked()})}getModel(){return this.section.getContent().getRootEntry()}getAllClasses(){return this.allClasses}isLocked(){return this.canLock&&this.getModel().isClickActionBubbleDialog()}}t.StatelessGenericSectionController=s}),define("components/stateless_screen/section/iq_apps/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/stateless_screen/section/iq_apps"),scope:{}}};class n{constructor(){this.styleType=constants.floating_content_structure.type.colored_section_block}}t.StatelessIqAppsSectionController=n}),define("components/stateless_screen/section/reports/directive",["require","exports","angular","angular_utilities","underscore","services/broker","services/modal","services/rest_form_service","classes/context_data/context_data","services/confirmation_service","other/tw","services/custom_pages","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:u.templateSourceFactory("components/stateless_screen/section/reports"),replace:!0,restrict:"AE",bindToController:{section:"="},scope:{},controllerAs:"vm",controller:p}};let p=class{constructor(e){this.$scope=e,this.styleType=constants.floating_content_structure.type.colored_section_block}$onInit(){const e=o.brokerService.subscribe(constants.content_structure.loaded,()=>{o.brokerService.unsubscribe(constants.content_structure.loaded,e)});this.editOptions=this.createEditOptions(),this.deleteOptions=this.createDeleteOptions()}hasUrl(){return void 0!==this.section.getUrl()}getStateIconNormal(){return this.section.getStateIconNormal()}createDeleteOptions(){return{onClick:e=>this.deleteEntry(e).then(()=>void 0),isAllowed:e=>this.section.getContent().isEditable()&&e.isEditable()&&!e.isClickActionToggle()}}deleteEntry(e){const t=this.getIdFromMappedId(e.getMappedId());return e.isClickActionToggle()?l.confirmationService.display({message:c.contextData.getMessage("_810416")}).then(()=>g.customPagesService.removeGroup(t)):l.confirmationService.display({message:c.contextData.getMessage("_156847")}).then(()=>g.customPagesService.removeDashboard({mapped_id:e.getMappedId()}))}createEditOptions(){return{onClick:e=>{const t={title:c.contextData.getMessage("_1000202"),fields:[{name:c.contextData.getMessage("_1000203"),description:c.contextData.getMessage("_1000204"),maxLength:24,errorEmpty:c.contextData.getMessage("_484213"),errorTooLong:c.contextData.getMessage("_465328").replace("{0}","24"),initialValue:e.getTitle()}]};return this.section.getContent().isEditable()&&e.isEditable()&&(t.postTitleIcon={label:"icon-tw-trash-bin",action:this.deleteEntryFunction(e)}),r.modalService.display("GENERIC_TEXT_INPUT",t).then(t=>{const i=s(t).first(),n=this.getIdFromMappedId(e.getMappedId()),o=routes.controllers.tw.TWRestForm.post("project",d.tw.project_id,"custom_pages_group","update",n,"rform").url;return e.setTitle(i),a.restFormService.post(o,{id:n,title:i})})},isAllowed:e=>this.section.getContent().isEditable()&&e.isEditable()&&e.isClickActionToggle()}}deleteEntryFunction(e){return()=>this.deleteEntry(e).then(()=>o.brokerService.publish(constants.floating_content.entry.remove,[e]),()=>void 0)}getIdFromMappedId(e){const t=e.split("|");return t[t.length-1]}};p=__decorate([n.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],p),t.StatelessReportsSectionController=p}),define("components/stateless_screen/section/setup/directive",["require","exports","services/tw_routing","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"="},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("components/stateless_screen/section/setup"),scope:{}}};class s{getModel(){return this.section.getContent().getRootEntry()}getStateIconNormal(){return this.getModel().getStateIconNormal()}goTo(e,t){t.preventDefault(),i.twRoutingService.changePageByUrl(e.getUrl(!1))}}t.StatelessSetupSectionController=s}),define("components/stateless_screen/section/topic_setup/options/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"A",bindToController:{section:"="},controllerAs:"vm",controller:n,templateUrl:i.templateSourceFactory("components/stateless_screen/section/topic_setup/options"),scope:{}}};class n{constructor(){this.styleType=constants.floating_content_structure.type.colored_section_block}}t.StatelessTopicSetupOptionsSectionController=n}),define("components/suggestions/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return e.$inject=["$scope","$element","$document","$window"],{replace:!0,restrict:"A",scope:{rootEntry:"=",addCallback:"&",searchCallback:"&"},controller:e,link:function(e,t,i){},templateUrl:n.templateSourceFactory("components/suggestions")};function e(e,t,n,s){let o;e.rootEntry.mapped_id===constants.topic_menu.TYPE.page_monitoring&&(e.iconConstants=constants.social_media_accounts,e.pageMonitoring=constants.topic_menu.TYPE.page_monitoring),e.showSuggestions=!1,e.vars={searching:!1},e.suggestionEntryTemplateUrl=BASE_TEMPLATE_URL+"components/suggestions/suggestion_entry.html",e.columnOne=function(t){const n=e.rootEntry.children,s=n.length;return i.indexOf(n,t)<Math.round(s/2)},e.columnTwo=function(t){const n=e.rootEntry.children,s=n.length,o=i.indexOf(n,t);return o>=Math.round(s/2)&&o<s},e.closeSuggestions=function(){e.rootEntry.children.length=0,l(!1)},e.old_search_input_object_url="",e.search=i.debounce(function(){if(e.old_search_input_object_url===e.rootEntry.input_object.url)return;e.old_search_input_object_url=e.rootEntry.input_object.url,e.rootEntry.input_object.field_messages={},d(!0);const t=Date.now();o=t,e.searchCallback({rootEntry:e.rootEntry}).then(function(i){!function(t){t===o&&(void 0!==e.rootEntry.children&&e.rootEntry.children.length>0&&(e.savedSuggestions=[],e.newSuggestions=[],e.rootEntry.children.forEach(function(t){!0===t.already_saved_in_project?e.savedSuggestions.push(t):e.newSuggestions.push(t)})),d(!1),l(!0))}(t)},function(){!function(e){e===o&&(d(!1),l(!1))}(t)})},350),e.add=function(t){e.closeSuggestions(),e.addCallback({entry:t,rootEntry:e.rootEntry})},e.isSearching=function(){return e.vars.searching};const r=e.$watch("rootEntry",function(t,n){i.isUndefined(n)||i.isUndefined(t)||i.isUndefined(t.input_object)||i.isUndefined(t.input_object.url)||!(t.input_object.url.length>0)||e.search()}),a=e.$watch("rootEntry.input_object.url",function(t,i){void 0!==t&&t.length>0&&!e.showSuggestions&&d()}),c=e.$watch("rootEntry.children",function(t,i){e.isSearching()&&d()}),l=function(t){void 0!==t?e.showSuggestions=t:e.showSuggestions?e.showSuggestions=!1:e.showSuggestions=!0},d=function(t){void 0!==t?e.vars.searching=t:e.vars.searching?e.vars.searching=!1:e.vars.searching=!0},g=function(i){!$(t).is(i.target)&&0===$(t).has(i.target).length&&e.showSuggestions&&e.$apply(function(){e.closeSuggestions()})};n.on("click",g),e.$on("$destroy",function(){n.off("click",g),r(),a(),c()})}}]}),define("components/suggestions/buttons_layout/directive",["require","exports","classes/context_data/context_data","services/template_source"],function(e,t,i,n){function s(){return e.$inject=["$scope","$window"],{templateUrl:n.templateSourceFactory("components/suggestions/buttons_layout"),restrict:"EA",replace:!0,scope:{suggestions:"=",clickCallback:"="},controller:e};function e(e,t){e.social_media_accounts=constants.social_media_accounts,e.getTimestamp=function(){return window.bootPayload.version},e.openPage=function(e,i){i.stopPropagation(),t.open(e.url,"_blank")},e.getOwnedPagesTitle=function(t){switch(t){case e.social_media_accounts.facebook_insights.code:return i.contextData.getMessage("_1810691");case e.social_media_accounts.linked_in.code:return i.contextData.getMessage("_1841406");case e.social_media_accounts.instagram_insights.code:return i.contextData.getMessage("_1787898");default:return`Unknown - "${t}" - accounts`}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.ButtonsLayoutSuggestions=s}),define("components/summary/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["twNumberFormatter",function(e){return t.$inject=["$scope"],{replace:!0,restrict:"E",scope:{widget:"="},controller:t,templateUrl:i.templateSourceFactory("components/summary")};function t(t){t.getFormattedTendency=function(t){return e.getInstance().toPercentage(t.getNumericData()/100)},t.hasLongValue=function(e){return e.split(" ").length>0}}}]}),define("components/tags/suggestion/inline/directive",["require","exports","underscore","jquery-inline-complete"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element"],{restrict:"A",scope:{tags:"=",ngModel:"=",selectCallback:"&"},controller:t};function t(t,n){function s(e){return i.chain(t.tags).filter(function(t){return t.alias.indexOf(e)>=0}).map(function(t){return t.alias.substring(t.alias.indexOf(e),t.alias.length)}).value()}function o(){e(function(){n.inlineCompleter({source:s})})}function r(e){$(e.target).val()&&i.contains([13,188],e.keyCode)&&(e.preventDefault(),t.selectCallback&&n.is(":valid")&&t.selectCallback({event:e})),i.contains([27],e.keyCode)||e.stopPropagation()}n.on("keydown",r),n.on("focus",o),t.$on("$destroy",function(){n.off("focus",o),n.off("keydown",r)})}}]}),define("components/tags/workflow/directive",["require","exports","underscore","components/form/common/topic_menu","classes/application/application","services/template_source","services/broker"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});const a=s.mainApplication;t.default=[function(){return{restrict:"A",scope:{filterMenuSet:"="},controller:["$scope",function(e){e.getTagsTM=function(){return n.getTopicMenuByType(e.user_filter_settings.filters.topic_menu,constants.topic_menu.TYPE.workflow_tags)},e.user_filter_settings=a.getPageState().getUserFilterSettings().toProto(),e.data=e.getTagsTM(),e.tagsHeader=e.data.root_entry,e.tags=e.tagsHeader.children,e.toggleTag=function(e){e.selected===constants.topic_entry.selected.none?t(e):s(e)},e.isSelected=function(e){return!!e&&e.selected!==constants.topic_entry.selected.none},e.columnOne=function(t){const n=e.tags,s=n.length;return i.indexOf(n,t)<Math.round(s/2)},e.columnTwo=function(t){const n=e.tags,s=n.length;return i.indexOf(n,t)>=Math.round(s/2)};const t=function(t){const n=i.indexOf(e.tags,t),s=e.tags.length/2;n<s&&e.tags[s+n].selected===constants.topic_entry.selected.node?e.tags[s+n].selected=constants.topic_entry.selected.none:n>=s&&e.tags[n-s].selected===constants.topic_entry.selected.node&&(e.tags[n-s].selected=constants.topic_entry.selected.none),t.selected=constants.topic_entry.selected.node,r.brokerService.publish(constants.events.filters.selected,[e.data.type])},s=function(e){e.selected=constants.topic_entry.selected.none}}],templateUrl:o.templateSourceFactory("components/tags/workflow")}}]}),define("components/text/text_editor_query",["require","exports","query_system","reusable_utilities","text_editor","queries/application_queries","queries/page_state_queries","services/text","services/configuration","classes/context_data/context_data","services/video_service","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){function p(e,t){const i=_(e);return t>=i.widthRange[0]&&t<=i.widthRange[1]}Object.defineProperty(t,"__esModule",{value:!0}),t.isTextLayoutAvailable=p;const h={type:s.TextEditorControllers.ImageUploadController,id:"imageUploadController",editOnly:!0,bindings:{image:"image",imageSeparator:"imageSeparator",imageUrl:"imageUrl"}},m={type:s.TextEditorControllers.VideoController,id:"videoUploadController",editOnly:!1,bindings:{video:"video",mediaUrl:"mediaUrl"}};function _(e){switch(e.mapped_id){case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_HEADLINE]:return{widthRange:[0,12],text:e.name,icons:["fa fa-header"],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_PARAGRAPH]:return{widthRange:[0,12],text:e.name,icons:["icon2-tw-headline"],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_HEADLINE_PARAGRAPH]:return{widthRange:[0,12],text:e.name,icons:["icon2-tw-headline","icon2-tw-text"],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_TEXT_TOP]:return{widthRange:[0,6],text:e.name,icons:["fa fa-align-left align-top","icon2-tw-image"],controllers:[h],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]}],[{widthRatio:1,items:[{type:s.LayoutElementTypes.ImageUpload,id:"image"},{type:s.LayoutElementTypes.HorizontalRule,editOnly:!0,id:"imageSeparator"},{type:s.LayoutElementTypes.SingleLineInput,editOnly:!0,id:"imageUrl"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_TEXT_BOTTOM]:return{widthRange:[0,6],text:e.name,icons:["icon2-tw-image align-top","fa fa-align-left"],controllers:[h],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.ImageUpload,id:"image"},{editOnly:!0,type:s.LayoutElementTypes.HorizontalRule,id:"imageSeparator"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"imageUrl"}]}],[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_IMAGE]:return{widthRange:[0,12],text:e.name,icons:["icon2-tw-image"],controllers:[h],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.ImageUpload,id:"image"},{editOnly:!0,type:s.LayoutElementTypes.HorizontalRule,id:"imageSeparator"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"imageUrl"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_VIDEO]:return{widthRange:[7,12],text:e.name,icons:["icon2-tw-video"],controllers:[m],blocks:[[{widthRatio:.5,items:[{type:s.LayoutElementTypes.VideoPreview,id:"video"}]},{widthRatio:.5,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"mediaUrl"},{type:s.LayoutElementTypes.SingleLineInput,optional:!0,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,optional:!0,id:"description"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_VIDEO_TOP]:return{widthRange:[0,6],text:e.name,icons:["icon2-tw-video"],controllers:[m],blocks:[[{widthRatio:1,items:[{type:s.LayoutElementTypes.VideoPreview,id:"video"}]}],[{widthRatio:1,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"mediaUrl"},{type:s.LayoutElementTypes.SingleLineInput,optional:!0,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,optional:!0,id:"description"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_TEXT_LEFT]:return{widthRange:[7,12],text:e.name,icons:["fa fa-align-left","icon2-tw-image"],controllers:[h],blocks:[[{widthRatio:.66,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]},{widthRatio:.33,items:[{type:s.LayoutElementTypes.ImageUpload,id:"image"},{editOnly:!0,type:s.LayoutElementTypes.HorizontalRule,id:"imageSeparator"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"imageUrl"}]}]]};case s.TextEditorLayouts[s.TextEditorLayouts.TEXT_TEXT_RIGHT]:return{widthRange:[7,12],text:e.name,icons:["icon2-tw-image","fa fa-align-left"],controllers:[h],blocks:[[{widthRatio:.33,items:[{type:s.LayoutElementTypes.ImageUpload,id:"image"},{editOnly:!0,type:s.LayoutElementTypes.HorizontalRule,id:"imageSeparator"},{editOnly:!0,type:s.LayoutElementTypes.SingleLineInput,id:"imageUrl"}]},{widthRatio:.66,items:[{type:s.LayoutElementTypes.TextStyleToolbar,id:"toolbar"},{type:s.LayoutElementTypes.SingleLineInput,id:"header"},{type:s.LayoutElementTypes.MultiLineInput,id:"text"}]}]]};default:throw new Error("unknown layout type: "+e.mapped_id)}}const f=[...o.queryApplicationGetMainPageState,r.queryPageStateIsEditMode],y=[...o.queryApplicationGetMainPageState,"allowed_pages","group_page",new i.TransformationQuery(e=>"REPORT"===e)];t.textEditorQuery=(e=>{const t=[new i.ProviderQuery(e),"widget",new i.TransformationQuery(e=>e.toProto())],s=[...t,"payload","value",new i.TransformationQuery(e=>JSON.parse(e))],o=[new i.ProviderQuery(e),"widget",new i.TransformationQuery(e=>e.getPageState().getAllowedPages().isCommandCenter()||e.getPageState().getAllowedPages().isCommandCenterWidgetPreview())];return new i.Query({settings:{useImageBackground:[new i.ProviderQuery(e),"widget",new i.TransformationQuery(e=>c.configurationService.getWidgetConfiguration(e.getType()).canUseBackgroundColor(e))],width:[...t,"width"],canDelete:[...s,"report_element_context",new i.TransformationQuery(e=>"body"===e)],showActionButtons:i.queryOr(f,y),header:{inlineLabel:new i.ForkQuery([...t,"width"],e=>new i.ProviderQuery(e>8)),hideLabels:new i.ForkQuery([...t,"width"],e=>new i.ProviderQuery(e<8)),size:new i.ForkQuery([...t,"width"],e=>e>=8?new i.ProviderQuery("big"):e>4?new i.ProviderQuery("medium"):new i.ProviderQuery("small"))},initialLayout:[...t,"menu","text_widget_layout_menu","root_entry","children",i.queryFindByProperty("selected","NODE"),"mapped_id"],layouts:new i.ForkQuery([...t,"width"],e=>new i.QueryArrayToMap([...t,"menu","text_widget_layout_menu","root_entry","children",i.queryUnderscore.filter(t=>p(t,e))],e=>new i.ProviderQuery(_(e)),{keyMap:e=>e.mapped_id}))},storeQueries:{getPayload:new i.ProviderQuery(()=>new i.Query(s).execute()),reset:new i.ProviderQuery(e=>{delete e.headline,delete e.text,delete e.content_url}),applyChanges:new i.ProviderQuery((e,t)=>Object.keys(t).forEach(i=>e[i]=t[i])),setLayout:new i.ProviderQuery((e,t)=>{n.TopicEntryUtils.recursiveUnselectAndSelect(e.menu.text_widget_layout_menu.root_entry,t),a.textService.changeConfig(e,dataTypeConf[t])}),persist:new i.ProviderQuery(e=>new i.PropertyMutationQuery([...t,"payload"],{value:JSON.stringify(e)}).execute()),getWidget:new i.ProviderQuery(()=>new i.Query(t).execute()),getWidgetWrapper:new i.ProviderQuery(()=>new i.Query([new i.ProviderQuery(e),"widget"]).execute())},description:[...t,"description"],id:[...t,"widget_id"],messages:{save:new i.ProviderQuery(l.contextData.getMessage("_612374")),cancel:new i.ProviderQuery(l.contextData.getMessage("_691638")),layout:new i.ProviderQuery(l.contextData.getMessage("_752506"))},content:{header:{data:[...s,"display_headline"],editModeData:[...s,"headline"],placeHolder:new i.ProviderQuery(l.contextData.getMessage("_1000700")),label:new i.ProviderQuery(l.contextData.getMessage("_1000701")),save:new i.ProviderQuery("headline")},toolbar:{data:[...s,"text_style"],save:new i.ProviderQuery("text_style"),enableTextLayouts:o},text:{data:[...s,"display_text"],editModeData:[...s,"text"],label:new i.ProviderQuery(l.contextData.getMessage("_1000702")),save:new i.ProviderQuery("text")},description:{data:[...s,"text"],label:new i.ProviderQuery(l.contextData.getMessage("_1000703")),save:new i.ProviderQuery("text")},mediaUrl:{data:[...s,"content_url"],label:new i.ProviderQuery(l.contextData.getMessage("_534534")),save:new i.ProviderQuery("content_url")},image:{label:new i.ProviderQuery("Upload Image"),data:[...s,"content_url"],save:new i.ProviderQuery("content_url"),brokenImageUrl:new i.ProviderQuery(g.resourcesService.getImageUrl(u.ImageResource.deadlinkPng))},video:{label:new i.ProviderQuery(l.contextData.getMessage("_534535")),data:[...s,"content_url"],hosts:new i.ProviderQuery(d.videoService.getHosts())},imageSeparator:{label:new i.ProviderQuery("or")},imageUrl:{label:new i.ProviderQuery("Image URL"),data:[...s,"content_url"],save:new i.ProviderQuery("content_url")},enableTextLayouts:o}})})}),define("components/text_entry/directive",["require","exports","underscore","services/tw_common","services/template_source","services/broker"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});const r=n.twCommon;t.default=["DirectiveWrapper","restFormService","logService","$timeout","$window",function(e,t,n,a,c){function l(t){this._initialize(t),e.call(this,t,l)}return l.$inject=["$scope"],l.prototype=i.extend(Object.create(e.prototype),{$scope:function(){return{$destroy:function(){o.brokerService.unsubscribe(constants.events.entry.translate,this.translate_entry_subscription)},translate:function(){const e=this;this.widget.getDic().load_more=!0;const i={};i.attributes=this.entry.getAttributes(),i.translation_state=this.entry.getTranslationState(),i.comment_entries=this.entry.getCommentEntries(),i.cluster_entries=this.entry.getClusterEntries(),t.post(routes.controllers.tw.TWRestForm.post("project",this.widget.getPageState().getProject().getId(),"translate_result","update","","settings").url,{entries:[i]}).then(function(t){t.entries.length>0?(e.entry.setAttributes(t.entries[0].attributes),e.entry.setTranslationState(t.entries[0].translation_state),e.widget.getDic().load_more=!1,o.brokerService.publish(constants.events.entry.refresh)):n.warn("failed to be translated",r.logFeatures.Entry)})},openLink:function(e,t){c.open(e,"_blank"),t.preventDefault()},toggleTranslation:function(){this.entry.isTranslated()?o.brokerService.publish(constants.events.entry.refresh):this.translate(),this.entry.toggleShowTranslated()},handleEntryTitleClick:function(e){this.widget.setReadIfNotTwitter(this.entry.toProto()),this.openLink(this.widget.getRedirectUrl(this.entry.toProto(),!0),e)}}},_initialize:function(e){e.translate_entry_subscription=o.brokerService.subscribe(constants.events.entry.translate,function(t){t===e.entry.toProto()&&(e.toggleTranslation(),o.brokerService.publish(constants.events.entry.refresh))})}}),{restrict:"A",scope:{widget:"=",contentFilter:"=",entry:"=",index:"=?",timezone:"=",handleClick:"=",isLastEntry:"=",handleContextButtonClick:"&onContextButtonClick",handleTranslateButtonClick:"&onTranslateButtonClick"},controller:l,link:function(e,t){a(function(){e.isLastEntry&&t.ready(function(){e.widget.setLoadMore(!0)})})},templateUrl:s.templateSourceFactory("components/text_entry")}}]}),define("components/theme_cloud/popup/directive",["require","exports","d3","reusable_services","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element","bubbleDialogService"],{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:t,link:function(e,t,i){},templateUrl:s.templateSourceFactory("components/theme_cloud/popup"),compile:function(){return{pre:o,post:r}}};function t(e,t,s){e.format=function(e){return isFinite(e)?i.format(",")(e):e},e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)},e.parseTextForEmoji=function(e){return!_.isUndefined(e)&&e.length>0?n.emojiService.parseTextForEmoji(e):""}}function o(e,t){t.css({opacity:"0"})}function r(t,i){e(function(){t.styleInformation.apply(t.referenceElement,i)},0,!1)}}]}),define("components/theme_preview/directive",["require","exports","services/theme","services/template_source"],function(e,t,i,n){function s(){return{replace:!0,bindToController:{stylesheets:"=",inheritedTheme:"=?"},controllerAs:"vm",controller:o,templateUrl:n.templateSourceFactory("components/theme_preview"),scope:{}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.ThemePreviewDirective=s;class o{constructor(e){this.$scope=e}$onInit(){this.determinePalette(this.stylesheets.getFirstSelectedEntryRecursively()),this.setupWatcher()}setupWatcher(){this.$scope.$watch(()=>this.stylesheets.getFirstSelectedEntryRecursively(),(e,t)=>{(e?e.getMappedId():"")!==(t?t.getMappedId():"")&&this.determinePalette(e)})}determinePalette(e){const t=i.themeService.findThemeByStrategy(e&&e.getMappedId())||this.inheritedTheme;if(void 0!==t&&void 0!==t.cssFile){const[e,i]=t.cssFile.split("_");this.paletteName=i}else this.paletteName=void 0}getThemeClass(){return this.paletteName}}o.$inject=["$scope"],t.ThemePreviewController=o}),define("components/time_filter/directive",["require","exports","underscore","common_constants","services/navbar","classes/application/application","services/refresh/model_refresh_service","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/navigation","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});const m=s.navbarService,_=s.FilterState,f=o.mainApplication,y=r.modelRefreshService,v=a.contextData,S=c.modelRefreshDecoratorFactory,b=d.ModelType,w=l.ModelRefreshStrategy,C=g.logService;t.default=["bubbleDialogService",function(e){return t.$inject=["$scope"],{restrict:"AE",scope:{userFilterSettings:"=ufs",filterState:"=",timeId:"=",sharingState:"=?",hidePin:"=?",hideDateTime:"=?",compact:"=?",embed:"=?",blackoutFunc:"=?",noInputs:"=?",blockDisabledEntries:"=?",allowRefresh:"=?"},controller:t,link:function(t,i){function n(n){t.open&&!i.is(n.target)&&0===i.has(n.target).length&&t.$apply(function(){t.open=!1,e.destroyById(constants.bubble_dialog.id.months)})}function s(){i.off(),t.embed||$(document).off("click",n)}i=$(i),t.getWidth=function(){const e=i.find(".time-filter-header-part").width();return e>0?e-24:void 0},t.embed||(i.on("click",function(e){t.hideDateTime||t.open&&e&&e.isDefaultPrevented()||t.$apply(function(){t.open=!0})}),$(document).on("click",n)),t.$on("$destroy",s),i.on("$destroy",s)},templateUrl:p.templateSourceFactory("components/time_filter")};function t(e){let t,s,o;function r(){if(i.isUndefined(e.eventsTM)||(e.eventsSelected=e.eventsTM.containsSelection()),!e.timeFilter.isOverrideMode()&&a()&&!e.timeFilter.hasNoInterval()||e.timeFilter.isOverrideMode&&a()?(e.timeFilterTM.setEntriesSelectionRecursively(!1),e.timeFilter.isOverrideMode()&&(e.timeFilter.setOverride(!0),i.isUndefined(e.eventsTM)||e.eventsTM.setOverride(!0)),e.timeFilter.setNoInterval(!1),e.embed||h.brokerService.publish(constants.events.filters.selected,[constants.events.time_filter.id])):!a()&&e.timeFilter.hasNoInterval()&&(e.timeFilter.selectDefaultTimeInterval(),e.timeFilter.isOverrideMode()&&(i.isUndefined(e.eventsTM)||e.eventsTM.setOverride(!1))),!e.embed&&m.getFilterState()===_.CLOSE||!0===e.allowRefresh)try{l(!1)}catch(e){e instanceof Error&&C.error("Error when refreshing page state after handling time filters !",void 0,e)}}function a(){return e.eventsSelected}function c(){return i.isUndefined(e.userFilterSettings.getTimeFilter().getFrom())||i.isUndefined(e.userFilterSettings.getTimeFilter().getTo())}function l(t){if(f.hasPageState()&&f.getPageState().getAllowedPages().isDocumentClusterIqApp()&&f.getPageState().getWidgets().length>0&&f.getPageState().getWidgets()[0].isDocumentCluster()&&f.getPageState().getWidgets()[0].hasPayloadValue()&&f.getPageState().getWidgets()[0].getPayloadValue().graph)return;const i={strategy:w.REFRESH},n=e.userFilterSettings.hasPageState()?e.userFilterSettings.getPageState():f.getPageState(),s=S.getDecorator(n,n.getApplication(),b.PAGE_STATE,i);t&&(i.delay=v.projectSettings.slow_refresh_timeout),y.refresh(s,i).then(function(){},function(){})}!function(){e.open=!i.isUndefined(e.embed)&&e.embed,e.timeFilter=e.userFilterSettings.getTimeFilter(),e.timeFilterTM=e.timeFilter.getTimeFilterMenu(),e.updating=!1,e.selectedEventRanges=[],e.root_id=constants.root_id,i.isUndefined(e.sharingState)&&(e.sharingState=!1);e.eventsTM=e.userFilterSettings.getTopicMenuByType(constants.topic_menu.TYPE.event),e.customTimeFilters=e.userFilterSettings.getTopicMenuByType(constants.topic_menu.TYPE.custom_time_filter),i.isUndefined(e.eventsTM)?e.eventsSelected=!1:e.eventsSelected=e.eventsTM.containsSelection()}(),e.embed||(e._removePageStateReceivedSubscription=h.brokerService.subscribe(constants.events.page_state.received,t=>{if(!e.userFilterSettings.isDisposed()&&e.userFilterSettings.getPageState().getId()===t.getId()){const t=e.timeFilter.isOverrideMode();(!t&&e.timeFilter.hasNoInterval()||t&&e.timeFilter.hasNoInterval()&&!c()||!e.timeFilter.isDefaultInterval())&&h.brokerService.publish(constants.events.filters.selected,[constants.events.time_filter.id]),h.brokerService.unsubscribe(constants.events.page_state.received,e._removePageStateReceivedSubscription)}})),e.embed||(t=h.brokerService.subscribe(constants.events.time_filter.reset,function(t){if(e.toggleAndUnselectEvents(),r(),e.timeId===t){e.timeFilter.isOverrideMode()&&e.timeFilter.setOverride(!1),void 0!==e.timeFilterTM.getRootEntry().getFirstSelectedEntry()?e.timeFilter.reset(e.userFilterSettings):e.timeFilter.setTimeInterval(constants.time_filter.TIME_INTERVAL.no_interval)}h.brokerService.publish(constants.events.time_filter.calendar.reset)})),e.sharingState&&(s=h.brokerService.subscribe(constants.events.time_filter.other_calendar.selected_events,function(t){e.timeId!==t&&(e.updating=!0,e.checkAndToggleEventsSelected())})),e.embed||(o=h.brokerService.subscribe(constants.events.time_filter.update,function(t){t&&e.toggleAndUnselectEvents(),r()})),e.formatTimeSpan=function(){return e.timeFilter.formatTimeSpan()},e.isOpen=function(){return e.open},e.isPredefinedEvents=function(e){return void 0!==e&&e.mapped_id===constants.root_id.predefined_events},e.isMyEvents=function(e){return void 0!==e&&e.mapped_id===constants.root_id.my_events},e.checkAndToggleEventsSelected=function(){r(),e.sharingState&&(e.updating?e.updating=!1:(e.userFilterSettings.checkFiltersChanged(),h.brokerService.publish(constants.events.time_filter.other_calendar.selected_events,[e.timeId])))},e.toggleAndUnselectEvents=function(){e.eventsTM&&(e.eventsSelected=!1,e.eventsTM.unselectAll())},e.isEventsSelected=function(){return a()},e.getSelectedEntries=function(t){let n=[];if(!i.isUndefined(e.eventsTM)&&e.eventsTM.hasRootEntry()&&e.eventsTM.getRootEntry().hasChildren()){const s=e.eventsTM.getEntryByMappedId(constants.root_id.predefined_events),o=e.eventsTM.getEntryByMappedId(constants.root_id.my_events);s&&i.each(s.getChildren(),function(e){d(e,n)}),d(o,n),n=n.slice(0,void 0!==t?t:n.length)}return n},e.anyEntrySelected=function(){return!i.isUndefined(e.eventsTM)&&e.eventsTM.containsSelection()},e.changeSelectedInterval=function(t,n){if(i.isUndefined(e.eventsTM)||e.eventsTM.setEntriesSelectionRecursively(!1),t.preventDefault(),n.isSelected()?e.timeFilter.setTimeInterval(n.getMappedId(),!0):e.timeFilter.setTimeInterval(void 0,!0),i.isUndefined(e.eventsTM)||(e.eventsSelected=e.eventsTM.containsSelection()),!e.embed&&m.getFilterState()===_.CLOSE||!0===e.allowRefresh)try{l(!0)}catch(e){e instanceof Error&&C.error("Error when refreshing page state after selecting interval !",void 0,e)}},e.canMultiSelectEvents=function(e){return e.getMappedId()===constants.root_id.my_events},e.isVisible=function(e){return e?e.getVisibility()!==n.topic_entry.visibility.never_visible:void 0},e.pinMenu=function(t){e.timeFilter.pin(f.getPageState().getProject().getId()),t.stopPropagation()},e.isPinnable=function(){return e.timeFilter.isPinnable()},e.canShowDateTime=function(){return(!c()||a())&&!e.hideDateTime},e.canShowIntervals=function(){return!e.compact||e.isOpen()},e.getTimeIntervalsContainerStyles=function(){let t=e.canShowDateTime()?"col-xs-6":"col-xs-12";return!e.isOpen()&&e.canShowDateTime()&&(t+=" right-border"),e.timeFilterTM.getRootEntry().getChildrenCount()<5?t+=" less-intervals":7===e.timeFilterTM.getRootEntry().getChildrenCount()&&(t+=" seven-intervals"),t},e.getDateTimeContainerStyles=function(){return e.canShowIntervals()?"col-xs-6":"col-xs-12"},e.handleDisabledAction=function(){u.navigationService.goToTrial(!0,"&cta=3")};const d=function(e,t){return e.hasChildren()&&t.push.apply(t,i.filter(e.getChildren(),function(e){return e.isSelected()})),t};e.$on("$destroy",function(){i.isUndefined(e._removePageStateReceivedSubscription)||h.brokerService.unsubscribe(constants.events.page_state.received,e._removePageStateReceivedSubscription),i.isUndefined(t)||h.brokerService.unsubscribe(constants.events.time_filter.reset,t),e.sharingState&&!i.isUndefined(s)&&h.brokerService.unsubscribe(constants.events.time_filter.other_calendar.selected_events,s),i.isUndefined(o)||h.brokerService.unsubscribe(constants.events.time_filter.update,o)})}}]}),define("components/tools/widgets",["require","exports","lazy","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});class s{static payloadChanges(e,t,i){if(e&&t){const t=s.extractPayloadJSON(e);t&&i(t)}}static extractPayloadJSON(e){if(!e)return e;const t=e.value?JSON.parse(e.value):void 0;return t&&t.data_graph?t:void 0}static extractSubobjects(e,t){let o={};return i(t).each(t=>{let i=t.split(".");if(i.length>0){i=n(i).filter(e=>e&&""!==e);const t=s._rec(e,i);o=s._merge_options(o,t)}}),o}static worldMapPayloadChanges(e,t,i){if(e&&t){const t=JSON.parse(e.value);t&&t&&t.data_graph&&i(t)}}static isClickable(e,t){return n.isUndefined(e.graph)||0===n.keys(e.graph).length||e.graph.navigation&&"y"===e.graph.navigation.toLowerCase()}static _rec(e,t){const i={};if(1===t.length)return void 0===e[t[0]]?null:i[t[0]]=e[t[0]];{const[n,...o]=t,r=e[n],a=s._rec(r,o);a&&(i[n]=a)}return i}static _merge_options(e,t){const i={};let n;for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);return i}}t.default=s}),define("components/tooltip/directive",["require","exports","underscore","jquery","services/tw_common","classes/context_data/context_data"],function(e,t,i,n,s,o){function r(e,t,r){return{restrict:"A",link:function(a,c,l){let d;function g(){c.off("click",u).off("mouseleave",u).off("mouseenter",p)}function u(){t.scheduleDestructionById(window.constants.bubble_dialog.id.tooltip,250)}function p(a){if(t.destroyById(window.constants.bubble_dialog.id.tooltip),!l.onOverflow||c[0].offsetWidth<c[0].scrollWidth){o.contextData.userSettings.tooltips&&(i.isUndefined(l.tooltipContent)?i.isUndefined(l.tooltipVariableContent)||(d=function(t,i){return t.split(".").reduce(function(e,t){return e[t]||i},e)}(l.tooltipVariableContent)):d=l.tooltipContent);const c={message:function(e){if(n("<div>").html(e).children().length){let t=e.slice(0);for(;t.indexOf("<")>=0;)t=t.slice(0,t.indexOf("<"))+t.slice(t.indexOf(">")+1);return t}return e}(d)},g=r.getBubbleDialogConfiguration().getStyle(window.constants.bubble_dialog.id.tooltip);if(!i.isUndefined(l.tooltipPlacement))switch(l.tooltipPlacement){case"top":g.setArrowSide(s.twCommon.sides.BOTTOM);break;case"right":g.setArrowSide(s.twCommon.sides.LEFT);break;case"bottom":g.setArrowSide(s.twCommon.sides.TOP);break;case"left":g.setArrowSide(s.twCommon.sides.RIGHT);break;default:console.warn("incorrect value")}t.createByType(window.constants.bubble_dialog.id.tooltip,a.target,window.constants.bubble_dialog.id.tooltip,c,g)}}o.contextData.userSettings.tooltips&&(!i.isUndefined(l.tooltipContent)&&l.tooltipContent.length>0||!i.isUndefined(l.tooltipVariableContent))&&(c.on("click",u).on("mouseleave",u).on("mouseenter",p),a.$on("$destroy",g))}}}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$window","bubbleDialogService","configurationService"],t.default=r,t.TooltipDirective=r}),define("components/top_images/directive",["require","exports","underscore","services/template_source","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["DirectiveWrapper","$timeout","navigationService",function(e,t,r){function a(t,i){e.call(this,t,a,i),t.redrawWidget=this.redrawWidget.bind(this,t),t.fragment.attach(t,i)}return a.$inject=["$scope","$element"],a.prototype=i.extend(Object.create(e.prototype),{$scope:function(e){return{getImages:function(){return i.isUndefined(this.images)&&(this.images=i.chain(this.widget.getTableBody().getRows()).map(function(e){return e.hasIconUrl()?e.getIconUrl():void 0}).compact().value()),this.images},deadLink:s.resourcesService.getImageUrl(o.ImageResource.deadlinkPng),isAnimated:function(){return e.animationEnabled},isFullyLoaded:function(){return this.images&&this.imagesLoaded},onClick:function(e,t){const n=this.widget.getTableBody().getRows()[e];i.isUndefined(n)||r.datagraphClick(this.widget.getDataGraph(),this.widget,e,0,t.target)}}},getTransitionDuration:function(e){return e.drawSettings.animationDuration},redrawWidget:function(e){return this._refresh(e),this._setupAnimation(e),t()},_refresh:function(e){this._changeElementOpacity(e,0,0),e.images=void 0,e.imagesLoaded=!1},_changeElementOpacity:function(e,n,s){i.each(e.$element.find("li.image-element"),function(i,o){i.style["transition-duration"]=750*n+"ms",t(function(){i.style.opacity=n},o*s),e.loadedImages+=1}),1===n?t(function(){e.imagesLoaded=!0},this.getTransitionDuration(e)+750+100,!1):e.imagesLoaded=!1},_setupAnimation:function(e){const i=this;t(function(){const t=e.getImages().length,n=i.getTransitionDuration(e)/t;i._changeElementOpacity(e,1,n)},0)}}),{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",drawSettings:"="},controller:a,templateUrl:n.templateSourceFactory("components/top_images")}}]}),define("components/trends/table/directive",["require","exports","reusable_services","event_bus","services/template_source","services/resources/resources","services/resources/resource","classes/context_data/context_data","data_structures"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l=i.emojiService;t.default=["DirectiveWrapper","$timeout","navigationService",function(e,t,i){function d(t){e.call(this,t,d),t.newTrendLabel=a.contextData.getMessage("_1231523");const i=$(`<span style="font-size: 12px ;color: #d7dade;font-family: 'RobotoR'; opacity:0">${a.contextData.getMessage("_1231523")}</span>`);i.appendTo("body");const s=i.outerWidth();i.remove(),t.tendencyWidth=Math.max(90,s);const o=t.widget.getTableBody().getRow(0);if(void 0!==o&&o.hasClickAction("new_topic")){t.disableSend=!1;const e=n.eventBus.subscribe(n.EVENT_TYPES.TOPIC_NAVBAR_APPLY_FILTER_AS_TOPIC,()=>{t.disableSend=!0,e.unsubscribe()});t.$on("$destroy",()=>{e.unsubscribe()})}}return d.$inject=["$scope"],d.prototype=Object.assign(Object.create(e.prototype),{$scope:function(){return{onRowClick:function(e,t){if(this.canRowReceiveClicks(e)){const s=this.widget.getTableBody().getRow(e);void 0!==s&&(s.hasClickAction("new_topic")?this.disableSend||n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_APPLY_FILTER_AS_TOPIC,value:{filter:s.getFilter(),label:s.getLabel()}}):i.datagraphClick(this.widget.getDataGraph(),this.widget,e,0,t.target))}},createTendencyData:function(e){return new c.Tendency(100+e.getTrendingPercentage(),100).build()},deadLink:o.resourcesService.getImageUrl(r.ImageResource.deadlinkPng),canRowReceiveClicks:function(e){const t=this.widget.getTableBody().getRow(e);return this.widget.isClickable()||t.hasClickActions()&&this.widget.hasPageState()&&this.widget.getPageState().hasAllowedPages()&&this.widget.getPageState().getAllowedPages().isSearch()},getRowLabel:function(e){const t=e.getLabel();try{return l.parseTextForEmoji(t)}catch(e){return t}}}},_setLoaded:function(e,i,n){i!==n&&0!==n||t(()=>{e.loaded=!0},0)}}),{restrict:"E",replace:!0,scope:{widget:"=",fullscreen:"="},controller:d,templateUrl:s.templateSourceFactory("components/trends/table")}}]}),define("components/twitter_toggle/directive",["require","exports","underscore","classes/application/application","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","log","services/template_source","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});const g=n.mainApplication,u=s.modelRefreshService,p=o.modelRefreshDecoratorFactory,h=a.ModelType,m=r.ModelRefreshStrategy,_=c.logService;t.default=[function(){return e.$inject=["$scope"],{replace:!1,restrict:"AE",scope:{},controller:e,templateUrl:l.templateSourceFactory("components/twitter_toggle")};function e(e){function t(){let t=!1;const s=n();if(!i.isUndefined(s)&&1===s.getSelectionCount()){const e=i(s.getSelectedEntriesRecursively()).first();t=!i.isUndefined(e)&&e.getMappedId()===constants.media_type.socialmedia_twitter.mapped_id}e.twitterOnly=t}function n(){return g.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.media_type)}e.twitterOnly=!1,e.isActive=function(){return e.twitterOnly},e.toggleTwitterOnly=function(){const t=n();e.twitterOnly?t.unselectAllAndSelect(t.getFirstSelectableEntry()):t.unselectAllAndSelectByMappedId(constants.media_type.socialmedia_twitter.mapped_id);e.twitterOnly=!e.twitterOnly,function(){const e={strategy:m.REFRESH},t=p.getDecorator(g.getPageState(),g,h.PAGE_STATE,e);u.refresh(t,e).then(function(){},function(e){e instanceof Error&&_.error("Error when refreshing page state after toggling twitter only !",void 0,e)})}()},function(){const n=i.debounce(t,50),s=d.brokerService.subscribe(constants.events.filters.selected,n);e.$on("$destroy",function(){d.brokerService.unsubscribe(constants.events.filters.selected,s)}),n()}()}}]}),define("components/wheel/directive",["require","exports","widget_base","classes/canvas_engine/settings/charts/wheel_chart_settings","services/tw_common","canvas_engine","classes/canvas_engine/charts/src/models/wheel_chart_model","classes/canvas_engine/charts/src/implementations/wheel_chart","reusable_utilities","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){return[function(){return e.$inject=["$element","$scope"],{replace:!0,restrict:"E",scope:{widget:"=",fragment:"=",mediator:"=",drawSettings:"="},controller:e,link:function(e){e.$on("$destroy",function(){e.loaded=!1,e.destroyChart(),void 0===e.inflatedSubscriptions?e.inflatedSubscriptions=[]:(e.inflatedSubscriptions.forEach(function(e){e.cancel()}),e.inflatedSubscriptions=[]),void 0===e.deflatedSubscriptions?e.deflatedSubscriptions=[]:(e.deflatedSubscriptions.forEach(function(e){e.cancel()}),e.deflatedSubscriptions=[])}),e.widget.hasReplayManager()&&e.widget.getReplayManager().onNewTimeline.subscribe(function(){e.rebuild=!0})},templateUrl:l.templateSourceFactory("components/wheel")};function e(e,t){e=$(e),t.id=t.widget.getDic().widget_id,t.element=e,t.fragment.attach(t,e),t.isTree=function(){return t.widget.hasTreePayloadType()},t.redrawWidget=function(l){return function(l){t.payload=t.widget.getPayloadValue();const d=Object.freeze({marginRight:150,AngleMod:3,RadiusMod:3,BorderMod:2,AnimationDuration:100,DepthMod:3}),g=Math.min(40,d.BorderMod+d.AngleMod+d.RadiusMod+1);let u;if(u=new r.WheelChartModel(t.payload,!0).enableDefaultLabels(!0),void 0!==t.isMultiLayered&&t.isMultiLayered!==u.isMultiLayered)return void t.widget.onLayoutChange.fire();t.isMultiLayered=u.isMultiLayered;let p=l.dimensions.width;const h=l.heightMode===i.WidgetHeightMode.LEGACY?Math.max(500,l.dimensions.height):l.dimensions.height;t.destroyChart(),t.isSampleData=u.isSampleData;const m=Math.max(0,Math.min(p/2-g,h/2-g));if(m>0){p=Math.min(p,h),t.canvas=e.find("canvas")[0],t.canvas.style.position="relative";const i=o.Stage.build(t.canvas,p,h,20,new o.StageSettings(3,2,[o.Constants.StageEvents.MouseWheel],l.style.resolutionScale));i.camera.disableTranslation(),t.stage=i.stage,t.camera=i.camera;const r=u.isMultiLayered?.2:.3,_=m*r,f=new o.Presence(p/2,h/2).setStyle(o.Style.Radius,m).setStyle(o.Style.Margins,g).setStyle(o.Style.Depth,_).setStyle(o.Style.SourceAngle,270).setStyle(o.Style.EndAngle,630),y=new n.WheelChartSettings({model:u}).enableDefaultLabels(!0).setAngleMod(d.AngleMod).setRadiusMod(d.RadiusMod).setDepthMod(d.DepthMod).enablePiePopovers(!0).setBorderMod(3).setAnimationDuration(d.AnimationDuration).setTransitionDuration(700).setDelayComputation(!0).setMargin(10).enableStaticBigSlices(!0).enablePopoverFooterAsLabel(!0).setNumberFormatter(l.style.formatting.numberFormatter),v=16;return u.isMultiLayered?y.enableLabelRotation(!0).enableSliceLimit(!0).limitRelevantSlicesTo(5).setLabelOrientation(o.Constants.Orientation.AUTO).enableRadiusTween(!0).enableDepthTween(!0).setLabelType(n.LabelType.curved).setMinArcRange(30).enableBorderTween(!0):y.enableColorTween(!1,!0).enableColorTween(!0),y.getLabelSettings().showOnFit(!0).flipText(!0).setShadowBlur(10).setMinVisibleFontsize(10).setShadowColor(c.Color.SHADOW_GREY()).setColor(c.Color.WHITE()).setAdaptiveMultiLine(!0).setSplitCharacter(" ").setAdaptive(!0).setBorderColor(c.Color.BLACK(.7)).setFontFamily(o.Constants.Font.Family.Digits).setFontSize(v).setDefferredAdaptation(!0),t.loaded||(y.setTransitionDuration(l.animationDuration),y.enableInitialAnimation(l.animationStrategy!==s.WidgetAnimationStrategy.INSTANT)),t.chart=new a.WheelChart(f,t.widget,y),t.chart.onReady.subscribeOnce(function(){t.widget.setFullyLoaded(!0)}),i.scene.addChild(t.chart),t.stage.start().then(function(){requestAnimationFrame(function(){t.initChart(i.stage)})}),void 0===t.inflatedSubscriptions?t.inflatedSubscriptions=[]:(t.inflatedSubscriptions.forEach(function(e){e.cancel()}),t.inflatedSubscriptions=[]),void 0===t.deflatedSubscriptions?t.deflatedSubscriptions=[]:(t.deflatedSubscriptions.forEach(function(e){e.cancel()}),t.deflatedSubscriptions=[]),t.chart.getCharts().forEach(function(e){t.inflatedSubscriptions.push(e.onSegmentInflated.subscribe(function(e){t.mediator.dispatch("WIDGET_MOUSEENTER",e)})),t.deflatedSubscriptions.push(e.onSegmentDeflated.subscribe(function(e){t.mediator.dispatch("WIDGET_MOUSELEAVE",e)}))}),t.loaded=!0,t.chart.onReady.subscribeOnceAsPromise()}{const e=$.Deferred();return setTimeout(function(){t.loaded=!0,e.resolve()}),e.promise()}}(l)},t.mediator.listen("REPLAY_STEP",function(){t.redrawWidget(t.drawSettings)}),t.mediator.listen("LEGEND_MOUSEENTER",function(e){t.chart.legendMouseEnter(e)}),t.mediator.listen("LEGEND_MOUSELEAVE",function(e){t.chart.legendMouseLeave(e)}),t.mediator.listen("LEGEND_MOUSECLICK",function(e){t.chart.legendMouseClick(e)}),t.initChart=function(e){t.chart.isReady?t.chart.animate():t.chart.onReady.subscribeOnce(function(){t.chart.animate(),e.processUpdate()}),e.processUpdate()},t.destroyChart=function(){_.isUndefined(t.stage)||(t.stage.dispose(),t.stage=void 0),t.chart=void 0,t.loaded=!1}}}]}),define("components/widget/directive",["require","exports","canvas_chart_utilities","common_constants","components/form/common/topic_menu","event_bus","log","react","reusable_components","reusable_utilities","classes/bubble_dialog/widget_dialog_config","classes/context_data/context_data","classes/custom_pages/custom_page_factory","classes/grid/grid","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/widget/blueprint_utilities","classes/widget/widget_fragment_factory/widget_fragment_factory","services/application_mode","services/broker","services/bubble_dialog","services/configuration","services/custom_pages","services/fullscreen","services/icons","services/navigation","services/refresh/model_refresh_service","services/template_source","services/tw_common","services/tw_routing","services/widgets/widget_section_service","wrappers/user_filter_settings/user_filter_settings_wrapper","components/bubble_dialog/react/articles_shortcuts_explanation_query","services/text"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){function e(e,t,A,N){r.logService.assert(angular.isDefined(t.widget),"widget is required");const L=new l.CancellationToken,B=t.$watch(()=>t.widget.getDicWrapper().getTs(),()=>t.widget.attachTemplate(e));L.addCleanupFunction(()=>B()),t.section&&R.WidgetSectionService.getInstance().addWidget(t.section,t.widget),t.isFullscreen=function(){return T.fullscreenService.isFullscreen()},t.hideActions=function(){j()||t.alwaysShowActions()||(!t.canShowEditButton()||t.canShowEditButton()&&!t.widget.isEditMode())&&(e.find("#widgetActionButtons").hide(),t.showBtnList=!1,Y()&&e.find(".tw-widget-menu").hide())},t.isReadOnly=function(){return t.widget.hasExtendedConfiguration()&&!!t.widget.getExtendedConfiguration().toProto().use_full_index_for_urls},t.showActions=function(){if(t.$$destroyed)return;j()||(e.find("#widgetActionButtons").show(),t.showBtnList=!0,t.isFilterActive=t.widget.getPageState().getUserFilterSettings().isAnyFilterActive()||t.widget.getPageState().getUserFilterSettings().getTopicMenuByPredicate(e=>e.getType()===constants.topic_menu.TYPE.event&&e.getRootEntry().containsSelection(!0)).length>0,t.isTopicActive=t.widget.getPageState().getUserFilterSettings().getTopicMenuByPredicate(e=>e.getType()===constants.topic_menu.TYPE.topic_pm_composed&&e.getRootEntry().containsSelection(!0)).length>0,Y()&&e.find(".tw-widget-menu").show())},t.getExpandTooltipText=function(){return t.widget.canReplay()?g.contextData.getMessage("_888948"):g.contextData.getMessage("_812692")},t.canNavigateToWidget=function(){return t.widget.hasNavigationOptions()},t.navigateToWidget=function(e,i){i.preventDefault(),e.type===constants.widget.navigation_option.url?x.twRoutingService.changePageByUrl(e.value):e.type===constants.widget.navigation_option.page?P.navigationService.moveToDisplayPageByMappedId(e.value):r.logService.error("Navigation option type has not been implemented for widget!",I.twCommon.logFeatures.Widget,t.widget)},t.canShowBigButton=function(){return!Y()};const W=t.widget.getPageState().getUserFilterSettings().toProto();angular.isDefined(W)&&(t.deletedResultsOptionMenu=s.getTopicMenuByType(W.filters.topic_menu,constants.topic_menu.TYPE.deleted_results_option)),L.subscribeToBrokerTopic(b.brokerService,constants.events.influencer_table_view_mode.change,()=>{t.isInfluencerTable()&&t.widget.getMenu().getViewModeMenu().unselectAll()});let U=!1;function G(e,i){if(e<0){const e=i.getLastWidget();i.removeWidget(e),t.widget.getPageState().insertSectionBelow(i).addWidget(e)}}function j(){return angular.isDefined(t.strategy)&&t.strategy.dragging}function H(e){return!j()&&(t.widget.getPageState().getApplication().getConfiguration().isWidgetActionAllowed(e,t.widget.getPageState().getApplication())&&C.configurationService.getPageConfiguration().isWidgetActionAllowed(e,t.widget))}function q(){const e=t.widget.getPageState(),i=e.getAllowedPages();return!(!(i.isReport()||i.isDashboard()&&e.isEditMode())||j())&&(t.widget.hasDataGraph()&&t.widget.hasNestType()&&t.widget.hasNestedDics()&&!t.widget.getDataGraph().hasIndicatorFrames())}async function V(){if(t.widget.hasPageState()&&t.widget.getPageState().getApplication()){const e={strategy:m.ModelRefreshStrategy.REFRESH},i=h.modelRefreshDecoratorFactory.getDecorator(t.widget.getPageState(),t.widget.getApplication(),f.ModelType.WIDGET,e);try{await D.modelRefreshService.refresh(i,e)}catch(e){e instanceof Error&&r.logService.error("Error when refreshing widget!",void 0,e)}}else r.logService.error("reload attempted on widget without page state, this could be due to a memory leak",I.twCommon.logFeatures.WidgetWrapper)}function z(e,t){return void 0!==(t=e&&e.getRootEntry()||t)&&t.hasVisibility()&&t.getVisibility()===n.topic_entry.visibility.not_visible||e.isButtonMenu()}function Y(){return t.widget.hasPageState()&&t.widget.getPageState().hasPageConfiguration()&&t.widget.getPageState().getPageConfiguration().pages&&t.widget.hasSlotConfiguration()}function X(e){return t=>t.mapped_id===constants.sort_by[e]}t.isWidgetFullScreenAllowed=function(){if(!(t.widget.isEmptyWidget()||t.widget.getPageState().getAllowedPages().isTrendDiscoveryOverview()||t.widget.getPageState().getAllowedPages().isReportPreview()||S.applicationMode.isMobile()))return H(I.twCommon.widgetActionButtons.FULL_SCREEN);return!1},t.isWidgetOverrideAllowed=function(){return H(I.twCommon.widgetActionButtons.OVERRIDE)},t.isWidgetResizeAllowed=function(){return H(I.twCommon.widgetActionButtons.RESIZE)},t.isWidgetResizeChartAllowed=function(){return!(!t.blueprint||!y.BlueprintUtilities.hasFragment(t.blueprint,i.LegendFragment))&&H(I.twCommon.widgetActionButtons.RESIZE_CHART)},t.canUnlinkNestedWidget=q,t.unlinkWidget=function(){q()&&t.widget.unlinkNestedWidgets()},t.isSelected=function(e){return e.selected===n.topic_entry.selected.node||s.childrenSelected(e)},t.toggleMenu=function(i){if(!t.widget.getDic().reload)if(void 0===t.menuBubble||t.menuBubble.isDisposed()){w.bubbleDialogService.destroyById("widget_menu");const i=C.configurationService.getBubbleDialogConfiguration().getStyle("widget_menu");t.menuBubble=w.bubbleDialogService.createByType("widget_menu",e.find("#widget-button-target"),"widget_menu",{widget:t.widget},i,{timeout:void 0}),t.menuBubble.onDestroy.subscribeOnce(()=>{t.widget&&t.widget.resolveScheduledMenuDelegates()})}else w.bubbleDialogService.destroyById("widget_menu"),t.widget.resolveScheduledMenuDelegates()},t.reload=async function(e){t.widget.setConfigurationChanged(!0),t.getExtendedConfiguration().offset=0,t.getExtendedConfiguration().loaded_urls=[],t.widget.prepareReload(e),await V()},t.getGroupByIcons=function(){return M.iconService.getIconMapForGroupMenu()},t.getSortByIcons=function(){return M.iconService.getIconMapForSortMenu()},t.decreaseWidgetWidth=function(){if(!t.canShrink()||t.widget.isReloading()||t.widget.getPageState().isLayoutBeingEdited())return;t.widget.isArticles()&&b.brokerService.publish(constants.events.entry.refresh,[t.widget.getId()]);if(!t.widget.isTable()||t.widget.isTable()&&t.widget.canShrink()&&!t.widget.isHeaderHidden()||t.widget.isWorldMap()&&t.widget.canShrink()&&t.widget.getHeightIndex>0){t.widget.getPageState().beginEditingPageLayout();const e=t.widget.getSection();if(t.widget.canShrink()){t.widget.shrink();let i=e.getRemainingWidth();const n=e.getWidgets();for(let s=0;s<n.length;s++)if(n[s]!==t.widget&&n[s].canExpand()&&n[s].canGrowBy(i)){n[s].expand(),G(i=e.getRemainingWidth(),e);break}}t.widget.getPageState().endEditingPageLayout()}!t.widget.isTable()||t.widget.canShrink()||t.widget.isHeaderHidden()||(t.widget.setHeaderHidden(!0),t.refreshWidget(t.widget))},t.increaseWidgetWidth=function(){if(!t.widget.canExpand()||t.widget.isReloading()||t.widget.getPageState().isLayoutBeingEdited())return;t.widget.isArticles()&&b.brokerService.publish(constants.events.entry.refresh,[t.widget.getId()]);t.widget.isTable()&&t.widget.isHeaderHidden()&&(t.widget.setHeaderHidden(!1),t.refreshWidget(t.widget));t.widget.getPageState().beginEditingPageLayout();const e=t.widget.getSection();if(t.widget.canExpand()){t.widget.expand();let i=e.getRemainingWidth();if(i<0){const n=e.getWidgets();for(let s=0;s<n.length;s++)if(n[s]!==t.widget&&n[s].canShrink()){n[s].shrink(),i=e.getRemainingWidth();break}}G(i,e)}t.widget.getPageState().endEditingPageLayout()},t.isMenuAllowed=function(){const e=t.widget.getPageState().getAllowedPages(),i=!S.applicationMode.isMobile()&&!e.isTrendDiscoveryOverview()&&!e.isVisualDiscoveryResults()&&!(e.isCommandCenterWidgetPreview()&&t.widget.isText())&&!(e.isSearch()&&t.widget.hasDataGraph()&&t.widget.getDataGraph().sample_data)&&(!e.isReportPreview()||g.contextData.rules.isProductProjectRuleEnabled()||t.widget.isText()),n=!t.isDeletedMode()&&!t.isFullscreen(),s=!(t.widget.isPageBreak()||t.widget.isText()&&t.widget.isEditMode());return t.widget.hasMenu()&&n&&i&&s},t.isMenuHidden=z,t.isDeletedMode=function(){return angular.isDefined(t.deletedResultsOptionMenu)&&t.deletedResultsOptionMenu.root_entry.children[0].selected===constants.topic_entry.selected.node},t.canShowContentFilterMenu=function(){return t.widget.isArticles()&&t.widget.hasExtendedConfiguration()&&angular.isDefined(t.widget.getMenu().getContentContainsType())&&!z(t.widget.getMenu().getContentContainsType())},t.isInfluencerTable=function(){return t.widget.isTable()&&t.widget.isInfluencerTableOptionPresent()},t.canShowWidgetHead=function(){if(t.widget.getPageState().getAllowedPages().isCommandCenterScreen())return!1;if(t.widget.getPageState().getAllowedPages().isSingleResultEntry())return!1;return t.widget.isInfluencerOverview()||t.widget.isText()||t.widget.isArticles()||t.widget.isTable()||t.widget.isMessageDiffusion()||angular.isDefined(t.widget.getTitle())||angular.isDefined(t.widget.getDescription())||t.hasGroupByMenu()||t.canShowNumberResultsMenu()||t.hasSortByMenu()||t.canShowThemeOptionsMenu()||t.widget.hasMenu()&&t.widget.getMenu().hasCustomMenus()},t.canShowFilterSelection=function(){if(j()||t.widget.isText()||t.widget.getPageState().getAllowedPages().isReportPreview()||S.applicationMode.isMobile())return!1;const e=t.widget.getPageState().getAllowedPages();return(e.isIqApp()&&"DEEP_ANALYTICS_DT_CATEGORY"===e.getPageCategory()||e.isIqApp()&&"LISTENING_DT_CATEGORY"===e.getPageCategory()||e.isDashboard()||e.isReport()||t.widget.getPageState().getAllowedPages().isCommandCenterWidgetPreview())&&t.widget.hasUf()&&!t.widget.isExternalTrends()||t.widget.isDocumentCluster()&&!(t.widget.hasPageState()&&t.widget.getPageState().isEditMode())},t.canShrink=function(){return t.widget.canShrink()||t.widget.isTable()&&!t.widget.canShrink()&&!t.widget.isHeaderHidden()||t.widget.isWorldMap()&&!t.widget.canShrink()&&t.widget.getHeightIndex()>0},t.hasGroupByMenu=function(){if(!t.widget.hasMenu())return;const e=t.widget.getMenu().toProto(),i=t.getExtendedConfiguration();return!(!e||e.hidden||!e.group_menu||!i||!i.group_by)},t.hasSortByMenu=function(){if(!t.widget.hasMenu())return;const e=t.widget.getMenu().toProto(),i=t.getExtendedConfiguration();return!!(e&&e.sort_menu&&i&&i.sort_by)},t.hasCompatibleDataMenu=function(){if(!t.widget.hasMenu())return!1;const e=t.widget.getMenu().toProto();return!!e&&!!e.compatible_data_types&&(!e.hidden||t.widget.getPageState().getAllowedPages().isTrendDiscoveryResults())},t.hasWidgetSizeMenu=function(){return t.widget.hasMenu()&&angular.isDefined(t.widget.getMenu().toProto().widget_width)},t.deleteWidget=function(){k.textService.removeTextWidget(t.widget.toProto(),t.widget.getPageState().getAllowedPages().getCustomPageType(),t.widget.getPageState())},t.getSelectedSortEntry=function(){return s.getSelectedBranchRecursive(t.getExtendedConfiguration().sort_by.root_entry,e=>e.name)},t.getSelectedSortEntryIcon=function(){return s.getSelectedBranchRecursive(t.getExtendedConfiguration().sort_by.root_entry,e=>e.mapped_id&&M.iconService.getIconForMetrics(e.mapped_id))},t.getSelectedContentFilterEntry=function(){return(t.widget.getMenu().toProto().content_contains_type.root_entry.children||[]).find(e=>e.selected===constants.topic_entry.selected.node).name},t.getSelectedGroupEntry=function(){return s.getSelectedBranchRecursive(t.getExtendedConfiguration().group_by.root_entry,e=>e.name)},t.handleWidgetTopicMenuSelect=function(e){e.hasChildren()&&(e.setSelected(!1),(e=_.first(e.getChildren())).setSelected(!0));let i;t.canShowTitle()||(i=I.twCommon.reloadingStrategy.WIDGET);t.refreshWidget(t.widget),t.reload(i)},t.selectContentFilter=function(e){const i=t.widget.getMenu().toProto().content_contains_type;A.selectTopicEntry(e.getMappedId(),i.type,[i]),t.widget.invalidateContentFilter(),t.refreshWidget(t.widget),t.reload(),b.brokerService.publish(constants.events.entries.destroy,[t.widget.getId()])},t.updateAndReload=function(){t.refreshWidget(t.widget),t.reload()},t.checkClustering=function(e){return e.mapped_id!==constants.sort_by.cluster_size||t.getExtendedConfiguration().group_by.root_entry.children[0].selected===n.topic_entry.selected.none},t.getExtendedConfiguration=function(){return t.widget.getExtendedConfiguration()&&t.widget.getExtendedConfiguration().toProto()},t.isReloading=function(){return t.widget.isReloading()},t.refresh=function(){t.refreshWidget(t.widget),t.widget.setReloadingStrategy(),t.reload()},t.isInfluence=X("influence"),t.isReach=X("reach"),t.isEngagement=X("engagement"),t.isPublishedDate=X("published_date"),t.isSearchIndexedDate=X("search_indexed_date"),t.isSortByFacebook=X("facebook"),t.isSortByTwitter=X("twitter"),t.isSortByYoutube=X("youtube"),t.isSortByCommentCount=X("comment_count"),t.isSortByClusterSize=X("cluster_size"),t.isSortByInstagram=X("instagram"),t.isSortByVelocity=X("velocity"),t.isSortByPmgSourceDate=X("pmg_source_date"),t.isSortByPmgDateSource=X("pmg_date_source"),t.isSortByPmgAve=X("pmg_ave"),t.isSortByPmgWortCount=X("pmg_wortcount"),t.isFilterActive=!1,t.widgetFiltersChanged=!1,t.canOverride=function(){if(!t.widget.getPageState().hasAllowedPages())return!1;return!t.widget.isText()&&(t.widget.getPageState().isEditMode()||t.widget.getPageState().getAllowedPages().isReport())&&t.widget.isContent()&&(t.isFilterActive||t.widget.hasFiltersChanged()||t.widget.getPageState().getAllowedPages().isDashboard()&&(t.isTopicActive||t.widget.hasConfigurationChanged()))},t.expandWidget=function(){if(t.widget.canBeFullScreen()&&!t.widget.isReloading()){const e=new d.WidgetDialogConfig(t.widget.getPageState());if(e.getStyle().setWidth("90%").setMaxWidth(0),t.widget.isArticles())e.setUfs(t.widget.getUf()).setForbidExpand(!0).setDisplayFullSizeWidget(!0),w.bubbleDialogService.createWidgetDialogBubble(e);else{const i=t.widget.clone();if(e.setGroupPage(t.widget.getPageState().getAllowedPages().getGroupPage()).setPageType("REPLAY").setShowCompareBar(!1).setMode(I.twCommon.WidgetBubbleMode.SINGLE_PAGE).setShowDrilldown(!1).setReuseActiveBubbleIfAble(!0).setWidgetToSend(i).setForbidExpand(!0).setDisplayFullSizeWidget(!0),i.getMenu().hasWidgetAnimationMenu()){const e=i.getMenu().getWidgetAnimationMenu();"NOT_ANIMATED"===e.getFirstSelectedEntry().getMappedId()&&i.getMenu().getWidgetAnimationMenu().unselectAllAndSelectByMappedId("ANIMATED_CUMULATIVE")}w.bubbleDialogService.createWidgetDialogBubble(e)}}},t.overrideWidget=function(){if(t.canOverride()&&!t.widget.isReloading()){t.widget.setFiltersChanged(!1);const e={mapped_id:t.widget.getPageState().getAllowedPages().getCustomPageId()};E.customPagesService.overrideWidget(t.widget.getPageState().getAllowedPages().getCustomPageType(),e,t.widget,t.widget.getPageState(),t.widget.getUf()).then(()=>{t.widget.getPageState().getAllowedPages().isCommandCenterScreenEditMode()||t.widget.setConfigurationChanged(!1)})}},t.canShowSearchModeMenu=function(){return!t.widget.isSkeleton()&&t.widget.hasMenu()&&t.widget.getMenu().hasSearchModeMenu()&&!z(t.widget.getMenu().getSearchModeMenu())},t.canShowTimefilterModeMenu=function(){return!t.widget.isSkeleton()&&t.widget.hasMenu()&&t.widget.getMenu().hasTimeFilterModeMenu()&&!z(t.widget.getMenu().getTimeFilterModeMenu())},t.refreshWidget=function(e){if(e.canBeSaved()){let i;if(t.widget.getPageState().getAllowedPages().isReport())i=constants.custom_page.type.report;else{if(!t.widget.getPageState().getAllowedPages().isDashboard())return;i=constants.custom_page.type.dashboard}const n={mapped_id:t.widget.getPageState().getAllowedPages().getCustomPageId()};E.customPagesService.saveWidget(i,n,e,t.widget.getPageState())}},t.avoidDragAndDrop=function(e){e.preventDefault(),e.stopPropagation()},t.toggleFilterSelection=function(e){if(U=!U){const i=[t.widget.getUf()];t.widget.hasNestedDics()&&(t.widget.getNestedDics()||[]).forEach(e=>{e.hasDataSource()&&i.push(new F.UserFilterSettingsWrapper(e.getPrimarySource().tw_data_source.uf,t.widget.getPageState(),I.twCommon.holderTypes.WIDGET,!0))}),w.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection);const n=w.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,$(e.target),i,C.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),t.widget.canBeSaved(),t.widget,void 0,!1);n.onDestroy.subscribeOnce(()=>{U=!1})}else w.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection)},t.canShowBody=function(){return!t.widget.isSkeleton()},t.canShowHiddenColumns=function(){if(j()||!t.widget.isTable()||!t.widget.getPageState().hasAllowedPages())return!1;if(Z().length<=0)return!1;const e=t.widget.getPageState().getAllowedPages();if(e.isReport())return!0;return(e.isDashboard()||e.isCommandCenterWidgetPreview())&&t.widget.getPageState().isEditMode()},t.canShowRemovedThemes=function(){if(j()||!t.widget.isThemeCloud()||!t.widget.getPageState().hasAllowedPages())return!1;const e=t.widget.getPageState().getAllowedPages();return(e.isDashboard()||e.isReport())&&t.widget.getPageState().isEditMode()&&J().length>0},t.getHiddenColumns=Z,t.getRemovedThemes=J,t.showAllThemes=function(){o.eventBus.dispatch({type:o.EVENT_TYPES.SHOW_ALL_THEMES,value:{widgetId:t.widget.getId()}})},t.showRemovedTheme=async function(e){o.eventBus.dispatch({type:o.EVENT_TYPES.SHOW_THEME,value:{widgetId:t.widget.getId(),text:e.label,id:e.id}})},t.showHiddenColumn=function(e){t.widget.getExtendedConfiguration().removeHiddenColumn(e),E.customPagesService.saveWidget(t.widget.getPageState().getAllowedPages().getCustomPageType(),{mapped_id:t.widget.getPageState().getAllowedPages().getCustomPageId()},t.widget),t.widget.isInfluencerTable()?(t.widget.prepareReload(),V()):t.widget.redraw(!0)},t.showAllColumns=function(){t.widget.getExtendedConfiguration().getHiddenColumns().length=0,E.customPagesService.saveWidget(t.widget.getPageState().getAllowedPages().getCustomPageType(),{mapped_id:t.widget.getPageState().getAllowedPages().getCustomPageId()},t.widget),t.widget.isInfluencerTable()?(t.widget.prepareReload(),V()):t.widget.redraw(!0)},t.$on("$destroy",function(){L.cancel(),R.WidgetSectionService.getInstance().removeWidget(t.widget),t.widget=void 0,t.strategy=void 0}),t.editWidget=(i=>{(function(){const e=p.Grid.getLastItemSelection();return void 0!==e&&(e.getCurrentItemId()===t.widget.getId()&&!t.widget.isEditMode()||e.getCurrentItemId()!==t.widget.getId()&&t.widget.isEditMode())})()&&i.stopPropagation(),Y()&&N(()=>{e.find(".tw-widget-menu").show()}),o.eventBus.dispatch({type:o.EVENT_TYPES.TOGGLE_EDIT_WIDGET,value:{id:t.widget.getId()}})}),t.canShowEditButton=(()=>{const e=t.widget,i=e.getPageState(),n=i.getAllowedPages(),s=n&&n.isCustomPage()&&i.isGridPage()&&(i.isEditMode()||n.isReport())&&(!n.isReportPreview()||g.contextData.rules.isProductProjectRuleEnabled()||e.isText()),o=e.isText()||e.isThemeTree()||e.isWorldMap()||e.isInfluencerNetwork()||e.isInfluencerTable()||e.isAreaChart()||e.isTable()||e.isLineChart()||e.isComposedGraph();return s&&o}),t.getEditButtonTooltip=(()=>t.widget.isEditMode()?g.contextData.getMessage("_904523"):g.contextData.getMessage("_344894")),t.handleDoubleClick=(e=>{t.canShowEditButton()&&!t.widget.isEditMode()&&t.editWidget(e)}),t.isFreeSearch=(()=>g.contextData.projectSettings.is_free_search),t.hasHelp=(()=>t.widget.isArticles()&&!t.widget.isArticlesKeyStories()&&!window.isExport&&S.applicationMode.getCurrentAppMode()!==S.AppMode.HOOTSUITE_DASHBOARD&&!S.applicationMode.isMobile()&&!t.widget.getPageState().getAllowedPages().isInstantDiscovery()),t.openHelp=(()=>{const e=C.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.shortcut_explanation);e.setAbsoluteY(window.pageYOffset+50),w.bubbleDialogService.createReactBubble(constants.bubble_dialog.id.shortcut_explanation,$("#page_content"),{query:O.articleShortcutsExplanationQuery},e=>a.createElement(c.ShortcutExplanation,{query:e.query,close:e.destroy}),e)}),t.shrinkWidgetChart=(()=>{const e=t.widget;e.getSlotConfiguration().trailing_whitespace++,e.redraw(!0),u.CustomPageFactory.getPageFromPageState(t.widget.getPageState()).saveWidget(t.widget)}),t.expandWidgetChart=(()=>{const e=t.widget;e.getSlotConfiguration().trailing_whitespace--,e.redraw(!0),u.CustomPageFactory.getPageFromPageState(t.widget.getPageState()).saveWidget(t.widget)}),t.canShowWidgetActions=(()=>!t.isFullscreen()&&!t.isFreeSearch()),t.isGridReport=(()=>t.widget.getPageState().isGridPage()&&t.widget.getPageState().getAllowedPages().isReport()),t.canShowFullscreenButton=(()=>t.isWidgetFullScreenAllowed()&&t.widget.canBeFullScreen()),t.canShowOverrideButton=(()=>t.isWidgetOverrideAllowed()&&t.canOverride()),t.canShowShrinkButton=(()=>t.isWidgetResizeAllowed()&&t.hasWidgetSizeMenu()&&t.canShrink()&&!t.widget.getPageState().isGridPage()),t.canShowExpandButton=(()=>t.isWidgetResizeAllowed()&&t.hasWidgetSizeMenu()&&t.widget.canExpand()&&!t.widget.getPageState().isGridPage()),t.canShrinkChartButton=(()=>t.isWidgetResizeChartAllowed()&&t.widget.hasSlotConfiguration()&&t.widget.getSlotConfiguration().trailing_whitespace<3),t.canExpandChartButton=(()=>t.isWidgetResizeChartAllowed()&&t.widget.hasSlotConfiguration()&&t.widget.getSlotConfiguration().trailing_whitespace>0),t.canShowResizeChartButton=(()=>t.isWidgetResizeChartAllowed()),t.alwaysShowActions=(()=>t.widget&&t.widget.getPageState().getAllowedPages().isCommandCenterWidgetPreview()),t.showOnlyEdit=(()=>t.canShowEditButton()&&t.widget.isEditMode()),t.blueprint=void 0,v.widgetFragmentFactory.getBlueprint(t.widget).then(e=>t.blueprint=e).catch(e=>!t.widget||t.widget.isDisposed()?Promise.resolve():Promise.reject(e)),t.reportPreview=function(){return t.widget.getPageState().getAllowedPages().isReportPreview()&&!g.contextData.rules.isProductProjectRuleEnabled()};let K=[],Q=0;function J(){if(void 0===t.widget.getExtendedConfiguration())return[];const e=l.StringUtils.calculateHash(t.widget.getExtendedConfiguration().getRemovedThemes().join());return e!==Q&&(K=[...t.widget.getExtendedConfiguration().getRemovedNormalThemes().map(e=>({id:"",label:e})),...t.widget.getExtendedConfiguration().getRemovedSmartThemes()]),Q=e,K}function Z(){if(t.widget.getDataGraph()){const e=t.widget.getExtendedConfiguration().getHiddenColumns()||[];return t.widget.getDataGraph().allCols.filter(({code:t})=>e.includes(t))}return[]}}return e.$inject=["$element","$scope","topicService","$timeout"],{priority:50,restrict:"EA",scope:{widget:"=",strategy:"=",disableInteraction:"=?",section:"=?"},controller:e,templateUrl:A.templateSourceFactory("components/widget")}}]}),define("components/widget/body/directive",["require","exports","angular_utilities","event_bus","graphics_utilities","log","reusable_utilities","widget_base","classes/application/abstract_application","classes/application/application","classes/widget/widget_fragment_factory/widget_fragment_factory","other/tw","services/application_mode","services/navigation","services/template_source","services/tw_common","services/widgets/widget_communication","services/widgets/widget_initializer","services/widgets/widget_menu_configuration","services/widgets/widget_size_calculator"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",templateUrl:h.templateSourceFactory("components/widget/body"),scope:{},bindToController:{widget:"=",fullscreen:"=?",disableInteraction:"=?"},controllerAs:"vm",controller:b}};let b=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.widgetContentDiv=this.$element.find(".tw-widget-content"),this.wasEmpty=this.widget.isEmptyWidget(),this.isInitialized=!1,this.isDisposed=!1,this.$scope.$on("$destroy",()=>{this.dispose()}),this.sanityCheck(),this.initialize()}sanityCheck(){if(1!==this.widgetContentDiv.length)throw new Error(`Expected 1 tw-widget-content found ${this.widgetContentDiv.length}`);if(void 0===this.widget)throw new Error("missing widget wrapper");if(!this.widget.getType())throw new Error("widget has no type!")}getWidgetStyle(){return this.disableInteraction?{"pointer-events":"none"}:{}}getCursor(){return this.disableInteraction&&this.widget.getPageState().isEditMode()?"cursor:move;":""}async initialize(){this.isDisposed=!1,this.cancellationToken=new r.CancellationToken,o.logService.debug(`initializing ${this.widget.getType()}`,m.twCommon.logFeatures.Widget,this.widget);const{layoutStrategy:e,config:t,fragments:i,unmanaged:n,hasMargin:s,transitionOnNewData:c}=await d.widgetFragmentFactory.createFragments(this.widget);this.cancellationToken.isCanceled()||(this.previousType=this.widget.getType(),this.widgetTransitionType=c,this.layout=i,this.config=t,this.widget.pixelHeight=0,this.updateCss(s),this.widgetManager=new a.WidgetManager(this.widgetContentDiv,{widthMode:S.widgetSizeCalculatorService.getWidthMode(this.widget),heightMode:S.widgetSizeCalculatorService.getHeightMode(this.widget),layoutStrategy:e,shouldEnableGlobalLegendMessages:this.shouldEnableGlobalLegendMessages()},i),f.widgetCommunicationService.registerWidget(this.widget,this.widgetManager.getMediator()),v.widgetMenuConfigurationService.getConfiguration(this.widget),this.initializeWidget(n,s))}shouldEnableGlobalLegendMessages(){return this.widget.getPageState().getAllowedPages().isIssueTrackerModule()}updateCss(e){e?this.$element.addClass("has-margin"):this.$element.removeClass("has-margin")}async initializeWidget(e,t){const i=S.widgetSizeCalculatorService.getIdealSize(this.widget),n=S.widgetSizeCalculatorService.getHeightMode(this.widget);let s;!e&&[a.WidgetHeightMode.FLEXIBLE,a.WidgetHeightMode.FULLSCREEN].includes(n)&&this.watchSizeChanges(),this.watchAlways(),e?(s=_.identity,this.widget.setFullyLoaded(!0)):(this.watchManaged(),s=((e,t,i)=>r.promiseTimeout(e,t,i)));try{await s(this.widgetManager.initialize({animationDuration:y.widgetInitializer.getAnimationDuration(),animationStrategy:y.widgetInitializer.getAnimationStrategy(),fragmentMetadata:d.widgetFragmentFactory.createFragmentMetadata(this.widget,this.layout,this.config),hasMargin:t,idealSize:i}),1e4,`widget ${this.widget.getType()} initialization timeout`)}catch(e){if(e instanceof Error)throw e;return o.logService.info("Initialization failed (probably aborted)",m.twCommon.logFeatures.Widget,this.widget),void this.dispose()}this.postInitialize(t)}async postInitialize(e){o.logService.debug(`initilization for ${this.widget.getType()} done`,m.twCommon.logFeatures.Widget,this.widget),this.widget.getTemplate()&&this.widget.getTemplate().css({opacity:1}),await this.markWidgetAsReadyToBeVisualized(e),this.checkPostInitializeCallback(),g.tw.inject("$rootScope").$apply(),this.checkPostInitializeCallback(),this.isInitialized=!0}checkPostInitializeCallback(){if(this.postInitializeCallback){const e=this.postInitializeCallbackArgs;this.postInitializeCallback(...e),this.postInitializeCallbackArgs=void 0,this.postInitializeCallback=void 0}}watchSizeChanges(){this.cancellationToken.registerCleanupFunction(this.widgetManager.onWidgetSizeCalculated.subscribe(e=>{this.widget.pixelHeight<e.height&&(this.$element.css({height:e.height}),this.widget.pixelHeight=e.height)}).cancel),this.widget.hasSection()&&this.cancellationToken.registerCleanupFunction(this.widget.getSection().onResize.subscribe(e=>{this.widget.pixelHeight<e&&(this.$element.css({height:e}),this.widget.pixelHeight=e,this.widget.redraw())}).cancel)}watchAlways(){this.cancellationToken.registerCleanupFunction(this.widget.onLayoutChange.subscribe(()=>{this.widget.setFullyLoaded(!1),this.redraw(!0)}).cancel),this.cancellationToken.registerCleanupFunction(this.widget.onDispose.subscribe(()=>{this.dispose()}).cancel)}deferIfNotInitialized(e){const t=this;return function(){const i=arguments;t.isInitialized?e.apply(t,i):(t.postInitializeCallback=e,t.postInitializeCallbackArgs=[].slice.apply(i))}}watchManaged(){this.cancellationToken.subscribe(this.widget.onTransitionWidgetObtained,()=>{this.isDisposed||this.performTransition()}),this.cancellationToken.subscribe(this.widget.onPayloadChange,this.deferIfNotInitialized(({newPayload:e,isLoadMore:t})=>{this.shouldDispose()?(this.wasEmpty=this.widget.isEmptyWidget(),this.dispose(),this.widget.isSkeleton()||this.initialize()):this.widget.hasPayloadValue()&&(this.widget.pixelHeight=0,this.widgetManager.update({widget:this.widget,subFragments:{}},t?a.DataAction.MORE_DATA:a.DataAction.DATA_CHANGED).then(()=>{this.isDisposed||(this.widget.setFullyLoaded(!1),this.scheduleRedraw())}))})),this.cancellationToken.subscribe(this.widget.onRedraw,this.deferIfNotInitialized(e=>{this.widget.setFullyLoaded(!1),this.redraw(e)})),this.cancellationToken.subscribe(this.widget.onResize,this.deferIfNotInitialized(()=>{this.widget.setFullyLoaded(!1),this.widgetManager.update({widget:this.widget,subFragments:{}},a.DataAction.DATA_CHANGED).then(()=>{this.isDisposed||this.redraw(!1)})})),(u.applicationMode.getCurrentAppMode()===u.AppMode.EMBEDDED||u.applicationMode.getCurrentAppMode()===u.AppMode.HOOTSUITE_DASHBOARD||u.applicationMode.isMobile())&&$(window).on("resize",_.debounce(this.deferIfNotInitialized(()=>{this.redraw(!1)}),250))}shouldDispose(){const e=this.widget.hasBluePrint()&&this.widget.getBlueprint().showEvenIfNoData;return this.widget.hasBluePrint()&&this.widget.getBlueprint().alwaysDisposeOnPayloadChange||!e&&(this.widget.isEmptyWidget()||this.widget.getType()!==this.previousType||!this.widget.isEmptyWidget()&&this.wasEmpty)}redraw(e){const t=Object.assign(this.drawSettings||{},{fragmentMetadata:d.widgetFragmentFactory.createFragmentMetadata(this.widget,this.layout,this.config),idealSize:S.widgetSizeCalculatorService.getIdealSize(this.widget)});this.widget.isText()||u.applicationMode.getCurrentAppMode()!==u.AppMode.IMAGE_EXPORT&&!g.tw.pageState.isGridPage()||this.$element.css("background-color",this.widget.hasExtendedConfiguration()?this.widget.getExtendedConfiguration().getBackgroundColor().toRGBA():"white"),e?(this.dispose(),this.initialize()):(o.logService.verbose(`drawing ${this.widget.getType()}`,m.twCommon.logFeatures.Widget,this.widget),this.widgetManager.draw(t).then(()=>this.widgetDoneDrawing()))}markWidgetAsReadyInstant(e,t,i){this.widget.setReadyToBeVisualized(!0),this.drawSettings={animationStrategy:0,animationDuration:0,fragmentMetadata:d.widgetFragmentFactory.createFragmentMetadata(this.widget,this.layout,this.config),hasMargin:e,idealSize:S.widgetSizeCalculatorService.getIdealSize(this.widget)},this.redraw(!1),t()}markWidgetAsReadyAnimatedInstant(e,t,i){this.widget.setReadyToBeVisualized(!0),this.drawSettings={animationStrategy:y.widgetInitializer.getAnimationStrategy(),animationDuration:y.widgetInitializer.getAnimationDuration(),fragmentMetadata:d.widgetFragmentFactory.createFragmentMetadata(this.widget,this.layout,this.config),hasMargin:e,idealSize:S.widgetSizeCalculatorService.getIdealSize(this.widget)},this.redraw(!1),t()}markWidgetAsReadyDefault(e,t,i){this.cancellationToken.registerCleanupFunction(this.widget.onInitializeVisualization.subscribeOnce(({strategy:i,duration:n})=>{o.logService.debug(`ready to render ${this.widget.getType()}`,m.twCommon.logFeatures.Widget,this.widget),this.drawSettings={animationStrategy:i,animationDuration:n,fragmentMetadata:d.widgetFragmentFactory.createFragmentMetadata(this.widget,this.layout,this.config),hasMargin:e,idealSize:S.widgetSizeCalculatorService.getIdealSize(this.widget)},this.redraw(!1),t()}).cancel),this.cancellationToken.setTimeout(()=>{this.widget.setReadyToBeVisualized(!0)})}async markWidgetAsReadyToBeVisualized(e){return new Promise((t,i)=>{if(!this.cancellationToken.isCanceled()){if(void 0===l.mainApplication.getWidgetById(this.widget.getId()))return this.markWidgetAsReadyInstant(e,t,i);switch(this.getWidgetReadyStrategy(this.widget)){case C.INSTANT:this.markWidgetAsReadyInstant(e,t,i);break;case C.INSTANT_ANIMATED:this.markWidgetAsReadyAnimatedInstant(e,t,i);break;case C.DEFAULT:this.markWidgetAsReadyDefault(e,t,i);break;default:throw new Error("Unknown mark widget as ready strategy")}}})}dispose(){void 0!==this.widgetManager&&this.widgetManager.dispose(),this.isDisposed=!0,this.isInitialized=!1,this.postInitializeCallback=void 0,this.widget.pixelHeight=0,this.cancellationToken.cancel()}widgetDoneDrawing(){this.cancellationToken.isCanceled()||(this.widget.setFullyLoaded(!0),!this.widget.isDisposed()&&this.widget.isTransitionWidget()&&this.performTransition(),n.eventBus.dispatch({type:n.EVENT_TYPES.WIDGET_DONE_DRAWING,value:{widget:this.widget}}))}performTransition(){switch(this.correctTransitionWidgetPosition(),this.widgetTransitionType){case a.WidgetTransitionType.FADE_OUT_IN:this.performFadeOutInTransition();break;case a.WidgetTransitionType.CROSS_FADE:this.performCrossFadeTransition();break;case a.WidgetTransitionType.FLIP:this.performFlipTransition();break;default:throw new Error("animation not implemented")}}performCrossFadeTransition(){this.widget.getTransitionTarget().getTemplate().parent().fadeTo(1e3,0);const e=this.widget.getTransitionTarget().getTemplate().parent(),t=this.widget.getTemplate().parent();s.animate(i=>{t.css({opacity:i}),e.css({opacity:1-i}),i>=1&&this.transitionDone()},2e3,this.cancellationToken)}performFadeOutInTransition(){this.widget.getTransitionTarget().getTemplate().parent().fadeTo(1e3,0);const e=this.widget.getTransitionTarget().getTemplate().parent(),t=this.widget.getTemplate().parent();s.animate(i=>{t.css({opacity:2*(i-.5)}),e.css({opacity:1-2*i}),i>=1&&this.transitionDone()},2e3,this.cancellationToken)}performFlipTransition(){const e=this.widget.getTransitionTarget().getTemplate().parent(),t=this.widget.getTemplate().parent();e.css({transform:"rotateY(0)","backface-visibility":"hidden"}),t.css({opacity:1,transform:"rotateY(180deg)","backface-visibility":"hidden"}),s.animate(i=>{t.css({transform:`rotateY(${180-180*i}deg)`}),e.css({transform:`rotateY(${180*i}deg)`}),i>=1&&this.transitionDone()},2e3,this.cancellationToken)}transitionDone(){this.widget.getPageState().deleteWidget(this.widget.getTransitionTarget(),!1)}correctTransitionWidgetPosition(){this.widget.getTransitionTarget().getTemplate();const e=this.widget.getTransitionTarget().getTemplate().parent().offset().left-this.widget.getTemplate().parent().offset().left;this.widget.getTemplate().parent().css({left:e})}getWidgetReadyStrategy(e){if(e.isTransitionWidget())return C.INSTANT;const t=e.getPageState().getAllowedPages();return t.isCommandCenter()||t.isCommandCenterScreenEditMode()||t.isCommandCenterScreen()||t.isCommandCenterWidgetPreview()?C.INSTANT_ANIMATED:C.DEFAULT}scheduleRedraw(){switch(this.getRedrawStrategy()){case w.INSTANT:this.redraw(!1);break;case w.DELAYED_BY_GRID_POSITION:this.delayRedrawByGridPosition();break;default:throw new Error("unknown redraw strategy")}}delayRedrawByGridPosition(){this.pendingRedrawToken&&this.pendingRedrawToken.cancel();const e=this.widget.getPageState().getWidgets().slice().sort((e,t)=>e.getSlotConfiguration().grid_y-t.getSlotConfiguration().grid_y||e.getSlotConfiguration().grid_x-t.getSlotConfiguration().grid_x);this.pendingRedrawToken=new r.CancellationToken,this.cancellationToken.setTimeout(()=>{this.pendingRedrawToken.isCanceled()||this.redraw(!1)},300*e.indexOf(this.widget))}getRedrawStrategy(){return this.widget.getPageState().getAllowedPages().isCommandCenterScreen()?w.DELAYED_BY_GRID_POSITION:w.INSTANT}shouldShowLoader(){return this.isReloading(m.twCommon.reloadingStrategy.BUBBLE)||this.isReloading(m.twCommon.reloadingStrategy.BUBBLE_NO_FADE)}shouldShowFade(){return this.isReloading(m.twCommon.reloadingStrategy.BUBBLE)}shouldApplyReloadStyle(){return this.widget.isReloadingWithDefaultStrategy()||this.widget.isReloadingWithWidgetStrategy()}goToTrial(){p.navigationService.goToTrial(!0,"&cta=5")}isReloading(e=m.twCommon.reloadingStrategy.DEFAULT){return this.widget.getReloadStrategy()===e&&this.widget.getPageState().getApplication().getType()===c.ApplicationType.MAIN}};var w,C;b=__decorate([i.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],b),function(e){e[e.INSTANT=0]="INSTANT",e[e.DELAYED_BY_GRID_POSITION=1]="DELAYED_BY_GRID_POSITION"}(w||(w={})),function(e){e[e.INSTANT=0]="INSTANT",e[e.INSTANT_ANIMATED=1]="INSTANT_ANIMATED",e[e.DEFAULT=2]="DEFAULT"}(C||(C={}))}),define("components/widget/head/widget_head_menu_strategy",["require","exports","react_components/menu/topic_menu_select_component_strategies/lazy_loaded_menu_strategy","services/tw_common","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","services/refresh/model_refresh_service","log"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.WidgetHeadMenuStrategy=class extends i.LazyLoadedMenuStrategy{constructor(e,t,i={refreshDataOnCloseOnly:!0}){super(e,i),this.widgetWrapper=t}onClose(){let e;this.widgetWrapper.setConfigurationChanged(!0),this.widgetWrapper.getExtendedConfiguration().setOffset(0),this.widgetWrapper.getExtendedConfiguration().clearLoadedUrls(),e=this.canShowTitle()?n.twCommon.reloadingStrategy.DEFAULT:n.twCommon.reloadingStrategy.WIDGET,this.widgetWrapper.prepareReload(e),this.refreshWidgetData()}canShowTitle(){return this.widgetWrapper.hasTitle()&&this.widgetWrapper.isDataLoaded()&&!this.widgetWrapper.isHideWidgetTitle()}async refreshWidgetData(){if(this.widgetWrapper.hasPageState()&&this.widgetWrapper.getPageState().getApplication()){const e={strategy:s.ModelRefreshStrategy.REFRESH},t=r.modelRefreshDecoratorFactory.getDecorator(this.widgetWrapper.getPageState(),this.widgetWrapper.getApplication(),o.ModelType.WIDGET,e);try{await a.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&c.logService.error("Error when refreshing widget!",void 0,e)}}else c.logService.error("reload attempted on widget without page state, this could be due to a memory leak",n.twCommon.logFeatures.WidgetWrapper)}}}),define("components/widget/head/directive",["require","exports","services/fullscreen","services/configuration","other/tw","services/tw_common","services/bubble_dialog","services/tw_routing","services/navigation","log","services/icons","services/embedded_widget","services/widgets/widget_factory","classes/custom_pages/custom_page_factory","classes/context_data/context_data","classes/widget/fragments/directive/widget_header_fragment","services/application_mode","classes/refresh/model_type","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","components/widget/head/widget_head_menu_strategy","reusable_utilities","classes/widget/types/widget_type","services/widgets/widget_section_service","angular_utilities","services/template_source","event_bus","services/resources/resources","services/resources/resource"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P,D,A,I){var x;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{},bindToController:{widget:"=",mediator:"=",config:"=",menuConfig:"="},controllerAs:"vm",controller:R,templateUrl:P.templateSourceFactory("components/widget/head")}},function(e){e.TOPIC_MENU_SELECT="TOPIC_MENU_SELECT",e.LABEL_SELECT="LABEL_SELECT",e.REACT_MENU_SELECT="REACT_MENU_SELECT",e.CUSTOM_MENUS="CUSTOM_MENUS"}(x=t.HeaderSectionTypes||(t.HeaderSectionTypes={}));let R=class{constructor(e,t){this.$scope=e,this.selectEntryDelegate=this.getSelectEntryDelegate.bind(this),this.refresh=this.reload.bind(this),this.customMenuSelectDelegate=this.handleCustomMenuSelect.bind(this),this.spacerHeight=0,this.upgradeIcon=A.resourcesService.getImageUrl(I.ImageResource.upgradeIconPng),this.widgetSectionService=T.WidgetSectionService.getInstance(),this.element=t}$onInit(){this.topicMenuSelectStyleModel=C.TopicMenuSelectStyleUtils.buildLabelStyleModel(),this.cancellationToken=new C.CancellationToken,this.widget.hasDataGraph()&&(this.cutoffMessage=this.widget.getCutoffMessage(),this.tokenExpirationMessage=this.widget.getTokenExpirationMessage()),this.mediator.listen(m.WidgetHeaderMediatorEventTypes.UPDATE_EVENT_TYPE,e=>{this.menuConfig=e,this.initSections()}),this.widgetSectionService.hasWidget(this.widget)&&(this.widgetSectionService.setWidgetAttribute(this.widget,"height",this.getHeaderHeight()),this.widgetSectionService.getSectionMediator(this.widgetSectionService.getSectionIdOfWidget(this.widget)).listen(T.WidgetSectionService.WIDGET_ATTRIBUTE_UPDATED_EVENT,e=>{e.widget!==this.widget&&"height"===e.attribute&&this.updateSpacer()},{token:this.cancellationToken}),this.$scope.$watch(_.throttle(()=>this.getHeaderHeight(),100),(e,t)=>{e!==t&&(this.widgetSectionService.setWidgetAttribute(this.widget,"height",e),this.updateSpacer())}),this.updateSpacer()),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel()})}calculateSpacerHeight(){const e=this.widgetSectionService.getWidgetAttributesForSection(this.widgetSectionService.getSectionIdOfWidget(this.widget),"height");if(e.length>1){const t=Math.max(...e),i=this.getHeaderHeight();if(t>i)return t-i}return 0}updateSpacer(){this.spacerHeight=this.calculateSpacerHeight(),this.element.find(".spacer").height(this.spacerHeight)}getHeaderHeight(){const e=this.element.find(".widget-head").first()[0].getBoundingClientRect();return Math.round(e.height)-this.spacerHeight}canShowSection(e,t,i){return this.menuNames.indexOf(e)>-1&&t===i}getSectionClass(e){switch(e){case"number_results_menu":return"number-of-results-menu";case"group_by":case"compatible_data_types":case"custom_menus":return"group-by-menu";default:return"sort-by-menu "+e.replace(/_/g,"-")}}canShowTitle(){return this.widget.hasTitle()&&(this.widget.getPageState().getApplication().getConfiguration().canShowWidgetTitle()||this.widget.getPageState().isWholePageExport())&&this.widget.isDataLoaded()&&!this.widget.isHideWidgetTitle()}canShowAutorefreshIcon(){return this.isFullscreen()&&this.widget.getPageState().getAllowedPages().isDashboard()}isAutorefreshEnabled(){return this.widget.isAutoRefreshEnabled()}isLoading(){return this.widget.isReloadingWithDefaultStrategy()||this.widget.isReloadingWithSpinnerStrategy()}hasNavigationOptions(){return this.widget.hasNavigationOptions()}navigateToWidget(e,t){t.preventDefault();const i=this.widget.getPageState().hasPageConfiguration();e.type===constants.widget.navigation_option.url?a.twRoutingService.changePageByUrl(e.value):e.type===constants.widget.navigation_option.page?i?D.eventBus.dispatch({type:D.EVENT_TYPES.GRID_PAGE_PAGE_TYPE_CHANGE,value:{pageType:e.value}}):c.navigationService.moveToDisplayPageByMappedId(e.value):l.logService.error("Navigation option type has not been implemented for widget!",o.twCommon.logFeatures.Widget,this.widget)}canShowResultCount(){return this.widget.getPageState().getApplication().getConfiguration().widgetShowResultCount()&&!this.widget.isVelocityChart()&&!this.widget.isHideWidgetMetrics()&&this.widget.hasResultCountText()&&this.widget.getPageState().getAllowedPages().getPageType()!==constants.page_type.context_menu_limited_read_only_results}isFullscreen(){return i.fullscreenService.isFullscreen()}saveAndReload(){this.save(),this.reload()}save(){if(this.widget.canBeSaved())if(s.tw.pageState.getAllowedPages().isEmbeddedWidget())g.embeddedWidgetService.update(s.tw.pageState).then(()=>{this.reload()});else{p.CustomPageFactory.getPageFromPageState(s.tw.pageState).saveWidget(this.widget)}}async reload(){let e;this.widget.setConfigurationChanged(!0),this.widget.getExtendedConfiguration().setOffset(0),this.widget.getExtendedConfiguration().clearLoadedUrls(),e=this.canShowTitle()?o.twCommon.reloadingStrategy.DEFAULT:o.twCommon.reloadingStrategy.WIDGET,this.widget.prepareReload(e),await this.refreshWidgetData()}getGroupByIcons(){return d.iconService.getIconMapForGroupMenu()}getSortByIcons(){return d.iconService.getIconMapForSortMenu()}getViewModePlaceholder(){return h.contextData.getMessage("_846512")}selectSortBy(e){const t=this.widget.getExtendedConfiguration().getSortByMenu();t.unselectAll(),e.hasChildren()&&(e=e.getChildren()[0]),t.getEntryByMappedId(e.getMappedId()).setSelected(!0),this.saveAndReload(),this.widget.getDic().primary_source.tw_result_source.cluster_configuration=void 0}getSelectEntryDelegate(e){switch(e.getAssociatedTopicMenu().getType()){case constants.topic_menu.TYPE.sort:return this.selectSortBy(e);case constants.topic_menu.TYPE.group:return this.selectGroupBy(e);case constants.topic_menu.TYPE.compatible_data_types:return this.selectView(e);case constants.topic_menu.TYPE.hashtag:return this.selectHashtagEntry(e);case constants.topic_menu.TYPE.view_mode_options:return this.selectViewModeOption(e);case constants.topic_menu.TYPE.theme_sampling_mode_menu:return this.selectThemeSamplingModeOption(e);default:return this.handleWidgetTopicMenuSelect(e)}}handleWidgetTopicMenuSelect(e){e.hasChildren()&&(e.setSelected(!1),(e=_.first(e.getChildren())).setSelected(!0)),this.saveAndReload()}selectViewModeOption(e){e.hasChildren()&&(e.setSelected(!1),(e=_.first(e.getChildren())).setSelected(!0)),this.widget.prepareReload(),this.refreshWidgetData().then(()=>{this.widget.onLayoutChange.fire(this.widget.getType(),this.widget.getType())},()=>void 0)}selectThemeSamplingModeOption(e){this.widget.getMenu().getThemeSamplingModeMenu().unselectAllAndSelectByMappedId(e.getMappedId()),this.saveAndReload()}selectHashtagEntry(e){this.widget.getMenu().getHashtagMenu().unselectAll(),e.hasChildren()?e.getChildren().forEach(e=>{e.setSelected(!0)}):e.setSelected(!0),this.saveAndReload()}selectGroupBy(e){const t=this.widget.getExtendedConfiguration().getGroupByMenu();t.unselectAll(),t.getEntryByMappedId(e.getMappedId()).setSelected(!0),this.saveAndReload(),this.widget.getDic().primary_source.tw_result_source.cluster_configuration=void 0}getExtendedConfiguration(){return this.widget.hasExtendedConfiguration()&&this.widget.getExtendedConfiguration().toProto()}selectView(e){const t=this.widget.getMenu().getCompatibleDataTypes(),i=this.widget.getType();this.widget.setVisualizationInitialized(!1),this.widget.setReadyToBeVisualized(!1),e.hasChildren()&&(e=_.first(e.getChildren())),t.selectEntry(e);const n=dataTypeConf[e.getMappedId()];s.tw.inject("topicService").selectTopicEntry(e.getMappedId(),this.widget.getDic().menu.compatible_data_types.type,[this.widget.getDic().menu.compatible_data_types]),this.widget.getDic().primary_source.data_type_configuration_uuid=e.getMappedId();this.widget.getDic().payload.type;this.widget.getDic().configuration_rendering=n.configuration,this.widget.getDic().configuration_rendering.uuid_configuration=n.configuration_type,this.widget.getDic().payload.type=n.payload_type;const r=u.widgetFactory.determineWidgetType(this.widget.toProto(),this.widget.getPageState());let a;this.shouldRewrapWidget(this.widget,i,r)&&(this.widget=u.widgetFactory.rewrapWidget(this.widget)),this.save(),this.widget.isWorldMap()?(this.widget.setConfigurationChanged(!0),this.widget.prepareReload(),a=this.refreshWidgetData()):this.widget.isArticles()?(this.getExtendedConfiguration().offset=0,this.getExtendedConfiguration().load_more=!1,this.widget.setConfigurationChanged(!0),this.widget.prepareReload(),a=this.refreshWidgetData()):this.widget.isTreeMap()?(this.widget.setConfigurationChanged(!0),this.widget.prepareReload(),a=this.refreshWidgetData()):this.widget.setConfigurationChanged(!0),i===this.widget.getType()||i===E.WidgetType.HORIZONTAL_BAR_CHART&&this.widget.isVerticalBarChart()||i===E.WidgetType.VERTICAL_BAR_CHART&&this.widget.isHorizontalBarChart()||this.widget.setReloading(!0,o.twCommon.reloadingStrategy.WIDGET),i!==this.widget.getType()?void 0!==a?(this.widget.getTemplate().css({opacity:.5}),a.then(()=>{this.widget.onLayoutChange.fire(i,this.widget.getType())})):this.widget.onLayoutChange.fire(i,this.widget.getType()):void 0!==a?a.then(()=>{this.widget.onLayoutChange.fire(i,this.widget.getType())}):this.widget.redraw()}shouldRewrapWidget(e,t,i){return n.configurationService.getWidgetConfiguration(t).shouldRewrapWidgetOnLayoutChange(e,i)}handleCustomMenuSelect(e){this.saveAndReload()}initTokenExpirationDialog(e){r.bubbleDialogService.createTokenExpirationBubble(this.widget.getTokenExpirationMessage(),$(e.target))}initCutoffBubble(e){r.bubbleDialogService.createCutoffLegendBubble(this.widget.getCutoffMessage(),$(e.target))}removeCutoffBubbleDialog(){r.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.cutoff,500)}removeTokenExpirationDialog(){r.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.cutoff,500)}canShowCutoffBox(){if(f.applicationMode.getCurrentAppMode()===f.AppMode.IMAGE_EXPORT)return!1;const e=this.widget.getPageState();return void 0!==e&&!e.getAllowedPages().isCommandCenterScreen()}hasTokenExpirationMessage(){return this.widget.hasDataGraph()&&void 0!==this.widget.getTokenExpirationMessage()}hasCutoffMessage(){return this.widget.hasDataGraph()&&void 0!==this.widget.getCutoffMessage()}initSections(){void 0!==this.menuConfig&&(this.sections={custom_menus:x.CUSTOM_MENUS,sort_menu:x.TOPIC_MENU_SELECT,group_menu:x.TOPIC_MENU_SELECT,view_mode:x.TOPIC_MENU_SELECT,hashtag_menu:x.REACT_MENU_SELECT,compatible_data_types:x.TOPIC_MENU_SELECT,breakdown_options:x.TOPIC_MENU_SELECT,tree_map_sort:x.TOPIC_MENU_SELECT,theme_options:x.TOPIC_MENU_SELECT,number_results_menu:x.LABEL_SELECT,theme_sampling_mode_menu:x.REACT_MENU_SELECT,select_search_data_function_menu:x.TOPIC_MENU_SELECT},this.menuNames=Object.keys(this.menuConfig))}getMenuStrategy(e){return new w.WidgetHeadMenuStrategy(e,this.widget,{refreshDataOnCloseOnly:!0})}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:v.ModelRefreshStrategy.REFRESH},t=b.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),y.ModelType.WIDGET,e);try{await S.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&l.logService.error("Error when refreshing widget!",void 0,e)}}else l.logService.error("reload attempted on widget without page state, this could be due to a memory leak",o.twCommon.logFeatures.WidgetWrapper)}};R=__decorate([M.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],R)}),define("components/widget/menu/directive",["require","exports","angular_utilities","common_constants","services/widgets/widget_menu_configuration","wrappers/topic_menu/topic_entry_wrapper","wrappers/widget/widget_wrapper","other/tw","services/embedded_widget","services/custom_pages","services/bubble_dialog","wrappers/topic_menu/topic_menu_wrapper","services/broker","services/icons","classes/context_data/context_data","notifications","services/export","services/tw_common","services/modal","services/commons","services/rest_form_service","log","services/widgets/widget_factory","services/command_center","services/configuration","services/widgets/widget_communication","services/context","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","event_bus","jquery","graphics_utilities","classes/widget/types/widget_type","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N){var L;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"A",replace:!0,templateUrl:N.templateSourceFactory("components/widget/menu"),scope:{},bindToController:{widget:"="},controllerAs:"vm",controller:B}},function(e){e.LABEL_SELECT_SECTION="LABEL_SELECT_SECTION",e.MULTI_LABEL_SELECT_SECTION="MULTI_LABEL_SELECT_SECTION",e.SIDE_MENU_SECTION="SIDE_MENU_SECTION",e.LARGE_ICON_SECTION="LARGE_ICON_SECTION",e.ON_OFF_SECTION="ON_OFF_SECTION"}(L=t.WidgetMenuSectionTypes||(t.WidgetMenuSectionTypes={}));let B=class{constructor(e,t,i,n,s){this.$scope=e,this.$element=t,this.$window=i,this.topicService=n,this.$rootScope=s,this.actions=[],this.sitePages=[],this.processingMonitorPage=!1}$onInit(){this.sections={},this.initMonitorChannels(),this.initializeWidgetActions()}initMonitorChannels(){this.widget.isInfluencerOverview()&&(this.sitePages=this.widget.getPayloadValue().influencer.site_pages||[])}async initializeWidgetActions(){s.widgetMenuConfigurationService.hasCachedConfig(this.widget)?this.widgetMenuConfiguration=s.widgetMenuConfigurationService.getCachedConfig(this.widget):(this.widgetMenuConfiguration=await s.widgetMenuConfigurationService.getConfiguration(this.widget),setTimeout(()=>{this.$scope.$apply()})),this.sections={translation_target_language_menu:L.LABEL_SELECT_SECTION,coloring_options_menu:L.LABEL_SELECT_SECTION,number_results_menu:L.LABEL_SELECT_SECTION,choropleth_map_menu:L.LABEL_SELECT_SECTION,metrics_menu:L.LABEL_SELECT_SECTION,y_axis_types:L.LABEL_SELECT_SECTION,transformations_menu:L.LABEL_SELECT_SECTION,comment_display_type_menu:L.LABEL_SELECT_SECTION,hide_widget_metrics:L.ON_OFF_SECTION,breakdown_options:L.LABEL_SELECT_SECTION,sort_menu:void 0!==this.widgetMenuConfiguration.sort_menu&&this.widgetMenuConfiguration.sort_menu.model instanceof o.TopicEntryWrapper?L.SIDE_MENU_SECTION:L.LABEL_SELECT_SECTION,legend_configuration_type:L.LABEL_SELECT_SECTION,legend_configuration_position:L.LABEL_SELECT_SECTION,group_menu:L.LABEL_SELECT_SECTION,select_search_data_function_menu:L.LABEL_SELECT_SECTION,author_source_menu:L.LABEL_SELECT_SECTION,page_monitoring:L.LABEL_SELECT_SECTION,theme_options:L.LABEL_SELECT_SECTION,filters:L.SIDE_MENU_SECTION,view_mode:L.SIDE_MENU_SECTION,hashtag_menu:L.SIDE_MENU_SECTION,time_axis_options:L.LABEL_SELECT_SECTION,cluster_labels_menu:L.LABEL_SELECT_SECTION,display_on_map_menu:L.MULTI_LABEL_SELECT_SECTION,compatible_data_types:L.SIDE_MENU_SECTION,nested_graph_type_menu:L.SIDE_MENU_SECTION,external_data_menu:L.SIDE_MENU_SECTION,report_actions:L.SIDE_MENU_SECTION,dashboard_page_menu:L.SIDE_MENU_SECTION,clone_dashboard_menu:L.SIDE_MENU_SECTION,command_center_menu:L.SIDE_MENU_SECTION,result_rule_menu:L.SIDE_MENU_SECTION,export_menu:L.LARGE_ICON_SECTION,export_complete_menu:L.LARGE_ICON_SECTION,share:L.LARGE_ICON_SECTION,export_share_menu:L.LARGE_ICON_SECTION,special_actions:L.SIDE_MENU_SECTION,theme_sampling_mode_menu:L.SIDE_MENU_SECTION},this.menuNames=Object.keys(this.widgetMenuConfiguration),this.addWidgetAction(constants.root_id.w_clone_widget,(e,t)=>{this.widget.getPageState().isGridPage()&&this.widget.getPageState().getAllowedPages().isReport()?R.eventBus.dispatch({type:R.EVENT_TYPES.GRID_REPORT_COPY_WIDGET,value:{widget:this.widget,pageId:this.widget.getSlotConfiguration().page}}):l.customPagesService.cloneWidget(t,this.getCustomPageContainer(),this.widget),this.close()}),this.addWidgetAction(constants.root_id.w_remove,(e,t)=>{this.widget.getPageState().getAllowedPages().isReport()&&this.widget.getPageState().isGridPage()&&R.eventBus.dispatch({type:R.EVENT_TYPES.GRID_UPDATE_PREVIEW,value:{pageId:this.widget.getSlotConfiguration().page}}),l.customPagesService.removeWidget(t,this.getCustomPageContainer(),this.widget).then(()=>{this.$rootScope.$$phase||this.$rootScope.$apply()}),this.close()}),this.addWidgetAction(constants.root_id.w_edit_title_description,(e,t)=>{const i=this.widget.clone().clearPayload().toProto(),n=C.widgetFactory.wrapWidget(i,this.widget.getPageState());n.setEditMode(!0),v.modalService.display("CUSTOM_PAGE_DASHBOARD",n,{keepBubbleDialogs:!0}).then(e=>{this.widget.getDic().title=e.getDic().title,this.widget.getDic().description=e.getDic().description,this.widget.getDicWrapper().setDisplayActiveFilters(e.getDicWrapper().isDisplayActiveFilters()),this.refreshWidget(this.widget)}),this.close()}),this.addWidgetAction(constants.root_id.w_edit_filters,(e,t)=>{const i={requested_handler:constants.routing.widget_edit_mode,requested_parameters:{id:this.widget.getPageState().getAllowedPages().getCustomPageId(),wid:this.widget.getDic().widget_id}};b.restFormService.post(routes.controllers.tw.TWRestForm.get(n.source_context.project,a.tw.project_id,"routing_service","create","","rform").url,i).then(e=>{void 0!==e.url&&(this.$window.location.href=e.url)})}),this.addWidgetAction(constants.root_id.w_set_as_trigger_condition,(e,t)=>{l.customPagesService.setAsTriggerCondition(t,this.getCustomPageContainer(),this.widget),this.close()}),this.addWidgetAction(constants.root_id.w_edit_background_color,this.editWidgetBackgroundColorAction.bind(this))}getIcon(e,t,i=!1,n){let s="";switch(e.getTopicMenuType()){case"DASHBOARD_ACTIONS":s="icon-tw-analytics-copy";break;case"REPORT_ACTIONS":s="icon2-tw-report";break;case"COMMAND_CENTER_ACTIONS":s="fa fa-television";break;case"RESULT_RULE":s="fa fa-tag"}switch(t){case"group_menu":s=p.iconService.getIconMapForGroupMenu()[e.getMappedId()].default||"";break;case"sort_menu":s=p.iconService.getIconMapForSortMenu()[e.getMappedId()].sort||""}if(s.length>0)return i?"fa fa-folder":s;const o=p.iconService.getIconForChart(e.getMappedId())||p.iconService.getIconForExport(e.getMappedId())||p.iconService.getIconForSpecialAction(e.getMappedId())||"ng-hide";return"ng-hide"===o&&void 0!==n&&e!==n?this.getIcon(n,t):o}monitorPage(e){if(!this.canMonitorPages()||!0===this.processingMonitorPage)return;this.processingMonitorPage=!0;const t=void 0===e?this.sitePages[0]:e,i={site_pages:[t],name:this.widget.getPayloadValue().influencer.name.value},n=routes.controllers.tw.TWRestForm.post(P.contextService.getCurrentContext().scope,P.contextService.getCurrentContext().id,"group_site_page","new","0","rform").url,s='<i class="fa fa-refresh fa-spin"></i> '+h.contextData.getMessage("_498245"),o=b.restFormService.post(n,i);m.notificationService.warning(s,{permanent:!0,singleInstance:!0,closeOnResolve:o}),o.then(e=>{this.removeSitePage(t),m.notificationService.success(h.contextData.getMessage("_513706"),{permanent:!0}),this.processingMonitorPage=!1,this.refreshPageData(),this.close()},e=>{this.processingMonitorPage=!1,m.notificationService.display(e.notification)})}canMonitorPages(){return(this.widget.isInfluencerOverview()||this.widget.isInfluencerTable())&&!_.isEmpty(this.sitePages)}getSitePages(e){return void 0===e||e?this.sitePages.filter(({author:e})=>void 0!==e&&!0===e):this.sitePages.filter(({author:e})=>void 0===e||!1===e)}removeSitePage(e){if(this.sitePages=this.sitePages.filter(t=>t.mapped_id!==e.mapped_id),this.widget.isInfluencerOverview()||this.widget.isInfluencerTable()){const e=this.widget.getPayloadValue();e.influencer.site_pages=this.sitePages,this.widget.setPayloadValue(e)}}getSecondaryLabelClass(e){const t=[this.getMenuOpenSide()];return"clone_dashboard_menu"!==e&&"dashboard_page_menu"!==e&&"report_actions"!==e||t.push("separate-last"),t.join(" ")}getMenuOpenSide(){return this.$element.offset().left>window.innerWidth/2?"pull-left":"pull-right"}canShowSection(e,t,i){return this.menuNames.indexOf(e)>-1&&t===i}addWidgetAction(e,t){w.logService.assert(void 0!==e,"mapped_id is required"),w.logService.assert(void 0!==t,"method is required"),w.logService.assert(2===t.length,"invalid method signature, must require exactly 2 arguments"),this.actions[e]=t}onOffChange(e,t){switch(e){case"influencer_highlight_by_source_panel":M.widgetCommunicationService.dispatchToWidget(this.widget.getId(),"SET_HIGHLIGHT_SOURCE_PANEL",t);break;case"hide_widget_metrics":setTimeout(()=>{this.widget.getMenu().toProto().hide_widget_metrics=!this.widget.getMenu().toProto().hide_widget_metrics,this.widget.onLayoutChange.fire(),this.widget.setConfigurationChanged(!0),this.refreshWidget(this.widget)});break;default:this.updateAndReload()}}dispatchLabelHideChange(e){const t=parseInt(e.mapped_id,10);this.widget.getExtendedConfiguration().setClusterLabelsShown(1===parseInt(e.mapped_id,10)),M.widgetCommunicationService.dispatchToWidget(this.widget.getId(),"DOCUMENT_CLUSTER_HIDE_LABEL_CHANGE",t),this.widget.setConfigurationChanged(!0),this.refreshWidget(this.widget)}dispatchColorChange(e){const t=parseInt(e.mapped_id,10);this.widget.getExtendedConfiguration().setColorScheme(t),M.widgetCommunicationService.dispatchToWidget(this.widget.getId(),"INFLUENCER_NETWORK_SWITCH_THEME",t),this.widget.setConfigurationChanged(!0),this.refreshWidget(this.widget)}handleLabelSelectChange(e,t){switch(e){case"cluster_labels_menu":this.dispatchLabelHideChange(t);break;case"coloring_options_menu":this.dispatchColorChange(t);break;case"y_axis_types":this.handleAxisTypeSelection(this.widget.getExtendedConfiguration().getYAxisConfiguration());break;case"comment_display_type_menu":this.selectCommentDisplayType(this.widget.getMenu().getCommentDisplayTypeMenu());break;case"legend_configuration_type":this.updateLegendType(t);break;case"legend_configuration_position":this.updateLegendPosition(t);break;case"author_source_menu":this.changeSourceOrAuthor();break;case"sort_menu":this.changeSortMenu();break;default:this.updateAndReload()}}updateLegendType(e){this.widget.getLegendConfiguration().setLegendType(e.mapped_id),this.widget.onLayoutChange.fire(),this.widget.setConfigurationChanged(!0),this.refreshWidget(this.widget)}updateLegendPosition(e){this.widget.getLegendConfiguration().setLegendPosition(e.mapped_id),this.widget.onLayoutChange.fire(),this.widget.setConfigurationChanged(!0),this.refreshWidget(this.widget)}changeSourceOrAuthor(){this.updateAndReload(),this.widget.isTable()&&this.widget.isInfluencerTableOptionPresent()&&u.brokerService.publish(constants.events.influencer_table_view_mode.change)}changeSortMenu(){this.widget.isInfluencerNetwork()||this.updateAndReload()}selectCommentDisplayType(e){const t=e.getFirstSelectedEntryRecursively();let i=!1;this.widget.getExtendedConfiguration().hasComments()&&t&&(this.widget.getExtendedConfiguration().getComments().forEach(e=>{e.display_type=t.getMappedId()}),i=!0),this.widget.hasNestedDics()&&this.widget.getNestedDics().forEach(e=>{e.hasExtendedConfiguration()&&e.getExtendedConfiguration().hasComments()&&(e.getExtendedConfiguration().getComments().forEach(e=>{e.display_type=t.getMappedId()}),i=!0)}),this.widget.getDataGraph().hasAdditionalFrames()&&(this.widget.getDataGraph().getAdditionalFrames()[0].comments.forEach(e=>{e.display_type=t.getMappedId()}),i=!0),i&&(this.updateAndReload(),this.widget.onRedraw.fire(!0))}handleAxisTypeSelection(e){e.setAxisType(e.getAxisTypeMenu().getFirstSelectedEntryRecursively().getMappedId()),this.updateAndReload()}executeSpecialAction(e){e.mapped_id===constants.special_actions.s_create_press_release?this.createPressRelease():e.mapped_id===constants.special_actions.s_edit_axis_label&&this.editAxisLabels()}createPressRelease(){const e={page_state:this.widget.getPageState().toProto()},t=routes.controllers.tw.TWRestForm.post(P.contextService.getCurrentContext().scope,P.contextService.getCurrentContext().id,"press_release","export","","rform").url,i=b.restFormService.post(t,e),n='<i class="fa fa-refresh fa-spin"></i> '+h.contextData.getMessage("_498245");m.notificationService.warning(n,{permanent:!0,singleInstance:!0,closeOnResolve:i})}editAxisLabels(){v.modalService.display("EDIT_AXIS_LABELS",this.widget.clone()).then(e=>{const t=this.widget.getExtendedConfiguration(),i=this.widget.hasNestedDics();if(this.widget.setEditMode(!0),void 0!==e.y){const i=t.hasYAxisConfiguration()?t.getYAxisConfiguration().toProto():{};void 0!==e.y.label&&e.y.label.length>0&&e.y.label!==i.label&&(i.label=e.y.label),t.setYAxisConfiguration(i)}if(void 0!==e.z&&i&&t.setZAxisConfiguration({label:e.z.label?e.z.label:void 0,auto_rename_legend:e.z.auto_rename_legend,use_main_axis:!!e.z.use_main_axis&&e.z.use_main_axis}),void 0!==e.scalingFunctionData&&i&&t.setZAxisTypeMenuData(e.scalingFunctionData),void 0!==e.rowLabel&&i){const t=_.first(this.widget.getNestedDics());t&&t.hasDataSource()&&(t.getDataSource().row_label=e.rowLabel)}this.refreshWidget(this.widget),this.widget.prepareReload(),this.refreshPageData()})}handleSideMenuPrimaryClick(e,t){switch(e){case"special_actions":this.executeSpecialAction(t.toProto());break;case"export_share_menu":this.exportOrShareObject(t.getParent(),t);break;case"export_menu":this.exportFunction(t.toProto());break;case"external_data_menu":this.toggleExternalDatasets(t);break;case"share":this.exportFunction(t.toProto());break;case"export_complete_menu":this.exportStreamingFct(t.toProto());break;case"nested_graph_type_menu":return void this.selectNestedLayout(t,this.widget.getMenu().getNestedGraphTypeMenu());case"result_rule_menu":this.actionForRuleTagging(t.toProto());break;case"compatible_data_types":this.selectLayout(t,this.widget.getMenu().getCompatibleDataTypes());break;case"filters":this.handlePredefinedFilterClick(t);break;case"clone_dashboard_menu":case"dashboard_page_menu":case"command_center_menu":case"report_actions":this.actionOnWidget(t.getTopicEntry(),t.getTopicMenuType()),s.widgetMenuConfigurationService.updateCache(this.widget);break;case"sort_menu":this.selectTopicEntry(t,this.widget.getExtendedConfiguration().getSortByMenu());break;case"view_mode":this.selectViewMode(t,this.widget.getMenu().getViewModeMenu());break;case"hashtag_menu":this.selectTopicEntry(t,this.widget.getMenu().getHashtagMenu());break;case"theme_sampling_mode_menu":this.selectTopicEntry(t,this.widget.getMenu().getThemeSamplingModeMenu())}}handleSideMenuSecondaryClick(e,t){switch(e){case"external_data_menu":this.selectExternalDataset(t,!0);break;default:this.handleSideMenuPrimaryClick(e,t)}}handleSideMenuTertiaryClick(e,t){switch(e){case"external_data_menu":this.selectExternalDataset(t,!1);break;default:this.handleSideMenuSecondaryClick(e,t)}}actionOnWidget(e,t){let i;if(t===constants.topic_menu.TYPE.dashboard_actions?i=constants.custom_page.type.dashboard:t===constants.topic_menu.TYPE.report_actions&&(i=constants.custom_page.type.report),e.children&&e.children.length>0){const t=new o.TopicEntryWrapper(e).getAllLeavesRecursively();e=_.first(t).toProto()}if(this.close(),e.mapped_id in this.actions)this.actions[e.mapped_id](e,i);else if(t===constants.topic_menu.TYPE.command_center_actions){const t=e.mapped_id,i=[this.widget.getDic()],n=this.widget.getPageState().copyAndPrune(!0);E.commandCenterService.addWidgetsToScreen({custom_page_id:t,page_state:n.toProto(),dics:i}),n.dispose()}else this.addWidget(e,i)}isValidCustomPageId(e){return void 0!==e&&"0"!==e}async addWidget(e,t){try{const i=e.mapped_id,n=this.widget.getPageState().clone();let s;this.isValidCustomPageId(i)?t===constants.custom_page.type.dashboard?s="CUSTOM_PAGE_DASHBOARD":t===constants.custom_page.type.report&&(s="CUSTOM_PAGE_REPORT"):s=t===constants.custom_page.type.dashboard?"ADD_WIDGET_TO_NEW_DASHBOARD":"ADD_WIDGET_TO_NEW_REPORT";let o=this.widget.clone();if(w.logService.assert(void 0!==s,"menuType is required!"),o.clearPayload(),o.setEditMode(!1),"CUSTOM_PAGE_DASHBOARD"!==s&&"CUSTOM_PAGE_REPORT"!==s||!this.widget.isText()){let e;if("ADD_WIDGET_TO_NEW_DASHBOARD"===s){const t=routes.controllers.tw.TWRestForm.get(P.contextService.getCurrentContext().scope,P.contextService.getCurrentContext().id,"dashboard_groups","show","","rform").url,i=await b.restFormService.get(t).then(e=>({title:void 0,description:void 0,dic:o.getDic(),description_filters_allowed:!1,groups:new g.TopicMenuWrapper(e.groups)})),n=constants.bubble_dialog.id.new_dashboard,s=T.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.new_dashboard),r=d.bubbleDialogService.createByType(n,F("#page_content"),"new-dashboard",i,s,{fadeBackground:!0});e=await new Promise((e,t)=>{r.onMessage.subscribeOnce(i=>{i.save?e(i.result):t()})})}else e="ADD_WIDGET_TO_NEW_REPORT"===s?await l.customPagesService.showMultipageModalForWidgetToNewReport(o):await v.modalService.display(s,o);if(void 0===e)return;let a={};if(e instanceof r.WidgetWrapper)o=C.widgetFactory.wrapWidget(e.getDic(),n),a={mapped_id:i,add_active_filters:e.getDicWrapper().isDisplayActiveFilters()};else{o=C.widgetFactory.wrapWidget(e.dic,n);const t=n.toProto();t.data_input_configuration=[],a={title:e.title,description:e.description,reports:e.reports,groups:e.groups,output_types_and_templates:e.output_types_and_templates,add_active_filters:e.description_filters_allowed,settings:e.settings,page_state:t}}const c=o.getLinkedWidgets();c.unshift(o),this.isValidCustomPageId(i)?l.customPagesService.addWidgetsToCustomPage(t,a,c,n):l.customPagesService.createCustomPageWithWidgets(t,a,c,n)}else l.customPagesService.addWidgetsToCustomPage(t,{mapped_id:i},[o],n)}catch(e){}}async selectTopicEntry(e,t){t.selectEntry(e),this.widget.setConfigurationChanged(!0),this.updateAndReload(!1)}handlePredefinedFilterClick(e){this.widget.getMenu().hasHashtagMenu()&&this.widget.getMenu().getHashtagMenu().unselectAll(),e.setChildrenSelectionRecursively(!1),e.toggleSelection(),this.updateAndReload(!0)}canShowYAxisTypes(){return(this.widget.isLineChart()||this.widget.isAreaChart()||this.widget.isBarChart()||this.widget.isBubbleChart())&&this.widget.hasExtendedConfiguration()&&this.widget.getExtendedConfiguration().hasYAxisConfiguration()&&this.widget.getExtendedConfiguration().getYAxisConfiguration().hasAxisTypeMenu()}selectLayout(e,t){const i=this.widget.getType();let s;this.widget.setVisualizationInitialized(!1),e.hasChildren()&&(e=e.getFirstVisibleChild()),this.canShowYAxisTypes()&&(s=this.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisType()),t.selectEntry(e);const o=dataTypeConf[e.getMappedId()];let r;w.logService.assert(void 0!==o,"data type configuration is invalid",y.twCommon.logFeatures.Widget),this.topicService.selectTopicEntry(e.getMappedId(),this.widget.getDic().menu.compatible_data_types.type,[this.widget.getDic().menu.compatible_data_types]),this.widget.hasNestedDics()&&this.widget.getMenu().hasNestedGraphTypeMenu()&&this.topicService.validateLinkedMenuSelection(this.widget.getMenu().getCompatibleDataTypes(),this.widget.getMenu().getNestedGraphTypeMenu(),[constants.data_type_categories.line_chart_group]),this.widget.getDic().primary_source.data_type_configuration_uuid=e.getMappedId(),this.widget.getDic().primary_source.data_type=o.data_type,this.widget.getDic().configuration_rendering=o.configuration,this.widget.getDic().configuration_rendering.uuid_configuration=o.configuration_type,this.widget.setCanBeDrawn(!1),this.widget.getDic().payload.type=o.payload_type;const a=C.widgetFactory.determineWidgetType(this.widget.toProto(),this.widget.getPageState());if(this.shouldRewrapWidget(this.widget,i,a)&&(this.widget=C.widgetFactory.rewrapWidget(this.widget)),e.getTopicEntry().select_action===constants.widget.refresh_widget||i===k.WidgetType.WHEEL_CHART?(this.refreshWidget(this.widget),this.widget.prepareReload(),r=this.refreshWidgetData()):(this.refreshWidget(this.widget),this.widget.isWorldMap()?(this.widget.setConfigurationChanged(!0),this.widget.prepareReload(),this.widget.getExtendedConfiguration().setSkipDataLoading(!0),r=this.refreshWidgetData()):this.widget.isArticles()?(this.getExtendedConfiguration().offset=0,this.getExtendedConfiguration().load_more=!1,this.widget.setConfigurationChanged(!0),this.widget.prepareReload(),r=this.refreshWidgetData()):this.widget.setConfigurationChanged(!0)),(i!==this.widget.getType()||!this.widget.isThemeCloud())&&(i===this.widget.getType()||i===k.WidgetType.HORIZONTAL_BAR_CHART&&this.widget.isVerticalBarChart()||i===k.WidgetType.VERTICAL_BAR_CHART&&this.widget.isHorizontalBarChart())||this.widget.setReloadingStrategy(y.twCommon.reloadingStrategy.WIDGET),void 0!==r?(this.widget.isWorldMap()||this.widget.getTemplate().css({opacity:.5}),r.then(()=>{this.widget.onLayoutChange.fire(i,this.widget.getType())})):this.widget.onLayoutChange.fire(i,this.widget.getType()),void 0!==s)if(this.canShowYAxisTypes()){const e=this.widget.getDic().primary_source.data_type_configuration_uuid,t=constants.widget.axis_options[e];void 0!==t&&t.length>0&&this.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisTypeMenu().getRootEntry().getChildren().forEach(e=>{t.includes(e.getMappedId())?e.setVisibility(n.topic_entry.visibility.visible):(e.setVisibility(n.topic_entry.visibility.not_visible),e.isSelected()&&this.selectNormalYAxisTypeOption())})}else this.selectNormalYAxisTypeOption();this.close()}async selectViewMode(e,t){await this.selectTopicEntry(e,this.widget.getMenu().getViewModeMenu()),this.widget.prepareReload(),await this.refreshWidgetData(),this.widget.onLayoutChange.fire(this.widget.getType(),this.widget.getType())}shouldRewrapWidget(e,t,i){return T.configurationService.getWidgetConfiguration(t).shouldRewrapWidgetOnLayoutChange(e,i)}selectNormalYAxisTypeOption(){const e=this.widget.getExtendedConfiguration().getYAxisConfiguration().getAxisTypeMenu();if(e.getFirstSelectedEntryRecursively().getMappedId()!==constants.axis_type.normal){const t=constants.axis_type.normal;this.widget.getExtendedConfiguration().getYAxisConfiguration().setAxisType(t),e.selectEntryByMappedId(t)}}actionForRuleTagging(e){e.mapped_id===constants.result_rule.add_rule&&v.modalService.display("ADD_RESULT_RULE",this.widget.getPageState())}async exportFunction(e){const t='<i class="fa fa-refresh fa-spin"></i> '+h.contextData.getMessage("_498245");this.close();const i=f.exportService.exportWidget(e.mapped_id,this.widget);m.notificationService.warning(t,{permanent:!0,singleInstance:!0,closeOnResolve:i});const n=await i;m.notificationService.success(n.message,{permanent:!0})}exportOrShareObject(e,t){"EXPORT_root"===e.getMappedId()?this.exportFunction(t.toProto()):"EXPORT_COMPLETE_root"===e.getMappedId()?this.exportStreamingFct(t.toProto()):"root_replay_export"===e.getMappedId()?this.exportFunction(t.toProto()):this.shareObject(t.toProto())}performShareObject(e,t,i,n){f.exportService.shareWidget(t.mapped_id,e).then(e=>{if(i){const t=this.$window.open(e.url,"mywin","width=500,height=360,toolbar=1,resizable=0");S.commons.checkPopupBlocked(t)&&m.notificationService.success(e.message,{permanent:!0})}else m.notificationService.success(e.message,{permanent:!0});if(n){const t=a.tw.project_id;n.shared_object_id=e.key;const i=routes.controllers.tw.TWRestForm.post("project",t,"image_sharing_options","update","","rform").url;b.restFormService.post(i,n)}}),e.dispose(),this.close()}isTwitter(e){return e.mapped_id===constants.output_type.twitter}isFacebook(e){return e.mapped_id===constants.output_type.facebook}isHootsuite(e){return e.mapped_id===constants.output_type.hootsuite_stream}isPNG(e){return e.mapped_id===constants.output_type.png}shareObject(e){const t=this.widget.clone();this.isPNG(e)?(t.setTitle(this.widget.getPageState().getProject().getName()+" - "+t.getTitle()),v.modalService.display("IMAGE_SHARING_OPTIONS",t).then(i=>{this.performShareObject(t,e,this.isTwitter(e)||this.isFacebook(e),i.form_entry)})):this.isHootsuite(e)?v.modalService.display("HOOTSUITE_SHARING_OPTIONS",t).then(t=>{this.performShareObject(t,e,!1)}):t.isArticles()?v.modalService.display("SHARING_OPTIONS",t).then(t=>{this.performShareObject(t,e,this.isTwitter(e)||this.isFacebook(e))}):this.performShareObject(t,e,this.isTwitter(e)||this.isFacebook(e))}async exportStreamingFct(e){if(this.widget.isArticles())v.modalService.display("EXPORT_ALL",{widget:this.widget,outputType:e.mapped_id});else{const t=await f.exportService.exportStreamingFct([this.widget.clone().clearPayloadValue().getDic()],e.mapped_id);m.notificationService.success(t.message,{permanent:!0})}this.close()}updateAndReload(e=!1){this.refreshWidget(this.widget),this.reload(e)}selectNestedLayout(e,t){this.widget.setVisualizationInitialized(!1),e.hasChildren()&&(e=_.first(e.getChildren())),t.selectEntry(e);const i=this.widget.getMenu();if(this.widget.hasNestedDics()&&this.widget.getMenu().hasNestedGraphTypeMenu()&&this.topicService.validateLinkedMenuSelection(this.widget.getMenu().getCompatibleDataTypes(),this.widget.getMenu().getNestedGraphTypeMenu(),[constants.data_type_categories.line_chart_group]),i.hasNestedGraphTypeMenu()&&dataTypeConf[e.getMappedId()].configuration.bar_chart){const t=this.widget.getDic().configuration_rendering.bar_chart,i=this.widget.getNestedDics()&&this.widget.getNestedDics()[0].getDic().configuration_rendering&&this.widget.getNestedDics()[0].getDic().configuration_rendering.bar_chart,n=this.widget.getDic().nested_data_input_configurations&&this.widget.getDic().nested_data_input_configurations[0].configuration_rendering&&this.widget.getDic().nested_data_input_configurations[0].configuration_rendering.bar_chart,s=t||i||n||{};s.orientation_mode=dataTypeConf[e.getMappedId()].configuration.bar_chart.orientation_mode,s.stacking_mode=dataTypeConf[e.getMappedId()].configuration.bar_chart.stacking_mode}e.toProto().select_action===constants.widget.refresh_widget?(this.widget.prepareReload(),this.refreshWidgetData()):(this.refreshWidget(this.widget),this.widget.redraw(!0)),this.close()}selectExternalDataset(e,t=!1){t?e.isSelected()?e.setSelectionRecursively(!1):e.setChildrenSelectionRecursively(!e.allChildrenSelected()):(e.getParent().isSelected()&&(e.getParent().setSelected(!1),e.getParent().setChildrenSelectionRecursively(!0)),e.toggleSelection()),this.widget.scheduleCallOnMenuClose(()=>{this.widget.setConfigurationChanged(!0),this.updateAndReload()},[!0])}toggleExternalDatasets(e){const t=this.widget.getMenu().getExternalDataMenu();if(t.getSelectionCount()>0)t.unselectAll();else{_(e.getChildren()).first().setSelected(!0)}this.widget.scheduleCallOnMenuClose(()=>{this.widget.setConfigurationChanged(!0),this.updateAndReload()},[!0])}close(){d.bubbleDialogService.destroyById("widget_menu")}async reload(e=!1){this.widget.prepareReload(),await this.refreshWidgetData().then(()=>{const t=this.getExtendedConfiguration();t&&(t.offset=0,t.loaded_urls=[]),e||this.close()},()=>void 0)}getExtendedConfiguration(){return this.widget.hasExtendedConfiguration()?this.widget.getExtendedConfiguration().toProto():void 0}getCustomPageContainer(){return{mapped_id:this.widget.getPageState().getAllowedPages().getCustomPageId()}}refreshWidget(e){if(e.canBeSaved()){const t=this.widget.getPageState().getAllowedPages();if(t.isEmbeddedWidget())c.embeddedWidgetService.update(this.widget.getPageState()).then(()=>{this.reload()});else{let i;if(t.isReport())i=constants.custom_page.type.report;else if(t.isDashboard())i=constants.custom_page.type.dashboard;else{if(!t.isCommandCenterScreenEditMode()&&!t.isCommandCenterWidgetPreview())throw new Error("No custom page type defined");i=constants.custom_page.type.command_center_screen}const n=e.clone();n.getPayload().keep_payload||n.clearPayloadValue(),l.customPagesService.saveWidget(i,this.getCustomPageContainer(),n),this.reload()}}}async refreshPageData(){const e={strategy:A.ModelRefreshStrategy.REFRESH},t=I.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),x.ModelType.PAGE_STATE,e);try{await D.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&w.logService.error("Error when refreshing page state after adding page to monitor !",void 0,e)}}editWidgetBackgroundColorAction(e,t){const i=this.createWidgetBackgroundColorEditionBubble(),n=i.getPayload();i.onMessage.subscribe(e=>{i.destroy(),e&&(this.widget.getExtendedConfiguration().setBackgroundColor(O.Color.fromHex(n.color)),this.updateAndReload())})}createWidgetBackgroundColorEditionBubble(){const e=constants.bubble_dialog.id.color_edition,t={title:h.contextData.getMessage("_1658462"),color:this.widget.getExtendedConfiguration().getBackgroundColor().toHex8()||"#FFFFFF"};return d.bubbleDialogService.createByType(e,F("body"),"color-edition",t,T.configurationService.getBubbleDialogConfiguration().getStyle(e),{fadeBackground:!0})}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:A.ModelRefreshStrategy.REFRESH},t=I.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),x.ModelType.WIDGET,e);try{return await D.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&w.logService.error("Error when refreshing widget!",void 0,e)}}else w.logService.error("reload attempted on widget without page state, this could be due to a memory leak",y.twCommon.logFeatures.WidgetWrapper)}};B=__decorate([i.ngInject(["$scope","$element","$window","topicService","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object,Object,Object])],B)}),define("components/widget/menus/bottom/directive",["require","exports","other/tw","services/tw_common","classes/custom_pages/custom_page_factory","classes/refresh/model_type","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{},controllerAs:"vm",bindToController:{widget:"="},controller:d}};class d{constructor(){this.refresh=this.saveAndReload.bind(this)}saveAndReload(){this.save(),this.reload()}save(){if(this.widget.canBeSaved()){s.CustomPageFactory.getPageFromPageState(i.tw.pageState).saveWidget(this.widget)}}reload(){this.widget.setConfigurationChanged(!0),this.widget.getExtendedConfiguration().setOffset(0),this.widget.getExtendedConfiguration().clearLoadedUrls(),this.widget.prepareReload(n.twCommon.reloadingStrategy.WIDGET),this.refreshWidgetData()}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:r.ModelRefreshStrategy.REFRESH},t=c.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),o.ModelType.WIDGET,e);try{return await a.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&l.logService.error("Error when refreshing widget!",void 0,e)}}else l.logService.error("reload attempted on widget without page state, this could be due to a memory leak",n.twCommon.logFeatures.WidgetWrapper)}}}),define("components/widget/menus/top/directive",["require","exports","services/tw_common","other/tw","classes/custom_pages/custom_page_factory","classes/refresh/model_type","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{},controllerAs:"vm",bindToController:{widget:"="},controller:g,templateUrl:d.templateSourceFactory("components/widget/menus/top")}};class g{constructor(){this.refresh=this.saveAndReload.bind(this)}saveAndReload(){this.save(),this.reload()}save(){if(this.widget.canBeSaved()){s.CustomPageFactory.getPageFromPageState(n.tw.pageState).saveWidget(this.widget)}}reload(){this.widget.setConfigurationChanged(!0),this.widget.getExtendedConfiguration().setOffset(0),this.widget.getExtendedConfiguration().clearLoadedUrls(),this.widget.prepareReload(i.twCommon.reloadingStrategy.WIDGET),this.refreshWidgetData()}async refreshWidgetData(){if(this.widget.hasPageState()&&this.widget.getPageState().getApplication()){const e={strategy:r.ModelRefreshStrategy.REFRESH},t=c.modelRefreshDecoratorFactory.getDecorator(this.widget.getPageState(),this.widget.getApplication(),o.ModelType.WIDGET,e);try{return await a.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&l.logService.error("Error when refreshing widget!",void 0,e)}}else l.logService.error("reload attempted on widget without page state, this could be due to a memory leak",i.twCommon.logFeatures.WidgetWrapper)}}}),define("components/widget/no_data/directive",["require","exports","services/template_source","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{},bindToController:{widget:"="},controllerAs:"vm",controller:s,templateUrl:i.templateSourceFactory("components/widget/no_data")}};class s{getEmptyWidgetMessage(e){switch(e){case constants.payload.missing_data_reason.page_state_not_correct:return n.contextData.getMessage("_743910");case constants.payload.missing_data_reason.cutoff_too_many_results_per_month:return n.contextData.getMessage("_191934");case constants.payload.missing_data_reason.cutoff_project_history_limitations:return n.contextData.getMessage("_484597");case constants.payload.missing_data_reason.cutoff_no_rebuild:return n.contextData.getMessage("_852237");case constants.payload.missing_data_reason.not_available:return n.contextData.getMessage("_981947");case constants.payload.missing_data_reason.search_not_available:return n.contextData.getMessage("_125649");case constants.payload.missing_data_reason.no_topics_or_sites_selected:return n.contextData.getMessage("_989142");case constants.payload.missing_data_reason.feature_disabled:return n.contextData.getMessage("_1698610");case constants.payload.missing_data_reason.data_retention_limit:return n.contextData.getMessage("_1073525");case constants.payload.missing_data_reason.results_deleted:return n.contextData.getMessage("_1357481");case constants.payload.missing_data_reason.token_expired:return n.contextData.getMessage("_1357482");case constants.payload.missing_data_reason.values_only_zero:return n.contextData.getMessage("_2258985");case constants.payload.missing_data_reason.full_content_missing:return n.contextData.getMessage("_2234551");default:return n.contextData.getMessage("_981947")}}}}),define("components/widget/placeholder/directive",["require","exports","angular_utilities","drag_and_drop","event_bus","jquery","log","reusable_services","reusable_utilities","classes/application/application","classes/bubble_dialog/widget_dialog_config","classes/context_data/context_data","classes/custom_pages/custom_page_factory","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","services/bubble_dialog","services/configuration","services/confirmation_service","services/grid_spacial","services/icons","services/pages/page_size_calculator","services/presentation_service","services/refresh/model_refresh_service","services/template_source","services/tw_common","services/widgets/widget_size_calculator","wrappers/user_filter_settings/user_filter_settings_wrapper","services/articles"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D){Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_FONT_SIZE=16,t.MAX_FONT_SIZE=300,t.default=function(){return{replace:!1,bindToController:{item:"=",grid:"=",pageState:"=?",showPlaceholder:"=",strategy:"=?"},controllerAs:"vm",controller:A,templateUrl:E.templateSourceFactory("components/widget/placeholder"),scope:{}}};let A=class{constructor(e,t,i){this.$element=e,this.$timeout=t,this.$scope=i,this.style={},this.bubbleDialogs=[]}$onInit(){this.cancellationToken=new c.CancellationToken,this.grid.getConfiguration().gridItemOptions.selectable&&(this.cancellationToken.addDomEvent(o(document),"click",e=>this.handleDocumentClick(e)),this.cancellationToken.addDomEvent(o(document),"mousedown",e=>this.handleMouseDown()),this.showPlaceholder&&this.cancellationToken.subscribe(this.grid.onDeletePressed,e=>{this.item===e&&this.removeWithConfirmation()})),this.buttonHash=this.getCurrentWidget().getId(),this.widgetActions=this.generateWidgetActions(),this.onClickOutsideMenu=this.clickOutsideMenu.bind(this),w.presentationService.isPresentationEnabled||this.$timeout(()=>{this.$scope.$$destroyed||(this.item.attachTemplate(this.$element.find(".widget-slot")),this.configureDragAndDrop(),this.configureCopyPaste(),this.cancellationToken.addDomEvent(this.$element,"mousewheel",e=>{this.isItemScrollable()&&e.stopPropagation()}),this.strategy&&this.cancellationToken.addDomEvent(this.$element[0],"mousedown",e=>{this.strategy.onMouseDown(e,this.item)}),this.item.getCurrentItem().setFullyLoaded(!0),s.eventBus.dispatch({type:s.EVENT_TYPES.WIDGET_DONE_DRAWING,value:{widget:this.item.getCurrentItem()}}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.GRID_WIDGET_OVERFLOW,e=>{this.item.hasItemId(e.value.id)&&void 0!==this.getCurrentPageState()&&this.getCurrentPageState().isGridPage()&&!this.getCurrentPageState().getAllowedPages().isCustomPage()&&this.item.getTemplate().css({overflow:"visible"})}))}),this.cancellationToken.addCleanupFunction(()=>this.$scope.$watch(()=>this.showPlaceholder,(e,t)=>{e!==t&&this.$timeout(()=>{this.item.attachTemplate(this.$element.find(".widget-slot"))})})),this.$scope.$on("$destroy",()=>{this.cancellationToken.cancel(),this.widgetActions=[],this.onClickOutsideMenu=void 0})}configureCopyPaste(){this.grid.getConfiguration().gridActions&&this.grid.getConfiguration().gridActions.copyPaste&&a.clipboardService.addCutCopy(document.body,this.grid.getConfiguration().gridActions.copyPaste.channel,()=>this.item.getCurrentItem().isSelected()?this.item:void 0,this.cancellationToken)}configureDragAndDrop(){this.grid.getConfiguration().dragAndDrop&&n.dragAndDropService.registerDragSources([this.$element[0]],{onDragStart:async e=>(this.strategy.startDragging(e,this.item),{dragHandle:document.createElement("div"),model:this.item}),onDragMove:(e,t)=>this.strategy.move(e,t),onDragStop:async(e,t)=>{this.strategy.stopDragging(e),this.strategy.postDrag()},channels:this.grid.getConfiguration().dragAndDrop.gridItemsDragAndDropChannels,minimumDragDistance:15,cancellationToken:this.cancellationToken})}isItemScrollable(){const e=this.getCurrentPageState().getAllowedPages();return!this.getCurrentPageState().isEditMode()&&v.gridSpacialService.isAtTheBottomEdge(this.grid.getHeight(),this.item.getCurrentItem())&&(e.isSearchAdvanced()||e.isSearch()||D.articlesService.isLoadMoreInGridAllowed(this.item.getCurrentItem()))}getCurrentWidget(){return this.item.getCurrentItem()}disableWidgetInteraction(){return!this.grid.getConfiguration().gridItemOptions.interactive&&!this.getCurrentWidget().isEditMode()}getPlaceholderStyle(e=!1,t=!1){return this.calculateStyle(e,t)}calculateStyle(e=!1,t=!1){const i=this.item.getSlotConfiguration();if(i){const n=this.isEditMode()?1:0;this.style.zIndex=this.item.selected?1:0,this.setOffset(i),this.pageState?(this.style.width=i.width*b.pageSizeCalculatorService.getGridCellSize(this.pageState,b.pageSizeCalculatorService.getCurrentGrid(this.pageState.getPageConfiguration())).width+"px",this.style.height=i.height*b.pageSizeCalculatorService.getGridCellSize(this.pageState,b.pageSizeCalculatorService.getCurrentGrid(this.pageState.getPageConfiguration())).height+"px"):this.setSize(i,n),this.style.fontSize=!0===e?this.calculateIconFontSize(i,this.grid.getConfiguration(),t):void 0,this.item.hasMultipleItems()?(this.style.outlineStyle="double",this.style.outlineWidth="3px",this.style.outlineOffset="-2px"):(this.style.outlineStyle=void 0,this.style.outlineWidth=void 0,this.style.outlineOffset=void 0)}else r.logService.error("No valid slot configuration found for widget!",void 0,{widget:this.getCurrentWidget()});return this.style}setOffset(e){const t=this.getCurrentWidget(),{width:i,height:n}=this.grid.getConfiguration();if(M.widgetSizeCalculatorService.canWidgetResizeToGrid(t)){const i=b.pageSizeCalculatorService.getGridCellSize(t.getPageState(),b.pageSizeCalculatorService.getCurrentGrid(t.getPageState().getPageConfiguration()));this.style.left=`${e.grid_x*i.width}px`,this.style.top=`${e.grid_y*i.height}px`}else this.style.left=c.StyleUtils.toPercentageString(e.grid_x,i),this.style.top=c.StyleUtils.toPercentageString(e.grid_y,n)}setSize(e,t){const{width:i,height:n}=this.grid.getConfiguration();this.style.width=c.StyleUtils.toPercentageString(e.width,i,t),this.style.height=c.StyleUtils.toPercentageString(e.height,n,t)}getIcon(){const e=this.getCurrentWidget();return S.iconService.getIconForWidget(e.getConfigurationRenderingUuid())}hasBackgroundImage(){const{backgroundImage:e}=this.grid.getConfiguration().style.background;return void 0!==e&&e.length>0}remove(e){e.preventDefault(),this.removeWithConfirmation()}removeWithConfirmation(){y.confirmationService.display({message:g.contextData.getMessage("_1444457")}).then(()=>{this.$timeout(()=>{this.item.removeItem(this.item.getCurrentItem())})},()=>void 0)}selectPreviousItem(e){e.stopPropagation(),this.item.previous()}selectNextItem(e){e.stopPropagation(),this.item.next()}unstackSelectedWidget(){this.grid.getConfiguration().gridActions.onUnstack(this.item)}cloneWidget(){this.grid.getConfiguration().gridActions.onClone(this.item)}isEditMode(){return void 0!==this.getCurrentPageState()&&this.getCurrentPageState().isEditMode()}openPreview(){const e=this.getCurrentWidget(),t=e.clone(),i=new d.WidgetDialogConfig(e.getPageState(),{widgetToSend:t,ufs:e.getUf(),groupPage:"CONTEXT_MENU",pageType:"CONTEXT_COMMAND_CENTER_PREVIEW",mode:T.twCommon.WidgetBubbleMode.SINGLE_PAGE,showCompareBar:!1,showDrilldown:!1,forbidExpand:!0,displayFullSizeWidget:!0,reloadWidget:!1,removeCustomPageId:!1});i.getStyle().setWidth("90%").setMaxWidth(0),_.bubbleDialogService.destroyAllNonPersistent(),_.bubbleDialogService.createWidgetDialogBubble(i).onDestroy.subscribeOnce(()=>{this.refreshPageData()})}scheduleShowInformationBubble(e){void 0!==this.bubbleCancellationToken&&this.bubbleCancellationToken.cancel(),this.bubbleCancellationToken=new c.CancellationToken,setTimeout(()=>{this.cancellationToken.isCanceled()||this.bubbleCancellationToken.isCanceled()||this.showInformationBubble(e)},500)}showInformationBubble(e){this.bubbleDialogs&&(this.bubbleDialogs.forEach(e=>e.destroy()),this.bubbleDialogs.length=0);const t=o(e.target),i=this.getCurrentWidget();(i.hasTitle()||i.hasDescription())&&this.bubbleDialogs.push(_.bubbleDialogService.createByType(constants.bubble_dialog.id.placeholder_information,t,constants.bubble_dialog.id.generic_message,{message:{__html:this.generateBubbleContent()},limited:!1,styleModel:{}},f.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.placeholder_information)))}scheduleBubbleDestruction(e){this.bubbleCancellationToken&&this.bubbleCancellationToken.cancel(),this.bubbleDialogs.forEach(e=>e.scheduleDestruction(250))}generateBubbleContent(){const e=this.getCurrentWidget();return`<div class="placeholder-information">\n                ${e.hasTitle()?`<h3>${e.getTitle()}</h3>`:""}\n                ${e.hasDescription()?`<p>${e.getDescription()}</p>`:""}\n                <div></div>\n            </div>`}calculateIconFontSize(e,i,n=!1){const{width:s,height:o}=i,r=Math.min(e.width/s,e.height/o)*(n?.3:1);return`${Math.max(Math.round(r*t.MAX_FONT_SIZE),t.MIN_FONT_SIZE)}px`}isMenuVisible(){return this.isEditMode()&&this.showContextMenu}getClickOutsideMenu(){return this.onClickOutsideMenu}clickOutsideMenu(e){(e.target?o(e.target).attr("id"):"")!==this.getButtonHash()&&this.$timeout(()=>{this.showContextMenu=!1},0)}getWidgetActions(){return this.widgetActions}toggleMenu(){this.showContextMenu=!this.showContextMenu}getButtonHash(){return this.buttonHash}canShowFilterSelection(){const e=this.getCurrentWidget();return this.isEditMode()&&e.hasUf()&&!e.isText()&&!e.isExternalTrends()}canShowUnlinkButton(){return this.isEditMode()&&this.item.hasMultipleItems()}toggleFilterSelection(e){const t=this.getCurrentWidget();if(this.filterSelectionActive=!this.filterSelectionActive,this.filterSelectionActive){const i=[t.getUf()];t.hasNestedDics()&&t.getNestedDics().forEach(e=>{e.hasDataSource()&&i.push(new P.UserFilterSettingsWrapper(e.getDataSource().uf,t.getPageState(),T.twCommon.holderTypes.WIDGET,!0))}),_.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection),_.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,o(e.target),i,f.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),t.canBeSaved(),t,void 0,!1).onDestroy.subscribeOnce(()=>{this.filterSelectionActive=!1})}else _.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection)}overrideWidget(){if(this.canOverride()){const e=this.getCurrentWidget();e.setFiltersChanged(!1),u.CustomPageFactory.getPageFromPageState(this.getCurrentPageState()).overrideWidget(e,this.getCurrentPageState(),e.getUf())}}canOverride(){const e=this.getCurrentWidget();return this.isEditMode()&&!e.isText()&&e.isContent()&&e.hasFiltersChanged()}generateWidgetActions(){return[{label:g.contextData.getMessage("_1444463"),icon:"fa fa-gear",clickAction:e=>{this.onClickOutsideMenu(e),this.openPreview()}},{label:g.contextData.getMessage("_1252063"),icon:"fa fa-clone",clickAction:e=>{this.onClickOutsideMenu(e),this.cloneWidget()}},{label:g.contextData.getMessage("_1444462"),icon:"fa fa-trash-o",clickAction:e=>{this.onClickOutsideMenu(e),this.remove(e)}}]}handleDocumentClick(e){this.item.selected&&!e.ctrlKey&&!e.shiftKey&&this.isEventOutsideElement(e,this.item.getTemplate())&&this.isEventOutsideElement(e,o(".toolbar"))&&this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&(this.grid.unselectItem(this.item),this.$scope.$$phase||this.$scope.$apply())}isEventOutsideElement(e,t){return t.length>0&&!t.is(e.target)&&0===t.has(e.target).length&&!c.DOMMath.isPointOnElement({x:e.clientX,y:e.clientY},this.item.getTemplate())}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}async refreshPageData(){const e={strategy:h.ModelRefreshStrategy.REFRESH},t=p.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,m.ModelType.PAGE_STATE,e);try{await C.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state after closing widget preview !",void 0,e)}}getCurrentPageState(){return void 0!==this.pageState?this.pageState:l.mainApplication.getPageState()}};A=__decorate([i.ngInject(["$element","$timeout","$scope"]),__metadata("design:paramtypes",[Object,Function,Object])],A),t.WidgetPlaceholderController=A}),define("components/widget/result_count/directive",["require","exports","classes/context_data/context_data","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"E",scope:{},bindToController:{widget:"="},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("components/widget/result_count")}};class s{getResultLabel(){return this.widget.getDataGraph().total_label}getResultNumber(){return this.widget.getDataGraph().total_results}getResultTooltip(){return this.shouldDisplayResultNumberTooltip()?i.contextData.getMessage("_1815648"):""}shouldDisplayResultNumberTooltip(){return this.widget.getPageState().getAllowedPages().isMonitor()}}}),define("components/widget_topic_menu_select/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){function s(e,t,n,s,o){function r(i){i.stopPropagation(),e.showMenu=!1,t.off("click",r),e.$apply()}o.assert(e.topicMenu instanceof n),e.showMenu=!1,e.isButtonMenu=function(){return e.topicMenu.isButtonMenu()},e.isLabelMenu=function(){return!e.isButtonMenu()&&!0!==e.boxed},e.isBoxedMenu=function(){return!e.isButtonMenu()&&!0===e.boxed},e.toggleMenu=function(i){e.showMenu=!e.showMenu,e.showMenu?s(function(){t.on("click",r)},0,!1):t.off("click",r)},e.hasSelectedIcon=function(){const t=e.topicMenu.getFirstSelectedEntryRecursively();return void 0!==t&&void 0!==e.iconMap&&void 0!==e.iconMap[t.getMappedId()]},e.getSelectedIcon=function(){const t=e.topicMenu.getFirstSelectedEntryRecursively();return e.iconMap[t.getMappedId()]},e.getIconState=function(){return e.iconState},e.getOptionName=function(){return e.title||e.topicMenu.getRootEntry().getName()},e.getSelectedName=function(){if(e.allowMultiSelection||e.showMoreSelections){const t=e.topicMenu.getSelectedEntriesRecursively();if(0===t.length)return i.isUndefined(e.placeholder)?"":e.placeholder;let n="";return i.each(t,function(e,t){n+=0===t?e.getName():" "+e.getName()}),n}{const t=e.topicMenu.getFirstSelectedEntryRecursively();if(i.isUndefined(t))return i.isUndefined(e.placeholder)?"":e.placeholder;if(e.concatSelectionBranchLabel){let e=t.getName(),i=t.getParent();for(;void 0!==i&&i.hasName();)e=`${i.getName()} (${e})`,i=i.getParent();return e}return t.getName()}},e.select=function(i){e.allowMultiSelection?e.topicMenu.selectEntry(i):(t.off("click",r),e.showMenu=!1,e.topicMenu.unselectAll(),i.setSelected(!0)),e.onSelectionChange(i,e.topicMenu)},e.getAllNode=function(){return e.topicMenu.hasAllNode()?e.topicMenu.getAllNode():void 0},e.getEntries=function(){return e.concatAllNode&&e.topicMenu.hasAllNode()?e.topicMenu.getAllNode().getChildren():e.topicMenu.hasAllNode()?e.topicMenu.getAllNode().getChildren():e.topicMenu.getRootEntry().getChildren()},e.$on("$destroy",function(){t.off("click",r)})}Object.defineProperty(t,"__esModule",{value:!0}),s.$inject=["$scope","$document","TopicMenuWrapper","$timeout","logService"],t.default=[function(){return{restrict:"E",scope:{topicMenu:"=",onSelectionChange:"=",placeholder:"=?",iconMap:"=?",iconState:"@?",title:"=?",concatSelectionBranchLabel:"=?",concatAllNode:"=?",allowMultiSelection:"=?",boxed:"=?",showMoreSelections:"=?"},controller:s,templateUrl:n.templateSourceFactory("components/widget_topic_menu_select")}}]}),define("configuration/directive_config/calendar",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return this.getDefaultTimeValuesFrom=function(){const e={hours:"00",minutes:"00",seconds:"00"};return e},this.getDefaultTimeValuesTo=function(){const e={hours:"24",minutes:"00",seconds:"00"};return e},this}]}),define("configuration/page/base",["require","exports","services/tw_common"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.disabledMenus=[]}canDrillDown(e){return!e.isEditMode()&&!e.getAllowedPages().isSearch()}canHideInfluencerColums(){return!1}canShowAllowedPages(){return!1}canExportWholePage(){return!1}canUserPinFilter(e,t){return e!==constants.topic_menu.TYPE.topic_pm_composed}isPinForced(e){return!1}canShowWidgetHeaderMenu(e,t=!1){return this.disabledMenus.indexOf(e)<0}canShowWidgetUI(e){return!0}canShowFilterHits(){return!1}isFilterOverrideMode(){return!1}getMinimumPages(e){return 1}isWidgetActionAllowed(e,t){return this.getAllowedWidgetActions().includes(e)}getAllowedWidgetActions(e){return[]}canResizeWidget(e){return this.getAllowedWidgetActions().includes(i.twCommon.widgetActionButtons.RESIZE)}hasSkeleton(){return!1}canSave(){return!1}getSectionWidth(){return 12}showFilters(){return!1}canShowPageOptions(){return!0}useRecentSearches(){return!1}canShowFiltersSearchbar(){return!0}getSectionsPerPage(e){return 1e4}isSidebarSortable(){return!1}shouldForceFilterOverride(){return!1}isPinningLimited(e){return!1}getPinLimit(e){}isPinLimitReached(e){return!1}}}),define("configuration/page/command_center",["require","exports","services/tw_common","configuration/page/base"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends n.default{getAllowedWidgetActions(){return[i.twCommon.widgetActionButtons.OVERRIDE]}canHideInfluencerColums(){return!0}isFilterOverrideMode(){return!0}canShowWidgetHeaderMenu(e,t){return t}canShowWidgetUI(e){return!1}isWidgetActionAllowed(e){return this.getAllowedWidgetActions().includes(e)}canSave(){return!0}shouldForceFilterOverride(){return!0}}}]}),define("configuration/page/dashboard",["require","exports","services/tw_common","configuration/page/base","services/pin"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends n.default{isFilterOverrideMode(){return!0}getAllowedWidgetActions(){return[i.twCommon.widgetActionButtons.RESIZE,i.twCommon.widgetActionButtons.OVERRIDE,i.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return this.getAllowedWidgetActions().includes(e)}canResizeWidget(e){return this.getAllowedWidgetActions().includes(i.twCommon.widgetActionButtons.RESIZE)}canSave(){return!0}hasSkeleton(){return!0}showFilters(){return!0}canUserPinFilter(e,t){return!this.isPinningLimited(t)||!this.isPinLimitReached(t)}isPinningLimited(e){return e.getAllowedPages().isDashboard()&&e.isGridPage()}getPinLimit(e){return this.isPinningLimited(e)?5:void 0}isPinLimitReached(e){return s.pinService.getNumPinnedMenus()===this.getPinLimit(e)}}}]}),define("configuration/page/edit",["require","exports","configuration/page/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends i.default{canDrillDown(e){return!1}canUserPinFilter(e){return!1}isFilterOverrideMode(){return!0}showFilters(){return!0}canShowPageOptions(){return!1}}}]}),define("configuration/page/embedded_widget",["require","exports","underscore","services/tw_common","classes/application/application","configuration/page/base"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends o.default{canShowAllowedPages(){return tw.pageState.getAllowedPages()&&tw.pageState.getAllowedPages().isMonitor()||tw.pageState.getAllowedPages().isSearch()}canShowFilterHits(){return!0}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return!s.mainApplication.getPageState().getAllowedPages().isSearch()||!i.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.topic_pm_composed],e)}isPinForced(e){return!!s.mainApplication.getPageState().getAllowedPages().isSearch()&&i.contains([constants.root_id.searchbar],e)}hasSkeleton(){return!1}showFilters(){return!0}canShowPageOptions(){return!1}}}]}),define("configuration/page/iq_app",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{isPinForced(e){return i.contains([constants.topic_menu.TYPE.topic_pm_composed],e)}canUserPinFilter(e){return!i.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.topic_pm_composed],e)}isFilterOverrideMode(){return!0}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.RESIZE,n.twCommon.widgetActionButtons.OVERRIDE,n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canSave(){return!0}hasSkeleton(){return!0}showFilters(){return!0}}}]}),define("configuration/page/monitor",["require","exports","configuration/page/base","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends i.default{canShowAllowedPages(){return!0}canShowFilterHits(){return!0}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return this.getAllowedWidgetActions().includes(e)}canResizeWidget(e){return this.getAllowedWidgetActions().includes(n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return e!==constants.topic_menu.TYPE.topic_pm_composed}isPinForced(e){return!1}hasSkeleton(){return!0}showFilters(){return!0}}}]}),define("configuration/page/quick_search",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{canHideInfluencerColums(){return!0}canShowWidgetHeaderMenu(){return!1}canShowAllowedPages(){return!1}canShowFilterHits(){return!0}canExportWholePage(){return!1}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return!i.contains(["TIME_FILTER","searchbarID"],e)}hasSkeleton(){return!0}showFilters(){return!1}canShowFiltersSearchbar(){return!1}useRecentSearches(){return!0}}}]}),define("configuration/page/report",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{canDrillDown(e){return!0}canUserPinFilter(e){return!1}getMinimumPages(e){return constants.report.minimum_pages[e]}isFilterOverrideMode(){return!0}canShowWidgetHeaderMenu(e){return!i.contains(["NUMBER_RESULTS"],e)}isWidgetActionAllowed(e,t){return i.contains(this.getAllowedWidgetActions(t),e)}getAllowedWidgetActions(e){return e.getPageState().isGridPage()?[n.twCommon.widgetActionButtons.OVERRIDE,n.twCommon.widgetActionButtons.RESIZE_CHART]:[n.twCommon.widgetActionButtons.RESIZE,n.twCommon.widgetActionButtons.OVERRIDE]}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(e),n.twCommon.widgetActionButtons.RESIZE)&&!e.isArticles()}hasSkeleton(){return!0}canSave(){return!0}showFilters(){return"REPORT_LAYOUT"===tw.pageState.getAllowedPages().getPageType()}getSectionsPerPage(e){return constants.report.sections_per_page[e]}isSidebarSortable(){return!0}}}]}),define("configuration/page/sandbox",["require","exports","configuration/page/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends i.default{hasSkeleton(){return!0}}}]}),define("configuration/page/search",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{canShowAllowedPages(){return!0}canShowWidgetHeaderMenu(){return!1}canShowFilterHits(){return!0}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return!i.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.topic_pm_composed],e)}isPinForced(e){return!1}hasSkeleton(){return!0}showFilters(){return!1}useRecentSearches(){return!0}}}]}),define("configuration/page/settings",["require","exports","configuration/page/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["basePageConfiguration",function(e){return new class extends i.default{}}]}),define("configuration/page/stateless_page",["require","exports","configuration/page/base"],function(e,t,i){function n(e,t){return new class extends i.default{}}Object.defineProperty(t,"__esModule",{value:!0}),n.$inject=["logService","basePageConfiguration"],t.default=n}),define("configuration/page/topic_setup",["require","exports","configuration/page/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends i.default{isSidebarSortable(){return!0}}}]}),define("configuration/page/trend_discovery",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{canShowAllowedPages(){return!1}canShowFilterHits(){return!0}canExportWholePage(){return!1}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return!i.contains(["TIME_FILTER","searchbarID"],e)}hasSkeleton(){return!0}showFilters(){return!0}useRecentSearches(){return!0}}}]}),define("configuration/page/trigger_condition",["require","exports","configuration/page/base"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends i.default{canDrillDown(e){return!1}canUserPinFilter(e){return!1}showFilters(){return!0}canShowPageOptions(){return!1}}}]}),define("configuration/page/user_workflow",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}hasSkeleton(){return!1}showFilters(){return!0}canUserPinFilter(e){return!1}}}]}),define("configuration/page/visual_search",["require","exports","underscore","services/tw_common","configuration/page/base"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","basePageConfiguration",function(e,t){return new class extends s.default{canShowAllowedPages(){return!1}canShowFilterHits(){return!0}canExportWholePage(){return!1}getAllowedWidgetActions(){return[n.twCommon.widgetActionButtons.FULL_SCREEN]}isWidgetActionAllowed(e){return i.contains(this.getAllowedWidgetActions(),e)}canResizeWidget(e){return i.contains(this.getAllowedWidgetActions(),n.twCommon.widgetActionButtons.RESIZE)}canUserPinFilter(e){return!i.contains(["TIME_FILTER","searchbarID"],e)}hasSkeleton(){return!0}showFilters(){return!0}useRecentSearches(){return!0}}}]}),define("configuration/topic_menu/base",["require","exports","underscore","services/tw_routing","services/tw_common","classes/application/application"],function(e,t,i,n,s,o){return[function(){return this.isFilter=e,this.isClearableFilter=function(e){const t=constants.topic_menu.TYPE;return-1!==[t.countries,t.media_type,t.languages,t.tags,t.workflow_tags,t.filter,t.source_panel,t.influenstar,t.sentiment,t.important,t.time_filter,t.named_entity_types,t.content_contains_type,t.generator_device,t.score_tags,t.mention_type,t.pmg_publication_issue,t.pmg_source_brandgroup,t.custom_entities,t.pmg_publication_unit,t.pmg_deduplication,"DEMOGRAPHICS_AND_GENDER","VISUAL_ENTITY_TYPE"].indexOf(e)},this.isAddButtonAllowed=function(e){return i.contains([constants.topic_menu.TYPE.topic,constants.topic_menu.TYPE.page_monitoring,constants.topic_menu.TYPE.filter,constants.topic_menu.TYPE.event],e)},this.getDefaultMappedIdsByType=function(e,t){if(!i.isUndefined(t)&&t.getHolderType()===s.twCommon.holderTypes.PAGE&&e.getType()!==constants.topic_menu.TYPE.time_filter&&o.mainApplication.hasPageState()&&o.mainApplication.getPageState().getAllowedPages().isCustomPage()&&e.getType()!==constants.topic_menu.TYPE.sentiment&&e.getType()!==constants.topic_menu.TYPE.important)return[];if(i.isUndefined(t)||e.getType()!==constants.topic_menu.TYPE.time_filter){if(o.mainApplication.hasPageState()&&o.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp()&&"LANGUAGES"===e.getType())return[];{const t=e.getDefaultMappedId();return i.isUndefined(t)?[]:[t]}}{const e=t.getTimeFilter().getDefaulTimeInterval();return e===constants.time_filter.TIME_INTERVAL.no_interval?[]:[e]}},this.getChildVisibilityStrategy=function(t){return e(t)&&t!==constants.topic_menu.TYPE.filter?s.twCommon.TopicEntryVisbilityStrategy.NO_DUPLICATES:s.twCommon.TopicEntryVisbilityStrategy.ALL},this.canTrimInvisible=function(e){return i.contains([constants.topic_menu.TYPE.content_contains_type,constants.topic_menu.TYPE.countries,constants.topic_menu.TYPE.generator_device,constants.topic_menu.TYPE.languages,constants.topic_menu.TYPE.media_type,constants.topic_menu.TYPE.mention_type,constants.topic_menu.TYPE.named_entity_types,constants.topic_menu.TYPE.custom_entities,constants.topic_menu.TYPE.pmg_publication_issue,constants.topic_menu.TYPE.pmg_publication_unit,constants.topic_menu.TYPE.pmg_source_brandgroup,constants.topic_menu.TYPE.pmg_source_distribution_type,constants.topic_menu.TYPE.pmg_deduplication,constants.topic_menu.TYPE.score_tags,constants.topic_menu.TYPE.source_panel,constants.topic_menu.TYPE.tags,constants.topic_menu.TYPE.topic_pm_composed,constants.topic_menu.TYPE.workflow_tags,constants.topic_menu.TYPE.sentiment],e)&&n.twRoutingService.getGroupPage()!==constants.group_page.settings},this;function e(e){const t=constants.topic_menu.TYPE;return-1!==[t.countries,t.media_type,t.languages,t.tags,t.workflow_tags,t.filter,t.source_panel,t.influenstar,t.sentiment,t.important,t.time_filter,t.named_entity_types,t.content_contains_type,t.generator_device,t.score_tags,t.mention_type,t.pmg_publication_issue,t.pmg_source_brandgroup,t.custom_entities,t.pmg_publication_unit,t.predefined_filters,t.pmg_source_distribution_type,t.pmg_deduplication,"DEMOGRAPHICS_AND_GENDER","VISUAL_ENTITY_TYPE"].indexOf(e)}}]}),define("controllers/navbar",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","NavBarOptionsWrapper","$window",function(e,t,i){return new function(){let n=t.NavBarContext.PROJECT,s=i.tw.project_id;void 0!==i.tw.project_id&&"0"!==i.tw.project_id||(void 0!==i.account_id&&"0"!==i.account_id?(n=t.NavBarContext.ACCOUNT,s=i.account_id):(n=t.NavBarContext.USER,s=i.user_id)),e.navBarOptions=new t(n,e.filterMenus,s)}}]}),define("controllers/settings",["require","exports","services/context"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$window","$rootScope","$compile","$timeout","bubbleDialogService","loadingBubbleService",function(e,t,n,s,o,r){function a(e){$.get(e).then(function(e){r.showSpinner(),angular.element("#wrapper").scope().$destroy(),function(){const e=$("body");e.find("#payload").remove(),e.find("#wrapper.page .page__content").empty().hide(),o.destroyAll()}(),function(e){const i=$("body"),o=$("<div></div>"),a=i.find("#wrapper.page");o.html(e),i.append(o.find("#payload")),a.find(".page__content").empty().hide(),a.find(".page__content").append(n(o.find("#wrapper.page .page__content"))(t).children()),s(function(){a.find(".page__content").show(),r.hideSpinner()})}(e)})}return e.addEventListener("hashchange",function(){a(e.location.hash.substring(1))}),t.redirect=function(t){!function(t){e.location.hash=t}(i.contextService.changeOldUrl(t))},new function(){s(function(){e.location.hash?a(e.location.hash.substring(1)):$(".page__content").fadeIn(400)},250)}}]}),define("controllers/rest_form/accounts/account_selection",["require","exports","underscore","services/confirmation_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$sce","restFormService","twRoutingService","modalService",function(e,t,s,o,r,a){e.inProgress=!1;const c=i.debounce(function(i){!0!==e.inProgress&&(e.inProgress=!0,o.post(i.add_project_link).then(function(i){i.redirect_url&&(t.location.href=i.redirect_url),e.inProgress=!1},function(t){e.form_entry.field_messages=t.field_messages,e.inProgress=!1}))},5e3,!0);e.getProjects=function(e){return e&&e.projects?l()?e.projects.filter(function(e){return!e.expired}):e.projects:[]},e.createProject=function(t,i){i.preventDefault(),e.inProgress||c(t)};function l(){return e.form_entry&&e.form_entry.filter_inactive_projects}e.removeProject=function(i,s){n.confirmationService.display({message:e.form_entry.confirm_remove_project}).then(function(){!function(e,i){o.deleter(i.root_link_delete).then(function(e){t.location.reload()},function(e){})}(0,s)},function(){})},e.quotaStyle=function(e){return e>=95?{color:"red","font-weight":"bold"}:e>=85?{color:"orange","font-weight":"bold"}:{}},e.showUpgradeForPerc=function(e){return e>=85},e.getContactSupport=function(){return s.trustAsHtml(e.form_entry.contact_support)},e.shouldShowUsersLimit=function(e){return e.admin_in_account},e.shouldShowFilteredProjectMessage=function(t){return l()&&0===e.getProjects(t).length&&t.projects.length>0},e.shouldShowNoAccessMessage=function(t){return 0===e.getProjects(t).length&&t.total_projects_in_account>0},e.canShowInactiveFilter=function(){return!i.isUndefined(window.form_entry.filter_inactive_projects)},e.loadProject=function(e,t){t.preventDefault(),t.stopPropagation(),r.changePageByUrl(e)},e.getMainProjectUrl=function(e){return!1===e.expired&&!i.isUndefined(e.root_link_home)&&e.root_link_home.length>0?e.root_link_home:!1===e.expired&&!i.isUndefined(e.root_link_search)&&e.root_link_search.length>0?e.root_link_search:""},e.handleUsersLimitClick=function(e,t){t.preventDefault(),function(e){o.get(e.link_enforced_users).then(function(t){!function(e,t){const i=constants.modal.mailing_lists.type.user_access_lists;a.display("MAILING_LISTS",{mailing_lists:t.enforced_users_menu,type:i}).then(function(){!function(e,t){t.project_form=e,o.post(routes.controllers.tw.TWRestForm.post("project",e.id,"enforced_users","update","","settings").url,t).then(function(t){e.enforced_users=t.project_form.enforced_users})}(e,t)})}(e,t)})}(e)},e.form_entry=t.form_entry}]}),define("controllers/rest_form/alerts/alert",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.cancel=function(){t.location.href=e.form_entry.root_link_back},e.alert=t.form_entry}]}),define("controllers/rest_form/alerts/alerts",["require","exports","underscore","services/confirmation_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService",function(e,t,s){e.form_entry=t.form_entry;e.editAlert=function(e){t.location.href=e.edit_link},e.remove=function(t){n.confirmationService.display({message:e.form_entry.confirm_question}).then(function(){!function(t){s.deleter(t.delete_link).then(function(n){e.form_entry.alerts=i.without(e.form_entry.alerts,i.findWhere(e.form_entry.alerts,{id:t.id}))},function(e){})}(t)},function(){})},e.sendAlert=function(e){s.get(e.one_off_link).then(function(e){},function(e){})}}]}),define("controllers/rest_form/alerts/confirm_alert_subscription",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService",function(e,t,i){e.form_entry=t.form_entry,e.form_entry.put_url&&i.put(e.form_entry.put_url,e.form_entry).then(function(i){e.form_entry=i,i.redirect_url&&(t.location.href=i.redirect_url)},function(t){e.form_entry.field_messages=t.field_messages})}]}),define("controllers/rest_form/audit_logs/audit_logs",["require","exports","services/rest_form_service","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s="YYYY-MM-DD";class o{constructor(e,t,i){this.$window=e,this.$rootScope=t,this.calendarConstructor=i,this.isUserSelectionActive=!0,this.isProjectSelectionActive=!0,this.formEntry=window.form_entry,this.buildDateCalendar(),this.logTypeMenu={root_entry:{selection_type:"SINGLE",children_unselect_available:!1,children:[{mapped_id:"account_actions",name:n.contextData.getMessage("_2451123"),selected:"NONE"},{mapped_id:"project_actions",name:n.contextData.getMessage("_2451523"),selected:"NODE"},{mapped_id:"project_activity",name:n.contextData.getMessage("_2451723"),selected:"NONE"}]}}}buildDateCalendar(){const e=$("body").find('div[id="date-calendar"]');this.fromDate=this.$window.moment().subtract(1,"months").add(1,"days"),this.toDate=this.$window.moment(),this.rangeCalendar=new this.calendarConstructor(e,{months:3,viewStartDate:this.$window.moment().subtract(2,"months"),mode:"range",selected:[this.fromDate.format(s),this.toDate.format(s)],direction:"today-past",blackout:e=>e.isBefore("2018-10-30"),useYearNav:!1,format:s}),this.rangeCalendar.subscribe("change",()=>this.changeDate())}changeDate(){const e=this.rangeCalendar.getSelectedAsText();this.fromDate=this.$window.moment(e[0]),this.toDate=this.$window.moment(e[1]?e[1]:e[0])}getAvailableUserLabel(){return n.contextData.getMessage("_1702125")}getSelectedUserLabel(){return n.contextData.getMessage("_1585106")}getAvailableGroupLabel(){return n.contextData.getMessage("_1811568")}getSelectedGroupLabel(){return n.contextData.getMessage("_1984453")}async changeUserConfiguration(){const e=await i.restFormService.postRForm("audit_logs","info",{configuration:this.formEntry.configuration,users:{}});this.formEntry.users=e.users,this.isUserSelectionActive="NODE"===e.configuration.root_entry.children[0].selected,this.$rootScope.$applyAsync()}isProjectSelected(){const e=this.formEntry.projects;return[e.root_entry.children[0],...e.root_entry.children[0].children].some(e=>e.selected&&"NONE"!==e.selected)}isUserSelected(){return this.formEntry.users.root_entry.children.some(e=>e.selected&&"NONE"!==e.selected)}isExportButtonDisabled(){return"project_actions"===this.getSelectedLogType()||"project_activity"===this.getSelectedLogType()?!(this.isProjectSelected()&&this.isUserSelected()):"account_actions"!==this.getSelectedLogType()||!this.isUserSelected()}getSelectedLogType(){return this.logTypeMenu.root_entry.children.find(e=>"NODE"===e.selected).mapped_id}async exportAuditLog(){await i.restFormService.postRForm("audit_logs","export",{from:this.fromDate.hour(0).minute(0).second(0).valueOf().toString(),to:this.toDate.hour(23).minute(59).second(59).valueOf().toString(),projects:this.formEntry.projects,users:this.formEntry.users,configuration:this.formEntry.configuration,audit_log_type:this.getSelectedLogType()})}onLogTypeSelected(e,t){this.isProjectSelectionActive=this.canShowProjects(),this.$rootScope.$applyAsync()}canShowProjects(){return"project_activity"===this.getSelectedLogType()||"project_actions"===this.getSelectedLogType()}}o.$inject=["$window","$rootScope","Calendar"],t.default=o}),define("controllers/rest_form/authentication/confirm_email",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","loadingBubbleService",function(e,t,i,n){e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},n.hideSpinner(),e.form_entry=t.form_entry,e.form_entry.put_url&&i.put(e.form_entry.put_url,e.form_entry).then(function(i){e.form_entry=i,i.redirect_url&&(t.location.href=i.redirect_url)},function(t){e.form_entry.field_messages=t.field_messages})}]}),define("controllers/rest_form/authentication/reset_password",["require","exports","services/loading_bubble","services/rest_form_service"],function(e,t,i,n){function s(e){i.loadingBubbleService.hideSpinner(),e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.resetPassword=function(){n.restFormService.post(e.form_entry.link_post,e.form_entry,e.send_action).then(function(t){e.form_entry=t,""!==(e.form_entry.redirect_url||"")&&setTimeout(()=>{window.location.href=t.redirect_url},5e3)},function(t){e.form_entry.field_messages=t.field_messages,e.form_entry.captcha=t.captcha})},e.goToLogin=function(){window.location.href=e.form_entry.link_login},e.isLoginButtonDisabled=function(){return void 0!==e.form_entry.captcha&&!e.form_entry.captcha.result},e.form_entry=window.form_entry,e.send_action=constants.events.form.action.send}Object.defineProperty(t,"__esModule",{value:!0}),s.$inject=["$scope"],t.default=s}),define("controllers/rest_form/authentication/popups/popup_allow_authorization",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","loadingBubbleService",function(e,t,i,n){n.hideSpinner()}]}),define("controllers/rest_form/basic_setup/basic_setup",["require","exports","underscore","services/commons","common_constants","services/tw_common","notifications","services/confirmation_service"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$q","restFormService",function(e,t,c,l){e.getSitePages=function(){let t;for(let n=0;n<e.form_entry.specific_search.length;n++){const s=e.form_entry.specific_search[n];let o=!1;for(const e in s.search_list)if(i.has(constants.social_media_accounts,e)&&(o=s.search_list[e])){t=s;break}if(o)break}return t},e.switchFilter=function(s){if(e.showSuggestions=!1,e.noSelection||s!==e.selectedKey){e.selectedKey=s;const i=constants.social_media_accounts[s].client_name,a=constants.social_media_accounts[s].oauth_enabled,c=e.form_entry.external_connection[s];!c&&a?function(i,s){const a={client_name:i,source:"project",source_id:e.form_entry.project_id,type:"SMA",protocol:o.twCommon.extractProtocol(t.location.protocol)};l.post(routes.controllers.tw.TWRestForm.post(a.source,a.source_id,"external_authentication","new","","settings").url,a).then(function(e){const i=t.open(e.url,e.client_name+"- connection","width=800,height=600");n.commons.checkPopupBlocked(i)&&r.notificationService.success(window.messages.get("_817156"),{permanent:!0})})}(i):e.showSuggestions=!0}!function(t){if(e.noSelection)for(let n=0;n<e.form_entry.specific_search.length;n++){const s=e.form_entry.specific_search[n];if(i.has(s.search_list,t)){s.input_object.url=i.isUndefined(e.currentFilterObject)?void 0:e.currentFilterObject.input_object.url,e.currentFilterObject=s,s.search_list[t]=!0,e.noSelection=!1;break}}else i.each(e.form_entry.specific_search,function(n){for(const s in n.search_list)i.has(constants.social_media_accounts,s)&&(s===t?(n.search_list[t]=!n.search_list[t],n.search_list[t]?(n.input_object.url=e.currentFilterObject.input_object.url,e.currentFilterObject=n):e.noSelection=!0):n.search_list[s]=!1)})}(s)},e.getSuggestions=function(t){return c(function(s,o){t.input_object&&t.input_object.url?l.post(e.form_entry.suggestion_page_url,t).then(i,n):o()});function i(e){t.children=e.children}function n(e){t.input_object.field_messages=e.field_messages}},e.setPageToMonitor=function(t){!function(t){l.get(routes.controllers.tw.TWRestForm.post("project",e.form_entry.project_id,"page_monitoring","validate","","rform").url).then(function(n){e.form_entry.external_connection={},i.each(i.keys(n.external_connection),function(t){e.form_entry.external_connection[t]=n.external_connection[t]}),t()})}(function(){e.form_entry.page_to_monitor.push(t),e.form_entry.specific_search[0].input_object.url=void 0})},e.hasPageToMonitor=function(){return e.form_entry.page_to_monitor.length>0},e.removePage=function(t){t.preventDefault(),a.confirmationService.display({message:e.form_entry.page_to_monitor[0].confirm_question}).then(function(){e.form_entry.page_to_monitor.pop()},function(){})},e.save=function(){l.post(e.form_entry.save_link,e.form_entry).then(function(){t.location.href=e.form_entry.redirect_url})},e.canShowSuggestions=function(){return!e.noSelection&&e.showSuggestions},e.form_entry=t.form_entry,e.toggles={showCompetitor:!0,showOtherTopicQuery:!1},e.socialMediaList=i.map(e.form_entry.specific_search,function(e){return e.search_list}),e.noSelection=!0,e.toggleType=s.toggle.yes_no.type,t.socialMediaAccountCallBack=function(t){e.$apply(function(){e.showSuggestions=!0})}}]}),define("controllers/rest_form/branding/branding_settings",["require","exports","reusable_utilities","classes/context_data/context_data","services/bubble_dialog","services/configuration","services/confirmation_service","services/form","services/rest_form_service","services/tw_routing"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.form_entry=window.form_entry,this.update_action=constants.events.form.action.update,this.dnsCorrect=!0,this.color=this.form_entry.color,void 0!==this.form_entry.logo_placeholder&&(this.placeholderLogo=this.form_entry.logo_placeholder),this.checkDNS(),this.reloadImages()}reloadImages(){for(let e=0;e<$("img").length;e++){const t=$("img").get(e);t.src=t.src.split("?")[0].concat(`?t=${Date.now()}`)}}domainFocus({target:e}){0===e.value.length&&(e.value="https://",e.focus())}checkDNS(){if(void 0!==this.form_entry.domain&&this.form_entry.domain.length>0){0!==this.form_entry.domain.indexOf("https://")&&(this.form_entry.domain="https://"+this.form_entry.domain);const e=this.buildCheckDnsUrl();c.restFormService.get(e).then(e=>{this.dnsCorrect=e.dns_status},()=>{this.dnsCorrect=!1})}this.dnsCorrect=!0}buildCheckDnsUrl(){let e=null!==this.form_entry.domain.match(/^https\:\/\//i)?this.form_entry.domain:"https://"+this.form_entry.domain;return e+="/app/dns_check"}isCustomUrl(){const e=i.TopicMenuUtils.getFirstSelectedEntry(this.form_entry.option_academy_link);return void 0!==e&&e.mapped_id===constants.academy_link.type.custom}openTestMailModal(){s.bubbleDialogService.destroyAllNonPersistent(),s.bubbleDialogService.createByType(constants.bubble_dialog.id.smtptest,$("#page_content"),constants.bubble_dialog.id.smtptest,void 0,o.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.smtptest),{fadeBackground:!0})}submit(){this.checkIfColorOrLogoChanged()?this.callDialogue():this.callEndpoint()}checkIfColorOrLogoChanged(){return this.form_entry.color!==this.color||this.form_entry.logo_placeholder!==this.placeholderLogo}callDialogue(){r.confirmationService.display({message:{message:this.form_entry.update_report_templates_question,ok:n.contextData.getMessage("_697024"),cancel:n.contextData.getMessage("_348105")}}).then(()=>{this.form_entry.update_report_templates=!0,this.callEndpoint()},()=>{this.form_entry.update_report_templates=!1,this.callEndpoint()})}callEndpoint(){const e=Object.assign({},this.form_entry);void 0!==e.domain&&e.domain.length>0&&0===e.domain.indexOf("https://")||(e.domain=""),c.restFormService.postMultipart(this.form_entry.save_link,e,void 0,this.update_action).then(e=>{this.form_entry=e,this.checkDNS(),l.twRoutingService.reloadPageAndContext()},e=>{this.form_entry.field_messages=e.field_messages,a.formService.showMessagesAsNotifications(e.field_messages)})}removeBranding(){r.confirmationService.display({message:this.form_entry.confirm_question}).then(()=>{c.restFormService.deleter(this.form_entry.remove_link).then(e=>window.location.reload(!0),e=>window.location.reload(!0))},()=>void 0)}canShowTestButton(){return void 0!==this.form_entry.send_test_email_links&&void 0!==this.form_entry.send_test_email_links.send_link}isImpersonate(){return n.contextData.rules.isImpersonate()}}}),define("controllers/rest_form/data_set/data_set",["require","exports","angular","lazy","underscore","services/confirmation_service","classes/context_data/context_data"],function(e,t,i,n,s,o,r){function a(e,t,a,c){return(()=>{t.form_entry=a.form_entry,t.getAccountSelectionLabel=v,t.getViewSelectionLabel=S,t.remove=l,t.progressOptions={action:constants.events.form.action.post,text:r.contextData.getMessage("_612374"),textCalling:r.contextData.getMessage("_911337"),keepProgress:!0};const e=[t.$on("dataset-cancel",p),t.$on("dataset-downloadExport",()=>u("export_link")),t.$on("dataset-downloadSampleCsv",()=>u("sample_link_csv")),t.$on("dataset-downloadSampleXls",()=>u("sample_link_xls")),t.$on("dataset-downloadSampleXlsx",()=>u("sample_link_xlsx")),t.$on("dataset-save",h),t.$on("dataset-selectAccount",f),t.$on("dataset-socialMediaAccountSelected",y),t.$on("dataset-updateTitleLink",()=>(function(){void 0!==t.form_entry.google_sheets.data_url&&s(()=>c.post(t.form_entry.fetch_sheet_title_link,t.form_entry).then(e=>{t.form_entry.title=e.title.substring(0,32)},g)).debounce(700)()})),t.$on("destroy",()=>e.forEach(e=>e()))]})();function l(e,i){i.preventDefault(),o.confirmationService.display({message:t.form_entry.confirm_question}).then(()=>(function(e){c.deleter(e.remove_link).then(e=>m(window.form_entry.root_link),e=>t.form_entry.form_fields=e.form_fields)})(e),()=>void 0)}function d(e){a.location.href=e.exported_file_link}function g(e){t.form_entry.field_messages=e.field_messages}function u(e){c.get(t.form_entry[e],"info").then(d,g)}function p(){m(window.form_entry.root_link)}function h(){c.postMultipart(t.form_entry.save_link,t.form_entry).then(e=>{_(e),m(e.root_link)}).catch(g)}function m(t){e.redirect(t)}function _(e){i.copy(e,t.form_entry),t.$broadcast("dataset-refreshedDataset")}function f(){void 0!==t.form_entry.init_external_data_link&&c.post(t.form_entry.init_external_data_link,t.form_entry).then(_)}function y(){void 0!==t.form_entry.init_external_data_link&&c.post(t.form_entry.init_external_data_link,n(t.form_entry).omit(["accounts"]).toObject()).then(_)}function v(){return r.contextData.getMessage("_1049325")}function S(){return r.contextData.getMessage("_1901238")}}Object.defineProperty(t,"__esModule",{value:!0}),a.$inject=["$rootScope","$scope","$window","restFormService"],t.default=a,t.DataSetController=a}),define("controllers/rest_form/data_set/data_sets",["require","exports","underscore","classes/context_data/context_data","services/confirmation_service","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o){function r(e,t,r,a,c,l){return t.form_entry=r.form_entry,t.project_id=t.form_entry.providers.projects_social_media_account&&1===t.form_entry.providers.projects_social_media_account.length?t.form_entry.providers.projects_social_media_account[0].id:"0",t.tempData={},t.smaTitle=n.contextData.getMessage("_1422757"),t.connectedSmaTitle=n.contextData.getMessage("_1452322"),t.businessIndicatorCreationMenu=new o.TopicMenuWrapper({root_entry:{mapped_id:"root",children:[{mapped_id:"google_analytics",name:n.contextData.getMessage("_718534")},{mapped_id:"google_sheets",name:n.contextData.getMessage("_633702")},{mapped_id:"custom_indicators",name:n.contextData.getMessage("_871235")}]}}),t.sharePageCallBack=u,t.getJobStateIcon=p,t.hasDatasets=(()=>(t.form_entry.data_sets||[]).length>0),t.getRelevantFormEntry=h,t.canShowJobState=m,t.filter={items:"tr:not(.headers)"},t.sort={stop:(e,t)=>{const i=window.form_entry.data_sets,n=t.item.index(),s=t.item.sortable.index,o=i.splice(s,1)[0];i.splice(n,0,o),c.post(window.form_entry.update_order_link,window.form_entry)}},t.redirect=e.redirect,t.remove=d,void(t.newDataset=g);function d(e,n){n.preventDefault(),s.confirmationService.display({message:t.form_entry.confirm_question}).then(()=>(function(e){c.deleter(e.remove_link).then(n=>{t.form_entry.data_sets=i(t.form_entry.data_sets).without(i(t.form_entry.data_sets).findWhere({dataset_id:e.dataset_id}))},e=>{t.form_entry.form_fields=e.form_fields})})(e),()=>void 0)}function g(e,i){e.preventDefault(),"root"!==i.mapped_id&&c.post(function(e){switch(e){case"custom_indicators":return t.form_entry.new_dataset_custom_indicators_link;case"google_analytics":return t.form_entry.new_dataset_google_analytics_link;case"google_sheets":return t.form_entry.new_dataset_google_sheets_link}}(i.mapped_id)).then(e=>t.redirect(e.edit_link))}function u(e,i,n){l.sharePageCallBack(e,i,n,t.form_entry.providers.projects_social_media_account)}function p(e){return a.getIconForJobState(e)}function h(e){switch(e.data_source){case constants.data_source_type.google_analytics:return e.google_analytics;case constants.data_source_type.google_sheets:return e.google_sheets;case constants.data_source_type.uploaded_file:default:return e.custom_indicator_form}}function m(){return!n.contextData.rules.isOriginalUserEnabled()}}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$rootScope","$scope","$window","iconsService","restFormService","smaService"],t.default=r}),define("controllers/rest_form/data_set/common_form_controller/directive",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.$log=e,this.$scope=t,this.save=this.saveForm.bind(this),this.cancel=this.cancelForm.bind(this)}dispatch(e){this.$log.debug(`dispatching: '${e}' event`),this.$scope.$emit(e,this.context)}getJobStateText(){return` - ${this.formData.last_error_message}`+(void 0!==this.formData.last_error_date)?` (${window.form_entry.last_error_date})`:""}saveForm(){this.dispatch("dataset-save")}cancelForm(){this.dispatch("dataset-cancel")}updateTitleLink(){this.dispatch("dataset-updateTitleLink")}handleItemSelection(){this.dispatch("dataset-selectItem")}handleDownloadClick(e,t){e.preventDefault(),this.dispatch(t)}isUserMetricsJobStateOK(){return this.formData.job_state===constants.user_metrics.state.ok}}i.$inject=["$log","$scope"],t.CommonDatasetFormController=i}),define("controllers/rest_form/data_set/custom_indicators_form/directive",["require","exports","controllers/rest_form/data_set/common_form_controller/directive","services/template_source"],function(e,t,i,n){function s(){return{templateUrl:n.templateSourceFactory("controllers/rest_form/data_set/custom_indicators_form"),restrict:"E",replace:!0,scope:!0,controller:o,controllerAs:"vm",bindToController:{formData:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.DatasetCustomIndicatorFormDirective=s;class o extends i.CommonDatasetFormController{constructor(e,t){super(e,t)}$onInit(){this.context={location:"custom-indicators"}}}o.$inject=["$log","$scope"]}),define("controllers/rest_form/data_set/google_analytics_form/directive",["require","exports","angular","lazy","components/form/common/topic_menu","wrappers/topic_menu/topic_menu_wrapper","controllers/rest_form/data_set/common_form_controller/directive","classes/context_data/context_data","classes/application/application","services/template_source"],function(e,t,i,n,s,o,r,a,c,l){function d(){return{templateUrl:l.templateSourceFactory("controllers/rest_form/data_set/google_analytics_form"),restrict:"E",replace:!0,scope:!0,controller:g,controllerAs:"vm",bindToController:{formData:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=d,t.GoogleAnalyticsFormDirective=d;class g extends r.CommonDatasetFormController{constructor(e,t,i,n){super(e,t),this.modalService=i,this.smaService=n,this.selectAccount=this.selectAccountDispatch.bind(this)}$onInit(){this.context={location:"google-analytics"},this.connectNewSocialMediaAccountEntry={name:a.contextData.getMessage("_001138")},this.initializeGoogleAnalytics(),this.dispatch("dataset-socialMediaAccountSelected");const e=[this.$scope.$on("dataset-refreshedDataset",this.initializeGoogleAnalytics.bind(this)),this.$scope.$on("destroy",()=>e.forEach(e=>e()))]}get viewLabel(){return a.contextData.getMessage("_1654638")}get accountLabel(){return a.contextData.getMessage("_1849604")}handleAccountSelection(){this.dispatch("dataset-socialMediaAccountSelected")}selectAccountDispatch(e,t){this.dispatch("dataset-selectAccount")}getSocialMediaAccounts(){return this.formData.social_media_accounts.root_entry.children||[]}getAccountSelectionLabel(){return a.contextData.getMessage("_1049325")}initializeGoogleAnalytics(){void 0!==this.formData.social_media_accounts&&(this.smaAccounts=new o.TopicMenuWrapper(this.formData.social_media_accounts)),void 0!==this.formData.accounts&&(this.accounts=new o.TopicMenuWrapper(this.formData.accounts))}connectNewSMA(){const e=c.mainApplication.getPageState().getProject().getId();this.smaService.connectExternalAccount(constants.social_media_accounts.google_analytics.code,"SMA",e).then(this.initializeGoogleAnalytics)}hasGAIndicators(){return(this.formData.indicators||[]).length>0}isViewSelected(){return function e(t){return!!t.isSelected()||n(t.getChildren()).some(e)}(this.accounts.getRootEntry())}addGAIndicator(){const e=i.copy(this.formData.indicator_template),t={action:constants.events.form.action.post,text:a.contextData.getMessage("_868669"),textCalling:a.contextData.getMessage("_868670"),keepProgress:!0};this.modalService.display("GA_INDICATOR",{indicator:e,title:a.contextData.getMessage("_1680285"),progressOptions:t}).then(()=>this.formData.indicators=[...this.formData.indicators,e])}getSelectedEntryName(e){return s.getFirstSelectedEntry(e.root_entry).name}editIndicator(e,t){t.preventDefault();const i=JSON.parse(JSON.stringify(e)),n={action:constants.events.form.action.post,text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),keepProgress:!0};this.modalService.display("GA_INDICATOR",{indicator:i,title:a.contextData.getMessage("_1520894"),progressOptions:n}).then(()=>{const t=_(this.formData.indicators).indexOf(e);this.formData.indicators.splice(t,1,i)})}removeIndicator(e,t){t.preventDefault();const i=_(this.formData.indicators).indexOf(e);this.formData.indicators.splice(i,1)}}g.$inject=["$log","$scope","modalService","smaService"]}),define("controllers/rest_form/data_set/google_sheets_form/directive",["require","exports","controllers/rest_form/data_set/common_form_controller/directive","services/template_source"],function(e,t,i,n){function s(){return{templateUrl:n.templateSourceFactory("controllers/rest_form/data_set/google_sheets_form"),restrict:"E",replace:!0,scope:!0,controller:o,controllerAs:"vm",bindToController:{formData:"="}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.GoogleSheetsFormDirective=s;class o extends i.CommonDatasetFormController{constructor(e,t){super(e,t)}$onInit(){this.context={location:"google-sheets"}}}o.$inject=["$log","$scope"]}),define("controllers/rest_form/dev/all_users_application",["require","exports","lazy","underscore","notifications","services/confirmation_service"],function(e,t,i,n,s,o){function r(e,t,r,a){t.showNumber=20,t.filter={value:""},t.returnLastPathSegment=function(e){return e.replace(/\/[^\/]+$/,"")},t.applicationFilter=function(e){const n=[e.user_credentials.email,e.first_name,e.last_name];return i(n).invoke("toLowerCase").some(function(e){return-1!==e.indexOf(t.filter.value.toLocaleLowerCase())})};const c=e(window.form_entry.base_url+"/:action",{responseType:"json",transformResponse:h},{addCutoff:{method:"POST",params:{action:window.form_entry.actions_by_name.addCutoff}},removeCutoffs:{method:"POST",params:{action:window.form_entry.actions_by_name.removeCutoffs}},fetchProject:{method:"GET",params:{action:window.form_entry.actions_by_name.fetchProject}}}),l=e(window.form_entry.base_url+"/:action",{responseType:"json",transformResponse:h},{process:{method:"POST",params:{action:"merge"}}}),d=e(window.form_entry.base_url.replace(/all_users_application/,"dev_project_restrictions/:action"),{responseType:"json",transformResponse:h},{imageSearch:{method:"POST",params:{action:"update"}},discovery:{method:"POST",params:{action:"update"}}}),g=e(window.form_entry.base_url.replace(/all_users_application/,"dev_project_topics/:action"),{responseType:"json",transformResponse:h},{updateTopics:{method:"POST",params:{action:"update"}}}),u=e(window.form_entry.base_url.replace(/rform\/all_users_application/,"project/:project_id/rform/dev_results_rules/:action"),{project_id:"@project_id",responseType:"json",transformResponse:h},{createResultsRules:{method:"POST",params:{action:"add"}}}),p=e(window.form_entry.base_url.replace(/all_users_application/,"dev_hootsuite/:action"),{responseType:"json",transformResponse:h},{setup:{method:"POST",params:{action:"enable"}}});function h(e,i,n){500===n&&(t.otherMessage="something went wrong")}function m(e){return function(){alert(e)}}function _(e){return 0!==e.projects.length}function f(e){return i(e.projects).map(function(t){return{accountTitle:e.decorator.title,accountId:e.decorator.id,projectTitle:t.decorator.title,projectId:t.decorator.id}}).value()}function y(e){s.notificationService.display(e.notification)}function v(e){t.form_entry.field_messages=e.field_messages}function S(){r.location.reload()}t.clearOtherMessage=function(){t.otherMessage=void 0},t.login=function(e){t.connect(n.find(window.form_entry.users,function(t){return t.user_credentials.email===e}).root_link_save)},t.hasAccount=function(e){return n.find(window.form_entry.users,function(t){return t.user_credentials.email===e})},t.addUser=function(e){n.isUndefined(e.new_user_cluster)&&(document.getElementById("rdoWalt").checked?e.new_user_cluster="walt":document.getElementById("rdoProd").checked?e.new_user_cluster="prod":document.getElementById("rdoProdBeta").checked&&(e.new_user_cluster="prod_beta")),document.getElementById("btnAddId").disabled=!0,document.getElementById("btnAddEmail").disabled=!0,document.getElementById("txtProgress").style.display="inherit";const i=t.returnLastPathSegment(r.location.href)+"/add";a.post(i,e).then(function(e){t.form_entry=e,document.getElementById("btnAddId").disabled=!1,document.getElementById("btnAddEmail").disabled=!1,document.getElementById("txtProgress").style.display="none"},v)},t.addByEmail=function(e,i){t.hasAccount(e)?o.confirmationService.display({message:"you already have the account "+e+" do you wish to redownload?"}).then(function(){t.addUser({new_user_email:e||document.getElementById("txtEmail").value,new_user_type:"email",filter_project_id:document.getElementById("txtProjectFilter").value,new_user_cluster:i},function(){})},function(){}):t.addUser({new_user_email:e||document.getElementById("txtEmail").value,new_user_type:"email",filter_project_id:document.getElementById("txtProjectFilter").value,new_user_cluster:i})},t.addById=function(){t.addUser({new_user_id:document.getElementById("txtId").value,new_user_type:"id",filter_project_id:document.getElementById("txtProjectFilter").value})},t.connect=function(e){a.get(e).then(function(e){t.form_entry=e,r.location.href=t.form_entry.redirect_url},v)},t.clearDB=function(){a.post(t.form_entry.clear_d_b_url,{}).then(S,v)},t.createSearchProject=function(e){const i=t.form_entry.add_search_project_url,n={account_id:e};a.post(i,n).then(S,v)},t.createPartner=function(e){const i=t.form_entry.create_partner_url,n={partner_type_name:e};a.post(i,n).then(S,v)},t.assignAccountToPartner=function(e,i){const n=t.form_entry.assign_partner_url,s={account_id:e,partner_type_name:i};a.post(n,s).then(S,v)},t.clearRecentSearches=function(e){const i=t.form_entry.clear_recent_searches_url,n={project_id:e};a.post(i,n).then(S,v)},t.form_entry=r.form_entry,t.getUsers=function(){return t.form_entry.users},t.getUserByEmail=function(e){return n(t.form_entry.users).find(function(t){return t.user_credentials.email===e})},t.getUserById=function(e){return n(t.form_entry.users).find(function(t){return t.id===e})},t.processAction=function(e,t){l.process({action_type:e,action_payload:t},y)},t.setImageSearch=function(e,t){const i={action:t,project_id:e,restriction:"IMAGE_DETECTION"};d.imageSearch(i,m('image search set to "'+t+'"'),m("SOMETHING WENT WRONG"))},t.setDiscovery=function(e,t){const i={action:t,project_id:e,restriction:"DISCOVERY"};d.discovery(i,m('discovery set to "'+t+'"'),m("SOMETHING WENT WRONG"))},t.getProjects=function(e){return i(t.form_entry.users).filter(function(t){return!angular.isDefined(e)||t.id===e}).pluck("dev_accounts").flatten().filter(_).map(f).flatten().uniq("projectId").value()},t.cutoffTypes=i(constants.cutoff.type).values().value(),t.cutoffFormData={projectId:"",numberOfDays:7,date:new Date,type:t.cutoffTypes[0]},t.cutoffResetFormData={},t.topicsResetFormData={},t.resultsRulesFormData={},t.refreshProjectFormData={env:"WALT"},t.hootsuiteFormData={hsId:void 0,twId:"5f2cd1fb-7208-4768-8074-36a128a3ca51"},t.isCutoffFormValid=function(){let e=i(t.signin_form);switch(t.cutoffFormData.type){case"NOREBUILD":e=e.pick(["cutoff-project-id","cutoff-number-of-days","cutoff-date"]);break;case"PROJECTHISTORYLIMITATIONS":e=e.pick(["cutoff-project-id","cutoff-number-of-days"]);break;case"TOOMANYRESULTSPERMONTH":e=e.pick(["cutoff-project-id","cutoff-date"]);break;default:return!1}return!e.pluck("$valid").every()},t.isCutoffResetFormValid=function(){return i([void 0,""]).contains(t.cutoffResetFormData.projectId)},t.isHootsuiteFormValid=function(){return!i(t.signin_form).pick(["hootsuite-hs-id","hootsuite-tw-id"]).pluck("$valid").every()},t.isRefreshFormValid=function(){return!i(t.signin_form).pick(["refresh-cluster","refresh-user","refresh-project"]).pluck("$valid").every()},t.isTopicsResetFormValid=function(){return!i(t.signin_form).pick(["topics-reset-project-id","topics-reset-search-topics","topics-reset-search-topic-entries","topics-reset-search-topic-entry-chars"]).pluck("$valid").every()},t.isResultsRulesFormValid=function(){return i(t.signin_form).pick(["results-rules-project-id","results-rules-count"]).pluck("$valid").every()},t.refreshProject=function(){c.fetchProject({user_id:t.refreshProjectFormData.userId,project_id:t.refreshProjectFormData.projectId,env:t.refreshProjectFormData.env},S)},t.submitCutoff=function(){const e=m("Cutoff applied successfully!");switch(t.cutoffFormData.type){case"NOREBUILD":c.addCutoff({cutoff_ts:t.cutoffFormData.date.getTime(),cutoff_type:t.cutoffFormData.type,data_storage_days:t.cutoffFormData.numberOfDays,project_id:t.cutoffFormData.projectId},e);break;case"PROJECTHISTORYLIMITATIONS":c.addCutoff({cutoff_type:t.cutoffFormData.type,data_storage_days:t.cutoffFormData.numberOfDays,project_id:t.cutoffFormData.projectId},e);break;case"TOOMANYRESULTSPERMONTH":c.addCutoff({cutoff_ts:t.cutoffFormData.date.getTime(),cutoff_type:t.cutoffFormData.type,project_id:t.cutoffFormData.projectId},e);break;default:throw new Error("invalid cutoff type")}},t.submitCutoffReset=function(){c.removeCutoffs({project_id:t.cutoffResetFormData.projectId},m("Cutoffs removed successfully!"))},t.submitHootsuite=function(){p.setup({tw_user_id:t.hootsuiteFormData.twId,hs_user_id:t.hootsuiteFormData.hsId},m("Hootsuite was setup!"))},t.submitTopicsReset=function(){g.updateTopics({project_id:t.topicsResetFormData.projectId,search_topics:t.topicsResetFormData.searchTopics,search_topic_entries:t.topicsResetFormData.searchTopicEntries,search_topic_entry_chars:t.topicsResetFormData.searchTopicEntryChars},m("Topics reset!"))},t.submitResultsRulesCreation=function(){u.createResultsRules({project_id:t.resultsRulesFormData.projectId,rules_count:t.resultsRulesFormData.rulesCount})},$("div.tw-splashscreen").hide()}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$resource","$scope","$window","restFormService"],t.default=r}),define("controllers/rest_form/dev/code_insights",["require","exports"],function(e,t){function i(e,t,i,n){t.form_entry=i.form_entry,$("div.tw-splashscreen").hide()}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$resource","$scope","$window","restFormService"],t.default=i}),define("controllers/rest_form/dev/light_generic",["require","exports","notifications"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const n=i.notificationService;function s(e,t,i){t.form_entry=i.form_entry,$("div.tw-splashscreen").hide();const s=e(":action",{responseType:"json",transformResponse:function(e,i,n){500===n&&(t.otherMessage="something went wrong")}},{process:{method:"POST",params:{action:"merge"}}});function o(e){n.display(e.notification),void 0!==e.url&&(i.location.href=e.url)}t.callAction=function(e){s.process({action_type:e},o)}}s.$inject=["$resource","$scope","$window"],t.default=s}),define("controllers/rest_form/dev/phantomjs_metrics",["require","exports"],function(e,t){function i(e,t,i,n){t.form_entry=i.form_entry,$("div.tw-splashscreen").hide(),t.imageExportPageStateId=window.location.hash.split("pagestate=")[1]||"",t._description='Check imageexporter log and copy/paste the "Error UUID" to reproduce export',t.description=t._description,t.downloadImageExporterPS=function(){t.showSandboxUrl=void 0,t.description="loading...",n.post("/app/rform/dev_phantomjs_metrics/refresh",{application_data_id:t.imageExportPageStateId,source_clusters:window.form_entry.source_clusters}).then(function(e){t.description=void 0,t.showSandboxUrl=e.application_data_id},function(){t.description=t._description})},t.exportImageExporterPS=function(){t.description="loading...",t.image=void 0,n.post("/app/rform/dev_phantomjs_metrics/export",{application_data_id:t.imageExportPageStateId,source_clusters:window.form_entry.source_clusters}).then(function(e){t.image=e.image,t.description=t._description},function(){t.description=t._description})}}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$resource","$scope","$window","restFormService"],t.default=i}),define("controllers/rest_form/document_template/document_template",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.form_entry=window.form_entry}}}),define("controllers/rest_form/events/event",["require","exports"],function(e,t){function i(e,t,i){e.cancel=(()=>t.redirect(e.form_entry.root_link_back)),e.event=i.form_entry}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$scope","$rootScope","$window"],t.default=i,t.EventController=i}),define("controllers/rest_form/events/events",["require","exports","underscore","moment-timezone","services/confirmation_service","services/context"],function(e,t,i,n,s,o){function r(e,t,r,a){e.form_entry=t.form_entry,e.filter={items:"tbody"},e.sort={stop:(e,i)=>{const n=t.form_entry.events,s=i.item.index()-2,r=i.item.sortable.index-2,c=n.splice(r,1)[0];n.splice(s,0,c);const l={id:c.id,new_index:s},d=routes.controllers.tw.TWRestForm.get(o.contextService.getCurrentContext().scope,o.contextService.getCurrentContext().id,"event","move","","rform").url;a.post(d,l)}};e.newEvent=(t=>{t.preventDefault(),a.post(e.form_entry.link_add).then(t=>e.editEvent(t))}),e.editEvent=(e=>r.redirect(e.edit_link)),e.remove=(t=>s.confirmationService.display({message:e.form_entry.confirm_question}).then(()=>(t=>{a.deleter(t.link_delete).then(n=>{e.form_entry.events=i(e.form_entry.events).without(i(e.form_entry.events).findWhere({id:t.id}))},t=>e.topic.field_messages=t.field_messages)})(t),()=>void 0)),e.getDate=(e=>n(e.date).format("DD/MM/YYYY")),e.getRange=(e=>{const t=n(e.end);return 0===t.hour()&&0===t.minute()&&t.subtract(1,"days"),n(e.start).format("DD/MM/YYYY")+" - "+t.format("DD/MM/YYYY")}),e.togglePopup=(t=>{t.stopPropagation(),e.popup.show=!e.popup.show}),e.showPopup=((t,i)=>{i.stopPropagation(),e.popup.data=t,e.popup.show=!0})}Object.defineProperty(t,"__esModule",{value:!0}),r.$inject=["$scope","$window","$rootScope","restFormService"],t.default=r,t.EventsController=r}),define("controllers/rest_form/influencer_mgmt/influencers_settings/influencers_settings",["require","exports","angular_utilities","pagination","reusable_utilities","react-dom","react","event","classes/context_data/context_data","services/loading_bubble","services/rest_form_service","services/confirmation_service","notifications"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});let p=class{constructor(e,t,i,n){this.$scope=e,this.$element=t,this.$window=i,this.$timeout=n,this.cancellationToken=new s.CancellationToken,this.filterValue="",this.initialize()}getStatusDisplayName(e){switch(e){case"ACTIVE":return c.contextData.getMessage("_1879065");case"PENDING":return c.contextData.getMessage("_1890624");case"UPDATE_PENDING":return c.contextData.getMessage("_1894064");case"IMPORT_FAILED":return c.contextData.getMessage("_1950843");case"METRICS_FAILED":return c.contextData.getMessage("_1349815");case"UPDATE_FAILED":return c.contextData.getMessage("_1805217");case"UPDATE_AND_METRICS_FAILED":return c.contextData.getMessage("_1941355");case"INFLUENCER_LIMIT_EXCEEDED":return c.contextData.getMessage("_1915024");case"UNKNOWN":default:return c.contextData.getMessage("_1894404")}}deleteInfluencer(e){g.confirmationService.display({message:this.formEntry.confirm_question}).then(async()=>{l.loadingBubbleService.showSpinner(),this.deletingInfluencer=!0;const t=d.restFormService.deleter(e.remove_link);u.notificationService.warning(`<i class="fa fa-refresh fa-spin"></i> ${c.contextData.getMessage("_498245")}`,{permanent:!0,singleInstance:!0,closeOnResolve:t}),this.formEntry=await t,this.initStatusTable(),this.influencersPaginator.replaceModels(this.influencersTable.data),this.deletingInfluencer=!1,l.loadingBubbleService.hideSpinner(),this.$scope.$$phase||this.$scope.$apply()},()=>void 0)}updatePagination(){this.influencersPaginator.pageNum=1,this.influencersPaginator.events.onRedraw.fire()}initialize(){this.formEntry=this.$window.form_entry,this.initStatusColors(),this.initStatusTable(),this.initPaginator()}initStatusColors(){this.statusColors={},this.statusColors.ACTIVE="green",this.statusColors.PENDING="orange",this.statusColors.UPDATE_PENDING="orange",this.statusColors.IMPORT_FAILED="red",this.statusColors.METRICS_FAILED="red",this.statusColors.UPDATE_FAILED="red",this.statusColors.UPDATE_AND_METRICS_FAILED="red",this.statusColors.UNKNOWN="red",this.statusColors.INFLUENCER_LIMIT_EXCEEDED="red"}initStatusTable(){this.influencersTable={title:c.contextData.getMessage("_449842"),data:this.formEntry.influencers||[]}}initPaginator(){const e=new a.Event;e.subscribe(()=>{this.$scope.$$phase||this.$scope.$apply()});const t={onChange:e,onRedraw:new a.Event},i=new n.ListPaginator(this.influencersTable.data,t,this.matchPredicate.bind(this),200);this.influencersPaginator=i,this.$timeout(()=>{const e=this.$element.find("#pagination")[0];this.cancellationToken.addCleanupFunction(()=>o.unmountComponentAtNode(e)),o.render(r.createElement(n.ListPaginationComponent,{paginator:i}),e)})}matchPredicate(e,t,i){return void 0!==e.name&&e.name.toLowerCase().includes(this.filterValue.toLowerCase())}};p=__decorate([i.ngInject(["$scope","$element","$window","$timeout"]),__metadata("design:paramtypes",[Object,Object,Object,Function])],p),t.default=p}),define("controllers/rest_form/influencer_mgmt/setup/influencers_setup",["require","exports","angular_utilities","reusable_utilities","event","pagination","react","react-dom","reusable_utilities","classes/context_data/context_data","services/icons","services/loading_bubble","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});let p=class{constructor(e,t,i,s){this.$scope=e,this.$element=t,this.$window=i,this.$timeout=s,this.cancellationToken=new n.CancellationToken,this.uploadingChannels=!1,this.uploadingChannelsFile=!1,this.exportingInfluencers=!1,this.filterValue="",this.initialize()}async addChannels(){g.loadingBubbleService.showSpinner(),this.uploadingChannels=!0;try{this.formEntry=await u.restFormService.postRForm("influencer_setup_import","update",{pasted_channels:this.formEntry.pasted_channels,target_lists:this.formEntry.target_lists}),this.initStatusTable(),this.importStatusPaginator.replaceModels(this.statusTable.data)}catch(e){}finally{this.uploadingChannels=!1,g.loadingBubbleService.hideSpinner(),this.$scope.$$phase||this.$scope.$apply()}}async importInfluencers(){g.loadingBubbleService.showSpinner(),this.uploadingChannelsFile=!0;try{this.formEntry=await u.restFormService.postMultipartRForm("influencer_setup_import","import",{imported_file:this.formEntry.imported_file,target_lists:this.formEntry.target_lists}),this.initStatusTable(),this.importStatusPaginator.replaceModels(this.statusTable.data)}catch(e){}finally{this.uploadingChannelsFile=!1,g.loadingBubbleService.hideSpinner(),this.$scope.$$phase||this.$scope.$apply()}}async exportInfluencers(){try{this.exportingInfluencers=!0;const e=this.exportTypes.find(e=>c.TopicEntryUtils.isSelected(e));await u.restFormService.postRForm("influencer_setup_import","export",{export_type:e.mapped_id}),this.exportingInfluencers=!1}catch(e){this.exportingInfluencers=!1}}getStatusDisplayName(e){switch(e){case"ACTIVE":return l.contextData.getMessage("_1879065");case"PENDING":return l.contextData.getMessage("_1890624");case"UPDATE_PENDING":return l.contextData.getMessage("_1894064");case"IMPORT_FAILED":return l.contextData.getMessage("_1950843");case"METRICS_FAILED":return l.contextData.getMessage("_1349815");case"UPDATE_FAILED":return l.contextData.getMessage("_1805217");case"UPDATE_AND_METRICS_FAILED":return l.contextData.getMessage("_1941355");case"INFLUENCER_LIMIT_EXCEEDED":return l.contextData.getMessage("_1915024");case"UNKNOWN":default:return l.contextData.getMessage("_1894404")}}isTargetListSelected(){return void 0!==c.TopicMenuUtils.getFirstSelectedEntry(this.formEntry.target_lists)}isEntrySelected(e){return c.TopicEntryUtils.isSelected(e)}isAnyExportTypeSelected(){return this.exportTypes.some(e=>c.TopicEntryUtils.isSelected(e))}updatePagination(){this.importStatusPaginator.pageNum=1,this.importStatusPaginator.events.onRedraw.fire()}selectExportType(e){this.unselectExportTypes(),c.TopicEntryUtils.setSelection(e,!0)}getExportTypeIcon(e){return d.iconService.getIconForExport(e.mapped_id)}initialize(){this.formEntry=this.$window.form_entry,this.initExportTypes(),this.initStatusColors(),this.initStatusTable(),this.initPaginator()}initExportTypes(){this.exportTypes=[],this.exportTypes.push({mapped_id:"CSV",name:l.contextData.getMessage("_923892")}),this.exportTypes.push({mapped_id:"XLS",name:l.contextData.getMessage("_924984")}),this.exportTypes.push({mapped_id:"XLSX",name:"XLSX"})}initStatusColors(){this.statusColors={},this.statusColors.ACTIVE="green",this.statusColors.PENDING="orange",this.statusColors.UPDATE_PENDING="orange",this.statusColors.IMPORT_FAILED="red",this.statusColors.METRICS_FAILED="red",this.statusColors.UPDATE_FAILED="red",this.statusColors.UPDATE_AND_METRICS_FAILED="red",this.statusColors.UNKNOWN="red",this.statusColors.INFLUENCER_LIMIT_EXCEEDED="red"}initStatusTable(){this.statusTable={title:l.contextData.getMessage("_449842"),data:this.formEntry.import_statuses||[]}}initPaginator(){const e=new s.Event;e.subscribe(()=>{this.$scope.$$phase||this.$scope.$apply()});const t={onChange:e,onRedraw:new s.Event},i=new o.ListPaginator(this.statusTable.data,t,this.matchPredicate.bind(this),15);this.importStatusPaginator=i,this.$timeout(()=>{const e=this.$element.find("#pagination")[0];this.cancellationToken.addCleanupFunction(()=>a.unmountComponentAtNode(e)),a.render(r.createElement(o.ListPaginationComponent,{paginator:i}),e)})}matchPredicate(e,t,i){if(e.influencer_status){let t=!1;return e.influencer_status.forEach(e=>{void 0!==e.profile_url&&e.profile_url.toLowerCase().includes(this.filterValue.toLowerCase())&&(t=!0)}),t}return!1}unselectExportTypes(){this.exportTypes.forEach(e=>c.TopicEntryUtils.setSelection(e,!1))}};p=__decorate([i.ngInject(["$scope","$element","$window","$timeout"]),__metadata("design:paramtypes",[Object,Object,Object,Function])],p),t.default=p}),define("controllers/rest_form/mailing_lists/mailing_list",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","$rootScope",function(e,t,n,s){e.form_entry=t.form_entry,e.import_action=constants.events.form.action.importr,e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0},e.importFile=function(){n.postMultipart(e.form_entry.import_link,e.form_entry,void 0,constants.events.form.action.importr).then(function(t){e.form_entry=t},function(t){e.form_entry.field_messages=t.field_messages})},e.addMails=function(){const t=e.form_entry.title;n.post(e.form_entry.add_link,e.form_entry).then(function(i){i.title=t,e.form_entry=i},function(i){i.title=t,e.form_entry=i})},e.removeMail=function(t,s){s.preventDefault(),e.form_entry.email_set=i.without(e.form_entry.email_set,t),n.post(e.form_entry.remove_mail_link,e.form_entry).then(function(e){})},e.save=function(){n.post(e.form_entry.update_link,e.form_entry).then(function(t){e.form_entry=t,e.redirect(e.form_entry.root_link_back)},function(t){e.form_entry=t})},e.cancel=function(){e.redirect(e.form_entry.root_link_back)},e.redirect=function(e){s.redirect(e)}}]}),define("controllers/rest_form/mailing_lists/mailing_lists",["require","exports","underscore","services/confirmation_service","classes/context_data/context_data"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","$rootScope",function(e,t,o,r){e.form_entry=t.form_entry,e.newMailingList=function(){o.get(e.form_entry.new_link).then(function(t){e.form_entry.mailing_lists.push(t),e.redirect(t.edit_link)})};e.redirect=function(e){r.redirect(e)},e.removeList=function(t,s){s.preventDefault(),n.confirmationService.display({message:t.remove_confirm_question}).then(()=>{!function(t){o.deleter(t.remove_link,t).then(t=>{e.form_entry.mailing_lists=i.without(e.form_entry.mailing_lists,i.findWhere(e.form_entry.mailing_lists,{list_id:t.list_id}))},()=>{})}(t)},()=>{})},e.emailHasIssues=function(e,t){return!!e.email_states[t].hard_failure},e.unbanEmail=function(e,t){o.postRForm("mail_banned","remove",{mail:e}).then(()=>{t.email_states[e].hard_failure=!1},()=>{})},e.showIssueDetails=function(e,t){n.confirmationService.display({message:{title:s.contextData.getMessage("_2441123"),message:s.contextData.getMessage("_2446612")+'<br><br><code style="white-space:pre-wrap">'+t.email_states[e].reason+"</code>",hideCancel:!0}}).then(()=>{},()=>{})}}]}),define("controllers/rest_form/page/embed",["require","exports","classes/application/application","wrappers/page_state/page_state_wrapper","services/rest_form_service","services/application_mode","services/presentation_service","classes/refresh/model_refresh_strategy","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/refresh/model_refresh_service","services/command_center","services/theme"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope",function(e){e.isPageStateLoaded=function(){return i.mainApplication.hasPageState()},e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.isGrid=function(){return i.mainApplication.getPageState().isGridPage()},e.pageData=(()=>i.mainApplication.getPageState()),s.restFormService.get(window.page_state_id).then(e=>{if(i.mainApplication.injectPageState(new n.PageStateWrapper(e.page_state||e,i.mainApplication,!0)),o.applicationMode.getCurrentAppMode()===o.AppMode.SHARED_COMMAND_CENTER){window.validateUrl=e.validate_url,r.presentationService.enterPresentationMode({conditions:{failIfNotFullscreen:!1},actions:{exitOnWindowSizeChange:!1,exitPresentationOnEscape:!1,redrawWidgets:!1},style:{hideHeader:!0,hideNavbar:!0,hideNotifications:!0,hideSidebar:!0}});const t={strategy:a.ModelRefreshStrategy.REFRESH,endpoint:"public_cc"},n=c.modelRefreshDecoratorFactory.getDecorator(i.mainApplication.getPageState(),i.mainApplication,l.ModelType.PAGE_STATE,t);d.modelRefreshService.refresh(n,t),g.commandCenterService.enterFullscreenMode(void 0,u.themeService.findThemeByCSSFile(i.mainApplication.getPageState().getStyleSheet()))}}),e.getSelectedDashboard=(()=>i.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.dashboard).getFirstSelectedEntryRecursively())}]}),define("controllers/rest_form/page/snapshot",["require","exports","classes/application/application","wrappers/page_state/page_state_wrapper"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope",function(e){i.mainApplication.injectPageState(new n.PageStateWrapper(window.page_state,i.mainApplication,!0))}]}),define("controllers/rest_form/pages_monitoring/pages_monitoring",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.form_entry=t.form_entry}]}),define("controllers/rest_form/project_views/project_views",["require","exports","underscore","angular","services/rest_form_service","services/tw_routing","angular_utilities","services/confirmation_service","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});let l=class{constructor(e,t,i){this.$scope=e,this.$window=t,this.$rootScope=i,this.form_entry=t.form_entry}deleteFromServer(e){s.restFormService.deleter(e.delete_link)}getName(e){return e.is_default?`${e.name} [${c.contextData.getMessage("_874124")}]`:e.name}editSharing(e){this.$rootScope.redirect(e.edit_sharing_link)}findProjectFormWithBookmark(e){for(const t of this.form_entry.account_forms)for(const i of t.projects)if(i.id===e.project_id)return i;return null}updateDefault(e,t){const i=this.findProjectFormWithBookmark(e);for(const n of i.bookmarks)n.id===e.id?n.is_default=t:t&&e.group_id===n.group_id&&(n.is_default=!1);const n={view_id:e.id,make_default:t};s.restFormService.post(e.edit_link,n)}remove(e){a.confirmationService.display({message:this.form_entry.confirm_question}).then(()=>{this.deleteFromServer(e);const t=this.findProjectFormWithBookmark(e);t.bookmarks=i.filter(t.bookmarks,t=>t.id!==e.id)},()=>void 0)}openView(e){const t={view_id:e.id},i=routes.controllers.tw.TWRestForm.post("project",e.project_id,"bookmark","new","","rform").url;s.restFormService.post(i,t).then(e=>o.twRoutingService.changePageById(e.sub_page_id,e.token))}};l=__decorate([r.ngInject(["$scope","$window","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],l),t.default=l}),define("controllers/rest_form/project_views/view/view_sharing",["require","exports","angular_utilities","angular","services/rest_form_service","classes/context_data/context_data","reusable_utilities"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});let a=class{constructor(e,t){this.$scope=e,this.$window=t,this.save=this.saveForm.bind(this),this.form_entry=t.form_entry,this.usersInitiallySelected=void 0!==this.form_entry.users&&void 0!==r.TopicMenuUtils.getFirstSelectedEntry(this.form_entry.users),this.initSaveButton()}saveForm(){s.restFormService.post(this.form_entry.save_link,this.form_entry)}initSaveButton(){this.progressOptions={action:constants.events.form.action.post,text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337"),keepProgress:!0,isDisabled:()=>!this.usersInitiallySelected&&void 0!==this.form_entry.users&&void 0===r.TopicMenuUtils.getFirstSelectedEntry(this.form_entry.users)}}};a=__decorate([i.ngInject(["$scope","$window"]),__metadata("design:paramtypes",[Object,Object])],a),t.default=a}),define("controllers/rest_form/projects/general_settings",["require","exports","angular","underscore","services/modal","services/confirmation_service","services/context","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){function c(e,t,c,l,d){function g(e){let t,i;const n=window.location.search.substring(1).split("&");for(t=0;t<n.length;t++)if((i=n[t].split("="))[0]===e)return unescape(i[1]);return null}function u(e,t){const i=[],s=e.getEntryByMappedId(t);s.setSelected(!1),i.push(s),void 0!==e.getEntryByMappedId(constants.filters.custom)&&i.push(e.getEntryByMappedId(constants.filters.custom)),n(i).each(e=>{e.hasChildren()&&n(e.getChildren()).each(e=>{e.hasSelectionChanged()||e.setSelected(!1),e.hasChildren()&&e.allChildrenSelected()&&(n(e.getChildren()).each(e=>{e.setSelected(!1)}),e.setSelected(!0),e.setHits(0))})}),i[0].allChildrenSelected()&&(i[0].setChildrenSelectionRecursively(!1),e.recalculateHits(),i[0].setSelected(!0))}function p(){const e=routes.controllers.tw.TWRestForm.get("project",window.tw.project_id,"project_users_access","show","","rform").url;t.get(e).then(e=>{i.isDefined(e.users_menu)?s.modalService.display("PROJECT_USERS_ACCESS",e).then(h,h):h()})}function h(){o.confirmationService.display({message:{message:a.contextData.getMessage("_823763"),ok:a.contextData.getMessage("_186670"),cancel:a.contextData.getMessage("_202805")}}).then(()=>{window.location=e.form_entry.edit_mode_url},()=>void 0)}e.addNewCustomTimeFilter=function(i){i.preventDefault();const n=routes.controllers.tw.TWRestForm.get(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"custom_time_filter","new","","rform").url;t.get(n).then(t=>{e.form_entry.project_advanced_settings.custom_time_filters.unshift(t),e.form_entry.project_advanced_settings.custom_time_filters.forEach((e,t)=>{e.order=t})},t=>e.form_entry.field_messages=t.field_messages)},e.isCustomTimeFiltersEnabled=function(){return a.contextData.rules.isCustomTimeFiltersEnabled()},e.generalSettingForm=n.debounce(()=>{const i=JSON.parse(JSON.stringify(e.form_entry)),n=new c(i.countries),s=new c(i.languages),o=new c(i.media_type);e.form_entry.group_countries&&u(n,constants.root_id.predefined_countries),e.form_entry.group_languages&&u(s,constants.root_id.predefined_languages),e.form_entry.group_media_type&&u(o,constants.root_id.predefined_media_types),n.toProto(),s.toProto(),o.toProto(),t.post(e.form_entry.save_link,i).then(t=>{e.form_entry.field_messages=t.field_messages,d.reloadPageAndContext()},t=>{e.form_entry.field_messages=t.field_messages}).then(()=>{"1"===g("new")&&p()})},1e3,!0),e.createEntry=((t,i)=>new l(t,e.tagsMenu,i)),e.countries=new c(window.form_entry.countries),e.languages=new c(window.form_entry.languages),e.mediaTypes=new c(window.form_entry.media_type),e.smartFilters=new c(window.form_entry.predefined_filters),e.form_entry=window.form_entry,"1"===g("set_users_access")&&p(),e.progressOptions={action:constants.events.form.action.post,text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),isDisabled:()=>void 0===e.form_entry.save_link}}Object.defineProperty(t,"__esModule",{value:!0}),c.$inject=["$scope","restFormService","TopicMenuWrapper","TopicEntryWrapper","twRoutingService"],t.default=c,t.ProjectGeneralSettingsController=c}),define("controllers/rest_form/projects/restricted_settings",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","restFormService","twRoutingService",function(e,t,n){e.generalSettingForm=i.debounce(function(){const i=JSON.parse(JSON.stringify(e.form_entry));t.post(e.form_entry.save_link,i).then(function(t){e.form_entry.field_messages=t.field_messages,n.reloadPageAndContext()},function(t){e.form_entry.field_messages=t.field_messages})},1e3,!0),e.form_entry=window.form_entry,e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")}}]}),define("controllers/rest_form/projects/turn_off_notifications",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.form_entry=t.form_entry,e.goToLogin=function(){t.location.href=e.form_entry.link_login}}]}),define("controllers/rest_form/rebuild/rebuild",["require","exports","angular_utilities","wrappers/user_filter_settings/user_filter_settings_wrapper","services/confirmation_service","services/rest_form_service","services/bubble_dialog","services/configuration"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});let c=class{constructor(){this.blackout=this.blackoutDate.bind(this),this.scheduleRebuild=this.scheduleRebuildOnDemand.bind(this),this.form_entry=window.form_entry,this.userFilterSettings=new n.UserFilterSettingsWrapper(this.form_entry.ufs,void 0,void 0,!0),this.post_action=constants.events.form.action.post}toPercent(e){return e+"%"}canAddRebuild(){return!this.isRebuildsLimitReached()&&!this.isDataLimitReached()}disableSubmit(){return!this.userFilterSettings.getTimeFilter().hasTimeRange()&&this.userFilterSettings.getTimeFilter().hasNoInterval()}blackoutDate(e){return e.toDate().getTime()<this.form_entry.earliest_rebuild_start_ts}isRebuildsLimitReached(){return this.form_entry.remaining_rebuilds<=0}isDataLimitReached(){return this.form_entry.remaining_results<=0}scheduleRebuildOnDemand(){s.confirmationService.display({message:this.form_entry.confirmation_message}).then(()=>{o.restFormService.post(this.form_entry.add_link,this.form_entry).then(e=>{this.form_entry.field_messages=e.field_messages,this.form_entry.rebuild_log=e.rebuild_log},e=>{this.form_entry.field_messages=e.field_messages})},()=>{})}showFilterSelection(e,t){e.preventDefault(),this.loadFilterSelection(t,$(e.target))}loadFilterSelection(e,t){o.restFormService.get(e.info_link).then(this.spawnFilterSelection.bind(void 0,t))}spawnFilterSelection(e,t){t.ufs.filters.query_pinned=!1,t.ufs.filters.query_pinned_type="NONE";const i=new n.UserFilterSettingsWrapper(t.ufs);r.bubbleDialogService.destroyById(constants.bubble_dialog.id.filters.selection),r.bubbleDialogService.createSelectedFilters(constants.bubble_dialog.id.filters.selection,e,i,a.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1,void 0,!0,!0,!0)}};c=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[])],c),t.default=c}),define("controllers/rest_form/report/report",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.form_entry=t.form_entry}]}),define("controllers/rest_form/reports/report_categories",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.form_entry=t.form_entry}]}),define("controllers/rest_form/reports/reports_historic",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService",function(e,t,n){e.form_entry=t.form_entry,e.remove=function(t,n){n.preventDefault(),e.form_entry.reports=i.without(e.form_entry.reports,i.findWhere(e.form_entry.reports,{id:t.id}))}}]}),define("controllers/rest_form/results/rule/ai_filter_form_controller",["require","exports","filter_menu"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.AiEngineFilterFormController=class extends i.DefaultFilterFormController{constructor(){super(),this.DISPLAYED_TOP_RESULTS=19}filterSelectionHandler(e,t,i){!t.selected&&e.props.filters.filter(e=>e.selected).length>=19||(e.state=Object.assign({},e.state,{searchInput:"",showTopResults:!0}),this.dispatchFilterSelection(e,t,i))}}}),define("react_components/menu/topic_menu_select_component_strategies/redirect_url_menu_strategy",["require","exports","services/context","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.RedirectUrlMenuStrategy=class{constructor(e,t){this.menuWrapper=e,this.settingsMode=t}onSelect(e,t,s){return new Promise((e,s)=>{if(s(),this.settingsMode){const e=i.contextService.changeOldUrl(t.mapped_id),s=new n.Url(e);window.location.href=new n.Url(window.location.href).setParameterHash(encodeURIComponent(s.getHref())).getHref()}else window.location.href=t.mapped_id})}onMouseEnter(e){return new Promise((e,t)=>{e({openPath:void 0,changedEntry:void 0})})}isActionsDisabled(){return!1}}}),define("controllers/rest_form/results/rule/ai_results_rules",["require","exports","underscore","angular","other/tw","services/rest_form_service","services/confirmation_service","pagination","event","react","react-dom","classes/context_data/context_data","angular_utilities","wrappers/topic_menu/topic_menu_wrapper","reusable_utilities","react_components/menu/topic_menu_select_component_strategies/redirect_url_menu_strategy","talkwalker_constants","services/bubble_dialog","services/configuration","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v){var S;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FUTURE=0]="FUTURE",e[e.PAST=1]="PAST"}(S||(S={}));let b=class{constructor(e,t,i,n,s){this.$scope=e,this.$element=t,this.$window=i,this.$rootScope=n,this.$timeout=s,this.aiRuleTablesTemplate=BASE_TEMPLATE_URL+"controllers/rest_form/results/rule/ai_rule_tables.html",this.cancellationToken=new v.CancellationToken,this.initialize()}initPagination(){this.initPaginationsForType(this.aiRuleTables,this.aiRulesPaginators,"#ai-table-wrapper-")}editAiRule(e){this.$rootScope.redirect(e.edit_link)}trainAiRule(e){this.$rootScope.redirect(e.training_link)}async deleteAiRule(e,t,i){i.stopPropagation();try{await r.confirmationService.display({message:this.formEntry.confirm_question}),await this.askTagDeletionIfAvailable(e),this.deleteFromServer(e,t,()=>this.updateUiModelsAfterDeletion(t,e,this.aiRuleTables,this.aiRulesPaginators))}catch(e){}}async selectFirstRuleMenuOption(e){try{await this.createRuleMenuStrategy.onSelect(e,this.createRuleMenu.getRootEntry().getFirstLeaf().toProto())}catch(e){}}async openRebuildDialog(e){f.bubbleDialogService.createByType(constants.bubble_dialog.id.rebuild_time_range,$("body"),constants.bubble_dialog.id.rebuild_time_range,{rule:e},y.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.rebuild_time_range)).onMessage.subscribeOnce(()=>{this.$rootScope.reload()})}hasProgress(e){return void 0!==e.training_progress_percent&&0!==e.training_progress_percent}async toggleAiRule(e){let t=this.formEntry.past_ai_rules.find(t=>t.id===e);void 0===t&&(t=this.formEntry.future_ai_rules.find(t=>t.id===e));const i=!0===t.enabled?t.disable_rule_link:t.enable_rule_link;try{return await o.restFormService.post(i,t),!0}catch(e){return!1}}getDateColumnLabel(e){return e.type===S.PAST?g.contextData.getMessage("_1897445"):g.contextData.getMessage("_1840119")}cancelRebuild(e,t){o.restFormService.deleter(e.cancel_link).then(()=>{this.updateUiModelsAfterDeletion(t,e,this.aiRuleTables,this.aiRulesPaginators)},()=>void 0)}getDate(e,t){return t.type===S.PAST?e.created:e.last_updated}deleteFromServer(e,t,i){o.restFormService.deleter(e.remove_link,e).then(e=>{i()},e=>{})}updateUiModelsAfterDeletion(e,t,n,s){const o=n[e].data;o.splice(i.indexOf(o,t),1),0===o.length?(n.splice(e,1),s.splice(e,1)):s[e].replaceModels(o)}createSortableOptions(e){return{stop:(t,i)=>{const n=i.item.index(),r=routes.controllers.tw.TWRestForm.post("project",s.tw.project_id,"ai_result_rules","move","","settings").url,a={rule_to_move:e[n],new_index:n};o.restFormService.post(r,a)}}}initialize(){this.formEntry=this.$window.form_entry,this.aiRuleTables=[],this.aiRulesPaginators=[],this.createRuleMenu=new p.TopicMenuWrapper(this.formEntry.create_rule_menu),this.createRuleMenuStyleModel=h.TopicMenuSelectStyleUtils.buildButtonStyleModel("icon-tw-plus-sign"),this.createRuleMenuStrategy=new m.RedirectUrlMenuStrategy(this.createRuleMenu,!0),this.initAiRuleTables(),this.initStatusColors(),this.pollTrainingProgress(),this.subscribeDestroy()}initAiRuleTables(){this.formEntry.future_ai_rules&&this.formEntry.future_ai_rules.length>0&&this.aiRuleTables.push({title:g.contextData.getMessage("_449842"),data:this.formEntry.future_ai_rules,sortable:!1,type:S.FUTURE}),this.formEntry.past_ai_rules&&this.formEntry.past_ai_rules.length>0&&this.aiRuleTables.push({title:g.contextData.getMessage("_845122"),data:this.formEntry.past_ai_rules,sortable:!1,type:S.PAST})}initPaginationsForType(e,t,i){e.forEach((e,n)=>{const s=new c.Event;s.subscribe(()=>{this.$scope.$$phase||this.$scope.$apply()});const o={onChange:s,onRedraw:new c.Event},r=new a.ListPaginator(e.data,o,void 0,20);t.push(r),this.$timeout(()=>{const e=`${i}${n} #pagination-${n}`,t=this.$element.find(e)[0];this.cancellationToken.addCleanupFunction(()=>d.unmountComponentAtNode(t)),d.render(l.createElement(a.ListPaginationComponent,{paginator:r}),t)})})}pollTrainingProgress(){this.pollIntervalId=setInterval(async()=>{this.updateTrainingProgresses(await this.requestTrainingProgress())},4e3)}async requestTrainingProgress(){return o.restFormService.get(this.formEntry.training_progress_link)}updateTrainingProgresses(e){const{progress_per_rule:t,status_per_rule:i,display_status_per_rule:n}=e;void 0!==t&&this.aiRuleTables.forEach(e=>{e.data.forEach(e=>{const s=t[e.id];if(void 0!==s&&(e.training_progress_percent=s),void 0!==i){const t=i[e.id];void 0!==t&&(e.status=t)}if(void 0!==n){const t=n[e.id];void 0!==t&&(e.display_state=t)}})})}async askTagDeletionIfAvailable(e){if(e.delete_tags_question)try{await r.confirmationService.display({message:{message:e.delete_tags_question,ok:g.contextData.getMessage("_697024"),cancel:g.contextData.getMessage("_348105")}}),e.delete_tags_on_remove=!0}catch(t){t instanceof Error||(e.delete_tags_on_remove=!1)}}initStatusColors(){this.statusColors={},this.statusColors[_.DisplayStatus.RUNNING.toLowerCase()]="green",this.statusColors[_.DisplayStatus.RUNNING_AND_TRAINING.toLowerCase()]="green",this.statusColors[_.DisplayStatus.TRAINING.toLowerCase()]="orange",this.statusColors[_.DisplayStatus.STOPPED_AND_TRAINING.toLowerCase()]="orange",this.statusColors[_.DisplayStatus.TRAINING_REQUIRED.toLowerCase()]="red",this.statusColors[_.DisplayStatus.STOPPED.toLowerCase()]="red"}subscribeDestroy(){this.$scope.$on("$destroy",()=>{void 0!==this.pollIntervalId&&clearInterval(this.pollIntervalId),this.cancellationToken.cancel()})}};b=__decorate([u.ngInject(["$scope","$element","$window","$rootScope","$timeout"]),__metadata("design:paramtypes",[Object,Object,Object,Object,Function])],b),t.default=b}),define("controllers/rest_form/results/rule/tag_creation_button",["require","exports","flux","react","classes/context_data/context_data","event_bus","reusable_utilities","services/bubble_dialog","services/configuration"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.TagCreationButtonRenderable=class extends i.BaseComponent{render(){return n.createElement("div",{onClick:this.onClickHandler.bind(this),className:"action-button"},n.createElement("span",null,n.createElement("i",{className:"icon-tw-plus-sign"})),n.createElement("span",null,s.contextData.getMessage("_1856124")))}async onClickHandler(e){const t=JSON.parse(JSON.stringify(this.props.groupsMenu));this.spawnBubbleDialog(t).onMessage.subscribeOnce(e=>{this.dispatchCreatedTag(e.newTag,t,e.newGroup)})}spawnBubbleDialog(e){const t={tagName:"",groupsMenu:e};return a.bubbleDialogService.createByType(constants.bubble_dialog.id.tag_creation,$("body"),constants.bubble_dialog.id.tag_creation,t,c.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tag_creation))}dispatchCreatedTag(e,t,i){const n={tag:e,selectedGroup:r.TopicMenuUtils.getFirstSelectedEntry(t),newGroup:i};o.eventBus.dispatch({type:o.EVENT_TYPES.ADD_NEW_TAG_TO_AI_MODEL,value:n})}}}),define("controllers/rest_form/results/rule/controllers/no_save_filter_bar_controller",["require","exports","filter_menu"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.NoSaveFilterBarController=class extends i.AbstractFilterBarController{resetChanges(){}saveChanges(){}}}),define("controllers/rest_form/results/rule/abstract_ai_rule_form_controller",["require","exports","event_bus","filter_menu","react","react-dom","reusable_components","reusable_utilities","classes/context_data/context_data","controllers/rest_form/results/rule/tag_creation_button","controllers/rest_form/results/rule/ai_filter_form_controller","wrappers/topic_menu/topic_menu_wrapper","react_components/filter_menu/default_filter_menu_controller","react_components/filter_menu/topic_menu_wrapper_adapter","controllers/rest_form/results/rule/controllers/no_save_filter_bar_controller"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.AbstractAiRuleFormController=class{constructor(e,t,i,n){this.$scope=e,this.$element=t,this.$window=i,this.$rootScope=n,this.cancellationToken=new a.CancellationToken,this.buttonMenus=[],this.filterBarController=new h.NoSaveFilterBarController}initialize(){this.formEntry=this.$window.form_entry,this.saving=!1,this.initSuggestionsListener(),this.setupButtonMenus(),this.aiRuleFormFieldsTemplate=BASE_TEMPLATE_URL+"controllers/rest_form/results/rule/partial_template/ai_rule_form_fields.html",this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,this.handleTagsSelection.bind(this)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.ADD_NEW_TAG_TO_AI_MODEL,this.handleNewTag.bind(this))}destroy(){o.unmountComponentAtNode($("#tags-filter-menu")[0]),this.cancellationToken.cancel()}canSave(){return this.isTagsFieldValid()&&this.isLocationFieldValid()&&this.isTopicsFieldValid()}cancel(){this.$rootScope.redirect(this.formEntry.back_link)}getTagsSettingsMessage(){return c.contextData.getMessage("_1854635",[this.formEntry.tag_settings_link])}getFilterMenuColor(){return c.contextData.projectSettings.branding.color}getFilterBarController(){return this.filterBarController}handleTagsSelection(e){void 0!==this.formEntry.tags&&this.formEntry.tags.root_entry.mapped_id===e.value.parentId&&(this.formEntry.creating_new_rule?this.handleTagSelectionInCreateMode(e):this.handleTagSelectionInEditMode(e))}handleTagSelectionInCreateMode(e){const t=a.TopicEntryUtils.getEntryByMappedId(this.formEntry.tags.root_entry,e.value.element.mappedId);a.TopicEntryUtils.isSelected(t)?a.TopicEntryUtils.setSelection(t,!a.TopicEntryUtils.isSelected(t)):a.TopicEntryUtils.recursiveUnselectAndSelect(this.formEntry.tags.root_entry,e.value.element.mappedId),this.renderFiltersComponentForTags(),this.$rootScope.$$phase||this.$rootScope.$apply()}handleTagSelectionInEditMode(e){const t=a.TopicEntryUtils.getSelectedChildrenRecursively(this.formEntry.tags.root_entry).length;if(t<this.formEntry.category_limit||t===this.formEntry.category_limit&&e.value.element.selected){const t=a.TopicEntryUtils.getEntryByMappedId(this.formEntry.tags.root_entry,e.value.element.mappedId);this.handleRelatedSelections(t),a.TopicEntryUtils.setSelection(t,!a.TopicEntryUtils.isSelected(t)),this.renderFiltersComponentForTags(),this.$rootScope.$$phase||this.$rootScope.$apply()}}handleNewTag(e){this.formEntry.creating_new_rule?this.handleNewTagInCreateMode(e):this.handleNewTagInEditMode(e),void 0!==e.value.newGroup&&this.addNewGroupToTagCreationMenu(e.value.newGroup),this.renderFiltersComponentForTags(),this.$rootScope.$$phase||this.$rootScope.$apply()}handleNewTagInCreateMode(e){const{tag:t,selectedGroup:i,newGroup:n}=e.value;void 0===this.formEntry.tags.root_entry.children[0].children&&(this.formEntry.tags.root_entry.children[0].children=[]),i.mapped_id===constants.root_id.ungrouped_tags?this.formEntry.tags.root_entry.children[0].children.push({mapped_id:t.code,name:t.name}):this.formEntry.tags.root_entry.children[0].children.push({mapped_id:n.code,name:n.name})}handleNewTagInEditMode(e){const{tag:t,selectedGroup:i,newGroup:n}=e.value;let s;n?(s=n,void 0===this.formEntry.tags.root_entry.children[0].children&&(this.formEntry.tags.root_entry.children[0].children=[]),this.formEntry.tags.root_entry.children[0].children.push(s)):void 0===(s=a.TopicEntryUtils.getEntryByMappedId(this.formEntry.tags.root_entry,i.mapped_id))&&(s={mapped_id:i.mapped_id,name:i.name},void 0===this.formEntry.tags.root_entry.children[0].children&&(this.formEntry.tags.root_entry.children[0].children=[]),this.formEntry.tags.root_entry.children[0].children.push(s)),void 0===s.children&&(s.children=[]),s.children.push({mapped_id:t.code,name:t.name})}addNewGroupToTagCreationMenu(e){void 0===this.formEntry.all_groups_menu.root_entry.children&&(this.formEntry.all_groups_menu.root_entry.children=[]),this.formEntry.all_groups_menu.root_entry.children.push({mapped_id:e.code,name:e.name})}handleRelatedSelections(e){const t=a.TopicEntryUtils.getParent(e,this.formEntry.tags.root_entry);a.TopicEntryUtils.isSelected(e)||(a.TopicEntryUtils.setSelection(t,!1),a.TopicEntryUtils.setSelectionRecursive(e,!1,!1))}renderFiltersComponentForTags(){if(void 0!==this.formEntry.tags){const e=this.buildFilterFormFilters(this.formEntry.tags),t=this.buildMenuAttributes(this.formEntry.tags);o.render(s.createElement(n.FilterFormContainer,{actionButton:{component:l.TagCreationButtonRenderable,props:{groupsMenu:this.formEntry.all_groups_menu}},controller:new d.AiEngineFilterFormController,skipRender:!1,secondLevelElement:e[0].children[0],rootElementToIgnore:t.topicMenu.root_entry.name,messages:{},menuAttributes:t,filters:e}),$("#tags-filter-menu")[0])}}buildMenuAttributes(e){const t=e.root_entry;return{topicMenu:{root_entry:{name:t.name,mapped_id:t.mapped_id},disabled:!0===e.disabled,default_mapped_id:e.default_mapped_id},rootId:t.mapped_id,config:{color:c.contextData.projectSettings.branding.color,showSearchBar:!0,sortFunction:this.selectedTagsSortPredicate.bind(this)}}}buildFilterFormFilters(e){return u.DefaultFilterMenuController.getFilterInputsRecursively(this.remapTopicEntry(e.root_entry))}remapTopicEntry(e,t){const i=a.TopicEntryUtils.getSelectedChildrenRecursively(e).length;return{name:e.name,selected:"NODE"===e.selected,isNotSelectable:!1,mappedId:e.mapped_id,selectionNumber:i,parent:void 0!==t?{name:t.name,selected:"NODE"===t.selected,isNotSelectable:!1,mappedId:t.mapped_id}:void 0,children:void 0!==e.children?e.children.map(e=>this.remapTopicEntry(e)):[]}}initSuggestionsListener(){void 0!==this.formEntry.geo_short_ids&&this.$scope.$on("suggestionInserted",(e,t)=>{this.formEntry.geo_short_ids.push({short_id:t.suggestion.value,label:t.suggestion.label})})}isTagsFieldValid(){return void 0===this.formEntry.tags||a.TopicEntryUtils.isSelectedOrHoldsSelection(this.formEntry.tags.root_entry)}isLocationFieldValid(){return void 0===this.formEntry.geo_short_ids||this.formEntry.geo_short_ids.length>0}isTopicsFieldValid(){return void 0===this.formEntry.topics||a.TopicEntryUtils.isSelectedOrHoldsSelection(this.formEntry.topics.root_entry)}selectedTagsSortPredicate(e,t){const i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:0}setupButtonMenus(){this.buttonMenus.push([this.createButtonMenu(new g.TopicMenuWrapper(this.formEntry.languages_filter))],[this.createButtonMenu(new g.TopicMenuWrapper(this.formEntry.countries_filter))],[this.createButtonMenu(new g.TopicMenuWrapper(this.formEntry.media_types_filter))]),void 0!==this.formEntry.custom_filters_filter&&this.buttonMenus.push([this.createButtonMenu(new g.TopicMenuWrapper(this.formEntry.custom_filters_filter))])}createButtonMenu(e){const t={topicMenu:e,config:{menuLabelProvider:()=>e.getRootEntry().getName(),showSearchBar:!0,showSelectedFilters:!0,showTopResults:!1,showSelectionAsLabel:!0,component:{renderable:r.SquareFilterMenuRenderable,props:{minWidth:"309px"}}}};return{controller:new u.DefaultFilterMenuController(t,p.TopicMenuWrapperMenuAdapter)}}}}),define("controllers/rest_form/results/rule/ai_rule_edition",["require","exports","angular","services/rest_form_service","angular_utilities","controllers/rest_form/results/rule/abstract_ai_rule_form_controller"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});let r=class extends o.AbstractAiRuleFormController{constructor(e,t,i,n){super(e,t,i,n),this.initialize()}initialize(){super.initialize(),this.$scope.$on("$destroy",()=>this.destroy())}save(){this.saving=!0,n.restFormService.post(this.formEntry.save_link,this.formEntry).then(e=>{this.$rootScope.redirect(this.formEntry.back_link)})}saveAndRedirect(){this.saving=!0,n.restFormService.post(this.formEntry.create_link,this.formEntry).then(e=>{this.$rootScope.redirect(e.training_link)})}};r=__decorate([s.ngInject(["$scope","$element","$window","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object,Object])],r),t.default=r}),define("controllers/rest_form/results/rule/result_rule",["require","exports","reusable_utilities"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){t.form_entry.back_link=new i.Url(t.location.href).setParameterHash("url="+encodeURIComponent(t.form_entry.back_link)).getHref(),e.form_entry=t.form_entry}]}),define("controllers/rest_form/results/rule/results_rules",["require","exports","underscore","wrappers/page_state/page_state_wrapper","other/tw","services/rest_form_service","services/confirmation_service","pagination","event","react","react-dom","classes/context_data/context_data","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){function p(e,t,p,h,m,_,f){let y;e.resultRuleTablesTemplate=BASE_TEMPLATE_URL+"controllers/rest_form/results/rule/result_rule_tables.html",e.hasPastResultRules=function(){return void 0!==e.form_entry&&e.form_entry.past_result_rules.length>0},e.hasFutureResultRules=function(){return void 0!==e.form_entry&&e.form_entry.future_result_rules.length>0},e.hasSystemFutureResultRules=function(){return void 0!==e.form_entry&&e.form_entry.system_future_result_rules.length>0},e.editResultRule=function(e){h.redirect(e.edit_link)},e.deleteResultRule=function(t,n,s){s.stopPropagation(),r.confirmationService.display({message:e.form_entry.confirm_question}).then(()=>{!function(e,t,i){o.restFormService.deleter(e.remove_link).then(e=>{i()},e=>{})}(t,0,()=>(function(e,t,n,s){const o=n[e].data;o.splice(i.indexOf(o,t),1),0===o.length?(n.splice(e,1),s.splice(e,1)):s[e].replaceModels(o)})(n,t,e.resultRuleTables,e.resultRulesPaginators))},()=>void 0)},e.cancelResultRule=function(e,t){t.stopPropagation(),o.restFormService.deleter(e.cancel_link).then(t=>{e.cancel_link=t.cancel_link})},e.showFilterSelection=i.debounce(function(e,t){e.preventDefault(),function(e,t){y=e,o.restFormService.get(e.info_link).then(function(e,t){const i=new n.PageStateWrapper(t.page_state,void 0);_.destroyById(constants.bubble_dialog.id.filters.selection),_.createSelectedFilters(constants.bubble_dialog.id.filters.selection,e,i.getUserFilterSettings(),f.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.filters.selection),!1,void 0,!0,!0,!0).onOpen.subscribeOnce(()=>y=void 0)}.bind(void 0,t))}(t,$(e.target))},1e3),e.recreateRebuild=function(e,t){o.restFormService.post(t.recreate_rebuild_link).then(()=>{h.reload()},()=>void 0)},e.canShowFilterSelection=function(e){return void 0!==e.info_link},e.isLoadingFilters=function(e){return y===e},e.toggleResultRule=async function(t){let i=e.form_entry.past_result_rules.find(e=>e.id===t);void 0===i&&void 0===(i=e.form_entry.future_result_rules.find(e=>e.id===t))&&(i=e.form_entry.system_future_result_rules.find(e=>e.id===t));const n=!0===i.enabled?i.disable_rule_link:i.enable_rule_link;try{return await o.restFormService.post(n,i),!0}catch(e){return!1}},e.initResultRuleTables=(()=>{!function(i,n,s){i.forEach((i,o)=>{const r=new c.Event;r.subscribe(()=>{e.$$phase||e.$apply()});const g=new c.Event,u={onChange:r,onRedraw:g},p=new a.ListPaginator(i.data,u,void 0,20);n.push(p),m(()=>{const e=s+o+" #pagination-"+o,i=t.find(e)[0];v.addCleanupFunction(()=>d.unmountComponentAtNode(i)),d.render(l.createElement(a.ListPaginationComponent,{paginator:p}),i)})})}(e.resultRuleTables,e.resultRulesPaginators,"#rr-table-wrapper-")}),e.form_entry=p.form_entry,e.resultRuleTables=[],e.resultRulesPaginators=[],e.hasFutureResultRules()&&e.resultRuleTables.push({title:g.contextData.getMessage("_449842"),data:e.form_entry.future_result_rules,sortable:!0,sortableOptions:function(e){return{stop:(t,i)=>{const n=i.item.index(),r=routes.controllers.tw.TWRestForm.post("project",s.tw.project_id,"results_rules","move","","settings").url,a={rule_to_move:e[n],new_index:n};o.restFormService.post(r,a)}}}(e.form_entry.future_result_rules)}),e.hasPastResultRules()&&e.resultRuleTables.push({title:g.contextData.getMessage("_845122"),data:e.form_entry.past_result_rules,sortable:!1}),e.hasSystemFutureResultRules()&&e.resultRuleTables.push({title:g.contextData.getMessage("_1449843"),data:e.form_entry.system_future_result_rules,sortable:!1});const v=new u.CancellationToken;e.$on("$destroy",()=>{v.cancel()})}Object.defineProperty(t,"__esModule",{value:!0}),p.$inject=["$scope","$element","$window","$rootScope","$timeout","bubbleDialogService","configurationService"],t.default=p}),define("controllers/rest_form/saml/saml_settings",["require","exports","services/rest_form_service"],function(e,t,i){function n(e,t){e.form_entry=t.form_entry,e.form_entry.saml_debug||(e.form_entry.saml_debug={}),e.submitSamlDebug=function(){const t={saml_response:e.form_entry.saml_debug.content||"",debug:""};i.restFormService.postRForm("saml_settings","info",t).then(function(t){e.form_entry.saml_debug.response=t.debug||""},function(t){e.form_entry.saml_debug.response=t.debug||"Server Error"})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.$inject=["$scope","$window"],t.samlSettingsController=n}),define("controllers/rest_form/sentiment/sentiment_settings",["require","exports","angular","services/rest_form_service","angular_utilities","classes/context_data/context_data","services/tw_routing","services/confirmation_service"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});let c=class{constructor(e,t,i){this.$scope=e,this.$window=t,this.restFormService=i,this.saveSettingsCallback=this.saveSettings.bind(this),this.init()}confirmTopicBasedToggling(){return a.confirmationService.display({message:o.contextData.getMessage("_810647")})}hasToConfirmTopicBasedSentimentOff(){return!0===this.initialTopicBasedSentiment}isTopicBasedSentimentEnabled(){return o.contextData.rules.isTopicBasedSentimentEnabled()}init(){this.form_entry=this.$window.form_entry,this.payload={query:this.form_entry.custom_search_query},this.initialTopicBasedSentiment=this.form_entry.topic_based_sentiment,this.initSaveSettingsButton()}initSaveSettingsButton(){this.progressOptions={action:constants.events.form.action.post,text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337"),isDisabled:()=>this.isSaveSettingsButtonDisabled()}}isSaveLinkUndefined(){return void 0===this.form_entry.save_link}isTopicBasedSentiment(){return this.form_entry.topic_based_sentiment}isTopicBasedSentimentQueryValid(){return!this.isTopicBasedSentiment()||this.isTopicBasedSentiment()&&this.isQueryValid()}isSaveSettingsButtonDisabled(){return this.isSaveLinkUndefined()||!this.isTopicBasedSentimentQueryValid()}hasTopicBaseSentimentChangedToOn(){return!this.initialTopicBasedSentiment&&this.isTopicBasedSentiment()}saveSettings(){this.hasTopicBaseSentimentChangedToOn()||this.payload.query!==this.form_entry.custom_search_query?a.confirmationService.display({message:o.contextData.getMessage("_1891035")}).then(()=>{this.handleSaveRequest()},()=>void 0):this.handleSaveRequest()}handleSaveRequest(){this.form_entry.custom_search_query=this.payload.query,this.restFormService.post(this.form_entry.save_link,this.form_entry).then(e=>{r.twRoutingService.reloadPageAndContext()},e=>{this.form_entry.field_messages=e.field_messages})}isQueryValid(){return void 0!==this.payload.query&&this.payload.query.length>0}};c=__decorate([s.ngInject(["$scope","$window","restFormService"]),__metadata("design:paramtypes",[Object,Object,n.default])],c),t.default=c}),define("controllers/rest_form/shared/share",["require","exports","services/confirmation_service","underscore","moment-timezone"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$rootScope","twRoutingService","$window","restFormService","Calendar",function(e,t,n,s,o,r){e.form_entry=s.form_entry,e.showDateCalendar=!1,function(){const t=$("body").find('div[id="date-calendar"]'),i=s.moment(e.form_entry.valid_until).format("YYYY-MM-DD");e.dateCalendar=new r(t,{months:2,mode:"single",viewStartDate:i,selected:[i],useYearNav:!1,format:"YYYY-MM-DD"}),e.dateCalendar.subscribe("change",function(){e.changeDate()})}(),function(){if(0!==e.valid_until){const t=s.moment(e.form_entry.valid_until);e.validDate=t.format(e.form_entry.date_format)}else e.validDate="-"}(),e.progressOptions={action:s.constants.events.form.action.post,text:s.messages.get("_612374"),textCalling:s.messages.get("_911337"),keepProgress:!0},s&&s.context_data&&s.context_data.projectSettings&&s.context_data.projectSettings.branding&&s.context_data.projectSettings.branding.contact_email?e.support_email=s.context_data.projectSettings.branding.contact_email:s&&s.context_data&&s.context_data.userSettings&&s.context_data.userSettings.email?e.support_email=s.context_data.userSettings.email:e.support_email="support@talkwalker.com",e.redirect=function(e){n.changePageByUrl(e)},e.cancelEmbedded=function(){t.redirect(e.form_entry.root_link)};e.toggleDateCalendar=function(t){e.showDateCalendar=void 0!==t?t:!e.showDateCalendar},e.changeDate=function(){const t=_.first(e.dateCalendar.getSelectedAsText()),i=s.moment(t);e.form_entry.valid_until=i.toDate().getTime(),e.validDate=i.format(e.form_entry.date_format)},e.save=function(){o.post(e.form_entry.save_link,e.form_entry).then(function(t){e.form_entry=t,s.location=t.root_link},function(e){})},e.cancel=function(){e.toggleDateCalendar(!1)},e.remove=function(t,n){n.preventDefault(),i.confirmationService.display({message:e.form_entry.confirm_question}).then(function(){!function(t){o.deleter(t.delete_link).then(function(e){s.location=e.root_link},function(t){e.form_entry.form_fields=t.form_fields})}(t)},function(){})},e.isHootsuite=function(){return e.form_entry.output_type===s.constants.output_type.hootsuite_stream},e.$on("$destroy",function(){e.dateCalendar.dispose()})}]}),define("controllers/rest_form/shared/shares",["require","exports","underscore","moment-timezone","services/confirmation_service"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","$rootScope","twRoutingService",function(e,t,o,r,a){e.form_entry=t.form_entry,e.has_deleted_widgets=!1;e.redirect=function(e){r.redirect(e)},e.remove=function(t,i){i.preventDefault(),s.confirmationService.display({message:e.form_entry.confirm_question}).then(function(){!function(t){o.deleter(t.delete_link).then(function(i){t.deleted=i.deleted,i.deleted&&(e.has_deleted_widgets=!0)},function(t){e.form_entry.form_fields=t.form_fields})}(t)},function(){})},e.restoreEmbededWidget=function(t,i){i.stopPropagation(),i.preventDefault(),o.get(t.restore_link).then(function(i){t.deleted=i.deleted,e.hasDeletedWidgets()||(e.form_entry.deleted_mode=!1)})},e.formatDate=function(e,t){return n(t).format(e.date_format)},e.hasDeletedWidgets=function(){return e.has_deleted_widgets=i.some(e.form_entry.view_forms,function(e){return!0===e.deleted}),e.has_deleted_widgets||e.setDeletedMode(!1),e.has_deleted_widgets},e.setDeletedMode=function(t){e.form_entry.deleted_mode=t,a.search(!1===t?void 0:"deleted")},e.refresh=function(e){event.preventDefault(),e.refreshingEntry=!0,o.get(e.refresh_link).then(function(t){delete e.refreshingEntry})},e.hasDeletedWidgets(),e.form_entry.deleted_mode="deleted"===a.getSearchParameters()}]}),define("controllers/rest_form/shared/entities/edit/account_governance",["require","exports","services/loading_bubble","services/rest_form_service","classes/context_data/context_data","pagination","react-dom","react","event","services/bubble_dialog","services/configuration","notifications","reusable_utilities"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});const p="NO_PROJECT_SELECTED";function h(e,t,h,m){e.changeEntityType=async function(e){if(e)try{await b(e.mapped_id,e.name)}catch(e){}},e.changeProject=function(t){t&&(t.mapped_id===p?e.currentProjectId=void 0:e.currentProjectId=t.mapped_id,S(),e.$apply())},e.changeFilter=function(){S()},e.editSharing=function(t){i.loadingBubbleService.showSpinner();const n=e.form_entry.entities.find(e=>e.id===t.entityId);n.id;n&&(e.editedEntity=n,e.editProjectsMenu=n.projects_to_which_it_has_been_shared,e.editMode=!0);h(()=>{i.loadingBubbleService.hideSpinner()})},e.editEntity=async function(t){i.loadingBubbleService.showSpinner();try{const o=e.form_entry.entities.find(e=>e.id===t.entityId);let r=void 0;switch(o.type_code){case"st":r="topic";break;case"ft":r="filter";break;default:return}const a=await n.restFormService.get(routes.controllers.tw.TWRestForm.get("project",t.masterProjectId,r,"edit",`${t.entityId}|${o.category_id}`,"rform").url),c=constants.bubble_dialog.id.edit_topic,g={projectId:t.masterProjectId,topicId:t.entityId,topicName:t.entityName,topic:a,messages:{convertTooltip:s.contextData.getMessage("_841653"),description:s.contextData.getMessage("_975358"),queryLabel:s.contextData.getMessage("_964210"),queryHelp:s.contextData.getMessage("_657300"),queryAcademyLabel:s.contextData.getMessage("_484746"),noQueryAdded:s.contextData.getMessage("_451854"),label:s.contextData.getMessage("_827560"),labelHelp:s.contextData.getMessage("_951386"),labelRequired:s.contextData.getMessage("_694677"),groupHelp:s.contextData.getMessage("_553890"),groupLabel:s.contextData.getMessage("_699700"),excludedQueriesHelp:s.contextData.getMessage("_774458")}},u=l.bubbleDialogService.createByType(c,$("body"),c,g,d.configurationService.getBubbleDialogConfiguration().getStyle(c));u.onDestroy.subscribeOnce(t=>{b(e.currentEntityTypeId,e.currentEntityTypeName)})}catch(e){}finally{i.loadingBubbleService.hideSpinner()}},e.exportEntity=async function(e){try{const t=await n.restFormService.get(e.export_link);if(t&&t.export_message)g.notificationService.success(t.export_message,{permanent:!0});else if(t&&t.import_export_links&&t.import_export_links.link_exported_file){const e=`<a href="${t.import_export_links.link_exported_file}" target="_blank">${s.contextData.getMessage("_154796")}</a>`,i=s.contextData.getMessage("_487035",[e]);g.notificationService.success(i,{permanent:!0})}}catch(e){}},e.hasExportAction=function(e){return!(void 0===e.export_link||""===e.export_link)},e.cancelSharingEdit=function(){e.editMode=!1,e.editedEntity=void 0,e.editProjectsMenu=void 0,S()},e.saveSharingEdit=async function(){e.saving=!0,i.loadingBubbleService.showSpinner();try{const t={entities:{groups:[{entities_by_id:{[e.editedEntity.id]:{id:e.editedEntity.id,projects_menu:e.editProjectsMenu,type_code:e.editedEntity.type_code}},type_code:e.editedEntity.type_code}]}};await n.restFormService.post(e.editedEntity.update_link,t),e.editMode=!1,w(),S(),e.$apply()}catch(e){}finally{i.loadingBubbleService.hideSpinner(),e.saving=!1}},e.hasEditAction=function(t){const i=e.form_entry.entities.find(e=>e.id===t.entityId);if(i)switch(i.type_code){case"st":case"ft":return!0;default:return!1}return!1},function(){e.form_entry=t.form_entry,e.saving=!1,e.editMode=!1,e.tableModel=void 0,e.filterValue=void 0;const i=e.form_entry.entity_types.root_entry.children.find(e=>"NODE"===e.selected);e.currentEntityTypeId=i.mapped_id,e.currentEntityTypeName=i.name,e.currentEntityType=i.type,e.cancellationToken=new u.CancellationToken,e.$on("$destroy",()=>{e.cancellationToken.cancel()}),v(),e.progressButtonsOptions={text:s.contextData.getMessage("_612374"),textCalling:s.contextData.getMessage("_911337"),action:constants.events.form.action.post,isDisabled:()=>!0===e.saving},w()}();const _=new c.Event;_.subscribe(()=>{e.$$phase||e.$apply()});const f=new c.Event,y={onChange:_,onRedraw:f};function v(){e.projectsMenu={root_entry:{children:[{name:s.contextData.getMessage("_1996390"),mapped_id:p,selected:"NODE"},...e.form_entry.account_projects_menu.root_entry.children]}}}function S(){e.listPaginator.pageNum=1,f.fire()}async function b(t,i){e.form_entry=await n.restFormService.getRForm("account_governance","show",t),e.editMode=!1,e.currentEntityTypeId=t,e.currentEntityTypeName=i,w(),v(),e.listPaginator.replaceModels(e.tableModel),S(),e.$apply()}function w(){e.tableModel?e.tableModel.length=0:e.tableModel=[],e.form_entry.entities.forEach(t=>{const i=[`${t.project_membership.root_entry.name} (${s.contextData.getMessage("_875456")})`],n=[t.project_membership.root_entry.mapped_id];t.projects_to_which_it_has_been_shared.root_entry.children.filter(e=>"NODE"===e.selected).forEach(e=>{i.push(e.name),n.push(e.mapped_id)}),e.tableModel.push({entityName:t.title,projectNames:i.join(", "),projectIds:n,entityId:t.id,masterProjectId:t.project_membership.root_entry.mapped_id,export_link:t.export_link})})}e.listPaginator=new o.ListPaginator(e.tableModel,y,function(t,i,n){if(e.currentProjectId&&-1===t.projectIds.indexOf(e.currentProjectId))return!1;if(e.currentFilter)return t.entityName.toLowerCase().includes(e.currentFilter.toLowerCase());return!0}),h(()=>{r.render(a.createElement(o.ListPaginationComponent,{paginator:e.listPaginator}),$("#pagination")[0]),e.cancellationToken.addCleanupFunction(()=>r.unmountComponentAtNode($("#pagination")[0]))},0)}h.$inject=["$scope","$window","$timeout","$rootScope"],t.default=h}),define("controllers/rest_form/shared/entities/edit/shared_entities",["require","exports","underscore","reusable_utilities","components/form/common/topic_menu","services/loading_bubble","services/rest_form_service","services/shared_entities","wrappers/topic_menu/topic_menu_wrapper","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l){function d(e,t,d){function g(t){o.loadingBubbleService.hideSpinner(),e.saving=!1,e.editModes[t.type_code]=!1,e.editMode=!1,e.entitiesMenuSelectable=!0,e.projectsMenu=void 0}function u(t){return()=>{!function(t,i){void 0!==i&&i.preventDefault();e.editModes[t.type_code]=!1,e.editMode=!1,e.entitiesMenuSelectable=!0,e.projectsMenu=void 0}(t)}}function p(t){r.restFormService.get(`${e.form_entry.project_sharings_link}/${t.mapped_id}`).then(t=>{e.entitiesForm=t,e.editMode=!1,e.entitiesMenuSelectable=!0,e.entityMenus={},e.overviewTable={},e.progressButtonsOptions={},e.collapseStates={},e.editModes={},e.saveGroupHandlers={},e.cancelGroupHandlers={},i(e.entitiesForm.entities.groups).each((t,i)=>{void 0!==t.entities_menu&&(e.entityMenus[t.type_code]=new c.TopicMenuWrapper(t.entities_menu),h(t),function(t){e.progressButtonsOptions[t.type_code]={text:l.contextData.getMessage("_612374"),textCalling:l.contextData.getMessage("_911337"),action:constants.events.form.action.post,isDisabled:()=>!0===e.saving}}(t),e.saveGroupHandlers[t.type_code]=function(t){return()=>{e.saving=!0,o.loadingBubbleService.showSpinner(),r.restFormService.post(e.entitiesForm.update_sharings_link,{entities:{groups:[t]}}).then(()=>{h(t),g(t)},()=>{g(t)})}}(t),e.cancelGroupHandlers[t.type_code]=u(t)),e.collapseStates[t.type_code]=e.form_entry.type_code!==t.type_code,e.editModes[t.type_code]=!1}),e.singleSelectPlaceholders={},e.singleSelectPlaceholders[constants.shareable_entities.type.st]=l.contextData.getMessage("_1611566"),e.singleSelectPlaceholders[constants.shareable_entities.type.ft]=l.contextData.getMessage("_1841628"),e.singleSelectPlaceholders[constants.shareable_entities.type.tp]=l.contextData.getMessage("_1841423"),e.singleSelectPlaceholders[constants.shareable_entities.type.sp]=l.contextData.getMessage("_1458203"),e.singleSelectPlaceholders[constants.shareable_entities.type.ev]=l.contextData.getMessage("_1476528"),e.noSharedEntitiesMsgs={},e.noSharedEntitiesMsgs[constants.shareable_entities.type.st]=l.contextData.getMessage("_1841456"),e.noSharedEntitiesMsgs[constants.shareable_entities.type.ft]=l.contextData.getMessage("_1255883"),e.noSharedEntitiesMsgs[constants.shareable_entities.type.tp]=l.contextData.getMessage("_1256943"),e.noSharedEntitiesMsgs[constants.shareable_entities.type.sp]=l.contextData.getMessage("_1711529"),e.noSharedEntitiesMsgs[constants.shareable_entities.type.ev]=l.contextData.getMessage("_1414585"),e.noSharedEntitiesMsgs[constants.shareable_entities.type.mg]=l.contextData.getMessage("_1663809")})}function h(t){const s=[];i(e.entityMenus[t.type_code].getAllLeavesRecursively()).each(e=>{const o=t.entities_by_id[e.getMappedId()];if(void 0!==o&&void 0!==o.projects_menu){const e=o.projects_menu,t=n.TopicEntryUtils.getSelectedChildren(e.root_entry);let r="";if(t.length>0){i.each(t,(e,i)=>{r+=e.name,i<t.length-1&&(r+=", ")});const e={entityName:o.title,projectNames:r,entityId:o.id};s.push(e)}}}),e.overviewTable[t.type_code]=s}e.toggleCollapseState=function(t){e.editModes[t.type_code]||(e.collapseStates[t.type_code]=!e.collapseStates[t.type_code])},e.editGroup=function(t,i){i.preventDefault(),e.editModes[t.type_code]=!0,e.collapseStates[t.type_code]=!1,e.editMode=!0},e.showAddEntitiesForm=function(e,t){t.preventDefault(),d.redirect(e.show_group_entities_link)},e.editEntity=function(t,i,s){s.preventDefault();const o=i.entities_menu;n.TopicEntryUtils.recursiveUnselectAndSelect(o.root_entry,t,!1),e.entitiesMenuSelectable=!1,e.editModes[i.type_code]=!0,e.collapseStates[i.type_code]=!1,e.editMode=!0,e.projectsMenu=i.entities_by_id[t].projects_menu},e.deleteEntity=function(t,n,s){s.preventDefault();const o=n.entities_by_id[t.entityId];r.restFormService.deleter(o.unshare_link).then(()=>{const s=e.overviewTable[n.type_code];s.splice(i.indexOf(s,t),1)})},e.loadEntities=p,e.getProjectPlaceholder=function(){return l.contextData.getMessage("_1841453")},e.getProjectsMenuId=function(e){return"projects-"+e.type_code},e.getGroupListLabel=function(e){return a.sharedEntitiesService.getGroupListLabel(e)},e.canShowGroup=function(t){return!e.editMode||e.editMode&&e.editModes[t.type_code]},e.isEntitiesSelectable=function(){return e.entitiesMenuSelectable},e.canSyncGroups=function(){return!l.contextData.rules.isOriginalUserEnabled()&&void 0!==e.entitiesForm.sync_sharings_link},e.syncGroup=function(e,t){t.preventDefault(),m(e)},function(){e.form_entry=t.form_entry,e.saving=!1,e.editMode=!1,e.entitiesMenuSelectable=!0;const i=void 0===e.form_entry.account_projects_menu?null:s.getFirstSelectedEntry(e.form_entry.account_projects_menu.root_entry);null!==i&&p(i)}();const m=i.throttle(t=>{r.restFormService.post(e.entitiesForm.sync_sharings_link,{type_code:t.type_code})},2500)}Object.defineProperty(t,"__esModule",{value:!0}),d.$inject=["$scope","$window","$rootScope"],t.default=d}),define("controllers/rest_form/sign_up/sign_up",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","loadingBubbleService",function(e,t,n){n.hideSpinner(),e.sign_up_action=constants.events.form.action.post,e.getPage=function(){return e.form_entry.current_page},e.isSearchSignup=function(){return t.form_entry.talkwalker_project_type===constants.project_type.search},e.columnOne=function(t){const n=e.form_entry.demo_projects,s=n.length;return i.indexOf(n,t)+1<=Math.round(s/2)},e.columnTwo=function(t){const n=e.form_entry.demo_projects,s=n.length,o=i.indexOf(n,t);return o+1>Math.round(s/2)&&o+1<=Math.round(s)},e.switchFormEntry=function(t){e.form_entry=t},e.form_entry=t.form_entry}]}),define("controllers/rest_form/socialmedia_token/socialmedia_token",["require","exports","angular","angular_utilities","services/context","services/loading_bubble"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$window=i,this.initialize()}initialize(){this.formEntry=this.$window.form_entry,this.projectId=s.contextService.getCurrentContext().id,window.socialMediaAccountCallBack=(()=>{const e=decodeURIComponent(window.location.href).split("#url=");e.length>1?window.location.href=e[0]:window.location.reload()}),o.loadingBubbleService.hideSpinner()}};r=__decorate([n.ngInject(["$scope","$element","$window"]),__metadata("design:paramtypes",[Object,Object,Object])],r),t.default=r}),define("forms/suggestions/model",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.Suggestion=class{constructor(e,t,i,n=0,s){this.label=e,this.value=t,this.type=i,this.score=n,this.description=s}}}),define("forms/suggestion_provider_factory",["require","exports","angular","lazy"],function(e,t,i,n){function s(e){return class{constructor(e,t=[],n=[]){if(this.fetchFunction=e,this.predicates=t,this.postProcessors=n,!i.isFunction(this.fetchFunction))throw new Error('"fetchFunction" must be a function')}getSuggestionsPromise(t){return this.checkPredicates(t)?n(this.postProcessors).reduce(function(e,i){return e.then(e=>i(e,t))},this.fetchFunction(t)):e.when([])}checkPredicates(e){return n(this.predicates).map(t=>!0===t(e)).every(e=>!0===e)}}}Object.defineProperty(t,"__esModule",{value:!0}),s.$inject=["$q"],t.default=s,t.SuggestionProviderFactory=s}),define("forms/async_provider_helper",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.$http=e,this.SuggestionProviderFactory=t}createProvider(e,t,n,s){return s.location=s.location||"UNKNOWN",new this.SuggestionProviderFactory(this.getFetcher(e,n,s),[i.getContextChecker(e)],[i.checkStatusCode,t])}static getContextChecker(e){return t=>t.context.property===e&&(t.context.comesAfterColon||t.context.isColon)}static checkStatusCode(e){return void 0!==e.data?e.data.suggestions:void 0}getFetcher(e,t,i){return n=>{const s={method:"POST",url:t,data:{text:n.wordSoFar,keyword:e,context:i}};return this.$http(s).catch(()=>{throw new Error("Could not setup static code suggestions")})}}}i.$inject=["$http","SuggestionProviderFactory"],t.AsyncSuggestionHelper=i,t.default=i}),define("forms/suggestions/suggestion_source",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id,e.entry_type,t)}}n.LABEL="SOURCE",t.SourceSuggestion=n}),define("forms/suggestions/suggestion_authorcountry",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id+" ","value",e.score)}}n.LABEL="authorcountry",t.AuthorcountrySuggestion=n}),define("forms/suggestions/suggestion_demographic",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id+" ","value",e.score)}}n.LABEL="demographic",t.DemographicSuggestion=n}),define("forms/suggestions/suggestion_image",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n,s,o){super(e,t,i,n,s),this.image=o}static parseRawDatum(e,t){return new n(e.name,`${e.id} `,e.type.code,t,`${e.name}`,e.url)}}n.LABEL="image",t.ImageSuggestion=n}),define("forms/suggestions/suggestion_lang",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id+" ","value",e.score)}}n.LABEL="lang",t.LangSuggestion=n}),define("forms/suggestions/suggestion_sourcegeo",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n,s){super(e,t,i,n),this.mapCoords=s}static parseRawDatum(e,t){return new n(e.name,e.id+" ",e.resolution.toLowerCase(),t,{lat:e.latitude,lng:e.longitude})}}n.LABEL="sourcegeo",t.SourceGeoSuggestion=n}),define("forms/suggestions/suggestion_sourcecountry",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id+" ","value",e.score)}}n.LABEL="sourcecountry",t.SourcecountrySuggestion=n}),define("forms/suggestions/suggestion_sourcetype",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.id+" ","value",e.score)}}n.LABEL="sourcetype",t.SourcetypeSuggestion=n}),define("forms/suggestions/suggestion_static",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.StaticSuggestion=class extends i.Suggestion{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s),this.example=o,this.docLink=r}}}),define("forms/suggestions/suggestion_tag",["require","exports","forms/suggestions/model"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Suggestion{constructor(e,t,i,n){super(e,t,i,n)}static parseRawDatum(e,t){return new n(e.name,e.name+" ","tag",t)}}n.LABEL="tag",t.TagSuggestion=n}),define("forms/suggestions/main",["require","exports","forms/suggestions/suggestion_source","forms/suggestions/suggestion_authorcountry","forms/suggestions/suggestion_demographic","forms/suggestions/suggestion_image","forms/suggestions/suggestion_lang","forms/suggestions/suggestion_sourcegeo","forms/suggestions/suggestion_sourcecountry","forms/suggestions/suggestion_sourcetype","forms/suggestions/suggestion_static","forms/suggestions/model","forms/suggestions/suggestion_tag"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.SourceSuggestion=i.SourceSuggestion,t.AuthorcountrySuggestion=n.AuthorcountrySuggestion,t.DemographicSuggestion=s.DemographicSuggestion,t.ImageSuggestion=o.ImageSuggestion,t.LangSuggestion=r.LangSuggestion,t.SourceGeoSuggestion=a.SourceGeoSuggestion,t.SourcecountrySuggestion=c.SourcecountrySuggestion,t.SourcetypeSuggestion=l.SourcetypeSuggestion,t.StaticSuggestion=d.StaticSuggestion,t.Suggestion=g.Suggestion,t.TagSuggestion=u.TagSuggestion}),define("forms/suggestions_code",["require","exports","angular","fuzzy","lazy","forms/suggestions/main","classes/context_data/context_data","services/application_mode"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c="__providers",l=Object.freeze({pre:'<span class="match-highlight">',post:"</span>"});function d(e,t,d,u){return function p(h,m={}){if(!(this instanceof p))throw new Error('"CodeSuggestions" must be instatiated with the "new" keyword');if(m.location=m.location||"UNKNOWN",a.applicationMode.getAppModeModelForCurrentMode().public)return;const _=this,f=routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,"query_editor","info","","rform").url;function y(t){if(r.contextData.userSettings.autocomplete){const i=_[c].map(function(e){return e.getSuggestionsPromise(t)});return e.all(i).then(e=>e.reduce((e,t)=>[...e,...t],[]).sort((e,t)=>e.score>t.score?1:-1))}return e.when([])}function v(t){const i=t.doc_link;function r(e,t){return s(t).map(function(t){return new o.StaticSuggestion(t.highlightedLabel,t.snippet,e,-t.score,t.description,t.example,i)}).toArray()}function a(e,t){const i=t.wordSoFar.replace(/^[+/():\s]*/,"");return s(e).map(function(e){const t=n.match(i,e.label,l);return null===t?e.isAMatch=!1:(e.isAMatch=!0,e.highlightedLabel=t.rendered,e.score=t.score),e}).toArray()}function g(e){return s(e).filter(e=>!0===e.isAMatch).toArray()}_[c]=[..._[c],...function(){return s(t.fields).pairs().map(function([t,n]){return new d(()=>e.when(n),[i],[a,g,r.bind(void 0,t)])}).toArray();function i(e){const t=e.wordSoFar.replace(/^[+-/()\s]*/,"");return""!==t&&!e.context.isColon&&!e.context.comesAfterColon}}(),...function(){return s(t.replacements).pairs().map(function([t,n]){return new d(()=>e.when(n),[i,function(e){return t===e.context.property}],[a,g,r.bind(void 0,t)])}).toArray();function i(e){return e.context.isColon||e.context.comesAfterColon}}()]}_.getSuggestions=y,_[c]=[{label:"authorcountry",postProcessor:o.AuthorcountrySuggestion.parseRawDatum},{label:"image",postProcessor:o.ImageSuggestion.parseRawDatum},{label:"demographic",postProcessor:o.DemographicSuggestion.parseRawDatum},{label:"lang",postProcessor:o.LangSuggestion.parseRawDatum},{label:"sourcecountry",postProcessor:o.SourcecountrySuggestion.parseRawDatum},{label:"sourcegeo",postProcessor:o.SourceGeoSuggestion.parseRawDatum},{label:"sourcetype",postProcessor:o.SourcetypeSuggestion.parseRawDatum},{label:"tag",postProcessor:o.TagSuggestion.parseRawDatum}].map(e=>t.createProvider(e.label,g(e.postProcessor),h,m)),u.post(f,{context:{location:m.location}}).then(e=>i.fromJson(e.keywords)).then(v).catch(()=>{throw new Error("Could not setup static code suggestions")})}}function g(e){return t=>s(t).map(e).toArray()}d.$inject=["$q","AsyncSuggestionHelper","SuggestionProviderFactory","restFormService"],t.default=d,t.processAsyncResponse=g}),define("controllers/rest_form/source_panels/source_panel",["require","exports","underscore","classes/context_data/context_data","services/confirmation_service","services/modal","services/context","reusable_utilities"],function(e,t,i,n,s,o,r,a){function c(e,t,c,l){e.add_multiple_action=constants.events.form.action.add_multiple,e.add_one_action=constants.events.form.action.add_one,e.update_action=constants.events.form.action.update,e.pagingsByKey={},e.singleInputs={},e.progressOptions={action:constants.events.form.action.post,text:n.contextData.getMessage("_612374"),textCalling:n.contextData.getMessage("_911337"),keepProgress:!0},e.groupCreationEntry={name:n.contextData.getMessage("_1194037"),params:{}};e.$on("suggestionInserted",function(t,i){const{suggestion:n,context:s}=i,o=e.form_entry.sources_panels_entries[s.location].link_multiple_source_panel,r={source_panel_entries:[{author:!1,exact_match:!0,mapped_id:n.value,name:n.label,source_id:n.value}]};l.post(o,r,e.add_multiple_action).then(function(t){e.form_entry.sources_panels_entries[s.location].source_panel_entries=[...e.form_entry.sources_panels_entries[s.location].source_panel_entries,...t.source_panel_entries],e.singleInputs[s.location]=void 0},function(t){e.form_entry.field_messages=t.field_messages,e.singleInputs[s.location]=void 0})}),e.cancel=(()=>{t.redirect(e.form_entry.root_link_back)}),e.shouldDisplaySpecificSuggestionBox=(()=>n.contextData.rules.isSourcePanelSuggestionEnabled()),e.save=(()=>{l.post(e.form_entry.save_link,e.form_entry).then(function(i){t.redirect(e.form_entry.root_link_back)},function(t){e.form_entry.field_messages=t.field_messages})}),e.exportInFile=(()=>{l.get(e.form_entry.import_export_links.link_export).then(function(t){e.form_entry.import_export_links.link_exported_file=t.import_export_links.link_exported_file},function(t){e.form_entry.field_messages=t.field_messages})}),e.importFile=(()=>{l.postMultipart(e.form_entry.import_export_links.link_import,e.form_entry).then(function(t){e.form_entry=t},function(t){e.form_entry.field_messages=t.field_messages})}),e.getUrl=(e=>{if("facebook.com"===e.url)return"http://www.facebook.com/"+e.mapped_id.split(":")[1];if(!i.isUndefined(e.url)&&e.url.length>0){let t=e.url;return t.startsWith("http")||(t="http://"+t),t}return"#"}),e.validateUrlClick=((t,i)=>{"#"===e.getUrl(t)&&i.preventDefault()}),e.validateTargetAttr=(t=>"#"!==e.getUrl(t)?"_blank":void 0),e.isExactMatchApplicable=(t=>e.isUrlEntry(t)),e.isUrlEntry=(e=>e.entry_type===constants.source_panel_entry_type.url),e.isSourceEntry=(e=>e.entry_type===constants.source_panel_entry_type.source),e.isAuthorEntry=(e=>e.entry_type===constants.source_panel_entry_type.author),e.removeEntry=((t,n)=>{s.confirmationService.display({message:e.form_entry.confirm_question}).then(()=>((t,n)=>{const s=e.form_entry.sources_panels_entries[t].source_panel_entries;l.deleter(n.link_remove_source).then(function(o){e.form_entry.sources_panels_entries[t].source_panel_entries=i(s).without(i(s).findWhere({mapped_id:n.mapped_id}))},function(t){e.form_entry.field_messages=t.field_messages})})(t,n),()=>void 0)}),e.edited_element=void 0,e.enterEditMode=((t,i)=>{e.exitEditMode(t,i),i.edit_mode=JSON.parse(JSON.stringify(i)),e.edited_element=i}),e.exitEditMode=((t,i)=>{e.edited_element&&(delete e.edited_element.edit_mode,delete e.edited_element)}),e.updateEntry=((t,i)=>{e.updateOnServer(t,i.edit_mode,n=>{Object.keys(n).forEach(e=>{i[e]=n[e]}),e.exitEditMode(t,i)})}),e.updateOnServer=((t,i,n)=>{e.form_entry.sources_panels_entries[t].source_panel_entries;l.post(i.link_update_source,i).then(n)}),e.editMode=(t=>{e.edit[t].visible=!e.edit[t].visible}),e.addOneEntry=((t,i)=>{const n=e.form_entry.sources_panels_entries[t].link_source_panel;e.edit[t].new_source_entry.exact_match=!0,l.post(n,e.edit[t].new_source_entry,e.add_one_action).then(function(n){e.form_entry.sources_panels_entries[t].source_panel_entries.push(n),e.edit[t].new_source_entry={},i.$setPristine()},function(t){e.form_entry.field_messages=t.field_messages})}),e.getPaging=(t=>{const n=t.key;return n in e.pagingsByKey||(e.pagingsByKey[n]=new function(){this.current_entry_page=1;const e={oldCurrentPage:this.current_entry_page,dataLength:void 0};this.page_size=10,this.edit_current_page=!1,this.page_count=void 0,this.setDataLength=(t=>{e.dataLength=t,this.page_count=Math.ceil(t/10)}),this.getDataStartIdx=(()=>(this.current_entry_page-1)*this.page_size),this.firstPage=(()=>{this.setCurrentPage(1),this.exitEditMode()}),this.previousPage=(()=>{this.hasPreviousPage()&&(this.setCurrentPage(this.current_entry_page-1),this.exitEditMode())}),this.hasPreviousPage=(()=>this.current_entry_page>1),this.nextPage=(()=>{this.hasNextPage()&&(this.setCurrentPage(this.current_entry_page+1),this.exitEditMode())}),this.hasNextPage=(()=>this.current_entry_page<e.dataLength/this.page_size),this.lastPage=(()=>{this.setCurrentPage(this.page_count),this.exitEditMode()}),this.setCurrentPage=(t=>{this.current_entry_page=t,e.oldCurrentPage=this.current_entry_page}),this.getCurrentPageData=(e=>{const t=+this.getDataStartIdx();return e.slice(t,t+this.page_size)}),this.enterEditMode=(()=>{this.edit_current_page=!0}),this.exitEditMode=(()=>{this.edit_current_page=!1,this.validateCurrentPage(!0)}),this.validateCurrentPage=(t=>{(t||""!==this.current_entry_page)&&(this.current_entry_page=parseInt(this.current_entry_page,10),!this.current_entry_page||!i.isNumber(this.current_entry_page)||this.current_entry_page<1||this.current_entry_page>this.page_count?this.current_entry_page=e.oldCurrentPage:this.setCurrentPage(this.current_entry_page))})}),e.pagingsByKey[n]}),e.getList=(()=>{return i(window.form_entry.sources_panels_entries).map((e,t)=>(window.form_entry.sources_panels_entries[t].key=t,window.form_entry.sources_panels_entries[t]))}),e.addMultipleEntries=((t,n)=>{const s=e.form_entry.sources_panels_entries[t].link_multiple_source_panel,o=e.edit[t].multiple_source.sources.split("\n").map(i=>({url:i,source_id:i,exact_match:e.edit[t].multiple_source.exact_match})),r={};r.source_panel_entries=o,l.post(s,r,e.add_multiple_action).then(function(s){i(s.source_panel_entries).each(i=>{e.form_entry.sources_panels_entries[t].source_panel_entries.push(i)}),e.edit[t].multiple_source.sources="",n.$setPristine()},function(t){e.form_entry.field_messages=t.field_messages})}),e.openGroupCreation=function(t){const i={title:n.contextData.getMessage("_1194037"),fields:[{name:n.contextData.getMessage("_1780684"),required:!0,maxLength:32}]};o.modalService.display("GENERIC_TEXT_INPUT",i).then(t=>{const i=routes.controllers.tw.TWRestForm.post(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"source_panels_group","create","","rform").url;l.post(i,{title:t[0]}).then(t=>{const i={mapped_id:t.group_id,name:t.title};e.form_entry.groups.root_entry.children.push(i),a.TopicEntryUtils.recursiveUnselectAndSelect(e.form_entry.groups.root_entry,i.mapped_id)})},()=>{})},e.changeColor=(t=>{e.form_entry.color=t}),e.changeCustomColor=(t=>{o.modalService.display("TOPIC_CUSTOM_COLOR",t).then(t=>{e.changeColor(t.mapped_id),a.TopicEntryUtils.setSelectionRecursive(e.form_entry.colors_menu.root_entry,!1),a.TopicEntryUtils.setSelection(t,!0)})}),e.social_media_accounts=constants.social_media_accounts,e.form_entry=c.form_entry,e.edit={},i(i.keys(e.form_entry.sources_panels_entries)).each(t=>{e.edit[t]={},e.edit[t].visible=!0,e.edit[t].new_source_entry={},e.edit[t].multiple_source={},e.edit[t].multiple_source.exact_match=!0})}Object.defineProperty(t,"__esModule",{value:!0}),c.$inject=["$scope","$rootScope","$window","restFormService"],t.default=c,t.SourcePanelController=c}),define("controllers/rest_form/source_panels/source_panels",["require","exports","underscore","services/confirmation_service","angular_utilities","services/rest_form_service","services/context","classes/context_data/context_data","services/modal"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});let l=class{constructor(e,t,i){this.$scope=e,this.$window=t,this.$rootScope=i,this.bindedExposeConcealPartnerPanel=this.exposeConcealPartnerPanel.bind(this),this.importAction=constants.events.form.action.importr,this.exportAction=constants.events.form.action.exportr,this.uiSortableConfig={items:"tr:not(.headers):not(.table-section)",connectWith:"tbody",helper:(e,t)=>{const i=t.children(),n=t.clone();return n.children().each((e,t)=>{const n=i.eq(e),s=$(t);s.outerWidth(n.outerWidth(!0)),s.outerHeight(n.outerHeight(!0))}),n}},this.formEntry=t.form_entry,this.initializeSort()}redirect(e){this.$rootScope.redirect(e)}canModifyPartnerPanels(e){return void 0!==e.conceal_link&&void 0!==e.expose_link}canShowGroupActions(e){return void 0!==e.update_link||void 0!==e.delete_link}isDefaultGroup(e){return e.id===constants.source_panel.ungrouped}isPartnerNotTwAccountEnabled(){return a.contextData.rules.isPartnerNotTwAccountEnabled()}canShowGroupHeader(e){return!this.isDefaultGroup(e)}canShowGroupContents(e){return!e.collapsed||this.isDefaultGroup(e)}canShowPanel(e){if(void 0===e)return!1;if(0===e.length)return!1;let t=0;return e.forEach(e=>{e.panels&&e.panels.forEach(e=>t++)}),0!==t}renameGroup(e){const t=this.createRenameGroupPayload(e);c.modalService.display("GENERIC_TEXT_INPUT",t).then(t=>{const i={group_id:e.id,title:t[0]};o.restFormService.post(e.update_link,i).then(()=>e.name=i.title,()=>void 0)},()=>void 0)}dismantleGroup(e){n.confirmationService.display({message:a.contextData.getMessage("_1580684")}).then(()=>{o.restFormService.deleter(e.delete_link).then(()=>this.$rootScope.reload(),()=>void 0)},()=>void 0)}newPanelEntry(e){e.preventDefault(),o.restFormService.get(this.formEntry.link_add).then(e=>{e.redirect_url&&this.$rootScope.redirect(e.redirect_url)},e=>{this.formEntry.field_messages=e.field_messages})}export(){o.restFormService.get(this.formEntry.import_export_links.link_export,constants.events.form.action.exportr).then(e=>{window.location.href=e.import_export_links.link_exported_file},e=>{this.formEntry.field_messages=e.field_messages})}import(){o.restFormService.postMultipart(this.formEntry.import_export_links.link_import,this.formEntry,void 0,constants.events.form.action.importr).then(e=>{this.formEntry=e,this.initializeSort()},e=>{this.formEntry.field_messages=e.field_messages})}removeSourcePanel(e,t,i){i.preventDefault(),n.confirmationService.display({message:this.formEntry.confirm_question}).then(()=>this.deleteFromServer(e,t),()=>void 0),this.deletePanelFromMaps(e)}toggleGroupCollapsed(e){e.collapsed=!e.collapsed}exposeConcealPartnerPanel(e,t){const i=t?e.expose_link:e.conceal_link;o.restFormService.get(i).then(e=>void 0,e=>{this.formEntry.field_messages=e.field_messages})}enablePartnerAccountPanels(){const e=routes.controllers.tw.TWRestForm.get(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"source_panels","enable","","rform").url;o.restFormService.get(e).then(e=>{this.formEntry.partner_panels_enabled=e.partner_panels_enabled,this.formEntry.partner_panels=e.partner_panels,this.formEntry.partner_groups=e.partner_groups},e=>{this.formEntry.field_messages=e.field_messages})}initializeSort(){this.initPanelMappings(),this.sortObject={stop:(e,t)=>{const i=t.item[0].id,n=this.panelsMap[i],s=this.panelToGroupMapping[i],a=$(t.item[0]).parent("tbody"),c=this.formEntry.custom_groups[a.index()-2],l=c.id===s.id||this.isDefaultGroup(c)?t.item.index():t.item.index()-1,d=s.panels,g=c.panels;d.splice(d.indexOf(n),1),g.splice(l,0,n),this.panelToGroupMapping[n.id]=c;const u={id:n.id,name:n.name,old_group_id:s.id,new_group_id:c.id,new_index:l},p=routes.controllers.tw.TWRestForm.get(r.contextService.getCurrentContext().scope,r.contextService.getCurrentContext().id,"source_panel","move","","rform").url;o.restFormService.post(p,u),c!==s&&t.item.remove()}}}initPanelMappings(){this.panelsMap={},this.panelToGroupMapping={},this.formEntry.custom_groups.forEach(e=>{e.panels.forEach(t=>{this.panelsMap[t.id]=t,this.panelToGroupMapping[t.id]=e})})}deleteFromServer(e,t){o.restFormService.deleter(e.link_remove).then(n=>{t.panels=i.without(t.panels,i.find(t.panels,t=>t.id===e.id)),this.deletePanelFromMaps(e)},e=>{this.formEntry.field_messages=e.field_messages})}deletePanelFromMaps(e){delete this.panelsMap[e.id],delete this.panelToGroupMapping[e.id]}createRenameGroupPayload(e){return{title:a.contextData.getMessage("_1806816"),fields:[{name:a.contextData.getMessage("_1780684"),initialValue:e.name,required:!0,maxLength:32}]}}};l=__decorate([s.ngInject(["$scope","$window","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],l),t.default=l}),define("controllers/rest_form/tag_cloud_panels/tag_cloud_panel",["require","exports","underscore","reusable_services","services/confirmation_service"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$rootScope","$window","restFormService",function(e,t,o,r){e.add_multiple_action=constants.events.form.action.add_multiple;e.parseTextForEmoji=function(e){return n.emojiService.parseTextForEmoji(e)},e.cancel=function(){t.redirect(e.form_entry.root_link_back)},e.save=function(){r.post(e.form_entry.save_link,e.form_entry).then(function(i){t.redirect(e.form_entry.root_link_back)},function(t){e.form_entry.field_messages=t.field_messages})},e.exportInFile=function(){r.get(e.form_entry.import_export_links.link_export).then(function(t){e.form_entry.import_export_links.link_exported_file=t.import_export_links.link_exported_file},function(t){e.form_entry.field_messages=t.field_messages})},e.importFile=function(){r.postMultipart(e.form_entry.import_export_links.link_import,e.form_entry).then(function(t){e.form_entry=t},function(t){e.form_entry.field_messages=t.field_messages})},e.removeEntry=function(t,n){s.confirmationService.display({message:e.form_entry.confirm_question}).then(function(){!function(t,n){const s=e.form_entry.tag_cloud_panels_entries[t].tag_cloud_panel_entries;r.deleter(n.link_remove_tag_cloud_entry).then(function(o){e.form_entry.tag_cloud_panels_entries[t].tag_cloud_panel_entries=i.without(s,i.findWhere(s,{id:n.id}))},function(t){e.form_entry.field_messages=t.field_messages})}(t,n)},function(){})},e.addMultipleEntries=function(t,n){const s=e.form_entry.tag_cloud_panels_entries[t].link_multipletag_cloud_entry,o=e.edit[t].multiple_tag_cloud_entries.value,c=[];i.each(o.split("\n"),function(e){if(e){const t={};t.name=e,c.push(t)}});const l={};l.tag_cloud_panel_entries=c,r.post(s,l,e.add_multiple_action).then(function(s){i.each(s.tag_cloud_panel_entries,function(i){e.form_entry.tag_cloud_panels_entries[t].tag_cloud_panel_entries.push(i)}),a(e.form_entry.tag_cloud_panels_entries[t].tag_cloud_panel_entries),e.edit[t].multiple_tag_cloud_entries={},n.$setPristine()},function(e){})};const a=function(e){e&&e.sort(function(e,t){return e.name.toUpperCase()<t.name.toUpperCase()?-1:e.name.toUpperCase()>t.name.toUpperCase()?1:0})};e.form_entry=o.form_entry,e.edit={},i.each(i.keys(e.form_entry.tag_cloud_panels_entries),function(t){e.edit[t]={},e.edit[t].multiple_tag_cloud_entries={},a(e.form_entry.tag_cloud_panels_entries[t].tag_cloud_panel_entries)}),e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0}}]}),define("controllers/rest_form/tag_cloud_panels/tag_cloud_panels",["require","exports","underscore","services/confirmation_service","services/context"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$rootScope","restFormService",function(e,t,o,r){e.import_action=constants.events.form.action.importr,e.export_action=constants.events.form.action.exportr,e.filter={items:"tbody"},e.sort={stop:function(e,t){const i=window.form_entry.custom,n=t.item.index()-2,o=t.item.sortable.index-2,a=i.splice(o,1)[0];i.splice(n,0,a);const c={name:a.name,id:a.id,new_index:n},l=routes.controllers.tw.TWRestForm.get(s.contextService.getCurrentContext().scope,s.contextService.getCurrentContext().id,"theme_cloud","move","","rform").url;r.post(l,c)}};e.redirect=function(e){o.redirect(e)},e.exportInFile=function(){r.get(e.form_entry.import_export_links.link_export,constants.events.form.action.exportr).then(function(e){t.location=e.import_export_links.link_exported_file},function(t){e.form_entry.field_messages=t.field_messages})},e.importFile=function(){r.postMultipart(e.form_entry.import_export_links.link_import,e.form_entry,void 0,constants.events.form.action.importr).then(function(t){e.form_entry=t},function(t){e.form_entry.field_messages=t.field_messages})},e.newPanelEntry=function(t){t.preventDefault(),r.get(e.form_entry.link_add).then(function(e){e.redirect_url&&o.redirect(e.redirect_url)},function(t){e.form_entry.field_messages=t.field_messages})},e.remove=function(t,s){s.preventDefault(),n.confirmationService.display({message:e.form_entry.confirm_question}).then(function(){!function(t){r.deleter(t.link_remove).then(function(n){e.form_entry.custom=i.without(e.form_entry.custom,i.findWhere(e.form_entry.custom,{id:t.id}))},function(t){e.form_entry.field_messages=t.field_messages})}(t)},function(){})},e.form_entry=t.form_entry}]}),define("controllers/rest_form/tags/tags_management",["require","exports","event","log","services/confirmation_service","classes/context_data/context_data","services/tw_common","wrappers/topic_menu/topic_entry_wrapper","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$timeout","restFormService","TopicMenuWrapper","TopicEntryWrapper","logService",function(e,t,l,d){function g(t){e.tags=t,e.tagsMenu=new c.TopicMenuWrapper(e.tags),e.tagsMenu.toProto()}e.tags={},e.show_deleted_tags=void 0,e.buildingForm=!1,e.changedTags=0,e.saveForm=function(){e.isDeletedMode()||d.post(e.form_entry.save_link,e.form_entry).then(function(){},function(t){e.form_entry.field_messages=t.field_messages})},e.canShowTagsForm=function(){const t=e.tagsMenu.getEntriesByMappedId("custom")[0].getChildren().length,i=e.tagsMenu.getEntriesByMappedId("custom")[0].getEntriesRecursively().length-1,n=e.tagsMenu.getEntriesByMappedId("ungrouped")[0].getChildren().length,s=Math.max(0,n-e.changedTags),o=Math.max(0,e.changedTags-n);return s>0||i-o>t},e.displayNoTagsMessage=function(){return e.isDeletedMode()||!e.isDeletedMode()&&e.buildingForm?window.messages.get("_1972186"):window.messages.get("_1468428")},e.isDeletedMode=function(){return!!e.form_entry.show_deleted_tags&&e.show_deleted_tags},e.addGroup=function(t){if(e.form_entry.tag={name:t.getName()},void 0!==t.getName())return e.form_entry.is_group=!0,d.post(e.form_entry.add_link,e.form_entry).then(function(e){return t.setMappedId(e.tag.code),t})},e.removeGroup=function(t){return d.deleter(routes.controllers.tw.TWRestForm.post("project",e.form_entry.project_id,e.form_entry.form,"remove",t.getMappedId(),"rform").url)},e.addEntry=function(t,i){return e.form_entry.tag={name:t.name},i&&(e.form_entry.tag.parent={code:i.getMappedId(),name:i.getName()}),e.form_entry.is_group=!1,d.post(e.form_entry.add_link,e.form_entry).then(function(i){const n=new a.TopicEntryWrapper(t,e.tagsMenu);return n.setMappedId(i.tag.code),n})},e.renameEntry=function(i){void 0!==i&&""!==i.getName()&&void 0!==i.getName()&&(e.form_entry.tag={code:i.getMappedId(),name:i.getName()},d.post(routes.controllers.tw.TWRestForm.post("project",t.tw.project_id,"tag_management","rename","","settings").url,e.form_entry).then(function(e){i.setMappedId(e.tag.code)},function(e){i.setName(e.tag.name)}))},e.restoreEntry=function(t){return e.changedTags++,d.post(routes.controllers.tw.TWRestForm.post("project",e.form_entry.project_id,e.form_entry.form,"restore",t,"rform").url)},e.removeValidate=function(t){return t.isGroup?s.confirmationService.display({message:o.contextData.getMessage("_1957027")}):s.confirmationService.display({message:e.form_entry.confirm_question})},e.removeEntry=function(t,i){return e.changedTags++,d.deleter(routes.controllers.tw.TWRestForm.post("project",e.form_entry.project_id,e.form_entry.form,"remove",t,"rform").url)},e.createEntry=function(t,i){return new a.TopicEntryWrapper(t,e.tagsMenu,i)},e.groupToggleCallback=function(t){t||e.tagsMenu.toProto()},e.modeToggleCallback=function(t){e.form_entry.show_deleted_tags=t,(n.logService.debug("Loading tags...",r.twCommon.logFeatures.SettingsPage,{showDeletedTags:e.form_entry.show_deleted_tags}),d.post(routes.controllers.tw.TWRestForm.post("project",e.form_entry.project_id,e.form_entry.form,"edit","0","rform").url,e.form_entry).then(function(e){return n.logService.debug("Tags loaded!",r.twCommon.logFeatures.SettingsPage,{showDeletedTags:e.show_deleted_tags,tags:e.tags}),g(e.tags),e})).then(function(t){e.show_deleted_tags=t.show_deleted_tags,e.buildingForm=!0,l(function(){e.updateEvent.fire()},0),e.buildingForm=!1,e.changedTags=0})},e.canCreate=function(){return!e.isDeletedMode()},e.form_entry=t.form_entry,e.updateEvent=new i.Event,g(t.form_entry.tags),e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),isDisabled:e.isDeletedMode.bind(e)}}]}),define("controllers/rest_form/token_request/token_request",["require","exports","angular","angular_utilities","components/form/common/topic_menu","services/rest_form_service","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.tokenRequestDirective=function(){return{restrict:"E",scope:{},controllerAs:"vm",templateUrl:r.templateSourceFactory("controllers/rest_form/token_request"),bindToController:{formEntry:"="},controller:a}};let a=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$rootScope=i,this.initialize()}isAnyMailingListSelected(){return void 0!==this.formEntry&&void 0!==this.formEntry.mailing_lists&&s.getSelectedEntries(this.formEntry.mailing_lists.root_entry).length>0}canShowMailingLists(){return void 0!==this.formEntry&&void 0!==this.formEntry.mailing_lists&&void 0!==this.formEntry.mailing_lists.root_entry&&void 0!==this.formEntry.mailing_lists.root_entry.children&&this.formEntry.mailing_lists.root_entry.children.length>0}async send(){this.saving=!0;try{const e=o.restFormService.getRFormUrl("socialmedia_token_request","send");await o.restFormService.post(e,this.formEntry)}catch(e){}finally{this.saving=!1,this.runScopeApply()}}canSave(){return this.isAnySocialMediaSelected()}async generateLink(){this.generating=!0;try{const e=o.restFormService.getRFormUrl("socialmedia_token_request","create");this.formEntry.generated_link=(await o.restFormService.post(e,this.formEntry)).generated_link}catch(e){}finally{this.generating=!1,this.runScopeApply()}}canGenerateLink(){return this.isAnySocialMediaSelected()}copyLink(e){e.target.select(),document.execCommand("copy")}isAnySocialMediaSelected(){return!!(this.formEntry&&this.formEntry.social_media_sites&&this.formEntry.social_media_sites.root_entry)&&s.getSelectedEntries(this.formEntry.social_media_sites.root_entry).length>0}async initialize(){this.saving=!1,this.generating=!1}runScopeApply(){this.$rootScope.$$phase||this.$rootScope.$apply()}};a=__decorate([n.ngInject(["$scope","$element","$rootScope"]),__metadata("design:paramtypes",[Object,Object,Object])],a),t.default=a}),define("controllers/rest_form/topics/topics_categories",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window",function(e,t){e.form_entry=t.form_entry}]}),define("controllers/rest_form/unsubscribe/unsubscribe_user",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","loadingBubbleService",function(e,t,i){e.form_entry=t.form_entry,i.hideSpinner(),e.canShowPoweredBy=function(){return window.context_data.projectSettings.branding.show_powered_by},e.goToLogin=function(){t.location.href=e.form_entry.link_login},e.subscribe=function(){t.location.href=e.form_entry.link_subscribe}}]}),define("controllers/rest_form/users/general_settings",["require","exports","notifications","services/confirmation_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","twRoutingService",function(e,t,s,o){e.form_entry=t.form_entry,e.form_entry.notification&&i.notificationService.display(e.form_entry.notification),e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")};const r=e.form_entry.user_credentials.email;function a(t){s.post(e.form_entry.save_link,t).then(function(t){e.form_entry=t,o.reloadPageAndContext()},function(t){e.form_entry.field_messages=t.field_messages})}e.email_validation_pattern=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,10}$/,e.generalSettingForm=function(){const t=JSON.parse(JSON.stringify(e.form_entry));e.form_entry.user_credentials.email!==r?function(e){n.confirmationService.display({message:{message:window.messages.get("_1951604"),ok:window.messages.get("_697024"),cancel:window.messages.get("_348105")}}).then(function(){e.remove_alert_recipients=!0,a(e)},function(){e.remove_alert_recipients=!1,a(e)})}(t):a(t)}}]}),define("controllers/rest_form/users/login_settings",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService",function(e,t,i){e.loginSettingForm=function(){i.post(e.form_entry.save_link,e.form_entry).then(function(t){e.form_entry=t,e.login_settings_form.$setPristine()},function(t){e.form_entry.field_messages=t.field_messages})},e.form_entry=t.form_entry,e.site_codes_to_connect=e.form_entry.site_codes_to_connect,e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337")}}]}),define("controllers/rest_form/users/user_api_settings",["require","exports","angular","underscore","components/form/common/topic_menu","notifications","services/confirmation_service"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$rootScope","$window","$element","restFormService",function(e,t,a,c,l){e.addNewAccessToken=function(){t.redirect(e.form_entry.root_link_new_accesstoken)},e.getAccessMode=function(e){return s.getSelectedValue(e.root_entry)},e.editAccessToken=function(e){t.redirect(e.root_link_edit)},e.deleteAccessToken=function(t){r.confirmationService.display({message:e.form_entry.confirm_delete}).then(function(){!function(t){l.deleter(t.root_link_delete,t).then(function(t){e.form_entry.access_tokens=n.filter(e.form_entry.access_tokens,function(e){return e.access_token!==t.access_token})},function(t){e.form_entry.field_messages=t.field_messages})}(t)},function(){})},i.element(c).ready(function(){window.form_entry.success||o.notificationService.error(window.form_entry.error_notification,{permanent:!0})}),e.form_entry=a.form_entry}]}),define("controllers/rest_form/users/user_api_settings_access_token",["require","exports","angular","notifications"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});const s=n.notificationService;t.default=["$scope","$rootScope","$window","$element","restFormService",function(e,t,n,o,r){e.submitAccessToken=function(){r.post(e.form_entry.save_link,e.form_entry).then(function(i){t.redirect(e.form_entry.root_link_back)},function(t){e.form_entry.field_messages=t.field_messages})},e.cancel=function(){t.redirect(e.form_entry.root_link_back)},i.element(o).ready(function(){window.form_entry.success||s.error(window.form_entry.error_notification,{permanent:!0})}),e.form_entry=n.form_entry,e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0}}]}),define("controllers/rest_form/users/user_edition",["require","exports","underscore","components/form/common/topic_menu","services/confirmation_service","classes/context_data/context_data","services/form"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","restFormService","$rootScope",function(e,t,a,c){e.form_entry=t.form_entry;const l=e.form_entry.user_credentials.email;function d(t){a.post(e.form_entry.save_link,t).then(function(e){c.redirect(e.root_link_back)},function(t){e.form_entry.field_messages=t.field_messages})}e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0},e.getAvailableGroupsLabel=function(){return window.messages.get("_1811568")},e.getSelectedGroupsLabel=function(){return window.messages.get("_1984453")},e.isGroupsTopicMenu=function(){return void 0!==e.form_entry.groups&&!i.isArray(e.form_entry.groups)},e.isGroupsArray=function(){return void 0!==e.form_entry.groups&&i.isArray(e.form_entry.groups)},e.redirect=function(e){c.redirect(e)},e.isImpersonate=function(){return o.contextData.rules.isImpersonate()},e.usersEditionForm=function(){const t=JSON.parse(JSON.stringify(e.form_entry));t.projects&&t.projects.root_entry&&function(e,t){const s=n.findTopicEntry(e.root_entry,t);s.selected===constants.topic_entry.selected.node&&(s.selected=constants.topic_entry.selected.none,i.each(s.children,function(e){e.selected=constants.topic_entry.selected.node}))}(t.projects,constants.root_id.main_entry.all),void 0!==e.form_entry.id&&e.form_entry.id.length>0&&e.form_entry.user_credentials.email!==l?function(e){s.confirmationService.display({message:{message:window.messages.get("_1951604"),ok:window.messages.get("_697024"),cancel:window.messages.get("_348105")}}).then(function(){e.remove_alert_recipients=!0,d(e)},function(){e.remove_alert_recipients=!1,d(e)})}(t):d(t)},e.cancel=function(){c.redirect(e.form_entry.root_link_back)},e.selectFull=function(e){e&&i.each(window.form_entry.project_access_levels,function(e){n.recursiveUnselectAndSelect(e.project_access_level.root_entry,constants.user_access.level.full)})},e.showFieldErrorsNoDirty=function(t){return r.formService.shouldShowFieldErrors(e.user_edition_form,t,!1)},e.enablePasswordChange=function(t,i){i.preventDefault(),e.form_entry.password_changed=!0!==t},e.getSelectedAccessLevel=function(e){return n.getFirstSelectedMappedId(e.root_entry)},e.isCustomLevelSelected=function(t){return e.getSelectedAccessLevel(t)===constants.user_access.level.custom},e.isNoAccessSelected=function(e){return"NONE"===n.getFirstSelectedMappedId(e.root_entry)}}]}),define("controllers/rest_form/users/users_management",["require","exports","lazy","underscore","notifications","table_sorter_ui","classes/context_data/context_data","services/confirmation_service","pagination","react-dom","react","event","reusable_utilities","services/tw_routing"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){function h(e,t,h,m,_,f){const y=[];return(()=>{e.filterValue="",e.form_entry=m.form_entry,e.cancellationToken=new u.CancellationToken,e.$on("$destroy",()=>{e.cancellationToken.cancel()});const i=new g.Event;i.subscribe(()=>{e.$$phase||e.$apply()});const p=new g.Event,D={onChange:i,onRedraw:p};e.listPaginator=new c.ListPaginator(e.form_entry.users,D,v),e.canShowEmailIssues=C,e.warningIconClass=E,e.buildEmailIssueTooltip=T,e.showIssueDetails=M,e.reEnableEmail=P,_(()=>{l.render(d.createElement(c.ListPaginationComponent,{paginator:e.listPaginator}),$("#pagination")[0]),e.cancellationToken.addCleanupFunction(()=>l.unmountComponentAtNode($("#pagination")[0]))},0),e.nameColumn={sortable:!0,sort:constants.data_table.sorting.NONE},e.emailColumn={sortable:!0,sort:constants.data_table.sorting.NONE},y.push(e.nameColumn,e.emailColumn),_(()=>{new o.TableSorter(t.find("table")[0],{sortableColumns:[{sortable:!1},e.nameColumn,{sortable:!1},e.emailColumn,{sortable:!1}],displayBehaviour:o.SortDisplayBehaviour.ONE_COLUMN})}),e.sortTableBy=b,e.isSortedBy=w,e.addNewUser=(()=>h.redirect(e.form_entry.root_link_new)),e.editUser=(e=>h.redirect(e.root_link_edit)),e.updatePagination=(()=>{e.listPaginator.pageNum=1,p.fire()}),e.resendConfirmationEmail=n.debounce(e=>{f.put(e).then(()=>{s.notificationService.success(constants.email.confirmation_resent,{permanent:!1})})},3e3,!0),e.deleteUser=(e=>{a.confirmationService.display({message:r.contextData.getMessage("_705442")}).then(()=>(function(e){a.confirmationService.display({message:{message:r.contextData.getMessage("_1951604"),ok:r.contextData.getMessage("_697024"),cancel:r.contextData.getMessage("_348105")}}).then(()=>S(e,{remove_alert_recipients:!0}),()=>S(e,{remove_alert_recipients:!1}))})(e),()=>void 0)})})();function v(t,n,s){const o=void 0===t.user_credentials?void 0:t.user_credentials.email;return i([t.first_name,t.last_name,o]).map(e=>e.toLowerCase()).filter(e=>void 0!==e).some(t=>i(t).contains(e.filterValue.toLowerCase()))}function S(t,i){f.post(t.root_link_delete,i).then(i=>{e.form_entry.users=n.without(e.form_entry.users,n.findWhere(e.form_entry.users,{id:t.id})),e.listPaginator.replaceModels(e.form_entry.users)},t=>{e.formEntry.field_messages=t.field_messages})}function b(t){let i=constants.data_table.sorting.ASC;n(y).each(e=>{if(e===t){switch(e.sort){case constants.data_table.sorting.ASC:i=constants.data_table.sorting.DESC;break;default:i=constants.data_table.sorting.ASC}e.sort=i}else e.sort=constants.data_table.sorting.NONE}),e.form_entry.users.sort((i,n)=>{let s,o;return t===e.nameColumn?(s=i.full_name,o=n.full_name):(s=i.user_credentials.email,o=n.user_credentials.email),(s=s.toUpperCase())<(o=o.toUpperCase())?-1:s>o?1:0}),i===constants.data_table.sorting.DESC&&e.form_entry.users.reverse()}function w(e){return e.sort===constants.data_table.sorting.ASC}function C(e){return!e.is_email_confirmed&&void 0!==e.resend_confirm_email_link||e.mail_state.hard_failure}function E(e){return`icon-tw-check-attention icons-action ${e&&e.mail_state&&!0===e.mail_state.hard_failure?"error":""}`}function T(e){const t=[];return e.is_email_confirmed||void 0===e.resend_confirm_email_link||t.push(r.contextData.getMessage("_2449986")),e.mail_state.hard_failure&&t.push(r.contextData.getMessage("_2446612")),t.join(" ")}function M(e){let t="";e.is_email_confirmed||void 0===e.resend_confirm_email_link||(t=r.contextData.getMessage("_2449986")),e.mail_state.hard_failure&&(""!==t&&(t+="<hr>"),t=t+r.contextData.getMessage("_2446612")+'<br><br><code style="white-space:pre-wrap">'+e.mail_state.reason+"</code>"),a.confirmationService.display({message:{title:r.contextData.getMessage("_2441123"),message:t,hideCancel:!0}}).then(()=>{},()=>{})}async function P(e){const t={mail:JSON.stringify([e.user_credentials.email])};await f.postRForm("mail_banned","remove",t),p.twRoutingService.reloadPageAndContext()}}Object.defineProperty(t,"__esModule",{value:!0}),h.$inject=["$scope","$element","$rootScope","$window","$timeout","restFormService"],t.default=h,t.UsersManagementController=h}),define("controllers/rest_form/users/groups/user_group_settings",["require","exports","notifications","services/form"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$rootScope","modalService","restFormService",function(e,t,s,o,r){e.form_entry=t.form_entry,i.notificationService.display(e.form_entry.notification),e.progressOptions={action:constants.events.form.action.post,text:window.messages.get("_612374"),textCalling:window.messages.get("_911337"),keepProgress:!0},e.showFieldErrors=function(t){return n.formService.shouldShowFieldErrors(e.user_group_form,t)},e.showFieldErrorsNoDirty=function(t){return n.formService.shouldShowFieldErrors(e.user_group_form,t,!1)},e.getAvailableUsersLabel=function(){return window.messages.get("_1702125")},e.getSelectedUsersLabel=function(){return window.messages.get("_1585106")},e.save=function(){const t=JSON.parse(JSON.stringify(e.form_entry));r.post(e.form_entry.save_link,t).then(function(t){s.redirect(e.form_entry.back_link)},function(t){e.form_entry.field_messages=t.field_messages})}}]}),define("controllers/rest_form/users/groups/user_groups_settings",["require","exports","underscore","services/confirmation_service"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$rootScope","restFormService",function(e,t,s,o){e.form_entry=t.form_entry,function(){if(e.form_entry.groups.length>0){e.seeUsers=[];for(let t=0;t<e.form_entry.groups.length;t++)e.seeUsers.push(!1)}}(),e.editGroup=function(e){s.redirect(e.edit_link)},e.removeGroup=function(t){n.confirmationService.display({message:t.confirm_question}).then(function(){o.deleter(t.delete_link,t).then(function(){const n=i.indexOf(e.form_entry.groups,t);n>-1&&e.form_entry.groups.splice(n,1)})},function(){})},e.addNewGroup=function(){s.redirect(e.form_entry.new_link)},e.toggleUsers=function(t){e.seeUsers[t]=!e.seeUsers[t]}}]}),define("entry_point/booting_process",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.phases=["polyfill","preload","router_setup","angular","post_boot","launch"]}async run(){let e=void 0;for(;this.phases.length>0;)e=await this.nextPhase(e)}async nextPhase(t){return new Promise(async i=>{let n=this.phases.shift();"post_boot"===n&&"LOGIN"===window.bootPayload.operationMode&&(n=this.phases.shift());const s=await new Promise((t,i)=>{e([`entry_point/phases/${n}_phase`],t,i)});console.log(`[Booting] ${n} phase`);try{i(await s.start(t))}catch(e){console.error("FATAL ERROR"),console.log(e),setTimeout(()=>{window.location.href=window.bootPayload.defaultUrl},3e3)}})}}t.BootingProcess=i,t.bootingProcess=new i}),define("entry_point/configurations/angular_configuration/export",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.exportAngularConfiguration={components:["bubble_dialogs","core","modals","forms","ng_filters","other","pages","rest_form","settings","to_be_split","widgets_1","widgets_2"],modules:{"angular-sanitize":"ngSanitize","angular-messages":"ngMessages",bindonce:"pasvaz.bindonce",oclazyLoad:"oc.lazyLoad","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:[]}}),define("entry_point/configurations/angular_configuration/sandbox",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.sandboxAngularConfiguration={components:["bubble_dialogs","core","filters","forms","ng_filters","other","pages","rest_form","settings","to_be_split","widgets_1","widgets_2"],modules:{"angular-sanitize":"ngSanitize","angular-messages":"ngMessages",bindonce:"pasvaz.bindonce","entry_point/configurations/angular_configuration/angular_modules/canvas_engine":"twCanvasEngine","entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility":"twCanvasEngineCompatibility","entry_point/configurations/angular_configuration/angular_modules/classes":"twClasses","entry_point/configurations/angular_configuration/angular_modules/configuration":"twConfiguration","entry_point/configurations/angular_configuration/angular_modules/inhouse":"twInhouse","entry_point/configurations/angular_configuration/angular_modules/wrappers":"twWrappers"},externalDependencies:[]}}),define("entry_point/configurations/angular_configuration/angular_modules/canvas_engine",["require","exports","angular","classes/canvas_engine/charts/src/implementations/default_chart","classes/canvas_engine/charts/src/implementations/pie_chart","classes/canvas_engine/charts/src/implementations/wheel_chart","classes/canvas_engine/charts/src/models/default_chart_model","classes/canvas_engine/charts/src/models/wheel_chart_model","classes/canvas_engine/core/entities/charts/data_gauge","classes/canvas_engine/core/entities/charts/kpi_chart","classes/canvas_engine/core/entities/charts/pack_chart","classes/canvas_engine/core/entities/cutoff_rectangle","classes/canvas_engine/core/entities/slider","classes/canvas_engine/core/models/kpi_model","classes/canvas_engine/core/models/pack_chart_model","classes/canvas_engine/core/models/slider_model","classes/canvas_engine/core/models/worldmap_model","classes/canvas_engine/settings/axis_settings","classes/canvas_engine/settings/charts/data_gauge_settings","classes/canvas_engine/settings/charts/kpi_chart_settings","classes/canvas_engine/settings/charts/pie_chart_settings","classes/canvas_engine/settings/charts/velocity_chart_settings","classes/canvas_engine/settings/charts/wheel_chart_settings"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w){Object.defineProperty(t,"__esModule",{value:!0}),i.module("twCanvasEngine",[]).factory("TwChart",n.default).factory("TwPieChart",s.default).factory("TwWheelChart",o.default).factory("TwDataModel",r.default).factory("TwWheelChartModel",a.default).factory("TwDataGauge",c.default).factory("TwKpiChart",l.default).factory("TwPackChart",d.default).factory("TwCutoffRectangle",g.default).factory("TwSliderEntity",u.default).factory("TwKpiModel",p.default).factory("TwPackChartModel",h.default).factory("TwSliderModel",m.default).factory("TwWorldmapModel",_.default).factory("TwAxisSettings",f.default).factory("TwDataGaugeSettings",y.default).factory("KpiChartSettings",v.default).factory("PieChartSettings",S.default).factory("TwVelocityChartSettings",b.default).factory("WheelChartSettings",w.default)}),define("entry_point/configurations/angular_configuration/angular_modules/canvas_engine_compatibility",["require","exports","underscore","angular","canvas_engine","reusable_utilities","canvas_chart_utilities","data_structures"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),n.module("twCanvasEngineCompatibility",[]).factory("engineConstants",i.constant(s.Constants)).factory("TwStyle",i.constant(s.Style)).factory("TwPresence",i.constant(s.Presence)).factory("TwDataSet",i.constant(a.Dataset)).factory("Tendency",i.constant(a.Tendency)).factory("TwPopoverData",i.constant(a.PopoverData)).factory("TwColor",function(){const e=o.Color;return e.addCustomColor("BRANDING_COLOR",window.context_data.projectSettings.branding.color),e}).service("TwCanvasUtilities",i.constant(s.Utilities)).factory("TwChartSettings",i.constant(r.DefaultChartSettings))}),define("entry_point/configurations/angular_configuration/angular_modules/classes",["require","exports","angular","classes/calendar/calendar","classes/cropper","classes/directives/directive_wrapper","classes/draggable/strategy/dashboards_strategy","classes/draggable/strategy/draggable_grid_strategy","classes/floating_content/floating_content_structure","classes/graph_slicer","classes/influencer/profile/influencer_profile","classes/navigation/nav_params"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),i.module("twClasses",[]).factory("Calendar",n).factory("Cropper",s.default).factory("DirectiveWrapper",o.default).factory("DraggableDashboardsStrategy",r.default).factory("DraggableGridStrategy",a.default).factory("FloatingContentStructure",c.default).factory("GraphSlicer",l.default).factory("InfluencerProfile",d.default).factory("NavigationParams",g.default)}),define("components/bubble_dialog/color_edition/directive",["require","exports","angular","angular_utilities","jquery","math_utils","react","react-dom","reusable_components","reusable_utilities","services/tw_common","services/template_source"],function(e,t,i,n,s,o,r,a,c,l,d,g){function u(e){return{replace:!0,restrict:"AE",bindToController:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controllerAs:"vm",controller:p,templateUrl:g.templateSourceFactory("components/bubble_dialog/color_edition"),scope:{},compile:function(){return{pre:t,post:i}}};function t(e,t){t.css({opacity:"0"})}function i(t,i){e(()=>{t.vm.styleInformation.setAbsoluteY(window.innerHeight/2-i.height()/2),t.vm.styleInformation.apply(t.vm.referenceElement,i)},0,!1)}}Object.defineProperty(t,"__esModule",{value:!0}),u.$inject=["$timeout"],t.default=u,t.ColorEditionBubbleDialogDirective=u;let p=class{constructor(e,t){this.$scope=e,this.$element=t,this.cancellationToken=new l.CancellationToken,this.cancellationToken.addDomEvent(s(document),"mouseup",e=>this.handleClick(e)),this.cancellationToken.addDomEvent(s(document),"mousedown",e=>this.handleMouseDown()),this.$scope.$on("$destroy",()=>{a.unmountComponentAtNode(this.$element.find("#color-edition-bubble-body").get(0)),this.cancellationToken.cancel()})}$onInit(){this.color=this.extractNoAlphaColor(this.payload.color),this.opacity=this.extractAlpha(this.payload.color),this.renderColorPicker()}ok(){const e=o.numberConversionUtils.decToHex(Math.round(this.opacity*o.MAX_COLOR_DECIMAL));this.payload.color=this.color+e,this.facade.onMessage.fire(!0)}cancel(){this.facade.onMessage.fire(!1)}renderColorPicker(){const e={opacity:this.opacity,onOpacityChange:this.onOpacityChange.bind(this)};a.render(r.createElement(c.ColorPickerPopoverRenderable,{selectedColor:this.color,onColorChange:this.onColorChange.bind(this),opacityProps:this.payload.hideOpacity?void 0:e,embed:!0}),this.$element.find("#color-edition-bubble-body").get(0))}onColorChange(e){this.color=e,this.renderColorPicker()}onOpacityChange(e){this.opacity=e,this.renderColorPicker()}extractNoAlphaColor(e){return e.substring(0,7)}extractAlpha(e){return 9===e.length?o.numberConversionUtils.hexToDec(e.substring(7,9))/o.MAX_COLOR_DECIMAL:1}handleClick(e){d.twCommon.isPointOnElement({x:e.clientX,y:e.clientY},this.$element)||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.cancel()}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}};__decorate([l.throttle(10,{trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],p.prototype,"onOpacityChange",null),p=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],p),t.ColorEditionBubbleDialogController=p}),define("react_components/bubble_dialogs/components/comment_preview_bubble_dialog",["require","exports","classnames","flux","jquery","react","reusable_components"],function(e,t,i,n,s,o,r){var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.RIGHT=0]="RIGHT",e[e.LEFT=1]="LEFT"}(a=t.CommentDirection||(t.CommentDirection={}));t.CommentPreviewBubbleDialog=class extends n.BaseComponent{constructor(e){super(e),this.state={showImage:this.showImage(e)}}showImage(e){const{comment:t}=e.payload;return void 0!==t&&void 0!==t.image_url&&t.image_url.length>0}render(){const{comment:e,isAlwaysVisible:t}=this.props.payload,{direction:n}=this.state,s=this.generateImagePreview(),r=this.generateDescription(),c=!e.content||0===e.content.length,l=this.state.showImage,d=t&&!c,g=i({"tw-bubble-dialog":!0,"bubble-dialog-comment-preview":!0,"no-comment":c,"no-image":!l,visible:d}),u=i({"comment-container":!0,"open-left":n===a.LEFT});return d||l?o.createElement("div",{className:g,ref:this.applyStyle.bind(this)},o.createElement("div",{className:u},s,r)):null}componentWillUnmount(){const{facade:e}=this.props;e&&!e.isDisposed()&&(void 0!==this.subscription&&this.subscription.cancel(),e.destroy())}applyStyle(e){if(e){const{referenceElement:t,styleInformation:i,facade:n,payload:o}=this.props,{direction:r}=this.state;t&&i&&i.apply(t,s(e)),setTimeout(()=>{if(void 0===r&&this.determineDirection(e),void 0!==this.subscription&&this.subscription.cancel(),this.subscription=n.onElementUpdate.subscribe(()=>{t&&i&&i.apply(t,s(e))}),"SHOW_ALL_COMMENTS"===o.comment.display_type){const i=$(t).parents(".tw-widget-body"),n=$(e);n.offset().left<i.offset().left?n.css({marginLeft:`${i.offset().left-n.offset().left}px`}):n.offset().left+n.outerWidth()>i.offset().left+i.outerWidth()&&n.css({marginLeft:`-${n.offset().left+n.outerWidth()-(i.offset().left+i.outerWidth())}px`})}},0)}}generateImagePreview(){const{comment:e,color:t}=this.props.payload;let{clickAction:n}=this.props.payload;if(this.state.showImage){const s=i({content:!0,clickable:!!n});return void 0===n&&(n=(()=>!1)),o.createElement("div",{className:s,style:{borderColor:t},ref:e=>this.reference=e,onClick:n.bind(this)},o.createElement(r.Image,{src:e.image_url,onError:this.onImageError.bind(this)}))}return null}determineDirection(e){const t=this.props.facade.getReferenceElement(),i=this.findParent(t);if(i){const t=$(e),n=i.offset(),s=t.offset(),o=n.left+i.innerWidth(),r=s.left+this.getElementWidth(t)<o?a.RIGHT:a.LEFT;this.setState({direction:r})}}getElementWidth(e){const t=$(".content",e),i=$(".comment",e);return t.innerWidth()+i.innerWidth()}findParent(e){if(e.length>0){let t=100,i=e[0].parentElement;for(;i&&i.parentElement&&t-- >=0;){const e=$(i);if(e.hasClass("widget"))return e;i=i.parentElement}return null}}onImageError(){this.setState({showImage:!1})}generateDescription(){const{comment:e}=this.props.payload,{direction:t,showImage:n}=this.state;if(e&&void 0!==e.content&&e.content.length>0){const s=i({comment:!0,"has-image":n});return o.createElement("div",{className:s,style:{display:void 0===t&&"block"}},o.createElement("div",{className:"limited",dangerouslySetInnerHTML:{__html:e.content}}))}return null}}}),define("services/react_bridge_factory",["require","exports","react-dom","reusable_utilities"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createReactBridge=function(e,t,s={}){return()=>{const{replace:o=!0,template:r="<div></div>",classNames:a=""}=s;return{replace:o,scope:t,controller:["$scope","$element","$rootScope",(t,r,c)=>{let l=s.cancellationToken;o&&$(r[0]).addClass(a),i.render(e(t,r),r[0]),void 0!==s.watch&&Array.isArray(s.watch)&&s.watch.length>0&&(void 0===l&&(l=new n.CancellationToken),s.watch.forEach(n=>{l.addCleanupFunction(t.$watch(()=>t[n],(n,s)=>{void 0!==n&&n!==s&&i.render(e(t,r),r[0])},!0))})),t.$on("$destroy",()=>{i.unmountComponentAtNode(r[0]),void 0!==l&&l.cancel()})}],template:r}}}}),define("components/bubble_dialog/comment_preview/directive",["require","exports","react","react_components/bubble_dialogs/components/comment_preview_bubble_dialog","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.CommentPreviewBubbleDialog,Object.assign({},e)),{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="})}),define("components/bubble_dialog/generic_message/directive",["require","exports","react","services/react_bridge_factory","react_components/bubble_dialogs/components/generic_message_bubble_dialog"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.GenericMessageBubbleDialog,Object.assign({},e)),{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="})}),define("components/bubble_dialog/react/directive",["require","exports","react-dom"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"EA",scope:{payload:"=",referenceElement:"=",styleInformation:"=",facade:"="},controller:["$scope","$element",function(e,t){e.cancelDestruction=function(){e.facade.cancelDestruction()},e.destroy=function(){e.facade.scheduleDestruction(100)},e.$on("$destroy",()=>{i.unmountComponentAtNode(t.get(0))}),i.render(e.payload.componentFactory(Object.assign({},e.payload.payload,{destroy:e.destroy,cancelDestruction:e.cancelDestruction,styleInformation:e.styleInformation,refreshStyle:()=>e.styleInformation.apply(e.referenceElement,t)})),t.get(0))}],compile:function(){return{pre:e,post:t}},template:'<div class="tw-bubble-dialog bubble-dialog-react"></div>'};function e(e,t){t.css({opacity:"0"})}function t(e,t){setTimeout(function(){e.styleInformation.apply(e.referenceElement,t)},0)}}}),define("components/bubble_dialog/topic_menu_select_dropdown/directive",["require","exports","react","react-dom","reusable_components","angular","angular_utilities","reusable_utilities","event_bus"],function(e,t,i,n,s,o,r,a,c){function l(){return{template:'<div class="tw-bubble-dialog tw-bubble-dialog-topic-menu-select-dropdown"></div>',replace:!0,restrict:"EA",scope:{referenceElement:"=",styleInformation:"="},compile:g,bindToController:{payload:"=",facade:"="},controllerAs:"vm",controller:d}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=l,t.TopicMenuSelectDropdownDirective=l;let d=class{constructor(e,t){this.$scope=e,this.$element=t}$onInit(){this.cancellationToken=new a.CancellationToken,this.cancellationToken.subscribeToStream(c.eventBus,c.EVENT_TYPES.UPDATE_TOPIC_MENU_SELECT_DROPDOWN,e=>{const t=e.value;t.type===this.payload.menu.type&&(this.payload.menu.root_entry.children=t.root_entry.children||[],this.render())}),this.render(),this.$scope.$on("$destroy",()=>{n.unmountComponentAtNode(this.$element.get(0)),this.cancellationToken.cancel()})}render(){n.render(i.createElement(s.DocumentClickTrackerWrapper,{clickOutside:e=>this.payload.close(e)},i.createElement(s.DropdownMenuContainer,{forceShow:!0,entries:this.payload.menu.root_entry.children||[],isSubMenu:!1,options:this.payload.options,mergeFirstLevel:this.payload.concatAllNode,className:this.payload.className,onClick:(e,t,i)=>this.handleSelection(e,t,i),onMouseEnter:e=>this.handleMouseEnter(e)})),this.$element.get(0))}handleSelection(e,t,i){this.payload.onEntryClicked(e,t,i)}handleMouseEnter(e){void 0!==this.payload.onMouseEnter&&this.payload.onMouseEnter(e)}};function g(){return{post(e,t){setTimeout(()=>{e.styleInformation.apply(e.referenceElement,t)},0)}}}d=__decorate([r.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],d)}),define("entry_point/configurations/angular_configuration/angular_modules/components_bubble_dialogs",["require","exports","angular","components/activity/popup/directive","components/bars/popup/directive","components/bars/sentiment_popup/directive","components/bubble_dialog/alert/directive","components/bubble_dialog/color_edition/directive","components/bubble_dialog/colored_message/directive","components/bubble_dialog/comment_marker/directive","components/bubble_dialog/comment_preview/directive","components/bubble_dialog/confirmation/directive","components/bubble_dialog/drop_down_menu/directive","components/bubble_dialog/entry/directive","components/bubble_dialog/filters/selection/directive","components/bubble_dialog/generic_message/directive","components/bubble_dialog/influencer/follower_info/directive","components/bubble_dialog/influencers_list/creation/directive","components/bubble_dialog/influencers_list/selection/directive","components/bubble_dialog/mail_error/directive","components/bubble_dialog/message/directive","components/bubble_dialog/months/directive","components/bubble_dialog/new_dashboard/directive","components/bubble_dialog/react/directive","components/bubble_dialog/replay_speed/directive","components/bubble_dialog/rform/directive","components/bubble_dialog/search_query/edit/directive","components/bubble_dialog/smtptest/directive","components/bubble_dialog/tooltip/directive","components/bubble_dialog/topic_menu_select_dropdown/directive","components/bubble_dialog/widget/directive","components/bubble_dialog/widget_menu/directive","components/message_diffusion/popup/directive","components/pie/popup/directive","components/theme_cloud/popup/directive","components/bubble_dialog/influencers/add_to_campaign/directive","components/bubble_dialog/tag/creation/directive","components/bubble_dialog/rebuild_time_range/directive","components/bubble_dialog/group/creation/directive","components/bubble_dialog/export_preview/directive","components/bubble_dialog/account_details/directive","components/bubble_dialog/edit_topic/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_bubbleDialogs",[]).directive("twBubbleDialogActivity",n.default).directive("twBubbleDialogBars",s.default).directive("twBubbleDialogSentiment",o.default).directive("twBubbleDialogAlert",r.default).directive("twBubbleDialogColorEdition",a.default).directive("twBubbleDialogColoredMessage",c.default).directive("twBubbleDialogCommentMarker",l.default).directive("twBubbleDialogCommentPreview",d).directive("twBubbleDialogConfirmation",g.default).directive("twBubbleDialogDropDownMenu",u.default).directive("twBubbleDialogEntry",p.default).directive("twBubbleDialogFiltersSelection",h.default).directive("twBubbleDialogGenericMessage",m).directive("twBubbleDialogInfluencerFollowerInfo",_.default).directive("twBubbleDialogInfluencersListCreation",f.default).directive("twBubbleDialogInfluencersListSelection",y.default).directive("twBubbleDialogMailError",v.default).directive("twBubbleDialogMessage",S.default).directive("twBubbleDialogMonths",b.default).directive("twBubbleDialogNewDashboard",w.default).directive("twBubbleDialogReact",C.default).directive("twBubbleDialogReplaySpeed",E.default).directive("twBubbleDialogRform",T.default).directive("twBubbleDialogSearchQueryEdit",M.default).directive("twBubbleDialogSmtptest",P.default).directive("twBubbleDialogTooltip",D.default).directive("twBubbleDialogTopicMenuSelectDropdown",A.default).directive("twBubbleDialogWidget",I.default).directive("twBubbleDialogWidgetMenu",x.default).directive("twBubbleDialogMessageDiffusion",R.default).directive("twBubbleDialogPie",F.default).directive("twBubbleDialogThemeCloud",O.default).directive("twBubbleDialogAddInfluencersToCampaign",k.default).directive("twBubbleDialogTagCreation",N.default).directive("twBubbleDialogRebuildTimeRange",L.default).directive("twBubbleDialogGroupCreation",B.default).directive("twBubbleDialogExportPreview",W.default).directive("twBubbleDialogAccountDetails",U.default).directive("twBubbleDialogEditTopic",G.default)}),define("services/replay_manager",["require","exports","angular","underscore","classes/context_data/context_data","event","data_structures","canvas_engine","log"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l="__number-of-steps",d="__speed",g="__timeline",u=5e3;t.default=function(){function e(t,i){if(this[l]=i||1,!(this instanceof e))throw new Error('ReplayManager must be instantiated with the "new" keyword');return this[g]=new a.Timeline(!0),this.durationMultiplier=1,this.model=t,this.onStepChange=new o.Event,this.onSpeedChange=new o.Event,this.onDispose=new o.Event,this.onNewTimeline=new o.Event,this.onTickRequest=new o.Event,this.onLoseInitialStateOnTimeline=new o.Event,this.autoReplayEnabled=!0,this.pauseDuration=0,this.bindTimeline(),this.currentStep=0,this.buildTimeFormat(),this}e.prototype.STATUSES={PLAYING:"__playing",PAUSED:"__paused"},e.prototype.SPEEDS={SLOWER:.5,NORMAL:1,FASTER:2};const t=function(e){const t=this.currentStep;if(this.currentStep=Math.floor(e*(this.numberOfSteps-1)),t!==this.currentStep){const e=this;e.onStepChange.fire(e.currentStep,t)}};return Object.defineProperty(e.prototype,"frameIndex",{get:function(){return Math.min(this.numberOfSteps-1,Math.ceil(this.progress*(this.numberOfSteps-1)))},set:function(){throw new Error('cannot set "frameIndex", use timeline\'s setProgress instead!')},enumerable:!0}),Object.defineProperty(e.prototype,"numberOfSteps",{get:function(){return this[l]},set:function(){throw new Error('cannot modify "numberOfSteps"!')},enumerable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this[d]||e.prototype.SPEEDS.NORMAL},set:function(t){if(!n(e.prototype.SPEEDS).includes(t))throw new Error('value: "'+t+'" is not a valid "speed"');this[d]=t},enumerable:!0}),e.prototype.setSpeed=function(e){this.speed=e,this.onSpeedChange.fire()},Object.defineProperty(e.prototype,"status",{get:function(){return i.isDefined(this.getTimeline())&&this.getTimeline().isPlaying()?e.prototype.STATUSES.PLAYING:e.prototype.STATUSES.PAUSED},set:function(){throw new Error("cannot set status directly! please use the 'play', 'pause' or 'toggle' function")},enumerable:!0}),Object.defineProperty(e.prototype,"timeline",{get:function(){return this[g]},set:function(){throw new Error("timeline cannot be modified!")}}),Object.defineProperty(e.prototype,"duration",{get:function(){return u*this.durationMultiplier/this.speed},set:function(){throw new Error("Cannot set duration; adjust speed instead!")}}),Object.defineProperty(e.prototype,"progress",{get:function(){return i.isDefined(this.getTimeline())?this.getTimeline().getProgress():0},set:function(e){i.isDefined(this.getTimeline())?this.getTimeline().setProgress(e):c.logService.error("timeline not available!")}}),e.prototype.isPlaying=function(){return i.isDefined(this.getTimeline())&&this.getTimeline().isPlaying()},e.prototype.addTickRequest=function(e,t){this.onTickRequest.fire(e,t)},e.prototype.getDataModel=function(){return this.model},e.prototype.setDurationMultiplier=function(e){return this.durationMultiplier=e,this},e.prototype.getNumberOfSteps=function(){return this.numberOfSteps},e.prototype.getNumberOfFrames=function(){return this.numberOfFrames},e.prototype.getTimeline=function(){return this.timeline},e.prototype.setReplayType=function(e){this.replayType=e},e.prototype.isCumulative=function(){return this.replayType===constants.widget.replayType.animated_cumulative},e.prototype.isDiscrete=function(){return this.replayType===constants.widget.replayType.animated_discrete},e.prototype.getReplayType=function(){return this.replayType},e.prototype.hasTimeData=function(){return void 0!==this.model&&this.model.hasAdditionalFrames()},e.prototype.getTimeFormat=function(){return this.timeFormat},e.prototype.getTimeData=function(){const e={start:void 0,end:void 0,current:void 0,next:void 0,step:void 0},t=this.currentStep;let i;const s=(i=this.model.getAdditionalFramesAsDatagraphs?this.model.getAdditionalFramesAsDatagraphs():this.model.getAdditionalFrames())[t];return e.start=i[0].getAnimationFrameTimestamp(),e.step=i[1].getAnimationFrameTimestamp()-i[0].getAnimationFrameTimestamp(),e.end=n.last(i).getAnimationFrameTimestamp(),this.isCumulative()&&(e.current=e.start),t+1<i.length?(this.isDiscrete()&&(e.current=s.getAnimationFrameTimestamp()),e.next=i[t+1].getAnimationFrameTimestamp()):(this.isDiscrete()&&(e.current=i[t-1].getAnimationFrameTimestamp()),e.next=s.getAnimationFrameTimestamp()),e},e.prototype.bindTimeline=function(){n.isUndefined(this.onLoseInitialStateSubscription)||this.onLoseInitialStateSubscription.cancel(),this.onLoseInitialStateSubscription=this.getTimeline().onLoseInitialState.subscribe(function(){this.onLoseInitialStateOnTimeline.fire()},this)},e.prototype._addOnStepSubscription=function(){this.onStepSubscription=this.getTimeline().onStep.subscribe(t,this)},e.prototype.enableStepWatch=function(e){e?this._addOnStepSubscription():void 0!==this.onStepSubscription&&(this.onStepSubscription.cancel(),this.onStepSubscription=void 0)},e.prototype.isStepWatchEnabled=function(){return void 0!==this.onStepSubscription},e.prototype.enableAutoReplay=function(e){return this.autoReplayEnabled=e,this},e.prototype.setPauseDuration=function(e){return c.logService.assert(e>=0,"duration of a pause must be positive or 0",a.Constants.Feature.ReplayManager,this),this.pauseDuration=e,this},e.prototype.getPauseDuration=function(){return this.pauseDuration},e.prototype.buildTimeFormat=function(){let e;const t=this.getDataModel();if(this.numberOfFrames=1,n.isUndefined(t))this.timeFormat=s.contextData.commonPropertiesContainer.date_format.date_format;else if(t instanceof r.NetworkModel)e=t.getMaximumTimestamp()-t.getMinimumTimestamp(),this.timeFormat=e>=864e5?s.contextData.commonPropertiesContainer.date_format.date_format:s.contextData.commonPropertiesContainer.date_format.time_format;else if(t instanceof r.DataGraphWrapper&&(t.hasAdditionalFrames()&&(this[l]=t.getAdditionalFrames().length,this.numberOfFrames=this.numberOfSteps-1),t.hasAnimationRange())){const i=(e=t.getAnimationRangeEndTimestamp()-t.getAnimationRangeStartTimestamp())/this[l];this.timeFormat=i>=864e5?constants.date_format:e<=36e5?s.contextData.commonPropertiesContainer.date_format.time_format.concat(":ss"):s.contextData.commonPropertiesContainer.date_format.time_format}},e.prototype.enablePausingOnStepChange=function(e){return this.pausingOnStepChange=e,this},e.prototype.isPausingOnStepChangeEnabled=function(){return this.pausingOnStepChange},e.prototype.isAutoReplayEnabled=function(){return this.autoReplayEnabled},e.prototype.merge=function(e){this[l]=e.hasAdditionalFrames()&&e.getAdditionalFrames().length||1,this.model=e,this.buildTimeFormat(),this.reset()},e.prototype.dispose=function(){this.onStepChange.cancelAll(),this.onSpeedChange.cancelAll(),this.onNewTimeline.cancelAll(),this.onTickRequest.cancelAll(),this.onLoseInitialStateOnTimeline.cancelAll(),this.enableStepWatch(!1),this.getTimeline().dispose(),this.onDispose.fire()},e.prototype.reset=function(e){this.speed=this.SPEEDS.NORMAL,e?(this.enableStepWatch(!1),this.getTimeline().dispose(),this[g]=new a.Timeline(!0),this.bindTimeline(),this.enableStepWatch(!0),this.onNewTimeline.fire(this[g])):this.getTimeline().resetTimeline(!0),this.currentStep=0},e}}),define("services/browser_detection_service",["require","exports","reusable_services","services/modal","classes/context_data/context_data"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(){this.versions={msie:"11",chrome:"50",firefox:"50",safari:"9.0",opera:"40",msedge:"14"},this.browserDetection=new i.BrowserDetection}isMobileBrowser(){return-1!==window.navigator.userAgent.indexOf("Mobi")}initialize(){if(!this.browserDetection.isBrowserSupported()){let e=s.contextData.getMessage("_1982153");const t=["Internet Explorer >= "+this.versions.msie,"Chrome >= "+this.versions.chrome,"Firefox >= "+this.versions.firefox,"Safari >= "+this.versions.safari,"Opera >= "+ +this.versions.opera,"Edge >= "+this.versions.msedge];e+="<ul>",_.each(t,t=>{e+="<li>"+t+"</li>"}),e+="</ul>",n.modalService.display("INFORMATION",{titleIcon:"fa fa-exclamation-triangle",title:s.contextData.getMessage("_1815169"),text:e})}}}t.default=o,t.browserDetectionService=new o}),define("services/calendar",["require","exports","moment-timezone","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["logService","configurationService",function(e,t){return{fromHoursChanged:function(e,i){const o=e.from.hours,r=i.getSelectedAsText(),a=t.getCalendarConfiguration().getDefaultTimeValuesFrom();if(!function(e){return/([0-1][0-9]|2[0-3])/.test(e)}(o))return void(e.from.hours=a.hours);(1===r.length||r.length>1&&n.isEqual(r[0],r[1]))&&s(o,"from",e,r[0])},toHoursChanged:function(e,i){const o=e.to.hours,r=i.getSelectedAsText(),a=t.getCalendarConfiguration().getDefaultTimeValuesTo();if(!function(e){return/([0-1][0-9]|2[0-4])/.test(e)}(o))return void(e.to.hours=a.hours);(1===r.length||r.length>1&&n.isEqual(r[0],r[1]))&&s(o,"to",e,r[0])},fromMinutesChanged:function(e,i){const s=e.from.minutes,r=i.getSelectedAsText(),c=t.getCalendarConfiguration().getDefaultTimeValuesFrom();if(!a(s,e.from.hours))return void(e.from.minutes=c.minutes);(1===r.length||r.length>1&&n.isEqual(r[0],r[1]))&&o(s,"from",e,r[0])},toMinutesChanged:function(e,i){const s=e.to.minutes,r=i.getSelectedAsText(),c=t.getCalendarConfiguration().getDefaultTimeValuesTo();a(s,e.to.hours)||(e.to.minutes=c.minutes);(1===r.length||r.length>1&&n.isEqual(r[0],r[1]))&&o(s,"to",e,r[0])},fromSecondsChanged:function(e,i){const s=e.from.seconds,o=i.getSelectedAsText(),a=t.getCalendarConfiguration().getDefaultTimeValuesFrom();if(!c(s,e.from.minutes,e.from.hours))return void(e.from.seconds=a.seconds);(1===o.length||o.length>1&&n.isEqual(o[0],o[1]))&&r(s,"from",e,o[0])},toSecondsChanged:function(e,i){const s=e.to.seconds,o=i.getSelectedAsText(),a=t.getCalendarConfiguration().getDefaultTimeValuesTo();c(s,e.to.minutes,e.to.hours)||(e.to.seconds=a.seconds);(1===o.length||o.length>1&&n.isEqual(o[0],o[1]))&&r(s,"to",e,o[0])},initializeCalendarTimeValues:function(e,s,o){if(e.from={},e.to={},n.isUndefined(s)||n.isUndefined(o)){const i=t.getCalendarConfiguration().getDefaultTimeValuesFrom(),n=t.getCalendarConfiguration().getDefaultTimeValuesTo();e.from.hours=i.hours,e.from.minutes=i.minutes,e.from.seconds=i.seconds,e.to.hours=n.hours,e.to.minutes=n.minutes,e.to.seconds=n.seconds}else{const t=i(s),n=i(o);e.from.hours=t.format("HH"),e.from.minutes=t.format("mm"),e.from.seconds=t.format("ss");const r=n.format("HH");e.to.hours="00"===r?"24":r,e.to.minutes=n.format("mm"),e.to.seconds=n.format("ss")}},validateMinutes:function(e,t){return a(e,t)},changeTimePart:function(e,t,n,s){const o=i.tz(e,t);"from"===s?o.hour(Number(n.from.hours)).minute(Number(n.from.minutes)).second(Number(n.from.seconds)).millisecond(0):"to"===s&&o.hour(Number(n.to.hours)).minute(Number(n.to.minutes)).second(Number(n.to.seconds)).millisecond(0);return o.toDate().getTime()}};function s(e,n,s,o){let r,a=Number(e),c=i(o),l=i(o),d=t.getCalendarConfiguration().getDefaultTimeValuesTo();if(c.hour(s.from.hours).minute(s.from.minutes).second(s.from.seconds),l.hour(s.to.hours).minute(s.to.minutes).second(s.to.seconds),0===l.diff(c))l.second(c.second()+1),r=l.second().toString(),s.to.seconds=1===r.length?"0"+r:r;else if("from"===n&&c.diff(l)>0){if(l.hour(a).add("hours",1),0===l.hour()){l.minute(0).second(0),a=l.hour().toString();const e=l.minute().toString(),t=l.second().toString();s.to.minutes=1===e.length?"0"+e:e,s.to.seconds=1===t.length?"0"+t:t}const e=c.hour().toString(),t=l.hour().toString();s.from.hours=1===e.length?"0"+e:e,0===l.hour()?s.to.hours=d.hours:s.to.hours=1===t.length?"0"+t:t}else if("to"===n){let e;if(l.diff(c)<0){c.hour(a),a>0?c.subtract(1,"hours"):(l.minute(c.minute()).second(c.second()+1),e=l.minute().toString(),r=l.second().toString(),s.to.minutes=1===e.length?"0"+e:e,s.to.seconds=1===r.length?"0"+r:r);const t=c.hour().toString(),i=c.minute().toString(),n=c.second().toString();s.from.hours=1===t.length?"0"+t:t,s.from.minutes=1===i.length?"0"+i:i,s.from.seconds=1===n.length?"0"+n:n}else 24===a&&(l.minute(0).second(0),e=l.minute().toString(),r=l.second().toString(),s.to.minutes=1===e.length?"0"+e:e,s.to.seconds=1===r.length?"0"+r:r)}}function o(e,t,n,s){const o=Number(e),r=i(s),a=i(s);if(r.hour(n.from.hours).minute(n.from.minutes).second(n.from.seconds),a.hour(n.to.hours).minute(n.to.minutes).second(n.to.seconds),0===a.diff(r)){a.second(r.second()+1);const e=a.second().toString();n.to.seconds=1===e.length?"0"+e:e}else if("from"===t&&r.diff(a)>0){a.minute(o).add(1,"minutes");const e=a.minute().toString(),t=a.hour().toString();n.to.minutes=1===e.length?"0"+e:e,n.to.hours=1===t.length?"0"+t:t}else if("to"===t&&a.diff(r)<0){r.minute(o<60?o:0).subtract(1,"minutes");const e=r.minute().toString(),t=r.hour().toString();n.from.minutes=1===e.length?"0"+e:e,n.from.hours=1===t.length?"0"+t:t}}function r(e,t,n,s){let o,r=Number(e),a=i(s),c=i(s);if(a.hour(n.from.hours).minute(n.from.minutes).second(n.from.seconds),c.hour(n.to.hours).minute(n.to.minutes).second(n.to.seconds),0===c.diff(a))c.second(a.second()+1),o=c.second().toString(),n.to.seconds=1===o.length?"0"+o:o;else if("from"===t&&a.diff(c)>0){c.second(r).add(1,"seconds"),o=c.second().toString();const e=c.minute().toString();n.to.seconds=1===o.length?"0"+o:o,n.to.minutes=1===e.length?"0"+e:e}else if("to"===t&&c.diff(a)<0){a.second(r<60?r:0),r>0&&a.subtract(1,"seconds");const e=a.second().toString(),t=a.minute().toString();n.from.seconds=1===e.length?"0"+e:e,n.from.minutes=1===t.length?"0"+t:t}}function a(e,t){return/([0-5][0-9])/.test(e)&&l(t,e)}function c(e,t,i){return/([0-5][0-9])/.test(e)&&l(i,t,e)}function l(e,t,i){const n=Number(e),s=Number(t),o=Number(i);return!(24===n&&(s>0||o&&o>0))}}]}),define("services/canvas_chart",["require","exports","event_bus","reusable_utilities","services/comments","services/navigation"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_ADD,e=>{this.addOrEditComment(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_EDIT,e=>{this.addOrEditComment(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_PIN,e=>{this.togglePinComment(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_UNPIN,e=>{this.togglePinComment(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_REMOVE,e=>{this.removeComment(e.value)})}addOrEditComment({widget:e,row:t,column:i,nestedId:s,isIndicator:r,nestedIndex:a}){let c=[];t.getRow().isDrilldownDisabled||i.getColumn().isDrilldownDisabled||(void 0!==i.getFilter()&&""!==i.getFilter()&&(c=i.getFilter()),void 0!==i.getFilter()&&""!==i.getFilter()&&c.push(n.StringUtils.parseFilters(t.getFilters())));const l=i.getCode()&&parseInt(i.getCode(),10);return o.navigationService.commentClickHandlerWithArgs(c,e,t.getCode(),l,r,s,a),this}togglePinComment({comment:e,widget:t,nestedId:i,isIndicator:n}){return s.commentsService.togglePin(e,t,n,i),this}removeComment({comment:e,widget:t,nestedId:i,isIndicator:n}){return s.commentsService.removeComment(t,e,!1,n,i),this}}r.$inject=[],t.default=r}),define("services/custom_timezones",["require","exports","moment-timezone","underscore"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX",t=1e-6;return i.tz.pack=r,i.tz.packBase60=o,i.tz.createLinks=l,i.tz.filterYears=d,i.tz.filterLinkPack=function(e,t,i){let n,s,o=e.zones,a=[];for(n=0;n<o.length;n++)a[n]=d(o[n],t,i);for(s=l({zones:a,links:e.links.slice(),version:e.version}),n=0;n<s.zones.length;n++)s.zones[n]=r(s.zones[n]);return s},this.getPackedCustomTimezones=s,this.initialize=function(){i.tz.add(s())},this;function s(){const e=[];return n.each([{name:"-12:00",abbrs:["-12:00"],untils:[null],offsets:[720]},{name:"-11:00",abbrs:["-11:00"],untils:[null],offsets:[660]},{name:"-10:00",abbrs:["-10:00"],untils:[null],offsets:[600]},{name:"-09:30",abbrs:["-09:30"],untils:[null],offsets:[570]},{name:"-09:00",abbrs:["-09:00"],untils:[null],offsets:[540]},{name:"-08:00",abbrs:["-08:00"],untils:[null],offsets:[480]},{name:"-07:00",abbrs:["-07:00"],untils:[null],offsets:[420]},{name:"-06:00",abbrs:["-06:00"],untils:[null],offsets:[360]},{name:"-05:00",abbrs:["-05:00"],untils:[null],offsets:[300]},{name:"-04:30",abbrs:["-04:30"],untils:[null],offsets:[270]},{name:"-04:00",abbrs:["-04:00"],untils:[null],offsets:[240]},{name:"-03:30",abbrs:["-03:30"],untils:[null],offsets:[210]},{name:"-03:00",abbrs:["-03:00"],untils:[null],offsets:[180]},{name:"-02:00",abbrs:["-02:00"],untils:[null],offsets:[120]},{name:"-01:00",abbrs:["-01:00"],untils:[null],offsets:[60]},{name:"+01:00",abbrs:["+01:00"],untils:[null],offsets:[-60]},{name:"+02:00",abbrs:["+02:00"],untils:[null],offsets:[-120]},{name:"+03:00",abbrs:["+03:00"],untils:[null],offsets:[-180]},{name:"+03:30",abbrs:["+03:30"],untils:[null],offsets:[-210]},{name:"+04:00",abbrs:["+04:00"],untils:[null],offsets:[-240]},{name:"+04:30",abbrs:["+04:30"],untils:[null],offsets:[-270]},{name:"+05:00",abbrs:["+05:00"],untils:[null],offsets:[-300]},{name:"+05:30",abbrs:["+05:30"],untils:[null],offsets:[-330]},{name:"+05:45",abbrs:["+05:45"],untils:[null],offsets:[-345]},{name:"+06:00",abbrs:["+06:00"],untils:[null],offsets:[-360]},{name:"+06:30",abbrs:["+06:30"],untils:[null],offsets:[-390]},{name:"+07:00",abbrs:["+07:00"],untils:[null],offsets:[-420]},{name:"+08:00",abbrs:["+08:00"],untils:[null],offsets:[-480]},{name:"+08:45",abbrs:["+08:45"],untils:[null],offsets:[-525]},{name:"+09:00",abbrs:["+09:00"],untils:[null],offsets:[-540]},{name:"+09:30",abbrs:["+09:30"],untils:[null],offsets:[-570]},{name:"+10:00",abbrs:["+10:00"],untils:[null],offsets:[-600]},{name:"+10:30",abbrs:["+10:30"],untils:[null],offsets:[-630]},{name:"+11:00",abbrs:["+11:00"],untils:[null],offsets:[-660]},{name:"+11:30",abbrs:["+11:30"],untils:[null],offsets:[-690]},{name:"+12:00",abbrs:["+12:00"],untils:[null],offsets:[-720]},{name:"+12:45",abbrs:["+12:45"],untils:[null],offsets:[-765]},{name:"+13:00",abbrs:["+13:00"],untils:[null],offsets:[-780]},{name:"+14:00",abbrs:["+14:00"],untils:[null],offsets:[-840]}],function(t){e.push(i.tz.pack(t))}),e}function o(i,n){let s="",o=Math.abs(i),r=Math.floor(o),a=function(i,n){let s,o=".",r="";for(;n>0;)n-=1,i*=60,s=Math.floor(i+t),o+=e[s],i-=s,s&&(r+=o,o="");return r}(o-r,Math.min(~~n,10));for(;r>0;)s=e[r%60]+s,r=Math.floor(r/60);return i<0&&(s="-"+s),s&&a?s+a:(a||"-"!==s)&&(s||a)||"0"}function r(e){return function(e){if(!e.name)throw new Error("Missing name");if(!e.abbrs)throw new Error("Missing abbrs");if(!e.untils)throw new Error("Missing untils");if(!e.offsets)throw new Error("Missing offsets");if(e.offsets.length!==e.untils.length||e.offsets.length!==e.abbrs.length)throw new Error("Mismatched array lengths")}(e),e.name+"|"+function(e){let t,i,n=0,s=[],r=[],a=[],c={};for(t=0;t<e.abbrs.length;t++)void 0===c[i=e.abbrs[t]+"|"+e.offsets[t]]&&(c[i]=n,s[n]=e.abbrs[t],r[n]=o(Math.round(60*e.offsets[t])/60,1),n++),a[t]=o(c[i],0);return s.join(" ")+"|"+r.join(" ")+"|"+a.join("")}(e)+"|"+function(e){let t,i=[],n=0;for(t=0;t<e.length-1;t++)i[t]=o(Math.round((e[t]-n)/1e3)/60,1),n=e[t];return i.join(" ")}(e.untils)}function a(e,t){let i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function c(e,t){return a(e.offsets,t.offsets)&&a(e.abbrs,t.abbrs)&&a(e.untils,t.untils)}function l(e){let t=[],i=[];return e.links&&(i=e.links.slice()),function(e,t,i){let n,s,o,r,a;for(n=0;n<e.length;n++){for(a=!0,o=e[n],s=0;s<t.length;s++)c(o,r=t[s])&&(i.push(r.name+"|"+o.name),a=!1);a&&t.push(o)}}(e.zones,t,i),{version:e.version,zones:t,links:i.sort()}}function d(e,t,i){const n=Array.prototype.slice,s=function(e,t,i){let n,s,o=0,r=e.length+1;for(i||(i=t),t>i&&(s=t,t=i,i=s),s=0;s<e.length;s++)null!==e[s]&&((n=new Date(e[s]).getUTCFullYear())<t&&(o=s+1),n>i&&(r=Math.min(r,s+1)));return[o,r]}(e.untils,t,i),o=n.apply(e.untils,s);return o[o.length-1]=null,{name:e.name,abbrs:n.apply(e.abbrs,s),untils:o,offsets:n.apply(e.offsets,s)}}}}),define("services/injector",["require","exports","angular_utilities","smoothscroll"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});let n=class{constructor(e){window.tw.inject=e.get,window.tw.inject("$browser").url=function(){return""}}};n=__decorate([i.ngInject(["$injector"]),__metadata("design:paramtypes",[Object])],n),t.default=n}),define("services/popover",["require","exports","event_bus","classes/application/application","classes/context_data/context_data","classes/navigation/nav_params","other/tw","wrappers/page_state/page_state_wrapper","services/application_mode","services/bubble_dialog","services/configuration","services/navigation"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});class u{constructor(){this.ignoreNextBubbleClose=!1,c.applicationMode.isMobile()||(i.eventBus.subscribe(i.EVENT_TYPES.POPOVER_OPEN,e=>{this.openPopover(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.CLOUD_POPOVER_OPEN,e=>{this.openCloudPopover(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.POPOVER_CLOSE,e=>{this.closePopovers()}),i.eventBus.subscribe(i.EVENT_TYPES.IGNORE_NEXT_POPOVER_CLOSE,e=>{this.ignoreNextBubbleClose=!0}),i.eventBus.subscribe(i.EVENT_TYPES.DRILLDOWN_OPEN,e=>{this.openDrilldown(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.OPEN_MAP_DRILLDOWN,e=>{this.openMapPieDrilldown(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.DETAILS_OPEN,e=>{this.openDetails(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.SLICED_DRILLDOWN,e=>{this.openSlicedGraph(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.BUBBLE_MODAL,e=>{this.openBubbleModal(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.DROPDOWN_OPEN,e=>{this.openDropDown(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.DROPDOWN_CLOSE,e=>{this.closeDropDown()}),i.eventBus.subscribe(i.EVENT_TYPES.LINE_CHART_COMMENT_CLICK,e=>{this.commentClick(e.value)})),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_COMMENT_PREVIEWS,async e=>{await this.showCommentPreviews(e.value),i.eventBus.dispatch({type:i.EVENT_TYPES.ALL_COMMENT_BUBBLES_READY,value:e.value})}),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_COMMENT_MARKERS,async e=>{await this.showCommentMarkers(e.value),i.eventBus.dispatch({type:i.EVENT_TYPES.ALL_COMMENT_BUBBLES_READY,value:e.value})}),i.eventBus.subscribe(i.EVENT_TYPES.CLEAR_COMMENT_MARKERS,e=>{this.clearCommentMarker(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.CLEAR_COMMENT_PREVIEWS,e=>{this.clearCommentPreview(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.GO_TO_TRIAL,e=>{this.goToTrial()}),i.eventBus.subscribe(i.EVENT_TYPES.GO_TO_TRIAL,e=>{this.goToTrial()}),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_CANVAS_CUTOFF_MESSAGE,e=>{this.showCutoffMessage(e.value)}),i.eventBus.subscribe(i.EVENT_TYPES.HIDE_CANVAS_CUTOFF_MESSAGE,e=>{this.hideCutoffMessage()}),i.eventBus.subscribe(i.EVENT_TYPES.SHOW_COLOR_EDIT_BUBBLE,e=>{this.showEditColorBubble(e.value)})}showEditColorBubble({initialColor:e,title:t}){const n=constants.bubble_dialog.id.color_edition,s=l.bubbleDialogService.createByType(n,$("body"),"color-edition",{title:t,color:e,hideOpacity:!0},d.configurationService.getBubbleDialogConfiguration().getStyle(n),{fadeBackground:!0}),o=s.getPayload();s.onMessage.subscribe(t=>{s.destroy(),t?i.eventBus.dispatch({type:i.EVENT_TYPES.COLOR_EDIT_BUBBLE_CLOSE,value:o.color}):i.eventBus.dispatch({type:i.EVENT_TYPES.COLOR_EDIT_BUBBLE_CLOSE,value:e})})}getWidgetById(e){if(l.bubbleDialogService.getBubbles().length>0)for(const t of l.bubbleDialogService.getBubbles()){const i=t.getPayload();if(void 0!==i&&i.pageState instanceof a.PageStateWrapper&&void 0!==i.pageState.getApplication().getWidgetById(e))return i.pageState.getApplication().getWidgetById(e)}return n.mainApplication.getWidgetById(e)}showCutoffMessage({title:e,content:t,element:i,x:n,y:s,height:o}){l.bubbleDialogService.destroyById(constants.bubble_dialog.id.topic_menu_message);const r=d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.topic_menu_message);return r.setAbsoluteX(n).setAbsoluteY(s).setHeight(o),l.bubbleDialogService.createMessageWithPayload(constants.bubble_dialog.id.topic_menu_message,i,{dispose:!0,title:e,content:t},r),this}hideCutoffMessage(){return l.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.topic_menu_message,500),this}commentClick({filters:e,id:t,rowCode:i,timestamp:n,isIndicator:s,nestedId:o,nestedIndex:r}){const a=this.getWidgetById(t);return g.navigationService.commentClickHandlerWithArgs(e,a,i,n,s,o,r),this}clearCommentMarker({element:e}){return l.bubbleDialogService.getBubbles().forEach(t=>{t.getReferenceElement()[0]===e&&t.getType()===constants.bubble_dialog.id.comment_marker&&t.destroy()}),this}clearCommentPreview({element:e}){return l.bubbleDialogService.getBubbles().forEach(t=>{t.getReferenceElement()[0]===e&&t.getType()===constants.bubble_dialog.id.comment_preview&&t.destroy()}),this}async showCommentMarkers({comments:e,element:t,onClick:i,color:s,x:o,y:r}){return await Promise.all(e.map(e=>{const s=d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.comment_marker).setFadeIn(window.isExport?0:300);return s.setAbsoluteX(o).setAbsoluteY(r),l.bubbleDialogService.createByType(e.id,t,constants.bubble_dialog.id.comment_marker,{marker:e.marker,clickAction:n.mainApplication.getPageState().isEditMode()?()=>i(e):void 0},s,{persist:!0,watchElement:{enable:!0,threshold:20,interval:250}}).onReady.subscribeOnceAsPromise()})),this}async showCommentPreviews({comments:e,element:t,onClick:i,color:s,x:o,y:r}){return await Promise.all(e.map(e=>{const a=d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.comment_preview).setFadeIn(window.isExport?0:300);return a.setAbsoluteX(o).setAbsoluteY(r),l.bubbleDialogService.createByType(e.id,t,constants.bubble_dialog.id.comment_preview,{comment:e,clickAction:n.mainApplication.getPageState().isEditMode()?()=>i(e):void 0,color:s,isAlwaysVisible:e.display_type===constants.comments.display_type.show_all_comments},a,{persist:!0,watchElement:{enable:!0,threshold:20,interval:250}}).onReady.subscribeOnceAsPromise()})),this}goToTrial(){g.navigationService.goToTrial(!0,"&cta=3")}openBubbleModal({type:e,data:t}){return l.bubbleDialogService.destroyAllNonPersistent(),l.bubbleDialogService.createByType(constants.bubble_dialog.id[e],$("#page_content"),constants.bubble_dialog.id[e],t,d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id[e]),{fadeBackground:!0}),this}openDropDown({container:e,x:t,y:n,dropdownData:o}){const r=constants.bubble_dialog.id.context_menu,a=o.buttons.map(e=>({icon:e.icon,text:s.contextData.getMessage(e.text),onClick:t=>{i.eventBus.dispatch({type:e.clickEventType,value:e.clickEventPayload}),l.bubbleDialogService.destroyById(r)}})),c=d.configurationService.getBubbleDialogConfiguration().getStyle(r);return l.bubbleDialogService.destroyById(r),c.setAbsoluteX(t),c.setAbsoluteY(n),c.setPositionOffsetX(2),c.setPositionOffsetY(0),l.bubbleDialogService.createDropDownMenu(r,e,{buttons:a},c),this}closeDropDown(){if(!this.ignoreNextBubbleClose){const e=constants.bubble_dialog.id.context_menu;l.bubbleDialogService.scheduleDestructionById(e,500)}return window.setTimeout(()=>this.ignoreNextBubbleClose=!1,300),this}openCloudPopover({container:e,x:t,y:i,popoverData:n,percentageBasedValue:s,hashTagMappeId:o}){return o===constants.root_id.sampled_themes&&(n.values[0]=Object.assign({},n.values[0],{formatted_value:s,value:s})),this.openPopover({container:e,x:t,y:i,popoverData:n}),this}openPopover({container:e,x:t,y:i,popoverData:n}){l.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup);const s=$(e),o=d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.popup);return o.setAbsoluteX(t),o.setAbsoluteY(i),l.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,s,"bars",n,o),this}closePopovers(){return this.ignoreNextBubbleClose||l.bubbleDialogService.scheduleDestructionById(constants.bubble_dialog.id.popup,500),window.setTimeout(()=>this.ignoreNextBubbleClose=!1,300),this}openSlicedGraph({id:e,start:t,end:i}){const n=new o.NavigationParams;return n.setWidget(r.tw.pageState.getWidgetById(e)),n.setFilters([[{key:"TIME_INTERVAL",begin:t,interval:i-t}]]),g.navigationService.clickHandler(n),this}openMapPieDrilldown(e){this.closePopovers();const t=new o.NavigationParams,i=[e.filters],n=this.getWidgetById(e.id);if(n.getSelectedGeodataPrecisionType()===constants.geodata_precision_type.real_coordinates||n.getSelectedGeodataPrecisionType()===constants.geodata_precision_type.article_coordinates){let e;n.getSelectedGeodataPrecisionType()===constants.geodata_precision_type.real_coordinates?e=constants.world_map.articlegeo_resolution.coordinates:n.getSelectedGeodataPrecisionType()===constants.geodata_precision_type.article_coordinates&&(e=constants.world_map.sourcegeo_resolution.city),i.push([{key:"QUERY",value:e}])}else e.filters.indexOf?-1!==e.filters.indexOf("COUNTRIES")?i.push([{key:e.filters.split("=")[0],value:e.filters.split("=")[1]}]):i.push([{key:"QUERY",value:e.filters}]):e.filters[0]&&i.push([{key:"QUERY",value:e.filters[0]}]);return t.setFilters(i),t.setWidget(n),t.setClickTarget(e.container),t.addTopicMenuFilter(n.getMenu().toProto().geodata_precision_types),g.navigationService.clickHandler(t,e.container,"CONTEXT_MENU_WORLD_MAP"),this}openDrilldown(e,t=this.getWidgetById(e.id)){this.closePopovers();const i=e.requestedPageType||(t.getDataGraph().is_compare_theme_cloud?t.getPayloadValue().tree.root.requested_page_type:void 0);return g.navigationService.clickHandlerWithArgs(e.filters,t,e.container,void 0,i),this}openDetails(e){const t=this.getWidgetById(e.id);return t.getDataGraph().is_compare_theme_cloud?g.navigationService.clickHandlerWithArgs(e.filters,t,e.container,void 0,t.getPayloadValue().tree.root.requested_page_type):this.openDrilldown(e,t),this}}u.$inject=[],t.default=u}),define("services/scripts_loading",["require","exports","reusable_utilities","other/tw","services/google_analytics","services/rest_form_service","services/tw_routing"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});let a=class{constructor(){this.scripts={googleMaps:{locales:{},blockedLocales:["cn","cu","ir","kp","sd","sy","vn"],loaded:!1,blocked:!1,deferred:n.tw.inject("$q").defer(),condition:()=>"PUBLIC"!==r.twRoutingService.getGroupPage()}}}get googleMaps(){return this.scripts.googleMaps}loadScript(t){const{onLoaded:i=_.noop,onError:n=_.noop}=t;t.condition&&!t.condition()||o.restFormService.get(routes.controllers.tw.TWRestForm.get("none","none","ip_country_geolocation","show","","rform").url).then(s=>{let o;if(_.contains(t.blockedLocales,s.country_code))t.blocked=!0;else{if(!(o=t.locales[s.country_code]?t.locales[s.country_code]:t.locales.global))return;"/"!==o[0]&&(o=e.toUrl(o)),$.getScript(o,()=>{t.loaded=!0,i.call(this),t.deferred.resolve()}).fail(()=>{t.blocked=!0,n.call(this)})}})}initialize(){Object.keys(this.scripts).forEach(e=>{this.loadScript(this.scripts[e])}),this.isGoogleAnalyticsAllowed()&&s.googleAnalyticsService.initialize()}isGoogleAnalyticsAllowed(){return r.twRoutingService.getActivePage()&&"SANDBOX"!==r.twRoutingService.getActivePage().getId()}};a=__decorate([i.order(1),__metadata("design:paramtypes",[])],a),t.default=a,Object.defineProperty(t,"scriptsLoadingService",{get:function(){return n.tw.inject("scriptsLoadingService")}})}),define("services/store_logic/radar_store",["require","exports","flux","canvas_engine","radar","reusable_utilities","services/bubble_dialog","services/configuration","data_structures","services/navigation","services/tw_number_formatter"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});class g extends i.BaseStore{constructor(){super([s.RadarActions]),this.hovering=[]}static getInstance(){return g.instance}addHovering(e){return void 0===_.find(this.hovering,({dataset:t})=>e.dataset.getPopoverFooter()===t.getPopoverFooter())&&(this.hovering.length>0&&this.hovering[0].dataset.getValue()!==e.dataset.getValue()||this.hovering.push(e)),this}onAxisLegendMouseEnter(e){r.bubbleDialogService.destroyById(constants.bubble_dialog.id.tooltip);const t=$(e.canvas),i=a.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.tooltip),s=e.label.getPresence().toPoint(),o=e.label.getBoundingBox();return i.setAbsoluteX(t.offset().left+s.getX()+o.width/2),i.setAbsoluteY(t.offset().top+s.getY()),r.bubbleDialogService.createByType(constants.bubble_dialog.id.tooltip,t,constants.bubble_dialog.id.tooltip,{message:e.fullLabel},i),n.ObjectCache.recycleObject(o),this}onAxisLegendMouseLeave(){return r.bubbleDialogService.destroyById(constants.bubble_dialog.id.tooltip),this}onMouseLeave(e){return this.removeHovering(e),r.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),this}removeHovering(e){return this.hovering=this.hovering.filter(({dataset:t})=>e.dataset.getPopoverFooter()!==t.getPopoverFooter()),this}onMouseEnter(e){return this.addHovering(e),this.buildPopover(),this}onMouseClick(e){return r.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),e.stageFacade.isInteractionBlocked||this.openDrilldown(),this}openDrilldown(){if(void 0!==this.hovering[0]){const e=this.hovering[0];r.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup);const t=e.dataset.getFilters(),i=e.widget,n=e.canvas;l.navigationService.openDrilldown(t,void 0,void 0,n,i)}}buildPopover(){const e=this.hovering[0];if(void 0===e)return;const t=_.rest(this.hovering),i=$(e.canvas),s=e.circle;r.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup);const o=a.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.theme_cloud),l=s.getPresence().toPoint();o.setAbsoluteX(i.offset().left+l.getX()-s.getStyle(n.Style.Radius)),o.setAbsoluteY(i.offset().top+l.getY()-5);const g=e.dataset,u=new c.PopoverData(g.getColor().toHex6(),g.getPopoverFooter(),0===t.length);if(g.hasOldValue()){const e=g.getTendency();u.addValue(g.getSubLabel(),d.twNumberFormatter.getInstance().toDecimal(g.getValue()),e),u.setCorner(g.getPercentageValue())}else u.addValue(g.getSubLabel(),d.twNumberFormatter.getInstance().toDecimal(g.getValue()));return t.forEach(e=>{u.addAdditionalData(e.color.toRGBAString(),e.dataset.getPopoverFooter())}),this.popover=r.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,i,"bars",u.build(),o),this}}g.instance=new g,__decorate([o.debounce(10),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],g.prototype,"openDrilldown",null),__decorate([o.debounce(10),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],g.prototype,"buildPopover",null),t.RadarStore=g}),define("services/store_logic/bubble_chart_store",["require","exports","flux","bubble_chart","services/bubble_dialog","services/configuration","services/navigation","other/tw"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c extends i.BaseStore{constructor(){super([n.BubbleChartActions])}static getInstance(){return c.instance}onMouseLeave(e){return s.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),this.hoverPayload=e,this}onMouseEnter(e){this.hoverPayload=e,s.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup);const t=$(e.canvas),i=o.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.popup);return i.setAbsoluteX(e.coords.x),i.setAbsoluteY(e.coords.y),s.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,t,"bars",e.popoverData,i),this}onMouseClick(e){return s.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),e.stageFacade.isInteractionBlocked||this.openDrilldown(e),this}openDrilldown(e){if(void 0!==this.hoverPayload&&void 0!==a.tw.pageState.getWidgetById(this.hoverPayload.widgetId)){const t=e.stageFacade.getCanvas(),i=function(){e.stageFacade.unblockEvents()}.bind(this);e.stageFacade.blockEvents(),r.navigationService.openDrilldown([this.hoverPayload.filters],void 0,void 0,t,a.tw.pageState.getWidgetById(this.hoverPayload.widgetId),i)}}}c.instance=new c,t.BubbleChartStore=c}),define("services/store_logic/filter_click_validators",["require","exports","services/rest_form_service","services/tw_common","services/commons","other/tw","services/configuration","classes/context_data/context_data","services/bubble_dialog","services/context"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0}),t.filterClickValidators=[(e,t)=>{const d=o.tw.pageState.getUserFilterSettings().getTopicMenuByType(e.menuType).getEntryByMappedId(e.mappedId,e.parentMappedId);if(d.hasNotificationTrigger()){switch(d.getNotificationTrigger()){case"NEED_TOKEN":t.waitFor(function(e){return $.Deferred(t=>{const o=[];o.push({text:a.contextData.getMessage("_691638"),onClick:function(e){e.stopPropagation(),t.reject(),this.close()}},{text:a.contextData.getMessage("_716089"),isPrimary:function(){return!0},onClick:function(e){e.stopPropagation(),this.close(),function(e){const t=constants.social_media_accounts.facebook.code,o={client_name:constants.social_media_accounts[t].client_name,source:l.contextService.getCurrentContext().scope,source_id:l.contextService.getCurrentContext().id,type:"SMA",protocol:n.twCommon.extractProtocol(window.location.protocol)};i.restFormService.post(routes.controllers.tw.TWRestForm.post(o.source,o.source_id,"external_authentication","new","","settings").url,o).then(function(t){let i;window.socialMediaAccountCallBack=function(t){i.onunload=function(){e.resolve()}},i=window.open(t.url,t.client_name+"- connection","width=800,height=600"),s.commons.checkPopupBlocked(i)&&e.reject()})}(t)}}),c.bubbleDialogService.destroyById(constants.bubble_dialog.id.topic_menu_message),c.bubbleDialogService.createMessage(constants.bubble_dialog.id.topic_menu_message,$(e),a.contextData.getMessage("_1000100"),a.contextData.getMessage("_1000101"),o,r.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.topic_menu_message).setPositionOffsetX(-2).setArrowSide(n.twCommon.sides.TOP),void 0,void 0,{persistent:!0})})}(e.event.target))}}}]}),define("services/store_logic/filter_store_object",["require","exports","components/form/common/topic_menu","components/tools/data_graph","log","reusable_utilities","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","services/refresh/model_refresh_service","services/rest_form_service","services/topic_entry_loader","services/store_logic/filter_click_validators","services/context"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f){Object.defineProperty(t,"__esModule",{value:!0});class y{onRefreshHitCount(e,t){const s={page_state:g.tw.pageState.toProto(),filter_type:e.menuType};p.restFormService.post(routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"filter_count","search","","rform").url,s).then(s=>{const o=new n.default(s.data_graph);i.refresh_hits(g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e.menuType).toProto(),o),t()})}onLazyLoad(e,t){const i=g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e.menuType),n=i.getEntryByMappedId(e.mappedId,e.parentMappedId);!i.shouldFetchFromServer()||n.hasChildren()||n.hasAdditionalInfo()?t():this.lazyLoadChildrenGeneric(n,e.menuType,t)}onFilterClick(e,t){const i=g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e.menuType),n=i.getEntryByMappedId(e.mappedId,e.parentMappedId);if(i.selectEntry(n,$(e.event.target)),e.refresh)this.refreshPageData();else{const e=g.tw.inject("$rootScope");e.$$phase||e.$apply()}this.checkLazyLoaded(n,i,t)}getLazyLoadMode(e){const t=g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e);return t.shouldFetchFromServer()&&t.getType()===constants.topic_menu.TYPE.named_entity_types?{cached:!1,enabled:!0,loadOnHover:!1}:t.shouldFetchFromServer()?{enabled:!0,cached:!0,loadOnHover:!0}:{enabled:!1,cached:!1,loadOnHover:!1}}isPinnable(e){return g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e).isPinnable()}isGroupable(e){return!g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e).isGroupingNotApplied()}hasSubPage(e){return e===constants.topic_menu.TYPE.countries&&this.isGroupable(e)||e===constants.topic_menu.TYPE.predefined_filters}getTopicMenuByType(e){return g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e).toModel()}getMenuTransformation(e){return"TAGS"===e?e=>{try{const t=o.TopicMenuUtils.getEntryByMappedId(e,e.all_mapped_id);if(t){const i=[];i.push(...t.children);const n=o.TopicEntryUtils.getEntryByMappedId(t,constants.root_id.ungrouped_tags);if(void 0!==n&&o.TopicEntryUtils.hasChildren(n)){const e=i.findIndex(e=>n.mapped_id===e.mapped_id);e===i.length-1&&(i.push(...n.children),i.splice(e,1))}e.root_entry.children.push(...i),t.children.length=0}}catch(e){s.logService.error(e)}return e}:_.identity}canInvertSelection(e){const t=g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e);let i=(e===constants.topic_menu.TYPE.media_type||e===constants.topic_menu.TYPE.countries||e===constants.topic_menu.TYPE.languages||e===constants.topic_menu.TYPE.tags||e===constants.topic_menu.TYPE.source_panel)&&!g.tw.pageState.getUserFilterSettings().getTopicMenuByType(e).hasDefaultFilterState(g.tw.pageState.getUserFilterSettings());if(!t.hasDefaultMappedId()&&t.hasAllMappedId()){const e=t.getEntryByMappedId(t.getAllMappedId());i=i&&!e.isSelected()}return i}lazyLoadChildrenGeneric(e,t,i){let n;g.tw.pageState.getAllowedPages().isCustomPage()||(n=g.tw.pageState.getId()),h.topicEntryLoaderService.loadDynamicFilters(e,t,n,()=>{e.hasChildren()||e.setAdditionalInfo(a.contextData.getMessage("_1216469",[e.getTopicEntry().name])),i()})}checkLazyLoaded(e,t,i){const n=this.getLazyLoadMode(t.getType());n.enabled&&(n.cached&&e.hasChildren()||this.lazyLoadChildrenGeneric(e,t.getType(),i))}async refreshPageData(){if(r.mainApplication.hasPageState()&&r.mainApplication.getPageState().getAllowedPages().isDocumentClusterIqApp()&&r.mainApplication.getPageState().getWidgets().length>0&&r.mainApplication.getPageState().getWidgets()[0].isDocumentCluster()&&r.mainApplication.getPageState().getWidgets()[0].hasPayloadValue()&&r.mainApplication.getPageState().getWidgets()[0].getPayloadValue().graph)return;const e={strategy:l.ModelRefreshStrategy.REFRESH},t=c.modelRefreshDecoratorFactory.getDecorator(r.mainApplication.getPageState(),r.mainApplication,d.ModelType.PAGE_STATE,e);try{await u.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&s.logService.error("Error when refreshing page state after clicking filter !",void 0,e)}}}__decorate([o.preCheck(m.filterClickValidators,e=>e[0]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",void 0)],y.prototype,"onFilterClick",null),t.FilterStoreObject=y}),define("services/store_logic/filter_option_store_object",["require","exports","underscore","services/refresh/model_refresh_service","classes/application/application","classes/refresh/model_refresh_strategy","log","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.FilterOptionStoreObject=class{setPinState({topicMenu:e,pin:t}){s.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e.type).setPin(t),e.pinned=t}toggleFilterPin(e){this.setPinState(i.assign(e,{pin:!e.topicMenu.pinned}))}toggleFilterSort(e,t){let i=e.topicMenu.sorting;i="HITS"===i?"NAME":"HITS",e.topicMenu.sorting=i,s.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e.topicMenu.type).setSorting(i),this.refreshPageData("Error when refreshing page state after toggling filter sort !"),t()}setGroupFilter({topicMenu:e,grouping:t}){const i=t===constants.topic_menu.grouping.grouped;s.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e.type).setGrouping(i),e.grouped=i,e.grouping=t,this.refreshPageData("Error when refreshing page state after changing group filter !")}toggleGroupFilter(e){e.topicMenu.grouping===constants.topic_menu.grouping.grouped?this.setGroupFilter(i.assign(e,{grouping:constants.topic_menu.grouping.not_grouped})):this.setGroupFilter(i.assign(e,{grouping:constants.topic_menu.grouping.grouped}))}onChangeFilterBehaviour(e,t){const i=s.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e.menuType);switch(i.getFilterBehaviour()){case"AND":i.setFilterBehaviour("OR");break;case"OR":i.setFilterBehaviour("AND")}this.refreshPageData("Error when refreshing page state after changing filter behaviour !"),t()}onInvertSelection(e,t){const i=s.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e.menuType);i.hasDefaultMappedId()?i.getEntryByMappedId(i.getDefaultMappedId()).invertSelection(!1):i.hasAllMappedId()&&i.getEntryByMappedId(i.getAllMappedId()).invertSelection(!1,!0),t()}async refreshPageData(e){const t={strategy:o.ModelRefreshStrategy.REFRESH},i=a.modelRefreshDecoratorFactory.getDecorator(s.mainApplication.getPageState(),s.mainApplication,c.ModelType.PAGE_STATE,t);try{await n.modelRefreshService.refresh(i,t)}catch(t){t instanceof Error&&r.logService.error(e,void 0,t)}}}}),define("services/store_logic/source_actions_menu_store_object",["require","exports","other/tw","wrappers/topic_menu/topic_menu_wrapper","wrappers/topic_menu/topic_entry_wrapper","underscore","classes/context_data/context_data","classes/application/application"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsMenuStoreObject=class{constructor(){this.sourcesService=i.tw.inject("articleSourcesService"),this.modalService=i.tw.inject("modalService")}async toggleUserRating(e,t){return this.sourcesService.toggleUserRating(t.sources,t.value)}async toggleFavorite(e,t){return this.sourcesService.toggleFavorite(t.sources)}async togglePanel(e,t){return this.sourcesService.togglePanel(t.sources,t.panel,t.include)}async block(e,t){return this.sourcesService.block(t.sources)}async addPanel(e,t){const i=await this.showAddSourcePanelModal(t),n=await this.sourcesService.createPanel(i),s={id:n.id,title:n.name,color:n.color,included_entries:[],excluded_entries:[]},o=this.findSelectedSourcePanelGroup(n.groups);this.addSourcePanelToTopicMenu(s,o.getMappedId());const r=t.sources,a={id:s.id,name:s.title,included_entries:[],excluded_entries:[]};return await this.sourcesService.togglePanel(r,a,!0),{panel:a,group:{name:o.getName(),mapped_id:o.getMappedId(),panels:[]}}}showAddSourcePanelModal(e){const t=this.constructAddPanelModalPayload(e),n=this.modalService.display("ADD_SOURCE_PANEL",t),s=i.tw.inject("$rootScope");return s.$$phase||s.$apply(),n}constructAddPanelModalPayload(e){const t=!e.sources[0].author,i=this.extractNames(e.sources);return{title:r.contextData.getMessage("_148742"),isSource:t,sourceNames:t?i:[],authorNames:t?[]:i}}extractNames(e){return o(e).chain().map(e=>e.name).uniq().value()}findSelectedSourcePanelGroup(e){const t=new n.TopicMenuWrapper(e).getRootEntry(),i=t.getFirstSelectedEntryRecursively();return i||t.getEntryByMappedId("SOURCE_PANEL_GROUP|ungrouped_source_panels_group")}addSourcePanelToTopicMenu(e,t){const i=a.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.source_panel),n=s.TopicEntryWrapper.create(e.id,e.title);let o=i.getRootEntry().getEntryByMappedId(t);void 0===o&&-1!==t.indexOf(constants.source_panel.ungrouped)&&(o=i.getRootEntry().getEntryByMappedId(constants.root_id.source_panel)),o.addChild(n)}getMonitoredSites(){return constants.monitored_sites}getMessages(){return{_001166:r.contextData.getMessage("_001166"),_540506:r.contextData.getMessage("_540506"),_644521:r.contextData.getMessage("_644521"),_984212:r.contextData.getMessage("_984212"),_306883:r.contextData.getMessage("_306883"),_355355:r.contextData.getMessage("_355355"),_212333:r.contextData.getMessage("_212333"),_868599:r.contextData.getMessage("_868599"),_734283:r.contextData.getMessage("_734283"),_265115:r.contextData.getMessage("_265115"),_815162:r.contextData.getMessage("_815162"),_807508:r.contextData.getMessage("_807508"),_697046:r.contextData.getMessage("_697046"),_484126:r.contextData.getMessage("_484126"),_128860:r.contextData.getMessage("_128860")}}}}),define("components/line_chart/simple_line_chart",["require","exports","flux","react","log","services/tw_common","canvas_engine","classes/canvas_engine/core/entities/charts/line_chart/line_chart"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.SimpleLineChart=class extends i.BaseComponent{constructor(e){super(e)}initialize(e){if(e.length){const t=e.innerWidth(),i=e.innerHeight(),n=r.Stage.build(e[0],t,i,30,{layerAmount:2,relayEvents:[r.Constants.StageEvents.MouseWheel],allowInteraction:!1});this.scene=n.scene,this.stage=n.stage,this.camera=n.camera,this.camera.disableTranslation(),this.stage.onResize.subscribe(()=>{this.redrawWidget()});const s=this;requestAnimationFrame(function e(){s.stage.isDisposed||(requestAnimationFrame(e),s.stage.draw())}),this.stage.start(),void 0!==this.props.datagraph&&this.redrawWidget()}else void 0!==this.stage&&this.stage.dispose()}render(){return n.createElement("canvas",{ref:e=>this.initialize($(e)),id:"chartCanvas",className:"tw-line-chart"})}redrawWidget(){const{datagraph:e}=this.props;void 0!==e&&e.toProto().rows.length>0?(this.scene.clearChildren(),this.lineChart=new a.LineChart(r.Presence.zero(this.scene.getPresence()),e,this.stage.getWidth(),this.stage.getHeight()),this.scene.addChild(this.lineChart),this.stage.processUpdate()):s.logService.warn("dataGraph has no rows!",o.twCommon.logFeatures.Charts.LineChart,{datagraph:e})}}}),define("services/store_logic/article_store_object",["require","exports","data_structures","react","underscore","components/line_chart/simple_line_chart","other/tw","services/articles","services/confirmation_service","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.ArticleStoreObject=class{constructor(){this.$q=r.tw.inject("$q")}onTriggerLoadMore(e,t){const i=e.getPayload(t.widgetId);a.articlesService.performLoadMore(t.widgetId,i,t.forward,t.keepPayload)}onApplyScore(e,t){const i=s.range(1,11);return s.contains(i,t.score)?a.articlesService.toggleScore(t.widgetId,t.selection.get(),t.score):Promise.resolve(!1)}checkTagCommentsRule(e,t){const i={message:l.contextData.getMessage("_1584385")};return e.tagCommentsFuture&&(i.checkbox={message:l.contextData.getMessage("_1649824"),data:e}),c.confirmationService.display(i).then(()=>(e.tagComments=!0,t(e.tagComments,e.tagCommentsFuture)),()=>(e.tagComments=!1,t(e.tagComments)))}onApplySentiment(e,t){const i=t.selection.get();return t.canTagComments?(t.tagCommentsFuture=!0,this.checkTagCommentsRule(t,a.articlesService.setSentiment.bind(a.articlesService,t.widgetId,i,t.sentiment))):(t.tagComments=!1,a.articlesService.setSentiment(t.widgetId,i,t.sentiment,t.tagComments))}onToggleImportant(e,t){const i=t.selection.get();return t.canTagComments?(s.every(i,e=>e.metadata.important)||(t.tagCommentsFuture=!0),this.checkTagCommentsRule(t,a.articlesService.toggleImportant.bind(a.articlesService,t.widgetId,i))):(t.tagComments=!1,a.articlesService.toggleImportant(t.widgetId,i,t.tagComments))}onToggleTag(e,t){const i=t.selection.get();return t.canTagComments?(t.tagCommentsFuture=!0,this.checkTagCommentsRule(t,a.articlesService.toggleTag.bind(a.articlesService,t.widgetId,i,t.tag))):(t.tagComments=!1,a.articlesService.toggleTag(t.widgetId,i,t.tag,t.tagComments))}onArticleDeleted(e,t){return t.delete?this.deleteArticles(t):this.undeleteArticles(t)}deleteArticles(e){const t=e.selection.get();return e.canRemoveComments?c.confirmationService.display({message:l.contextData.getMessage("_1745652")}).then(()=>a.articlesService.deleteArticles(e.widgetId,t,!0),()=>a.articlesService.deleteArticles(e.widgetId,t,!1)):a.articlesService.deleteArticles(e.widgetId,t,!1)}undeleteArticles(e){const t=e.selection.get();return a.articlesService.undeleteArticles(e.widgetId,t)}onAddToReport(e){let{widgetId:t,selection:i,selectedEntry:n}=e;return n.children&&n.children.length>0&&(n=s.first(n.children)),a.articlesService.addToCustomPage(t,i.get(),n.mapped_id)}onClickUrlAndSetRead(e,t){const i=e.getPayload(t.widgetId),n=s.find(i.articles,e=>e.entry_id===t.entryId);return void 0!==n?a.articlesService.setRead(t.widgetId,[n]):Promise.resolve(!1)}async onKeyPressed(e,t){2===t.keys.length&&t.keys.join(" ")===l.contextData.userSettings.shortcuts.articles.select_all&&t.selection&&t.selection.selectAll()}onOpenContextPage(e,t){return a.articlesService.openArticleDetails(t.widgetId,t.entryId,t.pageType,t.clusterId,t.isComment)}onRemoveArticlesBySources(e,t){return a.articlesService.removeArticlesBySources(t)}onToggleChildFilter(e,t){return a.articlesService.toggleChildFilter(t.widgetId,t.entryId,t.clusterId,t.isComments)}onTriggerChildrenLoadMore(e,t){return a.articlesService.performChildLoadMore(t.widgetId,t.entryId,t.clusterId,t.isComments,t.payload)}onReceiveChildArticles(e,t){return a.articlesService.mergeArticle(t.widgetId,t.entryId,t.payload,t.oldPayload)}onTriggerTranslationToggle(e,t){return a.articlesService.translateArticle(t.widgetId,t.entryId,t.payload,t.targetLanguage)}getEngagementChart(e){const t=new i.DataGraphWrapper(e);return n.createElement(o.SimpleLineChart,{datagraph:t})}onToggleEntryUserWorkflow(e,t){return a.articlesService.toggleEntryUserWorkflow(t.widgetId,t.entryId,t.timestamp,t.savedStatus)}onReportImageMismatch(e,t){a.articlesService.reportImageMismatch(t.widgetId,t.article)}onAddCustomTag(e,t){const i=t.selection.get();return t.canTagComments?(t.tagCommentsFuture=!0,this.checkTagCommentsRule(t,a.articlesService.addCustomTag.bind(a.articlesService,t.widgetId,i,t.tag))):(t.tagComments=!1,a.articlesService.addCustomTag(t.widgetId,i,t.tag,t.tagComments))}onRemoveTag(e,t){const i=t.selection.get();return t.canTagComments?this.checkTagCommentsRule(t,a.articlesService.removeCustomTag.bind(a.articlesService,t.widgetId,i,t.tag)):(t.tagComments=!1,a.articlesService.removeCustomTag(t.widgetId,i,t.tag,t.tagComments))}onShareUrlClick(e,t){return a.articlesService.openShareUrl(t.widgetId,t.selection.get(),t.shareUrl)}onConvertArticleToTopic(e,t){return c.confirmationService.display({message:l.contextData.getMessage("_2496216")}).then(async()=>void 0!==await a.articlesService.convertArticleToTopic(t.widgetId,t.selection.get()),()=>!1)}onSendEmail(e,t){return a.articlesService.emailArticles(t.widgetId,t.selection.get())}}}),define("services/store_logic/topic_menu_select_store_object",["require","exports","other/tw"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuSelectStoreObject=class{getTopicMenu(e){return i.tw.pageState.getUserFilterSettings().getTopicMenuByType(e)}}}),define("services/store_logic/treemap_store_object",["require","exports","services/bubble_dialog","services/configuration","other/tw","reusable_utilities","jquery","classes/navigation/nav_params","underscore","data_structures","services/articles","services/tw_number_formatter","services/confirmation_service","classes/custom_pages/custom_page_factory","classes/context_data/context_data","classes/application/application","classes/refresh/model_type","services/tw_common","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log","services/navigation","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C){Object.defineProperty(t,"__esModule",{value:!0});t.TreemapStoreObject=class{toggleMouseClickAction(e){e.queryResult.actionsEnabled&&this.openDetails(e.node,e.queryResult,e.event)}toggleMouseEnterAction(e){const t=e.queryResult;t.actionsEnabled&&(this.buildPopover(e,t),(t.deleteActionAllowed||t.blockActionAllowed)&&this.buildDropdown(e,t))}toggleMouseLeaveAction(e){this.closeBubbleDialogs(300)}destroyBubbles(){void 0!==this.dropDownBubble&&this.dropDownBubble.destroy(),void 0!==this.popoverBubble&&this.popoverBubble.destroy()}openDetails(e,t,i){if(t.widgetClickable&&!i.ctrlKey&&!i.metaKey)if(void 0!==t.payload.tree){const n=o.StringUtils.parseFilters(e.clickAction.filter),s=new a.NavigationParams;s.setFilters([n]),s.setWidget(m.mainApplication.getWidgetById(t.widget.widget_id)),s.setClickTarget(i.target),w.navigationService.clickHandler(s,i.target,e.clickAction.page_type)}else t.payload.articles&&d.articlesService.openArticleDetails(t.widget.widget_id,e.clickAction.article_id,e.clickAction.page_type)}closeBubbleDialogs(e=0){void 0===this.popoverBubble||this.popoverBubble.isMouseOver()&&0!==e||this.popoverBubble.scheduleDestruction(e),void 0===this.dropDownBubble||this.dropDownBubble.isMouseOver()&&0!==e||this.dropDownBubble.scheduleDestruction(e)}blockTheme(e,t){const i=t.payload,n=o.StringUtils.parseFilters(e.clickAction.filter);let s;if(c.any(n,e=>e.key===constants.topic_menu.TYPE.named_entity_types||e.value.indexOf(constants.topic_menu.TYPE.named_entity_types)>=0)){const t=e.id.split("\t");t.length>1&&(s={name:t[1]})}c.isUndefined(s)&&(s={name:e.label});const r={tag_cloud_panel_entries:[s]},a=i.delete_link;C.restFormService.post(a,r,constants.events.form.action.add_one).then(()=>{const e=m.mainApplication.getWidgetById(t.widget.widget_id);e.prepareReload(),this.refreshWidgetData(e)})}deleteTheme(e,t){const i=m.mainApplication.getWidgetById(t.widget.widget_id),n=i.getExtendedConfiguration().toProto();c.isUndefined(n.blocked_themes)&&(n.blocked_themes=[]),n.blocked_themes.push(e.label),p.CustomPageFactory.getPageFromPageState(s.tw.pageState).saveWidget(i);const o=m.mainApplication.getWidgetById(t.widget.widget_id);o.prepareReload(),this.refreshWidgetData(o)}buildPopover(e,t){const s=e.node;if(i.bubbleDialogService.destroyById(constants.bubble_dialog.id.popup),t.popoverAllowed){const t=n.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.theme_cloud),o=new l.PopoverData("","",!0);this.addPopoverMetric(s,o),this.popoverBubble=i.bubbleDialogService.createByType(constants.bubble_dialog.id.popup,r(e.event.target),"bars",o.build(),t)}}buildDropdown(e,t){const s=e.node,o=constants.bubble_dialog.id.context_menu,a={buttons:[]};t.blockActionAllowed&&a.buttons.push({icon:"fa fa-ban",text:h.contextData.getMessage("_973823"),onClick:()=>{this.closeBubbleDialogs(),u.confirmationService.display({message:h.contextData.getMessage("_117793")}).then(()=>{this.blockTheme(s,t)},()=>void 0)}}),t.deleteActionAllowed&&a.buttons.push({icon:"fa fa-trash",text:h.contextData.getMessage("_914504"),onClick:()=>{this.closeBubbleDialogs(),u.confirmationService.display({message:h.contextData.getMessage("_510062")}).then(()=>{this.deleteTheme(s,t)},()=>void 0)}});const c=n.configurationService.getBubbleDialogConfiguration().getStyle(o);i.bubbleDialogService.destroyById(o),this.dropDownBubble=i.bubbleDialogService.createDropDownMenu(o,r(e.event.target),a,c),this.dropDownBubble.onDestroy.subscribeOnce(()=>{delete this.dropDownBubble})}addPopoverMetric(e,t){const i=e.previousValue,n=e.originalValue,s=g.twNumberFormatter.getInstance().toDecimal(n);c.isUndefined(i)?t.addValue(e.metric.text,s):t.addValue(e.metric.text,s,new l.Tendency(n,i))}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:y.ModelRefreshStrategy.REFRESH},i=S.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),_.ModelType.WIDGET,t);try{return await v.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&b.logService.error("Error when refreshing widget!",void 0,e)}}else b.logService.error("reload attempted on widget without page state, this could be due to a memory leak",f.twCommon.logFeatures.WidgetWrapper)}}}),define("react_components/sidebar/stores/sidebar_store",["require","exports","flux","reusable_components","wrappers/topic_menu/topic_menu_wrapper","other/tw","services/rest_form_service","reusable_utilities","underscore","services/refresh/model_refresh_service","classes/application/application","classes/refresh/model_refresh_strategy","log","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_type","services/context","services/modal"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f){Object.defineProperty(t,"__esModule",{value:!0});class y extends i.BaseStore{constructor(){super(["global_onPageStateReceived",n.sidebarActions]),this.topicMenuService=o.tw.inject("topicMenuService"),y.instance=this}onPageStateReceived(e){this.onChange.fire({newPageState:!0})}static getInstance(){return y.instance}onAddButtonClicked(e){e.containerQuery.execute().menus.forEach(e=>a.TopicEntryUtils.setSelectionRecursive(e.root_entry,!1,!0));const t=e.query.execute(),i=new s.TopicMenuWrapper(t.menu);if(i.getType()===constants.topic_menu.TYPE.page_monitoring)i.selectEntry(i.getRootEntry()),this.refreshPageData(!1,"Error when refreshing page state after add channel clicked !").then(function(){},function(){});else if(i.getType()===constants.topic_menu.TYPE.web_connector)i.unselectAll(),i.getRootEntry().setSelected(!0),this.refreshPageData(!1,"Error when refreshing page state after add web connector clicked !").then(function(){},function(){});else if(i.getType()===constants.topic_menu.TYPE.reports)this.topicMenuService.addTopicCategory(i,{type:constants.custom_page.type.report},!0).then(()=>$(window).scrollTop(0));else if(i.getRootEntry().hasChildren()){if(t.editMode){let e;e=t.settings.defaultCategory?i.getEntryByMappedId(t.settings.defaultCategory):i.getFirstVisibleEntry(),this.createTopic(e,i,t)}}else this.topicMenuService.addTopicCategory(i).then(e=>{t.editMode&&this.createTopic(e,i,t)})}onAddGroupButtonClicked(e){const t=e.query.execute();e.containerQuery.execute().menus.forEach(e=>a.TopicEntryUtils.setSelectionRecursive(e.root_entry,!1,!0));const i=new s.TopicMenuWrapper(t.menu),n=o.tw.inject("$rootScope");f.modalService.display("ADD_TOPICS_CATEGORY",{name:""}).then(e=>{this.topicMenuService.addTopicCategory(i,{name:e.name}).then(e=>{this.newEntryPostCreation(i,e,t)})}),n.$$phase||n.$apply()}onAddEntry(e){this.onChange.fire(e)}createTopic(e,t,i){let n;const s=e.getMappedId().split(constants.delimiter);let o=s[s.length-1];t.getType()===constants.topic_menu.TYPE.event?o=void 0:t.getType()===constants.topic_menu.TYPE.page_monitoring&&(n={site_pages:[{icon_type:o}]},o=void 0),this.topicMenuService.addTopicEntry(t,n,o,!0).then(e=>{this.newEntryPostCreation(t,e,i)})}newEntryPostCreation(e,t,i){e.unselectAll(),t.setSelected(!0),o.tw.pageState.getUserFilterSettings().getTopicMenuByType(e.getType()).merge(e),i.editMode&&$(window).scrollTop(0),this.refreshPageData(!1,"Error when refreshing page state after new entry created !").then(function(){},function(){})}onReorderTopic(e,t){const{droppedElement:{child:i,parent:n},newParent:s,newIndex:r,query:a}=e,c=a.execute().menu,l=d.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(c.type),g=l.getEntryByMappedId(n.mapped_id),u=g.getChildByMappedId(i.mapped_id);g.removeChildByMappedId(i.mapped_id),l.getEntryByMappedId(s.mapped_id).addChildAtIndex(u,r),o.tw.inject("topicService").saveOrder([l.toProto()]).then(()=>{this.onChange.fire({selectionChanged:!0}),t()})}onClickTopic(e){const t=e.mainQuery.execute(),i=e.query.execute(),n=c.chain(t.menus).map(e=>new s.TopicMenuWrapper(e)).filter(e=>e.getType()===i.menu.type||e.getRootEntry().containsSelection()).map(e=>[e.getType(),e]).object().value();n[i.menu.type].selectEntryByMappedId(e.entry.mapped_id),c.chain(n).omit([i.menu.type]).values().invoke("unselectAll"),c.invoke(c.values(n),"toProto"),this.onChange.fire({selectionChanged:!0}),this.refreshPageData(!i.editMode,"Error when refreshing page state after add channel clicked !").then(function(e){e.isEditMode()&&$(window).scrollTop(0)},()=>{})}onToggleCollapse(e){e.entry.collapsed=!e.entry.collapsed,this.onChange.fire({collapseChanged:!0})}onToggleCollapseAll(e){const t=e.query.execute();t.menu.root_entry.children&&(c.any(t.menu.root_entry.children,e=>e.collapsed)?t.menu.root_entry.children.forEach(e=>e.collapsed=!1):t.menu.root_entry.children.forEach(e=>e.collapsed=!0),this.onChange.fire({collapseChanged:!0}))}onSortGroup(e,t){const{entry:i}=e,{menu:n}=e.query.execute(),a=n.type===constants.topic_menu.TYPE.page_monitoring,l=c.contains([constants.topic_menu.TYPE.topic,constants.topic_menu.TYPE.filter],n.type);if(!a&&!l)return;let d;if(void 0!==i)d=r.restFormService.post(routes.controllers.tw.TWRestForm.post(_.contextService.getCurrentContext().scope,_.contextService.getCurrentContext().id,"ordering",a?"edit":"move","","rform").url,{category_mapped_id:i.mapped_id});else if(a)d=r.restFormService.get(routes.controllers.tw.TWRestForm.get(_.contextService.getCurrentContext().scope,_.contextService.getCurrentContext().id,"ordering","override","","rform").url,{});else{const e=this.getOrderingType(n);d=r.restFormService.post(routes.controllers.tw.TWRestForm.post(_.contextService.getCurrentContext().scope,_.contextService.getCurrentContext().id,"ordering","validate","","rform").url,{type:e})}return d.then(e=>{if(void 0!==e.topic_menus&&e.topic_menus.length>0){const t=o.tw.pageState.getUserFilterSettings(),i=c(e.topic_menus).first(),n=i.type,r=t.getTopicMenuByType(n);if(r){const e=r.getSelectedEntriesRecursively().map(e=>e.getMappedId());r.getRootEntry().merge(new s.TopicMenuWrapper(i).getRootEntry()),r.unselectAll(),e.forEach(e=>r.selectEntryByMappedId(e)),r.toProto(),this.onChange.fire({menuUpdated:!0,menuType:n})}}t()})}getOrderingType(e){return e.type===constants.topic_menu.TYPE.filter?constants.topic_menu.ordering_type.filters:constants.topic_menu.ordering_type.topics}async refreshPageData(e,t){const i={strategy:g.ModelRefreshStrategy.REFRESH},n=h.modelRefreshDecoratorFactory.getDecorator(d.mainApplication.getPageState(),d.mainApplication,m.ModelType.PAGE_STATE,i);e&&(i.delay=p.contextData.projectSettings.slow_refresh_timeout);try{return await l.modelRefreshService.refresh(n,i)}catch(e){if(!(e instanceof Error))throw e;u.logService.error(t,void 0,e)}}}__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],y.prototype,"onReorderTopic",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],y.prototype,"onSortGroup",null),t.SidebarStore=y}),define("services/store",["require","exports","articles","services/store_logic/radar_store","services/store_logic/bubble_chart_store","reusable_components","services/store_logic/filter_store_object","services/store_logic/filter_option_store_object","services/store_logic/source_actions_menu_store_object","services/store_logic/article_store_object","services/store_logic/topic_menu_select_store_object","treemap","services/store_logic/treemap_store_object","react_components/sidebar/stores/sidebar_store"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.articleStore=this.instantiateArticleStore(),this.sourceActionsMenuStore=this.instantiateSourceActionsMenuStore(),this.filterStore=new o.FilterStore(new r.FilterStoreObject),this.filterOptionStore=new o.FilterOptionStore(new a.FilterOptionStoreObject),this.topicMenuSelectStore=new o.TopicMenuSelectStore(new d.TopicMenuSelectStoreObject),this.treemapStore=new g.TreemapStore(new u.TreemapStoreObject),this.sidebarStore=new p.SidebarStore,this.radarStore=this.instantiateRadarStore(),this.bubbleChartStore=this.instantiateBubbleChartStore()}instantiateRadarStore(){return n.RadarStore.getInstance()}instantiateBubbleChartStore(){return s.BubbleChartStore.getInstance()}instantiateArticleStore(){return new i.ArticleStore(new l.ArticleStoreObject)}instantiateSourceActionsMenuStore(){return new o.SourceActionsMenuStore(new c.SourceActionsMenuStoreObject)}}}),define("services/time",["require","exports","moment-timezone","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=[function(){return{extractFormattedTimeOfDay:function(e){return n.twCommon.formatNumberMinSize(new i(e).hour(),2)+":"+n.twCommon.formatNumberMinSize(new i(e).minute(),2)+":"+n.twCommon.formatNumberMinSize(new i(e).second(),2)},time2String:function(e){const t=new i(e);return{date:t.format("ddd MMM DD YYYY"),time:t.format("H:mm:ss A"),shortTime:t.hour()+":"+n.twCommon.formatNumberMinSize(t.minute(),2),debug:t.format("M/DD/YYYY, H:mm:ss A"),shortDate:t.date()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.month()]}},getMonths:e,isMidnight:function(e){return function(e){const t=new i(e);return t.subtract(t.hours(),"hours"),t.subtract(t.minutes(),"minutes"),t.subtract(t.seconds(),"seconds"),t.subtract(t.milliseconds(),"milliseconds"),t.toDate().getTime()}(e)===e},removeMillisecs:function(e){const t=new i(e);return t.subtract(t.milliseconds(),"milliseconds"),t.toDate().getTime()}};function e(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}}]}),define("services/topic",["require","exports","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","common_constants","components/form/common/topic_menu","flux","log","reusable_components","services/refresh/model_refresh_service","underscore","wrappers/user_filter_settings/build_parameters/build_parameters","classes/application/application","wrappers/topic_menu/topic_entry_wrapper","services/broker"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0});const _=d.modelRefreshService,f=i.modelRefreshDecoratorFactory,y=s.ModelType,v=n.ModelRefreshStrategy,S=c.logService,b=a.dispatcher,w=l.sidebarActions;t.default=["$q","restFormService",function(e,t){let i=!1;const n=[[constants.data_type.line_chart,constants.data_type.line_chart_area,constants.data_type.line_chart_multiple,constants.data_type.line_chart_multiple_area],[constants.data_type.column_chart_vertical,constants.data_type.column_chart_vertical_not_stacked,constants.data_type.column_chart_vertical_not_stacked_perc,constants.data_type.column_chart_vertical_perc,constants.data_type.column_chart_vertical_stacked,constants.data_type.column_chart_vertical_stacked_perc,constants.data_type_categories.v_bar_chart_group]];m.brokerService.subscribe(constants.events.topic.update,S.deprecated(function(e,t,i,n){n=!g.isUndefined(n)&&n;const s=p.mainApplication.getPageState().toProto();if(p.mainApplication.getPageState().toProto().user_filter_settings){let n=g.findWhere(s.user_filter_settings.topics,{type:t||constants.topic_menu.TYPE.topic});n||(n=g.findWhere(s.user_filter_settings.filters.topic_menu,{type:t||constants.topic_menu.TYPE.topic}));const o=r.findTopicEntry(n.root_entry,e);o.mapped_id===i.mapped_id&&o.name===i.name&&o.event===i.event||(o.mapped_id=i.mapped_id,o.name=i.name,o.event=i.event)}})),m.brokerService.subscribe(constants.events.topic.add,S.deprecated(function(e,t,i,n,s,o,a,c){a=!(g.isUndefined(a)||!1===a);const l=p.mainApplication.getPageState().toProto();if(l.user_filter_settings){let s=g.findWhere(l.user_filter_settings.topics,{type:n||constants.topic_menu.TYPE.topic});const d=p.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(g.isUndefined(n)?constants.topic_menu.TYPE.topic:n);s||(s=g.findWhere(l.user_filter_settings.filters.topic_menu,{type:n||constants.topic_menu.TYPE.topic}));let u=r.findTopicEntry(s.root_entry,e);const m={};if(m.mapped_id=t,m.name=i,o&&(m.visibility=o),null===u&&n===constants.topic_menu.TYPE.page_monitoring){const t=e.substring(e.indexOf(constants.delimiter)+1);u={mapped_id:e,name:constants.social_media_accounts[t].name},s.root_entry.children||(s.root_entry.children=[]),s.root_entry.children.push(u),d.getRootEntry().addChild(new h.TopicEntryWrapper(u,d,d.getRootEntry()))}if(u.children||(u.children=[]),!r.findTopicEntry(s.root_entry,t)){const e=d.getEntryByMappedId(u.mapped_id),t=new h.TopicEntryWrapper(m,d,e);c&&t.setSelected(!0),a?e.getChildren().unshift(t):e.getChildren().push(t),e.toProto(),b.dispatch(w.sidebar_onAddEntry,{menuUpdated:!0,menuType:d.getType()})}}})),m.brokerService.subscribe(constants.events.topic.remove,S.deprecated(function(e,t,i){if(window.tw.pageState.hasUserFilterSettings()){const n=p.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(i),s=n.getEntryByMappedId(e),o=s.getEntryByMappedId(t);s.removeChild(o),i===constants.topic_menu.TYPE.page_monitoring&&0===s.getChildren().length&&n.getRootEntry().removeChild(s),n.unselectAll(),function(){const e={strategy:v.REFRESH},t=f.getDecorator(p.mainApplication.getPageState(),p.mainApplication,y.PAGE_STATE,e);_.refresh(t,e).then(function(){},function(e){e instanceof Error&&S.error("Error when refreshing page state after removing entry !",void 0,e)})}()}})),m.brokerService.subscribe(constants.events.panel.add,S.deprecated(function(e){m.brokerService.publish(constants.events.topic.add,[constants.root_id.source_panel,e.id,e.name,constants.topic_menu.TYPE.source_panel,!1])})),m.brokerService.subscribe(constants.events.custom_page.update,S.deprecated(function(e,t){!function(e,t,i,n){const s=p.mainApplication.getPageState().toProto(),o=g.findWhere(s.user_filter_settings.topics,{type:e});r.findTopicEntry(o.root_entry,t).name=i}(constants.topic_menu.TYPE.dashboard,constants.topic_menu.TYPE.dashboard+constants.delimiter+e.id,e.name)}));return this.addTopicCategory=function(i,n,o,r){n=void 0===n||n,o=void 0===o||o;const a=s(i,!1),c=e.defer(),l=routes.controllers.tw.TWRestForm.post("project",tw.project_id,a,"new","0","rform").url;return t.post(l,r||"{}").then(function(e){m.brokerService.publish(constants.events.topic.add,[e.parent_mapped_id,e.mapped_id,e.name,i,n,void 0,void 0,o]),c.resolve(e)},function(e){c.reject(e)}),c.promise},this.addTopicEntry=function(i,n,o,r,c,l,d){o=void 0===o||o,r=void 0===r||r;const g=s(i,!0),u=a(n),p=e.defer(),h=routes.controllers.tw.TWRestForm.post("project",tw.project_id,g,"new",u,"rform").url;return t.post(h,c||"{}").then(function(e){m.brokerService.publish(constants.events.topic.add,[e.parent_mapped_id,e.mapped_id,e.name,i,o,l,d,r]),p.resolve(e)},function(e){p.reject(e)}),p.promise},this.moveTopicEntry=function(i,n,o,r,c,l,d,g){c=void 0===c||c,l=void 0===l||l;const u=s(i,!0),p=a(n),h=e.defer(),_=routes.controllers.tw.TWRestForm.post("project",tw.project_id,u,"move",p,"rform").url;return t.post(_,d||"{}").then(function(e){m.brokerService.publish(constants.events.topic.remove,[o,r,i,c]),m.brokerService.publish(constants.events.topic.add,[e.parent_mapped_id,e.mapped_id,e.name,i,c,g,void 0,l]),h.resolve(e)},function(e){h.reject(e)}),h.promise},this.removeTopicEntry=function(i,n,s,o,r){r=!!g.isUndefined(r)||r;const a=e.defer();return t.deleter(n).then(function(e){s&&o&&m.brokerService.publish(constants.events.topic.remove,[s,o,i,r]),a.resolve(e)},function(e){a.reject(e)}),a.promise},this.saveOrder=function(i){const n={topic_menus:i},s=constants.rform.ordering,o=e.defer(),r=routes.controllers.tw.TWRestForm.post("project",tw.project_id,s,"update","","rform").url;return t.post(r,n).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveTopicEntry=function(i,n,s,o,r){o=void 0===o||o;const a=e.defer();return t.post(s,n,r).then(function(e){a.resolve(e);const t={mapped_id:e.mapped_id,name:e.name};m.brokerService.publish(constants.events.topic.update,[e.mapped_id,i,t,o])},function(e){a.reject(e)}),a.promise},this.selectTopicEntry=function(e,t,n,s,a,l,u){return function(e,t,n,s,a,l,u){const p=g.findWhere(n,{type:t}),h=g.isUndefined(u)||g.isUndefined(u.topTopicEntry)?p.root_entry:u.topTopicEntry;let m;m=s||(window.tw.pageState.isEditMode()||l?o.topic_menu.select_type.single:void 0);let _,f=window.tw.pageState.isEditMode()||l?o.topic_menu.behaviour.or:h.topic_behaviour;if(h.disabled){const t=r.findTopicEntry(h,e);_=void 0!==t&&t.selected===o.topic_entry.selected.node}(!h.disabled||h.disabled&&(!_||r.numFirstLevelSelections(h)>1))&&function(e,t,n,s,a){i=!1;const l=g.isUndefined(a)||g.isUndefined(a.topTopicEntry)?e.root_entry:a.topTopicEntry,u=l.topic_behaviour;let p;n=n||l.selection_type;let h=!1;e.type===constants.topic_menu.TYPE.tags?p=function(e,t){if(e.mapped_id===t)return r.recursiveChildrenSelect(e,constants.topic_entry.selected.none),e.selected=constants.topic_entry.selected.node,i=!1,!1;e.selected=constants.topic_entry.selected.none;const n=r.findTopicEntry(e,t);g.isUndefined(n)||(n.selected===constants.topic_entry.selected.node?n.selected=constants.topic_entry.selected.none:(n.selected=constants.topic_entry.selected.node,r.recursiveChildrenSelect(n,constants.topic_entry.selected.none),i=!0));const s=function e(t){if(!g.isUndefined(t.children)&&t.children.length>0){let n=!0;for(let s=0;s<t.children.length;s++){const o=t.children[s];o.selected===constants.topic_entry.selected.none&&(e(o)?(r.recursiveChildrenSelect(o,constants.topic_entry.selected.none),o.selected=constants.topic_entry.selected.node,i=!0):n=!1)}return n}return!1}(e);return i=i||s,!1}(l,t):n===o.topic_menu.select_type.single?p=function e(t,n,s,a,c){let l=!0;if(t.mapped_id===n)return r.recursiveChildrenSelect(t,o.topic_entry.selected.none),!0;if(!(t.children&&t.children.length>0))return!1;{const s=[];for(let a=0;a<t.children.length;a++){const c=t.children[a];if(c.mapped_id===n)c.selected&&c.selected!==o.topic_entry.selected.none?(void 0===t.children_unselect_available||t.children_unselect_available)&&(c.selected=o.topic_entry.selected.node,i=!0,l=!1):s.push(c),c.children&&r.recursiveChildrenSelect(c,o.topic_entry.selected.none);else if(c.children){const t=e(c,n,c.selected);t?s.push(c):(l=!1,c.selected=o.topic_entry.selected.none)}else c.selected===o.topic_entry.selected.node?(c.selected=o.topic_entry.selected.none,l=!1):l=!1}l?1===s.length&&t.children&&1===t.children.length?(g.each(s,function(e){e.selected=o.topic_entry.selected.node,i=!0}),l=!1):g.each(s,function(e){e.selected=o.topic_entry.selected.none}):g.each(s,function(e){e.selected=o.topic_entry.selected.node,i=!0})}return l}(l,t,l.selected):n===o.topic_menu.select_type.single_and_multiple?p=function(e,t){if(i=!0,e.mapped_id===t)return d(e,void 0,!0),!1;const n=function(e,t){const i=[];return g.each(e.children,function(e){e.category_selected=!1,e.category_mapped_id=!1,e.category_topic_mapped_id=!1,e.category_top_element_selected=!1,e.current_number_selected=0,e.final_number_selected=0,e.unselect_category=!1,e.selected===o.topic_entry.selected.node&&(e.category_top_element_selected=!0,e.category_selected=!0,e.unselect_category=!0),e.mapped_id===t&&(e.category_mapped_id=!0),e.children&&(g.each(e.children,function(i){i.topic_selected=!1,i.topic_mapped_id=!1,i.selected===o.topic_entry.selected.node&&(i.topic_selected=!0,e.category_selected=!0,e.current_number_selected++,e.final_number_selected++),i.mapped_id===t&&(e.category_topic_mapped_id=!0,i.topic_mapped_id=!0,i.selected===o.topic_entry.selected.none?e.final_number_selected++:e.final_number_selected--)}),(0===e.final_number_selected&&e.category_topic_mapped_id&&!e.category_top_element_selected||e.final_number_selected===e.children.length)&&(e.category_mapped_id=!0)),i.push(e)}),i}(e,t);return g.each(n,function(e){e.category_mapped_id||e.category_topic_mapped_id?(e.selected=e.category_mapped_id?o.topic_entry.selected.node:o.topic_entry.selected.none,e.selected===o.topic_entry.selected.node?(r.recursiveChildrenSelect(e,o.topic_entry.selected.none),e.unselect_category&&(e.selected=o.topic_entry.selected.none)):e.category_topic_mapped_id&&g.each(e.children,function(t){e.current_number_selected>1&&t.topic_selected&&t.topic_mapped_id?t.selected=o.topic_entry.selected.none:t.topic_mapped_id||t.topic_selected?t.selected=e.category_top_element_selected?o.topic_entry.selected.none:o.topic_entry.selected.node:t.selected=e.category_top_element_selected?o.topic_entry.selected.node:o.topic_entry.selected.none})):(e.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(e,o.topic_entry.selected.none))}),!1}(l,t):n===o.topic_menu.select_type.multiple?p=function e(t,n,s,a,c){let l=!0;if(t.mapped_id===n)return r.recursiveChildrenSelect(t,o.topic_entry.selected.none),t.selected===o.topic_entry.selected.none;if(t.children&&t.children.length>0){const d=[];for(let i=0;i<t.children.length;i++){const s=t.children[i];if(s.mapped_id!==n||!g.isUndefined(c)&&t.mapped_id!==c)if(s.children){const t=e(s,n,s.selected===o.topic_entry.selected.node,a+1,c);t?d.push(s):(l=!1,s.selected=o.topic_entry.selected.none)}else s.selected===o.topic_entry.selected.node?d.push(s):l=!1;else s.selected&&s.selected!==o.topic_entry.selected.none?(void 0===t.children_unselect_available||t.children_unselect_available)&&(s.selected=o.topic_entry.selected.none):d.push(s),s.children&&r.recursiveChildrenSelect(s,o.topic_entry.selected.none)}l?d.length===t.children.length?(r.recursiveChildrenSelect(t,o.topic_entry.selected.none),i=!1):(g.each(d,function(e){e.selected=o.topic_entry.selected.node}),i=!0,l=!1):(g.each(d,function(e){e.selected=o.topic_entry.selected.node}),1===t.children.length?l=!1:d.length>0&&(i=!0),s&&0===d.length&&1===a&&(l=!0))}else l=!1;return l}(l,t,l.selected===o.topic_entry.selected.node,0,a.parentMappedId):n===o.topic_menu.select_type.opposite?p=function(e,t){let n=g.findWhere(t,{mapped_id:e}),s=!0;if(n.selected===o.topic_entry.selected.none){const e=g.indexOf(t,n),i=t.length,s=i/2;e<s&&t[s+e].selected===constants.topic_entry.selected.node?t[s+e].selected=constants.topic_entry.selected.none:e>=s&&t[e-s].selected===constants.topic_entry.selected.node&&(t[e-s].selected=constants.topic_entry.selected.none),n.selected=constants.topic_entry.selected.node}else n.selected=constants.topic_entry.selected.none;r.childrenSelectedRecursive(t)&&(s=!1,i=!0);return s}(t,l.children):(h=!0,t!==l.mapped_id?(l.selected===o.topic_entry.selected.node&&(l.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(l,o.topic_entry.selected.node)),function e(t,n){if(t.mapped_id===n)return r.recursiveChildrenSelect(t,o.topic_entry.selected.none),t.selected=t.selected===o.topic_entry.selected.node?o.topic_entry.selected.none:o.topic_entry.selected.node,i=!0,!0;if(!t.children||0===t.children.length)return!1;const s=t.selected===o.topic_entry.selected.node;s&&c(t,n)&&(t.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(t,o.topic_entry.selected.node));const a=g.find(t.children,function(t){return e(t,n)});if(!g.isUndefined(a))return C(t),!0;return!1}(l,t)):i=d(l,void 0,!0));p?l.selected=o.topic_entry.selected.node:i||u!==o.topic_menu.behaviour.or?h||u===o.topic_menu.behaviour.or&&!i||(l.selected=o.topic_entry.selected.none):l.selected=o.topic_entry.selected.node}(p,e,m,0,u);if(t!==constants.topic_menu.TYPE.event||t===constants.topic_menu.TYPE.event&&window.tw.pageState.isEditMode()){const e=g.filter(n,function(e){return e.type!==t});f===o.topic_menu.behaviour.or&&e&&g.each(e,function(e){f=window.tw.pageState.isEditMode()||l?o.topic_menu.behaviour.or:e.root_entry.topic_behaviour,function(e,t){(t=t||e.root_entry.topic_behaviour)!==o.topic_menu.behaviour.and&&(e.root_entry.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(e.root_entry,o.topic_entry.selected.none))}(e,f)})}return!tw.pageState.isEditMode()}(e,t,n,s,0,l,u)},this.updateTopicMenuName=function(e){m.brokerService.publish(constants.events.topic_menu.refresh_name,[e])},this.validateLinkedMenuSelection=function(e,t,i){let s=e.getFirstSelectedEntryRecursively(),o=t.getFirstSelectedEntryRecursively();if(!g.isUndefined(s)&&!g.isUndefined(o)){for(;s.getParent()!==e.getRootEntry();)s=s.getParent();for(;o.getParent()!==t.getRootEntry();)o=o.getParent();if(s&&o){const e=s.getMappedId(),r=E(e),a=E(o.getMappedId());if(!g.contains(i,s.getMappedId())&&r===a){const e=n[r],i=g.find(t.getRootEntry().getChildren(),function(t){return!g.contains(e,t.getMappedId())&&!t.isNotSelectable()});if(!g.isUndefined(i))return t.unselectAll(),i.selectFirstSelectableEntry(),!0}}}return!1},this.preparePageStateForPreview=function(e,t){const i=new u.BuildParametersWrapper({preview_topic_id:t});return e.getUserFilterSettings().setBuildParameters(i),e},this;function s(e,t){let i;return i=t?constants.rform.topic_entry[e]:constants.rform.topic_category[e]}function a(e){return e?"0"+constants.delimiter+e:"0"}function c(e,t){if(g.isUndefined(e))return!1;const i=g.find(e.children,function(e){return e.mapped_id===t});return!g.isUndefined(i)}function l(e){let t=0;return g.isUndefined(e)||g.isUndefined(e.children)?0:(g.each(e.children,function(e){e.visibility===o.topic_entry.visibility.visible&&++t}),t)}function d(e,t,i){let n,s=!1;return n=g.isUndefined(t)?g.find(e.children,function(e){return l(e)>0}):g.find(e.children,function(e){return e.mapped_id===t}),i&&!g.isUndefined(n)&&n.selected===o.topic_entry.selected.node&&1===function e(t){let i=0;return g.isUndefined(t)?0:(t.selected===o.topic_entry.selected.node&&++i,g.each(t.children,function(t){i+=e(t)}),i)}(e)?(e.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(e,o.topic_entry.selected.none),!0):(e.selected=o.topic_entry.selected.none,r.recursiveChildrenSelect(e,o.topic_entry.selected.none),!g.isUndefined(n)&&l(n)>0?(n.selected=o.topic_entry.selected.node,s=!0):g.isUndefined(n)||(n.selected=o.topic_entry.selected.node,s=!0),s)}function C(e){let t=!0;g.each(e.children,function(e){e.visibility===o.topic_entry.visibility.visible&&e.selected!==o.topic_entry.selected.node&&(t=!1)}),t&&(e.selected=o.topic_entry.selected.node,r.recursiveChildrenSelect(e,o.topic_entry.selected.none))}function E(e){return g.findIndex(n,function(t){return g.contains(t,e)})}}]}),define("services/topic_menu_service",["require","exports","underscore","wrappers/topic_menu/topic_entry_wrapper","services/tw_common","services/broker"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["restFormService","$q",function(e,t){return{addTopicCategory:function(s,o,r){r=void 0===r||r;const a=constants.rform.topic_category[s.getType()],c=t.defer(),l=routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,a,"new","0","rform").url;return e.post(l,i.isUndefined(o)?"{}":o).then(function(e){const t=n.TopicEntryWrapper.create(e.mapped_id,e.name);s.getRootEntry().addChild(t),r&&t.setSelected(!0),c.resolve(t)},function(e){c.reject(e)}),c.promise},addTopicEntry:function(s,o,r,a,c){a=void 0===a||a;const l=constants.rform.topic_entry[s.getType()],d=i.isUndefined(r)?"0":"0"+constants.delimiter+r,g=t.defer(),u=routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,l,"new",d,"rform").url;return e.post(u,i.isUndefined(o)?"{}":o).then(function(e){if(!s.hasEntryByMappedId(e.parent_mapped_id)&&s.getType()===constants.topic_menu.TYPE.page_monitoring){const t=e.parent_mapped_id.substring(e.parent_mapped_id.indexOf(constants.delimiter)+1),i=n.TopicEntryWrapper.create(e.parent_mapped_id,constants.social_media_accounts[t].name);s.getRootEntry().addChild(i)}const t=n.TopicEntryWrapper.create(e.mapped_id,e.name),o=s.getEntryByMappedId(e.parent_mapped_id);i.isUndefined(c)?o.addChild(t):o.addChildAtIndex(t,c),a&&s.selectEntry(t),g.resolve(t)},function(e){g.reject(e)}),g.promise},saveOrder:function(n){const s={topic_menus:i.map(n,function(e){return e.toProto()})},o=constants.rform.ordering,r=t.defer(),a=routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,o,"update","","rform").url;return e.post(a,s).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getMenuName:function(e){return e.getType()===constants.topic_menu.TYPE.event||e.getType()===constants.topic_menu.TYPE.time_filter?constants.navbar.filter_translation.TIME_FILTER:e.getRootEntry().getName()},unselectFilterEntry:function(e,t,n){t.getType()===constants.topic_menu.TYPE.time_filter?n.getTimeFilter().reset(n):t.getType()===constants.topic_menu.TYPE.event?(t.selectEntry(e),t.containsSelection()||n.getTimeFilter().reset(n)):t.getType()===constants.root_id.searchbar?n.getSearchbarFilter().reset():t.getType()===constants.topic_menu.TYPE.topic?(t.selectEntryByStrategy(e,s.twCommon.selectionStrategies.MULTIPLE),t.getRootEntry().containsSelection(!0)||t.getRootEntry().setSelected(!0)):t.selectEntry(e);const r=i.contains([constants.topic_menu.TYPE.time_filter,constants.topic_menu.TYPE.event],t.getType());n.getHolderType()===s.twCommon.holderTypes.PAGE&&r&&o.brokerService.publish(constants.events.time_filter.update,[!1])}}}]}),define("services/version_service",["require","exports","reusable_utilities","services/context","services/rest_form_service"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){const e=_.debounce(()=>this.onContextSwitch(),500);window.addEventListener("hashchange",e),t.versionService=this}checkVersionUnchanged(e){if(window.isExport)return Promise.resolve();const t=new i.Url(decodeURIComponent(window.location.href)).getUrlParameters();let n,o="";return void 0!==t.mobile?o=`&mobile=${t.mobile}`:this.isMobile()&&(o="&mobile=true"),n="project"!==e.scope&&"account"!==e.scope||"0"===e.id?"/app/none/none/bootstrap":`/app/${e.scope}/${e.id}/bootstrap`,n+=o,new Promise((e,t)=>{s.restFormService.get(n).then(i=>{window.bootPayload.oldVersionSystem&&void 0===i.version||!window.bootPayload.oldVersionSystem&&i.version===window.bootPayload.version?e():t()})})}isMobile(){return-1!==window.navigator.userAgent.indexOf("Mobi")}async onContextSwitch(){if(-1===location.href.indexOf("rform/reset_password")&&-1===location.href.toLowerCase().indexOf("#/command_center")&&-1===location.hash.indexOf("#/COMMAND_CENTER_OVERVIEW"))try{await this.checkVersionUnchanged(n.contextService.getCurrentContext())}catch(e){window.location.reload(!0)}}}}),define("services/moment_service",["require","exports","event_bus","classes/context_data/context_data","moment-timezone"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.initMomentMetadata(),this.subscribeContextSwitch()}subscribeContextSwitch(){i.eventBus.subscribe(i.EVENT_TYPES.ON_CONTEXT_SWITCH,e=>{this.initMomentMetadata()})}initMomentMetadata(){s.locale(n.contextData.commonPropertiesContainer.interface_language),s.tz.setDefault(n.contextData.commonPropertiesContainer.timezone)}}}),define("entry_point/configurations/angular_configuration/angular_modules/components_core",["require","exports","angular","controllers/main_controller","controllers/navbar","controllers/rest_form/page/embed","components/constant/directive","components/message/directive","components/navbar/directive","services/replay_manager","services/article_sources","services/broker","services/browser_detection_service","services/bubble_dialog","services/calendar","services/canvas_chart","services/comments","services/configuration","services/confirmation_service","services/context","services/custom_pages","services/custom_timezones","services/embedded_widget","services/filter","services/fullscreen","services/icons","services/injector","services/loading_bubble","services/modal","services/navigation","services/pin","services/popover","services/quick_search","services/rest_form_service","services/scripts_loading","services/session","services/shared_entities","services/sma_service","services/store","services/theme","services/time","services/topic","services/topic_menu_service","services/tw_number_formatter","services/tw_routing","services/version_service","services/moment_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q,V){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_core",[]).controller("mainController",n.default).controller("navbarController",s.default).controller("embedController",o.default).directive("twConstant",r.default).directive("twMessage",a.default).directive("twNavbar",c.default).factory("ReplayManagerFactory",l.default).service("articleSourcesService",d.default).service("brokerService",g.default).service("browserDetectionService",u.default).service("bubbleDialogService",p.default).service("calendarService",h.default).service("canvasChartService",m.default).service("commentsService",_.default).service("configurationService",f.default).service("confirmationService",y.default).service("contextService",v.default).service("customPagesService",S.default).service("customTimezonesService",b.default).service("embeddedWidgetService",w.default).service("filterService",C.default).service("fullscreenService",E.default).service("iconsService",T.default).service("injector",M.default).service("loadingBubbleService",P.default).service("modalService",D.default).service("navigationService",A.default).service("pinService",I.default).service("popoverService",x.default).service("quickSearchService",R.default).service("restFormService",F.default).service("scriptsLoadingService",O.default).service("sessionService",k.default).service("sharedEntitiesService",N.default).service("smaService",L.default).service("storeService",B.default).service("themeService",W.default).service("timeService",U.default).service("topicService",G.default).service("topicMenuService",$.default).service("twNumberFormatter",j.default).service("twRoutingService",H.default).service("versionService",q.default).service("momentService",V.default)}),define("react_components/bubble_dialogs/components/interfaces/crop_image_bubble_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/crop_image_bubble_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/crop_image_bubble_dialog",["require","exports","event_bus","flux","react","reusable_components","reusable_utilities","classes/context_data/context_data","services/context","services/rest_form_service","react_components/form/progress_button/progress_button_container","services/theme"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});class u extends n.BaseComponent{render(){return s.createElement("div",{className:"tw-bubble-dialog-crop-image"},this.generateHeader(),this.generateBody())}generateHeader(){return s.createElement("div",{className:"header"},s.createElement("h2",null,a.contextData.getMessage("_1132466"),s.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}generateBody(){const{cropCircle:e,id:t}=this.props.payload;return s.createElement("div",{className:"body"},s.createElement("form",{className:"form-horizontal"},s.createElement("div",{className:"form-group no-border-bottom"},s.createElement(o.CropComponentRenderable,{imageUrl:this.generateBase64Image(),cropCircle:e,containerId:t,placeholderColor:g.themeService.getBrandingColor()}))),this.generateButtons())}generateButtons(){return s.createElement("div",{className:"tw-buttons clearfix"},s.createElement(d.ProgressButtonContainer,{text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),clickEvent:this.handleSave.bind(this),className:"tw-button pull-right",disabled:!1}))}handleSave(){i.eventBus.dispatch({type:i.EVENT_TYPES.CROP_IMAGE,value:this.props.payload.id}),this.props.destroy()}async generateBase64Image(){const{imageUrl:e}=this.props.payload;return e.startsWith("http")?l.restFormService.get(`/app/project/${c.contextService.getCurrentContext().id}/image_base64_fetch/${encodeURIComponent(e)}`):e}clickInside(e){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.CropImageBubbleDialog=u,r.applyMixins(u,[n.DocumentClickTracker])}),define("components/edit_mode/topic/directive",["require","exports","angular","angular_utilities","components/form/common/topic_menu","event_bus","jquery","lazy","log","react","reusable_components","reusable_utilities","underscore","classes/application/application","classes/bubble_dialog/widget_dialog_config","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","other/tw","react_components/bubble_dialogs/components/crop_image_bubble_dialog","services/broker","services/bubble_dialog","services/configuration","services/confirmation_service","services/modal","services/refresh/model_refresh_service","services/rest_form_service","services/template_source","components/bubble_dialog/react/diff_history_query"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"AE",replace:!0,bindToController:{topic:"=",excludeOnly:"=",messages:"=",onSave:"=?",onCancel:"=?",hideHistory:"=?",hidePreview:"=?"},scope:{},controllerAs:"vm",controller:I,link:x,templateUrl:D.templateSourceFactory("components/edit_mode/topic")}};let I=class{constructor(e,t,i){this.$scope=e,this.$timeout=t,this.topicService=i}$onInit(){const{$scope:e,$timeout:t,topicService:n}=this;e.selectedQuery=[],e.topic=this.topic,e.onSave=this.onSave,e.onCancel=this.onCancel,e.hideHistory=this.hideHistory,e.hidePreview=this.hidePreview,e.changeTopicColor=(t=>e.topic.color=t),e.shouldDisplayImageField=m.contextData.rules.isImageDetectionEnabled(),e.save_action=constants.events.form.action.post,e.showExclusions=e.topic.search_query.search_query_item.exclude.search_query_items.length>0,e.showRebuild=!1,e.showSampling=!1,e.noteExists=!!e.topic.description,e.getNotification=function(e){return e.notification.map(e=>e.message).join(" - ")},e.hasNotification=function(e){return void 0!==e&&void 0!==e.notification&&0!==e.notification.length},e.isSamplingEnabled=function(){return m.contextData.isFeatureEnabled("TOPIC_SAMPLING")},e.cancel=(async()=>{if(v.tw.pageState)try{return await R()}catch(e){e instanceof Error&&c.logService.error("Error when refreshing page state after cancelling !",void 0,e)}this.onCancel&&this.onCancel()}),e.isTopic=(()=>e.topic.type===window.constants.edit_type.topic),e.isFilter=(()=>e.topic.type===window.constants.edit_type.filter),e.isSearch=(()=>e.topic.type===window.constants.edit_type.search),e.isEditing=(t=>void 0!==e.selectedQuery[t]),e.getLocation=(t=>e.isFilter()?"FILTER_SETUP":t?"TOPIC_SETUP_INCLUDE":"TOPIC_SETUP_EXCLUDE"),e.save=function(n,o,r){if(e.noteExists=!!e.topic.description,e.search_query_item_blank.include.text&&void 0===r)return void(e.isEditing("include")?e.edit("include"):e.addSearchQueryItem("include",!0,o));if(e.search_query_item_blank.exclude.text&&void 0===r)return void(e.isEditing("exclude")?e.edit("exclude"):e.addSearchQueryItem("exclude",!0,o));if(!n&&0===e.topic.search_query.search_query_item.include.search_query_items.length&&!e.isFilter())return e.hasError=!0,void(e.noIncludeError=!0);e.isFilter()&&!e.canShowProximityFilter()&&(e.topic.word_distance_filter_active=!1,e.topic.word_distance_filter=0);e.topic.queries_only=!!n;const l=JSON.parse(JSON.stringify(e.topic));if(l.thumbnail=e.topic.thumbnail,void 0!==r){const t=u(e.topic.search_query.search_query_item[r.type].search_query_items).indexOf(e.selectedQuery[r.type]),i=l.search_query.search_query_item[r.type].search_query_items[t];void 0!==i&&(i.text=r.form.search_query_items[0].text);for(let e=r.form.search_query_items.length-1;e>0;e--)l.search_query.search_query_item[r.type].search_query_items.push(r.form.search_query_items[e])}P.restFormService.postMultipart(e.topic.save_link,l).then(l=>{let d;if(void 0!==r){const t=u(e.topic.search_query.search_query_item[r.type].search_query_items).indexOf(e.selectedQuery[r.type]);for(e.selectedQuery[r.type].text=r.form.search_query_items[0].text,d=r.form.search_query_items.length-1;d>0;d--)e.topic.search_query.search_query_item[r.type].search_query_items.splice(t+1,0,{text:r.form.search_query_items[d].text});e.search_query_item_blank[r.type]={},e.cancelEdit(r.type)}if(v.tw.pageState&&i.isDefined(v.tw.pageState.getUserFilterSettings())){const t=v.tw.pageState.getUserFilterSettings();let i,o;for(let n=0;n<t.getTopics().length&&(o=t.getTopics()[n].toProto(),!(i=s.findTopicEntry(o.root_entry,e.topic.mapped_id)));n++);if(!e.topic.categories_menu)return;const r=s.getSelectedValueRecursive(e.topic.categories_menu.root_entry);if(s.changeEntryParent(o.root_entry,i,r.mapped_id),e.topic=l,e.topic.mapped_id!==i.mapped_id&&(i.mapped_id=e.topic.mapped_id),!n)try{R()}catch(e){e instanceof Error&&c.logService.error("Error when refreshing page state after toggling edit mode !",void 0,e)}}!function(e){t(function(){a(e).filter(e=>void 0!==e).each(e=>e.$setPristine())})}(o),this.onSave&&!0!==n&&this.onSave()},t=>{e.topic.field_messages=t.field_messages})},e.edit=function(t,i=[]){const n={search_query_items:x(t)};P.restFormService.post(e.topic.search_query.search_query_item[t].link_add,n).then(function(n){e.save(!0,i,{form:n,type:t})},function(t){e.topic.field_messages=t.field_messages})},e.addSearchQueryItem=function(t,n,s){e.hasError=!1;const o=e.search_query_item_blank[t].text,r=i.isUndefined(o)?[]:o.split("\n"),c={search_query_items:a(r).filter(e=>void 0!==e&&""!==e).map(e=>({text:e})).toArray()};P.restFormService.post(e.topic.search_query.search_query_item[t].link_add,c).then(function(i){u(i.search_query_items).each(function(i){e.topic.search_query.search_query_item[t].search_query_items.push(i)}),e.search_query_item_blank[t]={},e.save(!n,s)},function(t){e.topic.field_messages=t.field_messages})},e.canShowProximityFilter=function(){return 0===e.topic.search_query.search_query_item.exclude.search_query_items.length&&m.contextData.rules.isProximityFilterEnabled()},e.cancelEdit=I,e.editSearchQueryItem=function(t,i,n){n.preventDefault(),e.search_query_item_blank[i]={text:t.text},e.selectedQuery[i]=t},e.removeSearchQueryItem=function(t,i,n){n.preventDefault(),E.confirmationService.display({message:m.contextData.getMessage("_303179")}).then(()=>{const n=e.topic.search_query.search_query_item[i].search_query_items;e.topic.search_query.search_query_item[i].search_query_items=u(n).without(t),e.save(!0),I(i)},()=>void 0)},e.addToNewGroup=function(t){const o=v.tw.pageState.getUserFilterSettings();let r,a;for(let e=0;e<o.getTopics().length&&(a=o.getTopics()[e].toProto(),!(r=s.findTopicEntry(a.root_entry,t.parentMappedId)));e++);function c(n){p.mainApplication.getPageState().getUserFilterSettings().getFirstTopicMenuByPredicate(e=>e.hasEntryByMappedId(t.parentMappedId)).toProto();const o=s.findTopicEntry(a.root_entry,n.mapped_id);s.recursiveChildrenSelect(e.topic.categories_menu.root_entry,window.constants.topic_entry.selected.none);const r=i.fromJson(i.toJson(o));r.selected=window.constants.topic_entry.selected.node,e.topic.categories_menu.root_entry.children.push(r)}T.modalService.display("ADD_TOPICS_CATEGORY",{name:""}).then(function(e){n.addTopicCategory(a.type,!1,!1,{name:e.name}).then(c)})},e.changeCustomColor=function(t){T.modalService.display("TOPIC_CUSTOM_COLOR",t).then(function(t){e.changeTopicColor(t.mapped_id),s.recursiveChildrenSelect(e.topic.colors_menu.root_entry,window.constants.topic_entry.selected.none),t.selected=window.constants.topic_entry.selected.node})},e.toggleShowExclusions=function(){e.showExclusions=!e.showExclusions},e.toggleShowRebuild=function(){e.showRebuild=!e.showRebuild},e.toggleShowSampling=function(){e.showSampling=!e.showSampling},e.canShowRebuild=function(){return e.isTopic()&&m.contextData.rules.isUserRebuildSettingsVisible()},e.updateTopicMenuName=function(e){n.updateTopicMenuName(e)},e.showUpdatedTimeStamp=function(){return!m.contextData.rules.isOriginalUserEnabled()&&i.isDefined(e.topic.last_change_time)},e.imageEntityForm={value:""},e.appendToQuery=function(t,i){e.search_query_item_blank[t].text=`${e.search_query_item_blank[t].text||""}\n${i.value}\n`,i.value=""},e.previewTextAreaIncludeSearchQueryItems=function(){const t={search_query_items:x("include")};P.restFormService.post(e.topic.preview_query_link,t).then(function(e){const t=function(e){return n.preparePageStateForPreview(p.mainApplication.getPageState().clone(),e)}(e.preview_topic_id),i=C.configurationService.getBubbleDialogConfiguration().getStyle(window.constants.bubble_dialog.id.widget);i.setAbsoluteY(window.pageYOffset+50),w.bubbleDialogService.destroyById(window.constants.bubble_dialog.id.widget);const s=new h.WidgetDialogConfig(t,{groupPage:"CONTEXT_MENU",pageType:window.constants.page_type.context_menu_preview,ufs:t.getUserFilterSettings(),setAllowedPagesReloadFlag:!0,style:i});s.setTargetElement(r(".page__content")),w.bubbleDialogService.createWidgetDialogBubble(s)})},e.openHistory=function(e){delete this.topic.compare_type,delete this.topic.length_histories,delete this.topic.start_history_id,P.restFormService.postRForm(this.topic.type,"info",Object.assign(this.topic,{compare_type:"COMPARE_WITH_PREVIOUS",length_histories:10,item_history_id:e})).then(t=>{const i=t.search_query_histories,n=C.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.diff_explorer);n.setAbsoluteY(window.pageYOffset+50),w.bubbleDialogService.createReactBubble(constants.bubble_dialog.id.diff_explorer,r("#page_content"),{query:A.topicHistoryQuery(i,this.topic.id,this.topic.type,t.last_history_id,!0,!1,e)},e=>l.createElement(d.DiffExplorer,{query:e.query,close:function(e){return function(){e.destroy();try{R()}catch(e){e instanceof Error&&c.logService.error("Error when refreshing page state after diff explorer closing !",void 0,e)}}}(e)}),n)})},e.samplingToPercent=function(e){return e+"%"},e.canShowPreviewButton=function(){return!e.isFilter()||void 0!==e.topic.preview_query_link},e.getAvatarOrLogoSize=function(){return F},e.getDefaultInitials=function(){return function(){if(e.topic.name){const t=e.topic.name.split(" ");if(1===t.length)e.topic.default_initials=t[0].charAt(0).toUpperCase();else{if(!(t.length>1))throw new Error("topic name words array length is less than 1");e.topic.default_initials=(t[0].charAt(0)+t[1].charAt(0)).toUpperCase()}}}(),e.topic.default_initials},e.removeDefaultAvatarOrLogo=function(){e.topic.use_default_avatar_or_logo=!0,e.topic.custom_image_url=""},e.getQuickUploadId=function(){return O},e.getQuickUploadIconTooltip=function(){return k},e.getQuickUploadMessage=function(){return N},e.isImpersonating=(()=>!m.contextData.rules.isOriginalUserEnabled()||!1),this.showHistorySubscription=b.brokerService.subscribe(constants.events.topic.show_history,t=>{t===e.topic.mapped_id&&e.openHistory()}),e.$on("suggestionInserted",()=>t(()=>e.appendToQuery("include",e.imageEntityForm),10));const D=new g.CancellationToken;function I(t){e.selectedQuery[t]=void 0,e.search_query_item_blank[t]={}}function x(t){const i=e.search_query_item_blank[t].text;return a(void 0===i?[]:[i]).filter(e=>void 0!==e&&""!==e).map(e=>({text:e})).toArray()}async function R(){const e={strategy:f.ModelRefreshStrategy.REFRESH},t=_.modelRefreshDecoratorFactory.getDecorator(p.mainApplication.getPageState(),p.mainApplication,y.ModelType.PAGE_STATE,e);return await M.modelRefreshService.refresh(t,e)}D.subscribeToStream(o.eventBus,o.EVENT_TYPES.QUICK_UPLOAD_SUBMIT,e=>{const{id:t,image:i}=e.value;if(t===O){const e=constants.bubble_dialog.id.crop_image,n=C.configurationService.getBubbleDialogConfiguration().getStyle(e);n.setAbsoluteY(window.innerHeight/4-n.minHeight/4);const s={id:t,imageUrl:i,cropCircle:!0};w.bubbleDialogService.createReactBubble(e,r("body"),s,e=>(e.payload=s,l.createElement(S.CropImageBubbleDialog,{payload:e.payload,destroy:e.destroy})),n,{preventOutsideClickActions:!0,fadeBackground:!0})}}),D.subscribeToStream(o.eventBus,o.EVENT_TYPES.IMAGE_WAS_CROPPED,t=>{t.value.containerId===O&&t.value.imageUrl&&(e.topic.custom_image_url=t.value.imageUrl,e.topic.use_default_avatar_or_logo=!1,e.$$phase||e.$apply())}),e.$on("$destroy",()=>{b.brokerService.unsubscribe(constants.events.topic.show_history,this.showHistorySubscription),D.cancel()});const F="75px";const O=u.uniqueId("quick-upload");const k=m.contextData.getMessage("_1056455");const N=m.contextData.getMessage("_1565201")}};function x(e){e.search_query_item_blank={include:{},exclude:{}}}I=__decorate([n.ngInject(["$scope","$timeout","topicService"]),__metadata("design:paramtypes",[Object,Function,Object])],I)}),define("entry_point/configurations/angular_configuration/angular_modules/components_edit_mode",["require","exports","angular","components/edit_mode/dashboard/directive","components/edit_mode/directive","components/edit_mode/event/directive","components/edit_mode/events/directive","components/edit_mode/page_monitoring/directive","components/edit_mode/page_monitoring/group/directive","components/edit_mode/page_monitoring/logo/directive","components/edit_mode/project/setup_description/directive","components/edit_mode/topic/directive","components/edit_mode/topic_categories/directive","components/edit_mode/topic_category/directive","components/rebuild/directive","components/edit_mode/web_connector/overview/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_editMode",[]).directive("twEditDashboard",n.default).directive("twEdition",s.default).directive("twEditEvent",o.default).directive("twEditEvents",r.default).directive("twPagesMonitoring",a.default).directive("twPmGroup",c.default).directive("twPageLogo",l.default).directive("twProjectSetupDescription",d.default).directive("twEditTopicElement",g.default).directive("twEditTopicCategories",u.default).directive("twEditTopicCategory",p.default).directive("twRebuild",h.default).directive("twWebConnectorsOverview",m.default)}),define("react_components/filters/components/horizontal_filter/horizontal_filter_container",["require","exports","react","flux","reusable_components","services/icons","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.HorizontalFilterContainer=class extends n.BaseComponent{constructor(e){super(e),this.constants={iconMap:{star1:{icon:o.iconService.getIcon("star"),count:1,className:"tw-btn-icon button rating"},star2:{icon:o.iconService.getIcon("star"),count:2,className:"tw-btn-icon button rating"},star3:{icon:o.iconService.getIcon("star"),count:3,className:"tw-btn-icon button rating"},favourites:{icon:o.iconService.getIcon("favorite"),count:1,className:"tw-btn-icon button favorite"}},messages:{more:r.contextData.getMessage("talkwalker_menu_filter_more")}},this.state={menu:s.FilterStore.getInstance().getTopicMenuByType(this.props.topicMenuType),menuTransformation:s.FilterStore.getInstance().getMenuTransformation(this.props.topicMenuType)}}componentDidMount(){this.cancellationToken.subscribe(s.FilterStore.getInstance().onChange,e=>{this.checkNewPageState(e),this.checkSelectionChange(e),this.checkFilterAdded(e)})}checkNewPageState(e){e.newPageState&&this.recalculateAll()}checkSelectionChange(e){e.selectionChange&&e.topicMenuType===this.state.menu.type&&this.recalculateAll()}checkFilterAdded(e){e.filterAdded&&this.recalculateAll()}recalculateAll(){this.setState({menu:s.FilterStore.getInstance().getTopicMenuByType(this.props.topicMenuType)})}render(){let{menu:e,menuTransformation:t}=this.state;return e=t(JSON.parse(JSON.stringify(e))),i.createElement(s.HorizontalFilter,{menu:e,constants:this.constants})}}}),define("components/filter/menu/horizontal/directive",["require","exports","react","react_components/filters/components/horizontal_filter/horizontal_filter_container","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.HorizontalFilterContainer,{topicMenuType:e.menu.getType()}),{menu:"="})}),define("react_components/filters/components/filter_options/filter_options_container",["require","exports","react","reusable_components","flux","reusable_utilities","log","services/tw_common","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends s.BaseComponent{constructor(e){super(e),this.state=this.initializeState(this.props)}componentDidMount(){this.cancellationToken.subscribe(n.FilterOptionStore.getInstance().onChange,e=>{e.topicMenuType===this.props.topicMenu.type&&(e.forceClose||1===this.state.optionsSections.length&&1===this.state.optionsSections[0].options.length?this.close():this.forceUpdate())})}getOptionsSections(e){if(void 0===e.topicMenu||void 0===e.topicMenu.type)throw new Error("All props must be defined");const t=[];if(n.FilterStore.getInstance().isGroupable(e.topicMenu.type)||n.FilterStore.getInstance().isPinnable(e.topicMenu.type)){const i={title:c.contextData.getMessage("_489498"),options:[]};n.FilterStore.getInstance().isGroupable(e.topicMenu.type)&&this.buildGroupingOption(i),n.FilterStore.getInstance().isPinnable(e.topicMenu.type)&&this.buildPinningOption(i),[constants.topic_menu.TYPE.pmg_source_brandgroup,constants.topic_menu.TYPE.pmg_publication_unit].includes(e.topicMenu.type)&&this.buildSortingOption(i),i.options.length>0&&t.push(i)}if(n.FilterStore.getInstance().canInvertSelection(e.topicMenu.type)||void 0!==this.props.topicMenu.filter_behaviour){const i={title:c.contextData.getMessage("_1806863"),options:[]};n.FilterStore.getInstance().canInvertSelection(e.topicMenu.type)&&this.buildInvertSelection(i),void 0!==e.topicMenu.filter_behaviour&&this.buildFilterBehaviourOption(i),i.options.length>0&&t.push(i)}return t}buildGroupingOption(e){const t=this,i={style:"",icon:"icon2-tw-group",clickAction:n.FilterOptionMenuActions.filterOptions_toggleGroupFilter,get name(){let e;switch(t.props.topicMenu.type){case constants.topic_menu.TYPE.countries:e=c.contextData.getMessage("_549457",[c.contextData.getMessage("_001151").toLowerCase()]);break;case constants.topic_menu.TYPE.languages:e=c.contextData.getMessage("_549457",[c.contextData.getMessage("_001153").toLowerCase()]);break;case constants.topic_menu.TYPE.media_type:e=c.contextData.getMessage("_549457",[c.contextData.getMessage("_144866").toLowerCase()]);break;case constants.topic_menu.TYPE.tags:e=c.contextData.getMessage("_549457",[c.contextData.getMessage("_188741").toLowerCase()]);break;default:e=c.contextData.getMessage("_549457",[""]),r.logService.warn("Unknown filter option group type: "+t.props.topicMenu.type,a.twCommon.logFeatures.FilterOptionContainer)}return e},get selected(){return t.props.topicMenu.grouping===constants.topic_menu.grouping.grouped},clickData:{topicMenu:this.props.topicMenu},type:n.FilterOptionType.ICON_LABEL};e.options.push(i)}buildPinningOption(e){const t=this,i={style:"",icon:"fa fa-thumb-tack",clickAction:n.FilterOptionMenuActions.filterOptions_toggleFilterPin,name:c.contextData.getMessage("_479055"),get selected(){return!!t.props.topicMenu.pinned},clickData:{topicMenu:this.props.topicMenu},type:n.FilterOptionType.ICON_LABEL};e.options.push(i)}buildSortingOption(e){const t=this,i={style:"",icon:"fa fa-sort-numeric-desc",clickAction:n.FilterOptionMenuActions.filterOptions_toggleFilterSort,name:c.contextData.getMessage("_1489849"),get selected(){return"HITS"===t.props.topicMenu.sorting},clickData:{topicMenu:this.props.topicMenu},type:n.FilterOptionType.ICON_LABEL};e.options.push(i)}buildFilterBehaviourOption(e){const t=this,i={buttons:[{name:c.contextData.getMessage("_1921632"),get selected(){return"OR"===t.props.topicMenu.filter_behaviour}},{name:c.contextData.getMessage("_1750639"),get selected(){return"AND"===t.props.topicMenu.filter_behaviour}}],style:"",clickAction:n.FilterOptionMenuActions.filterOptions_onChangeFilterBehaviour,clickData:{menuType:this.props.topicMenu.type},type:n.FilterOptionType.TOGGLE_BUTTONS};e.options.push(i)}buildInvertSelection(e){const t={style:"",icon:"fa fa-exchange invert-select",clickAction:n.FilterOptionMenuActions.filterOptions_onInvertSelection,name:c.contextData.getMessage("_1918016"),selected:!1,clickData:{menuType:this.props.topicMenu.type,forceClose:!0},type:n.FilterOptionType.ICON_LABEL};e.options.push(t)}toggle(){this.setState({open:!this.state.open,optionsSections:this.state.optionsSections})}componentWillReceiveProps(e){this.setState({optionsSections:this.getOptionsSections(e)})}close(){this.setState({open:!1,optionsSections:this.state.optionsSections})}render(){return this.state.optionsSections.length>0?i.createElement(n.FilterOptions,{ref:e=>this.root=e,open:this.state.open,toggleOpen:()=>this.toggle(),optionsSections:this.state.optionsSections,displayMenuButtonAsActive:this.canDisplayMenuButtonAsActive(this.props)}):null}initializeState(e){return{open:void 0!==this.state&&this.state.open,optionsSections:this.getOptionsSections(e)}}canDisplayMenuButtonAsActive(e){return e.topicMenu.grouping===constants.topic_menu.grouping.grouped||"AND"===e.topicMenu.filter_behaviour}clickInside(e){}clickOutside(e){this.state.open&&this.close()}}t.FilterOptionsContainer=l,o.applyMixins(l,[s.DocumentClickTracker])}),define("react_components/filters/components/vertical_filter/vertical_filter_container",["require","exports","react","reusable_components","flux","react_components/filters/components/filter_options/filter_options_container","components/tools/results","underscore","services/icons","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.VerticalFilterContainer=class extends s.BaseComponent{constructor(e){super(e);const{heightOffset:t}=e,i=n.FilterStore.getInstance().getTopicMenuByType(this.props.topicMenuType);switch(i.height){case 0:case 1:throw new Error("filter menu is too small");case 2:this.minimumNumberOfOptionsToShow=1;break;case 3:this.minimumNumberOfOptionsToShow=3;break;case 4:this.minimumNumberOfOptionsToShow=5;break;case 5:this.minimumNumberOfOptionsToShow=7;break;default:this.minimumNumberOfOptionsToShow=10}switch(t){case 0:this.optionsToShowOffset=0;break;case 1:this.optionsToShowOffset=2;break;case 2:this.optionsToShowOffset=5;break;case 3:this.optionsToShowOffset=8;break;case 4:this.optionsToShowOffset=11;break;case 5:this.optionsToShowOffset=14;break;default:throw new Error("Invalid heightOffset")}i.type===constants.topic_menu.TYPE.source_panel&&(this.minimumNumberOfOptionsToShow+=3),this.state={topicMenu:i,numberOfOptionsToShow:this.minimumNumberOfOptionsToShow,lazy:n.FilterStore.getInstance().getLazyLoadMode(this.props.topicMenuType),hasSubPage:n.FilterStore.getInstance().hasSubPage(this.props.topicMenuType),loadingFilterCount:!1},this.filterConstants={iconMap:{star1:{icon:c.iconService.getIcon("star"),count:1,className:"tw-btn-icon button rating"},star2:{icon:c.iconService.getIcon("star"),count:2,className:"tw-btn-icon button rating"},star3:{icon:c.iconService.getIcon("star"),count:3,className:"tw-btn-icon button rating"},favourites:{icon:c.iconService.getIcon("favorite"),count:1,className:"tw-btn-icon button favorite"}},messages:{all:l.contextData.getMessage("_271981"),more:l.contextData.getMessage("talkwalker_menu_filter_more"),less:l.contextData.getMessage("talkwalker_menu_filter_less")},grouped:constants.topic_menu.grouping.grouped,notGrouped:constants.topic_menu.grouping.not_grouped},this.highlightedEntries=["All panels","All documents"]}componentDidMount(){this.cancellationToken.subscribe(n.FilterStore.getInstance().onChange,e=>{this.checkNewPageState(e),this.checkSelectionChange(e),this.checkNumberOfOptionsChanged(e),this.checkFilterHitsChanged(e),this.checkFilterHitsLoading(e),this.checkFilterAdded(e)}),this.cancellationToken.subscribe(n.FilterOptionStore.getInstance().onChange,e=>{this.checkPinChange(e),this.checkSortingChange(e),this.checkGroupingChange(e),this.checkSelectionChange(e)})}checkSelectionChange(e){e.selectionChange&&e.topicMenuType===this.state.topicMenu.type&&this.recalculateAll()}checkNumberOfOptionsChanged(e){void 0!==e.numberOfOptionsToShow&&e.rowIndex===this.props.rowIndex&&this.setState({numberOfOptionsToShow:Math.max(this.minimumNumberOfOptionsToShow,e.numberOfOptionsToShow-this.optionsToShowOffset)})}checkPinChange(e){if(void 0!==e.pinState&&this.state.topicMenu.type===e.topicMenuType){const t=this.state.topicMenu;t.pinned=e.pinState,this.setState({topicMenu:t})}}checkFilterHitsLoading(e){e.filterHitCountLoading&&this.state.topicMenu.type===e.topicMenuType&&this.setState({loadingFilterCount:!0})}checkFilterHitsChanged(e){e.filterHitCount&&this.state.topicMenu.type===e.topicMenuType&&(this.setState({loadingFilterCount:!1}),this.recalculateAll())}checkGroupingChange(e){e.grouping&&this.state.topicMenu.type===e.topicMenuType&&this.recalculateAll()}checkNewPageState(e){e.newPageState&&this.recalculateAll()}checkFilterAdded(e){e.filterAdded&&this.recalculateAll()}recalculateAll(){this.setState({topicMenu:n.FilterStore.getInstance().getTopicMenuByType(this.props.topicMenuType)})}render(){return i.createElement(n.VerticalFilter,{columnIndex:this.props.columnIndex,rowIndex:this.props.rowIndex,optionsToShowOffset:this.optionsToShowOffset,topicMenu:this.state.topicMenu,minimumNumberOfOptionsToShow:this.minimumNumberOfOptionsToShow,numberOfOptionsToShow:Math.max(this.state.numberOfOptionsToShow,this.minimumNumberOfOptionsToShow),lazy:this.state.lazy,highlightedEntries:this.highlightedEntries,hasSubPage:this.state.hasSubPage,filterConstants:this.filterConstants,numberFormatter:a.partial(r.default.constructor.formatWithUnit,a,1,!0),FilterOptionsContainer:o.FilterOptionsContainer,loadingFilterCount:this.state.loadingFilterCount})}checkSortingChange(e){if(void 0!==e.sorting&&this.state.topicMenu.type===e.topicMenuType){const t=this.state.topicMenu;t.sorting=e.sorting,this.setState({topicMenu:t})}}}}),define("components/filter/menu/vertical/directive",["require","exports","react","react_components/filters/components/vertical_filter/vertical_filter_container","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.VerticalFilterContainer,{topicMenuType:e.menu.getType(),columnIndex:e.colIndex,rowIndex:e.rowIndex,heightOffset:e.heightOffset}),{menu:"=",isShowingMore:"=",colIndex:"=",colLength:"=",rowIndex:"=",heightOffset:"="})}),define("react_components/filter_menu/directive",["require","exports","react","services/react_bridge_factory","classes/context_data/context_data","map","filter_menu"],function(e,t,i,n,s,o,r){return n.createReactBridge(e=>{e.messages=e.messages||{msgNoFiltersSelected:s.contextData.getMessage("_1663547"),msgSearchHint:s.contextData.getMessage("_1663548"),msgSearchResults:s.contextData.getMessage("_1663549"),msgTopResults:s.contextData.getMessage("_1663550"),msgNoSearchResults:s.contextData.getMessage("_1663551"),msgSearchPlaceholder:s.contextData.getMessage("_1586942"),msgMore:s.contextData.getMessage("_1695865"),msgApplyChanges:s.contextData.getMessage("_1589501"),msgCancelChanges:s.contextData.getMessage("_1589500")},e.colorPairs=e.colorPairs||function(){const e=new o.Map;return Object.keys(constants.colors.quick_search.topic).forEach(t=>{e.set(t,constants.colors.quick_search.topic[t])}),e}();const t=Object.assign({color:e.color,label:e.label},e.configuration||{});return i.createElement(r.FilterBarContainer,{menus:e.menus,showPageFilters:e.showPageFilters,controller:e.controller,messages:e.messages,colorPairs:e.colorPairs,configuration:t})},{menus:"=",color:"=",label:"=?",configuration:"=?",showPageFilters:"=?",controller:"=?",messages:"=?",colorPairs:"=?",updateTs:"=?"},{replace:!1,watch:["updateTs"]})}),define("react_components/bubble_dialogs/components/interfaces/influencer_search_rollover_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/influencer_search_rollover_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/influencer_search_rollover",["require","exports","react","flux","classes/context_data/context_data","event_bus","services/rest_form_service"],function(e,t,i,n,s,o,r){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.rolloverTransitionTime=.666,function(e){e.SAVED_SEARCH_HEADER="saved-search-header",e.SAVED_SEARCHES="saved-searches"}(a||(a={}));const c=20,l=77;t.InfluencerSearchRollover=class extends n.BaseComponent{constructor(e){super(e),this.numberOfSearchCategories=0}render(){return i.createElement("div",{style:this.getStaticStyle(),ref:e=>{this.container=e}},this.renderSavedSearches())}renderSavedSearches(){let e,t;return this.props.payload.isAdvancedSearch?t=1+(e=1):e=1+(t=1),i.createElement("div",{className:"saved-search-container"},this.renderAdvancedSearches(e),this.renderSimpleSearches(t))}renderAdvancedSearches(e){const{influencerSearches:t}=this.props.payload,n=t.saved_searches.filter(e=>"QUERY"===e.type);return n&&n.length>0?(this.numberOfSearchCategories++,i.createElement("div",{style:{order:e}},i.createElement("div",{className:`${a.SAVED_SEARCH_HEADER} QUERY`},s.contextData.getMessage("_1571563"),i.createElement("hr",null)),i.createElement("div",{className:`${a.SAVED_SEARCHES} QUERY`},[n.map(e=>this.renderSearch(e))]))):void 0}renderSimpleSearches(e){const{influencerSearches:t}=this.props.payload,n=t.saved_searches.filter(e=>"CONSTRUCTED"===e.type);return n&&n.length>0?(this.numberOfSearchCategories++,i.createElement("div",{style:{order:e}},i.createElement("div",{className:`${a.SAVED_SEARCH_HEADER} CONSTRUCTED`},s.contextData.getMessage("_1698156"),i.createElement("hr",null)),i.createElement("div",{className:`${a.SAVED_SEARCHES} CONSTRUCTED`},n.map(e=>this.renderSearch(e))))):void 0}renderSearch(e){return i.createElement("div",{className:`search ${e.type}`,key:e.id,id:e.id,onClick:t=>this.selectSearch(t,e)},e.name,i.createElement("i",{className:"fa fa-trash","aria-hidden":"true",onClick:t=>this.removeSavedSearch(t,e)}))}selectSearch(e,t){e.stopPropagation(),o.eventBus.dispatch({type:o.EVENT_TYPES.INFLUENCER_SEARCH_SELECTED,value:t}),this.props.destroy()}async removeSavedSearch(e,t){e.stopPropagation(),await r.restFormService.deleter(t.remove_url),this.removeAppropriateElements(t),o.eventBus.dispatch({type:o.EVENT_TYPES.INFLUENCER_SEARCH_REMOVED,value:t})}removeAppropriateElements(e){$("#"+e.id).hide(),0===$(`.${a.SAVED_SEARCHES}`).filter("."+e.type).height()&&($(`.${a.SAVED_SEARCH_HEADER}`).filter("."+e.type).hide(),this.numberOfSearchCategories--,this.setBubbleHeight(),0===$(`.${a.SAVED_SEARCHES}`).filter(".CONSTRUCTED").height()&&0===$(`.${a.SAVED_SEARCHES}`).filter(".QUERY").height()&&this.close())}close(){this.numberOfSearchCategories=0,this.setBubbleHeight(),setTimeout(()=>{this.props.destroy()},1e3*t.rolloverTransitionTime)}getStaticStyle(){return{boxShadow:"silver 0px 5px 4px -1px",position:"absolute",zIndex:2,height:"1px",backgroundColor:"white",display:"flex",flexFlow:"column",overflow:"hidden",transition:t.rolloverTransitionTime+"s"}}assignRolloverVariableStyle(){const e=this.container.style,{leftAnchorId:t,topAnchorId:i,widthAnchorId:n}=this.props.payload,s=document.getElementById(t).getBoundingClientRect().left+"px",o=document.getElementById(i).getBoundingClientRect(),r=o.top+o.height+10+"px",a=document.getElementById(n).offsetWidth+"px";e.left=s,e.top=r,e.minWidth=a}componentDidMount(){this.assignRolloverVariableStyle(),this.cancellationToken.subscribe(this.props.facade.onReady,this.setBubbleHeight.bind(this)),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.ROLLOVER_SHOULD_CLOSE,this.close.bind(this))}setBubbleHeight(){this.container.style.height=this.calculateBubbleHeight()+"px"}calculateBubbleHeight(){const e=c+this.numberOfSearchCategories*l;return e!==c?e:1}}}),define("react_components/bubble_dialogs/components/interfaces/save_influencer_search_bubble_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/save_influencer_search_bubble",["require","exports","flux","react","reusable_utilities","classes/context_data/context_data","react_components/form/progress_button/progress_button_container","services/rest_form_service","event_bus"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends i.BaseComponent{constructor(e){super(e),this.textInput=void 0,this.state={valid:!1,name:""}}render(){return n.createElement("div",{className:"tw-bubble-dialog-add-influencer-to-campaign"},this.renderHeader(),this.renderBody())}renderHeader(){return n.createElement("div",{className:"header"},n.createElement("h2",null,o.contextData.getMessage("_1751635"),n.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}renderBody(){return n.createElement("div",{className:"body"},n.createElement("form",{className:"form-horizontal"},n.createElement("div",{className:"form-group no-border-bottom"},n.createElement("label",{className:"control-label"},o.contextData.getMessage("_1684566")),n.createElement("div",null,n.createElement("input",{style:{marginTop:"10px",width:"100%"},type:"text",value:this.state.name,onChange:this.handleNameInputChange.bind(this),required:!0,maxLength:25,ref:e=>this.textInput=e,onFocus:e=>e.currentTarget.select()})))),n.createElement("div",{className:"tw-buttons clearfix"},n.createElement(r.ProgressButtonContainer,{text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337"),clickEvent:this.handleInfluencerSearch.bind(this),className:"tw-button pull-right",disabled:!this.state.valid})))}handleInfluencerSearch(){if(this.state.valid){const{saveLink:e,searchDescriptor:t}=this.props.payload,i=Object.assign({},t,{name:this.state.name});a.restFormService.post(e,{saved_search:i}).then(e=>{c.eventBus.dispatch({type:c.EVENT_TYPES.SHOULD_UPDATE_SAVED_INFLUENCER_SEARCHES,value:void 0}),c.eventBus.dispatch({type:c.EVENT_TYPES.UPDATE_LOADED_INFLUENCER_SEARCH,value:e.saved_search})}),this.props.destroy()}}handleNameInputChange(e){const t=e.target.value;this.setState({name:t,valid:this.checkValidity(t)})}checkValidity(e){return void 0!==e&&""!==e}componentDidMount(){this.cancellationToken.subscribe(this.props.facade.onReady,()=>this.textInput.focus())}clickInside(e){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.SaveInfluencerSearchBubble=l,s.applyMixins(l,[i.DocumentClickTracker])}),define("react_components/menu/topic_menu_select_component_strategies/callback_selection_menu_strategy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.CallbackSelectionMenuStrategy=class{constructor(e,t){this.menuWrapper=e,this.config=t}onSelect(e,t,i){return new Promise((e,i)=>{this.config.callbacks.has(t.mapped_id)&&this.config.callbacks.get(t.mapped_id)(),e(this.menuWrapper.toModel())})}onMouseEnter(e){return new Promise((t,i)=>{t({openPath:this.menuWrapper.getEntryByMappedId(e.mapped_id).getPath(),changedEntry:void 0})})}isActionsDisabled(){return!1}}}),define("components/influencer_management_search/directive",["require","exports","angular","angular_utilities","event_bus","keypress","log","map","query_builder","react","react-dom","reusable_components","reusable_utilities","classes/application/application","classes/context_data/context_data","classes/refresh/model_refresh_decorator_factory","classes/refresh/model_refresh_strategy","classes/refresh/model_type","react_components/bubble_dialogs/components/influencer_search_rollover","react_components/bubble_dialogs/components/save_influencer_search_bubble","react_components/filter_menu/topic_menu_wrapper_adapter","react_components/menu/topic_menu_select_component_strategies/callback_selection_menu_strategy","react_components/menu/topic_menu_select_container","services/bubble_dialog","services/configuration","services/refresh/model_refresh_service","services/rest_form_service","services/template_source","services/theme","wrappers/topic_menu/topic_menu_wrapper","components/page/quick_search/controllers/lazily_saved_filter_menu_controller"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x){var R;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SAVE="SAVE",e.UPDATE="UPDATE"}(R||(R={})),t.default=function(){return{replace:!1,scope:{},controllerAs:"ctrl",controller:F,templateUrl:D.templateSourceFactory("components/influencer_management_search"),link(e,t,i,n){}}};let F=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$timeout=i,this.saveButtonTemplateUrl=BASE_TEMPLATE_URL+"components/influencer_management_search/save_button.html",this.searchbarPlaceholder=h.contextData.getMessage("_1354876"),this.topRolloverAnchorId=_.uniqueId("influencer-search-rollover-top-anchor"),this.leftRolloverAnchorId=_.uniqueId("influencer-search-rollover-left-anchor"),this.searchBarId=_.uniqueId("influencer-search-bar"),this.easySearchId=_.uniqueId("query-builder"),this.saveIconId=_.uniqueId("save-icon"),this.editQueryId=_.uniqueId("edit-query"),this.backButtonId=_.uniqueId("backbutton"),this.saveButtonMenuId=_.uniqueId("save-button-menu"),this.isAdvancedSearch=this.shouldDisplayAdvancedSearch(),this.isModifingSimpleSearchQuery=!1,this.isSearching=!1,this.canLaunchSimpleSearch=!1,this.simpleSearchMessages={addFilter:h.contextData.getMessage("_1324564"),addGroup:h.contextData.getMessage("_1456752"),firstGroupLeftHeader:h.contextData.getMessage("_1987655"),otherGroupsLeftHeader:h.contextData.getMessage("_1698454"),rightHeader:h.contextData.getMessage("_1654657"),reset:h.contextData.getMessage("_1569854"),filterMenuMessages:{msgNoFiltersSelected:h.contextData.getMessage("_1663547"),msgSearchHint:h.contextData.getMessage("_1663548"),msgSearchResults:h.contextData.getMessage("_1663549"),msgTopResults:h.contextData.getMessage("_1663550"),msgNoSearchResults:h.contextData.getMessage("_1663551"),msgSearchPlaceholder:h.contextData.getMessage("_1586942"),msgMore:h.contextData.getMessage("_1695865"),msgApplyChanges:h.contextData.getMessage("_1589501"),msgCancelChanges:h.contextData.getMessage("_1589500")}},this.threeDotsTooltip=h.contextData.getMessage("_1556345"),this.saveSearchTooltip=h.contextData.getMessage("_1563563"),this.editQueryTooltip=h.contextData.getMessage("_1685165"),this.backButtonTooltip=h.contextData.getMessage("_1561583",[h.contextData.getMessage("_1991137")]),this.keypressListener=void 0,this.simpleSearchSelectedFilters=[],this.cancellationToken=new u.CancellationToken,this.createSubscriptions(),e.$on("$destroy",()=>this.destroy())}destroy(){this.cancellationToken.cancel(),this.keypressListener.reset(),this.keypressListener.destroy()}$onInit(){this.queryBuilderModel=this.getQueryBuilderModel();const e=p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container;this.maxNumberOfSimpleSearchGroups=e.max_number_of_clauses,this.maxNumberOfFiltersPerSimpleSearchGroup=e.max_number_of_terms_per_clause,this.simpleSearchState=e.search_descriptor,this.loadedSearch=e.search_descriptor,this.updateSimpleSearchSelectedFilters(e.search_descriptor),this.updateInfluencerSearches(),this.keypressListener=new o.Listener,this.keypressListener.register_combo({keys:u.KeyCodes.ENTER,on_keydown:e=>this.handleEnterKeypress(),prevent_default:!0})}initializeCodeMirrorQuery(){const e=p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container;e&&e.search_descriptor&&"QUERY"===e.search_descriptor.type&&e.search_descriptor.query_search&&e.search_descriptor.query_search.query&&this.enterQueryInCodeMirror(e.search_descriptor.query_search.query)}handleEnterKeypress(){this.isInNoResultsSearchPage()&&!this.getIsAdvancedSearch()&&this.handleSimpleSearchSubmitClick()}updateLoadedSearch(e){this.loadedSearch=e,this.renderSaveButtonLoadingAnimation(),this.$timeout(()=>this.renderSaveButton(),1e3)}removeInfluencerSearch(e){e.id===this.loadedSearch.id&&(this.loadedSearch=void 0),this.updateInfluencerSearches()}updateInfluencerSearches(){P.restFormService.getRForm("influencer_searches","show").then(e=>{this.influencerSearches=e,this.applyScope()})}createSubscriptions(){this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.INFLUENCER_SEARCH_MODE_SHOULD_SWITCH,this.onSearchModeSwitch.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.SEARCH_BAR_SUBMIT,this.handleAdvancedSearchSubmit.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.PROPAGATE_QUERY_BUILDER_VALIDITY,this.handleSimpleSearchValidityChange.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.QUERY_BUILDER_PROPAGATE_DIRTY_STATE,this.handleSimpleSearchDirtyState.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.SHOULD_UPDATE_SAVED_INFLUENCER_SEARCHES,this.updateInfluencerSearches.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.INFLUENCER_SEARCH_SELECTED,this.onSavedSearchSelected.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.UPDATE_LOADED_INFLUENCER_SEARCH,e=>this.updateLoadedSearch(e.value)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.INFLUENCER_SEARCH_REMOVED,e=>this.removeInfluencerSearch(e.value)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.PAGESTATE_REFRESH,this.handlePageStateRefresh.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.CODEMIRROR_INITIALIZED,this.initializeCodeMirrorQuery.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.QUERY_BUILDER_FOCUS,this.disableBlockInfluencersKeybinds.bind(this)),this.cancellationToken.addCleanupFunction(()=>{this.$element.find(`#${this.saveButtonMenuId}`).length&&d.unmountComponentAtNode(this.$element.find(`#${this.saveButtonMenuId}`)[0])})}enableSimpleSearchModification(){this.rollover&&this.closeRollover(),this.closeTooltip(),s.eventBus.dispatch({type:s.EVENT_TYPES.RESET_QUERY_BUILDER_TO_CLEAN_STATE,value:this.easySearchId}),this.isModifingSimpleSearchQuery=!0}disableSimpleSearchModification(){this.isModifingSimpleSearchQuery&&(this.rollover&&this.closeRollover(),this.isModifingSimpleSearchQuery=!1)}toggleRolloverBubble(){if(this.closeTooltip(),this.rollover)this.closeRollover();else{const e=constants.bubble_dialog.id.influencer_search_rollover,t=T.configurationService.getBubbleDialogConfiguration().getStyle(e),i={topAnchorId:this.topRolloverAnchorId,leftAnchorId:this.leftRolloverAnchorId,widthAnchorId:this.searchBarId,isAdvancedSearch:this.getIsAdvancedSearch(),influencerSearches:this.influencerSearches};this.rollover=E.bubbleDialogService.createReactBubble(e,$("body"),i,e=>(e.payload=i,l.createElement(v.InfluencerSearchRollover,{payload:e.payload,destroy:e.destroy,facade:this.rollover})),t)}}closeRollover(){s.eventBus.dispatch({type:s.EVENT_TYPES.ROLLOVER_SHOULD_CLOSE,value:void 0}),setTimeout(()=>{this.rollover=void 0},1e3*v.rolloverTransitionTime)}handleSimpleSearchSubmitClick(){this.canLaunchSimpleSearch&&!this.isSearching&&(this.rollover&&this.closeRollover(),this.isSearching=!0,s.eventBus.dispatch({type:s.EVENT_TYPES.UPDATE_QUERY_BUILDER_CLEAN_STATE,value:this.easySearchId}),this.handleNewQueryBuilderData(c.QueryBuilderParser.parseToSearchDescriptor(this.easySearchId)))}getIsAdvancedSearch(){return this.isAdvancedSearch}onSearchModeSwitch(){this.isAdvancedSearch=!this.isAdvancedSearch,this.rollover&&this.closeRollover(),this.rollover=void 0,this.isModifingSimpleSearchQuery=!1,this.applyScope()}applyScope(){tw.inject("$rootScope").$$phase||this.$scope.$apply()}handlePageStateRefresh(e){if(this.rollover&&this.closeRollover(),!e.value.isLoadMore){this.isModifingSimpleSearchQuery=!1;const t=e.value.pagestate.toProto();let i;t.user_filter_settings.filters.search_descriptor_container&&(i=t.user_filter_settings.filters.search_descriptor_container.search_descriptor),void 0!==i?(this.simpleSearchState=i,this.forceIntoCorrectSearchMode(i)):this.simpleSearchState={},this.isInNoResultsSearchPage()&&this.isAdvancedSearch&&this.enterQueryInCodeMirror(""),this.isSearching=!1}}forceIntoCorrectSearchMode(e){"CONSTRUCTED"===e.type?this.isAdvancedSearch=!1:"QUERY"===e.type&&(this.isAdvancedSearch=!0)}canShowSearchbar(){return["IM_PAGE_SEARCH","IM_PAGE_SEARCH_RESULTS"].includes(p.mainApplication.getPageState().getAllowedPages().getPageType())}isInPage(e){return[e].includes(p.mainApplication.getPageState().getAllowedPages().getPageType())}isInResultsSearchPage(){return this.isInPage("IM_PAGE_SEARCH_RESULTS")}isInNoResultsSearchPage(){return this.isInPage("IM_PAGE_SEARCH")}isLoadedSearch(){return!(!this.loadedSearch||!this.loadedSearch.id)}shouldRenderSaveButton(){return this.getIsAdvancedSearch()?!this.isInNoResultsSearchPage()&&!this.isLoadedSearch():!this.isInNoResultsSearchPage()&&!this.isModifingSimpleSearchQuery&&!this.isLoadedSearch()}shouldRenderSaveMenu(){return this.getIsAdvancedSearch()?!this.isInNoResultsSearchPage()&&this.isLoadedSearch():!this.isInNoResultsSearchPage()&&!this.isModifingSimpleSearchQuery&&this.isLoadedSearch()}goBackToNoResultsSearchPage(){if(this.isInResultsSearchPage()){const e=p.mainApplication.getPageState().getUserFilterSettings(),t=e.toProto().filters.search_descriptor_container.search_descriptor;e.toProto().filters.query=void 0,t.query_search=void 0,t.constructed_search=void 0,this.loadedSearch=void 0,this.enterQueryInCodeMirror(""),this.closeTooltip(),this.refreshPageData()}}disableBlockInfluencersKeybinds(){s.eventBus.dispatch({type:s.EVENT_TYPES.DISABLE_BLOCK_INFLUENCERS_KEYBINDS,value:void 0})}getQueryBuilderModel(){return{groupSelectors:this.buildGroupSelectors(),filterProperties:this.buildFilterProperties(),filterMenus:[{type:"COUNTRY",controllerFactory:e=>this.createFilterMenuByType(e,"COUNTRY")},{type:"LANGUAGE",controllerFactory:e=>this.createFilterMenuByType(e,"LANGUAGE")},{type:"PREDEFINED_FILTER",controllerFactory:e=>this.createFilterMenuByType(e,"PREDEFINED_FILTER")}],singleSelects:[{type:"GENDER",topicMenu:this.getNewTopicMenuWrapperByType("GENDER").toProto()},{type:"REACH",topicMenu:this.buildReachTopicMenu()}]}}buildReachTopicMenu(){return{root_entry:{mapped_id:"front-reach",children:[{name:h.contextData.getMessage("_1565155"),mapped_id:">100000",selected:"NONE"},{name:h.contextData.getMessage("_1658441"),mapped_id:"<100000",selected:"NONE"},{name:h.contextData.getMessage("_1657441"),mapped_id:"<50000",selected:"NONE"},{name:h.contextData.getMessage("_1658841"),mapped_id:"<10000",selected:"NONE"},{name:h.contextData.getMessage("_1658651"),mapped_id:"<5000",selected:"NONE"}]}}}createFilterMenuByType(e,t){return new x.LazilySavedFilterMenuController(this.generateTopicMenuWrapperAttributesByType(e,t),b.TopicMenuWrapperMenuAdapter)}generateTopicMenuWrapperAttributesByType(e,t){return{rootId:e,topicMenu:this.getNewTopicMenuWrapperByType(t),config:{color:A.themeService.getBrandingColor(),showSearchBar:!0,showTopResults:!0,disableKeepOpenOnClick:!0,component:{renderable:g.SquareFilterMenuRenderable,props:this.getSquareFilterMenuRenderableProps()}}}}getNewTopicWrapperMenuByType(e){const t=new I.TopicMenuWrapper(p.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByType(e).toModel());return t.unselectAll(),t}buildGroupSelectors(){return p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.operator_menu.root_entry.children.map(e=>({type:e.mapped_id,message:e.name}))}buildFilterProperties(){return p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.fields_menu.root_entry.children.map(e=>({type:e.mapped_id,message:e.name}))}getSquareFilterMenuRenderableProps(){return{caretClasses:{up:"fa-angle-up",down:"fa-angle-down"},customStyle:{baseStyle:{display:"flex",color:"#555",alignItems:"center",padding:"0 12px 0 0",border:"1px solid",borderColor:A.themeService.getCurrentThemeModel().shade,height:"34px",minWidth:"291.40px",backgroundColor:"white",borderBottom:`1px solid ${A.themeService.getCurrentThemeModel().shade}`,cursor:"default"},openMenuStyle:{color:"#555",borderColor:A.themeService.getBrandingColor(),borderBottom:"1px solid white"},closedMenuStyle:{minWidth:"291.40px"},closedWithSelectionMenuStyle:{minWidth:"291.40px"},baseLabelStyle:{fontSize:"14px",padding:"0 15px 0 12px",flexGrow:1,overflow:"hidden",textOverflow:"ellipsis"},openAndClosedWithSelectionMenuLabelStyle:{fontFamily:"RobotoR"},normalButtonStyle:{backgroundColor:A.themeService.getBrandingColor(),color:"#000"}}}}handleNewQueryBuilderData(e){p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.search_descriptor=e,this.updateSimpleSearchSelectedFilters(e),this.refreshPageData()}async refreshPageData(){const e={strategy:f.ModelRefreshStrategy.REFRESH},t=m.modelRefreshDecoratorFactory.getDecorator(p.mainApplication.getPageState(),p.mainApplication,y.ModelType.PAGE_STATE,e);try{return await M.modelRefreshService.refresh(t,e)}catch(e){e instanceof Error&&r.logService.error("Error when refreshing page state",void 0,e)}}updateSimpleSearchSelectedFilters(e){e&&e.constructed_search&&(this.simpleSearchSelectedFilters=[],e.constructed_search.clauses.forEach(e=>{const t="NOT"===e.operator;e.terms.forEach(e=>{this.addTermToSelectedFilters(e,t)})}))}addTermToSelectedFilters(e,t){let i;this.hasValuesFromTopicMenu(e)?i=this.getReadableTopicMenuTermValues(e):e.values&&e.values[0]&&(i=e.values[0].split(" ").map(e=>e?`"${e}"`:"").join(" ")),i&&this.simpleSearchSelectedFilters.push({negated:t,value:this.getReadableTermFieldName(e)+": "+i,id:e.id})}getReadableTopicMenuTermValues(e){let t="";const i=this.getNewTopicMenuWrapperByType(e.field);return e.values&&e.values[0]?e.values.forEach(e=>{t+=i.getEntryByMappedId(e).getName()+" "}):t=i.getAllMappedId(),t}getReadableTermFieldName(e){return p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.fields_menu.root_entry.children.find(t=>t.mapped_id===e.field).name}handleSelectedFilterClick(e){this.enableSimpleSearchModification(),setTimeout(()=>$(document.getElementById(e)).focus())}handleAdvancedSearchSubmit(e){const t=p.mainApplication.getPageState().getUserFilterSettings();t.toProto().filters.search_descriptor_container.search_descriptor={type:"QUERY",query_search:{query:e.value}},t.toProto().filters.query=void 0,this.refreshPageData()}getNewTopicMenuWrapperByType(e){switch(e){case"COUNTRY":return this.getNewTopicWrapperMenuByType("COUNTRIES");case"LANGUAGE":return this.getNewTopicWrapperMenuByType("LANGUAGES");case"GENDER":return this.getNewTopicWrapperMenuByType("GENDER");case"REACH":return new I.TopicMenuWrapper(this.buildReachTopicMenu());case"PREDEFINED_FILTER":return this.getNewTopicWrapperMenuByType("PREDEFINED_FILTERS");default:throw new Error(`type: ${e} should not be linked to a topic menu.`)}}hasValuesFromTopicMenu(e){switch(e.field){case"AUTHOR_BIO":case"AUTHOR_NAME":case"CONTENT":case"CONTENT_AND_TITLE":case"FOLLOWER_COUNT":return!1;case"REACH":case"COUNTRY":case"INTERESTS":case"LANGUAGE":case"OCCUPATIONS":case"PREDEFINED_FILTER":case"GENDER":return!0;default:throw new Error("Unknown FIELD type")}}handleSimpleSearchValidityChange(e){(e.value.id=this.easySearchId)&&(this.canLaunchSimpleSearch=e.value.valid&&!this.isSearching,this.applyScope())}handleSimpleSearchDirtyState(e){(e.value.id=this.easySearchId)&&(this.isSimpleSearchDirty=e.value.dirty,this.applyScope())}searchAndCloseEditSimpleSearch(){this.canLaunchSimpleSearch&&(s.eventBus.dispatch({type:s.EVENT_TYPES.UPDATE_QUERY_BUILDER_CLEAN_STATE,value:this.easySearchId}),this.handleNewQueryBuilderData(c.QueryBuilderParser.parseToSearchDescriptor(this.easySearchId)),this.disableSimpleSearchModification())}hasSavedQueries(){return void 0!==this.influencerSearches&&void 0!==this.influencerSearches.saved_searches&&void 0!==this.influencerSearches.saved_searches[0]}handleInfluencerSearchSave(e=!1){s.eventBus.dispatch({type:s.EVENT_TYPES.DISABLE_BLOCK_INFLUENCERS_KEYBINDS,value:void 0}),this.rollover&&this.closeRollover();const t=Object.assign({},p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.search_descriptor);e?this.updateSearch(Object.assign({},this.loadedSearch,t)):this.saveSearch(t)}saveSearch(e){const t=constants.bubble_dialog.id.save_influencer_search,i=T.configurationService.getBubbleDialogConfiguration().getStyle(t);i.setAbsoluteX(window.innerWidth/2-i.minWidth/2);const n={saveLink:this.influencerSearches.save_link,searchDescriptor:e},s=E.bubbleDialogService.createReactBubble(t,$("body"),n,e=>(e.payload=n,l.createElement(S.SaveInfluencerSearchBubble,{payload:e.payload,destroy:e.destroy,facade:s})),i,{preventOutsideClickActions:!0})}updateSearch(e){this.renderSaveButtonLoadingAnimation();const t=Date.now();P.restFormService.postRForm("influencer_searches","update",{saved_search:e}).then(()=>{s.eventBus.dispatch({type:s.EVENT_TYPES.SHOULD_UPDATE_SAVED_INFLUENCER_SEARCHES,value:void 0});const e=Date.now()-t;this.$timeout(()=>{this.renderSaveButton()},1e3-e)})}async onSavedSearchSelected(e){const{load_url:t,type:i}=e.value,n=await P.restFormService.get(t),{saved_search:s}=n;if("QUERY"===i)await this.setToAdvancedSearch(),this.enterQueryInCodeMirror(s.query_search.query);else{if("CONSTRUCTED"!==i)throw new Error("Unknown type of search descriptor");this.isAdvancedSearch=!1,this.updateSimpleSearchSelectedFilters(s)}this.isModifingSimpleSearchQuery=!1,this.loadedSearch=s,p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container.search_descriptor=s,this.renderSaveButton(),this.refreshPageData()}async setToAdvancedSearch(){this.isAdvancedSearch||(this.isAdvancedSearch=!0,this.applyScope(),await new Promise(e=>setTimeout(e,500)))}enterQueryInCodeMirror(e){const t=$(".search-filters").find(".CodeMirror")[0];if(t){const i=t.CodeMirror.getDoc();if(i){const t=i.getValue();return i.setValue(""),i.replaceRange(e,{line:0,ch:0}),t}}else;}shouldDisplayAdvancedSearch(){const e=p.mainApplication.getPageState().getUserFilterSettings().toProto().filters.search_descriptor_container;return!e.search_descriptor||"CONSTRUCTED"!==e.search_descriptor.type}openTooltip(e,t){void 0!==t&&s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:$("#"+u.StringUtils.sanitizeInputForHtmlAttribute(e)),type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}buildSaveButtonMenu(){return new I.TopicMenuWrapper({root_entry:{mapped_id:"root",name:"",children:[{mapped_id:R.SAVE,name:h.contextData.getMessage("_2556001")},{mapped_id:R.UPDATE,name:h.contextData.getMessage("_2556002",[`"${this.loadedSearch.name}"`])}]}})}buildSaveButtonCallbacks(){const e=new a.Map;return e.set(R.SAVE,()=>this.handleInfluencerSearchSave(!1)),e.set(R.UPDATE,()=>this.handleInfluencerSearchSave(!0)),e}renderSaveButtonLoadingAnimation(){this.$element.find(`#${this.saveButtonMenuId}`).length&&d.render(l.createElement("i",{className:"fa fa-refresh fa-spin save-search"}),this.$element.find(`#${this.saveButtonMenuId}`)[0])}renderSaveButton(){if(!this.$element.find(`#${this.saveButtonMenuId}`).length)return;const e=this.buildSaveButtonMenu(),t=new w.CallbackSelectionMenuStrategy(e,{callbacks:this.buildSaveButtonCallbacks()});d.unmountComponentAtNode(this.$element.find(`#${this.saveButtonMenuId}`)[0]),d.render(l.createElement(C.TopicMenuSelectContainer,{key:"save-search",topicMenu:e,menuStrategy:t,styleModel:{iconClass:"fa fa-floppy-o save-search"},title:void 0,allowMultiSelection:!1,concatSelectionLabel:void 0,concatAllNode:void 0,dropdownClassName:"save-button-menu",openOnHover:!0}),this.$element.find(`#${this.saveButtonMenuId}`)[0])}};F=__decorate([n.ngInject(["$scope","$element","$timeout"]),__metadata("design:paramtypes",[Object,Object,Function])],F),t.InfluencerManagementSearchController=F}),define("entry_point/configurations/angular_configuration/angular_modules/components_filters",["require","exports","angular","components/filter/entry_list/directive","components/filter/menu/buttons/directive","components/filter/menu/horizontal/directive","components/filter/menu/horizontal/label/directive","components/filter/menu/two_columns/directive","components/filter/menu/vertical/directive","components/filter/menu/vertical/inline_list/directive","components/filter/menu/vertical/label/directive","components/filter/menu/vertical/merged/directive","components/filter/pin_list/directive","components/filters/close_overlay/directive","components/filters/directive","components/filters_searchbar/advanced/directive","components/filters_searchbar/simple/directive","components/filters_searchbar/directive","components/filters_searchbar/menu/horizontal/directive","react_components/filter_menu/directive","components/influencer_management_search/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_filters",[]).directive("twEntryList",n.default).directive("twButtonsMenu",s.default).directive("twHorizontalMenu",o).directive("twHorizontalLabelMenu",r.default).directive("twTwoColumnsMenu",a.default).directive("twVerticalMenu",c).directive("twVerticalMenuInlineList",l.default).directive("twLabelMenu",d.default).directive("twVerticalMergedMenu",g.default).directive("twPinList",u.default).directive("twFiltersCloseOverlay",p).directive("twFilters",h.default).directive("twAdvancedSearchbar",m.default).directive("twSimpleSearchbar",_.default).directive("twFiltersSearchbar",f.default).directive("twFiltersSearchbarHorizontalMenu",y.default).directive("twFilterDropdown",v).directive("influencerManagementSearch",S.default)}),define("react_components/image_gallery/image_gallery_container",["require","exports","underscore","react","classnames","flux","reusable_components"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.ImageGalleryContainer=class extends o.BaseComponent{render(){return n.createElement("div",{className:"tw-image-gallery"},this.generateHeader(),n.createElement("div",{className:"container"},this.generateCarousel()))}generateHeader(){return n.createElement("div",{className:"header"},this.props.header)}generateCarousel(){return n.createElement(r.CarouselList,{settings:this.getSettings(),items:this.props.items,generateItems:this.generateItems.bind(this),onFetchMoreData:i.noop,containerClass:""})}generateItems(e){return i.map(e,e=>{const t=this.props.onImageClick?()=>{this.props.onImageClick(e),this.selectAndUnselectOthers(e),this.forceUpdate()}:null,i=s({item:!0,selected:!0===e.selected,clickable:!!t});return n.createElement("div",{key:e.url,className:i,onClick:t},n.createElement("img",{src:e.url,alt:""}))})}selectAndUnselectOthers(e){i.each(this.props.items,t=>{t.selected=e.url===t.url})}getSettings(){return{useLoadingFlag:!1,width:72,margin:5,loadMoreThresholdItems:100,useSmallIcons:!0,isAnimated:!0,animationDuration:800}}}}),define("components/image_gallery/directive",["require","exports","react","services/react_bridge_factory","react_components/image_gallery/image_gallery_container"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.ImageGalleryContainer,{items:e.items,onImageClick:e.onImageClick()}),{items:"=",onImageClick:"&onImageClick"})}),define("react_components/form/multiple_checkbox/multiple_checkbox_container",["require","exports","react","reusable_components","flux","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.MultipleCheckboxContainer=class extends s.BaseComponent{constructor(e){super(e),this.state={model:this.createModelFromTopicMenu(e)}}render(){return i.createElement(n.MultipleCheckboxRenderable,{items:this.getItemsFromTopicMenu()})}createModelFromTopicMenu(e){return new o.TopicMenuWrapper(e.topicMenu)}getItemsFromTopicMenu(){const e=this.state.model;return e.getRootEntry().getChildren().map(t=>({id:t.getMappedId(),label:t.getName(),type:"SINGLE"===e.getSelectionStrategy()?n.StateButtonType.RADIO_BUTTON:n.StateButtonType.CHECKBOX,checked:t.isSelected(),disabled:t.isNotSelectable(),onClick:(t,i)=>{e.selectEntryByMappedId(i.id),void 0!==this.props.selectCallback&&this.props.selectCallback(i.id,this.props.topicMenu.type),this.forceUpdate()}}))}}}),define("components/multiple_checkbox/directive",["require","exports","react","services/react_bridge_factory","react_components/form/multiple_checkbox/multiple_checkbox_container"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.MultipleCheckboxContainer,{topicMenu:e.topicMenu,selectCallback:e.selectCallback}),{topicMenu:"=",selectCallback:"=?"})}),define("components/react_single_select/directive",["require","exports","services/react_bridge_factory","react","reusable_components"],function(e,t,i,n,s){return i.createReactBridge(e=>n.createElement(s.SingleSelectComponent,{model:e.model,defaultValue:e.defaultValue,placeholder:e.placeholder,isReadOnly:e.isReadOnly,allowEmptySelection:e.allowEmptySelection,selectCallback:e.selectCallback,bottomButton:e.bottomButton,bottomButtonCallback:e.bottomButtonCallback}),{model:"=",defaultValue:"@",placeholder:"@",isReadOnly:"=",allowEmptySelection:"=",selectCallback:"=",bottomButton:"=",bottomButtonCallback:"="})}),define("own_codemirror/mode/mode_interfaces",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DOUBLE='"'}(t.QuoteCharacter||(t.QuoteCharacter={}))}),define("own_codemirror/mode/tw-query",["require","exports","codemirror","reusable_utilities","own_codemirror/mode/mode_interfaces","reusable_services"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),i.defineMode("tw-query",e=>{const t=/[\(\)]{1}/,i=/[^\s\|\!\+\*\?\~\^\&\:\(\)\[\]\{\}\^\"\\]/,r=/^(?:O{0,1}NEAR(?:\/\d*){0,1}|(?:O{0,1}SENTENCE))$/,a=/^(?:[<|>][=]{0,1}\d*)$/,c=/[\|\!\+\-\*\?\~\^\&]/,l=/[\*\?]/,d=/(?:\ud83c|\ud83d|\ud83e)/,g=function(e){return new RegExp("^(?:"+e.join("|")+")$")}(["AND","OR","TO","NOT"]);function u(e){return function(t,i){const n=i.inQuote;let s,o=!1;if(i.inQuote=!1,n&&t.current()===e)return i.tokenize=v,"string";for(;null!=(s=t.next())&&!p(e,s,o);){if(h(s)){i.inQuote=!0,i.lastUsedQuoteCharacter=e,t.backUp(1);break}o=!o&&"\\"===s}return o||(i.tokenize=v),"string"}}function p(e,t,i){return t===e&&!i}function h(e){return l.test(e)}function m(e){return function(t,i){let n=e;if(_(e))for(;(e=t.peek())&&f(n+e);)n+=t.next();else if(!f(n))for(;(e=t.peek())&&y(e);)n+=t.next();return i.tokenize=v,g.test(n)?"gate":r.test(n)?"builtin":a.test(n)?"comparator":function(e){return parseFloat(e).toString()===e}(n)?"number":f(n)?"emoji":":"===t.peek()?constants.syntaxHighlighter.propertyRegex.test(n)?"property":constants.syntaxHighlighter.metricRegex.test(n)?"metric":"field":"string"}}function _(e){return d.test(e)}function f(e){return n.StringUtils.isIMGOnly(o.emojiService.parseTextForEmoji(e))}function y(e){return i.test(e)&&!_(e)&&!f(e)}function v(e,n){const o=e.next();return o===s.QuoteCharacter.DOUBLE?n.tokenize=u(o):t.test(o)?n.tokenize=function(e,t){return t.tokenize=v,"bracket"}:c.test(o)?n.tokenize=function(e){return function(t,i){let n="operator";switch(e){case"+":n+=" positive";break;case"-":n+=" negative";break;case"^":n+=" boost";break;case"|":case"*":case"&":t.eat(new RegExp(`\\${e}`))}return i.tokenize=v,n}}(o):i.test(o)?n.tokenize=m(o):n.inQuote&&void 0!==n.lastUsedQuoteCharacter&&(n.tokenize=u(n.lastUsedQuoteCharacter)),n.tokenize!==v?n.tokenize(e,n):null}return{startState:function(){return{tokenize:v,inQuote:!1}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)}}}),i.defineMIME("text/x-tw-query","tw-query")}),define("forms/editor_wrapper",["require","exports","codemirror","event_bus","jquery","reusable_services","reusable_utilities","classes/context_data/context_data","codemirror-placeholder","codemirror-matchbrackets","own_codemirror/mode/tw-query"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});const c={autoRefresh:!0,lineNumbers:!1,lineWrapping:!0,matchBrackets:{maxHighlightLineLength:4096},mode:"tw-query",theme:"talkwalker",flattenSpans:!1};t.default=function(){return l};class l{constructor(e,t,o,a){this.errorHandler=a;const{isReadOnly:l,maxLength:d,inputMode:g,forceFocus:u,selectAll:p}=o,h=_(t).debounce(10),m=_(c).clone();if(m.readOnly=l||!1,m.maxLength=d||-1,this.cancellationToken=new r.CancellationToken,this.reference=i.fromTextArea(e,m),this.reference.on("cursorActivity",h),this.reference.on("renderLine",this.emojify.bind(this)),this.reference.on("update",h),this.reference.on("beforeChange",this.onChange.bind(this)),o.maxWidth){s(s(".CodeMirror").toArray().find(e=>e.CodeMirror===this.reference)).css("maxWidth",`${o.maxWidth}px`)}if(u&&this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.CODEMIRROR_FOCUS,e=>{this.reference&&this.focus()}),p&&this.cancellationToken.setTimeout(()=>{this.reference&&this.reference.execCommand("selectAll")},0),g){const e=["Down","Enter","Esc","Tab","Up"].reduce((e,t)=>(e[t]=(()=>({})),e),{});this.reference.setOption("extraKeys",e)}}emojify(e,t,i){const n=i.querySelectorAll(".cm-emoji");Array.from(n).forEach(e=>{const t=s(o.emojiService.parseTextForEmoji(e.innerText))[0].src;e.style.backgroundImage=`url(${t})`})}onChange(e,t){return this.exceedsMaxLength(e,t)?this.errorHandler("maxlength",this.getMaxLengthErrorMessage(e)):this.errorHandler("maxlength",void 0),!0}getMaxLengthErrorMessage(e){return a.contextData.getMessage("_790529",[e.getOption("maxLength")])}exceedsMaxLength(e,t){const i=e.getOption("maxLength");if(i&&i>0&&t.update){let n=t.text.join("\n").length-(e.indexFromPos(t.to)-e.indexFromPos(t.from));if(n<=0)return!1;if((n=e.getValue().length+n-i)>0)return!0}return!1}get currentToken(){return this.reference.getTokenAt(this.cursor)}get cursor(){return this.doc.getCursor()}get relatedProperty(){return this.isAfterColon||this.isColon?this.reference.getTokenAt({line:this.cursor.line,ch:this.currentToken.start-(this.isColon()?0:1)}).string:void 0}get doc(){return this.reference.getDoc()}get value(){return this.reference.getValue()}set value(e){this.reference.setValue(e)}getWordSoFar(){return this.currentToken.string.slice(0,this.cursor.ch-this.currentToken.start)}getCurrentTokenString(){return this.currentToken.string}isAfterColon(){const e={line:this.cursor.line,ch:this.currentToken.start};return":"===this.reference.getTokenAt(e).string}isColon(){return":"===this.reference.getTokenAt(this.cursor).string}focus(){this.reference.focus()}dispose(){this.cancellationToken&&this.cancellationToken.cancel()}getSuggestionBoxPosition(){const e={line:this.cursor.line,ch:this.reference.getTokenAt(this.cursor).start},t=this.reference.charCoords(e,void 0);return{x:t.left,y:t.bottom}}insertSuggestion(e){const t=this.cursor,i=this.currentToken,n={line:t.line,ch:null===i.type?i.end:i.start},s={line:t.line,ch:i.end};this.reference.getDoc().replaceRange(e.value,n,s),this.focus();const o={line:t.line,ch:(null===i.type?i.end:i.start)+e.value.length};this.reference.getDoc().setCursor(o)}refresh(){this.reference.refresh()}resetErrorRegion(){this.reference.getDoc().getAllMarks().forEach(e=>e.clear())}highlightErrorRegion(e,t){this.doc.markText(e,t,{className:"error-proximity cm-string"})}}t.Editor=l}),define("forms/code_editor/directive",["require","exports","angular","reusable_utilities","underscore","forms/code_container/directive","services/template_source","event_bus"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),d.$inject=["EditorWrapper","$timeout"],t.default=d;const c="\\u0590-\\u07FF\\u200F\\u202B\\u202E\\uFB1D-\\uFDFD\\uFE70-\\uFEFC",l=new RegExp(`([${c}*?](?:[${c}\\-()\\[\\].,*?]|[^\\S\\n])+[${c}*?])`,"g");function d(e,t){return{replace:!0,require:["ngModel","^?codeContainer"],restrict:"E",link:function(r,c,d,g){const u=g[0];let p,h,m,_=!1;return(()=>{t(()=>{const t=new n.CancellationToken;null===g[1]?(p={configuration:o.defaultCodeContainerConfiguration},h={}):(p=g[1].input,h=g[1].suggestions);const s=p.configuration;m=new e(c.get(0),()=>r.$evalAsync(),{maxWidth:d.maxWidth?parseInt(d.maxWidth):void 0,maxLength:s.maxLength,forceFocus:s.forceFocus,isReadOnly:s.isReadOnly||i.isDefined(d.readOnly),inputMode:s.inputMode||i.isDefined(d.inputMode),selectAll:s.selectAll},function(e,t,i){e.errorData&&e.$error&&(void 0!==i?(e.$error[t]=!0,e.errorData[t]={message:i}):(e.$error[t]&&delete e.$error[t],e.errorData[t]&&delete e.errorData[t]))}.bind(this,u)),t.registerDisposable(m),u.$formatters.push(y),u.$render=f,u.$parsers.push(v),t.addDomEvent(c.parent().get(0),"keydown",b),t.setInterval(E,100),t.registerCleanupFunction(r.$watch(()=>m.cursor,w)),t.registerCleanupFunction(r.$watch(()=>m.value,C)),r.$on("$destroy",()=>t.cancel()),p.editor=m,a.eventBus.dispatch({type:a.EVENT_TYPES.CODEMIRROR_INITIALIZED,value:void 0})})})();function f(){m.value!==u.$viewValue&&(m.value=u.$viewValue||"")}function y(e=""){for(let t=l.exec(e);null!==t;){const i=e.slice(0,t.index),n=t[1].replace(/^(.*)([*?])$/,(e,t,i)=>`${i}${t}`),s=e.slice(t.index+n.length,e.length);e=[i,n,s].join(""),t=l.exec(e)}return e}function v(e){for(let t=l.exec(e);null!==t;){const i=e.slice(0,t.index),n=t[1].replace(/^([*?])(.*)$/,(e,t,i)=>`${i}${t}`),s=e.slice(t.index+n.length,e.length);e=[i,n,s].join(""),t=l.exec(e)}return e}function S(){return m.getCurrentTokenString()}function b(e){32===e.keyCode&&e.ctrlKey&&(h.updateSuggestions({wordSoFar:S(),context:{comesAfterColon:m.isAfterColon(),property:m.relatedProperty}},!0),e.stopPropagation())}function w(e,t){!s([void 0,t]).contains(e)&&i.isFunction(h.updateSuggestions)&&h.updateSuggestions({wordSoFar:S(),context:{comesAfterColon:m.isAfterColon(),isColon:m.isColon(),property:m.relatedProperty}})}function C(e,t){s([void 0,t]).contains(e)||u.$setViewValue(e)}function E(){const e=function(){const e=c.next().offset();return!s([e.top,e.left]).every(e=>0===e)}();!_&&e?(m.refresh(),_=!0):_&&!e&&(_=!1)}},templateUrl:r.templateSourceFactory("forms/code_editor")}}t.CodeEditorDirective=d}),define("forms/code_input/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{replace:!0,require:"ngModel",restrict:"E",templateUrl:i.templateSourceFactory("forms/code_input")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.CodeInputDirective=n}),define("forms/color_picker/directive",["require","exports","services/template_source"],function(e,t,i){function n(){return{replace:!0,restrict:"E",scope:{color:"="},link:function(e){e.color=void 0===e.color?"#3937a1":e.color},templateUrl:i.templateSourceFactory("forms/color_picker")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.ColorPickerDirective=n}),define("forms/quicksearch_code_container_form/directive",["require","exports","angular","angular_utilities","event_bus","reusable_utilities","services/template_source"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"AE",bindToController:{configuration:"=?"},controllerAs:"vm",controller:a,templateUrl:r.templateSourceFactory("forms/quicksearch_code_container_form"),scope:{}}};let a=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.$timeout=i}$onInit(){const{onKeyDown:e,onModelUpdate:t,forceFocus:i,initialValue:n}=this.configuration;this.cancellationToken=new o.CancellationToken,this.model=n,void 0!==e&&this.cancellationToken.addDomEvent(this.$element.get(0),"keydown",e=>{this.$timeout(this.handleKeyDown.bind(this,e),0)}),void 0!==t&&this.cancellationToken.registerCleanupFunction(this.$scope.$watch(()=>this.model,(e,i)=>{e!==i&&t({newValue:e,oldValue:i})})),i&&this.$timeout(()=>{s.eventBus.dispatch({type:s.EVENT_TYPES.CODEMIRROR_FOCUS,value:void 0})},200),this.$scope.$on("$destroy",()=>this.cancellationToken.cancel())}handleKeyDown(e){const{onKeyDown:t}=this.configuration;t(e,this.model)}};a=__decorate([n.ngInject(["$scope","$element","$timeout"]),__metadata("design:paramtypes",[Object,Object,Function])],a),t.QuicksearchCodeContainerFormController=a}),define("forms/specific_suggestion_input/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){function s(){return e.$inject=["$attrs","$document","$element","$scope","CodeSuggestions","SourcePanelSuggestions"],{replace:!0,require:"ngModel",restrict:"E",scope:{inclusionType:"=",location:"=",sourcePanelId:"="},controller:e,link:function(e,t,n,s){return s.$formatters.push(a),s.$render=o,s.$parsers.push(r),e.type=n.type,void(e.unregisterFunctions=[...e.unregisterFunctions||[],e.$watch(()=>e.value,c)]);function o(){e.value=s.$viewValue}function r(t){return i([void 0,""]).contains(t)?void 0:i([void 0,"","true"]).contains(n.addKeyword)?`${e.type}:${t}`:t}function a(e=""){const t=new RegExp(`^${n.type}:`);return e.replace(t,"")}function c(t,n){i([void 0,n]).contains(t)||(s.$setViewValue(t),e.updateSuggestions())}},templateUrl:n.templateSourceFactory("forms/specific_suggestion_input")};function e(e,n,s,o,r,a){const c=this;let l,d=!1;return(()=>{switch(this.suggestions={},this.input={editor:{insertSuggestion:h,focus:()=>{}}},o.updateSuggestions=u,o.hasFocusAndNotEmpty=g,s.get(0).addEventListener("keydown",m,!0),o.unregisterFunctions=[...o.unregisterFunctions||[],()=>s.get(0).removeEventListener("keydown",m,!0)],o.$on("destroy",()=>o.unregisterFunctions.forEach(e=>e())),e.endpointType){case"source_panel_entry_suggest":l=new a(t("source_panel_entry_suggest",e.endpointAction||"show"),{location:o.location,inclusion_type:o.inclusionType,source_panel_id:o.sourcePanelId});break;case"query_editor":case void 0:l=new r(t("query_editor",e.endpointAction||"show"),{location:o.location});break;default:throw new Error("invalid endpoint type")}return this})();function g(){return i(s.find("input")).filter(e=>e===n[0].activeElement&&void 0!==e.value&&e.value.length>0).length>0}function u(){if(!d){const t={wordSoFar:o.value,context:{comesAfterColon:!0,property:e.type}};l.getSuggestions(t).then(p)}}function p(e){c.suggestions.setSuggestions(e)}function h(e){o.value=e.value,p([]),d=!0,o.$emit("suggestionInserted",{suggestion:e,context:{location:o.location,inclusionType:o.inclusionType,sourcePanelId:o.sourcePanelId}})}function m(e){d=!1;try{switch(e.keyCode){case 40:c.suggestions.selectNext(),e.stopPropagation(),e.preventDefault();break;case 38:c.suggestions.selectPrevious(),e.stopPropagation(),e.preventDefault();break;case 13:case 9:h(c.suggestions.getSelected()),e.stopPropagation(),e.preventDefault();break;case 27:c.suggestions.resetSuggestions(),e.stopPropagation(),e.preventDefault()}o.$evalAsync()}catch(e){}}}function t(e,t){return routes.controllers.tw.TWRestForm.post("project",window.tw.project_id,e,t,"","rform").url}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,t.SpecificSuggestionDirectiveDirective=s}),define("forms/suggestion_box/directive",["require","exports","angular","underscore","classes/context_data/context_data","services/template_source","services/scripts_loading"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),l.$inject=["scriptsLoadingService"],t.default=l;const a={debounce:{scroll:10,disableHover:250}},c=-1;function l(){return{replace:!0,require:["^?codeContainer","^?specificSuggestionInput"],restrict:"E",transclude:!1,scope:{focusDelegate:"=?"},link:function(e,t,o,l){const d=l[0]||l[1],g=d.suggestions;let u=!1;const p=n(function(){const e=t.find(".suggestion__scrollbox");if(0!==e.length){const i=e.offset().top,n=e.height(),s=i+n,o=t.find(".suggestion__item.selected"),r=o.offset().top,a=r+o.height(),c=t.find(".suggestion__list"),l=c.offset().top;r<i?e.scrollTop(r-l):a>s&&e.scrollTop(a-l-n)}}).debounce(a.debounce.scroll),h=n(function(){u=!1}).debounce(a.debounce.disableHover);return e.canDisplayItemDescription=F,e.getSelectedDescription=C,e.getSelectedImage=y,e.getSelectedDocLink=b,e.getSelectedExample=w,e.getSelectedMapCoords=E,e.hasSuggestions=m,e.hoverHandler=P,e.isMapAllowed=R,e.isSelected=A,e.resetSuggestions=_,e.select=D,e.showBox=S,e.canShowDocLink=M,e.selectedIndex=-1,g.getSelected=T,g.hasSuggestions=m,g.resetSuggestions=_,g.selectNext=I,g.selectPrevious=x,void(g.setSuggestions=f);function m(){return i.isDefined(e.data)&&0!==e.data.length}function _(){e.data=[],e.selectedIndex=c}function f(t){e.data=t||[],e.selectedIndex=c}function y(){return i.isDefined(T())?T().image:void 0}function v(){u=!0,h()}function S(){return e.hasSuggestions()&&(void 0===e.focusDelegate||e.focusDelegate())}function b(){return i.isDefined(T())?T().docLink:void 0}function w(){return i.isDefined(T())?T().example:void 0}function C(){return i.isDefined(T())?T().description:void 0}function E(){return i.isDefined(T())?T().mapCoords:void 0}function T(){return e.data[e.selectedIndex]}function M(){return void 0!==e.getSelectedDocLink()&&s.contextData.rules.isAcademyEnabled()}function P(t){u||(e.selectedIndex=t)}function D(){d.input.editor.insertSuggestion(T()),d.input.editor.focus()}function A(t){const i=e.selectedIndex;return t===i&&(p(),!0)}function I(){if(v(),!m())throw new Error("no suggestions");e.selectedIndex=(e.selectedIndex+1)%e.data.length}function x(){if(v(),!m())throw new Error("no suggestions");e.selectedIndex=[c,0].includes(e.selectedIndex)?e.data.length-1:e.selectedIndex-1}function R(){return!r.scriptsLoadingService.googleMaps.blocked&&void 0!==E()}function F(){return void 0!==y()||void 0!==C()||R()}},templateUrl:o.templateSourceFactory("forms/suggestion_box")}}t.SuggestionBoxDirective=l}),define("forms/suggestions_source_panel",["require","exports","forms/suggestions/suggestion_source","forms/suggestions_code","classes/context_data/context_data"],function(e,t,i,n,s){function o(e,t){return class{constructor(e,s={}){this.providers=[{label:"SOURCE",postProcessor:i.SourceSuggestion.parseRawDatum}].map(i=>t.createProvider(i.label,n.processAsyncResponse(i.postProcessor),e,s))}getSuggestions(t){if(s.contextData.userSettings.autocomplete){const i=this.providers.map(function(e){return e.getSuggestionsPromise(t)});return e.all(i).then(e=>e.reduce((e,t)=>[...e,...t],[]).sort((e,t)=>e.score>t.score?1:-1))}return e.when([])}}}Object.defineProperty(t,"__esModule",{value:!0}),o.$inject=["$q","AsyncSuggestionHelper"],t.SourcePanelSuggestionsService=o,t.default=o}),define("react_components/hyperlink_with_icon/directive",["require","exports","react","services/react_bridge_factory","reusable_components"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n.createReactBridge(e=>i.createElement(s.HyperlinkWithIconContainer,{containerClass:e.containerClass,hyperlinkWrapperClass:e.hyperlinkWrapperClass,hyperlinkClickHandler:e.hyperlinkClickHandler,hyperlinkIconWrapperClass:e.hyperlinkIconWrapperClass,hyperlinkIconClass:e.hyperlinkIconClass,hyperlinkLabel:e.hyperlinkLabel}),{containerClass:"=?",hyperlinkWrapperClass:"=?",hyperlinkClickHandler:"=?",hyperlinkIconWrapperClass:"=?",hyperlinkIconClass:"=?",hyperlinkLabel:"@?"},{replace:!1})}),define("forms/injectable_code_editor/directive",["require","exports","angular_utilities","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{restrict:"AE",replace:!1,bindToController:{query:"=",validator:"@",location:"@",label:"@"},controllerAs:"vm",controller:s,templateUrl:n.templateSourceFactory("forms/injectable_code_editor")}};let s=class{constructor(e){this.$scope=e}$onInit(){}};s=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],s)}),define("entry_point/configurations/angular_configuration/angular_modules/components_forms",["require","exports","angular","components/custom_time_filters/directive","components/document_template_manager/directive","components/document_template_manager/ppt_placeholder_templates/directive","components/form/accordeon_tree/children/directive","components/form/accordeon_tree/directive","components/form/all_fields_messages/directive","components/form/autofocus/directive","components/form/color_select/directive","components/form/double_list_select/directive","components/form/error/directive","components/form/field_message/directive","components/form/file_upload/directive","components/form/flat_tag_select/directive","components/form/group_select/directive","components/form/input/autofill","components/form/input/constraint","components/form/input/field_validity","components/form/input/focus_form","components/form/label_select/directive","components/form/label_select_div/directive","components/form/single_select/directive","components/form/tabs/common_tab_content/directive","components/form/tabs/tab/directive","components/form/tabs/tab_content_transclude/directive","components/form/tabs/tab_heading_transclude/directive","components/form/tabs/tab_list/directive","components/form/tabs/tabset/directive","components/form/tree_select/directive","components/form/tree_select/topic_menu_select","components/form/validation/password_verify","components/image_gallery/directive","components/multiple_checkbox/directive","components/page/login/directive","components/progress_button/directive","components/react_single_select/directive","controllers/rest_form/data_set/custom_indicators_form/directive","controllers/rest_form/data_set/google_analytics_form/directive","controllers/rest_form/data_set/google_sheets_form/directive","forms/code_container/directive","forms/code_editor/directive","forms/code_input/directive","forms/color_picker/directive","forms/query_validator","forms/quicksearch_code_container_form/directive","forms/specific_suggestion_input/directive","forms/suggestion_box/directive","forms/editor_wrapper","forms/suggestion_provider_factory","forms/suggestions_code","forms/async_provider_helper","forms/suggestions_source_panel","components/captchas/simple_math/directive","react_components/hyperlink_with_icon/directive","forms/injectable_code_editor/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q,V,z,Y,X,K,Q,J,Z,ee,te,ie){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_forms",[]).directive("twCustomTimeFilters",n.default).directive("documentTemplateManager",s.default).directive("pptPlaceholderTemplates",o.default).directive("twAccordeonTreeChild",r.default).directive("twAccordeonTree",a.default).directive("allFieldsMessages",c.default).directive("autofocus",l.default).directive("colorSelect",d.default).directive("doubleListSelect",g.default).directive("errorValidation",u.default).directive("fieldMessage",p.default).directive("fileUpload",h.default).directive("flatTagSelect",m.default).directive("groupSelect",_.default).directive("autofill",f.default).directive("twConstraint",y.default).directive("fieldValidity",v.default).directive("twFocusForm",S.default).directive("labelSelect",b.default).directive("labelSelectDiv",w.default).directive("singleSelect",C.default).directive("commonTabContent",E.default).directive("tab",T.default).directive("tabContentTransclude",M.default).directive("tabHeadingTransclude",P.default).directive("tabList",D.default).directive("tabset",A.default).directive("treeSelect",I.default).directive("topicMenuSelect",x.default).directive("twPasswordVerify",R.default).directive("twImageGallery",F).directive("multipleCheckbox",O).directive("loginPage",k.default).directive("twProgressButton",N.default).directive("reactSingleSelect",L).directive("datasetCustomIndicatorForm",B.default).directive("datasetGoogleAnalyticsForm",W.default).directive("datasetGoogleSheetsForm",U.default).directive("codeContainer",G.default).directive("codeEditor",$.default).directive("codeInput",j.default).directive("twColorPicker",H.default).directive("queryValidator",q.default).directive("quicksearchCodeContainerForm",V.default).directive("specificSuggestionInput",z.default).directive("suggestionBox",Y.default).directive("twHyperlinkWithIcon",te.default).directive("simpleMathCaptcha",ee.default).factory("EditorWrapper",X.default).factory("SuggestionProviderFactory",K.default).factory("CodeSuggestions",Q.default).service("AsyncSuggestionHelper",J.default).service("SourcePanelSuggestions",Z.default).directive("injectableCodeEditor",ie.default)}),define("react_components/modals/dashboard_users_modal",["require","exports","react","underscore","flux","services/rest_form_service","reusable_components","classes/context_data/context_data","services/context"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.DashboardUsersModal=class extends s.BaseComponent{constructor(e){super(e),this.state={}}componentDidMount(){this.fetchUsersAndGroups()}componentWillReceiveProps(e){n.isEqual(e,this.props)||this.fetchUsersAndGroups()}fetchUsersAndGroups(){o.restFormService.get(routes.controllers.tw.TWRestForm.post(c.contextService.getCurrentContext().scope,c.contextService.getCurrentContext().id,"dashboards_user_access","show",this.props.mappedId,"rform").url).then(e=>{this.setState({users:e.users,groups:e.user_groups})})}render(){return i.createElement("form",{className:"form-horizontal dashboard-users",name:"widget_form"},i.createElement("div",{className:"form-group"},i.createElement("div",{className:"col-xs-12"},this.generateUsersTable(),this.generateUserGroupsTable())))}generateUsersTable(){const{users:e}=this.state;if(n.isUndefined(e))return i.createElement(r.SpinnerComponent,null);{const t=e.map(e=>({id:e.user_id,name:e.full_name,description:e.email,hasAccess:e.has_access,user:e}));return i.createElement(r.AccessManagementComponent,{objects:t,actions:this.generateUserActions(),messages:{title:a.contextData.getMessage("_001184"),name:a.contextData.getMessage("_001160"),description:a.contextData.getMessage("_001143"),access:a.contextData.getMessage("_1997455"),actions:a.contextData.getMessage("_1997456")}})}}generateUserGroupsTable(){const{groups:e}=this.state;if(n.isUndefined(e))return i.createElement(r.SpinnerComponent,null);if(0===e.length)return null;{const t=e.map(e=>({id:e.group_id,name:e.name,description:e.description,hasAccess:e.has_access,group:e}));return i.createElement(r.AccessManagementComponent,{objects:t,actions:this.generateUserGroupActions(),messages:{title:a.contextData.getMessage("_1702734"),name:a.contextData.getMessage("_001160"),description:a.contextData.getMessage("_313429"),access:a.contextData.getMessage("_1997455"),actions:a.contextData.getMessage("_1997456")}})}}generateUserActions(){return[{id:"GRANT_ACCESS",icon:"fa fa-unlock-alt",title:a.contextData.getMessage("_1777777"),success_title:a.contextData.getMessage("_1777778"),action:(e,t)=>(t.preventDefault(),void 0!==e.user?this.grantUserAccess(e.user).then(this.updateUserList.bind(this)):void 0),canShow:e=>e.user&&!e.user.has_access},{id:"REVOKE_ACCESS",icon:"fa fa-ban",title:a.contextData.getMessage("_1777779"),success_title:a.contextData.getMessage("_1777780"),action:(e,t)=>(t.preventDefault(),void 0!==e.user?this.revokeUserAccess(e.user).then(this.updateUserList.bind(this)):void 0),canShow:e=>e.user&&e.user.has_access&&e.user.can_revoke_access}]}generateUserGroupActions(){return[{id:"GRANT_ACCESS",icon:"fa fa-unlock-alt",title:a.contextData.getMessage("_1777777"),success_title:a.contextData.getMessage("_1777778"),action:(e,t)=>(t.preventDefault(),void 0!==e.group?this.grantUserGroupAccess(e.group).then(this.updateGroupList.bind(this)):void 0),canShow:e=>e.group&&!e.group.has_access},{id:"REVOKE_ACCESS",icon:"fa fa-ban",title:a.contextData.getMessage("_1777779"),success_title:a.contextData.getMessage("_1777780"),action:(e,t)=>(t.preventDefault(),void 0!==e.group?this.revokeUserGroupAccess(e.group).then(this.updateGroupList.bind(this)):void 0),canShow:e=>e.group&&e.group.has_access&&e.group.can_revoke_access}]}updateUserList(e){const t=e.user_to_update;if(void 0!==t){const e=n.findIndex(this.state.users,e=>e.user_id===t.user_id);-1!==e&&(this.state.users[e]=t,this.setState({users:this.state.users,groups:this.state.groups}))}}updateGroupList(e){const t=e.user_group_to_update;if(void 0!==t){const e=n.findIndex(this.state.groups,e=>e.group_id===t.group_id);-1!==e&&(this.state.groups[e]=t,this.setState({users:this.state.users,groups:this.state.groups}))}}grantUserAccess(e){const t={user_to_update:e};return this.grantAccess(t)}grantUserGroupAccess(e){const t={user_group_to_update:e};return this.grantAccess(t)}revokeUserAccess(e){const t={user_to_update:e};return this.revokeAccess(t)}revokeUserGroupAccess(e){const t={user_group_to_update:e};return this.revokeAccess(t)}grantAccess(e){return o.restFormService.post(routes.controllers.tw.TWRestForm.post(c.contextService.getCurrentContext().scope,c.contextService.getCurrentContext().id,"dashboards_user_access","update",this.props.mappedId,"rform").url,e).then(e=>e)}revokeAccess(e){return o.restFormService.deleter(routes.controllers.tw.TWRestForm.deleter(c.contextService.getCurrentContext().scope,c.contextService.getCurrentContext().id,"dashboards_user_access","remove",this.props.mappedId,"rform").url,e).then(e=>e)}}}),define("components/modals/dashboard_users/directive",["require","exports","react","react_components/modals/dashboard_users_modal","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.DashboardUsersModal,{mappedId:e.dashboard.mapped_id,ok:e.ok}),{dashboard:"=",ok:"&"})}),define("react_components/modals/edit_comments_modal",["require","exports","flux","react","reusable_components","underscore","other/tw","services/rest_form_service","react_components/comment_info/comment_actions","react_components/form/progress_button/progress_button_container","react_components/image_gallery/image_gallery_container","services/comments","classes/context_data/context_data","file_upload"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p){Object.defineProperty(t,"__esModule",{value:!0});const h=130,m=5;t.EditCommentsModal=class extends i.BaseComponent{constructor(e){super(e),this.loadTopImages(),this.hasSelection=!1,this.state=this.calculateState(e)}componentWillReceiveProps(e){o.isEqual(e,this.props)||(this.loadTopImages(),this.setState(this.calculateState(e)))}isValidComment(e){const t=void 0!==e.image_url||void 0!==this.state.uploadPayload,i=void 0!==e.content&&e.content.trim().length>0;return t||i}calculateState(e){const{widget:t,nestedId:i,rowKey:n,timestamp:s,id:r}=e,a=e.widget.getDataGraph();let c=a.findComment(n,s),l=!1;if(void 0===c){const t=e.widget.findExtendedConfiguration(i);t.hasComments()&&(o.isUndefined(t.findComment(n,s))?o.isUndefined(r)||o.isUndefined(t.getComment(r))||(c=t.getComment(r)):c=t.findComment(n,s),l=!o.isUndefined(c))}else l=!0;if(!l){const i=a.getCommentsWithMarkers(!0).length;c={content:"",row_key:e.rowKey,timestamp:e.timestamp,pinned:i<m,display_type:g.commentsService.getCommentDisplayMode(t)||constants.comments.display_type.show_on_hover}}return{comment:c,showRemoveButton:!0===l,editImage:this.state&&this.state.editImage||!l,topImages:this.state&&this.state.topImages||void 0,charactersRemaining:this.state&&this.state.charactersRemaining||h}}loadTopImages(){const{widget:e,pageState:t}=this.props;let i=t||e.getPageState();i.getWidgets().length>1&&e.hasUf()&&(i=i.clone()).clearWidgetsByPredicate(t=>t.getId()!==e.getId()),a.restFormService.post(routes.controllers.tw.TWRestForm.post("project",r.tw.project_id,"top_images","search",0,"rform").url,{page_state:i.toProto(),sort_by:constants.search_data_functions.engagement,num_images:25}).then(e=>{if(!this.isUnmounted&&e&&void 0!==e.image_urls){this.hasSelection=!1;const t=o.map(e.image_urls||[],e=>(this.hasSelection=this.hasSelection||this.state.comment.image_url===e,{url:e,selected:!!this.state.comment&&this.state.comment.image_url===e}));this.setState({comment:this.state.comment,showRemoveButton:this.state.showRemoveButton,charactersRemaining:this.state.charactersRemaining,editImage:this.state&&this.state.editImage||!1,topImages:o.unique(t,!1,e=>e.url)})}})}render(){return n.createElement("form",{className:"form-horizontal edit-comments",name:"widget_form"},n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-3 control-label",htmlFor:"commentImage"},u.contextData.getMessage("_1745682")),n.createElement("div",{className:"col-xs-9"},this.generateImagePanel())),n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-3 control-label",htmlFor:"commentText"},u.contextData.getMessage("_1745678")),n.createElement("div",{className:"col-xs-9"},n.createElement("div",{className:"header center overflow overflow-2x"},n.createElement("textarea",{name:"commentText",className:"form-control",rows:5,value:this.state.comment.content,onChange:this.onValueChange.bind(this)})),this.generateCommentLengthWarning())),n.createElement("div",{className:"tw-buttons clearfix"},n.createElement(l.ProgressButtonContainer,{text:u.contextData.getMessage("_612374"),textCalling:u.contextData.getMessage("_911337"),clickEvent:this.onSubmit.bind(this,this.getSubmitAction()),disabled:!this.isFormValid(),className:"tw-button pull-right"})))}getSubmitAction(){const{comment:e}=this.state;return void 0===e||void 0===e.id?"add":"update"}generateCommentLengthWarning(){const{charactersRemaining:e}=this.state;return e<0?n.createElement("div",{className:"characters-remaining"},u.contextData.getMessage("_1654656")):null}onSubmit(e){this.checkIfMessageIsValid(this.state.comment).then(t=>{const{remaining_character_count:i}=t;i>=0?this.submitChanges(e):this.updateCommentLengthWarning(i)})}submitChanges(e){let t;t="add"===e?c.CommentActions.comment_onAddComment:"update"===e?c.CommentActions.comment_onUpdateComment:c.CommentActions.comment_onRemoveComment,i.dispatcher.dispatch(t,{widgetId:this.props.widget.getId(),comment:this.state.comment,nestedId:this.props.nestedId,isIndicator:this.props.isIndicator,uploadData:this.state.uploadPayload}),this.props.ok({})}updateCommentLengthWarning(e){this.setState({charactersRemaining:e})}checkIfMessageIsValid(e){return g.commentsService.validateComment(e,h)}isFormValid(){return this.isValidComment(this.state.comment)}onValueChange(e){const t=e.target;if(this.state.comment){const e=this.state;e.comment.content=t.value,this.setState(e)}}generateImagePanel(){const{editImage:e}=this.state,t=this.getImageThumbnailUrl();let i=[];return void 0!==t&&t.length>0?(i.push(this.generateImageThumbnail()),e&&(i=i.concat(this.generateImageEditPanel())).push(this.generateImageUploadForm())):(i=i.concat(this.generateImageEditPanel())).push(this.generateImageUploadForm()),i}generateImageThumbnail(){const{editImage:e}=this.state,t=e?null:n.createElement("div",{key:"edit-actions",className:"edit-actions"},n.createElement("i",{className:"fa fa-pencil clickable",title:"Edit",onClick:this.enterEditMode.bind(this,!0)}));return n.createElement("div",{key:"image",className:"comment-image"},t,n.createElement("img",{src:this.getImageThumbnailUrl()}))}generateImageUploadForm(){return n.createElement("div",{key:"upload-form",id:"upload-form"},this.addSeparator(),n.createElement("div",{className:"header"},u.contextData.getMessage("_1745690")),n.createElement("div",{className:"default-width file-upload"},n.createElement(p.FileUpload,{label:"Upload",mimeFilter:"image/*",onLoad:e=>this.handleImageLoaded(e)})))}addSeparator(){return n.createElement("span",{key:"separator",className:"separator-text"},n.createElement("span",null,"or"))}handleImageLoaded(e){this.setState({uploadPayload:e})}generateImageEditPanel(){return[this.generateTopImages(),this.addSeparator(),n.createElement("div",{key:"image-url"},n.createElement("div",{className:"header"},u.contextData.getMessage("_1745689")),n.createElement("input",{name:"commentImage",className:"form-control",required:!0,maxLength:1024,value:this.state.comment.image_url,onChange:this.onImageUrlChange.bind(this)}))]}enterEditMode(e){const t=this.state;t.editImage=e,this.setState(t)}onImageUrlChange(e){const t=this.state,i=e.target,n=i.value;let s=t.topImages;!0===this.hasSelection&&(this.hasSelection=!1,s=o.map(t.topImages,e=>(e.selected=e.url===n,this.hasSelection=this.hasSelection||e.selected,e))),t.comment?(t.topImages=s,t.comment.image_url=i.value,t.uploadPayload=void 0,this.setState(t)):t.uploadPayload&&(t.uploadPayload=void 0,this.setState(t))}generateTopImages(){const{topImages:e}=this.state;return e?0===e.length?n.createElement("p",{key:"topImages"}):n.createElement(d.ImageGalleryContainer,{key:"topImages",items:this.state.topImages,header:u.contextData.getMessage("_1745688"),onImageClick:this.onImageClick.bind(this)}):n.createElement("div",{key:"topImages"},n.createElement(s.SpinnerComponent,null))}onImageClick(e){if(e&&e.url){const t=this.state;t.comment.image_url=e.url,t.uploadPayload=void 0,this.setState(t),this.hasSelection=!0}}getImageThumbnailUrl(){const{uploadPayload:e,comment:t}=this.state;return void 0!==e?e.dataUrl:void 0!==t?t.image_url:void 0}}}),define("components/modals/edit_comments/directive",["require","exports","react","services/react_bridge_factory","react_components/modals/edit_comments_modal"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.EditCommentsModal,{widget:e.widget,rowKey:e.rowKey,timestamp:e.timestamp,id:e.id,ok:e.ok,pageState:e.pageState,nestedId:e.nestedId,isIndicator:e.isIndicator}),{widget:"=",rowKey:"=",timestamp:"=",id:"=?",pageState:"=?",nestedId:"=?",isIndicator:"=?",ok:"&"})}),define("react_components/modals/image_mismatch_modal",["require","exports","flux","notifications","react","reusable_components","underscore","classes/context_data/context_data","other/tw","services/context","services/rest_form_service","wrappers/topic_menu/topic_menu_wrapper","react_components/form/progress_button/progress_button_container"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});t.ImageMismatchModal=class extends i.BaseComponent{constructor(e){super(e),this.predicateMap={[constants.reporting.data_science.logo.mapped_id]:e=>{const t=e.image;return void 0!==t&&t.bounding_boxes.length>0},[constants.reporting.data_science.mediatopic.mapped_id]:e=>{const t=c.tw.pageState.getUserFilterSettings().getTopicMenuByType(constants.topic_menu.TYPE.media_topics);return t&&t.getAllNode()&&!t.getAllNode().isSelected()}},this.state=this.initializeState(e)}initializeState(e){const{entry:t}=e;return{reportingOptions:this.buildTopicMenu(t)}}componentWillReceiveProps(e){r.isEqual(e,this.props)||this.setState(this.initializeState(e))}render(){return s.createElement("div",null,s.createElement("form",{className:"form-horizontal",name:"image_mismatch_form"},this.generateReportingDropDown(),s.createElement("div",{className:"tw-buttons clearfix"},s.createElement("div",{className:"bottom-btn-block clearfix"},s.createElement("div",{className:"col-xs-12 tw-buttons clearfix"},s.createElement(u.ProgressButtonContainer,{text:"Submit",textCalling:"Submitting...",clickEvent:this.submit.bind(this),className:"tw-button pull-right"}))))))}buildTopicMenu(e){return new g.TopicMenuWrapper({root_entry:{name:"Report type",mapped_id:"root",children:this.addOptions(e)},type:"REPORTING_TYPE",display_type:"SELECTIONBOX",pinned_type:"NONE",grouping:"NOT_APPLIED"})}addOptions(e){return e.metadata&&e.metadata.reporting_info[0]?e.metadata.reporting_info.map(e=>({mapped_id:e.type,name:e.label})):void 0}submit(e){const t={entry:this.props.entry,type:this.state.reportingOptions.getFirstSelectedEntry().getMappedId()};d.restFormService.post(routes.controllers.tw.TWRestForm.post(l.contextService.getCurrentContext().scope,l.contextService.getCurrentContext().id,"dev_image_recognition_reporting","send","","rform").url,t).then(e=>{e.data&&n.notificationService.success(e.data.message,{permanent:!0})}),this.props.ok({})}generateReportingDropDown(){const{reportingOptions:e}=this.state;if(e.getRootEntry().hasChildren()){const t=e.getRootEntry().getFirstSelectableChild();return s.createElement("div",{className:"form-group no-border-bottom"},s.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1000003")),s.createElement("div",{className:"col-xs-10"},s.createElement(o.SingleSelectComponent,{model:e.toProto(),allowEmptySelection:!1,defaultValue:t?t.getMappedId():void 0})))}return s.createElement("div",null,"Nothing to report!")}}}),define("components/modals/image_mismatch/directive",["require","exports","react","services/react_bridge_factory","react_components/modals/image_mismatch_modal"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.ImageMismatchModal,Object.assign({},e)),{entry:"=",ok:"&"})}),define("components/modals/grid_dashboard/page/settings/directive",["require","exports","react","react-dom","angular_utilities","classes/context_data/context_data","services/template_source","reusable_components","talkwalker_constants"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});const l={backgroundColor:"#7d8999",rounded:!1,size:"29px"};t.default=function(){return{replace:!0,restrict:"EA",scope:{},bindToController:{ok:"&",pageNumber:"=",icon:"="},controllerAs:"vm",controller:d,templateUrl:r.templateSourceFactory("components/modals/grid_dashboard/page/settings")}};let d=class{constructor(e,t){this.$scope=e,this.$element=t,this.save=this.saveButtonCallback.bind(this)}$onInit(){this.progressOptions={action:constants.events.form.action.post,text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337")},this.renderIconDropdownComponent()}renderIconDropdownComponent(){this.icons=[];let e="Aa";this.icon.icon.type===c.PageIcon.CUSTOM&&this.icon.icon.customIconData.type===a.CustomPageIconType.CUSTOM_LETTERS&&(e=this.icon.icon.customIconData.content),a.IconUtils.getDefaultPageIconModels(!0,e).forEach(e=>{const t=Object.assign({},l);e.type===c.PageIcon.CUSTOM&&(t.backgroundColor="#009bda"),this.icons.push({key:e,element:this.generateIconComponent(e,this.icon.pageTitle,this.pageNumber,t),selected:_.isEqual(e,JSON.parse(JSON.stringify(this.icon.icon)))})}),n.render(i.createElement(a.ItemGridSelectionDropdown,{columns:5,onItemChange:e=>this.onIconChange(e),items:this.icons,theme:{}}),this.$element.find(".grid-page-icon-dropdown").get(0)),this.$scope.$applyAsync()}generateIconComponent(e,t,n,s){return i.createElement(a.PageIconComponent,{model:e,pageTitle:t,pageNumber:n,iconProps:s,displayIconType:!0})}onIconChange(e){this.icon.icon=e.key,this.renderIconDropdownComponent()}onTitleChange(){this.renderIconDropdownComponent()}onIconContentChange(){this.icon.icon.customIconData.content=this.icon.icon.customIconData.content.substring(0,2),this.renderIconDropdownComponent()}showIconContentBox(){return this.icon.icon.type===c.PageIcon.CUSTOM&&this.icon.icon.customIconData.type===a.CustomPageIconType.CUSTOM_LETTERS}saveButtonCallback(){this.ok({icon:this.icon})}};d=__decorate([s.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],d)}),define("entry_point/configurations/angular_configuration/angular_modules/components_modals",["require","exports","angular","components/modals/articles/send/directive","components/modals/bulletin/directive","components/modals/bulletin/impersonate/directive","components/modals/command_center/clone_commandcenter/directive","components/modals/command_center/clone_screen/directive","components/modals/copy_dashboard/directive","components/modals/copy_report/directive","components/modals/custom_page/widget_additions/directive","components/modals/customtimefilter_timeslot/directive","components/modals/dashboard_page/directive","components/modals/dashboard_users/directive","components/modals/directive","components/modals/discovery_export/directive","components/modals/edit_axis_labels/directive","components/modals/edit_comments/directive","components/modals/export_all/directive","components/modals/ga/indicator/directive","components/modals/generic/send_email/directive","components/modals/generic_text_input/directive","components/modals/help/contact/directive","components/modals/hootsuite_sharing_options/directive","components/modals/image_mismatch/directive","components/modals/image_sharing_options/directive","components/modals/information/directive","components/modals/multipage_modal/directive","components/modals/panel/directive","components/modals/password/directive","components/modals/project/setup/directive","components/modals/project/users/access/directive","components/modals/report/alert/directive","components/modals/report/alert_now/directive","components/modals/report/convert_output_type/directive","components/modals/report/mailing_lists/directive","components/modals/report/migration/directive","components/modals/report/send/directive","components/modals/report/slide/layouts/directive","components/modals/grid_dashboard/page/settings/directive","components/modals/report/widget/directive","components/modals/result_rule/add/directive","components/modals/saveview/directive","components/modals/share_dashboard/directive","components/modals/sharing/directive","components/modals/topic/color/directive","components/modals/topics/category/directive","components/modals/widget/directive","components/modals/add_to_watchlist/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q,V,z,Y){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_modals",[]).directive("twSendArticles",n.default).directive("twModalBulletin",s.default).directive("twModalBulletinImpersonate",o.default).directive("twModalCloneCommandCenter",r.default).directive("twModalCloneCommandCenterScreen",a.default).directive("twModalCopyDashboard",c.default).directive("twModalCopyReport",l.default).directive("customPageWidgetAdditions",d.default).directive("twCustomtimefilterTimeslot",g.default).directive("twDashboardPageModal",u.default).directive("twModalDashboardUsers",p).directive("twModals",h.default).directive("twDiscoveryExport",m.default).directive("twModalEditAxisLabels",_.default).directive("twModalEditComments",f).directive("twExportAll",y.default).directive("twGaIndicator",v.default).directive("twGenericSendEmail",S.default).directive("twGenericTextInput",b.default).directive("twHelpContact",w.default).directive("twModalHootsuiteSharingOptions",C.default).directive("twModalImageMismatch",E).directive("twImageSharingOptions",T.default).directive("twModalInformation",M.default).directive("multipageModal",P.default).directive("twModalPanel",D.default).directive("twModalPassword",A.default).directive("twModalProjectSetup",I.default).directive("twModalProjectUsersAccess",x.default).directive("twAlertReport",R.default).directive("twAlertNowReport",F.default).directive("twModalChangeReportOutputType",O.default).directive("twModalMailingLists",k.default).directive("reportMigrationModal",N.default).directive("twSendReport",L.default).directive("modalReportSlideLayouts",B.default).directive("modalGridDashboardPageSettings",W.default).directive("twWidgetReport",U.default).directive("twAddResultRule",G.default).directive("twModalSaveView",$.default).directive("twModalShareDashboard",j.default).directive("twModalSharing",H.default).directive("twModalTopicColor",q.default).directive("twModalTopicsCategory",V.default).directive("twAddToWatchlist",Y.default).directive("twModalWidget",z.default)}),define("filters/localize_na",["require","exports","classes/context_data/context_data"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(e){return e===constants.data_graph.value_not_accessible?i.contextData.getMessage("_714772"):e}}}),define("filters/percent",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$filter",function(e){return function(t,n){return!i.isUndefined(t)&&i.isNumber(t)?e("number")(100*t,n)+"%":""}}]}),define("filters/tendency",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$sce","twNumberFormatter",function(e,t){const i=t.getInstance();return function(t){let n="";if(t.is_old_value_zero?t.is_positive?n='<span class="tendency positive"><span class="icon-tw icon-tw-arrow-change-up">&nbsp;</span></span>':t.is_negative&&(n='<span class="tendency negative"><span class="icon-tw icon-tw-arrow-change-down">&nbsp;</span></span>'):t.is_positive?n='<span class="tendency positive"><span class="icon-tw icon-tw-arrow-change-up">&nbsp;</span>'+i.toPercentage(t.value_abs_percentage)+"</span>":t.is_negative&&(n='<span class="tendency negative"><span class="icon-tw icon-tw-arrow-change-down">&nbsp;</span>'+i.toPercentage(t.value_abs_percentage)+"</span>"),void 0!==t.css){let e='style="';Object.keys(t.css).forEach(function(i,n){0!==n&&(e+=" "),e+=i+": "+t.css[i]+";"}.bind(this)),e+='"><span',n=n.replace("><span",e)}return e.trustAsHtml(n)}}]}),define("filters/truncate",["require","exports","underscore"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(e,t,n){return t=i.isUndefined(t)||isNaN(t)?10:t,n=i.isUndefined(n)?"...":n,e.length>t?String(e).substring(0,t-n.length)+n:e}}}),define("entry_point/configurations/angular_configuration/angular_modules/components_ng_filters",["require","exports","angular","filters/localize_na","filters/percent","filters/tendency","filters/truncate"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_ngFilters",[]).filter("localize_na",n.default).filter("percent",s.default).filter("tendency",o.default).filter("truncate",r.default)}),define("components/anchor/icon_anchor/icon_anchor_container",["require","exports","react","reusable_components","services/react_bridge_factory","reusable_utilities","event_bus"],function(e,t,i,n,s,o,r){class a extends i.Component{componentDidMount(){this.cancellationToken=new o.CancellationToken,this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,e=>this.rerender()),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.ANCHOR_MODEL_CHANGED,e=>this.updateModel(e.value))}componentWillUnmount(){this.cancellationToken.cancel()}render(){return i.createElement(n.IconAnchor,{model:this.props.model})}rerender(){this.forceUpdate()}updateModel(e){const{model:t}=this.props;t.fontSize=e.fontSize,t.nodes=e.nodes,this.forceUpdate()}}return s.createReactBridge(e=>i.createElement(a,{model:e.model,style:e.style}),{model:"=",style:"="})}),define("components/anchor/presentation_anchor/presentation_anchor_container",["require","exports","react","reusable_components","services/react_bridge_factory","reusable_utilities","event_bus"],function(e,t,i,n,s,o,r){class a extends i.Component{componentDidMount(){this.cancellationToken=new o.CancellationToken,this.cancellationToken=new o.CancellationToken(r.eventBus.subscribe(r.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,e=>this.updateSelection(e.value)).unsubscribe)}updateSelection(e){this.props.model.nodes.forEach(t=>t.selected=t.id===e.id),this.forceUpdate()}componentWillUnmount(){this.cancellationToken.cancel()}render(){return i.createElement(n.PresentationAnchor,{model:this.props.model})}}return s.createReactBridge(e=>i.createElement(a,{model:e.model}),{model:"="})}),define("components/anchor/preview_anchor/preview_anchor_container",["require","exports","react","reusable_components","services/react_bridge_factory","reusable_utilities","event_bus"],function(e,t,i,n,s,o,r){class a extends i.Component{constructor(){super(...arguments),this.renderAllowed=!0}componentDidMount(){this.cancellationToken=new o.CancellationToken(r.eventBus.subscribe(r.EVENT_TYPES.ADD_ANCHOR_PREVIEW_NODE,e=>this.addNode(e.value)).unsubscribe,r.eventBus.subscribe(r.EVENT_TYPES.ANCHOR_SELECTION_CHANGED,e=>this.rerender()).unsubscribe,r.eventBus.subscribe(r.EVENT_TYPES.REMOVE_ANCHOR_PREVIEW_NODE,e=>this.removeNode(e.value)).unsubscribe,r.eventBus.subscribe(r.EVENT_TYPES.ANCHOR_MODEL_CHANGED,e=>this.rerender()).unsubscribe,r.eventBus.subscribe(r.EVENT_TYPES.REACT_DRAGGABLE_DRAG_START,this.handleDragStart.bind(this)).unsubscribe,r.eventBus.subscribe(r.EVENT_TYPES.REACT_DRAGGABLE_DRAG_STOP,this.handleDragStop.bind(this)).unsubscribe)}componentWillUnmount(){this.cancellationToken.cancel()}render(){return i.createElement(n.PreviewAnchor,{model:this.props.model})}addNode(e){this.props.model.nodes.push(e),this.rerender()}removeNode(e){this.props.model.nodes.splice(this.props.model.nodes.findIndex(t=>t.id===e),1),this.rerender()}rerender(){this.renderAllowed&&this.forceUpdate()}disableRerender(){this.renderAllowed=!1}enableRerender(){this.renderAllowed=!0,this.rerender()}handleDragStart(e){e.value===this.props.model.dropzoneChannels&&this.disableRerender()}handleDragStop(e){e.value===this.props.model.dropzoneChannels&&this.enableRerender()}updateNode(e){const t=this.props.model.nodes.findIndex(t=>t.id===e.id);-1!==t&&(this.props.model.nodes.splice(t,1,e),this.rerender())}}return s.createReactBridge(e=>i.createElement(a,{model:e.model}),{model:"=",ts:"="},{watch:["ts"]})}),define("react_components/comment_info/stores/comment_store",["require","exports","flux","react_components/comment_info/comment_actions","services/comments","classes/application/application"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});class r extends i.BaseStore{constructor(){super([n.CommentActions.comment_onSubmitChanges,n.CommentActions.comment_onAddComment,n.CommentActions.comment_onOpenModal,n.CommentActions.comment_onRemoveComment,n.CommentActions.comment_onTogglePin,n.CommentActions.comment_onUpdateComment,"global_onPageStateReceived","global_onPartialPageStateRefresh"])}static getInstance(){return r.instance}onOpenModal(e){const{widgetId:t,rowKey:i,timestamp:n,pageState:r,id:a,nestedId:c,isIndicator:l}=e,d=o.mainApplication.getWidgetById(t);s.commentsService.editComment(d,i,n,l,a,c,r)}onAddComment(e){const{widgetId:t,comment:i,uploadData:n,nestedId:r,isIndicator:a}=e,c=o.mainApplication.getWidgetById(t);s.commentsService.performEdit(c,i,"add",n,a,r).then(()=>{this.fireChangeEvent(e)})}onUpdateComment(e){const{widgetId:t,comment:i,uploadData:n,nestedId:r,isIndicator:a}=e,c=o.mainApplication.getWidgetById(t);s.commentsService.performEdit(c,i,"update",n,a,r).then(()=>{this.fireChangeEvent(e)})}onRemoveComment(e){const{widgetId:t,comment:i,nestedId:n,isIndicator:r,uploadData:a}=e,c=o.mainApplication.getWidgetById(t);s.commentsService.performEdit(c,i,"remove",a,r,n),this.fireChangeEvent(e)}onTogglePin(e){let{nestedId:t,isIndicator:i}=e;const{comment:n,widgetId:r}=e,a=o.mainApplication.getWidgetById(r);if(void 0===t&&a.hasNestedDics()){a.getNestedDics().every(e=>(e.getExtendedConfiguration().getComment(n.id)&&(t=e.getWidgetId()),void 0===t))}s.commentsService.togglePin(n,a,i,t),this.fireChangeEvent(e)}onPartialPageStateRefresh(e){this.onChange.fire({})}onPageStateReceived(e){this.onChange.fire({})}fireChangeEvent(e){const{widgetId:t,comment:i}=e;this.onChange.fire({widgetId:t,comment:i})}}r.instance=new r,t.CommentStore=r}),define("react_components/comment_info/components/comment_renderable",["require","exports","react","flux"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0});t.CommentRenderable=class extends n.BaseComponent{render(){const e=this.props.comment;return i.createElement("div",{className:"comment clearfix"},this.generateThumbnail(e),this.generateContent(e))}generateThumbnail(e){return e&&e.image_url?i.createElement("div",{className:"thumbnail"},i.createElement("img",{src:e.image_url})):null}generateContent(e){return e?i.createElement("span",{className:"content",dangerouslySetInnerHTML:{__html:e.content}}):null}}}),define("react_components/comment_info/components/comment_info_component",["require","exports","flux","react","underscore","react_components/comment_info/stores/comment_store","react_components/comment_info/components/comment_renderable"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.CommentInfoComponent=class extends i.BaseComponent{componentDidMount(){this.cancellationToken.registerCleanupFunction(o.CommentStore.getInstance().onChange.subscribe(e=>{const{widgetId:t}=this.props.commentInfo;e.widgetId===t&&this.forceUpdate()}).cancel)}render(){const{widgetId:e,comments:t,actions:i}=this.props.commentInfo;return n.createElement("div",{className:"tw-comment-info"},this.generateCommentList(e,t))}generateCommentList(e,t){return t&&t.length>0?[s.first(t)].map(t=>n.createElement(r.CommentRenderable,{key:t.id,comment:t,widgetId:e})):null}}}),define("components/comment_info/directive",["require","exports","react","services/react_bridge_factory","react_components/comment_info/components/comment_info_component"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.CommentInfoComponent,{commentInfo:e.commentInfo}),{commentInfo:"="})}),define("react_components/footnote_list/components/footnote_list_item",["require","exports","flux","react","reusable_components","react_components/comment_info/comment_actions","classes/context_data/context_data"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.FootnoteListItem=class extends i.BaseComponent{render(){const{comment:e,marker:t,callback:i}=this.props;return n.createElement("li",{className:"footnote clearfix"},n.createElement("div",{className:"image"},n.createElement(s.Image,{onError:i.bind(this),onLoad:i.bind(this),src:e.image_url}),n.createElement("div",{className:"marker-small"},n.createElement("span",{className:"label"},t))),n.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:e.content}}),this.generatePinningAction())}generatePinningAction(){return this.props.editMode?n.createElement("span",{className:"pinning"},n.createElement("i",{className:"fa fa-thumb-tack clickable",title:r.contextData.getMessage("_1745687"),onClick:this.unpin.bind(this)})):null}unpin(e){i.dispatcher.dispatch(o.CommentActions.comment_onTogglePin,{comment:this.props.comment,widgetId:this.props.widgetId,nestedId:this.props.nestedId,isIndicator:this.props.isIndicator})}}}),define("react_components/footnote_list/footnote_query",["require","exports","query_system"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.footNoteQuery=(e=>{const t=n(e),o=s(e.widget);return new i.Query({widget:t,footnotes:o,editMode:[new i.ProviderQuery(()=>{const t=e.widget.getPageState();return t.isEditMode()||t.getAllowedPages().isReport()}),new i.TransformationQuery(e=>e())]})});const n=e=>[new i.ProviderQuery(e.widget.toProto())],s=e=>[new i.ProviderQuery(e),new i.TransformationQuery(e=>{const t=e.getDataGraph(),i=t.getCommentsWithMarkers(!0),n=t.hasAdditionalFrames()&&!t.hasAnimationFrames(),s=e.hasNestedDics()&&e.getNestedDics()[0];return i.map(i=>{if(n){let n,o;return t.hasIndicatorFrames()&&void 0!==t.getDatasetFrame().comments&&(o=void 0!==t.getDatasetFrame().comments.find(e=>e.id===i.id)),!1===o&&s&&s.getExtendedConfiguration().hasComments()&&(n=void 0!==s.getExtendedConfiguration().getComments().find(e=>e.id===i.id)?s.getWidgetId():void 0),{comment:i,widgetId:e.getId(),isIndicator:o,nestedId:n}}return{comment:i,widgetId:e.getId()}})})]}),define("react_components/footnote_list/components/footnote_list_component",["require","exports","react","underscore","flux","react_components/footnote_list/components/footnote_list_item","react_components/comment_info/stores/comment_store","reusable_components","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.FootnoteListContainer=class extends s.BaseComponent{constructor(e){super(e),this.state=this.initializeState(e)}componentDidMount(){this.cancellationToken.subscribe(r.CommentStore.getInstance().onChange,e=>{e.widgetId&&e.widgetId!==this.state.widget.widget_id||this.setState(this.initializeState(this.props))})}initializeState(e){const t=e.query.execute();return t.imagesToLoad=window.isExport?(t.comments?t.comments:[]).filter(e=>this.isValidImageUrl(e.image_url)).length:-1,t}render(){return i.createElement("div",{className:"tw-footnotes"},i.createElement("ul",{className:"list-unstyled"},this.generateFootnotes()),this.generateLoadingFlag())}generateFootnotes(){const{widget:e,footnotes:t,editMode:s,imagesToLoad:r}=this.state;return t&&t.length>0?t.map((t,a)=>{const{comment:c,nestedId:l,isIndicator:d}=t,g=String.fromCharCode("a".charCodeAt(0)+a);return i.createElement(o.FootnoteListItem,{key:c.id,comment:c,marker:g,callback:-1!==r?this.loadItemCallback.bind(this,c):n.noop,nestedId:l,isIndicator:d,editMode:s,widgetId:e.widget_id})}):[i.createElement("li",{className:"no-pinned-annotations-message",key:"no-annotations-pinned"},i.createElement("p",null,c.contextData.getMessage("_1213623")),window.isExport?void 0:i.createElement("p",null,i.createElement("i",{className:"fa fa-thumb-tack"}),c.contextData.getMessage("_1213624")))]}loadItemCallback(e){this.isValidImageUrl(e.image_url)&&this.setState({imagesToLoad:this.state.imagesToLoad-1})}generateLoadingFlag(){const{imagesToLoad:e}=this.state;return-1!==e?i.createElement(a.ImageExportFlag,{fullyLoaded:0===e}):null}isValidImageUrl(e){return void 0!==e&&e.trim().length>0}}}),define("components/comment_list/directive",["require","exports","react","services/react_bridge_factory","react_components/footnote_list/components/footnote_list_component","react_components/footnote_list/footnote_query"],function(e,t,i,n,s,o){return n.createReactBridge(e=>i.createElement(s.FootnoteListContainer,{query:o.footNoteQuery(e)}),{widget:"="})}),define("components/context_menu/directive",["require","exports","react","services/react_bridge_factory","reusable_components"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n.createReactBridge(e=>i.createElement(s.ContextMenuBuilder,{widgetId:e.widgetId,widgetActions:e.widgetActions,onClickOutside:e.onClickOutside()}),{widgetId:"=",widgetActions:"=?",onClickOutside:"&"})}),define("components/dropdown_menu/generic/directive",["require","exports","react","reusable_components","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.GenericDropdownMenuRenderable,{model:e.menu}),{menu:"="})}),define("components/image_selector_list/directive",["require","exports","services/react_bridge_factory","react","reusable_components","reusable_utilities","event_bus"],function(e,t,i,n,s,o,r){let a;return i.createReactBridge(e=>((a=new o.CancellationToken).subscribeToStream(r.eventBus,r.EVENT_TYPES.IMAGE_SELECTOR_LIST_ITEM_SELECTED,()=>{e.$root.$$phase||e.$apply()}),n.createElement(s.ImageSelectorListContainer,{menu:e.menu})),{menu:"="},{cancellationToken:a})}),define("components/item_grid_selection_dropdown/directive",["require","exports","services/react_bridge_factory","react","reusable_components"],function(e,t,i,n,s){return i.createReactBridge(e=>n.createElement(s.ItemGridSelectionDropdown,{theme:e.theme||{},items:e.items,onItemChange:e.onItemChange,columns:e.columns}),{theme:"=?",items:"=",onItemChange:"=?",columns:"=?"})}),define("components/influencers_list_mgmt/influencer_states/directive",["require","exports","react","services/react_bridge_factory","influencers_list_mgmt"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.InfluencersListStatesRenderable,{stateModels:e.influencerStateModels,options:e.options}),{influencerStateModels:"=",options:"=?"},{watch:["influencerStateModels"]})}),define("react_components/influencers_lists_mgmt/influencers_lists_container",["require","exports","react","flux","influencers_list_mgmt","event_bus","services/bubble_dialog","services/configuration","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});t.InfluencersListsContainer=class extends n.BaseComponent{constructor(e){super(e),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.CREATE_INFLUENCER_MGMT_LIST,this.handleCreateInfluencersListManagementBubble.bind(this))}redrawWidget(e){return new Promise((e,t)=>{e()})}render(){return i.createElement("div",{className:"influencers-lists-container"},this.renderRenderable())}renderRenderable(){return i.createElement(s.InfluencersListsBlocksRenderable,{influencersLists:this.props.influencersLists,messages:this.getMessages()})}getMessages(){return{influencerListMessages:{moreLabel:c.contextData.getMessage("_1943213")}}}handleCreateInfluencersListManagementBubble(e){const t=constants.bubble_dialog.id.influencers_list_creation;r.bubbleDialogService.createByType(t,$("body"),t,{formData:{},saveUrl:this.props.createUrl},a.configurationService.getBubbleDialogConfiguration().getStyle(t)).onMessage.subscribeOnce(e=>{!0===e.save&&o.eventBus.dispatch({type:o.EVENT_TYPES.RELOAD_INFLUENCERS_LISTS,value:this.props.id})})}}}),define("components/influencers_list_mgmt/influencers_list_block/directive",["require","exports","react","services/react_bridge_factory","react_components/influencers_lists_mgmt/influencers_lists_container","reusable_utilities","event_bus","services/refresh/model_refresh_service","classes/refresh/model_refresh_strategy","classes/refresh/model_type","classes/refresh/model_refresh_decorator_factory","log","services/rest_form_service","services/loading_bubble","drag_and_drop"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){async function m(e){e.prepareReload();const t={strategy:c.ModelRefreshStrategy.REFRESH},i=d.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),l.ModelType.WIDGET,t);try{return await a.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&g.logService.error("Error when refreshing widget!",void 0,e)}}return n.createReactBridge(e=>{const t=new o.CancellationToken;return function(e,t){e.subscribeToStream(r.eventBus,r.EVENT_TYPES.RELOAD_INFLUENCERS_LISTS,e=>{t.id===e.value.id&&m(t.widget)}),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.ON_DRAG_STOP_INFLUENCERS_LIST,async e=>{h.dragAndDropService.disableInteraction(),p.loadingBubbleService.showSpinner();const i=e.value.list,n=e.value.newIndex,s=t.formEntry.influencer_lists.indexOf(i);t.formEntry.influencer_lists.splice(s,1,n),await u.restFormService.post(u.restFormService.getRFormUrl("influencer_lists","move"),{new_order:n,list_to_move:i.list_id}),await m(t.widget),p.loadingBubbleService.hideSpinner(),h.dragAndDropService.enableInteraction()})}(t,e),e.$on("$destroy",()=>t.cancel()),i.createElement(s.InfluencersListsContainer,{influencersLists:e.formEntry.influencer_lists,createUrl:e.formEntry.create_list_url,id:e.widget.getId()})},{formEntry:"=",widget:"="})}),define("components/multiple_topic_navbar/multiple_topic_navbar_container",["require","exports","react","services/react_bridge_factory","react_components/topic_navbar/topic_navbar_container"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.TopicNavbarContainer,{userFilterSettings:e.userFilterSettings,location:e.location}),{userFilterSettings:"=?",location:"=?"},{classNames:"inherit-width",replace:!0})}),define("components/react_topic_menu_select/directive",["require","exports","services/react_bridge_factory","react_components/menu/topic_menu_select_container","react"],function(e,t,i,n,s){return i.createReactBridge(e=>s.createElement(n.TopicMenuSelectContainer,{topicMenu:e.topicMenu,styleModel:e.styleModel,title:e.title,iconMap:e.iconMap,updateSelectionLabelOnClose:e.updateSelectionLabelOnClose,concatAllNode:e.concatAllNode,concatSelectionLabel:e.concatSelectionLabel,allowMultiSelection:e.allowMultiSelection,menuStrategy:e.menuStrategy,renderable:e.renderable}),{topicMenu:"=",menuStrategy:"=",styleModel:"=?",placeholder:"=?",iconMap:"=?",iconState:"@?",title:"=?",concatSelectionLabel:"=?",concatAllNode:"=?",allowMultiSelection:"=?",updateSelectionLabelOnClose:"=?",renderable:"=?"})}),define("react_components/sidebar/components/sidebar_container",["require","exports","flux","reusable_components","react","react_components/sidebar/stores/sidebar_store","react_components/filters/components/filter_options/filter_options_container","event_bus"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.SidebarContainer=class extends i.BaseComponent{componentDidMount(){this.cancellationToken.subscribe(o.SidebarStore.getInstance().onChange,e=>{e.menuUpdated?a.eventBus.dispatch({type:a.EVENT_TYPES.UPDATE_SIDE_BAR,value:e}):(this.checkNewPageState(e),this.checkSelectionChanged(e),this.checkCollapseChanged(e))})}render(){const{query:e}=this.props;return s.createElement(n.Sidebar,{query:e,SidebarOptionsContainer:r.FilterOptionsContainer})}checkNewPageState(e){e.newPageState&&this.forceUpdate()}checkSelectionChanged(e){e.selectionChanged&&this.forceUpdate()}checkCollapseChanged(e){e.collapseChanged&&this.forceUpdate()}}}),define("components/sidebar/directive",["require","exports","react","services/react_bridge_factory","react_components/sidebar/components/sidebar_container","components/sidebar/sidebar_query"],function(e,t,i,n,s,o){return n.createReactBridge(e=>i.createElement(s.SidebarContainer,{query:o.sidebarQuery}),{})}),define("components/toolbar/directive",["require","exports","react","services/react_bridge_factory","report_components"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.ToolbarRenderable,{model:e.toolbarModel}),{toolbarModel:"="})}),define("components/progress_bar/directive",["require","exports","services/react_bridge_factory","reusable_components","react"],function(e,t,i,n,s){return i.createReactBridge(e=>s.createElement(n.ProgressBar,{fillRate:e.fillRate}),{fillRate:"="},{watch:["fillRate"]})}),define("components/initials_component/directive",["require","exports","react","services/react_bridge_factory","reusable_components"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twInitialsComponent=n.createReactBridge(e=>i.createElement(s.InitialsComponentRenderable,{backgroundColor:e.backgroundColor,containerClassName:e.containerClassName,initials:e.initials,rounded:e.rounded,size:e.size,textColor:e.textColor}),{backgroundColor:"=",containerClassName:"=",initials:"=",rounded:"=",size:"=",textColor:"="},{watch:["initials"]})}),define("components/image_box/directive",["require","exports","react","services/react_bridge_factory","report_components"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twImageBoxRenderable=n.createReactBridge(e=>i.createElement(s.ImageBoxRenderable,{model:e.model,settings:e.settings}),{model:"=",settings:"="})}),define("components/icon_image/directive",["require","exports","react","services/react_bridge_factory","reusable_components"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twImageComponent=n.createReactBridge(e=>i.createElement(s.ImageComponentRenderable,{backgroundColor:e.backgroundColor,containerClassName:e.containerClassName,image:e.image,rounded:e.rounded,size:e.size,textColor:e.textColor}),{backgroundColor:"=",containerClassName:"=",image:"=",rounded:"=",size:"=",textColor:"="},{watch:["image"]})}),define("components/query_builder/directive",["require","exports","react","services/react_bridge_factory","query_builder"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twQueryBuilderComponent=n.createReactBridge(e=>i.createElement(s.QueryBuilderComponentRenderable,{id:e.id,model:e.model,messages:e.messages,initialState:e.initialState,maxNumberOfGroups:e.maxNumberOfGroups,maxNumberOfFiltersPerGroup:e.maxNumberOfFiltersPerGroup}),{id:"=",model:"=",messages:"=",initialState:"=?",maxNumberOfGroups:"=?",maxNumberOfFiltersPerGroup:"=?"},{watch:["initialState"]})}),define("components/quick_upload/directive",["require","exports","react","services/react_bridge_factory","file_upload"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twQuickUpload=n.createReactBridge(e=>i.createElement(s.QuickUploadComponent,{id:e.id,uploadButtonTooltipMessage:e.uploadButtonTooltipMessage,textInputLabelMessage:e.textInputLabelMessage}),{id:"=",uploadButtonTooltipMessage:"=?",textInputLabelMessage:"=?"})}),define("components/download_upload/directive",["require","exports","react","services/react_bridge_factory","file_upload"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.twDownloadUpload=n.createReactBridge(e=>i.createElement(s.DownloadUploadComponent,{blockSvg:e.blockSvg,mimeFilter:e.mimeFilter,downloadClickCallback:e.downloadClickCallback,uploadLoadCallback:e.uploadLoadCallback,classNames:e.classNames,hideUpload:e.hideUpload,hideDownload:e.hideDownload}),{blockSvg:"=?",classNames:"=?",mimeFilter:"=",downloadClickCallback:"=",uploadLoadCallback:"=",hideDownload:"=?",hideUpload:"=?"},{watch:["hideDownload","hideUpload"]})}),define("entry_point/configurations/angular_configuration/angular_modules/components_other",["require","exports","angular","components/access_rights/project/directive","components/allowed_pages/directive","components/anchor/icon_anchor/icon_anchor_container","components/anchor/presentation_anchor/presentation_anchor_container","components/anchor/preview_anchor/preview_anchor_container","components/append","components/autofocus/directive","components/breadcrumb/directive","components/bulletin/directive","components/calendar/directive","components/comment_info/directive","components/comment_list/directive","components/contact/form/new_use_cases/directive","components/contact/form/upgrade_enterprise/directive","components/context_menu/directive","components/deploy/directive","components/download/directive","components/draggable/directive","components/draggable/overlay/directive","components/draggable/owner/directive","components/dropdown_menu/generic/directive","components/edit_mode/report/configuration_ui/directive","components/form/on_off/directive","components/form_fragments/report/creation/directive","components/form_fragments/report/page_format/directive","components/form_fragments/widget/custom_page_addition/directive","components/form_fragments/widgets/custom_page_addition/directive","components/ga_event/directive","components/help/directive","components/icon/directive","components/image_selector_list/directive","components/item_grid_selection_dropdown/directive","components/influencers_list_mgmt/influencer_states/directive","components/influencers_list_mgmt/influencers_list_block/directive","components/link/directive","components/modal/directive","components/multiple_topic_navbar/multiple_topic_navbar_container","components/on_error_callback/directive","components/on_error_src/directive","components/overlay","components/react_topic_menu_select/directive","components/reports/historic/report/directive","components/resizable/directive","components/save_buttons/directive","components/scroller/buttons/directive","components/search_query/edit/directive","components/sentiments/directive","components/sentiments/gauge/directive","components/settings/menu/directive","components/sidebar/directive","components/sign_up/free/directive","components/sign_up/trial/page1/directive","components/sign_up/trial/page2/directive","components/sign_up/trial/page3/directive","components/social/accounts/connect/directive","components/social/accounts/directive","components/social/filters/directive","components/sortable","components/sourcetypes/directive","components/stateless_screen/section/applications/directive","components/stateless_screen/section/dashboards/directive","components/stateless_screen/section/directive","components/stateless_screen/section/discovery/directive","components/stateless_screen/section/generic/directive","components/stateless_screen/section/iq_apps/directive","components/stateless_screen/section/reports/directive","components/stateless_screen/section/setup/directive","components/stateless_screen/section/topic_setup/options/directive","components/suggestions/buttons_layout/directive","components/suggestions/directive","components/tags/suggestion/inline/directive","components/tags/workflow/directive","components/time_filter/directive","components/toolbar/directive","components/tooltip/directive","components/twitter_toggle/directive","components/visible","components/progress_bar/directive","components/form_fragments/campaign/info/directive","components/form_fragments/campaign/schedule/directive","components/form_fragments/campaign/budget/directive","components/top_banner/directive","controllers/rest_form/token_request/token_request","components/initials_component/directive","components/image_box/directive","components/icon_image/directive","components/query_builder/directive","components/quick_upload/directive","components/download_upload/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q,V,z,Y,X,K,Q,J,Z,ee,te,ie,ne,se,oe,re,ae,ce,le,de,ge,ue,pe,he,me,_e,fe,ye,ve,Se,be,we,Ce,Ee,Te,Me,Pe,De,Ae,Ie,xe,Re,Fe,Oe,ke,Ne,Le){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_other",[]).directive("twProjectAccessRights",n.default).directive("twAllowedPages",s.default).directive("twIconAnchor",o).directive("twPresentationAnchor",r).directive("twPreviewAnchor",a).directive("ngAppend",c.default).directive("twAutofocus",l.default).directive("twBreadcrumb",d.default).directive("twBulletin",g.default).directive("twCalendar",u.default).directive("twCommentInfo",p).directive("twCommentList",h).directive("twContactNewUseCasesForm",m.default).directive("twContactUpgradeEnterpriseForm",_.default).directive("twContextMenu",f.default).directive("deploy",y.default).directive("twDownload",v.default).directive("draggable",S.default).directive("twDraggableOverlay",b.default).directive("draggableOwner",w.default).directive("twGenericDropdownMenu",C).directive("reportConfigurationUi",E.default).directive("onOff",T.default).directive("reportCreationFormFragment",M.default).directive("reportPageFormatFormFragment",P.default).directive("widgetCustomPageAdditionFormFragment",D.default).directive("widgetsCustomPageAdditionFormFragment",A.default).directive("twGaEvent",I.default).directive("twHelpButton",x.default).directive("icon",R.default).directive("imageSelectorList",F).directive("twItemGridSelectionDropdown",O).directive("influencersListStatesRenderable",k).directive("influencersListsRenderable",N).directive("twLink",L.default).directive("twModal",B.default).directive("twTopicNavbar",W).directive("twOnErrorCallback",U.default).directive("twOnErrorSrc",G.default).directive("ngOverlay",$.default).directive("reactTopicMenuSelect",j).directive("twHistoricReport",H.default).directive("resizable",q.default).directive("twSaveButtons",V.default).directive("buttonsScroller",z.default).directive("twSearchQueryEdition",Y.default).directive("twSentimentsMenu",X.default).directive("twSentimentsGauge",K.default).directive("twSettingsMenu",Q.default).directive("twSidebar",J).directive("twSignupFree",Z.default).directive("twSignupTrialPage1",ee.default).directive("twSignupTrialPage2",te.default).directive("twSignupTrialPage3",ie.default).directive("twSocialAccountsConnect",ne.default).directive("twSocialAccounts",se.default).directive("twSocialFilters",oe.default).directive("uiSortable",re.default).directive("twSourcetypes",ae.default).directive("twStatelessAppsSection",ce.default).directive("twStatelessDashboardsSection",le.default).directive("twStatelessSection",de.default).directive("twStatelessDiscoverySection",ge.default).directive("twStatelessGenericSection",ue.default).directive("twStatelessIqAppsSection",pe.default).directive("twStatelessReportsSection",he.default).directive("twStatelessSetupSection",me.default).directive("twStatelessTopicSetupOptionsSection",_e.default).directive("twButtonsLayoutSuggestions",fe.default).directive("twSuggestions",ye.default).directive("tagInlineSuggestion",ve.default).directive("twWorkflowTags",Se.default).directive("twTime",be.default).directive("twToolbar",we).directive("twTooltip",Ce.default).directive("twTwitterToggle",Ee.default).directive("ngVisible",Te.default).directive("twProgressBar",Me).directive("campaignInfoFormFragment",Pe.default).directive("campaignScheduleFormFragment",De.default).directive("campaignBudgetFormFragment",Ae.default).directive("tokenRequest",xe.tokenRequestDirective).directive("topBanner",Ie.topBannerDirective).directive("twInitialsComponent",Re.twInitialsComponent).directive("twImageBoxRenderable",Fe.twImageBoxRenderable).directive("twImageComponent",Oe.twImageComponent).directive("twQueryBuilderComponent",ke.twQueryBuilderComponent).directive("twQuickUpload",Ne.twQuickUpload).directive("twDownloadUpload",Le.twDownloadUpload)}),define("components/page/modules/influencer_mgmt/directive",["require","exports","angular","angular_utilities","event_bus","filter_menu","react","react-dom","reusable_components","classes/application/application","classes/context_data/context_data","classes/grid/anchor/grid_anchor_configuration","classes/grid/grid_page_controller","react_components/filter_menu/default_filter_bar_controller","react_components/filter_menu/default_filter_menu_controller","services/bubble_dialog","services/configuration","services/influencer_mgmt/campaign_form_service","services/modal","services/rest_form_service","services/template_source","components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filters_controller","components/influencers_list_mgmt/campaign_influencers/campaign_influencers_filter_menu_adapter","components/influencers_list_mgmt/campaign_influencers/styles/campaign_influencers_style_utils","components/page/modules/influencer_mgmt/influencer_mgmt_page_titles","services/loading_bubble"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!1,scope:{},bindToController:{pageData:"="},controllerAs:"ctrl",controller:M,templateUrl:S.templateSourceFactory("components/page/modules/influencer_mgmt")}};let M=class extends u.GridPageController{constructor(e,t){super(e,t),this.$scope=e,this.$element=t,this.filterFields=["content","author"],this.showFilterBar=!0,this.pageClasses=["influencer-management"]}get borderColor(){return d.contextData.projectSettings.branding.color}$onInit(){super.$onInit(),this.resetPrimaryFilters(),this.renderPrimaryFilterMenus(),this.canShowSearchbar()&&(this.showFilterBar=!0),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,()=>{["5","9"].includes(this.pageData.getPageConfiguration().active_page_id)&&this.recomputeGridSize()})}createSubscriptions(){super.createSubscriptions(),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.ADD_FILTER_MENU_FROM_OTHER_SRC,this.addFilterMenuFromOtherSource.bind(this))}getFilterMenuController(e){return e.getType()?b.CampaignInfluencersFiltersController:super.getFilterMenuController(e)}getPageControllerConfiguration(){return{respondToWidgetOverflow:!0,anchorConfiguration:{type:g.GridAnchorType.ICON},pageFilters:{userFilterSettings:l.mainApplication.getPageState().getUserFilterSettings(),filterBarController:new p.DefaultFilterBarController,allowedFilterTypes:l.mainApplication.getPageState().getUserFilterSettings().getTopicMenuByPredicate(e=>e.isPinned()).map(e=>e.getType()),enableFilterTypesReset:!0}}}async openCampaignCreationDialog(e){if(e.preventDefault(),!this.campaignCreationInProgress){this.campaignCreationInProgress=!0;const e=await v.restFormService.getRForm("campaign","show"),t={search_query:{search_query_item:{include:{search_query_items:[{}]}}},conversion_factor:e.conversion_factor,budget:e.budget,vertical_cpm:e.vertical_cpm,cpe:e.cpe};try{await y.modalService.display("MULTIPAGE_MODAL",f.campaignFormService.buildCampaignModalModel(t,!1)),this.refreshPageData(),this.createAddInfluencersToCampaignDialog(t)}catch(e){this.campaignCreationInProgress=!1}}}async openListCreationDialog(e){e.preventDefault(),s.eventBus.dispatch({type:s.EVENT_TYPES.CREATE_INFLUENCER_MGMT_LIST,value:void 0})}canShowPoweredBy(){return d.contextData.projectSettings.branding.show_powered_by}canShowCampaignCreationButton(){return"IM_PAGE_OUTREACH"===l.mainApplication.getPageState().getAllowedPages().getPageType()}canShowListCreationButton(){return"IM_PAGE_MONITOR_LISTS"===l.mainApplication.getPageState().getAllowedPages().getPageType()}canShowSearchbar(){return["IM_PAGE_SEARCH","IM_PAGE_SEARCH_RESULTS"].includes(l.mainApplication.getPageState().getAllowedPages().getPageType())}canShowPageFilters(){return super.canShowPageFilters()&&"IM_PAGE_MONITOR_DISCOVERY"!==this.pageState.getAllowedPages().getPageType()}isIdle(){return!T.loadingBubbleService.isSpinnerVisible()}isSearchPage(){return["IM_PAGE_SEARCH"].includes(l.mainApplication.getPageState().getAllowedPages().getPageType())}canShowTimeFilter(){return["IM_PAGE_SEARCH_RESULTS","IM_PAGE_OUTREACH_CONTENT","IM_PAGE_MEASURE"].includes(l.mainApplication.getPageState().getAllowedPages().getPageType())}canShowKeywordFilter(){return["IM_PAGE_MONITOR_CONTENT","IM_PAGE_OUTREACH_CONTENT"].includes(l.mainApplication.getPageState().getAllowedPages().getPageType())}getPageTitle(){const e=E.InfluencerManagementPageTitles.getPageTitle(l.mainApplication.getPageState().getAllowedPages().getPageType());if(void 0!==e){let t=e;const i=E.InfluencerManagementPageTitles.getSubPageTitle(l.mainApplication.getPageState().getAllowedPages().getPageType());return i&&(t+=" - "+i),t}return"&nbsp;"}getSearchLabel(){return d.contextData.getMessage("_1566565")}getUserFilterSettings(){return l.mainApplication.getPageState().getUserFilterSettings()}canShowMenuSelectionAsLabel(e){return["INFLUENCER_LIST","INFLUENCER_CAMPAIGN"].includes(e.getType())}canExpandSingleCategory(e){return["COUNTRIES","LANGUAGES","DEMOGRAPHICS_AND_GENDER"].includes(e.getType())}handlePageStateRefresh(e){super.handlePageStateRefresh(e),["5","9"].includes(this.pageData.getPageConfiguration().active_page_id)&&this.recomputeGridSize(),this.showFilterBar=!0===this.showFilterBar&&this.canShowPageFilters(),this.resetPrimaryFilters(),this.renderPrimaryFilterMenus(),this.canShowSearchbar()&&(this.showFilterBar=!0)}handleFilterPersistChangesAndCloseMenus(e){this.pageState.getAllowedPages().isInfluencerManagementModule()&&"IM_PAGE_CAMPAIGN_STATUS"!==this.pageState.getAllowedPages().getPageType()&&this.refreshPageData()}getFixedGridHeight(){return 765}createAddInfluencersToCampaignDialog(e){const t=constants.bubble_dialog.id.add_influencers_to_campaign,i=_.configurationService.getBubbleDialogConfiguration().getStyle(t),n={campaignId:e.campaign_id};this.influencersDialog=m.bubbleDialogService.createByType(t,$("body"),t,n,i),this.influencersDialog.onDestroy.subscribeOnce(()=>{this.influencersDialog=void 0,this.campaignCreationInProgress=!1,this.refreshPageData()})}resetPrimaryFilters(){this.primaryFilterMenus=[],this.isCampaignsMenuAllowed()&&this.primaryFilterMenus.push(this.createCampaignsMenu()),this.isInfluencerListsMenuAllowed()&&this.primaryFilterMenus.push(this.createInfluencerListsMenu())}createCampaignsMenu(){const e=this.pageState.getUserFilterSettings().getTopicMenuByType("INFLUENCER_CAMPAIGN"),t={topicMenu:e,rootId:e.getRootEntry().getMappedId(),config:{menuLabelProvider:()=>d.contextData.getMessage("_1324754"),showSearchBar:!1,showSelectedFilters:!1,showTopResults:!1,showSelectionAsLabel:!0,component:{renderable:c.SquareFilterMenuRenderable,props:C.CampaignInfluencersStyleUtils.buildSquareFilterMenuStyles()}}};return{controller:new b.CampaignInfluencersFiltersController(t)}}createInfluencerListsMenu(){const e=this.pageState.getUserFilterSettings().getTopicMenuByType("INFLUENCER_LIST"),t={topicMenu:e,allNodeId:e.getAllMappedId(),rootId:e.getRootEntry().getMappedId(),config:{menuLabelProvider:()=>d.contextData.getMessage("_1895415"),showSearchBar:!1,showSelectedFilters:!0,showTopResults:!1,showSelectionAsLabel:!0,hideAllNodeFromSelections:!0,component:{renderable:c.SquareFilterMenuRenderable,props:C.CampaignInfluencersStyleUtils.buildSquareFilterMenuStyles()}}};return{controller:new h.DefaultFilterMenuController(t,w.CampaignInfluencersFilterMenuAdapter)}}isCampaignsMenuAllowed(){return["IM_PAGE_CAMPAIGN_STATUS","IM_PAGE_OUTREACH_CONTENT","IM_PAGE_MEASURE"].includes(this.pageState.getAllowedPages().getPageType())}isInfluencerListsMenuAllowed(){return["IM_PAGE_MONITOR_LIST","IM_PAGE_MONITOR_CONTENT","IM_PAGE_MONITOR_DISCOVERY"].includes(this.pageState.getAllowedPages().getPageType())}toggleFilterBar(){this.showFilterBar=!this.showFilterBar;const e=$(this.$element).find(".page-level-filters");e.hasClass("ng-hide-animate")||(e.addClass("ng-hide-animate"),setTimeout(()=>e.removeClass("ng-hide-animate"),1e3)),"hidden"!==e.css("overflow")&&(e.css("overflow","hidden"),setTimeout(()=>e.css("overflow","visible"),1e3))}addFilterMenuFromOtherSource(e){this.primaryFilterMenus.push(e.value),this.renderPrimaryFilterMenus()}renderPrimaryFilterMenus(){a.render(r.createElement(o.FilterBarContainer,{menus:this.primaryFilterMenus,showPageFilters:!0,messages:{msgCancelChanges:"",msgApplyChanges:"",msgNoFiltersSelected:d.contextData.getMessage("_1255663")},configuration:{color:this.getFilterMenuColor()},controller:new p.DefaultFilterBarController}),this.$element.find("#primary-filters")[0])}};M=__decorate([n.ngInject(["$scope","$element"]),__metadata("design:paramtypes",[Object,Object])],M),t.InfluencerManagementPageController=M}),define("entry_point/configurations/angular_configuration/angular_modules/components_pages",["require","exports","angular","components/grid/page/directive","components/grid/pages/scrollable/directive","components/grid/pages/switchable/directive","components/page/analytics_page/directive","components/page/command_center_screen_page/directive","components/page/content/directive","components/page/dashboard_page/directive","components/page/dashboard_template_page/directive","components/page/discovery/directive","components/page/free_search/directive","components/page/modules/influencer_mgmt/directive","components/page/modules/issue_tracker/directive","components/page/quick_search/directive","components/page/r_form_page/directive","components/page/report_page/directive","components/page/report_page/modes/grid/directive","components/page/report_page/modes/normal/directive","components/page/report_page/page_options/directive","components/page/sandbox_page/directive","components/page/settings_page/directive","components/page/topic_setup/directive","components/page/user_workflow/directive","components/theme_preview/directive","components/page/dashboard_controller_picker/directive","components/page/dashboard_grid_controller/directive","components/grid/directive","components/page/dashboard_page/options/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_pages",[]).directive("twGrid",D.gridDirective).directive("gridPage",n.default).directive("scrollableGridPages",s.default).directive("switchableGridPages",o.default).directive("analyticsPage",r.default).directive("commandCenterScreenPage",a.default).directive("twPageContent",c.default).directive("dashboardPage",l.default).directive("dashboardPageOptions",A.default).directive("dashboardControllerPicker",M.dashboardControllerPickerDirective).directive("dashboardGridPage",P.default).directive("dashboardTemplatePage",d.default).directive("discoveryPage",g.default).directive("freeSearchPage",u.default).directive("influencerManagementPage",p.default).directive("issueTrackerModulePage",h.default).directive("quickSearchPage",m.default).directive("rFormPage",_.default).directive("reportPage",f.default).directive("reportPageEditMode",y.default).directive("reportPageNormalMode",v.default).directive("reportPageOptions",S.default).directive("sandboxPage",b.default).directive("settingsPage",w.default).directive("topicSetupPage",C.default).directive("userWorkflowPage",E.default).directive("twThemePreview",T.default)}),define("entry_point/configurations/angular_configuration/angular_modules/components_reports",["require","exports","angular","controllers/rest_form/report/report","controllers/rest_form/reports/report_categories","controllers/rest_form/reports/reports_historic","components/edit_mode/report/layout/directive","components/edit_mode/report/schedule/directive","components/edit_mode/report/settings/directive","components/edit_mode/report_categories/directive","components/edit_mode/report_category/directive","components/edit_mode/report_history/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_reports",[]).controller("reportsController",n.default).controller("reportCategoriesController",s.default).controller("reportsHistoricController",o.default).directive("twEditReportLayout",r.default).directive("twEditReportSchedule",a.default).directive("twEditReportSettings",c.default).directive("twEditReportCategories",l.default).directive("twEditReportCategory",d.default).directive("twReportLog",g.default)}),define("react_components/bubble_dialogs/components/interfaces/select_custom_field_data_type_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/create_custom_field_bubble_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/create_custom_field_bubble_state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/create_custom_field_bubble",["require","exports","event_bus","flux","notifications","react","reusable_utilities","classes/context_data/context_data","services/rest_form_service","react_components/form/progress_button/progress_button_container"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});const d='<i class="fa fa-refresh fa-spin"></i> '+a.contextData.getMessage("_498245");class g extends n.BaseComponent{constructor(e){super(e);const{description:t="",boolean_operator:i="",title:n=""}=this.props.payload.customFieldForm;this.state={description:t,operator:i,title:n,valid:this.isDescriptionValid(t)&&this.isTitleValid(n)&&this.isOperatorValid(i),shouldShowOperatorErrorMessage:!1}}render(){return o.createElement("div",{className:"tw-bubble-dialog-create-custom-field disable-shadow"},this.renderHeader(),this.renderBody())}renderHeader(){let e;return e=this.props.payload.editMode?a.contextData.getMessage("_1564165",[this.props.payload.customFieldForm.title]):a.contextData.getMessage("_1695815"),o.createElement("div",{className:"header"},o.createElement("h2",null,e,o.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}renderBody(){return o.createElement("div",{className:"body"},o.createElement("form",{className:"form-horizontal"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1658135")),o.createElement("div",{className:"col-xs-10"},o.createElement("input",{type:"text",value:this.state.title,className:"custom-field-creation-input",onChange:this.handleTitleChange.bind(this),required:!0,maxLength:33}))),o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1458650")),o.createElement("div",{className:"col-xs-10"},o.createElement("input",{type:"text",value:this.state.description,className:"custom-field-creation-input",onChange:this.handleDescriptionChange.bind(this),maxLength:33}))),this.renderOperatorPart()),this.renderButtons())}renderOperatorPart(){return this.props.payload.editMode?o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1568152")),o.createElement("div",{className:"col-xs-10"},o.createElement("p",{className:"help-block custom-field-edit-operator"},a.contextData.getMessage("_1546516"),this.state.operator))):o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},a.contextData.getMessage("_1568152")),o.createElement("div",{className:"col-xs-10"},o.createElement("p",{className:"help-block",dangerouslySetInnerHTML:{__html:a.contextData.getMessage("_1541566")}}),o.createElement("div",{className:"custom-field-creation-operator-container"},o.createElement("div",{className:"operator-prefix"},a.contextData.getMessage("_1546516")),o.createElement("input",{type:"text",value:this.state.operator,className:"operator-input",onChange:this.handleOperatorChange.bind(this),maxLength:20})),this.renderOperatorErrorMessage()))}renderOperatorErrorMessage(){return this.state.shouldShowOperatorErrorMessage?o.createElement("p",{className:"help-block",style:{color:"red"}},a.contextData.getMessage("_1564132")):void 0}handleTitleChange(e){const t=e.target.value,i=this.isTitleValid(t),n=this.isDescriptionValid(this.state.description)&&this.isOperatorValid(this.state.operator);this.setState({title:t,valid:i&&n})}handleDescriptionChange(e){const t=e.target.value,i=this.isDescriptionValid(t),n=this.isTitleValid(this.state.title)&&this.isOperatorValid(this.state.operator);this.setState({description:t,valid:i&&n})}handleOperatorChange(e){const t=e.target.value,i=this.isOperatorValid(t),n=this.isTitleValid(this.state.title)&&this.isDescriptionValid(this.state.description);this.setState({operator:t,valid:i&&n,shouldShowOperatorErrorMessage:!i})}renderButtons(){return o.createElement("div",{className:"tw-buttons clearfix",style:{marginTop:"20px"}},o.createElement(l.ProgressButtonContainer,{text:a.contextData.getMessage("_612374"),textCalling:a.contextData.getMessage("_911337"),clickEvent:this.saveCustomField.bind(this),className:"tw-button pull-right",disabled:!this.state.valid}),o.createElement("button",{type:"button",className:"btn btn-default pull-right",style:{marginRight:"10px"},onClick:this.clickOutside.bind(this)},a.contextData.getMessage("_691638")))}async saveCustomField(){if(this.state.valid){let e=!0,t=void 0;this.props.payload.editMode&&(e=this.props.payload.customFieldForm.shown,t=this.props.payload.customFieldForm.field_id);const n=c.restFormService.post(this.props.payload.customFieldForm.update_link,{field_id:t,title:this.state.title,description:this.state.description,boolean_operator:this.state.operator,format:this.props.payload.customFieldForm.format,shown:e});s.notificationService.warning(d,{permanent:!0,singleInstance:!0,closeOnResolve:n}),n.then(()=>{i.eventBus.dispatch({type:i.EVENT_TYPES.CUSTOM_FIELD_CREATED,value:void 0}),this.props.destroy()})}}isTitleValid(e){let t=!1;return e.length>0&&e.length<34&&(t=!0),t}isDescriptionValid(e){let t=!1;return e.length<34&&(t=!0),t}isOperatorValid(e){let t=!1;return e.length>2&&e.length<21&&-1===e.indexOf("__")&&"_"!==e.charAt(e.length-1)&&null!==e.match(/^[a-z0-9_]+$/i)&&"_"!==e.charAt(0)&&(t=!0),t}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.CreateCustomFieldBubble=g,r.applyMixins(g,[n.DocumentClickTracker])}),define("react_components/bubble_dialogs/components/select_custom_field_data_type_dialog",["require","exports","flux","react","reusable_utilities","services/bubble_dialog","services/configuration","services/rest_form_service","react_components/bubble_dialogs/components/create_custom_field_bubble"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends i.BaseComponent{render(){return n.createElement("div",{className:"custom-field-data-type-bubble"},this.generateChoices())}generateChoices(){return n.createElement("div",{className:"custom-field-data-type-choices"},this.props.payload.form.create_menu.root_entry.children.map(e=>n.createElement("div",{key:e.name,className:"custom-field-data-type"},n.createElement("span",{onClick:t=>this.handleDataTypeSelection(t,e)},e.name))))}async handleDataTypeSelection(e,t){const i=await a.restFormService.get(t.mapped_id),s=constants.bubble_dialog.id.create_custom_field,l=r.configurationService.getBubbleDialogConfiguration().getStyle(s);l.setAbsoluteY(window.innerHeight/3-l.minHeight/3);const d={customFieldForm:i};o.bubbleDialogService.createReactBubble(s,$("body"),d,e=>(e.payload=d,n.createElement(c.CreateCustomFieldBubble,{payload:e.payload,destroy:e.destroy})),l,{preventOutsideClickActions:!0,fadeBackground:!0}),this.props.destroy()}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.SelectCustomFieldDataTypeDialog=l,s.applyMixins(l,[i.DocumentClickTracker])}),define("controllers/rest_form/documents_import/documents_import",["require","exports","common_constants","react","underscore","react_components/bubble_dialogs/components/select_custom_field_data_type_dialog","services/bubble_dialog","services/configuration","services/rest_form_service","event_bus","services/confirmation_service","classes/context_data/context_data","react_components/bubble_dialogs/components/create_custom_field_bubble"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope","$window","$element","$interval","$timeout","brokerService",function(e,t,p,h,m,_){let f=!1;e.form_entry=t.form_entry,e.import_action=constants.events.form.action.importr,e.export_action1="export_action1",e.export_action2="export_action2",e.export_action3="export_action3",e.export_action4="export_action4",e.importFile=function(){c.restFormService.postMultipart(e.form_entry.link_import.link_import,e.form_entry,void 0,constants.events.form.action.importr).then(function(t){e.form_entry=t,m(S,1e3)},function(t){e.form_entry.field_messages=t.field_messages,f=!1})},e.sampleDownload=function(i,n){c.restFormService.get(e.form_entry[i].link_export,n).then(function(e){e[i].link_exported_file&&(t.location.href=e[i].link_exported_file)},function(t){e.form_entry.field_messages=t.field_messages})},e.getTableRowClass=function(e){switch(e){case"i":return"info";case"w":return"danger";case"s":return"success";case"h":return"info"}return""},e.shouldHideComplexChannelsButton=function(){return s.isUndefined(e.form_entry.link_sample_pagemonitoring_complex.link_export)||!s.isUndefined(e.form_entry.link_sample_pagemonitoring_complex.link_exported_file)||!e.form_entry.link_sample_pagemonitoring_complex.show_button},e.shouldHideComplexTopicsButton=function(){return s.isUndefined(e.form_entry.link_sample_search_complex.link_export)||!s.isUndefined(e.form_entry.link_sample_search_complex.link_exported_file)||!e.form_entry.link_sample_search_complex.show_button},e.shouldHideSimpleChannelsButton=function(){return s.isUndefined(e.form_entry.link_sample_pagemonitoring_simple.link_export)||!s.isUndefined(e.form_entry.link_sample_pagemonitoring_simple.link_exported_file)||!e.form_entry.link_sample_pagemonitoring_simple.show_button},e.shouldHideSimpleTopicsButton=function(){return s.isUndefined(e.form_entry.link_sample_search_simple.link_export)||!s.isUndefined(e.form_entry.link_sample_search_simple.link_exported_file)||!e.form_entry.link_sample_search_simple.show_button};const y=_.subscribe(i.event.btn.upload_click,function(){f=!0});const v=function(t){e.form_entry&&c.restFormService.get(e.form_entry.link_info).then(function(i){!function(t,i){e.messages_import=t.messages_import,i&&(f=!1)}(i,t)},function(){t&&(f=!1)})};function S(){v(!0)}function b(){v(!1)}(function(){b(),h(b,1e4)}).call(this),e.filterMessage=function(e){return!f||"h"===e.type},e.$on("$destroy",function(){_.unsubscribe(i.event.btn.upload_click,y)}),e.loadCustomFieldsForm=async function(){e.customFieldsForm=await c.restFormService.get(e.form_entry.custom_fields_tab_link),tw.inject("$rootScope").$$phase||tw.inject("$rootScope").$apply()},e.importCustomFields=async function(t){e.shouldHideUpload()||void 0===t||(await c.restFormService.postMultipart(e.customFieldsForm.import_export_links.link_import,{file_import:t.files}),await e.loadCustomFieldsForm())},e.exportCustomFields=function(){e.shouldHideDownload()||c.restFormService.get(e.customFieldsForm.import_export_links.link_export).then(e=>{e.import_export_links&&e.import_export_links.link_exported_file&&(t.location.href=e.import_export_links.link_exported_file)})},e.shouldHideUpload=function(){return void 0===e.customFieldsForm},e.shouldHideDownload=function(){return void 0===e.customFieldsForm||void 0===e.customFieldsForm.import_export_links.link_export},e.plusButtonId="09234562304589602395032",e.showNewCustomFieldTypes=function(){const t=constants.bubble_dialog.id.custom_fields_data_types,i=a.configurationService.getBubbleDialogConfiguration().getStyle(t),s={form:e.customFieldsForm};this.changeAiRuleBubble=r.bubbleDialogService.createReactBubble(t,$("#"+e.plusButtonId),s,e=>(e.payload=s,n.createElement(o.SelectCustomFieldDataTypeDialog,{payload:e.payload,destroy:e.destroy})),i,{preventOutsideClickActions:!0}),l.eventBus.subscribeOnce(l.EVENT_TYPES.CUSTOM_FIELD_CREATED,()=>e.loadCustomFieldsForm())},e.toggleCallback=async function(e){e.shown=!e.shown,await c.restFormService.post(e.toggle_shown_link,{field_id:e.field_id})},e.isActiveCustomField=function(e){return"ACTIVE"===e.status},e.isLockedCustomField=function(e){return"LOCKED"===e.status},e.isDeletingCustomField=function(e){return"DELETING"===e.status},e.isDeletedCustomField=function(e){return"DELETED"===e.status},e.handleActiveToDeletingState=async function(t){d.confirmationService.display({message:g.contextData.getMessage("_1566585",[t.title])}).then(async()=>{await c.restFormService.deleter(t.delete_link),await e.loadCustomFieldsForm()},()=>{})},e.handleCustomFieldRemoval=function(t){d.confirmationService.display({message:g.contextData.getMessage("_1569456")}).then(async()=>{await c.restFormService.deleter(t.delete_link),await e.loadCustomFieldsForm()},()=>{})},e.handleCustomFieldResoration=async function(t){await c.restFormService.post(t.restore_link,{field_id:t.field_id}),await e.loadCustomFieldsForm()},e.handleCustomFieldEditClick=async function(t){const i=await c.restFormService.get(t.edit_link),s=constants.bubble_dialog.id.create_custom_field,o=a.configurationService.getBubbleDialogConfiguration().getStyle(s);o.setAbsoluteY(window.innerHeight/3-o.minHeight/3);const d={customFieldForm:i,editMode:!0};r.bubbleDialogService.createReactBubble(s,$("body"),d,e=>(e.payload=d,n.createElement(u.CreateCustomFieldBubble,{payload:e.payload,destroy:e.destroy})),o,{preventOutsideClickActions:!0,fadeBackground:!0}),l.eventBus.subscribeOnce(l.EVENT_TYPES.CUSTOM_FIELD_CREATED,()=>e.loadCustomFieldsForm())}}]}),define("react_components/bubble_dialogs/components/interfaces/add_tag_category_bubble_payload",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/interfaces/add_tag_category_bubble_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/add_tag_category_dialog",["require","exports","angular_utilities","event_bus","flux","notifications","react","reusable_utilities","classes/context_data/context_data","services/rest_form_service","wrappers/topic_menu/topic_entry_wrapper","react_components/form/progress_button/progress_button_container"],function(e,t,i,n,s,o,r,a,c,l,d,g){Object.defineProperty(t,"__esModule",{value:!0});const u='<i class="fa fa-refresh fa-spin"></i> '+c.contextData.getMessage("_498245");class p extends s.BaseComponent{constructor(e){super(e),this.state={selectedTag:void 0,canSave:!1}}render(){return r.createElement("div",{className:"tw-bubble-dialog-add-tag-category"},r.createElement("div",{className:"header"},r.createElement("h2",null,this.props.payload.headerMessage,r.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×"))),r.createElement("div",{className:"body"},r.createElement("form",{className:"form-horizontal",onSubmit:e=>e.preventDefault()},r.createElement("div",{className:"form-group add-new-tag-container"},this.generateTagsContainer())),r.createElement("div",{className:"tw-buttons clearfix"},r.createElement(g.ProgressButtonContainer,{text:c.contextData.getMessage("_1324567"),textCalling:c.contextData.getMessage("_1453448"),clickEvent:this.handleSave.bind(this),className:"tw-button pull-right",disabled:!this.state.canSave}))))}generateTagsContainer(){return r.createElement("div",{ref:this.handleAngularGroupSelectInjection.bind(this)})}async handleAngularGroupSelectInjection(e){if(e&&void 0===this.addTagAngularLogic){const{tags:t}=this.props.payload,n=await i.directiveService.inject(tw.inject("$compile"),$(e),"group-select",{directiveArguments:{"ng-model":t,"tags-management":!0,"single-select-mode":!0,"can-edit":!1,"can-delete":!1,"can-restore":!1,"create-entry":this.createEntry.bind(this),"dont-show-all-entries-selector":!0,"dont-show-number-of-selected-entries":!0,"add-group-callback":e=>this.addCallback({entry:e},{isGroup:!0}),"add-entry-callback":(e,t)=>this.addCallback({entry:e,parent:t},{isGroup:!1})},parentScope:tw.inject("$rootScope")});this.addTagAngularLogic=n}}createEntry(e,t){const{tags:i}=this.props.payload;return new d.TopicEntryWrapper(e,i,t)}async addCallback(e,t){const{entry:i,parent:n}=e,s=i instanceof d.TopicEntryWrapper?i:new d.TopicEntryWrapper(i),o=n?{code:n.getMappedId(),name:n.getName()}:void 0,r={code:s.getMappedId(),name:s.getName(),group:t.isGroup,parent:o},a=(await l.restFormService.postRForm("tag_management","add",{tag:r,is_group:r.group})).tag.code;return s.setMappedId(a),s}handleSave(e){const{payload:t}=this.props,{selectedTag:i}=this.state;this.props.destroy(),this.props.payload.keypressListener.listen(),n.eventBus.dispatch({type:n.EVENT_TYPES.ADDING_CATEGORY_IN_AI_TRAINING,value:!0});const s=l.restFormService.post(t.addNewCategoryLink,{category_to_add:i.getMappedId(),rule_id:t.ruleId});o.notificationService.warning(u,{permanent:!0,singleInstance:!0,closeOnResolve:s}),s.then(e=>{n.eventBus.dispatch({type:n.EVENT_TYPES.CATEGORY_ADDED_IN_AI_TRAINING,value:e}),n.eventBus.dispatch({type:n.EVENT_TYPES.ADDING_CATEGORY_IN_AI_TRAINING,value:!1})},()=>{throw n.eventBus.dispatch({type:n.EVENT_TYPES.ADDING_CATEGORY_IN_AI_TRAINING,value:!1}),new Error("Exception in calling endpoint to add category in training screen")})}onSelectedTag(e){const{value:t}=e;this.setState({selectedTag:t,canSave:void 0!==t})}componentDidMount(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SINGLE_GROUP_SELECTED_ENTRY,this.onSelectedTag.bind(this))}componentWillUnmount(){this.cancellationToken.cancel(),this.setState({canSave:!1,selectedTag:void 0}),this.addTagAngularLogic.scope.$destroy()}clickInside(e){}clickOutside(e){e.preventDefault(),this.props.destroy(),this.props.payload.keypressListener.listen()}}t.AddTagCategoryDialog=p,a.applyMixins(p,[s.DocumentClickTracker])}),define("controllers/rest_form/results/rule/ai_rule_training",["require","exports","angular","angular_utilities","event_bus","keypress","log","math_utils","notifications","react","reusable_utilities","underscore","widget_base","classes/context_data/context_data","classes/widget/fragments/directive/article_widget_fragment","classes/widget/widget_fragment_factory/widget_fragment_draw_style_factory","react_components/bubble_dialogs/components/add_tag_category_dialog","services/broker","services/bubble_dialog","services/configuration","services/confirmation_service","services/rest_form_service","services/tw_common","services/widgets/widget_factory","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E){Object.defineProperty(t,"__esModule",{value:!0});const T='<i class="fa fa-refresh fa-spin"></i> '+p.contextData.getMessage("_1354255");let M=class{constructor(e,t,i,n){this.$scope=e,this.$rootScope=t,this.$timeout=i,this.keypressListener=n,this.initialize()}initialize(){this.formEntry=window.form_entry,this.widgetsIteratingIndex=0,this.putIrrelevantCategoryAsFirstCategory(),this.hasIrrelevantCategory=this.isFirstCategoryIrrelevant(),this.categoryIndexOffset=this.hasIrrelevantCategory?0:1,this.initWidget(),this.updateOverallProgress(),this.keypressListener=new o.Listener,this.registerKeyCombos(this.generateKeyCombos()),this.canPressKey=!0,this.willRegisterClick=!0,this.description=this.formEntry.description,this.addingNewCategory=!1,this.triggerWidgetsRequestIndex=this.calculateTriggerWidgetsRequestIndex(this.formEntry.widgets.length),this.setupListeners(),this.handleNoMoreArticles(),this.$scope.$on("$destroy",()=>{f.brokerService.publish(constants.events.keypress.enable),this.keypressListener.reset(),this.keypressListener.destroy(),this.keypressListener=void 0,this.cancellationToken.cancel()})}putIrrelevantCategoryAsFirstCategory(){const{choices:e}=this.formEntry,t=e.findIndex(e=>e.irrelevant_category);if(0!==t&&-1!==t){r.logService.debug("Irrelevant Category was sent by server but not in first place. Putting it in first place now",w.twCommon.logFeatures.AiEngine,{formEntry:JSON.parse(JSON.stringify(this.formEntry))});const i=e[0];e[0]=e[t],e[t]=i}}setupListeners(){this.cancellationToken=new d.CancellationToken,this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.CATEGORY_ADDED_IN_AI_TRAINING,this.handleCategoryAdd.bind(this)),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.ADDING_CATEGORY_IN_AI_TRAINING,e=>{this.addingNewCategory=e.value})}registerKeyCombos(e){this.$timeout(()=>{e.forEach(e=>{this.keypressListener.register_combo(e)})})}generateKeyCombos(){const e=[],{length:t}=this.formEntry.choices,i=t<=10?t:10;return g.range(0,i).forEach(t=>{const i=t+this.categoryIndexOffset;e.push(this.generateKeyCombo(i.toString())),e.push(this.generateKeyCombo("num_"+i.toString()))}),g.range(i,t).forEach(t=>{const i=t+this.categoryIndexOffset;e.push(this.generateKeyCombo(p.contextData.userSettings.shortcuts.ai_training[i]))}),e}generateKeyCombo(e){return{keys:e,on_keydown:e=>{this.generateKeyDownCombo(e)},on_release:e=>{this.generateKeyReleaseCombo(e)}}}generateKeyDownCombo(e){this.canPressKey&&(this.canPressKey=!1,$(`#${this.getCorrespondingChoice(e).id}`).addClass("tag-on-keydown"),this.keyPressDownCode=e.code)}generateKeyReleaseCombo(e){this.shouldRegisterKeyRelease(e)&&(this.keypressListener.stop_listening(),this.handleKeypress(e),setTimeout(()=>{$(`#${this.getCorrespondingChoice(e).id}`).removeClass("tag-on-keydown")},125),this.keypressListener.listen(),this.canPressKey=!0)}shouldRegisterKeyRelease(e){return!this.canPressKey&&e.code===this.keyPressDownCode}handleKeypress(e){this.submitSelection(this.getCorrespondingChoice(e))}getCorrespondingChoice(e){const{choices:t}=this.formEntry;return t[this.invertObject(p.contextData.userSettings.shortcuts.ai_training)[e.key]-this.categoryIndexOffset]}invertObject(e){const t={};return Object.keys(e).forEach(i=>{e.hasOwnProperty(i)&&(t[e[i]]=i)}),t}async submitSelection(e){this.canSubmitChoice()&&(this.disableArticle(),this.shouldRequestNewWidgets()&&(r.logService.info("requesting new widgets"),this.requestNewWidgets()),setTimeout(async()=>{await this.callSubmitChoiceEndpoint(e)},500))}shouldRequestNewWidgets(){return this.widgetsIteratingIndex===this.triggerWidgetsRequestIndex&&!this.isLoadingNewArticles}async callSubmitChoiceEndpoint(e){const{widgets:t}=this.formEntry,i=t[this.widgetsIteratingIndex].entry_id,n=t[this.widgetsIteratingIndex].routing_ts;await b.restFormService.post(this.formEntry.submit_choice_link,{rule_id:this.formEntry.rule_id,entry_id:i,routing_ts:n,selected_choice:e}).then(async t=>{await this.handleCategorySubmissionSuccess(t,e)},()=>{this.enableArticle()})}async handleCategorySubmissionSuccess(e,t){this.updateFormForNextWidget(e,t);try{await this.waitForNextArticleToShow(),this.switchToNextArticle()}catch(e){throw new Error(e)}}updateFormForNextWidget(e,t){this.widgetsIteratingIndex++,this.updateUndoPayload(e),this.incrementChoiceProgress(t),this.updateOverallProgress()}waitForNextArticleToShow(){return new Promise(e=>{this.hasNoMoreArticlesButLoadingMore()?setTimeout(async()=>{await this.waitForNextArticleToShow(),e()},500):e()})}switchToNextArticle(){this.updateWidget(this.formEntry.widgets[this.widgetsIteratingIndex].widget),setTimeout(()=>{this.enableArticle()},100)}hasNoMoreArticlesButLoadingMore(){return this.formEntry.widgets.length===this.widgetsIteratingIndex&&this.isLoadingNewArticles}async requestNewWidgets(){this.isLoadingNewArticles=!0,await this.callRequestNewWidgetsEndpoint()}async callRequestNewWidgetsEndpoint(){await b.restFormService.post(this.formEntry.fetch_widgets_link,{rule_id:this.formEntry.rule_id,loaded_urls:this.formEntry.loaded_urls}).then(e=>{this.handleRequestNewWidgetsSuccess(e)},()=>{throw new Error("could not load more widgets")})}handleRequestNewWidgetsSuccess(e){this.updateFormForNewWidgets(e),this.handleNoMoreArticles()}updateFormForNewWidgets(e){this.formEntry.widgets=this.formEntry.widgets.concat(e.widgets),this.formEntry.no_more_articles_to_label=e.no_more_articles_to_label,this.formEntry.loaded_urls=e.loaded_urls,this.isLoadingNewArticles=!1,this.triggerWidgetsRequestIndex=this.calculateTriggerWidgetsRequestIndex(e.widgets.length)}handleUndoClick(){this.canUndo()&&(this.keypressListener.stop_listening(),this.disableArticle(),setTimeout(async()=>{await this.callUndoEndpoint()},500)),this.keypressListener.listen()}async callUndoEndpoint(){b.restFormService.post(this.formEntry.undo_link,{undo:this.formEntry.undo,rule_id:this.formEntry.rule_id}).then(e=>{this.handleCallUndoEndpointSuccess(e)},()=>{this.enableArticle()})}handleCallUndoEndpointSuccess(e){this.widgetsIteratingIndex--,this.updateWidget(this.formEntry.widgets[this.widgetsIteratingIndex].widget),this.decrementChoiceProgress(),this.updateUndoPayload(e),this.updateOverallProgress(),this.enableArticle()}trainNow(){this.canTrainNow()&&(this.trainingWouldResultInLowAccuracy()?this.showLowAccuracyBubble():this.callTrainNowEndpoint())}trainingWouldResultInLowAccuracy(){return this.formEntry.choices.every(e=>e.progress<e.progress_max)}showLowAccuracyBubble(){S.confirmationService.display({message:this.formEntry.low_accuracy_warning_message}).then(()=>this.callTrainNowEndpoint(),()=>{})}callTrainNowEndpoint(){b.restFormService.post(this.formEntry.start_training_link,{rule_id:this.formEntry.rule_id}).then(()=>{this.$rootScope.redirect(this.formEntry.root_link_back)},()=>{})}trainLater(){this.$rootScope.redirect(this.formEntry.root_link_back)}handleNoMoreArticles(){this.hasArticlesToShow()||this.keypressListener.stop_listening()}disableArticle(){this.willRegisterClick=!1,$(".ai-training-area").find(".articles").addClass("highlight-training-area")}enableArticle(){$(".ai-training-area").find(".articles").removeClass("highlight-training-area"),this.willRegisterClick=!0}updateWidget(e){this.widgetFragmentModel.widget=C.widgetFactory.wrapWidget(e),this.widgetFragment.update(this.widgetFragmentModel,u.DataAction.DATA_CHANGED)}updateUndoPayload(e){this.formEntry.undo=e.undo,this.formEntry.undo_link=e.undo_link}calculateTriggerWidgetsRequestIndex(e){const t=this.formEntry.widgets.length-Math.floor(e/2);return 1===t?0:t}incrementChoiceProgress(e){e.progress++}decrementChoiceProgress(){this.formEntry.choices.find(e=>e.id===this.formEntry.undo.category_id).progress--}updateOverallProgress(){this.formEntry.overall_progress=this.calculateOverallProgress()}calculateOverallProgress(){const e=this.calculateOverallProgressBasedOnMinimumTagProgress();return e>100?100:e}calculateOverallProgressBasedOnMinimumTagProgress(){const{choices:e}=this.formEntry,t=e.length<3?e:e.slice(1,this.formEntry.choices.length);return Math.min(...t.map(e=>e.progress))}calculateOverallProgressBasedOnAverageTagProgress(){const e=this.calculateSumOfRelevantProgress(),{choices:t}=this.formEntry,i=(t.length<3?t:t.slice(1,t.length)).reduce((e,t)=>({progress_max:e.progress_max+t.progress_max})).progress_max;return Math.round(e/i*100)}calculateSumOfRelevantProgress(){const{choices:e}=this.formEntry;return e.slice(1,e.length).reduce((e,t)=>{let i;return i=t.progress>t.progress_max?t.progress_max:t.progress,{progress:e.progress+i}}).progress}calculateSumOfEveryProgress(){return this.formEntry.choices.reduce((e,t)=>{let i;return i=t.progress>t.progress_max?t.progress_max:t.progress,{progress:e.progress+i}}).progress}getOverallProgressStyle(){return{width:this.formEntry.overall_progress/100*123+"px"}}getUserTagProgressStyle(e){return{width:(e.progress<e.progress_max?e.progress:e.progress_max)/100*193+"px"}}getIrrelevantTagStyle(){return this.shouldShowIrrelevantProgressBar()?{height:"44px"}:void 0}getProgressBarColor(e){const t=this.getRatioOfProgressToMaxProgress(e);return{borderColor:`rgb(${this.getRedPartOfProgressBarColor(t)},${this.getGreenPartOfProgressBarColor(t)},0)`}}getRatioOfProgressToMaxProgress(e){return void 0!==e?e.progress/e.progress_max:this.formEntry.overall_progress/100}getRedPartOfProgressBarColor(e){return e<.5?255:Math.round(-3.1*e*100+410)}getGreenPartOfProgressBarColor(e){return e<.5?Math.round(380*e):190}hasArticlesToShow(){return void 0===this.formEntry.no_more_articles_to_label}canShowAddTags(){return this.formEntry.can_add_categories&&this.formEntry.tag_categories&&!this.addingNewCategory}canShowAddGeoLocation(){return this.formEntry.can_add_categories&&!this.formEntry.tag_categories&&!this.addingNewCategory}canSubmitChoice(){return this.willRegisterClick&&this.widgetsIteratingIndex!==this.formEntry.widgets.length}shouldShowDescription(){return""!==this.description}canTrainNow(){return this.calculateSumOfEveryProgress()>=this.formEntry.training_threshold}isFirstCategoryIrrelevant(){return this.formEntry.choices[0].irrelevant_category}getChoicesRenderLimitTo(){return 1-this.categoryIndexOffset-this.formEntry.choices.length}canUndo(){return void 0!==this.formEntry.undo}shouldShowIrrelevantProgressBar(){return this.formEntry.choices.length<3}shouldShowCanTrainNowMessage(){return this.formEntry.untrained_model&&this.atLeastOneCategoryIsFullyLabelled()}atLeastOneCategoryIsFullyLabelled(){return this.formEntry.choices.some(e=>e.progress>=e.progress_max)}handleAddTagClick(){this.handleAddTagBubbleAlreadyOpen(),this.keypressListener.stop_listening(),this.generateAddTagBubble()}handleAddTagBubbleAlreadyOpen(){void 0!==this.addTagCategoryBubble&&(this.addTagCategoryBubble.destroy(),this.keypressListener.listen())}async generateAddTagBubble(){const e=constants.bubble_dialog.id.add_tag_category,t=v.configurationService.getBubbleDialogConfiguration().getStyle(e);t.setAbsoluteY(window.innerHeight/5-t.minHeight/5);const i=b.restFormService.post(this.formEntry.load_tags_link,{rule_id:this.formEntry.rule_id},"info");c.notificationService.warning(T,{permanent:!0,singleInstance:!0,closeOnResolve:i});const n=await i,s=this.buildAddTagCategoryBubble(n,this.formEntry);this.addTagCategoryBubble=y.bubbleDialogService.createReactBubble(e,$("body"),s,e=>(e.payload=s,l.createElement(_.AddTagCategoryDialog,{payload:e.payload,destroy:e.destroy})),t,{preventOutsideClickActions:!0})}buildAddTagCategoryBubble(e,t){return{tags:new E.TopicMenuWrapper(e.tags),headerMessage:t.add_or_select_category_message,ruleId:t.rule_id,addNewCategoryLink:t.add_category_link,keypressListener:this.keypressListener}}handleCategoryAdd(e){const t=this.formEntry.choices.map(e=>e.id),i=e.value.choices.find(e=>t.every(t=>t!==e.id));this.updateFormToNewCategory(i,e.value)}updateFormToNewCategory(e,t){this.formEntry.choices.push(e),this.formEntry.can_add_categories=t.can_add_categories,this.registerKeyCombos(this.generateKeyCombos()),this.formEntry.overall_progress=this.calculateOverallProgress()}getKeyboardKeyLabel(e){return p.contextData.userSettings.shortcuts.ai_training[e]}initWidget(){if(this.hasArticlesToShow()){this.widget=C.widgetFactory.wrapWidget(this.formEntry.widgets[this.widgetsIteratingIndex].widget);const e=new u.PortableFragment(h.ArticleWidgetFragment,{},e=>m.WidgetFragmentDrawStyleFactory.createFragmentDrawStyle(this.widget,e,{})),t=new d.CancellationToken;this.$timeout(async()=>{const{drawSettings:i,model:n,fragment:s}=await e.deploy(this.buildFragmentParameters(t));this.widgetFragmentModel=n,this.widgetFragment=s,await s.update(n,u.DataAction.NEW_DATA),await s.draw(i)},0)}}buildFragmentParameters(e){return{cleanUp:e,animationStrategy:0,animationDuration:0,mediator:new u.WidgetMediator,rootNode:document.getElementById("ai-training-article-root"),payload:this.widget,dimensions:new a.Rectangle(a.Vector2D.zero(),300,300)}}};M=__decorate([n.ngInject(["$scope","$rootScope","$timeout"]),__metadata("design:paramtypes",[Object,Object,Function,o.Listener])],M),t.default=M}),define("react_components/grouped_sma/sma_account_component",["require","exports","react","flux","classes/context_data/context_data","classnames","reusable_components","services/bubble_dialog","services/configuration","services/rest_form_service","services/confirmation_service"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0});t.SmaAccountComponent=class extends n.BaseComponent{constructor(e){super(e),this.state={busy:!1}}render(){return this.renderSingleAccount()}renderSingleAccount(){const e=o({"list-unstyled":!0,"group-row":!0,expired:"expired"===this.props.account.expiration_state}),t=this.state.busy?{pointerEvents:"none",opacity:.3}:null;return i.createElement("li",{className:e,style:t,onClick:e=>this.connectAccount(e)},i.createElement("div",{className:"account-name"},this.validateAccountName(this.props.account.name)),i.createElement("i",{className:"fa fa-trash account-action",onClick:e=>this.deleteAccount(e)}),this.accountInfo())}validateAccountName(e){return e&&""!==e?e:s.contextData.getMessage("_666568")}accountInfo(){let e,t;if(this.props.account.expiration_date)switch(this.props.account.expiration_state){case"expired":e=`${s.contextData.getMessage("_666875")} ${this.props.account.expiration_date}. `,t="fa fa-exclamation-circle account-info error";break;case"expires_in_7_days":e=`${s.contextData.getMessage("_666879")} ${this.props.account.expiration_date}. `,t="fa fa-exclamation-triangle account-info error warning-color";break;case"not_expired":e=`${s.contextData.getMessage("_666871")} ${this.props.account.expiration_date}. `,t="fa fa-info-circle account-info"}return"ERROR"==this.props.account.status&&(e=e?e+s.contextData.getMessage("_186185"):s.contextData.getMessage("_186185"),t="fa fa-exclamation-circle account-info error"),i.createElement(r.TooltipComponent,{text:e,position:"top"},i.createElement("i",{className:t}))}async deleteAccount(e){e.stopPropagation(),e.preventDefault(),this.setState({busy:!0});try{const e={message:s.contextData.getMessage("_966932",[this.props.account.name])};await d.confirmationService.display(e),await l.restFormService.deleter(this.props.account.link_delete_sma,{oauth_site_code:this.props.account.oauth_site_code}),this.props.dataChanged()}catch(e){this.setState({busy:!1})}}connectAccount(e){e.stopPropagation(),e.preventDefault();const t=constants.bubble_dialog.id.account_details,i={name:this.props.account.name,expiration_date:this.props.account.expiration_date,added_date:this.props.account.added_date,expiration_state:this.props.account.expiration_state,social_media_pages:this.props.account.social_media_pages,status:this.props.account.status,projectId:this.props.projectId,userId:this.props.userId,site_code:this.props.account.site_code};a.bubbleDialogService.createByType(t,$("body"),t,i,c.configurationService.getBubbleDialogConfiguration().getStyle(t),{fadeBackground:!0}).onDestroy.subscribeOnce(()=>{})}}}),define("react_components/grouped_sma/sma_group_component",["require","exports","react","flux","services/theme","react_components/grouped_sma/sma_account_component"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.SmaGroupComponent=class extends n.BaseComponent{constructor(e){super(e),this.state={accounts:e.accounts}}render(){return this.renderGroup(this.props.accounts)}colorForSite(e){const t=s.themeService.getCurrentThemeModel();switch(e){case"fb":case"fbi":return t.facebook;case"tw":return t.twitter;case"ga":case"gs":case"gp":case"gx":return t.googlePlus;case"li":return t.linkedin;case"fl":return t.flickr;case"ig":return t.instagram;case"vi":return t.vimeo;case"pt":return t.pinterest;case"tc":return t.twitch;case"ks":return t.kakaoStory;case"aa":return t.adobeAnalytics;case"ii":return t.instagram;case"rt":return t.reviewtrackers;default:return t.shade}}generateTitleStyle(e){return{backgroundColor:this.colorForSite(e),height:"37px"}}generateLogoClass(e){let t="sma-logo ";switch(e){case"fb":t+="fa fa-facebook";break;case"tw":t+="fa fa-twitter";break;case"gp":t+="fa fa-google-plus";break;case"li":t+="fa fa-linkedin";break;case"fl":t+="fa fa-flickr";break;case"ig":t+="fa fa-instagram";break;case"vi":t+="fa fa-vimeo-square";break;case"pt":t+="fa fa-pinterest";break;case"tc":t+="fa fa-twitch";break;case"ks":t+="fa icon2-tw-kakaostory";break;case"aa":t+="fa icon2-tw-adobe-analytics";break;case"ga":case"gs":case"gx":t+="fa fa-google";break;case"rt":t+="fa icon2-tw-reviewtrackers";break;default:t+="fa fa-question"}return t}generateSiteName(e){switch(e){case"fb":return"Facebook";case"fbi":return"Facebook Insights";case"tw":return"Twitter";case"gp":return"Google+";case"li":return"LinkedIn";case"fl":return"Flickr";case"ig":return"Instagram";case"vi":return"Vimeo";case"pt":return"Pinterest";case"tc":return"Twitch";case"ks":return"KakaoStory";case"aa":return"Adobe Analytics";case"ga":return"Google Analytics";case"gs":return"Google Spreadsheets";case"gx":return"Google Play";case"ii":return"Instagram Insights";case"rt":return"ReviewTrackers";default:return`unknown - ${e}`}}renderGroup(e){let t=null;if("ga"===e.code_site||"gs"===e.code_site||"gx"===e.code_site||"gp"===e.code_site)t=i.createElement("img",{className:"sma-logo-img",src:"/app/assets/svg/btn_google_light_normal_ios.svg"});else if("fbi"===e.code_site)t=i.createElement("img",{className:"sma-logo-img",src:"/app/assets/svg/facebook-insights.svg"});else if("ii"===e.code_site){const e=`/app/assets/svg/insta_business_insights.svg?ts=${window.bootPayload.version}`;t=i.createElement("img",{className:"sma-logo-img",src:e})}else t=i.createElement("i",{className:this.generateLogoClass(e.code_site)});return i.createElement("li",{className:"list-unstyled sma-group"},i.createElement("div",{style:this.generateTitleStyle(e.code_site)},t,i.createElement("span",{className:"sma-group-name"},this.generateSiteName(e.code_site))),this.renderAccounts(e))}renderAccounts(e){const t=e.social_media_accounts;return t.length>0?i.createElement("ul",{className:"list-unstyled sma-group-content stylized-scrollbar"},t.map((e,t)=>i.createElement(o.SmaAccountComponent,{key:`account-${e.name}-${t}`,account:e,projectId:this.props.projectId,userId:this.props.userId,dataChanged:this.props.dataChanged}))):null}}}),define("react_components/grouped_sma/grouped-sma",["require","exports","react","flux","react_components/grouped_sma/sma_group_component","classes/context_data/context_data"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});t.GroupedSocialMediaAccounts=class extends n.BaseComponent{constructor(e){super(e),this.state={accounts:e.accounts}}render(){return this.props.accounts.length>0?(this.sortAsExpected(),i.createElement("div",{className:"relative-container form-group"},i.createElement("div",{className:"sub-title"},o.contextData.getMessage("_666563")),i.createElement("ul",{className:"sma-groups"},this.props.accounts.map((e,t)=>i.createElement(s.SmaGroupComponent,{key:`SmaGroupComponent-${t}-${e.code_site}`,accounts:e,projectId:this.props.projectId,userId:this.props.userId,dataChanged:this.props.dataChanged}))))):i.createElement("div",{className:"no-data"},o.contextData.getMessage("_666981"))}sortAsExpected(){const e=this.props.sites;this.props.accounts.sort((t,i)=>e.indexOf(t.code_site)-e.indexOf(i.code_site))}}}),define("controllers/rest_form/sma/sma_management",["require","exports","react","react-dom","reusable_utilities","react_components/grouped_sma/grouped-sma","services/rest_form_service","services/sma_service"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(e,t,i){this.$scope=e,this.$element=i,this.tokenModel=void 0,this.invitationsVisible=!1,this.formEntry=t.form_entry,this.userSma=this.formEntry.user_social_media_accounts,this.siteCodesToConnect=this.formEntry.site_codes_to_connect,this.projectId=e.form_entry.project_id,this.cancellationToken=new s.CancellationToken,e.$on("$destroy",()=>{this.cancellationToken.cancel()}),t.socialMediaAccountCallBack=this.socialMediaAccountCallBack.bind(this),this.showConnections(),this.showInvitations()}async reloadModels(){try{this.tokenModel=await r.restFormService.getRForm("socialmedia_token_request","show"),this.formEntry=await r.restFormService.getRForm("social_media_account","show")}catch(e){}}sharePageCallBack(e,t,i){a.smaService.sharePageCallBack(e,t,i,this.$scope.projects_sma)}async socialMediaAccountCallBack(){this.updateUi()}async updateUi(){await this.reloadModels(),this.renderConnections()}async waitFor(e){return new Promise(t=>{const i=setInterval(()=>{const n=this.$element.find(e);n.length<1||(clearInterval(i),t(n))},200)})}async showConnections(){const e=(await this.waitFor("#sma-mgmt-con")).get(0);this.cancellationToken.addCleanupFunction(()=>n.unmountComponentAtNode(e)),this.renderConnections()}renderConnections(){const e=this.$element.find("#sma-mgmt-con").get(0);n.render(i.createElement(o.GroupedSocialMediaAccounts,{accounts:this.formEntry.connected_social_media_accounts_per_type,sites:this.formEntry.site_codes_to_connect,userId:this.$scope.userId,projectId:this.projectId,externalTypeConnection:"SMA",dataChanged:this.updateUi.bind(this)}),e)}async showInvitations(){this.tokenModel=await r.restFormService.getRForm("socialmedia_token_request","show"),this.invitationsVisible=!0}}c.$inject=["$scope","$window","$element","smaService","restFormService"],t.default=c}),define("controllers/rest_form/scoring_engine/add_custom_score_bubble",["require","exports","flux","react","reusable_utilities","classes/context_data/context_data","react_components/form/progress_button/progress_button_container","event_bus","services/rest_form_service","notifications"],function(e,t,i,n,s,o,r,a,c,l){Object.defineProperty(t,"__esModule",{value:!0});class d extends i.BaseComponent{constructor(e){if(super(e),this.props.editMode){const{label:e,description:t,formula:i,name:n}=this.props.payload;this.state={label:e,description:t,formula:i,valid:!0,name:n,nameErrorMessage:"",formulaErrorMessage:"",allTheErrors:[]}}else this.state={label:"",description:"",valid:!1,formula:"",formulaErrorMessage:"",name:"",nameErrorMessage:"",allTheErrors:[]}}render(){return n.createElement("div",{className:"tw-bubble-dialog-create-custom-score disable-shadow"},this.renderHeader(),this.renderBody())}renderHeader(){const e=this.props.editMode?o.contextData.getMessage("_2363562"):o.contextData.getMessage("_2132416");return n.createElement("div",{className:"header"},n.createElement("h2",null,e,n.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}renderBody(){return n.createElement("div",{className:"body"},n.createElement("form",{className:"form-horizontal"},n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-2 control-label"},o.contextData.getMessage("_2456654")),n.createElement("div",{className:"col-xs-10"},n.createElement("input",{type:"text",value:this.state.label,className:"custom-score-creation-input",onChange:this.handleLabelChange.bind(this),required:!0,maxLength:20}))),this.renderNamePart(),n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-2 control-label"},o.contextData.getMessage("_2681654")),n.createElement("div",{className:"col-xs-10"},n.createElement("input",{type:"text",value:this.state.description,className:"custom-score-creation-input",onChange:this.handleDescriptionChange.bind(this),maxLength:200}))),n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-2 control-label"},o.contextData.getMessage("_2684165")),n.createElement("div",{className:"col-xs-10"},n.createElement("textarea",{value:this.state.formula,className:"custom-score-creation-input",onChange:this.handleFormulaChange.bind(this),maxLength:5e3}),this.renderFormulaError()))),this.renderButtons(),this.renderErrorMessages())}renderNamePart(){return n.createElement("div",{className:"form-group"},n.createElement("label",{className:"col-xs-2 control-label"},o.contextData.getMessage("_2651656")),n.createElement("div",{className:"col-xs-10"},n.createElement("p",{className:"help-block",dangerouslySetInnerHTML:{__html:o.contextData.getMessage("_2541566")}}),n.createElement("div",{className:"custom-score-creation-name-container"},n.createElement("div",{className:"operator-prefix"},o.contextData.getMessage("_2684156")),n.createElement("input",{type:"text",value:this.state.name,className:"operator-input",onChange:this.handleNameChange.bind(this),maxLength:20,disabled:this.props.editMode})),this.renderNameErrorMessage()))}handleNameChange(e){const t=e.target.value,i=this.isLabelValid(this.state.label)&&this.isDescriptionValid(this.state.description);this.setState({name:t,valid:i})}renderNameErrorMessage(){return this.state.nameErrorMessage?n.createElement("p",{className:"help-block",style:{color:"red"}},this.state.nameErrorMessage):void 0}renderFormulaError(){return this.state.formulaErrorMessage?n.createElement("p",{className:"help-block",style:{color:"red"}},this.state.formulaErrorMessage):void 0}handleLabelChange(e){const t=e.target.value,i=this.isLabelValid(t),n=this.isDescriptionValid(this.state.description);this.setState({label:t,valid:i&&n})}handleDescriptionChange(e){const t=e.target.value,i=this.isDescriptionValid(t),n=this.isLabelValid(this.state.label);this.setState({description:t,valid:i&&n})}handleFormulaChange(e){const t=e.target.value,i=t.length<5001,n=this.isLabelValid(this.state.label)&&this.isDescriptionValid(this.state.description);this.setState({formula:t,valid:i&&n})}renderButtons(){return n.createElement("div",{className:"tw-buttons clearfix",style:{marginTop:"20px"}},n.createElement(r.ProgressButtonContainer,{text:o.contextData.getMessage("_612374"),textCalling:o.contextData.getMessage("_911337"),clickEvent:this.saveCustomScore.bind(this),className:"tw-button pull-right",disabled:!this.state.valid}),n.createElement("button",{type:"button",className:"btn btn-default pull-right",style:{marginRight:"10px"},onClick:this.clickOutside.bind(this)},o.contextData.getMessage("_691638")))}async saveCustomScore(){const{valid:e,label:t,description:i,formula:n,name:s}=this.state,{visible:r,update_link:d}=this.props.payload;if(e){const e=this.props.editMode?c.restFormService.post(d,{id:s,name:t,description:i,formula:n,visible:r}):c.restFormService.postRForm("scoring_engine","add",{name:t,description:i,formula:n,id:s}),g='<i class="fa fa-refresh fa-spin"></i> '+o.contextData.getMessage("_498245");l.notificationService.warning(g,{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(e=>{void 0!==e.error_messages&&e.error_messages.length>0?this.setState({allTheErrors:e.error_messages}):(a.eventBus.dispatch({type:a.EVENT_TYPES.CUSTOM_SCORE_CREATED,value:void 0}),this.props.destroy())},()=>{})}}renderErrorMessages(){return n.createElement(n.Fragment,null,this.state.allTheErrors.map(e=>n.createElement("div",{style:{color:"red"},key:e,dangerouslySetInnerHTML:{__html:e}})))}isLabelValid(e){let t=!1;return e.length>0&&e.length<21&&(t=!0),t}isDescriptionValid(e){let t=!1;return e.length<201&&(t=!0),t}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.CreateCustomScoreBubble=d,s.applyMixins(d,[i.DocumentClickTracker])}),define("controllers/rest_form/scoring_engine/add_indicator_variable_bubble",["require","exports","angular_utilities","event_bus","flux","react","reusable_components","reusable_utilities","classes/context_data/context_data","react_components/form/progress_button/progress_button_container","services/rest_form_service","notifications","wrappers/topic_menu/topic_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){var p;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CUSTOM_FILTER="CUSTOM_FILTER",e.SOURCE_PANEL="SOURCE_PANEL",e.SEARCH_QUERY="CUSTOM_INDICATOR_QUERY",e.TOPIC="TOPIC",e.CHANNEL="CHANNEL"}(p=t.MatchType||(t.MatchType={}));class h extends s.BaseComponent{constructor(e){if(super(e),this.matchType=p.CUSTOM_FILTER,this.props.editMode){const{info:e={}}=this.props.payload;this.state={valid:!1,description:e.description,name:e.name,nameErrorMessage:"",customFilterSelected:e.type===p.CUSTOM_FILTER,searchQuerySelected:e.type===p.SEARCH_QUERY,sourcePanelSelected:e.type===p.SOURCE_PANEL,topicSelected:e.type===p.TOPIC,channelSelected:e.type===p.CHANNEL,queryObject:{query:""},allTheErrors:[]}}else this.state={valid:!1,description:"",name:"",nameErrorMessage:"",customFilterSelected:!0,searchQuerySelected:!1,sourcePanelSelected:!1,topicSelected:!1,channelSelected:!1,queryObject:{query:""},allTheErrors:[]}}render(){return o.createElement("div",{className:"tw-bubble-dialog-create-indicator-variable disable-shadow"},this.renderHeader(),this.renderBody())}renderHeader(){return o.createElement("div",{className:"header"},o.createElement("h2",null,c.contextData.getMessage("_2465416"),o.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×")))}renderBody(){return o.createElement("div",{className:"body"},o.createElement("form",{className:"form-horizontal",name:"indicator_form"},o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},c.contextData.getMessage("_2656351")),o.createElement("div",{className:"col-xs-10"},o.createElement("p",{className:"help-block",dangerouslySetInnerHTML:{__html:c.contextData.getMessage("_2456852")}}),o.createElement("input",{type:"text",value:this.state.name,className:"indicator-variable-creation-input",onChange:this.handleNameChange.bind(this),required:!0,maxLength:20,disabled:this.props.editMode}),this.renderNameErrorMessage())),o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},c.contextData.getMessage("_2788596")),o.createElement("div",{className:"col-xs-10"},o.createElement("input",{type:"text",value:this.state.description,className:"custom-score-creation-input",onChange:this.handleDescriptionChange.bind(this),maxLength:200,disabled:this.props.editMode}))),this.props.editMode?void 0:o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},c.contextData.getMessage("_2123456")),o.createElement("div",{className:"col-xs-10"},o.createElement(r.MultipleCheckboxRenderable,{items:this.generateRadioButtons()}))),this.renderMatchType()),this.renderSearchQuery(),this.renderButtons(),this.renderErrorMessages())}renderNameErrorMessage(){return this.state.nameErrorMessage?o.createElement("p",{className:"help-block",style:{color:"red"}},this.state.nameErrorMessage):void 0}generateRadioButtons(){const e=r.StateButtonType.RADIO_BUTTON,{topicSelected:t,customFilterSelected:i,sourcePanelSelected:n,searchQuerySelected:s,channelSelected:o}=this.state;return[{id:p.CUSTOM_FILTER,label:c.contextData.getMessage("_2568541"),type:e,onClick:this.handleRadioButtonClick.bind(this),checked:i},{id:p.SOURCE_PANEL,label:c.contextData.getMessage("_2568543"),type:e,onClick:this.handleRadioButtonClick.bind(this),checked:n},{id:p.SEARCH_QUERY,label:c.contextData.getMessage("_2568542"),type:e,onClick:this.handleRadioButtonClick.bind(this),checked:s},{id:p.TOPIC,label:c.contextData.getMessage("_2568549"),type:e,onClick:this.handleRadioButtonClick.bind(this),checked:t},{id:p.CHANNEL,label:c.contextData.getMessage("_2654165"),type:e,onClick:this.handleRadioButtonClick.bind(this),checked:o}]}handleRadioButtonClick(e,t){let i,n,s,o,r=!1;switch(t.id){case p.CUSTOM_FILTER:i=!0,this.matchType=p.CUSTOM_FILTER,this.codeContainerLogic=void 0;break;case p.SOURCE_PANEL:n=!0,this.matchType=p.SOURCE_PANEL,this.codeContainerLogic=void 0;break;case p.SEARCH_QUERY:s=!0,this.matchType=p.SEARCH_QUERY;break;case p.TOPIC:r=!0,this.matchType=p.TOPIC,this.codeContainerLogic=void 0;break;case p.CHANNEL:o=!0,this.matchType=p.CHANNEL,this.codeContainerLogic=void 0;break;default:throw new Error(`${t.id} is not a known match type`)}this.setState({customFilterSelected:i,sourcePanelSelected:n,searchQuerySelected:s,topicSelected:r,channelSelected:o})}renderMatchType(){let e=void 0,t=void 0;return this.state.customFilterSelected?(e=this.renderCustomFilterMatchType(),t=c.contextData.getMessage("_2568541")):this.state.sourcePanelSelected?(e=this.renderSourcePanelMatchType(),t=c.contextData.getMessage("_2568543")):this.state.topicSelected?(e=this.renderTopicMatchType(),t=c.contextData.getMessage("_2568549")):this.state.channelSelected&&(e=this.renderChannelMatchType(),t=c.contextData.getMessage("_2654165")),e?o.createElement("div",{className:"form-group"},o.createElement("label",{className:"col-xs-2 control-label"},t),o.createElement("div",{className:"col-xs-10"},e)):void 0}renderCustomFilterMatchType(){return this.props.editMode&&this.props.payload.info&&this.props.payload.info.custom_filter_topic_menu?o.createElement("div",{style:{paddingTop:5}},new u.TopicMenuWrapper(this.props.payload.info.custom_filter_topic_menu).getFirstSelectedEntry().getName()):this.props.payload.customFilters?o.createElement(r.SingleSelectComponent,{model:this.props.payload.customFilters,allowEmptySelection:!1}):o.createElement("div",{style:{paddingTop:5}},"No filters to choose from found!")}renderSourcePanelMatchType(){return this.props.editMode&&this.props.payload.info&&this.props.payload.info.source_panel_topic_menu?o.createElement("div",{style:{paddingTop:5}},new u.TopicMenuWrapper(this.props.payload.info.source_panel_topic_menu).getFirstSelectedEntry().getName()):this.props.payload.sourcePanels?o.createElement(r.SingleSelectComponent,{model:this.props.payload.sourcePanels,allowEmptySelection:!1}):o.createElement("div",{style:{paddingTop:5}},"No source panels to choose from found!")}renderChannelMatchType(){return this.props.editMode&&this.props.payload.info&&this.props.payload.info.channel_topic_menu?o.createElement("div",{style:{paddingTop:5}},new u.TopicMenuWrapper(this.props.payload.info.channel_topic_menu).getFirstSelectedEntry().getName()):this.props.payload.channels?o.createElement(r.SingleSelectComponent,{model:this.props.payload.channels,allowEmptySelection:!1}):o.createElement("div",{style:{paddingTop:5}},"No channels to choose from found!")}renderSearchQuery(){if(this.props.editMode&&this.props.payload.info&&this.props.payload.info.type===p.SEARCH_QUERY)return o.createElement("form",{className:"form-horizontal",name:"indicator_form"},o.createElement("div",{className:"form-group",style:{paddingBottom:"10px"}},o.createElement("label",{className:"col-xs-2 control-label"},"Query"),o.createElement("div",{className:"col-xs-10",style:{paddingTop:5}},this.props.payload.info.query)));if(this.state.searchQuerySelected){const e=c.contextData.getMessage("_2568542");return o.createElement("div",{ref:this.bindCodeContainer.bind(this,e)})}return null}async bindCodeContainer(e,t){t&&!this.codeContainerLogic&&(this.codeContainerLogic=await i.directiveService.inject(tw.inject("$compile"),$(t),"injectable-code-editor",{directiveArguments:{query:this.state.queryObject,label:e,validator:"FILTER_SETUP",location:"FILTER_SETUP"},parentScope:tw.inject("$rootScope"),directiveAsElement:!0}))}renderTopicMatchType(){return this.props.editMode&&this.props.payload.info&&this.props.payload.info.query_topic_topic_menu?o.createElement("div",{style:{paddingTop:5}},new u.TopicMenuWrapper(this.props.payload.info.query_topic_topic_menu).getFirstSelectedEntry().getName()):this.props.payload.topics?o.createElement(r.SingleSelectComponent,{model:this.props.payload.topics,allowEmptySelection:!1}):o.createElement("div",{style:{paddingTop:5}},"No topics to choose from found!")}handleNameChange(e){const t=e.target.value,i=this.isNameValid(t),n=this.isDescriptionValid(this.state.description);this.setState({name:t,valid:i&&n})}handleDescriptionChange(e){const t=e.target.value,i=this.isDescriptionValid(t),n=this.isNameValid(this.state.name);this.setState({description:t,valid:i&&n})}renderButtons(){return this.props.editMode?void 0:o.createElement("div",{className:"tw-buttons clearfix",style:{marginTop:"20px"}},o.createElement(l.ProgressButtonContainer,{text:c.contextData.getMessage("_612374"),textCalling:c.contextData.getMessage("_911337"),clickEvent:this.saveIndicatorVariable.bind(this),className:"tw-button pull-right",disabled:!this.state.valid}),o.createElement("button",{type:"button",className:"btn btn-default pull-right",style:{marginRight:"10px"},onClick:this.clickOutside.bind(this)},c.contextData.getMessage("_691638")))}async saveIndicatorVariable(){if(this.state.valid){const e=d.restFormService.postRForm("indicator_variable","add",{name:this.state.name,description:this.state.description,query:this.state.queryObject.query,type:this.matchType,custom_filter_topic_menu:this.props.payload.customFilters,query_topic_topic_menu:this.props.payload.topics,source_panel_topic_menu:this.props.payload.sourcePanels,channel_topic_menu:this.props.payload.channels}),t='<i class="fa fa-refresh fa-spin"></i> '+c.contextData.getMessage("_498245");g.notificationService.warning(t,{permanent:!0,singleInstance:!0,closeOnResolve:e}),e.then(e=>{void 0!==e.error_messages&&e.error_messages.length>0?this.setState({allTheErrors:e.error_messages}):(n.eventBus.dispatch({type:n.EVENT_TYPES.INDICATOR_VARIABLE_CREATED,value:void 0}),this.props.destroy())},()=>{})}}renderErrorMessages(){return o.createElement(o.Fragment,null,this.state.allTheErrors.map(e=>o.createElement("div",{style:{color:"red"},key:e,dangerouslySetInnerHTML:{__html:e}})))}isNameValid(e){let t=!1;return e.length>0&&e.length<21&&(t=!0),t}isDescriptionValid(e){let t=!1;return e.length<201&&(t=!0),t}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.AddIndicatorVariableBubble=h,a.applyMixins(h,[s.DocumentClickTracker])}),define("controllers/rest_form/scoring_engine/scoring_engine",["require","exports","event_bus","react","classes/context_data/context_data","services/bubble_dialog","services/configuration","services/confirmation_service","services/rest_form_service","controllers/rest_form/scoring_engine/add_custom_score_bubble","controllers/rest_form/scoring_engine/add_indicator_variable_bubble"],function(e,t,i,n,s,o,r,a,c,l,d){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$scope",function(e){async function t(){const t=await c.restFormService.getRForm("scoring_engines","show");e.formData=t,tw.inject("$rootScope").$applyAsync()}t(),e.addCustomScore=function(){const e=constants.bubble_dialog.id.add_custom_score,s=r.configurationService.getBubbleDialogConfiguration().getStyle(e),a={};o.bubbleDialogService.createReactBubble(e,$("body"),a,e=>(e.payload=a,n.createElement(l.CreateCustomScoreBubble,{editMode:!1,payload:e.payload,destroy:e.destroy})),s,{preventOutsideClickActions:!0}),i.eventBus.subscribeOnce(i.EVENT_TYPES.CUSTOM_SCORE_CREATED,async()=>{await t()})},e.editCustomScore=function(e){const s=constants.bubble_dialog.id.add_custom_score,a=r.configurationService.getBubbleDialogConfiguration().getStyle(s),c={label:e.name,description:e.description,formula:e.formula,name:e.id,update_link:e.update_link,visible:e.visible};o.bubbleDialogService.createReactBubble(s,$("body"),c,e=>(e.payload=c,n.createElement(l.CreateCustomScoreBubble,{editMode:!0,payload:e.payload,destroy:e.destroy})),a,{preventOutsideClickActions:!0}),i.eventBus.subscribeOnce(i.EVENT_TYPES.CUSTOM_SCORE_CREATED,async()=>{await t()})},e.deleteCustomScore=function(e){a.confirmationService.display({message:s.contextData.getMessage("_2456524")}).then(async()=>{await c.restFormService.deleter(e.remove_link),await t()},()=>{})},e.toggleVisibility=async function(e){await c.restFormService.post(e.enable_link,{visible:!e.visible}),await t()},e.deleteIndicatorVariable=function(e){a.confirmationService.display({message:s.contextData.getMessage("_2476524")}).then(async()=>{await c.restFormService.get(e.remove_link),await t()},()=>{})},e.addIndicatorVariable=async function(){const e=await c.restFormService.getRForm("indicator_variable","info"),s=constants.bubble_dialog.id.add_indicator_variable,a=r.configurationService.getBubbleDialogConfiguration().getStyle(s),{custom_filter_topic_menu:l,query_topic_topic_menu:g,source_panel_topic_menu:u,channel_topic_menu:p}=e,h={customFilters:l,sourcePanels:u,topics:g,channels:p};o.bubbleDialogService.createReactBubble(s,$("body"),h,e=>(e.payload=h,n.createElement(d.AddIndicatorVariableBubble,{payload:e.payload,destroy:e.destroy})),a,{preventOutsideClickActions:!0}),i.eventBus.subscribeOnce(i.EVENT_TYPES.INDICATOR_VARIABLE_CREATED,async()=>{await t()})},e.showIndicatorVariable=async function(e){const t=await c.restFormService.get(e.edit_link),i=constants.bubble_dialog.id.add_indicator_variable,s=r.configurationService.getBubbleDialogConfiguration().getStyle(i),a={customFilters:void 0,sourcePanels:void 0,topics:void 0,channels:void 0,info:t};o.bubbleDialogService.createReactBubble(i,$("body"),a,e=>(e.payload=a,n.createElement(d.AddIndicatorVariableBubble,{payload:e.payload,destroy:e.destroy,editMode:!0})),s,{preventOutsideClickActions:!0})}}]}),define("entry_point/configurations/angular_configuration/angular_modules/components_rest_form",["require","exports","angular","controllers/rest_form/accounts/account_selection","controllers/rest_form/alerts/alert","controllers/rest_form/alerts/alerts","controllers/rest_form/alerts/confirm_alert_subscription","controllers/rest_form/authentication/confirm_email","controllers/rest_form/authentication/popups/popup_allow_authorization","controllers/rest_form/authentication/reset_password","controllers/rest_form/basic_setup/basic_setup","controllers/rest_form/data_set/data_set","controllers/rest_form/data_set/data_sets","controllers/rest_form/dev/all_users_application","controllers/rest_form/dev/code_insights","controllers/rest_form/dev/light_generic","controllers/rest_form/dev/phantomjs_metrics","controllers/rest_form/documents_import/documents_import","controllers/rest_form/events/event","controllers/rest_form/events/events","controllers/rest_form/mailing_lists/mailing_list","controllers/rest_form/mailing_lists/mailing_lists","controllers/rest_form/page/snapshot","controllers/rest_form/pages_monitoring/pages_monitoring","controllers/rest_form/project_views/project_views","controllers/rest_form/project_views/view/view_sharing","controllers/rest_form/projects/turn_off_notifications","controllers/rest_form/results/rule/ai_results_rules","controllers/rest_form/results/rule/ai_rule_edition","controllers/rest_form/results/rule/ai_rule_training","controllers/rest_form/results/rule/result_rule","controllers/rest_form/results/rule/results_rules","controllers/rest_form/sentiment/sentiment_settings","controllers/rest_form/shared/entities/edit/shared_entities","controllers/rest_form/shared/entities/group/shared_entities_group","controllers/rest_form/shared/entities/edit/account_governance","controllers/rest_form/shared/share","controllers/rest_form/shared/shares","controllers/rest_form/sign_up/sign_up","controllers/rest_form/sma/sma_management","controllers/rest_form/socialmedia_token/socialmedia_token","controllers/rest_form/source_panels/source_panel","controllers/rest_form/source_panels/source_panels","controllers/rest_form/tag_cloud_panels/tag_cloud_panel","controllers/rest_form/tag_cloud_panels/tag_cloud_panels","controllers/rest_form/tags/tags_management","controllers/rest_form/token_request/token_request","controllers/rest_form/topics/topics_categories","controllers/rest_form/unsubscribe/unsubscribe_user","controllers/rest_form/influencer_mgmt/setup/influencers_setup","controllers/rest_form/influencer_mgmt/influencers_settings/influencers_settings","controllers/rest_form/scoring_engine/scoring_engine"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q,V,z,Y,X,K,Q){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_restForm",[]).controller("AccountSelectionController",n.default).controller("alertController",s.default).controller("alertsController",o.default).controller("confirmAlertSubscriptionController",r.default).controller("confirmEmailController",a.default).controller("popupAllowAuthoritationController",c.default).controller("resetPasswordController",l.default).controller("basicSetupController",d.default).controller("dataSetController",g.default).controller("dataSetsController",u.default).controller("allUsersApplicationController",p.default).controller("codeInsightsController",h.default).controller("lightGenericController",m.default).controller("phantomJsMetricsController",_.default).controller("importDocumentsController",f.default).controller("eventController",y.default).controller("eventsController",v.default).controller("mailingListController",S.default).controller("mailingListsController",b.default).controller("snapshotController",w.default).controller("pagesMonitoringController",C.default).controller("projectViewsController",E.default).controller("bookmarkSharingController",T.default).controller("turnOffNotificationsController",M.default).controller("aiResultsRulesController",P.default).controller("aiRuleEditionController",D.default).controller("aiRuleTrainingController",A.default).controller("resultRuleController",I.default).controller("resultsRulesController",x.default).controller("sentimentSettingsController",R.default).controller("sharedEntitiesEditController",F.default).controller("sharedEntitiesGroupController",O.default).controller("accountGovernanceController",k.default).controller("shareController",N.default).controller("sharesController",L.default).controller("registrationController",B.default).controller("socialMediaAccountController",W.default).controller("socialmediaTokenController",U.default).controller("sourcePanelController",G.default).controller("sourcePanelsController",$.default).controller("tagCloudPanelController",j.default).controller("tagCloudPanelsController",H.default).controller("tagsManagementController",q.default).controller("tokenRequestController",V.default).controller("topicsCategoriesController",z.default).controller("unsubscribeUserController",Y.default).controller("influencersSetupController",X.default).controller("influencersSettingsController",K.default).controller("scoringEngineController",Q.default)}),define("entry_point/configurations/angular_configuration/angular_modules/components_settings",["require","exports","angular","controllers/rest_form/branding/branding_settings","controllers/rest_form/document_template/document_template","controllers/rest_form/projects/general_settings","controllers/rest_form/projects/restricted_settings","controllers/rest_form/rebuild/rebuild","controllers/rest_form/saml/saml_settings","controllers/rest_form/users/general_settings","controllers/rest_form/users/groups/user_group_settings","controllers/rest_form/users/groups/user_groups_settings","controllers/rest_form/users/login_settings","controllers/rest_form/users/user_api_settings","controllers/rest_form/users/user_api_settings_access_token","controllers/rest_form/users/user_edition","controllers/rest_form/users/users_management","controllers/rest_form/audit_logs/audit_logs","controllers/settings"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_settings",[]).controller("brandingSettingsController",n.default).controller("documentTemplateController",s.default).controller("projectGeneralSettingsController",o.default).controller("projectRestrictedSettingsController",r.default).controller("rebuildController",a.default).controller("samlSettingsController",c.default).controller("userGeneralSettingsController",l.default).controller("userGroupSettingsController",d.default).controller("userGroupsSettingsController",g.default).controller("loginSettingsController",u.default).controller("apiSettingsController",p.default).controller("apiAccessTokenController",h.default).controller("userEditionController",m.default).controller("usersManagementController",_.default).controller("auditLogsController",f.default).controller("settingsController",y.default)}),define("entry_point/configurations/angular_configuration/angular_modules/components_to_be_split",["require","exports","angular","services/commons","services/text","services/topic_entry_loader"],function(e,t,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_toBeSplit",[]).service("commons",n.default).service("textService",s.default).service("topicEntryLoaderService",o.default)}),define("ui_components/accordeon/directive",["require","exports","underscore","services/template_source"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$attrs","$window"],{templateUrl:n.templateSourceFactory("ui_components/accordeon"),replace:!0,restrict:"A",scope:{model:"=",flatMode:"=?"},controller:e};function e(e,t,n){e.getStateIconNormal=function(e){return e.state_icons.normal},e.getStateIconSelected=function(e){return i.isUndefined(e.state_icons.selected)?i.isUndefined(e.state_icons.normal)?"":e.state_icons.normal:e.state_icons.selected},e.toggleShowMore=function(){e.showMore=!e.showMore},e.isSelected=function(t){return!e.flatMode&&t.selected},e.canShowMore=function(){return!i.isUndefined(e.model.content)&&!e.model.content.show_all_content&&e.model.content.root_entry.children.length>e.maxCategories},e.selectOrRedirect=function(t){i.isUndefined(t.url)?function(t){i.isUndefined(t.url)&&(t.selected||function e(t){i.each(t.children,function(t){t.selected=!1,e(t)})}(e.model.content.root_entry),t.selected=!t.selected)}(t):n.location=t.url},e.getUrl=function(e){return i.isUndefined(e.url)?"#":e.url},e.canShowCategory=function(t){return e.model.content.show_all_content||t<e.maxCategories||e.showMore},function(){i.isUndefined(t.flatMode)&&(e.flatMode=!1);e.showMore=!1,e.maxCategories=8}()}}}),define("ui_components/button/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:i.templateSourceFactory("ui_components/button"),replace:!0,restrict:"E",transclude:!0,scope:{icon:"@?"}}}}),define("ui_components/button_group/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:i.templateSourceFactory("ui_components/button_group"),replace:!0,restrict:"E",transclude:!0,scope:{}}}}),define("ui_components/button_spacer/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:i.templateSourceFactory("ui_components/button_spacer"),replace:!0,restrict:"E",scope:{}}}}),define("ui_components/floating_content/blocks/block/directive",["require","exports","services/tw_routing","services/configuration","services/bubble_dialog","angular_utilities","graphics_utilities","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:a.templateSourceFactory("ui_components/floating_content/blocks/block"),replace:!0,restrict:"A",bindToController:{model:"=",styleType:"=?"},scope:{},controllerAs:"vm",controller:c}};let c=class{constructor(e,t){this.$window=e,this.$element=t}$onInit(){this.setIconColor(),this.setHoverStyles(),this.setBorderStyles()}getBorderStyle(){return _.isUndefined(this.styleType)?"border-styles":""}getHoverStyle(){return _.isUndefined(this.styleType)||this.styleType!==constants.floating_content_structure.type.colored_section_block?"":"hover-styles"}getBaseStyleClass(){switch(this.styleType){case constants.floating_content_structure.type.colored_section_block:return"colored-section-block";default:return"colored-section-header"}}goTo(e,t){if(t.preventDefault(),this.model.isClickActionUrl())_.isUndefined(this.styleType)||this.styleType!==constants.floating_content_structure.type.colored_section_block||i.twRoutingService.changePageByUrl(e);else if(this.model.isClickActionBubbleDialog()){const e=n.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.contact_form);e.setAbsoluteY(this.$window.pageYOffset+50);const t=this.model.getMappedId();s.bubbleDialogService.destroyById(t),s.bubbleDialogService.createRFormBubble(t,$(".page__content"),{src:{rform:this.model.getUrl(!1)}},e,{})}}setIconColor(){this.$element.find(".block-icon").css({backgroundColor:this.model.getColor()})}setHoverStyles(){_.isUndefined(this.styleType)||this.styleType!==constants.floating_content_structure.type.colored_section_block||this.$element.hover(this.setMouseEnterStyles.bind(this),this.setMouseLeaveStyles.bind(this))}setMouseEnterStyles(){this.$element.find(".hover-styles").css({backgroundColor:this.model.getColor()}),this.$element.find(".block-icon").css({color:this.model.getColor()})}setMouseLeaveStyles(){this.$element.find(".hover-styles").css({backgroundColor:""}),this.$element.find(".block-icon").css({color:""})}setBorderStyles(){_.isUndefined(this.styleType)&&this.$element.find(".border-styles").css({borderTopColor:r.Color.fromHex(this.model.getColor()).setOpacity(.4).toRGBA()})}};c=__decorate([o.ngInject(["$window","$element"]),__metadata("design:paramtypes",[Object,Object])],c),t.FloatingContentBlockController=c}),define("ui_components/floating_content/blocks/directive",["require","exports","angular_utilities","classes/floating_content/floating_content_structure","services/template_source"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:s.templateSourceFactory("ui_components/floating_content/blocks"),replace:!0,restrict:"A",bindToController:{model:"=",styleType:"=?"},scope:{},controller:o,controllerAs:"vm"}};let o=class{constructor(e){this.$scope=e}$onInit(){this.init()}getStateIconNormal(e){return e.toProto().state_icons.normal}init(){this.model.setStyleType(this.styleType),this.internalSectionTypes=n.FloatingContentStructure.internalSectionType}};o=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],o),t.Controller=o}),define("ui_components/floating_content/directive",["require","exports","angular_utilities","services/broker","classes/floating_content/floating_content_structure","services/tw_routing","event_bus","services/template_source"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{templateUrl:a.templateSourceFactory("ui_components/floating_content"),replace:!0,restrict:"A",bindToController:{model:"=",styleType:"=?",draggableStrategy:"=?",deleteOptions:"=?",editOptions:"=?"},scope:{},controllerAs:"vm",controller:c}};let c=class{constructor(e){this.$scope=e,this.internalSectionTypes=s.FloatingContentStructure.internalSectionType}$onInit(){this.setupDraggableStrategy(),this.setupEvents()}getActionsMenu(e){const t=[];return e.getActions().forEach(e=>{const i={icon:e.icon,actionPayload:e,eventType:this.getEventType(e)};t.push(i)}),{menuButtonIcon:"icon-tw-ellipsis",items:t}}getEventType(e){switch(e.action_type){case"copy_report":return r.EVENT_TYPES.COPY_REPORT;case"delete_report":return r.EVENT_TYPES.DELETE_REPORT;case"get_url":return r.EVENT_TYPES.DOWNLOAD_REPORT;case"send_report":return r.EVENT_TYPES.SEND_REPORT}}setupDraggableStrategy(){_.isUndefined(this.draggableStrategy)||(this.draggableStrategy.setFloatingContentStructure(this.model),this.draggableStrategy.setDropzoneConfig("[special-dropzone]",(e,t)=>!t.isClickActionToggle()&&-1===e.scope.model.children.indexOf(t)))}setupEvents(){const e=n.brokerService.subscribe(constants.floating_content.category.close,e=>{e.isSelected()&&this.toggleCategory(e)}),t=n.brokerService.subscribe(constants.floating_content.entry.remove,e=>{this.removeEntryFromModel(e)});this.$scope.$on("$destroy",()=>{n.brokerService.unsubscribe(constants.floating_content.category.close,e),n.brokerService.unsubscribe(constants.floating_content.entry.remove,t)})}canShowMoreDetailsButton(){return this.isContentLoaded()&&this.model.canShowMore(this.model.getUncategorizedEntries())&&!this.model.isShowMore(s.FloatingContentStructure.internalSectionType.UNCATEGORIZED_ENTRIES)}canShowLessDetailsButton(){return this.isContentLoaded()&&this.model.canShowMore(this.model.getUncategorizedEntries())&&this.model.isShowMore(s.FloatingContentStructure.internalSectionType.UNCATEGORIZED_ENTRIES)}isContentLoaded(){return this.model.hasContent()&&this.model.isLoaded()}hasCategories(){return this.model.getCategories().length>0}canShowCategoryRows(){return this.isContentLoaded()&&void 0!==this.model.getRows(this.model.getCategories())}canShowSingleCategoryRow(e){return this.model.canShowRow(e,s.FloatingContentStructure.internalSectionType.CATEGORIES)}canShowSingleRow(e){return this.model.canShowRow(e,s.FloatingContentStructure.internalSectionType.UNCATEGORIZED_ENTRIES)}preventFocus(e){e.preventDefault()}goTo(e,t){t.preventDefault(),this.isColoredSectionBlockStyle()&&o.twRoutingService.changePageByUrl(e)}getHoverStyle(e){return this.isColoredSectionBlockStyle()&&void 0!==e.getMappedId()?"hover-styles":""}setMouseEnterStyles(e,t){const i=this.findHoverStylesElement($(t.target));i.css({backgroundColor:e.getColor()}),i.find(".block-icon").css({color:e.getColor()})}setMouseLeaveStyles(e){const t=this.findHoverStylesElement($(e.target));t.css({backgroundColor:""}),t.find(".block-icon").css({color:""})}toggleCategory(e,t){if(_.isUndefined(t)||t.preventDefault(),e.isSelected())return e.toggleSelection(),void(this.selectedCategory=void 0);_.isUndefined(this.selectedCategory)||this.selectedCategory.toggleSelection(),e.toggleSelection(),this.selectedCategory=e}removeEntry(e,t){t.preventDefault(),t.stopPropagation(),this.deleteOptions.onClick(e).then(()=>{this.removeEntryFromModel(e)},()=>void 0)}removeEntryFromModel(e){this.model.getContent().removeEntry(e),e===this.selectedCategory&&(this.selectedCategory=void 0)}editEntry(e,t){t.preventDefault(),t.stopPropagation(),this.editOptions.onClick(e)}isSelectedCategoryInRow(e){return!_.isUndefined(this.selectedCategory)&&_.contains(this.model.getRowEntries(e,this.model.getCategories()),this.selectedCategory)}isColoredSectionBlockStyle(){return void 0!==this.styleType&&this.styleType===constants.floating_content_structure.type.colored_section_block}findHoverStylesElement(e){let t=e.find(".hover-styles");return 0===t.length&&(t=e.closest(".hover-styles")),t}};c=__decorate([i.ngInject(["$scope"]),__metadata("design:paramtypes",[Object])],c),t.FloatingContentController=c}),define("ui_components/img_fallback/directive",["require","exports","angular"],function(e,t,i){function n(){return{replace:!1,restrict:"A",link:function(e,t,n){function s(){i.element(this).attr("src",n.fallback),"true"===n.fallbackRemove&&t.addClass("hidden"),o()}function o(){"true"!==n.fallbackKeepChecking&&(t.off("load",o),t.off("error",s))}t.bind("error",s),t.bind("load",function(){t.removeClass("hidden"),o()}),e.$on("$destroy",()=>o)}}}Object.defineProperty(t,"__esModule",{value:!0}),n.$inject=[],t.BarsDirective=n,t.default=n}),define("ui_components/link_descriptions/directive",["require","exports","services/template_source"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return e.$inject=["$scope","$window"],{templateUrl:i.templateSourceFactory("ui_components/link_descriptions"),replace:!0,restrict:"A",scope:{model:"="},controller:e};function e(e,t){e.goTo=function(e){t.location.href=e}}}}),define("ui_components/popover/directive",["require","exports","underscore","classes/context_data/context_data"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["$timeout",function(e){return t.$inject=["$scope","$element","$attrs","$transclude","$window","logService"],{replace:!1,transclude:!1,restrict:"A",controller:t};function t(e,t,s,o,r,a){function c(e,t){return e.split(".").reduce(function(e,i){return void 0===e[i]?t:e[i]},r)}a.deprecated("tw-popover","bubbleDialogService.createMessage"),s.popoverEnable=void 0!==s.popoverEnable?s.popoverEnable:n.contextData.userSettings.tooltips,s.popoverEnable=!0,s.popoverEnable&&(s.popoverContent=void 0!==s.popoverVariableContent?c(s.popoverVariableContent):s.popoverContent,s.popoverTitle=void 0!==s.popoverVariableTitle?c(s.popoverVariableTitle):s.popoverTitle,e.$evalAsync(function(){t.popover({animation:!0,title:s.popoverTitle,content:s.popoverContent,delay:{show:600,hide:100},html:!0,placement:i.isUndefined(s.popoverPlacement)?"auto":s.popoverPlacement,trigger:i.isUndefined(s.popoverTrigger)?"hover":s.popoverTrigger})}))}}]}),define("entry_point/configurations/angular_configuration/angular_modules/components_ui",["require","exports","angular","ui_components/accordeon/directive","ui_components/button/directive","ui_components/button_group/directive","ui_components/button_spacer/directive","ui_components/floating_content/blocks/block/directive","ui_components/floating_content/blocks/directive","ui_components/floating_content/directive","ui_components/img_fallback/directive","ui_components/link_descriptions/directive","ui_components/popover/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_ui",[]).directive("twAccordeon",n.default).directive("twButton",s.default).directive("twButtonGroup",o.default).directive("twButtonSpacer",r.default).directive("twFloatingContentBlock",a.default).directive("twFloatingContentBlocks",c.default).directive("twFloatingContent",l.default).directive("fallback",d.default).directive("twLinkDescriptions",g.default).directive("twPopover",u.default)}),define("react_components/bubble_dialogs/components/interfaces/ai_rule_change_category_dialog_props",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("react_components/bubble_dialogs/components/ai_rule_change_category_dialog",["require","exports","event_bus","flux","react","reusable_utilities","classes/application/application","classes/context_data/context_data","services/rest_form_service"],function(e,t,i,n,s,o,r,a,c){Object.defineProperty(t,"__esModule",{value:!0});class l extends n.BaseComponent{render(){return s.createElement("div",{className:"ai-rule-metric-bubble"},s.createElement("h5",null," ",a.contextData.getMessage("_1654321")),this.generateChoices())}generateChoices(){return s.createElement("div",{className:"ai-rule-metric-bubble-choices"},this.props.payload.value.match.categories.map(e=>{const t=e.selected?"ai-rule-metric-bubble-choice clickable selected-category":"ai-rule-metric-bubble-choice clickable";return s.createElement("div",{className:"ai-rule-metric-bubble-choice-container",key:e.label},s.createElement("span",{className:t,onClick:()=>this.handleChoiceClick(e)},e.label))}))}async handleChoiceClick(e){const{update_endpoint:t,entry_id:n,routing_ts:s}=this.props.payload.value.match;c.restFormService.post(t,{selected_choice:e,entry_id:n,routing_ts:s}).then(async()=>{const e=r.mainApplication.getPageState(),t=[this.props.payload.value.entryId],n=await c.restFormService.postRForm("article_fetching","search",{entry_ids:t,fetch_raw_articles:!0,input_page_state:e.toProto()}),s=n.raw_articles&&n.raw_articles[0]?n.raw_articles[0]:void 0;if(void 0===s)throw new Error("New fetched article is undefined");s.timeStamp=Date.now(),i.eventBus.dispatch({type:i.EVENT_TYPES.SINGLE_ARTICLE_TO_UPDATE,value:s}),this.props.destroy()},()=>{})}clickInside(){}clickOutside(e){e.preventDefault(),this.props.destroy()}}t.AiRuleChangeCategoryDialog=l,o.applyMixins(l,[n.DocumentClickTracker])}),define("react_components/articles/articles_video_player_bubble",["require","exports","flux","react","reusable_utilities","video_player","event_bus","classes/context_data/context_data"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});class c extends i.BaseComponent{constructor(e){super(e),this.state={valid:void 0}}render(){const{videoUrl:e,annotations:t,boundingBoxIndicators:i,title:s,initiallyMute:r}=this.props.payload;return n.createElement("div",{className:"tw-bubble-dialog-articles_video_player",onKeyDown:e=>{27===e.keyCode&&this.props.destroy()},tabIndex:-1},n.createElement("div",{className:"header"},n.createElement("h2",null,void 0!==s.url&&s.url.length>0?n.createElement(n.Fragment,null,n.createElement("a",{target:"_blank",href:s.url},s.name),n.createElement("span",{style:{fontSize:"0.8em"}},a.contextData.getMessage("share_post_type_video"))):n.createElement("span",{style:{fontSize:"0.8em"}},s.name+" "+a.contextData.getMessage("share_post_type_video")),n.createElement("button",{className:"close",onClick:this.clickOutside.bind(this)},"×"))),void 0!==this.state.valid?this.state.valid?n.createElement("div",{className:"body",style:{flexFlow:"column"}},n.createElement(o.VideoPlayerComponent,{videoUrl:e,annotations:t,boundingBoxIndicators:i,initiallyMute:r,debuggingMode:a.contextData.isFeatureEnabled("DATA_SCIENCE_DEBUG_INFO"),ffmpegScript:this.props.payload.ffmpegScript,reportButtonTooltip:a.contextData.getMessage("_2222554"),articleUrl:this.props.payload.articleUrl,reportButtonLabel:a.contextData.getMessage("_2992334"),cancelReportButtonLabel:a.contextData.getMessage("_2334111"),cacheInfoKey:this.props.payload.cacheInfoKey}),this.renderColorLegend()):n.createElement("div",{style:{margin:"20px"}},a.contextData.getMessage("_2312523")):void 0)}isVideoUrlValid(){const e=document.createElement("video");e.ondurationchange=(()=>{this.setState({valid:!0}),e.ondurationchange=void 0,e.onerror=void 0}),e.onerror=(()=>{this.setState({valid:!1}),e.ondurationchange=void 0,e.onerror=void 0}),e.src=this.props.payload.videoUrl}renderColorLegend(){return n.createElement("div",{style:{display:"flex"}},this.props.payload.colorMap.map(e=>n.createElement("div",{key:e.color+e.title,style:{marginTop:"8px",display:"flex",alignItems:"center",fontSize:"0.9em",marginRight:"15px",cursor:"pointer"},onClick:t=>this.jumpToTimestamp(e.timestamp),onMouseEnter:e=>this.openTooltip(e,a.contextData.getMessage("_2568165")),onMouseLeave:()=>this.closeTooltip()},n.createElement("span",{style:this.getColorStyle("#"+e.color)}),n.createElement("span",null,e.title))))}getColorStyle(e){return{width:13,height:4,minWidth:13,minHeight:4,backgroundColor:e,display:"inline-block",marginRight:"5px"}}jumpToTimestamp(e){r.eventBus.dispatch({type:r.EVENT_TYPES.SET_VIDEO_PLAYER_TO_TIMESTAMP,value:e})}openTooltip(e,t){void 0!==t&&r.eventBus.dispatch({type:r.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){r.eventBus.dispatch({type:r.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}clickInside(e){}clickOutside(e){e.preventDefault(),this.props.destroy()}componentDidMount(){this.isVideoUrlValid()}}t.ArticlesVideoPlayerBubble=c,s.applyMixins(c,[i.DocumentClickTracker])}),define("react_components/articles/articles_widget_container",["require","exports","articles","event_bus","flux","notifications","react","classes/context_data/context_data","react_components/bubble_dialogs/components/ai_rule_change_category_dialog","services/articles","services/bubble_dialog","services/configuration","services/rest_form_service","react_components/articles/articles_settings_factory","react_components/articles/articles_video_player_bubble"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});t.ArticlesWidgetContainer=class extends s.BaseComponent{render(){const{widget:e,fragment:t,mediator:n}=this.props;return r.createElement(i.ArticlesContainer,{widgetId:e.getId(),mediator:n,settings:p.ArticlesSettingsFactory.build(e,t,l.articlesService.getResizeInfo(e))})}componentDidMount(){this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SHOW_AI_RULE_CATEGORIES,this.onShowAiRuleCategories.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.ADDED_NEW_TAG,this.onAddedNewTag.bind(this)),this.cancellationToken.subscribeToStream(n.eventBus,n.EVENT_TYPES.SHOW_VIDEO_PLAYER,this.onShowVideoPlayer.bind(this))}onShowAiRuleCategories(e){void 0!==this.changeAiRuleBubble&&this.changeAiRuleBubble.destroy();const t=constants.bubble_dialog.id.ai_rule_change_category,i=g.configurationService.getBubbleDialogConfiguration().getStyle(t);this.changeAiRuleBubble=d.bubbleDialogService.createReactBubble(t,e.value.event.target,e,t=>(t.payload=e,r.createElement(c.AiRuleChangeCategoryDialog,{payload:t.payload,destroy:t.destroy})),i)}onShowVideoPlayer(e){const t=u.restFormService.get(e.value.endpointUrl);o.notificationService.warning(`<i class="fa fa-refresh fa-spin"></i>  ${a.contextData.getMessage("_2012452")}`,{permanent:!0,singleInstance:!0,closeOnResolve:t}),t.then(e=>{const t=constants.bubble_dialog.id.article_video_player,i=g.configurationService.getBubbleDialogConfiguration().getStyle(t),{url:n,occurences:s,indicators:o,author_info:a,color_list:c,ffmpeg_script:l}=e.video_annotations,u={videoUrl:n,annotations:{occurences:s},boundingBoxIndicators:o,title:a,colorMap:c,initiallyMute:e.muted,ffmpegScript:l,articleUrl:e.article_url,cacheInfoKey:e.cache_info_key};d.bubbleDialogService.createReactBubble(t,$("body"),u,e=>(e.payload=u,r.createElement(h.ArticlesVideoPlayerBubble,{payload:e.payload,destroy:e.destroy})),i,{preventOutsideClickActions:!0,fadeBackground:!0})})}onAddedNewTag(e){}}}),define("components/articles/directive",["require","exports","react","services/react_bridge_factory","react_components/articles/articles_widget_container"],function(e,t,i,n,s){return n.createReactBridge(e=>i.createElement(s.ArticlesWidgetContainer,{widget:e.widget,fragment:e.fragment,mediator:e.mediator}),{widget:"=",fragment:"=",mediator:"="})}),define("react_components/globe/globe_container",["require","exports","react","flux","globe","canvas_engine","classes/color_palette_builder/globe_color_palette_builder","services/theme","services/rest_form_service","other/tw","services/configuration","services/bubble_dialog","services/message_diffusion_service"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){Object.defineProperty(t,"__esModule",{value:!0});const p=routes.controllers.tw.TWRestForm;t.GlobeContainer=class extends n.BaseComponent{constructor(e){super(e),this.state={dimensions:e.fragment.getDrawSettings().dimensions,palette:this.generateColorPalette()}}render(){const{palette:e,dimensions:t}=this.state,{mediator:n,fragment:o}=this.props,r=this.generatePluginList();return i.createElement(s.GlobeComponent,{dimensions:t,palette:e,mediator:n,plugins:r,timeline:this.getTimeline(),scale:o.getDrawSettings().style.resolutionScale,cancellationToken:o.cancellationToken})}getTimeline(){const{widget:e}=this.props;return e.hasReplayManager()?e.getReplayManager().getTimeline():void 0}generatePluginList(){const{widget:e}=this.props;return e.isMessageDiffusion()?this.generateMessageDiffusionPluginList():this.generateArticlePluginList()}generateMessageDiffusionPluginList(){const{widget:e}=this.props;return Object.assign({},s.defaultGlobeComponentPlugins,{arcs:{enabled:e.isMessageDiffusion(),requireCanvasEngine:!0,model:e.isMessageDiffusion()?e.getPayloadValue():void 0,playInitialAnimation:!e.hasReplayManager(),callbacks:this.createArcNodeCallbacks()},navigation:{enabled:!0,autoRotation:{enabled:!0,direction:[1,0],fps:60,speed:0},centerOn:{duration:500,delay:500}}})}generateArticlePluginList(){return Object.assign({},s.defaultGlobeComponentPlugins,{places:{enabled:!1,loader:this.fetchPopulatedCities.bind(this,this.props),style:s.defaultGlobeComponentPlugins.places.style}})}fetchPopulatedCities(e){const{pageState:t,widget:i}=e,n=(t||i.getPageState()).clone();n.clearWidgetsByPredicate(e=>e.getId()!==i.getId());const s={page_state:n.toProto(),count:15};return c.restFormService.post(p.post("project",l.tw.project_id,"city_distribution","search",0,"rform").url,s).then(e=>this.createPlaceInfoArray(e.distribution))}createPlaceInfoArray(e){return e.map(e=>({coordinates:[parseFloat(e.coordinates.longitude),parseFloat(e.coordinates.latitude)],name:e.label,count:e.count}))}componentDidMount(){const{widget:e}=this.props;this.cancellationToken.subscribe(e.onRedraw,()=>{if(!this.isUnmounted){const{fragment:e}=this.props,{dimensions:t}=e.getDrawSettings(),i=this.generateColorPalette();this.setState({palette:i,dimensions:t})}})}generateColorPalette(){return new r.GlobeColorPaletteBuilder(a.themeService.getCurrentThemeId()).build()}createArcNodeCallbacks(){const{widget:e}=this.props;return{onClick:(t,i)=>{u.messageDiffusionService.clickAction(t,e,i)},onMouseEnter:(e,t,i)=>{this.createNodePopover(e,t,i)},onMouseLeave:()=>{this.destroyNodePopover()}}}createNodePopover(e,t,i){const n=d.configurationService.getBubbleDialogConfiguration().getStyle(constants.bubble_dialog.id.message_diffusion);n.setAbsoluteX(t.getX()),n.setAbsoluteY(t.getY()),o.ObjectCache.recycleObject(t),g.bubbleDialogService.createByType(constants.bubble_dialog.id.message_diffusion,i,"message-diffusion",{results:e.getClusterSize(),label:e.getLocation().label},n)}destroyNodePopover(){g.bubbleDialogService.destroyById(constants.bubble_dialog.id.message_diffusion)}}}),define("components/globe/directive",["require","exports","react","react_components/globe/globe_container","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.GlobeContainer,{widget:e.widget,fragment:e.fragment,mediator:e.mediator}),{widget:"=",fragment:"=",mediator:"="})}),define("components/source_actions_panel/directive",["require","exports","react","reusable_components","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.SourceActionsPanel,{widgetId:e.widgetId,sources:e.sources,authors:e.authors,panels_groups:e.panelsGroups,monitoredSites:e.monitoredSites}),{widgetId:"=",sources:"=",authors:"=",panelsGroups:"=",monitoredSites:"="},{replace:!0,template:'<ul class="list-unstyled" />'})}),define("entry_point/configurations/angular_configuration/angular_modules/components_widgets_1",["require","exports","angular","components/activity/directive","components/articles/directive","components/bars/directive","components/composed/directive","components/data_table/directive","components/gender/directive","components/globe/directive","components/influencer/card/directive","components/influencer/directive","components/influencer/list/directive","components/influencer/list_widget/directive","components/influencer/overview/directive","components/influencer/table/directive","components/kpi/directive","components/source_actions_panel/directive","components/text_entry/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_widgets1",[]).directive("twActivity",n.default).directive("twArticles",s).directive("twBars",o.default).directive("twComposed",r.default).directive("twDataTable",a.default).directive("twGender",c.default).directive("twGlobe",l).directive("twInfluencerCard",d.default).directive("twInfluencer",g.default).directive("twInfluencerList",u.default).directive("twInfluencerListWidget",p.default).directive("twInfluencerOverview",h.default).directive("twInfluencerTable",m.default).directive("twKpi",_.default).directive("twSourceActionsPanel",f).directive("twTextEntry",y.default)}),define("components/button/directive",["require","exports","react","reusable_components","services/react_bridge_factory"],function(e,t,i,n,s){return s.createReactBridge(e=>i.createElement(n.DropdownButton,{topicMenu:e.topicMenu.toProto(),buttonClass:e.buttonClass,alignRight:e.alignRight,onClick:e.onClick}),{topicMenu:"=",onClick:"=",buttonClass:"=",alignRight:"="})}),define("services/store_logic/text_editor_store",["require","exports","flux","reusable_utilities","text_editor","components/text/text_editor_query","other/tw","services/rest_form_service","services/text","classes/application/application","classes/refresh/model_type","services/tw_common","classes/refresh/model_refresh_strategy","services/refresh/model_refresh_service","classes/refresh/model_refresh_decorator_factory","log","services/context"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,f){Object.defineProperty(t,"__esModule",{value:!0});class y extends i.BaseStore{constructor(){super([s.TextEditorActions,"widget_onResize","textEditor_onImageLoaded"])}static getInstance(){return y.instance}onEdit(e){this.onChange.fire({widgetId:e.widgetId,edit:!0})}onImageLoaded(e){this.onChange.fire({widgetId:e.widgetId})}onResize(e){const{dic:t}=e;if(t.payload.type!==constants.payload_type.payload_text)return;const i=e.dic.menu.text_widget_layout_menu,r=n.TopicMenuUtils.getFirstSelectedEntry(i);o.isTextLayoutAvailable(r,e.dic.width)||n.TopicEntryUtils.recursiveUnselectAndSelect(i.root_entry,s.layoutResizeSwapMap[r.mapped_id]),this.onChange.fire({widgetId:e.dic.widget_id})}onSaveLayout(e){const t=e.query.execute(),i=t.storeQueries.getWidget(),s=t.storeQueries.getPayload();t.storeQueries.setLayout(i,e.layout);const o=routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"text_widget","update","","rform").url;let c;s.content_url&&new n.Url(s.content_url).isDataURL()&&(c=new n.Url(s.content_url).getBase64(),delete s.content_url);const l={image_attachment:c,data_input_configuration:i,custom_page_id:r.tw.pageState.getAllowedPages().getCustomPageId(),custom_page_type:r.tw.pageState.getAllowedPages().getCustomPageType(),id:i.widget_id};a.restFormService.postMultipart(o,l)}onSave(e){const t=e.query.execute(),i=t.storeQueries.getPayload();let s;t.storeQueries.reset(i),t.storeQueries.applyChanges(i,e.changes),i.content_url&&new n.Url(i.content_url).isDataURL()&&(s=i.content_url.substring(i.content_url.indexOf("base64,")+7),delete i.content_url),t.storeQueries.persist(i);const o=t.storeQueries.getWidget();t.storeQueries.setLayout(o,e.layout);const c=routes.controllers.tw.TWRestForm.post(f.contextService.getCurrentContext().scope,f.contextService.getCurrentContext().id,"text_widget","update","","rform").url,g={image_attachment:s,data_input_configuration:o,custom_page_id:r.tw.pageState.getAllowedPages().getCustomPageId(),custom_page_type:r.tw.pageState.getAllowedPages().getCustomPageType(),id:o.widget_id};a.restFormService.postMultipart(c,g).then(e=>{const i=this.findWidgetById(o.widget_id);if(void 0!==i)i.prepareReload(),this.refreshWidgetData(i);else{const i=JSON.parse(o.payload.value),n=JSON.parse(e.data_input_configuration.payload.value);i.display_headline=n.display_headline,i.display_text=n.display_text,void 0!==e.image_id&&(o.payload.image_id=e.image_id),o.payload.value=JSON.stringify(i),t.storeQueries.getWidgetWrapper().redraw();const s={strategy:u.ModelRefreshStrategy.REFRESH},r=h.modelRefreshDecoratorFactory.getDecorator(l.mainApplication.getPageState(),l.mainApplication,d.ModelType.PAGE_STATE,s);p.modelRefreshService.refresh(r,s).then(()=>void 0,()=>void 0)}})}findWidgetById(e){const t=l.mainApplication.getWidgetById(e);if(!t||t.getPageState().getAllowedPages().isCommandCenterScreenEditMode()){const t=l.mainApplication.getSubApplications();return _.chain(t).map(t=>t.getWidgetById(e)).flatten().first().value()}return t}onDelete(e){const t=e.query.execute().storeQueries.getWidget(),i=l.mainApplication.getPageState().getAllowedPages().getCustomPageType();c.textService.removeTextWidget(t,i,l.mainApplication.getPageState())}async refreshWidgetData(e){if(e.hasPageState()&&e.getPageState().getApplication()){const t={strategy:u.ModelRefreshStrategy.REFRESH},i=h.modelRefreshDecoratorFactory.getDecorator(e.getPageState(),e.getApplication(),d.ModelType.WIDGET,t);try{return await p.modelRefreshService.refresh(i,t)}catch(e){e instanceof Error&&m.logService.error("Error when refreshing widget!",void 0,e)}}else m.logService.error("reload attempted on widget without page state, this could be due to a memory leak",g.twCommon.logFeatures.WidgetWrapper)}}y.instance=new y,t.TextEditorStore=y}),define("react_components/text_editor/text_editor_container",["require","exports","event","flux","react","text_editor","services/store_logic/text_editor_store"],function(e,t,i,n,s,o,r){Object.defineProperty(t,"__esModule",{value:!0});t.TextEditorContainer=class extends n.BaseComponent{constructor(e){super(e),this.forceRender=0,this.state={drawSettings:e.drawSettings},this.onEdit=new i.Event}componentDidMount(){this.cancellationToken.subscribe(r.TextEditorStore.getInstance().onChange,e=>{const t=this.props.query.execute();t.id===e.widgetId&&e.edit?this.onEdit.fire(!0):t.id===e.widgetId&&(this.forceRender++,this.forceUpdate())})}render(){const{props:{query:e,rootElement:t,fragment:i},state:{drawSettings:n}}=this;return s.createElement(o.TextEditor,{query:e,onEdit:this.onEdit,drawSettings:n,forceRender:this.forceRender,rootElement:t,fragment:i})}}}),define("components/text/directive",["require","exports","react","react_components/text_editor/text_editor_container","services/react_bridge_factory","components/text/text_editor_query"],function(e,t,i,n,s,o){return s.createReactBridge((e,t)=>i.createElement(n.TextEditorContainer,{query:o.textEditorQuery(e),fragment:e.fragment,drawSettings:e.drawSettings,rootElement:t}),{widget:"=",fragment:"=",drawSettings:"="})}),define("react_components/treemap/treemap_query",["require","exports","query_system","queries/application_queries"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.treemapQuery=(e=>{const t=s(e),n=o(t),g=r(n),u=a(n);return new i.Query({widget:t,payload:n,actionsEnabled:c,popoverAllowed:l,widgetClickable:d(e,g,u)})});const s=e=>[new i.ProviderQuery(()=>e.widget.toProto()),new i.TransformationQuery(e=>e())],o=e=>[...e,new i.TransformationQuery(e=>JSON.parse(e.payload.value))],r=e=>[...e,"data_graph"],a=e=>[...e,"articles"],c=i.queryAnd([...n.queryApplicationGetMainPageState,"allowed_pages","group_page",new i.TransformationQuery(e=>e!==constants.group_page.search)],[new i.ProviderQuery(window),"isExport",i.queryNegate]),l=[...n.queryApplicationGetMainPageState,"allowed_pages","page_type",new i.TransformationQuery(e=>e!==constants.page_type.id_overview)],d=(e,t,s)=>{const o=g(t),r=(e=>new i.ForkQuery([...e,new i.TransformationQuery(e=>void 0!==e)],{false:new i.ProviderQuery(!1),true:new i.ProviderQuery(!0)}))(s);return new i.ForkQuery(o,{false:new i.ForkQuery(r,{false:new i.ProviderQuery(!1),true:new i.ProviderQuery(!0)}),true:i.queryAnd([...t,"clickable",new i.TransformationQuery(e=>!0===e)],[...n.queryApplicationGetMainPageState,"allowed_pages","group_page",new i.TransformationQuery(e=>e!==constants.group_page.search)])})},g=e=>new i.ForkQuery([...e,new i.TransformationQuery(e=>void 0!==e)],{false:new i.ProviderQuery(!1),true:i.queryAnd([new i.ProviderQuery(!0)],[...e,"sample_data",new i.TransformationQuery(e=>!0===e)])})}),define("react_components/treemap/treemap_container",["require","exports","react","underscore","flux","reusable_components","treemap","classes/application/application"],function(e,t,i,n,s,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});t.TreemapContainer=class extends s.BaseComponent{constructor(e){super(e),this.widgetWrapper=a.mainApplication.getWidgetById(this.props.widgetId),this.rootIsZero=!1,this.state=this.initializeState(),this.props.fragment.attach(this,this.props.rootElement),this.props.mediator.listen("TREEMAP.EVENTS.LOADED",e=>{e&&this.fullyLoadedResolveFunc()}),this.props.fragment.cancellationToken.registerCleanupFunction(()=>{r.TreemapStore.getInstance().destroyBubbles()})}initializeState(e=!1){const t=this.props.query.execute();return{queryResult:t,rootNode:this.prepareTree(t),drawSettings:this.props.drawSettings}}redrawWidget(e){return new Promise((t,i)=>{this.setState(n.assign(this.initializeState(!0),{drawSettings:e})),this.fullyLoadedResolveFunc=t})}render(){return i.createElement("div",{className:"chart-container"},this.renderTreemapRenderable())}renderTreemapRenderable(){return i.createElement(r.TreemapRenderable,{queryResult:this.state.queryResult,rootNode:this.state.rootNode,drawSettings:this.state.drawSettings,widgetId:this.props.widgetId,mediator:this.props.mediator})}prepareTree(e){if(this.rootIsZero=!1,void 0!==e.payload.tree){const t={label:e.payload.tree.root.name,value:e.payload.tree.root.metric.value};return 0===t.value&&(this.rootIsZero=!0),void 0!==e.payload.tree.root.children&&this.prepareChildren(e.payload.tree.root.children,t,e,this.createNodeModelByThemeTreeNode.bind(this)),t}if(void 0!==e.payload.articles){const t={label:"",value:void 0!==e.payload.articles?e.payload.articles.reduce((e,t)=>e+t.metadata.proportion_value,0):0};return 0===t.value&&(this.rootIsZero=!0),void 0!==e.payload.articles&&this.prepareChildren(e.payload.articles,t,e,this.createNodeModelByArticle.bind(this)),t}}prepareChildren(e,t,i,s){void 0===t.children&&(t.children=[]),n.each(e,e=>{const n=s(e,i);void 0!==e.children&&this.prepareChildren(e.children,n,i,s),t.children.push(n)})}createNodeModelByThemeTreeNode(e,t){const i={action:o.ClickActionTypes.OPEN_CONTEXT_PAGE,page_type:t.payload.tree.root.requested_page_type,filter:e.filter},n={text:e.metric.label,value:""+e.metric.value,highlighted:!0,order:0},s=this.handleValue(e.metric.value);return{id:e.id,label:e.name,metric:n,value:this.rootIsZero?1:s,originalValue:e.metric.value,previousValue:e.metric.previous_value,clickAction:i,color:e.color}}createNodeModelByArticle(e){const t=e.image,i=this.handleValue(e.metadata.proportion_value);return{id:e.entry_id,label:void 0!==t?t.url:void 0,metric:e.primary_metrics[0],value:this.rootIsZero?1:i,originalValue:e.metadata.proportion_value,bounding_boxes:void 0!==t?t.bounding_boxes:void 0,clickAction:e.navigate_action}}handleValue(e){if(0!==e){let t=Math.log(e);return 0===t&&(t=.1),t}return.1}}}),define("components/tree_map/directive",["require","exports","services/react_bridge_factory","react","react_components/treemap/treemap_query","react_components/treemap/treemap_container"],function(e,t,i,n,s,o){return i.createReactBridge((e,t)=>{return e.widget.hasPayloadValue()&&(e.widget.getPayloadValue().tree&&void 0!==e.widget.getPayloadValue().tree.root||void 0!==e.widget.getPayloadValue().articles)?n.createElement(o.TreemapContainer,{query:s.treemapQuery(e),fragment:e.fragment,drawSettings:e.drawSettings,rootElement:t,widgetId:e.widget.getId(),mediator:e.mediator}):null},{widget:"=",fragment:"=",drawSettings:"=",mediator:"="},{classNames:"tw-treemap"})}),define("entry_point/configurations/angular_configuration/angular_modules/components_widgets_2",["require","exports","angular","components/animated_label/directive","components/command_center/block/directive","components/command_center/home/directive","components/command_center/home/screen/directive","components/command_center/home/screens/directive","components/edit_mode/command_center/directive","components/edit_mode/command_center_screen/directive","components/edit_mode/topic_setup/screen/directive","components/edit_mode/web_connector/ga/directive","components/image_bounding_box/directive","components/legend/icon/directive","components/legend/widget/directive","components/lines/directive","components/metric/list/directive","components/metric/multiple/directive","components/page_break/directive","components/pie/directive","components/replay_date/directive","components/replay_slider/directive","components/section/directive","components/stateless_screen/section/command_center/directive","components/summary/directive","components/top_images/directive","components/trends/table/directive","components/widget/body/directive","components/widget/directive","components/widget/head/directive","components/widget/menu/directive","components/widget/menus/bottom/directive","components/widget/menus/top/directive","components/widget/no_data/directive","components/widget/placeholder/directive","components/widget/result_count/directive","components/widget_topic_menu_select/directive","components/edit_mode/web_connector/adobe_analytics/directive","components/message_diffusion/directive","components/edit_mode/watchlist_item/directive","components/button/directive","components/metric/single/directive","components/pack/directive","components/text/directive","components/tree_map/directive","components/wheel/directive"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E,T,M,P,D,A,I,x,R,F,O,k,N,L,B,W,U,G,$,j,H,q){Object.defineProperty(t,"__esModule",{value:!0}),i.module("components_widgets2",[]).directive("twAnimatedLabel",n.default).directive("dropdownButton",U).directive("twCommandCenterBlock",s.default).directive("twCommandCenterHome",o.default).directive("twCommandCenterHomeScreen",r.default).directive("twCommandCenterHomeScreens",a.default).directive("twEditCommandCenter",c.default).directive("twEditCommandCenterScreen",l.default).directive("twEditTopicSetupScreen",d.default).directive("twGaWebConnector",g.default).directive("twImageBoundingBox",u.default).directive("twIconLegend",p.default).directive("twWidgetLegend",h.default).directive("twLines",m.default).directive("twMetricList",_.default).directive("twMetricMultiple",f.default).directive("twMetricSingle",G).directive("twPack",$).directive("twPageBreak",y.default).directive("twPie",v.default).directive("twReplayDate",S.default).directive("twReplaySlider",b.default).directive("twSection",w.default).directive("twStatelessCommandCenterSection",C.default).directive("twSummary",E.default).directive("twText",j).directive("twTopImages",T.default).directive("twTreemap",H).directive("twTrendsTable",M.default).directive("twWheel",q).directive("twWidgetBody",P.default).directive("twWidget",D.default).directive("widgetHeader",A.default).directive("twWidgetMenu",I.default).directive("twWidgetMenusBottom",x.default).directive("twWidgetMenusTop",R.default).directive("noData",F.default).directive("twWidgetPlaceholder",O.default).directive("twResultCount",k.default).directive("widgetTopicMenuSelect",N.default).directive("twMessageDiffusion",B.default).directive("twAaWebConnector",L.default).directive("twEditWatchlistItem",W.default)}),define("entry_point/configurations/angular_configuration/angular_modules/configuration",["require","exports","angular","configuration/directive_config/calendar","configuration/page/command_center","configuration/page/dashboard","configuration/page/edit","configuration/page/embedded_widget","configuration/page/iq_app","configuration/page/monitor","configuration/page/quick_search","configuration/page/report","configuration/page/sandbox","configuration/page/search","configuration/page/settings","configuration/page/stateless_page","configuration/page/topic_setup","configuration/page/trend_discovery","configuration/page/trigger_condition","configuration/page/user_workflow","configuration/page/visual_search","configuration/topic_menu/base","configuration/application/base","configuration/bubble_dialog/base","configuration/page/base"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E){Object.defineProperty(t,"__esModule",{value:!0}),i.module("twConfiguration",[]).factory("calendarConfiguration",n.default).factory("command_centerConfiguration",s.default).factory("dashboardConfiguration",o.default).factory("editConfiguration",r.default).factory("embedded_widgetConfiguration",a.default).factory("iq_appConfiguration",c.default).factory("monitorConfiguration",l.default).factory("quick_searchConfiguration",d.default).factory("reportConfiguration",g.default).factory("sandboxConfiguration",u.default).factory("searchConfiguration",p.default).factory("settingsConfiguration",h.default).factory("stateless_screenConfiguration",m.default).factory("topic_setupConfiguration",_.default).factory("trend_discoveryConfiguration",f.default).factory("trigger_conditionConfiguration",y.default).factory("user_workflowConfiguration",v.default).factory("visual_searchConfiguration",S.default).factory("baseTopicMenuConfiguration",b).service("baseApplicationConfiguration",w.default).service("baseBubbleDialogConfiguration",C.default).service("basePageConfiguration",E.default)}),define("entry_point/configurations/angular_configuration/angular_modules/inhouse",["require","exports","angular","log"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),i.module("twInhouse",[]).service("logService",_.constant(n.logService)).service("LogCluster",_.constant(n.LogCluster))}),define("wrappers/navbar/navbar_options_wrapper",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e,t,i){this._filterStateContainer=!1,this.context=e,this.filterMenus=t,this.id=i,this.groupPage=void 0}return e.prototype={getFilterState:function(){return this._filterStateContainer},setFilterState:function(e){this._filterStateContainer=e},getGroupPage:function(){return this.groupPage},setGroupPage:function(e){this.groupPage=e},hasGroupPage:function(){return void 0!==this.groupPage}},e.NavBarContext={PROJECT:1,ACCOUNT:2,USER:3},e}}),define("wrappers/page/menu/page_menu_wrapper",["require","exports","services/tw_common"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["TopicMenuWrapper","TopicEntryWrapper","logService",function(e,t,n){function s(t){this._allowedPages=t,void 0!==this._allowedPages.display_pages&&(this._displayPagesWrapper=new e(this._allowedPages.display_pages)),void 0!==this._allowedPages.dashboard_page_menu&&(this._dashboardPageMenuWrapper=new e(this._allowedPages.dashboard_page_menu)),this._validate()}return s.prototype={toProto:function(){return this._allowedPages},getGroupPage:function(){return this._allowedPages.group_page},hasDisplayPages:function(){return void 0!==this._displayPagesWrapper},getDisplayPages:function(){return this._displayPagesWrapper},hasDashboardPageMenu:function(){return void 0!==this._dashboardPageMenuWrapper},getDashboardPageMenu:function(){return this._dashboardPageMenuWrapper},getReload:function(){return this._allowedPages.reload},setReload:function(e){this._allowedPages.reload=e},_validate:function(){n.assert(void 0!==this._allowedPages.group_page,"Allowed pages group_page is required",i.twCommon.logFeatures.AllowedPages)}},s}]}),define("wrappers/page/page_wrapper",["require","exports","underscore","services/tw_common"],function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=["SectionWrapper","logService",function(e,t){function s(e){this.sections=[],this.maxPageSize=e,this._isDeleting=!1,this._isHeaderOrFooter=!1}return s.prototype={getSections:function(){return this.sections},addSection:function(e){t.assert(void 0!==e,"section is required",n.twCommon.logFeatures.PageState),this.isEmpty()||t.assert(!e.isPageBreakSection()||!this.getLastSection().isPageBreakSection(),"can't have 2 successive page breaks",n.twCommon.logFeatures.PageState,this),e.setPage(this),e.isPageBreakSection()&&(this._isHeaderOrFooter=e.getLastWidget().isHeader()||e.getLastWidget().isFooter()),this.sections.push(e)},isHeaderOrFooter:function(){return this._isHeaderOrFooter},isDeleting:function(){return this._isDeleting},isFull:function(){return this.getContentLength(this.maxPageSize)===this.maxPageSize},setDeleting:function(e){t.assert(void 0!==e,"value is required"),this._isDeleting=e},insertSectionBelow:function(e,n){t.assert(void 0!==n,"section is required"),t.assert(void 0!==e,"referenceSection is required");const s=i.indexOf(this.sections,e);t.assert(-1!==s,"referenceSection is not part of page"),n.setPage(this),this.sections.splice(s+1,0,n)},insertSectionAbove:function(e,n){t.assert(void 0!==n,"section is required"),t.assert(void 0!==e,"referenceSection is required");const s=i.indexOf(this.sections,e);t.assert(-1!==s,"referenceSection is not part of page"),n.setPage(this),this.sections.splice(s,0,n)},prependSection:function(e){t.assert(void 0!==e,"section is required"),t.assert(!e.isPageBreakSection(),"can't prepend page breaks"),e.setPage(this),this.sections.unshift(e)},isOverflowing:function(){return this.getSections().length>2&&!this.isHeaderOrFooter()&&this.maxPageSize<this.getContentLength(this.maxPageSize)},isEmpty:function(){return 0===this.getContentLength(this.maxPageSize)&&(1!==this.sections.length||!this.sections[0].isPayloadEditionSection())},getLastSection:function(){if(!this.isEmpty())return this.sections[this.sections.length-1]},getLastContentSection:function(){if(this.isEmpty())return;let e;for(let t=0;t<this.getSections().length;t++)this.getSections()[t].isContent()&&(e=this.getSections()[t]);return e},getContentLength:function(e){let t=0,n=0;return i.each(this.getSections(),function(i){i.isContent()&&!i.isTextWidgetSection()?(t+=i.getExportHeight(),1===e&&i.isWorldMapSection()&&t--):i.isTextWidgetSection()&&n++}),n>t&&(t+=n-t),t},removeSection:function(e){const n=i.indexOf(this.sections,e);t.assert(-1!==n,"section not found"),e.removePage(),this.sections.splice(n,1)}},s}]}),define("entry_point/configurations/angular_configuration/angular_modules/wrappers",["require","exports","angular","wrappers/abstract_wrapper","wrappers/allowed_pages/allowed_pages_wrapper","wrappers/branding/branding_wrapper","wrappers/content_structure/content_structure_entry_wrapper","wrappers/content_structure/content_structure_wrapper","wrappers/navbar/navbar_options_wrapper","wrappers/page/menu/page_menu_wrapper","wrappers/page/page_wrapper","wrappers/page_state/page_state_request_wrapper","wrappers/page_state/page_state_wrapper","wrappers/project/project_wrapper","wrappers/searchbar_filter/searchbar_filter_wrapper","wrappers/section/section_wrapper","wrappers/time_filter/time_filter_wrapper","wrappers/topic_menu/topic_entry_wrapper","wrappers/topic_menu/topic_menu_wrapper","wrappers/user_filter_settings/build_parameters/build_parameters","wrappers/user_filter_settings/user_filter_settings_wrapper","wrappers/widget/axis_configuration_wrapper","wrappers/widget/extended_configuration_wrapper","wrappers/widget/table/table_wrapper","wrappers/widget/widget_menu_wrapper"],function(e,t,i,n,s,o,r,a,c,l,d,g,u,p,h,m,_,f,y,v,S,b,w,C,E){Object.defineProperty(t,"__esModule",{value:!0}),i.module("twWrappers",[]).factory("AbstractWrapper",n.default).factory("AllowedPagesWrapper",s.default).factory("BrandingWrapper",o.default).factory("ContentStructureEntryWrapper",r.default).factory("ContentStructureWrapper",a.default).factory("NavBarOptionsWrapper",c.default).factory("PageMenuWrapper",l.default).factory("PageWrapper",d.default).factory("PageStateRequestWrapper",g.default).factory("PageStateWrapper",u.default).factory("ProjectWrapper",p.default).factory("SearchbarFilterWrapper",h.default).factory("SectionWrapper",m.default).factory("TimeFilterWrapper",_.default).factory("TopicEntryWrapper",f.default).factory("TopicMenuWrapper",y.default).factory("BuildParametersWrapper",v.default).factory("UserFilterSettingsWrapper",S.default).factory("AxisConfigurationWrapper",b.default).factory("ExtendedConfigurationWrapper",w.default).factory("TableWrapper",C.default).factory("WidgetMenuWrapper",E.default)}),define("entry_point/configurations/lifetime_services/public",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.publicLifeTimeServices=["injector","themeService"]}),define("entry_point/configurations/lifetime_services/test",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.testLifeTimeServices=["browserDetectionService","customTimezonesService","injector","sessionService","storeService"]}),define("services/template_cache_service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class i{loadTemplateCache(e){if(use_minified_templates)return this.cacheTemplates(window.templateCache,e)}cacheTemplates(e,t){try{Object.keys(e||{}).forEach(i=>t.put(i,e[i]))}catch(e){console.log(e)}}}t.default=i,t.templateCacheService=new i}),define("entry_point/phases/angular_phase",["require","exports","angular_utilities","metrics_service","query_system","reusable_services","classes/application/application","classes/context_data/context_data","services/application_mode","services/rest_form_service","services/router","services/template_cache_service","entry_point/configurations/angular_configuration/complete"],function(e,t,i,n,s,o,r,a,c,l,d,g,u){function p(e){g.templateCacheService.loadTemplateCache(e)}function h(t,n){i.directiveService.enableLazyLoad(t,n),i.directiveService.addLazyLoadableDirectives({loginPage:()=>new Promise((t,i)=>{e(["components/page/login/directive"],t,i)}),twProgressButton:()=>new Promise((t,i)=>{e(["components/progress_button/directive"],t,i)})})}function m(e){e.decorator("$templateCache",["$delegate",function(e){const t=e.get,i=e.put;return!0===window.use_minified_templates&&(e.get=(e=>{const i=t(e);return void 0===i&&console.warn('template "'+e+'" not found in the cache'),i}),e.put=((e,t)=>{"string"==typeof t&&i(e,a.contextData.replaceAllMetaLanguageTags(t))})),e}])}function _(e){e.defaults.useXDomain=!0,window.bootPayload.isInIFrame&&(e.defaults.headers.common["Source-Domain"]=window.bootPayload.referrer,$.ajaxSetup({headers:{"Source-Domain":window.bootPayload.referrer}})),function(e){e.defaults.transformResponse=function(e,t){return(e=angular.isArray(e)?e:[e]).concat(t)}(e.defaults.transformResponse,e=>{return"string"==typeof e?a.contextData.replaceAllMetaLanguageTags(e):e})}(e)}function f(e){e.decorator("$exceptionHandler",["$delegate",function(e){return(t,i)=>{e(t,i),window.tw.errors=window.tw.errors||[],window.tw.errors.push({exception:t,cause:i})}}])}async function y(e){let t=[];t=t.concat(e.components.map(e=>"entry_point/configurations/angular_configuration/angular_modules/components_"+e));const i=e.components.map(e=>"components_"+e.replace(/_(.)/g,e=>e[1].toUpperCase())),n=Object.keys(e.modules).map(i=>(t.push(i),e.modules[i]));return{components:i.concat(n),filesToLoad:t.concat(e.externalDependencies)}}Object.defineProperty(t,"__esModule",{value:!0}),t.start=async function(){a.contextData.areMetricsEnabled()&&c.applicationMode.getCurrentAppMode()===c.AppMode.NORMAL&&(n.MetricsService.setRestFormConnector(e=>l.restFormService.postRForm("metrics","add",e)),n.MetricsService.changeConfig(a.contextData.getMetricsConfiguration()),n.MetricsService.initialize()),window.messages={get:(e,t)=>a.contextData.getMessage(e,t)},setTimeout(()=>{$("div.main-spinner").find(".loading").length&&$("div.main-spinner").find(".loading").text(a.contextData.getMessage("_1894898"))},3e4),s.Query.genesisQuery=new s.Query(new s.ProviderQuery(r.mainApplication)),o.emojiService.setParseConfigurations({base:"/app/assets/lib/twemoji/",folder:"svg",ext:".svg"});const t=c.applicationMode.getAppModeModelForCurrentMode(),g=await async function(e){return y(function(e){if(void 0===d.routerService.router.getCurrentPage())throw new Error("failed to identify the current page");const t=d.routerService.router.getCurrentPage().getId(),i=e.routingTables.find(e=>void 0!==e.routes[t]);if(void 0===i)throw new Error("failed to identify the current page");return i.routes[t].angularConfiguration}(e))}(t);!async function(e,t){const i=await y(u.completeAngularConfiguration);e.angularComponentsToLazyLoad={components:i.components.filter(e=>-1===t.components.indexOf(e)),filesToLoad:i.filesToLoad.filter(e=>-1===t.filesToLoad.indexOf(e))}}(t,g),await function(t){return new Promise((n,s)=>{angular.module("twApp",[]),e(t.filesToLoad,()=>{angular.module("twApp",t.components).directive("directiveDeployer",i.directiveDeployer),n()})})}(g),angular.module("twApp").run(["$templateCache",p]).run(["$injector",e=>{window.tw.inject=e.get}]).config(["$httpProvider",_]).config(["$provide",f]).config(["$provide",m]).config(["$compileProvider","$injector",h]),function(e){(e=["injector"].concat(e)).length>0&&(e.push((...e)=>{e.sort(e=>e.constructor.__order||Number.MAX_VALUE).forEach(e=>{e.initialize&&e.initialize()})}),angular.module("twApp").run.call(this,e))}(t.lifeTimeServices)}}),define("entry_point/phases/launch_phase",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.start=async function(){angular.bootstrap(document,["twApp"],{strictDi:!0})}}),define("entry_point/phases/polyfill_phase",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(){return new Promise(t=>{let i=0;function n(){0==--i&&t()}void 0!==Array.from&&void 0!==[].find&&void 0!==[].findIndex&&void 0!==[].includes||(i++,e(["modern_array"],n)),void 0!==window.Set&&void 0!==window.Set.prototype.keys||(i++,e(["es6set"],n)),void 0!=="".includes&&void 0!=="".repeat&&void 0!=="".startsWith||(i++,e(["modern_string"],n)),void 0===Element.prototype.remove&&(i++,e(["modern_html_element"],n)),void 0!==Number.parseFloat&&void 0!==Number.parseInt||(i++,e(["modern_number"],n)),void 0===Object.assign&&(i++,e(["modern_object"],n)),void 0===Math.log10&&(i++,e(["log10"],n)),void 0===Math.sign&&(i++,e(["math_sign"],n)),void 0===document.contains&&(i++,e(["document_contains"],n)),0===i&&t()})}}),define("entry_point/phases/post_boot_phase",["require","exports","services/application_mode","services/session"],function(e,t,i,n){function s(){n.sessionService.setPageFullyLoaded(!0),console.log("[Booting] sequence complete")}Object.defineProperty(t,"__esModule",{value:!0}),t.start=async function(){const e=i.applicationMode.getAppModeModelForCurrentMode();e.angularComponentsToLazyLoad.components.length>0||e.angularComponentsToLazyLoad.filesToLoad.length>0?angular.module("twApp").run(["$injector",e=>{e.has("$ocLazyLoad")&&setTimeout(async()=>{!function(e){const t=i.applicationMode.getAppModeModelForCurrentMode();e.load({files:t.angularComponentsToLazyLoad.filesToLoad}).then(s)}(e.get("$ocLazyLoad"))},1e3)}]):angular.module("twApp").run(()=>{s()})}}),define("entry_point/phases/preload_phase",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.start=async function(){await new Promise((t,i)=>{e(["bootstrap"],t,i)}),window.use_minified_directives||await new Promise((t,i)=>{e(["angular"],t,i)})}}),define("entry_point/phases/router_setup_phase",["require","exports","services/router","services/application_mode","entry_point/configurations/routing/page_definitions"],function(e,t,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.start=async function(){const e=n.applicationMode.getAppModeModelForCurrentMode();i.routerService.initialize(e.routingTables,s.pageDefinitions)}}),define("flux/global_actions",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.globalActions={global_onPageStateReceived:"global_onPageStateReceived"}}),define("services/walkthrough/specs/free_search.walkthrough",["require","exports","services/walkthrough/walkthrough_service"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const n=[{titleID:"_555632",contentID:"_555901",backdrop:!0,backdropContainer:i.CONTAINER_ELEMENT,orphan:!0,template:i.FIRST_STEP_TEMPLATE},{titleID:"_555709",contentID:"",template:i.WALKTHROUGH_NOCONTENT_TEMPLATE,element:".right > .title",placement:"bottom"},{titleID:"_555133",contentID:"_555231",element:".icon2-tw-qs-charts",placement:"bottom"},{titleID:"_555776",contentID:"_555677",element:".icon2-tw-themecloud",placement:"bottom"},{titleID:"_555344",contentID:"_555610",element:".icon2-tw-qs-people",placement:"bottom"},{titleID:"_555000",contentID:"_555809",element:".icon2-tw-qs-who",placement:"bottom"},{titleID:"_555760",contentID:"_555249",element:".icon2-tw-worldmap",placement:"bottom"},{titleID:"_555281",contentID:"_555267",element:".icon2-tw-results-list",placement:"bottom"},{titleID:"_555321",contentID:"_555819",element:".fa-plus",placement:"bottom"},{titleID:"_555701",contentID:"_555244",backdrop:!0,backdropContainer:i.CONTAINER_ELEMENT,template:i.LAST_STEP_TEMPLATE,orphan:!0}];t.default=n}),define("services/walkthrough/specs/template.walkthrough",["require","exports","services/walkthrough/walkthrough_service"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const n=[{titleID:"_123456",contentID:"_123456",backdrop:!0,backdropContainer:i.CONTAINER_ELEMENT,orphan:!0,template:i.FIRST_STEP_TEMPLATE},{titleID:"_123456",contentID:"_123456",element:".icon2-tw-qs-charts",placement:"bottom"},{titleID:"_123456",contentID:"_123456",backdrop:!0,backdropContainer:i.CONTAINER_ELEMENT,template:i.LAST_STEP_TEMPLATE,orphan:!0}];t.default=n}),define("react_components/tdd_workshop/todo_list_renderable",["require","exports","flux"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});t.TodoList=class extends i.BaseComponent{constructor(e){super(e),this.state=this.props.controller.initialTodoListState(e)}}}),define("react_components/tdd_workshop/todo_list_controller",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultTodoListController=class{initialTodoListState(e){return{}}}}),define("react_components/tdd_workshop/todo_list_factory",["require","exports","react_components/tdd_workshop/todo_list_renderable","react_components/tdd_workshop/todo_list_controller","react"],function(e,t,i,n,s){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.default=0]="default"}(o=t.TODO_LIST_TYPE_CONTROLLER_TYPE||(t.TODO_LIST_TYPE_CONTROLLER_TYPE={}));t.TodoListFactory=class{static createTodoListController(e){switch(e){case o.default:return new n.DefaultTodoListController;default:throw new Error("unknown controller type!")}}static createTodoList(e){switch(e){case o.default:const t={controller:new n.DefaultTodoListController};return s.createElement(i.TodoList,Object.assign({},t));default:throw new Error("unknown controller type!")}}}});
define("classes/canvas_chart_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/canvas_chart_margins",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasChartMargins=class{constructor(){this._gridOffsetLeft=0,this._gridOffsetBottom=0,this._chartMargins=new i.Vector4D(0,0,0,0)}set gridOffsetBottom(e){this._gridOffsetBottom=e}get gridOffsetBottom(){return this._gridOffsetBottom}set gridOffsetLeft(e){this._gridOffsetLeft=e}get gridOffsetLeft(){return this._gridOffsetLeft}set chartTop(e){this._chartMargins.r=e}set chartRight(e){this._chartMargins.g=e}set chartBottom(e){this._chartMargins.b=e}set chartLeft(e){this._chartMargins.a=e}get top(){return this._chartMargins.r}get right(){return this._chartMargins.g}get bottom(){return this._chartMargins.b+this.gridOffsetBottom}get left(){return this._chartMargins.a+this.gridOffsetLeft}}}),define("classes/canvas_chart_grid_ticks",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasChartGridTicks=class{}}),define("classes/canvas_chart_grid_range",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasChartGridRange=class{}}),define("classes/canvas_grid_chart_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NORMAL=0]="NORMAL",e[e.INVERTED=1]="INVERTED"}(t.CanvasChartGridDirection||(t.CanvasChartGridDirection={})),function(e){e[e.START=0]="START",e[e.CENTER=1]="CENTER"}(t.CanvasChartGridAxisPlacement||(t.CanvasChartGridAxisPlacement={}))}),define("classes/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LEGEND_MOUSEENTER="LEGEND_MOUSEENTER",e.LEGEND_MOUSELEAVE="LEGEND_MOUSELEAVE",e.LEGEND_MOUSECLICK="LEGEND_MOUSECLICK",e.WIDGET_MOUSEENTER="WIDGET_MOUSEENTER",e.WIDGET_MOUSELEAVE="WIDGET_MOUSELEAVE"}(t.LegendActions||(t.LegendActions={}))}),define("classes/canvas_chart_layer",["require","exports","graphics_utilities","math_utils","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.ManagedDrawingLayer{constructor(e,t,i){super(e,t,i),this.flatDrawDrables=[],this.hasChanged=!1,this.context=this.canvas.getContext("2d"),this.size=e,void 0!==t.container&&t.container.appendChild(this.canvas),this.updateCanvasSize(e)}getResolutionScale(){return this.resolutionScale}toSerializable(){const e=super.toSerializable();return Object.assign({},e,{drawables:this.drawables.map(e=>e.toSerializable())})}putDrawableOnTop(e){super.putDrawableOnTop(e);const t=this.flatDrawDrables.indexOf(e);this.flatDrawDrables.indexOf(e)>-1&&(this.flatDrawDrables.splice(t,1),this.flatDrawDrables.push(e))}flattenDrawables(e){const t=[e];if(void 0!==e.children){let i=e.children.length;const s=i;for(;i--;){const n=e.children[s-1-i];t.push(...this.flattenDrawables(n))}}return t}async removeDrawable(e,t){const i=this.flatDrawDrables.indexOf(e);return-1!==i&&this.flatDrawDrables.splice(i,1),await super.removeDrawable(e,t)}hasDrawable(e){return this.flatDrawDrables.includes(e)}async addDrawable(e,t){await super.addDrawable(e,t),this.flatDrawDrables.push(...this.flattenDrawables(e)),this.hasChanged=!0}async clearDrawables(){await super.clearDrawables(),this.hasChanged=!0,this.flatDrawDrables.length=0}updateCanvasSize(e){const t=Math.floor(e.x),i=Math.floor(e.y);return $(this.canvas).width(t).height(i),this.canvas.width=t*this.resolutionScale,this.canvas.height=i*this.resolutionScale,this}updateCanvasPosition(e){return this.canvas.style.left=e.x+"px",this.canvas.style.top=e.y+"px",this}getCanvas(){return this.canvas}getSize(){return this.size}clear(){return this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this}getContext(){return this.context}addToDom(){document.contains(this.canvas)||document.body.appendChild(this.canvas)}removeFromDom(){document.contains(this.canvas)&&document.body.removeChild(this.canvas)}draw(){const e=navigator.userAgent.indexOf("Edge/")>0;e&&void 0===this.isDomLayer&&(this.isDomLayer=document.contains(this.canvas),this.isDomLayer||(this.canvas.style.display="none")),e&&this.addToDom();const t=this.getTransform();this.translateTo(t.clone().mul(this.resolutionScale)),this.scaleBy(new s.Vector2D(this.resolutionScale,this.resolutionScale)),i.canvasDrawingUtilities.clearCanvas(this.drawingContext);let n=this.drawableObjects.length;const r=n;for(;n--;)this.drawingContext.save(),this.drawDrawable(this.drawableObjects[r-1-n]),this.drawingContext.restore();this.scaleBy(new s.Vector2D(1/this.resolutionScale,1/this.resolutionScale)),this.translateTo(t),e&&this.removeFromDom()}drawImage(e,t,i){this.context.drawImage(e,t,i,this.width,this.height,0,0,this.width,this.height)}requestDraw(){if(!this.pendingDraw){this.pendingDraw=!0;const e=this;requestAnimationFrame(function t(){e.drawActivelyRequests>0&&requestAnimationFrame(t),e.pendingDraw=!1,e.draw(),e.hasChanged=!0})}}}__decorate([n.throttle(50,{leading:!0,trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],r.prototype,"addToDom",null),__decorate([n.throttle(50,{leading:!0,trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],r.prototype,"removeFromDom",null),t.CanvasChartLayer=r}),define("classes/canvas_chart_renderer",["require","exports","graphics_utilities","classes/canvas_chart_layer","math_utils","reusable_utilities","event","map"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=new a.Map;$(document).on("mousemove",e=>{const t=$(e.target),i=t.hasClass("canvas-chart-interaction-node")?e.target:t.parents(".canvas-chart-interaction-node")[0];l.has(i)&&l.get(i).forEach(t=>t(e))});t.CanvasChartRenderer=class extends i.Camera{constructor(e,t,i,l){super(t),this.fps=l,this.origin=new n.Vector2D(0,0),this.drawOffset=new n.Vector2D(0,0),this.size=new n.Vector2D(0,0),this.drawing=!1,this.rendering=!1,this.onDrawDone=new o.Event,this.zoomLevel=1,this.internalLastDrawTimestamp=0,this.drawCache=new a.Map,this.stackedCache=document.createElement("canvas").getContext("2d"),this.stackedIndex=-1,this.nextStackedIndex=-1,this.stackReady=!1,this.stackUpdateId=-1,this.cancellationToken=new r.CancellationToken,this.visibleLayer=new s.CanvasChartLayer(t.visibleLayer.size,t.visibleLayer.layerOptions,t.visibleLayer.resolutionScale),this.enableLayerInteractions(e,i,t.useCanvasAsMouseTarget)}get lastDrawTimeStamp(){return this.internalLastDrawTimestamp}callInteractionEnhancerEvent(e,t,i){e.isDefaultPrevented()||e.isPropagationStopped()||e.isImmediatePropagationStopped()||t[i](e,this.origin,this.zoomLevel)}enableLayerInteractions(e,t,i=!1){const s=[];this.layerData.forEach(({layer:e,name:i})=>{(t[i]||{}).enableInteractions&&s.push(e.setUpInteractions())});let n=$(e);if(i&&(n=n.find("canvas")),n.addClass("canvas-chart-interaction-node"),this.cancellationToken.addDomEvent(n,"mousedown",e=>s.forEach(t=>this.callInteractionEnhancerEvent(e,t,"mouseDown"))),this.cancellationToken.addDomEvent(n,"mouseup",e=>s.forEach(t=>this.callInteractionEnhancerEvent(e,t,"mouseUp"))),this.cancellationToken.addDomEvent(n,"mouseleave",e=>s.forEach(t=>this.callInteractionEnhancerEvent(e,t,"canvasLeave"))),i)this.cancellationToken.addDomEvent(n,"mousemove",e=>s.forEach(t=>this.callInteractionEnhancerEvent(e,t,"mouseMove")));else{l.has(e)||l.set(e,[]);const t=e=>s.forEach(t=>this.callInteractionEnhancerEvent(e,t,"mouseMove"));l.get(e).push(t),this.cancellationToken.addCleanupFunction(()=>{l.has(e)&&(l.get(e).splice(l.get(e).indexOf(t)),0===l.get(e).length&&l.delete(e))})}}toSerializable(){const e=super.toSerializable();return Object.assign({},e,{lastDrawTimeStamp:this.lastDrawTimeStamp,drawing:this.drawing})}zoomOutTowardsCenter(e,t){const i=Math.abs(1-this.zoomLevel),s=(0-this.origin.x)/(i/t),r=(0-this.origin.y)/(i/t);this.zoomLevel*=e,this.origin.x+=s,this.origin.y+=r,this.layerData.forEach(({layer:e})=>{e.translateTo(this.origin.clone().mul(-1)),e.scaleTo(new n.Vector2D(this.zoomLevel,this.zoomLevel)),e.translateTo(this.origin.clone())})}zoom(e,t,i){this.zoomLevel*=e,this.origin.x=Math.round(t-(t-this.origin.x)*e),this.origin.y=Math.round(i-(i-this.origin.y)*e),this.layerData.forEach(({layer:e})=>{e.translateTo(this.origin.clone().mul(-1)),e.scaleTo(new n.Vector2D(this.zoomLevel,this.zoomLevel)),e.translateTo(this.origin.clone())})}getLayerForDrawable(e){let t=this.layerData.length;for(;t--;){const i=this.layerData[this.layerData.length-1-t];if(i.layer.hasDrawable(e))return i.layer}}updateCanvasSize(e){return this.size.x===e.x&&this.size.y===e.y||(this.layerData.forEach(({layer:t})=>{t.updateCanvasSize(e)}),this.visibleLayer.updateCanvasSize(e),this.size.merge(e)),this}updateCanvasPosition(e){return this.layerData.forEach(({layer:t})=>t.updateCanvasPosition(e)),this.visibleLayer.updateCanvasPosition(e),this}get hasChanged(){let e=this.layerData.length;for(;e--;)if(this.layerData[this.layerData.length-1-e].layer.hasChanged)return!0;return!1}set hasChanged(e){this.layerData.forEach(({layer:t})=>t.hasChanged=e)}setDrawOffset(e,t){return this.drawOffset.x=e,this.drawOffset.y=t,this.layerData.forEach(({layer:i})=>i.setInteractionOffset(e,t)),this}queueDraws(e){this.drawing||(void 0!==this.animationFrameId&&r.AnimationLoop.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=r.AnimationLoop.registerCallback(async()=>{await new Promise(t=>{this.draw(),this.hasChanged=!1,e.isCanceled()&&(this.drawing=!1),t()})},!1,this.fps)),this.drawing=!0}dispose(){super.dispose(),this.cancellationToken.cancel(),void 0!==this.animationFrameId&&r.AnimationLoop.cancelAnimationFrame(this.animationFrameId),this.drawCache.clear(),this.layerData.length=0,this.onDrawDone.cancelAll()}start(e){if(this.drawing)throw new Error("Renderer is already drawing!");return this.queueDraws(e),this}updateStackedCache(){-1===this.stackUpdateId&&(this.stackUpdateId=r.AnimationLoop.requestDelay(()=>{Date.now()-this.lastDrawTimeStamp>100?(this.stackedCache.canvas.width=this.visibleLayer.width,this.stackedCache.canvas.height=this.visibleLayer.height,this.stackedCache.clearRect(0,0,this.visibleLayer.width,this.visibleLayer.height),this.layerData.forEach(({layer:e},t)=>{t<=this.nextStackedIndex&&this.stackedCache.drawImage(e.canvas,0,0)}),this.stackReady=!0,this.stackUpdateId=-1,this.stackedIndex=this.nextStackedIndex):(this.stackUpdateId=-1,this.updateStackedCache())},1e3))}draw(){if(this.hasChanged){this.internalLastDrawTimestamp=Date.now();let e=!1,t=-1,i=!1;this.layerData.forEach(({layer:s},r)=>{const o=s;this.drawCache.has(o)||this.drawCache.set(o,document.createElement("canvas").getContext("2d"));const a=this.drawCache.get(o);if(o.hasChanged){o.translateTo(this.drawOffset),e=!0,o.clear(),o.draw();const t=o.width,s=o.height;$(a).width(t).height(s),a.canvas.width=t,a.canvas.height=s,a.clearRect(0,0,t,s),a.drawImage(o.canvas,0,0),o.translateBy(new n.Vector2D(-this.drawOffset.x,-this.drawOffset.y)),i=!0}else i||(t=r)}),t!==this.stackedIndex&&(t<this.stackedIndex&&(this.stackReady=!1),t>0&&this.updateStackedCache()),this.nextStackedIndex=t,e&&(this.visibleLayer.clear(),this.stackReady&&this.visibleLayer.drawImage(this.stackedCache.canvas,0,0),this.layerData.forEach(({layer:e},t)=>{const i=e;this.stackReady&&t<=this.stackedIndex?i.hasChanged=!1:(i.hasChanged||0!==i.drawables.length)&&(i.hasChanged=!1,this.visibleLayer.drawImage(this.drawCache.get(e).canvas,0,0))})),this.onDrawDone.fire()}}}}),define("classes/canvas_chart_utils",["require","exports","xstream","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasChartUtils=class{static createStreamListener(e,t,i){return{next:i=>{if(void 0!==e)try{e(i)}catch(e){if(void 0===t)throw e;t(e)}},error:e=>{if(void 0===t)throw e;t(e)},complete:()=>{void 0!==i&&i()}}}static createUpdatableStream(e){let t=!1;const s=_.extend({},i.Stream.createWithMemory({start:e=>{t=!1,s.update=(i=>{t||e.next(i)})},stop:()=>{t=!0}}),{update:void 0});return s.startWith(e),s}},t.canvasMargin=function({top:e,right:t,bottom:i,left:n}){return new s.Vector4D(e,t,i,n)}}),define("classes/canvas_chart",["require","exports","event","event_bus","graphics_utilities","map","math_utils","object_pool","reusable_utilities","xstream","classes/canvas_chart_layer","classes/canvas_chart_margins","classes/canvas_chart_renderer","classes/canvas_chart_utils","log"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CANVAS_CHART_LAYER_TYPE={},function(e){e.ALIAS="alias",e.ALL_SCROLL="all-scroll",e.AUTO="auto",e.CELL="cell",e["CONTEXT-MENU"]="context-menu",e.COL_RESIZE="col-resize",e.COPY="copy",e.CROSSHAIR="crosshair",e.DEFAULT="default",e.E_RESIZE="e-resize",e.EW_RESIZE="ew-resize",e.GRAB="grab",e.GRABBING="grabbing",e.HELP="help",e.MOVE="move",e.N_RESIZE="n-resize",e.NE_RESIZE="ne-resize",e.NESW_RESIZE="nesw-resize",e.NS_RESIZE="ns-resize",e.NW_RESIZE="nw-resize",e.NWSE_RESIZE="nwse-resize",e.NO_DROP="no-drop",e.NONE="none",e.NOT_ALLOWED="not-allowed",e.POINTER="pointer",e.PROGRESS="progress",e.ROW_RESIZE="row-resize",e.S_RESIZE="s-resize",e.SE_RESIZE="se-resize",e.SW_RESIZE="sw-resize",e.TEXT="text",e["VERTICAL-TEXT"]="vertical-text",e.W_RESIZE="w-resize",e.WAIT="wait",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-out",e.INITIAL="initial",e.INHERIT="inherit"}(t.CANVAS_CHART_CURSOR||(t.CANVAS_CHART_CURSOR={}));const m=new a.Pool({initialSize:0,dynamic:!0,factory:()=>new n.Timeline,resetter:e=>(e.pause(),e.setTweenModels([]),e.progress=0,e),metricName:"timeline_canvas_chart"});class f{constructor(e,t){this.disposeToken=new l.CancellationToken,this.chartSize=new o.Vector2D(0,0),this.margins=new h.CanvasChartMargins,this.onAnimationDone=new i.Event,this.zoomLevel=1,this.logarithmicX=!1,this.logarithmicY=!1,this.afterUpdate=new i.Event,this.initialized=!1,this.runningTimeLines=[],this.queuedDrawables=[],this.animationStates=new r.Map,this.currentAnimationStates=new r.Map,this.queuedAnimationStates=new r.Map,this.subTweens={},this.runQueued=!1,this.lastReplayTimeStamp=0,this.replayTweenLayers=[],this.lowPrecisionFormatter=t.numberFormatter,this.options=t,this.containerSpan=t.containerSpan,this.initialAnimationDuration=t.initialAnimationDuration,this.initialAnimationEnabled=t.initialAnimationEnabled,void 0!==t.margins&&(this.margins.chartTop=t.margins.r,this.margins.chartRight=t.margins.g,this.margins.chartBottom=t.margins.b,this.margins.chartLeft=t.margins.a);const s=t.layers,n=this.handleLayers(s);this.internalDataStream=p.CanvasChartUtils.createUpdatableStream(e),this.internalDataStream.subscribe(p.CanvasChartUtils.createStreamListener(({model:e})=>{this.model=e})),this.internalRendererDataStream=this.createRenderer(e.size,n,t.layerConfigs||{},t.resolutionScale,this.internalDataStream,t.fps||40,t.useCanvasAsMouseTarget),t.enableZoom&&(this.maxZoom=t.maxZoom||3,this.minZoom=t.minZoom||1,this.zoomSpeed=t.zoomSpeed||.2,this.setUpZoom()),this.dataStream=this.internalRendererDataStream}setLowPrecisionFormatter(e){this.lowPrecisionFormatter=e}addToTimeline(e){if(this.disposeToken.isCanceled())return;void 0===this.queuedTimeLine&&(this.queuedTimeLine=m.get());const t=[];let i=e.length;for(;i--;){const s=e[e.length-1-i],r=`targetValue:${s.targetValue instanceof n.Color?s.targetValue.toARGBHex8():s.targetValue}initialValue:${s.initialValue instanceof n.Color?s.initialValue.toARGBHex8():s.initialValue}${s.duration}offset:${s.offset}formatter:${s.formatter}easing:${s.options&&s.options.easing}`;if(this.queuedDrawables.includes(s.drawable)||this.queuedDrawables.push(s.drawable),void 0===this.subTweens[r]){const e={onTicks:[],onAfterTicks:[],onDones:[],objectsAndKeys:[]};this.subTweens[r]=e;const i=()=>{let t=e.objectsAndKeys.length;for(;t--;){const[i,r]=e.objectsAndKeys[t];i[r]instanceof n.Color?(i[r].r=s.object[s.key].r,i[r].g=s.object[s.key].g,i[r].b=s.object[s.key].b,i[r].a=s.object[s.key].a):i[r]=s.object[s.key]}},o=Object.assign({},s.options||{});s.options=Object.assign({},s.options,{onTick:t=>{o&&o.onTick&&o.onTick(t);let i=e.onTicks.length;for(;i--;)e.onTicks[i](t)},onAfterTick:t=>{i(),o&&o.onAfterTick&&o.onAfterTick(t);let s=e.onAfterTicks.length;for(;s--;)e.onAfterTicks[s](t)},onDone:()=>{o&&o.onDone&&o.onDone(),i();let t=e.onDones.length;for(;t--;)e.onDones[t]()}}),t.push(s)}else this.subTweens[r].objectsAndKeys.push([s.object,s.key]),s.options&&s.options.onDone&&this.subTweens[r].onDones.push(s.options.onDone),s.options&&s.options.onTick&&this.subTweens[r].onTicks.push(s.options.onTick),s.options&&s.options.onAfterTick&&this.subTweens[r].onAfterTicks.push(s.options.onAfterTick)}this.queuedTimeLine.addTweenModels(t)}runTimeLine(e=!1){return new Promise(t=>{this.runQueued?t(!1):(this.runQueued=!0,l.AnimationLoop.requestAnimationFrame(async()=>{if(this.runQueued=!1,this.hasTweensToAnimate){void 0===this.queuedTimeLine&&(this.queuedTimeLine=m.get());const i=this.queuedTimeLine;if(this.queuedAnimationStates.size>0){const e=this.queuedAnimationStates.keys();let t=e.length;for(;t--;){const i=e[e.length-1-t],{name:s,states:n}=this.queuedAnimationStates.get(i);this.currentAnimationStates.get(i)!==s&&(this.currentAnimationStates.set(i,s),await new Promise(e=>{n.forEach(e=>this.tweenDrawable(i,e.path,e.value,e.duration,e.offset,e.options)),e()}))}}this.subTweens={},this.queuedAnimationStates.clear(),e||this.runningTimeLines.push(i),this.queuedTimeLine=void 0;const s=[];let n=this.queuedDrawables.length;for(;n--;){const e=this.queuedDrawables[n],t=this.renderer.getLayerForDrawable(e);t&&!s.includes(t)&&s.push(t)}this.queuedDrawables.length=0;let r=0;const o=i.totalDuration;let a,c=0;const d=l.AnimationLoop.registerCallback(async e=>{await new Promise(h=>{if(a){for(c+=e-a,r=Math.min(1,c/o),i.setProgress(r),n=s.length;n--;)s[n].hasChanged=!0;if(r>=1)return m.recycle(i),t(!0),h(),void l.AnimationLoop.cancelAnimationFrame(d)}else i.setProgress(0);for(a=e,n=s.length;n--;)s[n].hasChanged=!0;h()})},!0,this.options.fps)}else t(!1)}))})}update(e){return 0===e.size.y||0===e.size.x?(this.afterUpdate.fire(),this):(this.hasReplayEnabled&&(m.recycle(this.replayTimeLine),this.replayTimeLine=m.get(),this.replayTweenModels=void 0),this.abortAnimations(),this.internalDataStream.update(e),this)}get hasReplayEnabled(){return void 0!==this.replayTimeLine}enableReplay(){this.hasReplayEnabled||(this.replayTimeLine=m.get())}updateReplayProgress(e){void 0!==this.replayTweenModels&&(this.replayTweenModels.forEach(({drawable:e})=>{const t=this.renderer.getLayerForDrawable(e);t&&!this.replayTweenLayers.includes(t)&&this.replayTweenLayers.push(t)}),this.replayTimeLine.addTweenModels(this.replayTweenModels),this.replayTweenModels=void 0),this.renderer.lastDrawTimeStamp!==this.lastReplayTimeStamp&&(this.lastReplayTimeStamp=this.renderer.lastDrawTimeStamp,this.replayTimeLine.setProgress(e),this.replayTweenLayers.forEach(e=>e.hasChanged=!0))}setUpZoom(){const e=e=>{if(this.closePopover(),this.closeDropDown(),e.deltaY<0){if(this.zoomLevel<this.maxZoom){const t=Math.min(this.maxZoom,this.zoomLevel+this.zoomSpeed),i=t/this.zoomLevel;this.zoomLevel=t,this.renderer.zoom(i,e.offsetX,e.offsetY)}}else if(this.zoomLevel>this.minZoom){const e=Math.max(this.minZoom,this.zoomLevel-this.zoomSpeed),t=e/this.zoomLevel;this.zoomLevel=e,this.renderer.zoomOutTowardsCenter(t,this.zoomSpeed)}this.reRender(),e.preventDefault()};this.containerSpan.addEventListener("mousewheel",e),this.disposeToken.addCleanupFunction(()=>{this.containerSpan.removeEventListener("mousewheel",e)})}toJSON(){return JSON.stringify(this.toSerializable())}toSerializable(){return{model:this.model.toSerializable(),renderer:this.renderer.toSerializable()}}setDrawableAnimationState(e,t,i){this.renderer.getLayerByName(e).requestDrawWhile(t.setAnimationState(i))}getDrawablesForLayer(e){return this.renderer.getLayerByName(e).drawables}handleLayers(e){return _.toArray(e||t.CANVAS_CHART_LAYER_TYPE)}getContainer(){return this.containerSpan}setMargins(e,t,i,s){return this.margins.chartTop=e,this.margins.chartRight=t,this.margins.chartBottom=i,this.margins.chartLeft=s,this.calculateChartDimensions(),this}openDropDown(e,t,i){s.eventBus.dispatch({type:s.EVENT_TYPES.DROPDOWN_OPEN,value:{container:this.containerSpan,dropdownData:{buttons:i.map((e,t)=>({icon:e.icon,text:e.text,clickEventType:s.EVENT_TYPES.DROPDOWN_CLICK,clickEventPayload:t}))},x:e,y:t}});const n=i.map((e,t)=>s.eventBus.subscribe(s.EVENT_TYPES.DROPDOWN_CLICK,i=>{i.value===t&&(e.onClick(),this.closeDropDown())}));return s.eventBus.subscribeOnce(s.EVENT_TYPES.DROPDOWN_CLOSE,()=>{n.forEach(e=>e.unsubscribe())}),this}closeDropDown(){s.eventBus.dispatch({type:s.EVENT_TYPES.DROPDOWN_CLOSE,value:void 0})}openPopover(e,t,i){return s.eventBus.dispatch({type:s.EVENT_TYPES.POPOVER_OPEN,value:{container:this.containerSpan,popoverData:i,x:e,y:t}}),this}openDetails(e,t,i){return s.eventBus.dispatch({type:s.EVENT_TYPES.DETAILS_OPEN,value:{id:e,filters:t,container:i}}),this}openDrilldown(e,t,i,n){return s.eventBus.dispatch({type:s.EVENT_TYPES.DRILLDOWN_OPEN,value:{id:e,filters:t,container:i,requestedPageType:n}}),this}closePopover(){return s.eventBus.dispatch({type:s.EVENT_TYPES.POPOVER_CLOSE,value:{}}),this}changeCursor(e){return this.containerSpan.style.cursor=e,this}addTweens(e){return this.addToTimeline(e),this}static extractObjectAndKeyFromPath(e,t){let i,s=t;if(-1===e.indexOf("."))i=e;else{const t=e.split(".");i=t.pop();let n=t.length;const r=n;for(;n--;){const e=t[r-1-n];if(!s[e])throw new Error("Invalid path supplied to tween");s=s[e]}}return[s,i]}addDrawableAnimationState(e,t,i){return this.animationStates.has(e)||this.animationStates.set(e,{}),this.animationStates.get(e)[t]=i,this}addDrawableAnimationStates(e,t){return Object.keys(t).forEach(i=>{this.addDrawableAnimationState(e,i,t[i])}),this}toggleDrawableAnimationState(e,t,i=!1){return this.currentAnimationStates.get(e)!==t&&(this.currentAnimationStates.has(e)&&this.animationStates.get(e)[this.currentAnimationStates.get(e)].forEach(t=>{this.abortAnimationsByDrawableKey(e,t.path.split(".").pop())}),this.animationStates.has(e)&&void 0!==this.animationStates.get(e)[t]?this.queuedAnimationStates.set(e,{name:t,states:this.animationStates.get(e)[t]}):(i=!0,g.logService.warn("Trying to toggle invalid animationstate!")),i||this.animate()),this}createTweenModel(e,t,i,s,n=0,r){const[o,a]=f.extractObjectAndKeyFromPath(t,e);return o[a]!==i?[{drawable:e,object:o,key:a,initialValue:o[a],targetValue:i,duration:s,offset:n,options:r}]:[]}tweenDrawable(e,t,i,s,n=0,r){const o=this.createTweenModel(e,t,i,s,n,r);return o.length>0&&this.addTweens(o),this}tweenDrawables(e,t,i,s,n=0,r){return e.forEach(e=>this.tweenDrawable(e,t,i,s,n,r)),this}addReplayStates(e,t,i,s){if(i.length<2)throw new Error("The number of states for a replay transition must be at least 2");const[n,r]=f.extractObjectAndKeyFromPath(t,e);let o=i.shift();const a=Math.round(1e5/i.length);return void 0===this.replayTweenModels&&(this.replayTweenModels=[]),this.replayTweenModels.push(...i.map((t,i)=>{const l={object:n,key:r,drawable:e,initialValue:o,targetValue:t,duration:a,offset:a*i,options:s};return o=t,l})),this}get hasTweensToAnimate(){return void 0!==this.queuedTimeLine||this.queuedAnimationStates.size>0}async animate(e=!1){this.hasTweensToAnimate&&await new Promise(t=>{this.runTimeLine(e).then(e=>{e&&this.onAnimationDone.fire(),t()})})}abortTimelineTweens(e,t){if(!t)return e.pause(),e.emitEvent("done",void 0),!1;{const i=e.getTweenModels();if(e.setTweenModels(i.filter(e=>e.drawable!==t)),0===e.getTweenModels().length)return!1}return!0}abortTimelineTweensByDrawableKey(e,t,i){const s=e.getTweenModels();return e.setTweenModels(s.filter(e=>e.drawable!==t||e.key!==i)),0!==e.getTweenModels().length}abortAnimationsByDrawableKey(e,t){if(this.runningTimeLines=this.runningTimeLines.filter(i=>this.abortTimelineTweensByDrawableKey(i,e,t)),this.queuedTimeLine){this.abortTimelineTweensByDrawableKey(this.queuedTimeLine,e,t)&&(this.queuedTimeLine=void 0,this.subTweens={})}return this}abortAnimations(e){if(this.runningTimeLines=this.runningTimeLines.filter(t=>this.abortTimelineTweens(t,e)),this.queuedTimeLine){this.abortTimelineTweens(this.queuedTimeLine,e)&&(this.queuedTimeLine=void 0,this.subTweens={})}return this}calculateChartDimensions(){this.chartSize.merge(this.renderer.size),this.chartSize.x=this.chartSize.x-this.margins.right-this.margins.left,this.chartSize.y=this.chartSize.y-this.margins.top-this.margins.bottom,this.renderer.setDrawOffset(this.margins.left,this.margins.top)}createRenderer(e,t,i,s,n,r,a=!1){const l={layers:[],useCanvasAsMouseTarget:a,visibleLayer:{name:name,isFixed:!1,layerOptions:{container:this.containerSpan},resolutionScale:s,size:new o.Vector2D(e.x,e.y),layerType:d.CanvasChartLayer}};return t.forEach((t,i)=>{l.layers.push({name:t,isFixed:!1,resolutionScale:s,size:new o.Vector2D(e.x,e.y),layerType:d.CanvasChartLayer})}),this.renderer=new u.CanvasChartRenderer(this.containerSpan,l,i,r),c.Stream.create({start:e=>n.addListener({next:t=>{this.updateCanvasPosition(t.position),this.updateCanvasSize(t.size),requestAnimationFrame(()=>{t.size=this.chartSize,e.next(t)})}}),stop:()=>{}})}scale(e,t,i,s){return s?o.generalMathUtils.linearScale(e,t,o.generalMathUtils.reverseLog(e,e,i)):o.generalMathUtils.linearScale(e,t,i)}translateValueToY(e,t,i,s=this.logarithmicY){return this.scale({min:i,max:t},{min:0,max:this.chartSize.y},e,s)}translateValueToX(e,t,i,s=this.logarithmicX){return this.scale({min:i,max:t},{min:0,max:this.chartSize.x},e,s)}translateXToValue(e,t,i,s=this.logarithmicX){return this.scale({min:0,max:this.chartSize.x},{min:i,max:t},e,s)}updateCanvasSize(e){return this.renderer.updateCanvasSize(e),this.calculateChartDimensions(),new Promise(e=>{l.AnimationLoop.requestAnimationFrame(()=>e(this))})}updateCanvasPosition(e){return this.renderer.updateCanvasPosition(e),this.calculateChartDimensions(),this}addDrawable(e,t,i){return this.renderer.getLayerByName(e).addDrawable(t,i),this}putDrawableOnTop(e,t){this.renderer.getLayerByName(e).putDrawableOnTop(t)}clearDrawable(e,t){return this.animationStates.delete(t),this.currentAnimationStates.delete(t),this.queuedAnimationStates.delete(t),this.renderer.getLayerByName(e).removeDrawable(t)}clearDrawables(e){return this.getDrawablesForLayer(e).forEach(e=>{this.animationStates.delete(e),this.currentAnimationStates.delete(e),this.queuedAnimationStates.delete(e)}),this.renderer.getLayerByName(e).clearDrawables()}get rendering(){return this.renderer.hasChanged}get afterRenderPromise(){return this.renderer.onDrawDone.subscribeOnceAsPromise()}reRender(){const e=this.renderer.onDrawDone.subscribeOnceAsPromise();return this.renderer.hasChanged=!0,e}start(e){return this.initialized||this.afterRenderPromise.then(()=>this.initialized=!0),this.renderer.start(e),this}dispose(){this.dataStream._stopNow(),this.disposeToken.cancel(),this.renderer.dispose(),this.replayTweenLayers=[],this.abortAnimations(),this.queuedTimeLine&&m.recycle(this.queuedTimeLine),this.replayTimeLine&&m.recycle(this.replayTimeLine),this.queuedAnimationStates.clear(),this.animationStates.clear(),this.currentAnimationStates.clear(),$(this.containerSpan).remove(),this.containerSpan=void 0}draw(){this.renderer.draw()}}t.CanvasChart=f}),define("classes/abstract_canvas_chart_container",["require","exports","reusable_utilities","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractCanvasChartContainer=class{async drawChart(e,t,n,r,o){if(void 0!==this.animationPromise&&(await this.animationPromise,this.animationPromise=void 0),void 0!==o&&this.chart){const a=this.chart,l=a.afterUpdate.subscribeOnceAsPromise();a.update({size:new s.Vector2D(e,t),position:new s.Vector2D(n,r),model:o}),await l,void 0===this.drawToken&&(this.drawToken=new i.CancellationToken,a.start(this.drawToken)),this.animationPromise=a.animate(!0),await this.animationPromise,a.rendering&&await a.afterRenderPromise}return this}reset(){this.drawToken&&this.drawToken.cancel(),this.drawToken=void 0,this.chart&&this.chart.dispose(),this.chart=void 0}dispose(){this.chart&&this.chart.dispose()}}}),define("classes/abstract_canvas_chart_react_container",["require","exports","react","classes/abstract_canvas_chart_container","xstream","classes/canvas_chart_utils","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends s.AbstractCanvasChartContainer{constructor(e){super(),this.chart=e}}t.AbstractCanvasChartReactContainer=class extends i.Component{constructor(e){super(e),this.disposeToken=new o.CancellationToken}render(){return i.createElement("span",{ref:e=>this.initialize(e)})}shouldComponentUpdate(){return!1}async draw(e,t,i,s,n){await this.canvasChartContainer.drawChart(e,t,i,s,n)}componentWillReceiveProps(e){const{width:t,height:i,x:s,y:n,model:r}=e;this.props.width===t&&this.props.height===i&&this.props.x===s&&this.props.y===n&&this.props.model.checkSum===r.checkSum||this.draw(t,i,s,n,r)}initialize(e){if(e){this.canvasChartContainer&&this.canvasChartContainer.dispose();const t=this.createChart(e);t.initialize();const i=t.initialize();if(i instanceof n.default){const e=i.subscribe(r.CanvasChartUtils.createStreamListener(e=>{}));this.disposeToken.addCleanupFunction(()=>{e.unsubscribe()})}this.canvasChartContainer=new a(t);const{width:s,height:o,x:l,y:c,model:d}=this.props;this.draw(s,o,l,c,d),this.disposeToken.addCleanupFunction(()=>{this.canvasChartContainer.dispose()})}}componentWillUnmount(){this.disposeToken.cancel()}}}),define("classes/canvas_chart_grid_helpers",["require","exports","classes/canvas_grid_chart_model","graphics_utilities","math_utils","classes/canvas_chart_grid_range","classes/canvas_chart_grid_ticks","xstream","moment"],function(e,t,i,s,n,r,o,a,l){"use strict";function c(e){const t=void 0!==e.numRangeSteps?e.numRangeSteps:e.min<0?5:6,i=_.range(t);return i.map(t=>({base:n.generalMathUtils.linearScale({min:Math.min(...i),max:Math.max(...i)},{min:e.min,max:e.max},t),logarithmic:n.generalMathUtils.logarithmicScale({min:Math.min(...i),max:Math.max(...i)},{min:e.min,max:e.max},t)}))}function d(e,t,i,s){let n=s?i.logarithmic:i.base;return n>=10&&(n=Math.ceil(n)),t.percentageBased?e.toPercentage(n/100):e.toDecimal(n)}function h(e,t,i,r){return i.map((o,a)=>{r&&(o=i[i.length-1-a]);const l=d(e.numberFormatter,t,o,e.isLogarithmic);return new s.DrawableText({position:new n.Vector2D(0,0),text:l,family:s.DrawableTextFontFamily.RobotoR,size:11,textAlign:s.DrawableTextAlign.END,inheritParentOpacity:!0,style:{fillStyle:new s.Color(new n.Vector4D(127,140,140,255)),opacity:1}})})}function u(e,t,i,r,o=0){const a=t.length>i.length?2:1,l=Math.max(t.length,i.length);let c=0;for(let d=0;d<l;d+=a){const a=t[d],l=i[c];if(void 0===a&&l)i.splice(c,1);else if(l){const t=parseInt(l.text.replace(/%/g,""))<0;if(r){if(l.position.x=-10-e.options.yAxis.labelMargin,l.position.y=t?a.start.y-11:a.start.y+2,l.textAlign=s.DrawableTextAlign.END,e.options.yAxis.centerLabelsOnBaseline){l.position.x=e.translateValueToX(5,10,0),l.textAlign=s.DrawableTextAlign.CENTER,l.textBaseline=s.DrawableTextBaseline.MIDDLE,l.styleData.strokeStyle="white",l.styleData.lineWidth=5;const t=l.getBoundingBox(),i=6;l.children=[new s.DrawableRectangle({position:new n.Vector2D(-t.width/2,-t.height-(i-1)),size:new n.Vector2D(t.width,i),inheritParentOpacity:!0,style:{fillStyle:"white"}}),new s.DrawableRectangle({position:new n.Vector2D(-t.width/2,t.height/2+2),size:new n.Vector2D(t.width,i),inheritParentOpacity:!0,style:{fillStyle:"white"}})]}e.options.yAxis.centerLabelsOnDashedLines&&(l.position.y=a.start.y,l.textBaseline=s.DrawableTextBaseline.MIDDLE)}else l.position.x=a.start.x+.5,l.position.y=a.end.y+4+e.options.xAxis.labelMargin,l.textAlign=s.DrawableTextAlign.CENTER,e.showDaySeparators&&d>0&&(l.position.x+=o);c++}}}function p(e,t,i){let a,l;return t?(a=new n.Vector2D(e.options.xAxis.startLinesAtMargin?0:-e.margins.gridOffsetLeft,i),l=new n.Vector2D(e.chartWidth+e.margins.gridOffsetLeft+e.margins.right,i)):(a=new n.Vector2D(i,-e.margins.top),e.grid.yAxis instanceof r.CanvasChartGridRange?(l=new n.Vector2D(i,e.getYAxisCoordinate(0,!1)),l=new n.Vector2D(i,e.translateValueToY(e.grid.yAxis.max,e.grid.yAxis.max,e.grid.yAxis.min,!1))):e.grid.yAxis instanceof o.CanvasChartGridTicks&&(l=new n.Vector2D(i,e.chartHeight-e.translateValueToY(_.first(e.grid.yAxis.ticks).value,_.last(e.grid.yAxis.ticks).value,_.first(e.grid.yAxis.ticks).value,!1)))),new s.DrawableLine({start:a,end:l,inheritParentPosition:!1,style:{strokeStyle:new s.Color(new n.Vector4D(211,211,211,255)),lineWidth:1,lineDash:[5,5]}})}function g(e,t){const r=e.grid.direction===i.CanvasChartGridDirection.NORMAL;let o=c(t),a=h(e,t,o,r),l=t.numRangeSteps?t.numRangeSteps:f(e,a.map(({text:e})=>e),!r);t.min<0&&l%2==0&&l++,l<o.length&&!r&&(o=c(Object.assign({},t,{numRangeSteps:l})),a=h(e,t,o,r));const d=y(function(e,t,s){const n=e.grid.direction===i.CanvasChartGridDirection.NORMAL;return s.map(i=>n?Math.round(e.translateValueToY(i.base,t.max,t.min,!1)):Math.round(e.translateValueToX(i.base,t.max,t.min,!1)))}(e,t,o),l,!r,r?e.chartHeight:e.chartWidth).map(t=>p(e,r,t));t.hideInbetweenSteps&&d.forEach((e,t)=>{t%2!=0&&(e.styleData.opacity=0,e.inheritParentOpacity=!1)}),u(e,d,a,r);let g=!1;if(r?(e.options.yAxis.hideDashedLines&&d.forEach(e=>{e.styleData.opacity=0,e.inheritParentOpacity=!1}),e.options.yAxis.hideLabels&&(g=!0),e.options.yAxis.hideZeroLabel&&a.pop()):(e.options.xAxis.hideDashedLines&&d.forEach(e=>{e.styleData.opacity=0,e.inheritParentOpacity=!1}),e.options.xAxis.hideLabels&&(g=!0)),!r){let e;a.forEach(t=>{if(void 0!==e){const i=e.getBoundingBox(),s=t.getBoundingBox();i.right>s.x&&(t.styleData.opacity=0,t.inheritParentOpacity=!1),e=void 0}t.styleData.opacity>0&&(e=t)})}return{lines:new s.DrawableRectangle({position:new n.Vector2D(-e.margins.left,-e.margins.top),size:new n.Vector2D(e.chartWidth+e.margins.left+e.margins.right,e.chartHeight+e.margins.top+e.margins.bottom),isClippingMask:!0,style:{fillStyle:"rgba(0,0,0,0)"},children:d}),labels:new s.DrawableRectangle({position:new n.Vector2D(0,0),size:new n.Vector2D(e.chartWidth+e.margins.right,e.chartHeight+e.margins.bottom),style:{fillStyle:"rgba(0,0,0,0)",opacity:g?0:1},children:a}),tweens:[],buildId:e.buildId}}Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRangeValues=c,t.formatRangeValue=d,t.prepareRangeLabels=h;const m=document.createElement("canvas").getContext("2d");function f(e,t,i){if(i){const i=2*t.reduce((e,t)=>Math.max(e,m.measureText(t).width),0);return Math.min(e.grid.maxTickLines,Math.ceil(e.chartWidth/i))}return Math.round((e.chartHeight-e.margins.top-e.margins.bottom)/40)}function y(e,t,i,s){let n=[];const r=i?150:40;if(t>e.length&&e.length>1&&e[1]-e[0]>r)for(let i=0;i<e.length&&(n.push(e[i]),!(i+1>=t));i++)void 0!==e[i+1]&&n.push(Math.round((e[i+1]+e[i])/2));else{if(i&&t<e.length&&e.length>1){const i=e[e.length-1]-e[0],s=e[0],r=e[e.length-1];for(let e=0;e<t;e++)n.push(s+i/t*e);n.push(r)}else n=e;if(1===n.length){for(;n[e.length-1]<s;)n.push(n[e.length-1]+r);n[e.length-1]>s&&n.pop()}}return n}function b(e,t,i){const s=l(_(t).first().value).year()!==l(_(t).last().value).year()&&!_(t).first().formattedLabel.includes(l(_(t).first().value).year().toString())&&!e.showDaySeparators,n=[];let r,o;return t.filter(e=>e.formattedLabel.length>0).forEach((t,a)=>{if(t.hasTimeStamp){const c=function(e,t){return t?`${e.formattedLabel} ${l(e.value).year()}`:e.formattedLabel}(t,s);a%i==0?t.newDay||void 0===r||"d1"!==e.data.model.timeInterval?"d1"===e.data.model.timeInterval&&o===c||(n.push(Object.assign({},t,{formattedLabel:c})),o=c):e.showDaySeparators?n.push(Object.assign({},r,{formattedLabel:c})):_.last(n)!==r&&(n.push(r),o=r.formattedLabel):t.newDay&&o!==c&&(r=Object.assign({},t,{formattedLabel:c}))}else a%i==0&&n.push(Object.assign({},t))}),n}var E;function S(e,t,i){return e<i?1:function(e,t,i){return Math.ceil(e/t)<4?Math.floor(t/2):t*Math.ceil(e/(t*i))}(e,E[t],i)}function C(e,t){const i=new n.Vector2D(Math.round(e.getXAxisCoordinate(t,!1)),10);return i.x<18&&(i.x+=18-i.x),i}function v(e,t){for(;e.width>t&&t>0&&e.width>0&&e.text.length>3;){const t=e.text.replace("...","");e.text=t.substring(0,t.length-1).trim()+"..."}}function T(e,t){const r=e.grid.direction===i.CanvasChartGridDirection.NORMAL;!r&&t.ticks.some(e=>!e.hasTimeStamp)&&t.ticks.reverse();const o=e.showAllTicks?t.ticks.length:f(e,t.ticks.map(({formattedLabel:e})=>e),r),a=b(e,t.ticks,e.showAllTicks?1:S(t.ticks.length,e.timeInterval,o)),l=y(function(e,t,i){return t.map(({value:t})=>i?Math.round(e.getXAxisCoordinate(t,!1)):Math.round(e.getYAxisCoordinate(t,!1)))}(e,a,r),o,r,r?e.chartWidth:e.chartHeight).map(t=>p(e,!r,t));let c=[];const d=function(e){return e.map(e=>new s.DrawableText({position:new n.Vector2D(0,0),text:e.formattedLabel,size:11,family:s.DrawableTextFontFamily.RobotoR,inheritParentOpacity:!0,style:{fillStyle:new s.Color(new n.Vector4D(127,140,140,255)),opacity:1}}))}(a);let h=0,g=!1;if(r){if(l.length>2){const t=l[1].position.x-l[0].position.x,i=l[2].position.x-l[1].position.x;Math.abs(t-i)>3&&(l[0].styleData.opacity=0,l[0].inheritParentOpacity=!1),e.showDaySeparators&&(h=i-t)}if(e.options.xAxis.hideLabels&&(g=!0),e.showDaySeparators&&!a.some(e=>e.newDay)){c=t.ticks.filter(e=>e.newDay&&e.formattedLabel.length>0).map(t=>I(t.formattedLabel,C(e,t.value))),0===_.difference(c.map(e=>e.text),d.map(e=>e.text)).length?c=[]:e.options.xAxis.hideDashedLines=!1}e.options.xAxis.hideDashedLines&&l.forEach(e=>e.styleData.opacity=0),e.events.length>0&&c.push(...e.events.map(t=>I(t.title,C(e,t.date))))}else e.options.yAxis.hideDashedLines&&l.forEach(e=>{e.styleData.opacity=0,e.inheritParentOpacity=!1}),e.options.yAxis.hideLabels&&(g=!0);return u(e,l,d,!r,h),r?d.forEach(t=>v(t,e.chartWidth/d.length)):(e.options.yAxis.centerLabelsOnDashedLines||(_.last(_.sortBy(d,e=>e.position.y)).position.x-=Math.max(0,5)),d.forEach(t=>v(t,e.margins.gridOffsetLeft-e.options.yAxis.labelMargin+t.position.x))),{lines:new s.DrawableRectangle({position:new n.Vector2D(-e.margins.left,-e.margins.top),size:new n.Vector2D(e.chartWidth+e.margins.left+e.margins.right,e.chartHeight+e.margins.top+e.margins.bottom),isClippingMask:!0,style:{fillStyle:"rgba(0,0,0,0)"},children:l}),labels:new s.DrawableRectangle({position:new n.Vector2D(0,0),size:new n.Vector2D(e.chartWidth+e.margins.right,e.chartHeight+e.margins.bottom),style:{fillStyle:"rgba(0,0,0,0)",opacity:g?0:1},children:d}),tweens:[],buildId:e.buildId,verticalLabels:new s.DrawableRectangle({position:new n.Vector2D(0,0),size:new n.Vector2D(e.chartWidth+e.margins.right,e.chartHeight+e.margins.bottom),style:{opacity:1,fillStyle:"rgba(0,0,0,0)"},children:c.filter(({position:e})=>e.x>0)})}}function I(e,t){return new s.DrawableText({position:t,text:e,textAlign:s.DrawableTextAlign.END,textBaseline:s.DrawableTextBaseline.BOTTOM,size:14,fontStyle:s.DrawableTextFontStyle.ITALIC,family:s.DrawableTextFontFamily.RobotoR,inheritParentOpacity:!0,style:{fillStyle:"#666",rotationAngle:n.trigonometryUtils.degreesToRadians(-90),opacity:1}})}function w(e,t,i){const s=e.grid;let a,l;return s.xAxis instanceof r.CanvasChartGridRange?a=t.lines.children:s.yAxis instanceof r.CanvasChartGridRange&&(l=t.lines.children),s.xAxis instanceof o.CanvasChartGridTicks?a=i.lines.children:s.yAxis instanceof o.CanvasChartGridTicks&&(l=i.lines.children),new n.Vector2D(a[0].position.x,_.last(l).position.y)}function A(e,t,i,n){const r=[{object:t.start,key:n,targetValue:t.start[n],initialValue:i,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t},{object:t.end,key:n,targetValue:t.end[n],initialValue:i,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t}];return t.start[n]=i,t.end[n]=i,r}function O(e,t,i){return[{object:t.lines.position,key:"y",targetValue:t.lines.position.y,initialValue:i.y,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t.lines},{object:t.lines,key:"height",targetValue:t.lines.height,initialValue:0,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t.lines}]}function M(e,t){const i=[{object:t.styleData,key:"opacity",targetValue:t.styleData.opacity,initialValue:0,duration:e.animationDuration/2,offset:e.animationDuration/2,drawable:t}];return t.styleData.opacity=0,i}function L(e,t){const i=[{object:t.styleData,key:"opacity",targetValue:t.styleData.opacity,initialValue:0,duration:e.animationDuration/2,offset:e.animationDuration/2,drawable:t}];return t.styleData.opacity=0,i}function P(e,t,i){return[{object:t.lines.position,key:"x",targetValue:t.lines.position.x,initialValue:i.x,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t.lines},{object:t.lines,key:"width",targetValue:t.lines.width,initialValue:0,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t.lines}]}function x(e,t,i,s){return e.isAnimationEnabled?[...function(e,t,i){return e.grid.xAxis instanceof r.CanvasChartGridRange?e.options.xAxis.hideDashedLines?[]:O(e,t,i):e.options.yAxis.hideDashedLines?[]:P(e,t,i)}(e,t,s),...function(e,t,i){return e.grid.xAxis instanceof o.CanvasChartGridTicks?e.options.xAxis.hideDashedLines?[]:O(e,t,i):e.options.yAxis.hideDashedLines?[]:P(e,t,i)}(e,i,s)]:[]}function D(e,t,i){return _.flatten(["x","y"].map(n=>[{object:t.start,key:n,targetValue:i.start[n],initialValue:t.start[n],duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t},{object:t.end,key:n,targetValue:i.end[n],initialValue:t.end[n],duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:t}]))}function R(e,t){return[{object:t.styleData,key:"opacity",targetValue:0,initialValue:t.styleData.opacity,duration:e.animationDuration/2,offset:e.animationDuration/2,drawable:t}]}function N(e,t){return[{object:t.styleData,key:"opacity",targetValue:0,initialValue:t.styleData.opacity,duration:e.animationDuration/2,offset:e.animationDuration/2,drawable:t}]}function k(e,t){return e.children.map(({text:e,position:t})=>e+t.x+t.y).join("")!==t.children.map(({text:e,position:t})=>e+t.x+t.y).join("")}function F(e,t){return void 0===e||e.lines.children.length!==t.lines.children.length}function B(e,t,i=!1){e.css("left",t-2-e.outerWidth()/2),i?e.css("top",120+e.outerHeight()):e.css("top",100)}function U(e,t,i){e.find("p").first().html(t),e.find("p").last().html(i)}m.font="normal 11px sans-serif",t.getTextWidth=function(e){return m.measureText(e).width},function(e){e[e.min1=10]="min1",e[e.min5=2]="min5",e[e.min15=4]="min15",e[e.h1=24]="h1",e[e.d1=7]="d1",e[e.d7=4]="d7",e[e.d30=3]="d30",e[e.m1=3]="m1",e[e.m3=4]="m3",e[e.m6=2]="m6",e[e.y1=2]="y1"}(E||(E={})),t.createAnimations=function(e){return e.grid&&!e.options.hideGrid&&(function(e){const t=e.grid,[i,s,,,n,a]=e.renderData;(void 0===e.oldRangeLines||e.transitionsConfig.transitionRangeLabels)&&(t.xAxis instanceof r.CanvasChartGridRange?e.options.xAxis.hideLabels||(n.push(...L(e,i.labels)),e.transitionsConfig.transitionRangeLabels&&n.push(...R(e,e.oldRangeLines.labels))):e.options.yAxis.hideLabels||(n.push(...M(e,i.labels)),e.transitionsConfig.transitionRangeLabels&&n.push(...N(e,e.oldRangeLines.labels)))),(void 0===e.oldTickLines||e.transitionsConfig.transitionTickLabels)&&(t.xAxis instanceof o.CanvasChartGridTicks?e.options.xAxis.hideLabels||(n.push(...L(e,s.labels)),s.verticalLabels.children.length>0&&n.push(...L(e,s.verticalLabels)),e.transitionsConfig.transitionTickLabels&&(n.push(...R(e,e.oldTickLines.labels)),e.oldTickLines.verticalLabels.children.length>0&&n.push(...R(e,e.oldTickLines.verticalLabels)))):e.options.yAxis.hideLabels||(n.push(...M(e,s.labels)),e.transitionsConfig.transitionTickLabels&&n.push(...N(e,e.oldTickLines.labels)))),(void 0===e.oldYAxis2Labels||e.transitionsConfig.transitionYAxis2)&&a&&(e.options.xAxis.hideLabels||(n.push(...L(e,a)),e.transitionsConfig.transitionYAxis2&&n.push(...R(e,e.oldYAxis2Labels))))}(e),function(e){const[t,i,s,n,r]=e.renderData,o=w(e,t,i);e.transitionsConfig.transitionXAxis&&!e.options.xAxis.hideBaseLine?r.push(...D(e,e.oldXAxis,s)):r.push(...A(e,s,o.x,"x")),e.transitionsConfig.transitionYAxis&&!e.options.yAxis.hideBaseLine?r.push(...D(e,e.oldYAxis,n)):r.push(...A(e,n,o.y,"y"))}(e),function(e){const[t,i,,,s]=e.renderData;e.transitionsConfig.reRenderLines?s.push(...x(e,t,i,w(e,t,i))):(i.lines.children.forEach((t,i)=>{const n=e.oldTickLines.lines.children[i];s.push(...D(e,n,t))}),t.lines.children.forEach((t,i)=>{const n=e.oldRangeLines.lines.children[i];s.push(...D(e,n,t))}))}(e)),function(e){const[,,,,t]=e.renderData;void 0===e.oldGradientLegend&&void 0!==e.gradientLegend&&(t.push({object:e.gradientLegend,key:"height",targetValue:e.gradientLegend.height,initialValue:0,duration:e.animationDuration,options:{easing:s.EASING.easeInCubic},drawable:e.gradientLegend}),e.gradientLegend.height=0)}(e),e},t.getTransitionConfiguration=function(e){if(e.grid&&!e.options.hideGrid){const[t,i]=e.renderData,s={transitionXAxis:void 0!==e.oldXAxis,transitionYAxis:void 0!==e.oldYAxis,transitionYAxis2:void 0!==e.oldYAxis2Labels,transitionTickLabels:void 0!==e.oldTickLines&&(e.sizeChanged||k(e.oldTickLines.labels,i.labels)),transitionRangeLabels:void 0!==e.oldRangeLines&&(e.sizeChanged||k(e.oldRangeLines.labels,t.labels)),reRenderLines:e.sizeChanged||F(e.oldTickLines,i)||F(e.oldRangeLines,t)};e.transitionsConfig=s}return e},t.createGridLines=function(e){if(e.grid&&!e.options.hideGrid){const t=e.grid;let a,l;t.xAxis instanceof r.CanvasChartGridRange?a=t.xAxis:t.yAxis instanceof r.CanvasChartGridRange&&(a=t.yAxis),t.xAxis instanceof o.CanvasChartGridTicks?l=t.xAxis:t.yAxis instanceof o.CanvasChartGridTicks&&(l=t.yAxis);const c=g(e,a),d=T(e,l),h=function(e,t,o){const a=e.grid;let l,c;return a.xAxis instanceof r.CanvasChartGridRange?l=o:a.yAxis instanceof r.CanvasChartGridRange&&(l=t),c=a.xAxisPlacement===i.CanvasChartGridAxisPlacement.START?Math.max(...l.lines.children.map(e=>e.position.y)):l.lines.children[Math.floor(l.lines.children.length/2)].position.y,new s.DrawableLine({start:new n.Vector2D(e.options.xAxis.startLinesAtMargin?0:-e.margins.left,c),end:new n.Vector2D(e.chartWidth+e.margins.left+e.margins.right,c),style:{strokeStyle:new s.Color(new n.Vector4D(159,169,169,255)),lineWidth:1,opacity:e.options.xAxis.hideBaseLine?0:1}})}(e,c,d),u=function(e,t,r){const a=e.grid;let l,c;return a.xAxis instanceof o.CanvasChartGridTicks?l=r:a.yAxis instanceof o.CanvasChartGridTicks&&(l=t),c=a.yAxisPlacement===i.CanvasChartGridAxisPlacement.START?l.lines.children[0].position.x:l.lines.children[Math.floor(l.lines.children.length/2)].position.x,new s.DrawableLine({start:new n.Vector2D(c,-e.margins.top),end:new n.Vector2D(c,e.chartHeight),style:{strokeStyle:new s.Color(new n.Vector4D(159,169,169,255)),lineWidth:1,opacity:e.options.yAxis.hideBaseLine?0:1}})}(e,c,d);let p;void 0!==t.yAxis2&&(t.yAxis2 instanceof r.CanvasChartGridRange?p=g(e,t.yAxis2).labels:t.yAxis2 instanceof o.CanvasChartGridTicks&&(p=T(e,t.yAxis2).labels),p.children.forEach(e=>{e.textAlign=s.DrawableTextAlign.START,e.position.x=10}),t.xAxis instanceof o.CanvasChartGridTicks?p.position.x=e.getXAxisCoordinate(l.ticks[l.ticks.length-1].value,!1):t.xAxis instanceof r.CanvasChartGridRange&&(p.position.x=e.getXAxisCoordinate(a.max,!1))),e.renderData=[c,d,h,u,[],p]}else e.renderData=[void 0,void 0,void 0,void 0,[],void 0];return e},t.transitionOldXAxisLabels=R,t.transitionOldYAxisLabels=N,t.shouldTransitionAxisLabels=k,t.shouldRerenderLines=F,t.createGradientLegend=function(e){if(e.gradientLegendItems.length>0){const t=e.chartWidth+e.margins.left+e.margins.right,i=20;e.gradientLegend=new s.DrawableRectangle({position:new n.Vector2D(-e.margins.left,e.translateValueToY(10,10,-2)),size:new n.Vector2D(t,i),isClippingMask:!0,style:{fillStyle:new s.Gradient(new n.Vector2D(0,0),new n.Vector2D(e.chartWidth+e.margins.left+e.margins.right,0),e.gradientLegendItems.map(e=>({position:e.position,color:e.color})))},children:e.gradientLegendItems.map(e=>{const r=new s.DrawableText({position:new n.Vector2D(t*e.position,i/2),text:e.label,family:s.DrawableTextFontFamily.RobotoR,size:11,textAlign:s.DrawableTextAlign.CENTER,weight:s.DrawableTextWeight.BOLD,textBaseline:s.DrawableTextBaseline.MIDDLE,style:{fillStyle:e.labelColor,opacity:1}});return r.width/2>r.position.x?r.position.x=r.width/2+10:r.width/2+r.position.x>t-10&&(r.position.x=t-r.width/2-10),r})})}return e},t.createMouseDraggingStream=function(e,t,i,r,o){const c=$(e),d=$('<div class="drag-tooltip"><p>10/10/10</p><p></p></div>'),h=d.clone();let u;c.append(d),c.append(h);let p=-1;const g=c.find("canvas").height();return a.Stream.create({start:e=>{let a,m,_;c.on("mousedown.canvasDragging",()=>{o()||($(window).one("mouseup.canvasDragging",()=>{o()||(c.off("mousemove"),e.next([]),a=void 0,d.hide(),h.hide(),r(m,_),p=-1)}),c.on("mousemove.canvasDragging",r=>{if(!o()){const o=Math.min(Math.max(r.offsetX-t.left,0),c.find("canvas").width()-t.right-t.left),f=Math.round(n.generalMathUtils.linearScale({min:0,max:c.find("canvas").width()-t.right-t.left},{min:0,max:i.ticks.length-1},o)),y=Math.max(o+t.left,t.left);let b,E;const S=void 0===a;if(p!==f){const e=l(i.ticks[f].value);b=e.format("DD/MM/YY"),E=e.format("HH:mm:ss"),S||U(h,b,E)}if(S&&(function(e,t,i,s){e.show(),t.show(),U(e,i,s),U(t,i,s)}(d,h,b,E),a=o,B(d,y),m=Number(i.ticks[f].label)),_=Number(i.ticks[f].label),m>_){const e=m;m=_,_=e}p=f,B(h,y+4,Math.abs(o-a)<Math.max(d.outerWidth(),h.outerWidth())+10),u=function(e,t,i,r){const o=t-i,a=o+4,l=r+100;return void 0===e?e=[new s.DrawableRectangle({position:new n.Vector2D(i,-100),size:new n.Vector2D(o,l),style:{fillStyle:new s.Color(new n.Vector4D(0,119,167,150)),opacity:.5}}),new s.DrawableRectangle({position:new n.Vector2D(i-2,-100),size:new n.Vector2D(a,l),style:{strokeStyle:new s.Color(new n.Vector4D(0,119,167,255)),lineWidth:4,opacity:.5}})]:(e[0].position.x=i,e[0].width=o,e[0].height=l,e[1].position.x=i-2,e[1].width=a,e[1].height=l),e}(u,o,a,g),e.next(u)}}))})},stop:()=>{c.off("mousedown.canvasDragging"),c.off("mouseup.canvasDragging"),c.off("mousemove.canvasDragging"),void 0!==u&&u.length>0&&(u[0].dispose(),u[1].dispose())}})},t.createCutOffs=function(e){if(e.grid&&!e.options.hideGrid){const t=e.grid.ticks.ticks.length;let i=e.grid.ticks.ticks.length;const r=[];let o=-1;for(;i--;){const s=e.grid.ticks.ticks[t-i-1];s.isCutOff?(void 0===r[o]&&(o=r.push([-1,-1])-1),-1===r[r.length-1][0]?r[r.length-1][0]=s.value:r[r.length-1][1]=s.value):void 0!==r[o]&&o++}const a=_.first(e.grid.ticks.ticks).value,l=_.last(e.grid.ticks.ticks).value;e.cutOffs=r.filter(([,e])=>-1!==e).map(([t,i])=>{const r=Math.round(e.translateValueToX(t,l,a,!1)),o=Math.round(e.translateValueToX(i,l,a,!1))-r,c=-e.margins.top,d=e.grid.yAxis,h=Math.round(e.translateValueToY(d.max,d.max,d.min,!1))-c;return new s.DrawableRectangle({position:new n.Vector2D(r,c),size:new n.Vector2D(o,h),style:{fillStyle:"red",opacity:1}})})}return e}}),define("classes/canvas_grid_chart",["require","exports","classes/canvas_chart_utils","graphics_utilities","xstream","event_bus","classes/canvas_chart_grid_helpers","classes/canvas_chart_grid_ticks","classes/canvas_chart_grid_range","classes/canvas_chart"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CANVAS_GRID_CHART_LAYER_TYPE=Object.assign({},c.CANVAS_CHART_LAYER_TYPE,{GRID:"GRID",AXIS:"AXIS",CUT_OFF:"CUT_OFF",AXIS_LABELS:"AXIS_LABELS",DRAGGING_OVERLAY:"DRAGGING_OVERLAY",GRADIENT_LEGEND:"GRADIENT_LEGEND"});const d=new Image;let h;const u=new Promise(e=>{d.onload=(()=>{h=new s.Pattern(d,s.PATTERN_REPEAT.REPEAT),e()})});d.src="/app/assets/images/cutoff.png";class p extends c.CanvasChart{constructor(e,i){if(super(e,Object.assign({},i,{layerConfigs:Object.assign({},i.layerConfigs?i.layerConfigs:{},{[t.CANVAS_GRID_CHART_LAYER_TYPE.CUT_OFF]:{enableInteractions:!0}})})),this.clearableLabels=[],this.graphSlicingPaused=!1,this.setMissingOptions(),(!0!==i.hideGrid||i.enforceGridMargins)&&(this.margins.gridOffsetBottom=18),i.enableGraphSlicer&&e.model.grid.xAxis instanceof a.CanvasChartGridTicks){e.model.grid.xAxis.ticks[0].hasTimeStamp&&this.enableGraphSlicer()}let s;const n=()=>s;this.options.synchronizeLeftGridMargins&&(s=this.computeGridOffsetLeft(e),p.gridOffsetLeftGetters.push(n),this.disposeToken.addCleanupFunction(()=>{p.gridOffsetLeftGetters.splice(p.gridOffsetLeftGetters.indexOf(n),1)}));const r=this.dataStream.map(e=>{if(this.options.synchronizeLeftGridMargins){const t=s;(s=this.computeGridOffsetLeft(e))!==t&&(p.gridOffsetLeftGetters.splice(p.gridOffsetLeftGetters.indexOf(n),1),s=Math.max(...p.gridOffsetLeftGetters.map(e=>e()),s),p.gridOffsetLeftGetters.push(n)),e.gridOffsetLeft=Math.max(...p.gridOffsetLeftGetters.map(e=>e()))}else e.gridOffsetLeft=this.computeGridOffsetLeft(e);return this.grid=e.model.grid,e});this.dataStream=this.handleGrid(r)}setMissingOptions(){void 0===this.options.yAxis?this.options.yAxis={hideLabels:!1,hideDashedLines:!1,hideBaseLine:!1,hideZeroLine:!1,hideZeroLabel:!1,centerLabelsOnBaseline:!1,centerLabelsOnDashedLines:!1,labelMargin:0}:this.options.yAxis={hideLabels:this.options.yAxis.hideLabels||!1,hideDashedLines:this.options.yAxis.hideDashedLines||!1,hideBaseLine:this.options.yAxis.hideBaseLine||!1,hideZeroLine:this.options.yAxis.hideZeroLine||!1,hideZeroLabel:this.options.yAxis.hideZeroLabel||!1,centerLabelsOnBaseline:this.options.yAxis.centerLabelsOnBaseline||!1,centerLabelsOnDashedLines:this.options.yAxis.centerLabelsOnDashedLines||!1,labelMargin:this.options.yAxis.labelMargin||0},void 0===this.options.xAxis?this.options.xAxis={hideLabels:!1,hideDashedLines:!1,hideBaseLine:!1,hideZeroLine:!1,startLinesAtMargin:!1,labelMargin:0}:this.options.xAxis={hideLabels:this.options.xAxis.hideLabels||!1,hideDashedLines:this.options.xAxis.hideDashedLines||!1,hideBaseLine:this.options.xAxis.hideBaseLine||!1,hideZeroLine:this.options.xAxis.hideZeroLine||!1,startLinesAtMargin:this.options.xAxis.startLinesAtMargin||!1,labelMargin:this.options.xAxis.labelMargin||0},this.options.layerConfigs||(this.options.layerConfigs={})}handleLayers(e){const i=super.handleLayers(e);return this.options.putAxisLayerOnTop&&i.splice(i.indexOf(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS),1),i.splice(i.indexOf(t.CANVAS_GRID_CHART_LAYER_TYPE.CUT_OFF),1),i.splice(i.indexOf(t.CANVAS_GRID_CHART_LAYER_TYPE.DRAGGING_OVERLAY),1),i.push(t.CANVAS_GRID_CHART_LAYER_TYPE.CUT_OFF),this.options.putAxisLayerOnTop&&i.push(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS),i.push(t.CANVAS_GRID_CHART_LAYER_TYPE.DRAGGING_OVERLAY),i}handleGrid(e){let s,a,l,c,d,p,g,m,f=0;const y=e=>(f=e.model.checkSum,s=e.size.x,a=e.size.y,this.logarithmicX=e.model.logarithmicX,this.logarithmicY=e.model.logarithmicY,e);let b=!1;const E=e=>(b=s!==e.size.x||a!==e.size.y,e.model.checkSum!==f||s!==e.size.x||a!==e.size.y||this.logarithmicX!==e.model.logarithmicX||this.logarithmicY!==e.model.logarithmicY);return n.Stream.create({start:s=>{n.Stream.merge(e.filter(e=>!E(e)).map(y),e.filter(e=>!!E(e)||(this.reRender(),!1)).map(y).map(e=>(this.margins.gridOffsetLeft=e.gridOffsetLeft||0,this.calculateChartDimensions(),{data:e,animationDuration:this.options.initialAnimationDuration,isAnimationEnabled:this.options.initialAnimationEnabled,chartWidth:this.chartSize.x,chartHeight:this.chartSize.y,sizeChanged:b,translateValueToY:this.translateValueToY.bind(this),translateValueToX:this.translateValueToX.bind(this),getXAxisCoordinate:this.getXAxisCoordinate.bind(this),getYAxisCoordinate:this.getYAxisCoordinate.bind(this),margins:this.margins,numberFormatter:this.lowPrecisionFormatter,buildId:_.uniqueId(),timeInterval:e.model.timeInterval,isLogarithmic:e.model.logarithmicY||e.model.logarithmicX,options:Object.assign({},this.options,{xAxis:this.options.xAxis?Object.assign({},this.options.xAxis):void 0}),grid:e.model.grid,oldRangeLines:l,oldTickLines:c,oldXAxis:d,oldYAxis:p,oldYAxis2Labels:m,gradientLegendItems:e.model.gradientLegendItems||[],oldGradientLegend:g,cutOffs:void 0,events:e.model.events||[],showDaySeparators:"h1"===e.model.timeInterval&&this.options.showDaySeparators||!1,showAllTicks:this.options.showAllTicks||!1,container:this.getContainer()})).map(o.createCutOffs).map(o.createGridLines).map(o.getTransitionConfiguration).map(o.createGradientLegend).map(o.createAnimations).map(async e=>{for(const e of this.clearableLabels)await this.clearDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS_LABELS,e);this.clearableLabels.length=0;const[i,s,n,o,a,_]=e.renderData;return e.grid&&!e.options.hideGrid&&(this.handleAxes(e),await this.handleLineRenderData(e),this.handleAxisLabels(e)),e.gradientLegendItems.length>0&&(this.clearDrawables(t.CANVAS_GRID_CHART_LAYER_TYPE.GRADIENT_LEGEND),this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.GRADIENT_LEGEND,e.gradientLegend),g=e.gradientLegend),await this.clearDrawables(t.CANVAS_GRID_CHART_LAYER_TYPE.CUT_OFF),e.cutOffs&&(await u,e.cutOffs.forEach(i=>{e.data.model.cutOffMessage&&(i.on("mouseenter",()=>{if(0===this.getDrawablesForLayer(t.CANVAS_GRID_CHART_LAYER_TYPE.DRAGGING_OVERLAY).length){const t=$(e.container).find("canvas").offset(),s=t.left+i.position.x+i.width+20+e.margins.left-1,n=t.top;r.eventBus.dispatch({type:r.EVENT_TYPES.SHOW_CANVAS_CUTOFF_MESSAGE,value:{title:e.data.model.cutOffMessage.title,content:e.data.model.cutOffMessage.content,element:e.container,x:s,y:n,height:i.height}})}}),i.on("mouseleave",()=>{r.eventBus.dispatch({type:r.EVENT_TYPES.HIDE_CANVAS_CUTOFF_MESSAGE,value:void 0})})),i.styleData.fillStyle=h,this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.CUT_OFF,i)})),e.grid&&!e.options.hideGrid&&(e.transitionsConfig.reRenderLines?(l=i,c=s):(e.transitionsConfig.transitionRangeLabels&&(l.labels=i.labels),e.transitionsConfig.transitionTickLabels&&(c.labels=s.labels,c.verticalLabels=s.verticalLabels)),void 0===d&&(d=n),void 0===p&&(p=o),(void 0===m||e.transitionsConfig.transitionYAxis2)&&(m=_)),this.addTweens(a),e.data})).subscribe(i.CanvasChartUtils.createStreamListener(async e=>{const t=await e;s.next(t)}))},stop:()=>{}})}handleAxes(e){const[,,i,s]=e.renderData;e.transitionsConfig.transitionXAxis||this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS,i),e.transitionsConfig.transitionYAxis||this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS,s)}async handleLineRenderData(e){const[i,s]=e.renderData;e.transitionsConfig.reRenderLines&&(await this.clearDrawables(t.CANVAS_GRID_CHART_LAYER_TYPE.GRID),[i.lines,s.lines].forEach(e=>this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.GRID,e)))}handleAxisLabels(e){const[i,s,,,,n]=e.renderData;(void 0===e.oldTickLines||e.transitionsConfig.transitionTickLabels)&&[s.labels,s.verticalLabels].forEach(e=>{this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS_LABELS,e)}),(void 0===e.oldRangeLines||e.transitionsConfig.transitionRangeLabels)&&this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS_LABELS,i.labels),n&&this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.AXIS_LABELS,n),e.transitionsConfig.transitionRangeLabels&&this.clearableLabels.push(e.oldRangeLines.labels),e.transitionsConfig.transitionTickLabels&&(this.clearableLabels.push(e.oldTickLines.labels),this.clearableLabels.push(e.oldTickLines.verticalLabels))}pauseGraphSlicing(){this.graphSlicingPaused=!0}resumeGraphSlicing(){this.graphSlicingPaused=!1}enableGraphSlicer(){let e;const s=this.dataStream.subscribe(i.CanvasChartUtils.createStreamListener(s=>{void 0!==e&&e._stopNow();const n=(e=o.createMouseDraggingStream(this.getContainer(),this.margins,s.model.grid.xAxis,(e,t)=>{void 0!==e&&void 0!==t&&e!==t&&r.eventBus.dispatch({type:r.EVENT_TYPES.SLICED_DRILLDOWN,value:{id:s.model.id,start:e,end:t,container:this.getContainer()}})},()=>this.graphSlicingPaused)).subscribe(i.CanvasChartUtils.createStreamListener(async e=>{await this.clearDrawables(t.CANVAS_GRID_CHART_LAYER_TYPE.DRAGGING_OVERLAY),e.forEach(e=>this.addDrawable(t.CANVAS_GRID_CHART_LAYER_TYPE.DRAGGING_OVERLAY,e)),this.reRender()}));this.disposeToken.addCleanupFunction(()=>{n.unsubscribe()})}));this.disposeToken.addCleanupFunction(()=>{s.unsubscribe()})}getMaxLabelWidth(e){let t=0;if(!this.options.yAxis||!1===this.options.yAxis.hideLabels)if(e&&e.yAxis instanceof a.CanvasChartGridTicks){e.yAxis.ticks.forEach(e=>{t=Math.max(t,o.getTextWidth(e.formattedLabel.trim()))})}else if(e&&e.yAxis instanceof l.CanvasChartGridRange){const i=e.yAxis;let s=i.percentageBased?this.lowPrecisionFormatter.toPercentage(Math.round(i.max)/100):this.lowPrecisionFormatter.toDecimal(Math.round(i.max));i.min<0&&(s+="-"),t=o.getTextWidth(s)}return t}computeGridOffsetLeft(e){const t=e.model.grid;if(t&&(!this.options.hideGrid||this.options.enforceGridMargins)){const i=this.getMaxLabelWidth(t);return this.options.yAxis.centerLabelsOnBaseline?30:i>0?Math.max(o.getTextWidth(o.formatRangeValue(this.lowPrecisionFormatter,t.range,{base:t.range.min,logarithmic:t.range.min},e.model.logarithmicY)),Math.min(e.size.x/4+20,i+20)):o.getTextWidth(o.formatRangeValue(this.lowPrecisionFormatter,t.range,{base:t.range.min,logarithmic:t.range.min},e.model.logarithmicY))}return 0}getGridCoordinate(e,t,i=this.logarithmicY,s=this.logarithmicX){return[this.getXAxisCoordinate(e,s),this.getYAxisCoordinate(t,i)]}getXAxisCoordinate(e,t=this.logarithmicX){const i=this.grid.xAxis instanceof l.CanvasChartGridRange,s=this.grid.range,n=this.grid.ticks;return i?this.translateValueToX(e,s.max,s.min,t):this.translateValueToX(e,_.last(n.ticks).value,_.first(n.ticks).value,t)}getYAxisCoordinate(e,t=this.logarithmicY){const i=this.grid.yAxis instanceof l.CanvasChartGridRange,s=this.grid.range,n=this.grid.ticks;return i?this.chartSize.y-this.translateValueToY(e,s.max,s.min,t):this.chartSize.y-this.translateValueToY(e,_.last(n.ticks).value,_.first(n.ticks).value,t)}}p.gridOffsetLeftGetters=[],t.CanvasGridChart=p}),define("abstract_canvas_chart",["require","exports","classes/abstract_canvas_chart_container","classes/abstract_canvas_chart_react_container","classes/canvas_chart","classes/canvas_chart_grid_range","classes/canvas_chart_grid_ticks","classes/canvas_chart_layer","classes/canvas_chart_margins","classes/canvas_chart_renderer","classes/canvas_chart_utils","classes/canvas_grid_chart","classes/canvas_grid_chart_model","classes/interfaces"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p){"use strict";function g(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),g(i),g(s),g(n),g(r),g(o),g(a),g(l),g(c),g(d),g(h),g(u),g(p)}),define("classes/canvas_chart_vector_pool",["require","exports","object_pool","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vectorPool=new i.Pool({initialSize:0,dynamic:!0,factory:()=>s.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_canvas_chart"})}),define("interfaces/activity_chart_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/activity_chart_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/activity_chart_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/activity_chart",["require","exports","abstract_canvas_chart","graphics_utilities","math_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=4,o=7.5,a=12.5,l=5;t.activityChartLayerType=Object.assign({},i.CANVAS_GRID_CHART_LAYER_TYPE,{BUBBLES:"BUBBLES"});t.ActivityChart=class extends i.CanvasGridChart{constructor(e,i,s){super(e,Object.assign({},i,{layers:t.activityChartLayerType,layerConfigs:{[t.activityChartLayerType.BUBBLES]:{enableInteractions:!0}}})),this.colorPalette=s,this.bubbles=[]}initialize(){this.dataStream.subscribe(i.CanvasChartUtils.createStreamListener(e=>this.redraw(e))),this.disposeToken.addCleanupFunction(()=>{this.afterUpdate.fire()})}async redraw(e){this.activityChartModel=this.hasReplayEnabled?e.model.frames[0]:e.model,this.activityChartFrames=e.model.frames,await this.clearDrawables(t.activityChartLayerType.BUBBLES),this.activityChartModel.activities.forEach((e,t)=>{e.forEach((e,i)=>{this.drawBubble(e.value,t,i),this.hasReplayEnabled&&this.addBubbleReplayStates(t,i)})}),this.afterUpdate.fire()}drawBubble(e,i,s){const n=this.getDrawableAtCoordinates(i,s),r=n.radius,o=0!==r||this.options.initialAnimationEnabled&&this.options.initialAnimationDuration>0,l=this.valueToRadius(e),c=this.valueToColor(e),d=this.options.initialAnimationDuration/a*Math.abs(l-r);n.position.x=this.getXAxisCoordinate(i),n.position.y=this.getYAxisCoordinate(s)+1,n.styleData.fillStyle=c.clone(),n.styleData.strokeStyle=c.clone().setOpacity(.4),n.radius=l,this.addDrawable(t.activityChartLayerType.BUBBLES,n),o&&this.addTweens([{drawable:n,object:n,key:"radius",targetValue:l,initialValue:r,duration:d}])}addBubbleReplayStates(e,t){const i=this.getDrawableAtCoordinates(e,t),s=[],n=[],r=[],o=[];this.activityChartFrames.forEach((i,a)=>{const l=i.activities[e][t].value,c=this.valueToColor(l,i.min,i.max);s.push(this.valueToRadius(l,i.min,i.max)),n.push(c.r),r.push(c.g),o.push(c.b)}),this.addReplayStates(i,"radius",s),this.addReplayStates(i,"styleData.fillStyle.r",n),this.addReplayStates(i,"styleData.fillStyle.g",r),this.addReplayStates(i,"styleData.fillStyle.b",o),this.addReplayStates(i,"styleData.strokeStyle.r",n),this.addReplayStates(i,"styleData.strokeStyle.g",r),this.addReplayStates(i,"styleData.strokeStyle.b",o)}updateReplayProgress(e){super.updateReplayProgress(e),this.activityChartModel=this.activityChartFrames[Math.floor(e*this.activityChartFrames.length)]}getMultiplierForValue(e,t,i){return t=t||this.activityChartModel.min,i=i||this.activityChartModel.max,void 0!==t&&void 0!==i&&t===i?1:(e-t)/(i-t)}valueToRadius(e,t,i){if(!e)return r;const s=this.getMultiplierForValue(e,t,i);return o+(a-o)*s}valueToColor(e,t,i){if(!e)return this.colorPalette.defaultBubbleColor;const n=this.getMultiplierForValue(e,t,i);return s.Color.lerp(this.colorPalette.lightBubbleColor,this.colorPalette.darkBubbleColor,n)}getDrawableAtCoordinates(e,t){return this.bubbles[e]||(this.bubbles[e]=[]),this.bubbles[e][t]||(this.bubbles[e][t]=new s.DrawableCircle({position:n.Vector2D.zero(),radius:0,style:{lineWidth:0},on:{mouseenter:i=>this.onMouseEnterBubble(i,e,t),mouseleave:i=>this.onMouseLeaveBubble(i,e,t)}})),this.bubbles[e][t]}onMouseEnterBubble(e,t,i){const s=this.bubbles[t][i],n=this.activityChartModel.activities[t][i],r=n.value,o=`${n.day} (${n.hour}:00)`,a=$(e.target).offset(),c=s.getBoundingBox(),d=a.left+c.width/2+c.x+this.margins.left-1,h=a.top+c.y+this.margins.top;this.openPopover(d,h,{header:o,node:{color:"",label:""},values:[{label:this.activityChartModel.totalLabel,value:r,formatted_value:isNaN(r)?"n/a":r.toString()}]}),this.abortAnimations(s).tweenDrawable(s,"radius",this.valueToRadius(r)+l,200).tweenDrawable(s,"styleData.lineWidth",10,200).animate()}onMouseLeaveBubble(e,t,i){const s=this.bubbles[t][i],n=this.activityChartModel.activities[t][i].value;this.closePopover(),this.abortAnimations(s).tweenDrawable(s,"radius",this.valueToRadius(n),200).tweenDrawable(s,"styleData.lineWidth",0,200).animate()}}}),define("classes/activity_chart_color_palette_builder",["require","exports","reusable_utilities","graphics_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ActivityChartColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){return this.themeId,this.buildLightColorPalette()}buildLightColorPalette(){return{defaultBubbleColor:s.Color.fromHex("#CCDFE8"),lightBubbleColor:s.Color.fromHex("#66A0B9"),mediumBubbleColor:s.Color.fromHex("#3281A1"),darkBubbleColor:s.Color.fromHex("#00618A")}}}}),define("activity_chart",["require","exports","classes/activity_chart","classes/activity_chart_color_palette_builder"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("annotations/ng_async",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ngAsync=function(){return(e,t)=>(function(e,t){const i=e[t];return{value:function(...e){return window.tw.inject("$q").when(i.apply(this,e))}}})(e,t)}}),define("annotations/ng_inject",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ngInject=function(e){return t=>(function(e,t){e.$inject=t})(t,e)}}),define("directive_service",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.lazyLoadCatalog={}}enableLazyLoad(e,t){this.compileProvider=e,this.injector=t}addLazyLoadableDirectives(e){this.lazyLoadCatalog=Object.assign({},this.lazyLoadCatalog,e)}isLazyLoadingEnabled(){return void 0!==this.compileProvider}async inject(e,t,s,n){this.isLazyLoadingEnabled()&&await this.checkLazyLoad(s);let r=n.parentScope;n.noScope||(r=r.$new(!0));const o=i.uniqueId("$$args");r[o]={},this.injectArguments(n.directiveArguments,r,o);const a={template:e(this.getTemplate(s,n))(r),parentScope:n.parentScope,scope:r};return n.replaceParent?t.replaceWith(a.template):t.append(a.template),a}interpolateParams(e,t){return e.map(e=>0===e.indexOf("{{::")&&e.indexOf("}}")===e.length-2?e.substring(4,e.length-2).split(".").reduce((e,t)=>e[t],t):0===e.indexOf("{{")&&e.indexOf("}}")===e.length-2?e.substring(2,e.length-2).split(".").reduce((e,t)=>e[t],t):e)}injectArguments(e,t,s){Object.keys(e).forEach((n,r)=>{i.isString(e[n])||(t[s]["arg"+r]=e[n],e[n]=`${s}.arg`+r)})}parseArgs(e){return Object.keys(e).map(t=>`${t}="${e[t]}"`).join(" ")}getTemplate(e,t){const i=this.parseArgs(t.directiveArguments||{});return t.directiveAsElement?`<${e} ${i}></${e}>`:`<div ${e} ${i}></div>`}async checkLazyLoad(e){if(e=e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),!this.injector.has(e+"Directive")&&this.lazyLoadCatalog[e]){const t=await this.lazyLoadCatalog[e]();this.compileProvider.directive(e,t.default||t),delete this.lazyLoadCatalog[e]}}}t.DirectiveService=s,t.directiveService=new s}),define("directive_deployer",["require","exports","directive_service"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.directiveDeployer=function(){return{restrict:"E",scope:!1,controller:["$compile","$element","$scope",(e,t,s)=>{const n={};for(const e of t[0].attributes)"directive"!==e.nodeName&&(n[e.nodeName]=e.nodeValue);i.directiveService.inject(e,t,i.directiveService.interpolateParams([t.attr("directive")],s)[0],{parentScope:s,replaceParent:!0,directiveAsElement:!0,directiveArguments:n,noScope:!0})}]}}}),define("angular_utilities",["require","exports","annotations/ng_async","annotations/ng_inject","directive_deployer","directive_service"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("actions/article_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArticleActions={article_onPayloadRefresh:"article_onPayloadRefresh",article_onTriggerLoadMore:"article_onTriggerLoadMore",article_onLoadMore:"article_onLoadMore",article_onCustomPagesUpdate:"article_onCustomPagesUpdate",article_onKeyPressed:"article_onKeyPressed",article_onArrowKeyPressed:"article_onArrowKeyPressed",article_onApplyScore:"article_onApplyScore",article_onApplySentiment:"article_onApplySentiment",article_onToggleImportant:"article_onToggleImportant",article_onToggleTag:"article_onToggleTag",article_onEntryClicked:"article_onEntryClicked",article_onChildEntryClicked:"article_onChildEntryClicked",article_onArticleDeleted:"article_onArticleDeleted",article_onReceiveChildArticles:"article_onReceiveChildArticles",article_onResizeContainer:"article_onResizeContainer",article_onClickOutsideContainer:"article_onClickOutsideContainer",article_onNavigateCarousel:"article_onNavigateCarousel",article_onContextMenuButtonClick:"article_onContextMenuButtonClick",article_onContextMenuClose:"article_onContextMenuClose",article_onAddToCustomPage:"article_onAddToCustomPage",article_onAddCustomTag:"article_onAddCustomTag",article_onRemoveTag:"article_onRemoveTag",article_onReportImageMismatch:"article_onReportImageMismatch",article_onShareUrlClick:"article_onShareUrlClick",article_onRefreshContextMenu:"article_onRefreshContextMenu",article_onContainerWidthChange:"article_onContainerWidthChange",article_onConvertArticleToTopic:"article_onConvertArticleToTopic",article_onOpenSourcePanel:"article_onOpenSourcePanel",article_onWidgetBlur:"article_onWidgetBlur",article_onRedraw:"article_onRedraw",article_onSendEmail:"article_onSendEmail"},t.ArticleMediatorActions={ARTICLE_SELECTION_CHANGE:"ARTICLE_SELECTION_CHANGE"}}),define("utilities/article_payload_map",["require","exports","map"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticlePayloadMap=class extends i.Map{set(e,t){return super.set(e,t),this}}}),define("stores/article_store",["require","exports","flux","generic_selection","reusable_components","underscore","actions/article_actions","utilities/article_payload_map"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends i.BaseStore{constructor(e){if(super([o.ArticleActions.article_onPayloadRefresh,o.ArticleActions.article_onLoadMore,o.ArticleActions.article_onTriggerLoadMore,o.ArticleActions.article_onNavigateCarousel,o.ArticleActions.article_onKeyPressed,o.ArticleActions.article_onEntryClicked,o.ArticleActions.article_onApplyScore,o.ArticleActions.article_onContainerWidthChange,o.ArticleActions.article_onArrowKeyPressed,o.ArticleActions.article_onToggleImportant,o.ArticleActions.article_onToggleTag,o.ArticleActions.article_onArticleDeleted,o.ArticleActions.article_onChildEntryClicked,o.ArticleActions.article_onReceiveChildArticles,o.ArticleActions.article_onResizeContainer,o.ArticleActions.article_onClickOutsideContainer,o.ArticleActions.article_onContextMenuButtonClick,o.ArticleActions.article_onContextMenuClose,o.ArticleActions.article_onRemoveTag,o.ArticleActions.article_onReportImageMismatch,o.ArticleActions.article_onAddCustomTag,o.ArticleActions.article_onAddToCustomPage,o.ArticleActions.article_onShareUrlClick,o.ArticleActions.article_onConvertArticleToTopic,o.ArticleActions.article_onOpenSourcePanel,o.ArticleActions.article_onWidgetBlur,o.ArticleActions.article_onRedraw,o.ArticleActions.article_onSendEmail,n.SourceActionsMenuActions.sourceActionsMenu_onApplyInfluenstar,n.SourceActionsMenuActions.sourceActionsMenu_onApplyFavorite,n.SourceActionsMenuActions.sourceActionsMenu_onIncludeInPanel,n.SourceActionsMenuActions.sourceActionsMenu_onAddPanel,n.GenericActions.generic_onClickUrlAndSetRead,n.GenericActions.generic_onOpenContextPage,n.GenericActions.generic_onRemoveArticlesBySources,n.GenericActions.generic_onToggleChildFilter,n.GenericActions.generic_onTriggerChildrenLoadmore,n.GenericActions.generic_onTriggerTranslationToggle,n.GenericActions.generic_onToggleEntryUserWorkflow,n.GenericActions.generic_onApplySentiment,n.GenericActions.generic_onToggleImportant,n.GenericActions.generic_onReportImageMismatch]),void 0===e)throw new Error("storeObject is necessary");this.storeObject=e,this.payloadMap=new a.ArticlePayloadMap,this.selectionMap={},l.store=this}static getInstance(){return l.store}onPayloadRefresh(e){this.payloadMap.set(e.widgetId,e.payload),this.customPages=e.customPages,this.storeObject&&this.storeObject.onPayloadRefresh&&this.storeObject.onPayloadRefresh(this,e),this.onChange.fire({widgetId:e.widgetId,action:o.ArticleActions.article_onPayloadRefresh,payload:this.getPayload(e.widgetId),settings:e.settings})}onContainerWidthChange(e){this.onChange.fire({widgetId:e.widgetId,action:o.ArticleActions.article_onContainerWidthChange,settings:e.settings})}onLoadMore(e){this.payloadMap.set(e.widgetId,this.mergePayloads(this.payloadMap.get(e.widgetId),e.payload)),this.onChange.fire({widgetId:e.widgetId,action:o.ArticleActions.article_onLoadMore,payload:this.getPayload(e.widgetId),settings:e.settings})}onTriggerLoadMore(e){void 0!==e.widgetId&&(this.storeObject&&this.storeObject.onTriggerLoadMore&&this.storeObject.onTriggerLoadMore(this,{widgetId:e.widgetId,forward:!0,keepPayload:!0}),this.onChange.fire({widgetId:e.widgetId,action:o.ArticleActions.article_onTriggerLoadMore,payload:this.getPayload(e.widgetId)}))}onContextMenuButtonClick(e){const t=this.getPayload(e.widgetId);let i=this.getSelection(e.widgetId);const n=this.findEntryById(t,e.entryId);if(n){if(r.isEmpty(n))return;if(!n.selected){const e=r.findIndex(t.articles,e=>e.entry_id===n.entry_id);(i=new s.Selection(t.articles)).clear(),i.toggle(e,!1,!1)}this.selectionMap[e.widgetId]=i,this.contextMenuState={open:!0,selection:i},this.onChange.fire({action:o.ArticleActions.article_onContextMenuButtonClick,entryId:n.entry_id,widgetId:e.widgetId})}}onContextMenuClose(e){this.contextMenuState={open:!1},this.onChange.fire({action:o.ArticleActions.article_onContextMenuClose,widgetId:e.widgetId})}onEntryClicked(e){const t=e.event.nativeEvent;let i=this.getSelection(e.widgetId);const n=this.getPayload(e.widgetId);(!i||i.getList()!==n.articles)&&(i=new s.Selection(n.articles)).clear();const a=r.findIndex(n.articles,t=>t.entry_id===e.entryId);i.toggle(a,t.ctrlKey||t.metaKey,t.shiftKey),this.selectionMap[e.widgetId]=i,this.onChange.fire({action:o.ArticleActions.article_onEntryClicked,widgetId:e.widgetId,entryId:e.entryId,selection:i})}onChildEntryClicked(e){const t=e.event,i=t.nativeEvent;let n=this.getSelection(e.widgetId);const a=this.getPayload(e.widgetId),l=r.find(a.articles,t=>t.entry_id===e.entryId);let c=[];void 0!==l&&(c=l.comment_articles.length>0?l.comment_articles:l.cluster_articles),(!n||n.getList()!==c)&&(n=new s.Selection(c)).clear();const d=r.findIndex(c,t=>t.entry_id===e.commentId);n.toggle(d,i.ctrlKey||i.metaKey,i.shiftKey),this.selectionMap[e.widgetId]=n,this.onChange.fire({action:o.ArticleActions.article_onChildEntryClicked,widgetId:e.widgetId,entryId:e.entryId,selection:n}),t.preventDefault(),i.preventDefault(),t.stopPropagation(),i.stopPropagation()}onArticleDeleted(e){this.storeObject&&this.storeObject.onArticleDeleted&&this.storeObject.onArticleDeleted(this,{delete:e.delete,widgetId:e.widgetId,selection:this.getSelection(e.widgetId),canRemoveComments:e.canRemoveComments}).then(t=>{this.payloadMap.forEach((e,i)=>{let s=e.articles;r.each(t,e=>{s=s.filter(t=>t.hash!==e.hash)});const n=this.payloadMap.get(i);n.articles=s,this.payloadMap.set(i,n)}),this.onChange.fire({action:o.ArticleActions.article_onArticleDeleted,widgetId:e.widgetId,payload:this.getPayload(e.widgetId)})},()=>void 0)}onAddToCustomPage(e){const{widgetId:t,selectedEntry:i}=e;this.storeObject.onAddToReport({widgetId:t,selection:this.getSelection(e.widgetId),selectedEntry:i}),this.onChange.fire({action:o.ArticleActions.article_onAddToCustomPage,widgetId:e.widgetId,payload:this.getPayload(e.widgetId)})}onKeyPressed(e){this.handleKeyPress(e),this.storeObject&&this.storeObject.onKeyPressed?this.storeObject.onKeyPressed(this,{keys:e.keys,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)}).then(()=>{this.onChange.fire({action:o.ArticleActions.article_onKeyPressed,widgetId:e.widgetId,keys:e.keys,selection:this.getSelection(e.widgetId)})},()=>void 0):this.onChange.fire({action:o.ArticleActions.article_onKeyPressed,widgetId:e.widgetId,keys:e.keys,selection:this.getSelection(e.widgetId)})}onArrowKeyPressed(e){this.handleArrowKeyPress(e),this.storeObject&&this.storeObject.onArrowKeyPressed?this.storeObject.onArrowKeyPressed(this,{key:e.key,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)}).then(()=>{this.onChange.fire({action:o.ArticleActions.article_onArrowKeyPressed,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})},()=>void 0):this.onChange.fire({action:o.ArticleActions.article_onArrowKeyPressed,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})}onApplyScore(e){this.storeObject&&this.storeObject.onApplyScore?this.storeObject.onApplyScore(this,{widgetId:e.widgetId,score:e.score,selection:this.getSelection(e.widgetId)}).then(()=>{this.onChange.fire({action:o.ArticleActions.article_onApplyScore,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})},()=>void 0):this.onChange.fire({action:o.ArticleActions.article_onApplyScore,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})}onApplySentiment(e){if(this.storeObject&&this.storeObject.onApplySentiment){const t={widgetId:e.widgetId,sentiment:e.sentiment,selection:this.getSelection(e.widgetId),canTagComments:e.canTagComments};this.storeObject.onApplySentiment(this,t).then(()=>{e.canTagComments&&this.changeTagMatchingComments({enabled:t.tagComments}),this.onChange.fire({action:o.ArticleActions.article_onApplySentiment,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})},()=>void 0)}else this.onChange.fire({action:o.ArticleActions.article_onApplySentiment,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})}articleOnApplySentiment(e){this.onApplySentiment(e)}onToggleImportant(e){if(this.storeObject&&this.storeObject.onToggleImportant){const t={widgetId:e.widgetId,selection:this.getSelection(e.widgetId),canTagComments:e.canTagComments};this.storeObject.onToggleImportant(this,t).then(()=>{e.canTagComments&&this.changeTagMatchingComments({enabled:t.tagComments}),this.onChange.fire({action:o.ArticleActions.article_onToggleImportant,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})},()=>void 0)}else this.onChange.fire({action:o.ArticleActions.article_onToggleImportant,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})}onToggleTag(e){if(this.storeObject&&this.storeObject.onToggleTag){const t={widgetId:e.widgetId,selection:this.getSelection(e.widgetId),tag:e.tag,canTagComments:e.canTagComments};this.storeObject.onToggleTag(this,t).then(()=>{e.canTagComments&&this.changeTagMatchingComments({enabled:t.tagComments}),this.onChange.fire({action:o.ArticleActions.article_onToggleTag,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})},()=>void 0)}else this.onChange.fire({action:o.ArticleActions.article_onToggleTag,widgetId:e.widgetId,selection:this.getSelection(e.widgetId)})}onClickUrlAndSetRead(e){const{url:t,safeRedirectUrl:i,widgetId:s,entryId:r}=e,o=void 0!==i?i:t;void 0!==o&&window.open(o,"_blank"),this.storeObject&&this.storeObject.onClickUrlAndSetRead?this.storeObject.onClickUrlAndSetRead(this,e).then(()=>{this.onChange.fire({action:n.GenericActions.generic_onClickUrlAndSetRead,widgetId:s,entryId:r})},()=>void 0):this.onChange.fire({action:n.GenericActions.generic_onClickUrlAndSetRead,widgetId:s,entryId:r})}onOpenContextPage(e){this.storeObject&&this.storeObject.onOpenContextPage&&this.storeObject.onOpenContextPage(this,e),this.onChange.fire({action:n.GenericActions.generic_onOpenContextPage,entryId:e.entryId,widgetId:e.widgetId,clusterId:e.clusterId,isComment:e.isComment})}onOpenSourcePanel(e){const t=this.getSelection(e.widgetId);this.contextMenuState={open:!0,selection:t},this.onChange.fire({action:o.ArticleActions.article_onOpenSourcePanel,widgetId:e.widgetId,sourcePanel:e.sourcePanel,entryId:t&&t.getFirst().entry_id})}onRemoveArticlesBySources(e){const t=this;this.payloadMap.forEach((i,s)=>{i.articles=this.storeObject.onRemoveArticlesBySources(this,{sources:e.sources,articles:i.articles,author:e.author}),t.onChange.fire({action:n.GenericActions.generic_onRemoveArticlesBySources,widgetId:s,payload:i})})}onToggleChildFilter(e){this.storeObject&&this.storeObject.onToggleChildFilter&&this.storeObject.onToggleChildFilter(this,e),this.onChange.fire({action:n.GenericActions.generic_onToggleChildFilter,entryId:e.entryId,widgetId:e.widgetId})}onTriggerChildrenLoadmore(e){if(this.storeObject&&this.storeObject.onTriggerChildrenLoadMore){const t=e;t.payload=this.getPayload(e.widgetId),this.storeObject.onTriggerChildrenLoadMore(this,t)}this.onChange.fire({action:n.GenericActions.generic_onTriggerChildrenLoadmore,entryId:e.entryId,widgetId:e.widgetId})}onTriggerTranslationToggle(e){e.showTranslation?this.handleShowTranslation(e.widgetId,e.entryId,e.targetLanguage):this.handleHideTranslation(e.widgetId,e.entryId)}onResizeContainer(e){this.onChange.fire({action:o.ArticleActions.article_onResizeContainer,widgetId:e.widgetId,payload:this.getPayload(e.widgetId),settings:e.settings})}onRedraw(e){this.onChange.fire({action:o.ArticleActions.article_onRedraw,widgetId:e.widgetId,payload:this.getPayload(e.widgetId),settings:e.settings})}handleShowTranslation(e,t,i){this.storeObject&&this.storeObject.onTriggerTranslationToggle?this.storeObject.onTriggerTranslationToggle(this,{widgetId:e,entryId:t,payload:this.getPayload(e),targetLanguage:i}).then(i=>{const s=this.getPayload(e);r.forEach(i,e=>{const t=r.find(s.articles,t=>t.entry_id===e.entry_id);t&&(r.assign(t,e),t.show_translation=!0)}),this.payloadMap.set(e,s),this.onChange.fire({action:n.GenericActions.generic_onTriggerTranslationToggle,entryId:t,widgetId:e,payload:this.getPayload(e)})},()=>void 0):this.onChange.fire({action:n.GenericActions.generic_onTriggerTranslationToggle,entryId:t,widgetId:e,payload:this.getPayload(e)})}handleHideTranslation(e,t){const i=this.getPayload(e),s=r.findIndex(i.articles,e=>e.entry_id===t);s>=0&&(i.articles[s].show_translation=!1,this.onChange.fire({action:n.GenericActions.generic_onTriggerTranslationToggle,entryId:t,widgetId:e,payload:i}))}onReceiveChildArticles(e){const t=e.widgetId;if(this.storeObject&&this.storeObject.onReceiveChildArticles){const i=e;i.oldPayload=this.getPayload(t);const s=this.storeObject.onReceiveChildArticles(this,i);this.payloadMap.set(t,s)}const i=this.getPayload(t),s=r.first(e.payload.articles),n=r.find(i.articles,t=>t.entry_id===e.entryId);s&&n&&(n.child_element_count=s.child_element_count,n.child_filter_label=s.child_filter_label,n.children_label=s.children_label),this.onChange.fire({action:o.ArticleActions.article_onReceiveChildArticles,widgetId:t,entryId:e.entryId,payload:this.getPayload(t),selection:this.getSelection(t)})}onToggleEntryUserWorkflow(e){this.storeObject&&this.storeObject.onToggleEntryUserWorkflow&&this.storeObject.onToggleEntryUserWorkflow(this,e).then(t=>{const i=this.getPayload(e.widgetId);if(i){const s=r.find(i.articles,t=>t.entry_id===e.entryId);s&&s.save_to_user_workflow_button&&(s.save_to_user_workflow_button.selected=t,s.save_to_user_workflow_button.click_action.saved_status=t,this.onChange.fire({action:n.GenericActions.generic_onToggleEntryUserWorkflow,widgetId:e.widgetId,entryId:e.entryId,payload:this.getPayload(e.widgetId)}))}},()=>void 0)}onReportImageMismatch(e){if(this.storeObject&&this.storeObject.onReportImageMismatch&&e.entryId){const t=r.find(this.getPayload(e.widgetId).articles,t=>t.entry_id===e.entryId);this.storeObject.onReportImageMismatch(this,{widgetId:e.widgetId,article:t})}this.onChange.fire({action:n.GenericActions.generic_onReportImageMismatch,widgetId:e.widgetId})}changeTagMatchingComments(e){this.payloadMap.forEach(t=>{t.tag_comments_in_threaded_view=e.enabled})}onNavigateCarousel(e){this.storeObject&&this.storeObject.onTriggerLoadMore&&this.storeObject.onTriggerLoadMore(this,{widgetId:e.widgetId,forward:e.isForward,keepPayload:!0}),this.onChange.fire({widgetId:e.widgetId,action:o.ArticleActions.article_onTriggerLoadMore,payload:this.getPayload(e.widgetId)})}onAddCustomTag(e){if(this.storeObject&&this.storeObject.onAddCustomTag){const t={widgetId:e.widgetId,tag:e.tag,selection:this.getSelection(e.widgetId),canTagComments:e.canTagComments};this.storeObject.onAddCustomTag(this,t).then(()=>{const i=e.tag;e.tag.code=e.tag.name,i&&!i.name.match(/^(10|\d)$/)&&this.payloadMap.forEach(s=>{const n=s.project_tags||[],o=r.findWhere(n,{name:i.name});r.isUndefined(o)&&(n.push(i),s.project_tags=n),e.canTagComments&&(s.tag_comments_in_threaded_view=t.tagComments)}),this.onChange.fire({action:o.ArticleActions.article_onAddCustomTag})},()=>void 0)}}onRemoveTag(e){if(this.storeObject&&this.storeObject.onRemoveTag){const t={widgetId:e.widgetId,tag:e.tag,selection:this.getSelection(e.widgetId),canTagComments:e.canTagComments};this.storeObject.onRemoveTag(this,t).then(()=>{e.canTagComments&&this.changeTagMatchingComments({enabled:t.tagComments}),this.onChange.fire({action:o.ArticleActions.article_onRemoveTag})},()=>void 0)}}onShareUrlClick(e){this.storeObject&&this.storeObject.onShareUrlClick&&(this.storeObject.onShareUrlClick(this,{widgetId:e.widgetId,shareUrl:e.shareUrl,selection:this.getSelection(e.widgetId)}),this.onChange.fire({action:o.ArticleActions.article_onShareUrlClick}))}onWidgetBlur(e){const t=this.getSelection(e.widgetId);t&&t.clear(),this.onChange.fire({action:o.ArticleActions.article_onWidgetBlur,widgetId:e.widgetId})}onConvertArticleToTopic(e){this.storeObject&&this.storeObject.onConvertArticleToTopic&&(this.storeObject.onConvertArticleToTopic(this,{widgetId:e.widgetId,selection:this.getSelection(e.widgetId)}).then(()=>{this.onChange.fire({action:o.ArticleActions.article_onConvertArticleToTopic,widgetId:e.widgetId})},()=>void 0),this.contextMenuState={open:!1},this.refreshContextMenu(e))}onApplyInfluenstar(e){this.refreshContextMenu(e)}onApplyFavorite(e){this.refreshContextMenu(e)}onIncludeInPanel(e){this.refreshContextMenu(e)}onAddPanel(e){this.contextMenuState={open:!1},this.refreshContextMenu(e)}onSendEmail(e){this.storeObject.onSendEmail(this,{widgetId:e.widgetId,selection:this.getSelection(e.widgetId)}).then(()=>{this.onChange.fire({action:o.ArticleActions.article_onSendEmail,widgetId:e.widgetId,listenFocus:!0})},()=>void 0),this.onChange.fire({action:o.ArticleActions.article_onSendEmail,widgetId:e.widgetId,listenFocus:!1})}refreshContextMenu(e){this.onChange.fire({action:o.ArticleActions.article_onRefreshContextMenu,widgetId:e.widgetId})}getEngagementChart(e){return this.storeObject.getEngagementChart(e)}getPayload(e){return this.payloadMap.get(e)}getSelection(e){return this.selectionMap[e]}getCustomPages(){return this.customPages}removePayload(e){this.payloadMap.delete(e)}isContextMenuOpen(){return this.contextMenuState&&!0===this.contextMenuState.open}isContextMenuOpenForSelection(e){return this.isContextMenuOpen()&&this.contextMenuState.selection===e}mergePayloads(e,t){return r.isEmpty(t.articles)?e.total=0:e.articles=t.articles.reduce((e,t)=>(e.push(t),e),e.articles||[]),e}findEntryById(e,t){return r.find(e.articles||[],e=>e.entry_id===t)}handleKeyPress(e){if(1===e.keys.length&&"escape"===e.keys[0]){const t=this.getSelection(e.widgetId);t&&t.clear()}}handleArrowKeyPress(e){const t=this.getSelection(e.widgetId);if(t)switch(e.key){case"up":t.selectPrevious(e.event.shiftKey),this.centerViewOnArticle(t.getLead());break;case"down":t.selectNext(e.event.shiftKey),this.centerViewOnArticle(t.getLead());break;case"left":this.selectParentEntry(t,e.widgetId);break;case"right":this.handleRightArrow(t,e.widgetId)}}hasChildEntries(e){return e.comment_articles&&e.comment_articles.length>0||e.cluster_articles&&e.cluster_articles.length>0}handleRightArrow(e,t){const i=this.getPayload(t).articles;e.get()!==i&&this.hasChildEntries(e.getLead())?this.selectChildEntries(e,t):this.openUrlForSelection(e,t)}selectParentEntry(e,t){const i=this.getPayload(t),n=e.getList();if(i.articles===n)return;const o=r.findIndex(i.articles,e=>e.comment_articles===n||e.cluster_articles===n);-1!==o&&((e=new s.Selection(i.articles)).clear(),e.toggle(o,!1,!1),this.selectionMap[t]=e,this.centerViewOnArticle(i.articles[o]))}selectChildEntries(e,t){const i=this.getPayload(t),n=e.getList();if(i.articles!==n)return;const r=e.getLead();let o;r.comment_articles&&r.comment_articles.length>0?o=r.comment_articles:r.cluster_articles&&r.cluster_articles.length>0&&(o=r.cluster_articles),o&&o.length>0&&((e=new s.Selection(o)).clear(),e.toggle(0,!1,!1),this.selectionMap[t]=e,this.centerViewOnArticle(e.getLead()))}centerViewOnArticle(e){if(e){const t=$("#"+e.hash);if(t&&t.length>0){const e=t.offset().top-$(window).height()/2;$(window).scrollTop(e)}}}openUrlForSelection(e,t){e&&e.get().length>0&&e.get().forEach(e=>{if(e.navigate_action){e.navigate_action.widget_id=t;const i=n.ClickActionFactory.create(e.navigate_action);i&&i()}})}}__decorate([i.waitFor([n.SourceActionsMenuStore]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],l.prototype,"onApplyInfluenstar",null),__decorate([i.waitFor([n.SourceActionsMenuStore]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],l.prototype,"onApplyFavorite",null),__decorate([i.waitFor([n.SourceActionsMenuStore]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],l.prototype,"onIncludeInPanel",null),t.ArticleStore=l}),define("models/articles_keyboard_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("factories/keypress_factory",["require","exports","underscore","flux","actions/article_actions","reusable_components","stores/article_store"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeypressEvents={on_keyup:"on_keyup",on_keydown:"on_keydown",on_keypress:"on_keypress"};t.KeypressFactory=class{static destroyListener(e){e.reset(),e.stop_listening(),e.destroy()}static registerCombo(e,i,s,n){const r={keys:i=""+i};r[n.event||t.KeypressEvents.on_keydown]=(e=>(n.preventDefault&&e.preventDefault(),s.call(this,i.split(" "),e))),r.is_exclusive=n.isExclusive,r.is_solitary=n.isSolitary,e.register_combo(r)}static createCombo(e,t,s,n,r={}){if(n)i.forEach(i.flatten([t]),t=>{this.registerCombo(e,t,s,r)});else{const n=t;this.registerCombo(e,i.flatten(n).join(" "),s,r)}}static createScoreShortcut(e,t,i,r){this.createCombo(e,t,(e,t)=>{const a=o.ArticleStore.getInstance().getSelection(i);return a&&a.get().length>0&&(this.isContextMenuOpen()||s.dispatcher.dispatch(n.ArticleActions.article_onApplyScore,{score:r,widgetId:i})),!0},!0)}static createQuickTagShortcut(e,t,r){this.createCombo(e,t,(e,t)=>{const a=o.ArticleStore.getInstance().getSelection(r);if(a&&a.get().length>0&&!this.isContextMenuOpenForSelection(a)){const t=i.last(a.get());if(void 0!==t&&void 0!==t.entry_id)return s.dispatcher.dispatch(n.ArticleActions.article_onContextMenuButtonClick,{keys:e,widgetId:r,entryId:t.entry_id}),!1}return!0},!0)}static createApplySentimentShortcut(e,t,i,n,a,l){this.createCombo(e,n,(e,n)=>{const l=o.ArticleStore.getInstance().getSelection(a);return l&&l.get().length>0&&(this.isContextMenuOpen()||(s.dispatcher.dispatch(r.GenericActions.generic_onApplySentiment,{keys:e,widgetId:a,sentiment:t,canTagComments:i}),n.preventDefault())),!0},!0,l)}static createToggleImportantShortcut(e,t,i,n,a){this.createCombo(e,i,(e,i)=>{const a=o.ArticleStore.getInstance().getSelection(n);return a&&a.get().length>0&&(this.isContextMenuOpen()||(s.dispatcher.dispatch(r.GenericActions.generic_onToggleImportant,{keys:e,widgetId:n,canTagComments:t}),i.preventDefault())),!0},!0,a)}static createToggleTagShortcut(e,t,i,r,a,l){this.createCombo(e,r,(e,r)=>{const l=o.ArticleStore.getInstance().getSelection(a);return l&&l.get().length>0&&(this.isContextMenuOpen()||(s.dispatcher.dispatch(n.ArticleActions.article_onToggleTag,{keys:e,widgetId:a,tag:t,canTagComments:i}),r.preventDefault())),!0},!0,l)}static createGenericArticleShortcut(e,t,i,r){this.createCombo(e,t,(e,t)=>(this.isContextMenuOpen()||s.dispatcher.dispatch(n.ArticleActions.article_onKeyPressed,{keys:e,widgetId:i}),!0),!0,r)}static createDeleteArticleShortcut(e,t,i,r){this.createCombo(e,t,(e,t)=>(this.isContextMenuOpen()||s.dispatcher.dispatch(n.ArticleActions.article_onArticleDeleted,{widgetId:i,delete:!0}),!0),!0,r)}static createSelectionNavigationShortcut(e,t,i,r={}){this.createCombo(e,t,(e,r)=>!!this.isContextMenuOpen()||(s.dispatcher.dispatch(n.ArticleActions.article_onArrowKeyPressed,{event:r,key:t,widgetId:i}),!1),!0,r)}static createSourcePanelToggle(e,t,i,r,a={}){this.createCombo(e,i,(e,i)=>{const a=o.ArticleStore.getInstance().getSelection(r);return!(a&&a.get().length>0&&!this.isContextMenuOpen()&&(s.dispatcher.dispatch(n.ArticleActions.article_onOpenSourcePanel,{widgetId:r,sourcePanel:t}),1))},!0,a)}static isContextMenuOpen(){return o.ArticleStore.getInstance().isContextMenuOpen()}static isContextMenuOpenForSelection(e){return o.ArticleStore.getInstance().isContextMenuOpenForSelection(e)}}}),define("layouts/widget/widget_layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ARTICLE_LIST="RESULTSLIST",e.RESULTSLIST_NO_METRICS="RESULTSLIST_NO_METRICS",e.ARTICLE_STORY_TILES="RESULTSLIST_STORY_TILES",e.ARTICLE_LIST_COMPACT="RESULTSLIST_COMPACT",e.ARTICLE_IMAGE_GRID="RESULTSLIST_IMAGE_GRID",e.ARTICLE_STORIES="RESULTSLIST_STORIES",e.ARTICLE_WORLD_MAP="RESULTSLIST_WORLD_MAP",e.RESULTSLIST_INTERACTIONS="RESULTSLIST_INTERACTIONS",e.ARTICLE_NO_RESULTS="ARTICLE_NO_RESULTS",e.ARTICLE_LIST_SLEEK="ARTICLE_LIST_SLEEK",e.RESULTSLIST_SLIDES_TEN="RESULTSLIST_SLIDES_TEN",e.RESULTSLIST_SLIDES_FIVE="RESULTSLIST_SLIDES_FIVE",e.RESULTSLIST_SLIDES_ONE="RESULTSLIST_SLIDES_ONE",e.RESULTSLIST_SLIDES_THREE="RESULTSLIST_SLIDES_THREE",e.RESULTSLIST_SLIDES_IMAGES="RESULTSLIST_SLIDES_IMAGES",e.RESULTSLIST_FULL_CONTENT="RESULTSLIST_FULL_CONTENT"}(t.WidgetLayoutTypes||(t.WidgetLayoutTypes={}))}),define("models/articles_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/compact_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/five_slide_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/grid_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/image_slide_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/interaction_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/list_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/one_slide_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/sleek_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/story_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/ten_slide_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/three_slide_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/tile_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/context_menu_panels/article_actions_panel",["require","exports","react","reusable_components","actions/article_actions","flux","event_bus"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleActionsPanel=class extends s.ContextMenuPanel{generateContent(){return i.createElement("ul",{className:"list-unstyled"},this.generateArticleBlock())}generateArticleBlock(){const e=[];return this.props.allowTopicConversion&&e.push(this.generateArticleEntry(this.props.messages.convertToTopic,"fa fa-exchange",this.convertArticleToTopic.bind(this))),this.props.disableSharing||(this.props.shareUrlFacebook&&e.push(this.generateShareUrlEntry(this.props.messages.shareUrls.facebook,"fa fa-facebook facebook-small-icon",this.props.shareUrlFacebook)),this.props.shareUrlTwitter&&e.push(this.generateShareUrlEntry(this.props.messages.shareUrls.twitter,"fa fa-twitter",this.props.shareUrlTwitter)),this.props.shareUrlLinkedIn&&e.push(this.generateShareUrlEntry(this.props.messages.shareUrls.linkedin,"fa fa-linkedin linkedin",this.props.shareUrlLinkedIn)),this.props.shareUrlPinterest&&e.push(this.generateShareUrlEntry(this.props.messages.shareUrls.pinterest,"fa fa-pinterest pinterest",this.props.shareUrlPinterest))),this.props.allowSendEmail&&e.push(this.generateArticleEntry(this.props.messages.sendEmail,"fa fa-envelope-o",this.openSendEmailModal.bind(this))),this.props.canDeleteOrUndelete&&!this.props.isDeletedMode&&e.push(this.generateArticleEntry(this.props.messages.delete,"fa fa-trash-o",this.deleteSelection.bind(this))),e}deleteSelection(){r.dispatcher.dispatch(n.ArticleActions.article_onArticleDeleted,{delete:!0,widgetId:this.props.widgetId,canRemoveComments:this.props.canRemoveComments}),r.dispatcher.dispatch(n.ArticleActions.article_onContextMenuClose,{widgetId:this.props.widgetId}),o.eventBus.dispatch({type:o.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_CLOSE,value:void 0})}convertArticleToTopic(){r.dispatcher.dispatch(n.ArticleActions.article_onConvertArticleToTopic,{widgetId:this.props.widgetId})}generateShareUrlEntry(e,t,i){return this.generateArticleEntry(e,t,e=>{r.dispatcher.dispatch(n.ArticleActions.article_onShareUrlClick,{widgetId:this.props.widgetId,shareUrl:i})})}generateArticleEntry(e,t,s){return i.createElement("li",{key:e},i.createElement("div",{className:"menuitem label clickable",onClick:s||null},i.createElement("i",{className:t}),i.createElement("span",null,e)))}openSendEmailModal(){r.dispatcher.dispatch(n.ArticleActions.article_onSendEmail,{widgetId:this.props.widgetId})}}}),define("renderables/components/context_menu_panels/article_flag_panel",["require","exports","react","classnames","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleFlagPanel=class extends n.ContextMenuPanel{generateContent(){return i.createElement("ul",{className:"list-unstyled"},i.createElement("li",null,this.generateSentimentFlagButton(n.Sentiment.POSITIVE),this.generateSentimentFlagButton(n.Sentiment.NEUTRAL),this.generateSentimentFlagButton(n.Sentiment.NEGATIVE),this.props.canShowNeutral?void 0:this.generateSentimentFlagButton(n.Sentiment.NONE),this.generateImportantFlagButton()))}generateSentimentFlagButton(e){const t=s({"tw-btn-icon btn sentiment":!0,[e]:!0,active:this.props.sentiment===e}),r={action:n.ClickActionTypes.APPLY_SENTIMENT,widget_id:this.props.widgetId,sentiment:e,canTagComments:this.props.canTagComments};return i.createElement(n.ButtonRenderable,{key:e,click_action:r,icon:"icon-tw-flag",className:t})}generateImportantFlagButton(){const e=s({"tw-btn-icon btn important pull-right":!0,active:!0===this.props.isImportant}),t={action:n.ClickActionTypes.TOGGLE_IMPORTANT,widget_id:this.props.widgetId,canTagComments:this.props.canTagComments};return i.createElement(n.ButtonRenderable,{click_action:t,icon:"icon-tw-exclamation",className:e})}}}),define("renderables/components/context_menu_panels/article_reporting_panel",["require","exports","react","flux","reusable_components","actions/article_actions"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleReportingPanel=class extends n.ContextMenuPanel{generateContent(){return i.createElement("ul",{className:"list-unstyled"},i.createElement("li",{onClick:this.reportImageMismatch.bind(this)},i.createElement("div",{className:"menuitem label clickable"},i.createElement("i",{className:"fa fa-exclamation"}),i.createElement("span",null,this.props.label))))}reportImageMismatch(){const e=this.props.selection.getFirst();s.dispatcher.dispatch(r.ArticleActions.article_onReportImageMismatch,{widgetId:this.props.widgetId,entryId:e&&e.entry_id})}}}),define("renderables/components/article_tagging_component",["require","exports","classnames","flux","react","reusable_components","underscore","actions/article_actions"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleTaggingComponent=class extends s.BaseComponent{constructor(e){super(e),this.state={value:""}}componentDidMount(){setTimeout(()=>{this.inputRef&&this.inputRef.focus()},0)}render(){const e=this.generateFormBlock(),t=this.generateTagsBlock();return n.createElement("ul",{className:"list-unstyled"},e,t)}handleChange(e){this.setState({value:e.target.value})}resetValue(){this.setState({value:""})}addCallback(e,t){const i=e.nativeEvent.target.value||t;o.contains([188,13],e.keyCode)&&i&&(this.addCustomTag({name:i,marking_tag:!1}),this.resetValue(),e.preventDefault())}selectSuggestionCallback(e,t){t&&(this.addCustomTag(t),this.resetValue())}generateFormBlock(){return n.createElement("li",null,n.createElement("form",{name:"menu.form"},n.createElement(r.InlineTagsSuggestion,{tags:this.props.projectTags,addCallback:this.addCallback.bind(this),selectSuggestionCallback:this.selectSuggestionCallback.bind(this)},n.createElement("input",{id:"tagInput",ref:e=>this.inputRef=e,value:this.state.value,onChange:this.handleChange.bind(this),className:"form-control html5 input-sm",maxLength:r.MAX_TAG_WITH_GROUP_LENGTH,pattern:r.tagWithOptionalGroupRegex,autoComplete:"off"}))))}generateTagsBlock(){if(this.props.tags.length>0){const e=this.props.tags.map(e=>{const t=i({"label label-elipsis":!0,"label-default":e.marking_tag,"label-primary":!e.marking_tag});return n.createElement("li",{key:e.code,style:{maxWidth:"100%"},title:e.name},n.createElement("span",{className:t},n.createElement("span",{className:"label-text"},e.name),n.createElement("i",{className:"icon-tw-cross",onClick:this.removeTag.bind(this,e)})))});return n.createElement("li",null,n.createElement("ul",{className:"labels list-inline"},e))}return null}addCustomTag(e){!e||!new RegExp(r.tagWithOptionalGroupRegex).test(e.name)||e.name.length>r.MAX_TAG_WITH_GROUP_LENGTH||(e.code=void 0,s.dispatcher.dispatch(a.ArticleActions.article_onAddCustomTag,{tag:e,widgetId:this.props.widgetId,canTagComments:this.props.canTagMatchingComments}))}removeTag(e){s.dispatcher.dispatch(a.ArticleActions.article_onRemoveTag,{tag:e,widgetId:this.props.widgetId,canTagComments:this.props.canTagMatchingComments})}}}),define("renderables/components/context_menu_panels/article_tagging_panel",["require","exports","react","reusable_components","renderables/components/article_tagging_component"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleTaggingPanel=class extends s.ContextMenuPanel{generateContent(){return i.createElement(n.ArticleTaggingComponent,Object.assign({},this.props))}}}),define("renderables/components/context_menu_panels/article_undelete_panel",["require","exports","flux","react","reusable_components","actions/article_actions"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleUndeletePanel=class extends n.ContextMenuPanel{generateContent(){return s.createElement("ul",{className:"list-unstyled"},s.createElement("li",{key:this.props.label},s.createElement("div",{className:"menuitem label clickable",onClick:this.onClick.bind(this)},s.createElement("i",{className:"fa fa-reply"}),s.createElement("span",null,this.props.label))))}onClick(e){i.dispatcher.dispatch(r.ArticleActions.article_onArticleDeleted,{delete:!1,widgetId:this.props.widgetId})}}}),define("containers/article_context_menu_container",["require","exports","flux","react","reusable_components","reusable_utilities","actions/article_actions","renderables/components/context_menu_panels/article_actions_panel","renderables/components/context_menu_panels/article_flag_panel","renderables/components/context_menu_panels/article_reporting_panel","renderables/components/context_menu_panels/article_tagging_panel","renderables/components/context_menu_panels/article_undelete_panel","stores/article_store","underscore","event_bus"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleContextMenuContainer=class extends i.BaseComponent{constructor(e){super(e),this.state={isOpen:!1,contextMenuState:null}}componentDidMount(){const e=[o.ArticleActions.article_onAddCustomTag,o.ArticleActions.article_onRemoveTag,o.ArticleActions.article_onApplySentiment,o.ArticleActions.article_onToggleImportant,n.GenericActions.generic_onApplySentiment,n.GenericActions.generic_onToggleImportant];this.cancellationToken.subscribe(u.ArticleStore.getInstance().onChange,t=>{const i=this.props;let s;t.action===o.ArticleActions.article_onContextMenuButtonClick?(s=t.widgetId===i.widgetId&&t.entryId===i.entryId&&!this.state.isOpen,this.setState({isOpen:s,contextMenuState:this.getUpdatedContextMenuState(s)})):t.action===o.ArticleActions.article_onRefreshContextMenu?(s=u.ArticleStore.getInstance().isContextMenuOpen(),this.state.isOpen&&this.setState({isOpen:s,contextMenuState:this.getUpdatedContextMenuState(s)})):t.action===o.ArticleActions.article_onOpenSourcePanel?(s=t.widgetId===i.widgetId&&t.entryId===i.entryId,this.setState({isOpen:s,contextMenuState:this.getUpdatedContextMenuState(s,t.sourcePanel)})):e.includes(t.action)&&this.state.isOpen&&this.setState({isOpen:this.state.isOpen,contextMenuState:this.getUpdatedContextMenuState(this.state.isOpen)})}),this.cancellationToken.subscribe(n.SourceActionsMenuStore.getInstance().onChange,()=>{this.state.isOpen&&this.setState({isOpen:this.state.isOpen,contextMenuState:this.getUpdatedContextMenuState(this.state.isOpen)})})}render(){if(this.state.isOpen){let e=!1;const t=t=>{t&&!e&&(e=!0,g.eventBus.dispatch({type:g.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_OPEN,value:void 0}))};return s.createElement(n.ContextMenuContainer,{ref:t,widgetId:this.props.widgetId,onClickOutside:this.closeMenu.bind(this),onKeyDown:this.onKeyDown.bind(this),panels:this.generatePanels(),buttonHash:this.props.buttonHash})}return null}closeMenu(){i.dispatcher.dispatch(o.ArticleActions.article_onContextMenuClose,{widgetId:this.props.widgetId}),g.eventBus.dispatch({type:g.EVENT_TYPES.ARTICLE_ON_CONTEXT_MENU_CLOSE,value:void 0}),this.setState({isOpen:!1,contextMenuState:this.getUpdatedContextMenuState(!1)})}onKeyDown(e){if(e){const t=e.nativeEvent;t&&t.keyCode===r.Keys.ESCAPE&&this.closeMenu()}}generatePanels(){const e=[];return e.push(this.generateArticleUndeletePanel()),e.push(this.generateArticleFlagPanel()),e.push(this.generateArticleTaggingPanel()),e.push(this.generateArticleReportingPanel()),e.push(this.generateAddArticleToReportPanel()),e.push(this.generateArticleActionsPanel()),e.push(this.generateSourceActionsPanel()),e}generateArticleUndeletePanel(){return this.props.settings.canDeleteOrUndelete&&this.props.settings.isDeletedMode?s.createElement(h.ArticleUndeletePanel,{key:"article_undelete",widgetId:this.props.widgetId,header:this.props.messages.article,label:this.props.messages.undelete}):null}generateArticleFlagPanel(){const e=this.state.contextMenuState;return!this.props.settings.isDeletedMode&&this.props.settings.showSentimentActions?s.createElement(l.ArticleFlagPanel,{key:"article_flag",widgetId:this.props.widgetId,header:this.props.messages.changeSentiment,isImportant:e.isImportant,canTagComments:this.props.settings.canTagMatchingComments,sentiment:e.sentiment,canShowNeutral:this.props.settings.isAutoSentimentEnabled}):null}generateArticleTaggingPanel(){if(!this.props.settings.isDeletedMode&&this.props.settings.showTaggingActions){const e=this.state.contextMenuState;return s.createElement(d.ArticleTaggingPanel,{key:"article_tagging",widgetId:this.props.widgetId,header:this.props.messages.tagThisArticle,projectTags:e.projectTags,tags:e.tags,messages:this.props.messages,canTagMatchingComments:this.props.settings.canTagMatchingComments})}return null}canShowAddToReportPanel(){const e=this.state.contextMenuState;return this.props.settings.showCustomPagePanel&&e.customPages&&e.canAddToReport}generateAddArticleToReportPanel(){const e=this.state.contextMenuState;if(this.canShowAddToReportPanel()){const t=e.customPages.root_entry;return s.createElement(n.DropdownMenuPanel,{key:"article_add_to_report",widgetId:this.props.widgetId,entries:t.children,onClick:this.addArticleToReport.bind(this),icon:"icon2-tw-report"})}return null}addArticleToReport(e,t){i.dispatcher.dispatch(o.ArticleActions.article_onAddToCustomPage,{widgetId:this.props.widgetId,selectedEntry:t})}generateArticleReportingPanel(){const{showReportingActions:e}=this.state.contextMenuState;return e&&this.state.contextMenuState.selection.getFirst().can_be_reported?s.createElement(c.ArticleReportingPanel,{key:"article_reporting",widgetId:this.props.widgetId,label:this.props.messages.reportLogoMismatch,selection:this.state.contextMenuState.selection}):null}generateArticleActionsPanel(){if(this.props.settings.isDeletedMode)return null;{const e=this.state.contextMenuState;return s.createElement(a.ArticleActionsPanel,{key:"article_actions",widgetId:this.props.widgetId,header:this.props.messages.article,isDeletedMode:this.props.settings.isDeletedMode,disableSharing:e.disableSharing,shareUrlTwitter:e.shareUrlTwitter,shareUrlLinkedIn:e.shareUrlLinkedIn,shareUrlPinterest:e.shareUrlPinterest,shareUrlFacebook:e.shareUrlFacebook,allowTopicConversion:e.allowTopicConversion,allowSendEmail:e.allowSendEmail,canDeleteOrUndelete:e.canDeleteOrUndelete,canRemoveComments:this.props.settings.canTagMatchingComments,messages:this.props.messages})}}canShowSourceActionsPanel(){const e=this.props.settings,t=this.state.contextMenuState;return e.showSourcePanelActions&&(t.authors&&t.authors.length>0||t.sources&&t.sources.length>0)}generateSourceActionsPanel(){const e=this.state.contextMenuState;if(this.canShowSourceActionsPanel()){const t=n.SourceActionsMenuStore.getInstance().getMessages();return s.createElement(n.SourceActionsPanel,{key:"source_actions",widgetId:this.props.widgetId,header:t._697046,sources:e.sources,authors:e.authors,panels_groups:e.panels_groups,isPanelVisible:this.isPanelVisible.bind(this),monitoredSites:e.monitoredSites})}return null}isPanelVisible(e){return this.state.isOpen&&e===this.state.contextMenuState.openPanel}getUpdatedContextMenuState(e,t){if(!e)return this.state.contextMenuState;const i={},s=u.ArticleStore.getInstance(),r=this.props.widgetId,o=this.props.settings,a=s.getPayload(r);if(i.open=e,i.selection=s.getSelection(r),i.customPages=o.customPages,i.projectTags=a.project_tags,i.canTagMatchingComments=o.canTagMatchingComments,i.tagMatchingComments=a.tag_comments_in_threaded_view,i.openPanel=t,i.allowSendEmail=o.canSendArticlesByEmail,i.canDeleteOrUndelete=o.canDeleteOrUndelete,i.selection.isSingleSelection()){const e=p.first(i.selection.get());i.tags=e.tags,i.showReportingActions=o.showReportingActions,i.disableSharing=e.metadata.disable_sharing,i.shareUrlFacebook=e.metadata.facebook_share_url,i.shareUrlLinkedIn=e.metadata.linkedin_share_url,i.shareUrlPinterest=e.metadata.pinterest_share_url,i.shareUrlTwitter=e.metadata.twitter_share_url,i.sentiment=e.metadata.sentiment,i.isImportant=e.metadata.important,i.allowTopicConversion=o.canConvertArticleToTopic,i.canAddToReport=!e.metadata.is_fake_root}else i.tags=this.getSelectionTags(i.selection),i.showReportingActions=!1,i.disableSharing=!0,i.sentiment=i.selection.get().reduce((e,t,i)=>e=0===i?t.metadata.sentiment:t.metadata.sentiment===e?e:void 0,n.Sentiment.POSITIVE),i.isImportant=i.selection.get().every(e=>!0===e.metadata.important),i.canAddToReport=i.selection.get().every(e=>!1===e.metadata.is_fake_root),i.allowTopicConversion=!1;return i.panels_groups=a.panels_groups,i.authors=this.getAuthors(i.selection.get(),!0),i.sources=this.getSources(i.selection.get(),!0),i.monitoredSites=n.SourceActionsMenuStore.getInstance().getMonitoredSites(),i}getSelectionTags(e){if(!e||0===e.get().length)return[];const t=e.get().map(e=>e.tags),i=p.first(t),s=p.rest(t);return i.filter(e=>s.every(t=>t.some(t=>p.isEqual(e,t))))}getSources(e,t){return this.extractSources(e,"source",t)}getAuthors(e,t){return this.extractSources(e,"author",t)}extractSources(e,t,i){const s=p.chain(e).filter(e=>!e.metadata.is_fake_root).map(e=>e[t]).uniq().filter(e=>void 0!==e&&void 0!==e.id_hash&&void 0!==e.url_hash).value();return i?JSON.parse(JSON.stringify(s)):s}}}),define("renderables/layouts/article/compact_layout_renderable",["require","exports","underscore","react","classnames","flux","actions/article_actions","reusable_components","containers/article_context_menu_container"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CompactLayoutRenderable=class extends r.BaseComponent{shouldComponentUpdate(e){const t=e.article,s=e.layout,n=this.props.layout;return s.size!==n.size||s.selected!==n.selected||!i.isEqual(t.save_to_user_workflow_button,this.props.article.save_to_user_workflow_button)||t.show_translation!==this.props.article.show_translation||s.showSeparator!==n.showSeparator||s.separatorCount!==n.separatorCount||t.entry_id!==this.props.article.entry_id||!i.isEqual(t.metadata,this.props.article.metadata)}render(){const e=this.props.layout,t=e.entryId,i=this.generateSeparatorCount(),n=this.generateStyle(e),r=this.generateClassNames(e),o=this.generateContextMenuButton();return s.createElement("div",{className:r,style:n,key:t,onClick:this.handleEntryClick.bind(this)},s.createElement("article",{id:e.entryHash},this.generateLeftContainer(),s.createElement("div",{className:"middle"},s.createElement("div",{className:"top"},e.title),this.generateContent(),s.createElement("div",{className:"bottom"},s.createElement("ul",{className:"details list-inline"},s.createElement("li",{className:"no-separator"},e.icon),e.outro))),s.createElement(a.VisibilityRenderable,{delay:0,showChildren:!0},e.engagementChart),s.createElement("div",{className:"right"},e.metricsContainer),i,this.generateContextMenuContainer(),o))}generateContextMenuContainer(){const e=this.props.layout;return s.createElement(l.ArticleContextMenuContainer,{entryId:e.entryId,widgetId:e.widgetId,buttonHash:e.entryHash,messages:e.messages.contextMenu,settings:e.settings})}generateClassNames(e){const t=this.props.style&&this.props.style.classes||{};return n(i.assign(t,{entry:!0,separator:e.showSeparator,small:this.isSmall(),tiny:this.isTiny()}))}generateStyle(e){const t=this.props.style&&this.props.style.style||{};return i.assign(t,{backgroundColor:e.selected&&"#f0f0f0"})}generateContent(){const e=this.props.layout;return this.isSmall()?null:s.createElement("div",{className:"entry-content"},s.createElement("div",{className:"entry-description"},e.text))}generateLeftContainer(){const{layout:e}=this.props,t=(e.metrics.matching_topics||[]).map(e=>e.color).filter(e=>void 0!==e&&e.length>0);return!i.isNull(e.avatar)||t.length>0?s.createElement("div",{className:"left"},this.generateColorsBlock(t),e.avatar):null}generateColorsBlock(e){return e&&e.length>0?s.createElement("div",{className:"colors"},e.map(e=>s.createElement("div",{className:"color",key:"color-"+e,style:{backgroundColor:e}}))):null}generateSeparatorCount(){const e=this.props.layout;return e.showSeparator&&void 0!==e.separatorCount?s.createElement("div",{className:"separator-count"},e.separatorCount):null}generateContextMenuButton(){const e=this.props.layout;if(e.contextMenuButton&&void 0!==e.contextMenuButton){const t=n({"context-menu-button":!0,active:e.selected});return s.createElement("div",{className:t},e.contextMenuButton)}return null}handleEntryClick(e){const t=e.nativeEvent;$(t.target).is("a")||$(t.target).is("img")||$(t.target).is(".thumbnail-container")||e.defaultPrevented||t.defaultPrevented||r.dispatcher.dispatch(o.ArticleActions.article_onEntryClicked,{entryId:this.props.layout.entryId,widgetId:this.props.layout.widgetId,event:e})}isSmall(){return this.props.layout.size<12}isTiny(){return 6===this.props.layout.size}}}),define("renderables/layouts/article/grid_layout_renderable",["require","exports","classnames","flux","react","underscore","actions/article_actions","containers/article_context_menu_container"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GridLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(e,t){const i=e.article,s=e.layout,n=this.props.layout;return s.selected!==n.selected||s.imageDimensions!==n.imageDimensions||i.show_translation!==this.props.article.show_translation||s.showSeparator!==n.showSeparator||s.separatorCount!==n.separatorCount||i.entry_id!==this.props.article.entry_id||!r.isEqual(i.metadata,this.props.article.metadata)}render(){const e=this.props.layout,t=e.entryId,s=i({entry:!0,separator:e.showSeparator,active:e.selected}),o={width:!r.isUndefined(e.imageDimensions)&&e.imageDimensions+"px",height:!r.isUndefined(e.imageDimensions)&&e.imageDimensions+"px"};return n.createElement("div",{className:s,key:t,onClick:this.handleEntryClick.bind(this),style:o},this.generateContextMenuContainer(),e.contextMenuButton,e.image,e.metricBar)}handleEntryClick(e){const t=e.nativeEvent;$(t.target).is("a")||$(t.target).is("img")||$(t.target).is(".thumbnail-container")||e.defaultPrevented||t.defaultPrevented||s.dispatcher.dispatch(o.ArticleActions.article_onEntryClicked,{entryId:this.props.layout.entryId,widgetId:this.props.layout.widgetId,event:e})}generateContextMenuContainer(){const e=this.props.layout;return n.createElement(a.ArticleContextMenuContainer,{entryId:e.entryId,widgetId:e.widgetId,buttonHash:e.entryHash,messages:e.messages.contextMenu,settings:e.settings})}}}),define("renderables/layouts/article/interaction_layout_renderable",["require","exports","flux","react","underscore"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ARTICLE_MOUSE_ENTER="ARTICLE_MOUSE_ENTER",e.ARTICLE_MOUSE_LEAVE="ARTICLE_MOUSE_LEAVE",e.ARTICLE_CLICK="ARTICLE_CLICK"}(r=t.InteractionLayoutMediatorEvents||(t.InteractionLayoutMediatorEvents={}));t.InteractionLayoutRenderable=class extends i.BaseComponent{shouldComponentUpdate(e){const t=e.article,i=e.layout,s=this.props.layout;return i.size!==s.size||i.selected!==s.selected||!n.isEqual(t.save_to_user_workflow_button,this.props.article.save_to_user_workflow_button)||t.show_translation!==this.props.article.show_translation||i.showSeparator!==s.showSeparator||i.separatorCount!==s.separatorCount||t.entry_id!==this.props.article.entry_id||!n.isEqual(t.metadata,this.props.article.metadata)}reduceOutroSize(){return!!(this.props.layout.outro&&this.props.layout.outro.length&&this.props.layout.outro.every(e=>e.props&&e.props.children&&e.props.children.props&&e.props.children.props.text&&e.props.children.props.text.length))&&this.props.layout.outro.map(e=>e.props.children.props.text.length).reduce((e,t)=>e+t)>60}render(){const{layout:e,style:t={},mediator:i}=this.props,{entryId:n}=e,o=this.reduceOutroSize()?{position:"relative",top:"-9px",fontSize:"0.85em"}:void 0;return s.createElement("div",{className:"entry",style:t.style,key:n,"data-url":this.props.article.entry_id,onClick:()=>{void 0!==i&&i.dispatch(r.ARTICLE_CLICK,this.props.article.entry_id)},onMouseEnter:()=>{void 0!==i&&i.dispatch(r.ARTICLE_MOUSE_ENTER,this.props.article.entry_id)},onMouseLeave:()=>{void 0!==i&&i.dispatch(r.ARTICLE_MOUSE_LEAVE,this.props.article.entry_id)}},s.createElement("article",{id:e.entryHash},s.createElement("div",{className:"top-row",style:{position:this.reduceOutroSize()?"relative":void 0,top:this.reduceOutroSize()?"-5px":void 0}},s.createElement("div",{className:"column-left"},this.generateImage()),s.createElement("div",{className:"column-right"},s.createElement("div",{style:{fontWeight:"bold"}},e.title),s.createElement("div",{style:{fontSize:e.title?"0.9em":void 0,position:e.title?"relative":void 0,top:e.title?"-3px":void 0,maxHeight:e.title?"34px":void 0},className:"content"},this.generateContent()))),s.createElement("div",{className:"bottom-row"},s.createElement("div",{className:"outro"},s.createElement("ul",{className:"details list-inline",style:o},s.createElement("li",{className:"no-separator"},e.icon),e.outro)))))}generateContent(){const e=this.props.layout;return s.createElement("div",{className:"entry-content"},s.createElement("div",{className:"entry-description"},e.text))}generateImage(){const e=this.props.layout,t=this.props.layout.showImage;return!n.isNull(e.avatar)||t?s.createElement("div",null,e.avatar):null}}}),define("renderables/layouts/article/list_layout_renderable",["require","exports","classnames","flux","react","underscore","actions/article_actions"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ListLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(e){const t=this.props.article,i=e.article,s=e.layout,n=this.props.layout;return s.size!==n.size||s.selected!==n.selected||!r.isEqual(i.save_to_user_workflow_button,t.save_to_user_workflow_button)||i.show_translation!==t.show_translation||s.showSeparator!==n.showSeparator||s.separatorCount!==n.separatorCount||i.entry_id!==t.entry_id||i.cluster_articles.length!==t.cluster_articles.length||i.comment_articles.length!==t.comment_articles.length||this.hasCommentContainerChanged(t,i)||!r.isEqual(i.tags,t.tags)||!r.isEqual(i.metadata,t.metadata)||this.hasCommentSelectionChanged(t.comment_articles,i.comment_articles)||this.hasCommentSelectionChanged(t.cluster_articles,i.cluster_articles)}hasCommentContainerChanged(e,t){return!r.isEqual(e.child_filter_label,t.child_filter_label)||!r.isEqual(e.child_element_count,t.child_element_count)||!r.isEqual(e.children_label,t.children_label)}hasCommentSelectionChanged(e,t){return!e||!t||e.length!==t.length||e.reduce((e,i,s)=>e=e&&t[s]&&i.selected===t[s].selected,!0)}render(){const e=this.props.layout,t=e.entryId,s=e.selected?{backgroundColor:"#f0f0f0"}:null,r=this.generateSeparatorCount(),o=i({entry:!0,separator:e.showSeparator,small:e.size<12,"no-metrics":!e.metricsContainer}),a=void 0!==e.fullContent;return n.createElement("div",{className:o,style:s,key:t,onClick:this.handleEntryClick.bind(this)},n.createElement("article",{className:`entry ${a?"full-content-entry":""}`},n.createElement("div",{className:"top"},a?this.generateFullContent():n.createElement(n.Fragment,null,n.createElement("div",{className:"left"},n.createElement("div",{className:"avatar-box"},e.avatar,e.icon)),this.generateMiddle()),this.generateRight()),n.createElement("div",{className:"bottom"},this.generateCommentContainer(),n.createElement("div",{className:"right right-group"})),r))}generateMiddle(){const e=this.props.layout,t=12===e.size?e.subtitle:null;return n.createElement("div",{className:"middle"},e.title,n.createElement("div",{className:"entry-content"},this.generateImage(),t,n.createElement("div",{className:"entry-description"},e.text,e.translationButton)),this.generateOutro())}generateRight(){const e=this.props.layout;return 12===e.size?n.createElement("div",{className:"right"},e.metricsContainer):null}generateOutro(){return n.createElement("ul",{className:"details list-inline"},this.props.layout.outro)}generateCommentContainer(){const e=this.props.layout,t=[e.commentArticles,e.clusterArticles];return n.createElement("div",{className:"middle middle-group"},t)}generateImage(){const e=this.props.layout;return void 0!==e.image?n.createElement("div",null,e.image):null}generateSeparatorCount(){const e=this.props.layout;return e.showSeparator&&void 0!==e.separatorCount?n.createElement("div",{className:"separator-count"},e.separatorCount):null}handleEntryClick(e){const t=e.nativeEvent;$(t.target).is("a")||$(t.target).is("img")||$(t.target).is(".thumbnail-container")||e.defaultPrevented||t.defaultPrevented||s.dispatcher.unsafeDispatch(o.ArticleActions.article_onEntryClicked,{entryId:this.props.layout.entryId,widgetId:this.props.layout.widgetId,event:e})}generateFullContent(){const{nexis_full_content:e,factiva_full_content:t}=this.props.layout.fullContent;if(void 0!==e||void 0!==t){const i=void 0!==e;return n.createElement("div",{className:"article-full-content-container"},i?this.generateLexisNexisFullContent(e):this.generateFactivaDowJonesFullContent(t))}}generateLexisNexisFullContent(e){const{content:t,copyright:i,language:s,title:r,sub_title:o,word_count:a,source_category:l,publisher:c,published_date:d,message_keys:h}=e;function u(e,t){return n.createElement("div",null,n.createElement("b",null,h[e]?h[e]:e)," : ",t)}return n.createElement(n.Fragment,null,n.createElement("div",{className:"nexis-full-content-header"},n.createElement("img",{src:"/app/assets/images/lexis_nexis_logo.gif"}),n.createElement("div",{className:"nexis-full-content-header-publisher"},n.createElement("p",null,c),n.createElement("p",null,function(e){return new Date(e).toISOString().replace(/(\d{4})\-(\d{2})\-(\d{2})T(\d{2}):(\d{2}):(\d{2}).*/,"$3/$2/$1 $4:$5:$6")}(d))),n.createElement("div",{className:"nexis-full-content-header-title"},n.createElement("h1",null,r),n.createElement("h3",null,o),u("length",`${a}`))),n.createElement("div",{className:"nexis-full-content-main"},n.createElement("div",{dangerouslySetInnerHTML:{__html:t}})),n.createElement(n.Fragment,null,u("section",l),u("language",s),n.createElement("p",{className:"nexis-full-content-copyright"},i)))}generateFactivaDowJonesFullContent(e){const{title:t,content:i,author:s,published_date:r,image:o,source:a,language:l}=e,c="Copyright  2019 Dow Jones & Company, Inc. All right reserved";return n.createElement(n.Fragment,null,n.createElement(n.Fragment,null,n.createElement("div",{className:"factiva-full-content-header"},n.createElement("div",{className:"factiva-full-content-header-img"},n.createElement("img",{src:o})),n.createElement("div",{className:"factiva-full-content-header-publisher"},n.createElement("i",null,s),n.createElement("p",null,`${a} | ${l} | ${r}`))),n.createElement("div",null,n.createElement("h1",null,t))),n.createElement("div",{className:"factiva-full-content-main"},n.createElement("div",{dangerouslySetInnerHTML:{__html:i}})),n.createElement("div",{className:"factiva-full-content-footer"},n.createElement("div",{className:"factiva-full-content-footer-copyright"},c),n.createElement("div",{className:"factiva-full-content-footer-img"},n.createElement("img",{src:"/app/assets/images/powered_by_dow_jones.png"}))))}}}),define("renderables/layouts/article/sleek_layout_renderable",["require","exports","underscore","react","flux"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SleekLayoutRenderable=class extends n.BaseComponent{shouldComponentUpdate(e){const t=e.article,s=e.layout,n=this.props.layout;return s.size!==n.size||t.entry_id!==this.props.article.entry_id||!i.isEqual(t.metadata,this.props.article.metadata)}render(){const{layout:e,style:t={}}=this.props,i=e.entryId;return s.createElement("div",{className:"entry",style:t.style,key:i},s.createElement("article",{id:e.entryHash},s.createElement("div",{className:"column-left"},this.generateImage()),s.createElement("div",{className:"column-right"},s.createElement("div",{className:"title"},e.title),s.createElement("div",{className:"content"},this.generateContent()),s.createElement("div",{className:"outro"},s.createElement("ul",{className:"details list-inline"},e.outro)))))}generateContent(){const{text:e}=this.props.layout;return s.createElement("div",{className:"entry-content"},s.createElement("div",{className:"entry-description"},e))}generateImage(){const{showImage:e,avatar:t}=this.props.layout;return!i.isNull(t)||e?s.createElement("div",null,t):s.createElement("div",null)}}}),define("styles/widget/slides/five_per_slide_widget_layout.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fivePerSlideWidgetStyleModel={container:{width:"100%","& .entry:last-child>article":{borderStyle:"none"},fontFamily:"Arial"},entry:{display:"flex",flexWrap:"nowrap"},authorInfoContainer:{position:"relative",maxHeight:"85%"},header:{display:"flex",fontSize:"1.33em",marginBottom:"0.5em"},avatar:{position:"absolute",maxWidth:"18%",width:"18%",top:"15%",left:"1em","& .clickable":{borderRadius:"50%",maxWidth:"3em",maxHeight:"3em"}},authorBlock:{width:"72%",maxWidth:"68%",height:"40%",maxHeight:"40%",position:"absolute",left:"3.5em",top:"14.3%",fontWeight:"bold",fontStyle:"oblique",fontSize:"1.5em","& div":{color:"black",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginBottom:"1%"},"& a":{textDecoration:"underline"},"& ul":{fontWeight:"normal",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden","& li":{color:"black",paddingRight:"0"},"& li:last-child":{textDecoration:"underline"}}},titleTextContainer:{position:"relative"},outro:{display:"block",position:"absolute",bottom:"0",left:"2%",maxWidth:"98%",marginBottom:"0",whiteSpace:"normal","& li":{fontStyle:"oblique","&:last-child":{display:"inline"}}},titleContainer:{display:"block",width:"88%",height:"18%",position:"absolute",top:"0",left:"2%",fontSize:"6.5pt","& span":{display:"block",width:"100%",height:"114%",textDecoration:"underline",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",fontStyle:"oblique"}},textContainer:{fontSize:"6.1pt",display:"block",height:"5.5em",width:"97%",top:"32.3%",left:"2%",position:"absolute",bottom:"0",fontWeight:"bold",color:"rgba(0,0,0,0.38)",overflow:"hidden",textOverflow:"ellipsis",fontStyle:"oblique",lineHeight:"1.2","& em":{fontStyle:"oblique",fontWeight:"bold",border:"none"},"& span":{display:"block",maxHeight:"100%"},"& a":{color:"rgba(0,0,0,0.38)"},"& .emoji":{width:"1em !important",height:"1em !important"}},singlePrimaryMetricContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},singlePrimaryMetric:{fontSize:"13pt",color:"gray",fontWeight:"bold",flexDirection:"column"},authorBlockFlags:{marginBottom:0},imageContainer:{position:"relative","& .thumbnail":{maxWidth:"95% !important",padding:"0 !important",border:"none !important",margin:"auto !important",borderRadius:"0 !important",maxHeight:"100% !important",width:"auto",height:"auto",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"},"& .thumbnail-container":{margin:"0 !important",height:"100% !important",maxHeight:"100% !important",width:"inherit !important"}},image:{maxHeight:"100%",maxWidth:"95%",width:"auto",height:"auto",position:"absolute",top:"0",bottom:"0",left:"0",right:"0",margin:"auto"},icon:{position:"relative","& .favicon":{maxWidth:"0.8em",maxHeight:"0.8em",position:"absolute",top:"-2.3em",right:"-0.6em"}},text:{fontSize:"1.1em",paddingTop:"1em"},articleHeader:{display:"flex",height:"5%",maxHeight:"5%",width:"100%",maxWidth:"100%",borderBottom:"thin solid rgba(0, 0, 0, 0.1)",color:"gray",fontSize:"0.6em","& div":{paddingLeft:"0.5%"}},secondaryMetric:{listStyleType:"none",padding:"0",margin:"0",fontSize:"0.9em",color:"gray","& li":{paddingBottom:"3%",paddingLeft:"2%"}},articleHeaderColumnWithBorder:{borderLeft:"thin solid rgba(0, 0, 0, 0.1)"},sentiment:{}},t.fivePerSlideWidgetStyle=i.createCssModule(()=>t.fivePerSlideWidgetStyleModel).compute({}).attach().getModule()}),define("renderables/layouts/article/slides/five_slide_layout_renderable",["require","exports","react","flux","classnames","styles/widget/slides/five_per_slide_widget_layout.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FiveSlideLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}getClasses(){return n({entry:!0,[r.fivePerSlideWidgetStyle.entry]:!0})}render(){const{style:e={},layout:t}=this.props,s=t.entryId,{dynamicLayout:n={articleCount:5,columnCount:5,numberOfRows:5,displayMetric:!0}}=t.settings;return i.createElement("div",{className:this.getClasses(),style:e.style,key:s},i.createElement("article",{id:t.entryHash,style:e.articleProportions.article},this.getColumnsToBeRendered(n)))}getColumnsToBeRendered(e){return[this.generateFirstColumn(),this.generateSecondColumn(),this.generateThirdColumn(),this.generateFourthColumn(),this.generateFifthColumn()].splice(0,e.columnCount)}generateFirstColumn(){const{layout:e}=this.props,{columnProportions:t}=this.props.style;return i.createElement("div",{style:t.firstColumn,className:r.fivePerSlideWidgetStyle.authorInfoContainer,key:"1"},i.createElement("div",{className:r.fivePerSlideWidgetStyle.avatar},e.avatar,i.createElement("div",{className:r.fivePerSlideWidgetStyle.icon},e.icon)),i.createElement("div",{className:r.fivePerSlideWidgetStyle.authorBlock},e.authorBlock),i.createElement("ul",{className:this.getOutroClassName()},e.outro))}generateSecondColumn(){const{layout:e}=this.props,{columnProportions:t}=this.props.style;return i.createElement("div",{style:t.secondColumn,key:"2",className:r.fivePerSlideWidgetStyle.titleTextContainer},i.createElement("div",{className:r.fivePerSlideWidgetStyle.titleContainer}," ",e.title),i.createElement("div",{className:r.fivePerSlideWidgetStyle.textContainer}," ",e.text))}generateThirdColumn(){const{layout:e}=this.props,{columnProportions:t}=this.props.style;return i.createElement("div",{style:t.thirdColumn,key:"3",className:r.fivePerSlideWidgetStyle.imageContainer},e.image)}generateFourthColumn(){const{layout:e}=this.props,{columnProportions:t}=this.props.style;return i.createElement("div",{style:t.fourthColumn,key:"4",className:r.fivePerSlideWidgetStyle.singlePrimaryMetricContainer},i.createElement("div",{className:r.fivePerSlideWidgetStyle.singlePrimaryMetric},e.metrics.primary_metrics[0].value))}generateFifthColumn(){const{layout:e}=this.props,{columnProportions:t}=this.props.style;return i.createElement("ul",{className:r.fivePerSlideWidgetStyle.secondaryMetric,key:"5",style:t.fifthColumn},this.generateSentiment(),e.metrics.secondary_metrics.map(e=>i.createElement("li",{key:e.text}," ",e.text+": "+e.value," ")))}generateSentiment(){const e=this.props.article.sentiment_texts;if(e&&e[0].text&&e[1].font_color&&e[1].text){const t={color:e[1].font_color},s=e[1].text,n=e[0].text;return i.createElement("li",{key:s,className:r.fivePerSlideWidgetStyle.sentiment},n+": ",i.createElement("span",{style:t},s))}}getOutroClassName(){return n({"detailsObliqueOptimized list-inline":!0,[r.fivePerSlideWidgetStyle.outro]:!0})}}}),define("styles/widget/slides/image_slide_widget_layout.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageSlideWidgetStyleModel={container:{width:"100%",height:"100%",display:"flex",flexWrap:"wrap",fontFamily:"Arial"},articleWithCompleteBorder:{border:"thin solid rgba(0,0,0,0.1)",minHeight:"100%",minWidth:"100%",flexDirection:"column",flexWrap:"nowrap !important"},firstRow:{flexBasis:"70%",position:"relative",overflow:"hidden"},secondRow:{position:"relative",flexBasis:"10%",overflow:"hidden"},thirdRow:{flexBasis:"30%",position:"relative"},entry:{display:"flex"},outro:{display:"block",position:"absolute",maxWidth:"96%",marginBottom:"0",whiteSpace:"normal",fontStyle:"oblique",overflow:"hidden",fontSize:"0.7em",top:"66%",left:"10%",lineHeight:"90%","& li":{"& a":{"& span":{textDecoration:"underline"}},"&:not(:last-child):after":{content:'"|"',fontStyle:"normal",margin:"0 0.25em",padding:"0 !important"},"&:last-child":{display:"inline"},padding:"0 !important"}},icon:{position:"absolute",top:"63%",left:"2%","& .favicon":{height:"0.7em !important",width:"auto !important"}},titleContainer:{display:"block",position:"absolute",fontSize:"0.8em",left:"4%",whiteSpace:"nowrap",width:"95%","& span":{display:"block",width:"100%",height:"100%",textDecoration:"underline",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",fontStyle:"oblique"}},textContainer:{position:"absolute",left:"5%",top:"-1%",fontSize:"0.7em",width:"95%",height:"3.1em",overflow:"hidden",lineHeight:"1.1","& span":{display:"block",maxWidth:"95%",color:"black",fontStyle:"oblique"},"& em":{border:"none"},"& .emoji":{maxWidth:"0.9em",maxHeight:"0.9em"}},image:{"& .thumbnail":{maxWidth:"100% !important",minHeight:"100%",minWidth:"100%",padding:"0 !important",border:"none !important",margin:"0 !important",borderRadius:"0 !important"},"& .thumbnail-container":{margin:"0 !important",height:"inherit !important",width:"inherit !important"}},metricBar:{position:"absolute",height:"21%",width:"100%",top:"80%",backgroundColor:"rgba(120,120,120,0.4)",display:"flex",color:"white",fontWeight:"bold",flexWrap:"nowrap",fontSize:"1em"},firstMetric:{position:"absolute",left:"43%",display:"flex"},secondMetric:{},metricIcon:{fontSize:"1em",marginRight:"10%"},metricValue:{}},t.imageSlideWidgetStyle=i.createCssModule(()=>t.imageSlideWidgetStyleModel).compute({}).attach().getModule()}),define("renderables/layouts/article/slides/image_slide_layout_renderable",["require","exports","react","flux","classnames","styles/widget/slides/image_slide_widget_layout.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageSlideLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}getClasses(){return n({[r.imageSlideWidgetStyle.entry]:!0})}render(){const{style:e,layout:t}=this.props,s=t.entryId;return i.createElement("div",{className:this.getClasses(),style:e.articleProportions.article,key:s},i.createElement("article",{id:t.entryHash,className:r.imageSlideWidgetStyle.articleWithCompleteBorder},this.generateFirstRow(),this.generateSecondRow(),this.generateThirdRow()))}generateFirstRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.imageSlideWidgetStyle.firstRow},i.createElement("div",{className:r.imageSlideWidgetStyle.image},e.image,this.generateMetricsBar()))}generateSecondRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.imageSlideWidgetStyle.secondRow},i.createElement("div",{className:r.imageSlideWidgetStyle.titleContainer},e.title))}generateThirdRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.imageSlideWidgetStyle.thirdRow},i.createElement("div",{className:r.imageSlideWidgetStyle.icon},e.icon),i.createElement("div",{className:r.imageSlideWidgetStyle.textContainer},e.text),i.createElement("div",{className:this.getOutroClassName()},e.outro))}generateMetricsBar(){const{layout:e}=this.props,t=e.metrics.primary_metrics[0];return i.createElement("div",{className:r.imageSlideWidgetStyle.metricBar},this.generateMetric(t,r.imageSlideWidgetStyle.firstMetric))}generateMetric(e,t){return i.createElement("div",{className:t},i.createElement("div",{className:r.imageSlideWidgetStyle.metricIcon},i.createElement("i",{className:e.icon})),i.createElement("div",{className:r.imageSlideWidgetStyle.metricValue}," ",e.value," "))}getOutroClassName(){return n({"detailsObliqueOptimized list-inline":!0,[r.imageSlideWidgetStyle.outro]:!0})}}}),define("styles/article_style",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("styles/widget/slides/one_per_slide_widget_layout.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onePerSlideWidgetStyleModel={container:{width:"100%",height:"100%",fontFamily:"Arial",color:"black"},columnLeft:{order:0,flex:1,maxWidth:"50%"},columnRight:{order:1,flex:1,maxWidth:"50%",marginTop:"4%"},singleColumn:{order:1,flex:1,maxWidth:"100%"},entry:{padding:"0.75em",height:"100%"},authorInfo:{borderBottom:"1px solid #d7dbdd"},header:{display:"flex",fontSize:"1.33em",marginBottom:"0.5em"},outro:{whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%",overflow:"hidden",fontSize:"1em !important",fontStyle:"oblique",borderTop:"1px solid #d7dbdd",paddingTop:"3% !important",marginBottom:"2% !important","& a span":{textDecoration:"underline"}},avatar:{position:"relative","& .clickable":{borderRadius:"50%",maxWidth:"100%",maxHeight:"100%"}},authorBlock:{display:"inline-flex",padding:"0.3em 0 0.5em 0.8em",flexDirection:"column",fontStyle:"oblique",fontSize:"0.9em",fontWeight:"bold",whiteSpace:"nowrap",width:"68%","& a span":{textDecoration:"underline"},"& div":{marginBottom:"1%",textOverflow:"ellipsis",overflow:"hidden"},"& ul":{textOverflow:"ellipsis",overflow:"hidden"}},title:{fontSize:"1.2em",minHeight:"3em",paddingTop:"2.75em",fontStyle:"oblique",fontWeight:"bold",color:"black","& a span":{textDecoration:"underline"}},imageContainer:{position:"relative",marginTop:"13%","& .thumbnail":{maxWidth:"99% !important",padding:"0 !important",border:"none !important",margin:"auto !important",borderRadius:"0 !important",maxHeight:"100% !important",width:"auto",height:"auto",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"},"& .thumbnail-container":{margin:"0 !important",height:"100% !important",maxHeight:"100% !important",width:"inherit !important"}},image:{width:"auto",maxHeight:"100%",maxWidth:"100%"},text:{fontSize:"1.1em",fontStyle:"oblique",paddingTop:"0.2em",lineHeight:"1.3","& em":{border:"none",fontWeight:"normal"}},topMetrics:{color:"#7f8c8c"},singlePrimaryMetric:{display:"flex",flexDirection:"row",borderBottom:"1px solid #d7dbdd",fontSize:"1.3em",padding:"0.8em 0",alignItems:"center",marginTop:"1em"},singleSecondaryMetric:{display:"flex",flexDirection:"row",fontSize:"1em",padding:"0.5em 0",alignItems:"center"},primaryMetricIcon:{display:"inline-flex",marginRight:"0.5em",fontSize:"2.5em"},metricLabel:{display:"inline-flex",width:"47%"},metricValue:{display:"inline-flex",paddingRight:"0.25em",fontWeight:"bold",position:"absolute",right:"5%"},icon:{position:"absolute",top:"0%",right:"0%","& .favicon":{maxWidth:"0.7em",maxHeight:"0.7em"}},sentiment:{},secondaryMetrics:{marginTop:"1.3em"}},t.onePerSlideWidgetStyle=i.createCssModule(()=>t.onePerSlideWidgetStyleModel).compute({}).attach().getModule()}),define("renderables/layouts/widget/dynamic_size_widget_layout_renderable",["require","exports","flux"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DynamicSizeWidgetLayoutRenderable=class extends i.BaseComponent{render(){const{configuration:e}=this.props;return this.getLayout(e)}}}),define("renderables/layouts/widget/slides/one_slide_widget_layout_renderable",["require","exports","react","layouts/widget/widget_layout_types","styles/widget/slides/one_per_slide_widget_layout.css","renderables/article_renderable","renderables/layouts/widget/dynamic_size_widget_layout_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oneSlideDynamicArticleLayoutSettings={articleCount:1,columnCount:1,displayMetric:!0};t.OneSlideWidgetLayoutRenderable=class extends o.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{dynamicLayout:i=t.oneSlideDynamicArticleLayoutSettings}=e.settings;return this.renderSingleArticle(i)}renderSingleArticle(e=t.oneSlideDynamicArticleLayoutSettings){const{configuration:s}=this.props,{payload:r}=s,o=r.articles.slice(0,e.articleCount);return i.createElement("div",{className:n.onePerSlideWidgetStyle.container},o.map((e,t)=>this.generateArticleRenderable(e,t,s)))}generateArticleRenderable(e,t,n){const{widgetId:o,messages:a,settings:l,iconMap:c}=n;return e.key=e.entry_id+s.WidgetLayoutTypes.RESULTSLIST_SLIDES_ONE,i.createElement(r.ArticleRenderable,{key:e.key,widgetLayout:s.WidgetLayoutTypes.RESULTSLIST_SLIDES_ONE,widgetId:o,article:e,messages:a,settings:l,iconMap:c,showSeparator:!1,separatorCount:t+1})}}}),define("renderables/layouts/article/slides/one_slide_layout_renderable",["require","exports","react","flux","classnames","styles/widget/slides/one_per_slide_widget_layout.css","renderables/layouts/widget/slides/one_slide_widget_layout_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OneSlideLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}getClasses(){return n({entry:!0,[r.onePerSlideWidgetStyle.entry]:!0})}render(){const{style:e={},layout:t}=this.props,{dynamicLayout:s=o.oneSlideDynamicArticleLayoutSettings}=t.settings,n=t.entryId,r=this.getStyle(t.settings,s);return i.createElement("div",{className:this.getClasses(),style:e.style,key:n},i.createElement("article",{id:t.entryHash,style:r.article},this.generateLeftColumn(r),this.generateRightColumn(r)))}generateLeftColumn(e){const{layout:t}=this.props,{dynamicLayout:s=o.oneSlideDynamicArticleLayoutSettings}=t.settings;return i.createElement("div",{key:"columnLeft",className:s.columnCount>1?r.onePerSlideWidgetStyle.columnLeft:r.onePerSlideWidgetStyle.singleColumn,style:e.left},this.generateAuthorInfo(e),this.generateContent(e))}generateAuthorInfo(e){const{layout:t}=this.props;return i.createElement("div",{className:r.onePerSlideWidgetStyle.authorInfo},i.createElement("div",{className:r.onePerSlideWidgetStyle.header,style:e.header},i.createElement("div",{className:r.onePerSlideWidgetStyle.avatar,style:e.avatar},t.avatar,i.createElement("div",{className:r.onePerSlideWidgetStyle.icon},t.icon)),i.createElement("div",{className:r.onePerSlideWidgetStyle.authorBlock},t.authorBlock)),i.createElement("div",null,i.createElement("ul",{className:this.getOutroClassName()},t.outro)))}generateContent(e){const{layout:t}=this.props;return i.createElement("div",{key:"content"},i.createElement("div",{className:r.onePerSlideWidgetStyle.imageContainer,style:e.imageContainer},t.image),i.createElement("div",{className:r.onePerSlideWidgetStyle.title},t.title),i.createElement("div",{className:r.onePerSlideWidgetStyle.text},t.text))}generateRightColumn(e){return i.createElement("div",{key:"columnRight",className:r.onePerSlideWidgetStyle.columnRight,style:e.right},this.generatePrimaryMetrics(),this.generateSecondaryMetrics())}generatePrimaryMetrics(){const{layout:e}=this.props;return i.createElement("div",{className:r.onePerSlideWidgetStyle.topMetrics},this.getPrimaryMetricRenderables(e.metrics.primary_metrics))}getPrimaryMetricRenderables(e){return e.map(e=>i.createElement("div",{key:e.text,className:r.onePerSlideWidgetStyle.singlePrimaryMetric},i.createElement("div",{className:r.onePerSlideWidgetStyle.primaryMetricIcon},i.createElement("i",{className:e.icon})),i.createElement("span",{className:r.onePerSlideWidgetStyle.metricLabel},e.text),i.createElement("span",{className:r.onePerSlideWidgetStyle.metricValue},e.value)))}generateSecondaryMetrics(){const{layout:e}=this.props;return i.createElement("div",{className:r.onePerSlideWidgetStyle.topMetrics},i.createElement("div",{className:r.onePerSlideWidgetStyle.secondaryMetrics},this.generateSentiment(),this.getSecondaryMetricRenderables(e.metrics.secondary_metrics)))}getSecondaryMetricRenderables(e){return e.map(e=>i.createElement("div",{key:e.text,className:r.onePerSlideWidgetStyle.singleSecondaryMetric},i.createElement("span",{className:r.onePerSlideWidgetStyle.metricLabel},e.text),i.createElement("span",{className:r.onePerSlideWidgetStyle.metricValue},e.value)))}generateSentiment(){const e=this.props.article.sentiment_texts,t={color:e[1].font_color},s=e[1].text,n=e[0].text;return i.createElement("div",{key:s,className:r.onePerSlideWidgetStyle.singleSecondaryMetric},i.createElement("span",{className:r.onePerSlideWidgetStyle.metricLabel}," ",n),i.createElement("span",{className:r.onePerSlideWidgetStyle.metricValue,style:t},s))}getOutroClassName(){return n({"details list-inline":!0,[r.onePerSlideWidgetStyle.outro]:!0})}getStyle(e,t){const i=e.height,s=i/7.5,n=9*s/10,r=s-n,o=4*i/6,a=5*o/6,l=i/2.75;return{article:{height:`${i}px`,fontSize:i/40,borderTop:"none"},left:{paddingRight:t.columnCount>1?"1.5%":void 0},right:{display:t.columnCount>1?"block":"none",paddingLeft:"1.5%",borderLeft:"1px solid #d7dbdd"},header:{height:`${s}px`},avatar:{width:`${n}px`,height:`${n}px`,paddingTop:`${r}px`},textBox:{display:"inline-block",width:`calc(100% - ${n}px)`,height:`${o}px`,padding:"0.25em 0.25em 0.25em 1.25em",overflow:"hidden"},title:{fontWeight:"bold",lineHeight:"1.33em",marginBottom:0},metric:{display:2===t.columnCount?"block":"none",width:`${a}px`,height:"1.4em",fontSize:"1.4em",top:"50%",position:"relative",right:0,transform:"translateY(-50%)",color:"#838080",textAlign:"center"},imageContainer:{height:`${l}px`}}}}}),define("styles/widget/slides/ten_per_slide_widget_layout.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tenPerSlideWidgetStyleModel={container:{display:"flex",width:"100%",position:"relative",fontFamily:"Arial","& a":{textDecoration:"underline"},"& .emoji":{width:"1em",height:"1em"}},columnLeft:{order:0,flex:1,maxWidth:"50%"},columnRight:{order:1,flex:1,maxWidth:"50%"},singleColumn:{order:1,flex:1,maxWidth:"100%"},entry:{"& article":{borderStyle:"none !important"}},avatar:{position:"absolute",left:"10%",top:"16%","& img":{borderRadius:"100%",maxHeight:"88%",maxWidth:"88%"}},icon:{position:"absolute",top:"0em",right:"0.6em","& .favicon":{maxHeight:"1.05em",maxWidth:"1.05em"}},avatarIconContainer:{width:"5em",maxHeight:"4.5em",position:"relative"},textBox:{position:"absolute",left:"5.3em",top:"0.7em"},metric:{height:"1.4em",fontSize:"1.4em",top:"20%",position:"absolute",right:"0.6em",color:"#838080"},outro:{position:"absolute",top:"63%","& li":{display:"inline",fontStyle:"oblique"}},title:{fontStyle:"oblique",fontWeight:"bold",fontSize:"1.2em",lineHeight:"102%",marginBottom:"0.5%","& a":{textDecoration:"underline !important"}},text:{fontStyle:"oblique",color:"black",fontSize:"1.05em",lineHeight:"1.15em",maxHeight:"3.41em",overflow:"hidden","& em":{border:"none",fontStyle:"oblique"},"& a":{textDecoration:"none"}}},t.tenPerSlideWidgetStyle=i.createCssModule(()=>t.tenPerSlideWidgetStyleModel).compute({}).attach().getModule()}),define("renderables/layouts/widget/slides/ten_slide_widget_layout_renderable",["require","exports","react","layouts/widget/widget_layout_types","styles/widget/slides/ten_per_slide_widget_layout.css","renderables/article_renderable","renderables/layouts/article/slides/ten_slide_layout_renderable","renderables/layouts/widget/dynamic_size_widget_layout_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tenSlideDynamicArticleLayoutSettings={articleCount:10,columnCount:2,displayMetric:!0,numberOfRows:5};t.TenSlideWidgetLayoutRenderable=class extends a.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{dynamicLayout:i=t.tenSlideDynamicArticleLayoutSettings}=e.settings;return 2===i.columnCount?this.renderDoubleColumnLayout(i):this.renderSingleColumnLayout(i)}renderDoubleColumnLayout(e=t.tenSlideDynamicArticleLayoutSettings){const{configuration:s}=this.props,{payload:r}=s,a=r.articles,l=a.slice(0,e.numberOfRows),c=a.slice(e.numberOfRows,e.articleCount);return i.createElement("div",{className:n.tenPerSlideWidgetStyle.container},i.createElement("div",{className:n.tenPerSlideWidgetStyle.columnLeft},l.map((e,t)=>this.generateArticleRenderable(e,t,s,o.PaddingPosition.RIGHT))),i.createElement("div",{className:n.tenPerSlideWidgetStyle.columnRight},c.map((e,t)=>this.generateArticleRenderable(e,t,s,o.PaddingPosition.LEFT))))}renderSingleColumnLayout(e=t.tenSlideDynamicArticleLayoutSettings){const{configuration:s}=this.props,{payload:r}=s,a=r.articles.slice(0,e.articleCount);return i.createElement("div",{className:n.tenPerSlideWidgetStyle.singleColumn},a.map((e,t)=>this.generateArticleRenderable(e,t,s,o.PaddingPosition.NONE)))}generateArticleRenderable(e,t,n,o){const{widgetId:a,messages:l,settings:c,iconMap:d}=n;return e.key=e.entry_id+s.WidgetLayoutTypes.RESULTSLIST_SLIDES_TEN,i.createElement(r.ArticleRenderable,{key:e.key,widgetLayout:s.WidgetLayoutTypes.RESULTSLIST_SLIDES_TEN,widgetId:a,article:e,messages:l,settings:c,iconMap:d,showSeparator:!1,separatorCount:t+1,paddingPosition:o})}}}),define("renderables/layouts/article/slides/ten_slide_layout_renderable",["require","exports","react","flux","classnames","styles/widget/slides/ten_per_slide_widget_layout.css","renderables/layouts/widget/slides/ten_slide_widget_layout_renderable"],function(e,t,i,s,n,r,o){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.NONE=2]="NONE"}(a=t.PaddingPosition||(t.PaddingPosition={}));t.TenSlideLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}getClasses(){return n({entry:!0,[r.tenPerSlideWidgetStyle.entry]:!0})}render(){const{style:e={},layout:t,paddingPosition:s}=this.props,{dynamicLayout:n=o.tenSlideDynamicArticleLayoutSettings}=t.settings,a=t.entryId,l=this.getStyle(t.settings,s,n);return i.createElement("div",{className:this.getClasses(),style:e.style,key:a},i.createElement("article",{id:t.entryHash,style:l.article},i.createElement("div",{className:r.tenPerSlideWidgetStyle.avatarIconContainer},i.createElement("div",{className:r.tenPerSlideWidgetStyle.avatar},t.avatar),i.createElement("div",{className:r.tenPerSlideWidgetStyle.icon},t.icon)),i.createElement("div",{className:r.tenPerSlideWidgetStyle.textBox,style:l.textBoxWidth},i.createElement("div",{className:r.tenPerSlideWidgetStyle.title},t.title),i.createElement("div",{className:r.tenPerSlideWidgetStyle.text},t.text)),n.displayMetric?i.createElement("div",{className:r.tenPerSlideWidgetStyle.metric},t.metricsContainer):null,i.createElement("div",{className:this.getOutroClassName()},i.createElement("ul",{className:"details list-inline"},t.outro))))}getStyle(e,t,i){const{height:s}=e,n=s/i.numberOfRows,r=n/6,o=1*r/5,l=r-o,c=n/8.75,d=i.displayMetric?68:72;return{article:{height:`${n}px`,paddingTop:`${o}px`,paddingBottom:`${l}px`,fontSize:c,paddingRight:t===a.RIGHT?"1%":void 0,paddingLeft:t===a.LEFT?"1%":void 0},textBoxWidth:{maxWidth:`${d}%`}}}getOutroClassName(){return n({"detailsObliqueOptimized list-inline":!0,[r.tenPerSlideWidgetStyle.outro]:!0})}}}),define("styles/widget/slides/three_per_slide_widget_layout.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.threePerSlideWidgetStyleModel={container:{width:"100%",display:"flex",flexGrow:"0",justifyContent:"space-between",fontFamily:"Arial",color:"black"},articleWithCompleteBorder:{border:"thin solid rgba(0,0,0,0.1)",flexDirection:"column",flexGrow:"0",flexWrap:"nowrap !important"},firstRow:{flexBasis:"19.5%",position:"relative",backgroundColor:"rgba(210,210,210,0.5)",paddingBottom:"9%"},secondRow:{position:"relative",flexBasis:"11%",marginTop:"1%"},thirdRow:{flexBasis:"35%",position:"relative",marginTop:"2%"},fourthRow:{flexBasis:"25%",position:"relative",marginTop:"10%"},fifthRow:{position:"relative",flexBasis:"14%",marginBottom:"5%"},entry:{display:"flex",flexWrap:"nowrap"},authorInfoContainer:{position:"relative"},header:{display:"flex",fontSize:"1.33em",marginBottom:"0.5em"},avatar:{position:"absolute",left:"2.5%",top:"9.8%","& .clickable":{borderRadius:"50%",maxWidth:"3.3em"}},authorBlock:{maxWidth:"69%",height:"40%",maxHeight:"40%",position:"absolute",left:"5.5em",top:"9%",fontWeight:"bold",fontStyle:"oblique",fontSize:"0.8em","& div":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"1.4em",marginBottom:"4%"},"& a":{textDecoration:"underline"},"& ul":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",fontSize:"1.4em","& li":{paddingRight:"0"}}},outro:{display:"block",position:"absolute",top:"5.2em",left:"1em",maxWidth:"96%",marginBottom:"0",whiteSpace:"normal",fontStyle:"oblique",fontSize:"0.92em !important",overflow:"hidden",maxHeight:"37%",lineHeight:"1.25","& li":{"& a":{"& span":{textDecoration:"underline"}},"&:not(:last-child):after":{content:'"|"',fontStyle:"normal",margin:"0 0.25em",padding:"0 !important"},"&:last-child":{display:"inline"}}},titleContainer:{display:"block",position:"absolute",fontSize:"0.9em",left:"6%",top:"28%",overflow:"hidden",height:"42%",width:"87%",textOverflow:"ellipsis",whiteSpace:"nowrap","& span":{display:"block",width:"100%",height:"100%",textDecoration:"underline",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",fontStyle:"oblique"}},textContainer:{fontSize:"1.1em",display:"block",height:"81%",width:"95%",position:"absolute",left:"4.5%",right:"1.5%",color:"gray",fontStyle:"oblique",lineHeight:"126%","& em":{border:"none",fontWeight:"normal",fontStyle:"oblique"},"& span":{display:"block",maxHeight:"100%",overflow:"hidden"},"& a":{color:"gray"},"&:after":{content:'""',background:"rgba(0,0,0,0.25)",position:"absolute",bottom:"-12%",width:"86%",height:"1px",left:"5%"},"& .emoji":{width:"1em !important",height:"1em !important"}},authorBlockFlags:{marginBottom:0},icon:{position:"absolute",top:"0%",right:"0%","& .favicon":{maxWidth:"1em",maxHeight:"1em"}},image:{"& .thumbnail":{maxWidth:"92% !important",padding:"0 !important",border:"none !important",margin:"auto !important",borderRadius:"0 !important",maxHeight:"100% !important",width:"auto",height:"auto",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"},"& .thumbnail-container":{margin:"0 !important",height:"100% !important",maxHeight:"100% !important",width:"inherit !important"}},primaryMetrics:{position:"absolute",marginLeft:"4.5%",color:"gray",top:"-15%",fontWeight:"bold",padding:"0",listStyleType:"none",maxWidth:"81%",fontSize:"0.9em","& li":{display:"inline","&:not(:last-child):after":{content:'"|"',paddingRight:"0.45em",paddingLeft:"0.4em",padding:"0 0.3em !important"}}},sentiment:{position:"absolute",color:"gray",fontSize:"0.9em",marginLeft:"4.5%",top:"10%"},secondaryMetrics:{position:"absolute",marginLeft:"4.5%",fontSize:"0.65em",color:"gray",padding:"0",top:"43%",listStyleType:"none",width:"90%","& li":{display:"inline","&:not(:last-child):after":{content:'"|"',paddingRight:"0.5em",paddingLeft:"0.4em",padding:"0 0.3em !important"}}},articleHeaderColumnWithBorder:{borderLeft:"thin solid rgba(0, 0, 0, 0.1)"}},t.threePerSlideWidgetStyle=i.createCssModule(()=>t.threePerSlideWidgetStyleModel).compute({}).attach().getModule()}),define("renderables/layouts/article/slides/three_slide_layout_renderable",["require","exports","react","flux","classnames","styles/widget/slides/three_per_slide_widget_layout.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ThreeSlideLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}getClasses(){return n({[r.threePerSlideWidgetStyle.entry]:!0})}render(){const{style:e,layout:t}=this.props,s=t.entryId;return i.createElement("div",{className:this.getClasses(),style:e.articleProportions.article,key:s},i.createElement("article",{id:t.entryHash,className:r.threePerSlideWidgetStyle.articleWithCompleteBorder},this.generateFirstRow(),this.generateSecondRow(),this.generateThirdRow(),this.generateFourthRow(),this.generateFifthRow()))}generateFirstRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.threePerSlideWidgetStyle.firstRow},i.createElement("div",{className:r.threePerSlideWidgetStyle.avatar},e.avatar," ",i.createElement("div",{className:r.threePerSlideWidgetStyle.icon}," ",e.icon," ")),i.createElement("div",{className:r.threePerSlideWidgetStyle.authorBlock},e.authorBlock," "),i.createElement("ul",{className:this.getOutroClassName()}," ",e.outro," "))}generateSecondRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.threePerSlideWidgetStyle.secondRow},i.createElement("div",{className:r.threePerSlideWidgetStyle.titleContainer},e.title))}generateThirdRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.threePerSlideWidgetStyle.thirdRow},i.createElement("div",{className:r.threePerSlideWidgetStyle.image},e.image))}generateFourthRow(){const{layout:e}=this.props;return i.createElement("div",{className:r.threePerSlideWidgetStyle.fourthRow},i.createElement("div",{className:r.threePerSlideWidgetStyle.textContainer},e.text))}generateFifthRow(){return i.createElement("div",{className:r.threePerSlideWidgetStyle.fifthRow},this.generatePrimaryMetrics(),this.generateSentiment(),this.generateSecondaryMetrics())}generatePrimaryMetrics(){const{layout:e}=this.props;return i.createElement("ul",{className:r.threePerSlideWidgetStyle.primaryMetrics},e.metrics.primary_metrics.map(e=>i.createElement("li",{key:e.text},e.text+" "+e.value)))}generateSentiment(){const e=this.props.article.sentiment_texts,t={color:e[1].font_color},s=e[1].text,n=e[0].text;return i.createElement("div",{className:r.threePerSlideWidgetStyle.sentiment},n,i.createElement("span",{style:t}," ",s))}generateSecondaryMetrics(){const{layout:e}=this.props;return i.createElement("ul",{className:r.threePerSlideWidgetStyle.secondaryMetrics},e.metrics.secondary_metrics.map(e=>i.createElement("li",{key:e.text},e.text+" "+e.value)))}getOutroClassName(){return n({"details list-inline":!0,[r.threePerSlideWidgetStyle.outro]:!0})}}}),define("renderables/layouts/article/story_layout_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StoryLayoutRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}render(){const{layout:e,article:t}=this.props,{entry_id:s}=t,{text:r,subtitle:o,outro:a,image:l}=e,c=i({story:!0,animated:this.props.isAnimated}),d=i({"thumbnail-container":!0,"no-image":null===l});return n.createElement("div",{className:c,key:s},n.createElement("div",{className:"top"},n.createElement("div",{className:d},l)),n.createElement("div",{className:"middle"},r,n.createElement("small",null,o)),n.createElement("div",{className:"bottom"},n.createElement("ul",{className:"list-unstyled clearfix"},n.createElement("ul",{className:"details list-inline"},a))))}}}),define("renderables/layouts/article/tile_layout_renderable",["require","exports","classnames","flux","flux","react","react-dom","underscore","actions/article_actions","containers/article_context_menu_container"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TileLayoutRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state=this.initializeState(e.style)}shouldComponentUpdate(e,t){const i=this.props;if(i.article.entry_id!==e.article.entry_id||i.layout.selected!==e.layout.selected||i.article.show_translation!==e.article.show_translation||!a.isEqual(i.article.save_to_user_workflow_button,e.article.save_to_user_workflow_button))return!0;const s=this.state;return s.visible!==t.visible||!s.visible&&!t.visible||s.x!==t.x||s.y!==t.y||s.height!==t.height||s.width!==t.width}componentWillReceiveProps(e,t){a.isEqual(this.props,e)||this.setState(this.initializeState(e.style))}componentDidMount(){this.triggerCallback()}componentDidUpdate(e,t){!1===this.state.visible&&!0===t.visible&&this.triggerCallback()}render(){const{layout:e}=this.props,{image:t,text:s,subtitle:n,outro:o,metricBar:a}=e,l=this.generateStyle(),d=i({story:!0,animated:this.props.isAnimated}),h=i({"thumbnail-container":!0,"no-image":null===t});return r.createElement("div",{className:d,ref:this.registerElement.bind(this),style:l,onClick:this.handleEntryClick.bind(this)},r.createElement(c.ArticleContextMenuContainer,{entryId:e.entryId,widgetId:e.widgetId,buttonHash:e.entryHash,messages:e.messages.contextMenu,settings:e.settings}),e.contextMenuButton,r.createElement("div",{className:"top"},r.createElement("div",{className:h},t,a)),r.createElement("div",{className:"middle"},s,r.createElement("small",null,n)),r.createElement("div",{className:"bottom"},r.createElement("ul",{className:"list-unstyled clearfix"},r.createElement("ul",{className:"details list-inline"},o))))}triggerCallback(){if(this.state.visible)return;const e=this.props;if(this.ref&&e.loadCallback){let t=!1;if(!a.isUndefined(e.layout.image)){const i=o.findDOMNode(this.ref),s=$(i).find(".thumbnail").get(0),n=$(i).find("canvas").get(0);if(n)return e.loadCallback(this.ref),setTimeout(()=>{e.loadCallback(this.ref)},500),setTimeout(()=>{e.loadCallback(this.ref)},1e3),void setTimeout(()=>{e.loadCallback(this.ref)},2e3);const r=$(i).find(".bounding-box-img").get(0),a=$(i).find(".thumbnail-container").get(0);if(s){if(s.complete)setTimeout(()=>{s.width>=this.state.width&&($(s).css("width","100%"),n&&$(n).css("width","100%"),r&&$(r).css("width","100%")),e.loadCallback(this.ref)},0);else{const t=s.onload;s.onload=(i=>{s.width>=this.state.width&&($(s).css("width","100%"),n&&$(n).css("width","100%"),r&&$(r).css("width","100%")),t&&t.call(s,i),e.loadCallback(this.ref)}),s.onerror=(()=>{$("img",a).remove(),a&&$(a).addClass("no-image"),setTimeout(()=>{e.loadCallback(this.ref)},0)})}t=!0}}t||e.loadCallback(this.ref)}}registerElement(e){this.ref=e}generateStyle(){return{position:"absolute",width:this.getWidth(),height:this.getHeight(),top:this.getTop(),left:this.getLeft(),opacity:this.state.visible?1:0,backgroundColor:this.props.layout.selected&&"#f0f0f0",transition:this.getTransitions()}}getWidth(){return this.state.width?this.state.width+"px":"auto"}getHeight(){return this.state.height?this.state.height+"px":"auto"}getLeft(){return this.state.x?this.state.x+"px":"0"}getTop(){return this.state.y?this.state.y+"px":"0"}getTransitions(){return this.state.noAnimations?"none !important":void 0}initializeState(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0,visible:e.visible||!1,noAnimations:e.noAnimations||!1}}handleEntryClick(e){const t=e.nativeEvent;if($(t.target).is("a")||$(t.target).is("img")||$(t.target).is(".thumbnail-container")||e.defaultPrevented||t.defaultPrevented)return;const{entryId:i,widgetId:s}=this.props.layout;n.dispatcher.dispatch(l.ArticleActions.article_onEntryClicked,{entryId:i,widgetId:s,event:e})}}}),define("layouts/article/comment_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/article/layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutTypes={DEFAULT:"default",DEFAULT_TOGGLE_METRICS:"default_toggle_metrics",DEFAULT_NO_TITLE:"default_no_title",DEFAULT_COMMENT:"default_comment",TWITTER:"twitter",FAKE:"fake",SLIDE_ONE_ARTICLE_PER_SLIDE:"slide_one_article_per_slide",SLIDE_ONE_ARTICLE_PER_SLIDE_TWITTER:"slide_one_article_per_slide_twitter",SLIDE_ONE_ARTICLE_PER_SLIDE_INSTAGRAM:"slide_one_article_per_slide_instagram",SLIDE_THREE_ARTICLES_PER_SLIDE:"slide_three_articles_per_slide",SLIDE_THREE_ARTICLES_PER_SLIDE_TWITTER:"slide_three_articles_per_slide_twitter",SLIDE_THREE_ARTICLES_PER_SLIDE_INSTAGRAM:"slide_three_articles_per_slide_instagram",SLIDE_FIVE_ARTICLES_PER_SLIDE:"slide_five_articles_per_slide",SLIDE_FIVE_ARTICLES_PER_SLIDE_TWITTER:"slide_five_articles_per_slide_twitter",SLIDE_FIVE_ARTICLES_PER_SLIDE_INSTAGRAM:"slide_five_articles_per_slide_instagram",SLIDE_TEN_ARTICLES_PER_SLIDE:"slide_ten_articles_per_slide",SLIDE_TEN_ARTICLES_PER_SLIDE_TWITTER:"slide_ten_articles_per_slide_twitter",SLIDE_TEN_ARTICLES_PER_SLIDE_INSTAGRAM:"slide_ten_articles_per_slide_instagram",SLIDE_IMAGES_ARTICLES:"slide_images_articles",SLIDE_IMAGES_ARTICLES_TWITTER:"slide_images_articles_twitter",SLIDE_IMAGES_ARTICLES_INSTAGRAM:"slide_images_articles_instagram",STORY_TILE:"story_tile",STORY_TILE_NO_IMAGE:"story_tile_no_image",STORY_TILE_NO_ICON:"story_tile_no_icon",STORY_TILE_NO_IMAGE_NO_ICON:"story_tile_no_image_no_icon",STORY:"story",STORY_NO_IMAGE:"story_no_image",COMPACT:"compact",GRID:"grid",COMPACT_TWITTER:"compact_twitter",UNICEPTA_DEFAULT:"unicepta_default",UNICEPTA_DEFAULT_NO_TITLE:"unicepta_default_no_title",TREE_TILE:"tree_tile",TWITTER_INTERACTIONS:"twitter_interactions"}}),define("renderables/components/button_list_renderable",["require","exports","react","reusable_components","flux"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ButtonListRenderable=class extends n.BaseComponent{constructor(e){super(e)}render(){const e=this.props.className||null,t=this.props.buttons.map((e,t)=>e?[i.createElement("li",{key:"btn_"+t},i.createElement(s.ButtonRenderable,Object.assign({},e))),"\n"]:null);return i.createElement("ul",{className:e},t)}}}),define("renderables/components/comment_renderable",["require","exports","classnames","flux","react","reusable_components","actions/article_actions","underscore"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CommentRenderable=class extends s.BaseComponent{render(){const e=this.generateContent(),t=this.generateOutro(),s=i({comment:!0,active:this.props.selected});return n.createElement("li",{className:s,id:this.props.entryHash,onClick:this.onCommentClick.bind(this)},e,t)}generateContent(){if(this.props.text){const e=this.props.text[0];return n.createElement("p",null,n.createElement(r.TextBlockRenderable,Object.assign({},e.model)))}return null}generateOutro(){if(this.props.outro){const e=a.map(this.props.outro,(e,t)=>{const i=e;return n.createElement("li",{key:t},n.createElement(r.TextBlockRenderable,Object.assign({},i.model)))});return n.createElement("ul",{className:"details list-inline"},e)}return null}onCommentClick(e){s.dispatcher.dispatch(o.ArticleActions.article_onChildEntryClicked,{commentId:this.props.commentId,entryId:this.props.entryId,widgetId:this.props.widgetId,event:e})}}}),define("renderables/components/comment_container_renderable",["require","exports","underscore","react","renderables/components/comment_renderable","flux","reusable_components","stores/article_store","actions/article_actions"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CommentContainerRenderable=class extends r.BaseComponent{constructor(e){super(e),this.state={comments:this.props.comments}}componentDidMount(){this.cancellationToken.subscribe(a.ArticleStore.getInstance().onChange,e=>{if(e.widgetId===this.props.widgetId)switch(e.action){case l.ArticleActions.article_onKeyPressed:case l.ArticleActions.article_onArrowKeyPressed:case l.ArticleActions.article_onEntryClicked:case l.ArticleActions.article_onChildEntryClicked:case l.ArticleActions.article_onReceiveChildArticles:this.refreshSelections(e.selection)}})}componentWillReceiveProps(e,t){i.isEqual(this.props,e)||this.setState({comments:e.comments})}refreshSelections(e){const t=this.state.comments;t&&e&&i.each(t,t=>{t.selected=!i.isUndefined(i.find(e.get(),e=>e.entry_id===t.commentId))}),this.setState({comments:t})}render(){if(!this.state.comments||0===this.state.comments.length)return null;const e=this.props.isComments?"comments":"children",t=this.generateHeader(),i=this.generateCommentList(),n=this.generateFooter();return s.createElement("div",{className:e},t,i,n)}generateHeader(){const e=this.props.blocks.headerLabel[0],t=this.props.blocks.filterLabel[0],i=this.props.blocks.countLabel[0];return t.model.click_action.is_comments=this.props.isComments,s.createElement("div",null,s.createElement("header",{className:"bottom_comments-header clearfix"},s.createElement(o.TextBlockRenderable,Object.assign({},e.model,{className:"sub-title"})),s.createElement(o.TextBlockRenderable,Object.assign({},t.model,{className:"filter-toggle sub-title"})),s.createElement(o.TextBlockRenderable,Object.assign({},i.model,{className:"count pull-right"}))))}generateCommentList(){const e=i.map(this.state.comments||[],e=>s.createElement(n.CommentRenderable,Object.assign({},e,{widgetId:this.props.widgetId,key:e.commentId})));return s.createElement("ul",{className:"list-unstyled"},e)}generateFooter(){const{blocks:e,canLoadMore:t}=this.props;if(t&&e.loadMore){const t=e.loadMore[0],i=t.model;return i.click_action=Object.assign({},t.model.click_action,{widget_id:this.props.widgetId,article_id:this.props.entryId,is_comments:this.props.isComments}),s.createElement(o.TextBlockRenderable,Object.assign({},i,{className:"load-more clickable"}))}return s.createElement("span",{className:"load-more"})}}}),define("renderables/components/reusable/article_layout_component",["require","exports","layouts/article/layout_types"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleLayoutComponent=class{render(e){const{layout:t}=e;if(!this.checkRequiredProps(e))return null;switch(t){case i.LayoutTypes.DEFAULT:return this.renderDefault(e);case i.LayoutTypes.DEFAULT_NO_TITLE:return this.renderDefaultNoTitle(e);case i.LayoutTypes.TWITTER:return this.renderTwitter(e);case i.LayoutTypes.UNICEPTA_DEFAULT:return this.renderUniceptaDefault(e);case i.LayoutTypes.UNICEPTA_DEFAULT_NO_TITLE:return this.renderUniceptaDefaultNoTitle(e);case i.LayoutTypes.TWITTER_INTERACTIONS:return this.renderTwitterInteractions(e);case i.LayoutTypes.COMPACT:return this.renderCompact(e);case i.LayoutTypes.COMPACT_TWITTER:return this.renderCompactTwitter(e);case i.LayoutTypes.FAKE:return this.renderFake(e);case i.LayoutTypes.STORY:return this.renderStory(e);case i.LayoutTypes.STORY_NO_IMAGE:return this.renderStoryNoImage(e);case i.LayoutTypes.STORY_TILE:return this.renderStoryTile(e);case i.LayoutTypes.STORY_TILE_NO_IMAGE:return this.renderStoryTileNoImage(e);case i.LayoutTypes.STORY_TILE_NO_ICON:return this.renderStoryTileNoIcon(e);case i.LayoutTypes.STORY_TILE_NO_IMAGE_NO_ICON:return this.renderStoryTileNoImageNoIcon(e);case i.LayoutTypes.GRID:return this.renderGrid(e);case i.LayoutTypes.DEFAULT_COMMENT:return this.renderDefaultComment(e);case i.LayoutTypes.TREE_TILE:return this.renderTreeTile(e);case i.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE:return this.renderSlideOneArticlePerSlide(e);case i.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_TWITTER:return this.renderSlideOneArticlePerSlideTwitter(e);case i.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_INSTAGRAM:return this.renderSlideOneArticlePerSlideInstagram(e);case i.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE:return this.renderSlideThreeArticlesPerSlide(e);case i.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_TWITTER:return this.renderSlideThreeArticlesPerSlideTwitter(e);case i.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_INSTAGRAM:return this.renderSlideThreeArticlesPerSlideInstagram(e);case i.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE:return this.renderSlideFiveArticlesPerSlide(e);case i.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_TWITTER:return this.renderSlideFiveArticlesPerSlideTwitter(e);case i.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_INSTAGRAM:return this.renderSlideFiveArticlesPerSlideInstagram(e);case i.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE:return this.renderSlideTenArticlesPerSlide(e);case i.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_TWITTER:return this.renderSlideTenArticlesPerSlideTwitter(e);case i.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_INSTAGRAM:return this.renderSlideTenArticlesPerSlideInstagram(e);case i.LayoutTypes.SLIDE_IMAGES_ARTICLES:return this.renderSlideImagesArticles(e);case i.LayoutTypes.SLIDE_IMAGES_ARTICLES_TWITTER:return this.renderSlideImagesArticlesTwitter(e);case i.LayoutTypes.SLIDE_IMAGES_ARTICLES_INSTAGRAM:return this.renderSlideImagesArticlesInstagram(e);default:return console.warn("Unknown layout type: "+t),this.renderUnknownLayout(e)}}checkRequiredProps(e){return!0}renderDefault(e){return null}renderDefaultNoTitle(e){return null}renderTwitter(e){return null}renderUniceptaDefault(e){return null}renderUniceptaDefaultNoTitle(e){return null}renderTwitterInteractions(e){return null}renderCompact(e){return null}renderCompactTwitter(e){return null}renderFake(e){return null}renderStory(e){return null}renderStoryNoImage(e){return null}renderStoryTile(e){return null}renderStoryTileNoImage(e){return null}renderStoryTileNoIcon(e){return null}renderStoryTileNoImageNoIcon(e){return null}renderGrid(e){return null}renderDefaultComment(e){return null}renderTreeTile(e){return null}renderSlideOneArticlePerSlide(e){return null}renderSlideOneArticlePerSlideTwitter(e){return null}renderSlideOneArticlePerSlideInstagram(e){return null}renderSlideThreeArticlesPerSlide(e){return null}renderSlideThreeArticlesPerSlideTwitter(e){return null}renderSlideThreeArticlesPerSlideInstagram(e){return null}renderSlideFiveArticlesPerSlide(e){return null}renderSlideFiveArticlesPerSlideTwitter(e){return null}renderSlideFiveArticlesPerSlideInstagram(e){return null}renderSlideTenArticlesPerSlide(e){return null}renderSlideTenArticlesPerSlideTwitter(e){return null}renderSlideTenArticlesPerSlideInstagram(e){return null}renderSlideImagesArticles(e){return null}renderSlideImagesArticlesTwitter(e){return null}renderSlideImagesArticlesInstagram(e){return null}renderUnknownLayout(e){return null}}}),define("renderables/components/reusable/author_block_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components","factories/block_factory","classnames","styles/widget/slides/five_per_slide_widget_layout.css","styles/widget/slides/three_per_slide_widget_layout.css"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AuthorBlockComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){return!0}createAuthorBlock(e,t=""){const s=[],{authorBlocks:a,flags:l}=e;if(a&&a.length>0){const e=a[0];s.push(i.createElement("div",{key:"author"},i.createElement(n.TextBlockRenderable,Object.assign({},e.model))))}if(l&&l.length>0){const e=[];l.forEach((t,i)=>r.BlockFactory.addBlockAsListItem(e,t,{key:`flag-${i}`,blockType:n.TextBlockRenderable})),s.push(i.createElement("ul",{key:"flags",className:o({"list-inline":!0,[t]:!0})},e))}return s}createAuthorBlockSeparatedFlags(e,t=""){const s=[],{authorBlocks:a,flags:l}=e;if(a&&a.length>0){const e=a[0];r.BlockFactory.parseEmojisInBlock(e),s.push(i.createElement("div",{key:"author"},i.createElement(n.TextBlockRenderable,Object.assign({},e.model))))}if(l&&l.length>0){const e=[];l.forEach((t,i)=>r.BlockFactory.addBlockAsListItem(e,t,{key:`flag-${i}`,blockType:n.TextBlockRenderable})),s.push(i.createElement("ul",{key:"flags",className:o({"list-inline":!0,[t]:!0,detailsObliqueOptimized:!0})},e))}return s}renderSlideOneArticlePerSlide(e){return this.createAuthorBlock(e)}renderSlideOneArticlePerSlideTwitter(e){return this.createAuthorBlock(e)}renderSlideOneArticlePerSlideInstagram(e){return this.createAuthorBlock(e)}renderSlideFiveArticlesPerSlide(e){return this.createAuthorBlockSeparatedFlags(e,a.fivePerSlideWidgetStyle.authorBlockFlags)}renderSlideFiveArticlesPerSlideTwitter(e){return this.createAuthorBlockSeparatedFlags(e,a.fivePerSlideWidgetStyle.authorBlockFlags)}renderSlideFiveArticlesPerSlideInstagram(e){return this.createAuthorBlockSeparatedFlags(e,a.fivePerSlideWidgetStyle.authorBlockFlags)}renderSlideThreeArticlesPerSlide(e){return this.createAuthorBlock(e,l.threePerSlideWidgetStyle.authorBlockFlags)}renderSlideThreeArticlesPerSlideTwitter(e){return this.createAuthorBlock(e,l.threePerSlideWidgetStyle.authorBlockFlags)}renderSlideThreeArticlesPerSlideInstagram(e){return this.createAuthorBlock(e,l.threePerSlideWidgetStyle.authorBlockFlags)}}}),define("renderables/components/reusable/avatar_component",["require","exports","react","reusable_components","renderables/components/reusable/article_layout_component"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AvatarComponent=class extends n.ArticleLayoutComponent{createImageBlockNoFallback(e,t="avatar"){const{avatarBlocks:n}=e;if(!n)return null;const r=n[0];return i.createElement(s.ImageBlockRenderable,Object.assign({},r.model,{className:t}))}createImageBlockWithSocialMediaFallback(e){const{avatarBlocks:t,article:n,iconMap:r}=e;if(!r)return null;const o={iconMap:r,sourceType:n.source_type};if(t&&t[0]){const e=t[0],n=i.createFactory.bind(i,s.SocialMediaIconRenderable);return i.createElement("div",{className:"avatar-container"},i.createElement(s.ImageBlockRenderable,Object.assign({},e.model,{className:"avatar",errorTag:n(),errorProps:o})))}return i.createElement(s.SocialMediaIconRenderable,Object.assign({},o))}renderDefault(e){return this.createImageBlockNoFallback(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderTwitterInteractions(e){return this.renderDefault(e)}renderCompact(e){return this.createImageBlockWithSocialMediaFallback(e)}renderCompactTwitter(e){return this.renderCompact(e)}renderSlideTenArticlesPerSlide(e){return this.createImageBlockNoFallback(e,"")}renderSlideTenArticlesPerSlideTwitter(e){return this.createImageBlockNoFallback(e,"")}renderSlideTenArticlesPerSlideInstagram(e){return this.createImageBlockNoFallback(e,"")}renderSlideFiveArticlesPerSlide(e){return this.createImageBlockNoFallback(e,"")}renderSlideFiveArticlesPerSlideTwitter(e){return this.createImageBlockNoFallback(e,"")}renderSlideFiveArticlesPerSlideInstagram(e){return this.createImageBlockNoFallback(e,"")}renderSlideThreeArticlesPerSlide(e){return this.createImageBlockNoFallback(e,"")}renderSlideThreeArticlesPerSlideTwitter(e){return this.createImageBlockNoFallback(e,"")}renderSlideThreeArticlesPerSlideInstagram(e){return this.createImageBlockNoFallback(e,"")}renderSlideOneArticlePerSlide(e){return this.createImageBlockNoFallback(e,"")}renderSlideOneArticlePerSlideTwitter(e){return this.createImageBlockNoFallback(e,"")}renderSlideOneArticlePerSlideInstagram(e){return this.createImageBlockNoFallback(e,"")}}}),define("renderables/components/reusable/comment_container_component",["require","exports","react","renderables/components/reusable/article_layout_component","renderables/components/comment_container_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CommentContainerComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{comments:t,containerBlocks:i,messages:s}=e;return!!t&&t.length>0&&!!i&&!!s}createCommentContainerRenderable(e){const{entryId:t,widgetId:s,containerBlocks:r,comments:o,messages:a,isComments:l=!0,canLoadMore:c=!0}=e,d=l?"comments":"stories";return i.createElement(n.CommentContainerRenderable,{entryId:t,widgetId:s,comments:o,messages:a,isComments:l,blocks:r,canLoadMore:c,key:d})}renderDefault(e){return this.createCommentContainerRenderable(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.createCommentContainerRenderable(e)}renderUniceptaDefaultNoTitle(e){return this.renderUniceptaDefault(e)}renderFake(e){return this.createCommentContainerRenderable(e)}renderTwitter(e){return this.createCommentContainerRenderable(e)}}}),define("renderables/components/reusable/icon_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{iconBlocks:t}=e;return!!t&&!!t[0]}createImageBlock(e){const{iconBlocks:t}=e,s=t[0];return s?i.createElement(n.ImageBlockRenderable,Object.assign({},s.model,{className:"favicon"})):null}renderDefault(e){return this.createImageBlock(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderFake(e){return this.renderDefault(e)}renderCompact(e){return this.renderDefault(e)}renderCompactTwitter(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderTwitterInteractions(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlide(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlide(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideImagesArticles(e){return this.renderDefault(e)}renderSlideImagesArticlesTwitter(e){return this.renderDefault(e)}renderSlideImagesArticlesInstagram(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlide(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideOneArticlePerSlide(e){return this.renderDefault(e)}renderSlideOneArticlePerSlideTwitter(e){return this.renderDefault(e)}renderSlideOneArticlePerSlideInstagram(e){return this.renderDefault(e)}}}),define("renderables/components/reusable/image_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components","factories/block_factory","classnames"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageComponent=class extends s.ArticleLayoutComponent{getFallbackImageFactory(){return i.createFactory.bind(i,n.FallbackImageRenderable)}createImageBlockOnlyErrorFallback(e){const{imageBlocks:t}=e,s=this.getFallbackImageFactory();if(t&&t[0]){const e=t[0];return i.createElement("div",{className:"thumbnail-container"},i.createElement(n.ImageBlockRenderable,Object.assign({},e.model,{show_url:r.BlockFactory.shouldShowURL(e),className:"thumbnail",errorTag:s(),errorClass:"icon2-tw-no-img1 img-error-font img-error-font-colors fallback"})))}return null}createImageBlockAlwaysFallback(e){const{imageBlocks:t,imageUrlEnhancer:s}=e,a=this.getFallbackImageFactory();if(t){const e=t[0];return i.createElement("div",{className:"thumbnail-container"},i.createElement(n.ImageBlockRenderable,Object.assign({},e.model,{show_url:r.BlockFactory.shouldShowURL(e),urlEnhancer:s,className:"thumbnail",errorTag:a(),errorClass:"icon2-tw-no-img1 img-error-font img-error-font-colors fallback clickable"})))}{const e=o({"icon2-tw-no-img1 img-error-font img-error-font-colors fallback clickable":!0});return i.createElement("div",{className:"thumbnail-container"},i.createElement(n.FallbackImageRenderable,{className:e}))}}createImageBlockNeverFallback(e,t="thumbnail",s){const{imageBlocks:o,imageUrlEnhancer:a}=e;if(o){const e=o[0];return i.createElement(n.ImageBlockRenderable,Object.assign({},e.model,{show_url:r.BlockFactory.shouldShowURL(e),urlEnhancer:a,className:t,disableBoundingBoxes:s}))}return null}createImageBlockKeyStoriesFallback(e){const{imageBlocks:t}=e,s=o({"icon2-tw-no-img-keystories1 img-error-font img-error-font-colors fallback":!0,clickable:!t});if(t){const e=this.getFallbackImageFactory(),r=t[0];return i.createElement(n.ImageBlockRenderable,Object.assign({},r.model,{className:"thumbnail",errorTag:e(),errorClass:s}))}return i.createElement(n.FallbackImageRenderable,{className:s})}renderDefault(e){return this.createImageBlockOnlyErrorFallback(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderGrid(e){return this.createImageBlockAlwaysFallback(e)}renderStoryTile(e){return this.createImageBlockNeverFallback(e)}renderStoryTileNoIcon(e){return this.createImageBlockNeverFallback(e)}renderStory(e){return this.createImageBlockKeyStoriesFallback(e)}renderStoryNoImage(e){return this.createImageBlockKeyStoriesFallback(e)}renderSlideFiveArticlesPerSlide(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideFiveArticlesPerSlideTwitter(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideFiveArticlesPerSlideInstagram(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideThreeArticlesPerSlide(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideThreeArticlesPerSlideTwitter(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideThreeArticlesPerSlideInstagram(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideImagesArticles(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideImagesArticlesTwitter(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideImagesArticlesInstagram(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideOneArticlePerSlide(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideOneArticlePerSlideTwitter(e){return this.createImageBlockOnlyErrorFallback(e)}renderSlideOneArticlePerSlideInstagram(e){return this.createImageBlockOnlyErrorFallback(e)}}}),define("renderables/components/reusable/metric_bar_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricBarComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{primaryMetrics:t}=e;return!!t&&t.length>0}createRegularMetricBar(e){const{primaryMetrics:t,widgetId:s}=e;return i.createElement(n.MetricBarRenderable,{metrics:t,widgetId:s})}createRegularMetricBarIfMetricSelected(e){const{primaryMetrics:t}=e;return t.some(e=>e.highlighted)?this.createRegularMetricBar(e):null}renderStory(e){return this.createRegularMetricBar(e)}renderStoryNoImage(e){return this.createRegularMetricBar(e)}renderGrid(e){return this.createRegularMetricBar(e)}renderStoryTile(e){return this.createRegularMetricBarIfMetricSelected(e)}renderStoryTileNoImage(e){return this.createRegularMetricBarIfMetricSelected(e)}renderStoryTileNoIcon(e){return this.createRegularMetricBarIfMetricSelected(e)}renderStoryTileNoImageNoIcon(e){return this.createRegularMetricBarIfMetricSelected(e)}}}),define("renderables/components/indicator_list_renderable",["require","exports","flux","react","underscore","actions/article_actions","containers/article_context_menu_container","renderables/components/button_list_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IndicatorListRenderable=class extends i.BaseComponent{render(){const e=this.generateFlagButton(),t=this.generateImportantButton(),i=void 0!==this.props.widgetId,n=i?this.generateRatingButton():void 0,r=i?this.generateFavoriteButton():void 0,o=i?this.generateMessageDiffusionButton():void 0,l=i?this.generateContextMenuButton():void 0,c=i?this.buildContextMenuContainer():void 0;return s.createElement("div",{className:"small-indicators clearfix"},s.createElement(a.ButtonListRenderable,{buttons:[e,t],className:"buttons pull-left list-inline"}),s.createElement(a.ButtonListRenderable,{buttons:[n,r,o,l],className:"buttons pull-right list-inline"}),c)}buildContextMenuContainer(){return s.createElement(o.ArticleContextMenuContainer,{entryId:this.props.entryId,widgetId:this.props.widgetId,buttonHash:this.props.entryHash,messages:this.props.messages.contextMenu,settings:this.props.settings})}generateFlagButton(){if(this.props.sentiment){const e=["tw-btn-icon","btn","sentiment","disabled"];return e.push(this.props.sentiment),{icon:"icon-tw-flag",className:e.join(" ")}}return null}generateImportantButton(){return this.props.important?{icon:"icon-tw-exclamation",className:"tw-btn-icon btn important active disabled"}:null}generateRatingButton(){return this.props.user_rating?{icon:n.range(this.props.user_rating).map(()=>"icon-tw-star"),className:"tw-btn-icon btn rating active disabled"}:null}generateFavoriteButton(){return this.props.favorite?{icon:"icon-tw-heart",className:"tw-btn-icon btn favorite active disabled"}:null}generateMessageDiffusionButton(){if(this.props.viralityButton){const e=this.props.viralityButton.click_action;return e.widget_id=this.props.widgetId,{icon:"icon2-tw-message-diffusion fa-rotate-90",className:"tw-btn-icon btn",click_action:e,title:this.props.messages.messageDiffusion}}return null}generateContextMenuButton(){return this.props.showContextMenuButton?{id:this.props.entryHash,icon:"icon-tw-ellipsis",className:"tw-btn-icon btn",onClick:e=>{e.stopPropagation(),i.dispatcher.dispatch(r.ArticleActions.article_onContextMenuButtonClick,{widgetId:this.props.widgetId,entryId:this.props.entryId})}}:null}}}),define("renderables/components/metric_renderable",["require","exports","react","reusable_components","flux"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricRenderable=class extends n.BaseComponent{render(){const{metric:e,className:t,textClassName:n,showLabel:r=!0,tag:o=((e,t)=>i.createElement("li",e,t)),valueTag:a=((e,t)=>i.createElement("em",e,t)),widgetId:l}=this.props,c=new s.TextBlock({text:e.value,click_action:e.click_action},{widgetId:l}),d=new s.TextBlock({text:e.text},{widgetId:l});return o({className:t},[i.createElement(s.TextBlockRenderable,Object.assign({},c.model,{key:"value",tag:a})),r?i.createElement(s.TextBlockRenderable,Object.assign({},d.model,{key:"label",className:n})):null])}}}),define("renderables/components/metric_list_renderable",["require","exports","underscore","react","flux","reusable_components","renderables/components/metric_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricListRenderable=class extends n.BaseComponent{render(){const e=i.map(this.props.metrics,(e,t)=>{const i=""+t;if(this.props.icon)return s.createElement(r.IconMetricRenderable,{className:e.highlighted?"emphasize":null,key:i,metric:e,widgetId:this.props.widgetId});{const n=t===this.props.metrics.length-1;return s.createElement(o.MetricRenderable,{key:i,metric:e,showLabel:this.props.showLabel,widgetId:this.props.widgetId,className:e.highlighted?"emphasize":null,textClassName:n?null:"comma-separated"})}});return s.createElement("ul",{className:this.props.className||null},e)}}}),define("renderables/components/tag_list_renderable",["require","exports","react","underscore","reusable_components","flux"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TagListRenderable=class extends r.BaseComponent{render(){const e=s.map(this.props.tags,e=>{const t=this.getTagClasses(e),s=new n.TextBlock({text:e.name},{className:t}).model;return i.createElement("li",{key:e.code,className:"label-item",title:e.name},i.createElement(n.TextBlockRenderable,Object.assign({},s)))});return i.createElement("ul",{className:"labels"},e)}getTagClasses(e){const t=["label","label-elipsis"];return e.marking_tag?t.push("label-default"):t.push("label-primary"),t.join(" ")}}}),define("renderables/components/metrics_container_renderable",["require","exports","classnames","event_bus","flux","react","reusable_components","underscore","renderables/components/indicator_list_renderable","renderables/components/metric_list_renderable","renderables/components/tag_list_renderable"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricsContainerRenderable=class extends n.BaseComponent{constructor(e){super(e),this.showDeviceInfoUrl=!1,this.matchingEntityLimit=5}shouldComponentUpdate(e){return e.entryId!==this.props.entryId||!a.isEqual(e.tags,this.props.tags)||!a.isEqual(e.metadata,this.props.metadata)}render(){const{widgetId:e,entryId:t,entryHash:i,showContextMenuButton:s}=this.props,n=this.generateTags(),o=this.generateFlags(),a=this.generatePanels(),c=this.generateTopics(),d=this.generateAiRules(),h=this.generateMetrics(),u=this.generateDeviceInfo(),p=this.generateMatchingEntities(),g=this.generateRuleCount();return r.createElement("div",{className:"metrics-container"},r.createElement(l.IndicatorListRenderable,Object.assign({showContextMenuButton:s,viralityButton:this.props.virality_button,messages:this.props.messages,settings:this.props.settings,entryId:t,widgetId:e,entryHash:i},this.props.metadata)),n,o,a,c,d,h,p,g,u)}generateMetricListEntry(e,t,i=!1,s="comma-separated-list",n){const o=i?t:r.createElement("ul",{className:s},t);return r.createElement("div",{className:"metrics",key:n},r.createElement("label",null,e),r.createElement("div",{className:"metric-content"},o))}generateTopics(){if(this.props.matching_topics.length>0){const e=this.buildMetricElementList(this.props.matching_topics,!0);return this.generateMetricListEntry(this.props.messages.metrics.matches,e)}}generateAiRules(){if(!a.isUndefined(this.props.matching_ai_rules)&&this.props.matching_ai_rules.length>0){const e=this.buildMetricElementList(this.props.matching_ai_rules,!0);return this.generateMetricListEntry(this.props.messages.metrics.aiRule,e)}}buildMetricElementList(e,t,s){return a.map(e,(n,o)=>{const a=i({"comma-separated":o<e.length-1&&t,clickable:this.isAiRule(n),"ai-rule-metric-element":this.isAiRule(n)}),l=s?this.generateExplicitMatchIcon(n):null;return r.createElement("li",{className:a,key:n.id+o,onClick:e=>{this.handleClick(e,n)}},l,n.label)})}isAiRule(e){return void 0!==e.categories}handleClick(e,t){this.isAiRule(t)&&s.eventBus.dispatch({type:s.EVENT_TYPES.SHOW_AI_RULE_CATEGORIES,value:{event:e,match:t,entryId:this.props.entryId}})}generateExplicitMatchIcon(e){if(void 0===e.explicit_match)return null;const t=i({fa:!0,"fa-check-circle-o included-icon":!0===e.explicit_match,"fa-times-circle-o excluded-icon":!1===e.explicit_match});return r.createElement("i",{className:t})}generateDeviceInfo(){const e=this.props.device_info;if(a.isUndefined(e))return null;{const t=this.generateDeviceInfoText(e);return this.generateMetricListEntry(this.props.messages.metrics.deviceInfo,r.createElement("li",null,r.createElement(o.TextBlockRenderable,Object.assign({},t.model))))}}generateDeviceInfoText(e){const t={text:e.device_title};let i=!1;return e.device_url&&this.showDeviceInfoUrl&&(t.click_action={action:o.ClickActionTypes.OPEN_URL,url:e.device_url},i=!0),new o.TextBlock(t,{showUrl:i})}generatePanels(){return this.props.matching_panels.length>0?this.generateMetricListEntry(this.props.messages.metrics.panels,this.buildMetricElementList(this.props.matching_panels,!0,!0)):null}generateTags(){return this.props.tags.length>0?this.generateMetricListEntry(this.props.messages.metrics.tags,r.createElement("div",null,r.createElement(d.TagListRenderable,{tags:this.props.tags})),!0):null}generateFlags(){if(this.props.flags&&this.props.flags.length>0){const e=a.map(this.props.flags,(e,t)=>r.createElement("li",{key:"flag-"+t,className:"label-item"},r.createElement(o.TextBlockRenderable,Object.assign({},e.model,{className:"label label-primary label-elipsis"}))));return this.generateMetricListEntry(this.props.messages.metrics.flags,e,!1,"labels")}return null}generatePrimaryMetrics(){return this.props.primary_metrics.length>0?r.createElement("div",{className:"custom-metric-content-images"},r.createElement(c.MetricListRenderable,{className:"list-icons",widgetId:this.props.widgetId,metrics:this.props.primary_metrics,icon:!0})):null}generateSecondaryMetrics(){return this.props.secondary_metrics.length>0?r.createElement("div",{className:"custom-metric-content-text"},r.createElement(c.MetricListRenderable,{className:"comma-separated-list",metrics:this.props.secondary_metrics,widgetId:this.props.widgetId})):null}generateMetrics(){if(this.props.primary_metrics.length>0||this.props.secondary_metrics.length>0){const e=this.generatePrimaryMetrics(),t=this.generateSecondaryMetrics();return r.createElement("div",{className:"metrics lower-labels"},r.createElement("label",null,this.props.messages.metrics.metrics),e,t)}return null}generateMatchingEntities(){return!a.isUndefined(this.props.matching_entities)&&this.props.matching_entities.length>0?r.createElement("div",null,a.map(this.props.matching_entities,e=>{const t=e.children.slice(0,this.matchingEntityLimit),s=a.map(t,(e,s)=>{const n=i({"comma-separated":s!==t.length-1});return r.createElement("li",{key:e.id},r.createElement("span",{className:n},e.label))});return this.generateMetricListEntry(e.label,s,!1,"comma-separated-list",e.id)})):null}generateRuleCount(){const{rule_count:e}=this.props.metadata;return!a.isUndefined(e)&&e>0?r.createElement("div",{className:"metrics"},r.createElement("label",null,this.props.messages.metrics.ruleCount),r.createElement("div",{className:"metric-content"},r.createElement("ul",{className:"comma-separated-list"},r.createElement("li",null,e)))):null}}}),define("renderables/components/reusable/metrics_container_component",["require","exports","react","underscore","renderables/components/metrics_container_renderable","renderables/components/metric_list_renderable","renderables/components/metric_renderable","renderables/components/reusable/article_layout_component"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricsContainerComponent=class extends a.ArticleLayoutComponent{checkRequiredProps(e){const{article:t,metrics:i}=e;return!!t&&!!i}createRegularMetricsContainer(e){const{metrics:t,messages:s,settings:r,widgetId:o,article:a}=e,{primary_metrics:l=[],secondary_metrics:c=[]}=t;return!t||0===l.length&&0===c.length?null:i.createElement(n.MetricsContainerRenderable,Object.assign({},t,{messages:s,settings:r,widgetId:o,entryId:a.entry_id,entryHash:a.hash,showContextMenuButton:!a.unselectable}))}createMetricsContainerOnlyList(e){const{metrics:t,widgetId:s}=e;return i.createElement("div",{className:"metrics lower-labels"},i.createElement("div",{className:"custom-metric-content-images"},i.createElement(r.MetricListRenderable,{className:"list-icons",metrics:t.primary_metrics,widgetId:s,icon:!0})))}createMetricsContainerSingleMetric(e){const{metrics:t,widgetId:n}=e;if(!t.primary_metrics||0===t.primary_metrics.length)return null;const r=s.first(t.primary_metrics);return i.createElement(o.MetricRenderable,{key:r.text,metric:r,widgetId:n,showLabel:!1,tag:(e,t)=>i.createElement("div",e,t),valueTag:(e,t)=>i.createElement("span",e,t)})}renderDefault(e){return this.createRegularMetricsContainer(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderFake(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderCompact(e){return this.createMetricsContainerOnlyList(e)}renderCompactTwitter(e){return this.renderCompact(e)}renderSlideTenArticlesPerSlide(e){return this.createMetricsContainerSingleMetric(e)}renderSlideTenArticlesPerSlideTwitter(e){return this.renderSlideTenArticlesPerSlide(e)}renderSlideTenArticlesPerSlideInstagram(e){return this.renderSlideTenArticlesPerSlide(e)}}}),define("renderables/components/reusable/outro_component",["require","exports","renderables/components/reusable/article_layout_component","reusable_components","underscore","factories/block_factory","react","event_bus"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OutroComponent=class extends i.ArticleLayoutComponent{checkRequiredProps(e){const{outroBlocks:t}=e;return!!t}createDefaultOutroList(e){const{outroBlocks:t,saveUserToWorkflowButtonBlocks:i,reportingButtonBlocks:l,openVideoButton:c}=e,d=[];return n.forEach(t,(e,t)=>{e instanceof s.TextBlock?r.BlockFactory.addBlockAsListItem(d,e,{key:`block-${t}`,blockType:s.TextBlockRenderable,parseEmoji:!0}):e instanceof s.IconBlock&&r.BlockFactory.addBlockAsListItem(d,e,{key:`block-${t}`,blockType:s.IconBlockRenderable})}),i&&r.BlockFactory.addBlockAsListItem(d,i[0],{key:"save",blockType:s.IconBlockRenderable}),l&&r.BlockFactory.addBlockAsListItem(d,l[0],{key:"report",blockType:s.IconBlockRenderable}),c&&d.push(o.createElement("li",null,o.createElement("i",{className:"fa fa-video-camera clickable",onClick:()=>{a.eventBus.dispatch({type:a.EVENT_TYPES.SHOW_VIDEO_PLAYER,value:{endpointUrl:c.click_action.endpoint_url}})}}))),d}createStoryOutroItemsWithFavicon(e){const t=[],{outroBlocks:i,saveUserToWorkflowButtonBlocks:n,reportingButtonBlocks:l,openVideoButton:c}=e,[d,h,u,p]=i;return r.BlockFactory.addBlockAsListItem(t,d,{key:"icon",blockType:s.ImageBlockRenderable,listClasses:"no-separator",blockClasses:"favicon"}),r.BlockFactory.addBlockAsListItem(t,h,{key:"author",blockType:s.TextBlockRenderable,listClasses:"limit-size",listStyle:{maxWidth:"100px"},parseEmoji:!0}),r.BlockFactory.addBlockAsListItem(t,u,{key:"translate",blockType:s.IconBlockRenderable}),r.BlockFactory.addBlockAsListItem(t,p,{key:"open-external",blockType:s.IconBlockRenderable}),n&&r.BlockFactory.addBlockAsListItem(t,n[0],{key:"save",blockType:s.IconBlockRenderable}),l&&r.BlockFactory.addBlockAsListItem(t,l[0],{key:"report",blockType:s.IconBlockRenderable}),c&&t.push(o.createElement("li",null,o.createElement("i",{className:"fa fa-video-camera clickable",onClick:()=>{a.eventBus.dispatch({type:a.EVENT_TYPES.SHOW_VIDEO_PLAYER,value:{endpointUrl:c.click_action.endpoint_url}})}}))),t}createStoryOutroItemsNoFavicon(e){const t=[],{outroBlocks:i,saveUserToWorkflowButtonBlocks:n,reportingButtonBlocks:l,openVideoButton:c}=e,[d,h,u]=i;return r.BlockFactory.addBlockAsListItem(t,d,{key:"author",blockType:s.TextBlockRenderable,listClasses:"limit-size",listStyle:{maxWidth:"100px"},parseEmoji:!0}),r.BlockFactory.addBlockAsListItem(t,h,{key:"translate",blockType:s.IconBlockRenderable}),r.BlockFactory.addBlockAsListItem(t,u,{key:"open-external",blockType:s.IconBlockRenderable}),n&&r.BlockFactory.addBlockAsListItem(t,n[0],{key:"save",blockType:s.IconBlockRenderable}),l&&r.BlockFactory.addBlockAsListItem(t,l[0],{key:"report",blockType:s.IconBlockRenderable}),c&&t.push(o.createElement("li",null,o.createElement("i",{className:"fa fa-video-camera clickable",onClick:()=>{a.eventBus.dispatch({type:a.EVENT_TYPES.SHOW_VIDEO_PLAYER,value:{endpointUrl:c.click_action.endpoint_url}})}}))),t}renderDefault(e){return this.createDefaultOutroList(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderCompact(e){return this.renderDefault(e)}renderCompactTwitter(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderTwitterInteractions(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlide(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideTenArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlide(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideFiveArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlide(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlideTwitter(e){return this.renderDefault(e)}renderSlideThreeArticlesPerSlideInstagram(e){return this.renderDefault(e)}renderSlideImagesArticles(e){return this.renderDefault(e)}renderSlideImagesArticlesInstagram(e){return this.renderDefault(e)}renderSlideImagesArticlesTwitter(e){return this.renderDefault(e)}renderSlideOneArticlePerSlide(e){return this.renderDefault(e)}renderSlideOneArticlePerSlideTwitter(e){return this.renderDefault(e)}renderSlideOneArticlePerSlideInstagram(e){return this.renderDefault(e)}renderStory(e){return this.createStoryOutroItemsWithFavicon(e)}renderStoryNoImage(e){return this.renderStory(e)}renderStoryTile(e){return this.renderStory(e)}renderStoryTileNoImage(e){return this.renderStory(e)}renderStoryTileNoIcon(e){return this.createStoryOutroItemsNoFavicon(e)}renderStoryTileNoImageNoIcon(e){return this.renderStoryTileNoIcon(e)}renderUnknownLayout(e){return this.renderDefault(e)}}}),define("renderables/components/reusable/sentiment_flag_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SentimentFlagComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{sentimentBlocks:t}=e;return!!t}createSentimentFlag(e){const{sentimentBlocks:t}=e,s=t[0];return i.createElement("div",{key:"sentiment-flag"},i.createElement(n.ImageBlockRenderable,Object.assign({},s.model)))}renderSlideOneArticlePerSlide(e){return this.createSentimentFlag(e)}renderSlideOneArticlePerSlideTwitter(e){return this.createSentimentFlag(e)}renderSlideOneArticlePerSlideInstagram(e){return this.createSentimentFlag(e)}renderSlideFiveArticlesPerSlide(e){return this.createSentimentFlag(e)}renderSlideFiveArticlesPerSlideTwitter(e){return this.createSentimentFlag(e)}renderSlideFiveArticlesPerSlideInstagram(e){return this.createSentimentFlag(e)}renderSlideThreeArticlesPerSlide(e){return this.createSentimentFlag(e)}renderSlideThreeArticlesPerSlideTwitter(e){return this.createSentimentFlag(e)}renderSlideThreeArticlesPerSlideInstagram(e){return this.createSentimentFlag(e)}}}),define("renderables/components/reusable/subtitle_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components","underscore","factories/block_factory"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SubtitleComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{textBlocks:t}=e;return!!t&&t.length>0}createSingleLineSubtitle(e){const{textBlocks:t}=e,s=[],r=t[0],a=t[1];return o.BlockFactory.parseEmojisInBlock(r),r&&r.model&&s.push(i.createElement(n.TextBlockRenderable,Object.assign({},r.model,{className:"entry-author",key:"author"}))),a&&a.model&&s.push(i.createElement("small",{className:"author-subtitle",key:"author-subtitle"},i.createElement(n.TextBlockRenderable,Object.assign({},a.model)))),i.createElement("p",null,s)}createSubtitleFromMultipleBlocks(e){const{textBlocks:t}=e;return i.createElement("p",null,r.map(t,(e,t)=>{const s="title"+t;return i.createElement(n.TextBlockRenderable,Object.assign({},e.model,{className:"entry-author",key:s}))}))}createSimpleTextBlockSubtitle(e){const{textBlocks:t}=e,s=t[0];return i.createElement(n.TextBlockRenderable,Object.assign({},s.model))}renderDefault(e){return this.createSingleLineSubtitle(e)}renderUniceptaDefault(e){return this.createSubtitleFromMultipleBlocks(e)}renderUniceptaDefaultNoTitle(e){return this.renderUniceptaDefault(e)}renderStory(e){return this.createSimpleTextBlockSubtitle(e)}renderStoryNoImage(e){return this.renderStory(e)}renderStoryTile(e){return this.renderStory(e)}renderStoryTileNoImage(e){return this.renderStory(e)}renderStoryTileNoIcon(e){return this.renderStory(e)}renderStoryTileNoImageNoIcon(e){return this.renderStory(e)}}}),define("renderables/components/reusable/text_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components","factories/block_factory"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{textBlocks:t}=e;return!!t}createNormalText(e,t=!1){const{textBlocks:s}=e,o=s[0];return o?(r.BlockFactory.parseEmojisInBlock(o),i.createElement(n.TextBlockRenderable,Object.assign({},o.model,{limitSize:t,className:"tw-entry-text"}))):null}createTextFromMultipleBlocks(e){const{textBlocks:t}=e;return t&&t.length>0?i.createElement("div",null,t.filter(e=>e&&e.model).map((e,t)=>(r.BlockFactory.parseEmojisInBlock(e),i.createElement(n.TextBlockRenderable,Object.assign({},e.model,{className:"tw-entry-text tw-entry-paragraph",key:"text-"+t}))))):null}createTextAsHeader(e){const{textBlocks:t}=e,s=t[0];return s?(r.BlockFactory.parseEmojisInBlock(s),i.createElement("h5",{className:"entry-title"},i.createElement(n.TextBlockRenderable,Object.assign({},s.model)))):null}renderDefault(e){return this.createNormalText(e)}renderDefaultNoTitle(e){return this.createNormalText(e)}renderTwitter(e){return this.createNormalText(e)}renderTwitterInteractions(e){return this.createNormalText(e)}renderCompact(e){return this.createNormalText(e,!0)}renderCompactTwitter(e){return this.createNormalText(e,!0)}renderUniceptaDefault(e){return this.createTextFromMultipleBlocks(e)}renderUniceptaDefaultNoTitle(e){return this.renderUniceptaDefault(e)}renderStory(e){return this.createTextAsHeader(e)}renderStoryNoImage(e){return this.renderStory(e)}renderStoryTile(e){return this.renderStory(e)}renderStoryTileNoImage(e){return this.renderStory(e)}renderStoryTileNoIcon(e){return this.renderStory(e)}renderStoryTileNoImageNoIcon(e){return this.renderStory(e)}renderSlideTenArticlesPerSlide(e){return this.createNormalText(e)}renderSlideTenArticlesPerSlideTwitter(e){return this.createNormalText(e)}renderSlideTenArticlesPerSlideInstagram(e){return this.createNormalText(e)}renderSlideFiveArticlesPerSlide(e){return this.createNormalText(e)}renderSlideFiveArticlesPerSlideTwitter(e){return this.createNormalText(e)}renderSlideFiveArticlesPerSlideInstagram(e){return this.createNormalText(e)}renderSlideThreeArticlesPerSlide(e){return this.createNormalText(e)}renderSlideThreeArticlesPerSlideTwitter(e){return this.createNormalText(e)}renderSlideThreeArticlesPerSlideInstagram(e){return this.createNormalText(e)}renderSlideImagesArticles(e){return this.createNormalText(e)}renderSlideImagesArticlesTwitter(e){return this.createNormalText(e)}renderSlideImagesArticlesInstagram(e){return this.createNormalText(e)}renderSlideOneArticlePerSlide(e){return this.createNormalText(e)}renderSlideOneArticlePerSlideTwitter(e){return this.createNormalText(e)}renderSlideOneArticlePerSlideInstagram(e){return this.createNormalText(e)}renderUnknownLayout(e){return this.renderDefault(e)}}}),define("renderables/components/reusable/title_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components","layouts/article/layout_types","factories/component_factory","factories/block_factory"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TitleComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{titleBlocks:t,subtitleBlocks:i}=e;return!!t||!!i}createSingleLineTitleAsHeader(e,t=!0){const{titleBlocks:s}=e;if(s){const e=s[0];return a.BlockFactory.parseEmojisInBlock(e),i.createElement("h5",{className:t?"limit-size":void 0},i.createElement(n.TextBlockRenderable,Object.assign({},e.model)))}return null}createSingleLineTitleAsSpan(e,t=!0){const{titleBlocks:s}=e;if(s){const e=s[0];return a.BlockFactory.parseEmojisInBlock(e),i.createElement("span",{className:t?"limit-size":void 0},i.createElement(n.TextBlockRenderable,Object.assign({},e.model)))}return null}createTwitterTitleWithHandle(e){const{titleBlocks:t}=e;if(t){const e=t[0],s=t[1],r=t[2];return a.BlockFactory.parseEmojisInBlock(e),i.createElement("h5",null,e?i.createElement(n.TextBlockRenderable,Object.assign({},e.model,{key:"author"})):null,s?i.createElement("small",{className:"entry-handle"},i.createElement(n.TextBlockRenderable,Object.assign({},s.model,{key:"handle"}))):null,r?i.createElement("small",{className:"entry-subtitle"},i.createElement(n.TextBlockRenderable,Object.assign({},r.model,{key:"subtitle"}))):null)}return null}createSubtitleAsTitle(e){const{subtitleBlocks:t}=e;return t?i.createElement("h5",null,o.ComponentFactory.createSubtitle(r.LayoutTypes.DEFAULT,t)):null}renderDefault(e){return this.createSingleLineTitleAsHeader(e)}renderFake(e){return this.createSingleLineTitleAsHeader(e)}renderCompact(e){return this.createSingleLineTitleAsHeader(e)}renderCompactTwitter(e){return this.createSingleLineTitleAsHeader(e)}renderUniceptaDefault(e){return this.createSingleLineTitleAsHeader(e)}renderTwitter(e){return this.createTwitterTitleWithHandle(e)}renderDefaultNoTitle(e){return this.createSubtitleAsTitle(e)}renderSlideTenArticlesPerSlide(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideTenArticlesPerSlideTwitter(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideTenArticlesPerSlideInstagram(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideFiveArticlesPerSlide(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideFiveArticlesPerSlideTwitter(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideFiveArticlesPerSlideInstagram(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideThreeArticlesPerSlide(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideThreeArticlesPerSlideTwitter(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideThreeArticlesPerSlideInstagram(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideImagesArticles(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideImagesArticlesTwitter(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideImagesArticlesInstagram(e){return this.createSingleLineTitleAsSpan(e,!1)}renderSlideOneArticlePerSlide(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideOneArticlePerSlideTwitter(e){return this.createSingleLineTitleAsSpan(e,!0)}renderSlideOneArticlePerSlideInstagram(e){return this.createSingleLineTitleAsSpan(e,!0)}renderTwitterInteractions(e){return this.createSingleLineTitleAsSpan(e,!0)}renderUnknownLayout(e){return this.renderDefault(e)}}}),define("renderables/components/reusable/translation_button_component",["require","exports","react","renderables/components/reusable/article_layout_component","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TranslationButtonComponent=class extends s.ArticleLayoutComponent{checkRequiredProps(e){const{translationButtonBlocks:t,message:i}=e;return!!t&&!!i}createTranslateButton(e){const{translationButtonBlocks:t,message:s,tooltip:r,isTranslated:o}=e,a=t[0];return a.model?(a.model.icon="fa fa-language",a.model.click_action.translation_status=o,a.model.title=r,o?i.createElement("div",{className:"entry-translation"},i.createElement(n.TextBlockRenderable,{text:s,className:"label-disabled"}),i.createElement(n.TextBlockRenderable,Object.assign({},a.model))):i.createElement("div",{className:"entry-translation"},i.createElement(n.TextBlockRenderable,Object.assign({},a.model)))):null}renderDefault(e){return this.createTranslateButton(e)}renderDefaultNoTitle(e){return this.renderDefault(e)}renderTwitter(e){return this.renderDefault(e)}renderUniceptaDefault(e){return this.renderDefault(e)}renderUniceptaDefaultNoTitle(e){return this.renderDefault(e)}renderCompact(e){return this.renderDefault(e)}renderCompactTwitter(e){return this.renderDefault(e)}}}),define("factories/component_factory",["require","exports","flux","react","reusable_components","underscore","actions/article_actions","layouts/article/layout_types","renderables/components/button_list_renderable","renderables/components/reusable/author_block_component","renderables/components/reusable/avatar_component","renderables/components/reusable/comment_container_component","renderables/components/reusable/icon_component","renderables/components/reusable/image_component","renderables/components/reusable/metric_bar_component","renderables/components/reusable/metrics_container_component","renderables/components/reusable/outro_component","renderables/components/reusable/sentiment_flag_component","renderables/components/reusable/subtitle_component","renderables/components/reusable/text_component","renderables/components/reusable/title_component","renderables/components/reusable/translation_button_component","stores/article_store","factories/block_factory"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ComponentFactory=class{static createAvatar(e,t,i,s){return(new d.AvatarComponent).render({layout:e,avatarBlocks:t,article:i,iconMap:s})}static createIcon(e,t){return(new u.IconComponent).render({layout:e,iconBlocks:t})}static createImage(e,t,i){return(new p.ImageComponent).render({layout:e,imageBlocks:t,imageUrlEnhancer:i})}static createTitle(e,t,i){return(new E.TitleComponent).render({layout:e,titleBlocks:t,subtitleBlocks:i})}static createText(e,t){return(new b.TextComponent).render({layout:e,textBlocks:t})}static createSubtitle(e,t){return(new y.SubtitleComponent).render({layout:e,textBlocks:t})}static createAuthorBlock(e,t,i){return(new c.AuthorBlockComponent).render({layout:e,authorBlocks:t,flags:i})}static createSentimentFlag(e,t){return(new f.SentimentFlagComponent).render({layout:e,sentimentBlocks:t})}static createOutro(e,t,i,s,n){return(new _.OutroComponent).render({layout:e,outroBlocks:t,saveUserToWorkflowButtonBlocks:i,reportingButtonBlocks:s,openVideoButton:n})}static createMetricBar(e,t,i){return(new g.MetricBarComponent).render({layout:e,primaryMetrics:t,widgetId:i})}static createMetricsContainer(e,t,i,s,n,r){return(new m.MetricsContainerComponent).render({layout:e,widgetId:i,metrics:t,article:r,settings:n,messages:s})}static createCommentArticles(e,t,i,s,n,r,o=!0,a=!0){return(new h.CommentContainerComponent).render({layout:e,entryId:s,widgetId:i,comments:t,containerBlocks:n,messages:r,isComments:o,canLoadMore:a})}static createTranslationButton(e,t,i,s,n){return(new S.TranslationButtonComponent).render({layout:e,translationButtonBlocks:i,tooltip:n,message:s,isTranslated:t})}static createReportingActionsButton(e,t,i,s){return e?v.BlockFactory.create(n.BlockTypes.ICON,[{click_action:{action:n.ClickActionTypes.SHOW_REPORTING_ACTIONS,article_id:i}}],t,{tooltip:s,icon:"fa fa-exclamation report-article-icon"}):null}static createEngagementChart(e,t,i){switch(e){case a.LayoutTypes.COMPACT:case a.LayoutTypes.COMPACT_TWITTER:if(r.isUndefined(t))return null;{const e=C.ArticleStore.getInstance().getEngagementChart(t);return e||null}case a.LayoutTypes.DEFAULT:case a.LayoutTypes.DEFAULT_NO_TITLE:case a.LayoutTypes.TWITTER:case a.LayoutTypes.STORY:case a.LayoutTypes.STORY_NO_IMAGE:case a.LayoutTypes.STORY_TILE:case a.LayoutTypes.STORY_TILE_NO_IMAGE:case a.LayoutTypes.STORY_TILE_NO_ICON:case a.LayoutTypes.STORY_TILE_NO_IMAGE_NO_ICON:case a.LayoutTypes.FAKE:case a.LayoutTypes.GRID:case a.LayoutTypes.UNICEPTA_DEFAULT:case a.LayoutTypes.UNICEPTA_DEFAULT_NO_TITLE:case a.LayoutTypes.DEFAULT_COMMENT:case a.LayoutTypes.TREE_TILE:case a.LayoutTypes.TWITTER_INTERACTIONS:return null;case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE:case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES_TWITTER:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES_INSTAGRAM:return null;default:return console.warn("Unknown layout type: "+e),null}}static createContextMenuButton(e,t,n,r){switch(e){case a.LayoutTypes.GRID:case a.LayoutTypes.COMPACT:case a.LayoutTypes.COMPACT_TWITTER:case a.LayoutTypes.STORY:case a.LayoutTypes.STORY_NO_IMAGE:case a.LayoutTypes.STORY_TILE:case a.LayoutTypes.STORY_TILE_NO_IMAGE:case a.LayoutTypes.STORY_TILE_NO_ICON:case a.LayoutTypes.STORY_TILE_NO_IMAGE_NO_ICON:const c=[{id:r,icon:"icon-tw-ellipsis",className:"tw-btn-icon btn",onClick:e=>{e.preventDefault(),i.dispatcher.dispatch(o.ArticleActions.article_onContextMenuButtonClick,{widgetId:t,entryId:n})}}];return s.createElement(l.ButtonListRenderable,{buttons:c,className:"list-unstyled context-button"});case a.LayoutTypes.DEFAULT:case a.LayoutTypes.DEFAULT_NO_TITLE:case a.LayoutTypes.TWITTER:case a.LayoutTypes.FAKE:case a.LayoutTypes.UNICEPTA_DEFAULT:case a.LayoutTypes.UNICEPTA_DEFAULT_NO_TITLE:case a.LayoutTypes.DEFAULT_COMMENT:case a.LayoutTypes.TREE_TILE:case a.LayoutTypes.TWITTER_INTERACTIONS:return null;case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE:case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_ONE_ARTICLE_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_THREE_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_FIVE_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_TWITTER:case a.LayoutTypes.SLIDE_TEN_ARTICLES_PER_SLIDE_INSTAGRAM:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES_TWITTER:case a.LayoutTypes.SLIDE_IMAGES_ARTICLES_INSTAGRAM:return null;default:return console.warn("Unknown layout type: "+e),null}}}}),define("factories/block_factory",["require","exports","react","reusable_components","reusable_services"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static create(e,t,i,n={}){if(n.canShowImage=void 0===n.canShowImage||n.canShowImage,n.widgetId=i,!n.canShowImage||!t||Array.isArray(t)&&0===t.length)return null;switch(Array.isArray(t)||(t=[t]),e){default:case s.BlockTypes.TEXT:return r.createTextBlock(t,n);case s.BlockTypes.IMAGE:return r.createImageBlock(t,n);case s.BlockTypes.ICON:return r.createIconBlock(t,n)}}static shouldShowURL(e){const t=e.model,i=t&&t.click_action;return i&&-1!==[s.ClickActionTypes.OPEN_URL,s.ClickActionTypes.OPEN_URL_AND_SET_READ,s.ClickActionTypes.OPEN_CONTEXT_PAGE].indexOf(i.action)}static addBlockAsListItem(e,t,s){const r=t&&t.model;if(r){const t=i.createFactory(s.blockType);if(s.parseEmoji){const e=r;"string"==typeof e.text&&(e.text=n.emojiService.parseTextForEmoji(e.text,!0))}e.push(i.createElement("li",{key:s.key,className:s.listClasses,style:s.listStyle},t(Object.assign({className:s.blockClasses,style:s.blockStyle},r))))}}static parseEmojisInBlock(e){if(e&&e.model){const t=e.model;void 0!==t.text&&(t.text=n.emojiService.parseTextForEmoji(t.text,!0)),void 0!==t.alt_text&&(t.alt_text=n.emojiService.parseTextForEmoji(t.alt_text,!0))}}static createTextBlock(e,t){return e.map(e=>new s.TextBlock(e,t))}static createImageBlock(e,t){return e.map(e=>new s.ImageBlock(e,t))}static createIconBlock(e,t){return e.map(e=>new s.IconBlock(e,t))}}t.BlockFactory=r}),define("factories/layout_factory",["require","exports","classnames","reusable_components","underscore","factories/block_factory","factories/component_factory"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{static createListLayout(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i),u=a.shouldShowTranslation(e,d),p={widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,separatorCount:c,messages:n,size:d.size,fullContent:e.full_content,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i)),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i)),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:u}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:u})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:u})),translationButton:a.shouldShowTranslationButton(e)&&o.ComponentFactory.createTranslationButton(e.layout,u,r.BlockFactory.create(s.BlockTypes.TEXT,e.translate_button,i,{translationLanguage:d.translationTargetLanguage}),n.translatedByGoogle,u?n.seeOriginal:n.seeTranslation),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:u}),r.BlockFactory.create(s.BlockTypes.ICON,e.save_to_user_workflow_button,i,{icon:a.getSaveUserFlowButtonIcon(e.save_to_user_workflow_button),tooltip:a.getSaveUserFlowButtonTooltip(e.save_to_user_workflow_button,n)}),o.ComponentFactory.createReportingActionsButton(d.showReportingActions&&e.image&&void 0!==e.image.bounding_boxes&&e.image.bounding_boxes.length>0&&!(void 0!==e.image.click_action&&e.image.click_action.action===s.ClickActionTypes.SHOW_VIDEO),i,e.entry_id,n.reportArticle)),commentArticles:o.ComponentFactory.createCommentArticles(e.layout,e.comment_articles.map(t=>this.createCommentLayout(t,e.entry_id,i,n,u)),i,e.entry_id,{headerLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.children_label,i,{isTranslated:u}),filterLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_filter_label,i,{isTranslated:u}),countLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_element_count,i,{isTranslated:u}),loadMore:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_load_more,i,{isTranslated:u})},n,!0,!!e.metadata&&e.comment_articles.length<e.metadata.total_comments),clusterArticles:o.ComponentFactory.createCommentArticles(e.layout,e.cluster_articles.map(t=>this.createCommentLayout(t,e.entry_id,i,n,u)),i,e.entry_id,{headerLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.children_label,i,{isTranslated:u}),filterLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_filter_label,i,{isTranslated:u}),countLabel:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_element_count,i,{isTranslated:u}),loadMore:r.BlockFactory.create(s.BlockTypes.TEXT,e.child_load_more,i,{isTranslated:u})},n,!1,!!e.metadata&&e.cluster_articles.length<e.metadata.total_clusters)};return 12===d.size&&(p.subtitle=o.ComponentFactory.createSubtitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:u})),p.metricsContainer=o.ComponentFactory.createMetricsContainer(e.layout,h,i,n,d,e),p.metrics=h),p}static createTileLayout(e,t,i,l,c){const{navigate_action:d}=e,h=a.shouldShowTranslation(e,c);let u;return void 0!==d&&(u={click_action:e.navigate_action}),{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected,messages:l,size:c.size,settings:c,image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i),(e,t)=>c.imageUrlEnhancer(e,{maxWidth:Math.floor(c.width/c.tileColumnCount),maxHeight:Math.floor(c.width/c.tileColumnCount)})),metricBar:o.ComponentFactory.createMetricBar(e.layout,e.primary_metrics,i),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:h})),outro:o.ComponentFactory.createOutro(e.layout,n.union(r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:h}),r.BlockFactory.create(s.BlockTypes.ICON,e.translate_button,i,{icon:"fa fa-language translate-icon",isTranslated:h,tooltip:h?l.seeOriginal:l.seeTranslation}),r.BlockFactory.create(s.BlockTypes.ICON,u,i,{icon:"fa fa-external-link details-icon",tooltip:l.readArticle})),r.BlockFactory.create(s.BlockTypes.ICON,e.save_to_user_workflow_button,i,{icon:a.getSaveUserFlowButtonIcon(e.save_to_user_workflow_button),tooltip:a.getSaveUserFlowButtonTooltip(e.save_to_user_workflow_button,l)}),o.ComponentFactory.createReportingActionsButton(c.showReportingActions&&void 0!==e.image&&void 0!==e.image.bounding_boxes&&e.image.bounding_boxes.length>0&&!(void 0!==e.image.click_action&&e.image.click_action.action===s.ClickActionTypes.SHOW_VIDEO),i,e.entry_id,l.reportArticle)),subtitle:o.ComponentFactory.createSubtitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:h})),contextMenuButton:o.ComponentFactory.createContextMenuButton(e.layout,i,e.entry_id,e.hash)}}static createStoryLayout(e,t,i,l,c){const{navigate_action:d}=e,h=a.shouldShowTranslation(e,c);let u;return void 0!==d&&(u={click_action:e.navigate_action}),{widgetId:i,entryId:e.entry_id,entryHash:e.hash,messages:l,size:c.size,image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i)),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:h})),outro:o.ComponentFactory.createOutro(e.layout,n.union(r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:h}),r.BlockFactory.create(s.BlockTypes.ICON,e.translate_button,i,{icon:"fa fa-language translate-icon",isTranslated:h,tooltip:h?l.seeOriginal:l.seeTranslation}),r.BlockFactory.create(s.BlockTypes.ICON,u,i,{icon:"fa fa-external-link details-icon",tooltip:l.readArticle})),r.BlockFactory.create(s.BlockTypes.ICON,e.save_to_user_workflow_button,i,{icon:a.getSaveUserFlowButtonIcon(e.save_to_user_workflow_button),tooltip:a.getSaveUserFlowButtonTooltip(e.save_to_user_workflow_button,l)}),o.ComponentFactory.createReportingActionsButton(c.showReportingActions&&e.image&&void 0!==e.image.bounding_boxes&&e.image.bounding_boxes.length>0,i,e.entry_id,l.reportArticle)),subtitle:o.ComponentFactory.createSubtitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:h}))}}static createGridLayout(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,messages:n,selected:e.selected,size:d.size,settings:d,imageDimensions:d.gridImageDimensions,image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i),e=>d.imageUrlEnhancer(e,{maxWidth:d.gridImageDimensions,maxHeight:d.gridImageDimensions})),contextMenuButton:o.ComponentFactory.createContextMenuButton(e.layout,i,e.entry_id,e.hash),metricBar:o.ComponentFactory.createMetricBar(e.layout,e.primary_metrics,i),metrics:h}}static createCompactLayout(e,t,i,l,c,d,h){const u=a.createMetrics(JSON.parse(JSON.stringify(e)),i);let p;h.size<12&&(u.primary_metrics=u.primary_metrics.filter(e=>e.highlighted)),h.canShowEngagementChart&&(p=o.ComponentFactory.createEngagementChart(e.layout,e.engagement_chart,i));const g=a.shouldShowTranslation(e,h);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:c||!1,separatorCount:d,messages:l,settings:h,size:h.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:g}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:g})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:g})),outro:o.ComponentFactory.createOutro(e.layout,n.union(r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:g}),r.BlockFactory.create(s.BlockTypes.ICON,e.translate_button,i,{icon:"fa fa-language translate-icon",isTranslated:g,tooltip:g?l.seeOriginal:l.seeTranslation}),r.BlockFactory.create(s.BlockTypes.ICON,e.compact_navigate_button,i,{icon:"fa fa-external-link details-icon"})),r.BlockFactory.create(s.BlockTypes.ICON,e.save_to_user_workflow_button,i,{icon:a.getSaveUserFlowButtonIcon(e.save_to_user_workflow_button),tooltip:a.getSaveUserFlowButtonTooltip(e.save_to_user_workflow_button,l)}),o.ComponentFactory.createReportingActionsButton(h.showReportingActions&&e.image&&void 0!==e.image.bounding_boxes&&e.image.bounding_boxes.length>0&&!(void 0!==e.image.click_action&&e.image.click_action.action===s.ClickActionTypes.SHOW_VIDEO),i,e.entry_id,l.reportArticle),void 0!==e.open_video_button?e.open_video_button:void 0),metricsContainer:o.ComponentFactory.createMetricsContainer(e.layout,u,i,l,h,e),engagementChart:p,contextMenuButton:o.ComponentFactory.createContextMenuButton(e.layout,i,e.entry_id,e.hash),metrics:u}}static createSleekLayout(e,t,i,n,l,c,d){const h=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i,{canShowImage:d.canShowImage})),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:h})),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1}))}}static createTenSlideLayoutRenderable(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i),u=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.ICON,e.icon,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:u})),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1})),metricsContainer:o.ComponentFactory.createMetricsContainer(e.layout,h,i,n,d,e),metrics:h}}static createFiveSlideLayoutRenderable(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i),u=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),authorBlock:o.ComponentFactory.createAuthorBlock(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.header,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.flags,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i,{canShowImage:d.canShowImage})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:u})),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1})),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.ICON,e.icon,i)),metrics:h,sentiment:o.ComponentFactory.createSentimentFlag(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.sentiment,i))}}static createOneSlideLayoutRenderable(e,t,i,l,c,d,h){const u=a.createMetrics(JSON.parse(JSON.stringify(e)),i),p=a.shouldShowTranslation(e,h);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:c||!1,showImage:h.canShowImage,separatorCount:d,messages:l,settings:h,size:h.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),authorBlock:o.ComponentFactory.createAuthorBlock(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.header,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.flags,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i)),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:p})),outro:o.ComponentFactory.createOutro(e.layout,n.union(r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1}))),metricsContainer:o.ComponentFactory.createMetricsContainer(e.layout,u,i,l,h,e),sentiment:o.ComponentFactory.createSentimentFlag(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.sentiment,i)),metrics:u,icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.ICON,e.icon,i))}}static createThreeSlideLayoutRenderable(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i),u=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),authorBlock:o.ComponentFactory.createAuthorBlock(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.header,i),r.BlockFactory.create(s.BlockTypes.TEXT,e.flags,i)),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i,{canShowImage:d.canShowImage})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:u})),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1})),metrics:h,sentiment:o.ComponentFactory.createSentimentFlag(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.sentiment,i)),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.ICON,e.icon,i))}}static createImageSlideLayoutRenderable(e,t,i,n,l,c,d){const h=a.createMetrics(JSON.parse(JSON.stringify(e)),i),u=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:!1}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:!1})),image:o.ComponentFactory.createImage(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.image,i,{canShowImage:d.canShowImage})),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:u})),metrics:h,icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.ICON,e.icon,i)),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1}))}}static createInteractionLayout(e,t,i,n,l,c,d){const h=a.shouldShowTranslation(e,d);return{widgetId:i,entryId:e.entry_id,entryHash:e.hash,selected:e.selected||!1,showSeparator:l||!1,showImage:d.canShowImage,separatorCount:c,messages:n,settings:d,size:d.size,avatar:o.ComponentFactory.createAvatar(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.avatar,i),e,t),icon:o.ComponentFactory.createIcon(e.layout,r.BlockFactory.create(s.BlockTypes.IMAGE,e.icon,i)),text:o.ComponentFactory.createText(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:h})),outro:o.ComponentFactory.createOutro(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:!1})),title:o.ComponentFactory.createTitle(e.layout,r.BlockFactory.create(s.BlockTypes.TEXT,e.title,i,{isTranslated:h}),r.BlockFactory.create(s.BlockTypes.TEXT,e.subtitle,i,{isTranslated:h}))}}static createCommentLayout(e,t,i,n,o){return{commentId:e.entry_id,entryId:t,widgetId:i,messages:n,selected:!1,size:0,entryHash:e.hash,text:r.BlockFactory.create(s.BlockTypes.TEXT,e.text,i,{isTranslated:o}),outro:r.BlockFactory.create(s.BlockTypes.TEXT,e.outro,i,{isTranslated:o})}}static createMetrics(e,t){return{matching_entities:e.matching_entities,matching_panels:e.matching_panels,matching_topics:e.matching_topics,matching_ai_rules:e.matching_ai_rules,primary_metrics:e.primary_metrics,secondary_metrics:e.secondary_metrics,device_info:e.device_info,tags:e.tags,flags:r.BlockFactory.create(s.BlockTypes.TEXT,e.flags,t,{isTranslated:!1}),metadata:e.metadata,virality_button:e.virality_button}}static getSaveUserFlowButtonIcon(e){return e?i({"story-action-icon":!0,"icon2-tw-remove-story colored":e.selected,"icon2-tw-save-story":!e.selected}):""}static getSaveUserFlowButtonTooltip(e,t){return e?e.selected?t.removeSavedEntry:t.saveEntryForLater:""}static shouldShowTranslation(e,t){return n.isUndefined(e.show_translation)?t.isTranslated:e.show_translation}static shouldShowTranslationButton(e){return e.text&&!!e.text.length&&e.text.some(e=>!!e.text)}}t.LayoutFactory=a}),define("factories/article_render_factory",["require","exports","log","react","layouts/widget/widget_layout_types","renderables/layouts/article/compact_layout_renderable","renderables/layouts/article/grid_layout_renderable","renderables/layouts/article/interaction_layout_renderable","renderables/layouts/article/list_layout_renderable","renderables/layouts/article/sleek_layout_renderable","renderables/layouts/article/slides/five_slide_layout_renderable","renderables/layouts/article/slides/image_slide_layout_renderable","renderables/layouts/article/slides/one_slide_layout_renderable","renderables/layouts/article/slides/ten_slide_layout_renderable","renderables/layouts/article/slides/three_slide_layout_renderable","renderables/layouts/article/story_layout_renderable","renderables/layouts/article/tile_layout_renderable","factories/layout_factory"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleRenderFactory=class{static createArticleLayout(e){const{settings:t,article:i}=e,y=JSON.parse(JSON.stringify(i));switch(this.printAIDebugInfo(y),e.widgetLayout){case n.WidgetLayoutTypes.ARTICLE_LIST:case n.WidgetLayoutTypes.RESULTSLIST_FULL_CONTENT:const b=f.LayoutFactory.createListLayout(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(l.ListLayoutRenderable,{article:y,layout:b,style:e.style});case n.WidgetLayoutTypes.ARTICLE_LIST_COMPACT:const E=f.LayoutFactory.createCompactLayout(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(r.CompactLayoutRenderable,{article:y,layout:E,style:e.style});case n.WidgetLayoutTypes.ARTICLE_LIST_SLEEK:const S=f.LayoutFactory.createSleekLayout(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(c.SleekLayoutRenderable,{article:y,layout:S,style:e.style});case n.WidgetLayoutTypes.RESULTSLIST_INTERACTIONS:const C=f.LayoutFactory.createInteractionLayout(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(a.InteractionLayoutRenderable,{article:y,layout:C,style:e.style,mediator:e.mediator});case n.WidgetLayoutTypes.ARTICLE_IMAGE_GRID:const v=f.LayoutFactory.createGridLayout(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(o.GridLayoutRenderable,{article:y,layout:v,style:e.style});case n.WidgetLayoutTypes.ARTICLE_STORY_TILES:const T=f.LayoutFactory.createTileLayout(i,e.iconMap,e.widgetId,e.messages,t);return s.createElement(_.TileLayoutRenderable,{article:y,layout:T,style:e.style,loadCallback:e.loadCallback,isAnimated:t.isAnimated});case n.WidgetLayoutTypes.ARTICLE_STORIES:const I=f.LayoutFactory.createStoryLayout(i,e.iconMap,e.widgetId,e.messages,t);return s.createElement(m.StoryLayoutRenderable,{article:y,layout:I,style:e.style,loadCallback:e.loadCallback,isAnimated:t.isAnimated});case n.WidgetLayoutTypes.RESULTSLIST_SLIDES_TEN:const w=f.LayoutFactory.createTenSlideLayoutRenderable(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(p.TenSlideLayoutRenderable,{article:y,layout:w,style:e.style,paddingPosition:e.paddingPosition});case n.WidgetLayoutTypes.RESULTSLIST_SLIDES_FIVE:const A=f.LayoutFactory.createFiveSlideLayoutRenderable(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(d.FiveSlideLayoutRenderable,{article:y,layout:A,style:e.style});case n.WidgetLayoutTypes.RESULTSLIST_SLIDES_ONE:const O=f.LayoutFactory.createOneSlideLayoutRenderable(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(u.OneSlideLayoutRenderable,{article:y,layout:O,style:e.style});case n.WidgetLayoutTypes.RESULTSLIST_SLIDES_THREE:const M=f.LayoutFactory.createThreeSlideLayoutRenderable(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(g.ThreeSlideLayoutRenderable,{article:y,layout:M,style:e.style});case n.WidgetLayoutTypes.RESULTSLIST_SLIDES_IMAGES:const L=f.LayoutFactory.createImageSlideLayoutRenderable(i,e.iconMap,e.widgetId,e.messages,e.showSeparator,e.separatorCount,t);return s.createElement(h.ImageSlideLayoutRenderable,{article:y,layout:L,style:e.style});default:throw new Error("Unknown widget layout: "+(e.widgetLayout||"undefined"))}}static printAIDebugInfo(e){if(void 0!==e.metadata&&void 0!==e.metadata.ai_debug_info){const{shortName:t="no aiDebugInfo.short_name",description:s="no aiDebugInfo.description",debug:n="no aiDebugInfo.debug"}=e.metadata.ai_debug_info;i.logService.debug(`AI Debug Information:\n short name: ${t}\n description: ${s}\n debug: ${n}\n article id: ${e.entry_id}`)}}}}),define("renderables/article_renderable",["require","exports","underscore","reusable_components","flux","factories/article_render_factory","stores/article_store","actions/article_actions"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticleRenderable=class extends n.BaseComponent{componentDidMount(){this.cancellationToken.subscribe(o.ArticleStore.getInstance().onChange,this.handleArticleStoreActions.bind(this)),this.cancellationToken.subscribe(s.SourceActionsMenuStore.getInstance().onChange,this.handleSourceActionsMenuStoreActions.bind(this))}render(){return r.ArticleRenderFactory.createArticleLayout(this.props)}handleArticleStoreActions(e){if(e.widgetId!==this.props.widgetId)return;const t=[s.GenericActions.generic_onClickUrlAndSetRead,a.ArticleActions.article_onApplyScore,a.ArticleActions.article_onApplySentiment,a.ArticleActions.article_onToggleImportant,a.ArticleActions.article_onToggleTag,a.ArticleActions.article_onAddCustomTag,a.ArticleActions.article_onRemoveTag];if(i.contains(t,e.action)){const t=this.props.article.entry_id,i=e;(i.entryId===t||this.selectionContainsArticle(i.selection,t))&&this.forceUpdate()}}selectionContainsArticle(e,t){return e&&i.contains(e.get().map(e=>e.entry_id),t)}handleSourceActionsMenuStoreActions(e){const t=[s.SourceActionsMenuEvent.sourceActionsMenuEvent_onInfluenstarChanged,s.SourceActionsMenuEvent.sourceActionsMenuEvent_onFavoriteChanged];i.contains(t,e.action)&&this.doesArticleContainSource(e.payload.sources)&&this.forceUpdate()}doesArticleContainSource(e){const t=i.find(e,e=>{const t=this.props.article.source;return e.id_hash===t.id_hash||e.url_hash===t.url_hash});return!i.isUndefined(t)}}}),define("renderables/components/load_more_renderable",["require","exports","react","flux","reusable_components","stores/article_store","actions/article_actions","underscore"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LoadMoreRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state={preventTrigger:e.preventTrigger||!1}}componentWillReceiveProps(e,t){this.state.preventTrigger&&!e.preventTrigger&&this.setState({preventTrigger:!1})}componentDidMount(){this.cancellationToken.subscribe(r.ArticleStore.getInstance().onChange,e=>{e.widgetId===this.props.widgetId&&e.action===o.ArticleActions.article_onPayloadRefresh&&(this.isUnmounted||this.setState({preventTrigger:!0}))})}render(){return this.state.preventTrigger?null:i.createElement("div",{className:"load-more"},i.createElement(n.VisibilityRenderable,{onChange:a.throttle(this.callback.bind(this),250),delay:333}))}callback(e){e&&!this.state.preventTrigger&&(this.props.callback(),this.setState({preventTrigger:!0}))}}}),define("layouts/widget/list_widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/widget/abstract_list_widget_layout_renderable",["require","exports","react","underscore","flux","reusable_components","renderables/components/load_more_renderable","actions/article_actions","event","event_bus","math_utils","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractListWidgetLayoutRenderable=class extends n.BaseComponent{constructor(e){super(e),this.state={showLoadMore:!e.configuration.settings.useVirtualList},this.onItemsAdded=new l.Event}componentDidMount(){this.requestGridExpansion()}componentDidUpdate(){this.requestGridExpansion()}render(){const e=this.generateArticles(),t=this.generateLoadMoreRenderable(),i=this.generateNoMoreArticlesBlock();return this.renderContainer(e,t,i)}loadMoreCallback(){n.dispatcher.dispatch(a.ArticleActions.article_onTriggerLoadMore,{widgetId:this.props.configuration.widgetId})}getArticlesFromProps(e){const{payload:t}=e.configuration;return t&&t.articles?t.articles:[]}isLoadMore(e){const t=this.getArticlesFromProps(e),i=this.getArticlesFromProps(this.props);return t.length>i.length}isNewPayload(e){const t=this.getArticlesFromProps(e),i=this.getArticlesFromProps(this.props);return t.length<i.length||t.length===i.length&&!s.isEqual(t,i)}componentWillReceiveProps(e,t){(this.isLoadMore(e)||this.isNewPayload(e))&&this.setState({showLoadMore:!1})}generateArticles(){const{payload:e,settings:t,widgetId:s,messages:n,iconMap:o}=this.props.configuration,a=e?e.articles:[],l=this.generateSingleArticle.bind(this,s,n,t,o),c=()=>{this.isUnmounted||this.setState({showLoadMore:!0})};if(t.useItemPooling)return i.createElement(r.ItemPoolContainer,{id:s,items:a.map(e=>this.addKey(e)),renderItem:l,strategy:this.getItemPoolStrategy(this.props.containerClass),containerClass:this.props.containerClass||"list"});if(t.useVirtualList)return i.createElement(r.VirtualListContainer,{items:a,renderItem:l,container:window,tagName:"div",batchSize:this.calculateOptimalBatchSize(),renderDelay:5,onDone:c,containerClass:this.props.containerClass||"list"});{const e=a.map((e,t)=>l(e,t));return h.AnimationLoop.requestAnimationFrame(async()=>c()),i.createElement("div",{className:this.props.containerClass||"list"},e)}}addKey(e){const{layout:t}=this.props.configuration.settings;return e.key=e.key||e.entry_id+t,e}generateLoadMoreRenderable(){return!0===this.state.showLoadMore?i.createElement(o.LoadMoreRenderable,{containment:null,widgetId:this.props.configuration.widgetId,callback:this.loadMoreCallback.bind(this)}):null}generateNoMoreArticlesBlock(){return this.canShowNoMoreArticlesBlock()?i.createElement("div",{className:"no-more-results"}):null}canShowNoMoreArticlesBlock(){const{payload:e,settings:t}=this.props.configuration;return t.canShowEndOfResults&&(0===e.total||e.articles&&e.articles.length===e.total)}canShowSeparator(e,t){const{settings:i}=this.props.configuration;return t%i.numResults==0&&(!(t===e)||i.canShowSeparator)}getItemPoolStrategy(e="list"){const t=new r.DefaultItemPoolStrategy(this.onItemsAdded);return t.setContainerClass(e),t}requestGridExpansion(){this.gridExpansionTimeoutId=this.cancellationToken.setTimeout(()=>{clearTimeout(this.gridExpansionTimeoutId),c.eventBus.dispatch({type:c.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.configuration.widgetId,expectedSize:new d.Vector2D(this.props.configuration.settings.width,this.props.configuration.settings.height),realSize:new d.Vector2D(this.containerRef.clientWidth,this.containerRef.clientHeight+3)}})})}}}),define("renderables/layouts/widget/compact_widget_layout_renderable",["require","exports","classnames","react","underscore","layouts/widget/widget_layout_types","renderables/article_renderable","renderables/layouts/widget/abstract_list_widget_layout_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CompactWidgetLayoutRenderable=class extends a.AbstractListWidgetLayoutRenderable{renderContainer(e,t,i){return s.createElement("div",{ref:e=>this.containerRef=e,className:this.generateClassName()},e,t,i)}calculateOptimalBatchSize(){const e=this.getArticlesFromProps(this.props);return e?n.any(e,e=>!n.isUndefined(e.engagement_chart))?3:5:10}generateSingleArticle(e,t,i,n,a,l,c){const d=this.getArticlesFromProps(this.props);a.key=a.entry_id+r.WidgetLayoutTypes.ARTICLE_LIST_COMPACT;const h=l+1,u=this.canShowSeparator(d.length,l+1);return s.createElement(o.ArticleRenderable,{key:a.key,widgetLayout:r.WidgetLayoutTypes.ARTICLE_LIST_COMPACT,widgetId:e,article:a,messages:t,settings:i,iconMap:n,showSeparator:u||!1,separatorCount:h||0,style:c})}generateClassName(){const{settings:e}=this.props.configuration;return i({"articles entries":!0,"has-chart":e.canShowEngagementChart,[e.fontSizeClass]:!0})}}}),define("renderables/layouts/widget/empty_results_widget_layout_renderable",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EmptyResultsWidgetLayoutRenderable=class extends s.BaseComponent{render(){return i.createElement("div",null)}}}),define("layouts/widget/grid_widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/strategies/grid_layout_pool_strategy",["require","exports","reusable_components","react","react-transition-group","underscore","log"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GridLayoutPoolStrategy=class extends i.DefaultItemPoolStrategy{constructor(e,t){super(t),this.minRenderDelay=2e3,this.maxPoolSize=100,this.timeframe=e.refreshDelay,this.maxItems=e.numResults,this.poolTimestamps={}}enhanceInitialItemList(e){return e.forEach(e=>{e.poolTimestamp=Date.now()}),e}addPooledItemsToList(e){const{pool:t,nextItemArrival:s,items:n}=e;if(t&&t.length>0){const e=t.splice(0,this.getItemsToAdd());let r=n;return e.forEach(e=>{const t=this.findRandomItemIndexByTimestamp(r);r=[...r.slice(0,t),e,...r.slice(t+1)],e.poolTimestamp=Date.now()}),void 0!==this.onItemsAdded&&this.onItemsAdded.fire(e),o.logService.debug("Add an item from the pool!",i.ItemPoolFeature,{newItems:e,items:r}),o.logService.debug(`There are now ${t.length} items left in the pool`,i.ItemPoolFeature,{pool:t}),this.pruneItemList(r),{items:r,pool:t,nextItemArrival:s}}o.logService.debug("Item pool is empty...",i.ItemPoolFeature)}findRandomItemIndexByTimestamp(e){const t=r.groupBy(e,"poolTimestamp"),s=r.values(t).sort((e,t)=>{const i=r.first(e),s=r.first(t);return i.poolTimestamp>s.poolTimestamp?1:-1}),n=r.first(s),a=r.sample(n),l=r.findIndex(e,a);return o.logService.debug("Random item to be replaced",i.ItemPoolFeature,{groupedItemsByTimestamp:t,oldestTimestampGroup:n,candidate:a,index:l}),l}renderItems(e,t){return s.createElement(n.TransitionGroup,{className:this.getContainerClass()},this.getRenderedItems(e,t))}getRenderedItems(e,t){return e.items.map((e,i)=>s.createElement(n.CSSTransition,{key:e.key,classNames:"fader",timeout:{enter:1e3,exit:1e3}},t(e,i,{})))}}}),define("renderables/layouts/widget/grid_widget_layout_renderable",["require","exports","react","flux","classnames","renderables/article_renderable","layouts/widget/widget_layout_types","renderables/layouts/widget/abstract_list_widget_layout_renderable","actions/article_actions","layouts/strategies/grid_layout_pool_strategy"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GridWidgetLayoutRenderable=class extends a.AbstractListWidgetLayoutRenderable{constructor(e){super(e),this.constructItemPoolStrategy()}renderContainer(e,t,s){const r=n({"entries articles":!0,breakdown:void 0!==this.props.configuration.breakdownGroup});return i.createElement("div",{ref:e=>this.containerRef=e,className:r,style:this.getArticlesContainerStyle()},e,t,s)}canShowSeparator(e,t){const{numResults:i}=this.props.configuration.settings;return t<=e&&t%i==0}calculateOptimalBatchSize(){return 8}generateSingleArticle(e,t,s,n,a,l,c){const d=this.getArticlesFromProps(this.props);a.key=a.entry_id+o.WidgetLayoutTypes.ARTICLE_IMAGE_GRID;const h=this.canShowSeparator(d.length,l+1),u=l+1;return i.createElement(r.ArticleRenderable,{key:a.key,widgetLayout:o.WidgetLayoutTypes.ARTICLE_IMAGE_GRID,widgetId:e,article:a,messages:t,settings:s,iconMap:n,showSeparator:h||!1,separatorCount:u||0,style:c})}getItemPoolStrategy(){return this.itemPoolStrategy}loadMoreCallback(){setTimeout(()=>{s.dispatcher.dispatch(l.ArticleActions.article_onTriggerLoadMore,{widgetId:this.props.configuration.widgetId})},200)}constructItemPoolStrategy(){const{settings:e}=this.props.configuration;this.itemPoolStrategy=new c.GridLayoutPoolStrategy(e),this.itemPoolStrategy.setContainerClass(n({grid:!0,fader:e.isAnimated}))}getArticlesContainerStyle(){const{breakdownGroup:e}=this.props.configuration;if(void 0!==e){const{color:t}=e;return{borderLeft:`7px solid ${t}`}}}}}),define("renderables/layouts/widget/interaction_widget_layout_renderable",["require","exports","react","renderables/article_renderable","layouts/widget/widget_layout_types","renderables/layouts/widget/abstract_list_widget_layout_renderable","classnames"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=10;t.InteractionWidgetLayoutRenderable=class extends r.AbstractListWidgetLayoutRenderable{renderContainer(e,t,s){return i.createElement("div",{ref:e=>this.containerRef=e,className:this.generateClassName()},e,t,s)}calculateOptimalBatchSize(){return a}generateSingleArticle(e,t,r,o,a,l,c){return a.key=a.entry_id+n.WidgetLayoutTypes.RESULTSLIST_INTERACTIONS,i.createElement(s.ArticleRenderable,{key:a.key,widgetLayout:n.WidgetLayoutTypes.RESULTSLIST_INTERACTIONS,widgetId:e,article:a,messages:t,settings:r,iconMap:o,showSeparator:!1,separatorCount:0,style:c,mediator:this.props.configuration.mediator})}generateClassName(){const{settings:e}=this.props.configuration;return o({articles:!0,[e.fontSizeClass]:!0})}}}),define("renderables/layouts/widget/list_widget_layout_renderable",["require","exports","react","renderables/layouts/widget/abstract_list_widget_layout_renderable","layouts/widget/widget_layout_types","renderables/article_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ListWidgetLayoutRenderable=class extends s.AbstractListWidgetLayoutRenderable{renderContainer(e,t,s){return i.createElement("div",{ref:e=>this.containerRef=e,className:"articles"},e,t,s)}calculateOptimalBatchSize(){return 4}generateSingleArticle(e,t,s,o,a,l,c){const d=this.getArticlesFromProps(this.props);a.key=a.entry_id+n.WidgetLayoutTypes.ARTICLE_LIST;const h=this.canShowSeparator(d.length,l+1),u=l+1;return i.createElement(r.ArticleRenderable,{key:a.key,widgetLayout:n.WidgetLayoutTypes.ARTICLE_LIST,widgetId:e,article:a,messages:t,settings:s,iconMap:o,showSeparator:h||!1,separatorCount:u||0,style:c})}}}),define("layouts/strategies/globe_layout_pool_strategy",["require","exports","reusable_components"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GlobeLayoutPoolStrategy=class extends i.DefaultItemPoolStrategy{constructor(e,t){super(t),this.minRenderDelay=4e3,this.timeframe=e.refreshDelay}}}),define("renderables/layouts/widget/sleek_widget_layout_renderable",["require","exports","react","renderables/article_renderable","layouts/widget/widget_layout_types","renderables/layouts/widget/abstract_list_widget_layout_renderable","classnames","layouts/strategies/globe_layout_pool_strategy","reusable_utilities"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const c=10;t.SleekWidgetLayoutRenderable=class extends r.AbstractListWidgetLayoutRenderable{constructor(e){super(e),this.onItemsAdded.subscribe(t=>{const{mediator:i}=e.configuration,s=_.first(t),{metadata:n,location:r}=s;if(void 0!==r){const{latitude:e,longitude:t,label:s}=r;i.dispatch("GLOBE.PING",{longitude:t,latitude:e,color:this.getColorBySentiment(n.sentiment),placeLabel:s})}});const{settings:t}=e.configuration;this.itemPoolStrategy=new a.GlobeLayoutPoolStrategy(t,this.onItemsAdded),this.itemPoolStrategy.setContainerClass(o({sleek:!0,ticker:t.isAnimated}))}componentDidMount(){const{payload:e,mediator:t}=this.props.configuration;t.listen("GLOBE.REQUEST_INITIAL_PINGS",()=>{e.articles&&e.articles.length>0&&t.dispatch("GLOBE.INITIAL_PINGS",{pings:e.articles.map(e=>{const{metadata:t,location:i}=e,{latitude:s,longitude:n,label:r}=i;return{longitude:n,latitude:s,color:this.getColorBySentiment(t.sentiment),placeLabel:r}})})})}renderContainer(e,t,s){return i.createElement("div",{ref:e=>this.containerRef=e,className:this.generateClassName()},e)}calculateOptimalBatchSize(){return c}getItemPoolStrategy(){return this.itemPoolStrategy}generateSingleArticle(e,t,r,o,a,l,c){return a.key=a.entry_id+n.WidgetLayoutTypes.ARTICLE_LIST_SLEEK,i.createElement(s.ArticleRenderable,{key:a.key,widgetLayout:n.WidgetLayoutTypes.ARTICLE_LIST_SLEEK,widgetId:e,article:a,messages:t,settings:r,iconMap:o,showSeparator:!1,separatorCount:0,style:c})}generateClassName(){const{settings:e}=this.props.configuration;return o({"articles entries":!0,[e.fontSizeClass]:!0,ticker:e.isAnimated})}getColorBySentiment(e="neutral"){switch(e.toLowerCase()){case"positive":return l.Color.POSITIVE_SENTIMENT_COLOR();case"negative":return l.Color.NEGATIVE_SENTIMENT_COLOR();case"neutral":default:return l.Color.NEUTRAL_SENTIMENT_COLOR()}}}}),define("renderables/layouts/widget/slides/five_slide_widget_layout_renderable",["require","exports","react","layouts/widget/widget_layout_types","styles/widget/slides/five_per_slide_widget_layout.css","renderables/article_renderable","renderables/layouts/article/slides/ten_slide_layout_renderable","renderables/layouts/widget/dynamic_size_widget_layout_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fiveSlideDynamicArticleLayoutSettings={articleCount:5,columnCount:5,numberOfRows:5,displayMetric:!0};t.FiveSlideWidgetLayoutRenderable=class extends a.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{dynamicLayout:i=t.fiveSlideDynamicArticleLayoutSettings}=e.settings;return this.renderIt(i)}renderIt(e){const{configuration:t}=this.props,{payload:s}=t,r=s.articles.slice(0,e.articleCount);return i.createElement("div",{className:n.fivePerSlideWidgetStyle.container},this.generateArticleHeader(e),r.map((e,i)=>this.generateArticleRenderable(e,i,t,o.PaddingPosition.NONE)))}generateArticleHeader(e){return i.createElement("div",{className:n.fivePerSlideWidgetStyle.articleHeader},this.getColumnsToBeRendered(e))}getColumnsToBeRendered(e){const t=this.getColumnProportions(e);return[this.generateFirstColumnArticleHeader(t),this.generateSecondColumnArticleHeader(t),this.generateThirdColumnArticleHeader(t),this.generateFourthColumnArticleHeader(t),this.generateFifthColumnArticleHeader(t)].splice(0,e.columnCount)}generateFirstColumnArticleHeader(e){const{author:t}=this.props.configuration.messages.fiveResultsPerSlide;return i.createElement("div",{style:e.firstColumn,key:"1"},t)}generateSecondColumnArticleHeader(e){const{post:t}=this.props.configuration.messages.fiveResultsPerSlide;return i.createElement("div",{style:e.secondColumn,key:"2",className:n.fivePerSlideWidgetStyle.articleHeaderColumnWithBorder},t)}generateThirdColumnArticleHeader(e){return i.createElement("div",{style:e.thirdColumn,key:"3"})}generateFourthColumnArticleHeader(e){const t=this.props.configuration.payload.articles[0].primary_metrics[0].text;return i.createElement("div",{style:e.fourthColumn,key:"4",className:n.fivePerSlideWidgetStyle.articleHeaderColumnWithBorder},t)}generateFifthColumnArticleHeader(e){const{otherMetrics:t}=this.props.configuration.messages.fiveResultsPerSlide;return i.createElement("div",{style:e.fifthColumn,key:"5",className:n.fivePerSlideWidgetStyle.articleHeaderColumnWithBorder},t)}generateArticleRenderable(e,n,o,a){const{widgetId:l,messages:c,settings:d,iconMap:h}=o,{dynamicLayout:u=t.fiveSlideDynamicArticleLayoutSettings}=d,p=this.getColumnProportions(u),g=this.getArticleProportions(d,u);e.key=e.entry_id+s.WidgetLayoutTypes.RESULTSLIST_SLIDES_FIVE;const m={key:e.key,widgetLayout:s.WidgetLayoutTypes.RESULTSLIST_SLIDES_FIVE,widgetId:l,article:e,messages:c,settings:d,iconMap:h,showSeparator:!1,separatorCount:n+1,paddingPosition:a,style:{columnProportions:p,articleProportions:g}};return i.createElement(r.ArticleRenderable,Object.assign({},m))}getArticleProportions(e,i=t.fiveSlideDynamicArticleLayoutSettings){const{height:s}=e,n=(s-s/20)/i.numberOfRows,r=n/6;return{article:{height:`${n}px`,paddingTop:`${1*r/5}px`,paddingBottom:`${1*r/5}px`,fontSize:n/8.75}}}getColumnProportions(e){const t=this.getColumnWidths(e);return{firstColumn:{flexBasis:`${t[0]}%`},secondColumn:{flexBasis:`${t[1]}%`},thirdColumn:{flexBasis:`${t[2]}%`},fourthColumn:{flexBasis:`${t[3]}%`,whiteSpace:"nowrap"},fifthColumn:{flexBasis:`${t[4]}%`}}}getColumnWidths(e){return this.totalReferenceWidth=this.getTotalReferenceWidth(e),[this.getWidthForColumnNumber(1),this.getWidthForColumnNumber(2),this.getWidthForColumnNumber(3),this.getWidthForColumnNumber(4),this.getWidthForColumnNumber(5)]}getTotalReferenceWidth(e){switch(e.columnCount){case 1:return 6;case 2:return 12;case 3:return 15;case 4:return 17;case 5:return 20;default:throw new RangeError("Parameter outside of the allowed range of [1,5]")}}getWidthForColumnNumber(e){switch(e){case 1:case 2:return this.calculateColumnWidth(6);case 3:return this.calculateColumnWidth(3);case 4:return this.calculateColumnWidth(2);case 5:return this.calculateColumnWidth(3);default:throw new RangeError("Parameter outside of the allowed range of [1,5]")}}calculateColumnWidth(e){return e/this.totalReferenceWidth*100}}}),define("renderables/layouts/widget/slides/image_slide_widget_layout_renderable",["require","exports","react","renderables/layouts/widget/dynamic_size_widget_layout_renderable","renderables/layouts/article/slides/ten_slide_layout_renderable","layouts/widget/widget_layout_types","styles/widget/slides/image_slide_widget_layout.css","renderables/article_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageSlideDynamicArticleLayoutSettings={articleCount:3,columnCount:3,numberOfRows:3};t.ImageSlideWidgetLayoutRenderable=class extends s.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{dynamicLayout:i=t.imageSlideDynamicArticleLayoutSettings}=e.settings;return this.renderIt(i)}renderIt(e){const{configuration:t}=this.props,{payload:s}=t,r=s.articles.slice(0,e.articleCount);return i.createElement("div",{className:o.imageSlideWidgetStyle.container},r.map((e,i)=>this.generateArticleRenderable(e,i,t,n.PaddingPosition.NONE)))}generateArticleRenderable(e,s,n,o){const{widgetId:l,messages:c,settings:d,iconMap:h}=n,{dynamicLayout:u=t.imageSlideDynamicArticleLayoutSettings}=n.settings,p=this.getArticleProportions(d,u);e.key=e.entry_id+r.WidgetLayoutTypes.RESULTSLIST_SLIDES_IMAGES;const g={key:e.key,widgetLayout:r.WidgetLayoutTypes.RESULTSLIST_SLIDES_IMAGES,widgetId:l,article:e,messages:c,settings:d,iconMap:h,showSeparator:!1,separatorCount:s+1,paddingPosition:o,style:{articleProportions:p}};return i.createElement(a.ArticleRenderable,Object.assign({},g))}getArticleProportions(e,t){const{height:i}=e,s=i/(50*t.numberOfRows),n=i/t.numberOfRows-s,{width:r}=e,o=r/(50*t.columnCount)/2,a=o;return{article:{minHeight:`${n}px`,minWidth:`${r/t.columnCount-(o+a)}px`,marginBottom:s,marginLeft:o,marginRight:a}}}}}),define("renderables/layouts/widget/slides/three_slide_widget_layout_renderable",["require","exports","react","renderables/layouts/widget/dynamic_size_widget_layout_renderable","renderables/layouts/article/slides/ten_slide_layout_renderable","layouts/widget/widget_layout_types","styles/widget/slides/three_per_slide_widget_layout.css","renderables/article_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.threeSlideDynamicArticleLayoutSettings={articleCount:3,columnCount:3};t.ThreeSlideWidgetLayoutRenderable=class extends s.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{dynamicLayout:i=t.threeSlideDynamicArticleLayoutSettings}=e.settings;return this.renderIt(i)}renderIt(e){const{configuration:t}=this.props,{payload:s}=t,r=s.articles.slice(0,e.articleCount);return i.createElement("div",{className:o.threePerSlideWidgetStyle.container},r.map((e,i)=>this.generateArticleRenderable(e,i,t,n.PaddingPosition.NONE)))}generateArticleRenderable(e,s,n,o){const{widgetId:l,messages:c,settings:d,iconMap:h}=n,{dynamicLayout:u=t.threeSlideDynamicArticleLayoutSettings}=n.settings,p=this.getArticleProportions(d,u);e.key=e.entry_id+r.WidgetLayoutTypes.RESULTSLIST_SLIDES_THREE;const g={key:e.key,widgetLayout:r.WidgetLayoutTypes.RESULTSLIST_SLIDES_THREE,widgetId:l,article:e,messages:c,settings:d,iconMap:h,showSeparator:!1,separatorCount:s+1,paddingPosition:o,style:{articleProportions:p}};return i.createElement(a.ArticleRenderable,Object.assign({},g))}getArticleProportions(e,t){const i=this.getArticleWidth(e,t),{height:s}=e;return{article:{height:`${s}px`,flexBasis:`${i}px`,fontSize:s/38}}}getArticleWidth(e,t){const{width:i}=e;switch(t.columnCount){case 1:return i;case 2:return i/2.1;case 3:return i/3.1;default:throw new RangeError("column count not in interval of [1,3]")}}}}),define("renderables/layouts/widget/abstract_carousel_widget_layout_renderable",["require","exports","react","underscore","flux","reusable_components","actions/article_actions"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractCarouselWidgetLayoutRenderable=class extends n.BaseComponent{constructor(e){super(e),this.state=this.initializeState(e)}initializeState(e){return{articles:e.configuration.payload.articles}}componentWillReceiveProps(e){const t=e.configuration.payload,i=this.props.configuration.payload,n=t&&t.articles?t.articles:[],r=i&&i.articles?i.articles:[];(n.length<=r.length||!s.isEqual(i,t))&&this.setState(this.initializeState(e))}render(){const{settings:e}=this.props.configuration,t={width:235,margin:15,isAnimated:e.isAnimated,useLoadingFlag:e.useLoadingFlag,numberOfItemsInView:5,loadMoreThresholdItems:Math.floor(.6*e.numResults)};return i.createElement(r.CarouselList,{settings:t,containerClass:this.props.containerClass,onFetchMoreData:this.onFetchMoreData.bind(this),items:this.state.articles,generateItems:this.generateArticles.bind(this)})}onFetchMoreData(){n.dispatcher.dispatch(o.ArticleActions.article_onNavigateCarousel,{isForward:!0,widgetId:this.props.configuration.widgetId})}generateArticles(e){const{widgetId:t,messages:i,settings:n,iconMap:r}=this.props.configuration,o=this.generateSingleArticle.bind(this,t,i,n,r);return s.map(e,(e,t)=>o(e,t))}}}),define("renderables/layouts/widget/story_widget_layout_renderable",["require","exports","react","renderables/layouts/widget/abstract_carousel_widget_layout_renderable","layouts/widget/widget_layout_types","renderables/article_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StoryWidgetLayoutRenderable=class extends s.AbstractCarouselWidgetLayoutRenderable{generateSingleArticle(e,t,s,o,a,l,c){return a.key=a.entry_id+n.WidgetLayoutTypes.ARTICLE_STORIES,i.createElement(r.ArticleRenderable,{key:a.key,widgetLayout:n.WidgetLayoutTypes.ARTICLE_STORIES,widgetId:e,article:a,messages:t,settings:s,iconMap:o,showSeparator:!1,separatorCount:l+1,style:c})}}}),define("layouts/strategies/tile_layout_pool_strategy",["require","exports","react","reusable_components"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TileLayoutPoolStrategy=class extends s.DefaultItemPoolStrategy{constructor(e,t){super(t),this.timeframe=e.refreshDelay,this.maxItems=2*e.numResults}renderItems(e,t){return i.createElement("div",{className:this.getContainerClass()},this.getRenderedItems(e,t))}handleOldItemDiscards(e){}}}),define("layouts/widget/tile_widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/widget/tiles_widget_layout_renderable",["require","exports","classnames","event_bus","flux","log","math_utils","react","reusable_components","underscore","actions/article_actions","layouts/strategies/tile_layout_pool_strategy","layouts/widget/widget_layout_types","renderables/article_renderable","renderables/components/load_more_renderable","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m){"use strict";var _;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.EAGER=0]="EAGER",e[e.ORDERED=1]="ORDERED",e[e.POOLED=2]="POOLED"}(_=t.TileLayoutStrategies||(t.TileLayoutStrategies={}));const f=20;t.TilesWidgetLayoutRenderable=class extends n.BaseComponent{constructor(e){super(e),this.loadMorePosition=0,this.lastContainerHeight=0,this.state=this.initializeState(e,!1),this.debouncedCheckQueue=c.debounce(this.checkQueue.bind(this),f),this.orientationChangeHandler=this.handleOrientationChange.bind(this),this.itemPoolStrategy=new h.TileLayoutPoolStrategy(this.props.configuration.settings),this.itemPoolStrategy.setContainerClass(i({pooling:!0}))}initializeState(e,t){return{tileStyles:this.resetTileStyles(void 0!==this.state?this.state.tileStyles:{},t),queue:{},columns:this.initializeColumns(e),containerHeight:0,loadMorePosition:0,isFullyLoaded:!1,canLoadMore:!1,lastAddedIndex:-1,lastAddedColumn:-1}}resetTileStyles(e,t){return void 0===e||0===Object.keys(e).length||t?{}:(Object.keys(e).forEach(t=>{const i=e[t];i.width=this.getTileWidth(),i.visible=!1,i.noAnimations=!0}),e)}componentWillReceiveProps(e){const t=e.configuration.payload,i=e.configuration.settings,s=this.props.configuration.payload,n=this.props.configuration.settings;(i.width!==n.width&&0!==i.width||i.size!==n.size||i.tileColumnCount!==n.tileColumnCount||!1===i.useItemPooling&&t&&!c.isEqual(t,s))&&(r.logService.debug("Initializing new state since we got a new payload",{name:"Articles"}),this.setState(this.initializeState(e,!1)))}componentWillUnmount(){super.componentWillUnmount(),window.removeEventListener("orientationchange",this.orientationChangeHandler),r.logService.debug("Unmounting tiles container",{name:"Articles"})}initializeColumns(e){return c.range(0,e.columnCount).reduce((t,i)=>(t.push({height:e.evenOffset?i%2*e.evenOffset:0,items:[]}),t),[])}render(){const e=this.generateArticles(),t=this.generateLoadMore();return a.createElement("div",{className:"entries articles",style:{position:"relative",height:this.state.containerHeight+"px"},ref:e=>{this.containerRef=e}},e,t)}generateLoadMore(){if(this.state.canLoadMore){const{widgetId:e}=this.props.configuration,t={position:"absolute",bottom:this.state.loadMorePosition+"px"};return a.createElement("div",{style:t},a.createElement(g.LoadMoreRenderable,{containment:null,widgetId:e,callback:this.loadMoreCallback.bind(this),unlockDelay:750}),this.generateLoadedFlagComponent())}return this.generateLoadedFlagComponent()}generateLoadedFlagComponent(){const{settings:e}=this.props.configuration;return e.useLoadingFlag?(r.logService.debug("Loaded flag:",{name:"Articles"},this.state.isFullyLoaded),a.createElement(l.ImageExportFlag,{fullyLoaded:this.state.isFullyLoaded})):null}loadMoreCallback(){this.updateLoadMorePosition(),n.dispatcher.unsafeDispatch(d.ArticleActions.article_onTriggerLoadMore,{widgetId:this.props.configuration.widgetId})}updateLoadMorePosition(){this.loadMorePosition=0===this.state.containerHeight?0:.66*Math.max(0,this.state.containerHeight-this.lastContainerHeight),this.lastContainerHeight=this.state.containerHeight}generateArticles(){const{layoutStrategy:e,configuration:t}=this.props,{payload:i}=t,s=i&&i.articles||[];switch(e){case _.POOLED:return this.generatePooledArticles(s);case _.ORDERED:case _.EAGER:default:const t=this.getArticleGenerator(this.props);return s.map(t)}}generatePooledArticles(e){const{widgetId:t}=this.props.configuration;return a.createElement(l.ItemPoolContainer,{id:t,items:e.map(e=>this.addKey(e)),renderItem:this.getArticleGenerator(this.props),strategy:this.itemPoolStrategy,containerClass:"list"})}getArticleGenerator(e){const{widgetId:t,messages:i,settings:s,iconMap:n}=e.configuration;return this.generateSingleArticle.bind(this,t,i,s,n)}generateSingleArticle(e,t,i,s,n){return n.key=n.entry_id+u.WidgetLayoutTypes.ARTICLE_STORY_TILES,a.createElement(p.ArticleRenderable,{key:n.key,widgetLayout:u.WidgetLayoutTypes.ARTICLE_STORY_TILES,widgetId:e,article:n,messages:t,settings:i,iconMap:s,loadCallback:this.loadCallback.bind(this,e,n),style:this.getTileStyle(n)})}loadCallback(e,t,i){!1===this.getTileStyle(t).visible&&this.determineStrategy(t,i)}getTileWidth(){const{margin:e,padding:t,configuration:i}=this.props,{settings:s}=i,n=s.tileColumnCount,r=s.width-(e.left+e.right)-2*n;return Math.floor((r-(n-1)*t)/n)}determineColumnIndex(e=-1){const{layoutStrategy:t}=this.props,{lastAddedColumn:i}=this.state;switch(t){case _.ORDERED:return e%this.props.columnCount;case _.POOLED:return(i+1)%this.props.columnCount;default:case _.EAGER:return this.findSmallestColumnIndex()}}findSmallestColumnIndex(){const e=this.state.columns.map(e=>e.height);return e.findIndex(t=>t===Math.min(...e))}findTallestColumnIndex(){const e=this.state.columns.map(e=>e.height);return e.findIndex(t=>t===Math.max(...e))}addElementToColumn(e,t,i=-1){const{margin:n,padding:a,layoutStrategy:l}=this.props,{left:c=0}=n,d=this.state.tileStyles,h=this.determineColumnIndex(i),u=this.state.columns[h],p=$(t).outerHeight(!1);d[e.entry_id]={visible:!0,x:c+h*(this.getTileWidth()+a),y:u.height,width:this.getTileWidth(),height:p},u.height+=p+a,l===_.POOLED&&this.state.isFullyLoaded?(d[e.entry_id].y=0,u.items.forEach(e=>{const t=d[e.entry_id];t&&t.visible&&(t.y+=p+a)}),u.items=[e].concat(u.items)):u.items.push(e);const g=this.findTallestColumnIndex(),m=this.state.columns[g];r.logService.debug("Adding element to tiles layout",{name:"ARTICLES"},{article:e,element:t,column:u,columnIndex:h,elementHeight:p,style:d[e.entry_id]});const{articles:f=[]}=this.props.configuration.payload,y=this.getRenderCount(),b=this.state.isFullyLoaded||y>=f.length;r.logService.debug("Render status:",{name:"Articles"},{renderCount:y,isFullyLoaded:b}),m.height>this.state.containerHeight&&s.eventBus.dispatch({type:s.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.configuration.widgetId,expectedSize:new o.Vector2D(this.props.configuration.settings.width,this.props.configuration.settings.height),realSize:new o.Vector2D(this.containerRef.clientWidth,m.height+3)}}),this.setState({tileStyles:d,columns:this.state.columns,containerHeight:m.height,loadMorePosition:this.loadMorePosition||this.state.loadMorePosition,isFullyLoaded:b,canLoadMore:b,queue:this.state.queue,lastAddedIndex:i,lastAddedColumn:h})}getRenderCount(){return this.state.columns.reduce((e,t)=>e+t.items.length,0)}getTileStyle(e){return this.state.tileStyles[e.entry_id]||(this.state.tileStyles[e.entry_id]={width:this.getTileWidth(),visible:!1}),this.state.tileStyles[e.entry_id]}determineStrategy(e,t){const{layoutStrategy:i}=this.props;let s=!0;switch(i){case _.ORDERED:this.queueElementForAddition(e,t);break;case _.POOLED:s=this.state.isFullyLoaded,this.queueElementForAddition(e,t,s);break;case _.EAGER:this.queueElementForAddition(e,t,s);break;default:r.logService.error("Invalid layout strategy in TileWidgetLayout!",{name:"Articles"},{layoutStrategy:i,article:e,element:t,props:this.props,state:this.state})}}queueElementForAddition(e,t,i=!1){let s;if(!0===i)s=Object.values(this.state.queue).length;else{const{articles:t=[]}=this.props.configuration.payload;s=t.findIndex(t=>t.entry_id===e.entry_id)}this.state.queue[s]={index:s,article:e,element:t},m.AnimationLoop.requestAnimationFrame(this.debouncedCheckQueue)}checkQueue(){const e=this.state.lastAddedIndex+1,t=this.state.queue[e];!this.isUnmounted&&void 0!==t&&this.canAddElement(e)&&(this.addElementToColumn(t.article,t.element,t.index),this.state.queue[e]=void 0,this.setState({lastAddedIndex:e})),Object.values(this.state.queue).length>0&&!this.isUnmounted&&m.AnimationLoop.requestAnimationFrame(this.debouncedCheckQueue)}canAddElement(e){return this.state.lastAddedIndex===e-1}addKey(e){const{layout:t}=this.props.configuration.settings;return e.key=e.key||e.entry_id+t,e}componentDidMount(){window.addEventListener("orientationchange",this.orientationChangeHandler)}async handleOrientationChange(){this.loadMorePosition=0,this.lastContainerHeight=0,this.state=this.initializeState(this.props,!0),this.debouncedCheckQueue=c.debounce(this.checkQueue.bind(this),f),this.itemPoolStrategy=new h.TileLayoutPoolStrategy(this.props.configuration.settings),this.itemPoolStrategy.setContainerClass(i({pooling:!0}))}}}),define("factories/widget_render_factory",["require","exports","react","layouts/widget/widget_layout_types","renderables/layouts/widget/compact_widget_layout_renderable","renderables/layouts/widget/empty_results_widget_layout_renderable","renderables/layouts/widget/grid_widget_layout_renderable","renderables/layouts/widget/interaction_widget_layout_renderable","renderables/layouts/widget/list_widget_layout_renderable","renderables/layouts/widget/sleek_widget_layout_renderable","renderables/layouts/widget/slides/five_slide_widget_layout_renderable","renderables/layouts/widget/slides/image_slide_widget_layout_renderable","renderables/layouts/widget/slides/one_slide_widget_layout_renderable","renderables/layouts/widget/slides/ten_slide_widget_layout_renderable","renderables/layouts/widget/slides/three_slide_widget_layout_renderable","renderables/layouts/widget/story_widget_layout_renderable","renderables/layouts/widget/tiles_widget_layout_renderable"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WidgetRenderFactory=class{static createWidgetRenderable(e){const{payload:t,layout:n}=e;if(0===t.articles.length)return i.createElement(r.EmptyResultsWidgetLayoutRenderable,{key:s.WidgetLayoutTypes.ARTICLE_NO_RESULTS,configuration:e});const{breakdown_groups:o=[]}=t;return 0===o.length?this.createWidgetLayout(e,n):this.createGroupedLayouts(o,e)}static createWidgetLayoutConfiguration(e,t,i,s,n,r,o){return{layout:t,payload:e,widgetId:i,messages:s,settings:n,iconMap:r,mediator:o}}static createGroupedLayouts(e,t){const{layout:s,payload:n}=t;return i.createElement("div",{key:"groups"},e.map(e=>{const i=`${s}-${e.id}`,r=JSON.parse(JSON.stringify(n));r.articles=n.articles.filter(t=>-1!==t.breakdown_group_ids.indexOf(e.id)),r.breakdown_groups=[];const o=Object.assign({},t);return o.payload=r,o.breakdownGroup=e,r.articles.length>0?this.createWidgetLayout(o,i):null}))}static createWidgetLayout(e,t){const{layout:r}=e;switch(r){case s.WidgetLayoutTypes.ARTICLE_LIST:case s.WidgetLayoutTypes.RESULTSLIST_NO_METRICS:case s.WidgetLayoutTypes.RESULTSLIST_FULL_CONTENT:return i.createElement(l.ListWidgetLayoutRenderable,{key:t,containerClass:"list",configuration:e});case s.WidgetLayoutTypes.ARTICLE_LIST_COMPACT:return i.createElement(n.CompactWidgetLayoutRenderable,{key:t,containerClass:"compact",configuration:e});case s.WidgetLayoutTypes.ARTICLE_IMAGE_GRID:return i.createElement(o.GridWidgetLayoutRenderable,{key:t,containerClass:"grid",configuration:e});case s.WidgetLayoutTypes.ARTICLE_STORIES:return i.createElement(m.StoryWidgetLayoutRenderable,{key:t,configuration:e});case s.WidgetLayoutTypes.ARTICLE_STORY_TILES:const f={left:14,right:11},y=e.settings.useItemPooling?_.TileLayoutStrategies.POOLED:_.TileLayoutStrategies.ORDERED;return i.createElement(_.TilesWidgetLayoutRenderable,{key:t,configuration:e,evenOffset:0,columnCount:e.settings.tileColumnCount,padding:8,margin:f,layoutStrategy:y});case s.WidgetLayoutTypes.ARTICLE_WORLD_MAP:case s.WidgetLayoutTypes.ARTICLE_LIST_SLEEK:return i.createElement(c.SleekWidgetLayoutRenderable,{key:t,containerClass:"sleek",configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_INTERACTIONS:return i.createElement(a.InteractionWidgetLayoutRenderable,{key:t,containerClass:"interaction",configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_SLIDES_TEN:return i.createElement(p.TenSlideWidgetLayoutRenderable,{key:t,configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_SLIDES_ONE:return i.createElement(u.OneSlideWidgetLayoutRenderable,{key:t,configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_SLIDES_FIVE:return i.createElement(d.FiveSlideWidgetLayoutRenderable,{key:t,configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_SLIDES_THREE:return i.createElement(g.ThreeSlideWidgetLayoutRenderable,{key:t,configuration:e});case s.WidgetLayoutTypes.RESULTSLIST_SLIDES_IMAGES:return i.createElement(h.ImageSlideWidgetLayoutRenderable,{configuration:e});default:throw new Error("Unknown widget layout: "+(r||"undefined"))}}}}),define("containers/articles_container",["require","exports","classnames","event_bus","flux","jquery","keypress","react","reusable_components","underscore","actions/article_actions","factories/keypress_factory","factories/widget_render_factory","layouts/widget/widget_layout_types","stores/article_store","jquery-inline-complete"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArticlesContainer=class extends n.BaseComponent{constructor(e){super(e),this.state={payload:g.ArticleStore.getInstance().getPayload(this.props.widgetId),settings:e.settings,listenFocus:!0,marginBottom:0},this.previousSelectionCount=0,this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.SINGLE_ARTICLE_TO_UPDATE,this.handleSingleArticleUpdate.bind(this))}componentDidMount(){this.cancellationToken.subscribe(g.ArticleStore.getInstance().onChange,this.handleArticleStoreAction.bind(this)),this.cancellationToken.subscribe(l.SourceActionsMenuStore.getInstance().onChange,this.handleSourceActionsMenuStoreAction.bind(this)),this.container&&this.initializeKeyboardNavigation()}componentWillUnmount(){super.componentWillUnmount(),g.ArticleStore.getInstance().removePayload(this.props.widgetId)}initializeKeyboardNavigation(){const{settings:e}=this.state,t=e.keyboardMap,i=e.markingTags,s=this.props.widgetId;this.container.tabIndex=0,this.keyPressListener=new o.Listener(this.container),this.cancellationToken.addCleanupFunction(()=>{h.KeypressFactory.destroyListener(this.keyPressListener)}),e.showScoreActions&&c.each(t.scores,(e,t)=>{const i=parseInt(t,10);h.KeypressFactory.createScoreShortcut(this.keyPressListener,e,s,i)}),e.showTaggingActions&&h.KeypressFactory.createQuickTagShortcut(this.keyPressListener,t.tagging.quick,s),e.showSentimentActions&&(h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.POSITIVE,!1,t.tagging.positive,s,{isSolitary:!0}),h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.NEUTRAL,!1,t.tagging.neutral,s,{isSolitary:!0}),h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.NEGATIVE,!1,t.tagging.negative,s,{isSolitary:!0}),h.KeypressFactory.createToggleImportantShortcut(this.keyPressListener,!1,t.tagging.important,s,{isSolitary:!0}),t.tagging.positive_comments&&h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.POSITIVE,!0,t.tagging.positive_comments,s,{isExclusive:!0}),t.tagging.neutral_comments&&h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.NEUTRAL,!0,t.tagging.neutral_comments,s,{isExclusive:!0}),t.tagging.negative_comments&&h.KeypressFactory.createApplySentimentShortcut(this.keyPressListener,l.Sentiment.NEGATIVE,!0,t.tagging.negative_comments,s,{isExclusive:!0}),t.tagging.important_comments&&h.KeypressFactory.createToggleImportantShortcut(this.keyPressListener,!0,t.tagging.important_comments,s,{isExclusive:!0})),e.showTaggingActions&&(h.KeypressFactory.createToggleTagShortcut(this.keyPressListener,i.checked,!1,t.tagging.checked,s,{isSolitary:!0}),h.KeypressFactory.createToggleTagShortcut(this.keyPressListener,i.read,!1,t.tagging.read,s,{isSolitary:!0}),t.tagging.checked_comments&&h.KeypressFactory.createToggleTagShortcut(this.keyPressListener,i.checked,!0,t.tagging.checked_comments,s,{isExclusive:!0}),t.tagging.read_comments&&h.KeypressFactory.createToggleTagShortcut(this.keyPressListener,i.read,!0,t.tagging.read_comments,s,{isExclusive:!0})),c.each(t.navigation,e=>{h.KeypressFactory.createSelectionNavigationShortcut(this.keyPressListener,e,s)}),h.KeypressFactory.createDeleteArticleShortcut(this.keyPressListener,t.delete,s),h.KeypressFactory.createGenericArticleShortcut(this.keyPressListener,t.selection.unselect,s),h.KeypressFactory.createGenericArticleShortcut(this.keyPressListener,t.selection.all,s,{preventDefault:!0}),h.KeypressFactory.createSourcePanelToggle(this.keyPressListener,"AUTHOR",t.sourcePanel.author,s),h.KeypressFactory.createSourcePanelToggle(this.keyPressListener,"SOURCE",t.sourcePanel.source,s),this.keyPressListener.listen()}render(){const{settings:e,marginBottom:t}=this.state,{layout:s,backgroundStyle:n}=e,r=i({"tw-articles":!0,"tw-entries":!c.contains([p.WidgetLayoutTypes.ARTICLE_LIST,p.WidgetLayoutTypes.ARTICLE_LIST_COMPACT],s),"responsive-articles":e.shouldBeResponsive,"hootsuite-dashboard-articles":e.isHootsuiteDashboard});return a.createElement("div",{className:r,ref:e=>{this.container=e},onBlur:this.onBlur.bind(this),style:Object.assign({},n,{marginBottom:t})},this.renderWidget())}onBlur(e){setTimeout(()=>{if(!0===this.state.listenFocus){const e=document.activeElement;this.handleFocusChange(r(e))}},0)}handleFocusChange(e){let t=!1;if(e&&e.length>0){const i=e.parents(".tw-articles");t=i.length>0&&i.get(0)===this.container}t||n.dispatcher.dispatch(d.ArticleActions.article_onWidgetBlur,{widgetId:this.props.widgetId})}renderWidget(){if(c.isUndefined(this.state.payload)||c.isUndefined(this.state.payload.articles))return null;const{widgetId:e,mediator:t}=this.props,{settings:i,payload:s}=this.state,{messages:n,layout:r,iconMap:o}=i,a=u.WidgetRenderFactory.createWidgetLayoutConfiguration(s,r,e,n,i,o,t);return u.WidgetRenderFactory.createWidgetRenderable(a)}handleArticleStoreAction(e){const{widgetId:t,action:i}=e;if(t!==this.props.widgetId&&!c.isUndefined(t))return;const{settings:s}=this.state,{layout:n}=s;switch(i){case d.ArticleActions.article_onLoadMore:case d.ArticleActions.article_onPayloadRefresh:case d.ArticleActions.article_onArticleDeleted:case d.ArticleActions.article_onReceiveChildArticles:case d.ArticleActions.article_onResizeContainer:case d.ArticleActions.article_onRedraw:case l.GenericActions.generic_onRemoveArticlesBySources:case l.GenericActions.generic_onTriggerTranslationToggle:case l.GenericActions.generic_onToggleEntryUserWorkflow:this.setState({payload:e.payload,settings:e.settings||s,listenFocus:this.state.listenFocus});break;case d.ArticleActions.article_onAddCustomTag:case d.ArticleActions.article_onRemoveTag:this.setState({payload:g.ArticleStore.getInstance().getPayload(this.props.widgetId),settings:s,listenFocus:this.state.listenFocus});break;case d.ArticleActions.article_onContainerWidthChange:n===p.WidgetLayoutTypes.ARTICLE_STORY_TILES&&this.setState({payload:g.ArticleStore.getInstance().getPayload(this.props.widgetId),settings:e.settings,listenFocus:this.state.listenFocus});break;case d.ArticleActions.article_onKeyPressed:case d.ArticleActions.article_onArrowKeyPressed:case d.ArticleActions.article_onEntryClicked:case d.ArticleActions.article_onChildEntryClicked:case d.ArticleActions.article_onClickOutsideContainer:case d.ArticleActions.article_onWidgetBlur:case d.ArticleActions.article_onContextMenuButtonClick:this.refreshSelections(g.ArticleStore.getInstance().getSelection(e.widgetId));break;case d.ArticleActions.article_onContextMenuClose:!0===this.state.listenFocus&&this.setFocus(g.ArticleStore.getInstance().getSelection(e.widgetId));break;case d.ArticleActions.article_onSendEmail:this.setState({listenFocus:e.listenFocus}),!0===e.listenFocus&&this.setFocus(g.ArticleStore.getInstance().getSelection(e.widgetId))}const r=g.ArticleStore.getInstance().getSelection(e.widgetId),o=void 0!==r?r.get().length:0;o!==this.previousSelectionCount&&(this.props.mediator.dispatch(d.ArticleMediatorActions.ARTICLE_SELECTION_CHANGE,{widgetId:t,selectionCount:o}),this.previousSelectionCount=o)}findAndUpdateArticleSelecion(e,t,i,s){const n=c.findIndex(e.get(),e=>e.entry_id===i.entry_id);t.articles[s].selected=-1!==n}refreshSelections(e){const{payload:t,settings:i,listenFocus:s}=this.state;t.articles&&e&&c(t.articles).forEach((i,s)=>{this.findAndUpdateArticleSelecion(e,t,i,s)});const n=this.calculateBottomMargin(i,e);this.setState({payload:t,settings:i,listenFocus:s,marginBottom:n})}calculateBottomMargin(e,t){if(e.shouldAddExtraSpace&&g.ArticleStore.getInstance().isContextMenuOpenForSelection(t)){const e=r(`#${t.getLast().hash}`);if(e&&e.length>0){const t=r(document).height()-e.offset().top;return t<800?1e3-t:0}}return 0}handleSourceActionsMenuStoreAction(e){const t=l.SourceActionsMenuEvent;e.action===t.sourceActionsMenuEvent_onInfluenstarChanged?this.applyInfluenstar(e.payload):e.action===t.sourceActionsMenuEvent_onFavoriteChanged?this.applyFavorite(e.payload):e.action===t.sourceActionsMenuEvent_onPanelAdded&&this.addNewPanel(e.payload)}applyInfluenstar(e){const{payload:t}=this.state,i=t.articles;c.each(i,t=>{let i;i=e.author?c.find(e.sources,e=>e.id_hash===t.author.id_hash):c.find(e.sources,e=>e.id_hash===t.source.id_hash),c.isUndefined(i)||(t.metadata.user_rating=e.value,e.author?t.author.user_rating=e.value:t.source.user_rating=e.value)}),this.setState({payload:t,settings:this.state.settings,listenFocus:this.state.listenFocus})}applyFavorite(e){const{payload:t}=this.state,i=t.articles;c.each(i,t=>{let i;i=e.author?c.find(e.sources,e=>e.id_hash===t.author.id_hash):c.find(e.sources,e=>e.id_hash===t.source.id_hash),c.isUndefined(i)||(t.metadata.favorite=e.toggle,e.author?t.author.favorite=e.toggle:t.source.favorite=e.toggle)}),this.setState({payload:t,settings:this.state.settings,listenFocus:this.state.listenFocus})}addNewPanel(e){const{payload:t}=this.state,{newPanel:i,group:s}=e,n=c.find(t.panels_groups,e=>e.mapped_id===s.mapped_id);void 0!==n?n.panels.push(i):void 0!==s&&(s.panels.push(i),t.panels_groups.push(s)),this.setState({payload:t,settings:this.state.settings,listenFocus:this.state.listenFocus})}setFocus(e){if(this.refreshSelections(e),e&&e.get().length>0){const e=window.scrollX,t=window.scrollY;this.container.focus(),window.scrollTo(e,t)}}handleSingleArticleUpdate(e){const t=e.value,i=this.state.payload,s=i.articles.findIndex(e=>e.entry_id===t.entry_id);if(-1===s)throw new Error("no article to update found");i.articles[s].timeStamp=t.timeStamp,void 0!==i.articles[s].metadata&&void 0!==i.articles[s].metadata.sentiment&&(i.articles[s].metadata.sentiment=t.metadata.sentiment),void 0!==i.articles[s].tags&&(i.articles[s].tags=t.tags),void 0!==i.articles[s].matching_ai_rules&&(i.articles[s].matching_ai_rules=t.matching_ai_rules),void 0!==i.articles[s].outro&&(i.articles[s].outro=t.outro),n.dispatcher.dispatch(d.ArticleActions.article_onPayloadRefresh,{payload:i,widgetId:this.props.widgetId,customPages:this.props.settings.customPages,settings:this.props.settings})}}}),define("layouts/article/disclaimers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Disclaimers={LEXIS_NEXIS:"lexis_nexis"}}),define("articles",["require","exports","actions/article_actions","containers/articles_container","layouts/article/disclaimers","layouts/article/layout_types","layouts/widget/widget_layout_types","renderables/layouts/article/interaction_layout_renderable","renderables/layouts/widget/slides/five_slide_widget_layout_renderable","renderables/layouts/widget/slides/image_slide_widget_layout_renderable","renderables/layouts/widget/slides/one_slide_widget_layout_renderable","renderables/layouts/widget/slides/ten_slide_widget_layout_renderable","renderables/layouts/widget/slides/three_slide_widget_layout_renderable","stores/article_store","utilities/article_payload_map"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";function m(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),m(i),m(s),m(n),m(r),m(o),m(a),m(l),m(c),m(d),m(h),m(u),m(p),m(g)}),define("layouts/widget/compact_widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("mixins/debug_update_mixin",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("utilities/virtual_list_utilities",["require","exports"],function(e,t){"use strict";function i(e){return e&&e!==window?e.offsetTop+i(e.offsetParent):0}Object.defineProperty(t,"__esModule",{value:!0}),t.areArraysEqual=function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(e[i]!==t[i])return!1;return!0},t.topDifference=function(e,t){return i(e)-i(t)},t.topFromWindow=i,t.viewTop=function(e){let t;return e===window?(null==(t=window.pageYOffset)&&(t=document.documentElement.scrollTop),null==t&&(t=document.body.scrollTop)):null==(t=e.scrollY)&&(t=e.scrollTop),null==t?0:t},t.debounce=function(e,t,i){if(!t)return e;let s;return function(){const n=this,r=arguments,o=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||e.apply(n,r)},t),o&&e.apply(n,r)}}}),define("layouts/widget/preview_slides_widget_layout_renderable",["require","exports","react","renderables/layouts/widget/dynamic_size_widget_layout_renderable"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PreviewSlidesWidgetLayoutRenderable=class extends s.DynamicSizeWidgetLayoutRenderable{getLayout(e){const{settings:t,messages:s}=e;return i.createElement("div",{style:this.getContainerStyle(t)},i.createElement("span",{style:this.getTextStyle(t)},s.previewComingSoon))}getContainerStyle(e){const{width:t,height:i}=e;return{textAlign:"center",height:i,width:t,verticalAlign:"middle",position:"relative"}}getTextStyle(e){const{width:t,height:i}=e;return{width:t,position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",fontSize:`${i/8.5}px`}}}}),define("background_canvas_grid",["require","exports","data_structures","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BackgroundCanvasGrid=class{constructor(e,t){this.options=t,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("class",t.canvasDomClass||""),this.canvas.setAttribute("style",t.canvasDomStyle||""),this.canvas.width=t.canvasSize.x,this.canvas.height=t.canvasSize.y,this.context=this.canvas.getContext("2d"),this.stateData=i.SquareArray.createFromDimensions(t.gridSize.x,t.gridSize.y),this.setStateGlobally("default"),e.appendChild(this.canvas)}updateGridSize(e){this.options.gridSize=e,this.stateData.resize(e,"default"),this.redrawAll()}setStateGlobally(e){this.stateData.forEach((t,i,s,n)=>{n[s]=e}),this.redrawAll()}getCellSize(){return this.projectFromGridCoordinates(new s.Vector2D(1,1))}updateStateForArea(e,t){for(let i=e.x;i<e.x+e.width;i++)for(let s=e.y;s<e.y+e.height;s++)this.stateData.setItem(i,s,t);this.clearArea(e),this.drawArea(e)}updateStateForCell(e,t,i){this.stateData.getItem(e,t)!==i&&(this.stateData.setItem(e,t,i),this.clearCell(e,t),this.drawCell(e,t))}redrawAll(){this.clear(),this.stateData.forEach((e,t,i)=>{this.drawCell(t,i)})}projectFromGridCoordinates(e){return e.componentWiseMul(this.options.canvasSize).componentWiseDiv(this.options.gridSize)}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}clearArea(e){const t=this.projectFromGridCoordinates(e.position.clone()),i=this.projectFromGridCoordinates(e.size.clone());this.context.clearRect(t.x,t.y,i.x,i.y)}clearCell(e,t){const i=this.projectFromGridCoordinates(new s.Vector2D(e,t)),n=this.getCellSize();this.context.clearRect(i.x,i.y,n.x,n.y)}drawArea(e){for(let t=e.x;t<e.x+e.width;t++)for(let i=e.y;i<e.y+e.height;i++)this.drawCell(t,i)}drawCell(e,t){const i=this.stateData.getItem(e,t),n=this.projectFromGridCoordinates(new s.Vector2D(e,t)),r=this.getCellSize();this.applyStyle(i),this.context.beginPath(),this.context.rect(n.x,n.y,r.x,r.y),this.context.fill(),this.context.stroke()}applyStyle(e){if(this.currentStyleState!==e){const t=this.getDrawSettingsForState(e);this.context.lineWidth=t.gridLineThickness||1,this.context.setLineDash(t.gridLineDashPattern||[]),this.context.fillStyle=(t.gridCellColor||"transparent").toString(),this.context.strokeStyle=(t.gridLineColor||"transparent").toString(),this.currentStyleState=e}}getDrawSettingsForState(e){if(e in this.options.style){const t={};for(const i in this.options.style.default)t[i]=this.options.style[e][i]||this.options.style.default[i];return t}return this.options.style.default}}}),define("background_grid",["require","exports","background_canvas_grid"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("classes/bar_chart_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/bar_chart_render_config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"}(t.BarChartOrientation||(t.BarChartOrientation={})),function(e){e.NONE="NONE",e.STACK="STACK",e.STACK_PERCENT="STACK_PERCENT",e.NONE_PERCENT="NONE_PERCENT"}(t.BartChartStackingMode||(t.BartChartStackingMode={}))}),define("classes/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/bar_chart_helpers",["require","exports","graphics_utilities","math_utils","classes/bar_chart_render_config","canvas_drawable_mixins"],function(e,t,i,s,n,r){"use strict";function o(e,t,i){if(e.options.renderConfig.stacking_mode.indexOf("PERC")>-1)return e.options.renderConfig.stacking_mode.indexOf("STACK")>-1?`${e.options.numberFormatter.toPercentage(t.value<.1?Math.ceil(t.value/i*10)/10:t.value/i)}`:`${e.options.numberFormatter.toPercentage(t.value/100)}`}Object.defineProperty(t,"__esModule",{value:!0});const a=36,l=10;function c(e,t,n,r,o=!0){if(t.x<l||t.y<l)return[];const{total:d}=n,h=[];e.options.labelSettings.showLabel&&!o&&h.push(r.cellLabel),e.options.labelSettings.showResults&&(r.formattedValue&&r.formattedValue.length>0&&(e.options.renderConfig.stacking_mode.indexOf("PERC")>-1&&r.formattedValue.includes("%")||-1===e.options.renderConfig.stacking_mode.indexOf("PERC")&&!r.formattedValue.includes("%"))?h.push(r.formattedValue):e.options.renderConfig.stacking_mode.indexOf("STACK")>-1?h.push(`${e.options.renderConfig.stacking_mode.indexOf("PERC")>-1?e.options.numberFormatter.toPercentage(r.value<.1?Math.ceil(r.value/d*10)/10:r.value/d):e.options.numberFormatter.toDecimal(r.value)}`):h.push(`${e.options.renderConfig.stacking_mode.indexOf("PERC")>-1?e.options.numberFormatter.toPercentage(r.value/100):e.options.numberFormatter.toDecimal(r.value)}`));const u=new i.DrawableText({position:new s.Vector2D(t.x/2,t.y/2),text:h.join(": "),textAlign:i.DrawableTextAlign.CENTER,textBaseline:i.DrawableTextBaseline.MIDDLE,size:Math.min(Math.floor(.8*t.y),a),family:i.DrawableTextFontFamily.CabinCondensedR,style:{fillStyle:"white",opacity:1,shadowBlur:5,shadowColor:"#666"}});let p=!1;for(;u.size>=l;){if(u.width<.8*t.x&&u.size<.8*t.y){p=!0;break}u.size-=1}if(u.size<l||!p){if(e.options.labelSettings.showLabel&&!o)return c(e,t,n,r,!0);u.styleData.opacity=0}return[u]}t.createBars=function(e){const t=Object.keys(e.data.model.groups);let d,h=!0;const u=e.options.renderConfig.stacking_mode.indexOf("STACK")>-1,p=(e.options.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL?e.chartWidth:e.chartHeight)/t.length*.9;return t.forEach(t=>{const a=e.data.model.groups[t];d=e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL?e.getYAxisCoordinate(parseInt(t),!1):e.getXAxisCoordinate(parseInt(t),!1),u&&(d-=p/2);const l=new i.DrawableRectangle({position:new s.Vector2D(-(e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL?0:e.margins.left),-e.margins.top),size:new s.Vector2D(e.chartWidth+(e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL?0:e.margins.left)+e.margins.right,e.chartHeight+(e.options.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL?e.margins.top:200)),isClippingMask:!0,style:{fillStyle:new i.Color(new s.Vector4D(0,0,0,0))},additionalData:{barCodes:[]}});if(l.children=u?function(e,t,a,l){const{items:d,total:h}=t;0===h&&(l=0);let u=Object.keys(d);const p=l;let g,m;if(e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL){if(e.options.renderConfig.stacking_mode===n.BartChartStackingMode.STACK){const t=e.getXAxisCoordinate(e.data.model.biggestGroupTotal)-e.getXAxisCoordinate(0);g=t*(h/e.data.model.biggestGroupTotal)}else g=e.chartWidth;m=1}else{if(e.options.renderConfig.stacking_mode===n.BartChartStackingMode.STACK){const t=e.getYAxisCoordinate(0)-e.getYAxisCoordinate(e.data.model.biggestGroupTotal);g=t*(h/e.data.model.biggestGroupTotal)}else g=e.chartHeight;m=e.getYAxisCoordinate(0)-g}return e.options.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL&&(u=[...u].reverse()),u.map(l=>{const _=d[l],f=new s.Vector2D(0,0),y=new s.Vector2D(0,0);let b=g*(_.value/h);isNaN(b)&&(b=g/u.length),e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL?(f.x=m,f.y=a,y.x=b,y.y=p):(f.x=a,f.y=m,y.x=p,y.y=b),m+=b;const E=_.color.clone();return e.options.dashedLines&&(E.a*=.6),new(r.InteractionShapeMixin(i.DrawableRectangle))({shapeModifier(e){if(void 0===this.clonedShape||this.oldHeight!==e.height||this.oldWidth!==e.width||this.clonedShape.position.x!==e.position.x||this.clonedShape.position.y!==e.position.y){this.oldHeight=e.height,this.oldWidth=e.width,this.clonedShape=e.clone();const t=this.clonedShape.width<0,i=this.clonedShape.height<0;if(Math.abs(this.clonedShape.width)<=2){const e=this.clonedShape.width;this.clonedShape.width=t?-3:3,this.clonedShape.position.x-=this.clonedShape.width-e}if(Math.abs(this.clonedShape.height)<=2){const e=this.clonedShape.height;this.clonedShape.height=i?-3:3,this.clonedShape.position.y-=this.clonedShape.height-e}}return this.clonedShape},position:f,size:y,inheritParentPosition:!1,isClippingMask:!0,children:c(e,y,t,_),style:{fillStyle:E,opacity:1,lineWidth:e.options.dashedLines?2:0,lineDash:e.options.dashedLines?[3]:void 0,strokeStyle:E.clone().darken(.5)},additionalData:{model:_,popoverCorner:o(e,_,t.total)}})})}(e,a,d,p):function(e,t,a,l){const{items:d}=t,h=Object.keys(d),u=l/h.length;return h.map((h,p)=>{const g=d[h],m=new s.Vector2D(0,0),_=new s.Vector2D(0,0),f=g.value;e.options.renderConfig.orientation_mode===n.BarChartOrientation.HORIZONTAL?(m.x=1,m.y=a+u*p-l/2,_.x=Math.max(1,e.getXAxisCoordinate(f)),_.y=u):(m.x=a+u*p-l/2,m.y=Math.ceil(e.getYAxisCoordinate(f)),_.x=u,_.y=Math.ceil(e.getYAxisCoordinate(0)-Math.ceil(e.getYAxisCoordinate(f))),_.y<1&&(m.y-=1,_.y+=1));const y=g.color.clone();return e.options.dashedLines&&(y.a*=.6),new(r.InteractionShapeMixin(i.DrawableRectangle))({shapeModifier(e){if(void 0===this.clonedShape||this.oldHeight!==e.height||this.oldWidth!==e.width||this.clonedShape.position.x!==e.position.x||this.clonedShape.position.y!==e.position.y){this.oldHeight=e.height,this.oldWidth=e.width,this.clonedShape=e.clone();const t=this.clonedShape.width<0,i=this.clonedShape.height<0;if(Math.abs(this.clonedShape.width)<=2){const e=this.clonedShape.width;this.clonedShape.width=t?-3:3,this.clonedShape.position.x-=this.clonedShape.width-e}if(Math.abs(this.clonedShape.height)<=2){const e=this.clonedShape.height;this.clonedShape.height=i?-3:3,this.clonedShape.position.y-=this.clonedShape.height-e}}return this.clonedShape},position:m,size:_,children:c(e,_,t,g),inheritParentPosition:!1,isClippingMask:!0,style:{fillStyle:y,lineDash:e.options.dashedLines?[3]:void 0,opacity:1,lineWidth:e.options.dashedLines?1:0,strokeStyle:y.clone().darken(.5)},additionalData:{model:g,popoverCorner:o(e,g,t.total)}})})}(e,a,d,p),e.options.renderConfig.orientation_mode!==n.BarChartOrientation.HORIZONTAL&&"h1"!==e.data.model.timeInterval&&(l.height=Math.max(...l.children.map(e=>e.position.y+e.height))-Math.min(...l.children.map(e=>e.position.y))+10,l.width=Math.max(...l.children.map(e=>e.position.x+e.width))-Math.min(...l.children.map(e=>e.position.x))+20,l.position.x=Math.min(...l.children.map(e=>e.position.x)),l.position.y-=10),l.children.forEach(e=>l.additionalData.barCodes.push(e.additionalData.model.color.toHex6())),h&&l.children.find(e=>void 0!==e.children&&void 0!==e.children[0]&&e.children[0].styleData.opacity>0))for(const e of l.children)if(void 0!==e.children&&void 0!==e.children[0]&&e.children[0].styleData.opacity>0){h=!1;break}e.barGroups[t]=l}),h&&e.options.renderConfig.orientation_mode===n.BarChartOrientation.VERTICAL&&t.forEach(t=>{e.barGroups[t].children.forEach(e=>{if(e.children&&e.children.length>0){const t=e.children[0],{width:i,height:n}=e;!function(e,t,i){let n=!1;for(e.size=Math.min(Math.floor(.8*t),a);e.size>=l;){if(e.width<.8*i&&e.size<.8*t){n=!0;break}e.size-=1}e.size>=l&&n&&(e.styleData.rotationAngle=s.trigonometryUtils.degreesToRadians(-90),e.styleData.opacity=1)}(t,i,n)}})}),e}}),define("classes/bar_chart_chart",["require","exports","abstract_canvas_chart","math_utils","object_pool","xstream","classes/bar_chart_helpers","classes/bar_chart_render_config","graphics_utilities"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BAR_CHART_LAYER_TYPE=Object.assign({},i.CANVAS_GRID_CHART_LAYER_TYPE,{BARS:"BARS"});const c=new n.Pool({initialSize:0,dynamic:!0,factory:()=>s.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_line_chart"});var d;!function(e){e.NORMAL="NORMAL",e.FADED="FADED",e.HOVERED="HOVERED",e.HIGHLIGHTED="HIGHLIGHTED"}(d||(d={}));const h=1e3;t.BarChart=class extends i.CanvasGridChart{constructor(e,s){super(e,Object.assign({},s,{layers:t.BAR_CHART_LAYER_TYPE,layerConfigs:{[t.BAR_CHART_LAYER_TYPE.BARS]:{enableInteractions:!0}}})),this.legendMouseClicked=!1,this.bars=[],void 0===this.options.labelSettings&&(this.options.labelSettings={showLabel:!1,showResults:!0});const n=this.options.mediatorStream.subscribe(i.CanvasChartUtils.createStreamListener(e=>{switch(e.type){case"LEGEND_MOUSECLICK":const t=e.message;this.legendMouseClicked&&this.legendMouseClickedId===t?this.resetLineClickedStates():(this.legendMouseClickedId=t,this.legendMouseClicked=!0,this.toggleBarHightlight(e.message,!0));break;case"LEGEND_MOUSEENTER":this.legendMouseClicked||this.toggleBarHightlight(e.message,!0);break;case"LEGEND_MOUSELEAVE":this.legendMouseClicked||this.toggleBarHightlight("")}}));this.disposeToken.addCleanupFunction(()=>{n.unsubscribe()})}resetLineClickedStates(){this.toggleBarHightlight(""),this.legendMouseClickedId=void 0,this.legendMouseClicked=!1}toggleBarHightlight(e,i=!1){this.bars.forEach(s=>{s.additionalData.model.rowCode!==e?this.toggleDrawableAnimationState(s,i?d.FADED:d.NORMAL,!0):(this.putDrawableOnTop(t.BAR_CHART_LAYER_TYPE.BARS,s),this.toggleDrawableAnimationState(s,d.HIGHLIGHTED,!0))}),this.animate()}initialize(){let e={},s=0;return r.Stream.createWithMemory({start:n=>{this.dataStream.map(e=>{this.resetLineClickedStates();const t=s!==e.model.checkSum;return s=e.model.checkSum,{animationDuration:this.options.initialAnimationDuration,options:this.options,chartWidth:this.chartSize.x,chartHeight:this.chartSize.y,widgetID:e.model.id,vectorPool:c,modelChanged:t,translateValueToY:this.translateValueToY.bind(this),translateValueToX:this.translateValueToX.bind(this),getYAxisCoordinate:this.getYAxisCoordinate.bind(this),getXAxisCoordinate:this.getXAxisCoordinate.bind(this),buildId:_.uniqueId(),barGroups:{},margins:this.margins,data:e}}).map(o.createBars).subscribe(i.CanvasChartUtils.createStreamListener(async i=>{await this.clearDrawables(t.BAR_CHART_LAYER_TYPE.BARS);const s=Object.keys(i.barGroups),r=0===Object.keys(e).length&&this.options.initialAnimationEnabled&&this.options.initialAnimationDuration>0;this.bars=[];const o=this.createGroupsWrapper();let l=0;const c=i.data.model.grid.range.min<0;s.forEach(t=>{const s=i.barGroups[t];s.position.y+=l,i.options.renderConfig.orientation_mode===a.BarChartOrientation.HORIZONTAL||"h1"===i.data.model.timeInterval||c||(l+=s.height),c&&i.options.renderConfig.orientation_mode!==a.BarChartOrientation.HORIZONTAL&&(s.position.y=0,s.height=i.chartHeight+2*i.margins.top),o.children.push(s),this.transitionBars(i,s,e[t]),s.children.forEach(e=>{this.processBars(i,e,n)}),s.children.forEach(e=>this.bars.push(e))}),i.options.renderConfig.orientation_mode!==a.BarChartOrientation.HORIZONTAL&&"h1"!==i.data.model.timeInterval&&o.children.forEach(e=>{e.height+=2*l+5}),this.createGroupsWrapperAnimations(i,o,r,l),this.addDrawable(t.BAR_CHART_LAYER_TYPE.BARS,o),this.afterUpdate.fire(),e=i.barGroups}))},stop:()=>{}})}createGroupsWrapperAnimations(e,t,i,s){if(e.data.model.grid.range.min<0)i&&(t.position.y=e.getYAxisCoordinate(0,!1),t.height=0,this.tweenDrawable(t,"position.y",-e.margins.top,this.initialAnimationDuration),this.tweenDrawable(t,"height",e.chartHeight+2*e.margins.top,this.initialAnimationDuration));else if(e.options.renderConfig.orientation_mode!==a.BarChartOrientation.HORIZONTAL){0===s&&(s=this.chartSize.y);const e=s;t.height=e+1;const n=this.chartSize.y,r=this.chartSize.y-e;i?(t.position.y=n,this.tweenDrawable(t,"position.y",r,this.initialAnimationDuration)):t.position.y=r,this.hasReplayEnabled&&this.addReplayStates(t,"position.y",[n,r])}else{t.width=this.chartSize.x+20;const e=-this.chartSize.x-10,s=0;i?(t.position.x=e,this.tweenDrawable(t,"position.x",s,this.initialAnimationDuration)):t.position.x=s,this.hasReplayEnabled&&this.addReplayStates(t,"position.x",[e,s])}}createGroupsWrapper(){return new l.DrawableRectangle({position:new s.Vector2D(-10,-this.margins.top),size:new s.Vector2D(this.chartSize.x+this.margins.left+20,this.chartSize.y+2*this.margins.top),style:{fillStyle:"rgba(0,0,0,0)"},isClippingMask:!0,children:[]})}addBarAnimationStates(e){const t=e.styleData.strokeStyle.clone().lighten(1).setOpacity(.7).setSaturation(.6);this.addDrawableAnimationStates(e,{[d.NORMAL]:[{path:"styleData.lineWidth",value:0,duration:100},{path:"styleData.opacity",value:1,duration:100}],[d.HIGHLIGHTED]:[{path:"styleData.strokeStyle",value:t,duration:100},{path:"styleData.lineWidth",value:10,duration:100},{path:"styleData.opacity",value:1,duration:100}],[d.HOVERED]:[{path:"styleData.strokeStyle",value:e.styleData.strokeStyle.clone(),duration:100},{path:"styleData.lineWidth",value:10,duration:100},{path:"styleData.opacity",value:1,duration:100}],[d.FADED]:[{path:"styleData.lineWidth",value:0,duration:100},{path:"styleData.opacity",value:.2,duration:100}]})}addBarMouseEvents(e,s,n){const{popoverHeader:r,color:o,cellLabel:a,popoverDisplayValue:l,popoverValueLabel:c,rowCode:h,filters:u,requestedPageType:p,drillDownEnabled:g}=s.additionalData.model;s.on("mouseenter",u=>{if((!this.legendMouseClicked||this.legendMouseClickedId===s.additionalData.model.rowCode)&&0!==s.width&&0!==s.height){this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER);const p=$(u.target).offset(),g=p.left+s.position.x+this.margins.left-1+s.width/2,m=p.top+s.position.y+this.margins.top;this.openPopover(g,m,{header:r,corner:s.additionalData.popoverCorner,node:{color:o.toHex8(),label:a},values:[{value:"string"==typeof l?parseInt(l):l,formatted_value:"string"==typeof l?l:e.options.numberFormatter.toDecimal(l),label:isNaN(parseInt(c))?c:""}]}),this.legendMouseClicked||(this.putDrawableOnTop(t.BAR_CHART_LAYER_TYPE.BARS,s),this.bars.forEach(e=>{e!==s&&this.toggleDrawableAnimationState(e,d.NORMAL,!0)}),this.toggleDrawableAnimationState(s,d.HOVERED),n.next({type:"WIDGET_MOUSEENTER",message:h}))}}),s.on("mouseleave",()=>{this.closePopover(),this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),this.legendMouseClicked||(this.toggleDrawableAnimationState(s,d.NORMAL),n.next({type:"WIDGET_MOUSELEAVE",message:h}))}),s.on("mouseup",t=>{this.legendMouseClicked&&this.legendMouseClickedId!==s.additionalData.model.rowCode||this.options.isClickable&&g&&(t.preventDefault(),this.openDrilldown(e.widgetID,u,t.target,p))})}processBars(e,t,i){this.addBarAnimationStates(t),t.additionalData.model.isCutOff||this.addBarMouseEvents(e,t,i)}transitionBars(e,i,s){e.modelChanged&&void 0!==s&&(i.children.forEach(i=>{if(s.additionalData.barCodes.indexOf(i.additionalData.model.color.toHex6())>-1){const e=s.children.find(({additionalData:e})=>e.model.color.toHex6()===i.additionalData.model.color.toHex6());this.transitionBar(i,e.width,e.height,e.position.x,e.position.y);const n=i.children[0],r=e.children[0];let o=!0;if(void 0!==n)if(r&&r.text===n.text){const e=n.styleData.opacity,t=n.position.x,i=n.position.y,s=n.size;n.position.x=r.position.x,n.size=r.size,n.position.y=r.position.y,n.styleData.opacity=r.styleData.opacity,this.tweenDrawable(n,"styleData.opacity",e,h),this.tweenDrawable(n,"position.x",t,h),this.tweenDrawable(n,"position.y",i,h),this.tweenDrawable(n,"size",s,h),o=!1}else{const e=n.styleData.opacity;n.styleData.opacity=0,this.tweenDrawable(n,"styleData.opacity",e,h)}void 0!==r&&o&&(e.children.length=0,i.children.push(r),this.tweenDrawable(r,"styleData.opacity",0,h,0,{onDone:()=>{this.clearDrawable(t.BAR_CHART_LAYER_TYPE.BARS,r),i.children.splice(i.children.indexOf(r),1)}}))}else if(e.options.renderConfig.orientation_mode===a.BarChartOrientation.HORIZONTAL){const e=i.width;i.width=0,this.tweenDrawable(i,"width",e,h)}else{const e=i.position.y;i.position.y+=i.height,this.tweenDrawable(i,"position.y",e,h)}}),s.children=s.children.filter(s=>-1!==i.additionalData.barCodes.indexOf(s.additionalData.model.color.toHex6())||(s.cancelAll(),e.options.renderConfig.orientation_mode===a.BarChartOrientation.HORIZONTAL?this.tweenDrawable(s,"width",0,h,0,{onDone:()=>{this.clearDrawable(t.BAR_CHART_LAYER_TYPE.BARS,s),i.children.splice(i.children.indexOf(s),1)}}):(this.tweenDrawable(s,"height",0,h),this.tweenDrawable(s,"position.y",s.position.y+s.height,h,0,{onDone:()=>{this.clearDrawable(t.BAR_CHART_LAYER_TYPE.BARS,s),i.children.splice(i.children.indexOf(s),1)}})),!1)))}transitionBar(e,t,i,s,n){const r=e.position.y,o=e.position.x,a=e.width,l=e.height;e.position.x=s,e.position.y=n,e.width=t,e.height=i,this.tweenDrawable(e,"position.y",r,h),this.tweenDrawable(e,"position.x",o,h),this.tweenDrawable(e,"width",a,h),this.tweenDrawable(e,"height",l,h)}dispose(){super.dispose()}}}),define("bar_chart",["require","exports","classes/bar_chart_chart","classes/bar_chart_render_config"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("types/widget_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/block_based_widget_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("containers/interfaces/block_based_widget_container_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("controllers/interfaces/block_based_widget_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("containers/block_based_widget_container",["require","exports","event_bus","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockBasedWidgetContainer=class extends s.BaseComponent{constructor(e){super(e),this.controller=this.props.controller,this.state={payload:this.controller.payload,settings:this.controller.buildSettings(this.props.settings)}}componentDidMount(){this.controller.setupListeners(),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.BLOCK_BASED_WIDGET_SHOULD_UPDATE,this.update.bind(this))}componentWillUnmount(){super.componentWillUnmount(),this.controller.dispose(),this.cancellationToken.cancel()}render(){const e=this.getClassNames();return n.createElement("div",{className:e,ref:e=>{this.container=e}},this.renderWidget())}async checkLoadMore(){const e=this.controller;e.canLoadMore()&&await e.loadMore(this.getLoadedUnitIds())}update(){this.setState({payload:this.controller.payload,settings:this.controller.buildSettings(this.props.settings)})}}}),define("containers/interfaces/block_based_widget_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("factories/interfaces/list_item_configuration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("factories/types/any_block_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("factories/blocks_factory",["require","exports","react","reusable_components","reusable_services"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static create(e,t,i,n={}){if(n.canShowImage=!!_.isUndefined(n.canShowImage)||n.canShowImage,n.widgetId=i,!n.canShowImage||_.isUndefined(t)||_.isNull(t)||_.isArray(t)&&0===t.length)return null;switch(_.isArray(t)||(t=[t]),e){default:case s.BlockTypes.TEXT:return r.createTextBlock(t,n);case s.BlockTypes.IMAGE:return r.createImageBlock(t,n);case s.BlockTypes.ICON:return r.createIconBlock(t,n)}}static shouldShowURL(e){const t=e.model,i=t&&t.click_action;return!_.isUndefined(i)&&_.contains([s.ClickActionTypes.OPEN_URL,s.ClickActionTypes.OPEN_URL_AND_SET_READ,s.ClickActionTypes.OPEN_CONTEXT_PAGE],i.action)}static addBlockAsListItem(e,t,s){const r=t&&t.model;if(r){const t=i.createFactory(s.blockType);if(s.parseEmoji){const e=r;"string"==typeof e.text&&(e.text=n.emojiService.parseTextForEmoji(e.text,!0))}e.push(i.createElement("li",{key:s.key,className:s.listClasses,style:s.listStyle},t(_.assign({className:s.blockClasses,style:s.blockStyle},r))))}}static parseEmojisInBlock(e){if(e&&e.model){const t=e.model;void 0!==t.text&&(t.text=n.emojiService.parseTextForEmoji(t.text,!0)),void 0!==t.alt_text&&(t.alt_text=n.emojiService.parseTextForEmoji(t.alt_text,!0))}}static createTextBlock(e,t){return e.map(e=>new s.TextBlock(e,t))}static createImageBlock(e,t){return e.map(e=>new s.ImageBlock(e,t))}static createIconBlock(e,t){return e.map(e=>new s.IconBlock(e,t))}}t.BlocksFactory=r}),define("factories/block_based_widget_layout_factory",["require","exports","reusable_components","factories/blocks_factory"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockBasedWidgetLayoutFactory=class{static createMetrics(e,t,n){return Object.assign({},e,{flags:s.BlocksFactory.create(i.BlockTypes.TEXT,e.flags,e.widgetId,{isTranslated:!!n})})}static createRatios(e,t){return Object.assign({},e)}}}),define("layouts/types/render_element",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/units/interfaces/unit_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_layout_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_avatar_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_icon_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_location_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_subtitle_component",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_tags_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_text_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/interfaces/unit_title_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/unit_avatar_component",["require","exports","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static getFallbackImageFactory(){return i.createFactory.bind(i,s.AvatarFallbackImageRenderable)}static createImageBlockNoFallback(e,t){const{avatarBlocks:n}=e;if(!n)return null;const r=n[0];return i.createElement(s.ImageBlockRenderable,Object.assign({},r.model,{className:t}))}static createAvatarOnlyErrorFallback(e,t,o){const{avatarBlocks:a}=e,l=r.getFallbackImageFactory();if(a&&a[0]){const e=a[0];let r=t;return void 0!==o.errorFallbackClickable&&o.errorFallbackClickable&&(r+=" clickable"),i.createElement(s.ImageBlockRenderable,Object.assign({},e.model,{show_url:n.BlocksFactory.shouldShowURL(e),className:t,errorTag:l(),errorClass:r}))}return null}static createInitialsAvatar(e,t){return i.createElement(s.InitialsComponentRenderable,Object.assign({},e))}}t.UnitAvatarComponent=r}),define("renderables/components/unit_icon_component",["require","exports","react","reusable_components"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitIconComponent=class{static createIcons(e,t){const n=e.iconBlocks;return n?n.map(e=>i.createElement(s.ImageBlockRenderable,Object.assign({},e.model,{className:t}))):void 0}}}),define("renderables/components/unit_layout_component",["require","exports","event_bus","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitLayoutComponent=class{render(e){const t=this.generateComponent(e);return e.tooltipMessage?s.createElement("div",{onMouseEnter:t=>{this.openTooltip(t,e.tooltipMessage)},onMouseLeave:this.closeTooltip.bind(this)},t):t}openTooltip(e,t){i.eventBus.dispatch({type:i.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){i.eventBus.dispatch({type:i.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}}}),define("renderables/components/unit_location_component",["require","exports","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitLocationComponent=class{static createTextLocation(e,t){const r=e.locationBlocks[0];return r?(n.BlocksFactory.parseEmojisInBlock(r),i.createElement(s.TextBlockRenderable,Object.assign({},r.model,{className:t}))):null}}}),define("renderables/components/unit_subtitle_component",["require","exports","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitSubtitleComponent=class{static createHandle(e,t){const r=e.subtitleBlocks;if(r){const e=r[0];return n.BlocksFactory.parseEmojisInBlock(e),i.createElement("div",{className:t},i.createElement(s.TextBlockRenderable,Object.assign({},e.model,{key:"handle"})))}}}}),define("renderables/components/unit_tags_component",["require","exports","react","event_bus"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static createInfluencerStyleTag(e,t){return e.tags&&e.tags[0]?i.createElement("div",{className:t},e.tags.map(t=>i.createElement("div",{className:"influencer-style-tag",key:t.code},t.name,e.removable?i.createElement("i",{className:"fa fa-times",onClick:()=>n.handleRemoval(t,e.unitId,e.widgetId)}):void 0))):void 0}static handleRemoval(e,t,i){s.eventBus.dispatch({type:s.EVENT_TYPES.REMOVE_TAG,value:{tag:e,unitId:t,widgetId:i}})}}t.UnitTagsComponent=n}),define("renderables/components/unit_text_component",["require","exports","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitTextComponent=class{static createNormalText(e,t,r=!1){const o=e.textBlocks[0];return o?(n.BlocksFactory.parseEmojisInBlock(o),i.createElement(s.TextBlockRenderable,Object.assign({},o.model,{limitSize:r,className:t}))):null}static createTextWithDescription(e,t,r=!1){const o=e.textBlocks,a=o[0],l=o[1];return a&&l?(n.BlocksFactory.parseEmojisInBlock(a),n.BlocksFactory.parseEmojisInBlock(l),i.createElement("span",{className:t.wholeTextClassName},i.createElement(s.TextBlockRenderable,Object.assign({},a.model,{className:t.descriptionClassName}))," ",i.createElement(s.TextBlockRenderable,Object.assign({},l.model)))):void 0}}}),define("renderables/components/unit_title_component",["require","exports","classnames","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{static createSingleLineTitleAsSpan(e,t,i=!0){const{titleBlocks:a}=e;if(a){const e=a[0];return r.BlocksFactory.parseEmojisInBlock(e),s.createElement("span",{className:o.getSingleLineTitleAsSpanClassNames(i,t)},s.createElement(n.TextBlockRenderable,Object.assign({},e.model)))}return null}static getSingleLineTitleAsSpanClassNames(e,t){return i({"limit-size":e,[t]:!0})}}t.UnitTitleComponent=o}),define("renderables/interfaces/no_more_to_load_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/interfaces/unit_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/no_more_to_load_component",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NoMoreToLoadComponent=class extends s.BaseComponent{render(){return this.props.shouldDisplay?i.createElement("div",{className:"no-more-to-load-container"},i.createElement("div",{className:"no-more-to-load-separator left-separator"}),i.createElement("div",{className:"no-more-to-load-message"}," ",this.props.message),i.createElement("div",{className:"no-more-to-load-separator right-separator"})):i.createElement("div",null)}}}),define("renderables/options_menu/unit_options_menu_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/options_menu/unit_options_menu_renderable",["require","exports","classnames","event_bus","flux","react","reusable_components","factories/blocks_factory"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnitOptionsMenuRenderable=class extends n.BaseComponent{render(){const e=this.props.options;return r.createElement("div",{className:this.getContainerClassNames()},this.generateCheckbox(),e.map(e=>this.renderOption(e)),this.renderSpecificParts())}generateCheckbox(){if(this.props.showCheckbox){this.updateFields();const e=this.checked?this.generateCheckedCheckboxModel():this.generateUncheckedCheckboxModel();return r.createElement("div",{className:"unit-selection-checkbox-container"},r.createElement(o.StateButtonComponent,{toggleCallback:this.toggleSelection.bind(this),model:e,customClasses:{input:"unit-selection-checkbox"},type:o.StateButtonType.CHECKBOX}))}}generateCheckedCheckboxModel(){return{stateButtonState:o.StateButtonState.CHECKED,tooltipMessage:this.getSelectMessage()}}generateUncheckedCheckboxModel(){return{stateButtonState:o.StateButtonState.UNCHECKED,tooltipMessage:this.getUnselectMessage()}}updateFields(){this.checkedFromPreviousRender!==this.props.unitSelected&&(this.checked=this.props.unitSelected),this.checkedFromPreviousRender=this.checked}toggleSelection(e){const{unitId:t,widgetId:i}=this.props;this.checked=!this.checked,s.eventBus.dispatch({type:s.EVENT_TYPES.TOGGLE_UNIT_SELECTION,value:{widgetId:i,toBeToggledUnitId:t}}),this.forceUpdate()}renderOption(e){const t=a.BlocksFactory.create(o.BlockTypes.TEXT,e,this.props.widgetId);return t&&t[0]?r.createElement(o.TextBlockRenderable,Object.assign({},t[0].model,{key:e.icon,className:"pull-right unit-option",onMouseEnter:t=>this.openOptionTooltip(t,this.constructOptionTooltipMessage(e)),onMouseLeave:()=>this.closeOptionTooltip()})):void 0}constructOptionTooltipMessage(e){return e.tooltip_message}openOptionTooltip(e,t){void 0!==t&&s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeOptionTooltip(){s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}getContainerClassNames(){return i({"unit-options-menu":!0})}}}),define("renderables/selection_options/selection_options_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/selection_options/selection_options_container_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/selection_options/selection_options_container",["require","exports","flux","react","event_bus","reusable_components"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SelectionOptionsContainer=class extends i.BaseComponent{render(){return s.createElement("div",{className:"block-based-widget-selection-options"},s.createElement(r.StateButtonComponent,{model:this.generateStateButtonModel(),toggleCallback:this.toggleCallback.bind(this),type:r.StateButtonType.CHECKBOX,showContainer:!0}),this.renderSave(),this.renderNumberOfUnits())}generateStateButtonModel(){const{messages:e,selectionCheckboxState:t}=this.props;switch(t){case r.StateButtonState.CHECKED:return{stateButtonState:t,label:e.selectAll,tooltipMessage:e.unselectAllTooltip};case r.StateButtonState.INDETERMINATE:return{stateButtonState:t,label:e.selectSome,tooltipMessage:e.selectAllTooltip};case r.StateButtonState.UNCHECKED:return{stateButtonState:t,label:e.unselectAll,tooltipMessage:e.selectAllTooltip};default:throw new Error("no checkbox state")}}toggleCallback(){n.eventBus.dispatch({type:n.EVENT_TYPES.TOGGLE_ALL_SELECTION,value:this.props.widgetId})}renderSave(){if(this.props.saveOption&&this.props.selectionCheckboxState!==r.StateButtonState.UNCHECKED){const{icon:e,tooltipMessage:t}=this.props.saveOption;return s.createElement("div",{className:`save-option ${e}`,onClick:this.handleSaveOptionClick.bind(this),onMouseEnter:e=>this.openTooltip(e,t),onMouseLeave:this.closeTooltip.bind(this)})}}handleSaveOptionClick(){n.eventBus.dispatch({type:n.EVENT_TYPES.SAVE_SELECTED_INFLUENCERS_TO_LIST,value:{fetchUrl:this.props.saveOption.url,widgetId:this.props.widgetId}})}renderNumberOfUnits(){const{numberOfUnits:e}=this.props.messages;return e?s.createElement("div",{className:"number-of-units",dangerouslySetInnerHTML:{__html:e}}):void 0}openTooltip(e,t){void 0!==t&&n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}}}),define("renderables/selection_options/unit_selection_options_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("block_based_widget",["require","exports","containers/block_based_widget_container","factories/block_based_widget_layout_factory","factories/blocks_factory","renderables/components/unit_avatar_component","renderables/components/unit_icon_component","renderables/components/unit_layout_component","renderables/components/unit_location_component","renderables/components/unit_subtitle_component","renderables/components/unit_tags_component","renderables/components/unit_text_component","renderables/components/unit_title_component","renderables/no_more_to_load_component","renderables/options_menu/unit_options_menu_renderable","renderables/selection_options/selection_options_container"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m){"use strict";function _(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),_(i),_(s),_(n),_(r),_(o),_(a),_(l),_(c),_(d),_(h),_(u),_(p),_(g),_(m)}),define("controllers/interfaces/block_influencers_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/interfaces/block_influencers_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("containers/interfaces/block_influencers_container_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/interfaces/block_influencers_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/widget/block_influencers_layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blockInfluencersLayoutTypes={INFLUENCER_MANAGEMENT_GRID:"UUID_CONFIG_INFLUENCERLIST_TILE",INFLUENCER_MANAGEMENT_LIST:"UUID_CONFIG_INFLUENCERLIST_LIST",INFLUENCER_MANAGEMENT_DETAILED:"UUID_CONFIG_INFLUENCERLIST_DETAILED",INFLUENCER_MANAGEMENT_LABELS:"UUID_CONFIG_INFLUENCERLIST_LABELS"}}),define("layouts/interfaces/influencer_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/influencers/interfaces/influencer_detailed_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/influencers/interfaces/influencer_grid_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/influencers/interfaces/influencer_list_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/interfaces/influencer_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/influencer/interfaces/detailed_layout_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/options menu/interfaces/influencer_options_menu_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/options menu/influencer_options_menu_renderable",["require","exports","block_based_widget","react","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerOptionsMenuRenderable=class extends i.UnitOptionsMenuRenderable{renderSpecificParts(){return this.renderMatchingListsIcon()}getSelectMessage(){return this.props.messages.unitSelectionOptionsMessages.selectOne}getUnselectMessage(){return this.props.messages.unitSelectionOptionsMessages.unselectOne}renderMatchingListsIcon(){return this.shouldRenderMatchingListsIcon()?s.createElement(n.TextBlockRenderable,{icon:"fa fa-info",className:"pull-right unit-matching-lists",onMouseEnter:e=>this.openOptionTooltip(e,this.constructMatchingListsMessage()),onMouseLeave:()=>this.closeOptionTooltip()}):void 0}shouldRenderMatchingListsIcon(){const{additionalInformation:e}=this.props;return void 0!==e&&void 0!==e.matchingLists&&void 0!==e.matchingLists[0]&&void 0!==this.props.messages}constructMatchingListsMessage(){const e=this.props.additionalInformation.matchingLists.map(e=>e.label);return this.props.messages.matchingListsHelpText+"\n\n"+e.join("\n")}}}),define("renderables/layouts/influencer/influencer_detailed_renderable",["require","exports","flux","progress_graph","react","renderables/options menu/influencer_options_menu_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerDetailedRenderable=class extends i.BaseComponent{render(){return n.createElement("div",{className:"block-influencer"},this.generateOptionsMenu(),this.generateLeftPart(),this.generateMiddlePart(),this.generateRightPart())}generateOptionsMenu(){const{influencer:e,layout:t}=this.props;return n.createElement(r.InfluencerOptionsMenuRenderable,{unitSelected:e.selected,widgetId:t.widgetId,additionalInformation:{matchingLists:e.matching_lists},messages:t.messages,options:e.action_links,unitId:t.entryId,showCheckbox:!1})}generateLeftPart(){return n.createElement("div",{className:"block-influencer-left-part"},this.props.layout.avatar)}generateMiddlePart(){const e=this.props.layout;return n.createElement("div",{className:"block-influencer-middle-part"},e.alias,e.name,e.bio,e.labels)}generateRightPart(){return n.createElement("div",{className:"block-influencer-right-part"},this.generateRatios()," ",this.generateMetrics())}generateRatios(){const e=this.props.layout.ratios.main_ratios[0];return n.createElement("div",{className:"block-influencer-ratios"},this.generateRatio(e))}generateRatio(e){const t=parseInt(e.value),i=parseInt(e.total_value),r=e.color,o=e.text;return n.createElement("div",{className:"block-influencer-ratio"},n.createElement("div",{className:"block-influencer-metric-label"},o),n.createElement("div",{className:"block-influencer-ratio-graph"},n.createElement(s.CircularProgressGraphComponent,{value:t,animationEnabled:!0,color:r,type:s.ProgressGraphType.FRACTION,maxValue:i})))}generateMetrics(){const{metrics:e}=this.props.layout,t=e.primary_metrics[0],i=e.primary_metrics[1],s=e.primary_metrics[2];return n.createElement("div",{className:"block-influencers-metrics"},this.generateMetric(t),this.generateMetric(i),this.generateMetric(s))}generateMetric(e){return n.createElement("div",{className:"block-influencer-metric"},n.createElement("div",{className:"block-influencer-metric-label"},e.text),n.createElement("div",{className:"block-influencer-metric-value"},e.value))}componentDidMount(){$(".block-influencers-detailed").parent().parent().parent().parent().prev().height("10px")}}}),define("renderables/layouts/influencer/interfaces/grid_layout_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/influencer/influencer_grid_renderable",["require","exports","flux","progress_graph","react","renderables/options menu/influencer_options_menu_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerGridRenderable=class extends i.BaseComponent{render(){return n.createElement("div",{className:"unit block-influencer",id:this.props.layout.entryId},this.generateOptionsMenu(),this.generateFirstRow(),this.generateSecondRow(),this.generateThirdRow())}generateOptionsMenu(){const{influencer:e,layout:t}=this.props;return n.createElement(r.InfluencerOptionsMenuRenderable,{unitSelected:e.selected,widgetId:t.widgetId,additionalInformation:{matchingLists:e.matching_lists},messages:t.messages,options:e.action_links,unitId:t.entryId,showCheckbox:!0})}generateFirstRow(){const e=this.props.layout;return n.createElement("div",{className:"unit-first-row"},e.avatar,e.alias,e.name,this.generateMainRatio(),n.createElement("div",{className:"unit-first-separator"}))}generateMainRatio(){const e=this.props.layout.ratios.main_ratios[0],t=parseInt(e.value),i=parseInt(e.total_value),r=e.color,o=e.text;return n.createElement("div",{className:"unit-main-ratio"},n.createElement(s.CircularProgressGraphComponent,{value:t,animationEnabled:!1,color:r,type:s.ProgressGraphType.FRACTION,maxValue:i}),n.createElement("div",{className:"unit-main-ratio-text"},o))}generateSecondRow(){const e=this.props.layout;return n.createElement("div",{className:"unit-second-row"},e.bio)}generateThirdRow(){const e=this.props.layout,[t,i,s]=e.metrics.primary_metrics;return n.createElement("div",{className:"unit-third-row"},this.generateMetric(t),n.createElement("div",{className:"unit-metric-box-separator"}),this.generateMetric(i),n.createElement("div",{className:"unit-metric-box-separator"}),this.generateMetric(s))}generateMetric(e){return n.createElement("div",{className:"unit-metric-box"},n.createElement("div",{className:"unit-metric-label"},n.createElement("i",{className:e.icon}),e.text),n.createElement("div",{className:"unit-metric-value"},e.value))}}}),define("renderables/layouts/influencer/interfaces/list_layout_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/influencer/influencer_list_renderable",["require","exports","flux","progress_graph","react","renderables/options menu/influencer_options_menu_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerListRenderable=class extends i.BaseComponent{render(){return n.createElement("div",{className:"block-influencer",id:this.props.influencer.influencer_id,key:this.props.influencer.influencer_id},this.generateOptionsMenu(),this.renderFirstColumn(),this.renderSecondColumn(),this.renderSeparator(),this.renderThirdColumn(),this.renderSeparator(),this.renderFourthColumn())}generateOptionsMenu(){const{influencer:e,layout:t}=this.props;return n.createElement(r.InfluencerOptionsMenuRenderable,{unitSelected:e.selected,widgetId:t.widgetId,additionalInformation:{matchingLists:e.matching_lists},messages:t.messages,options:e.action_links,unitId:t.entryId,showCheckbox:!1})}renderFirstColumn(){const e=this.props.layout;return n.createElement("div",{className:"block-influencer-first-column"},e.avatar)}renderSecondColumn(){const e=this.props.layout;return n.createElement("div",{className:"block-influencer-second-column"},e.alias,e.name,e.bio)}renderThirdColumn(){return n.createElement("div",{className:"block-influencer-third-column"},this.generateRatios()," ",this.generateMetrics())}generateRatios(){const e=this.props.layout.ratios.main_ratios[0];return n.createElement("div",{className:"block-influencer-ratios"},this.generateRatio(e))}generateRatio(e){const t=parseInt(e.value),i=parseInt(e.total_value),r=e.color,o=e.text;return n.createElement("div",{className:"block-influencer-ratio"},n.createElement("div",{className:"block-influencer-ratio-graph"},n.createElement(s.CircularProgressGraphComponent,{value:t,animationEnabled:!1,color:r,type:s.ProgressGraphType.FRACTION,maxValue:i})),n.createElement("div",{className:"block-influencer-metric-label"},o))}generateMetrics(){const e=this.props.layout.metrics.primary_metrics[0],t=this.props.layout.metrics.primary_metrics[1],i=this.props.layout.metrics.primary_metrics[2];return n.createElement("div",{className:"block-influencers-metrics"},n.createElement("div",{className:"block-influencer-metric"},n.createElement("div",{className:"block-influencer-metric-value"},e.value),n.createElement("div",{className:"block-influencer-metric-label"},e.text)),n.createElement("div",{className:"block-influencer-metric"},n.createElement("div",{className:"block-influencer-metric-value"},t.value),n.createElement("div",{className:"block-influencer-metric-label"},t.text)),n.createElement("div",{className:"block-influencer-metric"},n.createElement("div",{className:"block-influencer-metric-value"},i.value),n.createElement("div",{className:"block-influencer-metric-label"},i.text)))}renderSeparator(){return n.createElement("div",{className:"block-influencer-separator-container"},n.createElement("div",{className:"block-influencer-separator"}))}renderFourthColumn(){return n.createElement("div",{className:"block-influencer-fourth-column"},this.props.layout.labels,this.renderCurrentCampaigns())}renderCurrentCampaigns(){const e=this.props.layout.messages;if(0!==this.props.layout.additionalInformation.matchingCampaigns.length){const t=this.props.layout.additionalInformation.matchingCampaigns;return n.createElement("div",{className:"block-influencer-current-campaigns-container stylized-scrollbar"},n.createElement("div",{className:"block-influencer-current-campaigns-header"},e.currentCampaignsHeader),t.map((e,i)=>n.createElement("div",{className:"block-influencer-current-campaign",key:e.list_id},e.label,i<t.length-1&&",")))}return n.createElement("div",{key:"no-current-campaigns",className:"block-influencer-not-part-of-any-campaign"},e.noCurrentCampaigns)}}}),define("layouts/influencers/interfaces/influencer_labels_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/influencers/influencer_layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencerLayoutTypes={INFLUENCER_MANAGEMENT_GRID:"influencer_management_tile",INFLUENCER_MANAGEMENT_LIST:"influencer_management_list",INFLUENCER_MANAGEMENT_DETAILED:"influencer_management_detailed",INFLUENCER_MANAGEMENT_LABELS:"influencer_management_labels"}}),define("renderables/components/influencer_layout_component",["require","exports","block_based_widget","layouts/influencers/influencer_layout_types"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerLayoutComponent=class extends i.UnitLayoutComponent{generateComponent(e){const t=e.layout;switch(t){case s.influencerLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED:return this.renderDetailed(e);case s.influencerLayoutTypes.INFLUENCER_MANAGEMENT_GRID:return this.renderGrid(e);case s.influencerLayoutTypes.INFLUENCER_MANAGEMENT_LIST:return this.renderList(e);case s.influencerLayoutTypes.INFLUENCER_MANAGEMENT_LABELS:return this.renderLabels(e);default:throw new Error("Unknown layout type"+t)}}renderDetailed(e){}renderGrid(e){}renderList(e){}renderLabels(e){}}}),define("renderables/components/influencer_alias_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerAliasComponent=class extends s.InfluencerLayoutComponent{renderGrid(e){return i.UnitSubtitleComponent.createHandle(e,"unit-alias")}renderDetailed(e){return i.UnitSubtitleComponent.createHandle(e,"block-influencer-alias")}renderList(e){return i.UnitSubtitleComponent.createHandle(e,"block-influencer-alias")}renderLabels(e){return i.UnitSubtitleComponent.createHandle(e,"block-influencer-alias")}}}),define("renderables/components/influencer_avatar_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerAvatarComponent=class extends s.InfluencerLayoutComponent{renderGrid(e){return i.UnitAvatarComponent.createAvatarOnlyErrorFallback(e,"unit-avatar block-influencer-avatar",{errorFallbackClickable:!0})}renderDetailed(e){return i.UnitAvatarComponent.createAvatarOnlyErrorFallback(e,"block-influencer-avatar",{errorFallbackClickable:!1})}renderList(e){return i.UnitAvatarComponent.createAvatarOnlyErrorFallback(e,"block-influencer-avatar",{errorFallbackClickable:!0})}renderLabels(e){return i.UnitAvatarComponent.createAvatarOnlyErrorFallback(e,"block-influencer-avatar",{errorFallbackClickable:!0})}}}),define("renderables/components/influencer_bio_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerBioComponent=class extends s.InfluencerLayoutComponent{renderGrid(e){return i.UnitTextComponent.createTextWithDescription(e,{descriptionClassName:"unit-bio-description",wholeTextClassName:"unit-bio"})}renderDetailed(e){return i.UnitTextComponent.createTextWithDescription(e,{descriptionClassName:"block-influencer-bio-description",wholeTextClassName:"block-influencer-bio"})}renderList(e){return i.UnitTextComponent.createTextWithDescription(e,{descriptionClassName:"block-influencer-bio-description",wholeTextClassName:"block-influencer-bio"})}renderLabels(e){return i.UnitTextComponent.createTextWithDescription(e,{descriptionClassName:"block-influencer-bio-description",wholeTextClassName:"block-influencer-bio"})}}}),define("renderables/components/influencer_location_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerLocationComponent=class extends s.InfluencerLayoutComponent{renderDetailed(e){return i.UnitLocationComponent.createTextLocation(e,"block-influencer-location")}renderList(e){return i.UnitLocationComponent.createTextLocation(e,"block-influencer-location")}}}),define("renderables/components/influencer_name_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNameComponent=class extends s.InfluencerLayoutComponent{renderGrid(e){return i.UnitTitleComponent.createSingleLineTitleAsSpan(e,"unit-name",!1)}renderDetailed(e){return i.UnitTitleComponent.createSingleLineTitleAsSpan(e,"block-influencer-name",!1)}renderList(e){return i.UnitTitleComponent.createSingleLineTitleAsSpan(e,"block-influencer-name",!1)}renderLabels(e){return i.UnitTitleComponent.createSingleLineTitleAsSpan(e,"block-influencer-name",!1)}}}),define("renderables/components/influencer_tags_component",["require","exports","block_based_widget","renderables/components/influencer_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerTagsComponent=class extends s.InfluencerLayoutComponent{renderDetailed(e){return i.UnitTagsComponent.createInfluencerStyleTag(e,"influencer-tags block-based-widget-tags")}renderList(e){return i.UnitTagsComponent.createInfluencerStyleTag(e,"influencer-tags block-based-widget-tags")}renderLabels(e){return i.UnitTagsComponent.createInfluencerStyleTag(e,"influencer-tags block-based-widget-tags")}}}),define("factories/influencer_component_factory",["require","exports","renderables/components/influencer_alias_component","renderables/components/influencer_avatar_component","renderables/components/influencer_bio_component","renderables/components/influencer_location_component","renderables/components/influencer_name_component","renderables/components/influencer_tags_component"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerComponentFactory=class{static createAvatar(e,t,i){return(new s.InfluencerAvatarComponent).render({layout:e,avatarBlocks:t,tooltipMessage:i})}static createBio(e,t){return null!==t?(new n.InfluencerBioComponent).render({layout:e,textBlocks:t}):void 0}static createAlias(e,t){return null!==t?(new i.InfluencerAliasComponent).render({layout:e,subtitleBlocks:t}):void 0}static createName(e,t){return null!==t?(new o.InfluencerNameComponent).render({layout:e,titleBlocks:t,subtitleBlocks:void 0}):void 0}static createLocation(e,t){return null!==t?(new r.InfluencerLocationComponent).render({layout:e,locationBlocks:t}):void 0}static createTags(e){return(new a.InfluencerTagsComponent).render(e)}}}),define("factories/influencer_layout_factory",["require","exports","block_based_widget","reusable_components","factories/influencer_component_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static createGridLayout(e,t,r,o){return{widgetId:t,entryId:e.influencer_id,messages:r,size:o.size,drilldownPageType:e.drilldown_page_type,avatar:n.InfluencerComponentFactory.createAvatar(e.layout,i.BlocksFactory.create(s.BlockTypes.IMAGE,e.avatar,t),o.messages.avatarTooltip),alias:n.InfluencerComponentFactory.createAlias(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.alias,t)),bio:n.InfluencerComponentFactory.createBio(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.bio,t)),name:n.InfluencerComponentFactory.createName(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.name,t)),metrics:i.BlockBasedWidgetLayoutFactory.createMetrics(JSON.parse(JSON.stringify(e)),t),ratios:i.BlockBasedWidgetLayoutFactory.createRatios(JSON.parse(JSON.stringify(e)),t)}}static createListLayout(e,t,r,o){return{widgetId:t,entryId:e.influencer_id,messages:r,size:o.size,drilldownPageType:e.drilldown_page_type,name:n.InfluencerComponentFactory.createName(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.name,t)),bio:n.InfluencerComponentFactory.createBio(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.bio,t)),avatar:n.InfluencerComponentFactory.createAvatar(e.layout,i.BlocksFactory.create(s.BlockTypes.IMAGE,e.avatar,t),o.messages.avatarTooltip),alias:n.InfluencerComponentFactory.createAlias(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.alias,t)),labels:n.InfluencerComponentFactory.createTags({layout:e.layout,tags:e.labels,removable:!1,unitId:e.influencer_id,widgetId:t}),additionalInformation:this.createAdditionalInformation(e,t),ratios:i.BlockBasedWidgetLayoutFactory.createRatios(JSON.parse(JSON.stringify(e)),t),metrics:i.BlockBasedWidgetLayoutFactory.createMetrics(JSON.parse(JSON.stringify(e)),t)}}static createDetailedLayout(e,t,r,o){return{widgetId:t,entryId:e.influencer_id,messages:r,size:o.size,alias:n.InfluencerComponentFactory.createAlias(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.alias,t)),name:n.InfluencerComponentFactory.createName(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.name,t)),bio:n.InfluencerComponentFactory.createBio(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.bio,t)),avatar:n.InfluencerComponentFactory.createAvatar(e.layout,i.BlocksFactory.create(s.BlockTypes.IMAGE,e.avatar,t)),labels:n.InfluencerComponentFactory.createTags({layout:e.layout,tags:e.labels,removable:!1,unitId:e.influencer_id,widgetId:t}),ratios:i.BlockBasedWidgetLayoutFactory.createRatios(JSON.parse(JSON.stringify(e)),t),metrics:i.BlockBasedWidgetLayoutFactory.createMetrics(JSON.parse(JSON.stringify(e)),t)}}static createLabelsLayout(e,t,o,a){return{widgetId:t,entryId:e.influencer_id,messages:o,size:a.size,alias:n.InfluencerComponentFactory.createAlias(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.alias,t)),name:n.InfluencerComponentFactory.createName(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.name,t)),bio:n.InfluencerComponentFactory.createBio(e.layout,i.BlocksFactory.create(s.BlockTypes.TEXT,e.bio,t)),avatar:n.InfluencerComponentFactory.createAvatar(e.layout,i.BlocksFactory.create(s.BlockTypes.IMAGE,e.avatar,t)),labels:n.InfluencerComponentFactory.createTags({layout:e.layout,tags:e.labels,removable:!0,unitId:e.influencer_id,widgetId:t}),additionalInformation:r.createAdditionalInformation(e,t),projectLabels:a.projectLabels}}static createAdditionalInformation(e,t){return{matchingLists:e.matching_lists,matchingCampaigns:e.matching_campaigns}}}t.InfluencerLayoutFactory=r}),define("renderables/layouts/influencer/interfaces/labels_layout_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/influencer/influencer_labels_renderable",["require","exports","event_bus","flux","react","reusable_components"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=25;t.InfluencerLabelsRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state={newTagName:"",valid:!1}}render(){return n.createElement("div",{className:"block-influencer"},this.generateLeftPart(),this.generateMiddlePart(),this.generateRightPart())}generateLeftPart(){return n.createElement("div",{className:"block-influencer-left-part"},this.props.layout.avatar)}generateMiddlePart(){const e=this.props.layout;return n.createElement("div",{className:"block-influencer-middle-part"},e.alias,e.name,e.bio,this.renderMatchingLists())}renderMatchingLists(){const e=this.props.layout.messages;if(0!==this.props.layout.additionalInformation.matchingLists.length){const t=this.props.layout.additionalInformation.matchingLists;return n.createElement("div",{className:"block-influencer-matching-lists-container stylized-scrollbar"},n.createElement("div",{className:"block-influencer-matching-lists-header"},e.matchingListsHeader),t.map((e,i)=>n.createElement("div",{className:"block-influencer-matching-list",key:e.list_id},e.label,i<t.length-1&&",")))}}generateRightPart(){const e=this.props.layout;return n.createElement("div",{className:"block-influencer-right-part"},this.renderNewLabelComponent(),e.labels)}renderNewLabelComponent(){const{messages:e}=this.props.layout;return n.createElement("div",{className:"new-tag-component"},n.createElement(r.InlineTagsSuggestion,{tags:this.computeAppropriateLabels(),addCallback:this.submitNewTag.bind(this),selectSuggestionCallback:this.selectSuggestionCallback.bind(this)},n.createElement("input",{type:"text",value:this.state.newTagName||"",placeholder:e.newLabelPlaceholder,onChange:this.handleNewTagChange.bind(this),maxLength:o,autoComplete:"off",className:"input-field"}),n.createElement("i",{className:`fa fa-plus ${this.state.valid?"valid":"invalid"}`,onClick:e=>this.submitNewTag(e,this.state.newTagName)})))}computeAppropriateLabels(){const{projectLabels:e}=this.props.layout,t=this.props.influencer.labels.map(e=>e.name);return e.filter(e=>!t.includes(e.name))}handleNewTagChange(e){const t=e.target.value;this.setState({newTagName:t,valid:this.checkValidity(t)})}checkValidity(e){return!!e&&e.length<=o&&e.split(" ").join("").length>0}selectSuggestionCallback(e,t){this.submitNewTag(e,t.name)}submitNewTag(e,t){if(this.state.valid){const{widgetId:e,entryId:s}=this.props.layout;i.eventBus.dispatch({type:i.EVENT_TYPES.ADD_TAG,value:{name:t,widgetId:e,unitId:s}}),this.setState({newTagName:"",valid:this.checkValidity("")})}}componentDidMount(){$(".block-influencers-labels").parent().parent().parent().parent().prev().height("10px")}}}),define("factories/influencer_render_factory",["require","exports","react","layouts/widget/block_influencers_layout_types","renderables/layouts/influencer/influencer_detailed_renderable","renderables/layouts/influencer/influencer_grid_renderable","renderables/layouts/influencer/influencer_list_renderable","factories/influencer_layout_factory","renderables/layouts/influencer/influencer_labels_renderable"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerRenderFactory=class{static createInfluencerLayout(e){const{key:t,settings:c,influencer:d,widgetLayout:h,messages:u,widgetId:p}=e,g=JSON.parse(JSON.stringify(d));switch(h){case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID:const m=a.InfluencerLayoutFactory.createGridLayout(d,p,u,c);return i.createElement(r.InfluencerGridRenderable,{influencer:g,layout:m,key:t});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST:const _=a.InfluencerLayoutFactory.createListLayout(d,p,u,c);return i.createElement(o.InfluencerListRenderable,{influencer:g,layout:_,key:t});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED:const f=a.InfluencerLayoutFactory.createDetailedLayout(d,p,u,c);return i.createElement(n.InfluencerDetailedRenderable,{key:t,influencer:g,layout:f});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LABELS:const y=a.InfluencerLayoutFactory.createLabelsLayout(d,p,u,c);return i.createElement(l.InfluencerLabelsRenderable,{key:t,influencer:g,layout:y});default:throw new Error("Unknown widget layout: "+(e.widgetLayout||"undefined"))}}}}),define("renderables/layouts/widget/block_influencers_detailed_layout_renderable",["require","exports","factories/influencer_render_factory","flux","react","layouts/widget/block_influencers_layout_types"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersDetailedLayoutRenderable=class extends s.BaseComponent{render(){const{payload:e}=this.props.configuration,t=(e&&e.influencers?e.influencers:[])[0];return n.createElement("div",{className:this.props.containerClass||"block-influencers-detailed"},this.renderSingle(t))}renderSingle(e){const{settings:t,widgetId:s,messages:n}=this.props.configuration;return e.key=e.influencer_id+r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST,i.InfluencerRenderFactory.createInfluencerLayout({key:e.key,influencer:e,messages:n,settings:t,widgetId:s,widgetLayout:r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED})}}}),define("renderables/layouts/widget/block_influencers_list_layout_renderable",["require","exports","flux","react","factories/influencer_render_factory","layouts/widget/block_influencers_layout_types"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersListLayoutRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{className:this.props.containerClass||"block-influencers-list"},this.renderInfluencers())}renderInfluencers(){const e=this.props.configuration.payload;return(e&&e.influencers?e.influencers:[]).map(e=>this.renderSingle(e))}renderSingle(e){e.key=e.influencer_id+r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST;const{settings:t,widgetId:i,messages:s}=this.props.configuration;return n.InfluencerRenderFactory.createInfluencerLayout({key:e.key,influencer:e,messages:s,settings:t,widgetId:i,widgetLayout:r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST})}}}),define("renderables/layouts/widget/block_influencers_grid_layout_renderable",["require","exports","block_based_widget","event_bus","flux","react","reusable_components","factories/influencer_render_factory","layouts/widget/block_influencers_layout_types"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersGridLayoutRenderable=class extends n.BaseComponent{render(){const e=!this.props.configuration.canLoadMore,{widgetId:t,messages:n}=this.props.configuration,{selectionCheckboxState:a}=this.props.configuration.payload,{icon:l,action_url:c,tooltip_message:d}=this.props.configuration.payload.action_links[0];return r.createElement("div",{className:this.props.containerClass||"block-influencers-grid"},r.createElement(i.SelectionOptionsContainer,{messages:n.selectionOptionsMessages,widgetId:t,selectionCheckboxState:void 0!==a?a:o.StateButtonState.UNCHECKED,saveOption:{icon:l,url:c,tooltipMessage:d}}),r.createElement("div",{onClick:()=>s.eventBus.dispatch({type:s.EVENT_TYPES.ENABLE_BLOCK_INFLUENCERS_KEYBINDS,value:void 0})},this.renderInfluencers(),r.createElement(i.NoMoreToLoadComponent,{shouldDisplay:e,message:this.props.configuration.messages.noMoreToLoad})))}renderInfluencers(){const e=this.props.configuration.payload;return(e&&e.influencers?e.influencers:[]).map(e=>this.renderSingle(e))}renderSingle(e){e.key=e.influencer_id+l.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID;const{settings:t,widgetId:i,messages:s}=this.props.configuration;return a.InfluencerRenderFactory.createInfluencerLayout({key:e.key,influencer:e,messages:s,settings:t,widgetId:i,widgetLayout:l.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID})}}}),define("renderables/layouts/widget/block_influencers_labels_layout_renderable",["require","exports","factories/influencer_render_factory","flux","react","layouts/widget/block_influencers_layout_types"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersLabelsLayoutRenderable=class extends s.BaseComponent{render(){const{payload:e}=this.props.configuration,t=(e&&e.influencers?e.influencers:[])[0];return n.createElement("div",{className:this.props.containerClass||"block-influencers-labels"},this.renderSingle(t))}renderSingle(e){const{settings:t,widgetId:s,messages:n}=this.props.configuration;return e.key=e.influencer_id+r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST,i.InfluencerRenderFactory.createInfluencerLayout({key:e.key,influencer:e,messages:n,settings:t,widgetId:s,widgetLayout:r.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LABELS})}}}),define("factories/block_influencers_render_factory",["require","exports","react","layouts/widget/block_influencers_layout_types","renderables/layouts/widget/block_influencers_detailed_layout_renderable","renderables/layouts/widget/block_influencers_list_layout_renderable","renderables/layouts/widget/block_influencers_grid_layout_renderable","renderables/layouts/widget/block_influencers_labels_layout_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersRenderFactory=class{static createBlockInfluencersRenderable(e){const{layout:t}=e;return this.createBlockInfluencersLayout(e,t)}static createBlockInfluencersLayoutConfiguration(e,t,i,s,n,r,o){return{layout:t,payload:e,widgetId:i,messages:s,settings:n,mediator:r,canLoadMore:o}}static createBlockInfluencersLayout(e,t){const{layout:l}=e;switch(l){case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_GRID:return i.createElement(o.BlockInfluencersGridLayoutRenderable,{key:t,containerClass:"block-based-widget-card-layout",configuration:e});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LIST:return i.createElement(r.BlockInfluencersListLayoutRenderable,{key:t,containerClass:"block-influencers-list",configuration:e});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_DETAILED:return i.createElement(n.BlockInfluencersDetailedLayoutRenderable,{key:t,containerClass:"block-influencers-detailed",configuration:e});case s.blockInfluencersLayoutTypes.INFLUENCER_MANAGEMENT_LABELS:return i.createElement(a.BlockInfluencersLabelsLayoutRenderable,{key:t,containerClass:"block-influencers-labels",configuration:e});default:throw new Error("Unknown widget layout:"+(l||"undefined"))}}}}),define("containers/block_influencers_container",["require","exports","block_based_widget","classnames","log","react","reusable_components","factories/block_influencers_render_factory"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockInfluencersContainer=class extends i.BlockBasedWidgetContainer{renderWidget(){const e=this.state.payload;if(void 0===e||void 0===e.influencers)return void n.logService.debug("Block Influencer Payload or Influencers in Payload undefined");const{widgetId:t,mediator:i}=this.props,{settings:s,payload:l}=this.state,{messages:c,layout:d}=s,h=a.BlockInfluencersRenderFactory.createBlockInfluencersLayoutConfiguration(l,d,t,c,s,i,this.controller.canLoadMore());return r.createElement("div",{className:"tw-block-influencers"},a.BlockInfluencersRenderFactory.createBlockInfluencersRenderable(h),r.createElement(o.VisibilityRenderable,{onChange:async e=>e?await this.checkLoadMore():null,delay:333}),r.createElement("div",{id:t,style:{display:"none"},className:"loader"}))}getClassNames(){return s({"tw-block-influencers-container":!0})}getLoadedUnitIds(){return this.controller.payload.influencers.map(e=>e.influencer_id)}update(){this.setState({payload:this.controller.payload})}}}),define("block_influencers",["require","exports","containers/block_influencers_container","layouts/widget/block_influencers_layout_types"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("models/interfaces/block_issues_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("controllers/interfaces/block_issues_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("containers/interfaces/block_issues_container_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/interfaces/block_issues_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/widget/block_issues_layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blockIssuesLayoutTypes={ISSUE_TRACKER_GRID:"UUID_CONFIG_ISSUE_TRACKER_ISSUES_TILE"}}),define("layouts/interfaces/issue_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("layouts/issues/interfaces/issue_grid_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/interfaces/issue_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/options menu/interfaces/issue_options_menu_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/options menu/issue_options_menu_renderable",["require","exports","block_based_widget"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueOptionsMenuRenderable=class extends i.UnitOptionsMenuRenderable{renderSpecificParts(){}getSelectMessage(){return this.props.messages.unitSelectionOptionsMessages.selectOne}getUnselectMessage(){return this.props.messages.unitSelectionOptionsMessages.unselectOne}}}),define("renderables/layouts/issue/interfaces/grid_layout_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layouts/issue/issue_grid_renderable",["require","exports","event_bus","flux","progress_graph","react","reusable_components","renderables/options menu/issue_options_menu_renderable","reusable_utilities","line_chart","data_structures","graphics_utilities","abstract_canvas_chart","math_utils"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueGridRenderable=class extends s.BaseComponent{render(){return r.createElement("div",{className:"unit clickable",onClick:this.handleIssueClick.bind(this),id:l.StringUtils.sanitizeInputForHtmlAttribute(this.props.layout.entryId)},this.generateOptionsMenu(),this.generateFirstRow(),this.generateSecondRow(),this.generateThirdRow())}generateOptionsMenu(){const{issue:e,layout:t}=this.props;return r.createElement(a.IssueOptionsMenuRenderable,{unitSelected:e.selected,widgetId:t.widgetId,messages:t.messages,options:e.action_links,unitId:t.entryId,showCheckbox:!0})}handleIssueClick(e){if(e.target instanceof HTMLCanvasElement&&e.target.classList.contains("react-line-chart"))return;const{layout:t}=this.props,s={issueId:t.entryId,widgetId:t.widgetId,pageType:t.drilldownPageType,filterString:t.filter};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_ISSUE_DETAILED,value:s})}generateFirstRow(){const{avatar:e,topicName:t,issueName:i}=this.props.layout;return r.createElement("div",{className:"unit-first-row"},e,t,i,this.generateMainRatio(),r.createElement("div",{className:"unit-first-separator"}))}generateMainRatio(){const e=this.props.layout.ratios.main_ratios[0],t=parseInt(e.value),i=parseInt(e.total_value),s=e.color,a=e.text;return r.createElement("div",{className:"unit-main-ratio"},r.createElement(o.EventHandleWrapper,{onClick:Object.assign({},this.props.layout.ratios.main_ratios[0].click_action)},r.createElement(n.CircularProgressGraphComponent,{value:t,animationEnabled:!1,color:s,type:n.ProgressGraphType.PLAIN,maxValue:i,numberFormatter:this.props.numberFormatter}),r.createElement("div",{className:"unit-main-ratio-text"},a)))}generateSecondRow(){const e={width:270,height:60,x:0,y:0,model:new _(new d.DataGraphWrapper(this.props.issue.data_graphs[0]),this.props.layout.widgetId),options:{hideGrid:!0,margins:new p.Vector4D(12,12,12,12),isClickable:!0,initialAnimationDuration:1e3,initialAnimationEnabled:!0},numberFormatter:this.props.numberFormatter};return r.createElement("div",{className:"unit-second-row"},r.createElement(c.ReactLineChartContainer,Object.assign({},e)))}generateThirdRow(){const e=this.props.layout,[t,i,s]=e.metrics.primary_metrics;return r.createElement("div",{className:"unit-third-row"},this.generateMetric(t),r.createElement("div",{className:"unit-metric-box-separator"}),this.generateMetric(i),r.createElement("div",{className:"unit-metric-box-separator"}),this.generateMetric(s))}generateMetric(e){return r.createElement(o.EventHandleWrapper,{onClick:Object.assign({},e.click_action)},r.createElement("div",{className:"unit-metric-box"},r.createElement("div",{className:"unit-metric-label"},r.createElement("i",{className:e.icon}),e.text),r.createElement("div",{className:"unit-metric-value"},e.value)))}};class g extends u.CanvasChartGridTicks{constructor(e){super(),this.ticks=e.getColumns().map((e,t)=>({label:e.getName(),formattedLabel:e.getColumn().name_formatted_compressed||e.getName(),newDay:e.getColumn().new_day||!1,value:e.getColumn().has_time_stamp?e.getColumn().timestamp:t,hasTimeStamp:e.getColumn().has_time_stamp})),this.checksum=l.StringUtils.calculateHash(this.ticks.reduce((e,t)=>e+=t.value.toString()+t.formattedLabel+t.hasTimeStamp+t.label+t.newDay,""))}}class m extends u.CanvasChartGridRange{constructor(e){super(),this.min=Number.MAX_VALUE,this.max=-Number.MAX_VALUE;const t=e.getRows();t.forEach(e=>{this.min=Math.min(this.min,e.getValueBounds().min),this.max=Math.max(this.max,e.getValueBounds().max)},{min:Number.MAX_VALUE,max:-Number.MAX_VALUE}),this.percentageBased=void 0!==t[0]&&void 0!==t[0].getCells()[0]&&t[0].getCells()[0].isPercentageBased(),this.min>0&&(this.min=0),this.checksum=l.StringUtils.calculateHash(""+this.percentageBased+this.max+this.min)}}class _{constructor(e,t){this.id=t,this.showArea=!0,this.canShowBackground=!1,this.isStacked=!1,this.isCurved=!0,this.logarithmicX=!1,this.logarithmicY=!1,this.timeInterval="d1",this.isExternalData=!1,this.isNestedData=!1,this.lines=this.buildLineData(e.getColumns()),this.grid=this.buildGridData(e)}toSerializable(){return{id:this.id}}get checkSum(){return l.StringUtils.calculateHash(`${JSON.stringify(this.grid)}${this.timeInterval}`)}buildLineData(e){const t={};return e.forEach(e=>{e.getCells().forEach(i=>{const s=i.getRow().getCode();if(void 0===t[s]){const e=h.Color.fromARGBString(i.getRow().getColor());t[s]={min:i.getRow().getValueBounds().min,max:i.getRow().getValueBounds().max,values:[],totalPositive:0,totalNegative:0,color:{top:0===e.a?_.defaultColor.clone():e.clone(),bottom:0===e.a?_.defaultColor.clone():e.clone()}}}const n=isNaN(i.getValue())?0:i.getValue();n>0?t[s].totalPositive+=n:t[s].totalNegative+=n;const r=h.Color.fromARGBString(i.getColor());t[s].values.push({value:n,percentageBased:i.isPercentageBased(),popoverHeader:"datetime"===i.getColumn().getColumn().data_type?i.getColumn().getColumn().name_formatted_full+(i.getColumn().getColumn().name_formatted_time?" ("+i.getColumn().getColumn().name_formatted_time+")":""):null,formattedLabel:e.getFormattedLabel(),color:0===r.a?_.defaultColor.clone():r,filters:[l.StringUtils.parseFilters(i.getRow().getFilters()),e.getFilter()].filter(e=>e.length>0),commentInfo:void 0,dropdownData:[],comments:[],subLabel:i.getRow().getLabel(),requestedPageType:i.getRequestedPageType(),drilldownEnabled:!0})})}),t}buildGridData(e){const t=new g(e),i=new m(e);return{xAxis:t,yAxis:i,direction:u.CanvasChartGridDirection.NORMAL,xAxisPlacement:u.CanvasChartGridAxisPlacement.START,yAxisPlacement:u.CanvasChartGridAxisPlacement.START,ticks:t,range:i,maxTickLines:Number.MAX_VALUE}}}_.defaultColor=h.Color.fromARGBString("rgba(0, 137, 188, 1)")}),define("layouts/issues/issue_layout_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.issueLayoutTypes={ISSUE_TRACKER_GRID:"tile"}}),define("renderables/components/issue_layout_component",["require","exports","block_based_widget","layouts/issues/issue_layout_types"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueLayoutComponent=class extends i.UnitLayoutComponent{generateComponent(e){const t=e.layout;switch(t){case s.issueLayoutTypes.ISSUE_TRACKER_GRID:return this.renderGrid(e);default:throw new Error("Unknown layout type"+t)}}renderGrid(e){}}}),define("renderables/components/issue_avatar_component",["require","exports","block_based_widget","renderables/components/issue_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueAvatarComponent=class extends s.IssueLayoutComponent{renderGrid(e){return i.UnitAvatarComponent.createAvatarOnlyErrorFallback(e,"unit-avatar",{errorFallbackClickable:!1})}}}),define("renderables/components/issue_name_component",["require","exports","block_based_widget","renderables/components/issue_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueNameComponent=class extends s.IssueLayoutComponent{renderGrid(e){return i.UnitSubtitleComponent.createHandle(e,"unit-alias issue")}}}),define("renderables/components/issue_topic_name_component",["require","exports","renderables/components/issue_layout_component","block_based_widget"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueTopicNameComponent=class extends i.IssueLayoutComponent{renderGrid(e){return s.UnitTitleComponent.createSingleLineTitleAsSpan(e,"unit-name issue",!1)}}}),define("renderables/components/issue_initials_avatar_component",["require","exports","renderables/components/issue_layout_component","block_based_widget"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueInitialsAvatarComponent=class extends i.IssueLayoutComponent{renderGrid(e){const{text:t,font_color:i,background_color:n}=e.blocks[0].model;return s.UnitAvatarComponent.createInitialsAvatar({initials:t,textColor:i,backgroundColor:n,rounded:!0,size:"62px",containerClassName:"unit-avatar"},"unit-avatar")}}}),define("factories/issue_component_factory",["require","exports","renderables/components/issue_avatar_component","renderables/components/issue_name_component","renderables/components/issue_topic_name_component","renderables/components/issue_initials_avatar_component"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueComponentFactory=class{static createAvatar(e,t){return(new i.IssueAvatarComponent).render({layout:e,avatarBlocks:t})}static createInitialsAvatar(e,t){return(new r.IssueInitialsAvatarComponent).render({layout:e,blocks:t})}static createIssueName(e,t){if(null!==t)return(new s.IssueNameComponent).render({layout:e,titleBlocks:void 0,subtitleBlocks:t})}static createTopicName(e,t){if(null!==t)return(new n.IssueTopicNameComponent).render({layout:e,titleBlocks:t,subtitleBlocks:void 0})}}}),define("factories/issue_layout_factory",["require","exports","block_based_widget","reusable_components","factories/issue_component_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueLayoutFactory=class{static createGridLayout(e,t,r,o){const{id:a,requested_page_type:l,avatar:c,initials:d,issue_name:h,brand_name:u,layout:p,filter:g,name:m}=e;let _=h;const f=m.text?m.text.split(" ~ "):[];return f.length>1&&f[0]===u.text&&f[1]===h.text||(_=m),{widgetId:t,entryId:a,messages:r,filter:g,size:o.size,drilldownPageType:l,avatar:c?n.IssueComponentFactory.createAvatar(p,i.BlocksFactory.create(s.BlockTypes.IMAGE,c,t)):n.IssueComponentFactory.createInitialsAvatar(p,i.BlocksFactory.create(s.BlockTypes.TEXT,d,t)),issueName:n.IssueComponentFactory.createIssueName(p,i.BlocksFactory.create(s.BlockTypes.TEXT,_,t)),topicName:n.IssueComponentFactory.createTopicName(p,i.BlocksFactory.create(s.BlockTypes.TEXT,u,t)),metrics:i.BlockBasedWidgetLayoutFactory.createMetrics(JSON.parse(JSON.stringify(e)),t),ratios:i.BlockBasedWidgetLayoutFactory.createRatios(e,t)}}}}),define("factories/issue_render_factory",["require","exports","react","layouts/widget/block_issues_layout_types","renderables/layouts/issue/issue_grid_renderable","factories/issue_layout_factory"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueRenderFactory=class{static createIssueLayout(e){const{settings:t,issue:o,widgetLayout:a,messages:l,widgetId:c}=e,d=JSON.parse(JSON.stringify(o));switch(a){case s.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID:const h=r.IssueLayoutFactory.createGridLayout(o,c,l,t);return i.createElement(n.IssueGridRenderable,{issue:d,layout:h,key:o.key,numberFormatter:t.numberFormatter});default:throw new Error(`Unknown widget layout: ${e.widgetLayout}`)}}}}),define("renderables/layouts/widget/block_issues_grid_layout_renderable",["require","exports","block_based_widget","flux","react","reusable_components","factories/issue_render_factory","layouts/widget/block_issues_layout_types"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesGridLayoutRenderable=class extends s.BaseComponent{render(){const e=!this.props.configuration.canLoadMore,{widgetId:t,messages:s}=this.props.configuration,{selectionCheckboxState:o}=this.props.configuration.payload;return n.createElement("div",{className:this.props.containerClass||"block-issues-grid"},n.createElement(i.SelectionOptionsContainer,{messages:s.selectionOptionsMessages,widgetId:t,selectionCheckboxState:void 0!==o?o:r.StateButtonState.UNCHECKED}),this.renderIssues(),n.createElement(i.NoMoreToLoadComponent,{shouldDisplay:e,message:this.props.configuration.messages.noMoreToLoad}))}renderIssues(){const e=this.props.configuration.payload;return(e&&e.issues?e.issues:[]).map(e=>this.renderSingle(e))}renderSingle(e){e.key=e.id+a.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID;const{settings:t,widgetId:i,messages:s}=this.props.configuration;return o.IssueRenderFactory.createIssueLayout({key:e.key,issue:e,messages:s,settings:t,widgetId:i,widgetLayout:a.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID})}}}),define("factories/block_issues_render_factory",["require","exports","react","layouts/widget/block_issues_layout_types","renderables/layouts/widget/block_issues_grid_layout_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesRenderFactory=class{static createBlockIssuesRenderable(e){const{layout:t}=e;return this.createBlockIssuesLayout(e,t)}static createBlockIssuesLayoutConfiguration(e,t,i,s,n,r,o){return{layout:t,payload:e,widgetId:i,messages:s,settings:n,mediator:r,canLoadMore:o}}static createBlockIssuesLayout(e,t){const{layout:r}=e;switch(r){case s.blockIssuesLayoutTypes.ISSUE_TRACKER_GRID:return i.createElement(n.BlockIssuesGridLayoutRenderable,{key:t,containerClass:"block-based-widget-card-layout",configuration:e});default:throw new Error("Unknown widget layout:"+(r||"undefined"))}}}}),define("containers/block_issues_container",["require","exports","block_based_widget","classnames","log","react","reusable_components","factories/block_issues_render_factory"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockIssuesContainer=class extends i.BlockBasedWidgetContainer{renderWidget(){const e=this.state.payload;if(!e||!e.issues)return void n.logService.debug("Block Issue Payload or Issues in Payload undefined");const{widgetId:t,mediator:i}=this.props,{settings:s,payload:l}=this.state,{messages:c,layout:d}=s,h=a.BlockIssuesRenderFactory.createBlockIssuesLayoutConfiguration(l,d,t,c,s,i,this.controller.canLoadMore());return r.createElement("div",{className:"tw-block-issues"},a.BlockIssuesRenderFactory.createBlockIssuesRenderable(h),r.createElement(o.VisibilityRenderable,{onChange:e=>e?this.checkLoadMore():null,delay:333}))}getClassNames(){return s({"tw-block-issues-container":!0})}getLoadedUnitIds(){return this.controller.payload.issues.map(e=>e.id)}update(){this.setState({payload:this.controller.payload})}}}),define("block_issue",["require","exports","containers/block_issues_container","layouts/widget/block_issues_layout_types"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("renderables/components/issue_brand_name",["require","exports","block_based_widget","renderables/components/issue_layout_component"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IssueBrandNameComponent=class extends s.IssueLayoutComponent{renderGrid(e){return i.UnitTitleComponent.createSingleLineTitleAsSpan(e,"unit-brand-name",!1)}}}),define("actions/bubble_chart_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BubbleChartActions={bubbleChart_onMouseEnter:"bubbleChart_onMouseEnter",bubbleChart_onMouseLeave:"bubbleChart_onMouseLeave",bubbleChart_onMouseClick:"bubbleChart_onMouseClick"}}),define("classes/bubble_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/bubble",["require","exports","canvas_engine","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=35;t.HOVER_ANIMATION_DURATION=200;const r={FADE:"fade",HOVER:"hover"},o=15;class a extends i.Entity{constructor(e,t,s,n){super(e),this.bubbleData=t,this.radius=s,this.numberFormatter=n,this.hovering=!1,this.faded=!1,this.interactionAnimationComponent=(new i.AnimationComponent).attach(this),this.buildCircle().buildLabel().buildHoverAnimation().buildFadeAnimation(),this.setInteractiveState(!0)}setZero(e){Object.keys(this.bubbleData.values).forEach(e=>this.bubbleData.values[e]=0),this.bubbleData.label="0",this.radius=e,this.label.setText("0"),this.label.fontSize=o;const t=this.label.getBoundingBox();this.label.getPresence().setCoordinates(-t.width/2,-t.height/2),this.circle.setStyle(i.Style.Radius,e)}getBubbleData(){return this.bubbleData}extractLabel(){this.removeComponent(this.label);const e=this.label;return this.label=void 0,e}getRadius(){return this.circle.getStyle(i.Style.Radius)}getFontSize(){return this.label.getStyle(i.Style.Font).getSize()}replayTransition(e,t,s,n,r,o){return o.setStyle(i.Style.Layer,this.getStyleMap()),e.addSequence(t.tween(this,[{key:"presence",value:n,duration:s}],this.getNodeId()+"replaytransition")),e.addSequence(t.tween(this.circle,[{key:i.Style.Radius,value:r,duration:s}],this.circle.getNodeId()+"replaytransition")),o.setStyle(i.Style.Opacity,0),this.addComponent(o),o.setStageFacade(this.getStageFacade()),o.subscribeToStage(),e.addSequence(t.tween(this.label,[{key:i.Style.Opacity,value:0,duration:.25*s}],this.label.getNodeId()+"replaytransitionOut")),e.addSequence(t.tween(o,[{key:i.Style.Opacity,value:1,duration:.75*s}],o.getNodeId()+"replaytransitionIn")),this.label=o,this}transitionWithNewLabel(e,t,s,n,r,o){return o.setStyle(i.Style.Layer,this.getStyleMap()),e.addSequence(t.tween(this,[{key:"presence",value:n,duration:s}],this.getNodeId()+"transition")),e.addSequence(t.tween(this.circle,[{key:i.Style.Radius,value:r,duration:s}],this.circle.getNodeId()+"transition")),o.setStyle(i.Style.Opacity,0),this.addComponent(o),o.setStageFacade(this.getStageFacade()),o.subscribeToStage(),e.addSequence(t.tween(this.label,[{key:i.Style.Opacity,value:0,duration:.25*s}],this.label.getNodeId()+"transitionOut")),e.addSequence(t.tween(o,[{key:i.Style.Opacity,value:1,duration:.75*s}],o.getNodeId()+"transitionIn")),e.onDone.subscribeOnceAsPromise().then(()=>{o.setStyle(i.Style.Opacity,this).setStyle(i.Style.Layer,this),this.removeComponent(this.label),this.label.dispose(),this.label=o}),this}transitionWithOutNewLabel(e,t,s,n,r){return e.addSequence(t.tween(this,[{key:"presence",value:n,duration:s}],this.getNodeId()+"transition")),e.addSequence(t.tween(this.circle,[{key:i.Style.Radius,value:r,duration:s}],this.circle.getNodeId()+"transition")),this}transition(e,t,s,n,r,o,a){return void 0!==a&&(this.bubbleData=a),this.label.getText()!==o.getText()||this.label.getStyle(i.Style.Font).size!==o.getStyle(i.Style.Font).size?this.transitionWithNewLabel(e,t,s,n,r,o):this.transitionWithOutNewLabel(e,t,s,n,r),this}getPoint(){return this.getPresence().toPoint()}getPopoverData(){return{node:{color:this.bubbleData.color.toHex6(),label:this.getPopoverLabel()},values:Object.keys(this.bubbleData.values).reverse().map(e=>({value:this.formatPopoverValues(this.bubbleData.values[e],this.bubbleData.valuesPercentageBased[e]),label:this.bubbleData.bubbleLabels[e]}))}}formatPopoverValues(e,t){return t?this.numberFormatter.toPercentage(e/100):this.numberFormatter.toDecimal(e)}getValues(){return this.bubbleData.values}setStage(e){return this.setStageFacade(e),this.subscribeToStage(),this.circle.setStageFacade(e),this.circle.subscribeToStage(),this}getFilters(){return this.bubbleData.filters}getPopoverLabel(){return this.bubbleData.popoverLabel}getId(){return this.bubbleData.id}isHovering(){return this.hovering}isFaded(){return this.faded}playAnimation(e,t,s=2){[this.label,this.circle].forEach(s=>{const n=this.interactionAnimationComponent.accessSequenceFor(s.getNodeId().toString()+e);void 0!==n&&(t?n.isReversed()?n.reset():n.setReverseState(!0):n.isReversed()?n.setReverseState(!1):n.reset(),n.getState()!==i.Constants.State.Animation.Playing&&n.resume())}),this.setLayer(s)}fadeOut(){return this.faded=!0,this.playAnimation(r.FADE,!1),this}fadeIn(e=2){return this.faded=!1,this.playAnimation(r.FADE,!0,e),this}hoverIn(){return this.hovering=!0,this.playAnimation(r.HOVER,!1,3),this}hoverOut(){return this.hovering=!1,this.playAnimation(r.HOVER,!0),this}resetInteractionAnimation(){return this.interactionAnimationComponent.destroyAll(),this.interactionAnimationComponent.dispose(),this.interactionAnimationComponent=(new i.AnimationComponent).attach(this),this}buildFadeAnimation(){return this.interactionAnimationComponent.tween(this.circle,[{key:i.Style.Opacity,value:.3,duration:t.HOVER_ANIMATION_DURATION}],this.circle.getNodeId().toString()+r.FADE),this.interactionAnimationComponent.tween(this.label,[{key:i.Style.Opacity,value:.3,duration:t.HOVER_ANIMATION_DURATION}],this.label.getNodeId().toString()+r.FADE),this}static getHoverSize(e){return a.getHoverRadius(e)+a.getHoverBorderThickness(e)}static getHoverRadius(e){return Math.min(1.5*e,e+5)}static getHoverBorderThickness(e){return Math.min(e/2,10)}buildHoverAnimation(){return this.interactionAnimationComponent.tween(this.circle,[{key:i.Style.Radius,value:a.getHoverRadius(this.circle.getStyle(i.Style.Radius)),duration:t.HOVER_ANIMATION_DURATION},{key:i.Style.BorderThickness,value:a.getHoverBorderThickness(this.circle.getStyle(i.Style.Radius)),duration:t.HOVER_ANIMATION_DURATION}],this.circle.getNodeId().toString()+r.HOVER),this}getPopoverPoint(){const e=$(this.getStageFacade().getCanvas()),t=this.circle.getPresence().toPoint();return new i.Point(e.offset().left+t.getX(),e.offset().top+t.getY()-this.circle.getStyle(i.Style.Radius))}buildInitialAnimation(e,t,s,n=0){const r=.7*s,o=s-r;e.addSequence(t.tween(this.circle,[{key:i.Style.Radius,value:1.2*this.circle.getStyle(i.Style.Radius),duration:r}],this.circle.getNodeId()+"init_circle_first"),n),e.addSequence(t.tween(this.circle,[{key:i.Style.Radius,value:this.circle.getStyle(i.Style.Radius),duration:o}],this.circle.getNodeId()+"init_circle_second"),n+r),e.addSequence(t.tween(this.label,[{key:i.Style.Opacity,value:1,duration:o}],this.label.getNodeId()+"label show"),n+r),this.label.setStyle(i.Style.Opacity,0),this.circle.setStyle(i.Style.Radius,0),this.circle.setStyle(i.Style.Depth,0)}buildLabel(){const e=new i.LabelSettings;e.setFontFamily(i.Constants.Font.Family.DigitsBold).setShadowBlur(5).setShadowColor(s.Color.fromRGB(102,102,102)).setColor(s.Color.WHITE());const t=e.getFont();t.setSize(o);let r=i.Utilities.measureText(this.bubbleData.label,t);const a=1.5*this.radius;for(;r.width<a&&r.height<a&&t.getSize()<=n;){t.setSize(t.getSize()+1);const e=r;r=i.Utilities.measureText(this.bubbleData.label,t),i.ObjectCache.recycleObject(e)}i.ObjectCache.recycleObject(r),e.setFont(t),this.label=new i.LabelComponent(new i.Presence(0,0),this.bubbleData.label,e);const l=this.label.getBoundingBox();return this.label.setStyle(i.Style.Layer,this).getPresence().translate(-l.width/2,-l.height/2),this.addComponent(this.label),i.ObjectCache.recycleObject(l),this}buildCircle(){return this.circle=new i.CircleComponent(new i.Circle(0,0,this.radius)),this.circle.setStyle(i.Style.BorderColor,this.bubbleData.color.clone().darken(10)).setStyle(i.Style.Color,this.bubbleData.color).setStyle(i.Style.Layer,this).setInteractiveState(!0),this.addComponent(this.circle),this}}t.Bubble=a}),define("models/bubble_chart_model",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={ENGAGEMENT:"x",REACH:"y",COUNT:"results"},n={REACH_AUTHOR:"x",ENGAGEMENT_AUTHOR:"y",NB_POST_TOTAL:"results"},r={ENGAGEMENT:"x",NET_SENTIMENT:"y",COUNT:"results"};t.BubbleChartModel=class{constructor(e,t,o,a){this.dataGraph=e,this.isInfluencerBubble=o,this.isLogarithmic=a,this.axesData={},this.itemMap={},this.keyMapping={},this.isInfluencerBubble?this.dataMapping=n:_.some(this.dataGraph.getColumns(),e=>"NET_SENTIMENT"===e.getColumn().function)?this.dataMapping=r:this.dataMapping=s,_.each(this.dataMapping,(e,t)=>{this.keyMapping[e]=t}),this.dataGraph=e,this.hash=i.StringUtils.calculateHash(this.buildItemData(t)+this.buildAxisData()+this.isLogarithmic)}getAllowedValues(){return Object.keys(this.dataMapping)}buildItemData(e){let t="";return this.itemMap={},this.dataGraph.getRows().forEach(s=>{const n={},r={},o={};s.getCells().forEach((e,t)=>{const i=e.getNumericData(),s=e.getColumn().getIdentifier();this.getAllowedValues().indexOf(s)>-1&&(n[s]=i,void 0!==e.getCell().value.formatted_value&&(r[s]=e.getCell().value.formatted_value.indexOf("%")>-1),o[s]=e.getColumn().getFormattedLabel())}),t+=_.toArray(n).toString()+s.getFormattedLabel()+s.getTwColor().toRGBAString(),this.itemMap[s.getFormattedLabel()]={label:e.toInteger(n[this.getResultsKey()]),id:s.getCode(),popoverLabel:s.getLabel(),color:s.getTwColor(),values:n,valuesPercentageBased:r,percentageBased:!1,bubbleLabels:o,filters:i.StringUtils.parseFilters(s.getFilters())}}),t}getAxisKey(e){return this.dataMapping[e]}getXKey(){return this.keyMapping.x}getYKey(){return this.keyMapping.y}getResultsKey(){return this.keyMapping.results}buildAxisData(){let e="";this.axesData={};let t=!1;return this.dataGraph.getColumns().forEach(i=>{if(this.getAllowedValues().indexOf(i.getIdentifier())>-1){let s=Number.MAX_VALUE,n=0,o=!1;i.getCells().forEach(e=>{const t=this.itemMap[e.getRow().getFormattedLabel()].values[i.getIdentifier()];(n=Math.ceil(Math.max(n,t)))<5&&(n=5),s=Math.floor(Math.min(0,s,t)),o=this.itemMap[e.getRow().getFormattedLabel()].valuesPercentageBased[i.getIdentifier()]}),(s<0||this.dataMapping===r)&&(t=!0),e+=s+n+i.getIdentifier(),this.axesData[this.getAxisKey(i.getIdentifier())]={id:i.getIdentifier(),label:i.getFormattedLabel(),min:s,max:n,percentageBased:o}}}),["x","y"].forEach(e=>{if(t){const t=Math.max(-this.axesData[e].min,this.axesData[e].max);this.axesData[e].min=-t,this.axesData[e].max=t}else this.axesData[e].min=0}),e}}}),define("classes/bubble_chart",["require","exports","canvas_engine","canvas_axes","classes/bubble","actions/bubble_chart_actions","flux","event","underscore"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const c=45,d=10,h=1e3;t.BubbleChart=class extends i.Entity{constructor(e,t,s,n){super(e),this.model=t,this.widgetID=s,this.settings=n,this.bubbles=[],this.initialTimeline=new i.Timeline,this.initialAnimationComponent=(new i.AnimationComponent).attach(this),this.onBubbleEnter=new a.Event,this.onBubbleLeave=new a.Event,this.checkCursorPredicate=((e,t,i)=>e.containsPoint(t,i))}getCanvasAxes(){return this.axes}exctractBubbles(){this.bubbles.forEach(e=>{this.removeChild(e)});const e=this.bubbles;return this.bubbles=[],e}setZero(){return this.bubbles.forEach(e=>{const t=this.axes.getZeroPoint();e.getPresence().setCoordinates(t.getX(),t.getY()),e.setZero(d)}),this}getMarginBottom(){return this.axes.getMarginBottom()}transitionAxes(e,t){return this.axes.replayTransition(e,t),this}replayTransition(e,t,i){return i.forEach(i=>{const s=l.find(this.bubbles,e=>e.getId()===i.getId());if(void 0!==s){const n=i.getPoint();s.replayTransition(e,t,h,n,i.getRadius(),i.extractLabel())}}),this}resetInterations(){this.bubbles.forEach(e=>{e.resetInteractionAnimation(),e.buildFadeAnimation().buildHoverAnimation()})}sortBubblesBySize(){return this.children=l.sortBy(this.children,e=>e instanceof n.Bubble?-e.getValues()[l.last(Object.keys(e.getValues()))]:-Number.MAX_VALUE),this}transition(e,t,s,n,r,o){this.axes.transition(e,t,h,n,r,o);const a=[],c=[];return this.cancelMouseEvents(),s.forEach(i=>{const s=l.find(this.bubbles,e=>e.getId()===i.getId());if(void 0!==s){const n=i.getPoint();s.transition(e,t,h,n,i.getRadius(),i.extractLabel(),Object.assign({},i.getBubbleData()))}else c.push(i);a.push(i.getId())}),this.bubbles.forEach(s=>{-1===a.indexOf(s.getId())&&(e.addSequence(t.tween(s,[{key:i.Style.Opacity,value:0,duration:h}],s.getNodeId()+"transitionOut")),e.onDone.subscribeOnceAsPromise().then(()=>{this.removeChild(s),s.dispose()}))}),c.forEach(i=>{i.buildInitialAnimation(e,t,h),this.addChild(i),i.setStageFacade(this.getStageFacade()),i.subscribeToStage(),this.bubbles.push(i)}),e.onDone.subscribeOnceAsPromise().then(()=>{this.bubbles=this.bubbles.filter(e=>a.indexOf(e.getId())>-1),this.bubbles.forEach(e=>{e.resetInteractionAnimation(),e.buildFadeAnimation().buildHoverAnimation()}),this.setUpMouseEvents()}),this.sortBubblesBySize(),this}async animate(e){const t=this.initialTimeline.onDone.subscribeOnceAsPromise();l.defer(()=>this.initialTimeline.playOverTime(e)),await t}handleMouseClick(e){return void 0===this.clickedID||this.clickedID!==e?(this.clickedID=void 0,this.handleMouseEnter(e),this.clickedID=e):(this.clickedID=void 0,this.handleMouseLeave()),this}handleMouseEnter(e,t=!1){return void 0===this.clickedID&&this.bubbles.forEach(i=>{i.getId()===e?(o.dispatcher.dispatch(r.BubbleChartActions.bubbleChart_onMouseEnter,{canvas:this.getStageFacade().getCanvas(),popoverData:i.getPopoverData(),coords:i.getPopoverPoint(),id:i.getId(),filters:i.getFilters(),widgetId:this.widgetID}),i.isHovering()||i.hoverIn(),i.isFaded()&&i.fadeIn(3)):(t&&this.onBubbleLeave.fire(i.getId()),i.isHovering()&&i.hoverOut(),i.isFaded()||i.fadeOut())}),this}handleMouseLeave(e=!1){return void 0===this.clickedID&&this.bubbles.forEach(t=>{t.isHovering()&&(t.hoverOut(),e&&this.onBubbleLeave.fire(t.getId()),o.dispatcher.dispatch(r.BubbleChartActions.bubbleChart_onMouseLeave,{id:t.getId()})),t.isFaded()&&t.fadeIn()}),this}buildInitialAnimation(e){const t=e/this.bubbles.length;let i=0;return this.bubbles.forEach(s=>{s.buildInitialAnimation(this.initialTimeline,this.initialAnimationComponent,e-t,i),i+=t}),this.axes.buildInitialAnimation(this.initialTimeline,this.initialAnimationComponent,e),this}buildAxes(e){const t={x:l.clone(this.model.axesData.x),y:l.clone(this.model.axesData.y)};let r,o;this.settings.maximizeMargin||this.model.axesData.y.min<0||this.model.axesData.x.min<0?(r=n.Bubble.getHoverSize(c)+8,o=n.Bubble.getHoverSize(c)-8):(r=e.reduce((e,{yValue:t,radius:i})=>{if(this.model.axesData.y.min<0){const s=t/this.model.axesData.y.min;return Math.max(e,s*i)}{const s=this.model.axesData.y.max,n=(s-t)/s*i;return Math.max(e,Math.min(1.5*n,n+10))}},0),o=e.reduce((e,{yValue:t,radius:i})=>{if(this.model.axesData.y.min<0){const s=1-t/this.model.axesData.y.min;return Math.max(e,s*i)}{const s=this.model.axesData.y.max,n=(1-(s-t)/s)*i;return Math.max(e,Math.min(1.5*n,n+10))}},0));const a=Math.max(40,o),d=Math.max(40,r+10);return this.axes=new s.CanvasAxes(i.Presence.zeroTopLeft(),t,{width:this.settings.width,height:this.settings.height,numYTicks:Math.floor(Math.max(2,Math.min(5,(this.settings.height-a-d)/15))),numXTicks:Math.floor(Math.max(2,Math.min(11,(this.settings.width-65)/45))),marginTop:a,marginBottom:d,numberFormatter:this.settings.numberFormatter,fontSize:this.settings.fontSize,logarithmicY:this.model.isLogarithmic,logarithmicX:this.model.isLogarithmic,colorPalette:{gridColor:this.settings.colorPalette.gridColor,axisColor:this.settings.colorPalette.axisColor,axisLabelColor:this.settings.colorPalette.axisLabelColor}}),this.addChild(this.axes),this}prepareBubbleData(){const e=this.model.axesData.results.max;return l.toArray(this.model.itemMap).reduce((t,i)=>{const s=i.values[this.model.getXKey()],n=i.values[this.model.getYKey()],r=i.values[this.model.getResultsKey()];let o=Math.min(c,Math.max(d,Math.round(r/e*c)));return isNaN(o)&&(o=d),t.push({xValue:s,yValue:n,itemData:i,radius:o}),t},[])}buildBubbles(e){return this.bubbles=this.bubbles.filter(e=>(this.removeChild(e),e.dispose(),!1)),e.forEach(({xValue:e,yValue:t,radius:s,itemData:r})=>{const o=new n.Bubble(i.Presence.fromPoint(this.axes.getValuePoint(e,t)),r,s,this.settings.numberFormatter);o.setLayer(2),this.addChild(o),o.setStage(this.getStageFacade()),this.bubbles.push(o),o.setStageFacade(this.getStageFacade()),o.subscribeToStage()}),this}showPointer(e){if(!this.getStageFacade().isCursorPointer()){const t=this.getStageFacade(),s=t.getActiveCamera(),n=s.stageToCameraCoordinates(t.getCurrentMousePosition());this.checkCursorPredicate(e,n,s)&&(this.getStageFacade().getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer),i.ObjectCache.recycleObject(n)}return this}resetCursor(e){const t=this.getStageFacade(),s=t.getActiveCamera(),n=s.stageToCameraCoordinates(t.getCurrentMousePosition());return this.checkCursorPredicate(e,n,s)||this.getStageFacade().resetCursor(),i.ObjectCache.recycleObject(n),this}cancelMouseEvents(){return this.bubbles.forEach(e=>{e.onMouseEnter.cancelAll(),e.onMouseLeave.cancelAll(),e.onMouseClick.cancelAll()}),this}setUpMouseEvents(){let e,t=void 0;return this.cancelMouseEvents(),this.bubbles.forEach(i=>{i.onMouseEnter.subscribe(()=>{setTimeout(()=>{i.isHovering()||void 0!==this.clickedID||(this.showPointer(i),t=i.getId(),this.handleMouseEnter(i.getId(),!0),void 0!==e&&clearTimeout(e),e=setTimeout(()=>{t=void 0,e=void 0},n.HOVER_ANIMATION_DURATION+10),this.onBubbleEnter.fire(i.getId()))},30)}),i.onMouseLeave.subscribe(()=>{void 0===this.clickedID&&(void 0!==t&&t!==i.getId()||(this.resetCursor(i),this.handleMouseLeave(!0)))}),i.onMouseClick.subscribe(()=>{void 0===this.clickedID&&o.dispatcher.dispatch(r.BubbleChartActions.bubbleChart_onMouseClick,{stageFacade:this.getStageFacade()})})}),this}compute(){const e=this.prepareBubbleData();return this.buildAxes(e),this.axes.setStageFacade(this.getStageFacade()),this.axes.subscribeToStage(),this.buildBubbles(e),this.sortBubblesBySize(),this}}}),define("classes/bubble_chart_fragment",["require","exports","canvas_chart_utilities","canvas_engine","data_structures","reusable_utilities","widget_base","models/bubble_chart_model","classes/bubble_chart"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BubbleChartFragment=class extends i.AbstractCanvasFragment{constructor(e){super(e),this.stageSettings={layerAmount:5,relayEvents:[s.Constants.StageEvents.MouseWheel]},this.modelUpdated=!1,this.cancellationToken=new r.CancellationToken,this.fragmentModel=e}isInfluencerBubble(){return void 0!==this.fragmentModel.widget.getPayloadValue().sources}isLogarithmic(){return this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration()&&this.fragmentModel.widget.getExtendedConfiguration().getYAxisConfiguration().isLogarithmic()}createModels(e){return[...this.fragmentModel.widget.getDataGraph().getAdditionalFrames().map(t=>new a.BubbleChartModel(new n.DataGraphWrapper(t),e.style.formatting.numberFormatter,this.isInfluencerBubble(),this.isLogarithmic()))]}calculateMaxAxesData(e){return e.reduce((e,t)=>(Object.keys(t.axesData).forEach(i=>{void 0===e[i]?e[i]=Object.assign({},t.axesData[i]):(e[i].max=Math.max(e[i].max,t.axesData[i].max),e[i].min=Math.min(e[i].min,t.axesData[i].min))}),e),{x:void 0,y:void 0,results:void 0})}initialize(e,t,i){return super.initialize(e,t,i),this.mediator=t,this.chartContainer=e,this.settings=i,this.bubbleChartModel=new a.BubbleChartModel(new n.DataGraphWrapper(this.fragmentModel.widget.getDataGraph().payloadDataGraph),i.style.formatting.numberFormatter,this.isInfluencerBubble(),this.isLogarithmic()),this.prepareReplay(),this.handleCanvas(i,this.stageSettings)}prepareReplay(){this.fragmentModel.widget.hasAdditionalFrames()&&(this.models=this.createModels(this.settings),this.maxAxesData=this.calculateMaxAxesData(this.models)),void 0!==this.chart&&(this.chart.dispose(),this.chart=void 0)}update(e){this.fragmentModel=e;const t=this.bubbleChartModel.hash;return this.bubbleChartModel=new a.BubbleChartModel(new n.DataGraphWrapper(e.widget.getDataGraph().payloadDataGraph),this.settings.style.formatting.numberFormatter,this.isInfluencerBubble(),this.isLogarithmic()),this.prepareReplay(),this.modelUpdated=this.bubbleChartModel.hash!==t,Promise.resolve(this)}createReplay(e){return this.replayTimeline=new s.Timeline,this.replayAnimationComponent=(new s.AnimationComponent).attach(this.chart),this}buildChart(e,t=this.bubbleChartModel){void 0!==this.maxAxesData&&(t.axesData=this.maxAxesData);const i=new l.BubbleChart(s.Presence.zeroTopLeft(),t,this.fragmentModel.widget.getId(),{width:e.dimensions.width,height:e.dimensions.height,numberFormatter:e.style.formatting.numberFormatter,maximizeMargin:this.fragmentModel.widget.hasAdditionalFrames(),fontSize:e.style.fontSize,colorPalette:e.style.colorPalette});return i.setStageFacade(this.scene.getStageFacade()),i.compute(),i.subscribeToStage(),i}setUpMediatorListeners(e){if(this.cancellationToken.cancel(),this.cancellationToken=new r.CancellationToken,this.fragmentModel.widget.hasAdditionalFrames()){this.createReplay(e);let t=!0;this.mediator.listen(o.REPLAY_ACTIONS.PROGRESS,({progress:i})=>{if(t)return this.chart.setZero(),this.models.forEach((t,i)=>{this.replayTimeline.setDelayAdditive(1e3*i),this.replayAnimationComponent.setIdAdditive(_.uniqueId());const s=this.buildChart(e,t);this.chart.replayTransition(this.replayTimeline,this.replayAnimationComponent,s.exctractBubbles())}),t=!1,void(this.chart.hasStageFacade()&&this.chart.getStageFacade().processUpdate());if(void 0!==i){if(0===i&&this.replayTimeline.getProgress()>i){let e=this.replayTimeline.getProgress();for(;e>i;)e=Math.max(0,e-.1),this.replayTimeline.setProgress(e)}else this.replayTimeline.setProgress(i);this.chart.hasStageFacade()&&this.chart.getStageFacade().processUpdate(),this.chart.resetInterations()}},{token:this.cancellationToken})}return this.mediator.listen(i.LegendFragmentActions.LEGEND_MOUSEENTER,e=>{this.chart.handleMouseEnter(e)},{token:this.cancellationToken}),this.mediator.listen(i.LegendFragmentActions.LEGEND_MOUSELEAVE,()=>{this.chart.handleMouseLeave()},{token:this.cancellationToken}),this.mediator.listen(i.LegendFragmentActions.LEGEND_MOUSECLICK,e=>{this.chart.handleMouseClick(e)},{token:this.cancellationToken}),this.chart.onBubbleEnter.subscribe(e=>{this.mediator.dispatch(i.LegendFragmentActions.WIDGET_MOUSEENTER,e)}),this.chart.onBubbleLeave.subscribe(e=>{this.mediator.dispatch(i.LegendFragmentActions.WIDGET_MOUSELEAVE,e)}),this}async draw(e){if(0===e.animationDuration&&(e.animationStrategy=0),await this.handleCanvas(e,this.stageSettings),void 0!==this.chart&&void 0!==this.logarithmic&&this.bubbleChartModel.isLogarithmic!==this.logarithmic&&(this.scene.clearChildren(),this.chart.dispose(),this.chart=void 0),void 0===this.chart||this.oldHeight===e.dimensions.height&&this.oldWidth===e.dimensions.width||(this.chart.dispose(),this.chart=void 0),void 0===this.chart)this.chart=this.buildChart(e,this.bubbleChartModel),this.scene.addChild(this.chart),1===e.animationStrategy&&this.chart.buildInitialAnimation(e.animationDuration),this.setUpMediatorListeners(e),this.scene.hasStageFacade()&&this.scene.getStageFacade().processUpdate(),1===e.animationStrategy&&(await this.chart.animate(e.animationDuration),void 0!==this.chart&&this.chart.setUpMouseEvents());else if(this.modelUpdated){const t=this.buildChart(e,this.bubbleChartModel),i=new s.Timeline,n=(new s.AnimationComponent).attach(t);this.chart.transition(i,n,t.exctractBubbles(),{x:this.bubbleChartModel.axesData.x,y:this.bubbleChartModel.axesData.y},t.getCanvasAxes().getXTicks(),t.getCanvasAxes().getYTicks()),i.playOverTime(1e3),await i.onDone.subscribeOnceAsPromise(),this.scene.hasStageFacade()&&this.scene.getStageFacade().processUpdate(),n.destroyAll(),n.dispose(),i.dispose(),t.dispose()}return this.oldHeight=e.dimensions.height,this.oldWidth=e.dimensions.width,this.logarithmic=this.bubbleChartModel.isLogarithmic,this}async handleCanvas(e,t={layerAmount:3}){await super.handleCanvas(e,t),$(this.canvas).addClass("tw-bubble-chart")}dispose(){this.stage.dispose(),void 0!==this.replayTimeline&&this.replayTimeline.dispose(),void 0!==this.replayAnimationComponent&&this.replayAnimationComponent.dispose()}getLayoutIterator(){return new o.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minWidth:0,minHeight:0}],e=>({width:Math.min(e.dimensions.width||0,e.dimensions.height||0),height:Math.min(e.dimensions.width||0,e.dimensions.height||0)}))}}}),define("classes/bubble_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BubbleColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){return 2===this.themeId?this.buildDarkColorPalette():this.buildLightColorPalette()}buildLightColorPalette(){return{}}buildDarkColorPalette(){return{}}}}),define("bubble_chart",["require","exports","actions/bubble_chart_actions","classes/bubble","classes/bubble_chart","classes/bubble_chart_fragment","classes/bubble_color_palette_builder","models/bubble_chart_model"],function(e,t,i,s,n,r,o,a){"use strict";function l(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),l(i),l(s),l(n),l(r),l(o),l(a)}),define("bubble_dialog_tray_controller",["require","exports","bubble_dialogs"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BubbleDialogTrayController=class{constructor(e,t){this.bubbleDialogService=e,this.options=t,this.dialogs=[],this.style=(new i.BubbleDialogStyle).setMinWidth(t.width).setWidth(t.width).setMinHeight(t.height).setHeight(t.height).setMaxHeight(t.height).setArrowSide("CENTER")}setPopUps(e){if(0===e.length)return this.reset();const t=e.map(e=>e.id);this.removePopUps(this.dialogs.filter(e=>-1===t.indexOf(e.getId())).map(e=>e.getId())),e.forEach((e,t)=>{this.hasDialog(e.id)?e.style&&this.updateStyle(e.id,e.style):setTimeout(()=>this.addPopUp(e.id,e.type,e.data,t,e.style))})}updateStyle(e,t){const i=this.getDialog(e),s=this.dialogs.indexOf(i);this.style.zIndex=1e3-s,Object.assign(this.style.clone(),t).updateStyle(i.getElement())}addPopUp(e,t,i,s=this.dialogs.length,n){const{animationSpeed:r,width:o,height:a,distanceBetweenBubbles:l,bubbleFactory:c,position:d,targetElement:h,offsetFromTargetElement:u}=this.options;this.style.zIndex=1e3-s,this.style.setPositionOffsetX(-h.width()/2+u.x+o/2),"TOP"===d?this.style.setPositionOffsetY(this.options.offsetFromTargetElement.y-h.height()-l-a+l*s):this.style.setPositionOffsetY(-this.options.offsetFromTargetElement.y-l*s);const p=this.bubbleDialogService.createReactBubble(e,h,i,c[t],Object.assign(this.style.clone(),n));p.onDestroy.subscribeOnce(()=>{const e=this.dialogs.indexOf(p);e>=0&&this.dialogs.splice(e,1)}),this.dialogs.splice(s,0,p);const g=[];for(let e=s;e<this.dialogs.length;e++)g.push(this.dialogs[e]);return p.onReady.subscribeOnce(()=>{setTimeout(()=>{g.forEach(e=>{e.move(0,this.getMoveDistance(!0),r),e.getStyle().positionOffsetY-=this.options.distanceBetweenBubbles})},100)}),p}getMoveDistance(e){const{distanceBetweenBubbles:t,position:i}=this.options;return"TOP"===i&&(e=!e),e?-t:t}reset(){this.dialogs.slice().forEach(e=>e.destroy()),this.dialogs.length=0}removePopUps(e){const{animationSpeed:t}=this.options;e.forEach(i=>{const s=this.dialogs.map(e=>e.getId()).indexOf(i);if(-1===s)return;const n=this.dialogs.splice(s,1)[0];if(n){n.move(0,this.getMoveDistance(!1),t),setTimeout(()=>n.destroy(),t);for(let i=s;i<this.dialogs.length;i++)-1===e.indexOf(this.dialogs[i].getId())&&this.dialogs[i].move(0,this.getMoveDistance(!1),t)}})}getDialog(e){return _.find(this.dialogs,t=>t.getId()===e)}hasDialog(e){return void 0!==this.getDialog(e)}}}),define("bubble_dialog_tray",["require","exports","bubble_dialog_tray_controller"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("dialog/bubble_dialog_style",["require","exports","underscore","reusable_utilities"],function(e,t,i,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TARGET=0]="TARGET",e[e.DIALOG=1]="DIALOG"}(n||(n={}));class r{constructor(){this.minWidth=300,this.minHeight=200,this.maxWidth=void 0,this.maxHeight=void 0,this.fadeIn=300,this.fadeOut=300,this.arrowSide="LEFT",this.arrowOffset=.5,this.arrowLength=10,this.arrowWidth=14,this.borderWidth=0,this.positionOffsetX=0,this.positionOffsetY=0,this.position="absolute",this.useShadow=!0,this.boxShadow=void 0,this.borderColor="black",this.borderSides={},this.color="white",this.borderRadius=0,this.absoluteX=void 0,this.absoluteY=void 0,this.virtualObjectPresence=void 0,this.absoluteXOrigin="LEFT",this.absoluteYOrigin="TOP",this.targetXOrigin="CENTER",this.overflow=void 0,this.zIndex=void 0,this.preventBoundCheck=void 0,this.lazyReposition=void 0}setColor(e){return this.color=e,this}setVirtualObjectPresence(e,t){return this.virtualObjectPresence={w:e,h:t},this}setBorderColor(e){return this.borderColor=e,this}setBorderSide(e,t){return this.borderSides[e]=t,this}setBorderWidth(e){return this.borderWidth=e,this}setMinWidth(e){return this.minWidth=e,this}setMaxWidth(e){return this.maxWidth=e,this}setMinHeight(e){return this.minHeight=e,this}setHeight(e){return this.height=e,this}setMaxHeight(e){return this.maxHeight=e,this}setArrowWidth(e){return this.arrowWidth=e,this}setArrowLength(e){return this.arrowLength=e,this}setArrowOffset(e){return this.arrowOffset=e,this}setPreferedWindowPosition(e,t,s,n){return i.isUndefined(e)||(this.minX=e),i.isUndefined(t)||(this.maxX=t),i.isUndefined(s)||(this.minY=s),i.isUndefined(n)||(this.maxY=n),this}setArrowSide(e){return this.arrowSide=e,this}clearAbsoluteX(){return this.absoluteX=void 0,this}setAbsoluteX(e){return this.absoluteX=e,this}setAbsoluteXOrigin(e){return this.absoluteXOrigin=e,this}setAbsoluteYOrigin(e){return this.absoluteYOrigin=e,this}setTargetXOrigin(e){return this.targetXOrigin=e,this}clearAbsoluteY(){return this.absoluteY=void 0,this}setAbsoluteY(e){return this.absoluteY=e,this}setBorderRadius(e){return this.borderRadius=e,this}setWidth(e){return this.width=e,this}setDisplay(e){return this.display=e,this}setFadeIn(e){return this.fadeIn=e,this}getFadeIn(){return this.fadeIn}setFadeOut(e){return this.fadeOut=e,this}setUseShadow(e){return this.useShadow=e,this}setBoxShadow(e){return this.boxShadow=e,this}setPositionOffsetX(e){return this.positionOffsetX=e,this}setPositionOffsetY(e){return this.positionOffsetY=e,this}setPosition(e){return this.position=e,this}setOverflow(e){return this.overflow=e,this}setZIndex(e){return this.zIndex=e,this}clone(){const e=new r;return i.each(Object.keys(this),t=>{e[t]=this[t]}),e}setPreventOutOfBoundCheck(e){return this.preventBoundCheck=e,this}preventOutOfBoundCheck(){return this.preventBoundCheck}computeBounds(e){const t=$(".tw-bubbles");if(t.length>0){const i=t.find(".tw-bubble-dialog.widget");if(i.length>0&&(i.is(e)||i.has(e).length>0)){const e=i.offset(),t=e.top,s=e.left,n=i.css("width"),r=i.css("height"),o=Number(r.substring(0,r.indexOf("px"))),a=s+Number(n.substring(0,n.indexOf("px"))),l=t+o;this.setPreferedWindowPosition(s,a,t,l)}else{const{left:e,right:t,top:i,bottom:n}=s.DOMMath.getPageBounds();this.setPreferedWindowPosition(e,t,i,n)}}else{const{left:e,right:t,top:i,bottom:n}=s.DOMMath.getPageBounds();this.setPreferedWindowPosition(e,t,i,n)}}calculateArrowOffsetX(e,t){return e<this.minX?Math.max(0,(t*this.arrowOffset-(this.minX+2-Math.abs(e)))/t):e+t>this.maxX?Math.min((this.maxX-2-(this.arrowWidth+this.arrowLength))/(e+t),1-(this.arrowWidth+this.arrowLength)/t):this.arrowOffset}calculateArrowOffsetY(e,t){return e<this.minY?(t*this.arrowOffset-(this.minY+2-Math.abs(e)))/t:e+t>this.maxY?Math.min((this.maxY-2-(this.arrowWidth+this.arrowLength))/(e+t),1-(this.arrowWidth+this.arrowLength)/t):this.arrowOffset}modifySettingsForFlip(e){this.absoluteYOrigin===this.arrowSide&&"TOP"===this.absoluteYOrigin&&"BOTTOM"===e&&(this.absoluteYOrigin="BOTTOM",this.virtualObjectPresence&&(this.absoluteY-=this.virtualObjectPresence.h)),this.absoluteYOrigin===this.arrowSide&&"BOTTOM"===this.absoluteYOrigin&&"TOP"===e&&(this.absoluteYOrigin="TOP",this.virtualObjectPresence&&(this.absoluteY+=this.virtualObjectPresence.h)),this.absoluteXOrigin===this.arrowSide&&"LEFT"===this.absoluteXOrigin&&"RIGHT"===e&&(this.absoluteXOrigin="RIGHT",this.virtualObjectPresence&&(this.absoluteX-=this.virtualObjectPresence.w)),"LEFT"===this.absoluteXOrigin&&"LEFT"===e&&(this.absoluteXOrigin="LEFT",this.virtualObjectPresence&&(this.absoluteX+=this.virtualObjectPresence.w))}apply(e,t){this._initializeDialogStyles(t);let s=this._getElementPresence(e,n.TARGET);const r=this._getElementPresence(t,n.DIALOG),o=t.find(".pointer"),a=t.find(".pointerBorder");if(this._configureStyleBySide(this.arrowSide,s,r,t,o,a),"CENTER"!==this.arrowSide&&!this.preventOutOfBoundCheck()){let l=this.getAlternativeSide(t);if(void 0!==l&&(this._changeDialogToAlternativeSide(l,s,r,t,o,a),this.checkOutofBounds(t,this.getBounds()))){l="CENTER";const c=this._getWidgetElement(e);i.isUndefined(c)||(s=this._getElementPresence(c,n.TARGET),this.absoluteX=s.x+s.width/2-r.width/2,this.absoluteY=s.y+s.height/2-r.height/2,this._changeDialogToAlternativeSide(l,s,r,t,o,a),this.checkOutofBounds(t,this.getBounds())&&(s=this._getElementPresence($("body"),n.TARGET),this.absoluteX=s.x+s.width/2-r.width/2,this.absoluteY=s.y+s.height/2-r.height/2,this._changeDialogToAlternativeSide(l,s,r,t,o,a)))}}this.subscribeWindowResize(e,t),void 0!==this.getFadeIn()?t.fadeTo(this.getFadeIn(),1):t.css({opacity:"1"})}destroy(){this.unsubscribeWindowResize()}updateStyle(e){e.css({"outline-width":this.outlineWidth,"outline-color":this.outlineColor,"outline-style":this.outlineStyle,"min-width":this.minWidth+"px","min-height":this.minHeight+"px",height:this.height+"px","border-width":this.borderWidth+"px","border-color":this.borderColor,position:this.position})}_initializeDialogStyles(e){this.updateStyle(e),this._applyBorderSideStyles(e);let t=this.borderRadius+"px";"string"==typeof this.borderRadius&&(t=this.borderRadius),e.css("-webkit-border-radius",t),e.css("-moz-border-radius",t),e.css("border-radius",t),this.maxWidth&&e.css("max-width",this.maxWidth+"px"),this.maxHeight&&e.css("max-height",this.maxHeight+"px"),this.overflow&&e.css("overflow",this.overflow),this.zIndex&&e.css("z-index",this.zIndex),this.useShadow&&(this.boxShadow?e.css("box-shadow",this.boxShadow):e.css("box-shadow","0 0 10px 0 #bdc3c7")),i.isUndefined(this.width)||e.css("width",this.width),i.isUndefined(this.display)||e.css("display",this.display)}_changeDialogToAlternativeSide(e,t,i,s,n,r){this.modifySettingsForFlip(e),this._alternativeSide=e,n.removeAttr("style"),r.removeAttr("style"),this._configureStyleBySide(this._alternativeSide,t,i,s,n,r)}_getWidgetElement(e){const t=e.closest(".tw-widget");if(t.length>0)return t}_applyBorderSideStyles(e){const t=this.borderSides;e.css({"border-top":t.TOP&&t.TOP+"px","border-left":t.LEFT&&t.LEFT+"px","border-bottom":t.BOTTOM&&t.BOTTOM+"px","border-right":t.RIGHT&&t.RIGHT+"px"})}_configureStyleBySide(e,t,i,s,n,r){"LEFT"===e?this._configureStyleLeft(t,i,s,n,r):"RIGHT"===e?this.configureStyleRight(t,i,s,n,r):"BOTTOM"===e?this._configureStyleBottom(t,i,s,n,r):"TOP"===e?this._configureStyleTop(t,i,s,n,r):"CENTER"===e&&this._configureStyleCenter(t,i,s,n,r)}_configureStyleLeft(e,t,i,s,n){const r=this.isAxesValuesInversible(this.arrowSide,"LEFT");let o=this.getPositionOffsetX(r);o="LEFT"!==this.arrowSide?-o:o;let a=this.getPositionOffsetY(r);a="LEFT"!==this.arrowSide?-a:a;const l=this._computeStyleLeftArrowOffset(e,t,a),c=this._computeStyleLeftEffectiveTop(e,t,a,l),d=this._computeStyleLeftEffectiveLeft(e,o);i.css({top:c,left:d}),s.css({"border-width":this.arrowWidth+"px "+this.arrowLength+"px "+this.arrowWidth+"px 0","border-color":"transparent "+this.color,left:-this.arrowLength+"px",top:t.height*l-this.arrowWidth+"px"}),this.borderWidth>0?n.css({"border-width":[this.arrowWidth+this.borderWidth-1,"px ",this.arrowLength+this.borderWidth-1,"px ",this.arrowWidth+this.borderWidth-1,"px ","0"].join(""),"border-color":"transparent "+this.borderColor,left:-this.arrowLength-1+"px",top:t.height*l-this.arrowWidth+"px"}):this.useShadow?n.css({"border-width":this.arrowWidth+"px "+this.arrowLength+"px "+this.arrowWidth+"px 0","border-color":"transparent #bdc3c7",left:-this.arrowLength-1+"px",top:t.height*l-this.arrowWidth+"px"}):n.hide()}_computeStyleLeftArrowOffset(e,t,i){let s;if(void 0!==this.absoluteY){let e=this.absoluteY;"BOTTOM"===this.absoluteYOrigin&&(e=e-t.height+i-(this.arrowWidth+this.arrowLength)),s=this.calculateArrowOffsetY(e,t.height)}else s=this.calculateArrowOffsetY(e.y+e.height+i+this.arrowWidth+this.arrowLength+this.borderWidth,t.height);return s}_computeStyleLeftEffectiveTop(e,t,i,s){let n;return void 0!==this.absoluteY?(n=this.absoluteY,"BOTTOM"===this.absoluteYOrigin&&(n=n-t.height*s+i+this.borderWidth),"CENTER"===this.absoluteYOrigin&&(n=n-t.height*s+i+this.borderWidth)):n=e.y+e.height/2+i-t.height*s-this.borderWidth,n}_computeStyleLeftEffectiveLeft(e,t){return void 0!==this.absoluteX?"CENTER"===this.absoluteXOrigin?this.absoluteX+t+this.arrowWidth+this.borderWidth:this.absoluteX:e.x+e.width+t+this.arrowWidth-this.borderWidth}configureStyleRight(e,t,i,s,n){const r=this.getPositionOffsetX(this.isAxesValuesInversible(this.arrowSide,"RIGHT")),o=this.getPositionOffsetY(this.isAxesValuesInversible(this.arrowSide,"RIGHT")),a=this._computeStyleRightArrowOffset(e,t,o),l=this._computeStyleRightEffectiveTop(e,t,o,a),c=this._computeStyleRightEffectiveLeft(e,t,r);i.css({top:l,left:c}),s.css({"border-width":`${this.arrowWidth}px 0 ${this.arrowWidth}px ${this.arrowWidth}px`,"border-color":"transparent "+this.color,right:-this.arrowWidth+"px",top:t.height*a-this.arrowWidth+"px"}),this.borderWidth>0?n.css({"border-width":[this.arrowWidth+this.borderWidth-1,"px ","0 ",this.arrowWidth+this.borderWidth-1,"px ",this.arrowWidth+this.borderWidth-1,"px"].join(""),"border-color":"transparent "+this.borderColor,right:-this.arrowWidth-1+"px",top:[t.height*a-this.arrowWidth,"px"].join("")}):this.useShadow?n.css({"border-width":[this.arrowWidth,"px ","0 ",this.arrowWidth,"px ",this.arrowWidth,"px"].join(""),"border-color":"transparent #bdc3c7",right:-this.arrowWidth-1+"px",top:t.height*a-this.arrowWidth+"px"}):n.hide()}_computeStyleRightArrowOffset(e,t,i){if(void 0!==this.absoluteY){let e=this.absoluteY;return"BOTTOM"===this.absoluteYOrigin&&(e=e-t.height+i-this.arrowWidth-this.arrowLength),this.calculateArrowOffsetY(e,t.height)}return this.calculateArrowOffsetY(e.y+e.height+i+this.arrowWidth+this.arrowLength+this.borderWidth,t.height)}_computeStyleRightEffectiveTop(e,t,i,s){return void 0!==this.absoluteY?this.absoluteY-t.height*s+i+this.borderWidth:e.y+e.height/2+i-t.height*s-this.borderWidth}_computeStyleRightEffectiveLeft(e,t,i){let s;return s=void 0!==this.absoluteX?this.absoluteX-t.width+i-this.arrowWidth+this.borderWidth:e.x+i-this.arrowWidth-this.borderWidth-t.width}_configureStyleBottom(e,t,i,s,n){const r=this.getPositionOffsetX(this.isAxesValuesInversible(this.arrowSide,"BOTTOM")),o=this.getPositionOffsetY(this.isAxesValuesInversible(this.arrowSide,"BOTTOM")),a=this._computeStyleBottomArrowOffset(e,t,r),l=this._computeStyleBottomEffectiveTop(e,t,o),c=this._computeStyleBottomEffectiveLeft(e,t,r,a);i.css({top:l,left:c}),s.css({"border-width":this.arrowLength+"px "+this.arrowWidth+"px 0","border-color":this.color+" transparent",bottom:-this.arrowLength+"px",left:t.width*a-this.arrowWidth+"px"}),this.borderWidth>0?n.css({"border-width":[this.arrowLength+this.borderWidth-2,"px ",this.arrowWidth+this.borderWidth-1,"px ","0"].join(""),"border-color":this.borderColor+" transparent",bottom:-this.arrowLength-1+"px",left:t.width*a-this.arrowWidth+"px"}):this.useShadow?n.css({"border-width":this.arrowLength+"px "+this.arrowWidth+"px 0","border-color":"#bdc3c7 transparent",bottom:-this.arrowLength-1+"px",left:t.width*a-this.arrowWidth+"px"}):n.hide()}_computeStyleBottomArrowOffset(e,t,i){let s;if(void 0!==this.absoluteX){let e=this.absoluteX;"CENTER"===this.absoluteXOrigin&&(e=e-t.width*this.arrowOffset+i),s=this.calculateArrowOffsetX(e,t.width)}else s=this.calculateArrowOffsetX(e.x+i+e.width/2-t.width*this.arrowOffset-this.borderWidth,t.width);return s}_computeStyleBottomEffectiveTop(e,t,i){return void 0!==this.absoluteY?this.absoluteY-t.height+i-this.arrowLength:e.y-t.height+i-this.borderWidth-this.arrowLength}_computeStyleBottomEffectiveLeft(e,t,i,s){return void 0!==this.absoluteX?this.absoluteX-t.width*s+i+this.borderWidth:e.x+i+e.width/2-t.width*s-this.borderWidth}_configureStyleTop(e,t,i,s,n){const r=this.getPositionOffsetX(this.isAxesValuesInversible(this.arrowSide,"TOP")),o=this.getPositionOffsetY(this.isAxesValuesInversible(this.arrowSide,"TOP")),a=this._computeStyleTopArrowOffset(e,t,r),l=this._computeStyleTopEffectiveTop(e,t,o),c=this._computeStyleTopEffectiveLeft(e,t,r,a);i.css({top:l,left:c}),s.css({"border-width":"0 "+this.arrowWidth+"px "+this.arrowLength+"px ","border-color":this.color+" transparent",top:-this.arrowLength+"px",left:t.width*a-this.arrowWidth+"px"}),this.borderWidth>0?n.css({"border-width":["0 ",this.arrowWidth+this.borderWidth-1,"px ",this.arrowLength+this.borderWidth-1,"px "].join(""),"border-color":this.borderColor+" transparent",top:-this.arrowLength-1+"px",left:t.width*a-this.arrowWidth+"px"}):this.useShadow?n.css({"border-width":"0 "+this.arrowWidth+"px "+this.arrowLength+"px ","border-color":"#bdc3c7 transparent",top:-this.arrowLength-1+"px",left:t.width*a-this.arrowWidth+"px"}):n.hide()}_computeStyleTopArrowOffset(e,t,i){let s;if(void 0!==this.absoluteX){let e=this.absoluteX;"CENTER"===this.absoluteXOrigin&&(e=e-t.width*this.arrowOffset+i),s=this.calculateArrowOffsetX(e,t.width)}else"CENTER"===this.targetXOrigin?s=this.calculateArrowOffsetX(e.x+i+e.width/2-this.borderWidth-this.arrowWidth-t.width*this.arrowOffset,t.width):"RIGHT"===this.targetXOrigin&&(s=this.calculateArrowOffsetX(e.x+i+e.width-this.borderWidth-this.arrowWidth-t.width*this.arrowOffset,t.width));return s}_computeStyleTopEffectiveTop(e,t,i){return void 0!==this.absoluteY?"BOTTOM"===this.absoluteYOrigin?this.absoluteY-t.height-i+this.arrowLength:"TOP"===this.absoluteYOrigin?this.absoluteY-i+this.arrowLength:this.absoluteY:e.y+e.height-i+this.borderWidth+this.arrowLength}_computeStyleTopEffectiveLeft(e,t,i,s){return void 0!==this.absoluteX?this.absoluteX-t.width*s+i+this.borderWidth:"RIGHT"===this.targetXOrigin?e.x+i+e.width-t.width-this.borderWidth:e.x+i+e.width/2-t.width*s-this.borderWidth}_configureStyleCenter(e,t,i,s,n){const r=void 0!==this.absoluteX?this.absoluteX:e.x+t.width/2+this.positionOffsetX+e.width/2-this.borderWidth-t.width/2,o=void 0!==this.absoluteY?this.absoluteY:e.y+e.height+this.positionOffsetY+this.borderWidth;i.css({top:o,left:r}),void 0===this.absoluteX&&i.css({transform:"translateX(-50%)"}),s.hide(),n.hide()}_getElementPresence(e,t){let i;try{i=e[0].getBBox&&e[0].getBBox()}catch(e){i={x:0,y:0,width:0,height:0}}let s=void 0!==i&&i.width||e.outerWidth()||Number(e.attr("width"))||e.context.clientWidth||0,r=void 0!==i&&i.height||e.outerHeight()||Number(e.attr("height"))||e.context.clientHeight||0;return t===n.DIALOG&&(s=Math.max(s,this.minWidth),r=Math.max(r,this.minHeight)),e[0]?e[0]&&e[0].viewportElement&&void 0!==i?{x:$(e[0].viewportElement).offset().left+i.x,y:e.offset().top,width:s,height:r}:{x:e.offset().left,y:e.offset().top,width:s,height:r}:{x:e.context.offsetLeft,y:e.context.offsetTop,width:s,height:r}}getBounds(){return{left:this.minX,right:this.maxX,top:this.minY,bottom:this.maxY}}getAlternativeSide(e){const t=this.getBounds();return this.checkOverTopBound(e,t)?"TOP":this.checkOverBottomBound(e,t)?"BOTTOM":this._checkOverLeftBound(e,t)?"LEFT":this.checkOverRightBound(e,t)?"RIGHT":void 0}checkOutofBounds(e,t){const i=[this.checkOverTopBound,this.checkOverBottomBound,this._checkOverLeftBound,this.checkOverRightBound];for(let s=0;s<i.length;s++){if(i[s](e,t))return!0}return!1}checkOverTopBound(e,t){return Number(e.css("top").substring(0,e.css("top").indexOf("px")))<t.top}checkOverBottomBound(e,t){const i=e.css("top"),s=Number(i.substring(0,i.indexOf("px"))),n=e.css("height");return s+Number(n.substring(0,n.indexOf("px")))>t.bottom}_checkOverLeftBound(e,t){const i=Number(e.css("left").substring(0,e.css("left").indexOf("px")));let s=$("#wrapper");return 0===s.length&&(s=$("body")),!(s.length>0)||i<t.left}checkOverRightBound(e,t){const i=Number(e.css("width").substring(0,e.css("width").indexOf("px"))),s=Number(e.css("left").substring(0,e.css("left").indexOf("px")));let n=$("#wrapper");return 0===n.length&&(n=$("body")),!(n.length>0)||s+i>t.right}isAxesValuesInversible(e,t){const s=["LEFT","RIGHT"],n=["TOP","BOTTOM"];return!(!i.contains(s,e)||i.contains(s,t))||i.contains(n,e)&&!i.contains(n,t)}getPositionOffsetX(e){return e?this.positionOffsetY:this.positionOffsetX}getPositionOffsetY(e){return e?this.positionOffsetX:this.positionOffsetY}subscribeWindowResize(e,t){this.lazyReposition=i.debounce(()=>{this.apply(e,t)},250),$(window).on("resize",this.lazyReposition)}unsubscribeWindowResize(){this.lazyReposition&&$(window).off("resize",this.lazyReposition)}}t.BubbleDialogStyle=r}),define("dialog/log_features",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bubbleDialogLogFeature={name:"BUBBLE_DIALOG",style:"color:indigo; font-weight:bold"}}),define("dialog/bubble_facade",["require","exports","event","log","underscore","angular_utilities","reusable_utilities","dialog/log_features"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=200;let c=0;t.BubbleFacade=class{constructor(e){this.fadeBackground=!1,this.SINGLE_FADE_BACKGROUND_Z_INDEX=1038,this.cancellationToken=new o.CancellationToken,this.onMouseEnter=new i.Event,this.onMouseLeave=new i.Event,this.onOpen=new i.Event,this.onMessage=new i.Event,this.onDestroy=new i.Event,this.onReady=new i.Event,this.onElementUpdate=new i.Event,this.mouseOver=!1,this.config=e.config,this.data=e,this.destructionRequested=!1,this.destructing=!1,this.ready=!1,this.imagesToLoad={},this.children=[],this.parent=e.parent,this.fadeBackground=void 0!==e.config&&e.config.fadeBackground||!1,this.spawn(e)}spawn(e){const{timeout:t}=e.config;if(void 0!==t){const{delay:e}=t;this.spawnBubbleAsync(e)}else this.spawnBubbleSync()}async spawnBubbleSync(){if(this.disposed)return void s.logService.error("timeout cancel failed",a.bubbleDialogLogFeature,this);const e=await this.createBubble();this.isDisposed()?e.template.remove():this.postBubbleCreation(e.template)}postBubbleCreation(e){this.bubbleElement=e,this.cancellationToken.setTimeout(()=>{if(this.fadeBackground){c++;const e=this.bubbleElement.parent().find(".tw-fade-page");if(0===e.length){const e=$('<div class="tw-fade-page"></div>');this.cancellationToken.addCleanupFunction(()=>{this.removeFadeBackground(e)}),this.bubbleElement.after(e),n.defer(()=>{e.addClass("show")})}else if(this.cancellationToken.addCleanupFunction(()=>{this.removeFadeBackground(e)}),this.config.fadeOtherBubbles){const t=Number(e.css("zIndex"));e.css({zIndex:t+1})}}this.config.preventOutsideClickActions&&$(".tw-container").css({"pointer-events":"none"}),this.bubbleElement&&(this.bubbleElement.mouseenter(e=>{this.onMouseEnter.fire(e),this.mouseOver=!0}),this.bubbleElement.mouseleave(e=>{this.onMouseLeave.fire(e),this.mouseOver=!1})),this.checkReady(),this.registerAsChild(),this.isWatchingElement()&&this.setupWatcher()},0),this.onOpen.fire()}removeFadeBackground(e){c--;const t=Number(e.first().css("zIndex"));t>this.SINGLE_FADE_BACKGROUND_Z_INDEX?e.css({zIndex:t-1}):0===c&&(e.hasClass("show")?(e.removeClass("show"),setTimeout(()=>{e.remove()},500)):e.remove())}move(e,t,i){this.bubbleElement&&this.bubbleElement.animate({left:`+=${e}px`,top:`+=${t}px`},i)}scheduleDestruction(e){this.isDisposed()||(this.destructionRequested=!0,this.destructionTimeout=this.cancellationToken.setTimeout(()=>{this.destructionTimeout=void 0,this.destroy()},e))}cancelDestruction(){this.destructionRequested=!1,this.destructionTimeout&&clearTimeout(this.destructionTimeout)}spawnBubbleAsync(e){this.bubbleCreationTimeout=setTimeout(()=>{this.bubbleCreationTimeout=void 0,this.spawnBubbleSync()},e)}setupWatcher(){const{interval:e=l}=this.getWatchParameters();this.watchHandle=this.cancellationToken.setInterval(this.watchElementForChanges.bind(this),e)}watchElementForChanges(){const e=this.getReferenceElement();if(e){let t=e,i=!1;for(;t.parent()[0];){if("0"===t.css("opacity")){this.getElement().css("display","none"),i=!0;break}t=t.parent()}i||this.getElement().css("display","");const s=e.offset();if(void 0!==this.referenceOffset){const{left:e,top:t}=this.referenceOffset,{threshold:i=0,autoUpdate:n}=this.getWatchParameters();(Math.abs(s.left-e)>i||Math.abs(s.top-t)>i)&&(this.onElementUpdate.fire({left:s.left-e,top:s.top-t}),n&&this.getStyle().apply(this.getReferenceElement(),this.getElement()))}this.referenceOffset=s}}isDestructionScheduled(){return this.destructionRequested}isBuilt(){return void 0!==this.getElement()&&!this.isDisposed()}isDisposed(){return this.disposed}isPersistent(){return this.getConfig().persist}isWatchingElement(){return void 0!==this.getWatchParameters()&&!0===this.getWatchParameters().enable}getWatchParameters(){return this.getConfig().watchElement}createBubble(){return r.directiveService.inject(this.config.$compile,this.config.parentElement,this.config.angularDirectivePrefix+this.getType(),{directiveArguments:{payload:this.getPayload(),id:this.getId(),"reference-element":this.getReferenceElement(),"style-information":this.getStyle(),facade:this},parentScope:this.config.parentScope})}registerAsChild(){void 0===this.parent||this.parent.isDisposed()||this.parent.children.push(this)}destroyChildren(){this.children.length>0&&this.children.forEach(e=>e.scheduleDestruction(e.destructionTimeout))}checkReady(){this.ready=this.checkForImages(),this.ready&&this.onReady.fire()}allImagesLoaded(){return!this.imagesToLoad||n.reduce(this.imagesToLoad,(e,t)=>e&&t,!0)}imageCallback(e){this.imagesToLoad[e]=!0,this.ready=this.allImagesLoaded(),this.ready&&this.onReady.fire()}checkForImages(){const e=this.getElement().find("img");return e.length>0&&n.forEach(e,e=>{!e.complete&&e.src?(this.imagesToLoad[e.src]=!1,e.onerror=this.imageCallback.bind(this,e.src),e.onload=this.imageCallback.bind(this,e.src)):this.imagesToLoad[e.src]=!0}),this.allImagesLoaded()}getElement(){return this.bubbleElement}destroy(){if(s.logService.debug("destroy called",a.bubbleDialogLogFeature,this),!this.isDisposed()&&!this.destructing){if(this.destructing=!0,this.config.preventOutsideClickActions&&$(".tw-container").css({"pointer-events":""}),void 0!==this.bubbleCreationTimeout)s.logService.verbose("timeout canceled",a.bubbleDialogLogFeature,this),clearTimeout(this.bubbleCreationTimeout),this.disposed=!0,this.cancellationToken.cancel(),this.onDestroy.fire();else if(void 0!==this.getElement()){s.logService.verbose("element !== undefined",a.bubbleDialogLogFeature,this);const e=this.getElement().scope();e&&e.$destroy(),void 0!==this.getStyle().fadeOut?(this.cancellationToken.setTimeout(()=>{s.logService.verbose("timeout fade",a.bubbleDialogLogFeature,this),this.getElement()&&(this.getElement().remove(),this.bubbleElement=void 0),this.disposed=!0,this.cancellationToken.cancel(),this.onDestroy.fire()},this.getStyle().fadeOut),this.getElement().fadeOut(this.getStyle().fadeOut)):(s.logService.verbose("direct destroy",a.bubbleDialogLogFeature,this),this.onDestroy.fire(),this.cancellationToken.cancel(),this.getElement().remove(),this.bubbleElement=void 0,this.disposed=!0)}else this.cancellationToken.setTimeout(()=>{s.logService.verbose("destroy during scope apply",a.bubbleDialogLogFeature,this),void 0!==this.getElement()&&(this.getElement().remove(),this.bubbleElement=void 0),this.disposed=!0,this.cancellationToken.cancel(),this.onDestroy.fire()});this.destroyChildren(),this.getStyle().destroy(),void 0!==this.watchHandle&&clearInterval(this.watchHandle)}}getReferenceElement(){return this.data.referenceElement}isReferenceElement(e){return this.getReferenceElement()===e||this.getReferenceElement().get(0)===e}getStyle(){return this.data.style}getScope(){const e=this.getElement().scope()&&this.getElement().scope().$$childHead;return null===e?void 0:e}hasScope(){return void 0!==this.getScope()}getScopeApplication(){return this.hasScope()&&this.getScope().application||void 0}hasScopeApplication(){return void 0!==this.getScopeApplication}getId(){return this.data.id}getType(){return this.data.type}getPayload(){return this.data.payload}getConfig(){return this.config}isMouseOver(){return this.mouseOver}isReady(){return this.ready}refreshStyle(){this.isBuilt()&&this.getStyle().apply(this.getReferenceElement(),this.getElement())}}}),define("bubble_dialog",["require","exports","log","dialog/bubble_facade","underscore","event_bus","dialog/log_features"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BubbleDialogService=class{constructor(e){this.defaultConfig=e,this.openBubbles=[]}createByType(e,t,a,l,c,d,h){const u=new i.LogCluster(`Created bubble ${a}`,i.logService.logLevel.VERBOSE,o.bubbleDialogLogFeature,!0);u.addObject({id:e,targetElement:t,type:a,payload:l,style:c,config:d,parent:h},!1);const p=this.computeDialogConfiguration(d);c.computeBounds($(t));const g=new s.BubbleFacade({id:e,referenceElement:$(t),type:a,payload:l,style:c,config:p,parent:h});return g.onDestroy.subscribeOnce(()=>{this.openBubbles=n(this.openBubbles).filter(e=>(e===g&&i.logService.debug("Removed bubble ",o.bubbleDialogLogFeature,e),e!==g))}),i.logService.debug("Added bubble ",o.bubbleDialogLogFeature,g),this.openBubbles.push(g),u.writeLog(),r.eventBus.dispatch({type:r.EVENT_TYPES.BUBBLE_DIALOG_CREATED,value:{id:g.getId(),type:g.getType()}}),g}createReactBubble(e,t,i,s,n,r,o){return this.createByType(e,t,"react",{componentFactory:s,payload:i},n,r,o)}computeDialogConfiguration(e){return n.assign({},this.defaultConfig,e)}getFirstBubbleById(e){return n(this.openBubbles).find(t=>t.getId()===e)}getBubblesById(e){return n(this.openBubbles).filter(t=>t.getId()===e)}destroyById(e){for(let t=this.openBubbles.length-1;t>=0;t--)this.openBubbles[t].getId()===e&&this.openBubbles[t].destroy()}find(e){return n(this.openBubbles).filter(t=>!0===e(t))}scheduleDestructionById(e,t){this.getBubblesById(e).forEach(e=>e.scheduleDestruction(t))}cancelDestructionById(e){this.getBubblesById(e).forEach(e=>e.cancelDestruction())}destroyAll(){this.openBubbles.forEach(e=>e.destroy())}destroyAllNonPersistent(){this.openBubbles.forEach(e=>{e.isPersistent()||e.destroy()})}getBubbles(){return this.openBubbles.slice()}}}),define("bubble_dialogs",["require","exports","bubble_dialog","dialog/bubble_dialog_style","dialog/bubble_facade"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("global_cache",["require","exports","log","metrics_service","event"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheDebug={logCache:new n.Event},t.CacheDebug.logCache.subscribe(()=>{r.log()});class r{static addInstance(e,t){void 0!==this.cache[e]&&i.logService.error("Cache id ",{name:e}," is already in use!"),this.cache[e]=t,1===Object.keys(this.cache).length&&window.setInterval(()=>{Object.keys(this.numReads).forEach(e=>{this.numReads[e].hasChanged&&(s.MetricsService.dispatchStats("metrics.cache.read",{cacheId:e,value:this.numReads[e].value}),this.numReads[e].hasChanged=!1)}),Object.keys(this.numWrites).forEach(e=>{this.numWrites[e].hasChanged&&(s.MetricsService.dispatchStats("metrics.cache.read",{cacheId:e,value:this.numWrites[e].value}),this.numWrites[e].hasChanged=!1)})},1e4)}static onRead(e){void 0===this.numReads[e]?this.numReads[e]={hasChanged:!0,value:1}:(this.numReads[e].value++,this.numReads[e].hasChanged=!0)}static onWrite(e){void 0===this.numWrites[e]?this.numWrites[e]={hasChanged:!0,value:1}:(this.numWrites[e].value++,this.numWrites[e].hasChanged=!0)}static getInstance(e){return this.cache[e]}static removeInstance(e){delete this.cache[e]}static log(){console.log("GLOBAL CACHE DATA ENTRIES:"),console.log("###############"),Object.keys(this.cache).forEach(e=>{console.log("CACHE ID: ",e),console.log("CURRENT ENTRIES:"),this.cache[e].log(),console.log("###############")})}}r.cache={},r.numReads={},r.numWrites={},t.GlobalCache=r}),define("key_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.KeyMap=class{constructor(){this.stringMap={},this.numberMap={}}set(e,t){"number"==typeof e?this.numberMap[e]=t:this.stringMap[e]=t}has(e){return"number"==typeof e?void 0!==this.numberMap[e]:void 0!==this.stringMap[e]}remove(e){"number"==typeof e?delete this.numberMap[e]:delete this.stringMap[e]}get(e){return"number"==typeof e?this.numberMap[e]:this.stringMap[e]}clear(){this.stringMap={},this.numberMap={}}}}),define("cache_entry",["require","exports","global_cache"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CacheEntry=class{constructor(e,t,i){this.key=e,this.cache=t,this.id=i}set(e){return this.cache.set(this.key,e),i.GlobalCache.onWrite(this.id),this}get(){return i.GlobalCache.onRead(this.id),this.cache.get(this.key)}hasValue(){return!this.cache.has(this.key)}clear(){return this.cache.delete(this.key),this}}}),define("abstract_cache",["require","exports","global_cache"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractCache=class{constructor(e,t){this.id=e,this.cache=new WeakMap,this.type=t,i.GlobalCache.addInstance(e,this)}getType(){return this.type}addEntry(e,...t){}log(){console.dir(this.cache)}hasEntry(e){return!1}getEntry(e){}dispose(){i.GlobalCache.removeInstance(this.id)}}}),define("cache_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{}i.WEAK="WeakCache",i.NORMAL="Cache",t.CACHE_TYPES=i}),define("cache",["require","exports","abstract_cache","key_map","cache_entry","log","cache_types"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Cache=class extends i.AbstractCache{constructor(e){super(e,o.CACHE_TYPES.NORMAL),this.id=e,this.cache=new WeakMap,this.keyMap=new s.KeyMap}log(){super.log()}createCacheKey(e){const t={id:e};return this.keyMap.set(e,t),t}addEntry(e,t){this.hasEntry(e)&&r.logService.error("Key ",{}," already in use!"),void 0!==e&&null!==e||r.logService.error("Key can not be null or undefined!");const i=this.createCacheKey(e),s=new n.CacheEntry(i,this.cache,this.id);return t.registerCleanupFunction(()=>{this.keyMap.remove(e)}),s}hasEntry(e){return this.cache.has(this.keyMap.get(e))}getEntry(e){return new n.CacheEntry(this.keyMap.get(e),this.cache,this.id)}dispose(){this.keyMap.clear(),super.dispose()}}}),define("weak_cache",["require","exports","cache_entry","abstract_cache","cache_types","log"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WeakCache=class extends s.AbstractCache{constructor(e){super(e,n.CACHE_TYPES.WEAK),this.id=e,this.cache=new WeakMap,this.cacheEntries=new WeakMap}log(){super.log()}addEntry(e){this.hasEntry(e)&&r.logService.error("Key ",e," already in use!"),void 0!==e&&null!==e||r.logService.error("Key can not be null or undefined!");const t=new i.CacheEntry(e,this.cache,this.id);return this.cacheEntries.set(e,t),t}hasEntry(e){return this.cacheEntries.has(e)}getEntry(e){return this.cacheEntries.get(e)}dispose(){super.dispose()}}}),define("cache_service",["require","exports","abstract_cache","cache","cache_entry","cache_types","global_cache","key_map","weak_cache"],function(e,t,i,s,n,r,o,a,l){"use strict";function c(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),c(i),c(s),c(n),c(r),c(o),c(a),c(l)}),define("classes/canvas_axes_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/abstract_axis",["require","exports","canvas_engine"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractAxis=class extends i.Entity{constructor(e,t,i,s){super(e),this.maxLength=t,this.axisData=i,this.color=s}}}),define("classes/axes_label",["require","exports","canvas_engine"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s extends i.Entity{constructor(e,t,n,r,o,a){super(e),this.value=t,this.color=n,this.scaling=r,this.percentageBased=o,this.numberFormatter=a;const l=new i.LabelSettings;l.setColor(this.color).setFontSize(l.getFontSize()*this.scaling),this.label=new i.LabelComponent(i.Presence.zeroTopLeft(),s.formatLabel(t,a,o),l),this.addComponent(this.label)}setLabelOrigin(e){return this.label.setOrigin(e),this}replayTransition(e,t){t.unshift(this.value);const i=1/t.length;e.onStep.subscribe(e=>{const n=t[Math.ceil((t.length-1)*e)],r=(t[Math.ceil((t.length-1)*e)+1]-n)*(e/Math.ceil(t.length*e)/i),o=s.formatLabel(n+r,this.numberFormatter,this.percentageBased);this.label.setText(o)})}getValue(){return this.value}getPosition(){return this.getPresence().toPoint()}transition(e,t,i,n,r){const o=this.value,a=n-o;return n!==o&&e.onStep.subscribe(e=>{const t=o+a*e,i=s.formatLabel(t,this.numberFormatter,this.percentageBased);this.label.setText(i)}),void 0!==r&&e.addSequence(t.tween(this,[{key:"presence",value:r,duration:i}],this.getNodeId()+"transition")),this.value=n,this}static formatLabel(e,t,i){return i?t.toPercentage(e/100):t.toInteger(e)}}t.AxesLabel=s}),define("classes/x_axis",["require","exports","classes/abstract_axis","canvas_engine"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.XAxis=class extends i.AbstractAxis{constructor(e,t,i,s){super(e,t,i,s),this.createLine()}createLine(){return this.line=new s.LineComponent(s.Presence.zeroTopLeft(),new s.Point(this.maxLength,0)),this.line.setStyle(s.Style.BorderColor,this.color).setStyle(s.Style.BorderThickness,2),this.addComponent(this.line),this}buildInitialAnimation(e,t,i,s){const n=this.line.getPoints()[0];return e.addSequence(t.tween(n,[{key:"x",value:n.getX(),duration:i}],this.line.getNodeId()+"init1")),n.setX(0),void 0!==s&&(e.addSequence(t.tween(this.line,[{key:"presence",value:this.line.getPresence().toRelativePoint(),duration:i}],this.line.getNodeId()+"init2")),this.line.getPresence().setX(s.getX())),this}}}),define("classes/y_axis",["require","exports","classes/abstract_axis","canvas_engine"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.YAxis=class extends i.AbstractAxis{constructor(e,t,i,s){super(e,t,i,s),this.createLine()}createLine(){return this.line=new s.LineComponent(s.Presence.zeroTopLeft(),new s.Point(0,this.maxLength)),this.line.setStyle(s.Style.BorderColor,this.color).setStyle(s.Style.BorderThickness,2),this.addComponent(this.line),this}buildInitialAnimation(e,t,i,s){if(e.addSequence(t.tween(this.line,[{key:"presence",value:this.line.getPresence().toRelativePoint(),duration:i}],this.line.getNodeId()+"init")),void 0!==s){const n=this.line.getPoints()[0];e.addSequence(t.tween(n,[{key:"y",value:n.getY(),duration:i}],this.line.getNodeId()+"init1")),n.setY(0),this.line.getPresence().setY(s.getY())}else this.line.getPresence().setY(this.maxLength);return this}}}),define("classes/grid",["require","exports","canvas_engine"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=65,n=40;t.Grid=class extends i.Entity{constructor(e,t){super(e),this.settings=t,this.xLines=[],this.yLines=[],this.marginBottom=t.marginBottom+t.marginTop,this.createXLines(),this.createYLines()}getMarginBottom(){return this.marginBottom}transition(e,t,i,s){return this.yLines.forEach(n=>{const r=n.getPoints()[0];e.addSequence(t.tween(r,[{key:"y",value:r.getY()+s[0],duration:i}],n.getNodeId()+"transition"))}),this.xLines.forEach((n,r)=>{e.addSequence(t.tween(n,[{key:"presence",value:n.getPresence().toPoint().translate(0,s[r]),duration:i}],n.getNodeId()+"transition"))}),this}buildNormalInitialAnimation(e,t,i){let s=i/this.xLines.length,n=0;this.xLines.reverse().forEach(r=>{const o=i-n,a=r.getPoints()[0];e.addSequence(t.tween(a,[{key:"x",value:a.getX(),duration:o}],r.getNodeId()+"init"),n),a.setX(0),n+=s}),n=0,s=i/this.yLines.length,this.yLines.forEach(r=>{const o=i-n;e.addSequence(t.tween(r,[{key:"presence",value:r.getPresence().toPoint(),duration:o}],r.getNodeId()+"init"),n),r.getPresence().setY(this.settings.height),n+=s})}buildCenteredInitialAnimation(e,t,i){let s=i/this.xLines.length,n=0;const r=this.getCenterPoint();this.xLines.forEach(o=>{const a=i-n,l=o.getPoints()[0];e.addSequence(t.tween(l,[{key:"x",value:l.getX(),duration:a}],o.getNodeId()+"init1"),n),e.addSequence(t.tween(o,[{key:"presence",value:o.getPresence().toPoint(),duration:a}],o.getNodeId()+"init2"),n),l.setX(0),o.getPresence().setX(r.getX()),n+=s}),n=0,s=i/this.yLines.length,this.yLines.forEach(o=>{const a=i-n,l=o.getPoints()[0];e.addSequence(t.tween(l,[{key:"y",value:l.getY(),duration:a}],o.getNodeId()+"init1"),n),e.addSequence(t.tween(o,[{key:"presence",value:o.getPresence().toPoint(),duration:a}],o.getNodeId()+"init"),n),l.setY(0),o.getPresence().setY(r.getY()),n+=s})}buildInitialAnimation(e,t,i){return this.settings.centered?this.buildCenteredInitialAnimation(e,t,i):this.buildNormalInitialAnimation(e,t,i),this}getOffsetTop(){return Math.max(n,this.settings.marginTop||0)}getOffsetLeft(){return Math.max(s,this.settings.offsetLeft||0)}getOffsetRight(){return Math.max(s,this.settings.offsetRight||0)}getYCoordinates(){return this.xLines.map(e=>e.getPresence().getY())}getXCoordinates(){return this.yLines.map(e=>e.getPresence().getX())}getCenterPoint(){const e=this.getYCoordinates(),t=this.getXCoordinates();let s=e.length-1,n=0;this.settings.centered&&(s=Math.ceil(s/2),n=Math.ceil((t.length-1)/2));const r=e[s],o=t[n];return new i.Point(o,r)}createXLines(){this.xLines=this.xLines.filter(e=>(this.removeComponent(e,!0),!1));const e=this.settings.numXLines;let t=this.getOffsetTop(),s=0;const n=this.settings.height+this.settings.marginBottom+this.settings.marginTop;n<200?s=30:n<290&&(s=20);const r=Math.round((this.settings.height-s)/e);for(let s=0;s<e;s++){const e=new i.LineComponent(new i.Presence(0,t),new i.Point(this.settings.width,0));e.setStyle(i.Style.BorderColor,this.settings.color).setStyle(i.Style.BorderThickness,1).setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Center).setStyle(i.Style.LineDash,[10,8]),this.addComponent(e),this.xLines.push(e),t+=r}return this}createYLines(){this.yLines=this.yLines.filter(e=>(this.removeComponent(e,!0),!1));const e=this.settings.numYLines,t=Math.round((this.settings.width-this.getOffsetRight())/e);let s=this.getOffsetLeft();for(let n=0;n<e;n++){const e=new i.LineComponent(new i.Presence(s,0),new i.Point(0,this.settings.centered?this.settings.height+this.marginBottom:_.last(this.xLines).getY()));e.setStyle(i.Style.BorderColor,this.settings.color).setStyle(i.Style.BorderThickness,1).setStyle(i.Style.StrokeAlignment,i.Constants.StrokeAlignment.Center).setStyle(i.Style.LineDash,[10,8]),this.addComponent(e),this.yLines.push(e),s+=t}return this}}}),define("classes/canvas_axes",["require","exports","canvas_engine","classes/x_axis","classes/y_axis","classes/grid","classes/axes_label","widget_base","math_utils"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasAxes=class extends i.Entity{constructor(e,t,i){super(e),this.axesData=t,this.settings=i,this.yTicks=[],this.xTicks=[],void 0===i.marginBottom&&(i.marginBottom=20),this.compute()}getMarginBottom(){return this.grid.getMarginBottom()}replayTransition(e,t){const i=[],s=[];return t.forEach(e=>{this.prepareLabelValues(e.x,this.getNumXTicks(),this.settings.logarithmicX).forEach((e,t)=>{void 0===i[t]&&(i[t]=[]),i[t].push(e)}),this.prepareLabelValues(e.y,this.getNumYTicks(),this.settings.logarithmicY).forEach((e,t)=>{void 0===s[t]&&(s[t]=[]),s[t].push(e)})}),this.xTicks.forEach((t,s)=>{t.replayTransition(e,i[s])}),this.yTicks.forEach((t,i)=>{t.replayTransition(e,s[i])}),this}getYTicks(){return this.yTicks}getXTicks(){return this.xTicks}transition(e,t,i,s,n,r){this.axesData=s;const o=this.yTicks.map((e,t)=>r[t].getPresence().getY()-e.getPresence().getY());return this.grid.transition(e,t,i,o.reverse()),this.yTicks.forEach((s,n)=>{s.transition(e,t,i,r[n].getValue(),r[n].getPosition())}),this.xTicks.forEach((s,r)=>{s.transition(e,t,i,n[r].getValue(),n[r].getPosition())}),e.addSequence(t.tween(this.xAxis,[{key:"presence",value:this.xAxis.getPresence().toPoint().translate(0,o[0]),duration:i}],this.xAxis.getNodeId()+"transition")),this}getNumXTicks(){return this.hasNegative()&&this.settings.numXTicks%2==0?this.settings.numXTicks:this.settings.numXTicks-1}getNumYTicks(){return this.hasNegative()&&this.settings.numYTicks%2!=0?this.settings.numYTicks+1:this.settings.numYTicks}buildInitialAnimation(e,t,s){const n=this.grid.getCenterPoint();this.grid.buildInitialAnimation(e,t,s);let r=s/this.xTicks.length,o=0;return this.xTicks.forEach(n=>{e.addSequence(t.tween(n,[{key:i.Style.Opacity,value:n.getStyle(i.Style.Opacity),duration:s-o}],n.getNodeId()+"init"),o),n.setStyle(i.Style.Opacity,0),o+=r}),r=s/this.yTicks.length,o=0,this.yTicks.forEach(n=>{e.addSequence(t.tween(n,[{key:i.Style.Opacity,value:n.getStyle(i.Style.Opacity),duration:s-o}],n.getNodeId()+"init"),o),n.setStyle(i.Style.Opacity,0),o+=r}),this.xAxis.buildInitialAnimation(e,t,s,this.hasNegative()?n:void 0),void 0!==this.yAxis&&this.yAxis.buildInitialAnimation(e,t,s,this.hasNegative()?n:void 0),this}getZeroPoint(){return new i.Point(this.grid.getXCoordinates()[0],this.grid.getYCoordinates()[0])}hasNegative(){return this.axesData.x.min<0||this.axesData.y.min<0}compute(){const e=this.prepareLabelValues(this.axesData.y,this.getNumYTicks(),this.settings.logarithmicY),t=this.prepareLabelValues(this.axesData.x,this.getNumXTicks(),this.settings.logarithmicX),s=t.reduce((e,t)=>{const s=i.Utilities.measureText(o.AxesLabel.formatLabel(t,this.settings.numberFormatter,this.axesData.x.percentageBased)),n=Math.max(e,s.width);return i.ObjectCache.recycleObject(s),n},0);return this.createGrid(s,t.length,e.length).createXTicks(t).createYTicks(e).createXAxis(),this.hasNegative()?(this.createYAxis(),this.xTicks[Math.floor(this.xTicks.length/2)].setStyle(i.Style.Opacity,0),this.xTicks.forEach(e=>{e.setOrigin(i.Constants.Origin.TOP_RIGHT),e.translate(-9,0)})):_.last(this.yTicks).setStyle(i.Style.Opacity,0),this}roundUp(e){const t=e.toString().length,i=Math.pow(10,Math.max(0,t-1));return Math.ceil(e/i)*i}prepareLabelValues(e,t,i){const s=this.roundUp(e.max);e.max=s;let n=Math.min(0,e.min);return n<0&&(n=-1*this.roundUp(-1*n),e.min=n),i?this.createLogarithmicValues(n,s,t+1):this.createLinearValues(n,s,t)}createLinearValues(e,t,i){const s=[e],n=(t+-1*e)/i;let r=e;for(let e=0;e<i;e++)r+=n,s.push(Math.round(r));return s}createLogarithmicValues(e,t,i){const s=[];for(let n=0;n<i;n++){const r=l.generalMathUtils.logarithmicScale({min:0,max:i-1},{min:e,max:t},n);s.push(Math.round(r))}return s}createXTicks(e){this.xTicks=this.xTicks.filter(e=>(this.removeChild(e),!1));const t=this.grid.getXCoordinates(),s=this.grid.getCenterPoint().getY()+5;for(let n=0;n<t.length;n++)if(void 0!==e[n]){const r=new o.AxesLabel(new i.Presence(t[n],s),e[n],this.settings.colorPalette.axisLabelColor,this.getScaling(this.settings.fontSize),this.axesData.x.percentageBased,this.settings.numberFormatter);r.setLabelOrigin(i.Constants.Origin.CENTER_TOP),this.xTicks.push(r),this.addChild(r)}return this}getScaling(e){switch(e){case a.FontSize.SMALL:return 1;case a.FontSize.MEDIUM:return 1.33;case a.FontSize.LARGE:return 1.66;case a.FontSize.EXTRA_LARGE:return 2;default:return 1}}createYTicks(e){e=e.reverse(),this.yTicks=this.yTicks.filter(e=>(this.removeChild(e),!1));const t=this.grid.getYCoordinates(),s=this.grid.getCenterPoint().getX();for(let n=0;n<t.length;n++)if(void 0!==e[n]){const r=new o.AxesLabel(new i.Presence(s-9,t[n]+1),e[n],this.settings.colorPalette.axisLabelColor,this.getScaling(this.settings.fontSize),this.axesData.y.percentageBased,this.settings.numberFormatter);r.setLabelOrigin(i.Constants.Origin.TOP_RIGHT),this.yTicks.push(r),this.addChild(r)}return this}createGrid(e,t,s){return this.grid=new r.Grid(new i.Presence(0,0),{width:this.settings.width,height:this.settings.height-this.settings.marginBottom,marginBottom:this.settings.marginBottom,marginTop:this.settings.marginTop,numXLines:s,numYLines:t,offsetLeft:e,centered:this.hasNegative(),color:this.settings.colorPalette.gridColor}),this.grid.setLayer(1),this.addChild(this.grid),this}getValuePoint(e,t){const s=this.grid.getYCoordinates(),n=this.grid.getXCoordinates(),r=_.last(n)-n[0],o=_.last(s)-s[0],a=this.axesData.x.max,c=this.axesData.y.max,d=this.axesData.x.min,h=this.axesData.y.min;let u,p;if(this.settings.logarithmicX){const t=n.length-1;u=n[0]+l.generalMathUtils.linearScale({min:0,max:t},{min:0,max:r},l.generalMathUtils.reverseLog({min:0,max:t},{min:d,max:a},e))}else u=n[0]+l.generalMathUtils.linearScale({min:d,max:a},{min:0,max:r},e);if(this.settings.logarithmicY){const e=s.length-1;p=s[0]+(o-l.generalMathUtils.linearScale({min:0,max:e},{min:0,max:o},l.generalMathUtils.reverseLog({min:0,max:e},{min:h,max:c},t)))}else p=s[0]+(o-l.generalMathUtils.linearScale({min:h,max:c},{min:0,max:o},t));return new i.Point(u,p)}createXAxis(){const e=this.axesData.x;return this.xAxis=new s.XAxis(new i.Presence(0,this.grid.getCenterPoint().getY()+1),this.settings.width,e,this.settings.colorPalette.axisColor),this.xAxis.setLayer(2),this.addChild(this.xAxis),this}createYAxis(){const e=this.axesData.y;return this.yAxis=new n.YAxis(new i.Presence(this.grid.getCenterPoint().getX(),0),this.settings.height,e,this.settings.colorPalette.axisColor),this.yAxis.setLayer(2),this.addChild(this.yAxis),this}}}),define("classes/canvas_axes_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CanvasAxesColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){return 2===this.themeId?this.buildDarkColorPalette():this.buildLightColorPalette()}buildLightColorPalette(){return{gridColor:i.Color.fromRGB(211,211,211),axisLabelColor:i.Color.fromRGB(127,140,140),axisColor:i.Color.fromRGB(159,169,169)}}buildDarkColorPalette(){return{gridColor:i.Color.WHITE(),axisLabelColor:i.Color.WHITE(),axisColor:i.Color.WHITE()}}}}),define("canvas_axes",["require","exports","classes/abstract_axis","classes/axes_label","classes/canvas_axes","classes/canvas_axes_palette_builder","classes/grid","classes/x_axis","classes/y_axis"],function(e,t,i,s,n,r,o,a,l){"use strict";function c(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),c(i),c(s),c(n),c(r),c(o),c(a),c(l)}),define("dialogs/country_dialog",["require","exports","flux","react","canvas_engine","reusable_utilities"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=35;t.CountryDialog=class extends i.BaseComponent{componentDidMount(){const e=this.refs.canvas,{data:t,resultCount:i,results:s}=this.props,{scene:a,stage:l}=n.Stage.build(e,o,o);this.stage=l;let c=315;const d=new n.Entity(n.Presence.zeroTopLeft(),[...t.filter(e=>e.value>0).map(e=>{const{value:t,color:i}=e,r=t/s*360,a=new n.CircleSegmentComponent(new n.CircleSegment(o/2,o/2,o/2,c,c+r+1)).setStyle(n.Style.Color,i);return a.onMouseClick.subscribe(()=>{this.drilldown()}),c+=r,a}),new n.LabelComponent(new n.Presence(o/2,o/2),i,n.LabelSettings.fromJson({color:r.Color.WHITE(1),textBaseLine:n.Constants.TextBaseLine.MIDDLE,origin:n.Constants.Origin.CENTER_TOP}).setFontSize(14))]);a.addChild(d),l.start(a)}drilldown(){const e=new window.tw.inject("NavigationParams")(),{filter:t,widget:i}=this.props;e.setFilters([t,[{key:"QUERY",value:`${window.constants.world_map.sourcegeo_resolution.country} AND NOT ${window.constants.world_map.sourcegeo_resolution.region}`}]]),e.setWidget(i),e.setClickTarget(i.getTemplate()),e.addTopicMenuFilter(i.getMenu().toProto().geodata_precision_types),new window.tw.inject("navigationService").clickHandler(e,i.getTemplate()[0],"CONTEXT_MENU_WORLD_MAP")}render(){const{countryName:e}=this.props;return s.createElement("div",null,s.createElement("canvas",{ref:"canvas",style:{margin:5,float:"left",cursor:"pointer"}}),s.createElement("div",{style:{float:"left"}},s.createElement("span",{style:{lineHeight:"4em"}},e)))}componentWillUnmount(){this.stage&&this.stage.dispose()}}}),define("dialogs/country_dialog_title",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CountryDialogTitle=class extends i.BaseComponent{render(){const{title:e}=this.props;return s.createElement("div",null,s.createElement("div",{style:{float:"left"}},s.createElement("span",{style:{lineHeight:"2em",marginLeft:10,fontWeight:"bold"}},e)))}}}),define("implementations/abstract_canvas_fragment",["require","exports","canvas_engine","widget_base"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractCanvasFragment=class{constructor(e){}async buildStage(e,t,s,n){const r=i.Stage.build(e,t,s,60,i.StageSettings.fromJSON(n));return this.stage=r.stage,this.scene=this.stage.getScene(),this.camera=this.stage.getActiveCamera(),this.camera.disableTranslation(),this.stage.setImageSmoothing(!0),this.stage.start()}async handleCanvas(e,t={layerAmount:3}){let n=Promise.resolve();const r=Math.floor(e.dimensions.width),o=Math.floor(e.dimensions.height);return t.scale=e.style.resolutionScale,void 0===this.canvas.stage?n=this.buildStage(this.canvas,r,o,t):$(this.canvas).width(r).height(o),e.heightMode!==s.WidgetHeightMode.LEGACY&&(this.canvas.style.left=e.dimensions.x+"px",this.canvas.style.top=e.dimensions.y+"px"),this.stage.getStyleMap().setStyleIfDifferent(i.Style.Width,r).setStyleIfDifferent(i.Style.Height,o),this.scene.getStyleMap().setStyleIfDifferent(i.Style.Width,r).setStyleIfDifferent(i.Style.Height,o),void 0!==n?n:this}initialize(e,t,i){return this.canvas=document.createElement("canvas"),i.style.placement.centeredVertically?e.classList.add("flex-center-vertically"):e.classList.remove("flex-center-vertically"),i.heightMode!==s.WidgetHeightMode.LEGACY&&(this.canvas.style.position="absolute"),e.appendChild(this.canvas),Promise.resolve(this)}}}),define("settings/default_chart_settings",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.hasInitialAnimation=!1,this.isAnimated=!1,this.animationFrame=-1,this.animationDuration=1e3,this.transitionDuration=1e3,this.textAnimationDuration=1e3,this.delayComputation=!1,this.model=e}static fromJson(e,t={},i=s){const n=new i;return Object.keys(e).forEach(i=>{void 0===t[i]||e[i]instanceof t[i]?n[i]=e[i]:n[i]=t[i].fromJson(e[i])}),n}toJson(){return{model:this.model,hasInitialAnimation:this.hasInitialAnimation,isAnimated:this.isAnimated,animationFrame:this.animationFrame,animationDuration:this.animationDuration,transitionDuration:this.transitionDuration,textAnimationDuration:this.textAnimationDuration,delayComputation:this.delayComputation}}getModel(){return this.model}setModel(e){return this.model=e,this}enableInitialAnimation(e){return this.hasInitialAnimation=e,this}isInitialAnimationEnabled(){return this.hasInitialAnimation}setAnimationDuration(e){return this.animationDuration=e,this}getAnimationDuration(){return this.animationDuration}setTransitionDuration(e){return this.transitionDuration=e,this}getTransitionDuration(){return this.transitionDuration}setTextAnimationDuration(e){return this.textAnimationDuration=e,this}getTextAnimationDuration(){return this.textAnimationDuration}setDelayComputation(e){return this.delayComputation=e,this}getDelayComputation(){return this.delayComputation}setAnimationFrame(e){return void 0!==e?(this.animationFrame=e,this.isAnimated=!0):(this.animationFrame=-1,this.isAnimated=!1),this}getCurrentDataGraph(){if(i.ObjectUtils.hasProperties(this.getModel(),["getData"])){const e=this.getModel().getData();if(i.ObjectUtils.hasProperties(e,["hasAdditionalFrames","getAdditionalFrames"])&&e.hasAdditionalFrames()&&!0===this.isAnimated&&this.animationFrame>=0)return e.getAdditionalFrames()[this.animationFrame];if(i.ObjectUtils.hasProperties(e,["payloadDataGraph"]))return e.payloadDataGraph}}merge(e){return this.hasInitialAnimation=e.isInitialAnimationEnabled(),this.isAnimated=e.isAnimated,this.animationFrame=e.animationFrame,this.model=e.getModel(),this.animationDuration=e.getAnimationDuration(),this.transitionDuration=e.getTransitionDuration(),this.textAnimationDuration=e.getTextAnimationDuration(),this.delayComputation=e.getDelayComputation(),this}}t.DefaultChartSettings=s}),define("implementations/chart",["require","exports","canvas_engine","settings/default_chart_settings"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Chart=class extends i.Entity{constructor(e,t=new s.DefaultChartSettings,i){super(e,i),this.legend=[],this.settings=t,t.getDelayComputation()||this.compute()}getChartSettings(){return this.getSettings()}getSettings(){return this.settings}getLegend(){return this.legend}animate(...e){throw new Error("Must be overwritten to be used in extending classes")}compute(){return this}reset(){}revert(){}}}),define("implementations/legend/legend_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LINE=0]="LINE",e[e.TABULAR=1]="TABULAR"}(t.LegendTypes||(t.LegendTypes={})),function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(t.LegendAlignment||(t.LegendAlignment={})),function(e){e[e.HOVER=0]="HOVER",e[e.FADEOUT=1]="FADEOUT"}(t.LegendAnimationTypes||(t.LegendAnimationTypes={})),function(e){e[e.CIRCLE=0]="CIRCLE",e[e.SQUARE=1]="SQUARE",e[e.LINE=2]="LINE"}(t.LegendItemIconType||(t.LegendItemIconType={})),function(e){e[e.TOP=0]="TOP",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.BOTTOM=3]="BOTTOM",e[e.INTEGRATED=4]="INTEGRATED"}(t.LegendPosition||(t.LegendPosition={}))}),define("implementations/legend/legend_item_icon_dots",["require","exports","canvas_engine","implementations/legend/legend_interfaces"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendItemIconDots=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.dots=[],this.animationComponent=(new i.AnimationComponent).attach(this),this.createDots()}playMouseEnterAnimation(){return this.dots.forEach(e=>{const t=this.animationComponent.accessSequenceFor(e.getNodeId().toString()+s.LegendAnimationTypes.HOVER);t.isReversed()?t.setReverseState(!1):t.reset(),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()}),this}attachStage(e){this.dots.forEach(t=>{t.setStageFacade(e),t.subscribeToStage()})}playMouseLeaveAnimation(){return this.dots.forEach(e=>{const t=this.animationComponent.accessSequenceFor(e.getNodeId().toString()+s.LegendAnimationTypes.HOVER);t.isReversed()?t.reset():t.setReverseState(!0),t.getState()!==i.Constants.State.Animation.Playing&&t.resume()}),this}createDots(){const e=(this.props.width-4)/3*this.props.scaling;let t=0;for(;t<this.props.width;){let n,r;switch(this.props.type){case s.LegendItemIconType.CIRCLE:const o=e/2;(n=new i.CircleComponent(new i.Circle(t,0,o))).setStyle(i.Style.Color,this.props.color),r=[{key:i.Style.Radius,value:1.5*o,duration:300}];break;case s.LegendItemIconType.SQUARE:(n=new i.RectangleComponent(new i.Rectangle(t,-e/2+2,e,e))).setStyle(i.Style.BorderThickness,0).setStyle(i.Style.Color,this.props.color).setStyle(i.Style.BorderColor,this.props.color),r=[{key:i.Style.BorderThickness,value:2,duration:300}];break;case s.LegendItemIconType.LINE:(n=new i.RectangleComponent(new i.Rectangle(t,1,e,Math.floor(e/1.5)))).setStyle(i.Style.BorderThickness,0).setStyle(i.Style.Color,this.props.color).setStyle(i.Style.BorderColor,this.props.color),r=[{key:i.Style.BorderThickness,value:2,duration:300}]}this.animationComponent.tween(n,r,n.getNodeId().toString()+s.LegendAnimationTypes.HOVER),this.dots.push(n.setLayer(2)),this.addComponent(n),t+=e+2}return this}getBoundingRect(e){return this.getComponentSumSurroundingRect(e).setWidth(2*this.props.width)}getBoundingBox(e,t){return this.getBoundingRect(e)}dispose(){this.animationComponent.dispose(),super.dispose()}}}),define("implementations/legend/legend_item_icon_tendency",["require","exports","canvas_engine","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendItemIconTendency=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.arrowUp=String.fromCharCode(58941),this.arrowDown=String.fromCharCode(58940),this.negativeColor=new s.Color(this.props.sentimentColors.negative),this.positiveColor=new s.Color(this.props.sentimentColors.positive),this.valueNumeric=this.props.value,this.createIcon(),this.createLabel()}tweenTendency(e,t,i){if(void 0!==e){const s={tendency:this.valueNumeric},n=[{key:"tendency",value:e.getValueAbs(),duration:1e3}];t.addSequence(i.tween(s,n,this.value.getNodeId()+"transition"));const r=t.onStep.subscribe(()=>{this.valueNumeric=s.tendency,this.applyTendencyStateToLabels(e)});t.onDone.subscribeOnceAsPromise().then(()=>{r.cancel(),this.valueNumeric=s.tendency,this.applyTendencyStateToLabels(e)})}return this}applyTendencyStateToLabels(e){const t=e.isPositive()?this.positiveColor:this.negativeColor;this.icon.getSettings().setColor(t),this.icon.setText(e.isPositive()?this.arrowUp:this.arrowDown),this.value.getSettings().setColor(t),this.value.setText(this.formatValue(this.valueNumeric))}createIcon(){const e=(new i.LabelSettings).setFontSize(11*this.props.scaling),t=this.props.isPositive?this.arrowUp:this.arrowDown;return e.setFontFamily("twAwesome").setColor(this.props.isPositive?this.positiveColor:this.negativeColor),e.setTextBaseLine(i.Constants.TextBaseLine.HANGING),this.icon=new i.LabelComponent(i.Presence.PresencePool.getObject().setCoordinates(0,e.getFontSize()/2),t,e),this.addComponent(this.icon),this.icon.setOrigin(i.Constants.Origin.CENTER_LEFT),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.icon.getPresence().translate(0,-1),this}isPositive(){return this.props.isPositive}getText(){return this.value.getText()}formatValue(e){return" "+this.props.numberFormatter.toPercentage(e/100)}createLabel(){const e=(new i.LabelSettings).setFontSize(12*this.props.scaling),t=this.getValueOffset();return e.setColor(this.props.isPositive?this.positiveColor:this.negativeColor),e.setTextBaseLine(i.Constants.TextBaseLine.HANGING),this.value=new i.LabelComponent(i.Presence.PresencePool.getObject().setCoordinates(t,e.getFontSize()/2-2*this.props.scaling-1),this.formatValue(this.valueNumeric),e),this.addComponent(this.value),this.value.setOrigin(i.Constants.Origin.CENTER_LEFT),this}getValueOffset(){const e=i.ObjectCache.FontPool.getObject().assimilate(this.icon.getSettings().getFont()).setFamily(i.Constants.Font.Family.Digits),t=i.Utilities.measureText("27",e),s=t.width;return i.ObjectCache.recycleObject(e),i.ObjectCache.recycleObject(t),s}getWidth(){const e=this.icon.getBoundingBox(),t=this.value.getBoundingBox(),s=e.width+t.width;return i.ObjectCache.recycleObject(e),i.ObjectCache.recycleObject(t),s}getHeight(){const e=this.icon.getBoundingBox(),t=this.value.getBoundingBox(),s=Math.max(e.height,t.height);return i.ObjectCache.recycleObject(e),i.ObjectCache.recycleObject(t),s}}}),define("implementations/legend/legend_item_icon",["require","exports","canvas_engine","implementations/legend/legend_interfaces","implementations/legend/legend_item_icon_dots","implementations/legend/legend_item_icon_tendency","log"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendItemIcon=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.circleRadius=4,this.iconOffsetLeft=0,this.animationComponent=(new i.AnimationComponent).attach(this),this.tendency=this.props.tendency,this.buildTendency(),this.buildIcon()}getColorString(){return this.props.color.toHex6()}hideTendency(e,t){this.tendencyHidden=!0;const s=[{key:i.Style.Opacity,value:0,duration:500}];return e.addSequence(t.tween(this.tendencyIcon,s,this.tendencyIcon.getNodeId().toString())),this}showTendency(e,t){this.tendencyHidden=!1;const s=[{key:i.Style.Opacity,value:1,duration:500}];return e.addSequence(t.tween(this.tendencyIcon,s,this.tendencyIcon.getNodeId().toString())),this}addTendency(e){this.tendency=e,this.buildTendency()}getTendency(){return this.tendency}isTendencyHidden(){return void 0===this.tendency||this.tendencyHidden}hasTendency(){return void 0!==this.tendency}getTendencyWidth(){return this.isTendencyHidden()?0:this.tendencyIcon.getWidth()}getTendencyHeight(){return this.isTendencyHidden()?0:this.tendencyIcon.getHeight()}getWidth(){const e=this.icon.getBoundingBox(!0),t=e.width;return i.ObjectCache.recycleObject(e),t}getIconOffsetLeft(){return this.iconOffsetLeft}setIconOffsetLeft(e){return this.iconOffsetLeft=e,this.icon.getPresence().setX(this.iconOffsetLeft),this}buildDottedIcon(e){this.icon=new n.LegendItemIconDots({width:16,height:this.circleRadius,color:this.props.color,type:e,scaling:this.props.scaling},i.Presence.zeroTopLeft()),this.addChild(this.icon)}buildIcon(){if(this.props.dotted)this.buildDottedIcon(this.props.type);else switch(this.props.type){case s.LegendItemIconType.CIRCLE:this.buildCircleIcon();break;case s.LegendItemIconType.SQUARE:this.buildSquareIcon();break;case s.LegendItemIconType.LINE:this.buildLineIcon();break;default:o.logService.error("Not a valid LegendItemIconType!")}return navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.icon.getPresence().translate(0,1),this.icon.setOrigin(i.Constants.Origin.CENTER_TOP),this}playMouseEnterAnimation(){if(!(this.icon instanceof n.LegendItemIconDots)){const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+s.LegendAnimationTypes.HOVER),t=e.onDone.subscribeOnceAsPromise();return void 0!==e&&(e.isReversed()?e.setReverseState(!1):e.reset(),e.getState()!==i.Constants.State.Animation.Playing&&e.resume()),t}return this.icon.playMouseEnterAnimation(),$.Deferred().resolve().promise()}playMouseLeaveAnimation(){if(!(this.icon instanceof n.LegendItemIconDots)){const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+s.LegendAnimationTypes.HOVER),t=e.onDone.subscribeOnceAsPromise();return void 0!==e&&(e.isReversed()?e.reset():e.setReverseState(!0),e.getState()!==i.Constants.State.Animation.Playing&&e.resume()),t}return this.icon.playMouseLeaveAnimation(),$.Deferred().resolve().promise()}tweenTendency(e,t,i){return void 0!==this.tendencyIcon&&this.tendencyIcon.tweenTendency(e,t,i),this}attachStage(e){this.icon instanceof n.LegendItemIconDots?this.icon.attachStage(e):(this.icon.setStageFacade(e),this.icon.subscribeToStage())}buildTendency(){this.hasTendency()?(this.tendencyHidden=!1,this.tendencyIcon=new r.LegendItemIconTendency({value:this.tendency.getValueAbs(),isPositive:this.tendency.isPositive(),numberFormatter:this.props.numberFormatter,scaling:this.props.scaling,sentimentColors:this.props.sentimentColors},i.Presence.PresencePool.getObject().setCoordinates(0,0)),this.tendencyIcon.setOrigin(i.Constants.Origin.TOP_LEFT),this.addChild(this.tendencyIcon),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.tendencyIcon.getPresence().translate(0,-1)):this.tendencyHidden=!0}buildRectangleIcon(e,t,n){const r=new i.RectangleComponent(new i.Rectangle(0,n,e*this.props.scaling,t*this.props.scaling)).setLayer(2);r.setStyle(i.Style.BorderThickness,0).setStyle(i.Style.Color,this.props.color).setStyle(i.Style.BorderColor,this.props.color),this.icon=r,this.addComponent(r);const o=[{key:i.Style.BorderThickness,value:3,duration:300}];return this.animationComponent.tween(r,o,this.getNodeId().toString()+s.LegendAnimationTypes.HOVER),this}buildLineIcon(){return this.buildRectangleIcon(13,this.circleRadius,1),this}buildSquareIcon(){const e=2*this.circleRadius+1;return this.buildRectangleIcon(e,e,-2*this.props.scaling),this}buildCircleIcon(){const e=new i.CircleComponent(new i.Circle(this.circleRadius*this.props.scaling,Math.ceil(this.circleRadius*this.props.scaling/2+1),this.circleRadius*this.props.scaling)).setLayer(2);e.setStyle(i.Style.Color,this.props.color),this.icon=e,this.addComponent(e);const t=[{key:i.Style.Radius,value:1.5*this.circleRadius*this.props.scaling,duration:300}];return this.animationComponent.tween(e,t,this.getNodeId().toString()+s.LegendAnimationTypes.HOVER),this}getHeight(){const e=this.icon.getBoundingBox(!0),t=Math.max(e.height,this.getTendencyHeight());return i.ObjectCache.recycleObject(e),t}getBoundingBox(){return new i.Rectangle(this.getPresence().getX(),this.getPresence().getY(),this.getWidth(),this.getHeight())}dispose(){this.animationComponent.dispose(),super.dispose()}}}),define("implementations/legend/legend_item_label",["require","exports","canvas_engine","reusable_services","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.labelSettings=new i.LabelSettings,this.labelSettings.setTextBaseLine(i.Constants.TextBaseLine.HANGING),this.labelSettings.setFontSize(12*this.props.scaling).setColor(this.props.color),this.labelSettings.setMaxWidth(void 0!==this.props.width?this.props.width:0),e.multiline&&this.labelSettings.setMultiline(!0).setSplitCharacter(" ")}isImageLabel(){return this.label instanceof i.ImageComponent}getText(){return this.label instanceof i.LabelComponent?this.label.getText():""}getWidth(){let e;if(this.label instanceof i.LabelComponent){this.label.formatText(!1,!0);const t=this.label.getBoundingBox();e=t.width,i.ObjectCache.recycleObject(t)}else e=16*this.props.scaling;return e}getHeight(){let e;if(this.label instanceof i.LabelComponent){const t=this.label.getBoundingBox();e=t.height,i.ObjectCache.recycleObject(t)}else e=16*this.props.scaling;return e}buildEmoji(e){const t=e.onLoad.subscribeOnceAsPromise();return t.then(()=>{e.buildShape(i.Constants.Shape.Rectangle),this.incrementEmojiReadyCounter()}),t}incrementEmojiReadyCounter(){this.hasStageFacade()&&this.getStageFacade().processUpdate()}checkForEmoji(e){if(void 0!==e){const t=s.emojiService.parseTextForEmoji(e);if(n.StringUtils.isIMGOnly(t))return t}return""}async compute(){const e=this.checkForEmoji(this.props.text),t=e.length>0,s=i.Presence.PresencePool.getObject();if(t){const t=3,n=8*this.props.scaling;s.setY(t);const r=new i.ImageComponent($(e)[0].src,!1,s);r.setStyle(i.Style.Radius,n),this.label=r,this.addComponent(this.label),await this.buildEmoji(r),this.label.setOrigin(i.Constants.Origin.CENTER_LEFT)}else s.setY(-3*this.props.scaling),this.label=new i.LabelComponent(s,this.props.text,this.labelSettings),this.label.setOrigin(i.Constants.Origin.TOP_LEFT),this.addComponent(this.label);return this}getBoundingBox(){return this.label.getBoundingBox()}};r=__decorate([n.meta({name:"LegendItemLabel"}),__metadata("design:paramtypes",[Object,i.Presence])],r),t.LegendItemLabel=r}),define("implementations/legend/legend_item",["require","exports","canvas_engine","implementations/legend/legend_item_icon","implementations/legend/legend_item_label","implementations/legend/legend_interfaces"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendItem=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft(),s=new i.Timeline){super(t,[],void 0),this.props=e,this.timeline=s,this.initialOffset=30,this.isInflated=!1,this.hoverToggled=!1,this.fadedOut=!1,this.iconOffsetLeft=0,this.itemDimensions=i.ObjectCache.DimensionsCalculatorPool.getObject(),this.animationComponent=(new i.AnimationComponent).attach(this)}attachStage(e){this.hoverRect.setStageFacade(e),this.hoverRect.subscribeToStage(),this.icon.attachStage(e),this.setStageFacade(e),this.subscribeToStage()}getWidth(){return this.label.getPresence().getX()+this.label.getWidth()-this.icon.getPresence().getX()}getHeight(){return Math.max(this.label.getHeight(),this.icon.getTendencyHeight())}updateDimensions(){return this.itemDimensions.reset(),this.itemDimensions.addX(this.icon.getPresence().getX(),this.label.getPresence().getX(),this.label.getPresence().getX()+this.label.getWidth()),this.itemDimensions.addY(this.label.getPresence().getY(),this.label.getPresence().getY()+this.label.getHeight(),this.icon.getTendencyHeight()),this}getColorString(){return this.icon.getColorString()}getProps(){return this.props}getIconWidth(){return this.icon.getWidth()}isDotted(){return this.props.icon.dotted}compute(){const e=this.buildItem();return e.then(()=>{this.isDisposed()||this.updateDimensions()}),e}tweenTendencies(e,t,i){return void 0===e?this.icon.isTendencyHidden()||this.icon.hideTendency(t,i):(this.icon.hasTendency()||this.icon.addTendency(e),this.icon.isTendencyHidden()&&this.icon.showTendency(t,i),this.icon.tweenTendency(e,t,i)),this}getLabel(){return this.props.text}getID(){return this.props.id}getCode(){return this.props.code}getTendencyWidth(){return this.icon.getTendencyWidth()}getHoverRect(){return this.hoverRect}buildHoverRectangle(e){void 0!==this.hoverRect&&this.removeComponent(this.hoverRect,!0);const t=this.getBoundingBox();return t.setWidth(t.getWidth()+4).setHeight(t.getHeight()+4),this.hoverRect=new i.RectangleComponent(t).setLayer(3).setInteractiveState(!0),this.hoverRect.getPresence().setCoordinates(-2,-t.getHeight()/2),this.addComponent(this.hoverRect),this.hoverRect.setStageFacade(e),this.hoverRect.subscribeToStage(),this}getIconOffsetLeft(){return this.iconOffsetLeft}setIconOffsetLeft(e){return this.iconOffsetLeft=e,this.icon.setIconOffsetLeft(e),this.label.getPresence().setX(e+this.icon.getWidth()/2+4*this.props.scaling),this.updateDimensions(),this}hideTendency(e,t){return this.icon.hideTendency(e,t),this}showTendency(e,t){return this.icon.showTendency(e,t),this}addTendency(e){this.icon.addTendency(e)}async buildItem(){this.icon=new s.LegendItemIcon(_.extend({},this.props.icon,{scaling:this.props.scaling,numberFormatter:this.props.numberFormatter,isLineLegend:this.props.isLineLegend,sentimentColors:this.props.sentimentColors}),i.Presence.zeroTopLeft()),this.addChild(this.icon);const e=i.Presence.PresencePool.getObject();return e.setCoordinates(this.icon.getWidth()/2+4*this.props.scaling,0),this.label=new n.LegendItemLabel({multiline:this.props.multiline,text:this.props.text,scaling:this.props.scaling,color:this.props.labelColor,width:this.props.width-this.icon.getWidth()-this.icon.getTendencyWidth()},e),this.addChild(this.label),await this.label.compute(),this}toggleMouseEnter(){return this.hoverToggled||!0!==this.props.enableHover||(this.hoverToggled=!0,this.icon.playMouseEnterAnimation()),this}toggleMouseLeave(){return this.hoverToggled&&!0===this.props.enableHover&&(this.hoverToggled=!1,this.icon.playMouseLeaveAnimation()),this}playMouseEnterAnimation(){!0===this.props.enableHover&&(this.isInflated=!0,this.icon.playMouseEnterAnimation())}playMouseLeaveAnimation(){!0===this.props.enableHover&&(this.isInflated=!1,this.icon.playMouseLeaveAnimation())}fadeOut(){this.fadedOut=!0;const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+r.LegendAnimationTypes.FADEOUT);return void 0!==e&&(e.isReversed()?e.setReverseState(!1):e.reset(),e.getState()!==i.Constants.State.Animation.Playing&&e.resume()),this}fadeIn(){this.fadedOut=!1;const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+r.LegendAnimationTypes.FADEOUT);return void 0!==e&&(e.isReversed()?e.reset():e.setReverseState(!0),e.getState()!==i.Constants.State.Animation.Playing&&e.resume()),this}getIsFadedOut(){return this.fadedOut}getIsInflated(){return this.isInflated}mouseEnterHandler(e){this.onMouseEnter.fire(e,this)}mouseLeaveHandler(e){this.onMouseLeave.fire(e,this)}mouseClickHandler(e){!0===this.props.enableClick&&this.onMouseClick.fire(e,this)}buildFadeAnimations(e){const t=[{key:i.Style.Opacity,value:.3,duration:e}];this.animationComponent.tween(this,t,this.getNodeId().toString()+r.LegendAnimationTypes.FADEOUT)}buildInitialAnimation(e,t=this.timeline,s=this.animationComponent){const n=[{key:"presence",value:this.getPresence().toRelativePoint(),duration:e/2},{key:i.Style.Opacity,value:1,duration:e/2}];t.addSequence(s.tween(this,n,this.getNodeId().toString()),e),this.setStyle(i.Style.Opacity,0).getPresence().translate(-this.initialOffset,0)}getBoundingBox(){return new i.Rectangle(this.getPresence().getX(),this.getPresence().getY(),this.getWidth(),this.getHeight())}dispose(){i.ObjectCache.DimensionsCalculatorPool.recycleObject(this.itemDimensions),this.animationComponent.dispose(),super.dispose()}}}),define("implementations/legend/legend_title",["require","exports","canvas_engine"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendTitle=class extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.compute()}buildLabel(){const e=new i.LabelSettings;e.setFontSize(12*this.props.scaling).setFontWeight("bold").setTextBaseLine(i.Constants.TextBaseLine.MIDDLE).setColor(this.props.color),this.label=new i.LabelComponent(i.Presence.PresencePool.getObject().setCoordinates(0,5),this.props.text,e);const t=this.label.getStyle(i.Style.Font);return this.label.setStyle(i.Style.Font,t),this.addComponent(this.label),this}compute(){return this.buildLabel(),this}getBoundingBox(){return this.label.getBoundingBox()}}}),define("implementations/legend/legend",["require","exports","canvas_engine","reusable_utilities","implementations/legend/legend_title"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.Entity{constructor(e,t=i.Presence.zeroTopLeft()){super(t,[],void 0),this.props=e,this.mouseAnimationDuration=200,this.linePromises=[],this.legendIsClicked=!1,this.itemMap={},this.animated=!1,this.initialPosition=t.toPoint(),this.legendDimension=i.ObjectCache.DimensionsCalculatorPool.getObject(),this.animationComponent=(new i.AnimationComponent).attach(this),this.timeline=new i.Timeline,this.transitionAnimationComponent=(new i.AnimationComponent).attach(this),this.transitionTimeline=new i.Timeline,this.transitionTimeline.onStep.subscribe(()=>{this.refreshIconSettings().updateHoverRectangle().updateEventListeners().updateDimensions()}),this.presence.translate(0,4)}updateDimensions(){return this.legendDimension.reset().addY(0),this.items.length>0&&(this.items.forEach(e=>{e.updateDimensions(),this.legendDimension.addX(e.getPresence().getX()),this.legendDimension.addX(e.getPresence().getX()+e.getWidth())}),this.legendDimension.addY(this.items[this.items.length-1].getPresence().getY()+2*this.items[this.items.length-1].getBoundingBox().getHeight())),this}addTitle(){let e=0;if(void 0!==this.props.title){this.title=new n.LegendTitle({text:this.props.title,canvasWidth:this.props.idealSize.idealWidth||0,scaling:this.props.scaling,color:this.props.labelColor},i.Presence.zeroTopLeft()),this.addChild(this.title);const t=this.title.getBoundingBox();e=t.height+10,i.ObjectCache.recycleObject(t),this.items.forEach(t=>{t.translate(0,e)})}return this}showPointer(){return this.getStageFacade().getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer,this}resetPoint(){return this.getStageFacade().resetCursor(),this}getItem(e){return this.items.find(t=>t.getCode()===e)}setItemEventListeners(e){return(this.props.enableHover||this.props.enableClick)&&(e.getHoverRect().onMouseEnter.subscribe(()=>{(this.items.length>1||this.props.numLegends>1)&&(this.props.enableHover&&this.mouseEnterHandler(e),this.showPointer())}),e.getHoverRect().onMouseLeave.subscribe(()=>{(this.items.length>1||this.props.numLegends>1)&&(this.props.enableHover&&this.mouseLeaveHandler(e),this.resetPoint())})),this.props.enableClick&&e.getHoverRect().onMouseClick.subscribe(()=>{(this.items.length>1||this.props.numLegends>1)&&this.mouseClickHandler(e)}),this}updateItemMap(){return this.items.forEach(e=>{this.itemMap[e.getLabel()]=e}),this}updateEventListeners(){return this.itemMap={},this.items.forEach(e=>{e.subscribeToStage(),this.setItemEventListeners(e)}),this}compute(){return this.buildMouseAnimations(),this.addTitle().updateDimensions().updateEventListeners(),$.when(...this.linePromises).then(()=>this)}getAndRemoveItems(){const e=this.items;return this.items.forEach(e=>this.removeChild(e)),this.items=[],e}getLegendDimension(){return this.updateDimensions(),this.legendDimension}getHeight(){return this.legendDimension.getHeight()}getWidth(){return this.legendDimension.getWidth()}toggleItemMouseEnter(e){return void 0!==this.itemMap[e]&&this.itemMap[e].toggleMouseEnter(),this}toggleItemMouseLeave(e){return void 0!==this.itemMap[e]&&this.itemMap[e].toggleMouseLeave(),this}animate(e){if(this.animated)return Promise.resolve(this);{this.animated=!0,this.timeline.reset(),this.hasStageFacade()&&this.getStageFacade().processUpdate();const t=this.timeline.onDone.subscribeOnceAsPromise();return this.timeline.playOverTime(e),t}}updateHoverRectangle(){return this.items.forEach(e=>{e.buildHoverRectangle(this.getStageFacade())}),this}attachStage(){return this.items.forEach(e=>{e.attachStage(this.getStageFacade())}),this}refreshIconSettings(){return this.items.forEach(e=>{e.setIconOffsetLeft(e.getTendencyWidth()>0?e.getTendencyWidth()+15*this.props.scaling:0)}),this}tweenOrder(e,t,i){return this}playTransition(e){this.fadeInItems(),this.legendIsClicked=!1;const t=this.transitionTimeline.onDone.subscribeOnceAsPromise().then(()=>{this.isDisposed()||(this.refreshIconSettings(),this.updateDimensions(),this.hasStageFacade()&&this.getStageFacade().processUpdate(),this.updateHoverRectangle().attachStage().updateEventListeners(),this.transitionAnimationComponent.getSequences().forEach(e=>{this.transitionTimeline.removeSequence(e)}),this.transitionAnimationComponent.destroyAll(),this.transitionTimeline.reset())});return this.transitionTimeline.playOverTime(e),t}tweenTendencies(e){return Object.keys(e).forEach(t=>{this.itemMap[t].tweenTendencies(e[t],this.transitionTimeline,this.transitionAnimationComponent)}),this}buildMouseAnimations(){return this.items.forEach(e=>e.buildFadeAnimations(this.mouseAnimationDuration)),this}wasAnimated(){return this.animated}async fadeOut(e){if(this.animationComponent.isDisposed)return;const t=new i.Timeline,s=[{key:"presence",value:this.getPresence().toPoint().translate(30,0),duration:e},{key:i.Style.Opacity,value:0,duration:e}];t.addSequence(this.animationComponent.tween(this,s,this.getNodeId()+"FADE_OUT")),t.playOverTime(e),await t.onDone.subscribeOnceAsPromise(),t.dispose()}buildInitialAnimation(e){return this.animated||this.animationComponent.isDisposed||this.items.forEach(t=>{t.buildInitialAnimation(e)}),this}mouseEnterHandler(e,t=!1,i){this.legendIsClicked||e.getIsInflated()||this.isHovering()||(e.playMouseEnterAnimation(),t||this.onMouseEnter.fire({item:e}))}mouseLeaveHandler(e,t=!1,i){this.legendIsClicked||!e.getIsInflated()||this.isHovering()||(e.playMouseLeaveAnimation(),t||this.onMouseLeave.fire({item:e}))}mouseClickHandler(e,t=!1,i){this.items.length<=1&&1===this.props.numLegends||(void 0!==i?(this.legendIsClicked=i.getLegendIsClicked(),this.legendIsClicked?this.fadeOutItems():this.fadeInItems()):this.legendIsClicked&&!e.getIsFadedOut()?this.setLegendClickedState(e,!1):this.legendIsClicked?(e.fadeIn(),this.fadeOutItems(e)):this.setLegendClickedState(e,!0),t||this.onMouseClick.fire({item:e}))}getLegendIsClicked(){return this.legendIsClicked}fadeOutItems(e){return this.items.forEach(t=>{t.getIsFadedOut()||void 0!==e&&e===t||t.fadeOut(),t.getIsInflated()&&t.playMouseLeaveAnimation()}),this}fadeInItems(e){return this.items.forEach(t=>{!t.getIsFadedOut()||void 0!==e&&e===t||t.fadeIn(),t.getIsInflated()&&t.playMouseLeaveAnimation()}),this}setLegendClickedState(e,t){return this.legendIsClicked=t,this.items.forEach(i=>{t?i===e||i.getIsFadedOut()||i.fadeOut():i!==e&&i.getIsFadedOut()&&i.fadeIn()}),this}center(e){this.updateDimensions(),this.getPresence().setCoordinates(this.initialPosition.getX(),this.initialPosition.getY()).translate(e/2-this.getWidth()/2+3,0)}async dispose(){super.dispose(),i.ObjectCache.DimensionsCalculatorPool.recycleObject(this.legendDimension),this.animationComponent.dispose(),this.timeline.dispose(),this.transitionAnimationComponent.dispose(),this.transitionTimeline.dispose()}}__decorate([s.debounce(10),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],r.prototype,"showPointer",null),t.Legend=r}),define("implementations/legend/legend_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("implementations/legend/legend_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){switch(this.themeId){case 2:return this.buildDarkColorPalette();case 3:return this.buildNavyColorPalette();default:return this.buildLightColorPalette()}}buildLightColorPalette(){return{fontColor:new i.Color("#000")}}buildDarkColorPalette(){return{fontColor:new i.Color("#fff")}}buildNavyColorPalette(){return{fontColor:new i.Color("#d3d3d3")}}}}),define("implementations/legend/legend_fragment/legend_fragment_interfaces",["require","exports","implementations/legend/legend_interfaces"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MOUSE_ENTER=0]="MOUSE_ENTER",e[e.MOUSE_LEAVE=1]="MOUSE_LEAVE",e[e.MOUSE_CLICK=2]="MOUSE_CLICK"}(t.LegendEventTypes||(t.LegendEventTypes={}));class s{}s.LEGEND_MOUSEENTER="LEGEND_MOUSEENTER",s.LEGEND_MOUSELEAVE="LEGEND_MOUSELEAVE",s.LEGEND_MOUSECLICK="LEGEND_MOUSECLICK",s.WIDGET_MOUSEENTER="WIDGET_MOUSEENTER",s.WIDGET_MOUSELEAVE="WIDGET_MOUSELEAVE",s.RERENDER="RERENDER",t.LegendFragmentActions=s,t.LEGEND_FRAGMENT_LAYOUTS=[{id:"line_one",flowingText:!0,minWidth:120,minHeight:20,numLegends:1,type:i.LegendTypes.LINE},{id:"line_two",flowingText:!0,minWidth:200,minHeight:20,numLegends:2,type:i.LegendTypes.LINE},{id:"line_three",flowingText:!0,minWidth:300,minHeight:20,numLegends:3,type:i.LegendTypes.LINE},{id:"tabular_one",minWidth:160,minHeight:20,numLegends:1,type:i.LegendTypes.TABULAR},{id:"tabular_two",minWidth:400,minHeight:20,numLegends:2,type:i.LegendTypes.TABULAR},{id:"tabular_three",minWidth:600,minHeight:20,numLegends:3,type:i.LegendTypes.TABULAR}],function(e){e[e.BY_ROW=0]="BY_ROW",e[e.BY_COLUMN=1]="BY_COLUMN"}(t.LegendDataAxisType||(t.LegendDataAxisType={}))}),define("implementations/legend/legend_event_mediator",["require","exports","log","reusable_utilities","xstream","implementations/legend/legend_fragment/legend_fragment_interfaces"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e){this.mediator=e,this.legends=[],this.streams=[],this.mediator.listen(r.LegendFragmentActions.WIDGET_MOUSEENTER,this.toggleMouseEnter.bind(this)),this.mediator.listen(r.LegendFragmentActions.WIDGET_MOUSELEAVE,this.toggleMouseLeave.bind(this)),this.mediator.listen(r.LegendFragmentActions.LEGEND_MOUSEENTER,this.toggleMouseEnter.bind(this),{channelFilter:"global"}),this.mediator.listen(r.LegendFragmentActions.LEGEND_MOUSELEAVE,this.toggleMouseLeave.bind(this),{channelFilter:"global"}),this.mediator.listen(r.LegendFragmentActions.LEGEND_MOUSECLICK,this.toggleMouseClick.bind(this),{channelFilter:"global"})}toggleMouseEnter(e){this.mediateLegendEvent(void 0,r.LegendEventTypes.MOUSE_ENTER,e)}toggleMouseLeave(e){this.mediateLegendEvent(void 0,r.LegendEventTypes.MOUSE_LEAVE,e)}toggleMouseClick(e){this.mediateLegendEvent(void 0,r.LegendEventTypes.MOUSE_CLICK,e)}createEventStream(e){const t={start:function(t){this.emitTimerId=setInterval(()=>{this.events.length>0&&t.next(this.events),this.events=[]},20),this.streamSubs.push(e.onMouseEnter.subscribe(({event:e,item:t})=>{this.queueEvents({type:r.LegendEventTypes.MOUSE_ENTER,id:t.getCode(),item:t,event:e})})),this.streamSubs.push(e.onMouseLeave.subscribe(({event:e,item:t})=>{this.queueEvents({type:r.LegendEventTypes.MOUSE_LEAVE,id:t.getCode(),item:t,event:e})})),this.streamSubs.push(e.onMouseClick.subscribe(({event:e,item:t})=>{this.queueEvents({type:r.LegendEventTypes.MOUSE_CLICK,id:t.getCode(),item:t,event:e})}))},stop:function(){this.emitTimerId&&clearInterval(this.emitTimerId),this.streamSubs.forEach(e=>e.cancel())},events:[],streamSubs:[],queueEvents:function(e){this.events.push(e)},emitTimerId:0};return n.Stream.create(t).map(e=>{const t=e.reduce((e,t)=>e||t.type===r.LegendEventTypes.MOUSE_CLICK,!1);return e.filter(e=>!t||e.type===r.LegendEventTypes.MOUSE_CLICK)}).compose(e=>n.Stream.create({start:t=>e.addListener({next:e=>{e.forEach(e=>{t.next(e)})}}),stop:()=>{e._stopNow()}}))}addLegendEventHandling(e){const t=this.createEventStream(e);return t.addListener({next:t=>{switch(t.type){case r.LegendEventTypes.MOUSE_CLICK:this.mediator.dispatch(r.LegendFragmentActions.LEGEND_MOUSECLICK,t.id);break;case r.LegendEventTypes.MOUSE_ENTER:this.mediator.dispatch(r.LegendFragmentActions.LEGEND_MOUSEENTER,t.id);break;case r.LegendEventTypes.MOUSE_LEAVE:this.mediator.dispatch(r.LegendFragmentActions.LEGEND_MOUSELEAVE,t.id)}this.mediateLegendEvent(e,t.type,t.item)}}),t}removeLegends(){this.legends=[],this.streams.forEach(e=>e._stopNow())}setLegends(e){this.legends=e,this.streams.forEach(e=>e._stopNow()),this.streams=e.map(e=>this.addLegendEventHandling(e))}mediateLegendEvent(e,t,s){this.legends.forEach(n=>{if(n!==e&&("string"==typeof s&&(s=n.getItem(s)),void 0!==s))switch(t){case r.LegendEventTypes.MOUSE_ENTER:n.mouseEnterHandler(s,!0,e);break;case r.LegendEventTypes.MOUSE_LEAVE:n.mouseLeaveHandler(s,!0,e);break;case r.LegendEventTypes.MOUSE_CLICK:n.mouseClickHandler(s,!0,e);break;default:i.logService.error("Invalid LegendEventTypes: "+t)}})}dispose(){this.removeLegends(),this.streams.length=0}}__decorate([s.throttle(50,{}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",void 0)],o.prototype,"toggleMouseEnter",null),t.LegendEventMediator=o}),define("implementations/legend/legend_tabular",["require","exports","canvas_engine","implementations/legend/legend_item","implementations/legend/legend"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendTabular=class extends n.Legend{constructor(e,t=i.Presence.zeroTopLeft()){super(e,t),this.iconOffsetLeft=0}getItems(){return this.items}refreshIconSettings(){const e=this.items.reduce((e,t)=>Math.max(e,t.getTendencyWidth()>0?t.getTendencyWidth()+15*this.props.scaling:0),0);return this.items.forEach(t=>{t.setIconOffsetLeft(e)}),this}buildItem(e,t=!0){const n=new s.LegendItem(_.extend({},e,{scaling:this.props.scaling,labelColor:this.props.labelColor,numberFormatter:this.props.numberFormatter,width:this.props.idealSize.idealWidth-20,isLineLegend:!1,sentimentColors:this.props.sentimentColors}),i.Presence.PresencePool.getObject().setCoordinates(0,0),this.timeline),r=n.compute();return this.linePromises.push(r),this.iconOffsetLeft=Math.max(n.getTendencyWidth()>0?n.getTendencyWidth()+15*this.props.scaling:0,this.iconOffsetLeft),t&&(this.addChild(n),this.items.push(n)),n}adjustItemPosition(e,t,i){e.setIconOffsetLeft(this.iconOffsetLeft);const s=e.getBoundingBox();return e.buildHoverRectangle(this.getStageFacade()),e.getPresence().translate(0,t),t+i+s.getHeight()}tweenOrder(e,t,s){const n=s.getAndRemoveItems();return this.transitionAnimationComponent.setIdAdditive(_.uniqueId()),this.items=this.items.filter(e=>{if(-1===_.findIndex(n,t=>e.getID()===t.getID()&&e.getColorString()===t.getColorString())){const t=[{key:i.Style.Opacity,value:0,duration:1e3}];return this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e,t,e.getNodeId().toString())),this.transitionTimeline.onDone.subscribeOnceAsPromise().then(()=>{this.removeChild(e),e.dispose()}),!1}{const t=_.find(n,t=>e.getID()===t.getID()),i=[{key:"y",value:t.getPresence().getY(),duration:1e3}];return this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e.getPresence(),i,e.getNodeId().toString())),n.splice(n.indexOf(t),1),t.dispose(),!0}}),n.forEach(e=>{const t=[{key:i.Style.Opacity,value:1,duration:1e3}];this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e,t,e.getNodeId().toString())),e.setStyle(i.Style.Opacity,0),this.addChild(e),this.items.push(e)}),this}compute(){this.items=[];const e=6*this.props.scaling;let t=e;return this.props.itemData.map(e=>this.buildItem(e)),this.items.forEach(i=>{t=this.adjustItemPosition(i,t,e)}),super.compute()}}}),define("implementations/legend/legend_line",["require","exports","canvas_engine","reusable_utilities","implementations/legend/legend","implementations/legend/legend_interfaces","implementations/legend/legend_item"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=class extends n.Legend{constructor(e,t=i.Presence.zeroTopLeft()){super(e,t),this.initialDraw=!0}setLineAlignment(e,t){if(void 0===t[0])return this;const s=t[0].getBoundingBox(),n=t[t.length-1].getBoundingBox(),o=s.getX()-this.getPresence().getX(),a=e-(n.getX()+n.getWidth()),l=n.getX()+n.getWidth()-o,c=5*this.props.scaling;switch(this.props.alignment){case r.LegendAlignment.LEFT:void 0!==this.title&&this.title.getPresence().setX(0),t.forEach(e=>{e.translate(1+c,0)});break;case r.LegendAlignment.CENTER:if(void 0!==this.title){const t=this.title.getBoundingBox();this.title.getPresence().setX(e/2-t.width/2),i.ObjectCache.recycleObject(t)}t.forEach(t=>{t.translate((e-l)/2-o,0)});break;case r.LegendAlignment.RIGHT:if(void 0!==this.title){const t=this.title.getBoundingBox();this.title.getPresence().setX(e-t.width),i.ObjectCache.recycleObject(t)}t.forEach(e=>{e.translate(a,0)})}return this}alignLines(e){return this.lines.forEach(t=>{this.setLineAlignment(e,t)}),this}center(e){return this.updateDimensions(),this.initialDraw&&(this.initialDraw=!1,this.alignLines(e)),this}buildItem(e,t,s){const n=new o.LegendItem(_.extend({},e,{scaling:this.props.scaling,labelColor:this.props.labelColor,numberFormatter:this.props.numberFormatter,width:this.props.idealSize.idealWidth-20,isLineLegend:!0,sentimentColors:this.props.sentimentColors}),i.Presence.PresencePool.getObject().setCoordinates(t,s),this.timeline);return this.linePromises.push(n.compute()),n.setIconOffsetLeft(n.getTendencyWidth()>0?n.getTendencyWidth()+15*this.props.scaling:0),n.buildHoverRectangle(this.getStageFacade()),this.addChild(n),this.items.push(n),n}buildLines(e,t){let s=0;const n=i.ObjectCache.DimensionsCalculatorPool.getObject().addX(0).addY(0);let r=t,o=0;const a=e.reduce((e,i)=>{const a=this.buildItem(i,n.getWidth(),r),l=a.getBoundingBox(),c=l.getHeight();return n.addX(l.getX()+l.getWidth()+30),n.getWidth()>this.props.idealSize.idealWidth?(r+=o+t,a.getPresence().setCoordinates(0,r),n.reset().addX(0).addY(r+c+t),n.addX(l.getWidth()+30),e[s+=1]=[a],o=c):(o=Math.max(o,c),e[s].push(a)),e},[[]]);return i.ObjectCache.recycleObject(n),a}getAndRemoveLines(){const e=this.lines;return this.items.forEach(e=>this.removeChild(e)),this.lines=[],e}tweenOrder(e,t,s){const n=s.getAndRemoveLines(),r=n.reduce((e,t)=>e.concat(t),[]),a=void 0!==this.items[0]&&this.items[0].isDotted();return this.transitionAnimationComponent.setIdAdditive(_.uniqueId()),this.items=this.items.filter(e=>{if(-1===_.findIndex(r,t=>e.getID()===t.getID()&&e.getColorString()===t.getColorString())){const t=[{key:i.Style.Opacity,value:0,duration:1e3}];return this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e,t,e.getNodeId().toString())),this.transitionTimeline.onDone.subscribeOnceAsPromise().then(()=>{this.removeChild(e),e.dispose()}),!1}{const t=_.find(r,t=>e.getID()===t.getID()),i=[{key:"y",value:t.getPresence().getY(),duration:1e3},{key:"x",value:t.getPresence().getX(),duration:1e3}];return this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e.getPresence(),i,e.getNodeId().toString())),r.splice(r.indexOf(t),1),t.dispose(),!0}}),r.forEach(e=>{if(e.isDotted()!==a){const t=e;t.getProps().icon.dotted=a,(e=new o.LegendItem(t.getProps(),t.getPresence().clone(),this.timeline)).compute(),t.dispose()}const t=[{key:i.Style.Opacity,value:1,duration:1e3}];this.transitionTimeline.addSequence(this.transitionAnimationComponent.tween(e,t,e.getNodeId())),e.setStyle(i.Style.Opacity,0),this.addChild(e),this.items.push(e)}),n.forEach((e,t)=>{this.lines[t]=this.items.filter(t=>_.findIndex(e,e=>t.getID()===e.getID())>-1)}),this}compute(){this.items=[];const e=6*this.props.scaling;return this.lines=this.buildLines(this.props.itemData,e),super.compute()}};a=__decorate([s.meta({name:"LegendLine"}),__metadata("design:paramtypes",[Object,i.Presence])],a),t.LegendLine=a}),define("implementations/legend/legend_factory",["require","exports","implementations/legend/legend_tabular","implementations/legend/legend_line","implementations/legend/legend_interfaces"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendFactory=class{static createLegend(e,t){switch(e.type){case n.LegendTypes.LINE:return new s.LegendLine(e,t);case n.LegendTypes.TABULAR:return new i.LegendTabular(e,t)}}}}),define("implementations/legend/legend_fragment/fragment_legend_factory",["require","exports","canvas_engine","underscore","implementations/legend/legend_factory","implementations/legend/legend_interfaces"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FragmentLegendFactory=class{static getAlignment(e,t,i){if(e===r.LegendTypes.TABULAR)return r.LegendAlignment.CENTER;if(e===r.LegendTypes.LINE)return 0===i?r.LegendAlignment.CENTER:0===t?r.LegendAlignment.LEFT:t===i?r.LegendAlignment.RIGHT:r.LegendAlignment.CENTER;throw new Error("Unknown LegendType!")}static splitLegendData(e,t){const i=[],n=Math.round(e.itemData.length/t);let r,o;for(let a=0;a<t;a++){o=(r=n*a)+n;const t=s.extend({},e);t.itemData=e.itemData.slice(r,o),i.push(t)}return o<e.itemData.length&&(i[0].itemData=i[0].itemData.concat(e.itemData.slice(o,e.itemData.length))),i}static mergeLegendData(e){const t=[],i=s.extend({},e),n=i.subItemData;return delete i.subItemData,t.push(i),t.concat(n.map((t,n)=>s.extend({},i,{itemData:t,title:e.subTitles[n]})))}static buildLegends(e,t,r){let o;o=void 0!==e.subItemData?this.mergeLegendData(e):this.splitLegendData(e,t.layout.numLegends);const a=void 0===t.dimensions.width?void 0:Math.floor(t.dimensions.width/o.length),l=t.style.colorPalette;return o.map((e,c)=>{const d=i.Presence.PresencePool.getObject();return d.setCoordinates(void 0===a?0:a*c,0),n.LegendFactory.createLegend(s.extend(e,{type:t.layout.type,idealSize:{idealHeight:t.dimensions.height,idealWidth:a},numLegends:o.length,numberFormatter:t.style.formatting.numberFormatter,scaling:r,labelColor:l.fontColor,alignment:this.getAlignment(t.layout.type,c,o.length-1)}),d)})}}}),define("implementations/legend/legend_fragment/legend_data_factory",["require","exports","data_structures","reusable_utilities","implementations/legend/legend_interfaces","implementations/legend/legend_fragment/legend_fragment_interfaces"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendDataFactory=class{static buildItemData(e,t,s,n){const o=t.axis===r.LegendDataAxisType.BY_COLUMN?e.getColumns():e.getRows(),a=s.getLegendOptions(),l=[],c=o.filter(e=>t.itemFilter(e)).map(n=>{const r=!0!==a.showTendency&&s.hasReplayManager()?void 0:this.getTendency(n),o=n instanceof i.DataGraphColumn?n.getFormattedLabel():n.getFormattedLabel(!0),c={label:o,tendency:""};return void 0!==r&&(c.tendency+=r.getOldValue()+r.getValue()),l.push(c),{text:o,id:n.getCode()+o,code:n.getCode(),enableHover:t.enableItemHover,enableClick:t.enableItemSelection,icon:{color:t.colorFactory(n,s),type:t.iconType instanceof Function?t.iconType(s,e):t.iconType,tendency:r,dotted:t.dotted}}}),d=_.sortBy(l,({label:e})=>e);return n.tendency+=d.map(({tendency:e})=>e).join(""),c}static buildMapLegendItemData(e,t,i,r){const o=[],a=t.legendRangeFormatter(e,i).map(e=>{const i=e.label,r={label:i,tendency:""};return o.push(r),{text:i,id:i,enableHover:t.enableItemHover,enableClick:t.enableItemSelection,icon:{color:new s.Color(e.color),type:n.LegendItemIconType.CIRCLE,tendency:void 0,dotted:t.dotted}}}),l=_.sortBy(o,({label:e})=>e);return r.tendency+=l.map(({tendency:e})=>e).join(""),a}static buildMessageDiffusionItemData(e,t,i){return _(e.getEdgeModels()).chain().groupBy(e=>e.getIteration()).map((e,n)=>{const r=_.first(e);return{text:t.labelBuilder(`${n}`),id:`${n}`,enableHover:t.enableItemHover,enableClick:t.enableItemSelection,icon:{color:new s.Color(r.getColor()),type:t.iconType instanceof Function?t.iconType(i):t.iconType,dotted:t.dotted}}}).sortBy(e=>parseInt(e.id,10)).value()}static getTendency(e){let t=0,s=0;return e.getCells().forEach(e=>{t+=e.getOldValue()||0,s+=e.getValue()||0}),0===t||t===s?void 0:new i.Tendency(s,t).compute()}static buildLegendData(e,t,s){if(!e.isNetSentiment()||1!==e.getDataGraph().getRows().length){if(e.isWorldMap()&&e.getPayloadValue()&&e.getPayloadValue().legend_ranges)return{itemData:this.buildMapLegendItemData(e.getPayloadValue().legend_ranges,t,e,s),sentimentColors:t.sentimentColors};if(e.hasDataGraph())return void 0!==e.getPayloadValue().chart_data_graph?{itemData:this.buildItemData(new i.DataGraphWrapper(e.getPayloadValue().chart_data_graph),t,e,s),sentimentColors:t.sentimentColors}:{itemData:this.buildItemData(new i.DataGraphWrapper(e.getPayloadValue().data_graph),t,e,s),sentimentColors:t.sentimentColors};if(e.isMessageDiffusion())return{itemData:this.buildMessageDiffusionItemData(new i.NetworkModel(e.getPayloadValue()),t,e),sentimentColors:t.sentimentColors};e.hasTreePayloadType()}return{itemData:[],sentimentColors:t.sentimentColors}}static getData(e,t){const r={tendency:""},o=this.buildLegendData(e,t,r);if(o.enableClick=t.enableItemSelection,o.enableHover=t.enableItemHover,o.numSubItems=0,e.hasDataGraph()&&e.getDataGraph().hasAdditionalFrames()&&!e.getDataGraph().hasAnimationFrames()){const s=e.getDataGraph();void 0!==s.y_axis_name&&(o.title=s.y_axis_name),o.subTitles=[],o.subItemData=s.getAdditionalFrames().map(a=>{void 0!==s.z_axis_name?o.subTitles.push(s.z_axis_name):void 0!==o.title&&o.subTitles.push(" ");const l=(()=>{const t=e.getNestedGraphType();return t.indexOf("LINE")>-1?n.LegendItemIconType.LINE:t.indexOf("COLUMN")>-1?n.LegendItemIconType.SQUARE:n.LegendItemIconType.CIRCLE})(),c=new i.DataGraphWrapper(a),d=this.buildItemData(c,Object.assign({},t,{dotted:!0,iconType:l}),e,r);return o.numSubItems++,d})}return o.configCheckSum=s.StringUtils.calculateHash(t.axis.toString()+t.dotted+t.enableItemSelection+t.enableItemHover+t.legendType+t.iconType),o.tendencyCheckSum=s.StringUtils.calculateHash(r.tendency),o}}}),define("implementations/legend/legend_fragment/legend_fragment",["require","exports","canvas_engine","underscore","widget_base","implementations/abstract_canvas_fragment","implementations/legend/legend_event_mediator","implementations/legend/legend_interfaces","implementations/legend/legend_fragment/fragment_legend_factory","implementations/legend/legend_fragment/legend_data_factory","implementations/legend/legend_fragment/legend_fragment_interfaces","font_saver_service"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LegendFragment=class extends r.AbstractCanvasFragment{constructor(e){super(e),this.model=e,this.stageSettings={layerAmount:4,relayEvents:[i.Constants.StageEvents.MouseWheel]},this.legendLayoutMap={},this.legends=[],this.shouldRebuild=!0,this.oldWidth=0,this.hasDrawn=!1,this.isDisposed=!1,this.buildConfiguration=this.getFinalBuildConfiguration(e.widget,e.buildConfiguration),this.legendData=c.LegendDataFactory.getData(e.widget,this.buildConfiguration)}initialize(e,t,i){return super.initialize(e,t,i),this.settings=i,this.eventMediator=new o.LegendEventMediator(t),this.handleCanvas(i),this.animationStrategy=i.animationStrategy,this.chartContainer=e,t.listen(d.LegendFragmentActions.RERENDER,async()=>{await this.update(this.model),this.getDimensionsForLayout(this.settings),t.dispatch(n.WIDGET_MEDIATOR_BASE_MESSAGES.REDRAW_FRAGMENT,this)}),Promise.resolve(this)}processLegends(e,t){let i,s=!1;this.shouldRebuild?(i=t.map(({legend:e})=>e),s=!0):i=this.legends,this.shouldRebuild=!1;const n=this.legends.filter(e=>-1===i.indexOf(e));return new Promise(t=>{Promise.all(n.map(t=>(s=!0,this.removeLegend(e,t)))).then(()=>{this.legends=i,this.legends.forEach(e=>{e.hasParent()||(this.scene.addChild(e),e.setStageFacade(this.scene.getStageFacade()),e.subscribeToStage())}),t(s)})})}removeLegend(e,t){return new Promise(i=>{t.onMouseEnter.cancelAll(),t.onMouseLeave.cancelAll(),t.onMouseClick.cancelAll(),t.wasAnimated()&&1===e.animationStrategy&&e.animationDuration>0?t.fadeOut(e.animationDuration/2).then(()=>{void 0!==this.scene&&this.scene.removeChild(t),t.dispose(),i(this)}):(t.dispose(),i(this))})}createTendencyTweenData(e){const t={itemTweenData:{}};return t.itemTweenData=e.itemData.reduce((e,t)=>(e[t.text]=t.icon.tendency,e),{}),void 0!==e.subItemData&&(t.subitemTweenData=e.subItemData.map(e=>({itemTweenData:e.reduce((e,t)=>(e[t.text]=t.icon.tendency,e),{})}))),t}splitTendencyTweenData(e){const t=[],i=e.layout.numLegends,n=Math.round(Object.keys(this.tendencyTweenData.itemTweenData).length/i);let r,o;for(let e=0;e<i;e++){o=(r=n*e)+n;const i=Object.keys(this.tendencyTweenData.itemTweenData).slice(r,o);t.push(s.pick(this.tendencyTweenData.itemTweenData,i))}return t}tweenOrder(e,t){const i=this.legendLayoutMap[t].map(({legend:e})=>e),s=void 0===this.legendData.subItemData?[this.legendData.itemData]:[this.legendData.itemData].concat(this.legendData.subItemData.map(e=>e));return this.legends.forEach((t,n)=>{i[n].center(Math.floor(e.dimensions.width/i.length)),t.tweenOrder(e.animationDuration,s[n],i[n]),t.updateItemMap()}),this}tweenTendencies(e){if(void 0!==this.tendencyTweenData){let t=[this.tendencyTweenData.itemTweenData];t=void 0!==this.tendencyTweenData.subitemTweenData?t.concat(this.tendencyTweenData.subitemTweenData.map(e=>e.itemTweenData)):this.splitTendencyTweenData(e),this.legends.forEach((e,i)=>e.tweenTendencies(t[i])),this.tendencyTweenData=void 0}return this}checkIfShouldRebuild(e,t,i){return 1!==e||!!this.legends.some(e=>!e.wasAnimated())||t!==i||!this.hasDrawn}update(e){this.eventMediator.removeLegends(),this.model=e,void 0!==e.buildConfiguration&&(this.buildConfiguration=this.getFinalBuildConfiguration(e.widget,e.buildConfiguration));const t=c.LegendDataFactory.getData(e.widget,this.buildConfiguration);return this.checkIfShouldRebuild(this.animationStrategy,t.configCheckSum,this.legendData.configCheckSum)?this.shouldRebuild=!0:t.tendencyCheckSum!==this.legendData.tendencyCheckSum?this.tendencyTweenData=this.createTendencyTweenData(t):this.tendencyTweenData=void 0,this.legendData=t,this.hasDrawn=!1,Promise.resolve(this)}getScaling(e){switch(e){case n.FontSize.SMALL:return 1;case n.FontSize.MEDIUM:return 1.33;case n.FontSize.LARGE:return 1.66;case n.FontSize.EXTRA_LARGE:return 2}}centerLegends(e){return this.legends.forEach(t=>{t.center(Math.floor(e.dimensions.width/this.legends.length))}),this}transitionChanges(e,t){return this.legends.filter(e=>e.isDisposed()).length>0?Promise.resolve():(this.tweenOrder(e,t),this.tweenTendencies(e),this.centerLegends(e),Promise.all(this.legends.map(e=>e.playTransition(500))))}async draw(e,t){this.settings=e,this.animationStrategy=e.animationStrategy;const i=e.layout.id;return await this.processLegends(e,this.legendLayoutMap[i]).then(async s=>{if(!s&&t&&t.isCanceled()||this.isDisposed)return;const n=this.legendData.itemData.map(e=>e.text).join("").split("");await h.fontSaverService.saveFont(h.SaveableFontName.RobotoR,n,this);let r=!1;if(r=await this.handleCanvasBeforeTransition(e,r),!s&&t&&t.isCanceled()||this.isDisposed)return;s?this.centerLegends(e):await this.transitionChanges(e,i);const o=this.handleCanvasAfterTransition(e,r);if(this.oldWidth=e.dimensions.width,1===e.animationStrategy&&s&&await this.animateLegends(e.animationDuration/(s?1:2)),!(!s&&t&&t.isCanceled()||this.isDisposed)){if(this.legends.forEach(e=>{e.invalidate()}),1!==e.animationStrategy){const e=this.stage.onDrawEnd.subscribeOnceAsPromise();this.stage.processUpdate(),await e}!s&&t&&t.isCanceled()||this.isDisposed||(this.eventMediator.setLegends(this.legends),await o,this.hasDrawn=!0)}}),this}async handleCanvasAfterTransition(e,t){return t||(await this.handleCanvas(e,this.stageSettings),this.legends.forEach(e=>e.invalidate()),this.stage.processUpdate()),this}async handleCanvasBeforeTransition(e,t){return e.dimensions.width>this.oldWidth&&(await this.handleCanvas(e,this.stageSettings),this.legends.forEach(e=>e.invalidate()),this.stage.processUpdate(),t=!0),t}async animateLegends(e){return await Promise.all(this.legends.map(async t=>{t.buildInitialAnimation(e),await t.animate(e)})),this}dispose(){this.isDisposed=!0,void 0!==this.stage&&(this.stage.getScene().clearChildren(),this.stage.dispose()),this.eventMediator.dispose(),this.legends.length=0,Object.keys(this.legendLayoutMap).forEach(e=>{this.legendLayoutMap[e].forEach(e=>{e.legend.dispose(),e.legend=void 0}),this.legendLayoutMap[e].length=0,delete this.legendLayoutMap[e]}),this.legendLayoutMap={},h.fontSaverService.freeFont(h.SaveableFontName.RobotoR,this)}buildLegends(e,t){const i=l.FragmentLegendFactory.buildLegends(this.legendData,t,this.getScaling(t.style.fontSize));return Object.keys(this.legendLayoutMap).forEach(e=>{this.legendLayoutMap[e].forEach(({legend:e})=>{-1===this.legends.indexOf(e)&&e.dispose()})}),this.legendLayoutMap[e]=i.map(e=>({promise:e.compute(),legend:e})),i}getDimensionsForLayout(e){const t=e.layout.id;return this.calculateDimensions(this.buildLegends(t,e))}getLayoutIterator(){let e=d.LEGEND_FRAGMENT_LAYOUTS.filter(e=>{if(void 0!==this.legendData.subItemData){if(e.numLegends!==this.legendData.subItemData.length+1||e.type!==a.LegendTypes.LINE)return!1}else{if(void 0!==this.buildConfiguration.legendType&&this.buildConfiguration.legendType!==e.type)return!1;if(void 0!==this.buildConfiguration.numColumns&&e.numLegends!==this.buildConfiguration.numColumns)return!1;if(void 0!==this.buildConfiguration.numColumns&&1!==this.buildConfiguration.numColumns&&e.type!==a.LegendTypes.TABULAR)return!1}return!0});if(0===e.length){if(void 0===this.buildConfiguration.legendType)throw new Error("No valid legend layouts!");switch(this.buildConfiguration.legendType){case a.LegendTypes.LINE:e=[d.LEGEND_FRAGMENT_LAYOUTS.find(e=>"line_one"===e.id)];break;case a.LegendTypes.TABULAR:e=[d.LEGEND_FRAGMENT_LAYOUTS.find(e=>"tabular_one"===e.id)]}}return this.buildConfiguration.tryTabularFirst&&(e=e.sort(e=>e.id.indexOf("tabular")>-1?0:1)),new n.LayoutIterator(e,e=>this.getDimensionsForLayout(e))}async handleCanvas(e,t={layerAmount:3}){await super.handleCanvas(e,t),$(this.canvas).addClass("widget-legend")}calculateDimensions(e){const t=i.ObjectCache.DimensionsCalculatorPool.getObject();e.forEach(e=>{t.merge(e.getLegendDimension())});const s={width:t.getWidth(),height:t.getHeight()};return i.ObjectCache.DimensionsCalculatorPool.recycleObject(t),s}getXOrder(){switch(this.model.widget.getLegendOptions().position){case a.LegendPosition.LEFT:return-1;case a.LegendPosition.RIGHT:return 1;default:return 0}}getYOrder(){switch(this.model.widget.getLegendOptions().position){case a.LegendPosition.TOP:return-1;case a.LegendPosition.BOTTOM:return 1;default:return 0}}getFinalBuildConfiguration(e,t){const i=e.getLegendOptions(),n=s.extend(t,i);return 1!==n.position&&2!==n.position||(n.legendType=a.LegendTypes.TABULAR),Object.keys(n).reduce((s,n)=>{const r=t[n];return"function"==typeof r&&"colorFactory"!==n&&"itemFilter"!==n&&"colorPaletteBuilder"!==n&&"legendRangeFormatter"!==n?s[n]=r(e,i[n]):void 0===i[n]&&(s[n]=r),s},n)}}}),define("interfaces/popup_struct",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("settings/popover_chart_settings",["require","exports","settings/default_chart_settings","canvas_engine","jquery"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.DefaultChartSettings{constructor(e,t,i,n){super(e),this.type=r.defaultType,this.bubbleID=r.popupType,this.bubbleType=r.defaultType,this.bubblePadding=10,this.labelSettings=new s.LabelSettings,this.menuId=r.contextMenuType,void 0!==t&&(this.labelSettings=t),void 0!==i&&this.setType(i.toLowerCase()),void 0!==n&&(this.bubblePadding=n)}static fromJson(e,t={},i=r){void 0!==e.labelSettings&&(t.labelSettings=s.LabelSettings);const n=super.fromJson(e,t,i);return void 0!==e.type&&n.setType(e.type),n}toJson(){return n.extend(super.toJson(),{type:this.type,bubbleID:this.bubbleID,bubbleType:this.bubbleType,bubblePadding:this.bubblePadding,labelSettings:this.labelSettings.toJson(),menuId:this.menuId})}getType(){return this.type}setType(e){return[r.defaultType,r.popupType,r.pieType,r.sentimentType,r.contextMenuType,r.trendingScoreType,r.trendingType].indexOf(e)>0&&(this.type=e.toLocaleLowerCase(),(this.isPie()||this.isSentiment())&&(this.bubbleID=e.toLocaleLowerCase(),this.bubbleType=e.toLocaleLowerCase())),this}isSentiment(){return this.type===r.sentimentType}isTrendingScore(){return this.type===r.trendingScoreType}isTrending(){return this.type===r.trendingType}isPie(){return this.type===r.pieType}getBubbleId(){return this.bubbleID}getBubbleType(){return this.bubbleType}getBubblePadding(){return this.bubblePadding}getLabelSettings(){return this.labelSettings}getMenuId(){return this.menuId}merge(e){return super.merge(e),this.labelSettings=e.labelSettings.clone(),this.bubblePadding=e.bubblePadding,this.type=e.type,this.bubbleID=e.bubbleID,this.bubbleType=e.bubbleType,this.menuId=e.menuId,this}}r.defaultType="bars",r.popupType="popup",r.pieType="pie",r.sentimentType="sentiment",r.contextMenuType="context_menu",r.trendingScoreType="trending_score",r.trendingType="trending",t.PopoverChartSettings=r}),define("settings/pack_chart_settings",["require","exports","settings/popover_chart_settings"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PackChartSettings=class extends i.PopoverChartSettings{constructor(){super(...arguments),this.drawParentNames=!0}setParentNameDrawing(e){this.drawParentNames=e}shouldDrawParentNames(){return!0===this.drawParentNames}}}),define("canvas_chart_utilities",["require","exports","dialogs/country_dialog","dialogs/country_dialog_title","implementations/abstract_canvas_fragment","implementations/chart","implementations/legend/legend","implementations/legend/legend_color_palette_builder","implementations/legend/legend_event_mediator","implementations/legend/legend_factory","implementations/legend/legend_fragment/fragment_legend_factory","implementations/legend/legend_fragment/legend_data_factory","implementations/legend/legend_fragment/legend_fragment","implementations/legend/legend_fragment/legend_fragment_interfaces","implementations/legend/legend_interfaces","implementations/legend/legend_item","implementations/legend/legend_item_icon","implementations/legend/legend_item_icon_tendency","implementations/legend/legend_item_label","implementations/legend/legend_line","implementations/legend/legend_tabular","implementations/legend/legend_title","settings/default_chart_settings","settings/pack_chart_settings","settings/popover_chart_settings"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T){"use strict";function I(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),I(i),I(s),I(n),I(r),I(o),I(a),I(l),I(c),I(d),I(h),I(u),I(p),I(g),I(m),I(_),I(f),I(y),I(b),I(E),I(S),I(C),I(v),I(T)}),define("animation/stateful_animation_mixin",["require","exports","graphics_utilities","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatefulAnimationMixin=function(e){return class extends e{constructor(...e){super(...e),this.pendingResolves=[],this.animationStateQueue=[],this.statefulAnimationModel=e[0].animationStates,this.currentAnimationState=e[0].animationStates.options.initialState}setAnimationState(e){return this.nextAnimationState||e!==this.currentAnimationState?new Promise(t=>{this.pendingResolves.push(t),this.nextAnimationState=e,this.mergeTargetAnimationStates(this.generateAnimation(this.getStateModel(e))),this.isAnimationStateChanging||(this.isAnimationStateChanging=!0,this.pendingAnimationFrame=requestAnimationFrame(()=>this.animationFrame()))}):Promise.resolve()}queueAnimationState(e){this.isAnimationStateChanging?this.animationStateQueue.push(e):this.setAnimationState(e)}animationFrame(){if(this.isAnimationDone()){if(this.currentAnimationState=this.nextAnimationState,!(this.animationStateQueue.length>0))return this.pendingAnimationFrame=void 0,this.nextAnimationState=void 0,this.isAnimationStateChanging=!1,this.pendingResolves.forEach(e=>e()),void(this.pendingResolves.length=0);this.nextAnimationState=this.animationStateQueue.shift()}else Object.keys(this.targetAnimationState).forEach(e=>{this.applyTick(this,this.targetAnimationState,e)});this.pendingAnimationFrame=requestAnimationFrame(()=>this.animationFrame())}applyTick(e,t,i){void 0!==t[i].__value?this.tween(e,i,t[i].speedFactor,t[i].__value):Object.keys(t[i]).forEach(s=>{this.applyTick(e[i],t[i],s)})}tween(e,t,n,r){if("number"==typeof e[t]){if(n instanceof s.AbstractVector)throw new Error("cant use vector for speed on a number");e[t]>r?e[t]-=Math.min(e[t]-r,n*this.statefulAnimationModel.options.tickSpeed):e[t]<r&&(e[t]+=Math.min(r-e[t],n*this.statefulAnimationModel.options.tickSpeed))}if(e[t]instanceof s.Vector2D){if(n instanceof s.AbstractVector&&2!==n.components.length)throw new Error("When using vector for speed it must have same number of dimensions as the value");n instanceof s.AbstractVector?(this.tween(e[t],"x",n.components[0],r.x),this.tween(e[t],"y",n.components[1],r.y)):(this.tween(e[t],"x",n,r.x),this.tween(e[t],"y",n,r.y))}if(e[t]instanceof i.Color){if(n instanceof s.AbstractVector&&4!==n.components.length)throw new Error("When using tweening color with a vector, it has to be a vector4d");n instanceof s.AbstractVector?(this.tween(e[t],"r",n.components[0],r.r),this.tween(e[t],"g",n.components[1],r.g),this.tween(e[t],"b",n.components[2],r.b),this.tween(e[t],"a",n.components[3],r.a)):(this.tween(e[t],"r",n,r.r),this.tween(e[t],"g",n,r.g),this.tween(e[t],"b",n,r.b),this.tween(e[t],"a",n,r.a))}}mergeTargetAnimationStates(e){void 0!==this.targetAnimationState?Object.keys(e).forEach(t=>{this.mergeSubStateObject(this.targetAnimationState,e,t)}):this.targetAnimationState=e}mergeSubStateObject(e,t,i){void 0===e[i]||this.isTweenable(e[i])?e[i]=t[i]:void 0!==t[i]&&Object.keys(t[i]).forEach(s=>{this.mergeSubStateObject(e[i],t[i],s)})}getStateModel(e){return this.statefulAnimationModel.states[e]}generateAnimation(e){const t={};return Object.keys(e.state).forEach(i=>{this.generateTweenModelsByKey({key:i,source:e.state,realObject:this,nextTargetState:t,previousTargetState:this.targetAnimationState||{}})}),t}isAnimationDone(){return void 0===this.targetAnimationState||Object.keys(this.targetAnimationState).every(e=>this.isSubAnimationDone(this,this.targetAnimationState,e))}isSubAnimationDone(e,t,i){return void 0!==t[i].__value?this.isTweenDone(e[i],t[i].__value):Object.keys(t[i]).every(s=>this.isSubAnimationDone(e[i],t[i],s))}generateTweenModelsByKey(e){this.validateStateValue(e);const{key:t,source:i,previousTargetState:s,nextTargetState:n,realObject:r}=e;if(this.isSubStateObject(i[t]))return n[t]={},Object.keys(i[t]).forEach(e=>{this.generateTweenModelsByKey({key:e,source:i[t],realObject:r[t],nextTargetState:n[t],previousTargetState:s[t]||{}})});const o=this.resolveStateValue(i[t],s[t],r[t]);n[t]={__value:o.__value,speedFactor:o.speedFactor||1,delay:o.delay||0,linkSpeedFactor:o.linkSpeedFactor}}resolveStateValue(e,t,i){let s,n,r=!1;if(void 0!==t){const e=t.linkSpeedFactor;e&&e[this.nextAnimationState]&&(r=!0,s=e[this.nextAnimationState])}return"object"!=typeof(n="function"==typeof e?e(void 0!==t?t.__value:i):e)||void 0===n.value?{__value:n,speedFactor:r?s:1,delay:0}:{__value:n.value,speedFactor:r?s:n.speedFactor,delay:n.delay,linkSpeedFactor:n.linkSpeedFactor}}isTweenable(e){return"number"==typeof e||e instanceof s.Vector2D||e instanceof i.Color}isSubStateObject(e){return"object"==typeof e&&!this.isTweenable(e)&&void 0===e.value}validateStateValue(e){if(void 0===e.realObject)throw new Error(`Invalid animation state, animated object does not have key ${e.key}`)}dispose(){super.dispose(),this.pendingAnimationFrame&&cancelAnimationFrame(this.pendingAnimationFrame)}isTweenDone(e,t){return"number"==typeof e?e===t:e instanceof s.Vector2D?e.isEqual(t):e.colorData.isEqual(t.colorData)}}}}),define("interaction/event_block_mixin",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBlockMixin=function(e){return class extends e{constructor(...e){super(...e),this.allDisabled=!1,this.disabledEvents=[]}emitEvent(e,t){if(!this.allDisabled&&!this.disabledEvents.includes(e))return super.emitEvent(e,t)}disableAllEvents(){this.allDisabled=!0}enableAllEvents(){this.allDisabled=!1}disableEvent(e){this.disabledEvents.push(e)}enableEvent(e){const t=this.disabledEvents.indexOf(e);-1!==t&&this.disabledEvents.splice(t,1)}}}}),define("interaction/interaction_shape_mixin",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractionShapeMixin=function(e){return class extends e{constructor(...e){super(...e),this.shapeModifier=e[0].shapeModifier||_.identity}getShape(){return this.shapeModifier(super.getShape.call(this))}}}}),define("canvas_drawable_mixins",["require","exports","animation/stateful_animation_mixin","interaction/event_block_mixin","interaction/interaction_shape_mixin"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("core/utilities/unit",["require","exports","constants","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t={}){t=s.assign({noDecimal:!1,unitType:"px"},t),this.options=t;const{unitType:i}=t;s.isString(e)?this.parseExpression(e):e instanceof n?(this.value=e.getValue(),t.unitType=e.getType()):(t.unitType=i,this.value=e),Object.freeze(t)}parseExpression(e){if(-1!==e.indexOf(i.Constants.UnitType.CENTIMETERS))this.options.unitType=i.Constants.UnitType.CENTIMETERS,this.value=parseFloat(e);else if(-1!==e.indexOf(i.Constants.UnitType.MILLIMETERS))this.options.unitType=i.Constants.UnitType.MILLIMETERS,this.value=parseFloat(e);else if(-1!==e.indexOf(i.Constants.UnitType.PERCENT))this.options.unitType=i.Constants.UnitType.PERCENT,this.value=parseFloat(e);else{if(-1===e.indexOf(i.Constants.UnitType.PIXEL))throw new Error("unknown Expression");this.options.unitType=i.Constants.UnitType.PIXEL,this.value=parseFloat(e)}return this}getType(){return this.options.unitType}getValue(){return this.transformValue(this.value)}isInPercent(){return this.getType()===i.Constants.UnitType.PERCENT}isInPixel(){return this.getType()===i.Constants.UnitType.PIXEL}isInCentimeters(){return this.getType()===i.Constants.UnitType.CENTIMETERS}isInMillimeters(){return this.getType()===i.Constants.UnitType.MILLIMETERS}getValueIn(e,t=1){switch(e){case i.Constants.UnitType.PERCENT:switch(this.getType()){case i.Constants.UnitType.PERCENT:return this.transformValue(this.value);case i.Constants.UnitType.PIXEL:case i.Constants.UnitType.MILLIMETERS:case i.Constants.UnitType.CENTIMETERS:return this.transformValue(this.value/t*100);default:throw new Error("unsupported Unittype set")}case i.Constants.UnitType.PIXEL:switch(this.getType()){case i.Constants.UnitType.PERCENT:return this.transformValue(this.value*t/100);case i.Constants.UnitType.PIXEL:case i.Constants.UnitType.MILLIMETERS:case i.Constants.UnitType.CENTIMETERS:return this.value;default:throw new Error("Unsupported Unittype set")}default:throw new Error("Unsupported Unittype set")}}getRatio(e){return this.options.unitType===i.Constants.UnitType.PERCENT?this.value/100:this.value/e}toString(){return this.transformValue(this.value)+this.options.unitType}transformValue(e){const{noDecimal:t}=this.options;return t&&(e=Math.round(e)),e}}t.Unit=n}),define("core/graphics/primitives/vector",["require","exports","core/graphics/primitives/point","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Point{constructor(e,t){super(e,t)}static zero(){return new n(0,0)}static fromEndPoints(e,t){return n.zero().setEndPoints(e,t)}setEndPoints(e,t){return e instanceof i.Point?t instanceof i.Point?this.setCoordinates(t.getX()-e.getX(),t.getY()-e.getY()):this.setCoordinates(t.getAbsoluteX()-e.getX(),t.getAbsoluteY()-e.getY()):t instanceof i.Point?this.setCoordinates(t.getX()-e.getAbsoluteX(),t.getY()-e.getAbsoluteY()):this.setCoordinates(t.getAbsoluteX()-e.getAbsoluteX(),t.getAbsoluteY()-e.getAbsoluteY())}clone(){return new n(this.getX(),this.getY())}toNormalVector(e){return e?new n(this.getY(),-this.getX()):new n(-this.getY(),this.getX())}scalarProductWith(e){return this.getX()*e.getX()+this.getY()*e.getY()}getLength(){return Math.sqrt(this.getLengthSquared())}getLengthSquared(){return Math.pow(this.getX(),2)+Math.pow(this.getY(),2)}getAngle(e=!1){let t=Math.atan2(this.getY(),this.getX());return e||(t=s.trigonometryUtils.radiansToDegrees(t)),t}isClockwiseFrom(e){return this.scalarProductWith(e.toNormalVector(!0))>0}}t.Vector=n}),define("core/graphics/primitives/shape",["require","exports","core/graphics/primitives/point","constants","reusable_utilities","core/graphics/primitives/vector"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.Point{constructor(e,t){super(e,t),this.type=s.Constants.Shape,this.coordinates=i.Point.zero(!0),this.proximityTolerance=1}getType(){return this.type}getCoordinates(){return this.coordinates.unfreeze(),this.coordinates.merge(this),this.coordinates.freeze(),this.coordinates}isContainedIn(e){return!1}clone(){const e=super.clone();return e.type=s.Constants.Shape,e.coordinates=i.Point.zero(!0),e.proximityTolerance=1,e}getBoundingBox(){throw Error("Function must be overridden in extending classes")}getInnerRectForRatio(e,t){throw Error("Function must be overridden in extending classes")}getProximityTolerance(){return this.proximityTolerance}setProximityTolerance(e){return this.proximityTolerance=e,this}areNodesContainedIn(e){return!1}containsPoint(e){return!1}containsShape(e){return!1}}o.PointPool=new n.ObjectPool({initialPoolSize:5,flexible:!0,initializationFunction:e=>(e.resetCoordinates(),e),objectFactory:i.Point.zero,resetFunction:e=>e.resetCoordinates()}),o.VectorPool=new n.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:r.Vector.zero,resetFunction:e=>e.resetCoordinates()}),t.Shape=o}),define("core/graphics/primitives/line",["require","exports","core/graphics/primitives/shape","core/graphics/primitives/point","constants","underscore","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.Shape{constructor(e,t,i,r){super(e,t),this.lookUpTable=[],this.cartesianEquation={toString:""},this.derivativeEquation={toString:""},this.curveParams={source:s.Point.zero(),destination:s.Point.zero()},this.destination=new s.Point(i,r),this.type=n.Constants.Shape.Line}static zero(){return new a(0,0,0,0)}reset(){return this.resetCoordinates(),this.getDestination().resetCoordinates(),this}clone(){return new a(this.getX(),this.getY(),this.getDestination().getX(),this.getDestination().getY())}freeze(){return super.freeze(),this.getDestination().freeze(),this}unfreeze(){return super.unfreeze(),this.getDestination().unfreeze(),this}isEqualTo(e){return super.isEqualTo(e)&&this.getType()===e.getType()&&e.getDestination().getX()===this.getDestination().getX()&&e.getDestination().getY()===this.getDestination().getY()}getLength(){return this.isCurveInvalid()&&(this.length=Math.sqrt(this.getLengthSquared())),this.length}getLengthSquared(){return Math.pow(this.getDestination().getX()-this.getX(),2)+Math.pow(this.getDestination().getY()-this.getY(),2)}isContainedIn(e,t=0){const s=i.Shape.PointPool.getObject();let n=e.containsPoint(this);if(n&&(n=e.containsPoint(this.getDestination()),0!==t&&n)){const i=1/t;let r=i;for(;n&&r<1;)s.merge(this).addFast((this.getDestination().getX()-this.getX())*r,(this.getDestination().getY()-this.getY())*r),n=e.containsPoint(s),r+=i}return i.Shape.PointPool.recycleObject(s),n}getCenter(){return this.getOrigin().add(this.getDestination()).multiply(.5)}getTopLeft(){const e=this.getX()<this.getDestination().getX()?this.getX():this.getDestination().getX(),t=this.getY()<this.getDestination().getY()?this.getY():this.getDestination().getY();return new s.Point(e,t)}getBottomRight(){const e=this.getX()>this.getDestination().getX()?this.getX():this.getDestination().getX(),t=this.getY()>this.getDestination().getY()?this.getY():this.getDestination().getY();return new s.Point(e,t)}getHorizontalProjection(){return Math.abs(this.getDestination().getX()-this.getX())}getVerticalProjection(){return Math.abs(this.getDestination().getY()-this.getY())}getOrigin(){return this.getCoordinates()}getDestination(){return this.destination}setDestinationCoordinates(e,t){return this.destination.setCoordinates(e,t)}compute(){return this.curveParams.source.merge(this.getOrigin()),this.curveParams.destination.merge(this.getDestination()),this.computeLookUpTable(),this.computeCartesianEquation(),this}computeCartesianEquation(){const e=this.getLookUpTable(),t=e.length,i=e[Math.floor(t/3)],s=e[Math.min(Math.ceil(2*t/3),t-1)],n=s.x-i.x;if(0!==n){const e=(s.y-i.y)/n,t=i.y/(e*i.x);this.cartesianEquation.a=Math.floor(100*e)/100,this.cartesianEquation.b=Math.floor(100*t)/100,this.cartesianEquation.toString="y = ",0!==e&&(this.cartesianEquation.toString+=e+"x + "),this.cartesianEquation.toString+=t}else this.cartesianEquation.a=i.x>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.b=i.y,this.cartesianEquation.toString="y = "+i.y;return this.computeDerivativeEquation(),this}computeDerivativeEquation(){const e=this.cartesianEquation.a;return this.derivativeEquation.a=e,this.derivativeEquation.toString="y = "+e,this}applyDerivativeEquation(e){const t=this.derivativeEquation.a;return r.isFinite(t)?t:t>0?2:-2}getSlopeAngleForX(e){return 45*this.applyDerivativeEquation(e)}computeLookUpTable(e=Math.ceil(this.getLength())){return e>0&&(this.lookUpTable=r.map(r.range(0,1,1/e),e=>({x:this.getX()+Math.min(1,e)*(this.getDestination().getX()-this.getX()),y:this.getY()+Math.min(1,e)*(this.getDestination().getY()-this.getY())}))),this}getLookUpTable(){return this.isCurveInvalid()&&this.compute(),this.lookUpTable}getCoordinatesAtLength(e){return this.getLookUpTable()[e]}isCurveInvalid(){let e=void 0===this.length;const t={source:this.getOrigin(),destination:this.getDestination()};return e||(e=r.filter(Object.keys(this.curveParams),e=>this.curveParams[e].isEqualTo(t[e])).length<2),e}containsPoint(e){return r.chain(this.getLookUpTable()).filter(t=>Math.abs(e.getX()-t.x)<this.getProximityTolerance()).filter(t=>Math.abs(e.getY()-t.y)<this.getProximityTolerance()).value().length>0}translate(e,t){return super.translate(e,t),this.getDestination().translate(e,t),this}}a.LinePool=new o.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:a.zero,resetFunction:e=>e.reset()}),t.Line=a}),define("core/graphics/font",["require","exports","constants","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t){this.size=11,this.family=i.Constants.Font.Family.Default,this.style=i.Constants.Font.Style.Default,this.weight=i.Constants.Font.Weight.Default,this.minSize=1,this.maxSize=Number.MAX_VALUE,void 0!==e&&this.setSize(e),void 0!==t&&this.setFamily(t)}static zero(){return new n}compareTo(e){return e.getSize()===this.getSize()&&(e.getStyle()===this.getStyle()&&(e.getFamily()===this.getFamily()&&(e.getWeight()===this.getWeight()&&(e.getMaxSize()===this.getMaxSize()&&e.getMinSize()===this.getMinSize()))))}static fromJson(e){const t=new n;return Object.keys(e).forEach(i=>t[i]=e[i]),t}toJson(){return{size:this.size,family:this.family,style:this.style,weight:this.weight,minSize:this.minSize,maxSize:this.maxSize}}equals(e){return this.size===e.size&&this.minSize===e.minSize&&this.maxSize===e.maxSize&&this.equalsinStyle(e)}equalsinStyle(e){return this.family===e.family&&this.weight===e.weight&&this.style===e.style}assimilate(e){return this.setSize(e.getSize()),this.setFamily(e.getFamily()),this.setStyle(e.getStyle()),this.setWeight(e.getWeight()),this.setMinSize(e.getMinSize()),this.setMaxSize(e.getMaxSize()),this}clear(){return this.setSize(1),this.setFamily(i.Constants.Font.Family.Default),this.setStyle(i.Constants.Font.Style.Default),this.setWeight(i.Constants.Font.Weight.Default),this.setMinSize(1),this.setMaxSize(Number.MAX_VALUE),this}clone(){const e=new n;return e.setFamily(this.getFamily()).setSize(this.getSize()).setMinSize(this.getMinSize()).setMaxSize(this.getMaxSize()).setStyle(this.getStyle()).setWeight(this.getWeight()),e}resetToDefault(){return this.clear(),this.setSize(11),this.setFamily(i.Constants.Font.Family.Default),this}setStyle(e){return this.style=e,this}getStyle(){return this.style}setWeight(e){return this.weight=e,this}getWeight(){return this.weight}setSize(e){return s.logService.assert(e>0,"font size must be a positive number",i.Constants.Feature.Utilities.Font,e),e=Math.max(e,this.getMinSize()),e=Math.min(e,this.getMaxSize()),this.size=e,this}getSize(){return this.size}setMaxSize(e){return s.logService.assert(e>0,"maximum font size must be a positive number",i.Constants.Feature.Utilities.Font,e),this.maxSize=Math.max(1,Math.round(e)),this.normalizeFontSize(),this}getMaxSize(){return this.maxSize}normalizeFontSize(){(this.getSize()<this.getMinSize()||this.getSize()>this.getMaxSize())&&this.setSize(this.getSize())}setMinSize(e){return s.logService.assert(e>0,"minimum font size must be a positive number",i.Constants.Feature.Utilities.Font,e),this.minSize=Math.max(1,Math.round(e)),this.normalizeFontSize(),this}getMinSize(){return this.minSize}setFamily(e){return this.family=e,this}getFamily(){return this.family}build(){let e="";return this.getStyle()!==i.Constants.Font.Style.Default&&(e+=this.getStyle()),this.getWeight()!==i.Constants.Font.Weight.Default&&(e=""===e?e:e+" ",e+=this.getWeight()),e=""===e?e:e+" ",e+=this.getSize()+"px",e+=" ",e+=this.getFamily()}}t.Font=n}),define("core/graphics/primitives/circle",["require","exports","core/graphics/primitives/shape","core/graphics/primitives/point","core/graphics/primitives/rectangle","constants","log","math_utils","underscore","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d extends i.Shape{constructor(e,t,i=0,s=0,n=!1){super(e,t),this.radius=0,this.depth=0,this.thickness=0,this.setRadius(i),this.setDepth(s),this.setShallow(n),this.type=r.Constants.Shape.Circle}static zero(){return new d(0,0)}setValues(e,t,i,s=0){return this.setCoordinates(e,t),this.setRadius(i),this.setDepth(s),this}reset(){return this.resetCoordinates(),this.setRadius(0),this.setDepth(0),this.setShallow(!1),this}clone(){return new d(this.getX(),this.getY(),this.getRadius(),this.getDepth(),this.isShallow())}isEqualTo(e){let t=super.isEqualTo(e);return t&&(t=t&&this.getRadius()===e.getRadius()&&this.getDepth()===e.getDepth()&&this.isShallow()===e.isShallow()),t}getRadius(){return this.radius}getThickness(){return this.thickness}setRadius(e){return this.checkFrozenState(),o.logService.assert(e>=0," the radius of a circle has to be a positive number",r.Constants.Feature.Primitives.Circle,{radius:e}),this.radius=e,this.thickness=e-this.getDepth(),this}getBoundingBox(){return n.Rectangle.RectanglePool.getObject().assimilateCoordinates(this).setWidth(2*this.getRadius()).setHeight(2*this.getRadius())}setShallow(e){return this.checkFrozenState(),this.shallow=e,this}isShallow(){return this.shallow}getDepth(){return this.depth}setDepth(e){return this.checkFrozenState(),o.logService.assert(e>=0," the depth of a circle has to be a positive number",r.Constants.Feature.Primitives.Circle,{depth:e}),this.depth=e,this.thickness=this.getRadius()-e,this}static getPointOnArc(e,t,i,n=s.Point.zero()){return t=a.trigonometryUtils.degreesToRadians(t),n.addFast(e).addFast(Math.round(i*Math.cos(t)),Math.round(i*Math.sin(t)))}getDepthPoint(e,t=s.Point.zero()){return d.getPointOnArc(this,e,this.getDepth(),t)}getArcPoint(e,t=s.Point.zero()){return d.getPointOnArc(this,e,this.getRadius(),t)}getInnerRectForRatio(e,t){const i=n.Rectangle.RectanglePool.getObject();return i.setHeight(Math.sqrt(4*Math.pow(this.getRadius(),2)/(Math.pow(e/t,2)+1))),i.setWidth(e*i.getHeight()/t),i.setX(this.getX()-i.getWidth()/2),i.setY(this.getY()-i.getHeight()/2),i.freeze(),i}static getCardinals(){return[0,45,90,135,180,225,270,315,360]}static getAllCardinals(){return[0,22.5,45,67.5,90,112.5,135,157.5,180,202.5,225,247.5,270,292.5,315,337.5,360]}isPointOnArc(e,t=0){let i;e instanceof s.Point?(t=e.getY(),i=e.getX()):i=e;const n=Math.pow(i-this.getX(),2)+Math.pow(t-this.getY(),2);return Math.abs(n-Math.pow(this.getRadius(),2))<.5}getArcPointXForY(e,t=!1){const i=Math.sqrt(Math.pow(this.getRadius(),2)-Math.pow(e-this.getY(),2));return t?this.getX()-i:this.getX()+i}getArcPointYForX(e,t=!1){const i=Math.sqrt(Math.pow(this.getRadius(),2)-Math.pow(e-this.getX(),2));return t?this.getY()-i:this.getY()+i}getCardinalPoints(){const e=[];return l.each(d.getCardinals(),t=>{e.push(this.getArcPoint(t))}),e}containsShape(e){switch(e.getType()){case r.Constants.Shape.Rectangle:return e.areNodesContainedIn(this);case r.Constants.Shape.Circle:return this.distanceSquaredTo(e)<=Math.pow(this.getRadius()-e.getRadius(),2);case r.Constants.Shape.Polygon:return e.areNodesContainedIn(this);case r.Constants.Shape.CircleSegment:return e.isContainedIn(this);case r.Constants.Shape.Line:return this.containsPoint(e)&&this.containsPoint(e.getDestination());default:throw new Error("Shape Unknown")}}isContainedIn(e){const t=i.Shape.PointPool.getObject();let s=e.containsPoint(this);if(s){const i=this.getRadius();l.find(d.getAllCardinals(),n=>(t.merge(this).addFast(Math.round(i*Math.cos(n)),Math.round(i*Math.sin(n))),!(s=e.containsPoint(t))))}return i.Shape.PointPool.recycleObject(t),s}intersectsRectangle(e){const t=i.Shape.PointPool.getObject().setCoordinates(Math.abs(this.x-(e.x+e.width/2)),Math.abs(this.y-(e.y+e.height/2))),s=d.intersectsRectangleMemoized(t.x,t.y,this.radius,e.width,e.height);return i.Shape.PointPool.recycleObject(t),s}static intersectsRectangleMemoized(e,t,i,s,n){return e<=s/2+i&&t<=n/2+i&&(e<=s/2||t<=n/2||Math.pow(e-s/2,2)+Math.pow(t-n/2,2)<=Math.pow(i,2))}containsPoint(e){const t=i.Shape.VectorPool.getObject();t.setEndPoints(this.getCoordinates(),e);let s=t.getLengthSquared()<=Math.pow(this.getRadius(),2)+.1;return s&&this.getDepth()>0&&!this.isShallow()&&(s=t.getLengthSquared()>=Math.pow(this.getDepth(),2)-.1),i.Shape.VectorPool.recycleObject(t),s}}__decorate([c.memoize((e,t,i,s,n)=>`${e}|${t}|${i}|${s}|${n}`),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number,Number,Number]),__metadata("design:returntype",Boolean)],d,"intersectsRectangleMemoized",null),t.Circle=d}),define("core/gradient",["require","exports","underscore","core/graphics/primitives/point","core/graphics/primitives/circle","event","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e,t,s){this.stops=[],this.reportGenerated=new r.Event,this.startShape=e,this.endShape=t,i.each(s,e=>{e instanceof o.Color||i.isString(e)?this.addColorStop(e):this.addColorStop(e.color,e.placement)})}compareTo(e){if(this.stops.length!==e.getStops().length)return!1;for(let t=0,i=this.stops.length;t<i;t++){if(this.stops[t].placement!==e.getStops[t].placement)return!1;if(this.stops[t].color.toHex6()!==e.getStops[t].color.toHex6())return!1}return this.simplify(this.startShape)===this.simplify(e.getStartShape())&&this.simplify(this.endShape)===this.simplify(e.getEndShape())}simplify(e,...t){return i.isFunction(e)?e(...t):e}static empty(){return new a(s.Point.zero(),s.Point.zero())}setStartShape(e){return this.startShape=e,this}getStartShape(){return this.startShape}setEndShape(e){return this.endShape=e,this}getEndShape(){return this.endShape}addColorStop(e,t){return e instanceof o.Color||(e=new o.Color(e)),this.stops.push({color:e,placement:t}),this}getStops(){return this.stops}getStop(e){return this.getStops()[e]}clear(){return this.stops.length=0,this}buildOn(e){let t;const s=this.simplify(this.startShape),r=this.simplify(this.endShape),o=new l;s instanceof n.Circle?(t=e.createRadialGradient(s.getX(),s.getY(),s.getRadius(),r.getX(),r.getY(),r.getRadius()),o.gradientType="Radial",o.gradientStart={x:s.getX(),y:s.getY(),radius:s.getRadius()},o.gradientEnd={x:r.getX(),y:r.getY(),radius:r.getRadius()},o.startIsFunction=i.isFunction(this.startShape),o.endIsFunction=i.isFunction(this.endShape)):(t=e.createLinearGradient(s.getX(),s.getY(),r.getX(),r.getY()),o.gradientType="Linear",o.gradientStart={x:s.getX(),y:s.getY()},o.gradientEnd={x:r.getX(),y:r.getY()},o.startIsFunction=i.isFunction(this.startShape),o.endIsFunction=i.isFunction(this.endShape));let a=[],c=void 0;if(o.stops=[],i.each(this.stops,function(e){if(void 0!==e.placement){if(a.length>0){const s=c||0,n=i.isUndefined(c)?1:0,r=(e.placement-s)/(a.length+1-n);for(let e=0;e<a.length;e++)t.addColorStop(s+r*(e+1-n),a[e].toRGBAString()),o.stops.push({placement:s+r*(e+1-n),color:a[e].toRGBAString()});a.length=0}c=e.placement,t.addColorStop(e.placement,e.color.toRGBAString()),o.stops.push({placement:e.placement,color:e.color.toRGBAString()})}else a.push(e.color)}),a.length>0){let e=0,s=1;void 0!==c&&(e=c,s=0);const n=(1-e)/(a.length-s);i.each(a,function(i,r){t.addColorStop(e+n*(r+1-s),i.toRGBAString()),o.stops.push({placement:e+n*(r+1-s),color:i.toRGBAString()})})}return this.reportGenerated.fire(o),t}}t.Gradient=a;class l{}t.GradientReport=l}),define("core/graphics/stage/layer",["require","exports","core/graphics/primitives/point"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Layer=class{constructor(){this.canvas=document.createElement("canvas"),this.invalid=!0,this.offset=i.Point.zero()}get width(){return this.canvas.width}set width(e){this.canvas.width=e}get height(){return this.canvas.height}set height(e){this.canvas.height=e}get style(){return this.canvas.style}isInvalid(){return this.invalid}getCanvas(){return this.canvas}getContext(e){return this.canvas.getContext(e)}invalidate(){return this.invalid=!0,this}setOffset(e,t){return this.getOffset().setX(e).setY(t),this}getOffset(){return this.offset}translate(e,t){return this.getOffset().translate(e,t)}validate(){return this.invalid=!1,this}}}),define("core/graphics/primitives/polygon",["require","exports","core/graphics/primitives/rectangle","constants","core/graphics/primitives/shape","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.Rectangle{constructor(e,t,n,r=!1){super(e,t,0,0),this.points=[],this.boundingBox=i.Rectangle.zero(),this.resetExtrema(),this.addPoints(n),this.setReturnToSource(r),this.type=s.Constants.Shape.Polygon}static zero(){return new o(0,0,[])}reset(){return super.reset(),this.points.length=0,this.resetExtrema(),this}resetExtrema(){this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}clone(){const e=[];return r.each(this.getPoints(),(t,i)=>{0!==i&&e.push(t.clone())}),new o(this.getX(),this.getY(),e,this.getReturnToSource())}freeze(){return super.freeze(),r.each(this.getPoints(),e=>{e.freeze()}),this}unfreeze(){return super.unfreeze(),r.each(this.getPoints(),(e,t)=>{0!==t&&e.unfreeze()}),this}getReturnToSource(){return this.returnToSource}setReturnToSource(e){return this.checkFrozenState(),this.returnToSource=e,this}isEqualTo(e){if(this.getPoints().length===e.getPoints().length){let t=super.isEqualTo(e)&&this.getType()===e.getType()&&this.getReturnToSource()===e.getReturnToSource();return t&&r.each(this.getPoints(),(i,s)=>{const n=e.getPoint(s);t=t&&n.getX()===i.getX()&&n.getY()===i.getY()}),t}return!1}addPoints(e){return this.checkFrozenState(),r.each(e,e=>{this.addPoint(e)}),this}addPoint(e){this.checkFrozenState();let t=!1;return e.getX()<this.getMinX()&&(this.setMinX(e.getX()),t=!0),e.getX()>this.getMaxX()&&(this.setMaxX(e.getX()),t=!0),e.getY()<this.getMinY()&&(this.setMinY(e.getY()),t=!0),e.getY()>this.getMaxY()&&(this.setMaxY(e.getY()),t=!0),this.getPoints().push(e),t&&this.refreshBoundingBox(),this}refreshBoundingBox(){this.setWidth(this.getMaxX()-this.getMinX()),this.setHeight(this.getMaxY()-this.getMinY()),this.boundingBox.unfreeze(),this.boundingBox.setX(this.getMinX()),this.boundingBox.setY(this.getMinY()),this.boundingBox.setWidth(this.getWidth()),this.boundingBox.setHeight(this.getHeight()),this.boundingBox.freeze()}getPoint(e){return this.getPoints()[e]}getMinX(){return this.minX}setMinX(e){return this.minX=e,this}translate(e,t){return this.checkFrozenState(),super.translate(e,t),this.getPoints().forEach(i=>{i.unfreeze(),i.translate(e,t),i.freeze()}),this}getMinY(){return this.minY}setMinY(e){return this.minY=e,this}getMaxX(){return this.maxX}setMaxX(e){return this.maxX=e,this}getMaxY(){return this.maxY}setMaxY(e){return this.maxY=e,this}getPoints(){return this.points}getBoundingBox(){const e=this.boundingBox.getBottomRight(),t=i.Rectangle.RectanglePool.getObject().assimilateTopLeftBottomRight(this.boundingBox.getTopLeft(),e);return n.Shape.PointPool.recycleObject(e),t}containsShape(e){switch(e.getType()){case s.Constants.Shape.Rectangle:case s.Constants.Shape.Polygon:case s.Constants.Shape.Circle:case s.Constants.Shape.CircleSegment:case s.Constants.Shape.Line:return e.isContainedIn(this);default:throw new Error("Shape Unknown")}}isContainedIn(e){let t=void 0,i=e.containsPoint(this.getCoordinates());return i&&(r.find(this.getPoints(),s=>(void 0!==t&&(i=this.isSegmentContainedIn(t,s,e)),t=s,!i)),i&&void 0!==t&&this.getReturnToSource()&&(i=this.isSegmentContainedIn(t,this,e))),i}areNodesContainedIn(e){let t=e.containsPoint(this.getCoordinates());return t&&r.find(this.getPoints(),i=>!(t=e.containsPoint(i))),t}addAngle(e,t){return e<0&&(e+=360),e>t&&e-t<180||e<t&&t-e<180?e-t:e>t?e-360+t:360+e-t}containsPoint(e){let t=0,i=0,s=0;const o=n.Shape.VectorPool.getObject();return r.each(this.getPoints(),(n,r)=>{o.setEndPoints(e,n),t=o.getAngle(),r>0&&(s=this.addAngle(t,i)),i=t}),this.getReturnToSource()&&(o.setEndPoints(e,this),s=this.addAngle(o.getAngle(),i)),n.Shape.VectorPool.recycleObject(o),Math.abs(s/360)>=1}}t.Polygon=o}),define("settings/stage_settings",["require","exports","constants"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=1,t=0,s=[i.Constants.StageEvents.MouseWheel],n=1,r=!1,o=!0){this.layerAmount=e,this.cameraLayer=t,this.relayEvents=s,this.scale=n,this.showUi=r,this.allowInteraction=o}static fromJSON(e){return new s(e.layerAmount,e.cameraLayer,e.relayEvents,e.scale,e.showUi,e.allowInteraction)}getLayerAmount(){return this.layerAmount}getCameraLayer(){return this.cameraLayer}getRelayEvents(){return this.relayEvents}isInteractionAllowed(){return this.allowInteraction}getScale(){return this.scale}showUI(){return this.showUi}}t.StageSettings=s}),define("core/utilities/abstract_state_object",["require","exports","constants","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractStateObject=class{constructor(){this.state=i.Constants.State.Animation.Ready}getState(){return s.logService.assertDefined(this.state,i.Constants.Feature.Animations.Sequence,this),this.state}setState(e){return s.logService.assertDefined(e,i.Constants.Feature.Animations.Sequence,this),this.state=e,this}isReady(){return this.getState()===i.Constants.State.Animation.Ready}isPlaying(){return this.getState()===i.Constants.State.Animation.Playing}isPaused(){return this.getState()===i.Constants.State.Animation.Paused}isDone(){return this.getState()===i.Constants.State.Animation.Done}isStopped(){return this.getState()===i.Constants.State.Animation.Stopped}}}),define("core/utilities/mouse_service",["require","exports","event","log","map","underscore","constants","core/graphics/primitives/point","reusable_utilities"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(){this.onMouseElementEnter=new i.Event,this.onMouseEnter=new i.Event,this.onMouseLeave=new i.Event,this.onMouseUp=new i.Event,this.onMouseDown=new i.Event,this.onMouseWheel=new i.Event,this.onMouseMove=new i.Event,this.onMouseClick=new i.Event,this.onRightClick=new i.Event,this.onMouseDoubleClick=new i.Event,this.stageCounter=0,this.activeStageMap=new n.Map,this.state=new n.Map,this.coordinateSystems=new n.Map,this.mouseX=0,this.mouseY=0,this.previousMouseX=0,this.previousMouseY=0,this.ready=!1,this.events={enter:{label:"mouseover",func:this.handleMouseEnter.bind(this)},leave:{label:"mouseout",func:this.handleMouseLeave.bind(this)},up:{label:"mouseup",func:this.handleMouseUp.bind(this)},down:{label:"mousedown",func:this.handleMouseDown.bind(this)},rightDown:{label:"contextmenu",func:this.handleRightMouseDown.bind(this)},wheel:{label:"wheel",func:this.handleMouseWheel.bind(this)},move:{label:"mousemove",func:this.handleMouseMove.bind(this)}},"onwheel"in document.createElement("div")||(void 0!==document.onmousewheel?this.events.wheel.label="mousewheel":this.events.wheel.label="DOMMouseScroll"),r.each(r.keys(this.events),e=>{document.documentElement.addEventListener(this.events[e].label,this.events[e].func)}),this.ready=!0}clone(){return new c}getMouseX(){return this.mouseX}getMouseY(){return this.mouseY}handleMouseEnter(e){0===e.buttons&&this.onMouseEnter.fire(e)}handleMouseLeave(e){0===e.buttons&&this.onMouseLeave.fire(e)}handleMouseUp(e){const t=o.Constants.Mouse.State,i=o.Constants.Mouse.Buttons;switch(e.button){case i.Left:this.state.get(t.Left)===t.Left.Pressed?(this.state.set(t.Left,t.Left.Clicked),this.onMouseClick.fire(e),this.state.delete(t.Left),this.onMouseUp.fire(e)):this.state.get(t.Left)===t.Left.DoublePressed&&(this.state.delete(t.Left),this.onMouseDoubleClick.fire(e),this.onMouseUp.fire(e));break;case i.Right:break;case i.Wheel:this.state.get(t.Wheel)===t.Wheel.Pressed?(this.state.set(t.Wheel,t.Wheel.Clicked),this.state.delete(t.Wheel),this.onMouseUp.fire(e)):this.state.get(t.Wheel)===t.Wheel.DoublePressed&&(this.state.delete(t.Wheel),this.onMouseDoubleClick.fire(e),this.onMouseUp.fire(e));break;default:return}}handleMouseDown(e){const t=o.Constants.Mouse.State,i=o.Constants.Mouse.Buttons;switch(e.button){case i.Left:this.state.get(t.Left)===t.Left.Clicked?(this.state.set(t.Left,t.Left.DoublePressed),this.onMouseDown.fire(e)):(this.state.set(t.Left,t.Left.Pressed),this.onMouseDown.fire(e));break;case i.Wheel:this.state.get(t.Wheel)===t.Wheel.Clicked?(this.state.set(t.Wheel,t.Wheel.DoublePressed),this.onMouseDown.fire(e)):(this.state.set(t.Wheel,t.Wheel.Pressed),this.onMouseDown.fire(e));break;default:return}}handleRightMouseDown(e){this.onRightClick.fire(e)}isDown(e){const t=o.Constants.Mouse.Buttons;switch(e){case t.Left:const i=o.Constants.Mouse.State.Left;return this.state.get(i)===i.Pressed||this.state.get(i)===i.DoublePressed;case t.Wheel:const s=o.Constants.Mouse.State.Wheel;return this.state.get(s)===s.Pressed||this.state.get(s)===s.DoublePressed;case t.Right:const n=o.Constants.Mouse.State.Right;return this.state.get(n)===n.Pressed||this.state.get(n)===n.DoublePressed;default:return!1}}isUp(e){const t=o.Constants.Mouse.Buttons;switch(e){case t.Left:const i=o.Constants.Mouse.State.Left;return this.state.get(i)!==i.Pressed&&this.state.get(i)!==i.DoublePressed;case t.Wheel:const s=o.Constants.Mouse.State.Wheel;return this.state.get(s)!==s.Pressed&&this.state.get(s)!==s.DoublePressed;case t.Right:const n=o.Constants.Mouse.State.Right;return this.state.get(n)!==n.Pressed&&this.state.get(n)!==n.DoublePressed;default:return!1}}isClicked(e){const t=o.Constants.Mouse.Buttons;switch(e){case t.Left:const i=o.Constants.Mouse.State.Left;return this.state.get(i)===i.Clicked;case t.Wheel:const s=o.Constants.Mouse.State.Wheel;return this.state.get(s)===s.Clicked;case t.Right:const n=o.Constants.Mouse.State.Right;return this.state.get(n)===n.Clicked;default:return!1}}handleMouseWheel(e){this.onMouseWheel.fire(e)}handleElementEnter(e,t,i){const s=document.elementFromPoint(e,t);this.currentElement!==s&&this.onMouseElementEnter.fire(i,s),this.currentElement=s}handleMouseMove(e){this.mouseX=e.clientX,this.mouseY=e.clientY,this.onMouseElementEnter.hasSubscriptions()&&this.handleElementEnter(e.clientX,e.clientY,e),this.ready&&this.stageCounter>0&&(e.mouseDeltaX=this.mouseX-this.previousMouseX,e.mouseDeltaY=this.mouseY-this.previousMouseY,this.onMouseMove.fire(e),this.resetMouse(),l.AnimationLoop.requestAnimationFrame(()=>{this.ready=!0}))}resetMouse(){this.ready=!1,this.previousMouseX=this.mouseX,this.previousMouseY=this.mouseY}defineCoordinateSystem(e,t){this.coordinateSystems.set(e,t)}isStageRegistered(e){return this.activeStageMap.has(e)}isStageActive(e){return this.activeStageMap.get(e)}activateStage(e){this.activeStageMap.has(e)&&(this.activeStageMap.set(e,!0),this.stageCounter++)}deactivateStage(e){this.activeStageMap.has(e)&&(this.activeStageMap.set(e,!1),this.stageCounter--)}registerStage(e){this.activeStageMap.set(e,!1)}unregisterStage(e){this.activeStageMap.get(e)&&setTimeout(()=>this.stageCounter--,50),this.activeStageMap.delete(e)}getCoordinatesFor(e){if(this.coordinateSystems.has(e)){const t=this.coordinateSystems.get(e)(this.mouseX,this.mouseY);return t.coordinateSystem=this.coordinateSystems.get(e),t.coordinateSystemId=e,t}return s.logService.warn("Unknown coordinateSystem Id"),a.Point.zero()}removeCoordinateSystem(e){this.coordinateSystems.delete(e)}}t.Mouse=c}),define("settings/draw_settings",["require","exports","core/graphics/primitives/point"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,i,s=!1){this.style=e,this.setCoordinates(t,i,s)}static zero(){return new s(void 0,0,0)}setCoordinates(e,t,i=!1){return i?(this.setX(Math.round(e)),this.setY(Math.round(t))):(this.setX(e),this.setY(t)),this}reset(){return this.setX(0),this.setY(0),this.style=void 0,this}toPoint(){return new i.Point(this.x,this.y)}getX(){return this.x}getY(){return this.y}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setStyleMap(e){return this.style=e,this}multiply(e){return this.x*=e,this.y*=e,this}}t.DrawSettings=s}),define("core/graphics/primitives/quadratic_curve",["require","exports","core/graphics/primitives/line","core/graphics/primitives/point","constants","underscore","core/graphics/primitives/rectangle","math_utils"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends i.Line{constructor(e,t,i,r,a,l,c=!1){super(e,t,a,l),this.curveParams={source:s.Point.zero(),control:s.Point.zero(),destination:s.Point.zero()},this.bBox=o.Rectangle.zero(),this.minPoint=s.Point.min(),this.maxPoint=s.Point.max(),this.control=new s.Point(i,r),this.type=n.Constants.Shape.QuadraticCurve,c||this.compute()}static zero(){return new l(0,0,0,0,0,0)}static fromPoints(e,t,i){return new l(e.getX(),e.getY(),t.getX(),t.getY(),i.getX(),i.getY())}reset(){return super.reset(),this.getControl().resetCoordinates(),this}clone(){return new l(this.getX(),this.getY(),this.getControl().getX(),this.getControl().getY(),this.getDestination().getX(),this.getDestination().getY())}getControl(){return this.control}freeze(){return super.freeze(),this.getControl().freeze(),this}unfreeze(){return super.unfreeze(),this.getControl().unfreeze(),this}isEqualTo(e){return super.isEqualTo(e)&&e.getControl().getX()===this.getControl().getX()&&e.getControl().getY()===this.getControl().getY()}getCurveParametricPoint(e){const t=Math.pow(1-e,2),i=2*(1-e)*e,s=Math.pow(e,2);return{x:this.getX()*t+this.getControl().getX()*i+this.getDestination().getX()*s,y:this.getY()*t+this.getControl().getY()*i+this.getDestination().getY()*s}}getCurveDerivativePoint(e){const t={x:this.getX()-2*this.getControl().getX()+2*this.getDestination().getX(),y:this.getY()-2*this.getControl().getY()+2*this.getDestination().getY()};return t.x=2*t.x*e+2*this.getControl().getX()-2*this.getX(),t.y=2*t.y*e+2*this.getControl().getY()-2*this.getY(),t}compute(){return this.curveParams.source.merge(this.getOrigin()),this.curveParams.control.merge(this.getControl()),this.curveParams.destination.merge(this.getDestination()),this.computeLength(),this.computeLookUpTable(),this.computeBBox(),this.computeCartesianEquation(),this}computeCartesianEquation(){const e=this.getCurveParametricPoint(.25),t=this.getCurveParametricPoint(.5),i=this.getCurveParametricPoint(.75),s=i.x-e.x,n=t.x-e.x,r=Math.pow(e.x,2),o=Math.pow(t.x,2)-r,a=Math.pow(i.x,2)-r,c=t.y-e.y,d=(i.y-e.y)*n-c*s,h=a*n-o*s;if(0!==h){const t=d/h;this.cartesianEquation.a=Math.floor(100*t)/100;const i=c-t*o;if(0!==n){const s=i/n,o=e.y-t*r-s*e.x;this.cartesianEquation.b=Math.floor(100*s)/100,this.cartesianEquation.c=Math.floor(100*o)/100,this.cartesianEquation.toString="y = ",0!==t&&(this.cartesianEquation.toString+=t+"x + "),0!==s&&(this.cartesianEquation.toString+=s+"x + "),this.cartesianEquation.toString+=o}else this.cartesianEquation.b=i>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.c=-this.cartesianEquation.b,this.cartesianEquation.toString=l.INFINITE_EQUATION}else this.cartesianEquation.a=d>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.b=-this.cartesianEquation.a,this.cartesianEquation.c=this.cartesianEquation.a,this.cartesianEquation.toString=l.INFINITE_EQUATION;return this.computeDerivativeEquation(),this}computeDerivativeEquation(){if(l.INFINITE_EQUATION===this.cartesianEquation.toString)this.derivativeEquation.toString=this.cartesianEquation.toString;else{const e=2*this.cartesianEquation.a,t=this.cartesianEquation.b;this.derivativeEquation.a=e,this.derivativeEquation.b=t,0!==e&&(this.derivativeEquation.toString+=e+"x + "),this.derivativeEquation.toString+=t}return this}getSlopeAngleForT(e){const t=1-e,i=t*this.getControl().x+e*this.getDestination().x-(t*this.x+e*this.getControl().x),s=t*this.getControl().y+e*this.getDestination().y-(t*this.y+e*this.getControl().y);return a.trigonometryUtils.radiansToDegrees(Math.atan2(s,i))}applyCartesianEquation(e){if(this.cartesianEquation.toString!==l.INFINITE_EQUATION){const t=this.cartesianEquation.a,i=this.cartesianEquation.b,s=this.cartesianEquation.c;return t*Math.pow(e,2)+i*e+s}return 0}applyDerivativeEquation(e){if(this.derivativeEquation.toString!==l.INFINITE_EQUATION){return this.derivativeEquation.a*e+this.derivativeEquation.b}return 0}computeLength(){const e=this.curveParams,t=e.source.subtract(e.control.clone().multiply(2)).addFast(e.destination),i=e.control.clone().multiply(2).subtractFast(e.source.clone().multiply(2)),s=4*(Math.pow(t.getX(),2)+Math.pow(t.getY(),2)),n=Math.sqrt(s),r=Math.pow(s,1.5),o=4*(t.getX()*i.getX()+t.getY()*i.getY()),a=Math.pow(i.getX(),2)+Math.pow(i.getY(),2),l=Math.sqrt(a),c=Math.sqrt(s+o+a),d=1/(8*r),h=2*n+o/n+2*c,u=o/n+2*l,p=Math.log(h/u)/Math.log(10),g=4*r*c+2*n*o*(c-l)+(4*a*s-Math.pow(o,2))*p;return this.length=d*g,this}computeLookUpTable(e=Math.ceil(this.getLength())){return e>0&&(this.lookUpTable=r.map(r.range(0,1,1/e),e=>this.getCurveParametricPoint(Math.min(e,1)))),this}computeBBox(){return this.bBox.unfreeze(),this.minPoint.unfreeze(),this.maxPoint.unfreeze(),void 0!==this.bBox&&(this.minPoint.setCoordinates(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.maxPoint.setCoordinates(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)),r.each(this.getLookUpTable(),e=>{e.x>this.maxPoint.getX()&&this.maxPoint.setX(e.x),e.x<this.minPoint.getX()&&this.minPoint.setX(e.x),e.y>this.maxPoint.getY()&&this.maxPoint.setY(e.y),e.y<this.minPoint.getY()&&this.minPoint.setY(e.y)}),this.minPoint.freeze(),this.maxPoint.freeze(),this.bBox.assimilateTopLeftBottomRight(this.minPoint,this.maxPoint),this.bBox.freeze(),this}isCurveInvalid(){let e=void 0===this.length;const t={source:this.getOrigin(),control:this.getControl(),destination:this.getDestination()};return e||(e=r.filter(Object.keys(this.curveParams),e=>this.curveParams[e].isEqualTo(t[e])).length<3),e}getLength(){return this.isCurveInvalid()&&this.compute(),this.length}getLookUpTable(){return this.isCurveInvalid()&&this.compute(),this.lookUpTable}getBoundingBox(){return this.isCurveInvalid()&&this.compute(),this.bBox}isContainedIn(e,t=0){return this.getBoundingBox().isContainedIn(e)}getCenter(){const e=this.getOrigin().distanceTo(this.getControl()),t=this.getControl().distanceTo(this.getDestination());return s.Point.fromJson(this.getCurveDerivativePoint(e/t*.5))}getTopLeft(){return this.isCurveInvalid()&&this.compute(),this.minPoint}getBottomRight(){return this.isCurveInvalid()&&this.compute(),this.maxPoint}translate(e,t){return super.translate(e,t),this.getControl().translate(e,t),this}}l.INFINITE_EQUATION="y = "+Number.POSITIVE_INFINITY,t.QuadraticCurve=l}),define("core/graphics/primitives/cubic_curve",["require","exports","core/graphics/primitives/quadratic_curve","core/graphics/primitives/point","constants","underscore","core/graphics/primitives/line","core/graphics/primitives/shape"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends i.QuadraticCurve{constructor(e,t,i,r,o,a,l,c){super(e,t,i,r,l,c,!0),this.curveParams.secondaryControl=s.Point.zero(),this.secondaryControl=new s.Point(o,a),this.type=n.Constants.Shape.CubicCurve,this.compute()}reset(){return super.reset(),this.getSecondaryControl().resetCoordinates(),this}static zero(){return new l(0,0,0,0,0,0,0,0)}clone(){return new l(this.getX(),this.getY(),this.getControl().getX(),this.getControl().getY(),this.secondaryControl.getX(),this.secondaryControl.getY(),this.getDestination().getX(),this.getDestination().getY())}getSecondaryControl(){return this.secondaryControl}freeze(){return super.freeze(),this.getControl().freeze(),this}unfreeze(){return super.unfreeze(),this.getControl().unfreeze(),this}isEqualTo(e){return super.isEqualTo(e)&&e.getSecondaryControl().getX()===this.getSecondaryControl().getX()&&e.getSecondaryControl().getY()===this.getSecondaryControl().getY()}getCurveParametricPoint(e){const t=Math.pow(1-e,3),i=3*e*Math.pow(1-e,2),s=3*(1-e)*Math.pow(e,2),n=Math.pow(e,3);return{x:this.getX()*t+this.getControl().getX()*i+this.getSecondaryControl().getX()*s+this.getDestination().getX()*n,y:this.getY()*t+this.getControl().getY()*i+this.getSecondaryControl().getY()*s+this.getDestination().getY()*n}}getCurveDerivativePoint(e){const t=Math.pow(e,2),i={x:this.getControl().getX()-3*this.getX(),y:this.getControl().getY()-3*this.getY()};return i.x+=e*(3*this.getSecondaryControl().getX()-4*this.getControl().getX()+6*this.getX()),i.y+=e*(3*this.getSecondaryControl().getY()-4*this.getControl().getY()+6*this.getY()),i.x+=t*(3*this.getControl().getX()+3*this.getDestination().getX()-3*this.getX()-3*this.getSecondaryControl().getX()),i.y+=t*(3*this.getControl().getY()+3*this.getDestination().getY()-3*this.getY()-3*this.getSecondaryControl().getY()),i}compute(){return this.curveParams.secondaryControl.merge(this.getSecondaryControl()),this.curveParams.source.merge(this.getOrigin()),this.curveParams.control.merge(this.getControl()),this.curveParams.destination.merge(this.getDestination()),this.computeLength(),this.computeLookUpTable(),this.computeBBox(),this.computeCartesianEquation(),this.computeDerivativeEquation(),this}computeCartesianEquation(){const e=this.getCurveParametricPoint(.2),t=this.getCurveParametricPoint(.4),i=this.getCurveParametricPoint(.6),s=this.getCurveParametricPoint(.8),n=s.x-e.x,r=i.x-e.x,o=t.x-e.x,a=Math.pow(e.x,2),l=Math.pow(t.x,2),c=Math.pow(i.x,2),d=Math.pow(s.x,2)-a,h=c-a,u=l-a,p=Math.pow(e.x,3),g=Math.pow(t.x,3)-p,m=h*o-u*r,_=d*o-u*n,f=(Math.pow(i.x,3)-p)*o-g*r,y=((Math.pow(s.x,3)-p)*o-g*n)*m-f*_,b=t.y-e.y,E=(i.y-e.y)*o-b*r,S=((s.y-e.y)*o-b*n)*m-E*_;if(0!==y){const t=S/y;this.cartesianEquation.a=t;const i=E-t*f;if(0!==m){const s=i/m;this.cartesianEquation.b=s;const n=e.y-t*a-s*e.x;if(0!==o){const i=n/o;this.cartesianEquation.c=i;const r=e.y-t*p-s*a-i*e.x;this.cartesianEquation.d=r,this.cartesianEquation.toString="y = ",0!==t&&(this.cartesianEquation.toString+=t+"x + "),0!==s&&(this.cartesianEquation.toString+=s+"x + "),0!==i&&(this.cartesianEquation.toString+=i+"x + "),this.cartesianEquation.toString+=r}else this.cartesianEquation.c=n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.d=-this.cartesianEquation.c,this.cartesianEquation.toString="y = Infinity"}else this.cartesianEquation.b=i>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.c=-this.cartesianEquation.b,this.cartesianEquation.d=-this.cartesianEquation.c,this.cartesianEquation.toString="y = Infinity"}else this.cartesianEquation.a=y>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,this.cartesianEquation.b=-this.cartesianEquation.a,this.cartesianEquation.c=-this.cartesianEquation.b,this.cartesianEquation.d=-this.cartesianEquation.c,this.cartesianEquation.toString="y = Infinity";return this}computeDerivativeEquation(){if(i.QuadraticCurve.INFINITE_EQUATION===this.cartesianEquation.toString)this.derivativeEquation.toString=this.cartesianEquation.toString;else{const e=3*this.cartesianEquation.a,t=2*this.cartesianEquation.b,i=this.cartesianEquation.c;this.derivativeEquation.a=e,this.derivativeEquation.b=t,this.derivativeEquation.c=i,0!==e&&(this.derivativeEquation.toString+=e+"x + "),0!==t&&(this.derivativeEquation.toString+=t+"x + "),this.derivativeEquation.toString+=i}return this}applyDerivativeEquation(e){if(this.derivativeEquation.toString!==i.QuadraticCurve.INFINITE_EQUATION){const t=this.derivativeEquation.a,i=this.derivativeEquation.b,s=this.derivativeEquation.c;return t*Math.pow(e,2)+i*e+s}return 0}applyCartesianEquation(e){if(this.cartesianEquation.toString!==i.QuadraticCurve.INFINITE_EQUATION){const t=this.cartesianEquation.a,i=this.cartesianEquation.b,s=this.cartesianEquation.c,n=this.cartesianEquation.d;return t*Math.pow(e,3)+i*Math.pow(e,2)+s*e+n}return 0}computeLength(){const e=a.Shape.PointPool.getObject().setCoordinates(this.getX(),this.getY());this.translate(-e.getX(),-e.getY());const t=l.gaussTValues,i=l.gaussCValues,s=o.Line.zero();let n,c,d=0;return r.each(r.range(0,t.length),e=>{c=.5*t[e]+.5,n=this.getCurveDerivativePoint(c),s.setDestinationCoordinates(n.x,n.y),d+=i[e]*s.getLength()}),this.length=.5*d,this.translate(e.getX(),e.getY()),a.Shape.PointPool.recycleObject(e),this}isCurveInvalid(){let e=void 0===this.length;const t={source:this.getOrigin(),control:this.getControl(),secondaryControl:this.getSecondaryControl(),destination:this.getDestination()};return e||(e=r.filter(Object.keys(this.curveParams),e=>this.curveParams[e].isEqualTo(t[e])).length<4),e}getCenter(){const e=this.getOrigin().distanceTo(this.getControl()),t=this.getControl().distanceTo(this.getDestination()),i=this.getOrigin().distanceTo(this.getSecondaryControl()),n=this.getSecondaryControl().distanceTo(this.getDestination());return s.Point.fromJson(this.getCurveDerivativePoint((e+t)/(i+n)*.5))}translate(e,t){return super.translate(e,t),this.getSecondaryControl().translate(e,t),this}}l.gaussTValues=[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],l.gaussCValues=[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],t.CubicCurve=l}),define("core/graphics/primitives/circle_segment",["require","exports","core/graphics/primitives/circle","core/graphics/primitives/point","core/graphics/primitives/rectangle","constants","core/graphics/primitives/vector","core/graphics/primitives/shape","underscore","core/graphics/primitives/cubic_curve","math_utils"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class h extends i.Circle{constructor(e,t,i=0,s=0,n=0,o=0,a=!1,l=!1){super(e,t,i,o,l),this.centralCurve=[],this.providesCentralCurves=a,this.setSourceAngle(s),this.setEndAngle(n),this.type=r.Constants.Shape.CircleSegment}static zero(){return new h(0,0)}reset(){return super.reset(),this.setSourceAngle(0),this.setEndAngle(0),this}isEqualTo(e){return super.isEqualTo(e)&&this.getSourceAngle()===e.getSourceAngle()&&this.getEndAngle()===e.getEndAngle()&&this.getCentralPathCurves().length===e.getCentralPathCurves().length&&this.getEndAngle()===e.getEndAngle()}clone(){return new h(this.getX(),this.getY(),this.getRadius(),this.getSourceAngle(),this.getEndAngle(),this.getDepth(),this.isShallow())}freeze(){return super.freeze(),l.isUndefined(this.getArcAnchor())||this.getArcAnchor().freeze(),l.isUndefined(this.getArcEnd())||this.getArcEnd().freeze(),l.isUndefined(this.getArcCenter())||this.getArcCenter().freeze(),l.isUndefined(this.getArcSource())||this.getArcSource().freeze(),l.isUndefined(this.getDepthEnd())||this.getDepthEnd().freeze(),l.isUndefined(this.getDepthCenter())||this.getDepthCenter().freeze(),l.isUndefined(this.getDepthSource())||this.getDepthSource().freeze(),this}unfreeze(){return super.unfreeze(),l.isUndefined(this.getArcAnchor())||this.getArcAnchor().unfreeze(),l.isUndefined(this.getArcEnd())||this.getArcEnd().unfreeze(),l.isUndefined(this.getArcCenter())||this.getArcCenter().unfreeze(),l.isUndefined(this.getArcSource())||this.getArcSource().unfreeze(),l.isUndefined(this.getDepthEnd())||this.getDepthEnd().unfreeze(),l.isUndefined(this.getDepthCenter())||this.getDepthCenter().unfreeze(),l.isUndefined(this.getDepthSource())||this.getDepthSource().unfreeze(),this}getInnerRectForRatio(e,t){const i=this.getContentCenter().getX(),o=this.getContentCenter().getY(),a=new s.Point(i,this.getSourceYForX(i)),l=new s.Point(i,this.getEndYForX(i)),c=new s.Point(this.getSourceXForY(o),o),d=new s.Point(this.getEndXForY(o),o);let h,u,p,g,m;const _=this.getMeanAngle(),f=0!==_&&_%360==0?360:_%360;f>90&&f<=270?(m=f>180&&f<=270,u=Math.max(l.getY(),this.getArcPointYForX(i,m)),h=Math.min(a.getY(),this.getArcPointYForX(i,m))):(m=f>270&&f<=360,h=Math.min(l.getY(),this.getArcPointYForX(i,m)),u=Math.max(a.getY(),this.getArcPointYForX(i,m))),f>0&&f<=180?(m=f>90&&f<=180,g=Math.max(this.getArcPointXForY(o,m),c.getX()),p=Math.min(this.getArcPointXForY(o,m),d.getX())):(m=f>180&&f<=270,g=Math.max(this.getArcPointXForY(o,m),d.getX()),p=Math.min(this.getArcPointXForY(o,m),c.getX()));const y=g-p,b=u-h;p=i-y/2,h=o-b/2;const E=e*b/t,S=Math.min(E,y),C=E!==S?t*S/e:b,v=n.Rectangle.RectanglePool.getObject();v.setHeight(C),v.setWidth(S),v.setX(p),v.setY(h);const T=e/10,I=t/10;for(;!this.containsShape(v)&&v.getHeight()>0&&v.getWidth()>0;){let e=0,t=0,i=0,s=0;switch(this.determineOobCorners(v)[0]){case r.Constants.Origin.TOP_LEFT:e+=T,t+=I;break;case r.Constants.Origin.BOTTOM_LEFT:e+=T,i+=I;break;case r.Constants.Origin.TOP_RIGHT:s+=T,t+=I;break;case r.Constants.Origin.BOTTOM_RIGHT:s+=T,i+=I}s+=e,i+=t,v.translate(e,t),v.setWidth(Math.max(0,v.getWidth()-s)),v.setHeight(Math.max(0,v.getHeight()-i))}return v}determineOobCorners(e){const t=[];this.containsPoint(e)||t.push(r.Constants.Origin.TOP_LEFT);const i=a.Shape.PointPool.getObject();return i.merge(e).translate(e.getWidth(),e.getHeight()),this.containsPoint(i)||t.push(r.Constants.Origin.BOTTOM_RIGHT),i.translate(-e.getWidth(),0),this.containsPoint(e.add(e.getWidth()))||t.push(r.Constants.Origin.BOTTOM_LEFT),i.translate(e.getWidth(),-e.getHeight()),this.containsPoint(e.add(0,e.getHeight()))||t.push(r.Constants.Origin.TOP_RIGHT),a.Shape.PointPool.recycleObject(i),t}getConcernedCardinals(e=!1){let t;const s=this.getSourceAngle()%360,n=this.getEndAngle()-this.getSourceAngle()+s;return t=e?i.Circle.getAllCardinals():i.Circle.getCardinals(),l.filter(t,e=>s<e&&e<n)}getEndYForX(e){return this.getArcEnd().getX()===this.getX()?this.getY():(this.getArcEnd().getY()*(e-this.getX())-this.getY()*(e-this.getArcEnd().getX()))/(this.getArcEnd().getX()-this.getX())}getEndXForY(e){return this.getArcEnd().getY()===this.getY()?this.getX():(this.getArcEnd().getX()*(e-this.getY())-this.getX()*(e-this.getArcEnd().getY()))/(this.getArcEnd().getY()-this.getY())}getSourceYForX(e){return this.getArcSource().getX()===this.getX()?this.getY():(this.getArcSource().getY()*(e-this.getX())-this.getY()*(e-this.getArcSource().getX()))/(this.getArcSource().getX()-this.getX())}getSourceXForY(e){return this.getArcSource().getY()===this.getY()?this.getX():(this.getArcSource().getX()*(e-this.getY())-this.getX()*(e-this.getArcSource().getY()))/(this.getArcSource().getY()-this.getY())}getSourceAngle(){return this.sourceAngle}getArcAngle(){return this.arcAngle}setSourceAngle(e){return this.checkFrozenState(),this.sourceAngle=e,l.isUndefined(this.getEndAngle())||(this.updateMeanAngle(),this.updateAnchorAngle()),this}getEndAngle(){return this.endAngle}isPointOnArc(e,t){let i,n;return e instanceof s.Point?(t=e.getY(),i=e.getX(),n=this.containsPoint(e)):(i=e,n=this.containsPoint(new s.Point(i,t))),n&&super.isPointOnArc(i,t)}setEndAngle(e){return this.checkFrozenState(),this.endAngle=e,l.isUndefined(this.getSourceAngle())||(this.updateMeanAngle(),this.updateAnchorAngle()),this}updateAnchorAngle(){return this.endAngle-this.sourceAngle>180&&(this.anchorAngle=this.getSourceAngle()+180),this}getAnchorAngle(){return this.anchorAngle}updateMeanAngle(){return this.meanAngle=this.getEndAngle()-(this.getEndAngle()-this.getSourceAngle())/2,this.arcAngle=this.getEndAngle()-this.getSourceAngle(),this.computeContentCenter(),this.providesCentralCurves&&this.computeCentralCurve(),this}enableComputationOfCentralCurves(e){return this.providesCentralCurves=e,e&&this.computeCentralCurve(),this}isCentralCurveComputationEnabled(){return this.providesCentralCurves}isFullCircleArc(){const e=Math.round(1e3*this.getEndAngle()-1e3*this.getSourceAngle())/1e3;return 0!==e&&e%360==0}computeContentCenter(){const e=this.getArcCenter().distanceTo(this.getArcEnd()),t=this.getRadius()*e/(this.getRadius()+e);let i=this.getDepth()>0?(this.getRadius()-this.getDepth())/2:t;const s=(i=this.getRadius()-i)/this.getRadius(),n=this.getArcCenter().subtract(this);return this.contentCenter=this.getCoordinates().clone().addFast(n.getX()*s,n.getY()*s),this}computeCentralCurve(){this.centralCurve=[];const e=this.getDepth()+this.getThickness()/2,t=this.getArcAngle()>90?this.getMeanAngle()-45:this.getSourceAngle(),i=this.getCoordinates();if(0!==this.arcAngle){const n=d.trigonometryUtils.degreesToRadians(Math.min(this.getArcAngle(),90)),r=4/3*Math.tan(n/4),o=t,a=new s.Point(1,0).multiply(e).rotateAroundCenter(o).addFast(i),l=new s.Point(Math.cos(n),Math.sin(n)).multiply(e).rotateAroundCenter(o).addFast(i),h=new s.Point(1,r).multiply(e).rotateAroundCenter(o).addFast(i),u=new s.Point(Math.cos(n)+r*Math.sin(n),Math.sin(n)-r*Math.cos(n)).multiply(e).rotateAroundCenter(o).addFast(i);this.centralCurve.push(new c.CubicCurve(a.getX(),a.getY(),h.getX(),h.getY(),u.getX(),u.getY(),l.getX(),l.getY()))}else this.centralCurve.push(c.CubicCurve.zero());return this}getCentralPathCurves(){return this.centralCurve}getMeanAngle(){return this.meanAngle}getArcCenter(e){return this.getArcPoint(this.getMeanAngle(),e)}getArcSource(e){return this.getArcPoint(this.getSourceAngle(),e)}getArcEnd(e){return this.getArcPoint(this.getEndAngle(),e)}getArcAnchor(e){return this.getArcPoint(this.getAnchorAngle(),e)}getDepthEnd(e){return this.getDepthPoint(this.getEndAngle(),e)}getDepthCenter(e){return this.getDepthPoint(this.getMeanAngle(),e)}getDepthSource(e){return this.getDepthPoint(this.getSourceAngle(),e)}setDepth(e){return super.setDepth(e),l.isUndefined(this.getMeanAngle())||this.computeContentCenter(),this}disableBBUpdate(){return this.checkFrozenState(),this.bBupdateDisabled=!0,this}getContentDiameter(){const e=a.Shape.VectorPool.getObject(),t=this.getArcSource(),i=this.getArcEnd(),s=this.getDepthSource(),n=this.getDepthEnd(),r=e.setEndPoints(t,i).getLength(),o=e.setEndPoints(s,n).getLength(),l=Math.min(this.getRadius()-this.getDepth(),(r+o)/2);return a.Shape.PointPool.recycleObjects([t,i,s,n]),a.Shape.VectorPool.recycleObject(e),.8*l}enableBBUpdate(){return this.checkFrozenState(),this.bBupdateDisabled=!1,this}isBBUpdateDisabled(){return this.bBupdateDisabled}getContentCenter(){return this.contentCenter}getRelativeContentCenter(){return o.Vector.fromEndPoints(this.getCoordinates(),this.contentCenter)}getBoundingBox(){const e=[this.getArcSource(a.Shape.PointPool.getObject()),this.getArcEnd(a.Shape.PointPool.getObject()),this.getArcCenter(a.Shape.PointPool.getObject()),this.getDepthCenter(a.Shape.PointPool.getObject()),this.getDepthSource(a.Shape.PointPool.getObject()),this.getDepthEnd(a.Shape.PointPool.getObject())];l.each(this.getConcernedCardinals(),t=>{e.push(this.getArcPoint(t,a.Shape.PointPool.getObject()))});const t=a.Shape.PointPool.getObject().setX(s.Point.reduceToCoordinateExtremum(e,"x","min")).setY(s.Point.reduceToCoordinateExtremum(e,"y","min")),i=a.Shape.PointPool.getObject().setX(s.Point.reduceToCoordinateExtremum(e,"x","max")).setY(s.Point.reduceToCoordinateExtremum(e,"y","max")),r=n.Rectangle.RectanglePool.getObject().setCoordinates(t.getX(),t.getY()).setWidth(i.getX()-t.getX()).setHeight(i.getY()-t.getY());return a.Shape.PointPool.recycleObjects(e),r}containsShape(e){switch(e.getType()){case r.Constants.Shape.Rectangle:case r.Constants.Shape.Circle:case r.Constants.Shape.CircleSegment:case r.Constants.Shape.Polygon:case r.Constants.Shape.Line:return e.isContainedIn(this);default:throw new Error("Shape Unknown")}}isContainedIn(e){const t=a.Shape.PointPool.getObject();let i,s=e.containsPoint(this.getArcSource()),n=this.getRadius();const r=this.getDepth();function o(t){return!(s=e.containsPoint(t))}function l(i){const o=0===r?this:this.getDepthPoint(i);return t.merge(o).addFast(Math.round((n-r)*Math.cos(d.trigonometryUtils.degreesToRadians(i))),Math.round((n-r)*Math.sin(d.trigonometryUtils.degreesToRadians(i)))),!(s=e.containsPoint(t))}return s&&((i=[this.getArcCenter(),this.getArcEnd()]).find(e=>o(t)),a.Shape.PointPool.recycleObjects(i),s&&this.getConcernedCardinals(!0).find(e=>l(e)),s&&((s=e.containsPoint(this))||((i=[this.getDepthSource(),this.getDepthCenter(),this.getDepthEnd()]).find(e=>o(t)),a.Shape.PointPool.recycleObjects(i),s&&(n=this.getDepth(),this.getConcernedCardinals(!0).find(e=>l(e)))))),a.Shape.PointPool.recycleObject(t),s}containsPoint(e){if(super.containsPoint(e)){if(this.isFullCircleArc())return!0;const t=a.Shape.VectorPool.getObject(),i=a.Shape.VectorPool.getObject(),s=a.Shape.VectorPool.getObject(),n=a.Shape.PointPool.getObject(),r=this.getCoordinates();i.setEndPoints(r,this.getArcSource()),s.setEndPoints(r,this.getArcEnd()),t.setEndPoints(r,e);const o=!t.isClockwiseFrom(i),c=t.isClockwiseFrom(s)||t.getAngle()===s.getAngle()||n.merge(e).isEqualTo(r);if(a.Shape.PointPool.recycleObject(n),l.isUndefined(this.getAnchorAngle()))return a.Shape.VectorPool.recycleObjects([t,i,s]),o&&c;{const e=a.Shape.VectorPool.getObject();e.setEndPoints(r,this.getArcAnchor());const i=t.isClockwiseFrom(e);return a.Shape.VectorPool.recycleObject(e),o&&i||!i&&c}}return!1}}t.CircleSegment=h}),define("core/utilities/text_metrics_object",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.width=e,this.height=t}static zero(){return new i(0,0)}setValues(e,t){return this.width=e,this.height=t,this}assimilate(e){return this.width=e.width,this.height=e.height,this}multiply(e){return this.width*=e,this.height*=e,this}reset(){return this.setValues(0,0),this}}t.TextMetricsObject=i}),define("core/utilities/dimensions_calculator",["require","exports","underscore","core/graphics/primitives/rectangle"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DimensionsCalculator=class{constructor(){this.reset()}reset(){return this.noXCoordsSet=!0,this.noYCoordsSet=!0,this.minMaxCoords={maxY:0,minY:Number.MAX_VALUE,maxX:0,minX:Number.MAX_VALUE},this}hasXCoords(){return!this.noXCoordsSet}hasYCoords(){return!this.noYCoordsSet}merge(e){const t=e.getMinMaxCoords();return e.hasXCoords()&&(this.addX(t.minX),this.addX(t.maxX)),e.hasYCoords()&&(this.addY(t.minY),this.addY(t.maxY)),this}getMinMaxCoords(){return i.extend({},this.minMaxCoords)}toRectangle(){return new s.Rectangle(this.noXCoordsSet?0:this.minMaxCoords.minX,this.noYCoordsSet?0:this.minMaxCoords.minY,this.noXCoordsSet?0:this.minMaxCoords.maxX,this.noYCoordsSet?0:this.minMaxCoords.maxY)}addX(...e){return this.noXCoordsSet=!1,e.forEach(e=>{this.minMaxCoords.minX=Math.min(this.minMaxCoords.minX,e),this.minMaxCoords.maxX=Math.max(this.minMaxCoords.maxX,e)}),this}addY(...e){return this.noYCoordsSet=!1,e.forEach(e=>{this.minMaxCoords.minY=Math.min(this.minMaxCoords.minY,e),this.minMaxCoords.maxY=Math.max(this.minMaxCoords.maxY,e)}),this}addRectangle(e){this.addX(e.getX(),e.getWidth()+e.getX()),this.addY(e.getY(),e.getHeight()+e.getY())}getHeight(){return this.noYCoordsSet?0:this.minMaxCoords.maxY-this.minMaxCoords.minY}getWidth(){return this.noXCoordsSet?0:this.minMaxCoords.maxX-this.minMaxCoords.minX}}}),define("core/utilities/identityChecks",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTweenParams=function(e){return void 0!==e.key&&void 0!==e.value&&void 0!==e.originalValue&&void 0!==e.newProgress&&void 0!==e.target},t.isDimension=function(e){return void 0!==e.presence&&void 0!==e.considerScale&&void 0!==e.shapes&&void 0!==e.topLeft&&void 0!==e.bottomRight&&void 0!==e.width&&void 0!==e.height},t.isPresence=function(e){return void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&void 0!==e.origin&&void 0!==e.subscriptions&&void 0!==e.incorporeal&&void 0!==e.absolute&&void 0!==e.interactive&&void 0!==e.hidden&&void 0!==e.mouseHover&&void 0!==e.mouseDownOnMe},t.isEntity=function(e){return void 0!==e.children&&void 0!==e.components}}),define("core/utilities/object_cache",["require","exports","core/graphics/primitives/rectangle","reusable_utilities","core/graphics/primitives/point","core/graphics/primitives/vector","core/utilities/origin","settings/draw_settings","core/graphics/primitives/circle","core/graphics/primitives/circle_segment","core/graphics/primitives/line","core/graphics/primitives/cubic_curve","core/graphics/primitives/quadratic_curve","core/graphics/primitives/polygon","log","core/graphics/primitives/shape","core/graphics/font","core/utilities/text_metrics_object","core/utilities/dimensions_calculator","core/utilities/identityChecks"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class E{static recycleObject(e){e instanceof r.Vector?this.VectorPool.recycleObject(e):e instanceof c.CircleSegment?this.CircleSegmentPool.recycleObject(e):e instanceof l.Circle?this.CirclePool.recycleObject(e):e instanceof h.CubicCurve?this.CubicCurvePool.recycleObject(e):e instanceof u.QuadraticCurve?this.QuadraticCurvePool.recycleObject(e):e instanceof d.Line?this.LinePool.recycleObject(e):b.isDimension(e)?this.DimensionPool.recycleObject(e):e instanceof a.DrawSettings?this.DrawSettingsPool.recycleObject(e):e instanceof _.Font?this.FontPool.recycleObject(e):e instanceof o.Origin?this.OriginPool.recycleObject(e):e instanceof p.Polygon?this.PolygonPool.recycleObject(e):e instanceof i.Rectangle?this.RectanglePool.recycleObject(e):b.isPresence(e)?this.PresencePool.recycleObject(e):e instanceof f.TextMetricsObject?this.TextMetricsObjectPool.recycleObject(e):e instanceof n.Point?this.PointPool.recycleObject(e):e instanceof y.DimensionsCalculator?this.DimensionsCalculatorPool.recycleObject(e):b.isTweenParams(e)?this.TweenParamsPool.recycleObject(e):g.logService.error(`cannot recycle Object of type ${e.constructor.name} because no appropriate Pool exists`)}static recycleObjects(e){e.forEach(e=>this.recycleObject(e))}}E.PointPool=m.Shape.PointPool,E.VectorPool=m.Shape.VectorPool,E.RectanglePool=i.Rectangle.RectanglePool,E.DimensionsCalculatorPool=new s.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:()=>new y.DimensionsCalculator,resetFunction:e=>e.reset()}),E.OriginPool=new s.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:o.Origin.zero,resetFunction:e=>e.resetCoordinates()}),E.DrawSettingsPool=new s.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:a.DrawSettings.zero,resetFunction:e=>e.reset()}),E.CirclePool=new s.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:l.Circle.zero,resetFunction:e=>e.reset()}),E.CircleSegmentPool=new s.ObjectPool({initialPoolSize:3,flexible:!0,objectFactory:c.CircleSegment.zero,resetFunction:e=>e.reset()}),E.LinePool=new s.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:d.Line.zero,resetFunction:e=>e.reset()}),E.CubicCurvePool=new s.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:h.CubicCurve.zero,resetFunction:e=>e.reset()}),E.QuadraticCurvePool=new s.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:u.QuadraticCurve.zero,resetFunction:e=>e.reset()}),E.PolygonPool=new s.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:p.Polygon.zero,resetFunction:e=>{E.PointPool.recycleObjects(e.getPoints()),e.reset()}}),E.FontPool=new s.ObjectPool({initialPoolSize:3,flexible:!0,objectFactory:_.Font.zero,resetFunction:e=>e.resetToDefault()}),E.TextMetricsObjectPool=new s.ObjectPool({initialPoolSize:3,flexible:!0,objectFactory:f.TextMetricsObject.zero,resetFunction:e=>e.reset()}),E.TweenParamsPool=new s.ObjectPool({initialPoolSize:5,flexible:!0,objectFactory:()=>({key:void 0,value:void 0,originalValue:void 0,newProgress:void 0,target:void 0,additionalTarget:void 0}),resetFunction:e=>{for(const t in e)e[t]=void 0}}),t.ObjectCache=E}),define("core/entities/components/image_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/presence","style","event","constants","core/graphics/primitives/point","core/graphics/primitives/circle","core/graphics/primitives/rectangle","core/utilities/utilities","core/graphics/primitives/circle_segment"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageComponent=class extends i.PresenceComponent{constructor(e,t=!1,i=s.Presence.zeroTopLeft()){super(i),this.margin=0,this.isLoaded=!1,this.isLoading=!1,this.onLoad=new r.Event,this.onError=new r.Event,this.isAdaptive=!1,this.allowShrinking=!1,this.allowGrowing=!1,this.classType=o.Constants.ComponentClasses.Image,this.url=e,t&&this.load()}buildShape(e){return this.isLoaded?this.buildDefaultShape(e):this.onLoad.subscribeOnce(()=>this.buildDefaultShape(e)),this}buildDefaultShape(e){d.logService.assert(this.isLoaded,"cannot build defaultShape without knowing imageSizeParameters.",o.Constants.Feature.Entities.Components.ImageComponent,this),this.clearShape();const t=this.getStyle(n.Style.Width),i=this.getStyle(n.Style.Height);switch(e){case o.Constants.Shape.Rectangle:this.addShape(new c.Rectangle(0,0,i,t));break;case o.Constants.Shape.Circle:this.addShape(new l.Circle(t/2,i/2,Math.min(t/2,i/2)));break;default:throw new Error("Unsupported shapeType as of yet.")}return this}load(){return this.isLoading||(this.isLoading=!0,this.imageHandle=document.createElement("img"),this.imageHandle.src=this.url,this.imageHandle.complete?0===this.getUnscaledHeight()||0===this.getUnscaledWidth()?this.resolveError():this.resolveLoading():(this.imageHandle.addEventListener("load",()=>this.resolveLoading(),!1),this.imageHandle.addEventListener("onerror",()=>this.resolveError(),!1))),this}resolveLoading(){return this.isLoading=!1,this.isLoaded=!0,this.invalidate(),this.hasStyle(n.Style.Width)||this.setStyle(n.Style.Width,this.getUnscaledWidth()),this.hasStyle(n.Style.Height)||this.setStyle(n.Style.Height,this.getUnscaledHeight()),this.onLoad.fire(),this}resolveError(){return this.isLoading=!1,this.onError.fire(),this}draw(e){return this.isLoaded?this.isHidden()||(this.adaptSize(e),this.updateOrigin(e.getStyle(n.Style.ScaleX)),e.drawImage(this)):this.load(),this}fitsIn(e,t,i){if(void 0!==i&&(e=i.getShapeForCamera(e),t=i.getShapeForCamera(t,!0)),e instanceof h.CircleSegment){const i=e.getContentDiameter();if(t instanceof c.Rectangle)return t.getWidth()<=i&&t.getHeight()<=i;if(t instanceof l.Circle)return t.getRadius()<=i/2&&e.containsShape(t)}return e.containsShape(t)}adaptSize(e){const t=this.hasStyle(n.Style.Width)?this.getStyle(n.Style.Width):this.getUnscaledWidth(),i=this.hasStyle(n.Style.Height)?this.getStyle(n.Style.Height):this.getUnscaledHeight();let s=1;const r=this.getMargin();let l,c;if(this.hasResizeArea()){const n=e.getShapeForCamera(this.getResizeArea());switch(n.getType()){case o.Constants.Shape.CircleSegment:const e=n.getRadius()-n.getDepth(),h=n.getDepthEnd().distanceTo(n.getDepthSource()),u=Math.min(h,e),p=d.Utilities.rotatePoint(a.Point.zero().setCoordinates(u,u/2),90,a.Point.zero().setCoordinates(u/2,u/2));l=Math.max(t,i),s=(c=Math.abs(p.getX())-2*r)/l;break;case o.Constants.Shape.Circle:l=Math.min(t,i),(c=2*n.getRadius()-2*r)<l&&(s=c/l);break;case o.Constants.Shape.Rectangle:const g=n.getWidth()-2*r,m=n.getHeight()-2*r;s=i<t?g/t:m/i;break;default:throw new Error("Unsupported cropping shape detected")}}return this.getAllowShrinking()&&(s=Math.min(s,1)),this.getAllowGrowing()&&(s=Math.max(s,1)),this.setStyle(n.Style.Width,t*s),this.setStyle(n.Style.Height,i*s),this}verifyStyleChange(e){if(super.verifyStyleChange(e),[n.Style.Radius,n.Style.Width,n.Style.Height].indexOf(e)>=0){const t=this.getUnscaledHeight()/this.getUnscaledWidth()||1,i=this.getStyle(e);switch(e){case n.Style.Radius:this.getUnscaledHeight()<this.getUnscaledWidth()?(super.getStyleMap().setStyleIfDifferent(n.Style.Width,i/t*2,!1),super.getStyleMap().setStyleIfDifferent(n.Style.Height,2*i,!1)):(super.getStyleMap().setStyleIfDifferent(n.Style.Height,i*t*2,!1),super.getStyleMap().setStyleIfDifferent(n.Style.Width,2*i,!1));break;case n.Style.Width:this.getUnscaledHeight()<this.getUnscaledWidth()?super.getStyleMap().setStyleIfDifferent(n.Style.Radius,i*t/2,!1):super.getStyleMap().setStyleIfDifferent(n.Style.Radius,i/2,!1);break;case n.Style.Height:this.getUnscaledHeight()<this.getUnscaledWidth()?super.getStyleMap().setStyleIfDifferent(n.Style.Radius,i/2,!1):super.getStyleMap().setStyleIfDifferent(n.Style.Radius,i/t/2,!1)}this.adjustShape(),this.invalidate()}return this}adjustShape(){if(this.hasShapes()){let e=this.getShapes()[0];switch(e.getType()){case o.Constants.Shape.Rectangle:e.setWidth(this.getStyle(n.Style.Width)),e.setHeight(this.getStyle(n.Style.Height));break;case o.Constants.Shape.Circle:e=this.getShapes()[0].setRadius(this.getStyle(n.Style.Radius))}}return this}getUnscaledWidth(){return this.isLoaded?this.imageHandle.naturalWidth:1}getUnscaledHeight(){return this.isLoaded?this.imageHandle.naturalHeight:1}getImage(){return this.imageHandle}setMargin(e){return this.margin=e,this}getMargin(){return this.margin}setAdaptive(e){return this.isAdaptive=e,this}setCropArea(e){return this.cropArea=e,this}setResizeArea(e){return this.resizeArea=e,this}setAllowShrinking(e){return this.allowShrinking=e,this}getAllowShrinking(){return this.allowShrinking}setAllowGrowing(e){return this.allowGrowing=e,this}getAllowGrowing(){return this.allowGrowing}getCropArea(){return d.Utilities.simplify(this.cropArea)}getResizeArea(){return this.resizeArea}hasCropArea(){return void 0!==this.cropArea}hasResizeArea(){return void 0!==this.resizeArea}changeUrl(e){return this.url=e,this.load(),this}}}),define("core/entities/components/line_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/utilities","constants","style","core/utilities/presence","core/utilities/abstract_stage_node","core/graphics/primitives/line","core/graphics/primitives/quadratic_curve","core/graphics/primitives/cubic_curve","underscore"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class u extends i.PresenceComponent{constructor(e,t,i=0){super(e),this.arrowHeads=[],this.points=[],this.linePoints=[],this.interactionPadding=0,this.classType=n.Constants.ComponentClasses.Line,s.logService.assertDefined(t,n.Constants.Feature.Entities.Components.LineComponent,this),this.setLinePoints(t),this.compute(),this.setStyle(r.Style.StrokeAlignment,n.Constants.StrokeAlignment.Center),this.interactionPadding=i}static fromLine(e){switch(e.getType()){case n.Constants.Line.STRAIGHT_LINE:return new u(o.Presence.fromPoint(e),e.getDestination().subtract(e));case n.Constants.Line.QUADRATIC_CURVE:return new u(o.Presence.fromPoint(e),[e.getControl().subtract(e),e.getDestination().subtract(e)]);case n.Constants.Line.CUBIC_CURVE:return new u(o.Presence.fromPoint(e),[e.getControl().subtract(e),e.getSecondaryControl().subtract(e),e.getDestination().subtract(e)]);default:throw new Error("Shape is not a line or a Curve")}}static fromAbsolutePoints(e,t){return new u(e,t.map(t=>t.subtract(e)))}static fromPresences(e,t,i=n.Constants.Line.STRAIGHT_LINE,s=1,r,o=0){const a=t.toPoint().subtractFast(e),l=e.toVector(t),c=l.toNormalVector(r);switch(i){case n.Constants.Line.STRAIGHT_LINE:return new u(e,a,o);case n.Constants.Line.QUADRATIC_CURVE:const t=l.multiply(s/2).add(c.multiply(s/3));return new u(e,[t,a],o);case n.Constants.Line.CUBIC_CURVE:c.multiply(s/4);const r=l.clone().multiply(s/4).add(c),d=l.multiply(3*s/4).add(c);return new u(e,[r,d,a],o);default:throw new Error("unknown LineType detected. Cannot draw.")}}static fromSourceTarget(e,t,i,s,n,r=0){return e instanceof a.StageNode?t instanceof a.StageNode?u.fromPresences(e.getPresence().generateChild(),t.getPresence(),i,s,n,r):u.fromPresences(e.getPresence().generateChild(),t,i,s,n,r):t instanceof a.StageNode?u.fromPresences(e,t.getPresence(),i,s,n,r):u.fromPresences(e,t,i,s,n,r)}addArrowHead(e,t,i){const s={length:e,angle:t,attachAtSource:i||!1};return this.arrowHeads.push(s),this}removeArrowHead(){return this.arrowHeads.pop(),this}clearArrowHeads(){return this.arrowHeads=[],this}setLinePoints(e){return h.isArray(e)||(e=[e]),this.linePoints=e,this}addLinePoints(e){return h.isArray(e)||(e=[e]),this.linePoints.concat(e),this}getLinePoints(){return this.linePoints}compute(){this.clearPoints();let e,t,i,s=this.getLinePoints();switch((s||[]).forEach(e=>{this.addPoint(e)}),this.getPresence().clearShape(),(s=this.getPoints()).length){case 1:this.setType(n.Constants.Line.STRAIGHT_LINE),t=s[0],i=new l.Line(0,0,t.getX(),t.getY());break;case 2:this.setType(n.Constants.Line.QUADRATIC_CURVE),e=s[0],t=s[1],i=new c.QuadraticCurve(0,0,e.getX(),e.getY(),t.getX(),t.getY());break;case 3:this.setType(n.Constants.Line.CUBIC_CURVE),e=s[0];const r=s[1];t=s[2],i=new d.CubicCurve(0,0,e.getX(),e.getY(),r.getX(),r.getY(),t.getX(),t.getY());break;default:throw new Error("Unsupported amount of points passed to the line Component. Please pass 1-3 points additionally to the presence which is the source.")}const o=(this.getStyle(r.Style.BorderThickness)+this.getInteractionPadding())/2;return i.setProximityTolerance(o),this.getPresence().addShape(i),this}setType(e){return this.type=e,this}getType(){return this.type}setInteractionPadding(e){return this.interactionPadding=e,this}getInteractionPadding(){return this.interactionPadding}draw(e){return e.drawLine(this,this.arrowHeads),this}addPoint(e){return e instanceof a.StageNode?e=e.getPresence().toPoint():e instanceof o.Presence&&(e=e.toPoint()),this.points.push(e),this}removePoint(e){return this.points.splice(this.points.indexOf(e),1),this}clearPoints(){return this.points=[],this}getPoints(){return this.points}}t.LineComponent=u}),define("core/graphics/stage/cameras/camera_2d",["require","exports","core/graphics/stage/cameras/abstract_camera","core/utilities/utilities","core/graphics/style_map","style","settings/draw_settings","constants","core/graphics/primitives/rectangle","core/graphics/primitives/point","reusable_utilities","underscore","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class p extends i.Camera{constructor(e,t,i,s,n){super(e,t,i,s,n),this.layers.forEach((e,t)=>this.gallery.set(t,e.getContext("2d"))),this.setImageSmoothing(!1)}getBounds(){const e=this.activeContext.canvas;return u.ObjectCache.RectanglePool.getObject().setValues(0,0,e.width,e.height)}setImageSmoothing(e){return this.gallery.forEach(t=>{t.mozImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e,t.imageSmoothingEnabled=e}),this}drawImage(e){const t=s.Utilities.computeDrawSettings(e.getPresence(),this.getStyleMap(),this.offset);this.setActiveContext(t.style.getStyle(r.Style.Layer)),this.save(),this.applyStyles(t);let i=t.style.isDefault(r.Style.ScaleSystemX)?e.getStyle(r.Style.Width):s.Utilities.computeScaledLength(e.getStyle(r.Style.Width),t.style,!0),n=t.style.isDefault(r.Style.ScaleSystemY)?e.getStyle(r.Style.Height):s.Utilities.computeScaledLength(e.getStyle(r.Style.Height),t.style,!0);if(e.hasCropArea()){const t=e.getCropArea();switch(this.beginPath(),t.getType()){case a.Constants.Shape.Circle:const o=s.Utilities.computeDrawSettings(t,this.getStyleMap(),this.offset),l=this.getStyle(r.Style.ScaleX);let c=e.getCropArea().getRadius();c*l>Math.max(i/2,n/2)&&(c=Math.min(i/2,n/2)/l),this.activeContext.arc(o.x,o.y,s.Utilities.computeScaledLength(c,this.getStyleMap(),!0),0,s.Utilities.toRadians(360),!1),u.ObjectCache.DrawSettingsPool.recycleObject(o);break;default:const d=e.getCropArea();this.activeContext.rect(d.getX(),d.getY(),d.getWidth(),d.getHeight())}}else if(!this.style.isDefault(r.Style.ScaleSystemX)&&(i=s.Utilities.computeScaledLength(i,this.style,!0),n=s.Utilities.computeScaledLength(n,this.style,!1),t.style.hasStyle(r.Style.Viewport))){const s=t.style.getStyle(r.Style.Viewport);return this.activeContext.drawImage(e.getImage(),t.x,t.y,i,n,s.getX(),s.getY(),s.getWidth(),s.getHeight()),void this.restore()}e.hasCropArea()&&this.clip(),this.activeContext.drawImage(e.getImage(),t.x,t.y,i,n),u.ObjectCache.DrawSettingsPool.recycleObject(t),this.restore()}drawText(e,t,i){const n=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset,void 0,void 0,!1,void 0!==i);if(this.setActiveContext(n.style.getStyle(r.Style.Layer)),p.assertColors(n.style),this.save(),this.activeContext.lineJoin="round",this.applyStyles(n,!h.isUndefined(i)),!h.isUndefined(i)){const e=s.Utilities.computeDrawSettings(i,this.getStyleMap(),this.offset);this.applyTransformations(e.style),u.ObjectCache.DrawSettingsPool.recycleObject(e);const t=s.Utilities.computeDrawPoint(i,this.getStyleMap(),this.offset);n.setX(t.getX()).setY(t.getY()),u.ObjectCache.PointPool.recycleObject(t),u.ObjectCache.recycleObject(i)}(void 0!==i||this.isTextOnCamera(n))&&(this.activeContext.fillText(t,n.x,n.y),n.style.hasStyle(r.Style.BorderColor)&&n.style.hasStyle(r.Style.BorderThickness)&&this.activeContext.strokeText(t,n.x,n.y)),u.ObjectCache.DrawSettingsPool.recycleObject(n),this.restore()}isTextOnCamera(e){const t=this.getBounds(),i=u.ObjectCache.RectanglePool.getObject().setValues(e.x,e.y,e.style.getStyle(r.Style.Width)*this.getZoom(),e.style.getStyle(r.Style.Height)*this.getZoom()),s=t.intersects(i);return u.ObjectCache.recycleObject(t),u.ObjectCache.recycleObject(i),s}drawLetter(e,t,i){const n=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset,void 0,void 0,!1,void 0!==i);if(this.setActiveContext(n.style.getStyle(r.Style.Layer)),p.assertColors(n.style),this.save(),this.activeContext.lineJoin="round",this.applyStyles(n,!h.isUndefined(i)),!h.isUndefined(i)){const t=s.Utilities.computeDrawSettings(i,this.getStyleMap(),this.offset);this.applyTransformations(t.style),u.ObjectCache.DrawSettingsPool.recycleObject(t);const o=new c.Point(-e.getStyle(r.Style.Width)/2,-e.getStyle(r.Style.Height)/2),a=s.Utilities.computeDrawPoint(o,this.getStyleMap(),this.offset);n.setX(a.getX()).setY(a.getY()),u.ObjectCache.PointPool.recycleObject(a)}n.style.hasStyle(r.Style.Color)&&this.activeContext.fillText(t,n.x,n.y),n.style.hasStyle(r.Style.BorderColor)&&n.style.hasStyle(r.Style.BorderThickness)&&this.activeContext.strokeText(t,n.x,n.y),u.ObjectCache.DrawSettingsPool.recycleObject(n),this.restore()}drawRectangle(e){const t=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset);this.setActiveContext(t.style.getStyle(r.Style.Layer)),p.assertColors(t.style),this.save(),this.applyStyles(t),this.beginPath(),this.activeContext.rect(t.x,t.y,s.Utilities.computeScaledLength(t.style.getStyle(r.Style.Width),this.style),s.Utilities.computeScaledLength(t.style.getStyle(r.Style.Height),this.style)),this.drawStyle(t.style),u.ObjectCache.DrawSettingsPool.recycleObject(t),this.restore()}drawPolygon(e,t,i=!1){const n=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset);this.setActiveContext(n.style.getStyle(r.Style.Layer)),p.assertColors(n.style),this.save(),this.applyStyles(n),this.beginPath();let o=t[0];this.moveTo(o),t.forEach((e,t)=>{0!==t&&(this.lineTo(o,e,n.style),o=e)}),i&&this.closePath(),this.drawStyle(n.style),u.ObjectCache.DrawSettingsPool.recycleObject(n),this.restore()}drawCircle(e,t=!1){const i=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset);this.setActiveContext(i.style.getStyle(r.Style.Layer)),p.assertColors(i.style);const n=s.Utilities.computeScaledLength(i.style.getStyle(r.Style.Radius),this.style);if(this.isCircleOnCamera(i,n)){t&&this.clearCircle(e),this.save(),this.applyStyles(i);const o=s.Utilities.computeScaledLength(i.style.getStyle(r.Style.Depth),this.style);let a=i.style.getStyle(r.Style.EndAngle)||360;const l=i.style.getStyle(r.Style.AntiClockWise)||!1;let d=i.style.getStyle(r.Style.SourceAngle);a%360<180?(a-d)%360==0&&a++:l&&(a=360-a),d=s.Utilities.toRadians(d),a=s.Utilities.toRadians(a),this.beginPath(),this.activeContext.arc(i.x,i.y,n,d,a,l),o>0?this.activeContext.arc(i.x,i.y,o,a,d,!l):a-d<2*Math.PI&&this.lineTo(new c.Point(i.x,i.y),e.toPoint(),i.style),this.closePath(),this.drawStyle(i.style)}u.ObjectCache.DrawSettingsPool.recycleObject(i),this.restore()}isCircleOnCamera(e,t){const i=this.getBounds(),s=u.ObjectCache.CirclePool.getObject().setValues(e.x,e.y,t),n=s.intersectsRectangle(i);return u.ObjectCache.recycleObject(i),u.ObjectCache.recycleObject(s),n}drawLine(e,t=[]){const i=e.getStyleMap();i.hasStyle(r.Style.BorderColor)&&i.hasStyle(r.Style.BorderThickness)||s.logService.warn("borderColor+thickness must be defined.Otherwise there's nothing to draw."),this.setActiveContext(i.getStyle(r.Style.Layer)),this.save(),this.applyStyles(i);const n=i.getStyle(r.Style.BorderThickness)%2/2;this.activeContext.translate(n,n),this.beginPath();const o=e.getPresence().toPoint();switch(this.moveTo(o),e.getType()){case a.Constants.Line.STRAIGHT_LINE:this.lineTo(o,e.getPoints()[0].add(o),i,t);break;case a.Constants.Line.QUADRATIC_CURVE:this.quadraticCurveTo(o,e.getPoints()[0].add(o),e.getPoints()[1].add(o),i,t);break;case a.Constants.Line.CUBIC_CURVE:this.cubicCurveTo(o,e.getPoints()[0].add(o),e.getPoints()[1].add(o),e.getPoints()[2].add(o),i,t);break;default:throw new Error("unknown LineType detected. Cannot draw.")}this.stroke(e.getStyleMap()),this.restore()}clear(e){h.isUndefined(e)?this.gallery.keys().forEach(e=>{s.Utilities.clear(this.gallery.get(e))}):s.Utilities.clear(this.gallery.get(e))}clearPolygon(e,t){const i=e.getStyle(r.Style.Color),s=e.getStyle(r.Style.BorderColor);e.setStyle(r.Style.Color,d.Color.WHITE()),e.setStyle(r.Style.BorderColor,d.Color.WHITE()),this.drawPolygon(e,t,!0),e.setStyle(r.Style.Color,i),e.setStyle(r.Style.BorderColor,s)}clearCircle(e){const t=e.getStyle(r.Style.Color),i=e.getStyle(r.Style.BorderColor),s=e.getStyle(r.Style.Radius);e.setStyle(r.Style.Color,d.Color.WHITE()),e.setStyle(r.Style.BorderColor,d.Color.WHITE()),e.setStyle(r.Style.Radius,s+2),this.drawCircle(e),e.setStyle(r.Style.Color,t),e.setStyle(r.Style.BorderColor,i),e.setStyle(r.Style.Radius,s)}clearRectangle(e){const t=e.getStyle(r.Style.Color),i=e.getStyle(r.Style.BorderColor);e.setStyle(r.Style.Color,d.Color.WHITE()),e.setStyle(r.Style.BorderColor,d.Color.WHITE()),this.drawRectangle(e),e.setStyle(r.Style.Color,t),e.setStyle(r.Style.BorderColor,i)}save(){this.activeContext.save(),this.activeContext.scale(this.getScale(),this.getScale())}restore(){this.activeContext.restore()}saveAll(){Array.from(this.gallery.keys()).forEach(e=>this.gallery.get(e).save())}restoreAll(){Array.from(this.gallery.keys()).forEach(e=>this.gallery.get(e).restore())}beginPath(){this.activeContext.beginPath()}closePath(){this.activeContext.closePath()}moveTo(e){const t=s.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset);this.activeContext.moveTo(t.x,t.y),u.ObjectCache.DrawSettingsPool.recycleObject(t)}lineTo(e,t,i,n){const o=i.getStyle(r.Style.FillRatio);if(0===o)return;1!==o&&(t.setX(s.Utilities.lerp(e.getX(),t.getX(),o)),t.setY(s.Utilities.lerp(e.getY(),t.getY(),o)));const a=s.Utilities.computeDrawSettings(t,this.getStyleMap(),this.offset);this.activeContext.lineTo(a.x,a.y),u.ObjectCache.DrawSettingsPool.recycleObject(a)}quadraticCurveTo(e,t,i,n,o){const a=n.getStyle(r.Style.FillRatio);if(0===a)return;const l=s.Utilities.computeDrawSettings(t,this.getStyleMap(),this.offset),c=s.Utilities.computeDrawSettings(i,this.getStyleMap(),this.offset);if(1!==a){const t=a*a,i=1-a,n=i*i,r=2*a*i;c.setX(n*e.getX()+r*l.getX()+t*c.getX()),c.setY(n*e.getY()+r*l.getY()+t*c.getY()),l.setX(s.Utilities.lerp(e.getX(),l.getX(),a)),l.setY(s.Utilities.lerp(e.getY(),l.getY(),a))}this.activeContext.quadraticCurveTo(l.x,l.y,c.x,c.y),o.forEach(t=>{const i=t.attachAtSource?e:c.toPoint(),s=Math.atan2(l.x-i.x,l.y-i.y)+Math.PI;this.drawArrowHead(i,t.length,t.angle,s,n)}),u.ObjectCache.DrawSettingsPool.recycleObject(l),u.ObjectCache.DrawSettingsPool.recycleObject(c)}drawArrowHead(e,t,i,s,n){const r=e.getX()-t*Math.sin(s-i),o=e.getY()-t*Math.cos(s-i),a=e.getX()-t*Math.sin(s+i),l=e.getY()-t*Math.cos(s+i);this.activeContext.moveTo(e.getX(),e.getY()),this.activeContext.lineTo(r,o),this.activeContext.moveTo(e.getX(),e.getY()),this.activeContext.lineTo(a,l),this.activeContext.stroke()}cubicCurveTo(e,t,i,n,o,a){const l=o.getStyle(r.Style.FillRatio);if(0===l)return;const c=s.Utilities.computeDrawSettings(t,this.getStyleMap(),this.offset),d=s.Utilities.computeDrawSettings(i,this.getStyleMap(),this.offset),h=s.Utilities.computeDrawSettings(n,this.getStyleMap(),this.offset);if(1!==l){const t=l,i=Math.pow(t,2),s=Math.pow(t,3),n=1-t,r=Math.pow(n,2),o=Math.pow(n,3),a=c.toPoint(),u=d.toPoint();c.setX(n*e.getX()+t*c.getX()),c.setY(n*e.getY()+t*c.getY()),d.setX(r*e.getX()+2*t*n*a.getX()+i*d.getX()),d.setY(r*e.getY()+2*t*n*a.getY()+i*d.getY()),h.setX(o*e.getX()+3*t*r*a.getX()+3*n*i*u.getX()+s*h.getX()),h.setY(o*e.getY()+3*t*r*a.getY()+3*n*i*u.getY()+s*h.getY())}this.activeContext.bezierCurveTo(c.x,c.y,d.x,d.y,h.x,h.y),u.ObjectCache.DrawSettingsPool.recycleObject(c),u.ObjectCache.DrawSettingsPool.recycleObject(d),u.ObjectCache.DrawSettingsPool.recycleObject(h)}setFillStyle(e){return e instanceof d.Color?this.activeContext.fillStyle=e.toRGBAString():this.activeContext.fillStyle=e.buildOn(this.activeContext),this}setStrokeStyle(e){return e instanceof d.Color?this.activeContext.strokeStyle=e.toRGBAString():this.activeContext.strokeStyle=e.buildOn(this.activeContext),this}setBorderThickness(e){return this.activeContext.lineWidth=e/this.getScale(),this}setLineDash(e){return this.activeContext.setLineDash(e.map(e=>e/(2*this.getScale()))),this}setShadowColor(e){return this.activeContext.shadowColor=e.toRGBAString(),this}setShadowOffset(e){return this.activeContext.shadowOffsetX=e.getX(),this.activeContext.shadowOffsetY=e.getY(),this}setShadowBlur(e){return this.activeContext.shadowBlur=e,this}setOpacity(e){return this.activeContext.globalAlpha=e,this}setBlendMode(e){return this.activeContext.globalCompositeOperation=e,this}setActiveContext(e){return this.activeContext=this.gallery.get(s.Utilities.clamp(e,0,this.gallery.size-1)),this}applyViewportToAll(e){return Array.from(this.gallery.keys()).forEach(t=>{this.activeContext=this.gallery.get(t),this.applyViewport(e)}),this}applyViewport(e){let t;if(e instanceof l.Rectangle)t=this.getShapeForCamera(e);else{const i=e instanceof o.DrawSettings?e.style.getStyle(r.Style.Viewport):e.getStyle(r.Style.Viewport);t=i instanceof l.Rectangle?this.getShapeForCamera(i):this.getShapeForCamera(l.Rectangle.fromStruct(i))}return this.beginPath(),this.activeContext.rect(t.getX(),t.getY(),t.getWidth(),t.getHeight()),this.clip(),this}clip(){this.activeContext.clip()}clipAll(e){Array.from(this.gallery.keys()).forEach(t=>{if(void 0!==e){const i=u.ObjectCache.PointPool.getObject().addFast(e),n=s.Utilities.computeScaledLength(e.getStyle(r.Style.Width),this.style),o=s.Utilities.computeScaledLength(e.getStyle(r.Style.Height),this.style,!0);this.gallery.get(t).rect(i.x,i.y,n,o),u.ObjectCache.recycleObject(i)}this.gallery.get(t).clip()})}applyTransformations(e){if(e.hasStyle(r.Style.RotationPoint)){const t=e.getStyle(r.Style.RotationPoint);this.activeContext.translate(t.getX(),t.getY())}e.hasStyle(r.Style.RotationAngle)&&this.activeContext.rotate(-s.Utilities.toRadians(e.getStyle(r.Style.RotationAngle)))}applyStyles(e,t=!1){const i=e instanceof n.StyleMap?e:e.style;i.hasStyle(r.Style.Font)&&(this.activeContext.font=i.getStyle(r.Style.Font).build()),this.activeContext.textBaseline=i.getStyle(r.Style.TextBaseLine),i.hasStyle(r.Style.TextAlign)&&(this.activeContext.textAlign=i.getStyle(r.Style.TextAlign)),i.hasStyle(r.Style.Gradient)?this.setFillStyle(i.getStyle(r.Style.Gradient)):i.hasStyle(r.Style.Color)&&this.setFillStyle(i.getStyle(r.Style.Color)),i.hasStyle(r.Style.BorderGradient)?this.setStrokeStyle(i.getStyle(r.Style.BorderGradient)):i.hasStyle(r.Style.BorderColor)&&this.setStrokeStyle(i.getStyle(r.Style.BorderColor)),i.getStyle(r.Style.Opacity)<=1&&this.setOpacity(i.getStyle(r.Style.Opacity)),i.hasStyle(r.Style.BorderThickness)&&this.setBorderThickness(i.getStyle(r.Style.BorderThickness)),i.hasStyle(r.Style.LineDash)&&this.setLineDash(i.getStyle(r.Style.LineDash)),i.hasStyle(r.Style.ShadowColor)&&this.setShadowColor(i.getStyle(r.Style.ShadowColor)),i.hasStyle(r.Style.ShadowOffset)&&this.setShadowOffset(i.getStyle(r.Style.ShadowOffset)),i.hasStyle(r.Style.ShadowBlur)&&this.setShadowBlur(i.getStyle(r.Style.ShadowBlur)),i.hasStyle(r.Style.BlendMode)&&this.setBlendMode(i.getStyle(r.Style.BlendMode)),i.hasStyle(r.Style.Viewport)&&this.applyViewport(e),t||this.applyTransformations(i)}drawStyle(e){this.fill(e),this.stroke(e)}fill(e){(e.hasStyle(r.Style.Color)||e.hasStyle(r.Style.Gradient))&&this.activeContext.fill()}stroke(e){if((e.hasStyle(r.Style.BorderColor)||e.hasStyle(r.Style.BorderGradient))&&e.hasStyle(r.Style.BorderThickness)&&0!==e.getStyle(r.Style.BorderThickness)){const t=e.getStyle(r.Style.StrokeAlignment);let i=e.getStyle(r.Style.BorderThickness);switch(e.hasStyle(r.Style.BorderZoom)&&(i*=this.getStyle(r.Style.ScaleX)),t){case a.Constants.StrokeAlignment.Inside:this.save(),this.clip(),this.setBorderThickness(2*i),this.activeContext.stroke(),this.restore();break;case a.Constants.StrokeAlignment.Outside:this.save(),this.setBorderThickness(2*i),this.activeContext.stroke(),this.clip(),e.hasStyle(r.Style.Color)&&e.getStyle(r.Style.Color).a<1&&(this.save(),this.setFillStyle(d.Color.WHITE()),this.fill(e),this.restore()),this.fill(e),this.restore();break;default:this.activeContext.stroke()}}}static assertColors(e){e.hasStyle(r.Style.Color)||e.hasStyle(r.Style.Gradient)||(e.hasStyle(r.Style.BorderColor)||e.hasStyle(r.Style.BorderGradient))&&e.hasStyle(r.Style.BorderThickness)||s.logService.warn("Either Color or borderColor+thickness must be defined.Otherwise there's nothing to draw.")}}t.Camera2D=p}),define("core/entities/components/abstract_component",["require","exports","constants","core/utilities/utilities","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Component=class{constructor(){this.nodeId=s.Utilities.getUniqueId(),this.classType=i.Constants.ComponentClasses.Abstract}getClassType(){return this.classType}attach(e){return this.owner=e,this}unattach(){return this.attach(void 0),this}getOwner(){return this.owner}hasOwner(){return void 0!==this.owner}invalidate(){this.hasOwner()&&!this.getOwner().isInvalid()&&this.getOwner().invalidate()}clone(){const e=Object.create(Object.getPrototypeOf(this));return e.constructor=this.constructor,n.each(Object.keys(this),t=>{n.isArray(this[t])?e[t]=s.Utilities.cloneArray(this[t]):"owner"===t||(e[t]=!n.isUndefined(this[t])&&this[t].clone&&this[t].clone()||this[t])},this),e.owner=void 0,e}getData(){return this.data}setData(e){return this.data=e,this}update(){}dispose(){this.unattach(),this.data=void 0}}}),define("core/generic_engine_interfaces",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDrawable=function(e){return i.ObjectUtils.hasProperties(e,["draw"])}}),define("core/graphics/stage/scene",["require","exports","core/entities/entity","core/utilities/presence","underscore","core/utilities/utilities","constants","core/generic_engine_interfaces","reusable_utilities"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let c=class extends i.Entity{constructor(e,t){super(e||s.Presence.zeroTopLeft(),t)}setStageFacade(e){return n.each(this.getChildArray(),function(t){t.queryAllComponents(t=>{a.isDrawable(t)&&t.setStageFacade(e)}),t.setStageFacade(e)}),this.queryAllComponents(t=>{a.isDrawable(t)&&t.setStageFacade(e)}),super.setStageFacade(e)}addChild(e,t){return r.logService.assertDefined(e,o.Constants.Feature.Scene,this),this.setStageFacadeOnChild(e,this.getStageFacade()),super.addChild(e,t),this}setStageFacadeOnChild(e,t){e.queryChildTree(e=>{this.setStageFacadeOnChild(e,t)}),e.queryAllComponents(e=>{a.isDrawable(e)&&e.setStageFacade(t)}),e.setStageFacade(t)}removeChild(e){return r.logService.assertDefined(e,o.Constants.Feature.Scene,this),this.setStageFacadeOnChild(e,void 0),super.removeChild(e)}clearChildren(){return n.each(this.getChildren(),e=>{this.setStageFacadeOnChild(e,void 0),e.unattach()}),this.invalidate(),this.getChildren().length=0,this}};c=__decorate([l.meta({name:"Scene"}),__metadata("design:paramtypes",[s.Presence,Array])],c),t.Scene=c}),define("core/graphics/stage/stage",["require","exports","event","jquery","map","reusable_utilities","underscore","constants","settings/camera_settings","settings/stage_settings","style","core/utilities/abstract_state_object","core/utilities/facades/stage_facade","core/utilities/object_cache","core/utilities/presence","core/utilities/unit","core/utilities/utilities","core/graphics/primitives/point","core/graphics/style_map","core/graphics/stage/cameras/camera_2d","core/graphics/stage/queued_event","core/graphics/stage/scene"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class C extends h.AbstractStateObject{constructor(e,t=new y.StyleMap,s,r=new c.StageSettings){super(),this.settings=r,this.onMouseEnter=new i.Event,this.onMouseLeave=new i.Event,this.onMouseUp=new i.Event,this.onMouseDown=new i.Event,this.onMouseDrag=new i.Event,this.onMouseWheel=new i.Event,this.onMouseMove=new i.Event,this.onGlobalMouseMove=new i.Event,this.onMouseClick=new i.Event,this.onRightClick=new i.Event,this.onMouseDoubleClick=new i.Event,this.onResize=new i.Event,this.onDrawEnd=new i.Event,this.onHoverEnd=new i.Event,this.isPressed=!1,this.isActive=!1,this.isInteractionBlocked=!1,this.isDisposed=!1,this.isInvalid=!0,this.isFocused=!1,this.isProcessing=!1,this.frameRate=60,this.id=_.Utilities.getUniqueId(),this.cameras=[],this.alternateTargets=[],this.subscriptions=[],this.eventQueue=new Array(20),this.queuePointer=0,this.queueCounter=0,this.errorMap=new n.Map,this.isPollingActive=!0,this.screen=e,this.style=t,void 0!==s&&(this.frameRate=s),this.context=this.screen.getContext("2d"),this.setImageSmoothing(!1),this.updateStyle(),this.previousMetrics={width:0,height:0},this.checkResize(),_.Utilities.isClientFF()&&this.$canvas.attr("width",this.getCanvas().getBoundingClientRect().width),r.isInteractionAllowed()&&_.Utilities.getMouse().defineCoordinateSystem(this.id,this.windowToStageCoordinates.bind(this)),this.buildEvents(),this.activateEvents()}get relayEvents(){return this.getSettings().getRelayEvents()}static build(e,t,i,s,n=new c.StageSettings,r=new l.CameraSettings){_.Utilities.init(),n instanceof c.StageSettings||(n=c.StageSettings.fromJSON(n)),r instanceof l.CameraSettings||(r=new l.CameraSettings(r));const o=(new y.StyleMap).setStyleIfDifferent(d.Style.Width,t).setStyleIfDifferent(d.Style.Height,i),a=new C(e,o,s,n);e.stage=a;const h=new S.Scene;a.setScene(h);const u=(new y.StyleMap).setStyleIfDifferent(d.Style.Width,a.getWidth()*n.getScale()).setStyleIfDifferent(d.Style.Height,a.getHeight()*n.getScale()),p=a.addCamera(g.Presence.zeroTopLeft(),u,n.getLayerAmount(),r);return p.getStyleMap().setStyleIfDifferent(d.Style.Layer,n.getCameraLayer()),a.subscriptions.push(a.onResize.subscribe(()=>{p.getStyleMap().setStyleIfDifferent(d.Style.Width,a.getWidth()*n.getScale()).setStyleIfDifferent(d.Style.Height,a.getHeight()*n.getScale()),a.getScene().invalidate(),p.invalidate()})),{stage:a,camera:p,scene:h}}getSettings(){return this.settings}handleElementEnter(e,t){t!==this.screen&&(this.stageEvents.leave.func(e),this.mouseElementEnterSub.cancel(),this.documentLeaveSub.cancel())}registerEventRelay(e){this.relayEvents.indexOf(e)<0&&this.relayEvents.push(e)}unregisterEventRelay(e){this.relayEvents.splice(this.relayEvents.indexOf(e),1)}buildEvents(){this.stageEvents={enter:{target:"mouseover",func:e=>{if(!this.isFocused&&!this.isPressed){this.isFocused=!0,this.isPlaying()||this.play();const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseLeave)>=0;this.fireMouseEvent(e,this.onMouseEnter,t),this.mouseElementEnterSub=_.Utilities.getMouse().onMouseElementEnter.subscribe((e,t)=>{this.handleElementEnter(e,t)}),this.documentLeaveSub=_.Utilities.getMouse().onMouseLeave.subscribe(e=>{this.stageEvents.leave.func(e),this.documentLeaveSub.cancel(),this.mouseElementEnterSub.cancel()})}}},leave:{target:"mouseout",func:e=>{if(!this.isPressed&&0===e.buttons){this.isFocused=!1;const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseLeave)>=0;this.fireMouseEvent(e,this.onMouseLeave,!t),this.processUpdate()}}},up:{target:_.Utilities.getMouse().onMouseUp,func:e=>{if(this.isPressed){const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseUp)>=0;this.isPressed=!1,this.getScene().isInteractive()||this.getScene().setInteractiveState(!0),this.fireMouseEvent(e,this.onMouseUp,!t,!0),s(this.screen).is(":hover")?this.stageEvents.enter.func(e):this.stageEvents.leave.func(e)}}},down:{target:_.Utilities.getMouse().onMouseDown,func:e=>{const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseDown)>=0;e.target===this.getCanvas()&&(this.isPressed=!0,this.fireMouseEvent(e,this.onMouseDown,!t,!0))}},wheel:{target:_.Utilities.getMouse().onMouseWheel,func:e=>{const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseWheel)>=0;this.fireMouseEvent(e,this.onMouseWheel,!t)}},move:{target:_.Utilities.getMouse().onMouseMove,func:e=>{if(this.shouldRefresh()){const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseMove)>=0;this.fireMouseEvent(e,this.onMouseMove,!t,this.isPressed)}}},globalMove:{target:_.Utilities.getMouse().onMouseMove,func:e=>{if(this.shouldRefresh()){const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseMove)>=0;this.fireMouseEvent(e,this.onGlobalMouseMove,!t,!0),this.isPressed&&(this.getScene().isInteractive()&&this.getScene().setInteractiveState(!1),this.fireMouseEvent(e,this.onMouseDrag,!t,!0))}}},contextmenu:{target:_.Utilities.getMouse().onRightClick,func:e=>{this.fireMouseEvent(e,this.onRightClick,e.ctrlKey)}},click:{target:_.Utilities.getMouse().onMouseClick,func:e=>{if(e.target===this.screen){const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseClick)>=0;this.fireMouseEvent(e,this.onMouseClick,!t)}}},doubleClick:{target:_.Utilities.getMouse().onMouseDoubleClick,func:e=>{const t=this.relayEvents.indexOf(a.Constants.StageEvents.MouseDblClick)>=0;this.fireMouseEvent(e,this.onMouseDoubleClick,!t)}}}}shouldRefresh(){return!this.isDisposed&&void 0!==this.scene&&(!this.isPollingActive||this.isFocused||this.isActive||this.isPressed||void 0!==window.imageExporter)}activateEvents(){Object.keys(this.stageEvents).forEach(e=>{const t=this.stageEvents[e].target,i=this.stageEvents[e].func;o.isString(t)?(this.screen.addEventListener(t,i),this.subscriptions.push(_.Utilities.buildCustomSubscriptionFacade(()=>this.screen.removeEventListener(t,i)))):this.subscriptions.push(t.subscribe(i))})}registerAlternateTarget(e){return _.logService.assert(this.alternateTargets.indexOf(e)<0,"target has already been registered as an alternate target.",a.Constants.Feature.Stage,e),this.alternateTargets.push(e),this}unregisterAlternateTarget(e){return this.alternateTargets.splice(this.alternateTargets.indexOf(e),1),this}resize(e,t,i,s){this.getCanvas().width=Math.round(i*this.getSettings().getScale()),this.getCanvas().height=Math.round(s*this.getSettings().getScale()),this.onResize.fire({newWidth:i*this.getSettings().getScale(),newHeight:s*this.getSettings().getScale(),xFactor:e,yFactor:t,scale:this.getSettings().getScale()})}activate(){return this.isActive=!0,this.isPaused()&&this.play(),this}deActivate(){return this.isActive=!1,this}updateStyle(){this.getCanvas().style.backgroundColor=this.style.hasStyle(d.Style.Color)?this.style.getStyle(d.Style.Color).toHex6():"transparent";const e=new m.Unit(this.style.getStyle(d.Style.Width),{noDecimal:!0}),t=new m.Unit(this.style.getStyle(d.Style.Height),{noDecimal:!0});_.logService.assert(!t.isInPercent(),"height must be specified in pixels",a.Constants.Feature.Stage,this),e.getType()!==a.Constants.UnitType.PERCENT&&(this.getCanvas().width=e.getValueIn(a.Constants.UnitType.PIXEL)*this.getSettings().getScale()),this.getCanvas().style.width=e.toString(),this.getCanvas().height=t.getValueIn(a.Constants.UnitType.PIXEL)*this.getSettings().getScale(),this.getCanvas().style.height=t.toString()}windowToStageCoordinates(e,t=0){const i=this.getCanvas().getBoundingClientRect();return"number"==typeof e?f.Point.fromJson({x:e-i.left,y:t-i.top}):e instanceof f.Point?f.Point.fromJson({x:e.getX()-i.left,y:e.getY()-i.top}):((e=e).x-=i.left,e.y-=i.top,f.Point.fromJson(e))}fireMouseEvent(e,t,i=!1,s=!1){if(!this.isInteractionBlocked&&this.settings.isInteractionAllowed()&&(s||e.target===this.getCanvas()||this.alternateTargets.indexOf(e.target)>=0)){i&&e.preventDefault();const s=_.Utilities.getUniqueId()+""+this.id;this.getCameras().forEach(i=>{const n=i.stageToCameraCoordinates(this.getCurrentMousePosition());this.queueEvent(new E.QueuedEvent(t,{id:s,camera:i,e:e,appliedZoom:i.getStyle(d.Style.ScaleX),mouse:n.clone(),deltaX:e.mouseDeltaX,deltaY:e.mouseDeltaY},"mouse")),p.ObjectCache.recycleObject(n)})}}blockEvents(){return this.isInteractionBlocked=!0,this}unblockEvents(){return this.isInteractionBlocked=!1,this}getWidth(){return this.getCanvas().width/this.getSettings().getScale()}getCurrentMousePosition(){return _.Utilities.getMouse().getCoordinatesFor(this.id)}getHeight(){return this.getCanvas().height/this.getSettings().getScale()}getCanvas(){return this.screen}getId(){return this.id}setCursor(e){return this.getCanvas().style.cursor=e,this}resetCursor(){return this.getCanvas().style.cursor=a.Constants.Mouse.Cursor.Default,this}getCursor(){return this.getCanvas().style.cursor}isCursor(e){return this.getCanvas().style.cursor===e}isCursorPointer(){return this.getCursor()===a.Constants.Mouse.Cursor.Pointer}getContext(){return this.context}waitForFonts(){const e=document.fonts;return void 0===e||void 0===e.load?Promise.resolve([]):Promise.all(Object.values(a.Constants.Font.Family).map(t=>e.load(`10pt "${t}"`))).catch(e=>(console.warn(`Exception occurred when loading font: ${e}`),Promise.resolve([])))}async start(e=this.getScene()){await this.waitForFonts(),_.logService.assert(void 0!==e,"No passed scene as parameter and stage has no registeredscene. Aborting stage start procedure.",a.Constants.Feature.Stage,this),_.logService.assert(e instanceof S.Scene,"Incompatible Sceneargument. Aborting stage start procedure.",a.Constants.Feature.Stage,this),_.logService.assert(this.hasCameras(),"Stage has no Cameras to draw on. Aborting stage start procedure.",a.Constants.Feature.Stage,this),this.setScene(e),await _.Utilities.waitUntilFontsAreLoaded(),this.play()}play(){if(!this.isDisposed){const e=r.AnimationLoop.registerCallback(()=>new Promise(t=>{if(this.isDisposed)return r.AnimationLoop.removeCallbackById(e),t();_.Utilities.getMouse().isStageRegistered(this)||_.Utilities.getMouse().registerStage(this),!_.Utilities.getMouse().isStageActive(this)&&this.isHovered()?(_.Utilities.getMouse().activateStage(this),this.isFocused=!0):_.Utilities.getMouse().isStageActive(this)&&!this.isHovered()&&(this.onHoverEnd.fire(),_.Utilities.getMouse().deactivateStage(this),this.isFocused=!1),this.processUpdate(),this.shouldRefresh()?this.isPlaying()||this.setState(a.Constants.State.Animation.Playing):(this.setState(a.Constants.State.Animation.Paused),r.AnimationLoop.removeCallbackById(e)),t()}),!1,this.getFrameRate())}return this}isHovered(){if(!this.settings.isInteractionAllowed())return!1;const e=this.getCurrentMousePosition();return this.$canvas.is(":hover")||e.getX()>0&&e.getX()<this.getWidth()&&e.getY()>0&&e.getY()>this.getHeight()}processUpdate(){return this.isProcessing||(this.isProcessing=!0,this.update(),this.processEventsSafely(),this.isProcessing=!1),this}processEventsSafely(){try{this.processEvents()}catch(e){void 0===this.errorMap.get(e.message)&&(this.errorMap.set(e.message,e),_.logService.error([e.message].concat(e.stack.split("\n")),a.Constants.Feature.Stage,this)),this.eventQueue.splice(0,this.queueCounter+1),this.queuePointer-=this.queueCounter+1,this.processEventsSafely()}return this}setImageSmoothing(e){return this.context.mozImageSmoothingEnabled=e,this.context.webkitImageSmoothingEnabled=e,this.context.msImageSmoothingEnabled=e,this.context.imageSmoothingEnabled=e,this.cameras.forEach(t=>t.setImageSmoothing(e)),this}getFrameRate(){return this.frameRate}getFacade(){return void 0===this.facade&&(this.facade=new u.StageFacade(this)),this.facade}getStyleMap(){return this.style}getStyle(e){return this.getStyleMap().getStyle(e)}setStyle(e,t){return this.getStyleMap().setStyle(e,t),this.updateStyle(),this}hasScene(){return void 0!==this.getScene()}getScene(){return this.scene}setScene(e){return this.scene=e,this.scene.setStageFacade(this.getFacade()),this}invalidateLayer(){return this.invalidateAll()}invalidateAll(){return this.isInvalid||(this.isInvalid=!0,this.getCameras().forEach(e=>e.invalidateAll())),this}addCamera(e,t,i,s,n){const r=new b.Camera2D(e,t,i,s,n?n+""+this.id:void 0);return this.subscriptions.push(r.onMouseEnter.subscribe(()=>this.activeCamera=r)),this.subscriptions.push(r.onZoom.subscribe(()=>this.getScene().setInteractiveState(!1))),this.subscriptions.push(r.onZoomEnd.subscribe(()=>this.getScene().setInteractiveState(!0))),void 0===this.activeCamera&&(this.activeCamera=r),this.getCameras().push(r),r.setStageFacade(this.getFacade()),r}getOrigin(){const e=this.getCanvas().getBoundingClientRect();return new g.Presence(e.left,e.top,a.Constants.Origin.TOP_LEFT)}hasCameras(){return void 0!==this.getActiveCamera()||this.getCameras().length>0}getCameras(){return this.cameras}getActiveCamera(){return this.activeCamera}update(){this.checkResize(),void 0!==this.getScene()&&this.getScene().update(),this.getCameras().forEach(e=>e.update()),this.isInvalid&&this.hasDimensions()&&(this.isInvalid=!1,this.draw())}hasDimensions(){return void 0!==this.boundingRect&&0!==this.boundingRect.width&&0!==this.boundingRect.height}getBoundingRect(){return this.boundingRect}get $canvas(){return this.$internalCanvas&&this.$internalCanvas[0]===this.getCanvas()||(this.$internalCanvas=s(this.getCanvas())),this.$internalCanvas}updateBoundingRect(){const e=this.getCanvas().getBoundingClientRect(),t=this.$canvas;this.boundingRect={bottom:e.bottom,left:e.left,right:e.right,top:e.top,width:t.width(),height:t.height()}}checkResize(){if(this.updateBoundingRect(),this.boundingRect.width!==this.previousMetrics.width||this.boundingRect.height!==this.previousMetrics.height){const e=this.boundingRect.width/Math.max(this.previousMetrics.width,1),t=this.boundingRect.height/Math.max(this.previousMetrics.height,1);this.resize(e,t,this.boundingRect.width,this.boundingRect.height),this.previousMetrics.width=this.boundingRect.width,this.previousMetrics.height=this.boundingRect.height}}draw(){return _.Utilities.clear(this.context),this.cameras.forEach(e=>e.draw(this.scene)),this.onDrawEnd.fire(),this}removeEvents(){return this.onMouseEnter.cancelAll(),this.onMouseLeave.cancelAll(),this.onMouseUp.cancelAll(),this.onMouseDown.cancelAll(),this.onMouseDrag.cancelAll(),this.onMouseWheel.cancelAll(),this.onMouseMove.cancelAll(),this.onGlobalMouseMove.cancelAll(),this.onMouseClick.cancelAll(),this.onRightClick.cancelAll(),this.onMouseDoubleClick.cancelAll(),this.onResize.cancelAll(),this.onDrawEnd.cancelAll(),this.subscriptions.forEach(e=>e.cancel()),this.subscriptions.length=0,this}dispose(){void 0!==this.documentLeaveSub&&this.documentLeaveSub.cancel(),void 0!==this.mouseElementEnterSub&&this.mouseElementEnterSub.cancel(),delete this.getCanvas().stage,this.isDisposed=!0,_.Utilities.clear(this.context),_.Utilities.getMouse().unregisterStage(this),_.Utilities.getMouse().removeCoordinateSystem(this.id),this.removeEvents(),this.eventQueue.length=0,void 0!==this.scene&&(this.scene.dispose(),this.scene=void 0),this.getCameras().forEach(e=>e.dispose()),this.cameras=[],this.resetDefaultDomDimensions(),Object.keys(this.stageEvents).forEach(e=>{const t=this.stageEvents[e];t&&(delete t.func,t.events&&t.events.forEach(e=>e.cancelAll()))}),this.stageEvents=void 0}resetDefaultDomDimensions(){this.getCanvas().width=0,this.getCanvas().style.width="",this.getCanvas().height=0,this.getCanvas().style.height=""}processEvents(){if(this.queueCounter=0,this.eventQueue.length>0)for(;this.queueCounter<this.queuePointer;){if(void 0===this.eventQueue[this.queueCounter])throw new Error("undefined is not a valid event");{const e=this.eventQueue[this.queueCounter].getEvent();e instanceof i.Event?e.fire(this.eventQueue[this.queueCounter].getArguments()):e.apply(void 0,this.eventQueue[this.queueCounter].getArguments()),this.queueCounter++}}this.queuePointer=0}queueEvent(e){_.logService.assert(this.queuePointer<500,"too many Events queued at the same time",a.Constants.Feature.Stage,{object:this,event:e}),void 0!==this.eventQueue&&(this.queuePointer<this.eventQueue.length?(this.eventQueue[this.queuePointer]=e,this.queuePointer++):this.eventQueue.push(e))}}t.Stage=C}),define("core/graphics/stage/queued_event",["require","exports","event","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueuedEvent=class{constructor(e,t,n){this.event=e,e instanceof i.Event||s.isArray(t)||(t=[t]),this.args=t,this.id=n}getEvent(){return this.event}getArguments(){return this.args}getId(){return this.id}}}),define("core/utilities/facades/stage_facade",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StageFacade=class{constructor(e){this.stage=e,this.onDrawEnd=this.stage.onDrawEnd,this.onMouseClick=this.stage.onMouseClick,this.onRightClick=this.stage.onRightClick,this.onMouseDoubleClick=this.stage.onMouseDoubleClick,this.onMouseDown=this.stage.onMouseDown,this.onResize=this.stage.onResize,this.onMouseDrag=this.stage.onMouseDrag,this.onMouseUp=this.stage.onMouseUp,this.onMouseEnter=this.stage.onMouseEnter,this.onMouseLeave=this.stage.onMouseLeave,this.onMouseMove=this.stage.onMouseMove,this.onGlobalMouseMove=this.stage.onGlobalMouseMove,this.onMouseWheel=this.stage.onMouseWheel,this.onHoverEnd=this.stage.onHoverEnd}get isInteractionBlocked(){return this.stage.isInteractionBlocked}get isFocused(){return this.stage.isFocused}get isActive(){return this.stage.isActive}activate(){this.stage.activate()}deActivate(){this.stage.deActivate()}getId(){this.stage.getId()}setStyle(e,t){this.stage.setStyle(e,t)}getWidth(){return this.stage.getWidth()}getHeight(){return this.stage.getHeight()}queueEvent(e){this.stage.queueEvent(e)}getCurrentMousePosition(){return this.stage.getCurrentMousePosition()}isPressed(){return this.stage.isPressed}getCanvas(){return this.stage.getCanvas()}getCameras(){return this.stage.getCameras()}getContext(){return this.stage.getContext()}setCursor(e){return this.stage.setCursor(e)}resetCursor(){return this.stage.resetCursor()}getCursor(){return this.stage.getCursor()}isCursor(e){return this.stage.isCursor(e)}isCursorPointer(){return this.stage.isCursorPointer()}getStyleMap(){return this.stage.getStyleMap()}getStyle(e){return this.stage.getStyleMap().getStyle(e)}getFrameRate(){return this.stage.getFrameRate()}getActiveCamera(){return this.stage.getActiveCamera()}getOrigin(){return this.stage.getOrigin()}setImageSmoothing(e){return this.stage.setImageSmoothing(e)}isInvalid(){return this.stage.isInvalid}invalidateAll(){this.stage.invalidateAll()}invalidateLayer(){this.stage.invalidateLayer()}blockEvents(){this.stage.blockEvents()}unblockEvents(){this.stage.unblockEvents()}isHovered(){this.stage.isHovered()}isPlaying(){return this.stage.isPlaying()}isPaused(){return this.stage.isPaused()}play(){return this.stage.play()}isProcessing(){return this.stage.isProcessing}processUpdate(){return this.stage.processUpdate()}getSettings(){return this.stage.getSettings()}registerEventRelay(e){this.stage.registerEventRelay(e)}unregisterEventRelay(e){this.stage.unregisterEventRelay(e)}}}),define("core/utilities/abstract_stage_node",["require","exports","map","reusable_utilities","underscore","style"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t){this.subscriptions=[],this.locked=!1,this.disposed=!1,this.invalid=!1,this.nodeId=o.nodeUuid++,this.animationData=new i.Map,this.presence=e,this.presence.debugSetMaster(this),this.token=new s.CancellationToken,void 0!==t&&this.attach(t),this.initializeEvents()}initializeEvents(){this.onMouseClick=this.getPresence().onMouseClick,this.onRightClick=this.getPresence().onRightClick,this.onMouseDoubleClick=this.getPresence().onMouseDoubleClick,this.onMouseDown=this.getPresence().onMouseDown,this.onMouseDrag=this.getPresence().onMouseDrag,this.onMouseUp=this.getPresence().onMouseUp,this.onMouseEnter=this.getPresence().onMouseEnter,this.onMouseLeave=this.getPresence().onMouseLeave,this.onGlobalMouseMove=this.getPresence().onGlobalMouseMove,this.onMouseMove=this.getPresence().onMouseMove,this.onMouseWheel=this.getPresence().onMouseWheel,this.onTranslate=this.getPresence().onTranslate,this.token.registerDisposable(this.getStyleMap().on("style_changed",e=>{e.forEach(e=>this.verifyStyleChange(e)),this.invalidate()})),this.subscriptions=[]}verifyStyleChange(e){}setStageFacade(e){return this.stageFacade!==e&&(n.isUndefined(this.stageFacade)||this.removeEvents(),this.stageFacade=e,this.subscribeToStage(),!0)}setName(e){return this.name=e,this}getName(){return this.name}getStageFacade(){return this.stageFacade}hasStageFacade(){return void 0!==this.stageFacade}addEvents(e){return this}updateOrigin(e,t,i,s){this.getPresence().updateOrigin(e,t,i,s)}update(){this.invalid=!1}draw(e){throw new Error("You need to overwrite the draw method in the extending classes if you want to draw anything")}setOrigin(e){return this.getPresence().setOrigin(e),this}getOrigin(){return this.getPresence().getOrigin()}getNodeId(){return this.nodeId}getAnimationData(){return this.animationData}getPopoverData(){return this.popoverData}setPopoverData(e){return this.popoverData=e,this}setData(e){return this.data=e,this}getData(){return this.data}setLayer(e){return this.setStyle(r.Style.Layer,e),this}getLayer(){return this.getStyle(r.Style.Layer)}setEventParams(e){return this.eventParams=e,this}subscribeToStage(){const e=this.getStageFacade();return this.subscribedToStage!==e&&(n.isUndefined(this.subscribedToStage)||this.getPresence().cancelSubscriptions(),n.isUndefined(e)||(this.getPresence().subscribeToStage(this.getStageFacade()),this.addEvents&&this.addEvents(this.eventParams)),this.subscribedToStage=e),this}setAbsolute(e=!1){return this.getPresence().setAbsolute(e),this}isAbsolute(){return this.getPresence().isAbsolute()}getPresence(){return this.presence}setPositionRelativeTo(e,t,i){return this.getPresence().setPositionRelativeTo(e,t,i),this}getPositionRelativeTo(e){return this.getPresence().getPositionRelativeTo(e)}getStyleMap(){return this.getPresence().getStyleMap()}hasStyleMap(){return this.getPresence().hasStyleMap()}setStyleMap(e){return this.getPresence().setStyleMap(e),this}getStyle(e){return this.hasStyleMap()||this.getPresence().setDefaultStyleMap(),this.getStyleMap().getStyle(e)}hasStyle(e){return this.hasStyleMap()&&this.getStyleMap().hasStyle(e)}hasAnyStyle(e){return this.getStyleMap().hasAnyStyle(e)}hasAllStyles(e){return this.getStyleMap().hasAllStyles(e)}resetStyle(e){return this.getStyleMap().resetStyle(e)}setStyle(e,t,i=!0){return this.getStyleMap().setStyle(e,t,i),this}setX(e){return this.getPresence().setX(e),this.invalidate(),this}getX(){return this.getPresence().getX()}setY(e){return this.getPresence().setY(e),this.invalidate(),this}getY(){return this.getPresence().getY()}setZ(e){return this.getPresence().setZ(e),this.invalidate(),this}getZ(){return this.getPresence().getZ()}setRelativeX(e){return this.getPresence().setRelativeX(e),this.invalidate(),this}setRelativeY(e){return this.getPresence().setRelativeY(e),this.invalidate(),this}setRelativeZ(e){return this.getPresence().setRelativeZ(e),this.invalidate(),this}setDefaultStyle(e){return this.hasStyleMap()&&this.getStyleMap().setDefaultStyle(e),this}addShape(e){return this.getPresence().addShape(e),this}hasShapes(){return this.getPresence().hasShapes()}getBoundingBox(e,t){return this.getPresence().getBoundingBox(e,t)}translate(e,t){return this.getPresence().translate(e,t),this}getShapes(){return this.getPresence().getShapes()}getShape(){return this.getBoundingBox()}substractShape(e){return this.getPresence().substractShape(e),this}clearShape(){return this.getPresence().clearShape(),this}resetDimension(){return this.getPresence().resetDimension(),this}containsPoint(e,t){return this.getPresence().containsPoint(e,t)}isInteractive(){return this.getPresence().isInteractive()}setInteractiveState(e){return this.getPresence().setInteractiveState(e),this}invalidate(){return this.hasStageFacade()&&this.getStageFacade().invalidateAll(),this}isInvalid(){return this.hasStageFacade()&&this.getStageFacade().isInvalid()}attach(e){return this.parent=e,this.getPresence().attach(e.getPresence()),this.invalidate(),this}unattach(){return this.getStyleMap()&&this.getStyleMap().getRawStyle(r.Style.Opacity)===this.parent.getStyleMap()&&this.setDefaultStyle(r.Style.Opacity),this.parent=void 0,this.getPresence().unattach(),this.invalidate(),this}getParent(){return this.parent}hasParent(){return void 0!==this.parent}queryParentChain(e,t){let i;return this.hasParent()&&(i=e(this.getParent()),!n.isUndefined(i)||!n.isUndefined(t)&&t(this.getParent())&&t||(i=this.getParent().queryParentChain(e,t))),i}hide(){return this.isLocked()||this.isHidden()||(this.getPresence().hide(),this.invalidate()),this}show(){return!this.isLocked()&&this.isHidden()&&(this.getPresence().show(),this.invalidate()),this}isHidden(){return this.getPresence().isHidden()}isHovering(){return this.getPresence().isHovering()}lock(){return this.locked=!0,this}unlock(){return this.locked=!1,this}isRotated(){return this.getPresence().hasStyleMap()&&this.hasAllStyles([r.Style.RotationAngle,r.Style.RotationOrigin])}getRotationOrigin(){return this.getPresence().getOriginByType(this.getStyle(r.Style.RotationOrigin)).multiply(-1)}isLocked(){return this.locked}isDisposed(){return this.disposed}removeEvents(){return n.each(this.subscriptions,e=>{e.cancel()}),this.subscriptions=[],this.getPresence().cancelSubscriptions(),this.subscribedToStage=!1,this}dispose(){this.token.cancel(),this.disposed=!0,this.getPresence().dispose(),this.removeEvents(),this.data=void 0}}o.nodeUuid=0,t.StageNode=o}),define("core/entities/components/abstract_presence_component",["require","exports","underscore","constants","core/graphics/primitives/polygon","core/utilities/abstract_stage_node","core/utilities/utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PresenceComponent=class extends r.StageNode{constructor(){super(...arguments),this.classType=s.Constants.ComponentClasses.Presence}attach(e){return super.attach(e),this.setOwner(e),this}unattach(){return super.unattach(),this.setOwner(void 0),this}getClassType(){return this.classType}setClassType(e){return this.classType=e,this}setOwner(e){return this.owner=e,this}getOwner(){return this.owner}hasOwner(){return void 0!==this.owner}clone(){const e=Object.create(Object.getPrototypeOf(this));return e.constructor=this.constructor,i(Object.keys(this)).each(t=>{i.isArray(this[t])?e[t]=o.Utilities.cloneArray(this[t]):"owner"===t||(e[t]=!i.isUndefined(this[t])&&this[t].clone&&this[t].clone()||this[t])},this),this.getShapes().forEach(t=>e.addShape(t.clone())),e.owner=void 0,e}rotateShape(e=!1){return n.Polygon.zero()}update(){}draw(e){}dispose(){super.dispose(),this.owner=void 0}}}),define("core/entities/rectangle",["require","exports","core/entities/entity","core/graphics/primitives/rectangle","style"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RectangleEntity=class extends i.Entity{constructor(e,t=[],i){super(e,t,i),this.addShape(new s.Rectangle(0,0,this.getStyle(n.Style.Width),this.getStyle(n.Style.Height)))}draw(e){e.drawRectangle(this.getPresence()),super.draw(e)}}}),define("core/entities/components/rectangle_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/presence","core/graphics/primitives/rectangle","style","constants","underscore","core/utilities/object_cache","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let d=class extends i.PresenceComponent{constructor(e){if(e instanceof s.Presence){super(e);const t=e.getStyle(r.Style.Width),i=e.getStyle(r.Style.Height);this.addShape(new n.Rectangle(0,0,t,i))}else{super(new s.Presence(e.getX(),e.getY()).setStyle(r.Style.Width,e.getWidth()).setStyle(r.Style.Height,e.getHeight())),e.resetCoordinates(),this.addShape(e)}this.classType=o.Constants.ComponentClasses.Rectangle}getShape(){const e=l.ObjectCache.RectanglePool.getObject();return e.setCoordinates(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()),e.setWidth(this.getStyle(r.Style.Width)),e.setHeight(this.getStyle(r.Style.Height)),e}verifyStyleChange(e){if(super.verifyStyleChange(e),e===r.Style.Width||e===r.Style.Width){const t=this.getStyle(e);e===r.Style.Width&&a.isNumber(t)?this.getShapes()[0].setWidth(t):e===r.Style.Height&&a.isNumber(t)&&this.getShapes()[0].setHeight(t)}return this}draw(e){if(!this.getPresence().isHidden()){const t=e.getStyle(r.Style.ScaleX)||r.getDefaultStyle(r.Style.ScaleX);this.updateOrigin(t),e.drawRectangle(this.getPresence())}}};d=__decorate([c.meta({name:"RectangleComponent"}),__metadata("design:paramtypes",[Object])],d),t.RectangleComponent=d}),define("factories/factory",["require","exports","reusable_utilities","core/entities/rectangle","core/utilities/presence","style","core/entities/components/rectangle_component"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{static buildPlusButton(e,t,s=5,n=i.Color.WHITE(),l=i.Color.GREY(),c=i.Color.BLACK(.5),d=i.Color.BLACK(.7),h=.5,u=.2,p=Math.min(t,e)-2*s,g=.3*p){const m=a.buildMinusButton(e,t,s,n,l,c,d,h,u,p,g),_=a.buildRectanglePresence(g,p,l,d,u);return _.translate((e-g)/2,s),m.addComponent(new o.RectangleComponent(_).setStyle(r.Style.Layer,()=>m.getStyle(r.Style.Layer)+1)),m}static buildMinusButton(e,t,n=5,l=i.Color.WHITE(),c=i.Color.GREY(),d=i.Color.BLACK(.5),h=i.Color.BLACK(.7),u=.5,p=.2,g=Math.min(t,e)-2*n,m=.3*g){const _=a.buildRectanglePresence(e,t,l,d,u),f=a.buildRectanglePresence(g,m,c,h,p);return f.translate(n,(t-m)/2),new s.RectangleEntity(_,[new o.RectangleComponent(f).setStyle(r.Style.Layer,()=>_.getStyle(r.Style.Layer)+1)])}static buildRectanglePresence(e,t,s=i.Color.WHITE(),o=i.Color.BLACK(.5),a=.5){return n.Presence.zeroTopLeft().setStyle(r.Style.Width,e).setStyle(r.Style.Height,t).setStyle(r.Style.Color,s).setStyle(r.Style.BorderColor,o).setStyle(r.Style.BorderThickness,a)}}t.Factory=a}),define("settings/camera_settings",["require","exports","constants","core/graphics/primitives/point","core/utilities/utilities","underscore","factories/factory"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CameraSettings=class{constructor(e){this.translationEnabled=!1,this.wheelZoomEnabled=!1,this.buttonZoomEnabled=!1,this.triggeredZoomEnabled=!1,this.zoomFactor=2,this.zoomDuration=100,this.minZoomValue=1,this.maxZoomValue=100,this.buttons=[],this.buttonMargin=10,this.buttonOrigin=i.Constants.Origin.TOP_LEFT,this.panLimits={topLeft:s.Point.min(),bottomRight:s.Point.max()},void 0!==e&&(this.setZoomSettings(e),this.setPanLimits(e),this.setButtonSettings(e)),0===this.buttons.length&&this.buildDefaultButtons()}getZoomFactor(){return this.zoomFactor}setZoomFactor(e){return this.zoomFactor=e,this}getZoomDuration(){return this.zoomDuration}setZoomDuration(e){return this.zoomDuration=e,this}getMinZoomValue(){return this.minZoomValue}setMinZoomValue(e){return this.minZoomValue=e,this}enableTranslation(){return this.translationEnabled=!0,this}isTranslationEnabled(){return this.translationEnabled}disableTranslation(){return this.translationEnabled=!1,this}enableZoom(e,t=!1){return this.manipulateZoom(e,t,!0)}manipulateZoom(e,t,s){if(void 0===e)return this.manipulateAllZoom(s);const n=e.indexOf(i.Constants.ZoomType.Wheel)>=0;(t?!n:n)&&(this.wheelZoomEnabled=s);const r=e.indexOf(i.Constants.ZoomType.Button)>=0;(t?!r:r)&&(this.buttonZoomEnabled=s);const o=e.indexOf(i.Constants.ZoomType.Triggered)>=0;return(t?!o:o)&&(this.triggeredZoomEnabled=s),this}manipulateAllZoom(e){return this.wheelZoomEnabled=e,this.buttonZoomEnabled=e,this.triggeredZoomEnabled=e,this}disableZoom(e,t=!1){return this.manipulateZoom(e,t,!1)}isWheelZoomEnabled(){return this.wheelZoomEnabled}isButtonZoomEnabled(){return this.buttonZoomEnabled}isTriggeredZoomEnabled(){return this.triggeredZoomEnabled}isAnyZoomEnabled(){return this.isWheelZoomEnabled()||this.isButtonZoomEnabled()||this.isTriggeredZoomEnabled()}getMaxZoomValue(){return this.maxZoomValue}setMaxZoomValue(e){return this.maxZoomValue=e,this}setButtons(e){return this.buttons=e,r.each(this.buttons,e=>{e.hide()}),this}buildDefaultButtons(){return this.addButton(o.Factory.buildPlusButton(27,27,8.5)),this.addButton(o.Factory.buildMinusButton(27,27,8.5)),this}addButton(e){return this.buttons.push(e),e.hide(),this}getButtons(){return this.buttons}setPanLimits(e){return void 0!==e.topLeft&&(this.panLimits.topLeft=e.topLeft),void 0!==e.bottomRight&&(this.panLimits.bottomRight=e.bottomRight),this}getPanLimits(){return this.panLimits}getButtonMargin(){return this.buttonMargin}getButtonOrigin(){return this.buttonOrigin}setButtonMargin(e){return r.each(this.getButtons(),t=>{t.setRelativeX(e),t.setRelativeY(e)}),this.buttonMargin=e,this}setButtonSettings(e){void 0!==e.buttons&&this.setButtons(e.buttons),void 0!==e.buttonMargin&&this.setButtonMargin(e.buttonMargin),void 0!==e.buttonOrigin&&this.setButtonOrigin(e.buttonOrigin)}setButtonOrigin(e=i.Constants.Origin.TOP_LEFT){return this.buttonOrigin=e,this}setZoomSettings(e){return void 0!==e.zoomFactor&&this.setZoomFactor(e.zoomFactor),void 0!==e.zoomDuration&&this.setZoomDuration(e.zoomDuration),void 0!==e.minZoomValue&&this.setMinZoomValue(e.minZoomValue),void 0!==e.maxZoomValue&&this.setMaxZoomValue(e.maxZoomValue),this}regulateZoom(e){return n.Utilities.clamp(e,this.getMinZoomValue(),this.getMaxZoomValue())}regulateOffset(e,t){const i=this.getPanLimits(),s=n.Utilities.clamp(e.getX(),i.topLeft.getX()*t,i.bottomRight.getX()*t),r=n.Utilities.clamp(e.getY(),i.topLeft.getY()*t,i.bottomRight.getY()*t);return e.setCoordinates(s,r),e}}}),define("core/models/animation_model",["require","exports","underscore","core/utilities/utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.progress=0,this.reversed=!1,this.duration=e}static zero(){return new n(0)}compute(){this.duration instanceof Function&&(this.duration=this.duration())}getDuration(){return s.Utilities.simplify(this.duration)}setDuration(e){return this.duration=e,this}getProgress(){return this.progress}makeSkeleton(){return n.zero()}setProgress(e){return this.progress=e,this}clone(){const e=this.makeSkeleton();return i.each(i.keys(this),t=>{e[t]=s.Utilities.isCloneable(this[t])&&this[t].clone()||this[t]}),e}setReverseState(e){return e!==this.isReversed()&&this.reverse(),this}isReversed(){return this.reversed}reverse(){return this.reversed=!this.reversed,this}reset(e){return this.setReverseState(!1),this.progress=0,i.isUndefined(e)||this.setDuration(e),this}}t.AnimationModel=n}),define("core/models/tweening_model",["require","exports","underscore","constants","core/utilities/presence","core/utilities/utilities","core/models/animation_model"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends o.AnimationModel{constructor(e,t,i,s){super(i),this.key=e,this.setValue(t),void 0!==s&&this.setOriginalValue(s)}compute(){super.compute(),i.isFunction(this.originalValue)&&(this.originalValue=this.originalValue()),i.isFunction(this.value)&&this.setValue(r.Utilities.simplify(this.getValue(),this.getOriginalValue()))}static zero(){return new a(0,0,0)}makeSkeleton(){return a.zero()}getKey(){return this.key}getValue(){return this.value}hasValue(){return void 0!==this.getValue()}hasOriginalValue(){return void 0!==this.getOriginalValue()}reset(e,t){return super.reset(e),i.isUndefined(t)||this.setValue(t),this}setValue(e){return i.isFunction(e)&&(e=e()),e instanceof n.Presence?this.value=e.toPoint():this.value=e,this}setOriginalValue(e){return r.logService.assertDefined(e,s.Constants.Feature.Animations.Models.TweeningModel),i.isArray(e)?this.originalValue=e.slice():e instanceof n.Presence?this.originalValue=e.toRelativePoint():i.isUndefined(e.clone)?this.originalValue=e:this.originalValue=e.clone(),this.compute(),this}getOriginalValue(){return this.originalValue}reverse(){if(!i.isUndefined(this.getOriginalValue())&&!i.isUndefined(this.getValue())){super.reverse();const e=this.value;this.progress=1-this.progress,this.value=this.originalValue,this.originalValue=e}return this}clone(){return r.logService.assertDefined(this.value,s.Constants.Feature.Animations.Models.TweeningModel,this.value),super.clone()}}t.TweeningModel=a}),define("core/graphics/animation/animation",["require","exports","event","reusable_utilities","underscore","constants","style","core/models/tweening_model","core/utilities/utilities","core/utilities/abstract_state_object"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d extends c.AbstractStateObject{constructor(e){super(),this.models=[],this.activeModels=[],this.duration=0,this.timestamp=0,this.progress=0,this.id=r.Constants.Feature.Animations.Animation,this.reversed=!1,this.firstScheduleTime=Number.MIN_VALUE,this.isSubscribedToSequence=!1,this.frameRequestToken=new s.CancellationToken,this.onStop=new i.Event,this.onDone=new i.Event,this.onPause=new i.Event,this.onAnimationStep=new i.Event,this.onTimestampReset=new i.Event,this.onSetAnimationProgressCall=new i.Event,this.onAnimate=new i.Event,this.onReverse=new i.Event,void 0!==e&&this.addModels(e)}static zero(){return new d}cancelFrame(){this.frameRequestToken.cancel(),this.frameRequestToken=new s.CancellationToken}requestFrame(e){this.frameRequestToken.requestAnimationFrame(e)}conductAnimationStep(e,t){this.prepareAnimation(e)}scheduleAnimation(e){this.setState(r.Constants.State.Animation.Playing),this.firstScheduleTime===Number.MIN_VALUE&&(this.firstScheduleTime=this.timestamp),this.onAnimate.fire()}setAnimationProgress(e,t){l.logService.assert(e>=0&&e<=1,"animation progress must be between 0 and 1",r.Constants.Feature.Animations.Animation,e),this.prepareAnimation(t)}prepareAnimation(e){this.isPlaying()||(this.firstScheduleTime=void 0,this.setState(r.Constants.State.Animation.Paused),this.onAnimate.fire()),this.initializeModelsIfNeeded(e)}initializeModelsIfNeeded(e){let t;n.each(this.getModels(),(i,s)=>{i instanceof a.TweeningModel&&void 0===i.getOriginalValue()&&(t=o.isStyleKey(i.getKey())?e.getStyle(i.getKey()):e[i.getKey()],i.setOriginalValue(t))})}removeEvents(){this.onStop.cancelAll(),this.onDone.cancelAll(),this.onAnimationStep.cancelAll(),this.onAnimate.cancelAll(),this.onReverse.cancelAll(),this.onPause.cancelAll(),this.onTimestampReset.cancelAll(),this.onSetAnimationProgressCall.cancelAll()}setProgress(e){return this.progress=e,this}getProgress(){return this.progress}getModels(){return this.models}getActiveModels(){return this.activeModels}addModel(e){return this.verifyModelAttributes(e),this.duration=Math.max(this.getDuration(),e.getDuration()),this.models.push(e),this}addModels(e){return n.isArray(e)||(e=[e]),n.each(e,e=>{this.addModel(e)}),this}getTimestamp(){return this.timestamp}getDuration(){return this.duration}setTimestamp(e){return this.timestamp=e,this}getId(){return this.id}resume(e=!1){const t=Date.now();this.setTimestamp(t),e||this.onTimestampReset.fire(t),this.requestFrame(this.pausedDelegate.bind(this)),this.pausedDelegate=void 0}pause(e=!1){this.setState(r.Constants.State.Animation.Paused),e||this.onPause.fire(),this.cancelFrame(),this.firstScheduleTime=void 0}stop(){this.setState(r.Constants.State.Animation.Stopped),this.onStop.fire(),this.cancelFrame(),this.firstScheduleTime=void 0,this.activeModels.length=0}done(){this.setState(r.Constants.State.Animation.Done),this.onDone.fire()}reset(e){this.isReady()||(this.cancelFrame(),this.isStopped()||this.stop(),this.setReverseState(!1),this.getModels().forEach(t=>this.resetToDefault(e,t)),this.timestamp=0,this.state=r.Constants.State.Animation.Ready,s.ObjectUtils.applyFunctionIfAble(e,"invalidate"))}resetToDefault(e,t){throw new Error("needs to be overwritten in extending classes")}isReversed(){return this.reversed}setReverseState(e){e!==this.isReversed()&&this.reverse()}reverse(){this.reversed=!this.reversed,n.each(this.getModels(),e=>{e.setReverseState(this.isReversed())}),n.each(this.getActiveModels(),e=>{e.setReverseState(this.isReversed())}),this.onReverse.fire()}verifyModelAttributes(e){l.logService.assert(e.getDuration()>=0,"animation model needs a positive duration time in seconds",r.Constants.Feature.Animations.Tweening,{model:e,animation:this})}dispose(){this.removeEvents(),this.cancelFrame(),this.setState(r.Constants.State.Animation.Stopped)}}t.Animation=d}),define("core/utilities/facades/sequence_facade",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SequenceFacade=class{constructor(e){this.sequence=e,this.onStepStart=e.onStepStart,this.onPlay=e.onPlay,this.onReverse=e.onReverse,this.onStop=e.onStop,this.onStepDone=e.onStepDone,this.onDone=e.onDone,this.onAnimationStep=e.onAnimationStep,this.onSetProgressCall=e.onSetProgressCall}resume(){this.sequence.play()}stop(){this.sequence.stop()}reverse(){this.sequence.reverse()}reset(){this.sequence.reset()}resetAndResume(){this.reset(),this.resume()}conductAnimationStep(e){this.sequence.conductAnimationStep(e)}chainSequences(e){this.sequence.chainSequences(e)}chainSequence(e){this.sequence.chainSequence(e)}unchainSequences(e){this.sequence.unchainSequences(e)}unchainSequence(e){this.sequence.unchainSequence(e)}isReversed(){return this.sequence.isReversed()}setReverseState(e){return this.sequence.setReverseState(e)}getState(){return this.sequence.getState()}getSequence(){return this.sequence}getDuration(){return this.sequence.getDuration()}getAnimations(){return this.sequence.getAnimations()}isReady(){return this.sequence.isReady()}isPlaying(){return this.sequence.isPlaying()}isDone(){return this.sequence.isDone()}isStopped(){return this.sequence.isStopped()}setProgress(e){return this.sequence.setProgress(e)}}}),define("core/graphics/animation/tween",["require","exports","math_utils","reusable_utilities","underscore","constants","style","core/models/tweening_model","core/utilities/object_cache","core/utilities/utilities","core/graphics/style_map","core/graphics/animation/animation"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tween=class extends h.Animation{constructor(e){super(e),this.id=r.Constants.Feature.Animations.Tweening}scheduleAnimation(e){super.scheduleAnimation(e);const t=Date.now();this.conductAnimationStep(e,t)||(this.getState()!==r.Constants.State.Animation.Stopped?this.requestFrame(this.scheduleAnimation.bind(this,e)):this.setState(r.Constants.State.Animation.Paused))}conductAnimationStep(e,t){super.conductAnimationStep(e,t);let i=!0;e.lastAnimation=t;const r=t-this.getTimestamp(),a=[];return n.each(this.getModels(),t=>{const s=o.isStyleKey(t.getKey());s&&a.push(t.getKey()),s&&!e.hasStyle(t.getKey())&&e.setDefaultStyle(t.getKey(),!0);const n=0===t.getDuration()?{progress:1}:{deltaTime:r},l=this.buildParams(t,e,n);t.setProgress(l.newProgress),this.tween(l),t.getProgress()<1?i=!1:this.ensureFinalState(t,e)}),a.length>0&&e.getStyleMap().fireStylesChanged(a),this.setProgress(n.reduce(this.getModels(),(e,t)=>e+t.getProgress(),0)/this.getModels().length),this.onAnimationStep.fire(t),i?(this.done(),this.isStopped()||this.stop()):this.setTimestamp(t),s.ObjectUtils.applyFunctionIfAble(e,"invalidate"),i}setAnimationProgress(e,t){super.setAnimationProgress(e,t);const i=[];n.each(this.getModels(),s=>{const n=o.isStyleKey(s.getKey());n&&i.push(s.getKey()),n&&!t.hasStyle(s.getKey())&&t.setDefaultStyle(s.getKey(),!0);const r=0===s.getDuration()?{progress:1}:{progress:e},a=this.buildParams(s,t,r);s.setProgress(a.newProgress),this.tween(a)}),i.length>0&&t.getStyleMap().fireStylesChanged(i),1===e&&(this.isPlaying()||this.isPaused())&&(this.done(),this.stop()),this.setProgress(e),this.onSetAnimationProgressCall.fire(e),s.ObjectUtils.applyFunctionIfAble(t,"invalidate")}ensureFinalState(e,t){this.tween(this.buildParams(e,t,{progress:1}))}buildParams(e,t,s){const n=void 0!==s.progress?s.progress:i.generalMathUtils.clamp(e.getProgress()+s.deltaTime/e.getDuration(),0,1),r=l.ObjectCache.TweenParamsPool.getObject();if(r.key=e.getKey(),r.value=e.getValue(),r.originalValue=e.getOriginalValue(),r.newProgress=n,o.isStyleKey(e.getKey())){if(!t.hasStyleMap||!t.setStyleMap)throw new Error(`Tweening attempted on a style key for a target that does not support StyleMaps. Target: ${t.toString()}`);t.hasStyleMap()||t.setStyleMap(new d.StyleMap),r.target=t.getStyleMap().getMap(),r.additionalTarget=t}else r.target=t;return r}buildParamsFragment(e,t){const i=l.ObjectCache.TweenParamsPool.getObject();return i.key=t,i.value=e.value[t],i.originalValue=e.originalValue[t],i.newProgress=e.newProgress,i.target=e.target[e.key],i}tween(e){n.isArray(e.value)?n.each(e.value,(t,i)=>{this.applyTransformation(this.buildParamsFragment(e,i))}):this.applyTransformation(e)}applyTransformation(e){if(s.ObjectUtils.isTweenable(e.value)){const t=e.value.getTweenableAttributes();s.ObjectUtils.applyFunctionIfAble(e.value,"onBeforeTween"),t.forEach(t=>{this.applyTransformation(this.buildParamsFragment(e,t))}),s.ObjectUtils.applyFunctionIfAble(e.value,"onAfterTween")}else n.isObject(e.value)?c.logService.error("encountered untweenable object of type "+e.value.constructor.name+". Please make it implement the Tweenable interface if you want to be able to tween it.",r.Constants.Feature.Animations.Tweening,e):o.isStyleKey(e.key)?e.additionalTarget.setStyle(e.key,i.generalMathUtils.lerp(e.originalValue,e.value,e.newProgress),!1):e.target[e.key]=i.generalMathUtils.lerp(e.originalValue,e.value,e.newProgress);l.ObjectCache.recycleObject(e)}resetToDefault(e,t){const i=this.buildParams(t,e,{progress:0});this.tween(i)}verifyModelAttributes(e){super.verifyModelAttributes(e),c.logService.assert(e instanceof a.TweeningModel,"trying to add incompatible model",r.Constants.Feature.Animations.Tweening,{model:e,animation:this}),c.logService.assertDefined(e.getKey(),r.Constants.Feature.Animations.Tweening,{model:e,animation:this}),c.logService.assertDefined(e.getValue(),r.Constants.Feature.Animations.Tweening,{model:e,animation:this})}}}),define("core/graphics/animation/sequence",["require","exports","event","constants","core/utilities/utilities","core/utilities/facades/sequence_facade","core/graphics/animation/tween","core/models/tweening_model","underscore","core/utilities/abstract_state_object","core/utilities/abstract_stage_node"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Sequence=class extends c.AbstractStateObject{constructor(e,t,s=!1,n){super(),this.onPlay=new i.Event,this.onStop=new i.Event,this.onAnimationStep=new i.Event,this.onSetProgressCall=new i.Event,this.onStepStart=new i.Event,this.onStepDone=new i.Event,this.onReverse=new i.Event,this.onDone=new i.Event,this.animations=[],this.chain=[],this.unchainQueue=[],this.subscriptions=[],this.isChainExecutionInProgress=!1,this.reversed=!1,this.duration=0,this.progress=0,void 0!==n&&(this.rounds=n,this.roundCounter=0),void 0!==s&&(this.continuous=s),this.target=e,l.isUndefined(t)||this.addAnimations(t)}removeEvents(){this.onPlay.cancelAll(),this.onStop.cancelAll(),this.onAnimationStep.cancelAll(),this.onStepStart.cancelAll(),this.onSetProgressCall.cancelAll(),this.onStepDone.cancelAll(),this.onReverse.cancelAll(),this.onDone.cancelAll(),void 0!==this.animationSub&&this.animationSub.cancel()}getProgressStep(){const e=this.getAnimations().length;return e>0?1/e:0}getProgress(){return this.progress+(this.getCurrentAnimation()&&this.getCurrentAnimation().getProgress()*this.getProgressStep()||0)}registerAnimation(e){switch(e.id){case s.Constants.Feature.Animations.Animation:throw new Error("Animation cannot be instantiated nor played. It is only a baseclass forcommon animation variables and functions");case s.Constants.Feature.Animations.Tweening:let t;e instanceof o.Tween?t=e:(t=new o.Tween,e.models.forEach(e=>e instanceof a.TweeningModel?t.addModel(e):t.addModel(new a.TweeningModel(e.key,e.value,e.duration)))),this.duration+=t.getDuration(),this.animations.push(t),this.setUpSubscription(t);break;default:throw new Error("Unknown Animation trying to be registered to sequence"+e.id)}}setUpSubscription(e){e.isSubscribedToSequence||(e.onDone.subscribe(()=>{if(this.progress+=this.getProgressStep(),this.onStepDone.fire(this.reportProgress()),this.progress<1)this.isPlaying||this.resume();else{if(this.progress=Math.min(this.progress,1),this.isContinuous()&&(this.reverse(),(l.isUndefined(this.rounds)||this.roundCounter<this.rounds)&&!this.isPlaying()))return void this.play();this.done()}}),void 0!==this.isSubscribedToChain&&e.onAnimationStep.subscribe(e=>this.executeChainedFunction("conductAnimationStep",e)),e.isSubscribedToSequence=!0)}reset(){this.isReady()||(this.isStopped()||this.stop(),this.setReverseState(!1),l.isUndefined(this.rounds)||(this.roundCounter=0),this.progress=0,this.animations.forEach(e=>e.reset(this.target)),this.setState(s.Constants.State.Animation.Ready),this.executeChainedFunction("reset"))}conductAnimationStep(e){const t=this.getCurrentAnimation();void 0!==t&&t.conductAnimationStep(this.getTarget(),e)}setAnimationTimestamp(e){const t=this.getCurrentAnimation();void 0!==t&&t.setTimestamp(e)}executeChainedFunction(e,...t){this.chain.length>0&&(this.isChainExecutionInProgress=!0,this.chain.forEach(i=>i[e].apply(i,t)),this.isChainExecutionInProgress=!1,this.unchainQueue.forEach(e=>this.unchainSequence(e)),this.unchainQueue.length=0)}chainSequences(e){l.isArray(e)?e.forEach(e=>this.chainSequence(e)):this.chainSequence(e)}chainSequence(e){this.isSubscribedToChain||(this.getAnimations().forEach(e=>{this.subscriptions.push(e.onAnimationStep.subscribe(e=>this.executeChainedFunction("conductAnimationStep",e))),this.subscriptions.push(e.onTimestampReset.subscribe(e=>this.executeChainedFunction("setAnimationTimestamp",e)))}),this.isSubscribedToChain=!0),e instanceof r.SequenceFacade?this.chain.push(e.getSequence()):this.chain.push(e)}unchainSequences(e){l.isArray(e)?e.forEach(e=>this.unchainSequences(e)):this.unchainSequence(e)}unchainSequence(e){this.isChainExecutionInProgress?this.unchainQueue.push(e):(e instanceof r.SequenceFacade&&(e=e.getSequence()),this.chain.splice(this.chain.indexOf(e),1))}addAnimations(e){l.isArray(e)?e.forEach(e=>this.registerAnimation(e)):this.registerAnimation(e)}getAnimations(){return this.animations}getDuration(){return this.duration}play(){n.logService.verbose("sequence play",s.Constants.Feature.Animations.Sequence,this),n.logService.assert(!(void 0===this.getTarget()||this.getTarget instanceof d.StageNode&&this.getTarget().isDisposed()),"you cannot run an animation on a disposed or undefined Target",s.Constants.Feature.Animations.Sequence,this);const e=this.getCurrentAnimation();void 0!==e&&(this.isPlaying()||(this.setState(s.Constants.State.Animation.Playing),this.onPlay.fire()),l.isUndefined(this.animationSub)||this.animationSub.cancel(),this.animationSub=e.onAnimationStep.subscribe(()=>this.onAnimationStep.fire()),this.startAnimation(e))}reportProgress(){const e=this.getProgressStep()*this.progress;return{stepsDone:this.isReversed()?1-e:e,total:this.animations.length,reversed:this.isReversed()}}setProgress(e){n.logService.assertValueInRange(e,0,1,s.Constants.Feature.Animations.Sequence,e);const t=this.getProgressStep();if(this.getAnimations().length>0){let i=1;if(e>this.getProgress())for(;e>this.getProgress()&&1===i;)i=e-this.progress>t?1:(e-this.progress)/t,this.getCurrentAnimation().setAnimationProgress(Math.min(1,i),this.getTarget());else if(e<this.getProgress())for(l.isUndefined(this.getCurrentAnimation())&&(this.progress=Math.max(this.progress-this.getProgressStep(),0)),i=0;e<this.getProgress()&&0===i;)i=e-this.progress*t*(1-e),this.getCurrentAnimation().setAnimationProgress(Math.max(0,i),this.getTarget()),0===i&&e<this.getProgress()&&(this.progress=Math.max(this.progress-this.getProgressStep(),0))}this.executeChainedFunction("setProgress",e),this.onSetProgressCall.fire()}startAnimation(e){this.onStepStart.fire(),this.prepareCurrentAnimation(Date.now()),e.scheduleAnimation(this.target)}prepareCurrentAnimation(e){const t=this.getCurrentAnimation();void 0!==t&&t.setTimestamp(e),this.executeChainedFunction("prepareCurrentAnimation",e)}getCurrentAnimation(){return this.hasAnimations()?this.getAnimations()[Math.floor(this.progress*this.getAnimations().length)]:void 0}hasAnimations(){return this.getAnimations().length>0}stop(){n.logService.verbose("sequence stopped",s.Constants.Feature.Animations.Sequence,this),this.setState(s.Constants.State.Animation.Stopped),this.onStop.fire(),this.animations.forEach(e=>e.stop()),this.executeChainedFunction("stop")}resume(){this.play()}isReversed(){return this.reversed}setReverseState(e){this.isReversed()!==e&&this.reverse()}reverse(){n.logService.verbose("sequence reversed",s.Constants.Feature.Animations.Sequence,this),!l.isUndefined(this.rounds)&&this.isReversed()&&this.roundCounter++;const e=this.getCurrentAnimation();!l.isUndefined(e)&&(e.isReady()||e.isPlaying()||e.isPaused())||(this.progress=Math.max(this.progress-this.getProgressStep(),0)),this.reversed=!this.reversed,this.onReverse.fire(),this.animations.forEach(e=>{e.initializeModelsIfNeeded(this.getTarget()),e.setReverseState(this.isReversed())}),this.executeChainedFunction("reverse")}isContinuous(){return this.continuous}done(){n.logService.verbose("sequence done",s.Constants.Feature.Animations.Sequence,this),l.isUndefined(this.roundCounter)||(this.roundCounter=0),this.onDone.fire(),this.setState(s.Constants.State.Animation.Done)}setContinuous(e){return this.continuous=e,this}getTarget(){return this.target}getFacade(){return new r.SequenceFacade(this)}setTarget(e){return this.target=e,this}dispose(){n.logService.verbose("sequence destroyed",s.Constants.Feature.Animations.Sequence,this),this.removeEvents(),this.setState(s.Constants.State.Animation.Stopped),this.subscriptions.forEach(e=>e.cancel()),this.animations.forEach(e=>e.dispose())}}}),define("core/entities/components/animation_component",["require","exports","log","constants","core/graphics/animation/sequence","core/graphics/animation/tween","core/models/tweening_model","core/utilities/facades/sequence_facade","core/entities/components/abstract_component","underscore","map","core/entities/entity","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class p extends l.Component{constructor(e){super(),this.sequences=new d.Map,this.activeSequences=[],this.isDisposed=!1,this.requestInProgress=!1,this.idAdditive="",this.classType=s.Constants.ComponentClasses.Animation,c.isUndefined(e)||this.setSequences(e)}setIdAdditive(e){return this.idAdditive=e,this}registerSequence(e,t,i=!1){this.hasSequenceFor(e)&&!i?this.sequences.get(e).addAnimations(t.getAnimations()):this.sequences.set(e,t),this.addEvents(t)}addEvents(e){e.onAnimationStep.subscribe(this.registerSequenceEvent.bind(this,e)),e.onPlay.subscribe(this.registerSequenceEvent.bind(this,e)),e.onStop.subscribe(this.unregisterSequenceEvent.bind(this,e)),e.onSetProgressCall.subscribe(this.requestUpdate.bind(this))}canAccessStageFacade(){return this.hasOwner()&&this.getOwner()instanceof h.Entity&&this.getOwner().hasStageFacade()}requestUpdate(){if(this.canAccessStageFacade()&&!this.requestInProgress){const e=this.getOwner().getStageFacade();this.requestInProgress=!0,u.AnimationLoop.requestAnimationFrame(()=>{this.canAccessStageFacade()&&(e.isPlaying()||e.processUpdate()),this.requestInProgress=!1})}}registerSequenceEvent(e){if(this.activeSequences.indexOf(e)<0&&(this.activeSequences.push(e),this.canAccessStageFacade())){const e=this.getOwner().getStageFacade();e.isActive||e.activate()}}unregisterSequenceEvent(e){const t=this.activeSequences.indexOf(e);if(t>=0&&(this.activeSequences.splice(t,1),0===this.activeSequences.length&&this.canAccessStageFacade())){this.getOwner().getStageFacade().isActive&&this.getOwner().getStageFacade().deActivate()}}hasSequenceFor(e){return!this.isDisposed&&!c.isUndefined(this.getSequence(e))}accessSequenceFor(e){let t=this.getSequence(e);return void 0===t&&(t=this.getSequence(e.toString())),t}unregisterSequence(e){const t=this.getSequence(e);c.isUndefined(t)||(t.isStopped()||t.stop(),t.dispose(),this.getSequences().delete(e))}setSequences(e){e.keys().forEach(t=>this.registerSequence(t,e.get(t)))}getSequence(e){if(this.hasSequences())return this.getSequences().get(e)}getSequences(){return this.isDisposed?void 0:this.sequences}hasSequences(){return!this.isDisposed&&this.getSequences().size>0}getChainBase(e){const t={},i=[];return e.forEach((e,s)=>{const n="a"+s;t[n]=0,i.push([{key:n,value:10,duration:e}])}),this.tween(t,i)}play(e){const t=new a.SequenceFacade(this.sequences.get(e));return t.resume(),t}tween(e,t,i,s=!1){if(!this.isDisposed){this.checkForOwner();let n=[];const a=[];if(c.isArray(t))t.forEach(e=>{if(c.isArray(e))e.forEach(e=>n.push(new o.TweeningModel(e.key,e.value,e.duration,e.originalValue))),a.push(new r.Tween(n)),n=[];else{const{key:t,value:i,duration:s,originalValue:r}=e;n.push(new o.TweeningModel(t,i,s,r))}}),n.length>0&&a.push(new r.Tween(n));else{const{key:e,value:i,duration:s,originalValue:n}=t;a.push(new r.Tween(new o.TweeningModel(e,i,s,n)))}return this.buildSequence(e,a,i,s)}}buildSequence(e,t,i,s=!1){if(t.length>0){const r=new n.Sequence(e,t,!1),o=r.getFacade();return void 0===i||"string"!=typeof i&&"number"!=typeof i||(i+=this.idAdditive),void 0!==i?this.registerSequence(i,r,s):this.registerSequence(o,r,s),o}}checkForOwner(){this.hasOwner()||i.logService.verbose("every component should be attached to an entity and not be used standalone. If you're not using Entities, you may use the animation Component as a standalone by setting an owner to it and manually calling the dispose function when the owner is destroyed/disposed.",s.Constants.Feature.Entities.Components.AnimationComponent)}reset(){this.isDisposed||this.getSequences().forEach(e=>e.reset())}stopAll(){this.isDisposed||this.getSequences().forEach(e=>e.stop())}destroyAll(){this.isDisposed||(this.getSequences().forEach(e=>e.dispose()),this.sequences.clear(),this.activeSequences.length=0)}clone(){return new p}dispose(){this.isDisposed||(super.dispose(),this.destroyAll(),this.isDisposed=!0)}}t.AnimationComponent=p}),define("core/graphics/stage/cameras/abstract_camera",["require","exports","core/graphics/stage/layer","settings/camera_settings","core/graphics/stage/scene","core/utilities/utilities","underscore","core/graphics/primitives/point","style","constants","core/entities/entity","core/graphics/primitives/rectangle","core/entities/components/rectangle_component","event","core/graphics/primitives/quadratic_curve","core/graphics/primitives/cubic_curve","core/entities/components/animation_component","reusable_utilities","map","core/generic_engine_interfaces","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Camera=class extends n.Scene{constructor(e,t,n=3,o=new s.CameraSettings,d=r.Utilities.getUniqueId()){super(e),this.layerAmount=n,this.layers=[],this.mouseHover=!1,this.wheelData={value:0,mouse:void 0},this.triggeredZoomFunctions=new y.Map,this.animationComponent=new _.AnimationComponent,this.gallery=new y.Map,this.onZoom=new p.Event,this.onZoomEnd=new p.Event,this.onDisabledZoom=new p.Event,this.onWheelZoom=new p.Event,this.onButtonZoom=new p.Event,this.onTriggeredZoom=new p.Event,this.zoomSubscriptions=[],this.NO_FIXED_SCALE="Camera should not use fixed scaling system. To change camera drawing Size, change it's width and height and adjust percent-based scaling.",this.DEFAULT_CONVERSION="default CoordinateConversion called on camera: "+this.id+". \nCould be an error, but what is more likely is that you didn't set ScaleSystem style to ScaleSystem.NONE.",this.setAbsolute(!0),this.getStyleMap().merge(t),this.getPresence().setCanvasStyle(t),this.id=d,this.setCameraSettings(o),this.offset=new a.Point(0,0);for(let e=0;e<=n;e++)this.layers.push(new i.Layer);this.updateCameraStyle(),this.addComponent(this.animationComponent),this.setDefaultStyle(l.Style.ScaleX),this.setDefaultStyle(l.Style.ScaleY),this.setStyle(l.Style.ScaleSystemX,c.Constants.ScaleSystem.PERCENT),this.setStyle(l.Style.ScaleSystemY,c.Constants.ScaleSystem.PERCENT)}get style(){return this.getStyleMap()}getLayerAmount(){return this.layerAmount}invalidateAll(){this.layers.forEach(e=>e.invalidate())}invalidateLayer(e){this.layers.length>0&&(o.isUndefined(e)?this.invalidateAll():(r.logService.assert(e>=0&&e<this.layers.length,"insufficient layers on camera to display caller set on LayerLevel: "+e,c.Constants.Feature.Camera,this),this.layers[e].invalidate()),this.invalid=!0)}setZoomSettings(e,t,i,s){return this.getCameraSettings().setZoomSettings({zoomFactor:e,zoomDuration:t,minZoomValue:i,maxZoomValue:s}),this}areButtonsHovering(){return o.some(this.getCameraSettings().getButtons(),e=>e.isHovering())}registerZoomTrigger(e,t,i=r.Utilities.getUniqueId()){return this.triggeredZoomFunctions.set(i,{callback:e,trigger:t}),i}unregisterZoomTrigger(e){return this.triggeredZoomFunctions.delete(e),this}addEvents(){const e=this.getStageFacade(),t=.9*e.getWidth(),i=.9*e.getHeight(),s=a.Point.zero().subtractFast(t,i),n=a.Point.zero().addFast(t,i);return this.getCameraSettings().setPanLimits({topLeft:s,bottomRight:n}),this.addButtonEvents(),this.subscriptions.push(this.getStageFacade().onMouseWheel.subscribe(e=>this.handleMouseWheelMovement(e))),this.subscriptions.push(e.onMouseDrag.subscribe(e=>this.handleStageDragAction(e))),this.subscriptions.push(this.getStageFacade().onMouseEnter.subscribe(()=>this.setMouseHoverValue(!0))),this.subscriptions.push(this.getStageFacade().onMouseLeave.subscribe(()=>this.setMouseHoverValue(!1))),this}handleMouseWheelMovement(e){let t;if(this.wheelData.mouse=e.mouse,e.e.wheelDelta)t=e.e.wheelDelta%120==-0?e.e.wheelDelta/120:e.e.wheelDelta/12;else{const i=e.e.deltaY?e.e.deltaY:e.e.detail;t=-(i%3?10*i:i/3)}this.wheelData.value*t<0?this.wheelData.value=t:this.wheelData.value+=t,this.invalidate()}handleStageDragAction(e){const t=this.getStageFacade();this.getCameraSettings().isTranslationEnabled()&&!this.isZooming()&&(t.isCursor(c.Constants.Mouse.Cursor.Move)||t.setCursor(c.Constants.Mouse.Cursor.Move),this.getOffset().translate(e.deltaX,e.deltaY),this.getCameraSettings().regulateOffset(this.getOffset(),this.getStyle(l.Style.ScaleX)),this.onTranslate.fire(this.getSession()))}getScale(){return this.getStageFacade().getSettings().getScale()}setMouseHoverValue(e){return this.mouseHover=e,this.flipFrameVisibility(),this}addButtonEvents(){const e=this.getStageFacade();this.getCameraSettings().getButtons().forEach((t,i)=>{o.isUndefined(t.getStageFacade())&&t.setStageFacade(e),this.subscriptions.push(t.onMouseEnter.subscribe(()=>{e.getCanvas().style.cursor!==c.Constants.Mouse.Cursor.Move&&(this.currentButton=t,e.getCanvas().style.cursor!==c.Constants.Mouse.Cursor.Pointer&&(e.getCanvas().style.cursor=c.Constants.Mouse.Cursor.Pointer),t.queryAllComponents(e=>{b.isDrawable(e)&&e.getStyle(l.Style.Color).darken(50)}),t.invalidate())})),this.subscriptions.push(t.onMouseMove.subscribe(()=>{e.getCanvas().style.cursor!==c.Constants.Mouse.Cursor.Move&&(e.getCanvas().style.cursor=c.Constants.Mouse.Cursor.Pointer)})),this.subscriptions.push(t.onMouseLeave.subscribe(()=>{this.currentButton===t&&(e.getCanvas().style.cursor===c.Constants.Mouse.Cursor.Pointer&&(e.getCanvas().style.cursor=c.Constants.Mouse.Cursor.Default),this.currentButton=void 0),t.queryAllComponents(e=>{b.isDrawable(e)&&e.getStyle(l.Style.Color).reverseTransformation()}),t.invalidate()})),this.subscriptions.push(t.onMouseClick.subscribe(()=>{this.buttonZoom={zoomOut:0!==i},this.invalidate()}))})}flipFrameVisibility(){if(this.hasFrame()){const e=this.mouseHover?.1:0;this.getFrame().getStyle(l.Style.BorderColor).setAlpha(e),this.invalidate()}}removeEvents(){return this.onZoom.cancelAll(),this.onZoomEnd.cancelAll(),this}getStageOrigin(){return this.stageFacade.getOrigin()}getOffset(){return this.offset}getZoom(){return this.getStyle(l.Style.ScaleX)}setOffset(e){return this.offset=e,this}translate(e,t){for(let i=0;i<this.layers.length-1;i++)this.layers[i].translate(e,t);return this}applyZoom(){if(0!==this.wheelData.value){const e=this.wheelData.value;this.getCameraSettings().isWheelZoomEnabled()?this.handleWheelZoom():this.onDisabledZoom.fire({type:c.Constants.ZoomType.Wheel,data:this.wheelData}),this.wheelData.value-=e}o.isUndefined(this.buttonZoom)||(this.getCameraSettings().isButtonZoomEnabled()?this.handleButtonZoom():this.onDisabledZoom.fire({type:c.Constants.ZoomType.Button,data:this.buttonZoom})),this.triggeredZoomFunctions.forEach(e=>{e.trigger()&&(this.getCameraSettings().isTriggeredZoomEnabled()?e.callback(this):this.handleDisabledZoom({type:c.Constants.ZoomType.Triggered,data:e}))})}handleDisabledZoom(...e){this.onDisabledZoom.fire(...e)}handleWheelZoom(){this.onWheelZoom.fire(this.wheelData);const e=this.getStyle(l.Style.ScaleX);let t=this.getCameraSettings().getZoomFactor()*Math.abs(this.wheelData.value);this.wheelData.value<0&&(t=1/t);const i=this.getCameraSettings().regulateZoom(e*t),s=this.getPositionForScale(this.wheelData.mouse,e),n=this.getPositionForScale(this.wheelData.mouse,i),o=E.ObjectCache.PointPool.getObject().addFast(n).subtractFast(s);r.logService.verbose("zoomed mousecoordinates",c.Constants.Feature.Camera,{zoom:e,newZoom:i,currentMouse:s,zoomedMouse:n,difference:o});const a=E.ObjectCache.PointPool.getObject().addFast(this.getOffset()).subtractFast(o);this.zoomTo(i,this.getCameraSettings().getZoomDuration(),a),E.ObjectCache.recycleObjects([s,n,o,a])}handleButtonZoom(e,t=this.getOffset()){this.onButtonZoom.fire(this.buttonZoom);const i=this.getStyle(l.Style.ScaleX);let s=this.getCameraSettings().getZoomFactor();this.buttonZoom.zoomOut&&(s=1/s),e=this.getCameraSettings().regulateZoom(e||i*s);const n=this.getNormalizedCenter(),o=this.getViewportPosition(n),a=this.getPositionForScale(o,i),d=this.getPositionForScale(o,e),h=E.ObjectCache.PointPool.getObject().addFast(d).subtractFast(a);t=E.ObjectCache.PointPool.getObject().addFast(t).subtractFast(h),r.logService.verbose("zoomed centercoordinates",c.Constants.Feature.Camera,{zoom:i,newZoom:e,currentCenter:a,newCenter:d,offset:t,difference:h}),this.getCameraSettings().regulateOffset(t,e),this.zoomTo(e,this.getCameraSettings().getZoomDuration(),t),E.ObjectCache.recycleObjects([n,o,a,d,h,t]),this.buttonZoom=void 0}getCameraSettings(){return this.settings}setCameraSettings(e){return this.settings=e,this}enableTranslation(){return this.getCameraSettings().enableTranslation(),this}disableTranslation(){return this.getCameraSettings().disableTranslation(),this}isTranslationEnabled(){return this.getCameraSettings().isTranslationEnabled()}enableZoom(e,t=!1){const i=this.getCameraSettings(),s=i.isButtonZoomEnabled();return i.enableZoom(e,t),this.adaptStageRelays(),!s&&i.isButtonZoomEnabled()&&this.configureButtons(),this}adaptStageRelays(){this.hasStageFacade()&&(this.getCameraSettings().isWheelZoomEnabled()?this.getStageFacade().unregisterEventRelay(c.Constants.StageEvents.MouseWheel):this.getStageFacade().registerEventRelay(c.Constants.StageEvents.MouseWheel))}disableZoom(e,t=!1){const i=this.getCameraSettings().disableZoom(e,t);return i.isButtonZoomEnabled()||i.getButtons().forEach(e=>this.removeChild(e)),this}configureButtons(){const e=this.getCameraSettings(),t=this.getWidth(),i=this.getHeight(),s=e.getButtons(),n=e.getButtonMargin();switch(e.getButtonOrigin()){case c.Constants.Origin.TOP_LEFT:s[0].setRelativeX(n),s[0].setRelativeY(n),s[1].setRelativeX(n),s[1].setRelativeY(s[0].getStyle(l.Style.Height)+n);break;case c.Constants.Origin.CENTER_TOP:s[0].setRelativeX(t/2-s[0].getStyle(l.Style.Width)),s[0].setRelativeY(n),s[1].setRelativeX(t/2),s[1].setRelativeY(n);break;case c.Constants.Origin.TOP_RIGHT:s[0].setRelativeX(t-s[0].getStyle(l.Style.Width)-n),s[0].setRelativeY(n),s[1].setRelativeX(t-s[1].getStyle(l.Style.Width)-n),s[1].setRelativeY(s[0].getStyle(l.Style.Height)+n);break;case c.Constants.Origin.CENTER_LEFT:s[0].setRelativeX(n),s[0].setRelativeY(i/2-s[0].getStyle(l.Style.Height)),s[1].setRelativeX(n),s[1].setRelativeY(i/2);break;case c.Constants.Origin.CENTER:s[0].setRelativeX(t/2-s[0].getStyle(l.Style.Width)),s[1].setRelativeX(t/2),s[0].setRelativeY((i-s[0].getStyle(l.Style.Height))/2),s[1].setRelativeY((i-s[1].getStyle(l.Style.Height))/2);break;case c.Constants.Origin.CENTER_RIGHT:s[0].setRelativeX(t-s[0].getStyle(l.Style.Width)-n),s[1].setRelativeX(t-s[1].getStyle(l.Style.Width)-n),s[0].setRelativeY(i/2-s[0].getStyle(l.Style.Height)),s[1].setRelativeY(i/2);break;case c.Constants.Origin.BOTTOM_LEFT:s[0].setRelativeX(n),s[0].setRelativeY(i-s[0].getStyle(l.Style.Height)-s[1].getStyle(l.Style.Height)-n),s[1].setRelativeX(n),s[1].setRelativeY(i-s[0].getStyle(l.Style.Height)-n);break;case c.Constants.Origin.CENTER_BOTTOM:s[0].setRelativeX(t/2-s[0].getStyle(l.Style.Width)),s[1].setRelativeX(t/2),s[0].setRelativeY(i-s[0].getStyle(l.Style.Height)-s[1].getStyle(l.Style.Height)-n),s[1].setRelativeY(i-s[0].getStyle(l.Style.Height)-n);break;case c.Constants.Origin.BOTTOM_RIGHT:s[0].setRelativeX(t-s[0].getStyle(l.Style.Width)-n),s[1].setRelativeX(t-s[1].getStyle(l.Style.Width)-n),s[0].setRelativeY(i-s[0].getStyle(l.Style.Height)-s[1].getStyle(l.Style.Height)-n),s[1].setRelativeY(i-s[0].getStyle(l.Style.Height)-n);break;default:throw new Error("Unknown OriginType; cannot complete offset calculation")}s.forEach(e=>{this.addChild(e),e.setInteractiveState(!0),e.show()})}updateCameraStyle(){this.layers.forEach(e=>{e.getCanvas().style.backgroundColor=this.hasStyle(l.Style.Color)&&this.getStyle(l.Style.Color).toHex6()||"transparent",e.getCanvas().width=this.getStyle(l.Style.Width),e.getCanvas().height=this.getStyle(l.Style.Height),e.getCanvas().style.width=this.getStyle(l.Style.Width)+"px",e.getCanvas().style.height=this.getStyle(l.Style.Height)+"px"})}cameraToWindowCoordinates(e,t){let i,s;const n=window.pageYOffset||document.documentElement.scrollTop||0,o=window.pageXOffset||document.documentElement.scrollLeft||0;switch(this.getPresence().getStyle(l.Style.ScaleSystemX)){case c.Constants.ScaleSystem.NONE:case c.Constants.ScaleSystem.PERCENT:i=e+this.getStageOrigin().getAbsoluteX(),s=t+this.getStageOrigin().getAbsoluteY();break;case c.Constants.ScaleSystem.FIXED:r.logService.warn(this.NO_FIXED_SCALE);break;default:r.logService.warn(this.DEFAULT_CONVERSION),i=e+this.getStageOrigin().getAbsoluteX(),s=t+this.getStageOrigin().getAbsoluteY()}return E.ObjectCache.PointPool.getObject().setCoordinates(i+o,s+n)}stageToCameraCoordinates(e){let t,i;const s=E.ObjectCache.PointPool.getObject().addFast(e).subtractFast(this.getOffset());switch(this.getPresence().getStyle(l.Style.ScaleSystemX)){case c.Constants.ScaleSystem.NONE:t=s.getX(),i=s.getY();break;case c.Constants.ScaleSystem.PERCENT:t=s.getX()/this.getPresence().getStyle(l.Style.ScaleX),i=s.getY()/this.getPresence().getStyle(l.Style.ScaleY);break;case c.Constants.ScaleSystem.FIXED:r.logService.warn(this.NO_FIXED_SCALE);break;default:r.logService.warn(this.DEFAULT_CONVERSION),t=s.getX(),i=s.getY()}return s.setCoordinates(t,i)}cameraToStageCoordinates(e){let t,i;switch(this.getPresence().getStyle(l.Style.ScaleSystemX)){case c.Constants.ScaleSystem.NONE:t=e.getX(),i=e.getY();break;case c.Constants.ScaleSystem.PERCENT:t=e.getX()*this.getPresence().getStyle(l.Style.ScaleX),i=e.getY()*this.getPresence().getStyle(l.Style.ScaleY);break;case c.Constants.ScaleSystem.FIXED:r.logService.warn(this.NO_FIXED_SCALE);break;default:r.logService.warn(this.DEFAULT_CONVERSION),t=e.getX(),i=e.getY()}return E.ObjectCache.PointPool.getObject().setCoordinates(t,i).addFast(this.offset)}setImageSmoothing(e){throw new Error("not Implemented")}drawImage(e){throw new Error("not Implemented")}drawRectangle(e){throw new Error(" not implemented")}drawText(e,t,i){throw new Error("not implemented")}drawLetter(e,t,i){throw new Error("not implemented")}drawLine(e,t=[]){throw new Error("not implemented")}drawCircle(e,t){throw new Error("not implemented")}drawPolygon(e,t,i=!1){throw new Error("not implemented")}setShadowBlur(e){throw new Error("not implemented")}setShadowColor(e){throw new Error("not implemented")}setLineDash(e){throw new Error("not implemented")}setBorderThickness(e){throw new Error("not implemented")}lineTo(e,t,i,s){throw new Error("not implemented")}quadraticCurveTo(e,t,i,s,n){throw new Error("not implemented")}cubicCurveTo(e,t,i,s,n,r){throw new Error("not implemented")}drawArrowHead(e,t,i,s,n){throw new Error("not implemented")}beginPath(){throw new Error("not implemented")}closePath(){throw new Error("not implemented")}save(){throw new Error("not implemented")}restore(){throw new Error("not implemented")}moveTo(e){throw new Error("not implemented")}setStrokeStyle(e){throw new Error("not implemented")}setFillStyle(e){throw new Error("not implemented")}setShadowOffset(e){throw new Error("not implemented")}clear(e){throw new Error("not implemented")}clearRectangle(e){throw new Error("not implemented")}clearCircle(e){throw new Error("not implemented")}clearPolygon(e,t){throw new Error("not implemented")}setOpacity(e){throw new Error("not implemented")}setBlendMode(e){throw new Error("not implemented")}setActiveContext(e){throw new Error("not implemented")}applyViewportToAll(e){throw new Error("not implemented")}applyViewport(e){throw new Error("not implemented")}clip(){throw new Error("not implemented")}verifyStyleChange(e){return super.verifyStyleChange(e),[l.Style.Width,l.Style.Height,l.Style.Color].indexOf(e)>=0&&this.updateCameraStyle(),this}getWidth(){return this.getStyle(l.Style.Width)}getHeight(){return this.getStyle(l.Style.Height)}setWidth(e){return this.getStyleMap().setStyleIfDifferent(l.Style.Width,e),this}setHeight(e){return this.getStyleMap().setStyleIfDifferent(l.Style.Height,e),this}subscribeToStage(){const e=this.presence.toPoint();return this.addShape(new h.Rectangle(e.getX(),e.getY(),this.getWidth(),this.getHeight())),n.Scene.prototype.subscribeToStage.call(this)}dispose(){r.Utilities.getMouse().removeCoordinateSystem(this.id),d.Entity.prototype.dispose.call(this)}getCenter(){return E.ObjectCache.PointPool.getObject().setCoordinates(this.getWidth()/2,this.getHeight()/2)}getNormalizedCenter(){return E.ObjectCache.PointPool.getObject().setCoordinates(this.getWidth()*this.getStyle(l.Style.ScaleX)/2,this.getHeight()*this.getStyle(l.Style.ScaleY)/2)}canInitiateZoom(e){return this.getStyle(l.Style.ScaleX)!==e&&void 0===this.sequenceFacade}buildZoomSequence(e,t,i){const s=[{key:l.Style.ScaleX,value:e,duration:t},{key:l.Style.ScaleY,value:e,duration:t}];return void 0!==i&&(this.translating=!0,s.push({key:"offset",value:i.clone(),duration:t})),this.zoomId=this.id+"zoom",this.animationComponent.tween(this,s,this.zoomId)}subscribeToZoomSequenceEvents(){this.zoomSubscriptions.push(this.sequenceFacade.onDone.subscribe(()=>{r.logService.verbose("new config",c.Constants.Feature.Camera,{offset:this.getOffset(),zoom:this.getStyle(l.Style.ScaleX)}),this.clearSubs(),this.onZoomEnd.fire(this.getSession())})),this.zoomSubscriptions.push(this.sequenceFacade.getAnimations()[0].onAnimationStep.subscribe(()=>{this.invalidateLayer()}))}configureZoomState(e){void 0!==this.sequenceFacade&&(this.getStyle(l.Style.ScaleX)>e&&this.zoomType===c.CameraZoomType.Increasing||this.getStyle(l.Style.ScaleX)<e&&this.zoomType===c.CameraZoomType.Decreasing)&&(this.sequenceFacade.stop(),this.clearSubs())}zoomTo(e,t=this.getCameraSettings().getZoomDuration(),i,s){if(this.configureZoomState(e),this.canInitiateZoom(e)){const n=this.buildZoomSequence(e,t,i);n.onPlay.subscribeOnce(()=>this.onZoom.fire()),this.zoomType=this.getStyle(l.Style.ScaleX)>e?c.CameraZoomType.Decreasing:c.CameraZoomType.Increasing,s||n.resume(),this.sequenceFacade=n,this.subscribeToZoomSequenceEvents()}return this}getSession(){return{offset:this.getOffset(),zoomLevelX:this.getStyle(l.Style.ScaleX),zoomLevelY:this.getStyle(l.Style.ScaleY)}}setStageFacade(e){void 0!==this.stageResizeSub&&this.stageResizeSub.cancel(),this.stageResizeSub=e.onResize.subscribe(()=>{this.layers.forEach(t=>{t.getCanvas().width=e.getCanvas().width,t.getCanvas().height=e.getCanvas().height})});const t=super.setStageFacade(e);return this.adaptStageRelays(),t}draw(e){n.Scene.prototype.update.call(this),this.applyZoom(),this.redrawIds=[],this.layers.forEach((e,t)=>{e.isInvalid()&&(this.clear(t),this.redrawIds.push(t),e.validate())}),e.draw(this);const t=this.offset,i=this.getStyle(l.Style.ScaleSystemX),s=this.getStyle(l.Style.ScaleSystemY);return this.offset=E.ObjectCache.PointPool.getObject(),this.getStyleMap().setStyleIfDifferent(l.Style.ScaleSystemX,l.getDefaultStyle(l.Style.ScaleSystemX)),this.getStyleMap().setStyleIfDifferent(l.Style.ScaleSystemY,l.getDefaultStyle(l.Style.ScaleSystemY)),d.Entity.prototype.draw.call(this,this),E.ObjectCache.recycleObject(this.offset),this.offset=t,this.getStyleMap().setStyleIfDifferent(l.Style.ScaleSystemX,i),this.getStyleMap().setStyleIfDifferent(l.Style.ScaleSystemY,s),this.layers.forEach(e=>{r.Utilities.drawImageBuffer(e.getCanvas(),this.getStageFacade().getContext(),this.getPresence().getAbsoluteX()+e.getOffset().getX(),this.getPresence().getAbsoluteY()+e.getOffset().getY(),this.getStyle(l.Style.Width),this.getStyle(l.Style.Height))}),this.redrawIds=[],this}addChild(e,t){return r.logService.assertDefined(e,c.Constants.Feature.Layer,this),e.setAbsolute(!0),n.Scene.prototype.addChild.call(this,e,t)}clearSubs(){return this.zoomSubscriptions.forEach(e=>e.cancel()),this.animationComponent.unregisterSequence(this.zoomId),this.zoomSubscriptions.length=0,this.sequenceFacade=void 0,this}isZooming(){return!o.isUndefined(this.sequenceFacade)}addFrame(e,t){r.logService.assert(o.isUndefined(this.frame),"a camera should only have one frame",c.Constants.Feature.Camera,this);const i=this.getPresence().generateChild();return i.getStyleMap().setStyleIfDifferent(l.Style.Width,this.getWidth()).setStyleIfDifferent(l.Style.Height,this.getHeight()).setStyleIfDifferent(l.Style.StrokeAlignment,c.Constants.StrokeAlignment.Inside).setStyleIfDifferent(l.Style.BorderColor,t||f.Color.BLACK(0)).setStyleIfDifferent(l.Style.BorderThickness,e||2),this.frame=new u.RectangleComponent(i),this.addComponent(this.frame)}getFrame(){return this.frame}hasFrame(){return!o.isUndefined(this.frame)}getShapeForCamera(e,t=!1){const i=r.Utilities.computeDrawSettings(e.getCoordinates(),this.getStyleMap(),this.offset);let s,n,o,l,d;switch(e.getType()){case c.Constants.Shape.Rectangle:let h=e.getWidth(),u=e.getHeight();t||(h=r.Utilities.computeScaledLength(h,this.getStyleMap(),!0),u=r.Utilities.computeScaledLength(u,this.getStyleMap(),!0));const p=E.ObjectCache.RectanglePool.getObject();p.setCoordinates(i.x,i.y).setWidth(h).setHeight(u),d=p;break;case c.Constants.Shape.Circle:s=e.getRadius(),n=e.getDepth(),t||(s=r.Utilities.computeScaledLength(s,this.getStyleMap(),!0),n=r.Utilities.computeScaledLength(n,this.getStyleMap(),!0));const _=E.ObjectCache.CirclePool.getObject();_.setCoordinates(i.x,i.y).setRadius(s).setDepth(n).setShallow(e.isShallow()),d=_;break;case c.Constants.Shape.CircleSegment:s=e.getRadius(),n=e.getDepth(),t||(s=r.Utilities.computeScaledLength(s,this.getStyleMap(),!0),n=r.Utilities.computeScaledLength(n,this.getStyleMap(),!0));const f=E.ObjectCache.CircleSegmentPool.getObject();f.setCoordinates(i.x,i.y).setRadius(s).setSourceAngle(e.getSourceAngle()).setEndAngle(e.getEndAngle()).setDepth(n),d=f;break;case c.Constants.Shape.Line:o=r.Utilities.computeDrawSettings(e.getDestination(),this.getStyleMap(),this.offset);const y=E.ObjectCache.LinePool.getObject();y.setCoordinates(i.x,i.y).setProximityTolerance(e.getProximityTolerance()).setDestinationCoordinates(o.x,o.y),d=y,E.ObjectCache.recycleObject(o);break;case c.Constants.Shape.QuadraticCurve:l=r.Utilities.computeDrawSettings(e.getControl(),this.getStyleMap(),this.offset),o=r.Utilities.computeDrawSettings(e.getDestination(),this.getStyleMap(),this.offset),(d=new g.QuadraticCurve(i.x,i.y,l.x,l.y,o.x,o.y)).setProximityTolerance(e.getProximityTolerance()),E.ObjectCache.recycleObject(o),E.ObjectCache.recycleObject(l);break;case c.Constants.Shape.CubicCurve:l=r.Utilities.computeDrawSettings(e.getControl(),this.getStyleMap(),this.offset);const b=r.Utilities.computeDrawSettings(e.getSecondaryControl(),this.getStyleMap(),this.offset);o=r.Utilities.computeDrawSettings(e.getDestination(),this.getStyleMap(),this.offset),(d=new m.CubicCurve(i.x,i.y,l.x,l.y,b.x,b.y,o.x,o.y)).setProximityTolerance(e.getProximityTolerance()),E.ObjectCache.recycleObject(o),E.ObjectCache.recycleObject(l),E.ObjectCache.recycleObject(b);break;case c.Constants.Shape.Polygon:const S=E.ObjectCache.PolygonPool.getObject().setCoordinates(i.x,i.y);e.getPoints().forEach(e=>{const t=r.Utilities.computeDrawPoint(e,this.getStyleMap(),this.offset);S.addPoint(a.Point.zero().addFast(t)),E.ObjectCache.recycleObject(t)}),d=S;break;default:throw new Error("Shape Unknown")}return E.ObjectCache.recycleObject(i),d}getPositionForScale(e,t,i=t){const s=r.Utilities.computeDrawSettings(e,this.getStyleMap(),this.offset,t,i),n=E.ObjectCache.PointPool.getObject().setCoordinates(s.x,s.y);return E.ObjectCache.recycleObject(s),n}getScaledPosition(e){const t=E.ObjectCache.PointPool.getObject().addFast(e),i=t.getX()*this.getStyle(l.Style.ScaleX)+this.getOffset().getX(),s=t.getY()*this.getStyle(l.Style.ScaleY)+this.getOffset().getY();return t.setCoordinates(i,s)}getUnscaledPosition(e){const t=E.ObjectCache.PointPool.getObject().addFast(e),i=t.getX()/this.getStyle(l.Style.ScaleX),s=t.getY()/this.getStyle(l.Style.ScaleY);return t.setCoordinates(i,s)}getViewportPosition(e){const t=E.ObjectCache.PointPool.getObject().setCoordinates(e.getX()/this.getStyle(l.Style.ScaleX),e.getY()/this.getStyle(l.Style.ScaleY)).subtractFast(this.getOffset()),i=this.getUnscaledPosition(t);return E.ObjectCache.recycleObject(t),i}}}),define("core/entities/entity",["require","exports","constants","style","core/graphics/primitives/rectangle","core/utilities/abstract_stage_node","core/utilities/presence","core/utilities/utilities","core/entities/components/abstract_presence_component","underscore","reusable_utilities","core/generic_engine_interfaces","map","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class g extends r.StageNode{constructor(e,t=[],i){super(e,i),this.children=[],this.components=new u.Map,c.each(t,this.addComponent,this)}static zero(){return new g(o.Presence.zeroTopLeft())}setAbsolute(e){return this.queryAllComponents(t=>{t instanceof l.PresenceComponent&&t.setAbsolute(e)}),this.children.length>0&&c.each(this.children,function(t){t.setAbsolute(e)}),super.setAbsolute(e),this}addComponent(e){const t=e.getClassType();this.components.has(t)||this.components.set(t,[]);const i=this.components.get(t);return i.indexOf(e)<0&&i.push(e),e instanceof l.PresenceComponent&&(e.hasStyle(s.Style.Opacity)||e.setStyle(s.Style.Opacity,this),this.hasStageFacade()&&e.setStageFacade(this.getStageFacade())),e.attach(this),this}addComponents(e){return c.each(e,e=>{this.addComponent(e)}),this}removeComponent(e,t=!1){const i=e.getClassType();if(this.components.has(i)){const t=this.components.get(i).indexOf(e);t>=0&&this.components.get(i).splice(t,1)}return d.ObjectUtils.applyFunctionIfAble(e,"unattach"),e instanceof l.PresenceComponent&&e.getStyleMap().getRawStyle(s.Style.Opacity)===this.getStyleMap()&&e.setDefaultStyle(s.Style.Opacity),t&&e.dispose(),this}getFirstComponentOf(e){return this.getAllComponentsOf(e)[0]}getAllComponentsOf(e){return this.components.has(e)?this.components.get(e):[]}setStyle(e,t,i=!0){super.setStyle(e,t,i);const s=e=>d.ObjectUtils.applyFunctionIfAble(e,"invalidate");return this.queryAllComponents(s),this.queryChildTree(s,t=>!c.isUndefined(t.getStyle(e))),this}addChild(e,t){return a.logService.assert(!e.hasParent(),"Entity already has a parent.",i.Constants.Feature.Entities.Entity,e),e.attach(this),e.hasStyle(s.Style.Opacity)||e.setStyle(s.Style.Opacity,this),void 0!==t?this.getChildren().splice(t,0,e):this.getChildren().push(e),this.invalidate(),this}hasChildren(){return this.children.length>0}getComponentSumSurroundingRect(e=!1){let t;return this.queryAllComponents(i=>{i instanceof l.PresenceComponent&&(void 0===t?t=i.getBoundingBox(e,!0):t.mergeShape(i.getBoundingBox(e,!0)))}),void 0===t&&(t=p.ObjectCache.RectanglePool.getObject()),t}getComponentSumBoundingBox(e=!1){let t;return this.queryAllComponents(i=>{i instanceof l.PresenceComponent&&(void 0===t?t=i.getBoundingBox(e):t.mergeShape(i.getBoundingBox(e)))}),void 0===t&&(t=p.ObjectCache.RectanglePool.getObject()),t}getChildrenSumBoundingBox(e=!1){let t=n.Rectangle.zero();return this.queryChildTree(i=>{void 0===t?t=i.getComponentSumBoundingBox(e):t.mergeShape(i.getComponentSumBoundingBox(e))}),void 0===t&&(t=n.Rectangle.zero()),t}getFullBoundingBox(e=!1){let t=this.getChildrenSumBoundingBox(e);return t.isEqualTo(n.Rectangle.zero())?t=this.getComponentSumBoundingBox(e):t.mergeShape(this.getComponentSumBoundingBox(e)),t}clearChildren(){c.each(this.children,function(e){e.unattach()},this),this.children.length=0}removeChildren(e){e.forEach(e=>this.removeChild(e))}removeChild(e){const t=c.indexOf(this.getChildren(),e);if(t>=0)return e.unattach(),this.invalidate(),this.getChildren().splice(t,1)[0]}queryAllComponents(e,t,i){void 0!==t?this.queryComponents(e,this.getAllComponentsOf(t),i):this.components.forEach(t=>{this.queryComponents(e,t,i)})}queryComponents(e,t,i=!1){if(i)for(let i=t.length-1;i>=0;i--)e(t[i]);else t.forEach(t=>{e(t)})}clone(){const e=Object.create(Object.getPrototypeOf(this));return e.constructor=this.constructor,c.each(c.keys(this),t=>{"parent"!==t&&"children"!==t&&"configuration"!==t&&(c.isArray(this[t])?e[t]=a.Utilities.cloneArray(this[t]):e[t]=!c.isUndefined(this[t])&&this[t].clone&&this[t].clone()||this[t])}),c.each(this.getShapes(),t=>{e.addShape(t.clone())}),this.queryAllComponents(t=>{e.addComponent(t.clone())}),this.getChildren().length>0&&(e.children=[],c.each(this.getChildren(),t=>{e.addChild(t.clone())})),e}getComponents(){return this.components}clearComponents(){return this.queryAllComponents(e=>{this.removeComponent(e,!0)}),this.components.clear(),this}update(){this.updateChildren(),this.updateAllComponents(),super.update()}updateAllComponents(){this.queryAllComponents(e=>e.update(),void 0,!0)}updateChildren(){c.each(this.children,e=>{e.update()})}draw(e){this.isHidden()||void 0===this.getStyleMap()||(this.queryAllComponents(t=>{h.isDrawable(t)&&this.drawComponent(t,e)}),this.getChildren().length>0&&c.each(this.getChildren(),function(t){t.draw(e)}),e.redrawIds.indexOf(this.getStyle(s.Style.Layer))>-1&&this.getPresence().draw(e))}drawComponent(e,t){return!this.isHidden()&&e.getStyle&&t.redrawIds.indexOf(e.getStyle(s.Style.Layer))>-1&&(e.draw(t),e.getPresence&&e.getPresence().draw(t)),this}getChildren(){return this.children}getChildArray(){const e=[];return e.push.apply(e,this.getChildren()),c.each(this.getChildren(),t=>{e.push.apply(e,t.getChildArray())}),e}containsPoint(e,t){let i=!1;return this.isHidden()||(i=this.getPresence().containsPoint(e,t),this.queryAllComponents(s=>{h.isDrawable(s)&&(i=i||s.containsPoint(e,t))})),i}queryChildTree(e,t){return c.each(this.getChildren(),i=>{e(i),(c.isUndefined(t)||c.isFunction(t)&&!t(i)||!t)&&i.getChildren().length>0&&i.queryChildTree(e,t)}),this}dispose(){super.dispose(),c.each(this.children,e=>{e.dispose()}),this.clearComponents()}}t.Entity=g}),define("core/graphics/style_map",["require","exports","underscore","style","core/utilities/utilities","event","core/utilities/abstract_stage_node"],function(e,t,i,s,n,r,o){"use strict";let a;Object.defineProperty(t,"__esModule",{value:!0});class l extends r.EventEmitter{constructor(){super(),this.id=n.Utilities.getUniqueId(),this.style={},this.disposed=!1,this.numStyleValues=0,void 0===a&&(a=[s.Style.Radius,s.Style.SourceAngle,s.Style.EndAngle,s.Style.Depth,s.Style.Width,s.Style.Height,s.Style.Color])}clear(){return this.style={},this}fireStylesChanged(e,t=!0){return t&&(e=e.filter(e=>this.canValidateStyle(e))),this.emitEvent("style_changed",e),this}setStyleIfNotSet(e,t){return this.hasStyle(e)||this.setStyle(e,t),this}canValidateStyle(e){return a.indexOf(e)>-1}fireSingleChange(e){return this.canValidateStyle(e)?this.fireStylesChanged([e],!1):this.fireStylesChanged([],!1),this}handleExternalStyleValue(e){return e instanceof o.StageNode?e.getPresence().getStyleMap():e}setStyleValue(e,t){return t=this.handleExternalStyleValue(t),this.style[e]instanceof l&&this.numStyleValues--,this.style[e]=t,t instanceof l&&this.numStyleValues++,this}setStyleIfDifferent(e,t,i=!0){return this.hasStyle(e)&&this.compareStyles(this.style[e],t)||this.setStyle(e,t,i),this}setStyle(e,t,i=!0){return this.setStyleValue(e,t),i&&this.fireSingleChange(e),this}evaluateStyle(e,t){return i.isFunction(e)?this.hasParent()?e(this.getParent().getStyle(t)):e(s.getDefaultStyle(t)):e instanceof l?e.isDisposed()?(this.resetStyle(t,!1),s.getDefaultStyle(t)):e.getStyle(t):e}getRawStyle(e){return this.style[e]}getStyle(e){return this.hasStyle(e)?this.evaluateStyle(this.style[e],e):s.getDefaultStyle(e)}getMap(){let e=i.extend({},this.style);return this.numStyleValues>0&&(e=i.mapObject(e,(e,t)=>e instanceof l?e.getStyle(t):e)),e}getId(){return this.id}initializeKey(e){return void 0===this.style[e]&&this.setDefaultStyle(e),this}debugDumpStyle(){return this.parseObjectRecursively(this.style)}parseObjectRecursively(e,t={},s){for(const r in e){const o=e[r],a=void 0!==s?`${s}.${r}`:r;o instanceof l||i.isFunction(o)?this.assignValueToKey(t,a,n.Utilities.simplify(this.evaluateStyle(o,r))):this.assignValueToKey(t,a,o)}return t}assignValueToKey(e,t,s){i.isObject(s)?i.isFunction(s.toJson)?this.parseObjectRecursively(s.toJson(),e,t):e[t]=s.constructor.name:e[t]=s}setDefaultStyle(e){return this.style[e]=s.getDefaultStyle(e),this.fireSingleChange(e),this}compareStyles(e,t){return i.isObject(e)?!!Object.getPrototypeOf(e).isPrototypeOf(t)&&("function"==typeof e.compareTo?e.compareTo(t):i.isEqual(e,t)):i.isArray(e)?!i.some(e,(e,i)=>e!==t[i]):t===e}isDefault(e,t){const i=s.getDefaultStyle(e,!0);return void 0===t&&(t=this.style[e]),this.compareStyles(t,i)}attach(e){return this.owner=e,this.owner.attachStyleMap(this),this}clearOwner(){return this.owner=void 0,this}detach(){return this.owner.detachStyleMap(),this}clearParent(){return this.parent=void 0,this}setParent(e){return this.parent!==e&&(this.clearParent(),this.parent=e,this.merge(e)),this}resetAllStyles(){return this.getKeys().forEach(e=>this.resetStyle(e)),this}resetStyle(e,t=!0){return this.style[e]instanceof l&&this.numStyleValues--,delete this.style[e],t&&this.fireSingleChange(e),this}getOwner(){return this.owner}getKeys(){return Object.keys(this.style)}hasOwner(){return void 0!==this.owner}hasParent(){return void 0!==this.parent}getParent(){return this.parent}isFunctionStyle(e){return i.isFunction(this.style[e])}hasOwnStyle(e){return this.hasStyle(e)&&!(this.style[e]instanceof l)}hasAnyStyle(e){return e.some(e=>this.hasStyle(e))}hasAllStyles(e){for(const t of e)if(!this.hasStyle(t))return!1;return!0}hasStyle(e){return void 0!==this.style[e]}linkStyles(e,t){return i.each(e,e=>{t.hasStyle(e)&&this.setStyle(e,t)}),this}mergeStyles(e,t,n=!1,r=!0){const o=[];return i.each(e,e=>{if(n||s.isMergableStyle(e)&&!this.hasStyle(e)){const i=t.getStyle(e);"function"!=typeof i.clone||i instanceof l?this.setStyle(e,i,!1):this.setStyle(e,i.clone(),!1),this.canValidateStyle(e)&&o.push(e)}}),r&&this.fireStylesChanged(o,!1),this}merge(e,t=!1){return this.mergeStyles(e.getKeys(),e,t)}clone(){const e=new l;return e.merge(this,!0),e}isDisposed(){return this.disposed}dispose(){this.disposed=!0,this.hasParent()&&this.clearParent(),this.hasOwner()&&this.detach()}}t.StyleMap=l}),define("core/utilities/utilities",["require","exports","log","underscore","reusable_utilities","core/graphics/primitives/point","style","constants","core/graphics/font","core/utilities/mouse_service","math_utils","core/utilities/object_cache","core/utilities/identityChecks"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logService=new i.Log({showDeprecationWarnings:!0,globalLogLevel:4,traceAll:!0});class p{static areFontsReady(){return p.fontsReady||p.checkIfFontsAreLoaded(),p.fontsReady}static resolveStringSum(...e){let t="";return s(e).each(e=>{t+=e.replace(/\\?'/g,"\\'").replace(/\\?"/g,'\\"')}),t}static init(){return Object.keys(p.baseFontMetrics).length<1&&p.initFonts(),p}static initFonts(e){Object.keys(p.baseFontMetrics).length<1&&p.initBaseFontMetrics();const t=p.getEngineFonts();void 0!==e?(s.isArray(e)||(e=[e]),s.each(e,e=>{t.indexOf(e)<0&&p.customFonts.push(e)})):e=t;const i=[];return s.each(e,e=>{const t=document.createElement("div");switch(t.style.fontFamily=e,e){case a.Constants.Font.Family.FontAwesome:t.innerHTML=p.buildCharRangeString(61200,62224);break;case a.Constants.Font.Family.TwAwesome:t.innerHTML=p.buildCharRangeString(58800,60200);break;default:t.innerHTML=p.buildDefaultCharString()}t.style.visibility="hidden",p.body.appendChild(t),i.push(t)}),s.each(i,e=>{p.body.removeChild(e)}),p.checkIfFontsAreLoaded()}static getMouse(){return void 0===p.mouse&&(p.mouse=new c.Mouse),p.mouse}static buildCustomSubscriptionFacade(e=(()=>s.noop),t=(()=>s.noop),i=(()=>s.noop)){return{cancel:e,mute:t,unmute:i}}static getEngineFonts(){return s(Object.keys(a.Constants.Font.Family)).map(e=>a.Constants.Font.Family[e])}static initBaseFontMetrics(){p.span.style.fontSize="72px",p.span.innerHTML=p.buildDefaultCharString(),s(p.baseFonts).each(e=>{p.span.style.fontFamily=e,p.span.style.fontFamily=e,p.body.appendChild(p.span),p.baseFontMetrics[e]={width:p.span.offsetWidth,height:p.span.offsetHeight},p.body.removeChild(p.span)})}static buildDefaultCharString(){return'abcdefghijklmnopqrstuvwxyz0123456789/*-+ABCDEFGHIJKLMNOPQRSTUVWXYZ!"$%&()=?.,:;-_#\\~`{[]}<>|^'}static buildCharRangeString(e,t){let i="";return s.each(s.range(e,t),e=>{i+=String.fromCharCode(e)}),i}static waitUntilFontsAreLoaded(){return new Promise((e,i)=>{const s=setTimeout(()=>{p.fontsReady=!0,t.logService.warn("FontLoading timed out. Not all requested Fonts were loaded.\n"+JSON.stringify(p.fontMetrics),a.Constants.Feature.Utilities.Utilities,p.fontMetrics),e()},p.FONT_LOADING_TIMEOUT),r=()=>{p.areFontsReady()?(clearTimeout(s),e()):n.AnimationLoop.requestAnimationFrame(r)};r()})}static checkIfFontsAreLoaded(){if(p.fontsReady)return!0;const e=p.getEngineFonts().concat(p.customFonts);let t=!0;return s.each(e,e=>{t=t&&p.isFontLoaded(e)}),p.fontsReady=t,t}static isFontLoaded(e){if(p.fontMetrics[e]&&p.fontMetrics[e].loaded)return!0;let t=!1;return s.each(p.baseFonts,i=>{p.span.style.fontFamily=e+","+i,p.body.appendChild(p.span);const s=p.span.offsetWidth!==p.baseFontMetrics[i].width||p.span.offsetHeight!==p.baseFontMetrics[i].height;p.fontMetrics[e]=s?{width:p.span.offsetWidth,height:p.span.offsetHeight,loaded:!0}:{loaded:!1},p.body.removeChild(p.span),t=t||s}),t}static simplify(e,...t){return s.isFunction(e)?e(...t):e}static toRadians(e){return d.trigonometryUtils.degreesToRadians(e)}static clamp(e,t,i){return d.generalMathUtils.clamp(e,t,i)}static getUniqueId(){return p.baseUuid++}static getUuid(){return p.randomGenerator.nextUuid()}static formatNumber(e){return n.StringUtils.formatNumber(e)}static formatNumberValue(e,t){return t.indexOf(".")>t.indexOf(",")?e.toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(","):e.toString().split(/(?=(?:\d{3})+(?:,|$))/g).join(".")}static cloneArray(e){const i=e.slice();return i.forEach((e,n)=>{s.isUndefined(e)||(s.isArray(e)?i[n]=p.cloneArray(e):p.isCloneable(e)?i[n]=e.clone():(p.isPrimitive(e)||t.logService.warn("creating shallow copy of "+e.constructor+" because no clone method was found",a.Constants.Feature.Utilities.Utilities,e),i[n]=e))}),i}static rotatePoint(e,t,i){const s=-p.toRadians(t),n=e.getX(),r=e.getY(),o=i.getX(),a=i.getY(),l=Math.cos(s)*(n-o)-Math.sin(s)*(r-a)+o,c=Math.sin(s)*(n-o)+Math.cos(s)*(r-a)+a;return e.setCoordinates(Math.round(l),Math.round(c))}static applyMatrixTransformations(e,t,i,s){if(!e.hasAnyStyle([o.Style.RotationAngle,o.Style.RotationPoint]))return t;const n=h.ObjectCache.PointPool.getObject();if(e.hasStyle(o.Style.RotationPoint))n.merge(e.getStyle(o.Style.RotationPoint));else if(e.hasStyle(o.Style.RotationOrigin)){const t=h.ObjectCache.OriginPool.getObject().setType(e.getStyle(o.Style.RotationOrigin));n.merge(e.updateOrigin(void 0,i,s,t)).addFast(i,s),h.ObjectCache.OriginPool.recycleObject(t)}return this.rotatePoint(t,e.getStyle(o.Style.RotationAngle),n),h.ObjectCache.PointPool.recycleObject(n),t}static getMinMaxCoords(e){let t,i,n,r;return s.each(e,e=>{(void 0===t||e.getX()>t)&&(t=e.getX()),(void 0===n||e.getY()>n)&&(n=e.getY()),(void 0===i||e.getX()<i)&&(i=e.getX()),(void 0===r||e.getY()<r)&&(r=e.getY())}),{maxX:t,minX:i,maxY:n,minY:r}}static rotatePoints(e,t,i,s,n=!0){return e.map(e=>{const r=this.applyMatrixTransformations(t,n?e.subtractFast(t):e,i,s);return n&&r.addFast(t),r})}static computeDrawPoint(e,t,i,s=t.getStyle(o.Style.ScaleX)||1,n=t.getStyle(o.Style.ScaleY)||1){const a=h.ObjectCache.PointPool.getObject();if(e instanceof r.Point)a.translate(e.getX()*s+i.getX(),e.getY()*n+i.getY());else if(e.getStyleMap().hasStyle(o.Style.RotationAngle)){const r=p.computeDrawSettings(e,t,i,s,n);a.translate(r.x,r.y),h.ObjectCache.DrawSettingsPool.recycleObject(r)}else e.isAbsolute()?a.translate(e.getAbsoluteX(),e.getAbsoluteY()):a.translate(e.getAbsoluteX()*s+i.getX(),e.getAbsoluteY()*n+i.getY());return a}static computeDrawSettings(e,i,s,n=i.getStyle(o.Style.ScaleX)||1,l=i.getStyle(o.Style.ScaleY)||1,c=!1,d=!1){const u=h.ObjectCache.DrawSettingsPool.getObject();if(n=n||i.getStyle(o.Style.ScaleX)||1,l=l||i.getStyle(o.Style.ScaleY)||1,t.logService.assert(i.getStyle(o.Style.ScaleSystemX)!==a.Constants.ScaleSystem.FIXED),t.logService.assert(i.getStyle(o.Style.ScaleSystemY)!==a.Constants.ScaleSystem.FIXED),e instanceof r.Point)u.setCoordinates(e.getX()*n+s.getX(),e.getY()*l+s.getY(),c);else{const t=e.getStyleMap();if(e.isAbsolute()?d?u.setCoordinates(e.getRelativeX(),e.getRelativeY(),c):u.setCoordinates(e.getAbsoluteX(),e.getAbsoluteY(),c):d?u.setCoordinates(e.getRelativeX()*n+s.getX(),e.getRelativeY()*l+s.getY(),c):u.setCoordinates(e.getAbsoluteX()*n+s.getX(),e.getAbsoluteY()*l+s.getY(),c),t.hasStyle(o.Style.RotationAngle)){const i=h.ObjectCache.OriginPool.getObject().setType(t.getStyle(o.Style.RotationOrigin));e.updateOrigin(n,void 0,void 0,i),t.setStyle(o.Style.RotationPoint,e.toPoint().subtractFast(i)),u.setCoordinates(i.getX(),i.getY(),c),h.ObjectCache.OriginPool.recycleObject(i)}u.setStyleMap(t)}return u}static computeScaledLength(e,t,i=!1){const s=i?o.Style.ScaleSystemX:o.Style.ScaleSystemY,n=i?o.Style.ScaleX:o.Style.ScaleY;switch(t.getStyle(s)){case a.Constants.ScaleSystem.FIXED:e=t.getStyle(n)||e;break;case a.Constants.ScaleSystem.PERCENT:e*=t.getStyle(n)||1}return e}static lerp(e,t,i){return(1-i)*e+i*t}static drawImageBuffer(e,t,i,s,n,r){const o=t.canvas;0!==o.width&&0!==o.height&&0!==e.width&&0!==e.height&&t.drawImage(e,i,s,n,r)}static measureText(e,t=new l.Font,i=1){t instanceof l.Font||(t=t.getStyle(o.Style.Font));const s=t.getSize(),n=h.ObjectCache.TextMetricsObjectPool.getObject().setValues(p.measureTextMemoized(e,t.build(),s),s);return n.multiply(1/i),n}static measureTextMemoized(e,t,i){return p.ctx.font=t,p.ctx.measureText(e).width}static isArabic(e){return/[\u0600-\u06FF\u0750-\u077F\uFB50-\uFC3F\uFE70-\uFEFC]/.test(e)}static isClientIE(){if(void 0!==p.ieClient)return p.ieClient;const e=window.navigator.userAgent;if(p.ua!==e){p.ua=e,p.vn=0;const t=e.indexOf("MSIE ");if(t>0&&(p.vn=parseInt(e.substring(t+5,e.indexOf(".",t)),10)),e.indexOf("Trident/")>0){const t=e.indexOf("rv:");p.vn=parseInt(e.substring(t+3,e.indexOf(".",t)),10)}const i=e.indexOf("Edge/");i>0&&(p.vn=parseInt(e.substring(i+5,e.indexOf(".",i)),10))}return p.ieClient=0!==p.vn,p.ieClient}static isClientFF(){if(void 0!==p.ffClient)return p.ffClient;const e=window.navigator.userAgent;if(p.ua!==e){p.ua=e,p.vn=0,e.indexOf("Firefox")>0&&(p.ffClient=!0)}return p.ffClient}static clear(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}static mathSign(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}static assertArrayLengthMatch(e,i,s=a.Constants.Feature.Utilities.Utilities){t.logService.assert(e.length===i.length,"length mismatch between original and targeted value arrays",s,{value:e,comparer:i})}static assertTypeIdentity(e,i,s=a.Constants.Feature.Utilities.Utilities){let n;n=p.isPrimitive(e)||p.isPrimitive(i)?p.isPrimitive(e)&&p.isPrimitive(i)&&typeof e==typeof i:u.isPresence(e)||e instanceof r.Point?u.isPresence(e)||i instanceof r.Point:Object.getPrototypeOf(e)===Object.getPrototypeOf(i),t.logService.assert(n,"type mismatch between original and targeted values",s,{value:e,other:i})}static hasComparator(e,t){return s.isFunction(e[t])}static isPresent(e){return void 0!==e&&!s.isNull(e)}static isCloneable(e){return p.isPresent(e)&&s.isFunction(e.clone)}static isPrimitive(e){return typeof e==typeof!1||"number"==typeof e||"string"==typeof e||s.isNull(e)||void 0===e||s.isFunction(e)}static compareValues(e,t,i){let n;if(typeof e!=typeof t)return!1;if(s.isArray(e))n=s.isArray(t),p.assertArrayLengthMatch(e,t),n=e.reduce((e,s,n)=>e&&p.compareValues(s,t[n],i),n);else{if(p.hasComparator(e,i))return e[i](t);if(s.isObject(e)&&e.constructor.name!==t.constructor.name)return!1;switch(i){case a.Constants.Comparators.Equal:n=e===t;break;case a.Constants.Comparators.Bigger:n=e>t;break;case a.Constants.Comparators.BiggerOrEqual:n=e>=t;break;case a.Constants.Comparators.Smaller:n=e<t;break;case a.Constants.Comparators.SmallerOrEqual:n=e<=t;break;default:throw new Error("operation not yet supported by this function, but you're welcome to add it")}}return n}static compareValuesFast(e,t,i){if(typeof e!=typeof t)return!1;if(s.isObject(e)&&e.constructor.name!==t.constructor.name)return!1;if(s.isArray(e))return s.isArray(t)&&e.reduce((e,s,n)=>e&&p.compareValuesFast(s,t[n],i),!0);if(p.hasComparator(e,i))return e[i](t);switch(i){case a.Constants.Comparators.Equal:return e===t;case a.Constants.Comparators.Bigger:return e>t;case a.Constants.Comparators.BiggerOrEqual:return e>=t;case a.Constants.Comparators.Smaller:return e<t;case a.Constants.Comparators.SmallerOrEqual:return e<=t;default:return!1}}static compareToMultipleSingleMatch(e,t,i,s=!1){return p.compareToMultiple(e,t,i,s)}static compareToMultipleAllMatch(e,t,i,s=!1){return p.compareToMultiple(e,t,i,s,!0)}static compareToMultiple(e,t,i,s=!1,n=!1){return s?t.map(t=>p.compareValues(e,t,i)):n?t.reduce((t,s)=>p.compareValues(e,s,i)&&t,!0):t.reduce((t,s)=>p.compareValues(e,s,i)||t,!1)}static getDistance(e,t){return Math.sqrt(Math.pow(e.getX()-t.getX(),2)+Math.pow(e.getY()-t.getY(),2))}}p.canvas=document.createElement("canvas"),p.ctx=p.canvas.getContext("2d"),p.span=document.createElement("span"),p.body=document.getElementsByTagName("body")[0],p.baseFonts=["monospace","sans-serif","serif"],p.customFonts=[],p.ieClient=void 0,p.ffClient=void 0,p.ua=void 0,p.vn=0,p.baseFontMetrics={},p.fontMetrics={},p.fontsReady=!1,p.baseUuid=0,p.randomGenerator=new d.SeededRandomGenerator(4523),p.FONT_LOADING_TIMEOUT=1e4,p.DEFAULT_LOADING_TIMEOUT=3e3,p.AVERAGE_LOADING_TIMEOUT=1500,p.SHORT_LOADING_TIMEOUT=500,p.ARABIC_ADAPTATION_VALUE=.8,__decorate([n.memoize((e,t,i)=>`${e}|${t}|${i}`),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String,Number]),__metadata("design:returntype",Number)],p,"measureTextMemoized",null),t.Utilities=p}),define("core/utilities/dimension",["require","exports","core/utilities/utilities","constants","style","reusable_utilities","underscore","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l{constructor(e){this.considerScale=!0,this.shapes=[],this.width=0,this.height=0,this.presence=e,this.topLeft=e.generateChild(!0),this.bottomRight=e.generateChild(!0)}addShape(e){return this.updateDimensions(e),this.shapes.push(e),this}addShapes(e){return e.forEach(e=>this.addShape(e)),this}substractShape(e){return o.isUndefined(this.holes)&&(this.holes=new l(this.presence)),this.holes.addShape(e),this}reset(){return this.shapes=[],this.topLeft.resetCoordinates(),this.bottomRight.resetCoordinates(),this}resetAndClean(){return this.reset(),this.presence.reset(),this.presence.setDimension(this),this}translate(e,t){return this.topLeft.translate(e,t),this.bottomRight.translate(e,t),this}clearShapes(){return this.shapes=[],this}clearHoles(){return o.isUndefined(this.holes)||this.holes.clearShapes(),this}draw(e){return this.shapes.forEach(t=>{const n=this.presence.generateChild();switch(n.setStyleMap(this.presence.getStyleMap().clone()),t.getType()){case s.Constants.Shape.Rectangle:this.drawRectangle(t,e,n);break;case s.Constants.Shape.Polygon:this.drawPolygon(t,e,n);break;case s.Constants.Shape.Circle:this.drawCircle(t,e,n);break;case s.Constants.Shape.CircleSegment:this.drawCircleSegment(t,e,n);break;case s.Constants.Shape.Line:this.drawLine(t,e,n);break;case s.Constants.Shape.QuadraticCurve:this.drawQuadraticCurve(t,e,n);break;case s.Constants.Shape.CubicCurve:this.drawCubicCurve(t,e,n);break;default:i.logService.error("Shape Unknown",s.Constants.Feature.Dimension,t)}}),this}drawRectangle(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Width,e.getWidth()).setStyleIfDifferent(n.Style.Color,r.Color.FUCHSIA(.3)).setStyleIfDifferent(n.Style.BorderColor,r.Color.FUCHSIA()).setStyleIfDifferent(n.Style.BorderThickness,2).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.Height,e.getHeight()),i.setOrigin(this.presence.fetchOrigin(),!0),e.getWidth()>0&&e.getHeight()>0&&t.drawRectangle(i)}drawPolygon(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.CYAN(.3)).setStyleIfDifferent(n.Style.BorderColor,r.Color.CYAN()).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.BorderThickness,2),e.getPoints().length>0&&t.drawPolygon(i,e.getPoints(),e.getReturnToSource())}drawCircle(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.FUCHSIA(.3)).setStyleIfDifferent(n.Style.BorderColor,r.Color.LAWN_GREEN()).setStyleIfDifferent(n.Style.BorderThickness,1).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.Radius,e.getRadius()).setStyleIfDifferent(n.Style.Depth,e.getDepth()),t.drawCircle(i)}drawCircleSegment(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.BLUE(.3)).setStyleIfDifferent(n.Style.BorderColor,r.Color.BLUE()).setStyleIfDifferent(n.Style.BorderThickness,2).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.Radius,e.getRadius()).setStyleIfDifferent(n.Style.Depth,e.getDepth()).setStyleIfDifferent(n.Style.SourceAngle,e.getSourceAngle()).setStyleIfDifferent(n.Style.EndAngle,e.getEndAngle()),t.drawCircle(i)}drawLine(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.RED(.3)).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.BorderColor,r.Color.RED(.3)).setStyleIfDifferent(n.Style.BorderThickness,2);const o={getStyleMap:function(){return i.getStyleMap()},getPresence:function(){return i},getPoints:function(){return[e.getDestination().add(i)]},getType:function(){return s.Constants.Line.STRAIGHT_LINE}};t.drawLine(o)}drawQuadraticCurve(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.BLACK(.3)).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.BorderColor,r.Color.BLACK(.3)).setStyleIfDifferent(n.Style.BorderThickness,2);const o={getStyleMap:function(){return i.getStyleMap()},getPresence:function(){return i},getPoints:function(){return[e.getControl().add(i),e.getDestination().add(i)]},getType:function(){return s.Constants.Line.QUADRATIC_CURVE}};t.drawLine(o)}drawCubicCurve(e,t,i){i.setX(e.getX()).setY(e.getY()).getStyleMap().setStyleIfDifferent(n.Style.Color,r.Color.ORANGE(.3)).setStyleIfDifferent(n.Style.StrokeAlignment,s.Constants.StrokeAlignment.Center).setStyleIfDifferent(n.Style.BorderColor,r.Color.ORANGE(.3)).setStyleIfDifferent(n.Style.BorderThickness,2);const o={getStyleMap:function(){return i.getStyleMap()},getPresence:function(){return i},getPoints:function(){return[e.getControl().add(i),e.getSecondaryControl().add(i),e.getDestination().add(i)]},getType:function(){return s.Constants.Line.CUBIC_CURVE}};t.drawLine(o)}updateDimensions(e){switch(i.logService.assertDefined(e,s.Constants.Feature.Dimension),e.getType()){case s.Constants.Shape.Rectangle:this.evaluateShape(e.x,e.y,e.getWidth(),e.getHeight());break;case s.Constants.Shape.Circle:this.evaluateShape(e.x-e.getRadius(),e.y-e.getRadius(),2*e.getRadius(),2*e.getRadius());break;case s.Constants.Shape.CircleSegment:case s.Constants.Shape.Polygon:this.updateDimensions(e.getBoundingBox());break;case s.Constants.Shape.Line:const t=e.getTopLeft();this.evaluateShape(t.getX(),t.getY(),e.getHorizontalProjection(),e.getVerticalProjection());break;case s.Constants.Shape.QuadraticCurve:case s.Constants.Shape.CubicCurve:this.updateDimensions(e.getBoundingBox());break;default:throw new Error("Shape Unknown")}return this}evaluateShape(e,t,i,s){let r=this.topLeft.getRelativeX(),o=this.bottomRight.getRelativeX(),a=this.topLeft.getRelativeY(),l=this.bottomRight.getRelativeY();return 0===this.shapes.length?(this.width=i,this.height=s,this.topLeft.translate(e,t)):(r<e?o<e+i&&(this.width+=i-(o-e)):(r=e,o=o<e+i?e+i:o,this.width=o-r),a<t?l<t+s&&(this.height+=s-(l-t)):(a=t,l=l<t+s?t+s:l,this.height=l-a),this.topLeft.setY(a).setX(r)),this.bottomRight.setX(this.topLeft.getRelativeX()),this.bottomRight.setY(this.topLeft.getRelativeY()),this.bottomRight.translate(this.width,this.height),this.topLeft.hasStyleMap()&&(this.topLeft.getStyleMap().setStyleIfDifferent(n.Style.Width,this.width),this.topLeft.getStyleMap().setStyleIfDifferent(n.Style.Height,this.height)),this}doConsiderScale(e){return this.considerScale=e,this}getWidth(){const e=this.presence.getStyle(n.Style.ScaleSystemX);if(!this.considerScale||o.isUndefined(e))return this.width;switch(e){case s.Constants.ScaleSystem.NONE:return this.width;case s.Constants.ScaleSystem.FIXED:return this.presence.getStyle(n.Style.ScaleX)||this.width;case s.Constants.ScaleSystem.PERCENT:return this.width*this.presence.getStyle(n.Style.ScaleX)||this.width;default:throw new Error("This ScaleSystem is not supported by Dimension: "+e)}}getHeight(){const e=this.presence.getStyle(n.Style.ScaleSystemY);if(!this.considerScale||o.isUndefined(e))return this.height;switch(e){case s.Constants.ScaleSystem.NONE:return this.height;case s.Constants.ScaleSystem.FIXED:return this.presence.getStyle(n.Style.ScaleY)||this.height;case s.Constants.ScaleSystem.PERCENT:return this.height*this.presence.getStyle(n.Style.ScaleY)||this.height;default:throw new Error("This ScaleSystem is not supported by Dimension: "+e)}}getShapes(){return this.shapes}hasShapes(){return this.shapes.length>0}hasHoles(){return void 0!==this.holes&&this.holes.hasShapes()}getTopLeft(){return this.topLeft}getBottomRight(){return this.bottomRight}getHoles(){return this.holes?this.holes.getShapes():[]}containsPoint(e,t){e=(e=this.presence.isAbsolute()?t.cameraToStageCoordinates(e):a.ObjectCache.PointPool.getObject().translate(e.getX(),e.getY())).subtractFast(this.presence);let r,l=!1;if(this.presence.isAbsolute()){const s=a.ObjectCache.PresencePool.getObject().setPositionRelativeTo(e).setAbsolute(!0);r=i.Utilities.computeDrawPoint(s,t.getStyleMap(),t.getOffset()),a.ObjectCache.PresencePool.recycleObject(s)}else r=i.Utilities.computeDrawPoint(e,t.getStyleMap(),t.getOffset());return a.ObjectCache.PointPool.recycleObject(e),o.each(this.getShapes(),c=>{let d;if(d=this.presence.isAbsolute()?c:t.getShapeForCamera(c),i.Utilities.applyMatrixTransformations(this.presence,r,this.presence.getStyle(n.Style.Width),this.presence.getStyle(n.Style.Height)),d.containsPoint(r)){l=!0;let n=!1;return c.getType()===s.Constants.Shape.CubicCurve?(n=!0,e=i.Utilities.computeDrawPoint(r,t.getStyleMap(),t.getOffset())):e=r,o.each(this.getHoles(),i=>{let s;(s=this.presence.isAbsolute()?i:t.getShapeForCamera(i)).containsPoint(e)&&(l=!1)},this),n&&a.ObjectCache.PointPool.recycleObject(e),!0===l?l:void 0}}),a.ObjectCache.PointPool.recycleObject(r),l}getBoundingBox(e=!1,t=!1){const s=this.getSurroundingRect(e);if(this.presence.hasAnyStyle([n.Style.RotationAngle,n.Style.RotationPoint])){const e=this.topLeft.toRelativePoint(),t=this.bottomRight.toRelativePoint(),n=s.getWidth(),r=i.Utilities.rotatePoints([e,e.clone().setX(e.getX()+n),t,t.clone().setX(t.getX()-n)],this.presence,this.getWidth(),this.getHeight()),{maxX:o,minX:a,maxY:l,minY:c}=i.Utilities.getMinMaxCoords(r),d=o-a,h=l-c,u=t.subtract(e).multiply(.5);s.setCoordinates(u.getX()-d/2,u.getY()-h/2).setWidth(d).setHeight(h)}if(t){const e=s.getCoordinates().add(this.presence);s.setCoordinates(e.getX(),e.getY())}return s}setPresenceParent(e){return this.presence.attach(e),this}getSurroundingRect(e=!1){const t=e?a.ObjectCache.DimensionPool.getObject().addShapes(this.getShapes()).setPresenceParent(this.presence):this,i=a.ObjectCache.RectanglePool.getObject();return i.setX(t.topLeft.getAbsoluteX()).setY(t.topLeft.getAbsoluteY()).setWidth(t.getWidth()).setHeight(t.getHeight()),e&&a.ObjectCache.DimensionPool.recycleObject(t),i}dispose(){this.topLeft.dispose(),this.bottomRight.dispose(),this.shapes.length=0}}t.Dimension=l}),define("core/graphics/primitives/rectangle",["require","exports","core/graphics/primitives/shape","constants","core/graphics/primitives/line","reusable_utilities"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.Shape{constructor(e,t,i,n){super(e,t),this.width=i,this.height=n,this.type=s.Constants.Shape.Rectangle}setValues(e,t,i,s){return this.setCoordinates(e,t),this.setWidth(i),this.setHeight(s),this}static zero(){return new o(0,0,0,0)}static fromDimensionStruct(e){return new o(0,0,e.width,e.height)}static fromWidthHeight(e,t){return o.fromDimensionStruct({width:e,height:t})}static fromStruct(e,t=!1){const i=new o(e.x,e.y,e.width,e.height);return t&&i.freeze(),i}clone(){return o.zero().merge(this)}reset(){return this.resetCoordinates(),this.setWidth(0),this.setHeight(0),this}assimilateCoordinates(e){return super.merge(e),this}merge(e){return this.checkFrozenState(),this.setX(e.getX()),this.setY(e.getY()),this.setWidth(e.getWidth()),this.setHeight(e.getHeight()),this}assimilateTopLeftBottomRight(e,t){return this.checkFrozenState(),this.setX(e.getX()),this.setY(e.getY()),this.setWidth(t.getX()-e.getX()),this.setHeight(t.getY()-e.getY()),this}assimilateTopLeftWidthHeight(e,t,i){return this.checkFrozenState(),this.setX(e.getX()),this.setY(e.getY()),this.setWidth(t),this.setHeight(i),this}isEqualTo(e){return super.isEqualTo(e)&&this.getType()===e.getType()&&e.getHeight()===this.getHeight()&&e.getWidth()===this.getWidth()}compareTo(e){return this.isEqualTo(e)}getInnerRectForRatio(e,t){e*=this.getWidth()>this.getHeight()?this.getWidth():this.getHeight(),t*=this.getWidth()>this.getHeight()?this.getWidth():this.getHeight(),e>this.getWidth()&&(t/=e/this.getWidth(),e=this.getWidth()),t>this.getHeight()&&(e/=t/this.getHeight(),t=this.getHeight());const i=o.RectanglePool.getObject();return i.setHeight(t),i.setWidth(e),i.setX(this.getX()+(this.getWidth()-e)/2),i.setY(this.getY()+(this.getHeight()-t)/2),i}getWidth(){return this.width}getHeight(){return this.height}getTopLeft(){return this.getCoordinates()}getBottomRight(){return i.Shape.PointPool.getObject().addFast(this).addFast(this.getWidth(),this.getHeight())}mergeShape(e){const t=this.getBottomRight(),s=e.getBottomRight();this.combineMinimaFast(e),t.combineMaximaFast(s).subtractFast(this),this.setWidth(t.getX()),this.setHeight(t.getY()),i.Shape.PointPool.recycleObjects([t,s])}setWidth(e){return this.checkFrozenState(),this.width=e,this}setHeight(e){return this.checkFrozenState(),this.height=e,this}containsShape(e){switch(e.getType()){case s.Constants.Shape.Rectangle:return e.areNodesContainedIn(this);case s.Constants.Shape.Polygon:case s.Constants.Shape.Circle:case s.Constants.Shape.CircleSegment:return this.containsShape(e.getBoundingBox());case s.Constants.Shape.Line:const t=e.getTopLeft();return t.getX()>=this.getX()&&t.getY()>=this.getY()&&t.getX()+e.getHorizontalProjection()<=this.getX()+this.getWidth()&&t.getY()+e.getVerticalProjection()<=this.getY()+this.getHeight();default:throw new Error("Shape Unknown")}}getBoundingBox(){return this}areNodesContainedIn(e){let t=e.containsPoint(this);if(t){const s=i.Shape.PointPool.getObject();s.merge(this.getCoordinates()).translate(0,this.getHeight()),(t=e.containsPoint(s))&&(s.translate(this.getWidth(),0),(t=e.containsPoint(s))&&(s.translate(0,-this.getHeight()),t=e.containsPoint(s))),i.Shape.PointPool.recycleObject(s)}return t}isContainedIn(e){let t=e.containsPoint(this);if(t){const s=i.Shape.PointPool.getObject();s.merge(this),s.translate(this.getWidth(),0),(t=e.containsPoint(s))&&(t=this.isSegmentContainedIn(this.getCoordinates(),s,e)),t&&(s.translate(0,this.getHeight()),(t=e.containsPoint(s))&&(t=this.isSegmentContainedIn(this.getCoordinates().add(this.getWidth()),s,e)),t&&(s.translate(-this.getWidth(),0),(t=e.containsPoint(s))&&(t=this.isSegmentContainedIn(this.getCoordinates(),s,e)&&this.isSegmentContainedIn(this.getCoordinates().add(this.getWidth(),this.getHeight()),s,e)))),i.Shape.PointPool.recycleObject(s)}return t}intersects(e){return o.intersectsMemoized(this.getX(),this.getY(),this.getWidth(),this.getHeight(),e.getX(),e.getY(),e.getWidth(),e.getHeight())}static intersectsMemoized(e,t,i,s,n,r,o,a){return e<n+o&&e+i>n&&t<r+a&&t+s>r}isSegmentContainedIn(e,t,i){const s=n.Line.LinePool.getObject();s.merge(e),s.getDestination().merge(t);const r=s.isContainedIn(i,10);return n.Line.LinePool.recycleObject(s),r}containsPoint(e){return e.getX()>=this.getX()&&e.getX()<=this.getX()+this.getWidth()&&e.getY()>=this.getY()&&e.getY()<=this.getY()+this.getHeight()}}o.RectanglePool=new r.ObjectPool({initialPoolSize:2,flexible:!0,objectFactory:o.zero,resetFunction:e=>e.reset()}),__decorate([r.memoize((e,t,i,s,n,r,o,a)=>`${e}|${n}|${t}|${r}|${i}|${o}|${s}|${a}`),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number,Number,Number,Number,Number,Number]),__metadata("design:returntype",void 0)],o,"intersectsMemoized",null),t.Rectangle=o}),define("style",["require","exports","constants","core/graphics/primitives/rectangle","core/graphics/font","core/graphics/primitives/point","core/gradient","reusable_utilities","log"],function(e,t,i,s,n,r,o,a,l){"use strict";function c(e){return void 0!==t.STYLE_SETTINGS[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.Style={Phantom:"Phantom",ScaleSystemX:"ScaleSystemX",ScaleSystemY:"ScaleSystemY",ScaleX:"ScaleX",ScaleY:"ScaleY",Viewport:"Viewport",Color:"Color",Gradient:"Gradient",BorderGradient:"BorderGradient",BackgroundColor:"BackgroundColor",BorderColor:"BorderColor",BorderThickness:"BorderThickness",BorderZoom:"BorderZoom",RotationAngle:"RotationAngle",RotationOrigin:"RotationOrigin",RotationPoint:"RotationPoint",FillRatio:"FillRatio",LineDash:"LineDash",Width:"Width",Depth:"Depth",Layer:"Layer",Transient:"Transient",Height:"Height",Radius:"Radius",SecondaryRadius:"SecondaryRadius",Rotation:"Rotation",SourceAngle:"SourceAngle",EndAngle:"EndAngle",Margins:"Margins",AntiClockWise:"AntiClockWise",Opacity:"Opacity",Font:"Font",Orientation:"Orientation",SecondaryColor:"SecondaryColor",PrimaryColor:"PrimaryColor",BlendMode:"BlendMode",TextBaseLine:"TextBaseLine",TextAlign:"TextAlign",StrokeAlignment:"StrokeAlignment",ShadowColor:"ShadowColor",ShadowOffset:"ShadowOffset",ShadowBlur:"ShadowBlur"},t.STYLE_SETTINGS={Phantom:{default:0,mergable:!0},ScaleSystemX:{default:i.Constants.ScaleSystem.NONE,mergable:!0},ScaleSystemY:{default:i.Constants.ScaleSystem.NONE,mergable:!0},ScaleX:{default:1,mergable:!0},ScaleY:{default:1,mergable:!0},Viewport:{default:s.Rectangle.zero(),mergable:!0},Color:{default:new a.Color("000000"),mergable:!0},Gradient:{default:o.Gradient.empty(),mergable:!0},BorderGradient:{default:o.Gradient.empty(),mergable:!0},BackgroundColor:{default:new a.Color("00000000"),mergable:!0},BorderColor:{default:new a.Color("00000000"),mergable:!0},BorderThickness:{default:.1,mergable:!0},BorderZoom:{default:!1,mergable:!0},RotationAngle:{default:0,mergable:!1},RotationOrigin:{default:i.Constants.Origin.TOP_LEFT,mergable:!1},RotationPoint:{default:r.Point.zero(),mergable:!1},FillRatio:{default:1,mergable:!0},LineDash:{default:[0],mergable:!0},Width:{default:0,mergable:!0},Depth:{default:0,mergable:!0},Layer:{default:0,mergable:!0},Transient:{default:!1,mergable:!0},Height:{default:0,mergable:!0},Radius:{default:0,mergable:!0},SecondaryRadius:{default:0,mergable:!0},Rotation:{default:0,mergable:!0},SourceAngle:{default:0,mergable:!0},EndAngle:{default:0,mergable:!0},Margins:{default:0,mergable:!0},AntiClockWise:{default:!1,mergable:!0},Opacity:{default:e=>void 0!==e?e:1,mergable:!0},Font:{default:new n.Font,mergable:!0},Orientation:{default:i.Constants.Orientation.HORIZONTAL,mergable:!0},SecondaryColor:{default:new a.Color("000000"),mergable:!0},PrimaryColor:{default:new a.Color("000000"),mergable:!0},BlendMode:{default:i.Constants.BlendMode.SourceOver,mergable:!0},TextBaseLine:{default:i.Constants.TextBaseLine.TOP,mergable:!0},TextAlign:{default:i.Constants.TextAlign.LEFT,mergable:!0},StrokeAlignment:{default:i.Constants.StrokeAlignment.Center,mergable:!0},ShadowColor:{default:new a.Color("#BBFFFFFF"),mergable:!0},ShadowOffset:{default:r.Point.zero(),mergable:!0},ShadowBlur:{default:0,mergable:!0}},t.isStyleKey=c,t.isMergableStyle=function(e){return c(e)?t.STYLE_SETTINGS[e].mergable:(l.logService.warn("Cannot get default from unknown style key"),!1)},t.getDefaultStyle=function(e,i=!1){let s;if(c(e)){if(s=t.STYLE_SETTINGS[e].default,i)return s}else l.logService.warn("Cannot get default from unknown style key");return void 0!==s&&void 0!==s.clone?s.clone():s}}),define("core/utilities/presence",["require","exports","event","reusable_utilities","underscore","constants","style","core/generic_engine_interfaces","core/graphics/primitives/point","core/graphics/primitives/vector","core/graphics/stage/queued_event","core/graphics/style_map","core/utilities/abstract_stage_node","core/utilities/dimension","core/utilities/identityChecks","core/utilities/object_cache","core/utilities/origin"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class f{constructor(e,t,s=r.Constants.Origin.TOP_LEFT,n,o=new h.StyleMap,a=!1){this.subscriptions=[],this.incorporeal=!1,this.absolute=!1,this.interactive=!1,this.hidden=!1,this.mouseHover=!1,this.mouseDownOnMe=!1,this.onMouseClick=new i.Event(!0),this.onMouseDoubleClick=new i.Event(!0),this.onMouseDown=new i.Event(!0),this.onMouseUp=new i.Event(!0),this.onMouseMove=new i.Event(!0),this.onGlobalMouseMove=new i.Event(!0),this.onMouseWheel=new i.Event(!0),this.onMouseDrag=new i.Event(!0),this.onMouseEnter=new i.Event(!0),this.onMouseLeave=new i.Event(!0),this.onRightClick=new i.Event,f.registerPools(),this.x=e,this.y=t,this.z=0,this.setOrigin(s),this.setCanvasStyle(o),void 0!==n&&this.attach(n),this.mouseHover=!1,this.incorporeal=a}get onTranslate(){return this.hasEvent(this.privateOnTranslate)||(this.privateOnTranslate=new i.Event),this.privateOnTranslate}static registerPools(){void 0===m.ObjectCache.PresencePool&&(m.ObjectCache.PresencePool=f.PresencePool),void 0===m.ObjectCache.DimensionPool&&(m.ObjectCache.DimensionPool=f.DimensionPool)}getParentClassType(){return this.master.classType}static fromPoint(e){return new f(e.getX(),e.getY(),r.Constants.Origin.TOP_LEFT)}static zero(e){return new f(0,0,e.getOrigin(),e)}static zeroTopLeft(e){return new f(0,0,r.Constants.Origin.TOP_LEFT,void 0,void 0,e)}reset(){return this.resetCoordinates(),this.unattach(),this.clearShape(),this.getStyleMap().clear(),this.dimension=void 0,this.master=void 0,this.absolute=!1,this}resetCoordinates(e=!1){return this.setX(0,e),this.setY(0,e),this.setZ(0,e),this}setCoordinates(e,t,i,s=this.isAbsolute()){return void 0!==e&&this.setX(e,s),void 0!==t&&this.setY(t,s),void 0!==i&&this.setZ(i,s),this}setX(e,t=!1){let i=0;return t&&void 0!==this.parent&&(i=-this.getParent().getAbsoluteX()),this.x=e+i,this}setY(e,t=!1){let i=0;return t&&void 0!==this.parent&&(i=-this.getParent().getAbsoluteY()),this.y=e+i,this}setZ(e,t=!1){let i=0;return t&&void 0!==this.parent&&(i=-this.getParent().getAbsoluteZ()),this.z=e+i,this}setRelativeX(e){return this.x=e,this}setRelativeY(e){return this.y=e,this}setRelativeZ(e){return this.z=e,this}getRawX(){return this.x}getRawY(){return this.y}translate(e,t){return this.setX(this.getRawX()+e),this.setY(this.getRawY()+t),this.hasEvent(this.privateOnTranslate)&&this.privateOnTranslate.fire({horizontalTranslation:e,verticalTranslation:t}),this}getAbsoluteX(e=!1){let t=e?0:this.getOrigin().getX();return void 0!==this.parent&&(t+=this.parent.getAbsoluteX()),this.x+t}getAbsoluteY(e=!1){let t=e?0:this.getOrigin().getY();return void 0!==this.parent&&(t+=this.parent.getAbsoluteY()),this.y+t}getAbsoluteZ(e=!1){let t=0;return void 0!==this.parent&&(t+=this.parent.getAbsoluteZ()),this.z+t}getX(){return this.getRelativeX()}getRelativeX(){return this.x+this.getOrigin().getX()}getY(){return this.getRelativeY()}getRelativeY(){return this.y+this.getOrigin().getY()}getZ(){return this.getRelativeZ()}getRelativeZ(){return this.z}attachStyleMap(e){return this.styleMap!==e&&this.styleMap.detach(),this.styleMap=e,this}detachStyleMap(){return this.styleMap.clearOwner(),this.styleMap=void 0,this}getParentX(){let e=0;return void 0!==this.parent&&(e=this.parent.getAbsoluteX()),e}getParentY(){let e=0;return void 0!==this.parent&&(e=this.parent.getAbsoluteY()),e}getParentZ(){let e=0;return void 0!==this.parent&&(e=this.parent.getAbsoluteZ()),e}setPresence(e,t,i){return this.setX(e),this.setY(t),this.setZ(i),this}hasParent(){return void 0!==this.parent}getParent(){return this.parent}getOrigin(){return this.origin}isRelative(){return!this.isAbsolute()}isAbsolute(){return this.absolute}setAbsolute(e=!1){return this.absolute=e,this}clone(e=!1){let t;return t=e?new f(this.getRelativeX(),this.getRelativeY(),this.getOrigin(),this.parent):new f(this.getAbsoluteX(),this.getAbsoluteY(),this.getOrigin()),this.configureClone(t),t}configureClone(e){return e.setCanvasStyle(this.getStyleMap().clone()),e.setAbsolute(this.isAbsolute()),this.isHidden()&&e.hide(),this}generateChild(e=!1){const t=new f(0,0,this.getOrigin(),this,new h.StyleMap,e);return t.setAbsolute(this.isAbsolute()),t}createChild(e,t,i){const s=f.PresencePool.getObject(this).setCoordinates(e,t).setOrigin(i||this.origin);return s.attach(this),s}attach(e){if(e===this)throw new Error("Presence can't be it's own parent");return this.parent=e,this.hasStyleMap()||(this.styleMap=new h.StyleMap),this.getStyleMap().setParent(e.getStyleMap()),this.setAbsolute(e.isAbsolute()),this}unattach(){return this.parent=void 0,this.getStyleMap()&&this.getStyleMap().clearParent(),this.setAbsolute(!1),this}isIdenticalTo(e){return!!this.isEqualTo(e)&&this.parent===e.parent}isEqualTo(e){return e instanceof l.Point?this.getAbsoluteX()===e.getX()&&this.getAbsoluteY()===e.getY():this.getAbsoluteX()===e.getAbsoluteX()&&this.getAbsoluteY()===e.getAbsoluteY()&&this.getAbsoluteZ()===e.getAbsoluteZ()&&this.getOrigin().isEqualTo(e.getOrigin())}isBiggerThan(e){return e instanceof l.Point?[this.getAbsoluteX()>e.getX(),this.getAbsoluteY()>e.getY()]:[this.getAbsoluteX()>e.getAbsoluteX(),this.getAbsoluteY()>e.getAbsoluteY(),this.getAbsoluteZ()>e.getAbsoluteZ()]}isBiggerOrEqualTo(e){return e instanceof l.Point?[this.getAbsoluteX()>=e.getX(),this.getAbsoluteY()>=e.getY()]:[this.getAbsoluteX()>=e.getAbsoluteX(),this.getAbsoluteY()>=e.getAbsoluteY(),this.getAbsoluteZ()>=e.getAbsoluteZ()]}isSmallerThan(e){return e instanceof l.Point?[this.getAbsoluteX()<e.getX(),this.getAbsoluteY()<e.getY()]:[this.getAbsoluteX()<e.getAbsoluteX(),this.getAbsoluteY()<e.getAbsoluteY(),this.getAbsoluteZ()<e.getAbsoluteZ()]}isSmallerOrEqualTo(e){return e instanceof l.Point?[this.getAbsoluteX()<=e.getX(),this.getAbsoluteY()<=e.getY()]:[this.getAbsoluteX()<=e.getAbsoluteX(),this.getAbsoluteY()<=e.getAbsoluteY(),this.getAbsoluteZ()<=e.getAbsoluteZ()]}hasStyleMap(){return void 0!==this.styleMap}getStyleMap(){return this.styleMap}setStyleMap(e){return this.hasStyleMap()&&this.getStyleMap().dispose(),this.styleMap=e,this}toPoint(){return new l.Point(this.getAbsoluteX(),this.getAbsoluteY())}setOrigin(e,t=!1){if(e instanceof _.Origin)this.origin=new _.Origin(e.getType()),t&&this.origin.add(e);else{if(!n.isString(e))throw new Error("unsupported Origin format");this.origin=new _.Origin(e)}return this}fetchOrigin(){return void 0===this.fetchOriginPredicate?this.getOrigin():this.fetchOriginPredicate()}setFetchOriginPredicate(e){return this.fetchOriginPredicate=e,this}getOriginByType(e){return this.updateOriginByParams({origin:new _.Origin(e)})}updateOriginByParams(e){return this.updateOrigin(e.zoomLevel,e.width,e.height,e.origin)}updateOrigin(e,t,i,s){const a=1/(e=this.isAbsolute()||n.isUndefined(e)?1:e);switch(void 0!==t?void 0===i&&(i=t):0!==this.getStyle(o.Style.Width)?(t=this.getStyle(o.Style.Width),i=this.getStyle(o.Style.Height)):(t=2*this.getStyle(o.Style.Radius),i=2*this.getStyle(o.Style.Radius)),(s=s||this.getOrigin()).getType()){case r.Constants.Origin.TOP_LEFT:break;case r.Constants.Origin.CENTER_TOP:s.setCoordinates(-t/2*a,0);break;case r.Constants.Origin.TOP_RIGHT:s.setCoordinates(-t*a,0);break;case r.Constants.Origin.CENTER_LEFT:s.setCoordinates(0,-i/2*a);break;case r.Constants.Origin.CENTER:s.setCoordinates(-t/2*a,-i/2*a);break;case r.Constants.Origin.CENTER_RIGHT:s.setCoordinates(-t*a,-i*a/2);break;case r.Constants.Origin.BOTTOM_LEFT:s.setCoordinates(0,-i*a);break;case r.Constants.Origin.CENTER_BOTTOM:s.setCoordinates(-t*a/2,-i*a);break;case r.Constants.Origin.BOTTOM_RIGHT:s.setCoordinates(-t*a,-i*a);break;default:throw new Error("Unknown OriginType; cannot complete offset calculation")}return s}debugSetMaster(e){return this.master=e,this}debugGetMaster(){return this.master}hide(){return this.hidden=!0,this}show(){return this.hidden=!1,this}isHidden(){return this.hidden}setIncorporeal(e){return this.incorporeal=e,this}isIncorporeal(){return this.incorporeal}getBoundingBox(e,t){return this.getDimension().getBoundingBox(e,t)}resetDimension(){return this.getDimension().reset(),this}addShape(e){return this.getDimension().addShape(e),this}hasShapes(){return this.getDimension().hasShapes()}getShapes(){return this.getDimension().getShapes()}substractShape(e){return this.getDimension().substractShape(e),this}clearShape(){return this.getDimension().clearShapes(),this.getDimension().clearHoles(),this}getDimension(){return this.hasDimension()||(this.dimension=new p.Dimension(this)),this.dimension}setDimension(e){return this.dimension=e,this}hasDimension(){return void 0!==this.dimension}setCanvasStyle(e){return this.styleMap=e,this.getStyleMap().attach(this),this}getStyle(e){return this.getStyleMap().getStyle(e)}hasStyle(e){return this.getStyleMap().hasStyle(e)}resetStyle(e){return this.getStyleMap().resetStyle(e)}setStyle(e,t){return this.getStyleMap().setStyle(e,t),this}setDefaultStyle(e){return this.getStyleMap().setDefaultStyle(e),this}hasAnyStyle(e){return this.getStyleMap().hasAnyStyle(e)}hasAllStyles(e){return this.getStyleMap().hasAllStyles(e)}isInteractive(){return this.interactive}setInteractiveState(e){return this.interactive=e,this}update(){}draw(e){e.getOffset(),this.debugHighlight&&!this.isHidden()&&this.hasDimension()&&this.getDimension().draw(e)}setPositionRelativeTo(e,t=0,i=0){let s,n;return t instanceof l.Point?(s=t.getX(),n=t.getY()):(s=t,n=i),e instanceof u.StageNode&&(e=e.getPresence()),e instanceof f&&(e=e.toPoint()),this.setX(e.getX()+s,!0),this.setY(e.getY()+n,!0),this}getPositionRelativeTo(e){return this.toPoint().subtract(e.toPoint())}add(e){const t=this.clone();return e instanceof l.Point?t.translate(e.getX(),e.getY()):t.translate(e.getAbsoluteX(),e.getAbsoluteY()),this.configureClone(t),t}subtract(e){const t=this.clone();return e instanceof l.Point?t.translate(-e.getX(),-e.getY()):t.translate(-e.getAbsoluteX(),-e.getAbsoluteY()),this.configureClone(t),t}merge(e){return e instanceof l.Point?this.setX(e.getX()-this.getParentX()).setY(e.getY()-this.getParentY()):this.setX(e.getRelativeX()).setY(e.getRelativeY()).setZ(e.getRelativeZ()),this}multiply(e){return this.setX(this.getAbsoluteX()*e),this.setY(this.getAbsoluteY()*e),this}round(e=2){const t=Math.pow(10,e),i=f.PresencePool.getObject().setCoordinates(Math.round(this.getAbsoluteX()*t)/t,Math.round(this.getAbsoluteY()*t)/t).setStyleMap(new h.StyleMap);return this.configureClone(i),i}setDefaultStyleMap(){return this.setStyleMap(new h.StyleMap),this}distanceTo(e){return e instanceof l.Point?Math.sqrt(Math.pow(this.getAbsoluteX()-e.getX(),2)+Math.pow(this.getAbsoluteY()-e.getY(),2)):Math.sqrt(Math.pow(this.getAbsoluteX()-e.getAbsoluteX(),2)+Math.pow(this.getAbsoluteY()-e.getAbsoluteY(),2)+Math.pow(this.getAbsoluteZ()-e.getAbsoluteZ(),2))}subscribeToStage(e){return this.subscriptions.length<1&&(this.mouseEvents={up:{target:e.onMouseUp,events:[this.onMouseUp,this.onMouseClick,this.onMouseDrag],subscribed:!1,func:t=>{this.mouseDownOnMe&&(this.mouseDownOnMe=!1,this.onMouseUp.hasSubscriptions()&&t.id!==this.onMouseUp.id&&(this.onMouseUp.id=t.id,e.queueEvent(new d.QueuedEvent(this.onMouseUp,t,"mouse up"))))}},down:{target:e.onMouseDown,events:[this.onMouseDown,this.onMouseClick,this.onMouseDrag],subscribed:!1,func:t=>{this.containsPoint(t.mouse,t.camera)&&(this.mouseDownOnMe=!0,this.onMouseDown.hasSubscriptions()&&t.id!==this.onMouseDown.id&&(this.onMouseDown.id=t.id,e.queueEvent(new d.QueuedEvent(this.onMouseDown,t,"mouse down"))))}},wheel:{target:e.onMouseWheel,events:[this.onMouseWheel],subscribed:!1,func:t=>{this.onMouseWheel.hasSubscriptions()&&t.id!==this.onMouseWheel.id&&(this.onMouseWheel.id=t.id,this.containsPoint(t.mouse,t.camera)&&e.queueEvent(new d.QueuedEvent(this.onMouseWheel,t,"mouse wheel")))}},move:{target:e.onMouseMove,events:[this.onMouseMove,this.onMouseEnter],subscribed:!1,func:t=>{(this.onMouseMove.hasSubscriptions()||this.onMouseEnter.hasSubscriptions())&&t.id!==this.onMouseMove.id&&this.containsPoint(t.mouse,t.camera)&&(this.onMouseMove.id=t.id,e.queueEvent(new d.QueuedEvent(this.handleMouseMove.bind(this),t,"mouse move")))}},globalMove:{target:e.onGlobalMouseMove,events:[this.onGlobalMouseMove,this.onMouseLeave,this.onMouseDrag],subscribed:!1,func:t=>{(this.onGlobalMouseMove.hasSubscriptions()||this.onMouseDrag.hasSubscriptions()||this.onMouseLeave.hasSubscriptions())&&t.id!==this.onGlobalMouseMove.id&&(this.onGlobalMouseMove.id=t.id,(this.mouseHover||this.mouseDownOnMe)&&e.queueEvent(new d.QueuedEvent(this.handleGlobalMouseMove.bind(this),t,"mouse global move")))}},click:{target:e.onMouseClick,events:[this.onMouseClick],subscribed:!1,func:t=>{this.onMouseClick.hasSubscriptions()&&t.id!==this.onMouseClick.id&&this.mouseDownOnMe&&(this.onMouseClick.id=t.id,this.containsPoint(t.mouse,t.camera)&&e.queueEvent(new d.QueuedEvent(this.onMouseClick,t,"mouse click")))}},contextmenu:{target:e.onRightClick,events:[this.onRightClick],subscribed:!1,func:t=>{t.id!==this.onRightClick.id&&(this.onRightClick.id=t.id,this.containsPoint(t.mouse,t.camera)&&(t.e.ctrlKey&&this.debugInspect(),e.queueEvent(new d.QueuedEvent(this.onRightClick,t,"mouse click"))))}},doubleClick:{target:e.onMouseDoubleClick,events:[this.onMouseDoubleClick],subscribed:!1,func:t=>{this.onMouseDoubleClick.hasSubscriptions()&&t.id!==this.onMouseDoubleClick.id&&(this.onMouseDoubleClick.id=t.id,this.containsPoint(t.mouse,t.camera)&&e.queueEvent(new d.QueuedEvent(this.onMouseDoubleClick,t,"mouse double click")))}}},this.subscribeEvents()),this}subscribeEvents(){const e=e=>{this.mouseEvents[e].subscribed||this.subscribeEventByKey(e)};return n.each(n.keys(this.mouseEvents),t=>{const i=this.mouseEvents[t].events;let s=!1;n.each(i,i=>{i===this.onMouseDrag&&(i.hasSubscriptions()?(e("up"),e("down")):i.onSubscribe.subscribeOnce(()=>{e("up"),e("down")})),n.isUndefined(i.onSubscribe)||i.hasSubscriptions()?s=s||!0:i.onSubscribe.subscribeOnce(()=>{e(t)})}),s&&this.subscribeEventByKey(t)}),this}subscribeEventByKey(e){this.subscriptions.push(this.mouseEvents[e].target.subscribe(this.mouseEvents[e].func)),this.mouseEvents[e].subscribed=!0}handleMouseMove(e){this.containsPoint(e.mouse,e.camera)&&(this.mouseHover?this.onMouseMove.fire(e):(this.mouseHover=!0,this.onMouseEnter.fire(e)))}isHovering(){return this.mouseHover}handleGlobalMouseMove(e){this.containsPoint(e.mouse,e.camera)||this.mouseHover&&(this.mouseHover=!1,this.onMouseLeave.fire(e)),this.mouseDownOnMe&&(e.e.stopPropagation(),this.onMouseDrag.fire(e)),this.onGlobalMouseMove.fire(e)}containsPoint(e,t){if(this.isHidden()||!this.isInteractive())return!1;if(g.isEntity(this.debugGetMaster())){let i=this.getDimension().containsPoint(e,t);return!!i||(this.debugGetMaster().queryAllComponents(s=>{a.isDrawable(s)&&(i=i||s.containsPoint(e,t))}),i)}return this.getDimension().containsPoint(e,t)}cancelSubscriptions(){return this.subscriptions.length>0&&n.each(this.subscriptions,e=>{e.cancel()}),this.subscriptions=[],this}toRelativePoint(){return new l.Point(this.getRelativeX(),this.getRelativeY())}toVector(e){return c.Vector.fromEndPoints(this,e)}hasEvent(e){return void 0!==e}dispose(){this.onMouseClick.cancelAll(),this.onMouseDoubleClick.cancelAll(),this.onMouseDown.cancelAll(),this.onMouseDrag.cancelAll(),this.onMouseUp.cancelAll(),this.onMouseEnter.cancelAll(),this.onMouseLeave.cancelAll(),this.onMouseMove.cancelAll(),this.onGlobalMouseMove.cancelAll(),this.onMouseWheel.cancelAll(),this.hasEvent(this.privateOnTranslate)&&this.privateOnTranslate.cancelAll(),this.cancelSubscriptions(),this.hasDimension()&&this.getDimension().dispose(),this.hasStyleMap()&&this.getStyleMap().dispose()}debugInspect(){}}f.PresencePool=new s.ObjectPool({initialPoolSize:0,flexible:!0,initializationFunction:(e,t)=>(void 0!==t&&e.setOrigin(t.getOrigin()).attach(t),e),resetFunction:e=>e.reset(),objectFactory:f.zeroTopLeft}),f.DimensionPool=new s.ObjectPool({initialPoolSize:1,flexible:!0,objectFactory:()=>new p.Dimension(f.zeroTopLeft(!0)),resetFunction:e=>e.resetAndClean()}),t.Presence=f}),define("core/graphics/primitives/point",["require","exports","underscore","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t,i=!1){this.x=e,this.y=t,this.frozen=i}getTweenableAttributes(){return["x","y"]}onBeforeTween(){this.checkFrozenState()}static zero(e=!1){return new n(0,0,e)}static fromJson(e,t=e.frozen||!1){return new n(e.x,e.y,t)}toJson(){return{x:this.x,y:this.y,frozen:this.frozen}}static min(e=!1){return new n(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,e)}static max(e=!1){return new n(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,e)}resetCoordinates(){this.checkFrozenState(),this.setX(0),this.setY(0)}checkFrozenState(){}isFrozen(){return this.frozen}freeze(){return this.frozen=!0,this}unfreeze(){return this.frozen=!1,this}clone(){return new n(this.getX(),this.getY())}setCoordinates(e,t){return this.checkFrozenState(),this.setX(e),this.setY(t),this}getX(){return this.x}getY(){return this.y}setX(e){return this.checkFrozenState(),this.x=e,this}setY(e){return this.checkFrozenState(),this.y=e,this}getUX(){return this.x/Math.max(Math.abs(this.getX()),Math.abs(this.getY()))}getUY(){return this.y/Math.max(Math.abs(this.getX()),Math.abs(this.getY()))}translate(e,t){return this.checkFrozenState(),this.setCoordinates(e+this.getX(),t+this.getY()),this}multiply(e){return this.checkFrozenState(),e instanceof n?this.setCoordinates(this.getX()*e.getX(),this.getY()*e.getY()):i.isFunction(e.getAbsoluteX)?this.setCoordinates(this.getX()*e.getAbsoluteX(),this.getY()*e.getAbsoluteY()):this.setCoordinates(this.getX()*e,this.getY()*e),this}distanceTo(e){return e instanceof n?Math.sqrt(Math.pow(e.getX()-this.getX(),2)+Math.pow(e.getY()-this.getY(),2)):Math.sqrt(Math.pow(e.getAbsoluteX()-this.getX(),2)+Math.pow(e.getAbsoluteY()-this.getY(),2))}combineMinima(e){return e instanceof n?new n(Math.min(this.getX(),e.getX()),Math.min(this.getY(),e.getY())):new n(Math.min(this.getX(),e.getAbsoluteX()),Math.min(this.getY(),e.getAbsoluteY()))}combineMinimaFast(e){return e instanceof n?(this.setX(Math.min(this.getX(),e.getX())),this.setY(Math.min(this.getY(),e.getY()))):(this.setX(Math.min(this.getX(),e.getAbsoluteX())),this.setY(Math.min(this.getY(),e.getAbsoluteY()))),this}combineMaxima(e){return e instanceof n?new n(Math.max(this.getX(),e.getX()),Math.max(this.getY(),e.getY())):new n(Math.max(this.getX(),e.getAbsoluteX()),Math.max(this.getY(),e.getAbsoluteY()))}combineMaximaFast(e){return e instanceof n?(this.setX(Math.max(this.getX(),e.getX())),this.setY(Math.max(this.getY(),e.getY()))):(this.setX(Math.max(this.getX(),e.getAbsoluteX())),this.setY(Math.max(this.getY(),e.getAbsoluteY()))),this}distanceSquaredTo(e){return e instanceof n?Math.pow(e.getX()-this.getX(),2)+Math.pow(e.getY()-this.getY(),2):Math.pow(e.getAbsoluteX()-this.getX(),2)+Math.pow(e.getAbsoluteY()-this.getY(),2)}isEqualTo(e){return e instanceof n?this.getX()===e.getX()&&this.getY()===e.getY():!!i.isFunction(e.getAbsoluteX)&&(this.getX()===e.getAbsoluteX()&&this.getY()===e.getAbsoluteY())}isBiggerThan(e){return e instanceof n?[this.getX()>e.getX(),this.getY()>e.getY()]:i.isFunction(e.getAbsoluteX)?[this.getX()>e.getAbsoluteX(),this.getY()>e.getAbsoluteY()]:[!1,!1]}isBiggerOrEqualThan(e){return e instanceof n?[this.getX()>=e.getX(),this.getY()>=e.getY()]:i.isFunction(e.getAbsoluteX)?[this.getX()>=e.getAbsoluteX(),this.getY()>=e.getAbsoluteY()]:[!1,!1]}isSmallerThan(e){return e instanceof n?[this.getX()<e.getX(),this.getY()<e.getY()]:i.isFunction(e.getAbsoluteX)?[this.getX()<e.getAbsoluteX(),this.getY()<e.getAbsoluteY()]:[!1,!1]}isSmallerOrEqualTo(e){return e instanceof n?[this.getX()<=e.getX(),this.getY()<=e.getY()]:i.isFunction(e.getAbsoluteX)?[this.getX()<=e.getAbsoluteX(),this.getY()<=e.getAbsoluteY()]:[!1,!1]}addFast(e,t=0){return this.checkFrozenState(),i.isNumber(e)?this.translate(e,t):e instanceof n?this.translate(e.getX(),e.getY()):i.isFunction(e.getAbsoluteX)?this.translate(e.getAbsoluteX(),e.getAbsoluteY()):this}add(e,t){const i=this.clone();return i.addFast(e,t),i}subtractFast(e,t=0){return this.checkFrozenState(),i.isNumber(e)?this.translate(-e,-t):e instanceof n?this.translate(-e.getX(),-e.getY()):i.isFunction(e.getAbsoluteX)?this.translate(-e.getAbsoluteX(),-e.getAbsoluteY()):this}subtract(e,t){const i=this.clone();return i.subtractFast(e,t),i}rotateAroundCenter(e,t=n.zero(),i=!1){return i||(e=s.trigonometryUtils.degreesToRadians(e)),this.subtractFast(t),this.setCoordinates(this.getX()*Math.cos(e)-this.getY()*Math.sin(e),this.getX()*Math.sin(e)+this.getY()*Math.cos(e)),this.addFast(t),this}roundFast(e=0){this.checkFrozenState();const t=Math.pow(10,e);return this.setCoordinates(Math.round(this.getX()*t)/t,Math.round(this.getY()*t)/t),this}round(e){const t=this.clone();return t.roundFast(e),t}merge(e,t=0){return this.checkFrozenState(),i.isNumber(e)?this.setCoordinates(e,t):e instanceof n?this.setCoordinates(e.getX(),e.getY()):e.getAbsoluteX?this.setCoordinates(e.getAbsoluteX(),e.getAbsoluteY()):this}compareTo(e){return e.getX()===this.x&&e.getY()===this.y}static reduceToCoordinateExtremum(e,t,s){const n="min"===s?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;return i.reduce(e,function(e,t){return i.isUndefined(t)?e:Math[s](e,t.getX())},n)}}t.Point=n}),define("core/utilities/origin",["require","exports","core/graphics/primitives/point","constants"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.Point{constructor(e=s.Constants.Origin.TOP_LEFT){super(0,0),this.type=e}static zero(){return new n}getType(){return this.type}setType(e){return this.type=e instanceof n?e.getType():e,this}static fromJson(e){const t=new n(e.type);return t.setCoordinates(e.x,e.y),e.frozen&&t.freeze(),t}toJson(){return $.extend(super.toJson(),{type:this.getType()})}clone(){return n.fromJson(this.toJson())}isEqualTo(e){return this.getType()===e.getType()&&super.isEqualTo(e)}}t.Origin=n}),define("constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.Increasing="Increasing",e.Decreasing="Decreasing"}(t.CameraZoomType||(t.CameraZoomType={})),t.Constants={Arithmetics:{Add:"add",AddFast:"addFast",Subtract:"subtract",SubtractFast:"subtractFast",Multiply:"multiply",Round:"round",RoundFast:"roundFast"},Comparators:{Bigger:"isBiggerThan",BiggerOrEqual:"isBiggerOrEqualTo",Smaller:"isSmallerThan",SmallerOrEqual:"isSmallerOrEqualTo",Equal:"isEqualTo"},ComponentClasses:{Abstract:"Abstract",Presence:"Presence",Animation:"Animation",Circle:"Circle",CircleSegment:"CircleSegment",Image:"Image",CurvedLabel:"CurvedLabel",Label:"Label",Line:"Line",Polygon:"Polygon",Rectangle:"Rectangle"},Font:{Weight:{Default:"",Normal:"",Bold:"bold",Bolder:"bolder",Lighter:"lighter"},Style:{Default:"",Normal:"",Italic:"italic",Oblique:"oblique"},Family:{Default:"RobotoR, sans-serif",Content:"RobotoR",Heading:"RobotoM",Title:"RobotoB",FontAwesome:"FontAwesome",TwAwesome:"twAwesome",Icomoon2:"icomoon2",Helvetica:"Helvetica",Arial:"Arial",Digits:"CabinCondensedR",DigitsBold:"CabinCondensedM"}},Factory:{Entities:{PlusButton:"PlusButton",MinusButton:"MinusButton",RectanglePresence:"RectanglePresence"}},SpecialCharacters:{LongMinus:""},TimeoutTypes:{Timeout:"timeout",AnimationFrame:"AnimationFrame"},State:{Animation:{Ready:"Ready",Playing:"Playing",Paused:"Paused",Delayed:"Delayed",Stopped:"Stopped",Done:"Done"}},Shape:{Circle:"Circle",CircleSegment:"CircleSegment",Line:"Straight Line",QuadraticCurve:"Quadratic Curve",CubicCurve:"Cubic Curve",Polygon:"Polygon",Rectangle:"Rectangle"},SessionKeys:{Camera:{ScaleX:"Scale X",ScaleY:"Scale Y",OffsetX:"Offset X",OffsetY:"Offset Y"}},StageEvents:{MouseEnter:"mouseenter",MouseLeave:"mouseleave",MouseUp:"mouseup",MouseDown:"mousedown",MouseWheel:"mousewheel",MouseMove:"mousemove",MouseClick:"mouseclick",MouseDblClick:"mousedoubleclick"},Axis:{Type:{Linear:"Linear",Ordinal:"Ordinal"}},Zoom:{Linear:"LinearZoom",Scalar:"Scalar"},ZoomType:{Wheel:"Wheel",Button:"Button",Triggered:"Triggered"},TextBaseLine:{TOP:"top",BOTTOM:"bottom",MIDDLE:"middle",ALPHABETIC:"alphabetic",HANGING:"hanging"},TextAlign:{START:"left",END:"right",LEFT:"left",CENTER:"center",RIGHT:"right"},Mouse:{Cursor:{Auto:"auto",AllScroll:"all-scroll",Crosshair:"crosshair",Default:"",Help:"help",Inherit:"inherit",Move:"move",Pointer:"pointer",Progress:"progress",Text:"text",VerticalText:"vertical-text",Wait:"wait",NoDrop:"no-drop",Notallowed:"not-allowed",EResize:"e-resize",NResize:"n-resize",SResize:"s-resize",WResize:"w-resize",NeResize:"ne-resize",NwResize:"nw-resize",SeResize:"se-resize",SwResize:"sw-resize",ColResize:"col-resize",RowResize:"row-resize",Grab:"grab"},State:{Neutral:"Neutral",Left:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"},Wheel:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"},Right:{Pressed:"Pressed",Clicked:"Clicked",DoublePressed:"DoublePressed"}},Buttons:{Left:0,Wheel:1,Right:2}},Line:{STRAIGHT_LINE:"Straight Line",QUADRATIC_CURVE:"Quadratic Curve",CUBIC_CURVE:"Cubic Curve"},BlendMode:{SourceOver:"source-over",SourceIn:"source-in",SourceOut:"source-out",SourceAtop:"source-atop",DestinationOver:"destination-over",DestinationIn:"destination-in",DestinationOut:"destination-out",DestinationAtop:"destination-atop",Lighter:"lighter",Copy:"copy",Xor:"xor",Screen:"screen",Multiply:"multiply",Overlay:"overlay",Darken:"darken",Lighten:"lighten",ColorDodge:"color-dodge",ColorBurn:"color-burn",HardLight:"hard-light",SoftLight:"soft-light",Difference:"difference",Exclusion:"exclusion",Hue:"hue",Saturation:"saturation",Color:"color",Luminosity:"luminosity"},Velocity:{Icons:{AggregatedEngagement:"icon2-tw-link",FacebookShares:"icon-tw-facebook",FacebookLikes:"icon2-tw-thumbs-up",TwitterShares:"icon2-tw-loop"},State:{Active:"active",Inactive:"inactive"}},StrokeAlignment:{Inside:"inside",Outside:"outside",Center:"center"},Stage:"Stage",Feature:{CanvasEngine:{name:"CanvasEngine",style:"color:maroon"},ReplayManager:{name:"ReplayManager",style:""},Primitives:{Circle:{name:"Circle",style:""},Line:{name:"Line",style:""},Point:{name:"Point",style:""},Quadratic:{name:"Quadratic Curve",style:""}},Gradient:{name:"Gradient",style:""},Color:{name:"Color",style:""},Animations:{Models:{TweeningModel:{name:"TweeningModel",style:""}},Animation:{name:"Animation",style:""},Tweening:{name:"Tweening",style:""},Sequence:{name:"Sequence",style:""},SequenceTimeline:{name:"SequenceTimeline",style:""}},Entities:{Components:{AbstractComponent:{name:"AbstractComponent",style:""},AbstractPresenceComponent:{name:"AbstractPresenceComponent",style:""},AnimationComponent:{name:"AnimationComponent",style:""},ImageComponent:{name:"ImageComponent",style:""},LabelComponent:{name:"LabelComponent",style:""},LineComponent:{name:"LineComponent",style:""}},AbstractStageNode:{name:"AbstractStageNode",style:""},Factory:{name:"EntitiesFactory",style:""},Label:{name:"Label",style:""},Entity:{name:"Entity",style:""},DataGauge:{name:"DataGauge",style:""},Circle:{name:"Circle",style:""},Rectangle:{name:"Rectangle",style:""},Charts:{Velocity:{name:"Velocity Chart",style:""},Chart:{name:"Chart",style:""},PackChart:{name:"Pack Chart",style:""},InfluencerNetwork:{name:"Influencer Network",style:""},Kpi:{name:"KPI Chart",style:""},Pie:{name:"Pie Chart",style:""}}},Settings:{Draw:{name:"Drawsettings",style:""},Label:{name:"Labelsettings",style:""}},Utilities:{Utilities:{name:"Utilities",style:""},Unit:{name:"Unit",style:""},Font:{name:"Font",style:""},Tendency:{name:"Tendency",style:""}},Stage:{name:"Stage",style:""},Dimension:{name:"Dimension",style:""},Presence:{name:"Presence",style:""},Origin:{name:"Origin",style:""},Style:{name:"Style",style:""},Scene:{name:"Scene",style:""},Camera:{name:"Camera",style:""},Layer:{name:"Layer",style:""}},Origin:{TOP_LEFT:"top left",CENTER_TOP:"center top",TOP_RIGHT:"top right",CENTER_LEFT:"center left",CENTER:"center",CENTER_RIGHT:"center right",BOTTOM_LEFT:"bottom left",CENTER_BOTTOM:"center bottom",BOTTOM_RIGHT:"bottom right"},Orientation:{HORIZONTAL:"Horizontal",VERTICAL:"Vertical",AUTO:"Auto"},UnitType:{PERCENT:"%",PIXEL:"px",CENTIMETERS:"cm",MILLIMETERS:"mm"},ScaleSystem:{NONE:"None",PERCENT:"Percent",FIXED:"Fixed"},EventOperations:{ADD:"add",REMOVE:"remove"}}}),define("settings/cartesian_tick_settings",["require","exports","core/graphics/primitives/point","log","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e={showLabel:!0,labelAngle:0,labelOffset:i.Point.zero()}){this.model=e,s.logService.assertDefined(e.labelAngle),s.logService.assertDefined(e.labelOffset)}clone(){return new r(n.extend(this.model))}hasLabelFunction(){return void 0!==this.model.label}setLabelFunction(e){return this.model.label=e,this}setShowLabelSeparator(e){return this.model.showLabelSeparator=e,this}setLabelSeparatorHeight(e){return this.model.labelSeparatorHeight=e,this}getShowLabelSeparator(){return this.model.showLabelSeparator||!1}getLabelSeparatorHeight(){return this.model.labelSeparatorHeight}getLabelFunction(){return this.model.label}setLabelCentered(e){return this.model.labelCentered=e,this}isLabelCentered(){return this.model.labelCentered||!1}hasLabelFont(){return void 0!==this.model.labelFont}setLabelUseEndPoint(e){return this.model.labelUseEndPoint=e,this}getLabelUseEndPoint(){return this.model.labelUseEndPoint||!1}getLabelFont(){return this.model.labelFont}getLabelAngle(){return this.model.labelAngle}setLabelAngle(e){return this.model.labelAngle=e,this}setLabelFont(e){return this.model.labelFont=e,this}getLabel(e,t){return this.model.label(e,t)}setLineOffset(e){this.model.lineOffset=e}getLineOffset(){return this.model.lineOffset}getLabelColor(){return this.model.labelColor}setLabelColor(e){this.model.labelColor=e}getLineThickness(){return this.model.lineThickness}setLabelBold(e){this.model.labelBold=e}isLabelBold(){return this.model.labelBold}setLineThickness(e){this.model.lineThickness=e}getLabelFontSize(){return this.model.labelFontSize}setLabelFontSize(e){this.model.labelFontSize=e}setLineColor(e){this.model.lineColor=e}getLineColor(){return this.model.lineColor}getDashSize(){return this.model.dashSize}setDashSize(e){this.model.dashSize=e}hasLabelOffset(){return void 0!==this.model.labelOffset}setSeparatorOffset(e){this.model.separatorOffset=e}getSeparatorOffset(){return this.model.separatorOffset}getLabelOffset(){return this.model.labelOffset}setLabelOffset(e){this.model.labelOffset=e}getLabelRotation(){return this.model.labelRotation}setLabelRotation(e){this.model.labelRotation=e}setShowLine(e){this.model.showLine=e}getShowLine(){return this.model.showLine}setShowLabel(e){this.model.showLabel=e}getShowLabel(){return this.model.showLabel}}t.CartesianTickSettings=r}),define("settings/label_settings",["require","exports","constants","core/utilities/origin","core/graphics/font","reusable_utilities","core/graphics/primitives/point","core/utilities/utilities","underscore"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(e,t,s,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T){this.isMultiline=!1,this.textFlipped=!1,this.verticalSpace=5,this.spacingMultiplier=1.2,this.splitCharacter=";",this.textAlign=i.Constants.TextAlign.LEFT,this.origin=i.Constants.Origin.TOP_LEFT,this.textBaseLine=i.Constants.TextBaseLine.TOP,this.font=new n.Font,this.color=r.Color.BLACK(),this.borderColor=this.color.clone().setAlpha(0),this.borderThickness=.1,this.shadowColor=r.Color.BLACK(0),this.shadowOffset=o.Point.zero(),this.shadowBlur=0,this.isAdaptive=!1,this.reversed=!1,this.isShownOnFit=!1,this.lineDash=[0],this.adaptiveMultiLine=!1,this.deferredAdaptation=!1,this.maxWidth=0,this.offset=o.Point.zero(),void 0!==e&&(this.isMultiline=e),void 0!==t&&(this.verticalSpace=t),void 0!==s&&(this.splitCharacter=s),void 0!==a&&(this.textAlign=a),void 0!==l&&(this.origin=l),void 0!==d&&(this.font=d),void 0!==h&&(this.color=h),void 0!==u&&(this.borderColor=u),void 0!==p&&(this.borderThickness=p),void 0!==c&&(this.textBaseLine=c),void 0!==g&&(this.shadowColor=g),void 0!==m&&(this.shadowOffset=m),void 0!==_&&(this.shadowBlur=_),void 0!==f&&(this.isAdaptive=f),void 0!==y&&(this.isShownOnFit=y),void 0!==b&&(this.lineDash=b),void 0!==E&&(this.minVisibleFontsize=E),void 0!==S&&(this.adaptiveMultiLine=S),void 0!==C&&(this.deferredAdaptation=C),void 0!==v&&(this.maxWidth=v),void 0!==T&&(this.offset=T)}static fromJson(e){const t=new c;return Object.keys(e).forEach(i=>{let a=void 0;switch(i){case"font":a=n.Font;break;case"color":case"borderColor":case"shadowColor":a=r.Color;break;case"shadowOffset":a=o.Point;break;case"origin":l.isString(e[i])?t[i]=e[i]:a=s.Origin}void 0===a||e[i]instanceof a?t[i]=e[i]:t[i]=a.fromJson(e[i])}),t}toJson(){return{isMultiline:this.isMultiline,verticalSpace:this.verticalSpace,splitCharacter:this.splitCharacter,textAlign:this.textAlign,origin:this.origin instanceof s.Origin?this.origin.toJson():this.origin,textBaseLine:this.textBaseLine,font:this.font.toJson(),color:this.color.toJson(),minVisibleFontsize:this.minVisibleFontsize,borderColor:this.borderColor.toJson(),borderThickness:this.borderThickness,shadowColor:this.shadowColor.toJson(),shadowOffset:this.shadowOffset.toJson(),shadowBlur:this.shadowBlur,isAdaptive:this.isAdaptive,isShownOnFit:this.isShownOnFit,reversed:this.reversed,lineDash:this.lineDash.slice(),adaptiveMultiLine:this.adaptiveMultiLine,deferredAdaptation:this.deferredAdaptation,maxWidth:this.maxWidth,offset:this.offset.toJson()}}clone(){const e=new c;return Object.keys(this).forEach(t=>{a.Utilities.compareValues(this[t],e[t],i.Constants.Comparators.Equal)||(e[t]=a.Utilities.isCloneable(this[t])?this[t].clone():this[t])}),e}isTextSplittable(e){return-1!==e.indexOf(this.getSplitCharacter())}split(e){return e.split(this.getSplitCharacter())}setMultiline(e){return this.assertValueNotUndefined(e),this.isMultiline=e,this}setOffset(e){return this.assertValueNotUndefined(e),this.offset=e,this}getOffset(){return this.offset}flipText(e){return this.assertValueNotUndefined(e),this.textFlipped=e,this}isTextFlipped(){return this.textFlipped}setAdaptiveMultiLine(e){return this.assertValueNotUndefined(e),this.adaptiveMultiLine=e,this}getMinFontSize(){return this.getFont().getMinSize()}setMinFontSize(e){return this.getFont().setMinSize(e),this}getDefferredAdaptation(){return this.deferredAdaptation}setDefferredAdaptation(e){return this.assertValueNotUndefined(e),this.deferredAdaptation=e,this}getMaxFontSize(){return this.getFont().getMaxSize()}setMaxFontSize(e){return this.getFont().setMaxSize(e),this}getSpacingMultiplier(){return this.spacingMultiplier}setSpacingMultiplier(e){return this.assertValueNotUndefined(e),this.spacingMultiplier=e,this}getVerticalSpace(){return this.verticalSpace}getMinVisibleFontsize(){return this.minVisibleFontsize}setMinVisibleFontsize(e){return this.assertValueNotUndefined(e),this.minVisibleFontsize=e,this}setVerticalSpace(e){return this.assertValueNotUndefined(e),this.verticalSpace=e,this}getSplitCharacter(){return this.splitCharacter}setSplitCharacter(e){return a.logService.assert(l.isString(e)&&""!==e,"splitCharacter must be a non-empty String",i.Constants.Feature.Entities.Label,this),this.splitCharacter=e,this}setAdaptive(e){return this.assertValueNotUndefined(e),this.isAdaptive=e,this}showOnFit(e){return this.assertValueNotUndefined(e),this.isShownOnFit=e,this}getOrigin(){return this.origin}setOrigin(e){return this.assertValueNotUndefined(e),this.origin=e,this}getTextBaseLine(){return this.textBaseLine}setTextBaseLine(e){return this.assertValueNotUndefined(e),this.textBaseLine=e,this}getTextAlign(){return this.textAlign}setTextAlign(e){return this.assertValueNotUndefined(e),this.textAlign=e,this}getColor(){return this.color}setColor(e){return this.assertValueNotUndefined(e),this.color=e,this}getShadowColor(){return this.shadowColor}setShadowColor(e){return this.assertValueNotUndefined(e),this.shadowColor=e,this}getShadowOffset(){return this.shadowOffset}setShadowOffset(e){return this.assertValueNotUndefined(e),this.shadowOffset=e,this}getShadowBlur(){return this.shadowBlur}setReversedState(e){return this.assertValueNotUndefined(e),this.reversed=e,this}isReversed(){return this.reversed}setShadowBlur(e){return a.logService.assert(e>=0,"blur cannot be negative",i.Constants.Feature.Entities.Label,this),this.shadowBlur=e,this}getFont(){return this.font}setFont(e){return this.assertValueNotUndefined(e),this.font=e,this}getFontSize(){return this.font.getSize()}setFontSize(e){return this.font.setSize(e),this}getFontFamily(){return this.font.getFamily()}setFontFamily(e){return this.font.setFamily(e),this}getFontWeight(){return this.font.getWeight()}setFontWeight(e){return this.assertValueNotUndefined(e),this.font.setWeight(e),this}getFontStyle(){return this.font.getStyle()}setFontStyle(e){return this.assertValueNotUndefined(e),this.font.setStyle(e),this}resetFontSize(){return this.font.setSize(1),this}getBorderColor(){return this.borderColor}setBorderColor(e){return this.assertValueNotUndefined(e),this.borderColor=e,this}getLineDash(){return this.lineDash}setLineDash(e){return this.assertValueNotUndefined(e),this.lineDash=e,this}getMaxWidth(){return this.maxWidth}setMaxWidth(e){return this.assertValueNotUndefined(e),this.maxWidth=e,this}hasMaxWidth(){return this.maxWidth>0}getBorderThickness(){return this.borderThickness}setBorderThickness(e){return this.assertValueNotUndefined(e),this.borderThickness=e,this}assertValueNotUndefined(e){a.logService.assert(void 0!==e,"passed parameter is undefined",i.Constants.Feature.Settings.Label)}}t.LabelSettings=c}),define("core/entities/components/label_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/utilities","core/graphics/primitives/point","core/utilities/presence","settings/label_settings","constants","style","reusable_utilities","core/graphics/font","core/graphics/primitives/rectangle","event","underscore","map","core/utilities/object_cache","core/utilities/text_metrics_object","log","core/graphics/primitives/circle_segment"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y){"use strict";var b;Object.defineProperty(t,"__esModule",{value:!0});let E=b=class extends i.PresenceComponent{constructor(e,t,i,s=!1){super(e),this.baseTextSizes=new g.Map,this.linePositions=new g.Map,this.isContainingShapeInvalid=!0,this.translation=n.Point.zero(),this.conditionalHidePaused=!1,this.adaptationPaused=!1,this.widthChanged=!1,this.heightChanged=!1,this.modifier=10,this.oldBoundingWidth=0,this.oldBoundingHeight=0,this.oldZoomLevel=-1,this.adaptMargin=6,this.splitToConformToMaxWidth=!1,this._disposed=!1,this.onFontSizeAdapted=new u.Event,this.onMultilineAdapted=new u.Event,this.onBeforeApplyAdaptations=new u.Event,this.classType=a.Constants.ComponentClasses.Label,this.applySettings(i),this.textSlips=[],s||this.setText(t)}applySettings(e){this.settings=e;const t=e.getOrigin();p.isUndefined(t)||this.getPresence().setOrigin(t),this.hasStyle(l.Style.Color)||this.setStyle(l.Style.Color,()=>e.getColor()),this.hasStyle(l.Style.Font)||this.setStyle(l.Style.Font,(new d.Font).assimilate(e.getFont())),this.hasStyle(l.Style.BorderColor)||this.setStyle(l.Style.BorderColor,()=>e.getBorderColor()),this.hasStyle(l.Style.BorderThickness)||this.setStyle(l.Style.BorderThickness,()=>e.getBorderThickness()),this.hasStyle(l.Style.TextBaseLine)||this.setStyle(l.Style.TextBaseLine,()=>e.getTextBaseLine()),this.hasStyle(l.Style.TextAlign)||this.setStyle(l.Style.TextAlign,()=>e.getTextAlign()),this.hasStyle(l.Style.ShadowColor)||this.setStyle(l.Style.ShadowColor,()=>e.getShadowColor()),this.hasStyle(l.Style.ShadowOffset)||this.setStyle(l.Style.ShadowOffset,()=>e.getShadowOffset()),this.hasStyle(l.Style.ShadowBlur)||this.setStyle(l.Style.ShadowBlur,()=>e.getShadowBlur()),this.hasStyle(l.Style.ShadowBlur)||this.setStyle(l.Style.ShadowBlur,()=>e.getShadowBlur()),this.getSettings().isAdaptive&&this.getSettings().setFontSize(1),this.getStyleMap().setStyleIfDifferent(l.Style.LineDash,e.getLineDash()),e.getTextBaseLine()===a.Constants.TextBaseLine.MIDDLE&&this.getPresence().setFetchOriginPredicate(()=>this.getOrigin().translate(0,-this.getStyle(l.Style.Font).getSize()/this.getZoom()/2))}setShapeFetchPredicate(e){return this.fetchShape=e,this}attach(e){return super.attach(e),void 0===this.fetchShape&&(this.fetchShape=(()=>this.getOwner().getShape())),this}getSettings(){return this.settings}setSettings(e){return this.settings=e,this}resetAdjustments(){this.translate(this.translation.getX(),this.translation.getY()),this.translation.resetCoordinates(),this.setDefaultStyle(l.Style.Width),this.setDefaultStyle(l.Style.Height)}computeFont(){const e=this.getSettings().getFont(),t=this.getStyle(l.Style.Font),i=!e.equalsinStyle(t),s=this.baseTextSizes.size!==this.textSlips.length;return e.equals(t)||t.assimilate(e),(i||s)&&this.calculateBaseSizes(t),t}calculateBaseSizes(e){const t=b.getCalculationFont(e);this.baseTextSizes.clear(),this.baseTextSizes.set("",_.TextMetricsObject.zero()),this.textSlips.forEach(e=>{const i=s.Utilities.measureText(e,t);i.multiply(.01),this.baseTextSizes.set(e,_.TextMetricsObject.zero().assimilate(i)),m.ObjectCache.recycleObject(i)}),m.ObjectCache.recycleObject(t)}static getCalculationFont(e){return m.ObjectCache.FontPool.getObject().assimilate(e).setMaxSize(110).setSize(100)}getWordMetrics(e,t=!1){const i=this.baseTextSizes.get(e);return void 0===i?(t&&f.logService.error("There's some error happening in the computation of base sizes. Please investigate"),this.calculateBaseSizes(this.getFont()),this.getWordMetrics(e,!0)):m.ObjectCache.TextMetricsObjectPool.getObject().assimilate(i).multiply(this.getStyle(l.Style.Font).getSize())}buildString(e,t=1,i){const s=this.getWordMetrics(e),n=void 0!==i?e+i:e,o=this.linePositions.get(n)||r.Presence.PresencePool.getObject(this.getPresence());return o.translate(0,this.getStyle(l.Style.Height)/t),o.setStyle(l.Style.Width,s.width/t).setStyle(l.Style.Height,s.height/t),this.evaluateMetrics(s),m.ObjectCache.recycleObject(s),this.linePositions.has(n)||this.linePositions.set(n,o),this}adjustCenterTextPosition(e,t=1,i=0){return this.linePositions.forEach(n=>{let r=this.getStyle(l.Style.Width)/t-n.getStyle(l.Style.Width);s.Utilities.isArabic(e)&&(r*=.5)>i&&(i=r),n.translate(r/2,0)}),this.linePositions.forEach(e=>e.translate(i,0)),this}adjustRightTextPosition(e=1){return this.linePositions.forEach(t=>t.translate(this.getStyle(l.Style.Width)/e-t.getStyle(l.Style.Width),0)),this}adjustTextPositionBasedOnOrigin(e,t=1){switch(this.getOrigin().getType()){case a.Constants.Origin.CENTER:case a.Constants.Origin.CENTER_TOP:case a.Constants.Origin.CENTER_BOTTOM:this.adjustCenterTextPosition(e,t);break;case a.Constants.Origin.CENTER_RIGHT:case a.Constants.Origin.TOP_RIGHT:case a.Constants.Origin.BOTTOM_RIGHT:this.adjustRightTextPosition(t);break;case a.Constants.Origin.CENTER_LEFT:case a.Constants.Origin.TOP_LEFT:case a.Constants.Origin.BOTTOM_LEFT:}return this}resetWords(){this.linePositions.forEach(e=>e.resetCoordinates())}formatText(e=!1,t=!1){this.resetAdjustments(),this.computeFont(),this.resetWords();const i=this.isAbsolute()?1:this.getZoom();this.textSlips.forEach((e,t)=>this.buildString(e,i,t)),this.textSlips.length>1&&this.adjustTextPositionBasedOnOrigin(this.getText(),i);const s=this.getStyle(l.Style.Height)/i,n=this.getStyle(l.Style.Width)/i;if(this.hasShapes())this.getShapes()[0].setWidth(n),this.getShapes()[0].setHeight(s);else{const e=new h.Rectangle(0,0,n,s);this.addShape(e)}return e||this.setPositionRelativeToAlignment(),this.setPositionRelativeToBaseLine(),this.updateOrigin(i),t||this.invalidate(),this}persistentTranslate(e,t){return this.translation.translate(-e,-t),this.translate(e,t),this}setPositionRelativeToBaseLine(){const e=(this.textSlips.length-1)*this.fontSize/this.getZoom();switch(this.getStyle(l.Style.TextBaseLine)){case a.Constants.TextBaseLine.MIDDLE:this.persistentTranslate(0,-e/2);break;case a.Constants.TextBaseLine.TOP:this.persistentTranslate(0,-e)}return s.Utilities.isClientFF()&&this.persistentTranslate(0,.1*this.fontSize),this}setPositionRelativeToAlignment(){const e=this.getStyle(l.Style.Width)/this.getZoom();switch(this.getStyle(l.Style.TextAlign)){case a.Constants.TextAlign.CENTER:if(this.hasStyle(l.Style.RotationAngle)){const t=m.ObjectCache.PresencePool.getObject(this.getPresence()),i=this.getBoundingBox(),r=s.Utilities.applyMatrixTransformations(t.setStyle(l.Style.RotationPoint,n.Point.zero()),m.ObjectCache.PointPool.getObject().translate(e/2,0),i.width/this.getZoom(),i.height/this.getZoom());this.persistentTranslate(r.getX(),r.getY()),m.ObjectCache.recycleObjects([t,i,r])}else this.persistentTranslate(e/2,0)}return this}evaluateMetrics(e){const t=this.getStyle(l.Style.Width)||0,i=this.getStyle(l.Style.Height)||0;return(!this.hasStyle(l.Style.Width)||t<e.width)&&this.setStyle(l.Style.Width,e.width),this.setStyle(l.Style.Height,e.height+i),this}hasMultipleLines(){return this.textSlips.length>1}getNumLines(){return this.textSlips.length}isMultiline(){return this.getSettings().isMultiline}setMultiline(e){const t=this.getSettings().isMultiline;return this.getSettings().setMultiline(e),t!==e&&this.formatText(),this}update(){this.getStyleMap().setStyleIfDifferent(l.Style.Color,this.getSettings().getColor()),this.hasStageFacade()&&(this.getSettings().isAdaptive&&!this.adaptationPaused&&this.shouldAdapt()?this.applyAdaptations():this.conditionalHide(),this.updateOrigin(this.getZoom()))}accessCamera(){if(this.hasStageFacade())return this.getStageFacade().getActiveCamera()}getZoom(){return this.hasStageFacade()?this.accessCamera().getZoom():1}reformat(){return this.oldZoomLevel=-1,this.oldBoundingHeight=-1,this.oldBoundingWidth=-1,this.formatText(),this}adaptToMaxWidth(){let e=!1;const t=this.getSettings(),i=[];this.textSlips.forEach(s=>{const n=this.getWordMetrics(s);if(n.width>t.getMaxWidth()&&(s.length>2||2===s.length&&"-"!==s[1])){if(t.isTextSplittable(s))i.push.apply(i,t.split(s));else{const e=Math.ceil((s.length-1)/2);i.push(s.substring(0,e)+"-"),i.push(s.substring(e))}e=!0}else i.push(s);m.ObjectCache.recycleObject(n)}),e&&(this.textSlips=i,this.formatText(),this.adaptToMaxWidth(),this.splitToConformToMaxWidth=!0)}draw(e){!this.isHidden()&&this.isSizeVisible()&&this.textSlips.forEach((t,i)=>{const r=this.linePositions.get(t+i);if(r.getStyleMap().mergeStyles([l.Style.Opacity,l.Style.Color,l.Style.Layer,l.Style.TextBaseLine,l.Style.BorderColor,l.Style.BorderThickness,l.Style.StrokeAlignment,l.Style.ShadowColor,l.Style.Font],this.getStyleMap(),!0,!1),this.hasStyle(l.Style.RotationAngle)){const i=m.ObjectCache.PresencePool.getObject();i.setCoordinates(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()).getStyleMap().merge(this.getStyleMap(),!0),i.setStyle(l.Style.RotationPoint,n.Point.zero());const o=this.getBoundingBox(),a=s.Utilities.applyMatrixTransformations(i,m.ObjectCache.PointPool.getObject().translate(r.getRelativeX(),r.getRelativeY()),o.width,o.height);i.translate(a.getX(),a.getY()).resetStyle(l.Style.RotationPoint),m.ObjectCache.recycleObjects([o,a]),e.drawText(r,t,i)}else e.drawText(r,t)})}setAbsolute(e){return super.setAbsolute(e),this.linePositions.forEach(t=>t.setAbsolute(e)),this}getOrientation(){return this.labelOrientation}setOrientation(e,t){switch(this.labelOrientation=e,e){case a.Constants.Orientation.HORIZONTAL:t<=180&&(t+=180),this.setStyle(l.Style.RotationAngle,-t-90);break;case a.Constants.Orientation.VERTICAL:t>=90&&t<=270&&(t+=180),this.setStyle(l.Style.RotationAngle,-t)}return this}pauseConditionalHide(){return this.conditionalHidePaused=!0,this}resumeConditionalHide(){return this.conditionalHidePaused=!1,this.invalidate(),this}pauseAdaptation(){return this.adaptationPaused=!0,this}resumeAdaptation(){return this.adaptationPaused=!1,this.invalidate(),this}isSizeVisible(){return void 0===this.getSettings().getMinVisibleFontsize()||this.getSettings().getMinVisibleFontsize()<=this.getFont().getSize()}isSplitToConformToMaxWidth(){return this.splitToConformToMaxWidth}conditionalHide(){if(!this.conditionalHidePaused&&this.getSettings().isShownOnFit){const e=this.fitsInBoundingShape();e||this.isHidden()?e&&this.isHidden()&&this.show():this.hide()}return this}shouldAdapt(){let e=!1;if(-1===this.oldBoundingHeight)e=!0;else if(1===this.getFont().getSize()&&this.fitsInBoundingShape()){const t=this.fetchShape(),i=this.accessCamera().getShapeForCamera(t),s=i.getBoundingBox();e=s.width>2*this.baseTextSizes.get(this.getLongestTextSlip()).width,m.ObjectCache.recycleObjects([t,i,s])}else{const t=this.getOwnerBoundingBox();this.widthChanged=t.width!==this.oldBoundingWidth,this.heightChanged=t.height!==this.oldBoundingHeight,(this.oldZoomLevel!==this.getZoom()||this.widthChanged||this.heightChanged)&&(this.modifier=Math.round(Math.max(1,this.oldBoundingWidth/t.width,t.width/this.oldBoundingWidth)),e=!0),m.ObjectCache.recycleObject(t)}return e}forceApplyAdaptations(e,t=1){return this.getSettings().isAdaptive&&this.runAdaptations(),this}shouldShrink(){if(1===this.getFont().getSize()&&this.fitsInBoundingShape())return!1;const e=this.getOwnerBoundingBox(),t=!(e.width>=this.oldBoundingWidth&&e.height>=this.oldBoundingHeight);return m.ObjectCache.recycleObject(e),t}runAdaptations(){this.formatText(!1,!0),this.updateOrigin(this.getZoom()),this.onBeforeApplyAdaptations.fire(this),this.applyMultilineAdaptation(),this.adaptFontSize(this.shouldShrink()),this.formatText(!1,!0);const e=this.getOwnerBoundingBox();return this.oldBoundingWidth=e.width,this.oldBoundingHeight=e.height,m.ObjectCache.recycleObject(e),this.widthChanged=!1,this.heightChanged=!1,this.oldZoomLevel=this.getZoom(),this.conditionalHide(),this}getOwnerBoundingBox(){const e=this.fetchShape(),t=e.getBoundingBox();return m.ObjectCache.recycleObject(e),t}applyAdaptations(){return this.getSettings().getDefferredAdaptation()?p.defer(()=>{this.runAdaptations()}):this.runAdaptations(),this}applyMultilineAdaptation(e=!1){if(this.getText().split(" ").length>1&&!this.fitsInBoundingShape()&&this.getSettings().adaptiveMultiLine){if(!e&&this.getSettings().isMultiline)return this;if(e&&!this.getSettings().isMultiline)return this;if(!this.getSettings().isMultiline&&!e){const e=!this.getSettings().isMultiline;this.toggleMultilineAdaptation(e),this.fitsInBoundingShape()||this.toggleMultilineAdaptation(!e)}}return this}toggleMultilineAdaptation(e){this.getSettings().setMultiline(e),this.formatText(!1,!0),this.updateOrigin(this.getZoom()),this.onMultilineAdapted.fire(this)}adaptSizeByCalculus(){if(this.hasStageFacade()){const e=this.getLongestTextSlip(),t=this.baseTextSizes.get(e),i=t.height*this.textSlips.length,n=s.Utilities.isArabic(this.getText())?t.width/.7:t.width,r=this.fetchShape();let o=r.getInnerRectForRatio(n,i);m.ObjectCache.recycleObject(r);const a=(o=this.accessCamera().getShapeForCamera(o)).getWidth()/n;h.Rectangle.RectanglePool.recycleObject(o),Math.floor(a)!==this.getFont().getSize()&&this.getFont().setSize(Math.max(1,Math.floor(a)))}return this}getLongestTextSlip(){return this.textSlips.reduce((e,t)=>this.baseTextSizes.get(e).width<this.baseTextSizes.get(t).width?t:e,"")}getFont(){return this.getSettings().getFont()}tryFontSize(e,t=!0){return!(e<=0||p.isNaN(e)||void 0===e)&&(this.getFont().setSize(e),this.formatText(!1,!0),this.updateOrigin(this.getZoom()),t&&this.onFontSizeAdapted.fire(this),this.fitsInBoundingShape())}adaptByIteration(e,t=this.modifier){const i=e?this.getFont().getMinSize():this.getFont().getMaxSize();let s=this.getFont().getSize();this.resetAdjustments();const n=s;let r=!1;for(;e!==this.fitsInBoundingShape()&&(e?s>=i:s<=i);)s=e?s-t:s+t,this.tryFontSize(s,!0),this.applyMultilineAdaptation(e),r=!0;1!==t&&r?(e?this.adaptByIteration(!1,Math.floor(t/2)):this.adaptByIteration(!0,Math.floor(t/2)),this.applyMultilineAdaptation(e)):e||this.tryFontSize(Math.max(n,s-t))}adaptFontSize(e){const t=this.fetchShape();switch(t.getType()){case a.Constants.Shape.Rectangle:case a.Constants.Shape.Circle:this.adaptSizeByCalculus(),this.onFontSizeAdapted.fire(this);break;default:this.adaptByIteration(e),this.invalidate()}m.ObjectCache.recycleObject(t)}fitsInBoundingShape(e=!1){const t=this.fetchShape();if(t instanceof y.CircleSegment&&t.arcAngle<3)return!1;const i=this.fitsIn(t,e);return m.ObjectCache.recycleObject(t),i}fitsIn(e,t=!1){const i=this.hasAnyStyle([l.Style.RotationAngle,l.Style.RotationPoint])?this.rotateShape(!0,this.getSettings().isAdaptive?this.adaptMargin:0):this.getBoundingBox();let s;if(this.hasStageFacade()&&!t){const t=this.accessCamera().getShapeForCamera(e),n=this.accessCamera().getShapeForCamera(i,!0);s=e.containsShape(i),m.ObjectCache.recycleObjects([t,n])}else s=e.containsShape(i);return m.ObjectCache.recycleObject(i),s}getText(){let e="";return this.textSlips.length<1?e:this.textSlips.length<2?this.textSlips[0]:(this.textSlips.forEach((t,i)=>i!==this.textSlips.length-1?e+=t+this.getSettings().getSplitCharacter():e+=t),e)}set _text(e){this.setText(e)}get _text(){return this.textSlips}get fontSize(){return this.getSettings().getFont().getSize()}set fontSize(e){this.getSettings().getFont().setSize(e),this.formatText()}setText(e){this.textSlips=[];const t=this.getSettings();return t.isMultiline&&t.isTextSplittable(e)?this.textSlips=t.split(e):this.textSlips.push(e),this.formatText(),t.hasMaxWidth()&&!t.isAdaptive&&this.adaptToMaxWidth(),this}invalidateContainingShape(){return this.isContainingShapeInvalid=!0,this}getBoundingBox(){const e=this.getZoom(),t=super.getBoundingBox(!0),i=t.getWidth()/e,s=t.getHeight()/e;switch(this.getSettings().textAlign){case a.Constants.TextAlign.CENTER:t.translate(-i/2,-s/2);break;case a.Constants.TextAlign.END:case a.Constants.TextAlign.RIGHT:t.translate(-i,-s)}const n=this.getStyle(l.Style.Font).getSize()/e;switch(this.getStyle(l.Style.TextBaseLine)){case a.Constants.TextBaseLine.MIDDLE:t.translate(0,-n);break;case a.Constants.TextBaseLine.TOP:}return t}rotateShape(e=!1,t=0){const i=this.getBoundingBox(),n=m.ObjectCache.PointPool.getObject().translate(i.x,i.y).translate(-t/2,-t/2),r=i.width+t,o=i.height+t,a=s.Utilities.rotatePoints([n,m.ObjectCache.PointPool.getObject().translate(r,0),m.ObjectCache.PointPool.getObject().translate(r,o),m.ObjectCache.PointPool.getObject().translate(0,o)],this.getPresence(),r,o,e);return m.ObjectCache.recycleObject(i),m.ObjectCache.PolygonPool.getObject().addFast(a.shift()).addPoints(a)}dispose(){this.isDisposed()||(this.linePositions.forEach(e=>{m.ObjectCache.PresencePool.recycleObject(e)}),this.linePositions.clear(),this._disposed=!0,super.dispose(),this.onFontSizeAdapted.cancelAll(),this.onBeforeApplyAdaptations.cancelAll(),this.onMultilineAdapted.cancelAll())}};E=b=__decorate([c.meta({name:"LabelComponent"}),__metadata("design:paramtypes",[r.Presence,String,o.LabelSettings,Boolean])],E),t.LabelComponent=E}),define("core/entities/cartesian/cartesian_tick",["require","exports","core/entities/entity","core/utilities/presence","core/graphics/primitives/point","core/entities/components/line_component","style","settings/label_settings","constants","core/entities/components/label_component","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CartesianTick=class extends i.Entity{constructor(e,t,i,h,u){const p=[];if(t instanceof n.Point&&(t=s.Presence.fromPoint(t)),i.getShowLine()){const n=r.LineComponent.fromPresences(s.Presence.zero(e),t);n.setStyle(o.Style.BorderColor,i.getLineColor()).setStyle(o.Style.BorderThickness,i.getLineThickness()).setStyle(o.Style.LineDash,i.getDashSize()),p.push(n)}if(i.hasLabelFunction()&&i.getShowLabel()){const n=(new a.LabelSettings).setColor(i.getLabelColor()).setBorderThickness(0).setFontSize(i.getLabelFontSize()||12);i.hasLabelFont()&&n.setFontFamily(i.getLabelFont()),i.isLabelCentered()&&n.setOrigin(l.Constants.Origin.CENTER),i.isLabelBold()&&n.setFontWeight("bold");const g=s.Presence.zero(e);i.getLabelUseEndPoint()&&g.setPositionRelativeTo(t),i.hasLabelOffset()&&g.translate(i.getLabelOffset().getX(),i.getLabelOffset().getY());const m=new c.LabelComponent(g,i.getLabel(h,u),n).setStyle(o.Style.RotationAngle,i.getLabelAngle());if(p.push(m),i.getShowLabelSeparator()){const e=i.getLabelSeparatorHeight(),t=i.getSeparatorOffset(),s=g.clone(!0);s.translate(t.getX(),t.getY());const n=s.clone(!0);n.setY(n.getY()+e);const a=new r.LineComponent(s,[n.toPoint()]).setStyle(o.Style.BorderColor,d.Color.BLACK(1)).setStyle(o.Style.BorderThickness,1);p.push(a)}}super(e,p)}}}),define("core/entities/cartesian/cartesian_plane",["require","exports","core/entities/entity","core/graphics/primitives/rectangle","core/graphics/primitives/point","reusable_utilities","settings/cartesian_tick_settings","core/entities/cartesian/cartesian_tick","log","core/entities/components/rectangle_component","style","core/gradient","core/entities/components/line_component","settings/label_settings","constants","core/entities/components/label_component","underscore"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class f extends i.Entity{constructor(e,t,i,n=0,r=0){super(e),this.abscissaBounds=[],this.ordinateBounds=[],this.abscissaTickSettings=new o.CartesianTickSettings,this.ordinateTickSettings=new o.CartesianTickSettings,this.abscissaTickSettingsEnhancer=_.identity,this.ordinateTickSettingsEnhancer=_.identity,this.abscissaTicks=[],this.ordinateTicks=[],t-=n,i-=r,e.addShape(s.Rectangle.fromWidthHeight(t,i)),this.offsetLeft=n,this.offsetBottom=r}getWidth(){return this.getPlaneShape().getWidth()}getHeight(){return this.getPlaneShape().getHeight()}getPlaneShape(){return this.getPresence().getShapes()[0]}addAbscissaSeparator(e,t,i,s,n){const r=this.getAbscissaBoundDimensions(_.last(this.abscissaBounds)),o=this.getPresence().generateChild().setX(r.x+r.width+.25*e+1),a=this.buildAbscissaSeparatorArea(o,e);this.buildLines(o,r,e,t);const l=this.buildTextLabel(r,e,s,i),c=this.buildEndDateLabel(r,e,n);this.addComponent(l),this.addComponent(c),this.addComponent(a),this.abscissaBounds.push({size:e,type:"separator"})}buildAbscissaSeparatorArea(e,t){return new c.RectangleComponent(e.clone()).setStyle(d.Style.Height,this.getHeight()).setStyle(d.Style.Width,.5*t).setStyle(d.Style.Color,new h.Gradient(new n.Point(.25*t,this.getHeight()),new n.Point(.25*t,0),[r.Color.GREY(.4),r.Color.WHITE(.4)]))}buildLines(e,t,i,s){for(let n=-45;n<this.getHeight();n+=15){const r=e.clone();n<2?(r.setX(t.x+t.width+.3*i+1+Math.abs(n)),r.setY(this.getHeight()-2)):r.setY(this.getHeight()-n);const o=this.getPresence().generateChild().setCoordinates(t.x+t.width+.76*i,this.getHeight()-n-.45*i),a=u.LineComponent.fromPresences(r,o).setStyle(d.Style.BorderColor,s).setStyle(d.Style.BorderThickness,1);this.addComponent(a)}}buildTextLabel(e,t,i,s){return new m.LabelComponent(this.getPresence().generateChild().setCoordinates(e.x+e.width+.45*t,this.getHeight()+14),i,(new p.LabelSettings).setColor(s).setOrigin(g.Constants.Origin.CENTER).setFontSize(12))}buildEndDateLabel(e,t,i){return new m.LabelComponent(this.getPresence().generateChild().setCoordinates(e.x+e.width+t,75.5),i,(new p.LabelSettings).setColor(new r.Color(f.END_DATE_LABEL_COLOR)).setOrigin(g.Constants.Origin.CENTER).setFontSize(16)).setStyle(d.Style.RotationAngle,90)}addAbscissaBounds(e,t,i,s,n,r){f.addBounds(this.abscissaBounds,e,t,i,s,n,r)}addOrdinateBounds(e,t,i,s,n,r){f.addBounds(this.ordinateBounds,e,t,i,s,n,r)}static addBounds(e,t,i,s,n,r,o){e.push({min:t,max:i,size:s,offset:n,step:r,type:"bounds",iterate:o||f.DEFAULT_ITERATOR})}getBoundPair(e,t){return{abscissa:this.getAbscissaBound(e),ordinate:this.getOrdinateBound(t)}}getAbscissaBound(e){return f.getBound(e,this.abscissaBounds)}getOrdinateBound(e){return f.getBound(e,this.ordinateBounds)}static getBound(e,t){return _.find(t,t=>t.min<=e&&t.max>=e)}getAbscissaBoundDimensions(e){return f.getBoundDimensions(e,this.abscissaBounds,this.offsetLeft,"x","width")}getOrdinateBoundDimensions(e){return f.getBoundDimensions(e,this.ordinateBounds,-this.offsetBottom,"y","height")}static getBoundDimensions(e,t,i=0,n,r){const o=s.Rectangle.zero();return t.forEach(t=>{t===e?(o[n]=i,o[r]=t.size):i+=t.size+(t.offset||0)}),o}setAbscissaGetter(e){this.abscissaGetter=e}setOrdinateGetter(e){this.ordinateGetter=e}getOrdinateTickSettings(){return this.ordinateTickSettings}getAbscissaTickSettings(){return this.abscissaTickSettings}setOrdinateTickSettingsEnhancer(e){this.ordinateTickSettingsEnhancer=e}setAbscissaTickSettingsEnhancer(e){this.abscissaTickSettingsEnhancer=e}addAbscissaTick(e,t){}addOrdinateTick(e,t){}calculatePositionX(e,t){const i=this.getAbscissaBoundDimensions(t);return i.x+i.width*((e-t.min)/(t.max-t.min))}calculatePositionY(e,t){const i=this.getOrdinateBoundDimensions(t);return i.y+this.getHeight()-i.height*((e-t.min)/(t.max-t.min))}calculatePosition(e,t,i,s){return new n.Point(this.calculatePositionX(e,i),this.calculatePositionY(t,s))}clearTicks(e){this.removeChildren(e),e.length=0}createDefaultAbscissaTicks(){this.clearTicks(this.abscissaTicks),this.abscissaBounds.forEach(e=>{if(void 0===e.step)return;const t=e.iterate(e.min,e.max,e.step);for(;void 0!==t.next();){const i=this.calculatePositionX(t.current,e),s=this.getPresence().generateChild().setX(i),n=this.getPresence().generateChild().setCoordinates(i,this.getHeight()),r=new a.CartesianTick(s,n,this.abscissaTickSettingsEnhancer(this.abscissaTickSettings.clone(),t.current,e.step),t.current,e.step);this.addChild(r),this.abscissaTicks.push(r)}})}createDefaultOrdinateTicks(){this.clearTicks(this.ordinateTicks),this.ordinateBounds.forEach(e=>{if(void 0===e.step)return;const t=e.iterate(e.min,e.max,e.step);for(;void 0!==t.next();){const i=this.calculatePositionY(t.current,e),s=this.getPresence().generateChild().setY(i),n=this.getPresence().generateChild().setCoordinates(this.getWidth(),i),r=new a.CartesianTick(s,n,this.ordinateTickSettingsEnhancer(this.ordinateTickSettings.clone(),t.current,e.step),t.current,e.step);this.addChild(r),this.ordinateTicks.push(r)}})}refresh(){l.logService.assertDefined(this.abscissaGetter,{name:"You need to set a getter for the X coordinate, call 'setAbscissaGetter'"}),l.logService.assertDefined(this.ordinateGetter,{name:"You need to set a getter for the X coordinate, call 'setAbscissaGetter'"}),l.logService.assert(this.abscissaBounds.length>0,"You need to set at least one set of abscissa bounds, call 'addAbscissaBounds'"),l.logService.assert(this.ordinateBounds.length>0,"You need to set at least one set of ordinate bounds, call 'addOrdinateBounds'"),this.createDefaultAbscissaTicks(),this.createDefaultOrdinateTicks(),this.children.forEach(e=>{if(_.contains(this.abscissaTicks,e)||_.contains(this.ordinateTicks,e))return;const t=this.abscissaGetter(e),i=this.ordinateGetter(e),s=this.getBoundPair(t,i);void 0!==s.abscissa&&void 0!==s.ordinate&&e.setPositionRelativeTo(this,this.calculatePosition(t,i,s.abscissa,s.ordinate))})}}f.END_DATE_LABEL_COLOR="#666",f.SKIP_ITERATOR=function(e){return(t,i=t,s=1)=>{let n=t+e;const r={current:void 0,next:()=>(r.current=n>i?void 0:n,n+=s,r.current)};return r}},f.DEFAULT_ITERATOR=f.SKIP_ITERATOR(0),t.CartesianPlane=f}),define("core/entities/components/circle_component",["require","exports","reusable_utilities","constants","style","core/graphics/primitives/circle","core/utilities/object_cache","core/utilities/presence","core/entities/components/abstract_presence_component"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let c=class extends l.PresenceComponent{constructor(e,t=!1){e instanceof a.Presence?(super(e),this.addShape(new r.Circle(0,0,e.getStyle(n.Style.Radius),e.getStyle(n.Style.Depth),t))):(super(a.Presence.PresencePool.getObject().setCoordinates(e.getX(),e.getY()).setStyle(n.Style.Radius,e.getRadius()).setStyle(n.Style.Depth,e.getDepth())),e.resetCoordinates(),this.addShape(e)),this.classType=s.Constants.ComponentClasses.Circle}getShape(){const e=o.ObjectCache.CirclePool.getObject();return e.setCoordinates(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()),e.setRadius(this.getStyle(n.Style.Radius)),e.setDepth(this.getStyle(n.Style.Depth)),e}verifyStyleChange(e){if(super.verifyStyleChange(e),this.hasShapes()){const t=this.getShapes()[0];e===n.Style.Radius&&t.setRadius(this.getStyle(e)),e===n.Style.Depth&&t.setDepth(this.getStyle(e))}return this}setShallow(e){return this.hasShapes()&&this.getShapes()[0].setShallow(e),this}draw(e){this.getPresence().isHidden()||e.drawCircle(this.getPresence())}};c=__decorate([i.meta({name:"CircleComponent"}),__metadata("design:paramtypes",[Object,Boolean])],c),t.CircleComponent=c}),define("core/entities/components/circle_segment_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/presence","style","core/graphics/primitives/circle_segment","constants","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CircleSegmentComponent=class extends i.PresenceComponent{constructor(e,t=!1){if(e instanceof s.Presence)super(e),this.addShape(new r.CircleSegment(0,0,e.getStyle(n.Style.Radius),e.getStyle(n.Style.SourceAngle),e.getStyle(n.Style.EndAngle),e.getStyle(n.Style.Depth),t));else{t&&!e.isCentralCurveComputationEnabled()&&e.enableComputationOfCentralCurves(!0);const i=new s.Presence(e.getX(),e.getY());i.setStyle(n.Style.Radius,e.getRadius()).setStyle(n.Style.SourceAngle,e.getSourceAngle()).setStyle(n.Style.EndAngle,e.getEndAngle()),e.getDepth()>0&&i.setStyle(n.Style.Depth,e.getDepth()),super(i),e.resetCoordinates(),this.addShape(e)}this.classType=o.Constants.ComponentClasses.CircleSegment}setSegmentLabel(e){return this.segmentLabel=e,this}getSegmentLabel(){return this.segmentLabel}disableBBUpdate(){this.getInnerShape().disableBBUpdate()}enableBBUpdate(){this.getInnerShape().enableBBUpdate()}getThickness(){return this.getInnerShape().getThickness()}enableComputationOfCentralCurves(e){return this.getInnerShape().enableComputationOfCentralCurves(e),this}isCentralCurveComputationEnabled(){return this.getInnerShape().isCentralCurveComputationEnabled()}getCentralPathCurves(){return this.getInnerShape().centralCurve}getContentCenter(){return this.getInnerShape().getContentCenter()}getContentDiameter(){return this.getInnerShape().getContentDiameter()}getRelativeContentCenter(){return this.getInnerShape().getRelativeContentCenter()}getBoundingBox(){return this.getShape().getBoundingBox()}setIsInflated(e){this.isInflated=e}getIsInflated(){return this.isInflated}setSequence(e){this.sequence=e}getSequence(){return this.sequence}setDoneSub(e){this.doneSub=e}getDoneSub(){return this.doneSub}getShape(){const e=a.ObjectCache.CircleSegmentPool.getObject();return e.setCoordinates(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()),e.setRadius(this.getStyle(n.Style.Radius)),e.setDepth(this.getStyle(n.Style.Depth)),e.setSourceAngle(this.getStyle(n.Style.SourceAngle)),e.setEndAngle(this.getStyle(n.Style.EndAngle)),e}getInnerShape(){return this.getShapes()[0]}verifyStyleChange(e){return super.verifyStyleChange(e),this.hasShapes()&&(e===n.Style.Radius?this.getInnerShape().setRadius(this.getStyle(e)):e===n.Style.SourceAngle?this.getInnerShape().setSourceAngle(this.getStyle(e)):e===n.Style.EndAngle?this.getInnerShape().setEndAngle(this.getStyle(e)):e===n.Style.Depth&&this.getInnerShape().setDepth(this.getStyle(e))),this}setShallow(e){return this.hasShapes()&&this.getInnerShape().setShallow(e),this}draw(e){this.getPresence().isHidden()||e.drawCircle(this.getPresence())}}}),define("core/entities/components/curved_label_component",["require","exports","core/entities/components/label_component","underscore","core/utilities/presence","constants","style","core/utilities/utilities","core/graphics/primitives/rectangle","map","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class h extends i.LabelComponent{constructor(e,t,i,n){super(e,t,n,!0),this.transformationPresences=new c.Map,this.SIZE_SHADOW_FACTOR=6.1,s.isArray(i)?i.forEach(e=>this.addShape(e)):this.addShape(i),this.path=i,this.classType=r.Constants.ComponentClasses.CurvedLabel,this.labelOrientation=r.Constants.Orientation.HORIZONTAL,this.setText(t),this.setOrigin(r.Constants.Origin.TOP_LEFT)}static fromPath(e,t,i){const s=n.Presence.zeroTopLeft();return new h(s,e,t,i)}buildWordParts(e,t,i){const s=[];let n="";for(let r=0,o=0,a=0;r<e.length;r++){const l=t.startingIndex+a,c=0===a?t.leftOverLength:0;i.letterWidths[r]+o+c>i.curveLengths[l]&&(s.push(n),a++,o=0,n=""),n+=e[r],o+=i.letterWidths[r]}return""!==n&&s.push(n),s}buildString(e,t=1){const i=this.getSettings().getFont().setSize(1);this.getSettings().isReversed()&&(e=e.split("").reverse().join(""));const n=this.prepareBuildParameters(i,e);if(n.text=e,n.zoomLevel=t,n.pathLength>=n.totalWidth)if(s.isArray(this.path)){const t=this.prepareAdjustmentParameters(n);if(n.adjustmentParams=t,t.splitText){const s=this.buildWordParts(e,t,n),r=[];s.forEach((e,t)=>{0===t?r.push(0):r.push(r[t-1]+s[t-1].length)}),s.forEach((e,s)=>{const o=t.startingIndex+s;let a=0;0===s&&0!==n.curveLengths[o]&&(a=t.leftOverLength/n.curveLengths[o]),this.buildLetterPresences(a,e,i,n.pathArray[o],n,r[s],0!==s)})}else{let s=0;0!==n.curveLengths[t.startingIndex]&&(s=t.leftOverLength/n.curveLengths[t.startingIndex]),this.buildLetterPresences(s,e,i,n.pathArray[t.startingIndex],n)}}else this.buildLetterPresences((n.pathLength-n.totalWidth)/(2*n.pathLength),e,i,n.path,n);return this}prepareAdjustmentParameters(e){const t={},i=(1-e.ratio)/2;t.startingIndex=0;let s=0;for(;(e.curveLengths[t.startingIndex]+s)/e.pathLength<i;)s+=e.curveLengths[t.startingIndex],t.startingIndex++;return t.leftOverLength=i*e.pathLength-s,t.splitText=e.totalWidth+t.leftOverLength>e.curveLengths[t.startingIndex],t}forceApplyAdaptations(e,t=1){return this}prepareBuildParameters(e,t){const i={};s.isArray(this.path)?(i.pathArray=this.path,i.pathLength=i.pathArray.reduce((e,t)=>e+t.getLength(),0),i.curveLengths=i.pathArray.map(e=>e.getLength())):(i.path=this.path,i.pathLength=i.path.getLength());const n=a.Utilities.measureText(t,e),r=this.getSettings().getSpacingMultiplier(),l=Math.max(Math.floor(i.pathLength/(n.width*Math.pow(r,2))),.001);return this.getStyle(o.Style.Font).setSize(l),e.setSize(l),i.totalWidth=0,i.letterWidths=s.map(t,t=>{const s=a.Utilities.measureText(t,e);i.totalWidth+=s.width*r;const n=s.width*r;return d.ObjectCache.recycleObject(s),n}),i.ratio=i.totalWidth/i.pathLength,d.ObjectCache.recycleObject(n),i}buildLetterPresences(e,t,i,s,a,l=0,c=!1){if(s.getLength()>0)for(let d=0,h=e;d<t.length;d++){const e=d+l,u=t[d],p=a.letterWidths[e]/s.getLength();let g,m,_;c&&0===d?h=p+(_=-p/4*s.getLength()/a.pathLength):(_=p/2+h,h+=p),m=-s.getSlopeAngleForT(_),this.getSettings().isTextFlipped()&&(m+=180),g=s.getCurveParametricPoint(_);const f=n.Presence.PresencePool.getObject(this.getPresence());f.translate(g.x,g.y),f.setStyle(o.Style.RotationAngle,m).setStyle(o.Style.Opacity,e=>e).setOrigin(r.Constants.Origin.CENTER).setStyle(o.Style.Width,Math.floor(a.letterWidths[e]/a.zoomLevel)).setStyle(o.Style.Height,Math.floor(i.getSize()/a.zoomLevel)),this.transformationPresences.set(u+e,f.clone()),this.linePositions.set(u+e,f)}}formatText(e=!1,t=!1){this.resetAdjustments(),this.computeFont(),this.resetDimension();const i=this.isAbsolute()?1:this.getZoom();this.buildString(this.textSlips[0],i);const s=new l.Rectangle(0,0,this.getStyle(o.Style.Width)/i,this.getStyle(o.Style.Height)/i);return this.addShape(s),e||this.setPositionRelativeToAlignment(),this.setPositionRelativeToBaseLine(),this.updateOrigin(i),t||this.invalidate(),this}setText(e){return this.textSlips=[],this.textSlips.push(e),this.formatText(),this}update(){this.updateOrigin(this.getZoom());const e=Math.floor(this.getSettings().getFontSize()/this.SIZE_SHADOW_FACTOR);this.getStyle(o.Style.ShadowBlur)>e&&this.setStyle(o.Style.ShadowBlur,e)}draw(e){!this.isHidden()&&this.linePositions.size>0&&this.fontSize>=1&&this.textSlips.forEach(t=>{for(let i=0;i<t.length;i++){const s=t[i],n=this.getSettings().isReversed()?t.length-1-i:i,r=this.linePositions.get(s+n);if(r.hasStyle(o.Style.RotationAngle)){const t=this.transformationPresences.get(s+n);t.getAbsoluteX()!==r.getAbsoluteX()&&t.setX(r.getAbsoluteX()),t.getAbsoluteY()!==r.getAbsoluteY()&&t.setY(r.getAbsoluteY()),e.drawLetter(r,s,t)}else e.drawText(r,s)}})}dispose(){this._disposed=!0,super.dispose(),this.onFontSizeAdapted.cancelAll(),this.onBeforeApplyAdaptations.cancelAll(),this.onMultilineAdapted.cancelAll()}}t.CurvedLabelComponent=h}),define("core/entities/components/polygon_component",["require","exports","core/entities/components/abstract_presence_component","core/utilities/presence","style","core/graphics/primitives/polygon","constants","core/utilities/object_cache"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PolygonComponent=class extends i.PresenceComponent{constructor(e,t=[]){e instanceof s.Presence?(super(e),this.addShape(new r.Polygon(0,0,t))):(super(new s.Presence(e.getX(),e.getY())),e.resetCoordinates(),this.addShape(e)),this.classType=o.Constants.ComponentClasses.Polygon}updateDimensions(){this.getPresence().setStyle(n.Style.Width,super.getShapes()[0].getWidth()).setStyle(n.Style.Height,super.getShapes()[0].getHeight())}getPoints(){return super.getShapes()[0].getPoints()}getMinX(){return super.getShapes()[0].getMinX()}getMinY(){return super.getShapes()[0].getMinY()}addPoint(e){return super.getShapes()[0].addPoint(e),this.updateDimensions(),this}getReturnToSource(){return super.getShapes()[0].getReturnToSource()}setReturnToSource(e){return super.getShapes()[0].setReturnToSource(e),this}getShape(){const e=a.ObjectCache.PolygonPool.getObject();return e.setCoordinates(this.getPresence().getAbsoluteX(),this.getPresence().getAbsoluteY()),e.setReturnToSource(super.getShapes()[0].getReturnToSource()),super.getShapes()[0].getPoints().forEach(t=>{const i=a.ObjectCache.PointPool.getObject().merge(t);e.addPoint(i)}),e}draw(e){this.getPresence().isHidden()||e.drawPolygon(this.getPresence(),this.getPoints(),this.getReturnToSource())}}}),define("core/graphics/animation/timeline_state",["require","exports","constants"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TimelineState=class{constructor(e){this.isReversed=!1,this.isSynced=!1,this.isSilentlyPaused=!1,this.isInInitialState=!0,this.isWaiting=!1,this.isRewinding=!1,this.isInFocus=!0,this.considersFocus=!0,this.animationState=i.Constants.State.Animation.Ready,e&&(this.considersFocus=e,this.isInFocus=window.document.hasFocus())}}}),define("core/graphics/animation/sequence_timeline",["require","exports","reusable_utilities","constants","core/graphics/animation/timeline_state","event","core/utilities/facades/sequence_facade","log","core/utilities/utilities","underscore"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d{constructor(e=!1){this.timeline=[],this.callbacks=[],this.pauses=[],this.activeItems=[],this.ticks=[],this.subscriptions=[],this.params={endProgress:1},this.delayAdditive=0,this.onDone=new r.Event,this.onPlay=new r.Event,this.onLoseInitialState=new r.Event,this.onPlayBySpeed=new r.Event,this.onPlayOverTime=new r.Event,this.onPause=new r.Event,this.onDelay=new r.Event,this.onSetProgressCall=new r.Event,this.onReset=new r.Event,this.onStep=new r.Event,this.onStop=new r.Event,this.onReverse=new r.Event,this.focusCallback=(()=>{this.state.isInFocus=!0,this.state.isSilentlyPaused&&(this.state.isSilentlyPaused=!1,this.playByParams(this.params))}),this.blurCallback=(()=>{this.state.isInFocus=!1,this.isPlaying()&&(this.pause(!0),this.state.isSilentlyPaused=!0)}),this.state=new n.TimelineState(e),e&&(window.addEventListener("focus",this.focusCallback),window.addEventListener("blur",this.blurCallback)),this.params.progress=0,this.params.duration=0}verifyValuePositive(e){a.logService.assert(e>=0,"value must be positive or 0",s.Constants.Feature.Animations.SequenceTimeline,this)}validateState(){this.getState().isInInitialState&&(this.getState().isInInitialState=!1,this.onLoseInitialState.fire())}cleanState(){this.getState().isWaiting&&(this.getState().isInFocus||void 0===this.pauseCallback||this.validateState(),clearTimeout(this.getParams().pauseId),this.getParams().pauseId=void 0)}setDuration(e){return this.getParams().duration=e,this}getDuration(){return this.getParams().duration}setTime(e){return this.getParams().time=e,this}getTime(){return this.getParams().time}setTimestamp(e){return this.getParams().timestamp=e,this}getTimestamp(){return this.getParams().timestamp}getState(){return this.state}setState(e){return this.getState().animationState=e,this}getParams(){return this.params}getProgress(){return this.getParams().progress}setProgressByTime(e){this.setProgress(e/this.getTime())}addProgress(e){this.getParams().progress=l.Utilities.clamp(this.getParams().progress+e,0,1);const t=this.getState().isReversed?0:this.getParams().endProgress;return this.getParams().progress>=t&&(this.getParams().progress=t,this.done()),this}setProgress(e,t){this.validateState();const i=e*this.getDuration(),s=this.getProgress(),n=this.timeline.filter(t=>e>s?t.delay<=i:t.delay>=i);this.getParams().progress=l.Utilities.clamp(e,0,1),this.getState().isRewinding=e<s,this.triggerCallbacks(s),this.addActiveItems(n),this.conductStep(e,t),this.onSetProgressCall.fire(e)}setSpeed(e){const t=this.getParams().speed;void 0!==t&&t!==e&&(this.getParams().speed=e,this.adjustTime())}adjustDuration(e){return(void 0===this.getParams().duration||this.getParams().duration<e)&&(this.setDuration(e),!0)}adjustTime(){const e=this.getParams().duration/this.getParams().speed;return this.getTime()!==e&&(this.setTime(e),!0)}static extractSequence(e){return e instanceof o.SequenceFacade?e.getSequence():e}evaluateByDuration(){const e=c.max(this.timeline,e=>e.delay+e.sequence.getDuration(),0),t=c.max(this.callbacks,e=>e.delay);this.adjustDuration(Math.max(e,t))&&this.adjustTime()}setDelayAdditive(e){return this.delayAdditive=e,this}addSequence(e,t=0){t+=this.delayAdditive,this.verifyValuePositive(t),e=d.extractSequence(e);const i=this.timeline.filter(e=>e.delay<=t).length;this.adjustDuration(t+e.getDuration()),this.timeline.splice(i,0,{sequence:e,delay:t})}removeSequence(e){e=d.extractSequence(e);const t=this.timeline.filter(t=>t.sequence===e)[0];this.timeline.splice(this.timeline.indexOf(t),1),this.evaluateByDuration()}addCallback(e,t,i){this.verifyValuePositive(t);const s=this.callbacks.filter(e=>e.delay<=t).length;this.adjustDuration(t),this.callbacks.splice(s,0,{callback:e,delay:t}),i&&i.registerCleanupFunction(()=>{this.removeCallback(e)})}removeCallback(e){const t=this.callbacks.filter(t=>t.callback===e)[0];this.callbacks.splice(this.callbacks.indexOf(t),1),this.evaluateByDuration()}addPause(e,t,i,s,n,r=this,o){e=l.Utilities.clamp(e,0,1),t=l.Utilities.simplify(t),this.verifyValuePositive(t);const a=this.pauses.filter(t=>t.progress===e);if(a.length>0){const o=l.Utilities.simplify(a[0].duration),c={progress:e,duration:Math.max(o,t),condition:()=>a[0].condition()||i(),callback:()=>{o<t?(a[0].callback.apply(a[0].context,a[0].args),s.apply(r,n)):(s.apply(r,n),a[0].callback.apply(a[0].context,a[0].args))},args:n,context:r};this.pauses.splice(this.pauses.indexOf(a[0]),1,c)}else{const a=this.pauses.filter(t=>t.progress<=e).length,l={progress:e,duration:t,condition:i,callback:s,args:n,context:r};this.pauses.splice(a,0,l),o&&o.registerCleanupFunction(()=>this.removePause(l))}}removePause(e){const t=this.pauses.filter(t=>t.progress===e)[0];this.pauses.splice(this.pauses.indexOf(t),1)}fireEvent(e,t,...i){t||this[e].fire.apply(this[e],i)}playBySpeed(e,t=1,i=!1){this.getParams().endProgress=l.Utilities.clamp(t,0,1),this.setSpeed(e),this.fireEvent("onPlayBySpeed",i,e),this.play(i)}playOverTime(e,t=1,i=!1){this.fireEvent("onPlayOverTime",i,i),this.getParams().endProgress=l.Utilities.clamp(t,0,1),0===e?this.skipToEnd():(this.setTime(e),this.play(i))}playByParams(e){this.playBySpeed(e.speed,e.endProgress,e.silent)}play(e){this.validateState(),this.cleanState(),this.isPlaying()&&this.stop(),this.isDelayed()||this.fireEvent("onPlay",e),this.setState(s.Constants.State.Animation.Playing),this.setTimestamp(Date.now()),this.proceed()}proceed(){this.isPaused()||this.conductStep(),this.isPlaying()&&(this.ticks.length>0&&this.cancelTicks(),this.ticks.push(this.requestNextTick(()=>this.proceed())))}requestNextTick(e){return this.getState().isInFocus?{id:i.AnimationLoop.requestAnimationFrame(e),type:s.Constants.TimeoutTypes.AnimationFrame,callback:e,cancel(){i.AnimationLoop.cancelAnimationFrame(this.id)}}:(this.pause(!0),this.getState().isSilentlyPaused=!0,{cancel:c.noop})}cancelTicks(){this.ticks.forEach(e=>e.cancel()),this.ticks.length=0}pause(e){this.setState(s.Constants.State.Animation.Paused),this.cleanState(),this.cancelTicks(),this.fireEvent("onPause",e),this.state.isSilentlyPaused=e}wait(e){this.setState(s.Constants.State.Animation.Delayed);const t=l.Utilities.simplify(e.duration);this.pauseCallback=(t=>{this.pauseCallback=void 0,this.getParams().pauseId=void 0,e.callback.apply(e.context,e.args),t||this.playOverTime(this.getTime(),this.getParams().endProgress)}),this.getState().isInFocus?this.getParams().pauseId=setTimeout(this.pauseCallback,t):this.validateState(),this.onDelay.fire()}stop(){this.cleanState(),this.setState(s.Constants.State.Animation.Stopped),this.onStop.fire(),this.cancelTicks(),this.timeline.forEach(e=>e.sequence.stop())}done(){this.setState(s.Constants.State.Animation.Done),this.onDone.fire()}skipToEnd(){this.setTime(this.getDuration()),this.setProgress(this.getState().isReversed?0:1),this.isPlaying()&&this.stop()}applyNextProgressValue(e){const t=Date.now(),i=t-this.getTimestamp();this.setTimestamp(t);let s=i/this.getTime();return this.getState().isReversed&&(s*=-1),this.addProgress(s),this.getState().isRewinding=e>this.getProgress(),e}checkForPause(e,t){if(void 0===t&&this.isPlaying()){const i=c.chain(this.pauses).filter(e=>e.progress<=this.getProgress()).filter(t=>t.progress>e).value();if(i.length>0)return(void 0===(t=i[i.length-1]).condition||l.Utilities.simplify(t.condition))&&(this.getParams().progress=e,this.cancelTicks(),this.setProgress(t.progress,t)),t}}triggerCallbacks(e){const t=this.getDuration();this.callbacks.filter(i=>this.getProgress()>e?i.delay>=e*t&&i.delay<=this.getProgress()*t:i.delay<=e*t&&i.delay>=this.getProgress()*t).forEach(t=>{t.callback(this.getProgress()<e)})}checkForNewItemsByProgress(e,t){const i=e*this.getDuration(),s=t*this.getDuration(),n=this.timeline.filter(e=>e.delay>=s&&e.delay<=i);this.addActiveItems(n)}checkForNewItemsByItem(e){const t=this.timeline.filter(t=>t.delay<=e&&t.delay+t.sequence.getDuration()>e);this.addActiveItems(t)}addActiveItems(e){c.chain(e).filter(e=>this.activeItems.indexOf(e)<0).forEach(e=>this.activeItems.push(e))}applyCalculations(e){const t=[];this.activeItems.forEach(i=>{const s=l.Utilities.clamp((e-i.delay)/i.sequence.getDuration(),0,1);s===(this.getState().isReversed?0:1)&&t.push(i),i.sequence.setProgress(s)}),t.forEach(e=>this.activeItems.splice(this.activeItems.indexOf(e),1))}conductStep(e,t){if(void 0===e){const e=this.getProgress();this.applyNextProgressValue(e),t=this.checkForPause(e,t),this.triggerCallbacks(e),this.checkForNewItemsByProgress(this.getProgress(),e)}this.onStep.fire(this.getProgress());const i=this.getProgress()*this.getDuration();this.checkForNewItemsByItem(i),this.applyCalculations(i),this.isDone()&&this.isPlaying()&&this.stop(),void 0!==t&&this.wait(t)}clearTimedPause(){this.getState().isWaiting&&(this.getState().isInFocus||void 0===this.pauseCallback||this.validateState(),clearTimeout(this.getParams().pauseId),this.getParams().pauseId=void 0)}setReverseState(e){this.getState().isReversed!==e&&this.reverse()}reverse(){return this.onReverse.fire(),this.getState().isReversed=!this.getState().isReversed,this}reset(){this.clearTimedPause(),this.isReady()||(this.onReset.fire(),this.isStopped()||this.isPaused()||this.stop(),this.setState(s.Constants.State.Animation.Ready),this.getParams().time=void 0,this.getParams().speed=void 0,this.resetTimeline())}resetTimeline(e){this.isPlaying()&&this.stop(),this.getParams().progress=0,e&&(this.getState().isInInitialState=!0),this.timeline.forEach(e=>e.sequence.reset())}removeEvents(){this.onDone.cancelAll(),this.onPlay.cancelAll(),this.onLoseInitialState.cancelAll(),this.onPlayBySpeed.cancelAll(),this.onPlayOverTime.cancelAll(),this.onPause.cancelAll(),this.onDelay.cancelAll(),this.onSetProgressCall.cancelAll(),this.onReset.cancelAll(),this.onStep.cancelAll(),this.onStop.cancelAll(),this.onReverse.cancelAll()}dispose(){a.logService.verbose("sequence timeline destroyed",s.Constants.Feature.Animations.SequenceTimeline,this),this.removeEvents(),this.getState().isSynced&&this.unsync(),this.cleanState(),this.setState(s.Constants.State.Animation.Stopped),this.cancelTicks(),this.timeline.forEach(e=>e.sequence.dispose()),this.timeline.length=0,this.callbacks.length=0,this.pauses.length=0,this.activeItems.length=0,this.getState().considersFocus&&(window.removeEventListener("focus",this.focusCallback),window.removeEventListener("blur",this.blurCallback))}syncToTimeline(e,t){this.getState().isSynced&&t&&this.unsync(),this.getState().isSynced?a.logService.error("You're trying to sync this timeline to another while it is already synced to one. If this is intentional, either unsync first or set the forceSync parameter to true.",s.Constants.Feature.Animations.SequenceTimeline,this):(this.subscriptions.push(e.onSetProgressCall.subscribe(this.setProgress,this)),this.subscriptions.push(e.onStep.subscribe(this.setProgress,this)),this.subscriptions.push(e.onReset.subscribe(this.reset,this)),this.subscriptions.push(e.onReverse.subscribe(this.reverse,this)),this.getState().isSynced=!0)}unsync(){this.subscriptions.forEach(e=>e.cancel()),this.subscriptions.length=0,this.getState().isSynced=!1}isReady(){return this.getState().animationState===s.Constants.State.Animation.Ready}isDone(){return this.getState().animationState===s.Constants.State.Animation.Done}isPaused(){return this.getState().animationState===s.Constants.State.Animation.Paused}isStopped(){return this.getState().animationState===s.Constants.State.Animation.Stopped}isPlaying(){return this.getState().animationState===s.Constants.State.Animation.Playing}isDelayed(){return this.getState().animationState===s.Constants.State.Animation.Delayed}isReturning(){return this.getState().isRewinding}}t.Timeline=d}),define("canvas_engine",["require","exports","constants","core/entities/cartesian/cartesian_plane","core/entities/cartesian/cartesian_tick","core/entities/components/abstract_component","core/entities/components/abstract_presence_component","core/entities/components/animation_component","core/entities/components/circle_component","core/entities/components/circle_segment_component","core/entities/components/curved_label_component","core/entities/components/image_component","core/entities/components/label_component","core/entities/components/line_component","core/entities/components/polygon_component","core/entities/components/rectangle_component","core/entities/entity","core/entities/rectangle","core/generic_engine_interfaces","core/gradient","core/graphics/animation/animation","core/graphics/animation/sequence","core/graphics/animation/sequence_timeline","core/graphics/animation/tween","core/graphics/font","core/graphics/primitives/circle","core/graphics/primitives/circle_segment","core/graphics/primitives/cubic_curve","core/graphics/primitives/line","core/graphics/primitives/point","core/graphics/primitives/polygon","core/graphics/primitives/quadratic_curve","core/graphics/primitives/rectangle","core/graphics/primitives/shape","core/graphics/primitives/vector","core/graphics/stage/cameras/abstract_camera","core/graphics/stage/cameras/camera_2d","core/graphics/stage/layer","core/graphics/stage/queued_event","core/graphics/stage/scene","core/graphics/stage/stage","core/graphics/style_map","core/models/animation_model","core/models/tweening_model","core/utilities/abstract_stage_node","core/utilities/abstract_state_object","core/utilities/dimension","core/utilities/dimensions_calculator","core/utilities/facades/sequence_facade","core/utilities/facades/stage_facade","core/utilities/mouse_service","core/utilities/object_cache","core/utilities/origin","core/utilities/presence","core/utilities/unit","core/utilities/utilities","factories/factory","settings/camera_settings","settings/cartesian_tick_settings","settings/draw_settings","settings/label_settings","settings/stage_settings","style"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T,I,w,A,O,M,L,P,x,D,R,N,k,F,B,U,H,G,j,V,q,W,z,Y,X,K,$,Z,Q,J,ee,te,ie,se,ne,re,oe,ae,le){"use strict";function ce(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),ce(i),ce(s),ce(n),ce(r),ce(o),ce(a),ce(l),ce(c),ce(d),ce(h),ce(u),ce(p),ce(g),ce(m),ce(_),ce(f),ce(y),ce(b),ce(E),ce(S),ce(C),ce(v),ce(T),ce(I),ce(w),ce(A),ce(O),ce(M),ce(L),ce(P),ce(x),ce(D),ce(R),ce(N),ce(k),ce(F),ce(B),ce(U),ce(H),ce(G),ce(j),ce(V),ce(q),ce(W),ce(z),ce(Y),ce(X),ce(K),ce($),ce(Z),ce(Q),ce(J),ce(ee),ce(te),ce(ie),ce(se),ce(ne),ce(re),ce(oe),ce(ae),ce(le)}),define("collision_map/mouse_interaction_layer",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MouseInteractionLayer=class{constructor(){this.drawOffset=new i.Vector2D(0,0),this.testPoint=new i.Point(i.Vector2D.zero()),this.shapes=[]}getOverlaps(e){const t=[];for(let i=this.shapes.length-1;i>=0;i--)this.checkOverlap(e,this.shapes[i],[0,0],t);return t}checkOverlap(e,t,s,n){if(t.children)for(let i=t.children.length-1;i>=0;i--){let r=[...s];!1!==t.children[i].inheritParentPosition?(r[0]+=t.shape.position.x,r[1]+=t.shape.position.y):r=[0,0],this.checkOverlap(e,t.children[i],r,n)}this.testPoint.position.x=e.x-s[0],this.testPoint.position.y=e.y-s[1],i.collisionCalculator.isOverlapping(this.testPoint,t.shape)&&n.push(t)}}}),define("input_enhancers/interaction_enhancer",["require","exports","jquery","math_utils","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InteractionEnhancer=class{constructor(e){this.mousedownTargets=[],this.interactionLayer=e,this.cancellationToken=new n.CancellationToken,this.cancellationToken.addDomEvent(i(document),"mouseleave",e=>{this.documentLeaveHander(e)})}documentLeaveHander(e){n.AnimationLoop.requestDelay(()=>{void 0!==this.previousHoverResult&&(this.previousHoverResult.emitEvent("mouseleave",e),this.previousHoverResult=void 0)},20)}canvasLeave(e,t,s){n.AnimationLoop.requestDelay(()=>{if(void 0!==this.previousHoverResult){const t=i(e.target),s=t.offset(),n=e.clientX+window.scrollX,r=e.clientY+window.scrollY;s.left<n&&s.top<r&&s.left+t.width()>n&&s.top+t.height()>r||(this.previousHoverResult.emitEvent("mouseleave",e),this.previousHoverResult=void 0)}},20)}adjustPoint(e,t,i){void 0!==this.interactionLayer.drawOffset&&e.sub(this.interactionLayer.drawOffset),t&&i&&(e.x=(e.x-t.x)/i,e.y=(e.y-t.y)/i)}mouseDown(e,t,i){const n=new s.Vector2D(e.offsetX,e.offsetY);this.adjustPoint(n,t,i);const r=this.interactionLayer.getOverlaps(n);for(const t of r){if(e.isPropagationStopped())break;t.emitEvent("mousedown",e)}this.mousedownTargets=r}mouseUp(e,t,i){const n=new s.Vector2D(e.offsetX,e.offsetY);this.adjustPoint(n,t,i);const r=this.interactionLayer.getOverlaps(n);for(const t of r){if(e.isPropagationStopped())break;t.emitEvent("mousedown",e)}this.mousedownTargets.forEach(t=>{r.includes(t)&&t.emitEvent("mouseup",e)})}mouseMove(e,t,i){void 0===this.mouseMoveId&&(this.mouseMoveId=n.AnimationLoop.requestDelay(()=>{this.mouseMoveId=void 0;const n=new s.Vector2D(e.offsetX,e.offsetY);this.adjustPoint(n,t,i);const r=this.interactionLayer.getOverlaps(n),o=_.last(r.filter(e=>e.getSubscriptionCount("mouseenter")>0));if(void 0===this.previousHoverResult&&void 0!==o)o.emitEvent("mouseenter",e),this.previousHoverResult=o;else if(void 0!==this.previousHoverResult&&o!==this.previousHoverResult)this.previousHoverResult.emitEvent("mouseleave",e),void 0!==o?(o.emitEvent("mouseenter",e),this.previousHoverResult=o):this.previousHoverResult=void 0;else{const t=_.last(r.filter(e=>e.getSubscriptionCount("mousemove")>0));void 0!==t&&t.emitEvent("mousemove",e)}},20))}dispose(){this.cancellationToken.cancel()}}}),define("canvas_interaction_utils",["require","exports","collision_map/mouse_interaction_layer","input_enhancers/interaction_enhancer"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("interfaces/model_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TEXT=0]="TEXT",e[e.IMAGE=1]="IMAGE"}(t.CloudModelItemType||(t.CloudModelItemType={})),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.MIXED=1]="MIXED"}(t.CloudModelOrientation||(t.CloudModelOrientation={}))}),define("classes/utils/gradient_wrapper",["require","exports","math_utils","graphics_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.steps=e,this.totalValues=0,this.totalValues=this.steps.reduce((e,{maxValue:t})=>t+e,0)}getStepColor(e){return s.Color.fromHSL(_.find(this.steps,({name:t})=>t===e).hsl)}getColorForValues(e){let t=0,n=0,r=0;const o=Object.keys(e).reduce((t,i)=>e[i]+t,0);return this.steps.forEach(i=>{const s=e[i.name]/o;t+=i.hsl.x*s,n+=i.hsl.y*s,r+=i.hsl.z*s}),s.Color.fromHSL(new i.Vector3D(t,n,r))}getPercentageBasedPosition(e){const[t,i]=this.getClosestToHue(e),s=e/(t.hsl.x+i.hsl.x);let n=0;for(let e=0;e<this.steps.indexOf(t);e++)n+=this.steps[e].maxValue;return(n+s*t.maxValue)/this.totalValues}getClosestToHue(e){let t=0,i=[n.emptyStep,n.emptyStep],s=Number.MAX_VALUE;for(const r of this.steps){t++;const o=Math.abs(r.hsl.x-e);o<s&&(i=[r,this.steps[t]||n.emptyStep],s=o)}return i}getClosestToSteps(e){const t=this.steps.map(({name:t,hsl:i})=>({hue:e[0],index:0,stepHue:i.x,name:t}),{});for(let i=0;i<e.length;i++){const s=e[i];for(const e of t)Math.abs(s-e.stepHue)<Math.abs(e.hue-e.stepHue)&&(e.hue=s,e.index=i)}return t}}n.emptyStep={hsl:new i.Vector3D(0,0,0),maxValue:0,name:"EMPTY"},t.GradientWrapper=n}),define("classes/cloud_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DARK=0]="DARK",e[e.LIGHT=1]="LIGHT",e[e.NAVY=2]="NAVY"}(t.CloudThemeType||(t.CloudThemeType={}))}),define("interfaces/data_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LINEAR="linear",e.LOGARITHMIC="logarithmic",e.MIXED="mixed"}(t.CloudFontSizingStrategy||(t.CloudFontSizingStrategy={})),function(e){e.CIRCLE="circle",e.RECTANGLE="rectangle"}(t.CloudPositioningShape||(t.CloudPositioningShape={}))}),define("classes/utils/cloud_text",["require","exports","graphics_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CloudText=class extends i.DrawableText{toSerializable(){const e=super.toSerializable();return e.additionalData=this.additionalData,e}}}),define("classes/utils/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.IMAGE=0]="IMAGE",e[e.TEXT=1]="TEXT"}(t.CloudItemType||(t.CloudItemType={}))}),define("classes/utils/bitmap",["require","exports","math_utils","interfaces/data_interfaces","object_pool"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,i=!1){this.hasSprite=!1,this.width=Math.ceil(e*t),this.height=e,this.map=Array(Math.floor((this.width>>5)*this.height)).fill(0),this.mixedRadius=i}rectangleRadius(e){return Math.min(1/Math.abs(Math.cos(e)),1/Math.abs(Math.sin(e)))}circleRadius(e){return this.mixedRadius?.65+.35*this.rectangleRadius(e):1}getPositionGenerator(e,t=!1){let i=Math.PI;const n=[void 0,void 0],r=this.width/this.height,o=e===s.CloudPositioningShape.CIRCLE?this.circleRadius.bind(this):this.rectangleRadius;return()=>{let e=[0,0];do{const t=Math.floor(i/Math.PI),s=o(i);e=[Math.floor(r*t*Math.cos(i)*s),Math.floor(t*Math.sin(i)*s)],i+=2*Math.PI/(8*Math.max(t/30,1))}while(e[0]===n[0]&&e[1]===n[1]);return n[0]=e[0],n[1]=e[1],e[0]+=Math.floor(this.width/2),e[1]+=Math.floor(this.height/2),e}}spriteCollides(e,t){const i=(t[1]-(e.height>>1))*(this.width>>5)+(t[0]-(e.width>>5<<4)>>5),s=t[0]-(e.width>>5<<4)&31,n=32-s;for(let t=0;t<e.height;t+=1){let r=0;for(let o=0;o<=e.width>>5;o+=1)if(((32!==n?r<<n:0)|(o<e.width>>5?(r=e.pixels[t*(e.width>>5)+o])>>>s:0))&this.map[i+t*(this.width>>5)+o])return!0}return!1}addSprite(e,t){this.hasSprite=!0;const i=(t[1]-(e.height>>1))*(this.width>>5)+(t[0]-(e.width>>5<<4)>>5),s=t[0]-(e.width>>5<<4)&31,n=32-s;for(let t=0;t<e.height;t+=1){let r=0;for(let o=0;o<=e.width>>5;o+=1)this.map[i+t*(this.width>>5)+o]|=(32!==n?r<<n:0)|(o<e.width>>5?(r=e.pixels[t*(e.width>>5)+o])>>>s:0)}}}r.vectorPool=new n.Pool({initialSize:1,dynamic:!0,factory:()=>i.Vector2D.zero(),metricName:"bit_map_vector_2d"}),t.BitMap=r}),define("classes/utils/sprite_factory",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static reset(e,t){this.ctx.canvas.width=e,this.ctx.canvas.height=t,this.ctx.fillStyle="red",this.ctx.strokeStyle="red",this.ctx.textAlign="center",this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}static rotate(e,t,i){const s=Math.PI/180*i,n=Math.cos(s),r=Math.sin(s);return[n*e+r*t,n*t-r*e]}static getRotatedDimensions(e,t,i){if(0===i)return[e,t];const[s,n]=this.rotate(0,0,i),[r,o]=this.rotate(e,t,i),a=Math.min(s,r),l=Math.min(n,o);return[Math.max(s,r)-a,Math.max(n,o)-l]}static getTextWidth(e,t){return this.ctx.font=e,Math.ceil(this.ctx.measureText(t).width)}static getTextSprite(e){let t=this.getTextWidth(e.fontWeight+" "+e.size+"px "+e.fontFamily,e.text)+2*e.padding,i=e.size+2*e.padding;this.reset(1.5*Math.max(i,t),1.5*Math.max(i,t)),this.ctx.save(),this.ctx.font=`${e.fontWeight} normal ${e.size}px ${e.fontFamily}`;const s=this.getRotatedDimensions(t,i,e.rotation);t=s[0]+31>>5<<5,i=s[1]+31>>5<<5,t=t+31>>5<<5,this.ctx.translate(t/2,i/2),this.ctx.rotate(e.rotation*Math.PI/180),this.ctx.textBaseline="middle",this.ctx.fillText(e.text,0,0),this.ctx.lineWidth=e.padding,this.ctx.strokeText(e.text,0,0),this.ctx.restore();const n=this.ctx.getImageData(0,0,t,i).data;return this.extractSpriteData(n,t,i,!1)}static scaleToSize(e,t,i){return t>i?(i*=e/t,t=e):(t*=e/i,i=e),[Math.round(t),Math.round(i)]}static extractSpriteData(e,t,i,s){const n={width:t,height:i,pixels:[]};for(let t=0;t<n.height;t+=1)for(let i=0;i<n.width;i+=1){const r=(n.width>>5)*t+(i>>5),o=e[t*n.width+i<<2]?1<<31-i%32:0;s&&o>0?n.pixels[r]=999999999999:n.pixels[r]|=o}return n}static getImageSprite(e){let[t,i]=this.scaleToSize(e.size+31>>5<<5,e.imageElement.naturalWidth,e.imageElement.naturalHeight);if(isNaN(t)||isNaN(i))return{width:t=e.size+31>>5<<5,height:i=t,pixels:Array((t>>5)*i).fill(4294967295)};this.reset(t,i),this.ctx.save(),this.ctx.drawImage(e.imageElement,0,0,t,i),this.ctx.restore();const s=this.ctx.getImageData(0,0,t,i).data;return this.extractSpriteData(s,t,i,!0)}}s.ctx=document.createElement("canvas").getContext("2d"),__decorate([i.memoize((e,t,i)=>`${e}|${t}|${i}`),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number]),__metadata("design:returntype",Array)],s,"getRotatedDimensions",null),__decorate([i.memoize((e,t)=>`${e}|${t}`),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String]),__metadata("design:returntype",Number)],s,"getTextWidth",null),t.SpriteFactory=s}),define("classes/utils/reducers",["require","exports","underscore","graphics_utilities","math_utils","interfaces/model_interfaces","classes/utils/bitmap","classes/utils/interfaces","classes/utils/sprite_factory","interfaces/data_interfaces"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const d=14;function h(e,t,i,s){if(t[0]>=t[1])return i[1];let r=t,o=e.metric.value;switch(s){case c.CloudFontSizingStrategy.LOGARITHMIC:r=t.slice().map(e=>100*Math.log(e)),o=100*Math.log(e.metric.value);break;case c.CloudFontSizingStrategy.MIXED:r=t.slice().map(e=>(e+Math.log(e))/2),o=(e.metric.value+Math.log(e.metric.value))/2}return n.generalMathUtils.linearScale({min:r[0],max:r[1]},{min:i[0],max:i[1]},o)}const u=new n.SeededRandomGenerator(100);const p=5;function g(e,t,i){if(i[0]+e.width/2<t.width/2)for(;i[0]+p-e.width/2<t.width/2;){if(t.spriteCollides(e,i)){i[0]-=p;break}i[0]+=p}else for(;i[0]-p-e.width/2>t.width/2;){if(t.spriteCollides(e,i)){i[0]+=p;break}i[0]-=p}}const m=1;function _(e,t,i){if(i[1]+e.height/2<t.height/2)for(;i[1]+m-e.height/2<t.height/2;){if(t.spriteCollides(e,i)){i[1]-=m;break}i[1]+=m}else for(;i[1]-m-e.height/2>t.height/2;){if(t.spriteCollides(e,i)){i[1]+=m;break}i[1]-=m}}function f(e,t,i,s){const n=t.height/2;let r;if(void 0!==s){let i=n,o=n,a=1,l=0,c=1;const d=10;r=(()=>{l+=c;const n=Math.min(Math.max(Math.ceil(e.width/2),s+l),t.width-Math.floor(e.width/2));return Math.abs(l)===d&&(c*=-1),1===a?(a*=-1,[n,o+=3]):(a*=-1,[n,i-=3])})}else r=t.getPositionGenerator(i);let o=0;for(;;){const i=r();if(i[0]<0&&i[1]<0)break;if(i[0]-e.width/2<0||i[1]-e.height/2<0||i[0]+e.width/2>t.width||i[1]+e.height/2>t.height){if(void 0!==s&&o>2)break;o++}else if(!t.spriteCollides(e,i))return void 0===s&&t.hasSprite&&g(e,t,i),void 0!==s&&t.hasSprite&&_(e,t,i),t.addSprite(e,i),i}}function y(e,t,i,n){return e.type===r.CloudModelItemType.TEXT?{text:e.text,size:h(e,t,i,n.settings.fontSizingStrategy),rotation:n.orientation===r.CloudModelOrientation.MIXED&&function(e,t){if(0===t.length)return!1;const i=t.reduce((e,t)=>e+t.text.length,0)/t.length;return!(e.text.length>=i)&&u.nextNumber()>=.5}(e,n.items)?-90:0,color:s.Color.fromHex(e.color),fontFamily:n.settings.fontFamily,padding:n.settings.padding,fontWeight:n.settings.fontWeight,type:a.CloudItemType.TEXT,model:e}:{imageElement:e.imageElement,size:h(e,t,i,n.settings.fontSizingStrategy),type:a.CloudItemType.IMAGE,model:e}}const b=new s.Color(new n.Vector4D(0,0,0,0));function E(e,t,i){if(e.type===a.CloudItemType.TEXT){const i=e;return{position:new n.Vector2D(t[0],t[1]),text:i.text,size:i.size,style:{fillStyle:i.color,rotationAngle:n.trigonometryUtils.degreesToRadians(i.rotation),opacity:1},textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.fontFamily,weight:i.fontWeight,additionalData:{hue:e.model.hue,color:e.model.color,cloudItem:{size:e.size,model:{metric:{value:e.model.metric.value}}}}}}{const s=e;return{position:new n.Vector2D(t[0],t[1]).sub(new n.Vector2D(i.width/2,i.height/2)),size:new n.Vector2D(i.width,i.height),image:s.imageElement,style:{opacity:1},additionalData:{hue:e.model.hue,color:e.model.color,cloudItem:e}}}}function S(e,t,s){return i.sortBy(e.items,(i,r)=>(i.x=n.generalMathUtils.linearScale({min:0,max:e.items.length-1},{min:0,max:t},r)+s,-i.sprite.width*i.sprite.height))}function C(e,t,i,s,n,r){const o=Math.abs(t.x/2-(i-s.width/2))/(t.x/2);return i-s.width/2<t.x/2?i+=n/2*Math.min(1,o):i-=n/2*Math.min(1,o),f(s,r,e.cloudData.model.settings.positioningShape,i)}function v(e,t,s,n,r,a,l=.5){const c=i.sortBy(t,({cloudItem:e,sprite:t})=>e.model.hue);let d=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=Number.MAX_VALUE,p=-Number.MAX_VALUE;const g=function(e,t){let i;const s=Math.max(1,Math.floor(e.length/t));return e.reduce((t,n,r)=>(r%s==0&&(i&&i.items.length>0&&t.push(i),i={totalResults:0,maxSpriteWidth:0,items:[]}),i&&(i.totalResults+=n.cloudItem.model.metric.value,i.maxSpriteWidth=Math.max(i.maxSpriteWidth,n.sprite.width),i.items.push(n)),r===e.length-1&&i&&i.items.length>0&&t.push(i),t),[])}(c,c.length>=25?5:3);let m=0;const _=g.reduce((e,t)=>(m=Math.max(t.maxSpriteWidth,m),e+t.totalResults),0);let f=0;for(const t of g){const i=t.totalResults/_,c=S(t,i*r.x*l,f);f+=i*r.x*l;for(const{cloudItem:t,sprite:i,x:g}of c){const c=C(e,r,g,i,m,a);if(void 0===c)return T(e,s,n+=.5,r,a=new o.BitMap(r.x*n,r.x/r.y),l);d=Math.min(d,c[0]),h=Math.max(h,c[0]),u=Math.min(u,c[1]),p=Math.max(p,c[1]),t.settings=E(t,c,i),e.drawables.push(e.createRenderable(e,t))}}return e.cloudData.model.isGradientCloud&&r.x/r.y>(h-d)/(p-u)?T(e,s,n,r,a=new o.BitMap(r.x*n,r.x/r.y),l+.1):e}function T(e,t,i,s,n,r=.5){e.drawables=[];const a=t.map((e,t)=>({cloudItem:e,sprite:e.sprite,x:void 0}));if(e.cloudData.model.isGradientCloud)v(e,a,t,i,s,n,r);else for(const{cloudItem:l,sprite:d,x:h}of a){const a=f(d,n,e.cloudData.model.settings.positioningShape,h);if(void 0===a)return T(e,t,i+=.5,s,n=new o.BitMap(s.x*i,s.x/s.y,e.cloudData.model.settings.fontSizingStrategy===c.CloudFontSizingStrategy.MIXED),r);l.settings=E(l,a,d),e.drawables.push(e.createRenderable(e,l))}return e}t.prepareGradientData=function(e){e.cloudData.model.isGradientCloud&&(e.gradient=[{position:0,color:b,opacity:0,text:e.cloudData.model.cloudGradientNames.negative},{position:.5,color:b,opacity:0,text:e.cloudData.model.cloudGradientNames.neutral},{position:1,color:b,opacity:0,text:e.cloudData.model.cloudGradientNames.positive}],e.cloudData.model.gradientWrapper.getClosestToSteps(e.drawables.filter(({additionalData:e})=>e).map(({additionalData:e})=>e.hue)).forEach(({index:t,name:i,hue:s,stepHue:n})=>{const r=e.gradient.find(({text:e})=>e===i);r&&(r.color=e.drawables[t].additionalData.color,r.position=(e.drawables[t].position.x-e.drawables[t].width/2)/e.cloudData.size.x,r.opacity=Math.abs(n-s)/n<5?1:0)}));return e},t.tweenText=function(e,t,i){return[{object:t.position,key:"x",targetValue:t.position.x,initialValue:e.cloudData.size.x/2,duration:i,options:{easing:s.EASING.easeInSine},drawable:t},{object:t.position,key:"y",targetValue:t.position.y,initialValue:e.cloudData.size.y/2,duration:i,options:{easing:s.EASING.easeInSine},drawable:t}]},t.createGradientDrawable=function(e,t){const r=function(e){return i.unique(i.sortBy(e.cloudData.model.items,e=>e.hue),!0,e=>e.hue).filter((t,i)=>!(e.cloudData.model.items.length>=50)||i%3==0||i===e.cloudData.model.items.length-1)}(e);return new s.DrawableRectangle({position:new n.Vector2D(0,e.cloudData.size.y-20+t),size:new n.Vector2D(e.cloudData.size.x,20),style:{fillStyle:new s.Gradient(new n.Vector2D(0,e.cloudData.size.y-20),new n.Vector2D(e.cloudData.size.x,20),r.map((e,t)=>({color:s.Color.fromHex(e.color),position:t/r.length}))),opacity:1},children:function(e){const t=i.sortBy(e.gradient.filter(({text:e})=>e.length>0),({position:e})=>e);let r,o;for(const e of t)e.opacity>0&&(void 0===r&&(r=e),o=e);const a=t.map(t=>{const{position:i}=t;let a=5+(e.cloudData.size.x-10)*i;t===r?a=0:t===o&&(a=e.cloudData.size.x);const l=function(e,t,i){const{text:r,opacity:o}=t,a=new s.DrawableText({position:new n.Vector2D(i,10),text:r,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,size:11,weight:s.DrawableTextWeight.BOLD,style:{fillStyle:new s.Color(new n.Vector4D(255,255,255,255)),opacity:o}});return a.width/2>a.position.x?a.position.x+=a.width/2-a.position.x+10:a.width/2+a.position.x>e.cloudData.size.x-10&&(a.position.x-=a.width/2+a.position.x-e.cloudData.size.x+10),a}(e,t,a);return l});return a.forEach((e,t)=>{if(0!==t&&t!==a.length-1){const i=a[t-1],s=a[t+1],n=i.position.x+i.width/2+10,r=s.position.x-s.width/2-10,o=e.position.x-e.width/2,l=e.position.x+e.width/2;let c=0,d=0;o<n&&(c=n-o),l>r&&(d=l-r),0!==c&&(e.position.x+=c),0!==d&&(e.position.x-=d),e.getBoundingBox()}}),a}(e)})},t.transitionGradient=function(e,t,i){const s=[];t.styleData.opacity=0;const n=i.children,r=t.children;return n.forEach(n=>{const o=r.find(({text:e})=>e===n.text);if(void 0===o)s.push({object:n.styleData,key:"opacity",initialValue:n.styleData.opacity,targetValue:0,duration:e.transitionTime,drawable:i});else{const r=o.position.x;o.position.x=n.position.x,s.push({object:o.position,key:"x",initialValue:o.position.x,targetValue:r,duration:e.transitionTime,drawable:t}),0===o.styleData.opacity&&1===i.styleData.opacity?s.push({object:n.styleData,key:"opacity",initialValue:1,targetValue:0,duration:e.transitionTime,drawable:i}):n.styleData.opacity=0}}),s.push({object:t.styleData,key:"opacity",initialValue:0,targetValue:1,duration:e.transitionTime,drawable:t}),s.push({object:i.styleData,key:"opacity",initialValue:1,targetValue:0,duration:e.transitionTime,drawable:i}),s},t.tweenGradient=function(e,t){const i=[{object:t.position,key:"y",targetValue:t.position.y,initialValue:t.position.y+20,duration:e.options.initialAnimationDuration,drawable:t},{object:t.styleData,key:"opacity",targetValue:1,initialValue:0,duration:e.options.initialAnimationDuration,drawable:t}];return t.position.y=t.position.y+20,t.styleData.opacity=0,i},t.createAndPlaceCloudItems=function(e){const t=e.virtualSize,n=e.cloudData.model;let{domain:r,range:h}=function(e,t,i){const n=[Number.MAX_VALUE,Number.MIN_VALUE];let r=0,o=0;e.forEach(e=>{r=Math.max(r,e.text.length),o+=e.text.length,n[0]=Math.min(n[0],e.metric.value),n[1]=Math.max(n[1],e.metric.value)});const a=o/e.length,l=Array(Math.round(Math.max(2,a+1))).join("m");let c=0,h=d-1;do{h+=1,c=s.canvasDrawingUtilities.getTextWidth(l,h,s.DrawableTextWeight.NORMAL,i)}while(c*h*e.length<t.x*t.y);h>10&&(h=10*Math.ceil(h/10));let u=6;a>10&&e.length>=100&&(u=4);const p=Math.floor(Math.max(d,h/3)),g=[p,Math.ceil(p*u)];return{domain:n,range:g}}(n.items,t,n.settings.fontFamily);e.cloudData.model.isGradientCloud&&(h=[14,30]);const p=new o.BitMap(1.5*t.x,t.x/t.y,e.cloudData.model.settings.fontSizingStrategy===c.CloudFontSizingStrategy.MIXED);return u.setSeed(100),T(e,i.sortBy(i.sortBy(n.items,({metric:e})=>e.value).map(e=>{const t=y(e,r,h,n);return t.sprite=function(e){return e.type===a.CloudItemType.TEXT?l.SpriteFactory.getTextSprite(e):l.SpriteFactory.getImageSprite(e)}(t),t}),e=>-e.sprite.width*e.sprite.height),1.5,t,p)},t.scaleItems=function(e){const t=function(e){if(0===e.length)return{sceneBox:n.Rectangle.fromVectors(n.Vector2D.zero(),n.Vector2D.zero()),drawablesBoxes:[],minMaxCoords:[[0,0],[0,0]]};const t=[];let i=Number.MAX_VALUE,s=Number.MAX_VALUE,r=0,o=0;return{sceneBox:e.reduce((e,a)=>{const l=e.position.clone(),c=l.clone().add(e.size),d=a.getBoundingBox();return t.push(d),i=Math.min(i,d.x),s=Math.min(s,d.y),r=Math.max(r,d.right),o=Math.max(o,d.bottom),d.x<l.x&&(l.x=d.x),d.y<l.y&&(l.y=d.y),d.x+d.width>c.x&&(c.x=d.x+d.width),d.y+d.height>c.y&&(c.y=d.y+d.height),n.Rectangle.fromVectors(l,c.sub(l))},e[0].getBoundingBox()),drawablesBoxes:t,minMaxCoords:[[i,s],[r,o]]}}(e.drawables),r=t.sceneBox,o=e.cloudData.size.clone();e.cloudData.model.isGradientCloud&&(o.y-=5);const a=function(e,t,i){const[s,r]=i,o=Math.min(t.height/e.height,t.width/e.width);let a=r[0]+(e.width*o-e.width)/2,l=s[0]-(e.width*o-e.width)/2,c=r[1]+(e.height*o-e.height)/2,d=s[1]-(e.height*o-e.height)/2;const h=a-l,u=c-d;return a-=l,c-=d,l=0+(t.width-h)/2,d=0+(t.height-u)/2,a+=l,c+=d,l=Math.max(l,t.x),a=Math.min(a,t.right),d=Math.max(d,t.y),c=Math.min(c,t.bottom),e=>{const t=e.getBoundingBox(),i=e.position.x,o=n.generalMathUtils.linearScale({min:s[0],max:r[0]},{min:l,max:a},i),h=n.generalMathUtils.linearScale({min:s[0],max:r[0]},{min:l,max:a},i+t.width),u=e.position.y,p=n.generalMathUtils.linearScale({min:s[1],max:r[1]},{min:d,max:c},u),g=n.generalMathUtils.linearScale({min:s[1],max:r[1]},{min:d,max:c},u+t.height);return{position:new n.Vector2D(o,p),factor:Math.min((h-o)/t.width,(g-p)/t.height)}}}(r,n.Rectangle.fromVectors(n.Vector2D.zero(),o),t.minMaxCoords);return i.sortBy(e.drawables,e=>e.size).forEach(e=>{const t=a(e);e instanceof s.DrawableText?(e.size=t.factor*e.size,e.position=t.position):e instanceof s.DrawableImage&&(e.position=t.position,e.width*=t.factor,e.height*=t.factor)}),e}}),define("classes/cloud",["require","exports","abstract_canvas_chart","graphics_utilities","math_utils","xstream","classes/utils/reducers","classes/utils/interfaces","event_bus","classes/utils/cloud_text"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLOUD_LAYER_TYPE=Object.assign({},i.CANVAS_GRID_CHART_LAYER_TYPE,{ITEMS:"ITEMS"});const d=1e3;t.Cloud=class extends i.CanvasChart{constructor(e,i){super(e,Object.assign({},i,{layers:t.CLOUD_LAYER_TYPE,layerConfigs:{[t.CLOUD_LAYER_TYPE.ITEMS]:{enableInteractions:!0}},margins:new n.Vector4D(0,0,e.model.isGradientCloud?20+(e.model.isAnalytics?10:0):0,0)})),this.hovering=!1,$(i.containerSpan).addClass("canvas-cloud")}initialize(){let e,s=0,a=-100,l=-1,c=-1;return r.Stream.createWithMemory({start:h=>{r.Stream.create({start:e=>{this.dataStream.subscribe(i.CanvasChartUtils.createStreamListener(t=>{Promise.all(t.model.imageLoadPromises).then(()=>e.next(t))}))},stop:()=>{}}).map(e=>{if(s===e.model.checkSum&&l===e.size.x&&c===e.size.y)return this.reRender(),void this.afterUpdate.fire();let i;const r=Math.floor(e.size.y/e.size.x*100)/100;s===e.model.checkSum&&Math.abs(a-r)<=.1&&(i=this.getDrawablesForLayer(t.CLOUD_LAYER_TYPE.ITEMS)),a=r,s=e.model.checkSum;let o=new n.Vector2D(d,d*e.size.y/e.size.x);return e.model.isGradientCloud&&(o=e.size.clone()),{cloudData:e,options:this.options,createRenderable:this.createRenderable.bind(this),transitionTime:1e3,virtualSize:o,oldDrawables:i}}).filter(e=>void 0!==e).map(o.createAndPlaceCloudItems).map(o.scaleItems).map(o.prepareGradientData).subscribe(i.CanvasChartUtils.createStreamListener(async i=>{this.currentHover=void 0,this.drawables=i.drawables,await this.clearDrawables(t.CLOUD_LAYER_TYPE.ITEMS);const s=[];if(_.sortBy(i.drawables,e=>{const t=e.getBoundingBox();return t.width*t.height}).forEach(n=>{this.addDrawable(t.CLOUD_LAYER_TYPE.ITEMS,n),this.options.initialAnimationEnabled&&s.push(...o.tweenText(i,n,e?i.transitionTime:this.options.initialAnimationDuration))}),i.gradient)if(e&&i.cloudData.size.x===l&&i.cloudData.size.y===c){const s=e;e=o.createGradientDrawable(i,this.margins.bottom-(i.cloudData.model.isAnalytics?10:0)),this.addDrawable(t.CLOUD_LAYER_TYPE.ITEMS,s),this.addDrawable(t.CLOUD_LAYER_TYPE.ITEMS,e),this.addTweens(o.transitionGradient(i,e,s)),this.onAnimationDone.subscribeOnceAsPromise().then(()=>this.clearDrawable(t.CLOUD_LAYER_TYPE.ITEMS,s))}else e=o.createGradientDrawable(i,this.margins.bottom-(i.cloudData.model.isAnalytics?10:0)),this.addDrawable(t.CLOUD_LAYER_TYPE.ITEMS,e),this.options.initialAnimationEnabled&&s.push(...o.tweenGradient(i,e));l=i.cloudData.size.x,c=i.cloudData.size.y,this.addTweens(s),this.afterUpdate.fire()}))},stop:()=>{}})}itemMouseEnter(e,t,s,n){e.preventDefault(),this.currentHover===t&&this.mouseLeaveTimeoutId&&(clearTimeout(this.mouseLeaveTimeoutId),this.mouseLeaveTimeoutId=void 0);const r=e.clientX,o=e.clientY;this.popoverCandidate=t,0===$(document.elementFromPoint(r,o)).parents(".tw-bubble-dialog.popover").length&&0===$(document.elementFromPoint(r,o+10)).parents(".tw-bubble-dialog.popover").length&&(s.drawables.filter(e=>e!==t).forEach(e=>{e.styleData.opacity=.33}),t.styleData.opacity=1,this.reRender(),this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER),this.currentHover=t,this.hovering=!0),this.popUpTimeOutId&&(clearTimeout(this.popUpTimeOutId),this.popUpTimeOutId=void 0),this.popUpTimeOutId=setTimeout(()=>{if(0===$(document.elementFromPoint(r,o)).parents(".tw-bubble-dialog.popover").length&&0===$(document.elementFromPoint(r,o+10)).parents(".tw-bubble-dialog.popover").length&&0===$(":hover").filter(".tw-bubbles").find(".tw-bubble-dialog.popover").length&&this.popoverCandidate===t){this.closePopover(),this.closeDropDown(),void 0!==this.mouseOutTimoutId&&(clearTimeout(this.mouseOutTimoutId),this.mouseOutTimoutId=void 0);const i=s.cloudData.model;this.shouldGenerateItemDetailsMenu(i)&&this.generateItemDetailsMenu(e,t,n,i)}},500)}itemMouseLeave(e,t,s){e.preventDefault(),this.mouseLeaveTimeoutId&&clearTimeout(this.mouseLeaveTimeoutId),this.popoverCandidate===t&&(this.popoverCandidate=void 0),this.mouseLeaveTimeoutId=setTimeout(()=>{e.preventDefault(),this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),0===$(":hover").filter(".tw-bubbles").find(".tw-bubble-dialog.popover").length&&this.currentHover===t&&(this.currentHover=void 0,void 0!==this.mouseOutTimoutId&&(clearTimeout(this.mouseOutTimoutId),this.mouseOutTimoutId=void 0),this.hovering=!1,this.mouseOutTimoutId=setTimeout(()=>{this.hovering||(s.drawables.filter(e=>e!==t).forEach(e=>{e.styleData.opacity=1}),this.mouseOutTimoutId=void 0),this.reRender()},50),this.closePopover(),this.closeDropDown())},1e3)}itemMouseUp(e,t,i,s){const n=i.cloudData.model;this.options.isClickable&&(e.preventDefault(),this.closePopover(),this.closeDropDown(),this.openDrilldown(n.id,s.model.filter,e.target,s.model.requestedPageType))}createRenderable(e,t){const i=this,n=t.settings;return n.on={mouseenter(s){i.itemMouseEnter(s,this,e,t)},mouseleave(t){i.itemMouseLeave(t,this,e)},mouseup(s){i.itemMouseUp(s,this,e,t)}},t.type===a.CloudItemType.TEXT?new c.CloudText(n):new s.DrawableImage(n)}openCloudPopover(e,t,i,s){l.eventBus.dispatch({type:l.EVENT_TYPES.CLOUD_POPOVER_OPEN,value:{container:this.getContainer(),popoverData:i.popoverData,x:e,y:t,hashTagMappeId:i.hashTagMappeId,percentageBasedValue:s.toPercentage(i.percentageBasedValue)}})}shouldGenerateItemDetailsMenu(e){return this.options.isClickable}generateItemDetailsMenu(e,t,i,s){const n=$(e.target).offset(),r=t.getBoundingBox(),o=n.left+r.width/2+r.x+this.margins.left-1,a=n.top+r.y+this.margins.top;this.openCloudPopover(o,a+10,i.model,this.options.numberFormatter);const l=this.generateDropdownButtons(s,i,e);this.openDropDown(o,a+r.height,l)}generateDropdownButtons(e,t,i){const s=[this.generateShowDetailsButton(e.id,t.model.filter,i.target,t.model.requestedPageType),this.generateShowResultsButton(e.id,t.model.filter,i.target,"CONTEXT_MENU_RESULT_ENTRY")];return e.shouldShowBlockThemeButton&&s.push(this.generateBlockThemeButton(t,e)),e.shouldShowDeleteThemeButton&&s.push(this.generateDeleteThemeButton(t,e)),s}generateShowDetailsButton(e,t,i,s){return{icon:"fa fa-bars",text:"_489448",onClick:()=>{this.openDrilldown(e,t,i,s)}}}generateShowResultsButton(e,t,i,s){return{icon:"fa fa-search",text:"_1654879",onClick:()=>{this.openDrilldown(e,t,i,s)}}}generateBlockThemeButton(e,t){const{filter:i,id:s,name:n,deleteLink:r}=e.model;return{icon:"fa fa-ban",text:"_973823",onClick:()=>{l.eventBus.dispatch({type:l.EVENT_TYPES.BLOCK_THEME,value:{filters:i,widgetId:t.id,id:s,text:n,deleteLink:r}})}}}generateDeleteThemeButton(e,t){const{filter:i,name:s,id:n}=e.model;return{icon:"fa fa-trash",text:"_914504",onClick(){l.eventBus.dispatch({type:l.EVENT_TYPES.DELETE_THEME,value:{widgetId:t.id,text:s,id:n,filters:i}})}}}update(e){return super.update(e),this}async animate(){await super.animate()}dispose(){super.dispose(),this.closePopover(),this.closeDropDown(),void 0!==this.drawables&&(this.drawables.forEach(e=>e.dispose()),this.drawables=void 0)}}}),define("classes/trend_cloud_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("cloud",["require","exports","classes/cloud","classes/cloud_model","classes/utils/gradient_wrapper","interfaces/data_interfaces","interfaces/model_interfaces"],function(e,t,i,s,n,r,o){"use strict";function a(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),a(i),a(s),a(n),a(r),a(o)}),define("interfaces/colored_item_block",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/colored_item_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/colored_items_blocks.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createColoredItemsBlocksStyle=function(e){return{root:{height:"100%",display:"inline-block",position:"relative"},itemColor:{backgroundColor:e.color,width:"100%",height:4,position:"absolute",bottom:0},itemLabel:{textAlign:"center"}}}}),define("renderables/colored_item_block_renderable",["require","exports","flux","react","css/colored_items_blocks.css","css_modules"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ColoredItemBlockRenderable=class extends i.BaseComponent{constructor(e){super(e);const t={color:this.props.item.color},i=r.createCssModule(n.createColoredItemsBlocksStyle);this.state={cssModule:i,style:i.compute(t).attach().getModule()}}componentDidMount(){const e=this.refs.root;this.initFontsize(e)}render(){const e={fontSize:this.state.fontSize};return s.createElement("div",{ref:"root",className:this.state.style.root,style:this.props.styles},s.createElement("div",{className:this.state.style.itemLabel,style:e},this.props.item.label),s.createElement("div",{className:this.state.style.itemColor}))}componentWillUnmount(){this.state.cssModule.detach()}initFontsize(e){const t=$(e).innerHeight()-this.state.cssModule.getStyleSheetModel().itemColor.height;this.setState({fontSize:t})}}}),define("renderables/colored_items_blocks_renderable",["require","exports","flux","react","renderables/colored_item_block_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ColoredItemsBlocksRenderable=class extends i.BaseComponent{render(){return s.createElement("div",null,this.props.items.map(e=>this.renderItemBlock(e,1/this.props.items.length)))}renderItemBlock(e,t){const i={width:`${100*t}%`};return s.createElement(n.ColoredItemBlockRenderable,{item:e,styles:i})}}}),define("colored_items_blocks",["require","exports","renderables/colored_item_block_renderable","renderables/colored_items_blocks_renderable"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("interfaces/style_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("styles/common/breakpoints",["require","exports"],function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PHONE="600px",e.TABLET="1200px",e.DESKTOP="1400px"}(i=t.Breakpoints||(t.Breakpoints={})),t.mediaQueries={PHONE:`@media (min-device-width: 0px) and (max-device-width: ${i.PHONE})`,TABLET:`@media (min-device-width: ${i.PHONE}) and (max-device-width: ${i.TABLET})`,DESKTOP:`@media (min-device-width: ${i.TABLET})`}}),define("utilities/dynamic_style_factory",["require","exports","emotion"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dynamicStyle=function(e){return t=>e(i.css,t)},t.composeProps=function(...e){return e.reduceRight((e,t)=>(Object.keys(t).forEach(i=>{const s=t[i];void 0!==s&&(e[i]=s)}),e),{})}}),define("composable_styles",["require","exports","styles/common/breakpoints","utilities/dynamic_style_factory"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("css/contact_item_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/contact_item.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createContactItemStyle=function(e){return{root:{position:"relative",display:"flex",alignItems:"flex-start",justifyContent:"flex-start",marginRight:10,marginLeft:10,flexGrow:1,flexBasis:"100%","&:not(:first-child)":{marginTop:5},"&:not(:last-child)":{marginBottom:5}},iconStyles:{fontSize:18,display:"inline-flex",width:22,minWidth:22,height:22,alignItems:"center",justifyContent:"center",marginTop:4,color:e.iconColor,background:e.iconBackground},iconsWithActionWrapper:{width:34,marginTop:4},iconWithActionWrapper:{width:16},iconWithAction:{cursor:"pointer",color:e.iconActionColor,marginRight:2,marginLeft:2,"&:hover":{color:e.iconHoverColor}},addButton:{borderRadius:"50%",color:"white",border:`1px solid ${e.iconHoverColor}`,backgroundColor:e.iconHoverColor,paddingTop:3,paddingRight:4,paddingBottom:2,paddingLeft:4,fontSize:12,"&:hover":{backgroundColor:"white"}},textBlock:{display:"inline-flex",paddingRight:10,paddingLeft:10,flexWrap:"wrap",flexGrow:1},inputBlock:{display:"flex",flexDirection:"column",marginTop:2,justifyContent:"space-between",flexGrow:1},inputField:{border:`1px solid ${e.inputBorderColor}`,paddingTop:2,paddingRight:12,paddingBottom:2,paddingLeft:12,"&:invalid":{border:"1px solid red"},"&:focus":{borderColor:e.borderFocusColor,outline:0},"&::-webkit-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&::-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-ms-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor}},textareaField:{border:`1px solid ${e.inputBorderColor}`,paddingRight:12,paddingLeft:12,minHeight:70,"&:invalid":{border:"1px solid red"},"&:focus":{borderColor:e.borderFocusColor,outline:0},"&::-webkit-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&::-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-ms-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor}},label:{marginRight:5,marginBottom:"0px !important"},displayedText:{marginTop:"5px",whiteSpace:"pre-wrap"},singleSelectBlock:{width:182,marginLeft:20,marginRight:20,"& .single-select":{"& .form-control":{padding:"4px 6px",height:"29px"}}}}}}),define("interfaces/contact_item_config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/contact_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/contact_item_save_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/address_contact_item_component",["require","exports","react","flux","css/contact_item.css","classnames","event_bus"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AddressContactItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createContactItemStyle)}render(){return i.createElement("div",{className:this.style.root},this.renderIcon(),this.renderTextBlock(),this.renderEditIcon())}renderIcon(){return void 0!==this.props.item.icon?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.item.icon})):null}renderTextBlock(){return i.createElement("div",{className:this.style.textBlock},i.createElement("div",{className:this.style.displayedText},this.props.item.text))}renderEditIcon(){const e=r([this.style.iconWithAction,"fa fa-pencil"]),t=this.props.config.editable?i.createElement("i",{onClick:this.triggerToggleEditMode.bind(this),className:e}):null;return i.createElement("span",{className:this.style.iconWithActionWrapper},t)}triggerToggleEditMode(){const e={item:Object.assign({},this.props.item,{editMode:!this.props.item.editMode})};o.eventBus.dispatch({type:o.EVENT_TYPES.CONTACT_ITEM_EDIT,value:e})}}}),define("interfaces/block_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SINGLE_BLOCK=0]="SINGLE_BLOCK",e[e.GROUPED_BLOCKS=1]="GROUPED_BLOCKS"}(t.BlockType||(t.BlockType={}))}),define("interfaces/contact_items_block",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/contact_items_block_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/contact_items_block.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createContactItemsBlockStyle=function(e){return{root:{display:"flex",paddingTop:5,paddingRight:5,paddingBottom:5,paddingLeft:5,color:e.defaultTextColor,width:"100%"},inlineBlock:{display:"inline-flex !important",width:"50%"},hasLabel:{flexDirection:"column"},noLabel:{flexDirection:"row"},blockItems:{display:"flex",flexGrow:1},itemsList:{display:"flex",flexWrap:"wrap",flexGrow:1,alignItems:"flex-start"},iconStyles:{fontSize:18,display:"inline-flex",width:22,minWidth:22,height:22,alignItems:"center",justifyContent:"center",marginTop:4,color:e.iconColor,background:e.iconBackground},label:{marginRight:5,marginBottom:"0px !important"},groupedBlocksLabel:{fontWeight:"bold"}}}}),define("css/media_contact_item.css",["require","exports","css/contact_item.css"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMediaContactItemStyle=function(e){const t=i.createContactItemStyle(e);return Object.assign({},t,{mediaRoot:{marginLeft:0,width:"100%"}})}}),define("components/media_contact_item_component",["require","exports","react","flux","classnames","event_bus","css/media_contact_item.css"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MediaContactItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,o.createMediaContactItemStyle)}render(){const e=n([this.style.root,this.style.mediaRoot]);return i.createElement("div",{className:e},this.renderIcon(),this.renderTextBlock(),this.renderEditIcon())}renderIcon(){return void 0!==this.props.item.icon?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.item.icon})):null}renderTextBlock(){return i.createElement("div",{className:this.style.textBlock},i.createElement("div",{className:this.style.displayedText},i.createElement("a",{href:this.props.item.text,target:"_blank"},this.props.item.text)))}renderEditIcon(){const e=n([this.style.iconWithAction,"fa fa-pencil"]),t=this.props.config.editable?i.createElement("i",{onClick:this.triggerToggleEditMode.bind(this),className:e}):null;return i.createElement("span",{className:this.style.iconWithActionWrapper},t)}triggerToggleEditMode(){const e={item:Object.assign({},this.props.item,{editMode:!this.props.item.editMode})};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_EDIT,value:e})}}}),define("components/contact_item_component",["require","exports","flux","react","css/contact_item.css","classnames","event_bus"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContactItemComponent=class extends i.StyledBaseComponent{constructor(e){super(e,n.createContactItemStyle)}render(){return s.createElement("div",{className:this.style.root},this.renderIcon(),this.renderTextBlock(),this.renderEditIcon())}renderIcon(){return void 0!==this.props.item.icon?s.createElement("span",{className:this.style.iconStyles},s.createElement("i",{className:this.props.item.icon})):null}renderTextBlock(){return s.createElement("div",{className:this.style.textBlock},s.createElement("div",{className:this.style.displayedText},this.props.item.text))}renderEditIcon(){const e=r([this.style.iconWithAction,"fa fa-pencil"]),t=this.props.config.editable?s.createElement("i",{onClick:this.triggerToggleEditMode.bind(this),className:e}):null;return s.createElement("span",{className:this.style.iconWithActionWrapper},t)}triggerToggleEditMode(){const e={item:Object.assign({},this.props.item,{editMode:!this.props.item.editMode})};o.eventBus.dispatch({type:o.EVENT_TYPES.CONTACT_ITEM_EDIT,value:e})}}}),define("interfaces/contact_item_changed_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/contact_item_delete_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/add_new_field_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/editable_contact_item_component",["require","exports","react","flux","css/contact_item.css","event_bus","classnames"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EditableContactItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createContactItemStyle)}render(){const e=o({[this.style.root]:!0});return i.createElement("div",{className:e},this.renderIcon(),i.createElement("div",{className:this.style.textBlock},i.createElement("div",{className:this.style.inputBlock},i.createElement("input",{type:this.props.fieldType,placeholder:this.props.item.placeholderText,value:this.props.item.text,onChange:this.handleOnChange.bind(this),className:this.style.inputField}))),i.createElement("div",{className:this.style.iconsWithActionWrapper},this.renderSaveButton(),this.renderDeleteButton(),this.renderAddNewEmptyItemButton()))}renderIcon(){return void 0!==this.props.item.icon?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.item.icon})):null}renderDeleteButton(){const e=o([this.style.iconWithAction,"icon-tw-trash-bin"]),t=!0===this.props.config.deletable?i.createElement("i",{onClick:this.triggerDelete.bind(this),className:e}):null;return i.createElement("span",null,t)}renderSaveButton(){let e=null;if(this.canSave()){const t=o([this.style.iconWithAction,"fa fa-floppy-o"]);e=i.createElement("i",{onClick:this.triggerSave.bind(this),className:t})}return i.createElement("span",null,e)}renderAddNewEmptyItemButton(){let e=null;if(this.props.config.canCreateNewBlank){const t=o([this.style.iconWithAction,this.style.addButton,"fa fa-plus"]);e=i.createElement("i",{onClick:this.triggerAddNewEmptyItem.bind(this),className:t})}return i.createElement("span",null,e)}canSave(){return!0===this.props.config.saveable&&void 0!==this.props.item.text&&this.props.item.text.trim().length>0}handleOnChange(e){const t={item:Object.assign({},this.props.item,{text:e.target.value})};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_CHANGED,value:t})}triggerSave(e){const t={item:Object.assign({},this.props.item,{editMode:!1})};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_SAVE,value:t})}triggerDelete(e){const t={item:this.props.item};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_DELETE,value:t})}triggerAddNewEmptyItem(e){const t={type:this.props.item.type,subType:this.props.item.subType};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_ADD_NEW_FIELD,value:t})}}}),define("components/editable_address_contact_item_component",["require","exports","react","flux","css/contact_item.css","event_bus","classnames"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EditableAddressContactItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createContactItemStyle)}render(){const e=o({[this.style.root]:!0}),t=o([this.style.textBlock]);return i.createElement("div",{className:e},this.renderIcon(),i.createElement("div",{className:t},this.renderInputBlock(this.props.item.text,!1,this.handleOnChangeAddress.bind(this))),i.createElement("div",{className:this.style.iconsWithActionWrapper},this.renderSaveButton(),this.renderDeleteButton(),this.renderAddNewEmptyItemButton()))}renderIcon(){return void 0!==this.props.item.icon?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.item.icon})):null}renderInputBlock(e,t,s){return i.createElement("div",{className:this.style.inputBlock},i.createElement("textarea",{placeholder:this.props.item.placeholderText,value:e||"",onChange:s,className:this.style.textareaField,required:t}))}renderDeleteButton(){const e=o([this.style.iconWithAction,"icon-tw-trash-bin"]),t=!0===this.props.config.deletable?i.createElement("i",{onClick:this.triggerDelete.bind(this),className:e}):null;return i.createElement("span",null,t)}renderSaveButton(){let e=null;if(this.canSave()){const t=o([this.style.iconWithAction,"fa fa-floppy-o"]);e=i.createElement("i",{onClick:this.triggerSave.bind(this),className:t})}return i.createElement("span",null,e)}renderAddNewEmptyItemButton(){let e=null;if(this.props.config.canCreateNewBlank){const t=o([this.style.iconWithAction,this.style.addButton,"fa fa-plus"]);e=i.createElement("i",{onClick:this.triggerAddNewEmptyItem.bind(this),className:t})}return i.createElement("span",null,e)}canSave(){return!0===this.props.config.saveable&&void 0!==this.props.item.text&&this.props.item.text.trim().length>0}handleOnChangeAddress(e){const t=Object.assign({},this.props.item,{text:e.target.value});this.dispatchValueChange(t)}dispatchValueChange(e){const t={item:e};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_CHANGED,value:t})}triggerSave(e){const t={item:Object.assign({},this.props.item,{editMode:!1})};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_SAVE,value:t})}triggerDelete(e){const t={item:this.props.item};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_DELETE,value:t})}triggerAddNewEmptyItem(e){const t={type:this.props.item.type,subType:this.props.item.subType};r.eventBus.dispatch({type:r.EVENT_TYPES.CONTACT_ITEM_ADD_NEW_FIELD,value:t})}}}),define("components/editable_media_contact_item_component",["require","exports","react","flux","event_bus","classnames","reusable_components","reusable_utilities","css/media_contact_item.css"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EditableMediaContactItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,l.createMediaContactItemStyle)}render(){this.recomputeStyle();const e=r([this.style.root,this.style.mediaRoot]),t=r([this.style.textBlock]);return i.createElement("div",{className:e},this.renderIcon(),this.renderSubTypeMenu(),i.createElement("div",{className:t},this.renderInputBlock(this.props.item.text,this.handleOnChange.bind(this))),i.createElement("div",{className:this.style.iconsWithActionWrapper},this.renderSaveButton(),this.renderDeleteButton(),this.renderAddNewEmptyItemButton()))}renderIcon(){return void 0!==this.props.item.icon?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.item.icon})):null}renderInputBlock(e,t){return i.createElement("div",{className:this.style.inputBlock},i.createElement("input",{type:"text",placeholder:this.props.item.placeholderText,value:e,onChange:t,className:this.style.inputField}))}renderDeleteButton(){const e=r([this.style.iconWithAction,"icon-tw-trash-bin"]),t=!0===this.props.config.deletable?i.createElement("i",{onClick:this.triggerDelete.bind(this),className:e}):null;return i.createElement("span",null,t)}renderSaveButton(){let e=null;if(this.canSave()){const t=r([this.style.iconWithAction,"fa fa-floppy-o"]);e=i.createElement("i",{onClick:this.triggerSave.bind(this),className:t})}return i.createElement("span",null,e)}renderAddNewEmptyItemButton(){let e=null;if(this.props.config.canCreateNewBlank){const t=r([this.style.iconWithAction,this.style.addButton,"fa fa-plus"]);e=i.createElement("i",{onClick:this.triggerAddNewEmptyItem.bind(this),className:t})}return i.createElement("span",null,e)}renderSubTypeMenu(){return i.createElement("div",{className:this.style.singleSelectBlock},i.createElement(o.SingleSelectComponent,Object.assign({},this.props.item.subTypeMenuProps,{selectCallback:this.handleOnChangeSubType.bind(this)})))}canSave(){const e=a.TopicEntryUtils.getFirstSelectedChildRecursive(this.props.item.subTypeMenuProps.model.root_entry);return!0===this.props.config.saveable&&(void 0!==e||void 0!==this.props.item.subType)&&void 0!==this.props.item.text&&this.props.item.text.trim().length>0}handleOnChangeSubType(e){const t=Object.assign({},this.props.item,{subType:e.mapped_id});this.dispatchValueChange(t)}handleOnChange(e){const t=Object.assign({},this.props.item,{text:e.target.value});this.dispatchValueChange(t)}dispatchValueChange(e){const t={item:e};n.eventBus.dispatch({type:n.EVENT_TYPES.CONTACT_ITEM_CHANGED,value:t})}triggerSave(e){const t={item:Object.assign({},this.props.item,{editMode:!1})};n.eventBus.dispatch({type:n.EVENT_TYPES.CONTACT_ITEM_SAVE,value:t})}triggerDelete(e){const t={item:this.props.item};n.eventBus.dispatch({type:n.EVENT_TYPES.CONTACT_ITEM_DELETE,value:t})}triggerAddNewEmptyItem(e){const t={type:this.props.item.type,subType:this.props.item.subType};n.eventBus.dispatch({type:n.EVENT_TYPES.CONTACT_ITEM_ADD_NEW_FIELD,value:t})}}}),define("classes/contact_item_component_factory",["require","exports","components/address_contact_item_component","components/media_contact_item_component","components/contact_item_component","react","components/editable_contact_item_component","components/editable_address_contact_item_component","components/editable_media_contact_item_component"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContactItemComponentFactory=class{static createComponentForReading(e,t,o){switch(e.type){case"address":return r.createElement(i.AddressContactItemComponent,{key:e.id,item:e,theme:t,config:o});case"media_contact":return r.createElement(s.MediaContactItemComponent,{key:e.id,item:e,theme:t,config:o});case"phone":case"other_contact":default:return r.createElement(n.ContactItemComponent,{key:e.id,item:e,theme:t,config:o})}}static createComponentForEditing(e,t,i){switch(e.type){case"address":return r.createElement(a.EditableAddressContactItemComponent,{key:e.id,item:e,theme:t,config:i});case"media_contact":return r.createElement(l.EditableMediaContactItemComponent,{key:e.id,item:e,theme:t,config:i});case"phone":return r.createElement(o.EditableContactItemComponent,{key:e.id,item:e,theme:t,config:i,fieldType:"text"});case"other_contact":return r.createElement(o.EditableContactItemComponent,{key:e.id,item:e,theme:t,config:i,fieldType:this.getFieldTypeForOtherItem(e)});default:return r.createElement(o.EditableContactItemComponent,{key:e.id,item:e,theme:t,config:i,fieldType:"text"})}}static createContactItemTheme(e,t){return{inputBorderColor:t.inputBorderColor,iconColor:void 0!==e.iconStyles&&void 0!==e.iconStyles.color?e.iconStyles.color:t.iconColor,iconBackground:void 0!==e.iconStyles?e.iconStyles.background:void 0,iconActionColor:t.iconActionColor,iconHoverColor:t.iconHoverColor,placeholderColor:t.placeholderColor,borderFocusColor:t.borderFocusColor}}static getFieldTypeForOtherItem(e){switch(e.subType){case"EMAIL":case"WEB_SITE":default:return"text"}}}}),define("components/contact_items_block_component",["require","exports","react","flux","css/contact_items_block.css","classnames","classes/contact_item_component_factory"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContactItemsBlockComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createContactItemsBlockStyle)}render(){const e=r({[this.style.root]:!0,[this.style.inlineBlock]:this.props.model.isInlineBlock}),t=r({[this.style.hasLabel]:this.hasLabel(),[this.style.noLabel]:!this.hasLabel(),[this.style.blockItems]:!0});return i.createElement("div",{className:e},i.createElement("div",{className:t},this.renderIcon(),this.renderLabel(),this.renderItems()))}renderIcon(){return this.hasIcon()?i.createElement("span",{className:this.style.iconStyles},i.createElement("i",{className:this.props.model.icon})):null}renderLabel(){return this.hasLabel()?i.createElement("span",null,this.props.model.label):null}renderItems(){const e=r({[this.style.itemsList]:!0});return i.createElement("div",{className:e},this.props.model.items.map(e=>this.renderItem(e)))}renderItem(e){const t=o.ContactItemComponentFactory.createContactItemTheme(e,this.props.theme),i=this.props.configMap[e.id];return!0===e.editMode||1==this.props.editable?o.ContactItemComponentFactory.createComponentForEditing(e,t,i):o.ContactItemComponentFactory.createComponentForReading(e,t,i)}hasIcon(){return void 0!==this.props.model.icon}hasLabel(){return void 0!==this.props.model.label&&this.props.model.label.length>0}}}),define("css/contact_blocks_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/contact_blocks.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createContactBlocksStyle=function(e){return{rowTopBorder:{borderTop:`1px solid ${e.borderColor}`}}}}),define("interfaces/contact_items_blocks_block",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/grouped_contact_items_blocks_component",["require","exports","flux","react","classnames","css/contact_items_block.css","components/contact_items_block_component"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GroupedContactItemsBlocksComponent=class extends i.StyledBaseComponent{constructor(e){super(e,r.createContactItemsBlockStyle)}render(){const e=n({[this.style.root]:!0,[this.style.inlineBlock]:this.props.model.isInlineBlock}),t=n({[this.style.hasLabel]:this.hasLabel(),[this.style.noLabel]:!this.hasLabel(),[this.style.blockItems]:!0});return s.createElement("div",{className:e},s.createElement("div",{className:t},this.renderIcon(),this.renderLabel(),this.renderBlocks()))}renderIcon(){return this.hasIcon()?s.createElement("span",{className:this.style.iconStyles},s.createElement("i",{className:this.props.model.icon})):null}renderLabel(){return this.hasLabel()?s.createElement("span",{className:this.style.groupedBlocksLabel},this.props.model.label):null}renderBlocks(){const e=n({[this.style.itemsList]:!0});return s.createElement("div",{className:e},this.props.model.blocks.map(e=>this.renderBlock(e)))}renderBlock(e){const t=this.props.theme,i=Object.assign({},t),n=this.props.specificThemes[e.id];return void 0!==n&&(i.iconColor=n.iconColor,i.iconBackground=n.iconBackground),s.createElement(o.ContactItemsBlockComponent,{key:e.id,model:e,configMap:this.props.configMap,theme:i,editable:this.props.editable})}hasIcon(){return void 0!==this.props.model.icon}hasLabel(){return void 0!==this.props.model.label&&this.props.model.label.length>0}}}),define("components/contact_blocks_component",["require","exports","flux","react","components/contact_items_block_component","css/contact_blocks.css","interfaces/block_type","components/grouped_contact_items_blocks_component"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContactBlocksComponent=class extends i.StyledBaseComponent{constructor(e){super(e,r.createContactBlocksStyle)}render(){return s.createElement("div",null,this.props.blocks.map(e=>this.renderBlock(e)))}renderBlock(e){return e.type===o.BlockType.SINGLE_BLOCK?this.renderSingleBlock(e):e.type===o.BlockType.GROUPED_BLOCKS?this.renderGroupedBlocks(e):null}renderSingleBlock(e){return void 0!==e.items&&(!0===this.props.editable||e.items.length>0)?s.createElement(n.ContactItemsBlockComponent,{key:e.id,model:e,configMap:this.props.configMap,theme:this.props.theme.defaultBlockTheme,editable:this.props.editable}):null}renderGroupedBlocks(e){return s.createElement(a.GroupedContactItemsBlocksComponent,{key:e.id,model:e,configMap:this.props.configMap,theme:this.props.theme.defaultBlockTheme,editable:this.props.editable,specificThemes:this.props.theme.specificBlockThemes})}}}),define("css/contact_profile.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createContactProfileStyle=function(e){return{leftBlock:{display:"inline-flex"},rightBlock:{display:"inline-flex",paddingLeft:20,maxWidth:"84%",flexDirection:"column",verticalAlign:"top"},profileImg:{width:100,height:100,objectFit:"cover",borderRadius:"50%"},shortName:{overflow:"hidden",textOverflow:"ellipsis",fontSize:12,fontFamily:"RobotoR"},profileName:{fontSize:20,fontFamily:"RobotoB"}}}}),define("components/contact_profile_component",["require","exports","flux","react","reusable_components","css_modules","css/contact_profile.css"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContactProfileComponent=class extends i.BaseComponent{constructor(e){super(e);const t=r.createCssModule(o.createContactProfileStyle);this.state={cssModule:t,style:t.compute({}).attach().getModule()}}render(){const e=s.createFactory.bind(s,n.AvatarFallbackImageRenderable),t=this.state.style.profileImg,i=this.state.style.leftBlock,r=this.state.style.rightBlock,o=this.state.style.shortName,a=this.state.style.profileName;return s.createElement(s.Fragment,null,s.createElement("div",{className:i},s.createElement(n.ImageBlockRenderable,{url:this.props.avatarUrl,errorTag:e(),errorClass:t,className:t})),s.createElement("div",{className:r},s.createElement("div",{className:o},s.createElement("span",null,this.props.shortName)),s.createElement("div",{className:a},s.createElement("span",null,this.props.profileName))))}componentWillUnmount(){this.state.cssModule.detach()}}}),define("interfaces/contact_item_creator_type_change",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/contact_item_edit_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("contact_components",["require","exports","components/address_contact_item_component","components/contact_blocks_component","components/contact_profile_component","components/editable_address_contact_item_component","components/editable_contact_item_component","components/editable_media_contact_item_component","components/media_contact_item_component","interfaces/block_type"],function(e,t,i,s,n,r,o,a,l,c){"use strict";function d(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),d(i),d(s),d(n),d(r),d(o),d(a),d(l),d(c)}),define("enums/contact_item_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PHONE=0]="PHONE",e[e.SOCIAL_MEDIA=1]="SOCIAL_MEDIA",e[e.OTHER=2]="OTHER",e[e.ADDRESS=3]="ADDRESS"}(t.ContactItemType||(t.ContactItemType={}))}),define("classes/counter_number_formatter",["require","exports","reusable_utilities","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CounterNumberFormatter=class extends i.NumberFormatter{toInteger(e){return this.parse(e).format("0,")}toDecimal(e){return s.logService.warn("CounterNumberFormatter.toDecimal should not be used, use toInteger instead!"),this.toInteger(e)}toPercentage(e){return s.logService.warn("CounterNumberFormatter.toPercentage should not be used, use toInteger instead!"),this.toInteger(e)}toTime(e){return s.logService.warn("CounterNumberFormatter.toTime should not be used, use toInteger instead!"),this.toInteger(e)}}}),define("renderables/counter_renderable",["require","exports","flux","classnames","react","reusable_components","canvas_engine"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CounterRenderable=class extends i.BaseComponent{render(){const{value:e,oldValue:t,duration:i,drawSettings:s}=this.props;return n.createElement("div",{className:"tw-counter"},n.createElement(r.AnimatedLabel,{start:t,end:e,duration:i,renderFunction:this.renderValue.bind(this,s,this.calculateFontSize()),onStep:this.onStep.bind(this),onDone:this.onDone.bind(this)}))}calculateFontSize(){const{value:e,oldValue:t,drawSettings:i}=this.props,s=Math.max(Math.abs(e),Math.abs(t));let n;n=0===s?0:Math.log(s)/Math.log(10);let r="7".repeat(Math.ceil(n))+",".repeat(Math.ceil(n/3));(e<0&&s===Math.abs(e)||t<0&&s===Math.abs(t))&&(r+="-");const a=o.Utilities.measureText(r,(new o.Font).setSize(100));return Math.floor(Math.min(i.dimensions.height,i.dimensions.width/(a.width/100)))}renderValue(e,t,i,s){return n.createElement("div",{className:this.getValueFontClass(e),style:{lineHeight:1}},s.split("").map((e,i)=>n.createElement("span",{className:"letter",key:i,style:{fontSize:t}},e)))}getValueFontClass(e){const{fontSize:t}=e.style;return s({value:!0,"fontsize-small":0===t,"fontsize-medium":1===t,"fontsize-large":t>=2})}onStep(e){const{drawSettings:t}=this.props;return void 0!==t?t.style.formatting.numberFormatter.toInteger(e):`${e}`}onDone(e){const{drawSettings:t}=this.props;return void 0!==t?t.style.formatting.numberFormatter.toInteger(e):`${e}`}}}),define("containers/counter_container",["require","exports","data_structures","react","reusable_components","widget_base","classes/strategies/partitioned_value_item_pool_strategy","renderables/counter_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANIMATION_DURATION=window.isExport?0:2500;t.CounterContainer=class extends r.AbstractFragmentLayer{constructor(e){super(e),this.state={items:[],drawSettings:void 0}}componentDidMount(){this.update(this.props.model)}render(){const{model:e}=this.props,{drawSettings:t,items:i}=this.state;return void 0!==t&&i.length>0?s.createElement(n.ItemPoolContainer,{id:e.widget.getId(),items:this.getItems(),renderItem:this.renderItem.bind(this),strategy:this.getItemPoolStrategy(),containerClass:"tw-counter"}):null}getItemPoolStrategy(){const{buildConfiguration:e}=this.props.model,t=new e.itemPoolStrategy;return t instanceof o.PartitionedValueItemPoolStrategy&&t.setIdleTimeRatio(.5),t}update(e){const{items:i}=this.state,s=_.last(i)||{key:"0",value:0,oldValue:0,duration:t.DEFAULT_ANIMATION_DURATION},n={key:`${Date.now()}`,value:this.extractValue(e),oldValue:s.value,duration:t.DEFAULT_ANIMATION_DURATION};this.setState({items:[n]})}draw(e){this.setState({drawSettings:e})}getItems(){return this.state.items}renderItem(e,t,i){return s.createElement(a.CounterRenderable,{key:t,value:e.value,oldValue:e.oldValue,duration:e.duration,drawSettings:this.state.drawSettings})}extractValue(e){const t=new i.DataGraphWrapper(e.widget.getDataGraph().payloadDataGraph),s=_.first(t.getRows());return _.first(s.getCells()).getNumericData()}}}),define("classes/strategies/partitioned_value_item_pool_strategy",["require","exports","reusable_components","log","reusable_utilities","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PartitionedValueItemPoolStrategy=class extends i.SingleValueItemPoolStrategy{constructor(){super(...arguments),this.idleTimeRatio=.5}setIdleTimeRatio(e){this.idleTimeRatio=e}handleNewPayloadArrival(e,t,i){const s=r.first(t.items),n=this.findLastValue(i);if(s.value===n.value)return i;{const e=this.partitionValue(s,n,this.getTimeFrame()*(1-this.idleTimeRatio));return{items:i.items,pool:this.calculateNewItemPool(i,e),nextItemArrival:Date.now()+this.getTimeFrame()}}}calculateNextRenderTime(e){const t=e.pool?e.pool.length:0,i=Math.max(0,e.nextItemArrival-Date.now()),s=r.first(e.items).duration;if(t>0){const e=i/t,r=Math.floor(e*n.MathUtils.getRandomRange(.85,1.33));return Math.max(this.minRenderDelay,Math.max(s+1,r))}return 0===i?0:Math.max(s,this.defaultRenderDelay)}findLastValue(e){return e.pool.length>0?r.last(e.pool):1===e.items.length?e.items[0]:(s.logService.debug("Could not find last used value in pool / items!",void 0,{state:e}),{key:"0",value:0,oldValue:0,duration:0})}partitionValue(e,t,i){const s=this.getPartitionCount(),n=this.createValueAndDurationFactors(s);return this.createPartitions(s,e,t,n,i)}createValueAndDurationFactors(e){const t=r.times(e,()=>({value:n.MathUtils.getRandomRange(10,50,1),duration:n.MathUtils.getRandomRange(10,50,1)})),i=t.reduce((e,t)=>e+t.value,0),s=t.reduce((e,t)=>e+t.duration,0);return t.map(e=>({value:e.value/i,duration:e.duration/s}))}createPartitions(e,t,i,s,n){const o=[];return r(r.range(e)).chain().reduce((r,a)=>{const l=a===e-1,c=s[a],d=this.calculatePartitionValue(l,r,t,i,c);return o.push({value:d,oldValue:r,key:this.createKey(t.value,a),duration:this.calculatePartitionAnimationDuration(n,c)}),d},i.value).value(),o}calculatePartitionValue(e,t,i,s,n){if(e){const e=i.value-s.value;return this.createPartitionValueFromPrevious(t,e,n)}return i.value}createPartitionValueFromPrevious(e,t,i){return e+t*i.value}createKey(e,t){return`${e}:${t}`}calculatePartitionAnimationDuration(e,t){return e*t.duration}getPartitionCount(){return 5}}}),define("fragments/counter_fragment",["require","exports","react-dom","react","widget_base","containers/counter_container"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CounterFragment=class extends n.AbstractReactFragment{renderIntoContainer(e,t){i.render(s.createElement(r.CounterContainer,{model:this.fragmentModel,onDraw:t,onUpdate:e}),this.chartContainer)}}}),define("counter",["require","exports","classes/counter_number_formatter","classes/strategies/partitioned_value_item_pool_strategy","containers/counter_container","fragments/counter_fragment"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("css_module",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CssModule=class{constructor(e,t){this.styleFactory=e,this.jss=t}compute(e){const t=!!this.compiledStyleSheet;return this.compiledStyleSheet&&this.compiledStyleSheet.detach(),this.styleSheetModel=this.styleFactory(e),this.compiledStyleSheet=this.jss.createStyleSheet(this.styleSheetModel),t&&this.attach(),this}getModule(){if(!this.compiledStyleSheet)throw new Error("can't get module before computing");return this.compiledStyleSheet.classes}getStyleSheetModel(){return this.styleSheetModel}attach(){if(!this.compiledStyleSheet)throw new Error("can't attach before computing");return this.compiledStyleSheet.attach(),this}detach(){if(!this.compiledStyleSheet)throw new Error("can't detach before computing");return this.compiledStyleSheet.detach(),this}}}),define("css_module_service",["require","exports","jss","jss-preset-default","css_module"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i.create(s.default());t.createCssModule=function(e){return new n.CssModule(e,r)}}),define("css_modules",["require","exports","css_module","css_module_service"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("cubic_array/cubic_array",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=[]){this.data=e}getData(){return this.data}setData(e){this.data=e}flatten(){return i.flatten(this.data)}getX(){return this.data}getY(e){return this.getX()[e]}getZ(e,t){return this.getY(e)[t]}mapZ(e){return new s(this.data.map((t,i)=>t.map((s,n)=>s.map((r,o)=>e(r,s,t,o,n,i)))))}}t.CubicArray=s}),define("data_graph/tendency",["require","exports","underscore","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tendency=class{constructor(e,t){this.tendencyFeature={name:"Tendency",style:""},s.logService.assert(i.isNumber(e),"value must be a number",this.tendencyFeature,{value:e}),this.value=e,this.oldValue=t,this.compute()}isPositive(){return this.positive}isNegative(){return this.negative}isOldValueZero(){return this.oldValueZero}isOldValueUndefined(){return void 0===this.oldValue}getValueAbs(){return this.valueAbs}getValueSigned(){return this.valueSigned}getValueAbsPercentage(){return this.valueAbsPercentage}getValue(){return this.value}getOldValue(){return this.oldValue}getPostfix(){return this.postfix}getSign(){return this.sign}setValue(e,t){return s.logService.assert(i.isNumber(e),"value must be a number",this.tendencyFeature),e!==this.getValue()&&(this.value=e,t||this.compute()),this}setOldValue(e,t){return e!==this.getOldValue()&&(this.oldValue=e,t||this.compute()),this}compute(){this.oldValueZero=0===this.getOldValue();const e=this.getValue()-this.getOldValue(),t=this.isOldValueZero()?0:e/Math.abs(this.getOldValue()),i=100*t;return this.positive=e>=0,this.negative=e<0,this.valueSigned=i,this.valueAbs=Math.abs(i),this.valueAbsPercentage=Math.abs(t),this.postfix="%",this.sign=this.isPositive()?"+":this.isNegative()?"-":"",this}build(){return{is_available:!this.isOldValueUndefined(),is_old_value_zero:this.isOldValueZero(),value:this.getValue(),old_value:this.getOldValue(),is_positive:this.isPositive(),is_negative:this.isNegative(),value_raw:this,sign:this.getSign(),value_abs:this.getValueAbs(),value_signed:this.getValueSigned(),value_abs_percentage:this.getValueAbsPercentage(),postfix:this.getPostfix()}}}}),define("data_graph/popover_data",["require","exports","data_graph/tendency","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t,i=!1){this.values=[],this.additionalData=[],this.color=e,this.title=t,this.centerData=i}static centered(){return new n("","",!0)}addValue(e,t,i){const s={label:e,value:t,tendency:i};return this.values.push(s),this}addAdditionalData(e,t){const i={color:e,label:t};return this.additionalData.push(i),this}clearValues(){return this.values.length=0,this}setColor(e){return this.color=e,this}setTitle(e){return this.title=e,this}setCorner(e){return this.corner=e,this}setDataCentered(e){return this.centerData=e,this}setHeader(e){return this.header=e,this}getColor(){return this.color}getTitle(){return this.title}getCorner(){return this.corner}getHeader(){return this.header}getValues(){return this.values}buildValues(){return this.values.map(e=>(void 0===e.tendency||e.tendency instanceof i.Tendency||s.logService.warn("Usage of manual tendency objects is deprecated, please use the Tendency class!"),{label:e.label,value:e.value,tendency:e.tendency instanceof i.Tendency?e.tendency.build():e.tendency}))}getAdditionalData(){return this.additionalData}isDataCentered(){return this.centerData}build(){return{node:(this.getTitle()||this.getColor())&&{color:this.getColor(),label:this.getTitle(),corner:this.getCorner()},values:this.buildValues(),header:this.getHeader(),additionalData:this.getAdditionalData()}}}t.PopoverData=n}),define("data_model/dataset",["require","exports","underscore","event","reusable_utilities","data_graph/tendency"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e=0,t,i,n=0,r,o){this.value=e,this.label=i,this.popoverFooter=o,this.allowsDefaultLabels=!1,this.usePopoverFooterAsLabel=!1,this.disabledEvents=!1,this.percentageValue="",this.showsColor=!0,this.onChange=new s.Event,this.onValueChange=new s.Event,this.onColorChange=new s.Event,this.onDataChange=new s.Event,this.setId(),this.setOldValue(n),this.setSubLabel(r),this.setColor(t)}clone(){const e=new o(this.value);return e.merge(this),e.setColor(e.getColor().clone()),e}getValue(){return this.value}get _value(){return this.getValue()}set _value(e){this.setValue(e)}get _color(){return this.getColor()}set _color(e){this.setColor(e)}setColorVisibility(e){return this.showsColor=e,this}setValue(e){return this.value=Math.round(1e3*e)/1e3,this.hasOldValue()&&this.getTendency().setValue(this.value),this.onValueChange.fire({newValue:this.value}),this.onChange.fire({newValue:this.value}),this}hasOldValue(){return void 0!==this.getOldValue()}getOldValue(){return this.oldValue}setOldValue(e){return this.oldValue=Math.round(1e3*e)/1e3,void 0!==this.getValue()&&this.getTendency().setOldValue(this.oldValue),this}getTendency(){return void 0===this.tendency&&(this.tendency=new r.Tendency(this.getValue(),this.getOldValue())),this.tendency}getValueChanged(){return this.getTendency().build()}getId(){return this.id}setId(e="dataset id: "+Math.random()){return this.id=e,this}getPopoverValue(){return this.popoverValue}hasPopoverValue(){return void 0!==this.getPopoverValue()}setPopoverValue(e){return this.popoverValue=e,this}getPopoverFooter(){return this.popoverFooter}hasPopoverFooter(){return void 0!==this.popoverFooter}setPopoverFooter(e){return this.popoverFooter=e,this}getPreviousValue(){return this.getOldValue()}setPreviousValue(e){return this.setOldValue(e)}getLabel(){return void 0!==this.label?this.label:this.hasDefaultLabelsEnabled()?this.getPercentageValue():""}getPercentageValue(){return this.percentageValue}setPercentageValue(e){return this.percentageValue=e,this}enableDefaultLabels(e){return this.allowsDefaultLabels=e,this}hasDefaultLabelsEnabled(){return this.allowsDefaultLabels}enablePopoverFooterAsLabel(e){return this.usePopoverFooterAsLabel=e,this}hasPopoverFooterAsLabelEnabled(){return this.usePopoverFooterAsLabel}setLabel(e){return this.label=e,this.onChange.fire({newLabel:e}),this}getSubLabel(){return this.subLabel}setSubLabel(e){return this.subLabel=e||window.constants.messages._295682,this}getColor(){return this.color}setColor(e){return this.color=e instanceof n.Color?e:new n.Color(e),this.onColorChange.fire({newColor:e}),this.onChange.fire({newColor:e}),this}getData(){return this.data}setData(e){return this.data=e,this.onDataChange.fire({newData:e}),this.onChange.fire({newData:e}),this}disableEvents(e){return this.disabledEvents=e,this}areEventsDisabled(){return this.disabledEvents}getPopOverData(){return this.popoverData}hasPopOverData(){return void 0!==this.popoverData}setPopOverData(e){return this.popoverData=e,this}getFilters(){return this.filters}setFilters(e,t){if(void 0!==e)if(i.isString(e))this.filters=[n.StringUtils.parseFilters(e)];else{if(!i.isArray(e)&&!t)throw new Error("Unsupported filtertype passed. Expected is a filterstring or an array of parsed and built filters.");this.filters=e}return this}setAdditionalMetric(e){this.additionalMetric=e}getAdditionalMetric(){return this.additionalMetric}hasAdditionalMetric(){return void 0!==this.additionalMetric}merge(e){return this.setValue(e.value),this.setOldValue(e.oldValue),this.setSubLabel(e.subLabel),this.setLabel(e.label),this.setColor(e.color),this.setFilters(e.filters,!0),this.setPopoverFooter(e.popoverFooter),this.setPopoverValue(e.popoverValue),this.setAdditionalMetric(e.additionalMetric),this.setId(e.id),this.allowsDefaultLabels=e.allowsDefaultLabels,this.disabledEvents=e.disabledEvents,this}}t.Dataset=o}),define("data_graph/data_graph_row",["require","exports","reusable_utilities","data_graph/data_graph_cell"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataGraphRow=class{constructor(e,t){this.cells=[],this.min=Number.POSITIVE_INFINITY,this.max=Number.NEGATIVE_INFINITY,this.row=e,this.color=new i.Color(e.color),this.alternateDarkColor=new i.Color(e.alternate_dark_color),this.alternateLightColor=new i.Color(e.alternate_light_color),e.cells.forEach((e,i)=>new s.DataGraphCell(e,this,t[i]))}getMin(){return this.min}getMax(){return this.max}getFormattedLabel(e){const t=this.getRow();return"datetime"===t.data_type?t.name_formatted_full:this.getLabel(e)}toProto(){return this.getRow()}getRow(){return this.row}getValueBounds(){return{min:this.min,max:this.max}}addCell(e){return this.getCells().indexOf(e)<0&&(this.getCells().push(e),this.updateBounds(e)),this}updateBounds(e){const t=e.getValue();return t<this.min&&(this.min=t),t>this.max&&(this.max=t),this}getCells(){return this.cells}getCode(){return this.getRow().code}getLabel(e){return e&&this.getRow().translated_label||this.getRow().label}getFilters(){return this.getRow().filter}hasColor(){return void 0!==this.getRow().color}getColor(){return this.getTwColor().toRGBAString()}getTwColor(){return this.color}getAlternateDarkColor(){return this.alternateDarkColor}getAlternateLightColor(){return this.alternateLightColor}}}),define("data_graph/data_graph_wrapper",["require","exports","underscore","data_graph/data_graph_column","data_graph/data_graph_row"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=!1){this.columns=[],this.rows=[],this.additionalFrames=[],this.dataGraph=e,t||this.validate(),this.getColumnGroups().forEach(e=>e.data_columns.forEach(e=>this.columns.push(new s.DataGraphColumn(e)))),e.rows.forEach(e=>this.rows.push(new n.DataGraphRow(e,this.getColumns()))),void 0!==e.additional_frames&&e.additional_frames.forEach(e=>this.additionalFrames.push(new r(e)))}toProto(){return this.getDataGraph()}getDataGraph(){return this.dataGraph}hasCutoffs(){return void 0!==this.getCutoffs()&&0!==this.getCutoffs().length}getCutoffs(){return this.getDataGraph().cutoffs_in_time_range}getColumnGroups(){return this.getDataGraph().column_groups}getColumns(){return this.columns}findComment(e,t){return this.getComments().find(i=>i.row_key===e&&i.timestamp===t)}getCommentsWithMarkers(e){let t=0;return i(this.getComments()).chain().filter(t=>!e||!0===t.pinned).sortBy(e=>parseInt(e.timestamp)).value().map(e=>(e.pinned&&(e.marker=String.fromCharCode("a".charCodeAt(0)+t),t++),e))}getComments(){return this.getDataGraph()&&this.getDataGraph().comments||[]}hasComments(){return this.getComments().length>0}getRowCount(){return this.getRows().length}getRows(){return this.rows}getFramesOfType(e){return this.getAllFrames().filter(t=>t.getMetaData().attributes.dataframe_type===e)}getAllFrames(){return[this,...this.additionalFrames]}getAdditionalFrames(){return this.additionalFrames}hasAdditionalFrames(){return this.additionalFrames.length>0}getNumberOfAnimationFrames(){return this.getAttributes().number_of_animation_frames}hasNumberOfAnimationFrames(){return this.hasAttributes()&&void 0!==this.getAttributes().number_of_animation_frames}hasAnimationTimeFrame(){return this.hasAttributes()&&void 0!==this.getAttributes().animation_timeframe}getAnimationTimeFrame(){return this.getAttributes().animation_timeframe}hasAnimationFrameTimestamp(){return this.hasAnimationTimeFrame()&&void 0!==this.getAnimationTimeFrame().timestamp}getAnimationFrameTimestamp(){return this.getAnimationTimeFrame().timestamp}hasAnimationTimeRange(){return this.hasAttributes()&&this.getAttributes().animation_time_range}getAnimationTimeRange(){return this.getAttributes().animation_time_range}getAnimationTimeRangeStart(){return this.getAnimationTimeFrame().start}getAnimationTimeRangeEnd(){return this.getAnimationTimeFrame().end}hasMetaData(){return void 0!==this.dataGraph.meta_data}getMetaData(){return this.dataGraph.meta_data}hasAttributes(){return this.hasMetaData()&&void 0!==this.getMetaData().attributes}getAttributes(){return this.getMetaData().attributes}hasAnimationRange(){return this.hasAttributes()&&void 0!==this.getAttributes().animation_time_range}getAnimationRange(){return this.getAttributes().animation_time_range}hasTrendsFetchTime(){return this.hasAttributes()&&void 0!==this.getAttributes().trends_fetch_time}getTrendsFetchTime(){return this.getAttributes().trends_fetch_time}getAnimationRangeEndTimestamp(){return this.getAnimationRange().end}getAnimationRangeStartTimestamp(){return this.getAnimationRange().start}getLabel(){return this.dataGraph.total_label}getSubLabel(){return this.dataGraph.x_axis_name}getColumnCount(){return this.getColumns().length}getStartTimestamp(){return this.getColumns()[0].getTimestamp()}getEndTimestamp(){return this.getColumns()[this.getColumnCount()-1].getTimestamp()}validate(){return this}isSampleData(){return this.getDataGraph().sample_data}isClickable(){return this.getDataGraph().clickable&&!window.embedded_mode}}t.DataGraphWrapper=r}),define("data_graph/data_graph_column_metadata",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataGraphColumnMetadata=class{constructor(e){this.column=e}getAssociatedColumn(){return this.column}getMetaData(){return this.getAssociatedColumn().meta_data}getAttributes(){return this.getMetaData().attributes}getLatitude(){return this.getAttributes().latitude}getLongitude(){return this.getAttributes().longitude}getGeohashCoordinates(){return this.getAttributes().geohash_box_coords}toProto(){return this.getMetaData()}}}),define("data_graph/data_graph_column",["require","exports","reusable_utilities","underscore","data_model/dataset","data_graph/data_graph_cell","data_graph/data_graph_column_metadata"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataGraphColumn=class{constructor(e){this.cells=[],this.column=e,this.color=new i.Color(e.color||i.Color.random(void 0===e.name?Date.now():i.StringUtils.calculateHash(e.name))),this.metadata=new o.DataGraphColumnMetadata(e),this.filter=i.StringUtils.parseFilters(e.filter)}getFormattedLabel(){const e=this.getColumn();return"datetime"===e.data_type?e.name_formatted_full:this.getName()}addCell(e){this.getCells().indexOf(e)<0&&this.getCells().push(e)}getColumn(){return this.column}getMetadata(){return this.metadata}hasColor(){return void 0!==this.getColumn().color}getColor(){return this.getTwColor().toRGBAString()}getFilter(){return this.filter}getTwColor(){return this.color}getCells(){return this.cells}getSummaryCell(){return void 0!==this.summaryCellCount&&this.summaryCellCount===this.cells.length||this.computeSummaryCell(),this.summaryCell}computeSummaryCell(){const e=r.DataGraphCell.zeroCellValue();this.cells.forEach(t=>{e.numeric_data+=t.getNumericData(),t.hasOldNumericData()&&(e.numeric_data_old+=t.getOldNumericData())}),e.value=e.numeric_data.toString(),e.value_old=e.numeric_data_old.toString(),e.formatted_value=i.StringUtils.formatNumber(e.numeric_data),this.summaryCell=r.DataGraphCell.zero(e,this),this.summaryCell.pickColor(this),this.summaryCellCount=this.cells.length}getTimestamp(){return this.getColumn().timestamp}getLabel(){return this.getColumn().label}getName(){return this.getColumn().name}toProto(){return this.getColumn()}getCode(){return this.getColumn().code}getIdentifier(){return this.getCode()||this.metadata.column.function}toDataset(){const e=this.getSummaryCell(),t=new n.Dataset(e.getNumericData(),e.getTwColor());return t.setSubLabel(this.getLabel()),t.setLabel(this.getName()),t.setId(this.getCode()),t.setPopoverFooter(this.getName()),t.setOldValue(e.getOldNumericData()),t.setFilters(this.getFilter().map(e=>s.isArray(e)?e:[e])),t.setAdditionalMetric(e.getAdditionalMetric()),t}}}),define("data_graph/data_graph_cell",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,s){this.color=new i.Color,this.predictionColor=this.color.clone(),this.cell=e,void 0!==t&&this.linkToRow(t),void 0!==s&&this.linkToColumn(s)}static zeroCellValue(){return{value:"0",formatted_value:"0",value_old:"0",formatted_value_old:"0",numeric_data_old:0,predicted_value:!1,numeric_data:0}}static zero(e=s.zeroCellValue(),t){const i=new s({peak:!1,value:e,filter:"",requested_page_type:"GENERIC"});return i.column=t,i}getRequestedPageType(){return this.getCell().requested_page_type?this.getCell().requested_page_type:this.getRow().getRow().requested_page_type?this.getRow().getRow().requested_page_type:this.getColumn().getColumn().requested_page_type?this.getColumn().getColumn().requested_page_type:void 0}toProto(){return this.cell}getCell(){return this.cell}getTimestamp(){return this.getColumn().getTimestamp()}hasValue(){return void 0!==this.getValue()}linkToColumn(e,t=!1){return e.addCell(this),this.column=e,t&&this.pickColor(e),this}linkToRow(e,t=!0){return e.addCell(this),this.row=e,t&&this.pickColor(e),this}pickColor(e){this.color=e.getTwColor().clone(),this.isPredicted()&&(this.predictionColor=this.color.clone().increaseHue(20,!0))}getRow(){return this.row}getColumn(){return this.column}getIntensity(){return this.getValueObject().intensity}getColor(){return this.color.toRGBAString()}getPredictedColor(){return this.predictionColor.toRGBAString()}getTwColor(){return this.color}getPredictedTwColor(){return this.predictionColor}isPredicted(){return!0===this.getValueObject().predicted_value}getFormattedValue(){return this.getValueObject().formatted_value}isPercentageBased(){return this.getValueObject().formatted_value&&this.getValueObject().formatted_value.indexOf("%")>-1}getValue(){return this.hasData()?Number(this.getValueObject().value):void 0}getValueObject(){return this.getCell().value}hasNumericData(){return this.hasData()&&void 0!==this.getValueObject().numeric_data}getNumericData(){return this.hasNumericData()?Number(this.getValueObject().numeric_data):void 0}hasData(){return void 0!==this.cell}getOldValue(){return this.hasData()?Number(this.getValueObject().value_old):void 0}hasOldNumericData(){return this.hasData()&&void 0!==this.getValueObject().numeric_data_old}getOldNumericData(){return this.hasOldNumericData()?Number(this.getValueObject().numeric_data_old):void 0}getAdditionalMetric(){return this.getValueObject().additional_metric}}t.DataGraphCell=s}),define("data_model/abstract_data_model",["require","exports","event","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDatamodel=class{constructor(e){this.id=Math.random().toString(),this.datasets=[],this.subscriptions=[],this.additionalFrames=[],this.isSampleData=!1,this.allowsDefaultLabels=!1,this.usePopoverFooterAsLabel=!1,this.onValueFormat=new i.Event,this.setData(e)}getTotal(e=Number.POSITIVE_INFINITY){let t=0;return this.getDatasets().forEach((i,s)=>{s<e&&(t+=i.getValue())}),t}hasAdditionalFrames(){return this.additionalFrames.length>0}getAdditionalFrames(){return this.additionalFrames}getAdditionalFramesAsDatagraphs(){return s.pluck(this.additionalFrames,"datagraph")}getOriginalModel(){return this.original}getDataGraph(){return this.datagraph}hasDataGraph(){return void 0!==this.datagraph}isClickable(){return this.hasDataGraph()&&this.getDataGraph().isClickable()||!this.hasDataGraph()}addDataset(e){return e.enableDefaultLabels(this.allowsDefaultLabels),this.datasets.push(e),this}addDatasets(e){return e.forEach(e=>this.addDataset(e)),this}enableDefaultLabels(e){return this.datasets.forEach(t=>t.enableDefaultLabels(e)),this.hasAdditionalFrames()&&this.getAdditionalFrames().forEach(t=>t.enableDefaultLabels(e)),this.allowsDefaultLabels=e,this}enablePopoverFooterAsLabel(e){return this.datasets.forEach(t=>t.enablePopoverFooterAsLabel(e)),this.hasAdditionalFrames()&&this.getAdditionalFrames().forEach(t=>t.enablePopoverFooterAsLabel(e)),this.usePopoverFooterAsLabel=e,this}getDataset(e){return this.datasets[e]}getDatasets(){return this.datasets}formatValues(){this.onValueFormat.fire()}setLabel(e){return this.label=e,this}getLabel(){return this.label}getId(){return this.id}setId(e){return this.id=e,this}getData(){return this.data}setData(e){return this.data=e,this}removeDataset(e){const t=this.getDatasets(),i=t.indexOf(e);return t.splice(i,1),this.subscriptions.splice(i,1)[0].cancel(),this}clearDatasets(){return this.getDatasets().forEach((e,t)=>this.subscriptions[t].cancel()),this.datasets=[],this.subscriptions=[],this}sortByPredicate(e){const t=s.sortBy(this.getDatasets(),e);return this.getDatasets().splice(0,this.getDatasets().length),this.datasets=t,this}sort(e=!1){return e?this.sortByPredicate(e=>e.getValue()):this.sortByPredicate(e=>-e.getValue())}getAmountOfRelevantDatasets(){return this.getDatasets().filter(e=>e.getValue()>0).length}}}),define("data_model/data_model",["require","exports","data_model/dataset","data_model/abstract_data_model","underscore","data_graph/data_graph_wrapper"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends s.AbstractDatamodel{constructor(e,t=!1,s=!1){super(e),this.setData(e),n.isArray(e)?e.forEach(e=>this.addDataset(e)):void 0!==e&&(e instanceof r.DataGraphWrapper?this.datagraph=e:void 0!==e.data_graph&&(this.datagraph=new r.DataGraphWrapper(e.data_graph)),this.datagraph.getRows().forEach(e=>e.getCells().forEach((t,s)=>{const n=new i.Dataset(t.getNumericData(),e.getTwColor());n.setSubLabel(this.datagraph.getColumns()[s].getLabel()),n.setId(e.getCode()),n.setPopoverFooter(e.getLabel()),n.setOldValue(t.getOldNumericData()),n.setFilters(e.getFilters()),n.setAdditionalMetric(t.getAdditionalMetric()),this.addDataset(n)})),t||this.datagraph.getAdditionalFrames().forEach(e=>this.additionalFrames.push(new o(e))),s||(this.original=new o(this.datagraph,!0,!0)),this.isSampleData=this.datagraph.isSampleData(),this.setLabel(this.datagraph.getLabel()))}}t.Datamodel=o}),define("data_model/model_enhancer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ModelEnhancer=class{static calculatePercentages(e,t,i){let s=_.pluck(e.getDatasets(),"value");i>0&&(s=s.splice(0,i)),t.valuesToPercentages(s).forEach((t,i)=>e.getDataset(i).setPercentageValue(t))}}}),define("network/influencer_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerModel=class{constructor(e){this.sources=[],this.targets=[],this.data=e,this.id=e.author_i_d,this.name=e.author_long_name,this.followers=e.followers,this.profileUrl=e.profile_url}getId(){return this.id}getName(){return this.name}getFollowers(){return this.followers}setSources(e){return this.sources=e,this}addSource(e){return this.sources.push(e),this}getSources(){return this.sources}setTargets(e){return this.targets=e,this}addTarget(e){return this.targets.push(e),this}getTargets(){return this.targets}getProfileUrl(){return this.profileUrl}getData(){return this.data}}}),define("network/network_node_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkNodeModel=class{constructor(e){this.nativeSize=0,this.nativeX=0,this.nativeY=0,this.x=0,this.y=0,this.radius=0,this.data=e,this.id=e.uid,this.nativeSize=e.size,this.nativeX=e.x,this.nativeY=e.y}getId(){return this.id}getClusterId(){return this.data.cluster_id}getClusterSize(){return this.data.cluster_size}getNativeSize(){return this.nativeSize}getNativeX(){return this.nativeX}getNativeY(){return this.nativeY}getRadius(){return this.radius||this.getNativeSize()}getX(){return this.x||this.getNativeX()}getY(){return this.y||this.getNativeY()}getInfluencer(){return this.influencer}inflateBy(e,t){return void 0!==t?(this.radius=this.getNativeSize()*e/2,this.x=this.getNativeX()*e/2,this.y=this.getNativeY()*t/2):(this.radius=this.getNativeSize()*e,this.x=this.getNativeX()*e,this.y=this.getNativeY()*e),this}getColor(){return this.data.color}getIteration(){return this.data.iteration}setIteration(e){return this.data.iteration=e,this}getAuthorIds(){return this.data.author_ids}getTimestamp(){return this.data.timestamp}isOrigin(){return this.data.origin}getUrls(){return this.data.urls}isFromFullIndex(){return this.data.from_full_index}getData(){return this.data}getPosition(){return this.data.position}getBreakdownCode(){return this.data.breakdown_code}getLocation(){return this.data.location}getCoordinates(){const e=this.getLocation();return[e.longitude,e.latitude]}}}),define("network/influencer_node_model",["require","exports","network/influencer_model"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNodeModel=class{constructor(e){this.MIN_NODE_RADIUS=.1,this.nativeSize=0,this.nativeX=0,this.nativeY=0,this.x=0,this.y=0,this.radius=0,this.data=e,this.id=e.author_i_d,this.nativeSize=e.size,this.nativeX=e.x,this.nativeY=e.y,this.imageUrl=e.image_url,this.influencer=new i.InfluencerModel(this.buildInfluencerStruct())}buildInfluencerStruct(){return{author_i_d:this.data.author_i_d,author_short_name:this.data.author_short_name,author_long_name:this.data.author_long_name,profile_url:this.data.profile_url,followers:this.data.followers}}getId(){return this.id}getName(){return this.data.author_long_name}getdisplayName(){return this.data.author_short_name}getNativeSize(){return this.nativeSize}getNativeX(){return this.nativeX}getNativeY(){return this.nativeY}getRadius(){return this.radius||this.getNativeSize()}getX(){return this.x||this.getNativeX()}getY(){return this.y||this.getNativeY()}getInfluencer(){return this.influencer}isInfluencer(){return this.data.influencer}normalize(e,t){return this.radius=Math.max(this.getNativeSize()*e,this.MIN_NODE_RADIUS),void 0!==t?(this.x=this.getNativeX()*e,this.y=this.getNativeY()*t):(this.x=this.getNativeX()*e,this.y=this.getNativeY()*e),this}getColor(){return this.data.color}getImageUrl(){return this.imageUrl}getAuthorId(){return this.data.author_i_d}getData(){return this.data}}}),define("network/network_edge_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkEdgeModel=class{constructor(e,t,i){this.owner=e,this.target=t,this.data=i}getOwner(){return this.owner}getStartUid(){return this.data.start_uid}getEndUid(){return this.data.end_uid}getTarget(){return this.target}getColor(){return this.data.color}getData(){return this.data}getIteration(){return this.data.iteration}}}),define("network/network_meta_data_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkMetadataModel=class{constructor(e){this.data=e}getBreakdown(){return this.data.attributes.breakdown}getBoundingBox(){return this.data.attributes.bounding_box}getBreakdownByKey(e){return this.data.attributes.breakdown[e]}getBreakdownType(){return this.data.attributes.breakdown_type}getTimeAxes(){return this.data.attributes.time_axes}getTimeInterval(){return this.data.attributes.time_interval}}}),define("network/network_model",["require","exports","underscore","network/network_node_model","network/network_edge_model","network/network_meta_data_model","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkModel=class{constructor(e){this.nodeModels=[],this.edgeModels=[],this.data=e;const t=e.graph,o=t.vertices;i.each(Object.keys(o),e=>this.nodeModels.push(new s.NetworkNodeModel(o[e]))),t.edges.forEach(e=>{const t=this.nodeModels.filter(t=>t.getClusterId()===e.start_uid)[0],i=this.nodeModels.filter(t=>t.getClusterId()===e.end_uid)[0];this.edgeModels.push(new n.NetworkEdgeModel(t,i,e))}),this.metadata=new r.NetworkMetadataModel(t.meta_data)}hasAdditionalFrames(){return!1}getAdditionalFrames(){throw new Error("Network models do not support animation frames")}getNodeModels(){return this.nodeModels}getEdgeModels(){return this.edgeModels}inflateNodes(e,t){return this.getNodeModels().forEach(i=>{i.inflateBy(e,t)}),this}getData(){return this.data}getMinimumIteration(){return this.getExtremumNodeFunctionResult("getIteration",!1)-.5}getMaximumIteration(){return this.getExtremumNodeFunctionResult("getIteration",!0)+.5}getNodesByAuthorId(e){return this.getNodeModels().filter(t=>i.contains(t.getAuthorIds(),e))}getNodesByIteration(e){return this.getNodeModels().filter(t=>t.getIteration()===e)}getMinimumTimestamp(){return this.getExtremumNodeFunctionResult("getTimestamp",!1)}getMaximumTimestamp(){return this.getExtremumNodeFunctionResult("getTimestamp",!0)}getExtremumNodeFunctionResult(e,t=!1){const i=t?Math.max:Math.min;let s=t?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;return this.getNodeModels().forEach(t=>s=i(o.ObjectUtils.applyFunctionIfAble(t,e),s)),s}getTimeAxes(){let e=this.getMetaData().getTimeAxes();return void 0!==e&&0!==e.length||(e=[{start:this.getMinimumTimestamp(),end:this.getMaximumTimestamp(),number_of_clusters:this.getNodeModels().length}]),i.sortBy(e,function(e){return e.end})}getMetaData(){return this.metadata}}}),define("network/influencer_network_model",["require","exports","underscore","network/network_edge_model","network/network_meta_data_model","reusable_utilities","network/influencer_node_model"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkModel=class{constructor(e){this.nodeModels=[],this.edgeModels=[],this.data=e;const t=e.graph,r=t.vertices;i.each(Object.keys(r),e=>this.nodeModels.push(new o.InfluencerNodeModel(r[e]))),t.edges.forEach(e=>{const t=this.nodeModels.filter(t=>t.getId()===e.start_uid)[0],i=this.nodeModels.filter(t=>t.getId()===e.end_uid)[0];this.edgeModels.push(new s.NetworkEdgeModel(t,i,e))}),this.metadata=new n.NetworkMetadataModel(t.meta_data)}hasAdditionalFrames(){return!1}getAdditionalFrames(){throw new Error("Network models do not support animation frames")}getNodeModels(){return this.nodeModels}getEdgeModels(){return this.edgeModels}getInfluencerNodes(){return this.nodeModels.filter(e=>e.isInfluencer())}getFollowerCount(){return this.getInfluencerNodes().reduce((e,t)=>t.getInfluencer().getFollowers(),0)}normalizeNodes(e,t){return this.getNodeModels().forEach(i=>{i.normalize(e,t)}),this}getData(){return this.data}getMinimumIteration(){return this.getExtremumNodeFunctionResult("getIteration",!1)-.5}getMaximumIteration(){return this.getExtremumNodeFunctionResult("getIteration",!0)+.5}getNodesByAuthorId(e){return this.getNodeModels().filter(t=>t.getId()===e)[0]}getMinimumTimestamp(){return this.getExtremumNodeFunctionResult("getTimestamp",!1)}getMaximumTimestamp(){return this.getExtremumNodeFunctionResult("getTimestamp",!0)}getExtremumNodeFunctionResult(e,t=!1){const i=t?Math.max:Math.min;let s=t?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;return this.getNodeModels().forEach(t=>s=i(r.ObjectUtils.applyFunctionIfAble(t,e),s)),s}getTimeAxes(){let e=this.getMetaData().getTimeAxes();return void 0!==e&&0!==e.length||(e=[{start:this.getMinimumTimestamp(),end:this.getMaximumTimestamp(),number_of_clusters:this.getNodeModels().length}]),i.sortBy(e,function(e){return e.end})}getMetaData(){return this.metadata}}}),define("square_array/square_array",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e=[]){this.data=e}get width(){return this.data.length}get height(){return this.data[0].length}static createFromDimensions(e,t){const s=new Array(e);for(let i=0;i<e;i++)s[i]=new Array(t);return new i(s)}static fromVector(e){return i.createFromDimensions(e.x,e.y)}static fromSquareArray(e,t,s,n,r){const o=i.createFromDimensions(n,r);return o.forEach((i,n,r,o)=>{o[r]=e.getItem(n+t,r+s)}),o}has(e,t){return this.width>e&&this.height>t}transpose(){const e=i.createFromDimensions(this.height,this.width);return e.forEach((e,t,i,s)=>{s[i]=this.getItem(i,t)}),e}forEach(e){this.data.forEach((t,i)=>{for(let s=0;s<t.length;s++)e(t[s],i,s,t)})}copyFrom(e,t=0,i=Math.min(this.width,e.width),s=0,n=Math.min(this.height,e.height)){for(let r=t;r<i;r++)for(let t=s;t<n;t++)this.data[r][t]=e[r][t]}resize(e,t){const i=this.data;this.data=new Array(e.x);for(let i=0;i<e.x;i++)this.data[i]=new Array(e.y),this.data[i].fill(t);for(let t=0;t<Math.min(e.x,i.length);t++)for(let s=0;s<Math.min(e.y,i[t].length);s++)this.data[t][s]=i[t][s]}getData(){return this.data}setData(e){this.data=e}flatten(){return _.flatten(this.data)}getX(){return this.data}getY(e){return this.getX()[e]}getItem(e,t){return this.getY(e)[t]}setItem(e,t,i){this.getY(e)[t]=i}mapY(e){return new i(this.data.map((t,i)=>t.map((s,n)=>e(s,t,n,i))))}}t.SquareArray=i}),define("tree/quad/quad",["require","exports","math_utils","log","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t={maxDepth:5,maxObjectsPerNode:10},i=0){this.props=e,this.config=t,this.level=i,this.shapes=[],this.nodes=[]}insert(e){if(this.nodes.length>0){const t=this.findShapeFittingNode(e);if(void 0!==t)return void t.insert(e);this.nodes.forEach(t=>t.insert(e))}if(this.shapes.push(e),this.shapes.length>this.config.maxObjectsPerNode&&this.level<this.config.maxDepth){0===this.nodes.length&&this.split();const e=[];this.shapes.forEach(t=>{const i=this.findShapeFittingNode(t);void 0!==i?(i.insert(t),e.push(t)):this.nodes.forEach(i=>{i.insert(t),e.push(t)})}),e.forEach(e=>{this.shapes.splice(this.shapes.indexOf(e),1)})}}query(e){let t=[];return this.queryNode(e,t),t=n.uniq(t)}queryNode(e,t){switch(e.getType()){case i.ShapeType.RECTANGLE:this.queryRectangleNeighbors(e,t);break;default:s.logService.error("Shape type is not implemented")}}queryRectangleNeighbors(e,t){const i=this.findShapeFittingNode(e);void 0!==i?i.queryNode(e,t):this.nodes.forEach(i=>i.queryNode(e,t)),t.push(...this.shapes)}clear(){this.shapes.length=0,this.nodes.forEach(e=>{e.clear()}),this.nodes.length=0}split(){const e=this.props.bounds.width/2,t=this.props.bounds.height/2,s=this.props.bounds.x,n=this.props.bounds.y,o=this.level+1;this.nENode=new r({bounds:new i.Rectangle(new i.Vector2D(s+e,n),e,t)},this.config,o),this.sENode=new r({bounds:new i.Rectangle(new i.Vector2D(s+e,n+t),e,t)},this.config,o),this.sWNode=new r({bounds:new i.Rectangle(new i.Vector2D(s,n+t),e,t)},this.config,o),this.nWNode=new r({bounds:new i.Rectangle(new i.Vector2D(s,n),e,t)},this.config,o),this.nodes.push(this.nENode),this.nodes.push(this.sENode),this.nodes.push(this.sWNode),this.nodes.push(this.nWNode)}findShapeFittingNode(e){switch(e.getType()){case i.ShapeType.RECTANGLE:return this.findRectangleFittingNode(e);default:s.logService.error("Shape type is not implemented")}}findRectangleFittingNode(e){const t=this.props.bounds.width/2,i=this.props.bounds.height/2,s=this.props.bounds.x+t,n=this.props.bounds.y+i,r=e.y<n&&e.y+e.height<n,o=e.y>n&&e.y+e.height<this.props.bounds.y+this.props.bounds.height;if(e.y<s&&e.x+e.width<s){if(r)return this.nWNode;if(o)return this.sWNode}else{if(e.x>s&&e.x+e.width<this.props.bounds.x+this.props.bounds.width){if(r)return this.nENode;if(o)return this.sENode}}}}t.QuadTree=r}),define("data_structures",["require","exports","cubic_array/cubic_array","data_graph/data_graph_cell","data_graph/data_graph_column","data_graph/data_graph_column_metadata","data_graph/data_graph_row","data_graph/data_graph_wrapper","data_graph/popover_data","data_graph/tendency","data_model/abstract_data_model","data_model/data_model","data_model/dataset","data_model/model_enhancer","network/influencer_model","network/influencer_network_model","network/influencer_node_model","network/network_edge_model","network/network_meta_data_model","network/network_model","network/network_node_model","square_array/square_array","tree/quad/quad"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C){"use strict";function v(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),v(i),v(s),v(n),v(r),v(o),v(a),v(l),v(c),v(d),v(h),v(u),v(p),v(g),v(m),v(_),v(f),v(y),v(b),v(E),v(S),v(C)}),define("models/data_table_header",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/data_table_cell",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/data_table_click_action",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/data_table_row",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/data_table_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/header/data_table_sorting_ui_renderable",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableSortingUiRenderable=class extends i.BaseComponent{render(){const e=n({fa:!0,"fa-sort-asc":!0===this.props.isFancy&&"ASC"===this.props.sorted,"fa-sort-desc":!0===this.props.isFancy&&"DESC"===this.props.sorted,"fa-arrow-down":!1===this.props.isFancy&&void 0===this.props.sorted,"fa-arrow-circle-down":!1===this.props.isFancy&&void 0!==this.props.sorted});return s.createElement("div",{className:"sorted-bottom-line"},s.createElement("i",{className:e}))}}}),define("renderables/header/data_table_actions_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableHeaderActionsRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{className:"column-actions"},this.props.item.isDrilldown&&!this.props.item.groupId?s.createElement("i",{className:"fa fa-external-link filterable-icon",onClick:this.onDrilldownClick.bind(this,this.props.item)}):null,this.props.isEditMode?s.createElement("i",{className:"fa fa-eye-slash filterable-icon",onClick:this.onHideColumnClick.bind(this,this.props.item)}):null)}onDrilldownClick(e,t){t.preventDefault(),t.stopPropagation(),this.props.drillDownOnColumnCallback(e)}onHideColumnClick(e,t){t.preventDefault(),t.stopPropagation(),this.props.hideColumnCallback(e)}}}),define("renderables/header/data_table_header_renderable",["require","exports","flux","react","classnames","renderables/header/data_table_sorting_ui_renderable","renderables/header/data_table_actions_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableHeaderRenderable=class extends i.BaseComponent{render(){const e=this.props.item.isDrilldown&&void 0===this.props.item.groupId||this.props.isEditMode,t=n({"header-item":!0,"grid-row-header-full":!this.props.isSubcolumn,"grid-row-header-bottom-half":this.props.isSubcolumn,clickable:this.props.item.isSortable,sorted:!(!this.props.item.sorted&&!this.props.isHighlighted)}),i={gridColumn:`${this.props.col} / ${this.props.col+1}`,msGridColumn:`${this.props.col}`},a=void 0!==this.props.item.sorted||!1===this.props.isFancy&&!0===this.props.item.isSortable;return s.createElement("div",{className:t,style:i,onClick:this.props.item.isSortable?this.onSortClick.bind(this,this.props.item):void 0},s.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.item.label}}),e?s.createElement(o.DataTableHeaderActionsRenderable,{item:this.props.item,isEditMode:this.props.isEditMode,drillDownOnColumnCallback:this.props.drillDownOnColumnCallback,hideColumnCallback:this.props.hideColumnCallback}):null,a?s.createElement(r.DataTableSortingUiRenderable,{sorted:this.props.item.sorted,isFancy:this.props.isFancy}):null)}onSortClick(e,t){t.preventDefault(),t.stopPropagation(),this.props.sortOnColumnCalback(e)}}}),define("renderables/header/data_table_row_label_header_renderable",["require","exports","flux","react","classnames","renderables/header/data_table_sorting_ui_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableRowLabelHeaderRenderable=class extends i.BaseComponent{render(){const e=n({"header-row-label-spacer":!0,"grid-row-header-full":!0,"grid-col-1":!0,clickable:!0,sorted:void 0!==this.props.sorted}),t=void 0!==this.props.sorted||!1===this.props.isFancy;return s.createElement("div",{className:e,onClick:e=>this.onSortClick(e)},t?s.createElement(r.DataTableSortingUiRenderable,{sorted:this.props.sorted,isFancy:this.props.isFancy}):null)}onSortClick(e){e.preventDefault(),e.stopPropagation(),this.props.sortOnRowLabelsCallback()}}}),define("renderables/header/data_table_group_header_renderable",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableGroupHeaderRenderable=class extends i.BaseComponent{render(){const e=n({"header-item":!0,"grid-row-header-top-half":!0,sorted:this.props.isHighlighted}),t={gridColumn:`${this.props.col} / span ${this.props.span}`,msGridColumn:`${this.props.col}`,msGridColumnSpan:this.props.span};return s.createElement("div",{className:e,style:t},s.createElement("span",null,this.props.label))}}}),define("renderables/cell/data_table_cell_renderable",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableCellRenderable=class extends i.BaseComponent{render(){const e=n({"data-table-row-cell":!0,clickable:void 0!==this.props.drillDownOnCellCallback,"data-table-row-odd":!0===this.props.oddRow,"data-table-row-even":!1===this.props.oddRow}),t={msGridRow:this.props.row,msGridColumn:this.props.col};return s.createElement("div",{className:e,style:t,onClick:this.onClick.bind(this),dangerouslySetInnerHTML:{__html:this.props.item.label}})}onClick(e){e.preventDefault(),e.stopPropagation(),this.props.drillDownOnCellCallback&&this.props.drillDownOnCellCallback(this.props.item)}}}),define("renderables/cell/data_table_trend_cell_renderable",["require","exports","react","classnames","renderables/cell/data_table_cell_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableTrendCellRenderable=class extends n.DataTableCellRenderable{render(){const e=s({"data-table-row-cell":!0,clickable:void 0!==this.props.drillDownOnCellCallback,"data-table-row-odd":!0===this.props.oddRow,"data-table-row-even":!1===this.props.oddRow}),t={msGridRow:this.props.row,msGridColumn:this.props.col};return i.createElement("div",{className:e,style:t,onClick:this.onClick.bind(this)},i.createElement("p",null,i.createElement("span",null,i.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.item.label}}))),this.renderTendency())}renderTendency(){if(void 0===this.props.item.tendency)return null;const e=s({tendency:!0,negative:!this.props.item.tendency.isPositive,positive:this.props.item.tendency.isPositive}),t=s({"icon-tw":!0,"icon-tw-arrow-change-down":!this.props.item.tendency.isPositive,"icon-tw-arrow-change-up":this.props.item.tendency.isPositive});return 0!==this.props.item.tendency.change?i.createElement("p",{className:"tendency"},i.createElement("span",{className:e},i.createElement("span",{className:t},""),i.createElement("span",null,this.props.settings.style.formatting.numberFormatter.toPercentage(this.props.item.tendency.change)))):null}}}),define("renderables/cell/data_table_row_label_cell_renderable",["require","exports","react","classnames","flux"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableRowHeaderCellRenderable=class extends n.BaseComponent{render(){const e=s({"data-table-row-label":!0,"data-table-row-odd":!0===this.props.oddRow,"data-table-row-even":!1===this.props.oddRow,shortened:this.props.isShortened}),t={msGridRow:this.props.row};return i.createElement("div",{className:e,style:t},i.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.label}}))}}}),define("renderables/cell/data_table_action_cell_renderable",["require","exports","flux","react","classnames","reusable_components","event_bus"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableActionCellRenderable=class extends i.BaseComponent{render(){const e=n({"data-table-row-cell":!0,"data-table-row-odd":!0===this.props.oddRow,"data-table-row-even":!1===this.props.oddRow,"row-actions":!0}),t={msGridRow:this.props.row,msGridColumn:this.props.col};return this.props.item.actions?s.createElement("div",{className:e,style:t},this.props.item.actions.map((e,t)=>this.renderAction(e,t))):null}renderAction(e,t){const i=n({fa:!0,"fa-pencil":"pencil"===e.icon,"icon-tw-trash-bin":"trash"===e.icon,"fa-crosshairs":"crosshairs"===e.icon,"icon-tw-gear":"gear"===e.icon,"fa-user-plus":"add_influencer"==e.icon});return e.description?s.createElement(r.TooltipComponent,{key:`action-tooltip-${t}`,text:e.description,position:"top"},s.createElement("i",{className:i,onClick:t=>this.onClick(t,e)})):s.createElement("i",{key:`action-${t}`,className:i,onClick:t=>this.onClick(t,e)})}onClick(e,t){e.preventDefault(),e.stopPropagation(),o.eventBus.dispatch({type:o.EVENT_TYPES.CLICK_ACTION_TRIGGERED,value:{action:t,issueName:this.props.item.label}})}}}),define("renderables/cell/data_table_sentiment_cell_renderable",["require","exports","flux","react","classnames","sentiment_indicator","graphics_utilities"],function(e,t,i,s,n,r,o){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.POSITIVE="POSITIVE",e.NEUTRAL="NEUTRAL",e.NEGATIVE="NEGATIVE"}(a||(a={}));t.DataTableSentimentCellRenderable=class extends i.BaseComponent{render(){const e=n({"data-table-row-cell":!0,clickable:!1,"data-table-row-odd":!0===this.props.oddRow,"data-table-row-even":!1===this.props.oddRow,sentiment:!0}),t={msGridRow:this.props.row,msGridColumn:this.props.col};return s.createElement("div",{ref:e=>this.createSentimentIndicator(e),className:e,style:t})}createSentimentIndicator(e){e&&(void 0!==this.indicatorRef&&(e.removeChild(this.indicatorRef.getElement()),this.indicatorRef.dispose()),this.indicatorRef=new r.SentimentIndicatorComponent(e,{animationDuration:this.props.animationDuration,data:this.createSentimentCells(),height:15,width:256,globalWeight:this.props.globalWeight}))}createSentimentCells(){const e=[];let t=void 0;return Object.keys(a).filter(e=>isNaN(Number(e))).forEach(i=>{switch(i){case a.POSITIVE:t=this.props.item.sentiment.positive;break;case a.NEUTRAL:t=this.props.item.sentiment.neutral;break;case a.NEGATIVE:t=this.props.item.sentiment.negative}e.push({color:o.Color.fromARGBString(t.color),highlightColor:o.Color.fromARGBString(t.color).lighten(.5),id:t.label,weight:t.value,xOffset:-1,width:-1,popupPayload:{values:[{value:t.value,tendency:{is_positive:this.props.item.tendency.isPositive,is_negative:!this.props.item.tendency.isPositive,is_old_value_zero:0===this.props.item.tendency.change,value_abs_percentage:t.change}}],node:{label:t.label}}})}),e}}}),define("renderables/data_table_renderable_factory",["require","exports","react","renderables/data_table_renderable","renderables/cell/data_table_cell_renderable","renderables/cell/data_table_trend_cell_renderable","renderables/cell/data_table_row_label_cell_renderable","renderables/cell/data_table_action_cell_renderable","renderables/cell/data_table_sentiment_cell_renderable"],function(e,t,i,s,n,r,o,a,l){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROW_LABEL=0]="ROW_LABEL",e[e.CELL=1]="CELL",e[e.ACTIONS=2]="ACTIONS"}(c=t.DataTableCellType||(t.DataTableCellType={}));t.DataTableRenderableFactory=class{static makeCell(e,t,d,h,u,p,g){switch(e){case c.ROW_LABEL:if(t.model.hasRowLabels)return i.createElement(o.DataTableRowHeaderCellRenderable,{key:`row-${u}-label`,label:h.label,oddRow:u%2==0,row:u+1+s.HEADER_ROW_OFFSET,isShortened:t.model.isShortened});break;case c.CELL:return void 0!==d.sentiment?i.createElement(l.DataTableSentimentCellRenderable,{key:`row-${u}-cell-${p}`,item:d,animationDuration:t.settings.animationDuration,oddRow:u%2==0,col:p+(t.model.hasRowLabels?1:0)+s.GRID_CELL_OFFSET,row:u+1+s.HEADER_ROW_OFFSET,globalWeight:d.sentiment.globalWeight,drillDownOnCellCallback:g&&t.drillDownOnCellCallback?t.drillDownOnCellCallback.bind(this,d):void 0}):!0===t.model.useTrendCell?i.createElement(r.DataTableTrendCellRenderable,{key:`row-${u}-cell-${p}`,item:d,oddRow:u%2==0,col:p+(t.model.hasRowLabels?1:0)+s.GRID_CELL_OFFSET,row:u+1+s.HEADER_ROW_OFFSET,settings:t.settings,drillDownOnCellCallback:g&&t.drillDownOnCellCallback?t.drillDownOnCellCallback.bind(this,d):void 0}):i.createElement(n.DataTableCellRenderable,{key:`row-${u}-cell-${p}`,item:d,oddRow:u%2==0,col:p+(h.label?1:0)+1,row:u+1+s.HEADER_ROW_OFFSET,drillDownOnCellCallback:g&&t.drillDownOnCellCallback?t.drillDownOnCellCallback.bind(this,d):void 0});case c.ACTIONS:return i.createElement(a.DataTableActionCellRenderable,{key:`row-${u}-cell-${p}-actions`,item:h,oddRow:u%2==0,col:p+(h.label?1:0)+1,row:u+1+s.HEADER_ROW_OFFSET})}return null}}}),define("renderables/header/data_table_empty_header_renderable",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableEmptyHeaderRenderable=class extends i.BaseComponent{render(){const e=n({"header-item":!0,"grid-row-header-full":!0}),t={gridColumn:`${this.props.col} / ${this.props.col+1}`,msGridColumn:`${this.props.col}`};return s.createElement("div",{className:e,style:t})}}}),define("renderables/data_table_renderable",["require","exports","flux","classnames","react","renderables/header/data_table_header_renderable","renderables/header/data_table_row_label_header_renderable","renderables/header/data_table_group_header_renderable","renderables/data_table_renderable_factory","renderables/header/data_table_empty_header_renderable"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEADER_ROW_OFFSET=2,t.GRID_CELL_OFFSET=1;t.DataTableRenderable=class extends i.BaseComponent{render(){const e=s({"tw-new-data-table":!0,"side-padding":this.props.isSidePadding,fancy:this.props.isFancy});return n.createElement("div",{className:e},this.renderGridContainer())}renderGridContainer(){const{header:e,hasRowLabels:t,hasActions:i}=this.props.model,s={gridTemplateColumns:`repeat(${e.items.length+(t?1:0)+(i?1:0)}, auto)`};return n.createElement("div",{className:"data-table-container",style:s},this.renderHeader(),this.renderRows())}renderHeader(){const e=this.props.model.header,t=this.renderRowLabelHeader(),i=e.items.map((e,t)=>this.renderHeaderItem(e,t)),s=e.items.map((e,t)=>this.renderHeaderGroupItem(e,t)),n=this.renderActionsHeader(e.items.length);return[t,...i,n,...s]}renderRowLabelHeader(){return this.props.model.hasRowLabels?n.createElement(o.DataTableRowLabelHeaderRenderable,{key:"header-row-label",sortOnRowLabelsCallback:this.props.sortOnRowLabelsCallback,sorted:this.props.model.header.rowLabelSort,isFancy:this.props.isFancy}):null}renderHeaderItem(e,i){const s=this.props.model.hasGroups&&e.groupId?this.props.model.header.groups.find(t=>t.name===e.groupId):void 0;return n.createElement(r.DataTableHeaderRenderable,{key:`header-${e.label}-${i}`,item:e,col:i+(this.props.model.hasRowLabels?1:0)+t.GRID_CELL_OFFSET,isSubcolumn:!(!this.props.model.hasGroups||!e.groupId),isEditMode:this.props.isEditMode,isHighlighted:s&&s.highlighted,isFancy:this.props.isFancy,drillDownOnColumnCallback:this.props.drillDownOnColumnCallback,hideColumnCallback:this.props.hideColumnCallback,sortOnColumnCalback:this.props.sortOnColumnCalback})}renderHeaderGroupItem(e,i){if(!0!==this.props.model.hasGroups)return null;const s=e.groupId?this.props.model.header.groups.find(t=>t.name===e.groupId):void 0;return s&&!1===s.rendered?(s.rendered=!0,n.createElement(a.DataTableGroupHeaderRenderable,{key:`header-${s.name}-group-header`,label:s.name,col:i+(this.props.model.hasRowLabels?1:0)+t.GRID_CELL_OFFSET,span:s.size,isHighlighted:s&&s.highlighted})):null}renderActionsHeader(e){const i=e+t.GRID_CELL_OFFSET+(this.props.model.hasRowLabels?1:0);return this.props.model.hasActions?n.createElement(c.DataTableEmptyHeaderRenderable,{key:"header-actions",col:i,isFancy:this.props.isFancy}):null}renderRows(){const e=this.props.model.rows,t=this.props.model.header.items.map((e,t)=>e.isDrilldown);return _.flatten(e.map((e,i)=>this.renderRow(e,i,t)))}renderRow(e,t,i){return[l.DataTableRenderableFactory.makeCell(l.DataTableCellType.ROW_LABEL,this.props,void 0,e,t,void 0,!1),...e.cells.map((s,n)=>l.DataTableRenderableFactory.makeCell(l.DataTableCellType.CELL,this.props,s,e,t,n,i[n])),l.DataTableRenderableFactory.makeCell(l.DataTableCellType.ACTIONS,this.props,void 0,e,t,e.cells.length,!1)]}}}),define("containers/data_table_container",["require","exports","react","renderables/data_table_renderable","flux","event_bus","math_utils"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataTableContainer=class extends n.BaseComponent{constructor(e){super(e),this.model=e.model,this.cancellationToken.subscribe(e.onUpdate,e=>this.updateModel(e))}render(){const{settings:e,isEditMode:t,isSidePadding:n,isFancy:r,drillDownOnColumnCallback:o,drillDownOnCellCallback:a,hideColumnCallback:l,sortOnColumnCalback:c,sortOnRowLabelsCallback:d}=this.props;return i.createElement(s.DataTableRenderable,{model:this.model,settings:e,isEditMode:t,isSidePadding:n,isFancy:r,drillDownOnColumnCallback:o,drillDownOnCellCallback:a,hideColumnCallback:l,sortOnColumnCalback:c,sortOnRowLabelsCallback:d})}updateModel(e){this.model=e}componentDidMount(){this.triggerGridExpansion()}triggerGridExpansion(){const e=$(this.props.element).find(".data-table-container");r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.widgetId,expectedSize:this.props.settings.dimensions.size,realSize:new o.Vector2D(e.outerWidth(),e.outerHeight())}})}}}),define("data_table",["require","exports","containers/data_table_container","renderables/cell/data_table_action_cell_renderable","renderables/cell/data_table_cell_renderable","renderables/cell/data_table_sentiment_cell_renderable"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("cluster_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_SCALE=1,t.MAX_SCALE=100,t.RENDER_SETTINGS={lineThickness:.75,highlightLineThickness:1.5,nonSelectedClusterHoverOpacity:.3,selectedClusterHoverOpacity:.65,highlightDotRadiusMultiplier:1.3,maxHighlightDotRadius:16,showLabelPositionDots:!1,labelHighlightLineThickness:6},function(e){e.HORIZONTAL_LEFT="HORIZONTAL_LEFT",e.HORIZONTAL_CENTER="HORIZONTAL_CENTER",e.HORIZONTAL_RIGHT="HORIZONTAL_RIGHT"}(t.HorizontalClusterLabelAlignment||(t.HorizontalClusterLabelAlignment={})),function(e){e.VERTICAL_TOP="VERTICAL_TOP",e.VERTICAL_CENTER="VERTICAL_CENTER",e.VERTICAL_BOTTOM="VERTICAL_BOTTOM"}(t.VerticalClusterLabelAlignment||(t.VerticalClusterLabelAlignment={}))}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/document_cluster_node_model",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterNodeModel=class{constructor(e,t){this.data=e,this.color=t,this.id=e.id,this.shape=new i.Circle(new i.Vector2D(e.x,e.y),.8*e.size),this.clusterId=e.cluster_id}}}),define("models/document_cluster_link_model",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterLinkModel=class{constructor(e,t,s,n){this.startNode=t,this.endNode=s,this.color=n,this.isClusterEdgeLink=t.clusterId!==s.clusterId,this.entryId=e.source_id,this.clusterId=e.cluster_id,this.line=new i.Line(this.startNode.shape.position.clone(),this.endNode.shape.position.clone())}}}),define("classes/document_cluster_layout",["require","exports"],function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEFAULT="DOCUMENT_CLUSTER",e.SIDEBAR_HIDDEN="DOCUMENT_CLUSTER_GRAPH"}(i=t.DocumentClusterLayout||(t.DocumentClusterLayout={})),t.DOCUMENT_CLUSTER_FRAGMENT_LAYOUTS=[{id:i.DEFAULT,widthScalePriority:1.55,heightScalePriority:1,minWidth:0,minHeight:0},{id:i.SIDEBAR_HIDDEN,widthScalePriority:1,heightScalePriority:1,minWidth:0,minHeight:0}],t.DOCUMENT_CLUSTER_SIDEBAR_FRAGMENT_LAYOUTS=[{id:i.DEFAULT,widthScalePriority:0,heightScalePriority:1,minHeight:36,minWidth:480},{id:i.SIDEBAR_HIDDEN,widthScalePriority:0,heightScalePriority:0,minWidth:0,minHeight:0}]}),define("models/document_cluster_label_model",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterLabelModel=class{constructor(e){this.data=e,this.id=e.id,this.color=e.color,this.text=e.name,this.shape=new i.Rectangle(new i.Vector2D(e.non_overlapping_label_position.initial_label_x,e.non_overlapping_label_position.initial_label_y),0,0)}}}),define("models/document_cluster_model",["require","exports","models/document_cluster_node_model","models/document_cluster_link_model","graphics_utilities","models/document_cluster_label_model","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterModel=class{constructor(e,t,a,l,c){this.buildConfiguration=a,this.subFragments=l,this.numberFormatter=c,this.nodes={},this.links=[],this.generationTs=e.getPayloadValue().task_information.generation_ts,this.widget=e,this.layout=t;const d=e.getPayloadValue().graph;if(d.vertices){this.clusters=d.clusters;let e=0;for(const t of d.vertices){const s=n.Color.fromHex(d.clusters.find(e=>e.id===t.cluster_id).color);this.nodes[t.id]=new i.DocumentClusterNodeModel(t,s),e=Math.max(e,this.nodes[t.id].shape.radius)}i.DocumentClusterNodeModel.maxRadius=e,this.labels=d.clusters.filter(e=>this.isClusterVisible(e.id)).map(e=>new r.DocumentClusterLabelModel(e)),this.links=(d.edges||[]).map(e=>{const t=n.Color.fromHex(d.clusters.find(t=>t.id===e.cluster_id).color);return new s.DocumentClusterLinkModel(e,this.nodes[e.source_id],this.nodes[e.target_id],t)})}this.history=e.getPayloadValue().task_information.history,this.currentHistoryIndex=e.getPayloadValue().task_information.history_index,this.checkSum=o.StringUtils.calculateHash(JSON.stringify(d||{})),console.log(e.getPayloadValue()),console.log(this)}get customization(){const e=this.widget.getPayloadValue().graph;return e.customization?e.customization:{}}getClusterCustomization(e){return(this.customization.clusters||[]).find(t=>t.id===e)}isClusterVisible(e){const t=this.getClusterCustomization(e);return!t||!t.hidden}get visibleNodes(){return Object.keys(this.nodes).map(e=>{const t=this.nodes[e];if(this.isClusterVisible(t.clusterId))return t}).filter(e=>e)}get allNodes(){return Object.keys(this.nodes).map(e=>this.nodes[e]).filter(e=>e)}get visibleClusters(){return this.clusters.filter(e=>this.isClusterVisible(e.id))}get inVisibleClusters(){return this.clusters.filter(e=>!this.isClusterVisible(e.id))}get visibleLinks(){return this.links.map(e=>{if(this.isClusterVisible(e.clusterId))return e}).filter(e=>e)}getDocPercentage(e){const t=this.visibleClusters.reduce((e,t)=>e+t.doc_count,0);return this.numberFormatter.toPercentage(this.visibleClusters.find(t=>t.id===e).doc_count/t)}}}),define("classes/document_cluster_layer",["require","exports","widget_base"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterLayer=class{constructor(e,t,i){this.settings=t,this.createCanvas(this.settings,i),this.alpha=1}createCanvas(e,t){return this.canvas=document.createElement("canvas"),this.canvas.classList.add("canvas-hover-border-always"),this.context=this.canvas.getContext("2d"),void 0!==e.dimensions.height&&e.heightMode!==i.WidgetHeightMode.LEGACY&&(this.canvas.style.position="absolute"),void 0!==t&&t.appendChild(this.canvas),this.adjustCanvasSize(e),this}adjustCanvasSize(e){const t=Math.floor(e.dimensions.width),i=Math.floor(e.dimensions.height);return this.canvas.style.height=`${i}px`,this.canvas.style.width=`${t}px`,this.canvas.height=i*(e.resolutionMultiplier||1),this.canvas.width=t*(e.resolutionMultiplier||1),this}getWidth(){return this.settings.dimensions.width}getHeight(){return this.settings.dimensions.height}clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this}getContext(){return this.context}update(e){return this.settings=e,this.adjustCanvasSize(e),this}getCanvas(){return this.canvas}drawImage(e,t,i){this.getWidth()>0&&this.getHeight()>0&&this.context.drawImage(e,t,i)}}}),define("classes/highlight_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NONE="NONE",e.CLUSTER="CLUSTER",e.VERTEX="VERTEX"}(t.HighlightStateSelectionType||(t.HighlightStateSelectionType={}))}),define("classes/document_cluster_object",["require","exports","classes/highlight_state","cluster_constants"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterObject=class{getLayerId(){return this.layerId}setLayerId(e){return this.layerId=e,this}handleHighlightAlpha(e,t){t.isSelected!==i.HighlightStateSelectionType.NONE&&this.getClusterId()!==t.highlightClusterId||t.isSelected===i.HighlightStateSelectionType.VERTEX&&void 0!==t.highlightDotId?e.globalAlpha=s.RENDER_SETTINGS.nonSelectedClusterHoverOpacity:(t.isSelected===i.HighlightStateSelectionType.CLUSTER&&void 0!==t.highlightDotId||t.isSelected===i.HighlightStateSelectionType.VERTEX)&&(e.globalAlpha=s.RENDER_SETTINGS.selectedClusterHoverOpacity)}}}),define("classes/document_cluster_link",["require","exports","graphics_utilities","classes/document_cluster_object","classes/highlight_state","cluster_constants"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=new Map,a=new Map;class l extends s.DocumentClusterObject{constructor(e){super(),this.model=e,this.calculateColors()}static calculateHighlightColors(e){const t=e.stroke;let s=o.get(t);if(!s){s={stroke:i.Color.fromARGBString(e.stroke).setOpacity(1).toRGBA()},o.set(t,s)}return s}calculateColors(){this.baseColors={stroke:this.getColor().toRGBA()},this.highlightColors=l.calculateHighlightColors(this.baseColors)}static calculatePoints(e,t,i,s,n){n!==this.prevScale&&(this.prevScale=n,a.clear());const r=""+e+t+i+s;let o=a.get(r);if(!o){const l=.15;o=[e*=n,t*=n,(e+(i*=n))/2- -((s*=n)-t)*(2*l),(t+s)/2-(i-e)*(2*l),i,s],a.set(r,o)}return o}getClusterId(){return this.model.clusterId}handleHighlightAlpha(e,t){super.handleHighlightAlpha(e,t),t.isSelected!==n.HighlightStateSelectionType.NONE&&this.model.isClusterEdgeLink&&(e.globalAlpha=r.RENDER_SETTINGS.nonSelectedClusterHoverOpacity)}draw(e,t,i){const s=e.getContext();this.handleHighlightAlpha(s,i),this.model.clusterId!==i.highlightClusterId||this.model.isClusterEdgeLink?(s.strokeStyle=this.baseColors.stroke,s.lineWidth=r.RENDER_SETTINGS.lineThickness):(s.lineWidth=r.RENDER_SETTINGS.highlightLineThickness,s.strokeStyle=this.highlightColors.stroke),s.beginPath();const[n,o,a,c,d,h]=l.calculatePoints(this.model.line.position.x,this.model.line.position.y,this.model.line.targetPosition.x,this.model.line.targetPosition.y,t);return s.moveTo(n,o),s.quadraticCurveTo(a,c,d,h),s.stroke(),s.globalAlpha=1,this}dispose(){}getColor(){return this.model.color}}l.prevScale=-1,t.DocumentClusterLink=l}),define("classes/document_cluster_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOCUMENT_CLUSTER_ENABLE_UNSELECT="DOCUMENT_CLUSTER_ENABLE_UNSELECT",t.DOCUMENT_CLUSTER_DISABLE_UNSELECT="DOCUMENT_CLUSTER_DISABLE_UNSELECT",t.DOCUMENT_CLUSTER_DISABLE_UNSELECT_ONCE="DOCUMENT_CLUSTER_DISABLE_UNSELECT_ONCE",t.SET_DOCUMENT_CLUSTER_RECURSIVE_SELECTION="SET_DOCUMENT_CLUSTER_RECURSIVE_SELECTION",t.DOCUMENT_CLUSTER_UPDATED="DOCUMENT_CLUSTER_UPDATED",t.UPDATE_SELECTED_INFLUENCERS="UPDATE_SELECTED_INFLUENCERS",t.CLEAR_NODE_SELECTION="CLEAR_NODE_SELECTION",t.CUSTOMIZATION_UPDATING="CUSTOMIZATION_UPDATING",t.UPDATE_CLUSTER_SELECTION="UPDATE_CLUSTER_SELECTION",t.UPDATE_VERTEX_SELECTION="UPDATE_VERTEX_SELECTION",t.UPDATE_SOURCE_PANEL_COUNTS="UPDATE_SOURCE_PANEL_COUNTS",t.UPDATE_TOPICS_AND_CHANNELS="UPDATE_TOPICS_AND_CHANNELS",t.RESPOND_HASHTAGS="RESPOND_HASHTAGS",t.SET_HIGHLIGHTED_HASHTAGS="SET_HIGHLIGHTED_HASHTAGS",t.SET_DOCUMENT_CLUSTER_FILTER_VIEW_TYPE="SET_DOCUMENT_CLUSTER_FILTER_VIEW_TYPE",t.SET_LINKED_OBJECT_SELECTION="SET_LINKED_OBJECT_SELECTION",t.UPDATE_CUSTOMIZATION="UPDATE_CUSTOMIZATION",t.UPDATED_CUSTOMIZATION="UPDATED_CUSTOMIZATION"}),define("classes/document_cluster_node",["require","exports","models/document_cluster_node_model","math_utils","graphics_utilities","map","classes/document_cluster_object","reusable_utilities","cluster_constants","classes/highlight_state"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HASHTAG_SELECTION_COLOR="#333333";const d=new r.Map,h=50;class u extends o.DocumentClusterObject{constructor(e){super(),this.model=e,this.currentHighlightLevel=0,this.maximumLevel=0,this.canHighlightAdjacent=!1,this.calculateColors(),this.hitCheckShape=e.shape.clone()}get shape(){return this.model.shape}getData(){return this.model.data}getId(){return this.model.id}getRadius(){return this.shape.radius}getHexColor(){return this.getColor().toRGBA()}isInRectangle(e){return s.collisionCalculator.isOverlapping(this.shape,e)}hitCheck(e,t,i){const n=this.hitCheckShape.radius;this.hitCheckShape.radius=u.scaleRadius(n,a.MathUtils.linearScale({min:l.MIN_SCALE,max:5*l.MAX_SCALE},{min:n,max:4*n},l.MAX_SCALE-t),this.isNodeHighlightNode(i));const r=s.collisionCalculator.isOverlapping(this.hitCheckShape,new s.Point(e));return this.hitCheckShape.radius=n,r}static calculateHighlightColors(e){const t=e.fill+e.stroke;let i=d.get(t);if(!i){let s=n.Color.fromARGBString(e.fill);s=s.setSaturation(1.2*s.getSaturation());const r=n.Color.fromARGBString(e.stroke);i={fill:s.toRGBA(),stroke:r.toRGBA()},d.set(t,i)}return i}calculateColors(){this.baseColors={fill:this.getColor().toRGBA(),stroke:this.getColor().clone().darken(1).toRGBA()},this.highlightColors=u.calculateHighlightColors(this.baseColors)}getClusterId(){return this.model.clusterId}static scaleRadius(e,t,s=!1){t!==this.currentScale&&(this.currentScale=t,this.scaleCache.clear());const n=""+e+t+s;let r=this.scaleCache.get(n);if(r)return r;{const o=e/i.DocumentClusterNodeModel.maxRadius,c=h*o;return r=a.MathUtils.linearScale({min:l.MIN_SCALE,max:6*l.MAX_SCALE},{min:e,max:e*l.MAX_SCALE},t),r=Math.min(r,c),s&&(r+=Math.max(10,e*(1-l.RENDER_SETTINGS.highlightDotRadiusMultiplier))),this.scaleCache.set(n,r),r}}handleHighlightAlpha(e,t){super.handleHighlightAlpha(e,t),t.isSelected===c.HighlightStateSelectionType.NONE||(!t.selectedDotId&&t.highlightDotId)!==this.model.id&&t.selectedDotId!==this.model.id||(e.globalAlpha=1),t.isSelected===c.HighlightStateSelectionType.VERTEX&&t.highlightDotId===this.model.id&&t.selectedDotId!==this.model.id&&(e.globalAlpha=.75)}isNodeHighlightNode(e){return e.isSelected!==c.HighlightStateSelectionType.NONE&&void 0!==e.highlightDotId&&this.model.id===e.highlightDotId||e.selectedDotId===this.model.id}draw(e,t,i){const s=this.shape.position.x*t,n=this.shape.position.y*t,r=this.getRadius(),o=u.scaleRadius(r,t,this.isNodeHighlightNode(i)),a=e.getContext();return this.handleHighlightAlpha(a,i),a.fillStyle=this.baseColors.fill,a.strokeStyle=this.baseColors.stroke,a.beginPath(),a.lineWidth=1,this.model.clusterId===i.highlightClusterId?(a.fillStyle=this.highlightColors.fill,a.strokeStyle=this.highlightColors.stroke,a.lineWidth=.7):a.lineWidth=.3,a.arc(s,n,o,0,2*Math.PI,!0),a.fill(),a.stroke(),a.closePath(),a.globalAlpha=1,this}dispose(){}getColor(){return this.model.color}}u.currentScale=-1,u.scaleCache=new r.Map,t.DocumentClusterNode=u}),define("classes/document_cluster_renderer",["require","exports","math_utils","graphics_utilities","reusable_utilities","map","classes/highlight_state","event"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.HIGHLIGHT_HASHTAGS="HIGHLIGHT_HASHTAGS",e.HIGHLIGHT_SOURCE_PANELS="HIGHLIGHT_SOURCE_PANELS",e.HIGHLIGHT_SELECTION="HIGHLIGH_SELECTION",e.HIGHLIGHT_FILTER_VIEW="HIGHLIGHT_FILTER_VIEW"}(t.DrawEnhancers||(t.DrawEnhancers={}));t.DocumentClusterRenderer=class{constructor(){this.drawLayers=[],this.hasChanged=!0,this.scale=1,this.highlightState={isSelected:o.HighlightStateSelectionType.NONE,selectedDotId:void 0,highlightClusterId:void 0,highlightDotId:void 0},this.canvases=[],this.transformX=0,this.transformY=0,this.onDrawDone=new a.Event,this.resolutionScale=1,this.drawEnhancers=new r.Map,this.oldOffset=i.Vector2D.zero(),this.offset=i.Vector2D.zero(),this.drawOffset=i.Vector2D.zero()}setHighlightState(e){this.highlightState=e,e.isSelected===o.HighlightStateSelectionType.NONE&&void 0!==e.highlightClusterId||e.isSelected===o.HighlightStateSelectionType.CLUSTER&&void 0!==e.highlightDotId||e.isSelected===o.HighlightStateSelectionType.VERTEX&&void 0!==e.highlightDotId?this.setCursor("pointer"):this.setCursor("auto")}getHighlightState(){return this.highlightState}setLayerTransition(e,t=0,i=0){return setTimeout(()=>{e.classList.add("animate"),e.style.animation=`circle ${i-t}ms`},t),this}playInitialAnimation(e){const t=2.2*e.animationDuration,i=Math.round(t/7);this.setLayerTransition(this.drawLayers[0].getCanvas(),i,t).setLayerTransition(this.drawLayers[1].getCanvas(),2*i,t),this.drawLayers[2].getCanvas().style.transition="none",this.drawLayers[2].getCanvas().style.opacity="0",this.drawLayers[2].getCanvas().style.clipPath="initial",setTimeout(()=>{this.drawLayers[2].getCanvas().style.transition=`opacity ${Math.round(t-3*i)}ms`,this.drawLayers[2].getCanvas().style.opacity="1"},3*i)}get size(){return new i.Vector2D(this.width,this.height)}get width(){return this.drawLayers[0].getCanvas().width}get height(){return this.drawLayers[0].getCanvas().height}getViewport(){const e=this.projectPoint(i.Vector2D.zero());return new i.Rectangle(e,this.width/this.scale,this.height/this.scale)}resetDragOffsets(){return 0===this.offset.x&&0===this.offset.y||(this.drawOffset.add(this.offset),this.offset.zero(),this.refresh()),this}setObjects(e){this.objects=e}setHighlightNode(e){this.highlightNode=e}setSelectedNode(e){this.selectedNode=e}getScale(){return this.scale}setScale(e,t){return this.scale=e,this.hasChanged=!0,this}getCanvases(){return this.canvases}setDrawLayers(e,t){return this.drawLayers=e,this.camera=new s.Camera({layers:[]}),this.canvases=e.map(e=>e.getCanvas()),this}setLayerTransformOffset(e,t){return this.transformX+=e,this.transformY+=t,this.getCanvases().forEach(e=>{e.style.transform=`translate(${this.transformX}px,${this.transformY}px) scale(${1/this.resolutionScale})`}),[this.transformX,this.transformY]}drawObject(e){const t=this.drawLayers[e.layerId];this.drawEnhancers.size>0&&this.drawEnhancers.forEach(i=>i(e,t.getContext())),e.draw(t,this.scale,this.highlightState)}drawObjects(){return console.log(this),this.drawLayers.forEach(e=>{e.clear();const t=e.getContext();t.save(),t.translate(this.offset.x+this.drawOffset.x*this.resolutionScale+e.getWidth()/2,this.offset.y+this.drawOffset.y*this.resolutionScale+e.getHeight()/2),t.scale(this.resolutionScale,this.resolutionScale)}),this.objects.forEach(e=>this.drawObject(e)),this.selectedNode&&this.drawObject(this.selectedNode),this.highlightNode&&this.drawObject(this.highlightNode),this.transformX=0,this.transformY=0,this.drawLayers.forEach(e=>{e.getContext().restore(),e.getCanvas().style.transform=`translate(${this.transformX}px,${this.transformY}px) scale(${1/this.resolutionScale})`}),this.onDrawDone.fire(),this}updateDrawLayers(e){return this.drawLayers.forEach(t=>t.update(e)),this}refresh(){if(this.highlightState.highlightClusterId){const e=this.objects.find(e=>2===e.layerId&&e.model&&e.model.id===this.highlightState.highlightClusterId);this.objects.splice(this.objects.indexOf(e),1),this.objects.push(e)}this.hasChanged=!0}removeHighlight(){this.setHighlightState({highlightClusterId:void 0,isSelected:o.HighlightStateSelectionType.NONE,highlightDotId:void 0,selectedDotId:this.highlightState.selectedDotId})}isClusterSelected(){return this.highlightState.isSelected===o.HighlightStateSelectionType.CLUSTER}isVertexSelected(){return this.highlightState.isSelected===o.HighlightStateSelectionType.VERTEX}render(){if(this.hasChanged){const e=Date.now();this.drawObjects(),this.camera.draw(),this.hasChanged=!1;const t=Date.now()-e;this.avgRenderTime=Math.ceil(this.avgRenderTime?(this.avgRenderTime+t)/2:t)}return this.oldOffset.isEqual(this.offset)||this.oldOffset.merge(this.offset),this}start(){this.drawLayers.forEach(e=>e.alpha=0),n.AnimationLoop.registerCallback(()=>{this.render()},!0,60)}projectPoint(e){return e.sub(new i.Vector2D(this.width/2,this.height/2)).sub(this.drawOffset).div(this.scale)}setCursor(e){this.drawLayers[this.drawLayers.length-1].getCanvas().style.cursor!==e&&(this.drawLayers[this.drawLayers.length-1].getCanvas().style.cursor=e)}}}),define("classes/document_cluster_label",["require","exports","math_utils","graphics_utilities","classes/document_cluster_object","cluster_constants"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterLabel=class extends n.DocumentClusterObject{constructor(e){super(),this.model=e,this.currentHighlightLevel=0,this.maximumLevel=0,this.canHighlightAdjacent=!1,this.darkMode=!1,this.paddingX=10,this.paddingY=6,this.fontSize=12,this.color=s.Color.fromHex(e.color)}get shape(){return this.model.shape}getData(){return this.model.data}getId(){return this.model.id}getHexColor(){return this.model.color}getClusterId(){return this.model.id}hitCheck(e,t){const s=e.clone();s.x*=t,s.y*=t;const[n,r]=this.getFinalCoordinates(t);return this.hitCheckShape.x=n,this.hitCheckShape.y=r,i.collisionCalculator.isOverlapping(this.hitCheckShape,new i.Point(s))}getModifiedCoordinates(){const e=[this.shape.x,this.shape.y];switch(this.model.data.non_overlapping_label_position.horizontal_alignment){case r.HorizontalClusterLabelAlignment.HORIZONTAL_CENTER:e[0]-=this.shape.width/2;break;case r.HorizontalClusterLabelAlignment.HORIZONTAL_RIGHT:e[0]-=this.shape.width}switch(this.model.data.non_overlapping_label_position.vertical_alignment){case r.VerticalClusterLabelAlignment.VERTICAL_CENTER:e[1]-=this.shape.height/2;break;case r.VerticalClusterLabelAlignment.VERTICAL_BOTTOM:e[1]-=this.shape.height}return e}computeLabelDimensionsAndPosition(e){if(0===this.shape.width){this.shape.width=e.measureText(this.model.text).width+this.paddingX,this.shape.height=this.fontSize+this.paddingY,this.hitCheckShape=this.shape.clone();const[t,i]=this.getModifiedCoordinates();this.xModifier=t-this.model.data.non_overlapping_label_position.absolute_anchor_position_x,this.yModifier=i-this.model.data.non_overlapping_label_position.absolute_anchor_position_y}}setFont(e){e.font=this.fontSize+'px "RobotoB"'}getFinalCoordinates(e){return[this.model.data.non_overlapping_label_position.absolute_anchor_position_x*e+this.xModifier,this.model.data.non_overlapping_label_position.absolute_anchor_position_y*e+this.yModifier]}draw(e,t,i){const s=e.getContext();this.handleHighlightAlpha(s,i),this.setFont(s),this.computeLabelDimensionsAndPosition(s);const[n,o]=this.getFinalCoordinates(t);return s.beginPath(),s.rect(n,o,this.shape.width,this.shape.height),s.fillStyle=this.darkMode?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",s.strokeStyle=this.model.color,s.lineWidth=2,i.highlightClusterId===this.model.id&&(s.lineWidth=r.RENDER_SETTINGS.labelHighlightLineThickness),s.stroke(),s.fill(),s.closePath(),s.textBaseline="top",s.textAlign="left",s.fillStyle=this.darkMode?"white":"black",s.fillText(this.model.text,n+this.paddingX/2,o+this.paddingY/2),s.globalAlpha=1,r.RENDER_SETTINGS.showLabelPositionDots&&(s.lineWidth=2,s.beginPath(),s.fillStyle="aqua",s.strokeStyle="black",s.arc(this.model.data.non_overlapping_label_position.absolute_anchor_position_x*t,this.model.data.non_overlapping_label_position.absolute_anchor_position_y*t,5,0,2*Math.PI,!0),s.fill(),s.stroke(),s.closePath(),s.beginPath(),s.fillStyle="deeppink",s.strokeStyle="black",s.arc(this.model.data.non_overlapping_label_position.initial_label_x*t,this.model.data.non_overlapping_label_position.initial_label_y*t,5,0,2*Math.PI,!0),s.fill(),s.stroke(),s.closePath()),this}dispose(){}getColor(){return this.color}}}),define("classes/document_cluster",["require","exports","math_utils","reusable_utilities","classes/document_cluster_layer","classes/document_cluster_link","classes/document_cluster_messages","classes/document_cluster_node","classes/document_cluster_renderer","cluster_constants","classes/document_cluster_label","articles","classes/highlight_state","react-dom","react","map"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m){"use strict";var f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK"}(f=t.DocumentClusterColorThemeId||(t.DocumentClusterColorThemeId={}));const y=document.createElement("style");y.type="text/css";t.DocumentCluster=class{constructor(e,t,i,n){this.settings=t,this.model=i,this.numLayers=3,this.scaleStepMultiplier=1.5,this.initialized=!1,this.updated=!1,this.dragging=!1,this.mousePositionX=0,this.mousePositionY=0,this.blockUnselection=!1,this.renderer=new l.DocumentClusterRenderer,this.nodesMap=new m.Map,this.resolutionMultiplier=1,this.blockUnselectionOnce=!1,this.sizeMultiplier=1.5,this.eventsSetup=!1,this.movementX=0,this.movementY=0,this.minScale=c.MIN_SCALE,this.maxScale=c.MAX_SCALE,this.mediator=n,this.cancellationToken=new s.CancellationToken;const r=this.modifySettings(t).dimensions.size;this.parent=document.createElement("div"),e.appendChild(this.parent),this.parent.className="document-cluster-container",this.processModel(i).setParentDimensions().buildLayers(this.parent,t).setInitialZoom(i,r.clone().mul(this.resolutionMultiplier)).setInitialPosition(i).initializeMediator().setOverviewMode().handleBackground().handleLabels().renderUi(this.parent),-1===window.location.href.indexOf("app.talkwalker.com")&&(window.__documentCluster={getRenderSettings:()=>console.log(c.RENDER_SETTINGS),setRenderSettings:e=>{Object.assign(c.RENDER_SETTINGS,e),this.renderer.refresh()}})}renderUi(e){const t=document.createElement("div");t.className="document-cluster-ui-wrapper",e.appendChild(t);const{isInteractive:i}=this.model.buildConfiguration;return i&&p.render(g.createElement(g.Fragment,null,g.createElement("div",{className:"plus",onClick:()=>{this.zoom(this.scaleStepMultiplier,this.renderer.size.div(2))}}),g.createElement("div",{className:"minus",onClick:()=>{this.zoom(1/this.scaleStepMultiplier,this.renderer.size.div(2))}})),t),this}handleBackground(){return this.model.widget.getExtendedConfiguration().hasColorScheme()||this.model.widget.getExtendedConfiguration().setColorScheme(f.WHITE),this.model.widget.getExtendedConfiguration().getColorScheme()===f.BLACK?(this.parent.classList.add("document-cluster-dark-mode"),this.labels.forEach(e=>{e.darkMode=!0})):(this.parent.classList.remove("document-cluster-dark-mode"),this.labels.forEach(e=>{e.darkMode=!1})),this.renderer.refresh(),this}handleLabels(){return void 0===this.model.widget.getExtendedConfiguration().getClusterLabelsShown()&&this.model.widget.hasMenu()&&this.model.widget.getMenu().hasClusterLabelsMenu()&&this.model.widget.getExtendedConfiguration().setClusterLabelsShown("1"===this.model.widget.getMenu().getClusterLabelsMenu().getSelectedEntriesLeavesRecursively()[0].getMappedId()),!1===this.model.widget.getExtendedConfiguration().getClusterLabelsShown()?this.parent.classList.add("document-cluster-hide-labels"):this.parent.classList.remove("document-cluster-hide-labels"),this}setParentDimensions(){return this.parent.style.width=this.settings.dimensions.width+"px",this.parent.style.height=this.settings.dimensions.height+"px",this}setOverviewMode(){return this.overviewModeAllowed=!0,this.renderer.getScale()===this.minScale&&(this.overviewMode=!0),this}initializeMediator(){return this.mediator.listen(o.CUSTOMIZATION_UPDATING,e=>{this.parent.style.opacity=e?"0.5":"1"},{token:this.cancellationToken}),this.mediator.listen(h.InteractionLayoutMediatorEvents.ARTICLE_CLICK,e=>{this.renderer.getHighlightState().isSelected===u.HighlightStateSelectionType.CLUSTER&&this.mediator.dispatch(o.UPDATE_VERTEX_SELECTION,e)},{token:this.cancellationToken}),this.mediator.listen(h.InteractionLayoutMediatorEvents.ARTICLE_MOUSE_ENTER,e=>{if(this.renderer.getHighlightState().isSelected===u.HighlightStateSelectionType.CLUSTER){const t=this.nodes.find(t=>t.getId()===e);t&&this.setHover(t.getData())}},{token:this.cancellationToken}),this.mediator.listen(h.InteractionLayoutMediatorEvents.ARTICLE_MOUSE_LEAVE,()=>{this.renderer.getHighlightState().isSelected===u.HighlightStateSelectionType.CLUSTER&&this.setHover(void 0)},{token:this.cancellationToken}),this.mediator.listen("INFLUENCER_NETWORK_SWITCH_THEME",e=>{this.handleBackground()}),this.mediator.listen("DOCUMENT_CLUSTER_HIDE_LABEL_CHANGE",e=>{this.handleLabels()}),this.mediator.listen(o.CLEAR_NODE_SELECTION,()=>{this.removeSelection()}),this.mediator.listen(o.UPDATE_CLUSTER_SELECTION,e=>{void 0!==e&&this.setClusterSelection(e)}),this.mediator.listen(o.UPDATE_VERTEX_SELECTION,e=>{this.setVertexSelection(e)}),this.mediator.listen("DOCUMENT_CLUSTER_HOVER",e=>{const t=this.model.visibleNodes.find(t=>t.clusterId===e);t?this.setHover(t.data):this.setHover()},{token:this.cancellationToken}),this}setVertexSelection(e){const t=this.nodes.find(t=>t.model.id===e);this.renderer.setHighlightState(Object.assign({},this.renderer.getHighlightState(),{highlightClusterId:t?t.getClusterId():this.renderer.getHighlightState().highlightClusterId,highlightDotId:void 0,selectedDotId:e,isSelected:e?u.HighlightStateSelectionType.VERTEX:u.HighlightStateSelectionType.CLUSTER})),this.updateClusterSelectStyle(void 0),this.renderer.refresh()}setClusterSelection(e){this.renderer.setHighlightState({highlightClusterId:e,isSelected:u.HighlightStateSelectionType.CLUSTER,highlightDotId:this.renderer.getHighlightState().highlightDotId,selectedDotId:void 0}),this.renderer.refresh()}setInitialZoom(e,t){return e.widget.getExtendedConfiguration().hasWidgetCameraState()?this.renderer.setScale(e.widget.getExtendedConfiguration().getWidgetCameraState().zoom,i.Vector2D.zero()):this.renderer.setScale(1,i.Vector2D.zero()),this}setInitialPosition(e){let t;return t=e.widget.getExtendedConfiguration().hasWidgetCameraState()?e.widget.getExtendedConfiguration().getWidgetCameraState().panningOffset:new i.Vector2D(0,0),this.renderer.drawOffset.set(this.settings.dimensions.width*t.x*this.resolutionMultiplier,this.settings.dimensions.height*t.y*this.resolutionMultiplier),this}setUpMouseEvents(e){return this.eventsSetup||($(e).on("wheel",e=>{e.preventDefault(),this.mouseZoom(e)}).on("mousedown",e=>{e.preventDefault(),0===e.button&&(this.movementX=0,this.movementY=0,this.dragging=!0)}).on("mousemove",e=>{this.mouseMove(e)}),this.cancellationToken.addDomEvent($("body"),"mouseup",e=>{this.mouseDragEnd(e)}),this.cancellationToken.addDomEvent($("body"),"keydown",e=>{e.keyCode===s.Keys.ESCAPE&&this.onEscape()}),this.eventsSetup=!0),this}onEscape(){this.removeSelection()}removeSelection(){this.renderer.getHighlightState()&&this.renderer.getHighlightState().isSelected!==u.HighlightStateSelectionType.NONE&&(this.renderer.removeHighlight(),this.renderer.refresh(),this.mediator.dispatch(o.UPDATE_CLUSTER_SELECTION,void 0))}click(e){if(0!==e.button)return;if(this.blockUnselectionOnce)return void(this.blockUnselectionOnce=!1);if(this.blockUnselection)return;const{highlightClusterId:t,highlightDotId:i,isSelected:s}=this.renderer.getHighlightState();s===u.HighlightStateSelectionType.CLUSTER?void 0!==i?this.mediator.dispatch(o.UPDATE_VERTEX_SELECTION,i):this.mediator.dispatch(o.CLEAR_NODE_SELECTION,void 0):s===u.HighlightStateSelectionType.VERTEX?this.mediator.dispatch(o.UPDATE_VERTEX_SELECTION,i):void 0!==t&&this.mediator.dispatch(o.UPDATE_CLUSTER_SELECTION,t),this.renderer.setCursor("auto"),this.mouseMove(e)}mouseDragEnd(e){if(this.dragging){this.dragging=!1;const t=this.renderer.offset.getLength();this.renderer.resetDragOffsets(),t<8?this.click(e):this.persistWidgetCamera()}}mouseMove(e){this.mousePositionX=e.offsetX,this.mousePositionY=e.offsetY,this.dragging&&(this.movementX+=e.originalEvent.movementX,this.movementY+=e.originalEvent.movementY),this.performMouseMoveId||(this.performMouseMoveId=s.AnimationLoop.requestDelay(()=>{if(this.performMouseMoveId=void 0,this.dragging||this.checkHover(new i.Vector2D(e.offsetX,e.offsetY)),this.dragging){const e=new i.Vector2D(this.renderer.offset.x+this.movementX,this.renderer.offset.y+this.movementY);if(this.leftNode.data.x*this.renderer.getScale()+(e.x+this.renderer.drawOffset.x)<.45*this.settings.dimensions.width&&this.rightNode.data.x*this.renderer.getScale()+(e.x+this.renderer.drawOffset.x)>.45*-this.settings.dimensions.width&&this.topNode.data.y*this.renderer.getScale()+(e.y+this.renderer.drawOffset.y)<.45*this.settings.dimensions.height&&this.bottomNode.data.y*this.renderer.getScale()+(e.y+this.renderer.drawOffset.y)>.45*-this.settings.dimensions.height){const[t,i]=this.renderer.setLayerTransformOffset(this.movementX,this.movementY);this.renderer.offset.set(e.x,e.y),(Math.abs(t)>this.settings.dimensions.width*(this.sizeMultiplier-1)/2||Math.abs(i)>this.settings.dimensions.height*(this.sizeMultiplier-1)/2)&&this.renderer.refresh()}this.movementX=0,this.movementY=0}},15))}get zoomTimout(){return 1.5*(this.renderer.avgRenderTime||50)}mouseZoom(e){this.performZoom(e.originalEvent.deltaY)}performZoom(e){if(this.zoomTimeoutId)this.queuedZoomDeltaY=e;else{let t;if(e>0){if(this.overviewModeAllowed&&!this.overviewMode&&this.renderer.getScale()===this.minScale)return this.overviewMode=!0,void this.renderer.refresh();t=1/this.scaleStepMultiplier}else{if(this.overviewModeAllowed&&this.overviewMode&&this.renderer.getScale()===this.minScale)return this.overviewMode=!1,void this.renderer.refresh();t=this.scaleStepMultiplier}this.zoom(t,new i.Vector2D(this.mousePositionX,this.mousePositionY)),this.zoomTimeoutId=setTimeout(()=>{this.zoomTimeoutId=void 0,this.queuedZoomDeltaY&&(this.performZoom(this.queuedZoomDeltaY),this.queuedZoomDeltaY=void 0)},this.zoomTimout)}}zoom(e,t){const s=this.renderer.getScale(),n=Math.max(this.minScale,Math.min(this.maxScale,s*e)),r=this.renderer.projectPoint(t);this.renderer.setScale(n,i.Vector2D.zero());const o=n-s,a=r.clone().mul(-o);let l=this.model.allNodes[0];this.model.visibleNodes.filter(e=>(Math.abs(e.data.x-r.x)+Math.abs(e.data.y-r.y)<Math.abs(l.data.x-r.x)+Math.abs(l.data.y-r.y)&&(l=e),e.data.x*this.renderer.getScale()+a.x+this.renderer.drawOffset.x<=.45*this.settings.dimensions.width&&e.data.x*this.renderer.getScale()+a.x+this.renderer.drawOffset.x>=.45*-this.settings.dimensions.width&&e.data.y*this.renderer.getScale()+a.y+this.renderer.drawOffset.y<=.45*this.settings.dimensions.height&&e.data.y*this.renderer.getScale()+a.y+this.renderer.drawOffset.y>=.45*-this.settings.dimensions.height)).length>0?this.renderer.drawOffset.add(a):this.renderer.drawOffset.add(new i.Vector2D(l.data.x,l.data.y).mul(-o)),this.persistWidgetCamera()}scrollIntoView(e,t){const i=e.getBoundingClientRect(),s=t.getBoundingClientRect();s.top>=i.top&&s.top<=i.top+e.clientHeight||s.top+t.clientHeight>=i.top&&s.top+t.clientHeight<=i.top+e.clientHeight||(e.scrollTop=s.top+e.scrollTop-i.top)}updateClusterSelectStyle(e){y.parentElement||document.head.appendChild(y);const t=e?e.id:"";if(e){const e=document.querySelector(`*[data-url="${t}"]`);if(e){let t=e.parentElement;for(;t&&!t.classList.contains("page-container");){if(t.classList.contains("stylized-scrollbar")){this.scrollIntoView(t,e);break}t=t.parentElement}}}y.innerHTML=`\n            .document-cluster-sidebar-box *[data-url="${t}"] {\n                background: #f1f1f1;\n                cursor:pointer;\n            }\n        `}setHover(e,t=!1){let i=this.renderer.getHighlightState();const s=e&&e.cluster_id;if(this.renderer.isClusterSelected()){const t=e&&e.id;this.updateClusterSelectStyle(e),e&&e.cluster_id!==i.highlightClusterId||(void 0!==t&&i.highlightDotId!==t?(this.renderer.setHighlightState(Object.assign({},i,{highlightDotId:t})),this.renderer.refresh()):void 0===t&&(this.renderer.setHighlightState(Object.assign({},i,{highlightDotId:void 0})),this.renderer.refresh()))}else this.renderer.isVertexSelected()?e&&s===i.highlightClusterId?(this.renderer.setHighlightState({highlightClusterId:s,isSelected:i.isSelected,highlightDotId:e.id,selectedDotId:i.selectedDotId}),this.renderer.refresh()):(this.renderer.setHighlightState({highlightClusterId:i.highlightClusterId,isSelected:i.isSelected,highlightDotId:void 0,selectedDotId:i.selectedDotId}),this.renderer.refresh()):(this.updateClusterSelectStyle(void 0),void 0!==s&&s!==i.highlightClusterId?(this.renderer.setHighlightState({highlightClusterId:s,isSelected:u.HighlightStateSelectionType.NONE,highlightDotId:e.id,selectedDotId:void 0}),this.renderer.refresh(),t&&this.mediator.dispatch("DOCUMENT_CLUSTER_HOVER",s)):void 0===s&&void 0!==i.highlightClusterId&&(this.renderer.removeHighlight(),this.renderer.refresh(),t&&this.mediator.dispatch("DOCUMENT_CLUSTER_HOVER",void 0)));(i=this.renderer.getHighlightState()).highlightDotId?this.highlightNode&&this.highlightNode.getId()===i.highlightDotId||!i.highlightDotId||(this.highlightNode=this.nodesMap.get(i.highlightDotId),this.renderer.setHighlightNode(this.highlightNode)):(this.highlightNode&&this.renderer.setHighlightNode(),this.highlightNode=void 0),i.selectedDotId?this.selectedNode&&this.selectedNode.getId()===i.selectedDotId||!i.selectedDotId||(this.selectedNode=this.nodesMap.get(i.selectedDotId),this.renderer.setSelectedNode(this.selectedNode)):(this.selectedNode&&this.renderer.setSelectedNode(),this.selectedNode=void 0)}checkHover(e){const t=this.renderer.projectPoint(e),i=this.renderer.getHighlightState(),s=this.renderer.isClusterSelected();let n,r=!1;i.isSelected===u.HighlightStateSelectionType.NONE&&this.model.widget.getExtendedConfiguration().getClusterLabelsShown()&&(n=this.labels.find(e=>s&&i.highlightClusterId!==e.getClusterId()?void 0:(r=!0,e.hitCheck(t,this.renderer.getScale()))));const o=this.nodes.find(e=>n&&e.getClusterId()===n.getClusterId()?(r=!0,!0):s&&i.highlightClusterId!==e.getClusterId()?void 0:(r=!0,e.hitCheck(t,this.renderer.getScale(),i)));o?this.setHover(o.getData(),!0):!o&&void 0!==this.renderer.getHighlightState().highlightClusterId&&r&&this.setHover(void 0,!0)}processModel(e){return this.highlightNode=void 0,this.selectedNode=void 0,this.nodesMap.clear(),this.nodes=this.buildNodes(e),this.labels=this.buildLabels(e),this.links=this.buildLinks(e,this.nodes),this.renderer.setObjects([...this.nodes,...this.links,...this.labels]),this}buildLinks(e,t){return e.links.map(e=>new r.DocumentClusterLink(e).setLayerId(0))}buildNodes(e){return this.rightNode=e.allNodes[0],this.bottomNode=e.allNodes[0],this.leftNode=e.allNodes[0],this.topNode=e.allNodes[0],e.allNodes.map(e=>{e.data.y<this.topNode.data.y&&(this.topNode=e),e.data.y>this.bottomNode.data.y&&(this.bottomNode=e),e.data.x<this.leftNode.data.x&&(this.leftNode=e),e.data.x>this.rightNode.data.x&&(this.rightNode=e);const t=new a.DocumentClusterNode(e).setLayerId(1);return this.nodesMap.set(t.getId(),t),t})}buildLabels(e){return e.labels.map(e=>new d.DocumentClusterLabel(e).setLayerId(2))}buildLayers(e,t){const i=_.times(this.numLayers,i=>new n.DocumentClusterLayer(i,this.modifySettings(t),e));return i.forEach(e=>{t.style.resolutionScale>1&&(e.getCanvas().style.transform=`scale(${1/t.style.resolutionScale})`),e.getCanvas().style.marginLeft=.5*-(t.style.resolutionScale*t.dimensions.width*this.sizeMultiplier-t.dimensions.width)+"px",e.getCanvas().style.marginTop=.5*-(t.style.resolutionScale*t.dimensions.height*this.sizeMultiplier-t.dimensions.height)+"px"}),this.renderer.setDrawLayers(i,e),this}modifySettings(e){const t={dimensions:e.dimensions.clone(),heightMode:e.heightMode};return t.dimensions.size.set(e.style.resolutionScale*t.dimensions.size.x*this.sizeMultiplier,e.style.resolutionScale*t.dimensions.size.y*this.sizeMultiplier),t}async update(e){return this.model.checkSum!==e.checkSum&&void 0!==e.checkSum&&(this.model=e,this.processModel(e),this.updated=!0),this}async draw(e){setTimeout(()=>{this.setUpMouseEvents(this.parent)},e.animationDuration),this.renderer.resolutionScale=e.style.resolutionScale;const t=this.updated||this.settings.dimensions.width!==e.dimensions.width||this.settings.dimensions.height!==e.dimensions.height,i=!this.settings||!this.settings.dimensions.isEquivalentTo(e.dimensions);this.settings=e;const s=this.modifySettings(e);if(t){this.setParentDimensions();const e=s.dimensions.size.clone();this.setInitialZoom(this.model,e.clone().mul(this.resolutionMultiplier)).setInitialPosition(this.model),this.updated=!1}(t||i)&&this.renderer.updateDrawLayers(s);const n=this.renderer.onDrawDone.subscribeOnceAsPromise();return this.initialized?(t||i)&&(this.renderer.getCanvases().forEach(e=>{e.classList.remove("animate"),e.style.animation=""}),this.renderer.refresh()):(this.initialized=!0,this.renderer.start()),this.renderer.playInitialAnimation(e),await n,this}dispose(){this.cancellationToken.cancel()}persistWidgetCamera(){const e=this.renderer.drawOffset.x/this.settings.dimensions.width,t=this.renderer.drawOffset.y/this.settings.dimensions.height;this.model.widget.getExtendedConfiguration().setWidgetCameraState(new i.Vector2D(e,t),this.renderer.getScale())}disableUnselect(){this.blockUnselection=!0}enableUnselect(){this.blockUnselection=!1}}}),define("classes/document_cluster_fragment",["require","exports","reusable_utilities","widget_base","models/document_cluster_model","classes/document_cluster","classes/document_cluster_messages","classes/document_cluster_layout"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterFragment=class{constructor(e){this.fragmentModel=e,this.subFragments=e.subFragments,document.body.style.minWidth="1280px",document.body.style.width="100%"}async initialize(e,t,i){return this.fragmentModel.widget.hasPayloadValue()&&(this.documentClusterModel=new n.DocumentClusterModel(this.fragmentModel.widget,this.fragmentModel.buildConfiguration.getLayout(this.fragmentModel.widget),this.fragmentModel.buildConfiguration,this.subFragments,i.style.formatting.numberFormatter)),this.chartContainer=e,this.settings=i,this.fragmentModel.widget.hasPayloadValue()?(this.mediator=t,i.style.placement.centeredVertically?e.classList.add("flex-center-vertically"):e.classList.remove("flex-center-vertically"),this.fragmentModel.widget.getExtendedConfiguration(),this.cluster=new r.DocumentCluster(e,i,this.documentClusterModel,this.mediator),this.mediator.listen(o.DOCUMENT_CLUSTER_ENABLE_UNSELECT,()=>{this.cluster.enableUnselect()}),this.mediator.listen(o.DOCUMENT_CLUSTER_DISABLE_UNSELECT_ONCE,()=>{this.cluster.blockUnselectionOnce=!0}),this.mediator.listen(o.DOCUMENT_CLUSTER_DISABLE_UNSELECT,()=>{this.cluster.disableUnselect()}),this):this}async update(e){return this.documentClusterModel=new n.DocumentClusterModel(e.widget,this.documentClusterModel.layout,this.fragmentModel.buildConfiguration,this.subFragments,this.settings.style.formatting.numberFormatter),this.fragmentModel=e,this.cluster||await this.initialize(this.chartContainer,this.mediator,this.settings),await this.cluster.update(this.documentClusterModel),this.mediator.isDisposed()||this.mediator.dispatch(o.DOCUMENT_CLUSTER_UPDATED,""),this}async draw(e){return this.settings=e,this.cluster&&(await this.cluster.draw(e),await i.waitFor(e.animationDuration)),this}dispose(){this.cluster.dispose(),document.body.style.minWidth="100%",document.body.style.width="1px"}getLayoutIterator(){return new s.LayoutIterator(a.DOCUMENT_CLUSTER_FRAGMENT_LAYOUTS,e=>({width:Math.min(e.dimensions.width||0,e.dimensions.height||0),height:Math.min(e.dimensions.width||0,e.dimensions.height||0)}))}}}),define("classes/sidebar/pages/document_cluster_sidebar_page",["require","exports","react","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterSidebarPage=class extends i.Component{constructor(e){super(e),this.cancellationToken=new s.CancellationToken,this.rootRef=i.createRef()}componentWillUnmount(){this.cancellationToken.cancel()}render(){return i.createElement("div",{className:"document-cluster-sidebar-page",ref:this.rootRef},this.renderPage())}}}),define("classes/sidebar/pages/document_cluster_virtual_list",["require","exports","react"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterSidebarVirtualList=class extends i.Component{constructor(e){super(e),this.listContainerRef=i.createRef()}render(){const{items:e}=this.props;return i.createElement("div",{className:"virtual-list-wrapper"},i.createElement("div",null,i.createElement("div",{className:"stylized-scrollbar",ref:this.listContainerRef},i.createElement("div",null,e.map((e,t)=>this.renderListItem(t,e))))))}checkHeight(){if(!this.props.disableHeightCheck&&this.listContainerRef.current.firstElementChild.clientHeight<this.listContainerRef.current.scrollHeight){this.forceHeight=this.listContainerRef.current.firstElementChild.clientHeight;let e=this.listContainerRef.current.parentElement;for(;e&&!e.classList.contains("widget-column");){if(e.classList.contains("document-cluster-sidebar-box")){e.parentElement.childElementCount>1&&(e.style.maxHeight=this.forceHeight+60+"px");break}e=e.parentElement}}}componentDidUpdate(e){this.checkHeight()}componentDidMount(){this.checkHeight()}renderListItem(e,t){return i.createElement("div",{key:e,className:"sidebar-influencer-row"},t)}}}),define("classes/sidebar/pages/document_cluster_sidebar_box",["require","exports","react"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterSidebarBox=class extends i.Component{constructor(e){super(e),this.state={open:e.initiallyOpen,hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}static componentDidCatch(e,t){console.trace(e,t)}render(){const{title:e,children:t,showToggle:s}=this.props,{open:n}=this.state;return i.createElement("div",{className:"document-cluster-sidebar-box list-container-wrapper"+(n?" open":"")},i.createElement("div",{className:"list-container"},i.createElement(i.Fragment,null,i.createElement("div",{className:"virtual-list-title"+(s?" toggleable":""),key:e,onClick:e=>{s&&(e.preventDefault(),this.setState({open:!this.state.open}))}},i.createElement("span",null,e),s&&this.renderToggle(n)),i.createElement("div",{className:"virtual-list-children"+(this.state.open?" virtual-list-children-open":"")},!this.state.hasError&&t))))}renderToggle(e){return e?i.createElement("i",{className:"icon2-tw-collapse-head"}):i.createElement("i",{className:"icon2-tw-expand-head"})}}}),define("classes/sidebar/pages/document_cluster_sidebar_clusters_page",["require","exports","react","classes/sidebar/pages/document_cluster_sidebar_page","classes/sidebar/pages/document_cluster_virtual_list","classes/document_cluster_messages","classes/sidebar/pages/document_cluster_sidebar_box","reusable_utilities","reusable_services"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class c extends i.Component{constructor(e){super(e),this.cancellationToken=new a.CancellationToken,this.state={},e.mediator.listen("DOCUMENT_CLUSTER_HOVER",t=>{this.cancellationToken.isCanceled()||this.setState({faded:e.cluster.id!==t&&void 0!==t})},{token:this.cancellationToken})}componentWillUnmount(){this.cancellationToken.cancel()}render(){const{visible:e,mediator:t,cluster:s,onClick:n,percentage:o}=this.props;return i.createElement("div",{className:"cluster-list-item-wrapper"+(e?"":" invisible-cluster"),onClick:()=>{e&&(t.dispatch("DOCUMENT_CLUSTER_HOVER",void 0),t.dispatch(r.UPDATE_CLUSTER_SELECTION,s.id))},style:{padding:"3px 3px 3px"},onMouseEnter:()=>e&&this.props.mediator.dispatch("DOCUMENT_CLUSTER_HOVER",s.id),onMouseLeave:()=>e&&this.props.mediator.dispatch("DOCUMENT_CLUSTER_HOVER",void 0)},i.createElement("div",{className:"cluster-list-item",style:{opacity:this.state.faded?.2:1,margin:"0px"}},i.createElement("i",{className:"cluster-list-item-color",style:{backgroundColor:e?s.color:"#dddddd"}}),i.createElement("span",{className:"cluster-list-item-name"},i.createElement("span",{dangerouslySetInnerHTML:{__html:l.emojiService.parseTextForEmoji(s.name)}})),e?i.createElement("span",{className:"cluster-list-item-percentage"},o):i.createElement("span",{className:"cluster-list-item-show"},i.createElement("i",{onClick:n,className:"fa fa-eye"}))))}}t.DocumentClusterSidebarClustersPage=class extends s.DocumentClusterSidebarPage{constructor(e){super(e),this.rootRef=i.createRef()}renderPage(){const e=[...this.props.model.visibleClusters,...this.props.model.inVisibleClusters].map(e=>{const t=this.props.model.isClusterVisible(e.id);return i.createElement(c,{key:e.id+"",visible:t,mediator:this.props.mediator,cluster:e,percentage:t&&this.props.model.getDocPercentage(e.id),onClick:()=>{const t=this.props.model.customization.clusters||[],i=this.props.model.getClusterCustomization(e.id);i?i.hidden=!1:t.push({hidden:!1,id:this.props.selectedClusterId}),this.props.mediator.dispatch(r.UPDATE_CUSTOMIZATION,Object.assign({},this.props.model.customization,{clusters:t}))}})});return i.createElement(i.Fragment,null,i.createElement(o.DocumentClusterSidebarBox,{title:"Clusters",initiallyOpen:!0},i.createElement(n.DocumentClusterSidebarVirtualList,{items:e})))}}}),define("classes/sidebar/pages/document_cluster_sidebar_abstract_details_page",["require","exports","react","classes/sidebar/pages/document_cluster_sidebar_page","classes/document_cluster_messages","classes/sidebar/pages/document_cluster_virtual_list","widget_base","math_utils","classes/sidebar/pages/document_cluster_sidebar_cluster_details_page","reusable_services"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const d=25;let h=0;t.DocumentClusterSidebarAbstractDetailsPage=class extends s.DocumentClusterSidebarPage{constructor(e){super(e),this.isStoryScope=!1,this.articlesWidget=void 0,this.articlesDrawn=!1,this.state=this.getInitialState()}get messages(){const{model:{buildConfiguration:{messages:e}}}=this.props;return e}get canEdit(){return this.props.model.widget.getPageState().getAllowedPages().isDocumentClusterIqApp()}renderKeyWords(e){return i.createElement(r.DocumentClusterSidebarVirtualList,{items:[i.createElement("div",{className:"document-cluster-keywords",key:"keyword-"+e.join("")},e.filter(e=>e.length>0).map(e=>i.createElement("div",{key:e,dangerouslySetInnerHTML:{__html:c.emojiService.parseTextForEmoji(e)}})))]})}getInitialState(){return{articlesLoadingState:l.ArticlesLoadingState.LOADING,articlesDrawn:!1}}dispatchCustomizations(e){this.canEdit&&this.props.mediator.dispatch(n.UPDATE_CUSTOMIZATION,Object.assign({},e))}async fetchData(){const e=this.getAllArticleUrls();if(e.length>0){this.setState({articlesLoadingState:l.ArticlesLoadingState.LOADING});const t=h++,i=await this.props.model.buildConfiguration.loadArticles(this.props.model.widget,e.slice(0,d-1),t,this.isStoryScope);this.cancellationToken.isCanceled()||i.id!==t?i.cancellationToken.cancel():(this.cancellationToken.addCleanupFunction(()=>!i.cancellationToken.isCanceled()&&i.cancellationToken.cancel()),i.widget.isEmptyWidget()?this.setState({articlesLoadingState:l.ArticlesLoadingState.NO_DATA}):(this.articlesWidget=i.widget,this.setState({articlesLoadingState:l.ArticlesLoadingState.LOADED})))}}componentDidMount(){this.fetchData()}async mountFragment(e,t){if(e&&0===e.childElementCount&&!this.cancellationToken.isCanceled()){const i=this.props.model.subFragments[t].deploy({mediator:this.props.mediator,dimensions:new a.Rectangle(new a.Vector2D(0,0),e.clientWidth,e.clientHeight),animationDuration:0,animationStrategy:0,payload:this.articlesWidget||this.props.model.widget,rootNode:e,cleanUp:this.cancellationToken});requestAnimationFrame(()=>this.props.model.buildConfiguration.applyScope());const{fragment:s,model:n,drawSettings:r}=await i;await s.update(n,o.DataAction.NEW_DATA),await s.draw(r),this.setState({articlesDrawn:!0})}}showAllArticles(){this.props.model.buildConfiguration.openAllArticles(this.getDrilldownArticleUrls(),this.props.model.widget)}renderArticleFragments(){const{articlesLoadingState:e,articlesDrawn:t}=this.state;return this.articlesWidget&&e===l.ArticlesLoadingState.LOADED?i.createElement(r.DocumentClusterSidebarVirtualList,{disableHeightCheck:!t,items:[i.createElement("div",{ref:e=>this.mountFragment(e,"articles")}),this.getAllArticleUrls().length>=d?i.createElement("div",{className:"document-cluster-details-load-more",onClick:()=>this.showAllArticles()},this.messages.seeAll):void 0].filter(e=>e)}):e===l.ArticlesLoadingState.NO_DATA?i.createElement(r.DocumentClusterSidebarVirtualList,{disableHeightCheck:!t,items:[i.createElement("div",{ref:e=>this.mountFragment(e,"noData")})].filter(e=>e)}):i.createElement(i.Fragment,null)}renderArticles(){return i.createElement(i.Fragment,null,this.renderArticleFragments(),!this.state.articlesDrawn&&i.createElement("div",{className:"articles-loader"},i.createElement("div",null,i.createElement("i",{className:"fa fa-refresh fa-spin tw-loading-bubble"}))))}renderDefaultAuthorDetails(e){return i.createElement("div",{className:"main-author-details"},i.createElement("div",null,e.info.name),i.createElement("div",null,e.source_type_localized),i.createElement("div",null,e.reach))}renderTwitterAuthorDetails(e){return i.createElement("div",{className:"main-author-details"},i.createElement("div",null,e.info.name),i.createElement("div",null,i.createElement("a",{target:"window",href:e.info.url},"@",e.info.short_name)),i.createElement("div",null,e.reach," posts"))}renderMainAuthor(e){return e?i.createElement("div",{className:"cluster-list-item main-authors-author"},i.createElement("div",{className:"main-authors-icon"},i.createElement("div",{className:"main-authors-icon-image",style:{backgroundImage:e.info.image_url&&`url(${e.info.image_url})`}})),"SOCIALMEDIA_TWITTER"===e.source_type?this.renderTwitterAuthorDetails(e):this.renderDefaultAuthorDetails(e)):i.createElement("div",{className:"cluster-list-item main-authors-author-empty"})}renderMainAuthors(e){const t=[];for(let i=0;i<e.length;i+=2)t.push([e[i],e[i+1]]);return i.createElement(r.DocumentClusterSidebarVirtualList,{items:t.map(([e,t])=>i.createElement("div",{className:"document-cluster-details-main-authors"},this.renderMainAuthor(e),this.renderMainAuthor(t)))})}}}),define("classes/sidebar/pages/document_cluster_sidebar_cluster_details_page",["require","exports","react","classes/document_cluster_messages","event_bus","reusable_components","classes/sidebar/pages/document_cluster_sidebar_box","classes/sidebar/pages/document_cluster_sidebar_abstract_details_page","classes/sidebar/pages/document_cluster_virtual_list","reusable_services"],function(e,t,i,s,n,r,o,a,l,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LOADING="LOADING",e.NO_DATA="NO_DATA",e.LOADED="LOADED"}(d=t.ArticlesLoadingState||(t.ArticlesLoadingState={}));t.DocumentClusterSidebarClusterDetailsPage=class extends a.DocumentClusterSidebarAbstractDetailsPage{constructor(e){super(e),this.customization={}}getDrilldownArticleUrls(){return this.props.model.clusters.find(e=>e.id===this.props.selectedClusterId).article_urls}getAllArticleUrls(){return this.props.model.clusters.find(e=>e.id===this.props.selectedClusterId).urls}getInitialState(){const e=this.props.model.clusters.find(e=>e.id===this.props.selectedClusterId);return Object.assign({},super.getInitialState(),{editName:e.name,editColor:e.color,showDropdown:!1,articlesLoadingState:d.LOADING})}updateCustomization(){const e=this.props.model.customization.clusters||[],t=this.props.model.getClusterCustomization(this.props.selectedClusterId);t?Object.assign(t,this.customization):e.push(Object.assign({id:this.props.selectedClusterId},this.customization)),this.props.model.customization.merges,this.dispatchCustomizations(Object.assign({},this.props.model.customization,{clusters:e,merges:this.state.mergeClusterId?[...this.props.model.customization.merges||[],{cluster_id:this.props.selectedClusterId,merge_with_id:this.state.mergeClusterId}]:[...this.props.model.customization.merges||[]]}))}showColorPicker(e){n.eventBus.subscribeOnce(n.EVENT_TYPES.COLOR_EDIT_BUBBLE_CLOSE,t=>{t.value&&-1===t.value.indexOf(e)&&(this.customization=Object.assign({},this.customization,{color:t.value}),this.setState({editColor:t.value}))}),n.eventBus.dispatch({value:{initialColor:e,title:this.messages.editColor},type:n.EVENT_TYPES.SHOW_COLOR_EDIT_BUBBLE})}renderPage(){const e=this.props.model.clusters.find(e=>e.id===this.props.selectedClusterId);return i.createElement(i.Fragment,null,i.createElement("div",{className:"document-cluster-details-header "},i.createElement("i",{onClick:()=>this.state.editMode&&this.showColorPicker(this.state.editColor),className:"details-header-color"+(this.state.editMode?" editable":""),style:{backgroundColor:this.state.editColor}}),this.state.editMode?i.createElement("div",{className:"details-header-edit-name"},i.createElement("input",{onFocus:e=>e.target.select(),type:"text",value:this.state.editName,onChange:e=>this.setState({editName:e.target.value}),placeholder:this.messages.editName})):i.createElement("div",{className:"details-header-name clickable-name"},i.createElement("span",{onClick:()=>{this.props.mediator.dispatch(s.CLEAR_NODE_SELECTION,void 0)},dangerouslySetInnerHTML:{__html:c.emojiService.parseTextForEmoji(e.name)}})),this.renderActions(e)),this.state.editMode?this.renderDropdown():this.renderNumber(e),this.renderBoxes(e))}renderBoxes(e){return i.createElement("div",{className:"document-cluster-details-boxes"},e.keywords&&i.createElement(o.DocumentClusterSidebarBox,{title:this.messages.topKeywords,initiallyOpen:!0,showToggle:!0},this.renderKeyWords(e.keywords)),!this.props.isEmbedded&&i.createElement(o.DocumentClusterSidebarBox,{title:this.messages.mainStories,showToggle:!0},i.createElement(i.Fragment,null,this.renderArticles())),e.top_brands&&i.createElement(o.DocumentClusterSidebarBox,{title:this.messages.smartThemes,showToggle:!0},this.renderKeyWords(e.top_brands)),i.createElement(o.DocumentClusterSidebarBox,{title:this.messages.mainSources,showToggle:!0},i.createElement(i.Fragment,null,this.renderMainAuthors(e.main_authors))))}renderActions(e){return i.createElement("div",{className:"details-header-actions"},this.state.editMode?i.createElement("i",{className:"fa fa-floppy-o",onClick:()=>{this.state.editName.length>0&&this.state.editName!==e.name&&(this.customization=Object.assign({},this.customization,{name:this.state.editName})),Object.keys(this.customization).length>0||this.state.mergeClusterId?(this.props.mediator.dispatch(s.CLEAR_NODE_SELECTION,void 0),this.updateCustomization()):this.setState({editMode:!1,mergeClusterId:void 0,editColor:e.color,showDropdown:!1})}}):this.canEdit&&i.createElement("i",{className:"fa fa-pencil",onClick:()=>this.setState({editMode:!0,editName:e.name})}),!this.state.editMode&&this.canEdit&&i.createElement("i",{className:"fa fa-eye-slash",onClick:()=>{this.customization=Object.assign({},this.customization,{hidden:!0}),this.updateCustomization(),this.props.mediator.dispatch(s.CLEAR_NODE_SELECTION,void 0)}}),i.createElement("i",{className:"fa fa-level-up ",onClick:()=>{this.state.editMode?this.setState({editMode:!1,mergeClusterId:void 0,editColor:e.color,showDropdown:!1}):this.props.mediator.dispatch(s.CLEAR_NODE_SELECTION,void 0)}}))}renderNumber(e){return i.createElement("div",{className:"document-cluster-details-numbers"},i.createElement("div",{className:"details-numbers-row"},i.createElement("div",{className:"details-number"},i.createElement("span",null,this.props.numberFormatter.toInteger(e.doc_count)),i.createElement("label",null,this.messages.articles)),i.createElement("div",{className:"details-number"},i.createElement("span",null,this.props.numberFormatter.toInteger(e.story_count)),i.createElement("label",null,this.messages.stories)),i.createElement("div",{className:"details-number"})),i.createElement("div",{className:"details-numbers-row"},i.createElement("div",{className:"details-number"},i.createElement("span",null,this.props.model.getDocPercentage(e.id)),i.createElement("label",null,this.messages.conversations)),i.createElement("div",{className:"details-number"},i.createElement("span",null,this.props.numberFormatter.toPercentage(e.reach_percentage/100)),i.createElement("label",null,this.messages.reach)),i.createElement("div",{className:"details-number"},i.createElement("span",null,this.props.numberFormatter.toPercentage(e.engagement_percentage/100)),i.createElement("label",null,this.messages.engagement))))}renderDropdown(){const e=this.props.model.clusters.find(e=>e.id===this.state.mergeClusterId);return i.createElement("div",{className:"document-cluster-details-merge"},i.createElement("label",null,this.messages.mergeWith,":"),i.createElement(r.DocumentClickTrackerWrapper,{clickOutside:()=>this.state.showDropdown&&this.setState({showDropdown:!1})},i.createElement("div",{className:"merge-dropdown"},i.createElement("span",{onClick:()=>this.setState({showDropdown:!this.state.showDropdown})},i.createElement("input",{type:"text",placeholder:this.messages.selectAnotherCluster,value:e?e.name:"",className:"merge-placeholder",disabled:!0}),i.createElement("i",{className:"icon2-tw-expand-head"})),this.state.showDropdown&&i.createElement("div",{className:"merge-items",style:{height:Math.min(32*this.props.model.clusters.filter(e=>e.id!==this.props.selectedClusterId).length,160)+"px"}},i.createElement(l.DocumentClusterSidebarVirtualList,{disableHeightCheck:!0,items:[i.createElement("ul",null,this.props.model.clusters.filter(e=>e.id!==this.props.selectedClusterId).map(t=>i.createElement("li",{className:e&&t.id===e.id&&"selected-cluster",onClick:()=>this.setState({mergeClusterId:t.id,showDropdown:!1}),key:"cluster-"+t.id},t.name)))].filter(e=>e)})))))}}}),define("classes/sidebar/pages/document_cluster_sidebar_vertex_details_page",["require","exports","react","classes/sidebar/pages/document_cluster_sidebar_box","classes/sidebar/pages/document_cluster_sidebar_abstract_details_page","classes/document_cluster_messages","reusable_services"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterSidebarVertexDetailsPage=class extends n.DocumentClusterSidebarAbstractDetailsPage{constructor(){super(...arguments),this.isStoryScope=!0}renderPage(){const e=this.props.model.nodes[this.props.selectedVertexId],t=this.props.model.clusters.find(e=>e.id===this.props.selectedClusterId);return i.createElement(i.Fragment,null,i.createElement("div",{className:"document-cluster-details-header "},i.createElement("i",{className:"details-header-color",style:{backgroundColor:t.color}}),i.createElement("div",{className:"details-header-name clickable-name"},i.createElement("span",{onClick:()=>{this.props.mediator.dispatch(r.UPDATE_VERTEX_SELECTION,void 0)},dangerouslySetInnerHTML:{__html:o.emojiService.parseTextForEmoji(t.name)}}))),i.createElement("div",{className:"document-cluster-details-header document-cluster-vertex-details-header"},i.createElement("div",{className:"details-header-name"},i.createElement("span",null,this.messages.story,": "),e.data.more_info.title_snippet),this.renderActions(e)),this.renderNumbers(e),this.renderBoxes(e))}renderActions(e){return i.createElement("div",{className:"details-header-actions"},this.canEdit&&i.createElement("i",{className:"fa fa-eye-slash",onClick:()=>{this.props.mediator.dispatch(r.CLEAR_NODE_SELECTION,void 0),this.dispatchCustomizations(Object.assign({},this.props.model.customization,{hidden_stories:(this.props.model.customization.hidden_stories||[]).concat([this.props.selectedVertexId])}))}}),i.createElement("i",{className:"fa fa-level-up ",onClick:()=>{this.props.mediator.dispatch(r.UPDATE_VERTEX_SELECTION,void 0)}}))}getDrilldownArticleUrls(){return this.getAllArticleUrls()}getAllArticleUrls(){return this.props.model.nodes[this.props.selectedVertexId].data.more_info.entryUrls}renderBoxes(e){return i.createElement("div",{className:"document-cluster-details-boxes"},!this.props.isEmbedded&&i.createElement(s.DocumentClusterSidebarBox,{title:this.messages.mainArticles,initiallyOpen:!0,showToggle:!(!e.data.more_info.main_authors&&!e.data.more_info.top_brands)},i.createElement(i.Fragment,null,this.renderArticles())),e.data.more_info.main_authors&&e.data.more_info.main_authors.length>0&&i.createElement(s.DocumentClusterSidebarBox,{title:this.messages.mainSources,showToggle:!0},i.createElement(i.Fragment,null,this.renderMainAuthors(e.data.more_info.main_authors))),e.data.more_info.top_brands&&i.createElement(s.DocumentClusterSidebarBox,{title:this.messages.smartThemes,showToggle:!0},this.renderKeyWords(e.data.more_info.top_brands)))}renderNumbers(e){return i.createElement("div",{className:"document-cluster-details-numbers"},i.createElement("div",{className:"details-number"},i.createElement("span",null,e.data.more_info.entryUrls.length),i.createElement("label",null,this.messages.articles)),i.createElement("div",{className:"details-numbers-row details-metrics"},i.createElement("div",{className:"details-number details-metrics-label"},this.messages.metrics),i.createElement("div",{className:"details-number"},i.createElement("i",{className:"icon2-tw-engagement"}),i.createElement("span",null,this.props.numberFormatter.toInteger(e.data.more_info.engagement))),i.createElement("div",{className:"details-number"},i.createElement("i",{className:"icon2-tw-reach"}),i.createElement("span",null,this.props.numberFormatter.toInteger(e.data.more_info.reach))),i.createElement("div",{className:"details-number"},i.createElement("i",{className:"icon2-tw-velocity-increasing"}),i.createElement("span",null,e.data.more_info.trending_score))))}}}),define("classes/sidebar/document_cluster_sidebar",["require","exports","react","reusable_components","reusable_utilities","event_bus","math_utils","classes/document_cluster_messages","classes/sidebar/pages/document_cluster_sidebar_clusters_page","models/document_cluster_model","classes/sidebar/pages/document_cluster_sidebar_cluster_details_page","classes/sidebar/pages/document_cluster_sidebar_vertex_details_page"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";var u;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CLUSTERS="CLUSTERS",e.CLUSTER_DETAILS="CLUSTER_DETAILS",e.VERTEX_DETAILS="VERTEX_DETAILS"}(u=t.DocumentClusterSidebarPageType||(t.DocumentClusterSidebarPageType={}));class p extends i.Component{constructor(e){super(e),this.cancellationToken=new n.CancellationToken,this.refreshId=0,this.waitForServer=!1,this.graphRefreshing=!1;const{model:{widget:t,buildConfiguration:{changeCustomization:i}}}=this.props;this.buildConfiguration=e.model.buildConfiguration,this.subFragments=e.model.subFragments,this.state={jobStatus:{progress:0,status:""},isVisible:!0,statusString:"",page:u.CLUSTERS,documentClusterModel:this.buildModel(e.model),customizationChanging:!1,generationTried:this.buildConfiguration.triedGeneration},this.props.mediator.listen(a.UPDATE_VERTEX_SELECTION,e=>{void 0!==e?this.setState({selectedVertexId:e,page:u.VERTEX_DETAILS}):this.setState({selectedVertexId:e,page:u.CLUSTER_DETAILS})}),this.props.mediator.listen(a.UPDATE_CLUSTER_SELECTION,e=>{void 0!==e?this.setState({selectedClusterId:e,page:u.CLUSTER_DETAILS}):this.setState({selectedClusterId:e,page:u.CLUSTERS})}),this.props.mediator.listen(a.UPDATE_CUSTOMIZATION,async e=>{this.setState({customizationChanging:!0}),this.props.mediator.dispatch(a.CUSTOMIZATION_UPDATING,!0),await i(t,e),this.props.mediator.dispatch(a.CUSTOMIZATION_UPDATING,!1),this.setState({customizationChanging:!1})}),this.cancellationToken.addCleanupFunction(e.onUpdate.subscribe(e=>{this.setState({documentClusterModel:this.buildModel(e)})}).cancel)}buildModel(e){if(e.widget.hasPayloadValue()){return new c.DocumentClusterModel(e.widget,this.buildConfiguration.getLayout(e.widget),this.buildConfiguration,this.subFragments,this.props.settings.style.formatting.numberFormatter)}}componentDidMount(){const e=$(".tw-influencer-network-sidebar");r.eventBus.dispatch({type:r.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.model.widget.getId(),expectedSize:this.props.settings.dimensions.size,realSize:new o.Vector2D(e.width(),e.outerHeight())}});const t=new n.CancellationToken;this.refreshToken=t,this.startRefreshing(t)}componentWillUnmount(){this.cancellationToken.cancel()}render(){const{props:{model:{widget:e}}}=this;if(!this.state.isVisible)return null;if(!e.hasPayloadValue()||e.isEmptyWidget()||!e.getPayloadValue().graph.vertices)return this.renderNoPayload();const t=!e.getPageState().getAllowedPages().isDashboard()&&!e.getPageState().getAllowedPages().isReport(),s=i.createElement("div",{className:"refresh-block"},this.renderGenerationInfo(),this.renderRefreshButton());return i.createElement("div",{className:"tw-influencer-network-sidebar tw-document-cluster-sidebar"},t?s:null,this.state.customizationChanging&&i.createElement("div",{className:"loading customization-saving"},i.createElement("i",{className:"fa fa-refresh fa-spin"})),i.createElement("div",{className:"page-container"+(this.state.customizationChanging?" changing-customization":"")},this.renderPages()))}renderPages(){let e=[];switch(this.state.page){case u.CLUSTER_DETAILS:e.push([d.DocumentClusterSidebarClusterDetailsPage,this.state.selectedClusterId+""+u.CLUSTER_DETAILS]);break;case u.VERTEX_DETAILS:e.push([d.DocumentClusterSidebarClusterDetailsPage,this.state.selectedClusterId+""+u.CLUSTER_DETAILS],this.state.documentClusterModel.nodes[this.state.selectedVertexId]?[h.DocumentClusterSidebarVertexDetailsPage,this.state.selectedVertexId+""+u.VERTEX_DETAILS]:void 0);break;default:e.push([l.DocumentClusterSidebarClustersPage,"overview"])}return(e=e.filter(e=>e)).map(([t,s],n)=>i.createElement("span",{style:{display:e.length>0&&n<e.length-1&&"none"},key:s+n},i.createElement(t,{model:this.state.documentClusterModel,numberFormatter:this.props.settings.style.formatting.numberFormatter,dimensions:this.props.settings.dimensions,mediator:this.props.mediator,selectedClusterId:this.state.selectedClusterId,selectedVertexId:this.state.selectedVertexId,isEmbedded:this.buildConfiguration.isEmbedded()})))}startRefreshing(e){e.isCanceled()||(this.graphRefreshing=!0,this.refreshStatus(e))}async refreshStatus(e){if(!window.isExport&&!e.isCanceled())try{const{widget:t,buildConfiguration:i}=this.props.model,{jobStatus:r}=this.state,o=this.getRefreshButtonState(r),a=await n.PromiseUtils.cancellationPromise(i.getStatus(t),e);if(e.isCanceled())return;let l=!1;o===s.ProgressButtonState.LOADING&&this.getRefreshButtonState(a)===s.ProgressButtonState.DEFAULT&&(l=!0);const c=JSON.stringify(Object.assign({},a,{logging_context_id:""}));this.state.statusString!==c&&(l&&this.graphRefreshing&&(this.graphRefreshing=!1,this.reloadGraph()),this.setState({jobStatus:a,statusString:c})),100!==a.progress&&"FAILED"!==a.status?e.setTimeout(()=>this.refreshStatus(e),4e3):e.cancel()}catch(e){if(!e.isCancelled)throw e}}renderError(){const{model:{buildConfiguration:{messages:e}}}=this.props,t=e.noData.noResults,s=e.noData.noResultsTitle;return i.createElement("div",{className:"doc-cluster-error"},i.createElement("i",{className:"fa fa-frown-o"}),i.createElement("div",{className:"doc-cluster-error-title"},s),i.createElement("div",{dangerouslySetInnerHTML:{__html:t}}))}renderNoPayload(){const{model:{widget:e,buildConfiguration:{messages:t}}}=this.props,s=("FAILED"===this.state.jobStatus.status||this.state.generationTried)&&"NO_RESULTS"===e.getMissingDataReason()||"FAILED"!==this.state.jobStatus.status;let n;switch(this.state.jobStatus.status){case"LOADING":n=t.noData.loading;break;default:n=t.noData.idle}return i.createElement("div",{className:"tw-influencer-network-sidebar tw-document-cluster-sidebar no-payload"+(!e.hasDataGraph()&&e.hasPageState()&&e.getPageState().getAllowedPages().isIqApp()?" tall":"")},i.createElement("div",null,s&&this.renderError(),i.createElement("div",null,this.renderRefreshButton()),!s&&i.createElement("div",null,n)))}async refresh(){this.graphRefreshing=!0;const{model:{widget:e,buildConfiguration:{onRefreshClick:t,canRefreshCheck:i}}}=this.props;this.waitForServer=!0;try{if(""===this.state.jobStatus.status&&(this.refreshId++,this.setState({jobStatus:{progress:0,status:"RUNNING"},statusString:""})),await i(e)){this.refreshId++,this.setState({jobStatus:{progress:0,status:"RUNNING"},statusString:""}),this.refreshToken&&this.refreshToken.cancel();const i=new n.CancellationToken;this.refreshToken=i,this.cancellationToken.chain(this.refreshToken),await t(e),this.startRefreshing(i),i.addCleanupFunction(()=>{this.setState({generationTried:!0})})}this.waitForServer=!1}catch(e){e&&(this.refreshToken&&this.refreshToken.cancel(),this.refreshId++,this.setState({jobStatus:{progress:0,status:"RESTARTED"===e?"":"FAILED"},statusString:""}),this.waitForServer=!1)}}refreshButtonClicked(){this.waitForServer||this.refresh()}renderRefreshButton(){const{model:{buildConfiguration:{messages:e,showRefreshButton:t},widget:n}}=this.props,r=!n.hasPayloadValue()||n.isEmptyWidget();return t?i.createElement("div",{className:"pull-left"},i.createElement("div",{className:"pull-left"},i.createElement(s.ProgressButton,{key:"running"+this.refreshId,icon:"fa fa-refresh",progressBar:{fillRate:this.state.jobStatus.progress},forceButtonState:this.getRefreshButtonState(this.state.jobStatus),spinIconWhileLoading:!0,onClick:e=>{this.refreshButtonClicked()},className:"button refresh-button",loadingClass:"working",disabledClass:"disabled",text:r?e.refresh.init:e.refresh.idle,loadingText:e.refresh.busy,errorText:e.refresh.failed,errorClass:"failed"}))):null}renderGenerationInfo(){return i.createElement("div",{className:"generation-date"},this.getGenerationDate())}getGenerationDate(){const{model:{widget:e,buildConfiguration:{messages:t}},settings:{style:i}}=this.props,s=e.getPayloadValue();return`${t.refresh.generation} ${moment(s.task_information.generation_ts).format(i.formatting.dateTimeFormat)}`}getRefreshButtonState(e){return""===e.status||"FINISHED"===e.status?s.ProgressButtonState.DEFAULT:"FAILED"===e.status?s.ProgressButtonState.ERROR:s.ProgressButtonState.LOADING}reloadGraph(){this.props.model.buildConfiguration.reloadGraph(this.props.model.widget)}}__decorate([n.throttle(1e3,{leading:!0,trailing:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],p.prototype,"refreshButtonClicked",null),t.DocumentClusterSidebar=p}),define("classes/sidebar/document_cluster_sidebar_fragment",["require","exports","react-dom","react","widget_base","classes/document_cluster_layout","classes/sidebar/document_cluster_sidebar"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterSidebarFragment=class extends n.AbstractReactFragment{constructor(e){super(e),this.currentLayout=e.buildConfiguration.getLayout(e.widget)}initialize(e,t,i,s){return super.initialize(e,t,i,s)}renderIntoContainer(e,t,n,r){i.render(s.createElement(o.DocumentClusterSidebar,{model:this.fragmentModel,onDraw:t,onUpdate:e,settings:n,mediator:r}),this.chartContainer)}getXOrder(){return 1}getLayoutIterator(){const e=r.DOCUMENT_CLUSTER_SIDEBAR_FRAGMENT_LAYOUTS.filter(e=>e.id===this.currentLayout);return new n.LayoutIterator(e,e=>this.getDimensionsForLayout(e))}}}),define("document_cluster",["require","exports","classes/document_cluster","classes/document_cluster_fragment","classes/document_cluster_label","classes/document_cluster_layer","classes/document_cluster_layout","classes/document_cluster_link","classes/document_cluster_messages","classes/document_cluster_node","classes/document_cluster_object","classes/document_cluster_renderer","classes/highlight_state","classes/sidebar/document_cluster_sidebar","classes/sidebar/document_cluster_sidebar_fragment","models/document_cluster_label_model","models/document_cluster_link_model","models/document_cluster_model","models/document_cluster_node_model"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y){"use strict";function b(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),b(i),b(s),b(n),b(r),b(o),b(a),b(l),b(c),b(d),b(h),b(u),b(p),b(g),b(m),b(_),b(f),b(y)}),define("classes/document_cluster_ui",["require","exports","math_utils","graphics_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClusterUi=class{constructor(e,t,i){this.addCameraButtons(e,t,i)}addCameraButtons(e,t,n){const r=new s.Color(new i.Vector4D(0,0,0,88)),o=new s.Color(new i.Vector4D(0,0,0,88)),a=new s.DrawableRectangle({position:new i.Vector2D(10,10),style:{fillStyle:"white",strokeStyle:o.toRGBA()},size:new i.Vector2D(27,27),children:[new s.DrawableRectangle({position:new i.Vector2D(8,12),style:{fillStyle:o},size:new i.Vector2D(4,3)}),new s.DrawableRectangle({position:new i.Vector2D(15,12),style:{fillStyle:o},size:new i.Vector2D(4,3)}),new s.DrawableRectangle({position:new i.Vector2D(12,8),style:{fillStyle:o},size:new i.Vector2D(3,11)})],on:{mouseenter(){e.tween(o,"a",255,200),n.style.cursor="pointer"},mouseleave(){e.tween(o,"a",88,200),n.style.cursor=""},mouseup:t.zoomIn}}),l=new s.DrawableRectangle({position:new i.Vector2D(10,37),style:{fillStyle:"white",strokeStyle:r.toRGBA()},size:new i.Vector2D(27,27),children:[new s.DrawableRectangle({position:new i.Vector2D(8,12),style:{fillStyle:r},size:new i.Vector2D(11,3)})],on:{mouseenter(){e.tween(r,"a",255,200),n.style.cursor="pointer"},mouseleave(){e.tween(r,"a",88,200),n.style.cursor=""},mouseup:t.zoomOut}});e.addDrawable(a),e.addDrawable(l)}}}),define("classes/document_cluster_metrics_component",["require","exports","react"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s extends i.Component{render(){const{metrics:e}=this.props;return s.renderInfluencerMetrics(e.map(e=>e.label))}static renderInfluencerMetrics(e){return i.createElement("div",{style:{paddingTop:10,height:84,width:"48%",float:"left"}},i.createElement("table",{className:"metric"},i.createElement("tbody",null,e.map((e,t)=>i.createElement("tr",{style:{verticalAlign:"baseline"},key:t},i.createElement("td",{className:"label"},e))))))}}t.DocumentClusterMetricsComponent=s}),define("drag_and_drop_service",["require","exports","reusable_utilities","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.dragSources=[],this.dropTargets=[],this.dragging=!1,this.disabled=!1}removeDragSource(e){const t=this.dragSources.map(e=>e.source).indexOf(e);~t&&this.dragSources.splice(t,1)}removeDropTarget(e){const t=this.dropTargets.map(e=>e.target).indexOf(e);~t&&this.dropTargets.splice(t,1)}isDragging(){return this.dragging}registerDragSources(e,t){e.forEach((e,i)=>{if(void 0===e)throw new Error("source cannot be undefined");this.dragSources.push({source:e,options:t}),this.initializeSource(e,t,i),t.cancellationToken.addCleanupFunction(()=>this.removeDragSource(e))})}registerDropTargets(e,t){e.forEach(e=>{if(void 0===e)throw new Error("target cannot be undefined");this.dropTargets.push({target:e,options:t}),this.initializeTarget(e,t),t.cancellationToken.addCleanupFunction(()=>this.removeDropTarget(e))})}enableInteraction(){this.disabled=!1}disableInteraction(){this.disabled=!0}initializeSource(e,t,i){if(void 0===t.channels)throw new Error("channels cannot be undefined");const s=t.cancellationToken;s.addDomEvent(e,"mousedown",s=>this.onSourceMouseDown(e,t,i,s)),s.addDomEvent(document.body,"mousemove",e=>this.onSourceMouseMove(t,e)),s.addDomEvent(document.body,"mouseup",e=>{this.lastClickedSource===t&&(this.dragging&&(this.dropTargets.forEach(t=>{this.onTargetMouseUp(t.target,t.options,e)}),this.onSourceMouseUp(t,e,this.dragSession)),this.dragSession=void 0,this.dragging=!1,this.lastClickedIndex=void 0,this.lastClickedElement=void 0,this.lastClickPosition=void 0,this.lastClickedSource=void 0)})}initializeTarget(e,t){const i=t.cancellationToken;i.addDomEvent(e,"mouseenter",e=>this.onTargetMouseEnter(t,e)),i.addDomEvent(e,"mouseleave",e=>this.onTargetMouseLeave(t,e)),i.addDomEvent(e,"mousemove",e=>this.onTargetMouseMove(t,e))}onSourceMouseDown(e,t,i,n){if(0===n.button&&!this.disabled){if(this.dragging)throw new Error("illegal state");this.lastClickedIndex=i,this.lastClickedElement=e,this.lastClickedSource=t,this.lastClickPosition=new s.Vector2D(n.clientX,n.clientY)}}getChannels(e){return"function"==typeof e?e():e}async onSourceMouseMove(e,t){if(this.lastClickedSource===e&&this.hasAnyTargets(this.getChannels(e.channels))&&0===t.button)if(this.dragging)this.dragSession.lockHandle||(this.dragSession.dragHandle.style.left=`${t.clientX}px`,this.dragSession.dragHandle.style.top=`${t.clientY}px`),e.onDragMove(t,this.dragSession);else if(this.checkDragStart(e.minimumDragDistance,t,this.lastClickPosition)){this.getAllTargets(this.getChannels(e.channels)).forEach(e=>e.onDragStart&&e.onDragStart(t));const i=await e.onDragStart(t,this.lastClickedElement,this.lastClickedIndex);void 0!==i&&(this.dragSession=Object.assign({sourceOptions:e,lockHandle:!1},i,{sharedData:{}}),this.dragging=!0)}}async onSourceMouseUp(e,t,i){e.onDragStop&&0===t.button&&await e.onDragStop(t,i)}checkDragStart(e,t,i){return new s.Vector2D(t.clientX,t.clientY).distance(i)>=e}getAllTargets(e){return this.dropTargets.filter(t=>this.getChannels(t.options.channels).some(t=>e.includes(t))).map(e=>e.options)}hasAnyTargets(e){return void 0!==this.dropTargets.find(t=>this.getChannels(t.options.channels).some(t=>e.includes(t)))}onTargetMouseEnter(e,t){e.onDragEnter&&this.dragging&&this.isValidTarget(e)&&0===t.button&&setTimeout(()=>{e.onDragEnter(t,this.dragSession)})}onTargetMouseLeave(e,t){e.onDragLeave&&this.dragging&&this.isValidTarget(e)&&0===t.button&&setTimeout(()=>{e.onDragLeave(t,this.dragSession)})}onTargetMouseMove(e,t){e.onDragMove&&this.dragging&&this.isValidTarget(e)&&0===t.button&&setTimeout(()=>{e.onDragMove(t,this.dragSession)})}onTargetMouseUp(e,t,s){0===s.button&&this.dragging&&(this.isValidTarget(t)&&i.DOMMath.isPointOnElement({x:s.clientX+window.scrollX,y:s.clientY+window.scrollY},$(e))?t.onDragAccept(s,this.dragSession):t.onDragCancel&&t.onDragCancel(s,this.dragSession))}isValidTarget(e){return this.dragSession&&this.getChannels(e.channels).some(e=>this.getChannels(this.dragSession.sourceOptions.channels).includes(e))}}t.DragAndDropService=n,t.dragAndDropService=new n}),define("drag_and_drop",["require","exports","drag_and_drop_service"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("tw_event",["require","exports","xstream"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=!1){this._subscriptionCache=[],this._subscriptions={},this._oneTimeSubscriptions={},this.cancelAllState={},this.subscriptionCount=0,e&&(this.onSubscribe=new s),this._isFiring=!1,this._invalidated=!1,this._cancelAll=!1,this.linkedEvents=[]}link(e){this.linkedEvents.push(e)}unlink(e){this.linkedEvents.splice(this.linkedEvents.indexOf(e),1)}cancelByCallback(e){let t=Object.keys(this._subscriptions).find(t=>this._subscriptions[t].method===e);t&&this._cancel(t,this._subscriptions),(t=Object.keys(this._oneTimeSubscriptions).find(t=>this._oneTimeSubscriptions[t].method===e))&&this._cancel(t,this._oneTimeSubscriptions)}subscribe(e,t){return this._isFiring?this._invalidated=!0:this._subscriptionCache.length=0,this._cancelAll&&this._subscribe(e,t,this.cancelAllState),this._subscribe(e,t,this._subscriptions)}getStack(){return""}_subscribe(e,t,i){void 0!==this.onSubscribe&&this.onSubscribe.fire();const n=(s.uuid++).toString(),r={_subscribedAt:this.getStack(),_key:n,method:e,muted:!1,context:t||this};return i[n]=r,this.subscriptionCount++,{cancel:()=>{this._cancel(n,i)},mute:()=>{r.muted=!0},unmute:()=>{r.muted=!1}}}toStream(){const e=this;return i.Stream.create({start:function(t){this.sub=e.subscribe(e=>{t.next(e)})},stop:function(){this.sub.cancel()}})}hasSubscriptions(){return 0!==this.getSubscriptionCount()}getSubscriptionCount(){return this.subscriptionCount}subscribeOnce(e,t){return this._subscribe(e,t,this._oneTimeSubscriptions)}async subscribeOnceAsPromise(){return new Promise((e,t)=>{this.subscribeOnce((...t)=>{e(t[0])})})}cancelAll(){this._isFiring?(this._cancelAll=!0,this.cancelAllState={}):(this._subscriptionCache.length=0,this._subscriptions=this.cancelAllState,this.cancelAllState={},this._oneTimeSubscriptions={},this.subscriptionCount=Object.keys(this._subscriptions).length)}_cancel(e,t){this._isFiring?this._invalidated=!0:this._subscriptionCache.length=0,delete t[e],this.subscriptionCount--}fire(...e){if(this._isFiring=!0,0===this._subscriptionCache.length)for(const e in this._subscriptions)this._subscriptionCache.push(this._subscriptions[e]);let t=this._subscriptionCache.length,i=t;for(;t--;){const s=this._subscriptionCache[i-1-t];s.method.apply(s.context,e)}const s=Object.keys(this._oneTimeSubscriptions);for(i=t=s.length;t--;){const n=this._oneTimeSubscriptions[s[i-1-t]];n.muted||n.method.apply(n.context,e),this.subscriptionCount--}for(this._oneTimeSubscriptions={},this._invalidated&&(this._subscriptionCache.length=0),this._isFiring=!1,this._cancelAll&&this.cancelAll(),i=t=this.linkedEvents.length;t--;){const s=this.linkedEvents[i-1-t];s.fire.apply(s,e)}}fireAsync(e=0,...t){const i=setTimeout(()=>{this.fire(...t)},e);return{cancel(){clearTimeout(i)}}}}s.uuid=0,t.Event=s}),define("event_emitter",["require","exports","tw_event"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventEmitter=class{constructor(){this.events={}}getEvent(e){return this.events[e]||(this.events[e]=new i.Event),this.events[e]}cancelAll(){Object.keys(this.events).forEach(e=>{this.events[e].cancelAll()})}getSubscriptionCount(e){return this.getEvent(e).getSubscriptionCount()}on(e,t){return this.getEvent(e).subscribe(t,this),this}once(e,t){return this.getEvent(e).subscribeOnce(t,this),this}off(e,t){this.events[e]&&this.events[e].cancelByCallback(t)}emitEvent(e,t){this.events[e]&&this.events[e].fire(t)}dispose(){this.cancelAll(),this.events={}}}}),define("event",["require","exports","event_emitter","tw_event"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("event_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BUBBLE_DIALOG_CREATED="BUBBLE_DIALOG_CREATED",e.BUBBLE_DIALOG_DESTROY="BUBBLE_DIALOG_DESTROY",e.BUBBLE_DIALOG_CREATE="BUBBLE_DIALOG_CREATE",e.BEFORE_ENTER_PRESENTATION_MODE="BEFORE_ENTER_PRESENTATION_MODE",e.BEFORE_EXIT_PRESENTATION_MODE="BEFORE_EXIT_PRESENTATION_MODE ",e.ENTER_PRESENTATION_MODE="ENTER_PRESENTATION_MODE",e.EXIT_PRESENTATION_MODE="EXIT_PRESENTATION_MODE ",e.GRID_REMOVE_ITEM="GRID_REMOTE_ITEM",e.GRID_REMOVE_SUB_ITEM="GRID_REMOTE_SUB_ITEM",e.GRID_UPDATE_SIZE="GRID_UPDATE_SIZE",e.GRID_ADD_ITEM="GRID_ADD_ITEM",e.GRID_UPDATE_CONFIGURATION="GRID_UPDATE_CONFIGURATION",e.GRID_UPDATE_PAGE_NUMBER="GRID_UPDATE_PAGE_NUMBER",e.GRID_SYNC_STATE="GRID_SYNC_STATE",e.METRICS_PAYLOAD="METRICS_PAYLOAD",e.DISPATCHER_PAYLOAD="DISPATCHER_PAYLOAD",e.PAGESTATE_REFRESH="PAGESTATE_REFRESH",e.QUICKSEARCH_EXPORT_FULL_PAGE="QUICKSEARCH_EXPORT_FULL_PAGE",e.QUICKSEARCH_MENU_SELECT_ITEM="QUICKSEARCH_MENU_SELECT_ITEM",e.QUICKSEARCH_MENU_SELECT_CATEGORY="QUICKSEARCH_MENU_SELECT_CATEGORY",e.QUICKSEARCH_MENU_UNSELECT_ALL="QUICKSEARCH_MENU_UNSELECT_ALL",e.QUICKSEARCH_MENU_UNSELECT_OTHERS="QUICKSEARCH_MENU_UNSELECT_OTHERS",e.QUICKSEARCH_SAVED_TOGGLE="QUICKSEARCH_SAVED_TOGGLE",e.DISPATCHER_START_SESSION="DISPATCHER_START_SESSION",e.ADD_ANCHOR_PREVIEW_NODE="ADD_ANCHOR_PREVIEW_NODE",e.ANCHOR_SELECTION_CHANGED="ANCHOR_SELECTION_CHANGED",e.ANCHOR_PREVIEW_CHANGED="ANCHOR_PREVIEW_CHANGED",e.ANCHOR_MODEL_CHANGED="ANCHOR_MODEL_CHANGED",e.ANCHOR_MODEL_KEY_NAVIGATION_ACTIVE="ANCHOR_MODEL_KEY_NAVIGATION_ACTIVE",e.REMOVE_ANCHOR_PREVIEW_NODE="REMOVE_ANCHOR_PREVIEW_NODE",e.TOPIC_NAVBAR_MODIFY_ITEM="TOPIC_NAVBAR_MODIFY_ITEM",e.TOPIC_NAVBAR_UPDATE_QUERY="TOPIC_NAVBAR_UPDATE_QUERY",e.TOPIC_NAVBAR_TOGGLE_EDITING="TOPIC_NAVBAR_TOGGLE_EDITING",e.TOPIC_NAVBAR_DELETE_ITEM="TOPIC_NAVBAR_DELETE_ITEM",e.TOPIC_NAVBAR_TOGGLE_ITEM_MUTE="TOPIC_NAVBAR_TOGGLE_ITEM_MUTE",e.TOPIC_NAVBAR_SHOW_FILTERS="TOPIC_NAVBAR_SHOW_FILTERS",e.TOPIC_NAVBAR_APPLY_FILTER_AS_TOPIC="TOPIC_NAVBAR_APPLY_FILTER_AS_TOPIC",e.TOPIC_NAVBAR_CLEAR_SEARCH="TOPIC_NAVBAR_CLEAR_SEARCH",e.TOPIC_NAVBAR_NEW_SEARCH_QUERY="TOPIC_NAVBAR_NEW_SEARCH_QUERY",e.TOPIC_NAVBAR_DISABLED_CLICK="TOPIC_NAVBAR_DISABLED_CLICK",e.TOPIC_NAVBAR_CLOSE_FILTER_MENU="TOPIC_NAVBAR_OPEN_FILTER_MENU",e.TOPIC_NAVBAR_CLOSE_CONTEXT_MENU="TOPIC_NAVBAR_CLOSE_CONTEXT_MENU",e.TOPIC_NAVBAR_TOGGLE_CONTEXT_MENU="TOPIC_NAVBAR_TOGGLE_CONTEXT_MENU",e.TOPIC_NAVBAR_TOGGLE_FILTER_MENU="TOPIC_NAVBAR_TOGGLE_FILTER_MENU",e.TOPIC_NAVBAR_TRANSITION="TOPIC_NAVBAR_TRANSITION",e.TOPIC_NAVBAR_RERENDER="TOPIC_NAVBAR_RERENDER",e.TOPIC_NAVBAR_INVALID_QUERY="TOPIC_NAVBAR_INVALID_QUERY",e.FILTER_MENU_FILTER_CHANGED="FILTER_MENU_FILTER_CHANGED",e.FILTER_MENU_FILTER_SAVE="FILTER_MENU_FILTER_SAVE",e.FILTER_MENU_FILTER_UNDO="FILTER_MENU_FILTER_UNDO",e.FILTER_MENU_SHOW="FILTER_MENU_SHOW",e.FILTER_MENU_HOVERED="FILTER_MENU_HOVERED",e.FILTER_TOGGLE_OPPOSED_SELECTION="FILTER_TOGGLE_OPPOSED_SELECTION",e.FILTER_MENU_KEEP_OPEN="FILTER_MENU_KEEP_OPEN",e.FILTER_MENU_SHOW_FACEBOOK_LOGIN="FILTER_MENU_SHOW_FACEBOOK_LOGIN",e.FILTER_CLOSE_MENUS="FILTER_CLOSE_MENUS",e.FILTER_PERSIST_CHANGES_AND_CLOSE_MENUS="FILTER_PERSIST_CHANGES_AND_CLOSE_MENUS",e.FILTER_MENU_SELECTION_MODE_CHANGE="FILTER_MENU_SELECTION_MODE_CHANGE",e.FILTER_MENU_FILTER_EXPAND_TOGGLED="FILTER_MENU_FILTER_EXPAND_TOGGLED",e.TOPIC_NAVBAR_SAVE_SEARCH="TOPIC_NAVBAR_SAVE_SEARCH",e.TOPIC_NAVBAR_EXPORT="TOPIC_NAVBAR_EXPORT",e.ANCHOR_PREVIEW_NODE_MOVED="ANCHOR_PREVIEW_NODE_ORDERED",e.REACT_DRAGGABLE_DRAG_START="REACT_DRAGGABLE_DRAG_START",e.REACT_DRAGGABLE_DRAG_STOP="REACT_DRAGGABLE_DRAG_STOP",e.GRID_PAGE_ACTIVE_INDEX_CHANGE="GRID_PAGE_ACTIVE_INDEX_CHANGE",e.GRID_PAGE_PAGE_TYPE_CHANGE="GRID_PAGE_PAGE_TYPE_CHANGE",e.GRID_PAGE_ADD="GRID_PAGE_ADD",e.GRID_PAGE_REMOVE="GRID_PAGE_REMOVE",e.GRID_PAGE_UPDATE_LAYOUT="GRID_PAGE_UPDATE_LAYOUT",e.GRID_ITEM_SELECTION_CHANGED="GRID_ITEM_SELECTION_CHANGED",e.TEXT_BOX_SAVE="TEXT_BOX_SAVE",e.TEXT_BOX_FOCUS_CHANGED="TEXT_BOX_FOCUS_CHANGED",e.POPOVER_OPEN="POPOVER_OPEN",e.POPOVER_CLOSE="POPOVER_CLOSE",e.DRILLDOWN_OPEN="DRILLDOWN_OPEN",e.UPDATE_TOOLBAR="UPDATE_TOOLBAR",e.TEXT_ALIGN="TEXT_ALIGN",e.FONT_FAMILY_CHANGED="FONT_FAMILY_CHANGED",e.FONT_SIZE_CHANGED="FONT_SIZE_CHANGED",e.FONT_STYLE_CHANGED="FONT_STYLE_CHANGED",e.FONT_WEIGHT_CHANGED="FONT_WEIGHT_CHANGED",e.COLOR_CHANGED="COLOR_CHANGED",e.DRAG_TOOLBAR_ITEM="DRAG_TOOLBAR_ITEM",e.TOGGLE_RESIZABLE_DISPLAY="TOGGLE_RESIZABLE_DISPLAY",e.INIT_TOOLBAR_ITEM_DRAG_N_DROP="INIT_TOOLBAR_ITEM_DRAG_N_DROP",e.SEND_GRID_DRAGNDROP_INFO="SEND_GRID_DRAGNDROP_INFO",e.TOOLBAR_MOUNTED="TOOLBAR_MOUNTED",e.TOOLBAR_BLOCK_ITEM_SINGLE_SELECT="TOOLBAR_BLOCK_ITEM_SINGLE_SELECT",e.TOOLBAR_DROPDOWN_CLOSE="TOOLBAR_DROPDOWN_CLOSE",e.TOGGLE_EDIT_WIDGET="TOGGLE_EDIT_WIDGET",e.SET_WIDGET_EDIT="SET_WIDGET_EDIT",e.SLICED_DRILLDOWN="SLICED_DRILLDOWN",e.IMAGE_BOX_SAVE="IMAGE_BOX_SAVE",e.IMAGE_BOX_CANCEL="IMAGE_BOX_CANCEL",e.IMAGE_BOX_EDITABLE_CHANGED="IMAGE_BOX_EDITABLE_CHANGED",e.IMAGE_LOADED="IMAGE_LOADED",e.BUBBLE_MODAL="BUBBLE_MODAL",e.COPY_REPORT="COPY_REPORT",e.SEND_REPORT="SEND_REPORT",e.DOWNLOAD_REPORT="DOWNLOAD_REPORT",e.DELETE_REPORT="DELETE_REPORT",e.IMAGE_SELECTOR_LIST_ITEM_CLICKED="IMAGE_SELECTOR_LIST_ITEM_CLICKED",e.IMAGE_SELECTOR_LIST_ITEM_SELECTED="IMAGE_SELECTOR_LIST_ITEM_SELECTED",e.IMAGE_SELECTOR_LIST_UPDATE="IMAGE_SELECTOR_LIST_UPDATE",e.VIDEO_BOX_SAVE="VIDEO_BOX_SAVE",e.VIDEO_BOX_EDITABLE_CHANGED="VIDEO_BOX_EDITABLE_CHANGED",e.DROPDOWN_OPEN="DROPDOWN_OPEN",e.DROPDOWN_CLOSE="DROPDOWN_CLOSE",e.DROPDOWN_CLICK="DROPDOWN_CLICK",e.BLOCK_THEME="BLOCK_THEME",e.DELETE_THEME="DELETE_THEME",e.SHOW_THEME="SHOW_THEME",e.SHOW_ALL_THEMES="SHOW_ALL_THEMES",e.TAB_CHANGE_SELECTION="TAB_CHANGE_SELECTION",e.CLOUD_POPOVER_OPEN="CLOUD_POPOVER_OPEN",e.DETAILS_OPEN="DETAILS_OPEN",e.QUICKSEARCH_DELETE_SAVED_ITEM="QUICKSEARCH_DELETE_SAVED_ITEM",e.QUICKSEARCH_MENU_OPEN="QUICKSEARCH_MENU_OPEN",e.GO_TO_TRIAL="GO_TO_TRIAL",e.CANCEL_ALL_REFRESH_JOBS="CANCEL_ALL_REFRESH_JOBS",e.CODEMIRROR_FOCUS="CODEMIRROR_FOCUS",e.LINE_CHART_SHOW_DETAILS="LINE_CHART_SHOW_DETAILS",e.WIDGET_DONE_DRAWING="WIDGET_DONE_DRAWING",e.GRID_UPDATE_PREVIEW="GRID_UPDATE_PREVIEW",e.GRID_REPORT_COPY_WIDGET="GRID_REPORT_COPY_WIDGET",e.OL_DOT_DENSITY_DOT_HOVERED="OL_DOT_DENSITY_DOT_HOVERED",e.ON_CONTEXT_SWITCH="ON_CONTEXT_SWITCH",e.ON_DRAG_STOP_INFLUENCER="ON_DRAG_STOP_INFLUENCER",e.CREATE_INFLUENCER_MGMT_LIST="CREATE_INFLUENCER_MGMT_LIST",e.RELOAD_INFLUENCERS_LISTS="RELOAD_INFLUENCERS_LISTS",e.REDRAW_INFLUENCERS_LISTS="REDRAW_INFLUENCERS_LISTS",e.CLEAR_WIDGET_MENU_CACHE="CLEAR_WIDGET_MENU_CACHE",e.ON_DRAG_STOP_INFLUENCERS_LIST="ON_DRAG_STOP_INFLUENCERS_LIST",e.UPDATE_DROPDOWN_MENU_ENTRY="UPDATE_DROPDOWN_MENU_ENTRY",e.UPDATE_TOPIC_MENU_SELECT_DROPDOWN="UPDATE_TOPIC_MENU_SELECT_DROPDOWN",e.ITEM_POOL_DISCARD_OLD="ITEM_POOL_DISCARD_OLD",e.WORLD_MAP_RESULTS_CHANGED="WORLD_MAP_RESULTS_CHANGED",e.SHOW_INFLUENCER_LISTS="SHOW_INFLUENCER_LISTS",e.SHOW_WATCHLISTS="SHOW_WATCHLISTS",e.OPEN_MAP_DRILLDOWN="OPEN_MAP_DRILLDOWN",e.GRID_WIDGET_OVERFLOW="GRID_WIDGET_OVERFLOW",e.RESIZE_INFLUENCER_LIST_OVERVIEWS="RESIZE_INFLUENCER_LIST_OVERVIEWS",e.ENTER_INFLUENCER_LIST="ENTER_INFLUENCER_LIST",e.DELETE_INFLUENCER_LIST="DELETE_INFLUENCER_LIST",e.EDIT_INFLUENCER_LIST="EDIT_INFLUENCER_LIST",e.SHOW_INFLUENCER_CAMPAIGNS="SHOW_INFLUENCER_CAMPAIGNS",e.SHOW_INFLUENCER_DETAILED="SHOW_INFLUENCER_DETAILED",e.ADD_NEW_TAG_TO_AI_MODEL="ADD_NEW_TAG_TO_AI_MODEL",e.ENTER_CAMPAIGN="ENTER_CAMPAIGN",e.EDIT_CAMPAIGN="EDIT_CAMPAIGN",e.DELETE_CAMPAIGN="DELETE_CAMPAIGN",e.SHOW_AI_RULE_CATEGORIES="SHOW_AI_RULE_CATEGORIES",e.BLOCK_BASED_WIDGET_SHOULD_UPDATE="BLOCK_BASED_WIDGET_SHOULD_UPDATE",e.SINGLE_ARTICLE_TO_UPDATE="SINGLE_ARTICLE_TO_UPDATE",e.TRIGGER_GRID_EXPANSION="TRIGGER_GRID_EXPANSION",e.OPEN_ADD_INFLUENCERS_TO_CAMPAIGN_DIALOG="OPEN_ADD_INFLUENCERS_TO_CAMPAIGN_DIALOG",e.INFLUENCER_WAS_ADDED_TO_CAMPAIGN="INFLUENCER_WAS_ADDED_TO_CAMPAIGN",e.CATEGORY_ADDED_IN_AI_TRAINING="CATEGORY_ADDED_IN_AI_TRAINING",e.ON_REMOVE_INFLUENCER_FROM_LIST="ON_REMOVE_INFLUENCER_FROM_LIST",e.ADDING_CATEGORY_IN_AI_TRAINING="ADDING_CATEGORY_IN_AI_TRAINING",e.ADDED_NEW_TAG="ADDED_NEW_TAG",e.SINGLE_GROUP_SELECTED_ENTRY="SINGLE_GROUP_SELECTED_ENTRY",e.UPDATE_SIDE_BAR="UPDATE_SIDE_BAR",e.GLOBAL_LEGEND_MOUSEENTER="GLOBAL_LEGEND_MOUSEENTER",e.GLOBAL_LEGEND_MOUSELEAVE="GLOBAL_LEGEND_MOUSELEAVE",e.GLOBAL_LEGEND_MOUSECLICK="GLOBAL_LEGEND_MOUSECLICK",e.GLOBAL_WIDGET_MOUSEENTER="GLOBAL_WIDGET_MOUSEENTER",e.GLOBAL_WIDGET_MOUSELEAVE="GLOBAL_WIDGET_MOUSELEAVE",e.TOGGLE_BLOCK_INFLUENCER_SELECTION="TOGGLE_BLOCK_INFLUENCER_SELECTION",e.SELECT_ALL_BLOCK_INFLUENCERS="SELECT_ALL_BLOCK_INFLUENCERS",e.UNSELECT_ALL_BLOCK_INFLUENCERS="UNSELECT_ALL_BLOCK_INFLUENCERS",e.SHOW_COMMENT_PREVIEWS="SHOW_COMMENT_PREVIEWS",e.CLEAR_COMMENT_PREVIEWS="CLEAR_COMMENT_PREVIEWS",e.LINE_CHART_COMMENT_CLICK="LINE_CHART_COMMENT_CLICK",e.LINE_CHART_COMMENT_ADD="LINE_CHART_COMMENT_ADD",e.LINE_CHART_COMMENT_EDIT="LINE_CHART_COMMENT_EDIT",e.LINE_CHART_COMMENT_PIN="LINE_CHART_COMMENT_PIN",e.LINE_CHART_COMMENT_UNPIN="LINE_CHART_COMMENT_UNPIN",e.LINE_CHART_COMMENT_REMOVE="LINE_CHART_COMMENT_REMOVE",e.SHOW_COMMENT_MARKERS="SHOW_COMMENT_MARKERS",e.CLEAR_COMMENT_MARKERS="CLEAR_COMMENT_MARKERS",e.TOGGLE_UNIT_SELECTION="TOGGLE_UNIT_SELECTION",e.ISSUE_WAS_ADDED_TO_WATCHLIST="ISSUE_WAS_ADDED_TO_WATCHLIST",e.TOGGLE_BLOCK_ISSUE_SELECTION="TOGGLE_BLOCK_ISSUE_SELECTION",e.SHOW_ISSUE_DETAILED="SHOW_ISSUE_DETAILED",e.IGNORE_NEXT_POPOVER_CLOSE="IGNORE_NEXT_POPOVER_CLOSE",e.TOGGLE_ALL_SELECTION="TOGGLE_ALL_SELECTION",e.ADD_TO_CAMPAIGN_BUBBLE_CLOSED="ADD_TO_CAMPAIGN_BUBBLE_CLOSED",e.GRID_CELLS_ADDED="GRID_CELLS_ADDED",e.GRID_CELLS_REMOVED="GRID_CELLS_REMOVED",e.CROP_IMAGE="CROP_IMAGE",e.IMAGE_WAS_CROPPED="IMAGE_WAS_CROPPED",e.WATCHLIST_ITEM_ADDED="WATCHLIST_ITEM_ADDED",e.INFLUENCER_SEARCH_MODE_SHOULD_SWITCH="INFLUENCER_SEARCH_MODE_SHOULD_SWITCH",e.RESTFORM_POST_MENU_STRATEGY_CLICK="RESTFORM_POST_MENU_STRATEGY_CLICK",e.ALL_COMMENT_BUBBLES_READY="ALL_COMMENT_BUBBLES_READY",e.QUICK_UPLOAD_SUBMIT="QUICK_UPLOAD_SUBMIT",e.CONTACT_ITEM_CHANGED="CONTACT_ITEM_CHANGED",e.CONTACT_ITEM_SAVE="CONTACT_ITEM_SAVE",e.CONTACT_ITEM_EDIT="CONTACT_ITEM_EDIT",e.CONTACT_ITEM_DELETE="CONTACT_ITEM_DELETE",e.CONTACT_ITEM_ADD_NEW_FIELD="CONTACT_ITEM_ADD_NEW_FIELD",e.SEARCH_BAR_SUBMIT="SEARCH_BAR_SUBMIT",e.DISABLE_BLOCK_INFLUENCERS_KEYBINDS="DISABLE_BLOCK_INFLUENCERS_KEYBINDS",e.ENABLE_BLOCK_INFLUENCERS_KEYBINDS="ENABLE_BLOCK_INFLUENCERS_KEYBINDS",e.CLICK_ACTION_TRIGGERED="CLICK_ACTION_TRIGGERED",e.DATA_TABLE_RELOAD_REQUESTED="DATA_TABLE_RELOAD_REQUESTED",e.SHOW_SENTIMENT_POPUP="SHOW_SENTIMENT_POPUP",e.HIDE_SENTIMENT_POPUP="HIDE_SENTIMENT_POPUP",e.FILTER_STATE_CHANGE="FILTER_STATE_CHANGE",e.CUSTOM_FIELD_CREATED="CUSTOM_FIELD_CREATED",e.PROPAGATE_QUERY_BUILDER_VALIDITY="PROPAGATE_QUERY_BUILDER_VALIDITY",e.QUERY_BUILDER_PROPAGATE_DIRTY_STATE="QUERY_BUILDER_PROPAGATE_DIRTY_STATE",e.ADD_FILTER_MENU_FROM_OTHER_SRC="ADD_FILTER_MENU_FROM_OTHER_SRC",e.SHOULD_UPDATE_SAVED_INFLUENCER_SEARCHES="SHOULD_UPDATE_SAVED_INFLUENCER_SEARCHES",e.UPDATE_LOADED_INFLUENCER_SEARCH="UPDATE_LOADED_INFLUENCER_SEARCH",e.INFLUENCER_SEARCH_SELECTED="INFLUENCER_SEARCH_SELECTED",e.INFLUENCER_SEARCH_REMOVED="INFLUENCER_SEARCH_REMOVED",e.OPEN_EDIT_ITEM="OPEN_EDIT_ITEM",e.POST_CALL_RESTFORM_CLICK_ACTION="POST_CALL_RESTFORM_CLICK_ACTION",e.GET_CALL_RESTFORM_CLICK_ACTION="GET_CALL_RESTFORM_CLICK_ACTION",e.DELETE_CALL_RESTFORM_CLICK_ACTION="DELETE_CALL_RESTFORM_CLICK_ACTION",e.FILTER_MENU_PIN_TOGGLED="FILTER_MENU_PIN_TOGGLED",e.PAGE_STATE_BEFORE_MERGE="PAGE_STATE_BEFORE_MERGE",e.ROLLOVER_SHOULD_CLOSE="ROLLOVER_SHOULD_CLOSE",e.CREATE_NOTE_FROM_NOTES_FEED="CREATE_NOTE_FROM_NOTES_FEED",e.SAVE_NOTE_FROM_NOTES_FEED="SAVE_NOTE_FROM_NOTES_FEED",e.DELETE_NOTE_FROM_NOTES_FEED="DELETE_NOTE_FROM_NOTES_FEED",e.SAVE_SELECTED_INFLUENCERS_TO_LIST="SAVE_SELECTED_INFLUENCERS_TO_LIST",e.SHOW_CANVAS_CUTOFF_MESSAGE="SHOW_CANVAS_CUTOFF_MESSAGE",e.HIDE_CANVAS_CUTOFF_MESSAGE="HIDE_CANVAS_CUTOFF_MESSAGE",e.CODEMIRROR_INITIALIZED="CODEMIRROR_INITIALIZED",e.QUERY_BUILDER_FOCUS="QUERY_BUILDER_FOCUS",e.REDRAW_PREVIEW_NODE="REDRAW_PREVIEW_NODE",e.RESET_QUERY_BUILDER_TO_CLEAN_STATE="RESET_QUERY_BUILDER_TO_CLEAN_STATE",e.UPDATE_QUERY_BUILDER_CLEAN_STATE="UPDATE_QUERY_BUILDER_CLEAN_STATE",e.DOWNLOAD_FILE_ITEM="DOWNLOAD_FILE_ITEM",e.DELETE_FILE_ITEM="DELETE_FILE_ITEM",e.UPDATE_FILE_ITEM="UPDATE_FILE_ITEM",e.REMOVE_TAG="REMOVE_TAG",e.ADD_TAG="ADD_TAG",e.ARTICLE_ON_CONTEXT_MENU_OPEN="article_onContextMenuOpen",e.ARTICLE_ON_CONTEXT_MENU_CLOSE="article_onContextMenuClose",e.CUSTOM_SCORE_CREATED="CUSTOM_SCORE_CREATED",e.INDICATOR_VARIABLE_CREATED="INDICATOR_VARIABLE_CREATED",e.SHOW_VIDEO_PLAYER="SHOW_VIDEO_PLAYER",e.SET_VIDEO_PLAYER_TO_TIMESTAMP="SET_VIDEO_PLAYER_TO_TIMESTAMP",e.SHOW_COLOR_EDIT_BUBBLE="SHOW_COLOR_EDIT_BUBBLE",e.COLOR_EDIT_BUBBLE_CLOSE="COLOR_EDIT_BUBBLE_CLOSE"}(t.EVENT_TYPES||(t.EVENT_TYPES={}))}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ALERT="alert",e.MAIL_ERROR="mail_error"}(t.BUBBLE_MODAL_TYPE||(t.BUBBLE_MODAL_TYPE={}))}),define("bus",["require","exports","xstream","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={name:"EVENT_BUS",style:"color: gray; font-weight bold;"};class r{constructor(){this.updater={listener:void 0,addedSubCounts:{},addedSubs:[],dispatch(e){this.addedSubs.includes(e.type)&&this.listener(e)}},this.internalStream=i.Stream.create({start:e=>{this.updater.listener=(t=>{e.next(t)})},stop:()=>{this.updater.listener=void 0}}),this.internalStream.addListener(r.createListener(()=>{}))}get stream(){return this.internalStream}dispatch(e){const{type:t}=e;if(void 0===t)throw new Error("Event type is undefined!");return this.updater.dispatch(e),s.logService.verbose(`Dispatched ${e.type}`,n,e),this}subscribeToMany(e,t){const i=e.map(e=>this.subscribe(e,t));return{unsubscribe:()=>i.forEach(e=>e.unsubscribe())}}removeFromSubCount(e){this.updater.addedSubs.includes(e)||(this.updater.addedSubs.push(e),this.updater.addedSubCounts[e]-=1,this.updater.addedSubCounts[e]<=0&&(delete this.updater.addedSubCounts[e],this.updater.addedSubs.splice(this.updater.addedSubs.indexOf(e),1)))}addToSubCount(e){this.updater.addedSubs.includes(e)?this.updater.addedSubCounts[e]++:(this.updater.addedSubCounts[e]=1,this.updater.addedSubs.push(e))}subscribe(e,t){if(void 0===e)throw new Error("Event type is undefined!");const i=this.stream.filter(t=>t.type===e),s=r.createListener(t),n=i.subscribe(s);return this.addToSubCount(e),{unsubscribe:()=>{this.removeFromSubCount(e),n.unsubscribe()}}}subscribeOnce(e,t){if(void 0===e)throw new Error("Event type is undefined!");const i=this.stream.filter(t=>t.type===e);let s;const n=r.createListener(i=>{t(i),this.removeFromSubCount(e),s.unsubscribe()});return s=i.subscribe(n),this.addToSubCount(e),{unsubscribe:()=>{this.removeFromSubCount(e),s.unsubscribe()}}}static createListener(e,t){return{next:t=>{try{e(t)}catch(e){s.logService.error(e)}},error:e=>{if(void 0===t)throw e;t(e)},complete:()=>{}}}}t.EventBus=r,t.eventBus=new r}),define("event_bus",["require","exports","bus","event_types","interfaces"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("models/external_trend_table_entry_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/top_elements_table_model_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/external_trend_table_model",["require","exports"],function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RANK="Rank",e.DESCRIPTION="Description",e.PICTURE="Picture",e.TRAFFIC="Traffic",e.URL="Url"}(i||(i={}));t.ExternalTrendTableModel=class{constructor(e,t){this.country=t||"",this.entries=[],this.trendsFetchTime=e.hasTrendsFetchTime()?e.getTrendsFetchTime():"",e.getRows().forEach(e=>{const t={};e.getCells().forEach(e=>{t[e.getColumn().getCode()]=e.getCell().value.value});const s=t[i.TRAFFIC]?t[i.TRAFFIC].replace(/[,\.\+]/g,""):"";this.entries.push({rank:parseInt(t[i.RANK]),title:e.getLabel(),description:t[i.DESCRIPTION],value:s?parseInt(s):0,picture:t[i.PICTURE],url:t[i.URL]})})}getCountry(){return this.country}getEntries(){return this.entries}getTrendsFetchTime(){return this.trendsFetchTime}}}),define("widget_essentials/external_trend_table_fragment_build_configuration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("widget_essentials/external_trend_table_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/top_elements_table_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/external_trend_table",["require","exports","flux"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ExternalTrendTable=class extends i.BaseComponent{}}),define("widget_essentials/external_trend_table_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ExternalTrendTableColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){switch(this.themeId){case 2:return this.buildDarkColorPalette();case 3:return this.buildNavyColorPalette();default:return this.buildLightColorPalette()}}buildLightColorPalette(){return{primaryTextColor:new i.Color("#000000"),secondaryTextColor:new i.Color("#9a9a9a"),enumeratorColor:new i.Color("#979797"),alternateRowColor:new i.Color("#f2f3f4"),googleTrendsLogo:"/app/assets/images/google_trends_color.png"}}buildDarkColorPalette(){return{primaryTextColor:new i.Color("#FFFFFF"),secondaryTextColor:new i.Color("#dddddd"),enumeratorColor:new i.Color("#979797"),alternateRowColor:new i.Color("#555555"),googleTrendsLogo:"/app/assets/images/google_trends_light.png"}}buildNavyColorPalette(){return{primaryTextColor:new i.Color("#FFFFFF"),secondaryTextColor:new i.Color("#dddddd"),enumeratorColor:new i.Color("#979797"),alternateRowColor:new i.Color("#33465e"),googleTrendsLogo:"/app/assets/images/google_trends_light.png"}}}}),define("renderables/google_trend_table",["require","exports","react","renderables/external_trend_table"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=550,r=600,o=700;t.GoogleTrendTable=class extends s.ExternalTrendTable{render(){const e={color:this.props.colorPalette.primaryTextColor.toHex6()},t={backgroundImage:`url(${this.props.colorPalette.googleTrendsLogo})`},{model:s}=this.props;return this.renderImages=s.getEntries().some(e=>!!e.picture),this.renderValues=s.getEntries().some(e=>!!e.value),i.createElement("div",{className:"tw-external-trend-table google",style:e},i.createElement("div",{className:"external-trend-header"},i.createElement("div",{className:"external-trend-logo",style:t}),i.createElement("div",{className:"external-trend-country"},"- ",this.props.model.getCountry()),this.props.dimensions.width>o?i.createElement("div",{className:"external-trend-info"},s.getTrendsFetchTime()):null),i.createElement("div",null,this.renderTrendList()))}renderTrendList(){return i.createElement("ol",null,this.props.model.getEntries().map(this.renderListEntry.bind(this)))}renderListEntry(e,t){const{buildConfiguration:{messages:s}}=this.props;return i.createElement("li",{key:t,className:"external-trend-item"},i.createElement("div",{className:"external-trend-rank"},t+1),i.createElement("div",{className:"external-trend-label"},i.createElement("div",null,e.title),i.createElement("div",null,e.description?`${s.relatedSearches()}: `:null,i.createElement("b",null,e.description))),this.renderValues&&this.props.dimensions.width>n?i.createElement("div",{className:"external-trend-value"},s.searchCounter(e.value.toLocaleString())):null,this.renderImages&&this.props.dimensions.width>r?i.createElement("div",{className:"external-trend-graph"},e.picture?i.createElement("img",{src:e.picture,style:{width:45,height:45}}):null):null)}}}),define("renderables/twitter_trend_table",["require","exports","react","renderables/external_trend_table"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TwitterTrendTable=class extends s.ExternalTrendTable{render(){const e={color:this.props.colorPalette.primaryTextColor.toHex6()},{buildConfiguration:{messages:t}}=this.props;return i.createElement("div",{className:"tw-external-trend-table twitter",style:e},i.createElement("div",{className:"external-trend-header"},i.createElement("div",{className:"external-trend-logo"},i.createElement("i",{className:"fa fa-twitter"})),i.createElement("div",{className:"external-trend-country"},t.twitterTrends()," - ",this.props.model.getCountry())),i.createElement("div",null,this.renderTrendList()))}renderTrendList(){return i.createElement("ul",null,this.props.model.getEntries().map(this.renderListEntry.bind(this)))}renderListEntry(e,t){const s={};return t%2==0&&(s.backgroundColor=this.props.colorPalette.alternateRowColor.toHex6()),i.createElement("li",{key:t,className:"external-trend-item",style:s},i.createElement("div",{className:"external-trend-label"},e.title),i.createElement("div",{className:"external-trend-value"},e.value?e.value.toLocaleString():null))}}}),define("models/top_elements_table_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopElementsTableModel=class{constructor(e){this.entries=[],e.getRows().forEach(e=>{this.entries.push({title:e.getRow().label,value:e.getCells()[0].getValue()})})}getEntries(){return this.entries}}}),define("renderables/top_elements_table",["require","exports","react","renderables/external_trend_table"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopElementsTable=class extends s.ExternalTrendTable{render(){const e={color:this.props.colorPalette.primaryTextColor.toHex6()};return i.createElement("div",{className:"tw-external-trend-table topList",style:e},i.createElement("div",null,this.renderTrendList()))}renderTrendList(){return i.createElement("ul",null,this.props.model.getEntries().map(this.renderListEntry.bind(this)))}renderListEntry(e,t){const s={};return t%2==0&&(s.backgroundColor=this.props.colorPalette.alternateRowColor.toHex6()),i.createElement("li",{key:t,className:"external-trend-item",style:s},i.createElement("div",{className:"external-trend-rank"},t+1),i.createElement("div",{className:"external-trend-label"},e.title))}}}),define("widget_essentials/external_trend_table_fragment",["require","exports","widget_base","react-dom","react","renderables/google_trend_table","renderables/twitter_trend_table","models/external_trend_table_model","data_structures","talkwalker_constants","models/top_elements_table_model","renderables/top_elements_table"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ExternalTrendTableFragment=class extends i.AbstractReactFragment{constructor(e){if(super(e),this.dataGraph=new l.DataGraphWrapper(e.widget.getDataGraph().payloadDataGraph),e.widget.getConfigurationRenderingUuid()===c.ConfigurationDefaultsEnum.UUID_CONFIG_TOP_ELEMENTS_TABLE)this.tableModel=new d.TopElementsTableModel(this.dataGraph),this.type=e.widget.getDataTypeUuid();else{const t=e.widget.getExtendedConfiguration().getTrendCountriesMenu().getFirstSelectedEntry().getName();this.tableModel=new a.ExternalTrendTableModel(this.dataGraph,t),this.type=e.widget.getDynamicSource().external_data_configuration.data_sources[0].source_type}}renderIntoContainer(e,t,i,a){switch(this.type){case"TWITTER_TRENDS":s.render(n.createElement(o.TwitterTrendTable,{model:this.tableModel,colorPalette:i.style.colorPalette,buildConfiguration:this.fragmentModel.buildConfiguration,dimensions:i.dimensions}),this.chartContainer);break;case"GOOGLE_TRENDS":s.render(n.createElement(r.GoogleTrendTable,{model:this.tableModel,colorPalette:i.style.colorPalette,buildConfiguration:this.fragmentModel.buildConfiguration,dimensions:i.dimensions}),this.chartContainer);break;case"TOP_ELEMENTS_TABLE":s.render(n.createElement(h.TopElementsTable,{model:this.tableModel,colorPalette:i.style.colorPalette,buildConfiguration:this.fragmentModel.buildConfiguration,dimensions:i.dimensions}),this.chartContainer)}}}}),define("external_trend_table",["require","exports","models/external_trend_table_model","renderables/external_trend_table","widget_essentials/external_trend_table_color_palette_builder","widget_essentials/external_trend_table_fragment"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("utils/file_extension_icon_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileExtensionIconUtils=class{static getIcon(e){switch(e){case"csv":return"icon-tw-csv";case"doc":case"docx":return"icon-tw-docx";case"gif":return"icon2-tw-gif";case"mp4":return"icon2-tw-mp4";case"pdf":return"icon-tw-pdf";case"png":return"icon-tw-png";case"pptx":return"icon-tw-pptx";case"xls":return"icon-tw-xls";case"xlsx":return"icon2-tw-export-xlsx";case"xml":return"icon-tw-xml";default:return"fa fa-file-o"}}}}),define("file_extensions",["require","exports","utils/file_extension_icon_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("file_upload_component",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileUpload=class extends i.BaseComponent{constructor(e){super(e),this.nextKey=0,this.state={dataUrl:void 0}}componentDidMount(){void 0!==this.props.clickEvent&&this.cancellationToken.subscribe(this.props.clickEvent,()=>this.handleClick())}render(){const{label:e,mimeFilter:t}=this.props;return s.createElement("div",{ref:this.props.innerRef,onClick:this.clickInputButton.bind(this),className:"form-control",id:void 0!==this.props.id?this.props.id:""},s.createElement("input",{key:this.nextKey++,ref:"input",onChange:e=>this.fileAdded(e),type:"file",accept:t}),s.createElement("button",{type:"button",className:"btn btn-primary centered-absolute"},e))}clickInputButton(e){this.handleClick(e)}handleClick(e){this.props.onClick&&this.props.onClick(e),this.refs.input.click()}fileAdded(e){const t=e.target.files;if(0===t.length)return;if(this.props.blockSvg&&this.hasSvgFile(t))return;const i=new FileReader;i.onload=(e=>{this.setState({dataUrl:e.target.result}),this.props.onLoad({dataUrl:e.target.result,files:t}),this.forceUpdate()}),i.readAsDataURL(t[0])}hasSvgFile(e){for(let t=0;t<e.length;t++){const i=e.item(t);if(i&&-1!==i.type.indexOf("svg"))return!0}return!1}}}),define("interfaces/download_upload_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("download_upload_component",["require","exports","flux","react","file_upload_component"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DownloadUploadComponent=class extends i.BaseComponent{constructor(e){super(e),this.fileUploadId=_.uniqueId("file-upload")}render(){return s.createElement("div",{className:`download-upload-component ${void 0!==this.props.classNames?this.props.classNames:""}`},this.renderDownloadButton(),this.renderUploadButton())}renderDownloadButton(){return this.props.hideDownload?void 0:s.createElement("i",{className:"download-upload-button icon2-tw-download",onClick:this.handleDownloadClick.bind(this)})}handleDownloadClick(e){this.props.downloadClickCallback&&this.props.downloadClickCallback(e)}renderUploadButton(){return this.props.hideUpload?void 0:s.createElement(s.Fragment,null,s.createElement(n.FileUpload,{mimeFilter:this.props.mimeFilter,onLoad:this.onLoad.bind(this),id:this.fileUploadId,label:"downloadupload",blockSvg:!!this.props.blockSvg}),s.createElement("i",{className:"download-upload-button icon2-tw-upload",onClick:this.handleIconClick.bind(this)}))}handleIconClick(){document.getElementById(this.fileUploadId).click()}onLoad(e){this.props.uploadLoadCallback&&this.props.uploadLoadCallback(e)}componentDidMount(){document.getElementById(this.fileUploadId)&&(document.getElementById(this.fileUploadId).style.display="none")}componentDidUpdate(){document.getElementById(this.fileUploadId)&&(document.getElementById(this.fileUploadId).style.display="none")}}}),define("interfaces/icon_instant_upload_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/icon_instant_upload.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createIconInstantUploadStyle=function(e){return{uploadIcon:{cursor:"pointer",color:e.uploadIconColor,"&:hover":{color:e.uploadIconHoverColor}}}}}),define("icon_instant_upload_component",["require","exports","flux","file_upload_component","react","event","css/icon_instant_upload.css","classnames"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconInstantUploadComponent=class extends i.StyledBaseComponent{constructor(e){super(e,o.createIconInstantUploadStyle),this.iconClickEvent=new r.Event,this.cancellationToken.addCleanupFunction(()=>this.iconClickEvent.cancelAll()),this.uploadRef=n.createRef()}render(){const e=a([this.props.icon,this.style.uploadIcon]);return n.createElement("div",null,n.createElement("i",{onClick:this.handleIconClick.bind(this),className:e}),n.createElement(s.FileUpload,{innerRef:this.uploadRef,id:this.props.id,mimeFilter:this.props.mimeFilter,blockSvg:this.props.blockSvg,onLoad:this.props.onLoad.bind(this),clickEvent:this.iconClickEvent}))}componentDidMount(){this.uploadRef.current.style.display="none"}handleIconClick(){this.iconClickEvent.fire()}}}),define("interfaces/quick_upload_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/quick_upload_component_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/quick_upload_submit_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("quick_upload_component",["require","exports","flux","react","event_bus","file_upload_component","event"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickUploadComponent=class extends i.BaseComponent{constructor(e){super(e),this.fileUploadId=_.uniqueId("file-upload"),this.iconClickEvent=new o.Event,this.cancellationToken.addCleanupFunction(()=>this.iconClickEvent.cancelAll()),this.state={file:""}}render(){return s.createElement("div",{ref:"root",className:"quick-upload-container"},this.renderUploadIcon(),this.renderUploadField(),this.renderInputMessage(),this.renderUrlInput(),this.renderErrorChecker())}renderUploadIcon(){return s.createElement("i",{className:"fa fa-upload file-upload-icon","aria-hidden":"true",onClick:this.handleIconClick.bind(this),onMouseEnter:e=>{this.openTooltip(e,this.props.uploadButtonTooltipMessage)},onMouseLeave:this.closeTooltip.bind(this)})}renderUploadField(){return s.createElement(r.FileUpload,{mimeFilter:"image/*",label:"test",onLoad:this.onLoad.bind(this),id:this.fileUploadId,blockSvg:!0,clickEvent:this.iconClickEvent})}handleIconClick(){this.iconClickEvent.fire()}onLoad(e){this.setState({file:e.dataUrl})}openTooltip(e,t){void 0!==t&&n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}renderInputMessage(){return s.createElement("div",null,this.props.textInputLabelMessage)}renderUrlInput(){return s.createElement("input",{value:(this.state.file||"").substring(0,1024),onChange:this.handleURLChange.bind(this),className:"url-input"})}handleURLChange(e){this.setState({file:e.target.value})}renderErrorChecker(){return s.createElement("img",{src:this.state.file,style:{display:"none"},onLoad:()=>{this.state.file&&n.eventBus.dispatch({type:n.EVENT_TYPES.QUICK_UPLOAD_SUBMIT,value:{id:this.props.id,image:this.state.file}})}})}componentDidMount(){$(this.refs.root).find(`#${this.fileUploadId}`).css({display:"none"})}componentWillUnmount(){this.closeTooltip()}}}),define("file_upload",["require","exports","download_upload_component","file_upload_component","icon_instant_upload_component","quick_upload_component"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("interfaces/file_item_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/file_item.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFileItemStyle=function(e){return{root:{display:"flex",flexDirection:"column",alignItems:"center",padding:"5px 10px",backgroundColor:e.backgroundColor,fontSize:14,"&:hover $hiddenIcon":{display:"inline-block"},"&:not(:first-child)":{marginTop:10},"&:not(:last-child)":{marginBottom:10}},fileExtensionIcon:{fontSize:"2em"},mainContent:{display:"flex",width:"100%",alignItems:"center"},metadata:{width:"100%",fontSize:"0.85em"},label:{marginRight:10,marginLeft:10},actionIcons:{marginLeft:"auto"},clickableIcon:{cursor:"pointer",marginRight:2,marginLeft:2},hiddenIcon:{display:"none"},editSection:{display:"flex",flexDirection:"column",width:"100%",marginTop:25},inputField:{paddingTop:2,paddingRight:12,paddingBottom:2,paddingLeft:12,marginBottom:10,border:`1px solid ${e.borderColor}`,"&:focus":{borderColor:e.borderFocusColor,outline:0},"&::-webkit-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&::-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-ms-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor}},textareaField:{paddingRight:12,paddingLeft:12,marginBottom:10,border:`1px solid ${e.borderColor}`,"&:focus":{borderColor:e.borderFocusColor,outline:0},"&::-webkit-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&::-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-ms-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor}}}}}),define("interfaces/file_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/update_file_item_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/files_list_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/file_item_component",["require","exports","react","flux","css/file_item.css","event_bus","classnames"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileItemComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createFileItemStyle),this.state={editMode:!1,editedTitle:"",editedDescription:""}}render(){return i.createElement("div",{className:this.style.root},i.createElement("div",{className:this.style.mainContent},this.renderIcon(),this.renderLabel(),this.renderActionIcons()),i.createElement("div",{className:this.style.metadata},this.renderFileName()),this.renderEditSection())}renderIcon(){const e=o([this.props.item.icon,this.style.fileExtensionIcon]);return i.createElement("i",{className:e})}renderLabel(){return i.createElement("div",{className:this.style.label},i.createElement("div",null,this.props.item.label),i.createElement("div",null,this.props.item.description))}renderActionIcons(){return i.createElement("div",{className:this.style.actionIcons},this.renderEditIcon(),this.renderDeleteIcon(),this.renderDownloadIcon())}renderFileName(){return i.createElement("div",null,this.props.item.fileName)}renderEditIcon(){if(this.state.editMode){const e=o(["fa fa-floppy-o",this.style.clickableIcon]);return i.createElement("i",{onClick:this.triggerUpdate.bind(this),className:e})}{const e=o(["fa fa-pencil",this.style.clickableIcon,this.style.hiddenIcon]);return i.createElement("i",{onClick:this.enterEditMode.bind(this),className:e})}}renderDeleteIcon(){if(this.props.item.deletable){const e=o(["icon-tw-trash-bin",this.style.clickableIcon,this.style.hiddenIcon]);return i.createElement("i",{onClick:this.triggerDelete.bind(this),className:e})}return null}renderDownloadIcon(){const e=o(["fa fa-download",this.style.clickableIcon]);return i.createElement("i",{onClick:this.triggerDownload.bind(this),className:e})}renderEditSection(){return this.state.editMode?i.createElement("div",{className:this.style.editSection},i.createElement("input",{placeholder:this.props.messages.fileTitlePlaceholder,value:this.state.editedTitle,onChange:this.onTitleChange.bind(this),className:this.style.inputField}),i.createElement("textarea",{placeholder:this.props.messages.fileDescriptionPlaceholder,value:this.state.editedDescription,onChange:this.onDescriptionChange.bind(this),className:this.style.textareaField})):null}triggerDelete(e){r.eventBus.dispatch({type:r.EVENT_TYPES.DELETE_FILE_ITEM,value:this.props.item})}triggerDownload(e){r.eventBus.dispatch({type:r.EVENT_TYPES.DOWNLOAD_FILE_ITEM,value:this.props.item})}enterEditMode(e){this.setState({editMode:!0,editedTitle:this.props.item.label,editedDescription:this.props.item.description})}onTitleChange(e){this.setState({editedTitle:e.target.value})}onDescriptionChange(e){this.setState({editedDescription:e.target.value})}triggerUpdate(e){const t={id:this.props.item.id,newTitle:this.state.editedTitle,newDescription:this.state.editedDescription};r.eventBus.dispatch({type:r.EVENT_TYPES.UPDATE_FILE_ITEM,value:t}),this.setState({editMode:!1,editedTitle:"",editedDescription:""})}}}),define("interfaces/files_list_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/files_list.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFilesListStyle=function(e){return{}}}),define("components/files_list_component",["require","exports","react","flux","css/files_list.css","components/file_item_component"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilesListComponent=class extends s.StyledBaseComponent{constructor(e){super(e,n.createFilesListStyle)}render(){return i.createElement("div",null,this.renderItems())}renderItems(){return i.createElement(i.Fragment,null,this.props.items.map(e=>this.renderItem(e)))}renderItem(e){return i.createElement(r.FileItemComponent,{key:e.id,item:e,theme:this.props.theme.defaultItemTheme,messages:this.props.messages})}}}),define("files_list_component",["require","exports","components/file_item_component","components/files_list_component"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("components/filter_form/action_button",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/filter_form/data/filter_input",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/filter_form/data/menu_adapter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={shouldInvertFilters:!1,showSelectedFilters:!0,showTopResults:!0,showSearchBar:!0,entries:{}};t.MenuAdapter=class{constructor(e){this.data=e}getData(){return this.data}createMenuConfig(e){return Object.assign({},i,e)}}}),define("components/filter_form/renderable/menu/hoverable_filter_menu",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HoverableFilterMenuRenderable=class extends i.BaseComponent{constructor(){super(...arguments),this.baseStyle={display:"flex",alignItems:"center",padding:"0.45em 0.66em"}}render(){const{styleCondition:e,onClick:t,onMouseEnter:i,onMouseLeave:r}=this.props,o=n({hoverable:!0,"menu-open":e});return s.createElement("div",{className:o,onClick:t,onMouseEnter:i,onMouseLeave:r},this.renderContent())}renderContent(){const{styleCondition:e,children:t}=this.props;return s.createElement("div",{style:this.getStyle(e)},s.createElement("div",{className:"filter-menu-btn-container"},t),s.createElement("div",{className:"fa fa-caret-down filter-caret-down"}))}getStyle(e){return e?Object.assign({},this.baseStyle,{backgroundColor:this.props.color,backgroundRepeat:"no-repeat",color:"white",alignItems:"center",borderRadius:"5px"}):this.baseStyle}}}),define("components/filter_form/renderable/form/clear_selected_filters_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultClearSelectedFiltersStyle={normal:{},hovered:{}};t.ClearSelectedFiltersRenderable=class extends s.BaseComponent{render(){const{isHovered:e,clearSelectionHandler:t,style:i={normal:{},hovered:{}}}=this.props;return n.createElement("div",{className:this.getButtonClass(e),style:this.getButtonStyle(e,i),onClick:t},n.createElement("span",{className:"filter-menu-clear-btn-label clickable"},this.props.children))}getButtonClass(e){return i({"filter-menu-clear-btn clickable":!0,"icon-tw-cross clickable":e})}getButtonStyle(e,i){return e?Object.assign({},t.defaultClearSelectedFiltersStyle.hovered,i.hovered):Object.assign({},t.defaultClearSelectedFiltersStyle.normal,i.normal)}}}),define("components/filter_form/renderable/form/no_filters_selected_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NoFiltersSelectedRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{id:"no-filters-selected-msg-outer-div",key:"no-filters-selected-msg-outer-div-"+this.props.uniqueKeyAddendum},s.createElement("div",{id:"no-filters-selected-msg-inner-div"},this.props.msgNoFiltersSelected),this.props.children)}}}),define("components/filter_form/renderable/form/filter_renderable",["require","exports","react","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterRenderable=class extends i.Component{constructor(){super(...arguments),this.key=s.uniqueId("filter-")}render(){const{cssClass:e="",onClick:t,children:s}=this.props;return i.createElement("div",{key:this.key,className:e,onClick:()=>t()},s)}}}),define("components/filter_form/renderable/form/filter_search_suggestions_renderable",["require","exports","react"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterSearchSuggestionsRenderable=class extends i.Component{render(){const{children:e,msgNoSearchResults:t,msgSearchResults:s}=this.props,n=i.Children.count(e)?e:i.createElement("span",null,t);return i.createElement("div",{className:"div-filter-search-field"},i.createElement("div",{className:"separator-msg-container"},i.createElement("span",{className:"title"},s),i.createElement("div",{className:"line-container"},i.createElement("span",{className:"line"}))),i.createElement("div",{className:"filter-group-wrapper"},n))}}}),define("components/filter_form/renderable/form/search_input_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SearchInputRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state={focused:!1}}render(){const{uniqueKeyAddendum:e,onInputChange:t,onInputKeyDown:s,onFocus:r,onBlur:o,searchInput:a,msgSearchPlaceholder:l}=this.props,{focused:c}=this.state,d=i({"search-div":!0,disabled:!c});return n.createElement("div",{className:d,key:"search-div-"+e},n.createElement("div",{className:"search-icon-container"},n.createElement("i",{className:"icon-tw-search search-icon",key:"search-icon-"+e,onClick:this.focusInput.bind(this)})),n.createElement("div",{className:"search-input-container"},n.createElement("input",{key:"search-input-"+e,ref:e=>this.inputRef=e,type:"text",className:"filter-search-input",placeholder:c?"":l,onChange:t,onKeyDown:s,value:a,onFocus:()=>r(this),onBlur:()=>o(this)})))}focusInput(){this.inputRef.focus()}}}),define("components/filter_form/renderable/form/filter_name_wrapper_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterNameWrapperRenderable=class extends i.BaseComponent{render(){return s.createElement("span",{key:"filter-name-span-"+this.props.uniqueKeyAddendum,style:this.getStyle(this.props.backgroundColor),className:this.props.classNames},this.props.children)}getStyle(e){return{backgroundColor:e,display:"flex"}}}}),define("components/filter_form/renderable/form/search_result_filter_name_renderable",["require","exports","flux","react","components/filter_form/renderable/form/filter_name_wrapper_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SearchResultFilterNameRenderable=class extends i.BaseComponent{render(){const{name:e,searchInput:t,bgColor:i,uniqueKeyAddendum:r,color:o,wrapperClass:a}=this.props,l=t.length,c=e.length;let d=e.toLowerCase().indexOf(t.toLowerCase());const h=(d=-1===d?e.length:d)+l;return s.createElement(n.FilterNameWrapperRenderable,{backgroundColor:i||"transparent",uniqueKeyAddendum:r,classNames:a},s.createElement("span",{style:o&&{color:"black"},key:"filter-name-pre-search-span-"+r},e.substr(0,d)),s.createElement("span",{key:"filter-name-search-span-"+r,style:o&&{color:o,fontWeight:"bold"}},e.substr(d,l)),s.createElement("span",{style:o&&{color:"black"},key:"filter-name-post-search-span-"+r},e.substr(h,c-h)))}}}),define("components/filter_form/renderable/form/selected_filters_placeholder_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SelectedFiltersPlaceholderRenderable=class extends i.BaseComponent{render(){return s.createElement("span",{key:"selected-filters-placeholder",style:{color:this.props.color},className:"selected-filters-placeholder clickable",onClick:this.props.onClick},this.props.leftMsg(this.props.number))}}}),define("components/filter_form/renderable/form/selected_filter_name_renderable",["require","exports","flux","react","components/filter_form/renderable/form/filter_name_wrapper_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SelectedFilterNameRenderable=class extends i.BaseComponent{render(){const{color:e,uniqueKeyAddendum:t,wrapperClass:i,name:r}=this.props;return s.createElement(n.FilterNameWrapperRenderable,{key:`selected-filter-name-${t}`,backgroundColor:e,uniqueKeyAddendum:t,classNames:i},this.renderName(r),this.renderCross())}renderName(e){return s.createElement("span",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",flex:"1 1 100%"}},e)}renderCross(){return this.props.showCross?s.createElement("span",{style:{padding:"0 2px 0 5px",fontSize:"10px",flex:"1",minWidth:"16px"}},s.createElement("i",{className:"icon-tw-cross clickable",style:{position:"relative",top:"1px"}})):null}}}),define("components/filter_form/renderable/form/toggleable_filter_renderable",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToggleableFilterRenderable=class extends s.BaseComponent{render(){const e=this.getContainerStyle();return i.createElement("div",{className:this.props.containerClass,style:e,onClick:this.props.onClick},i.createElement("span",{className:"filter-name-label"},this.props.filter.name))}getContainerStyle(){const{filter:e,color:t}=this.props,i={display:"inline-block"};return e.selected&&(i.backgroundColor=t),i}}}),define("components/filter_form/renderable/form/top_results_filter_name_renderable",["require","exports","flux","react","components/filter_form/renderable/form/filter_name_wrapper_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopResultsFilterNameRenderable=class extends i.BaseComponent{render(){return s.createElement(n.FilterNameWrapperRenderable,{backgroundColor:this.props.color,uniqueKeyAddendum:this.props.uniqueKeyAddendum,classNames:this.props.wrapperClass},s.createElement("span",{key:"filter-name-span-"+this.props.uniqueKeyAddendum},this.props.name))}}}),define("components/filter_form/renderable/form/top_results_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopResultsRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{className:"top-results-inner-div"},s.createElement("h2",{className:"top-results-h2"},s.createElement("div",{className:"separator-msg-container"},s.createElement("span",{className:"title"},this.props.msgTopResults),s.createElement("div",{className:"line-container"},s.createElement("span",{className:"line"})))),this.props.children)}}}),define("components/filter_form/renderable/form/filter_form_style",["require","exports","composable_styles","emotion"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formContainerStyle=(e=>i.dynamicStyle((e,t)=>e`
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: auto;
            color: ${t.fontColor};
            color: ${t.fontColor};
            max-height: ${t.maxHeight};
            padding: ${t.padding}px;
            border: 1px solid ${t.borderColor};
            background-color: ${t.backgroundColor};
            width: ${t.width};

            label: formContainerStyle;
        `)(i.composeProps(e,{fontColor:"#333",maxHeight:"475px",width:"275px",padding:8,backgroundColor:"white"}))),t.filterItemLabel=(e=>i.dynamicStyle((e,t)=>e`
            font-size: ${t.fontSize};
            padding: 1px 5px 2px;
            border-radius: 4px;
            display: inline-block;
            overflow: hidden;
            max-width: 100%;

            .filter-name-label {
                display: block;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }

            label: filterItemLabel;
        `)(i.composeProps(e,{fontSize:"12px"}))),t.filterItemSelectedLabel=s.css`
    color: white;
    font-family: RobotoR;
    height: 20px;

    label: filterItemSelectedLabel;
`,t.filterItemParentLabel=s.css`
    text-transform: uppercase;
    font-weight: 600;

    label: filterItemParentLabel;
`}),define("components/filter_form/renderable/form/filter_form_renderable",["require","exports","classnames","event_bus","flux","log","react","reusable_components","underscore","components/filter_form/renderable/form/no_filters_selected_renderable","components/filter_form/renderable/form/filter_renderable","components/filter_form/renderable/form/filter_search_suggestions_renderable","components/filter_form/renderable/form/search_input_renderable","components/filter_form/renderable/form/search_result_filter_name_renderable","components/filter_form/renderable/form/selected_filters_placeholder_renderable","components/filter_form/renderable/form/selected_filter_name_renderable","components/filter_form/renderable/form/toggleable_filter_renderable","components/filter_form/renderable/form/top_results_filter_name_renderable","components/filter_form/renderable/form/top_results_renderable","react-transition-group","components/filter_form/renderable/form/filter_form_style","emotion"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterFormRenderable=class extends n.BaseComponent{constructor(e){super(e),this.MAX_CHILDREN_PER_ROOT=100,this.uniqueKeyAddendum=l.uniqueId(),this.allSearchResultFilterInput=[],this.searchInputPredicate=(e=>{const t=e.name,i=this.state.searchInput;return!!t&&(-1!==t.toUpperCase().indexOf(i.toUpperCase())&&!e.selected)});const t=this.getController(),{getInitialState:i}=t;this.state=i(e)}getConfiguration(){return this.props.menuAttributes.config||{}}componentDidMount(){this.allSearchResultFilterInput.length-1<this.state.arrowSelectedSearchResultIdx&&this.setState({arrowSelectedSearchResultIdx:this.allSearchResultFilterInput.length-1}),0!==this.allSearchResultFilterInput.length&&-1===this.state.arrowSelectedSearchResultIdx&&this.setState({arrowSelectedSearchResultIdx:0}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.FILTER_MENU_HOVERED,e=>{this.refs.input&&e.value.hovered&&this.props.menuAttributes.rootId===e.value.parentId&&setTimeout(()=>{this.refs.input.focus()})})}render(){return o.createElement("div",{key:"filter-new-"+this.uniqueKeyAddendum,className:this.getFormContainerStyle()},this.shouldRenderSelectedFilters()?this.renderSelectedFilters():null,this.renderSearchInput(),this.renderActionButton(),this.renderTopOrSearchResults(),this.renderLoadingIcon(),this.renderFetchedSuggestions())}getFormContainerStyle(){const{container:e=E.formContainerStyle}=this.getMenuConfigStyle();return S.cx("filter-form",e({borderColor:"#d7dbdd",width:this.props.menuAttributes.config.width}))}renderOpposedSelectionToggle(){const e=this.buildSingleSelectionItems(this.props.menuAttributes);return e&&e.length>0?o.createElement(a.SingleSelectionDropdown,{key:"on-off-"+this.uniqueKeyAddendum,items:e}):null}buildSingleSelectionItems(e){const{selectionModes:t,rootId:i}=e;return t.map(e=>{const{id:t,onSelected:n}=e,r=__rest(e,["id","onSelected"]);return Object.assign({},r,{onClick:()=>{s.eventBus.dispatch({type:s.EVENT_TYPES.FILTER_MENU_SELECTION_MODE_CHANGE,value:{parentId:i,mode:t}})}})})}renderSelectedFilters(){const{messages:e,menuAttributes:t}=this.props,i=this.getController(),{config:s}=t,{shouldInvertFilters:n}=s,{msgNoFiltersSelected:r}=e,{uniqueKeyAddendum:a}=this;if(this.noRelevantFiltersSelected())return o.createElement(c.NoFiltersSelectedRenderable,{key:"no-filters-selected-"+a,msgNoFiltersSelected:r,uniqueKeyAddendum:a});const l=this.getSelectedFilters();return o.createElement("div",{id:"selected-filters-outer-div",key:"selected-filters-outer-div-"+a,onMouseLeave:()=>i.toggleShowAllSelecteds(this,!1)},n?this.renderOpposedSelectionToggle():null,this.renderListOfSelectedFilters(l,t,e))}renderListOfSelectedFilters(e,t,i){const s=this.getController(),{numberOfDisplayedSelFilters:n}=s,{config:r}=t,{color:a}=r,{msgMore:l}=i,{showAllSelecteds:c,showAllFilters:d}=this.state;let h=e;return c||(h=e.slice(0,n)),o.createElement(o.Fragment,null,o.createElement(b.TransitionGroup,null,h.map(e=>o.createElement(b.CSSTransition,{key:`filter-${e.mappedId}`,classNames:"selected-filters-fade-in",timeout:{enter:200,exit:1}},this.renderSelectedFilter(e,"label filters-selected-div clickable")))),this.shouldShowPlaceholderRenderable(e,c,n)?o.createElement(g.SelectedFiltersPlaceholderRenderable,{number:e.length-n,leftMsg:e=>l.split("[0]").join(e.toString()),color:a,onClick:()=>s.toggleShowAllSelecteds(this,!d)}):null)}shouldShowPlaceholderRenderable(e,t,i){return!t&&e.length>i}shouldRenderSelectedFilters(){const{showSelectedFilters:e=!0,hideAllNodeFromSelections:t=!1}=this.getConfiguration();if(t){const e=this.getSelectedFilters();return!(1===e.length&&e[0].mappedId===this.props.menuAttributes.allNodeId)}return e}getSelectedFilters(){const{filters:e}=this.props,t=this.getSelectedFiltersOf(e);return t.concat(l.flatten(t.map(e=>this.getSelectedFiltersOf(e.children)))),void 0!==this.props.menuAttributes.config.sortFunction&&t.sort(this.props.menuAttributes.config.sortFunction),l.uniq(t)}getSelectedFiltersOf(e){return e.filter(e=>e.selected&&!this.isDefaultSelection(e)&&!this.isSecondLevelElement(e))}noRelevantFiltersSelected(){return 0===this.getSelectedFilters().length}renderSelectedFilter(e,t){return this.renderFilterWith(o.createElement(m.SelectedFilterNameRenderable,{uniqueKeyAddendum:this.uniqueKeyAddendum,name:e.name,color:this.getConfiguration().color,wrapperClass:this.getFilterItemLabelClass({selected:!0}),showCross:!e.isNotUnselectable}),e,t)}renderSearchResultFilter(e,t){return this.allSearchResultFilterInput.push(e),this.renderFilterWith(o.createElement(p.SearchResultFilterNameRenderable,{uniqueKeyAddendum:this.uniqueKeyAddendum,name:e.name,searchInput:this.state.searchInput,color:this.isSecondLevelElement(e)?null:this.getConfiguration().color,bgColor:this.allSearchResultFilterInput.length-1===this.state.arrowSelectedSearchResultIdx&&"#CCCCCC",wrapperClass:null}),e,t,-1!==t.indexOf("disabled"))}renderTopResultsFilter(e,t){return e.selected?this.renderSelectedFilter(e,t):this.renderFilterWith(o.createElement(f.TopResultsFilterNameRenderable,{uniqueKeyAddendum:this.uniqueKeyAddendum,color:"none",name:e.name,wrapperClass:this.getFilterItemLabelClass({selected:!1})}),e,t)}renderFilterWith(e,t,i,s){const n=this.getController();return o.createElement(d.FilterRenderable,{key:t.mappedId,selected:t.selected,cssClass:i,onClick:s?()=>null:()=>n.filterSelectionHandler(this,t)},e)}renderSearchInput(){const{props:e,uniqueKeyAddendum:t,state:i,allSearchResultFilterInput:s}=this,{messages:n}=e,r=this.getController(),{searchInput:a}=i;return this.getConfiguration().showSearchBar?o.createElement(u.SearchInputRenderable,{key:"search-input-container-"+t,uniqueKeyAddendum:t,searchInput:a,msgSearchPlaceholder:n.msgSearchPlaceholder,onInputChange:e=>r.onSearchInputChangeHandler(this,e),onInputKeyDown:e=>r.onSearchInputKeyDownHandler(this,e,s.length>0?this.allSearchResultFilterInput:this.state.fetchedSuggestions),onBlur:r.onSearchInputBlur,onFocus:r.onSearchInputFocus}):null}renderActionButton(){return void 0!==this.props.actionButton?o.createElement(this.props.actionButton.component,this.props.actionButton.props):null}renderTopOrSearchResults(){if(void 0!==this.state.fetchedSuggestions)return null;{const{messages:e,rootElementToIgnore:t}=this.props,{showTopResults:s}=this.state,n=this.getController(),{showSearchBar:r,separatorLabel:a}=this.getConfiguration(),l=i({"top-results-div stylized-scrollbar":!0}),c=this.getTopResultsFilters();return s?o.createElement("div",{key:"top-results-outer-div-"+this.uniqueKeyAddendum,className:l,ref:e=>n.registerTopResultContainer(this,e)},this.shouldDisplayTopResults(c)&&o.createElement(y.TopResultsRenderable,{key:"top-results-container-"+this.uniqueKeyAddendum,msgTopResults:e.msgTopResults},this.renderTopResults(c)),this.renderDedicatedAllNode(),this.renderSeparator(a||t),this.renderSectionContent()):r?o.createElement(h.FilterSearchSuggestionsRenderable,{key:"search-suggestions-"+this.uniqueKeyAddendum,msgSearchResults:e.msgSearchResults,msgNoSearchResults:e.msgNoSearchResults},this.renderSearchSuggestions()):null}}renderDedicatedAllNode(){const{menuAttributes:e,filters:t,controller:i}=this.props,{allNodeId:s,config:n}=e;if(n.showAllNodeAsDedicatedEntry&&s){r.logService.assertDefined(s);const e=t.find(e=>e.mappedId===s);return r.logService.assertDefined(e),void 0!==n.allNodeLabel&&(e.name=n.allNodeLabel),o.createElement("div",{className:"all-node-container"},o.createElement(_.ToggleableFilterRenderable,{containerClass:this.getFilterItemLabelClass({selected:e.selected}),color:n.color,filter:e,onClick:()=>i.filterSelectionHandler(this,e,!0)}))}return null}renderSeparator(e){const{shouldHideSeparatorLine:t}=this.getConfiguration();return t?null:o.createElement("div",{className:"separator-msg-container"},o.createElement("span",{className:"title"},e),o.createElement("div",{className:"line-container"},o.createElement("span",{className:"line"})))}renderSectionContent(){return o.createElement(a.ExpandableListContainer,{key:"exp-list-cont-"+this.uniqueKeyAddendum,height:343,menuAttributes:this.props.menuAttributes,listItems:this.getExpandableFilters(),useVirtualList:this.props.flatten,style:this.getMenuConfigStyle().expandableList})}shouldDisplayTopResults(e){return e.length>0&&this.getConfiguration().showTopResults}renderSearchSuggestions(){this.allSearchResultFilterInput.length=0;const e=this.props.filters.filter(e=>e.children.length>0).filter(this.searchInputPredicate);return e.concat(this.props.filters.filter(t=>this.hasSearchedChildren(t)&&!e.includes(t)&&!this.isRootElement(t))).map((e,t)=>o.createElement("div",{className:"filter-group",key:"search-group-"+t},this.renderSearchResultFilter(e,this.getFilterGroupElementCSSClassForRoot(e)),e.children.filter(this.searchInputPredicate).filter(e=>!e.selected).map(e=>this.renderSearchResultFilter(e,"clickable filter-group-element"))))}renderLoadingIcon(){return this.state.requestingSuggestions?o.createElement("div",{className:"loading-spinner"},o.createElement("i",{className:"fa fa-spinner fa-spin"})):null}renderFetchedSuggestions(){return void 0!==this.state.fetchedSuggestions?o.createElement("div",null,this.state.fetchedSuggestions.map((e,t)=>this.renderFetchedSuggestion(e,t))):null}renderFetchedSuggestion(e,t){const i=this.getController();return o.createElement(d.FilterRenderable,{key:e.mappedId,selected:e.selected,onClick:()=>i.filterSelectionHandler(this,e)},o.createElement("div",{className:"fetched-suggestion clickable",style:{backgroundColor:t===this.state.arrowSelectedSearchResultIdx&&"#CCCCCC"}},o.createElement("span",{className:"suggestion-type",style:{color:t===this.state.arrowSelectedSearchResultIdx&&"white"}},e.typeLabel),o.createElement("span",{className:"suggestion-name"},o.createElement(p.SearchResultFilterNameRenderable,{uniqueKeyAddendum:this.uniqueKeyAddendum,name:e.name,searchInput:this.state.searchInput,color:this.isSecondLevelElement(e)?null:this.getConfiguration().color,wrapperClass:"suggestion-name-wrapper"}))))}getFilterGroupElementCSSClassForRoot(e){return"filter-group-element ".concat(this.isSecondLevelElement(e)?"disabled-root":"clickable")}getTopResultsFilters(){const e=this.getController(),t=this.props.filters.filter(e=>this.isTopResult(e));return t.sort((e,t)=>t.significance-e.significance),t.slice(0,e.numberOfDisplayedTopResults)}isTopResult(e){return 0!==e.significance&&this.hasName(e)&&!this.isRootElement(e)&&!this.isSecondLevelElement(e)}renderTopResults(e){return e.map(e=>this.renderTopResultsFilter(e,"filter-label clickable"))}hasName(e){return!!e.name}hasSearchedChildren(e){return e.children.filter(this.searchInputPredicate).length>0}isRootElement(e){const{rootElementToIgnore:t}=this.props;return t&&t.toUpperCase()===e.name.toUpperCase()}isSecondLevelElement(e){const{secondLevelElement:t}=this.props;return t.name&&t.name.toUpperCase()===e.name.toUpperCase()}isDefaultSelection(e){const{menuAttributes:t}=this.props,{topicMenu:i}=t;return i.default_mapped_id&&i.default_mapped_id===e.mappedId}filterSelectionHandler(e,t){this.state=Object.assign({},this.state,{searchInput:"",showTopResults:!0}),e.needsToken?"SOCIALMEDIA_FACEBOOK"===e.mappedId&&s.eventBus.dispatch({type:s.EVENT_TYPES.FILTER_MENU_SHOW_FACEBOOK_LOGIN,value:{element:e}}):(e.name!==this.props.secondLevelElement.name||t)&&s.eventBus.dispatch({type:s.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,value:{element:e,parentId:this.props.menuAttributes.rootId,rootEntrySelectable:t}})}getExpandableFilters(){return this.props.filters.filter(e=>!e.parent)[0].children[0].children.map(e=>this.getExpandableFilter(e))}getExpandableFilter(e){const t=this.getController(),{selected:i,isNotSelectable:s,children:n,icon:r,name:o}=e,a=this.getConfiguration().color,l=i?{backgroundColor:a,backgroundRepeat:"no-repeat",color:"white"}:s?{color:"#ABB0B6"}:null,c=Object.assign({},l),d=this.getFilterItemLabelClass({selected:e.selected,isNotSelectable:e.isNotUnselectable,isParent:e.children.length>0||e.showExpandButton});return{id:e.mappedId,label:o,color:a,labelClass:d,leftIconClass:r,labelStyle:l,hoveredLabelStyle:c,labelClick:()=>t.filterSelectionHandler(this,e),expandButtonClick:i=>t.expandButtonHandler(this,e.mappedId,i),showExpandButton:e.showExpandButton,children:n&&n.map(e=>this.getExpandableFilter(e)),selectionNumber:e.selectionNumber}}getFilterItemLabelClass(e){const t=this.getMenuConfigStyle(),{filterItemLabelStyle:i={}}=t,{selected:s=!0,isNotSelectable:n=!1,isParent:r=!1}=e,{itemLabel:o=E.filterItemLabel,parentLabel:a=E.filterItemParentLabel,selectedLabel:l=E.filterItemSelectedLabel}=i;return S.cx(o({fontSize:"13px"}),{clickable:!n},{[l]:s},{[a]:r})}getMenuConfigStyle(){const{entries:e={}}=this.getConfiguration();return e[a.MenuConfigKeys.DEFAULT]&&e[a.MenuConfigKeys.DEFAULT].style||{}}getController(){return this.props.menuAttributes.controller||this.props.controller}}}),define("components/filter_form/controller/filter_form_controller",["require","exports","event_bus","map","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.DISPLAYED_TOP_RESULTS=10,this.MAX_NUMBER_OF_DISPLAYED_SEL_FILTERS=8}getInitialState(e){return{showTopResults:!0,searchInput:"",showAllFilters:!1,hoveredFilters:new s.Map,showAllSelecteds:void 0===e.messages.msgMore,arrowSelectedSearchResultIdx:0}}addSubscriptionsToToken(e,t){}filterSelectionHandler(e,t,i){e.state=Object.assign({},e.state,{searchInput:"",showTopResults:!0}),this.dispatchFilterSelection(e,t,i)}dispatchFilterSelection(e,t,s){t.needsToken?"SOCIALMEDIA_FACEBOOK"===t.mappedId&&i.eventBus.dispatch({type:i.EVENT_TYPES.FILTER_MENU_SHOW_FACEBOOK_LOGIN,value:{element:t}}):(t.name!==e.props.secondLevelElement.name||s)&&i.eventBus.dispatch({type:i.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,value:{element:t,parentId:e.props.menuAttributes.rootId,rootEntrySelectable:s}})}hoverFilterHandler(e,t,i){const s=e.state.hoveredFilters;e.state.hoveredFilters.forEach((e,t)=>{s.set(t,!1)}),s.set(t,i),e.setState({hoveredFilters:s})}expandButtonHandler(e,t,s){i.eventBus.dispatch({type:i.EVENT_TYPES.FILTER_MENU_FILTER_EXPAND_TOGGLED,value:{mappedId:t,parentId:e.props.menuAttributes.rootId}})}registerTopResultContainer(e,t){null!==t&&e.cancellationToken.addDomEvent(t,"mousewheel",e=>{e.stopPropagation()})}onSearchInputChangeHandler(e,t){const i=t.target.value;!i||i.length<r.MINIMUM_CHARS_TO_START_SEARCH?e.setState({showTopResults:!0,searchInput:i}):e.setState({showTopResults:!1,searchInput:i})}onSearchInputKeyDownHandler(e,t,i){if(i){const s=i[e.state.arrowSelectedSearchResultIdx>=0?e.state.arrowSelectedSearchResultIdx:0],r=i.length;switch(t.keyCode){case n.Keys.UP_ARROW:t.stopPropagation(),t.nativeEvent.stopPropagation(),e.state.arrowSelectedSearchResultIdx>0&&e.setState({arrowSelectedSearchResultIdx:e.state.arrowSelectedSearchResultIdx-1});break;case n.Keys.DOWN_ARROW:t.stopPropagation(),t.nativeEvent.stopPropagation(),r-1>e.state.arrowSelectedSearchResultIdx&&e.setState({arrowSelectedSearchResultIdx:e.state.arrowSelectedSearchResultIdx+1});break;case n.Keys.ENTER:t.stopPropagation(),t.nativeEvent.stopPropagation(),this.filterSelectionHandler(e,s)}}}onSearchInputFocus(e){i.eventBus.dispatch({type:i.EVENT_TYPES.ANCHOR_MODEL_KEY_NAVIGATION_ACTIVE,value:{active:!1}}),e.setState({focused:!0})}onSearchInputBlur(e){i.eventBus.dispatch({type:i.EVENT_TYPES.ANCHOR_MODEL_KEY_NAVIGATION_ACTIVE,value:{active:!0}}),e.setState({focused:!1})}toggleShowAllSelecteds(e,t){e.setState({showAllSelecteds:t})}get numberOfDisplayedTopResults(){return this.DISPLAYED_TOP_RESULTS}get numberOfCharsToStartSearch(){return r.MINIMUM_CHARS_TO_START_SEARCH}get numberOfDisplayedSelFilters(){return this.MAX_NUMBER_OF_DISPLAYED_SEL_FILTERS}}r.MINIMUM_CHARS_TO_START_SEARCH=2,r.ENTER_KEY_CODE=13,r.UP_ARROW_KEY_CODE=38,r.DOWN_ARROW_KEY_CODE=40,t.DefaultFilterFormController=r}),define("components/filter_form/data/root_mapped_ids",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SENTIMENT_ROOT_MAPPED_ID="Sentiment"}(t.RootMappedIds||(t.RootMappedIds={}))}),define("components/filter_form/renderable/form/filter_form_sentiments_renderable",["require","exports","react","underscore","components/filter_form/renderable/form/filter_form_renderable","emotion","components/filter_form/renderable/form/filter_form_style"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterFormSentimentsRenderable=class extends n.FilterFormRenderable{constructor(){super(...arguments),this.key=s.uniqueId()}render(){return i.createElement("div",{key:"filters-new-sentiments-"+this.key,className:r.cx("filter-form",o.formContainerStyle({borderColor:"#d7dbdd",backgroundColor:"white"})),style:{width:"auto",padding:"7px",textAlign:"center"}},i.createElement("div",{key:"filters-new-sentiments-inner-div-"+this.key,className:"filters-new-sentiments-inner-div"},this.props.filters.map(e=>this.renderSentimentsContainer(e))))}componentDidUpdate(){}renderSentimentsContainer(e){const{controller:t}=this.props;let s="icon-tw-flag tw-btn-icon-rounded sentiment ";switch(e.mappedId){case"POSITIVE":s+="positive";break;case"NEGATIVE":s+="negative";break;case"NONE":s+="none";break;default:s+="neutral"}const n=e.selected?{border:"1px solid"+this.getConfiguration().color,borderRadius:"2px"}:null;return i.createElement("div",{key:"sentiments-container-"+e.mappedId+this.key,onMouseEnter:()=>t.hoverFilterHandler(this,e.mappedId,!0),onMouseLeave:()=>t.hoverFilterHandler(this,e.mappedId,!1),className:"sentiments-container"},i.createElement("div",{key:"sentiments-container-icon-div-"+e.mappedId+this.key,onClick:()=>t.filterSelectionHandler(this,e,!0),className:"sentiments-icon-div"},i.createElement("i",{key:"sentiments-container-icon-div-i-"+e.mappedId+this.key,style:n,className:s})),i.createElement("div",{key:"sentiments-container-label-div-"+e.mappedId+this.key,className:"sentiments-label"},e.name))}}}),define("components/filter_form/container/filter_form_container",["require","exports","flux","react","components/filter_form/controller/filter_form_controller","components/filter_form/data/root_mapped_ids","components/filter_form/renderable/form/filter_form_renderable","components/filter_form/renderable/form/filter_form_sentiments_renderable"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterFormContainer=class extends i.BaseComponent{constructor(e){super(e),this.key=_.uniqueId("filter-form-flattened-")}shouldComponentUpdate(e){return!e.skipRender}render(){const{rootId:e}=this.props.menuAttributes;return e===r.RootMappedIds.SENTIMENT_ROOT_MAPPED_ID?this.renderSentiments():this.renderExpandable()}renderSentiments(){const e=this.flattenFilters(this.props.filters);return s.createElement(a.FilterFormSentimentsRenderable,{key:"filter-menu-form-sentiments",menuAttributes:this.props.menuAttributes,filters:e,rootElementToIgnore:this.props.rootElementToIgnore,secondLevelElement:this.props.secondLevelElement,messages:this.props.messages,controller:new n.DefaultFilterFormController})}renderExpandable(){return s.createElement(o.FilterFormRenderable,{key:"filter-menu-form-"+this.key,menuAttributes:this.props.menuAttributes,filters:this.props.filters,flatten:this.props.flatten,messages:this.props.messages,rootElementToIgnore:this.props.rootElementToIgnore,secondLevelElement:this.props.secondLevelElement,controller:this.props.controller,actionButton:this.props.actionButton})}flattenFilters(e){return e.filter(e=>void 0===e.children||0===e.children.length)}}}),define("components/filter_form/renderable/menu/filter_menu_renderable",["require","exports","react","classnames","flux","components/filter_form/renderable/menu/hoverable_filter_menu","components/filter_form/renderable/form/clear_selected_filters_renderable","event_bus","components/filter_form/container/filter_form_container","components/filter_form/data/root_mapped_ids","components/filter_form/controller/filter_form_controller"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPEN=1]="OPEN",e[e.OPEN_WITH_CLICK=2]="OPEN_WITH_CLICK"}(h=t.FilterMenuState||(t.FilterMenuState={}));t.FilterMenuRenderable=class extends n.BaseComponent{render(){const{menuAttributes:e}=this.props;return this.renderFilterMenu(e)}isOpen(){return this.props.openState!==h.CLOSED}renderFilterMenu(e){const{config:t,topicMenu:s,rootId:n}=e,{filters:o}=this.props,a=o.filter(e=>e.selected),l=o[0].children[0],c=this.getNumberOfSelectedFilters(a,{rootMappedId:n,secondLevelElementMappedId:l.mappedId,defaultMappedId:e.topicMenu.default_mapped_id},t.shouldCountChildrenInSelection),d=this.getFilterMenuLabel(e,a,c),h=t.color||this.props.color;if(s.disabled)return this.renderDisabledFilterMenu(d);{const s=this.isOpen(),o=()=>this.toggleKeepMenuOpenHandler(),u=()=>this.hoverMenuHandler(n,!0),p=()=>this.hoverMenuHandler(n,!1);if(void 0===t.component)return i.createElement(r.HoverableFilterMenuRenderable,{onClick:o,onMouseEnter:u,onMouseLeave:p,styleCondition:s,color:h},this.renderLabel(d,s),this.renderClearButton(e,c,s,h),this.renderFilterFormContainer(e,l));{const n=e=>{const{label:t=d}=e;return this.renderLabel(t,s)},r=t=>{const{style:i}=t;return this.renderClearButton(e,c,s,t.color,i)},g=t=>{const{className:i,minWidth:s}=t;return this.renderFilterFormContainer(e,l,i,s)};return i.createElement(t.component.renderable,Object.assign({isRendered:s,numberOfSelected:c,hasDefaultSelection:this.isDefaultSelectionActive(a,c),label:d,color:h,onClick:o,onMouseEnter:u,onMouseLeave:p},t.component.props,{elementProviders:{label:n,clearButton:r,filterContainer:g}}))}}}isDefaultSelectionActive(e,t){return 0===t&&e.length>0}renderLabel(e,t=!1){return i.createElement("div",{className:"filter-menu-btn-label clickable",style:t?{fontWeight:600}:null},e)}renderClearButton(e,t,s=!1,n=e.config.color,r){const{rootId:a}=e;return t>0?i.createElement(o.ClearSelectedFiltersRenderable,{isHovered:s,style:this.buildClearButtonStyle(n,r),clearSelectionHandler:()=>this.clearSelectionHandler(a)},!s&&t):null}buildClearButtonStyle(e,t){return t||{normal:{backgroundColor:e,color:"#fff"},hovered:{backgroundColor:"#fff",color:e}}}renderDisabledFilterMenu(e){return i.createElement("div",{className:"hoverable disabled",onClick:()=>a.eventBus.dispatch({type:a.EVENT_TYPES.GO_TO_TRIAL,value:void 0})},e)}getFilterMenuLabel(e,t,i){const{config:s,topicMenu:n}=e;return i>0&&s.showSelectionAsLabel?this.getLabelForSelection(t):s.menuLabelProvider?s.menuLabelProvider(e,t,i):n.root_entry.name?n.root_entry.name:t[0].name}getLabelForSelection(e){return e.map(e=>e.name).join(", ")}getNumberOfSelectedFilters(e,t,i=!1){const s=e.filter(e=>this.shouldCountFilterAsSelected(e,t));return i?s.reduce((e,i)=>this.countSelectedChildren(i,t,e),0):s.length}countSelectedChildren(e,t,i){const{defaultMappedId:s}=t;return e.mappedId===s?i:(e.children&&0!==e.children.length?i=e.children.reduce((e,i)=>this.countSelectedChildren(i,t,e),i):i+=1,i)}shouldCountFilterAsSelected(e,t){const{rootMappedId:i,secondLevelElementMappedId:s,defaultMappedId:n}=t,r=e.mappedId===i;if(i===c.RootMappedIds.SENTIMENT_ROOT_MAPPED_ID)return!r;{const t=e.mappedId===s,i=e.mappedId===n;return!t&&!i&&!r}}renderFilterFormContainer(e,t,n,r){const{filters:o,messages:a,skipRender:c,color:h}=this.props,{rootId:u,topicMenu:p}=e,g=this.isOpen(),m=s({"hover-content-hovered":g,"hover-content":!g,[n]:!!n});let _=null;"sentiments"===u?_={minWidth:"123px"}:void 0!==r&&(_={minWidth:r});const f=this.enhanceMenuAttributesConfig(e,h);return f.config.width=null!==_?_.minWidth:void 0,i.createElement("div",{className:m,style:_},i.createElement(l.FilterFormContainer,{menuAttributes:f,filters:o,controller:new d.DefaultFilterFormController,messages:a,skipRender:c,rootElementToIgnore:p.root_entry.name?p.root_entry.name:"",secondLevelElement:t}))}enhanceMenuAttributesConfig(e,t){return e.config&&e.config.color||(e.config.color=t),e}clearSelectionHandler(e){const{menuAttributes:t,filters:i}=this.props,s=t.rootId,n=this.findRootFilterElement(i,s);a.eventBus.dispatch({type:a.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,value:{element:n,parentId:s,rootEntrySelectable:e===c.RootMappedIds.SENTIMENT_ROOT_MAPPED_ID}})}toggleKeepMenuOpenHandler(){if(!this.props.menuAttributes.config.disableKeepOpenOnClick){const{menuAttributes:e}=this.props,t=e.rootId;a.eventBus.dispatch({type:a.EVENT_TYPES.FILTER_MENU_KEEP_OPEN,value:{parentId:t}})}}hoverMenuHandler(e,t){const{menuAttributes:i}=this.props,s=i.rootId;a.eventBus.dispatch({type:a.EVENT_TYPES.FILTER_MENU_HOVERED,value:{parentId:s,hovered:t}})}findRootFilterElement(e,t){return e.find(e=>e.mappedId===t||void 0===e.parent)}}}),define("components/filter_form/controller/abstract_filter_menu_controller",["require","exports","event_bus","flux","log","reusable_components","components/filter_form/renderable/menu/filter_menu_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractFilterMenuController=class{constructor(e,t){this.modified=!1,this.menu=e,this.adapter=new t(e)}static getFilterInputsRecursively(e){const{children:t=[]}=e,i=[e];return t.map(e=>this.getFilterInputsRecursively(e)).forEach(e=>{i.push(...e)}),i}getId(){return this.adapter.getAttributes().rootId}getAdapter(){return this.adapter}getState(){return void 0===this.menuState&&this.initializeState(),this.menuState}isModified(){return!0===this.modified}markAsUnmodified(){this.modified=!1}resetChangesHandler(){i.eventBus.dispatch({type:i.EVENT_TYPES.FILTER_CLOSE_MENUS,value:{}}),i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_FILTER_MENU,value:{}})}initializeState(){this.menuState=this.getInitialFilterFormContainerState(o.FilterMenuState.CLOSED)}addSubscriptionsToToken(e){e.subscribeToStream(i.eventBus,i.EVENT_TYPES.FILTER_MENU_SHOW_FACEBOOK_LOGIN,async e=>{const{element:t}=e.value;this.redirectToFacebookLogin(t)})}redirectToFacebookLogin(e){e.selected||s.dispatcher.dispatch(r.filterMenuActions.verticalFilters_onFilterClick,{event:{target:$(".expandable-list-item-label").children("span:contains('Facebook')")},mappedId:"SOCIALMEDIA_FACEBOOK",parentMappedId:e.parent?e.parent.mappedId:void 0,menuType:"MEDIA_TYPE",refresh:!1})}isTransientLeaf(e){return e.transient_properties&&e.transient_properties.is_leaf}onMenuClick(e){return!!this.shouldHandleAction(e)&&(this.getState().openState===o.FilterMenuState.OPEN_WITH_CLICK?this.setOpenState(o.FilterMenuState.OPEN):this.setOpenState(o.FilterMenuState.OPEN_WITH_CLICK),!0)}onClickOutside(){return this.getState().openState===o.FilterMenuState.OPEN_WITH_CLICK&&this.setOpenState(o.FilterMenuState.CLOSED),!0}onMenuHovered(e,t){if(!this.shouldHandleAction(e))return!1;const i=this.getState();return i.openState!==o.FilterMenuState.OPEN_WITH_CLICK&&(t&&i.openState===o.FilterMenuState.CLOSED?this.setOpenState(o.FilterMenuState.OPEN):this.setOpenState(o.FilterMenuState.CLOSED)),!0}onMenuOpenStateChange(e,t){e===o.FilterMenuState.CLOSED&&this.onMenuClose()}onFilterModeSelectionChange(e,t){if(!this.shouldHandleAction(e))return!1;const i=this.getState(),{selectionModes:s}=i.menuAttributes;return s.forEach(e=>{e.id===t?(e.selected=!0,e.onSelected()):e.selected=!1}),this.modified=!0,!0}setOpenState(e){const t=this.getState(),i=t.openState;t.openState=e,i!==e&&this.onMenuOpenStateChange(t.openState,i)}getInitialFilterFormContainerState(e){const t=this.adapter.getAttributes(),i=t.topicMenu.root_entry,s=t.rootId||i.mapped_id;return n.logService.assertDefined(s),{menuAttributes:t,filters:this.adapter.getFilters(),openState:void 0!==e?e:this.getState().openState}}shouldHandleAction(e){return this.getId()===e}}}),define("components/filter_form/container/filter_menu_container",["require","exports","react","flux","event_bus","components/filter_form/renderable/menu/filter_menu_renderable","reusable_components"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterMenuContainer=class extends s.BaseComponent{constructor(e){super(e),this.tokenChannel="controller",this.state=e.controller.getState()}componentDidMount(){this.setupSubscriptions(this.props)}componentWillReceiveProps(e){this.setupSubscriptions(e)}componentDidUpdate(e){this.props.controller!==e.controller&&this.setState(this.props.controller.getState())}setupSubscriptions(e){const{controller:t}=e;this.cancellationToken.cancelChannel(this.tokenChannel);const i=this.cancellationToken.createChannel(this.tokenChannel);i.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_HOVERED,e=>{const{parentId:i,hovered:s}=e.value;t.onMenuHovered(i,s)&&this.setState(t.getState())}),i.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_KEEP_OPEN,async e=>{const{parentId:i}=e.value;t.onMenuClick(i)&&this.setState(t.getState())}),i.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,async e=>{const{element:i,parentId:s,rootEntrySelectable:n}=e.value;t.onFilterChanged(i,s,n)&&this.setState(t.getState())}),i.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_SELECTION_MODE_CHANGE,async e=>{const{parentId:i,mode:s}=e.value;t.onFilterModeSelectionChange(i,s)&&this.setState(t.getState())}),i.subscribeToStream(n.eventBus,n.EVENT_TYPES.FILTER_MENU_FILTER_EXPAND_TOGGLED,async e=>{const{mappedId:i,parentId:s}=e.value;await t.onMenuExpandToggled(i,s)&&this.setState(t.getState())})}render(){const{messages:e,color:t}=this.props;return i.createElement(o.DocumentClickTrackerWrapper,{clickOutside:this.handleClickOutside.bind(this),className:"filters-menu"},i.createElement(r.FilterMenuRenderable,Object.assign({},this.state,{color:t,messages:e})))}handleClickOutside(){const{controller:e}=this.props,{openState:t}=this.state;t===r.FilterMenuState.OPEN_WITH_CLICK&&e.onClickOutside()&&this.setState(e.getState())}}}),define("components/filter_form/renderable/bar/filter_bar_renderable_style",["require","exports","composable_styles"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hoverableContainer=(e=>i.dynamicStyle((e,t)=>e`
                height: 100%;
                display: flex;
                flex: 10;
                margin: ${t.margin};

                label: hoverableContainer;
            `)(i.composeProps(e,{margin:"0"}))),t.responsiveFilterBar=(e=>i.dynamicStyle(e=>e`
            ${i.mediaQueries.PHONE} {
                display: block;
            }
            ${i.mediaQueries.TABLET} {
                display: block;
            }

            label: responsiveFilterBar;
        `)(e))}),define("components/filter_form/renderable/bar/filter_bar_renderable",["require","exports","react","flux","components/filter_form/container/filter_menu_container","emotion","components/filter_form/renderable/bar/filter_bar_renderable_style"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterBarRenderable=class extends s.BaseComponent{render(){const{configuration:e}=this.props;return i.createElement("div",{className:r.cx(o.hoverableContainer({margin:e.margin}),o.responsiveFilterBar())},this.renderFilterBarLabel(),this.props.menus.map((e,t)=>this.renderFilterMenu(e,t)))}renderFilterBarLabel(){const{configuration:e}=this.props;return void 0!==e.label?i.createElement("div",{className:"filter-bar-label"},e.label):null}renderFilterMenu(e,t){const{messages:s,configuration:r}=this.props;return i.createElement(n.FilterMenuContainer,{key:`filter-menu-container-${t}`,messages:s,color:r.color,controller:e.controller})}}}),define("components/filter_form/controller/abstract_filter_bar_controller",["require","exports","map","components/filter_form/renderable/menu/filter_menu_renderable"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractFilterBarController=class{constructor(){this.menuControllers=new i.Map}registerMenus(e){e.map(e=>this.registerMenuController(e.controller))}resetMenus(){this.menuControllers.clear()}registerMenuController(e){const t=e.getId();this.menuControllers.has(t)&&this.menuControllers.get(t)===e||(this.menuControllers.delete(t),this.wrapMenuCallbacks(e),this.overwriteMenuCallbacks(e),this.menuControllers.set(t,e))}wrapMenuCallbacks(e){this.wrapOnMenuClick(e),this.wrapOnMenuHovered(e)}overwriteMenuCallbacks(e){this.overwriteOnClose(e)}wrapOnMenuClick(e){const t=e.onMenuClick.bind(e);e.onMenuClick=(i=>(t(i)&&i===e.getId()&&this.handleOnMenuClick(e),!0))}wrapOnMenuHovered(e){const t=e.onMenuHovered.bind(e);e.onMenuHovered=((i,s)=>(t(i,s)&&i===e.getId()&&this.handleOnMenuHovered(e,s),!0))}overwriteOnClose(e){void 0==e.onMenuClose&&(e.onMenuClose=(()=>{this.handleMenuClose(e)}))}handleOnMenuClick(e){const t=e.getId();this.menuControllers.forEach(e=>{e.getId()===t?e.setOpenState(s.FilterMenuState.OPEN_WITH_CLICK):e.setOpenState(s.FilterMenuState.CLOSED)})}handleOnMenuHovered(e,t){const i=e.getId();this.menuControllers.forEach(e=>{const n=e.getState().openState;e.getId()===i?n!==s.FilterMenuState.OPEN_WITH_CLICK&&e.setOpenState(t?s.FilterMenuState.OPEN:s.FilterMenuState.CLOSED):e.setOpenState(s.FilterMenuState.CLOSED)})}handleMenuClose(e){this.menuControllers.values().some(e=>e.isModified())&&(this.saveChanges(),this.menuControllers.forEach(e=>e.markAsUnmodified()))}getMenuControllerById(e){return this.menuControllers.values().find(t=>t.getId()===e)}}}),define("components/filter_form/renderable/menu/topic_filter_wrapper",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopicFilterWrapper=class extends s.BaseComponent{render(){const{messages:e}=this.props;return i.createElement("div",{className:"filter-menu"},i.createElement("span",{className:"filter-menu-filter-icon",style:{backgroundColor:this.props.color}},i.createElement("i",{className:"fa fa-filter",style:{fontSize:"14px"}})),i.createElement("span",{className:"filter-menu-content",style:{backgroundColor:this.props.pairedColor}},this.props.children),i.createElement("span",{className:"filter-menu-cancel-btn clickable",onClick:()=>this.resetChanges()},e.msgCancelChanges),i.createElement("span",{style:{backgroundColor:this.props.color,fontWeight:"bold"},className:"filter-menu-apply-btn clickable",onClick:()=>this.persistChanges()},e.msgApplyChanges,i.createElement("i",{className:"fa fa-chevron-right",style:{marginLeft:"15px",fontSize:"14px"}})))}resetChanges(){this.props.controller.resetChanges()}persistChanges(){this.props.controller.saveChanges()}}}),define("components/filter_form/container/filter_bar_container",["require","exports","react","flux","components/filter_form/renderable/menu/topic_filter_wrapper","components/filter_form/renderable/bar/filter_bar_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterBarContainer=class extends s.BaseComponent{componentDidMount(){this.registerMenus(this.props)}componentWillReceiveProps(e){this.registerMenus(e)}registerMenus(e){const{controller:t,menus:i}=e;t.registerMenus(i)}render(){return i.createElement("div",{className:"searchbar-filter align-dropdown-right",id:"filter-menu-container"},this.renderFilterBar())}renderFilterBar(){const{menus:e,controller:t,configuration:s,showPageFilters:o,messages:a}=this.props,l=i.createElement(r.FilterBarRenderable,{menus:e,configuration:s,pageFiltersAreShown:o,messages:a});return o?l:i.createElement(n.TopicFilterWrapper,{color:s.color,messages:a,pairedColor:this.getPairedColor(s.color),controller:t},l)}getPairedColor(e){const{colorPairs:t}=this.props;return e&&t.has(e)?t.get(e):e}}}),define("components/filter_form/data/filter_form_container_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/filter_form/renderable/menu/styles/integrated_filter_menu_style",["require","exports","emotion","composable_styles"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterMenuContainer=(e=>s.dynamicStyle((e,t)=>e`
            color: ${t.color};
            ${n(t)};

            label: filterMenuContainer;
        `)(s.composeProps(e,{color:"#707070"}))),t.filterMenuLabelContainer=s.dynamicStyle((e,t)=>e`
        display: flex;
        padding: 1.41em;
        border-bottom: 1px solid #d7dbdd;
        ${n(t)};

        label: filterMenuLabelContainer;
    `),t.filterMenuLabel=i.css`
    flex: 1;

    font: 13px RobotoR;
    text-transform: uppercase;

    label: filterMenuLabel;
`,t.filterMenuCaret=i.css`
    font-size: 16px;
    color: #95a5a6;

    label: filterMenuCaret;
`,t.filterFormContainer=s.dynamicStyle((e,t)=>e`
        display: ${t.isOpen?void 0:"none"};

        label: filterFormContainer;
    `);const n=e=>i.css`
    background-color: ${e.isOpen?"#f2f3f4":void 0};
`}),define("components/filter_form/renderable/menu/integrated_filter_menu_renderable",["require","exports","react","flux","emotion","components/filter_form/renderable/menu/styles/integrated_filter_menu_style"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IntegratedFilterMenuRenderable=class extends s.BaseComponent{render(){const{isRendered:e}=this.props;return i.createElement("div",{className:r.filterMenuContainer({isOpen:e})},this.renderMenuContainer())}renderMenuContainer(){const{elementProviders:e,label:t,isRendered:s,onClick:n,onMouseEnter:o,onMouseLeave:a,color:l}=this.props;return i.createElement(i.Fragment,null,i.createElement("div",{className:r.filterMenuLabelContainer({isOpen:s}),onClick:n,onMouseEnter:o,onMouseLeave:a},this.renderLabel(t),e.clearButton({color:l}),i.createElement("div",{className:this.getCaretClass()})),i.createElement("div",{className:r.filterFormContainer({isOpen:s})},e.filterContainer({})))}renderLabel(e){return i.createElement("span",{className:r.filterMenuLabel},e)}getCaretClass(){const{isRendered:e}=this.props;return n.cx("fa",{"fa-chevron-down":!e},{"fa-chevron-up":e},r.filterMenuCaret)}}}),define("components/filter_form/renderable/menu/styles/integrated_filter_form_style",["require","exports","composable_styles","reusable_components","components/filter_form/renderable/form/filter_form_style"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.integratedFilterFormStyle={container:e=>n.formContainerStyle(i.composeProps(e,{backgroundColor:"transparent",width:"100%",fontColor:"#707070"})),filterItemLabelStyle:{parentLabel:""},expandableList:{container:e=>s.expandableListContainerStyle(i.composeProps({fontColor:"#707070",width:"88%",margin:"auto"},e)),item:e=>s.expandableListItemContainerStyle(i.composeProps(e,{margin:"0.33em"})),rightIcon:e=>s.expandableListItemIconStyle(i.composeProps(e,{backgroundColor:"transparent"})),expandedIconClass:"fa fa-chevron-up",collapsedIconClass:"fa fa-chevron-down"}}}),define("filter_menu",["require","exports","components/filter_form/container/filter_bar_container","components/filter_form/container/filter_form_container","components/filter_form/container/filter_menu_container","components/filter_form/controller/abstract_filter_bar_controller","components/filter_form/controller/abstract_filter_menu_controller","components/filter_form/controller/filter_form_controller","components/filter_form/data/menu_adapter","components/filter_form/renderable/bar/filter_bar_renderable","components/filter_form/renderable/form/filter_form_renderable","components/filter_form/renderable/form/filter_form_sentiments_renderable","components/filter_form/renderable/form/filter_renderable","components/filter_form/renderable/menu/filter_menu_renderable","components/filter_form/renderable/menu/integrated_filter_menu_renderable","components/filter_form/renderable/menu/styles/integrated_filter_form_style","components/filter_form/renderable/menu/topic_filter_wrapper"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_){"use strict";function f(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),f(i),f(s),f(n),f(r),f(o),f(a),f(l),f(c),f(d),f(h),f(u),f(p),f(g),f(m),f(_)}),define("style/floating_menu_style",["require","exports","composable_styles"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.floatingMenuContainer=(e=>i.dynamicStyle((e,t)=>e`
            position: fixed;
            bottom: 0;
            z-index: 100;
            margin: 0 20px 20px 0;
            transition: 700ms right ease-in-out;
            right: ${t.visible?"0":"-80px"};

            label: floatingMenuContainer;
        `)(i.composeProps(e,{}))),t.floatingMenuItem=(e=>i.dynamicStyle((e,t)=>e`
            position: relative;
            border-radius: 50%;
            background-color: ${t.backgroundColor};
            border: 1px solid ${t.backgroundColor};
            font-size: ${void 0!==t.iconSize?t.iconSize:Math.floor(.45*t.size)}px;
            width: ${t.size}px;
            height: ${t.size}px;
            text-align: center;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.14), 0 4px 8px rgba(0, 0, 0, 0.28);

            i.icon {
                position: relative;
                display: block;
                top: 50%;
                transform: translateY(-50%);
                text-shadow: 0 1px 4px rgba(0, 0, 0, 0.28);
                color: ${t.color};
            }

            label: floatingMenuItem;
        `)(i.composeProps(e,{size:56,color:"white"})))}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("floating_menu_item_renderable",["require","exports","react","flux","classnames","style/floating_menu_style"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FloatingMenuItemRenderable=class extends s.BaseComponent{render(){const{icon:e,color:t,iconSize:s,onClick:o}=this.props;return i.createElement("div",{onClick:o,className:r.floatingMenuItem({backgroundColor:t,iconSize:s})},i.createElement("i",{className:n({[e]:!0,icon:!0})}))}}}),define("floating_menu_renderable",["require","exports","react","flux","style/floating_menu_style","floating_menu_item_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FloatingMenuRenderable=class extends s.BaseComponent{render(){const{visible:e}=this.props;return i.createElement("div",{className:n.floatingMenuContainer({visible:e})},this.renderItems())}renderItems(){const{items:e}=this.props;return e.map(e=>this.renderSingleItem(e))}renderSingleItem(e){return i.createElement(r.FloatingMenuItemRenderable,Object.assign({key:e.id},e))}}}),define("floating_menu",["require","exports","floating_menu_renderable"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("annotations/async_handler",["require","exports"],function(e,t){"use strict";function i(e){e.__asyncHandler=!0}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncHandler=function(){return(e,t)=>i(e[t])},t.asyncHandlerAnnotate=i}),define("dispatch_session",["require","exports","log"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DispatchSession=class{constructor(e,t,i){this.subToSource=(e=>e.source),this.todo=e,this.done=[],this.pendingAsync=[],this.deferred=[],this.sourceAction=t,this.payload=i}isDone(){return 0===this.todo.length&&0===this.pendingAsync.length&&0===this.deferred.length}suspendSession(e){i.logService.debug(`Suspended dispatch ${this.sourceAction}`),this.timeout=setTimeout(()=>{i.logService.error(`asyncHandler timeout: action ${this.sourceAction} took over ${e} ms to resolve`,{},this)},e)}resumeSession(){i.logService.debug(`Resumed dispatch ${this.sourceAction}`),this.todo=this.deferred,this.deferred=[],clearTimeout(this.timeout)}dispatch(e){let t=this.todo.length;for(;this.todo.length>0;){if(this.dispatchIteration(e),this.todo.length===t)throw i.logService.dir(this.todo.map(e=>e.source.constructor)),new Error(`Either circular dependency with waitFor on action ${this.sourceAction} or one or more required stores did not listen to action`);t=this.todo.length}}makeAsync(e,t){return this.pendingAsync.push(e),()=>{this.done.push(e),this.pendingAsync.splice(this.pendingAsync.indexOf(e),1),t.resumeSession(this)}}dispatchIteration(e){for(let t=this.todo.length-1;t>=0;t--){let i=!1;this.todo[t].source.canBeInvoked(this.sourceAction,this.done.map(this.subToSource),this.pendingAsync.map(this.subToSource),()=>{i=!0})?(this.todo[t].source.invoke(this.sourceAction,this.payload,()=>this.makeAsync(this.todo[t],e)),-1===this.pendingAsync.indexOf(this.todo[t])&&this.done.push(this.todo[t]),this.todo.splice(t,1)):i&&(this.deferred.push(this.todo[t]),this.todo.splice(t,1))}}}}),define("dispatcher",["require","exports","log","underscore","dispatch_session"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e={asyncTimeout:1e4}){this.subscribers=[],this.inactiveSessions=[],this.settings=e}subscribe(e,t){const i=this.arrayToActionList(t);this.subscribers.push({source:e,actions:i})}validateDispatch(e,t){return void 0===this.activeSession||(i.logService.error("Cascading dispatch detected! A dispatch should not happen as a response to another dispatch. This is always a sign of bad code. Instead, you should have multiple stores react to the same dispatch and push all the state changes in one go"),setTimeout(this.dispatch.bind(this,e,t)),!1)}dispatch(e,t){this.validateDispatch(e,t)&&this.unsafeDispatch(e,t)}unsafeDispatch(e,t){if(void 0!==this.activeSession)return void setTimeout(this.unsafeDispatch.bind(this,e,t));const s=this.subscribers.filter(t=>t.actions[e]);0!==s.length?(i.logService.debug(`[FLUX] Dispatched action: ${e}`,{style:"color:red;"},{payload:t,affectedStores:s.map(e=>e.source)}),this.activeSession=this.createSession(s,e,t),this.tryDispatch(),this.tryCloseActiveSession()):i.logService.warn(`Action ${e} has no listeners`)}tryDispatch(){try{this.activeSession.dispatch(this)}catch(e){i.logService.error(e)}}createSession(e,t,i){return new n.DispatchSession(e,t,i)}closeActiveSession(){if(void 0===this.activeSession)throw new Error("Cannot suspend session, no active session");this.activeSession=void 0}hardReset(){this.subscribers=[],this.inactiveSessions=[],this.activeSession=void 0,this.inactiveSessions=[]}resumeSession(e){if(this.activeSession!==e){if(void 0!==this.activeSession)throw new Error("Unexpected state: session already active when new session was resumed");if(-1===this.inactiveSessions.indexOf(e))throw new Error("Can't resume session: It does not belong to this dispatcher");this.inactiveSessions.splice(this.inactiveSessions.indexOf(e),1),this.activeSession=e,e.resumeSession(),this.activeSession.dispatch(this),this.tryCloseActiveSession()}}suspendActiveSession(){if(void 0===this.activeSession)throw new Error("Cannot suspend session, no active session");this.activeSession.suspendSession(this.settings.asyncTimeout),this.inactiveSessions.push(this.activeSession),this.activeSession=void 0}arrayToActionList(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}tryCloseActiveSession(){this.activeSession.isDone()?this.closeActiveSession():this.suspendActiveSession()}validatePayload(e,t,n){return s.values(e).forEach(e=>{if(s.isObject(e)&&-1!==t.indexOf(e))throw new Error("circular payload cannot be dispatched");const r=n(e)&&this.validatePayload(e,t,n);return s.isObject(e)&&t.push(e),r?void 0:(i.logService.error(`dispatch validation failed for payload value ${e}`,{},e),!1)}),!0}}t.Dispatcher=r,t.dispatcher=new r}),define("base_store",["require","exports","dispatcher","underscore","event","annotations/waitFor","annotations/async_handler","log"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l{constructor(e,t){let r={actions:[],handlers:{}};void 0!==t&&(r=this.resolveMixin(t),s.assign(this,r.handlers)),i.dispatcher.subscribe(this,this.reduceActions(e).concat(r.actions)),this.onChange=new n.Event,this.onChange.subscribe(e=>this.logEvent(e))}canBeInvoked(e,t,i,s){const n=this.getProperty(e);if(void 0===n)throw new Error(`store has no listener for action ${e}`);return n.__waitFor?this.handleWaitFor(n.__waitFor,t,i,s):!n.__waitForCondition||this.handleWaitForCondition(n.__waitForCondition,t,i,s)}invoke(e,t,i){const s=this.getProperty(e);if(void 0===s)throw new Error(`${this.constructor.name} listens to an action (${e}) but has no handler for it`);if(s.__asyncHandler){const e=i();s.call(this,t,e)}else s.call(this,t)}logEvent(e){a.logService.debug(`[${this.constructor.name}] onChange fired`,{},e)}reduceActions(e){return s.isArray(e)?e.reduce((e,t)=>e.concat(s.isString(t)?[t]:s.values(t)),[]):s.values(e)}handleWaitFor(e,t,i,s){const n=t.map(e=>e.constructor),r=i.map(e=>e.constructor),o=e.every(e=>e instanceof l?~t.indexOf(e):~n.indexOf(e));if(o)return o;return e.every(e=>e instanceof l?~i.indexOf(e):~r.indexOf(e))?(s(),!1):void 0}handleWaitForCondition(e,t,i,s){return e.call(this,t,i,s)}parseAction(e){const t=e.split("_");if(t.length<2)throw new Error(`Action name ${e} does not follow the correct naming pattern see actions.ts for reference`);return t}resolveMixin(e){const t={actions:void 0,handlers:{}};return t.actions=Object.keys(e),t.actions.forEach(i=>{let n=e[i];if(!s.isFunction(n)){const{waitFor:e,handler:t,asyncHandler:i}=n;n=t,e&&r.waitForAnnotate(n,e),i&&o.asyncHandlerAnnotate(n)}t.handlers[i.split("_")[1]]=n}),t}getProperty(e){const t=this.parseAction(e),i=[`${t[0]}${t[1][0].toUpperCase()}${t[1].substring(1)}`,t[1]];return this[s.find(i,e=>this[e])]}}t.BaseStore=l}),define("annotations/waitFor",["require","exports","underscore"],function(e,t,i){"use strict";function s(e,t){i.isFunction(t)?e.__waitForCondition=t:e.__waitFor=t}Object.defineProperty(t,"__esModule",{value:!0}),t.waitFor=function(e){if(void 0===e||i.isArray(e)&&-1!==e.indexOf(void 0))throw new Error("invalid waitFor: waiting on undefined");return(t,i)=>s(t[i],e)},t.waitForAnnotate=s}),define("react_wrapper/base_component",["require","exports","react","reusable_utilities","dispatcher"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseComponent=class extends i.Component{constructor(e){super(e),this.isUnmounted=!1}get cancellationToken(){return void 0===this._token&&(this._token=new s.CancellationToken),this._token}registerDomEvent(e,t,i){this.cancellationToken.addDomEvent(e,t,i)}dispatch(e,t){n.dispatcher.dispatch(e,t)}componentWillUnmount(){this.isUnmounted=!0,void 0!==this._token&&this._token.cancel()}}}),define("mixins/document_click_tracker",["require","exports","react_wrapper/base_component","react-dom"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DocumentClickTracker=class extends i.BaseComponent{componentDidMount(){this.registerDomEvent($(document),"click",function(e){const t=s.findDOMNode(this);e.target==t||$(t).has(e.target).length?this.clickInside(e):this.clickOutside(e)}.bind(this))}}}),define("mixins/key_listener",["require","exports","react_wrapper/base_component","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.KeyListener=class extends i.BaseComponent{componentDidMount(){this.registerDomEvent($(document),"keydown",e=>(function(e,t){t.forEach(t=>{s.any(s.flatten([t.keys]),t=>t===e.keyCode)&&t.action.call(this,e)})}).call(this,e,this.keyActions))}}}),define("react_wrapper/styled_base_component",["require","exports","react_wrapper/base_component","css_modules","log"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StyledBaseComponent=class extends i.BaseComponent{constructor(e,t){super(e),n.logService.assertDefined(t);const i=s.createCssModule(t);this.cssModule=i,this.style=i.compute(this.props.theme).attach().getModule()}recomputeStyle(){this.style=this.cssModule.compute(this.props.theme).getModule()}componentWillUnmount(){super.componentWillUnmount(),this.style=void 0,this.cssModule.detach()}}}),define("flux",["require","exports","annotations/async_handler","annotations/waitFor","base_store","dispatch_session","dispatcher","mixins/document_click_tracker","mixins/key_listener","react_wrapper/base_component","react_wrapper/styled_base_component"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";function h(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),h(i),h(s),h(n),h(r),h(o),h(a),h(l),h(c),h(d)}),define("font_saver",["require","exports","map","fontfaceobserver","log"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CabinCondensedR="CabinCondensedR",e.CabinCondensedM="CabinCondensedM",e.RobotoR="RobotoR",e.RobotoM="RobotoM",e.RobotoB="RobotoB",e.SourceSansProB="SourceSansProB",e.twAwesome="twAwesome"}(t.SaveableFontName||(t.SaveableFontName={}));const r=1e4;t.fontSaverService=new class{constructor(){this.savedFontOwnerMap=new i.Map,this.savedFontMap=new i.Map,this.fontSaverContainer=document.createElement("div"),this.fontSaverContainer.style.opacity="0",this.fontSaverContainer.style.position="absolute",this.fontSaverContainer.style.height="0px",this.fontSaverContainer.style.overflow="hidden",document.body.appendChild(this.fontSaverContainer)}initializeFontSaving(e){const t=document.createElement("div");this.fontSaverContainer.appendChild(t),t.style.fontFamily=`'${e}'`,t.style.fontSize="12px",this.savedFontMap.set(e,{characters:new Set,fontSaverDiv:t})}registerOwner(e,t){this.savedFontOwnerMap.has(e)||this.savedFontOwnerMap.set(e,[]),this.savedFontOwnerMap.get(e).includes(t)||this.savedFontOwnerMap.get(e).push(t)}freeFont(e,t){this.savedFontOwnerMap.has(e)&&this.savedFontOwnerMap.get(e).includes(t)&&(this.savedFontOwnerMap.get(e).splice(this.savedFontOwnerMap.get(e).indexOf(t),1),0===this.savedFontOwnerMap.get(e).length&&this.clearFontSaver(e))}saveFont(e,t,i,s=r){return 0===t.length?Promise.resolve():(this.savedFontMap.has(e)||this.initializeFontSaving(e),this.registerOwner(e,i),this.updateFontSaver(e,t,s))}clearFontSaver(e){const t=this.savedFontMap.get(e);t.fontSaverDiv.innerHTML="",t.characters.clear()}updateFontSaver(e,t,i){const r=this.savedFontMap.get(e),o=r.characters.size;let a=t.length;for(;a--;)isNaN(parseInt(t[a]))&&" "!==t[a]&&r.characters.add(t[a].toLowerCase());o!==r.characters.size&&(r.fontSaverDiv.innerHTML=Array.from(r.characters).join(""));const l=new s(e),c=t.join("");return new Promise(t=>l.load(c,i).then(()=>{t()},()=>{n.logService.warn(`${e} is not loaded for (some of) these characters: ${c}`),t()}))}}}),define("font_saver_service",["require","exports","font_saver"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("main",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Selection=class{constructor(e){i.isArray(e)||i.isUndefined(e.children)?this.list=e:this.list=e.children,this.cache=this.anchor=this.lead=void 0}clear(){i.each(this.list,e=>{e.selected=!1}),this.cache=this.anchor=this.lead=void 0}deselect(e){return!(e<0||e>this.list.length||(this.cache=void 0,!this.list[e]||(this.list[e].selected=!1,0)))}select(e,t,s){if(!this.isValidSelection(e,t))return;this.cache=void 0,this.anchor=e,this.lead=t;const n=Math.min(e,t),r=Math.max(e,t);i.each(this.list,(e,t)=>{e.unselectable?e.selected=!1:e.selected=!!(s&&!0===e.selected||t>=n&&t<=r)})}selectNext(e,t=1){const i=this.anchor||0;let s=this.lead+t||0;for(;s<this.list.length&&this.list[s].unselectable;)s++;if(!(s>=this.list.length))return this.select(e?i:s,s,!1),this.lead}selectPrevious(e,t=1){const i=this.anchor||0;let s=this.lead-t||0;for(;s>0&&this.list[s].unselectable;)s--;if(!(s<0))return this.select(e?i:s,s,!1),this.lead}selectAll(){const e=i.isUndefined(this.list)?0:this.list.length-1;return this.select(0,e,!0),this.lead}toggle(e,t,i){i?this.select(void 0!==this.anchor?this.anchor:e,e,!1):t&&!0===this.list[e].selected?this.deselect(e):this.select(e,e,t)}get(){return i.isUndefined(this.cache)&&this.initializeCache(),this.cache}getList(){return this.list}getAnchor(){return this.list[this.anchor]}getLead(){return this.list[this.lead]}getLast(){return this.get()&&this.get().length>0?this.get()[this.get().length-1]:void 0}getFirst(){return this.get()&&this.get().length>0?this.get()[0]:void 0}isSingleSelection(){return this.get()&&1===this.get().length}initializeCache(){this.cache=i.where(this.list,{selected:!0})}isValidSelection(e,t){return this.list&&e>=0&&e<this.list.length&&(!t||t>0&&t<this.list.length)}}}),define("generic_selection",["require","exports","main"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("core/planetaryjs",["require","exports","d3","core/planet"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{drawStep(e,t){return e.isStopped()?this.timer:(e.getContext().clearRect(0,0,t.width,t.height),e.getHooks().onDraw.forEach(e=>e()),requestAnimationFrame(this.drawStep.bind(this,e,t)))}doDrawLoop(e,t){this.timer=this.drawStep(e,t)}runOnInitHooks(e,t,i){const s=i.onInit,n={current:0,hooksLeft:s.length};if(s.length>0){const i=()=>{0===n.hooksLeft?this.doDrawLoop(e,t):this.processNextHook(s,i,n)};this.processNextHook(s,i,n)}else this.doDrawLoop(e,t)}processNextHook(e,t,i){const s=e[i.current];s.length?s(()=>{i.hooksLeft--,i.current++,t()}):(s(),i.hooksLeft--,i.current++,setTimeout(t,0))}startDraw(e,t,i){e.setCanvas(t),e.setStopped(!1),this.runOnInitHooks(e,t,i)}createPlanet(){const e=new s.Planet(this),t=i.geo.orthographic().clipAngle(90),n=i.geo.path().projection(t);return e.setProjection(t),e.setPath(n),e}destroy(){void 0!==this.timer&&clearInterval(this.timer)}}t.PlanetaryJS=n,t.planetaryJs=new n}),define("core/planet",["require","exports","map","event"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Planet=class{constructor(e){this.planetaryReference=e,this.plugins=new i.Map,this.hooks={onInit:[],onDraw:[],onStop:[]},this.onRotationChange=new s.Event}draw(e){this.planetaryReference.startDraw(this,e,this.hooks)}stop(){this.setStopped(!0),this.hooks.onStop.forEach(e=>e()),this.onRotationChange.cancelAll()}destroy(){this.stop(),this.planetaryReference.destroy(),this.destroyCanvasEngineReferences(),delete this.hooks}destroyCanvasEngineReferences(){this.stage&&this.stage.dispose(),this.scene&&this.scene.dispose(),this.camera&&this.camera.dispose()}setStopped(e){this.stopped=e}isStopped(){return this.stopped}setCanvas(e){this.canvas=e,this.context=e.getContext("2d")}setCanvasContainer(e){this.canvasContainer=e}setTimeline(e){this.timeline=e}getCanvasContainer(){return this.canvasContainer}setCancellationToken(e){this.cancellationToken=e}getCancellationToken(){return this.cancellationToken}getContext(){return this.context}getCanvas(){return this.canvas}getTimeline(){return this.timeline}onInit(e){this.hooks.onInit.push(e)}onDraw(e){this.hooks.onDraw.push(e)}onStop(e){this.hooks.onStop.push(e)}loadPlugin(e,t,i){this.plugins.set(e,new e(this,t,i))}withSavedContext(e){if(!this.context)throw new Error("No canvas to fetch context for");this.context.save(),e(this.context),this.context.restore()}hasPlugin(e){return this.plugins.has(e)}isPluginLoaded(e){return this.hasPlugin(e)&&this.getPlugin(e).isLoaded()}getPlugins(){return this.plugins}getPlugin(e){return this.plugins.get(e)}getHooks(){return this.hooks}setProjection(e){this.projection=e}setPath(e){this.path=e}getPath(){return this.path}getProjection(){return this.projection}}}),define("plugins/planetary_plugin",["require","exports","log","canvas_engine"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlanetaryPlugin=class{constructor(e,t,i){this.planet=e,this.config=i,this.loaded=!1,this.cleanupFunctions=[],this.parentEntity=s.Entity.zero(),this.mediator=t,this.initialize()}initialize(){this.isEnabled()&&(this.planet.onInit(()=>{!0===this.config.requireCanvasEngine&&this.initializeCanvas(this.planet),this.loaded=!0,this.onInit()}),this.planet.onDraw(this.onDraw.bind(this)),this.planet.onStop(()=>{this.cleanupFunctions.forEach(e=>e()),this.onStop()}))}isLoaded(){return!0===this.loaded}setMediator(e){this.mediator=e}addCleanupFunction(e){this.cleanupFunctions.push(e)}getConfig(){return this.config}isEnabled(){return this.config&&!0===this.config.enabled}getParentEntity(){return!1===this.config.requireCanvasEngine?(i.logService.error("Trying to access entity in plugin that does not require canvas engine!",void 0,{plugin:this}),null):this.parentEntity}initializeCanvas(e){this.parentEntity.setStyle(s.Style.Width,e.getCanvas().width).setStyle(s.Style.Height,e.getCanvas().height),e.scene.addChild(this.parentEntity)}onInit(){}onDraw(){}onStop(){}addBehaviorEventListenersCleanup(e,t){this.planet.getCancellationToken().registerCleanupFunction(()=>{t.forEach(t=>{e.on(t,null)})})}}}),define("utils/coordinates",["require","exports","underscore","canvas_engine","math_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static normalize(e){return e[0]>=180&&(e[0]-=360),e[1]=n.generalMathUtils.clamp(e[1],-90,90),e}static add(e,t){return[e[0]+t[0],e[1]+t[1]]}static multiply(e,t){return[e[0]*t,e[1]*t]}static isEqual(e,t){return!(!e||!t||e.length!==t.length)&&i.all(e,(e,i)=>e===t[i])}static getGeoDistanceFromCenter(e,t){const i=t.getProjection().invert([t.getCanvas().width/2,t.getCanvas().height/2]);return d3.geo.distance(e,i)}static isVisibleOnPlanet(e,t){return r.getGeoDistanceFromCenter(e,t)<=r.HALF_PI}static toPoint(e){return new s.Point(e[0],e[1])}static fromPoint(e){return[e.x,e.y]}static findMid(e,t){const[i,s]=e,[r,o]=t,a=n.trigonometryUtils.degreesToRadians(s),l=n.trigonometryUtils.degreesToRadians(i),c=n.trigonometryUtils.degreesToRadians(o),d=n.trigonometryUtils.degreesToRadians(r)-l,h=Math.cos(c)*Math.cos(d),u=Math.cos(c)*Math.sin(d),p=Math.atan2(Math.sin(a)+Math.sin(c),Math.sqrt((Math.cos(a)+h)*(Math.cos(a)+h)+u*u)),g=l+Math.atan2(u,Math.cos(a)+h);return[n.trigonometryUtils.radiansToDegrees(g),n.trigonometryUtils.radiansToDegrees(p)]}static generateId(e){const[t,i]=e;return t+":"+i}}r.HALF_PI=Math.PI/2,t.CoordinatesUtils=r}),define("config/default_globe_component_config",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPingOptions={color:i.Color.DEFAULT_BRANDING_COLOR(),angle:4,ttl:2e3,expireTime:36e5},t.defaultGeneralConfig={initialRotation:[0,-27,0]},t.defaultCenterConfig={delay:500,duration:2e3},t.defaultAutoRotationConfig={enabled:!0,speed:6.66,fps:60,direction:[1,0]},t.defaultAdvancedZoomPluginConfig={initialScale:280,scaleExtent:[100,2e3]},t.defaultGlobeComponentThemes={dark:{land:{fill:new i.Color("#424344")},oceans:{fill:new i.Color("#222222")},borders:{stroke:new i.Color("#353637")},pings:{fill:new i.Color("#d6ff00")},places:{circles:{enabled:!1,fill:i.Color.fromRGBA(0,0,0,.3),stroke:i.Color.TRANSPARENT_COLOR()},text:{enabled:!1,font:"14px RobotoR",fill:i.Color.fromRGBA(255,255,255,.66),stroke:i.Color.fromRGBA(0,0,0,.33)}}},none:{land:{fill:new i.Color("#aaaaaa")},oceans:{fill:new i.Color("#dddddd")},borders:{stroke:new i.Color("#9b9b9b")},pings:{fill:new i.Color("#061b2e")},places:{circles:{enabled:!1,fill:i.Color.fromRGBA(0,0,0,.1),stroke:i.Color.TRANSPARENT_COLOR()},text:{enabled:!1,font:"14px RobotoR",fill:i.Color.fromRGBA(10,10,10,.66),stroke:i.Color.fromRGBA(255,255,255,.33)}}}},t.defaultGlobeComponentThemes.light=t.defaultGlobeComponentThemes.none;const s=t.defaultGlobeComponentThemes.light;t.defaultGlobeComponentPlugins={earth:{enabled:!0,file:"https://d3js.org/world-110m.v1.json"},oceans:{enabled:!0,palette:s.oceans},land:{enabled:!0,palette:s.land},borders:{enabled:!0,palette:s.borders},autoCenter:{enabled:!0,padding:10,centerWidth:!0,centerHeight:!0},navigation:{enabled:!0,centerOn:t.defaultCenterConfig,autoRotation:t.defaultAutoRotationConfig},pings:{enabled:!0,requireCanvasEngine:!0,options:t.defaultPingOptions,columnDrawTime:3e4,showPlaces:!1,showInitialPings:!0,spreadInitialPings:!0,overridePingColors:!0},places:{enabled:!1,file:"https://api.myjson.com/bins/hy8wp",palette:s.places},zoom:{enabled:!0,scaleExtent:[200,5e3],initialScale:200},drag:{enabled:!0},activity:{enabled:!0},arcs:{enabled:!1,requireCanvasEngine:!0,curveType:"quadratic",playInitialAnimation:!0,callbacks:{}}}}),define("plugins/advanced_drag_plugin",["require","exports","d3","event","utils/coordinates","plugins/planetary_plugin"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AdvancedDragPlugin=class extends r.PlanetaryPlugin{constructor(e,t,i){super(e,t,i),this.draggingAllowed=!0,this.onDragStart=new s.Event,this.onDrag=new s.Event,this.onDragEnd=new s.Event,this.planet.canDrag=this.canDrag.bind(this),this.planet.allowDragging=this.allowDragging.bind(this),this.planet.getCancellationToken().registerCleanupFunction(()=>{this.onDragStart.cancelAll(),this.onDrag.cancelAll(),this.onDragEnd.cancelAll()})}onInit(){const e=i.behavior.drag().on("dragstart",()=>{this.planet.canDrag()&&this.onDragStart.fire(this.planet.getProjection())}).on("dragend",()=>{this.planet.canDrag()&&this.onDragEnd.fire(this.planet.getProjection())}).on("drag",()=>{if(this.planet.canDrag()){const e=i.event.sourceEvent,t=e.movementX,s=e.movementY,r=this.planet.getProjection().scale(),o=i.scale.linear().domain([-1*r,r]).range([-90,90]),a=o(t),l=o(s),c=this.planet.getProjection().rotate();c[0]+=a,c[1]-=l;const d=[c[0],c[1]],[h,u]=n.CoordinatesUtils.normalize(d),p=[h,u,0];this.planet.getProjection().rotate(p),this.onDrag.fire(this.planet.getProjection())}});i.select(this.planet.getCanvasContainer()).call(e),this.addBehaviorEventListenersCleanup(e,["dragstart","dragend","drag"])}canDrag(){return this.draggingAllowed}allowDragging(e){this.draggingAllowed=e}}}),define("plugins/navigation_plugin",["require","exports","d3","jquery","log","math_utils","config/default_globe_component_config","utils/coordinates","plugins/advanced_drag_plugin","plugins/planetary_plugin"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const d=.85,h=95;t.NavigationPlugin=class extends c.PlanetaryPlugin{constructor(e,t,i={centerOn:o.defaultCenterConfig,autoRotation:o.defaultAutoRotationConfig}){super(e,t,i),this.planet.centerOn=this.centerOn.bind(this)}isAnimationPlaying(){return!0===this.animationPlaying}setRotationDirection(e){const{autoRotation:t}=this.config;t.enabled&&(t.direction=e)}setRotationSpeed(e){const{autoRotation:t}=this.config;t.enabled&&(t.speed=e)}onInit(){const{autoRotation:e}=this.config;e.enabled&&this.setupAutoRotation()}onStop(){const{autoRotation:e}=this.config;e.enabled&&this.stopAutoRotation()}setAnimationPlaying(e){this.animationPlaying=e;const{autoRotation:t,centerOn:i}=this.config;return t.enabled?e?(t.speed>0?this.lastSpeed=t.speed:n.logService.warn("Trying to set last speed to invalid value",void 0,{lastSpeed:this.lastSpeed,value:t.speed}),this.modifyRotationSpeed(0,i.delay).then(()=>(this.stopAutoRotation(),!1))):(this.startAutoRotation(),this.modifyRotationSpeed(this.lastSpeed||t.speed,i.delay).then(()=>!0)):(this.planet.isPluginLoaded(l.AdvancedDragPlugin)&&this.planet.allowDragging(!e),Promise.resolve(e))}modifyRotationSpeed(e,t){const n=s.Deferred(),{autoRotation:o}=this.config,a=o.speed;let l=0;return i.transition().duration(t).each("start",()=>l++).tween("rotate",()=>t=>{this.setRotationSpeed(r.generalMathUtils.lerp(a,e,t))}).each("end",()=>{0==--l&&n.resolve(o.speed)}).transition(),n}autoRotate(){const{autoRotation:e}=this.config;if(this.shouldPerformRotation()){const t=this.planet.getProjection(),i=e.speed/e.fps,s=t.rotate(),n=[s[0],s[1]],r=a.CoordinatesUtils.add(n,a.CoordinatesUtils.multiply(e.direction,i)),[o,l]=a.CoordinatesUtils.normalize(r),c=[o,l,0];t.rotate(c),a.CoordinatesUtils.isEqual(r,c)||this.planet.onRotationChange.fire(c),this.lastRotation=Date.now()}this.animationFrameHandle=requestAnimationFrame(this.autoRotate.bind(this))}setupAutoRotation(){if(void 0!==this.animationFrameHandle&&cancelAnimationFrame(this.animationFrameHandle),this.planet.isPluginLoaded(l.AdvancedDragPlugin)){const e=this.planet.getPlugin(l.AdvancedDragPlugin);this.addCleanupFunction(e.onDragStart.subscribe(()=>{this.stopAutoRotation()}).cancel),this.addCleanupFunction(e.onDragEnd.subscribe(()=>{this.startAutoRotation()}).cancel)}this.autoRotate()}stopAutoRotation(){void 0!==this.animationFrameHandle&&cancelAnimationFrame(this.animationFrameHandle)}startAutoRotation(){this.stopAutoRotation(),this.autoRotate()}shouldPerformRotation(){const{autoRotation:e}=this.config,t=1/e.fps;return!this.lastRotation||this.lastRotation+t<Date.now()}centerOn(e,t){const i=Object.assign({},this.config.centerOn,t),s=this.planet.getProjection().rotate(),n={x:s[0],y:s[1]},r={x:-(e=a.CoordinatesUtils.normalize(e))[0],y:-e[1]};return this.setAnimationPlaying(!0).then(()=>this.startTransition(n,r,i.duration))}startTransition(e,t,n){const r=s.Deferred(),o={rotation:void 0,zoom:void 0},a=this.planet.getProjection().scale();let l,c=0;return i.transition().duration(n).each("start",()=>{o.rotation=i.interpolateObject(e,t),o.zoom=function(e){const t=e.length-1;return i=>{const s=i<=0?i=0:i>=1?(i=1,t-1):Math.floor(i*t),n=e[s],r=e[s+1],o=s>0?e[s-1]:2*n-r,a=s<t-1?e[s+2]:2*r-n;return function(e,t,i,s,n){const r=e*e,o=r*e;return((1-3*e+3*r-o)*t+(4-6*r+3*o)*i+(1+3*e+3*r-3*o)*s+o*n)/6}((i-s/t)*t,o,n,r,a)}}([a,this.getZoomOut(a,e,t),a]),0===c&&(l=Math.sign(o.rotation(.5).x-o.rotation(0).x),this.setRotationDirection([l,0])),c++}).tween("rotate",()=>e=>{const t=o.rotation(e),i=[t.x,t.y,0];this.planet.getProjection().rotate(i),this.planet.onRotationChange.fire(i);const s=o.zoom(e);this.planet.getProjection().scale(s)}).each("end",()=>{0==--c&&this.setAnimationPlaying(!1).then(()=>{const e=this.planet.getProjection().rotate();r.resolve([e[0],e[1]])})}).transition(),r}getZoomOut(e,t,i){const s=(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)||1,n=h*h/s;return Math.min(1,Math.max(d,n))*e}}}),define("plugins/advanced_zoom_plugin",["require","exports","d3","event","config/default_globe_component_config","plugins/planetary_plugin","plugins/navigation_plugin","math_utils"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AdvancedZoomPlugin=class extends r.PlanetaryPlugin{constructor(e,t,i){super(e,t,i),this.onZoomStart=new s.Event,this.onZoom=new s.Event,this.onZoomEnd=new s.Event,this.planet.canZoom=this.canZoom.bind(this),this.planet.getZoomFactor=this.getZoomFactor.bind(this),this.planet.getCancellationToken().registerCleanupFunction(()=>{this.onZoomStart.cancelAll(),this.onZoom.cancelAll(),this.onZoomEnd.cancelAll()})}onInit(){const{initialScale:e=n.defaultAdvancedZoomPluginConfig.initialScale,scaleExtent:t=n.defaultAdvancedZoomPluginConfig.scaleExtent}=this.config,s=i.behavior.zoom();null!==e&&void 0!==e&&(this.planet.getProjection().scale(e),this.onZoom.fire(this.planet.getProjection())),s.on("zoomstart",()=>{const e=i.event.sourceEvent;this.planet.canZoom(e)&&this.onZoomStart.fire(this.planet.getProjection())}).on("zoomend",()=>{const e=i.event.sourceEvent;this.planet.canZoom(e)&&this.onZoomEnd.fire(this.planet.getProjection())}).on("zoom",()=>{const e=i.event.sourceEvent;if(this.planet.canZoom(e)){const i=Math.sign(e.wheelDeltaY),s=a.generalMathUtils.clamp(this.planet.getProjection().scale()*(1+.125*i),t[0],t[1]);this.planet.getProjection().scale(s),this.onZoom.fire(this.planet.getProjection())}e.preventDefault(),e.stopPropagation()}),i.select(this.planet.getCanvasContainer()).call(s),this.addBehaviorEventListenersCleanup(s,["zoomstart","zoomend","zoom"])}canZoom(e){return!(!e||!e.wheelDeltaY)&&(!this.planet.isPluginLoaded(o.NavigationPlugin)||!this.planet.getPlugin(o.NavigationPlugin).isAnimationPlaying())}getZoomFactor(){const{initialScale:e=n.defaultAdvancedZoomPluginConfig.initialScale}=this.config;return this.planet.getProjection().scale()/e}}}),define("components/engine/synchronized_entity",["require","exports","plugins/advanced_zoom_plugin"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SynchronizedEntity=class{constructor(e,t){this.zoomFactor=1,this.planet=e,this.configuration=t,this.setupPluginEvents()}setupPluginEvents(){const{adjustZoom:e}=this.configuration;e&&this.planet.hasPlugin(i.AdvancedZoomPlugin)&&this.planet.getPlugin(i.AdvancedZoomPlugin).onZoom.subscribe(()=>{this.zoomFactor=this.planet.getZoomFactor()})}getZoomFactor(){return this.zoomFactor}}}),define("components/arc/arc_node",["require","exports","canvas_engine","utils/coordinates","reusable_utilities","math_utils","components/engine/synchronized_entity","map","plugins/navigation_plugin"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const c=2,d=1.5,h=4.25;t.ArcNode=class extends o.SynchronizedEntity{constructor(e,t,i,s){super(t,{adjustZoom:!0}),this.edgesToHide=[],this.edgesToShow=[],this.data=e,this.animationComponent=i,this.callbacks=s,this.outgoingEdges=new a.Map,this.incomingEdges=new a.Map,this.initializeValues(),this.initializeComponent(),this.setupEvents()}initializeValues(){this.currentValues={radius:0,radiusMultiplier:1,opacity:0,color:new n.Color(this.getData().getColor()).setAlpha(.75)},this.maxValues={radius:c,radiusMultiplier:2,opacity:1}}initializeComponent(){this.component=new i.CircleComponent(i.Presence.zeroTopLeft()),this.update()}setupEvents(){this.component.onMouseEnter.subscribe(()=>{this.callbacks.onClick&&this.changeCursor(i.Constants.Mouse.Cursor.Pointer),this.callbacks.onMouseEnter&&(this.stopRotation(),this.createPopover()),this.inflate(250).resetAndResume(),this.edgesToHide.forEach(e=>e.fadeOut()),this.edgesToShow.forEach(e=>e.fadeIn())}),this.component.onMouseLeave.subscribe(()=>{this.callbacks.onClick&&this.changeCursor(i.Constants.Mouse.Cursor.Default),this.callbacks.onMouseLeave&&this.callbacks.onMouseLeave(this.data),this.deflate(250).resetAndResume(),this.edgesToHide.forEach(e=>e.fadeIn()),this.edgesToShow.forEach(e=>e.fadeIn())}),this.callbacks.onClick&&this.component.onMouseClick.subscribe(()=>{this.callbacks.onClick(this.getData(),$(this.planet.engineCanvas)),this.callbacks.onMouseLeave&&this.callbacks.onMouseLeave(this.data)})}stopRotation(){if(this.planet.hasPlugin(l.NavigationPlugin)){const e=this.planet.getPlugin(l.NavigationPlugin);e.getConfig().enabled&&(e.setRotationSpeed(0),e.getConfig().enabled=!1)}}changeCursor(e){this.component.getStageFacade().setCursor(e)}calculateEdgeCache(e){this.edgesToShow.length+this.edgesToHide.length===0&&e.forEach(e=>{this.shouldShowEdgeOnHover(e)?this.edgesToShow.push(e):this.edgesToHide.push(e)})}shouldShowEdgeOnHover(e){const t=e.getSource().getId(),i=e.getTarget().getId();return this.outgoingEdges.has(i)||this.incomingEdges.has(t)&&this.getId()===i}update(){this.component.setStyle(i.Style.Radius,this.getCurrentRadius()).setStyle(i.Style.Color,this.getColor()).setStyle(i.Style.Opacity,this.getCurrentOpacity()),this.visible=s.CoordinatesUtils.isVisibleOnPlanet(this.data.getCoordinates(),this.planet),this.updateComponentPosition()}updateComponentPosition(){const e=this.planet.getProjection()(this.data.getCoordinates());this.component.getPresence().merge(s.CoordinatesUtils.toPoint(e))}getCurrentRadius(){return Math.min(this.currentValues.radius,this.maxValues.radius)*this.getZoomFactor()*this.currentValues.radiusMultiplier}getCurrentOpacity(){return this.isVisible()?Math.min(this.currentValues.opacity,this.maxValues.opacity):0}createPopover(){const e=this.component.getStageFacade().getActiveCamera().cameraToWindowCoordinates(this.component.getPresence().getAbsoluteX()-2,this.component.getPresence().getAbsoluteY()-this.getCurrentRadius()-6);this.callbacks.onMouseEnter(this.data,e,$(this.component.getStageFacade().getCanvas()))}isVisible(){return this.visible}getData(){return this.data}getComponent(){return this.component}getColor(){return this.currentValues.color}addOutgoingEdge(e,t){this.outgoingEdges.has(e.getId())||this.outgoingEdges.set(e.getId(),t)}addIncomingEdge(e,t){this.incomingEdges.has(e.getId())||this.incomingEdges.set(e.getId(),t)}getOutgoingEdgeCount(){return this.outgoingEdges.size}getIncomingEdgeCount(){return this.incomingEdges.size}adjustRadiusByClusterSize(e){this.maxValues.radius=r.generalMathUtils.clamp(c*this.data.getClusterSize()/e,d,h)}createInitialAnimation(e){return this.animationComponent.tween(this.currentValues,[{key:"radius",value:this.maxValues.radius,duration:e},{key:"opacity",value:1,duration:.25*e}])}inflate(e){return this.animationComponent.tween(this.currentValues,[{key:"radiusMultiplier",value:this.maxValues.radiusMultiplier,duration:e}])}deflate(e){return this.animationComponent.tween(this.currentValues,[{key:"radiusMultiplier",value:1,duration:e}])}getId(){return this.data.getClusterId()}getLevel(){return this.outgoingEdges.values()[0].getLevel()}setCenterOnAnimationDuration(e){this.centerOnDuration=e}getCenterOnAnimationDuration(){return this.centerOnDuration}}}),define("components/arc/arc_line",["require","exports","canvas_engine","reusable_utilities","math_utils","log","utils/coordinates","components/engine/synchronized_entity"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=.5*Math.PI,c=.05,d=.8;t.ArcLine=class extends a.SynchronizedEntity{constructor(e,t,i,s,n,r){super(s,{adjustZoom:!0}),this.data=e,this.source=t,this.target=i,this.skyProjection=n,this.animationComponent=r,this.source.addOutgoingEdge(this.target,this),this.target.addIncomingEdge(this.source,this),this.distance=d3.geo.distance(t.getData().getCoordinates(),i.getData().getCoordinates()),this.initializeValues(),this.initializeComponent(),this.initializeAnimations()}static generateArcId(e,t){return`${e.getData().getClusterId()}->${t.getData().getClusterId()}`}initializeValues(){this.currentValues={fillRatio:0,opacity:1,color:new s.Color(this.getData().getColor()).setAlpha(.95)},this.maxValues={opacity:1,fillRatio:1}}initializeComponent(){this.component=i.LineComponent.fromSourceTarget(i.Presence.zeroTopLeft(),i.Presence.zeroTopLeft(),i.Constants.Line.QUADRATIC_CURVE),this.component.setInteractiveState(!1),this.update()}initializeAnimations(){this.fadeAnimation=this.animationComponent.tween(this.currentValues,[{key:"opacity",value:c,duration:100}])}update(){this.component.setStyle(i.Style.BorderColor,this.getColor()).setStyle(i.Style.BorderThickness,this.getBorderThickness()).setStyle(i.Style.Opacity,this.getCurrentOpacity()),this.updateComponentPosition(),this.updateArrowHeads(),this.determineMaxFillRatio(),this.component.setStyle(i.Style.FillRatio,this.getCurrentFillRatio()),this.component.invalidate()}determineMaxFillRatio(){let e=1;this.target.isVisible()&&this.source.isVisible()||(e=this.findCurveEdgePoint()),this.maxValues.fillRatio=e}updateComponentPosition(){const e=this.planet.getProjection(),t=this.skyProjection.scale(),s=this.determineNewProjectionScale(t,this.distance),n=this.source.getData().getCoordinates(),r=this.target.getData().getCoordinates();this.skyProjection.scale(s);const a=e(n),l=this.skyProjection(this.findPositionAlongArc(n,r,.5)),c=e(r);this.skyProjection.scale(t);const d=o.CoordinatesUtils.toPoint(a),h=o.CoordinatesUtils.toPoint(l),u=o.CoordinatesUtils.toPoint(c),p=this.component.getPresence();if(this.source.isVisible()){const e=new i.Point(h.getX()-d.getX(),h.getY()-d.getY()),t=new i.Point(u.getX()-d.getX(),u.getY()-d.getY());p.merge(d),this.component.setLinePoints([e,t])}else{const e=new i.Point(h.getX()-u.getX(),h.getY()-u.getY()),t=new i.Point(d.getX()-u.getX(),d.getY()-u.getY());p.merge(u),this.component.setLinePoints([e,t])}this.component.compute()}updateArrowHeads(){this.component.clearArrowHeads(),this.source.isVisible()?this.target.isVisible()&&this.component.addArrowHead(8,Math.PI/6):this.component.addArrowHead(8,Math.PI/6,!0)}getCurrentOpacity(){return this.isVisible()?Math.min(this.currentValues.opacity,this.maxValues.opacity):0}getColor(){return this.currentValues.color}getBorderThickness(){return d*this.getZoomFactor()}getCurrentFillRatio(){return Math.min(this.currentValues.fillRatio,this.maxValues.fillRatio)}isVisible(){return this.target.isVisible()||this.source.isVisible()}getData(){return this.data}findPositionAlongArc(e,t,i=.5){return d3.geo.interpolate(e,t)(i)}determineNewProjectionScale(e,t){const i=e,s=Math.max(t,.2)/l,o=n.generalMathUtils.clamp(i*s,.9*i,i*l);return r.logService.verbose("Sky projection",void 0,{initialSkyScale:i,newScale:o,distance:t,factor:s}),o}findCurveEdgePoint(e=!1){const t=this.component.getPresence().getShapes()[0].getLookUpTable();if(!t||0===t.length)return 0;const i=this.planet.getProjection(),s=i.rotate();s[0]+=180,i.rotate(s);const n=(!0===e?_.findIndex:_.findLastIndex)(t,e=>{const t=[e.x+this.component.getPresence().getAbsoluteX(),e.y+this.component.getPresence().getAbsoluteY()];return!o.CoordinatesUtils.isVisibleOnPlanet(i.invert(t),this.planet)});return s[0]-=180,i.rotate(s),n/t.length}getComponent(){return this.component}getSource(){return this.source}getTarget(){return this.target}setLevel(e){this.level=e}getLevel(){return this.level}getIteration(){return this.data.getIteration()}createInitialAnimation(e){return this.animationComponent.tween(this.currentValues,[{key:"fillRatio",originalValue:0,value:1,duration:e}])}fadeOut(){this.fadeAnimation.isPlaying()&&this.fadeAnimation.isReversed()?this.fadeAnimation.reverse():(this.fadeAnimation.setReverseState(!1),this.fadeAnimation.resume())}fadeIn(){this.fadeAnimation.isPlaying()&&!this.fadeAnimation.isReversed()?this.fadeAnimation.reverse():(this.fadeAnimation.setReverseState(!0),this.fadeAnimation.resume())}}}),define("typings/planetaryjs_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("plugins/auto_center_plugin",["require","exports","plugins/planetary_plugin"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AutoCenterPlugin=class extends i.PlanetaryPlugin{onInit(){this.planet.autoCenter=this.center.bind(this),this.planet.autoCenter()}center(){const{width:e=this.planet.getCanvas().width,height:t=this.planet.getCanvas().height,padding:i=0}=this.config,s=Math.min(e-2*i,t-2*i),n=[this.config.centerWidth?e/2:s/2+i,this.config.centerHeight?t/2:s/2+i];this.planet.getProjection().scale(s/2).translate(n)}}}),define("plugins/places_plugin",["require","exports","d3","plugins/planetary_plugin","utils/coordinates","config/default_globe_component_config"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlacesPlugin=class extends s.PlanetaryPlugin{onInit(){const{file:e,loader:t}=this.config;this.loaded=!1,this.places=[],void 0!==t?this.loadPlacesViaFunction(t):void 0!==e&&this.loadPlacesFromUrl(e)}loadPlacesFromUrl(e){i.json(e,(t,i)=>{if(t)throw new Error("Could not load JSON "+e);this.setupPlaces(i)})}loadPlacesViaFunction(e){e().then(e=>{this.setupPlaces(e)})}setupPlaces(e){this.places=e;const t=this.places.map(e=>e.count);this.zoomRange=i.scale.log().domain([i.min(t),i.max(t)]).range([.95,1.25]),this.loaded=!0}onDraw(){void 0===this.initialScale&&(this.initialScale=this.planet.getProjection().scale()),this.isLoaded()&&this.places.length>0&&this.places.forEach(e=>{this.isPlaceVisible(e)&&this.drawPlace(e)})}addPlace(e){this.pruneExpiredTemporaryPlaces(),_.any(this.places,t=>e.name===t.name||e.coordinates===t.coordinates)||this.places.push(e)}pruneExpiredTemporaryPlaces(){this.places=this.places.filter(e=>void 0===e.ttl||e.ttl>Date.now())}drawPlace(e){const{coordinates:t,name:s}=e,n=this.config.palette,o=n.circles,a=n.text;this.planet.withSavedContext(e=>{if(o.stroke||o.fill){o.stroke&&(e.strokeStyle=o.stroke.toHex6()),o.fill&&(e.fillStyle=o.fill.toHex6());const s=i.geo.circle().origin(t).angle(1/6);e.beginPath(),this.planet.getPath().context(e)(s()),e.fill(),e.stroke()}if(a.stroke||a.fill){e.font=a.font||r.defaultGlobeComponentThemes.dark.places.text.font,e.textAlign="center",e.textBaseline="bottom",a.stroke&&(e.strokeStyle=a.stroke.toHex6()),a.fill&&(e.fillStyle=a.fill.toHex6());const i=this.planet.getProjection()(t);e.fillText(s,i[0],i[1])}})}isPlaceVisible(e){const{ttl:t,coordinates:i,count:s}=e;let r=!1;if(void 0!==t)r=t>Date.now();else{const e=this.planet.getProjection().scale(),t=(this.initialScale||e)/e;r=this.zoomRange(s)>=t}return!0===r&&n.CoordinatesUtils.isVisibleOnPlanet(i,this.planet)}}}),define("utils/draw_utility",["require","exports","d3","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={radius:1,fillColor:"#061b2e",alpha:1},r=2*Math.PI;class o{static drawCircle(e,t,i,s={}){const[a,l]=e.getProjection()(i),c=s.radius||n.radius;t.fillStyle=o.generateColorString(s.fillColor||n.fillColor,s.alpha||n.alpha),t.arc(a,l,c,0,r,!1),t.fill()}static drawParticle(e,t,i,s={}){const[r,a]=e.getProjection()(i),l=s.radius||n.radius;t.fillStyle=o.generateRadialColorGradient(t,r,a,l,s.fillColor||n.fillColor,s.alpha||n.alpha),t.fillRect(r-l,a-l,2*l,2*l)}static drawGeoCircle(e,t,s,r={}){const a=i.geo.circle().origin(s).angle(r.radius||n.radius);t.fillStyle=o.generateColorString(r.fillColor||n.fillColor,r.alpha||n.alpha),t.beginPath(),e.getPath().context(t)(a()),t.fill()}static drawArc(e,t,i,r={},a){const[l,c,d]=i;t.strokeStyle=this.generateColorString(n.fillColor,.66),t.beginPath(),t.moveTo(l.x,l.y),t.quadraticCurveTo(c.x,c.y,d.x,d.y),t.stroke(),o.debugMode&&(t.strokeStyle=s.Color.RED(.8).toRGBAString(),t.strokeRect(c.x,c.y,3,3),t.font="9px Arial",t.fillStyle=t.strokeStyle,t.fillText(a.scale,c.x+5,c.y))}static generateColorString(e,t){const s=i.rgb(e);return t&&1!==t?`rgba(${s.r},${s.g},${s.b},${t})`:`rgb(${s.r},${s.g},${s.b})`}static generateRadialColorGradient(e,t,s,n,r,o){const a=i.rgb(r),l=e.createRadialGradient(t,s,0,t,s,n);return l.addColorStop(0,`rgba(${a.r},${a.g},${a.b},${o})`),l.addColorStop(.5,`rgba(${a.r},${a.g},${a.b},${.75*o})`),l.addColorStop(1,`rgba(${a.r},${a.g},${a.b},0)`),l}}o.debugMode=!0,t.DrawUtility=o}),define("plugins/advanced_pings_plugin",["require","exports","plugins/planetary_plugin","config/default_globe_component_config","utils/draw_utility","reusable_utilities","utils/coordinates","plugins/places_plugin"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AdvancedPingsPlugin=class extends i.PlanetaryPlugin{constructor(e,t,i){super(e,t,i),this.pings=[],this.planet.addPing=this.addPing.bind(this)}onInit(){const{showPlaces:e,showInitialPings:t,spreadInitialPings:i,overridePingColors:s}=this.config,n=this.config.palette,o=!0===e&&this.planet.hasPlugin(a.PlacesPlugin);this.mediator.listen("GLOBE.PING",e=>{const{longitude:t,latitude:i,color:r,placeLabel:a}=e,l={color:s&&n.fill?n.fill:r},c=[t,i];this.planet.centerOn(c).then(()=>{this.savePing(c,l,o?a:void 0)})}),t&&(this.mediator.listen("GLOBE.INITIAL_PINGS",e=>{e.pings&&e.pings.length>0&&e.pings.forEach(e=>{let{longitude:t,latitude:a,color:l,placeLabel:c}=e;const d={color:s&&n.fill?n.fill:l};if(i){const e=.025;t+=r.MathUtils.getRandomRange(1-e,1+e,1e4)-1,a+=r.MathUtils.getRandomRange(1-e,1+e,1e4)-1}const h=[t,a];this.savePing(h,d,o?c:void 0)})}),this.mediator.dispatch("GLOBE.REQUEST_INITIAL_PINGS",{}))}savePing(e,t,i){this.planet.addPing(e,{color:t.color,ttl:t.ttl,angle:t.angle,alpha:1}),void 0!==i&&this.planet.getPlugin(a.PlacesPlugin).addPlace({coordinates:e,name:i,ttl:Date.now()+6e4})}onDraw(){const e=Date.now();this.pings=this.removeExpiredPings(this.pings,e),this.pings.length>0&&this.planet.withSavedContext(t=>{this.drawPings(t,e)})}removeExpiredPings(e,t){return e.filter(e=>{const{ttl:i,expireTime:s}=e.options,{columnDrawTime:n=0}=this.config;return t-e.time<Math.max(i,s,n)})}drawPings(e,t){this.pings.forEach(i=>{const s=t-i.time;this.drawPing(e,i,s)})}drawPing(e,t,i){const s=[t.lng,t.lat],r=i<t.options.ttl,o=i<t.options.expireTime&&this.areCoordinatesVisible(s);if(r||o){const{options:a}=t,{ttl:l,angle:c,color:d}=a,h=(1-i/l)*(this.config.maxAlpha||1),u=Math.min(i/l*c,c);if(r){const t=d3.geo.circle().origin(s).angle(u);e.fillStyle=d.setAlpha(h).toRGBAString(),e.beginPath(),this.planet.getPath().context(e)(t()),e.fill()}o&&n.DrawUtility.drawParticle(this.planet,e,s,{alpha:Math.min(t.options.expireTime/(1.25*i),.55),fillColor:d.toHex6(),radius:u})}}addPing(e,t={}){const i=this.config.options,n=e[0],r=e[1];t.color=t.color||i&&i.color||s.defaultPingOptions.color,t.angle=t.angle||i&&i.angle||s.defaultPingOptions.angle,t.ttl=t.ttl||i&&i.ttl||s.defaultPingOptions.ttl,t.expireTime=t.expireTime||i&&i.expireTime||s.defaultPingOptions.expireTime;const o={time:Date.now(),options:t,lng:n,lat:r};this.config.latitudeFirst&&(o.lat=n,o.lng=r),this.pings.push(o)}areCoordinatesVisible(e){return o.CoordinatesUtils.isVisibleOnPlanet(e,this.planet)}}}),define("plugins/activity_plugin",["require","exports","underscore","utils/draw_utility","utils/coordinates","plugins/planetary_plugin","math_utils"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ActivityPlugin=class extends r.PlanetaryPlugin{constructor(e,t,i){super(e,t,i),this.points={},this.planet.setActivity=this.setActivity.bind(this)}onDraw(){if(0===i(this.points).keys().length)return;const e=i(this.points).filter(e=>e.activity>0);e.length>0&&this.planet.withSavedContext(t=>{e.forEach(e=>{n.CoordinatesUtils.isVisibleOnPlanet(e.coordinates,this.planet)&&s.DrawUtility.drawParticle(this.planet,t,e.coordinates,{fillColor:e.options.color,radius:o.generalMathUtils.clamp(e.options.angle,.05),alpha:e.options.alpha})})})}setActivity(e,t,i){const s=n.CoordinatesUtils.generateId(e);this.points[s]={coordinates:e,activity:t,options:i}}}}),define("factories/planet_factory",["require","exports","core/planetaryjs"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlanetFactory=class{static createPlanet(){return i.planetaryJs.createPlanet()}}}),define("palette/globe_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("plugins/earth_plugin",["require","exports","topojson","plugins/planetary_plugin","config/default_globe_component_config"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n.defaultGlobeComponentThemes.light;t.EarthPlugin=class extends s.PlanetaryPlugin{constructor(e,t,i){super(e,t,_.assign({enabled:_.any(_.values(i),e=>e.enabled)},i)),this.initializePlugins()}initializePlugins(){const e=this.config,t=e.topojson,i=e.oceans||{},s=e.land||{},n=e.borders||{};this.initializeTopoJSON(t),this.initializeOceans(i),this.initializeLand(s),this.initializeBorders(n)}initializeTopoJSON(e){this.planet.onInit(t=>{if(e.world)this.world=e.world,setTimeout(t,0);else{const i=e.file||"world-110m.json";d3.json(i,(e,s)=>{if(e)throw new Error("Could not load JSON "+i);this.world=s,t()})}})}initializeOceans(e){this.planet.onDraw(()=>{const t=e.palette.fill||r.oceans.fill,i=t&&t.toHex6();this.planet.withSavedContext(e=>{e.beginPath(),this.planet.getPath().context(e)({type:"Sphere"}),e.fillStyle=i,e.fill()})})}initializeLand(e){this.land=null,this.planet.onInit(()=>{this.land=i.feature(this.world,this.world.objects.land)}),this.planet.onDraw(()=>{const t=e.palette,i=t.fill||r.land.fill,s=t.stroke||r.land.stroke,n=i&&i.toHex6(),o=s&&s.toHex6(),a=r.land.lineWidth;this.planet.withSavedContext(e=>{e.beginPath(),this.planet.getPath().context(e)(this.land),n&&(e.fillStyle=n,e.fill()),o&&(a&&(e.lineWidth=a),e.strokeStyle=o,e.stroke())})})}initializeBorders(e){this.borders=null;const t=(e,t)=>e.id!==t.id;this.planet.onInit(()=>{this.borders=i.mesh(this.world,this.world.objects.countries,t)}),this.planet.onDraw(()=>{const t=e.palette.stroke||r.borders.stroke,i=t&&t.toHex6();this.planet.withSavedContext(e=>{e.beginPath(),this.planet.getPath().context(e)(this.borders),e.strokeStyle=i,e.lineWidth=1,e.stroke()})})}}}),define("utils/projection",["require","exports","plugins/advanced_drag_plugin","plugins/advanced_zoom_plugin"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProjectionUtils=class{static createLinkedProjection(e,t){const{scaleFactor:n=1,synchronizeProjections:r=!0}=t,o=e.getProjection(),a=d3.geo.orthographic().rotate(o.rotate()).translate(o.translate()).clipAngle(o.clipAngle()).scale(o.scale()*n);return r&&(e.onRotationChange&&e.onRotationChange.subscribe(e=>{e&&a.rotate(e)}),e.isPluginLoaded(i.AdvancedDragPlugin)&&e.getPlugin(i.AdvancedDragPlugin).onDrag.subscribe(e=>{a.rotate(e.rotate())}),e.isPluginLoaded(s.AdvancedZoomPlugin)&&e.getPlugin(s.AdvancedZoomPlugin).onZoom.subscribe(e=>{a.scale(e.scale()*n)})),a}}}),define("plugins/arcs_plugin",["require","exports","d3","map","canvas_engine","plugins/planetary_plugin","utils/projection","data_structures","components/arc/arc_line","components/arc/arc_node","plugins/navigation_plugin","utils/coordinates","plugins/advanced_drag_plugin","canvas_chart_utilities","math_utils"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const m=2250,f=1250;t.ArcsPlugin=class extends r.PlanetaryPlugin{constructor(e,t,i){super(e,t,i),this.maxLevel=0,this.edges=new s.Map,this.nodes=new s.Map,this.sourceNodes=[],this.setupEvents()}setupEvents(){if(this.planet.hasPlugin(d.NavigationPlugin)){const e=this.planet.getPlugin(u.AdvancedDragPlugin),t=this.planet.getPlugin(d.NavigationPlugin);e.onDragStart.subscribeOnce(()=>{t.setRotationSpeed(0),t.getConfig().autoRotation.enabled=!1})}this.mediator.listen(p.LegendFragmentActions.LEGEND_MOUSEENTER,e=>{const t=parseInt(e,10);this.highlightArcsByLevel(t)}),this.mediator.listen(p.LegendFragmentActions.LEGEND_MOUSELEAVE,e=>{const t=parseInt(e,10);this.resetArcHighlighting(t)})}onInit(){this.sky=o.ProjectionUtils.createLinkedProjection(this.planet,{scaleFactor:1.5,synchronizeProjections:!0}),void 0!==this.config.model&&this.constructArcsFromNetworkModel()}constructArcsFromNetworkModel(){const e=new a.NetworkModel(this.config.model),t=this.config.callbacks;this.animationComponent=new n.AnimationComponent,this.planet.getCancellationToken().registerDisposable(this.animationComponent);let i=0;this.createIterationLevelMap(e),e.getNodeModels().forEach(e=>{if(!this.nodes.has(e.getClusterId())){const s=new c.ArcNode(e,this.planet,this.animationComponent,t);this.nodes.set(e.getClusterId(),s),this.getParentEntity().addComponent(s.getComponent()),i+=e.getClusterSize()}}),i/=this.nodes.size,e.getEdgeModels().forEach(e=>{const t=this.nodes.get(e.getOwner().getClusterId()),s=this.nodes.get(e.getTarget().getClusterId());if(void 0!==t&&void 0!==s){const n=l.ArcLine.generateArcId(t,s);if(t.adjustRadiusByClusterSize(i),s.adjustRadiusByClusterSize(i),!this.edges.has(n)){const i=new l.ArcLine(e,t,s,this.planet,this.sky,this.animationComponent),r=this.iterationLevelMap[e.getIteration()];i.setLevel(r),this.edges.set(n,i),this.getParentEntity().addComponent(i.getComponent())}}}),this.findIterationOrigins(),this.createInitialAnimation()}findIterationOrigins(){const e=[];this.edges.forEach(t=>{const i=t.getSource(),s=t.getTarget();i.calculateEdgeCache(this.edges),s.calculateEdgeCache(this.edges);const n=t.getLevel();e[n]=e[n]||[],e[n].push(i)}),e.forEach((e,t)=>{const i={},s=e.reduce((e,t)=>(i[t.getId()]=(i[t.getId()]||0)+1,i[e.getId()]<=i[t.getId()]?t:e));this.sourceNodes[t]=s})}createIterationLevelMap(e){const t=_(e.getEdgeModels()).chain().map(e=>e.getIteration()).uniq().sortBy().value();this.iterationLevelMap=_.object(t,_.range(0,t.length)),this.maxLevel=t.length}createInitialAnimation(){const{playInitialAnimation:e}=this.config;let t;this.timeline=new n.Timeline,this.planet.getCancellationToken().registerDisposable(this.timeline),this.sourceNodes.forEach((e,i)=>{const s=i*(f+((t=t||e).getCenterOnAnimationDuration()||0)),n=this.calculateCenterOnDuration(e,t);e.setCenterOnAnimationDuration(n),this.timeline.addCallback(()=>{this.planet.centerOn(h.CoordinatesUtils.add(e.getData().getCoordinates(),[0,-30]),{duration:n})},s),t=e});const i=[];this.sourceNodes.reduce((e,t,s)=>{const n=e+t.getCenterOnAnimationDuration();return i[s]=n,n},0),this.edges.forEach(e=>{const t=f-500,s=e.getSource().createInitialAnimation(250),n=e.getTarget().createInitialAnimation(250),r=e.createInitialAnimation(t),o=e.getLevel(),a=o*f+i[o];this.timeline.addSequence(s,a),this.timeline.addSequence(r,a+250),this.timeline.addSequence(n,a+t),e.getLevel()<this.maxLevel?this.planet.getCancellationToken().subscribeOnce(r.getAnimations()[0].onDone,this.addTargetPing.bind(this,e)):this.planet.getCancellationToken().subscribeOnce(this.timeline.onDone,this.addTargetPing.bind(this,e))}),e?this.startInitialAnimation():(this.timeline.syncToTimeline(this.planet.getTimeline(),!0),this.addEndPauseToTimeline(this.timeline,1e3),this.setComponentInteraction(!0))}calculateCenterOnDuration(e,t=e){const s=i.geo.distance(e.getData().getCoordinates(),t.getData().getCoordinates())/(.5*Math.PI);return g.generalMathUtils.clamp(s*m,300,m)}addEndPauseToTimeline(e,t){e.addSequence(this.animationComponent.getChainBase([t]),e.getDuration())}startInitialAnimation(){this.addEndPauseToTimeline(this.timeline,1500),this.setComponentInteraction(!1),this.disableGlobeRotation(),this.planet.getCancellationToken().subscribeOnce(this.timeline.onDone,()=>{this.setComponentInteraction(!0),this.enableGlobeRotation(5)}),this.timeline.playOverTime(this.calculateOptimalAnimationDuration(1500))}calculateOptimalAnimationDuration(e=1500){return this.maxLevel*(f+m)+e}setComponentInteraction(e){this.nodes.forEach(t=>t.getComponent().setInteractiveState(e))}disableGlobeRotation(){this.planet.hasPlugin(d.NavigationPlugin)&&this.planet.getPlugin(d.NavigationPlugin).setRotationSpeed(0)}enableGlobeRotation(e){this.planet.hasPlugin(d.NavigationPlugin)&&this.planet.getPlugin(d.NavigationPlugin).setRotationSpeed(e)}addTargetPing(e){this.planet.addPing(e.getTarget().getData().getCoordinates(),{angle:4.5,ttl:1500,expireTime:1500,color:e.getColor().clone()})}onDraw(){this.isLoaded()&&(this.edges.size>0||this.nodes.size>0)&&(this.nodes.forEach(e=>e.update()),this.edges.forEach(e=>e.update()))}highlightArcsByLevel(e){this.edges.forEach(t=>{t.getIteration()===e?t.fadeIn():t.fadeOut()})}resetArcHighlighting(e){this.edges.forEach(t=>{t.getIteration()!==e&&t.fadeIn()})}}}),define("entities/globe_entity",["require","exports","jquery","plugins/auto_center_plugin","plugins/places_plugin","plugins/navigation_plugin","plugins/advanced_pings_plugin","plugins/advanced_zoom_plugin","plugins/activity_plugin","plugins/advanced_drag_plugin","factories/planet_factory","plugins/earth_plugin","plugins/arcs_plugin"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GlobeEntity=class{constructor(e,t){this.cleanupFunctions=[],this.initialize(e,t)}initialize(e,t){this.globe=d.PlanetFactory.createPlanet(),this.config=e,this.mediator=e.mediator,this.globe.setTimeline(e.timeline),this.globe.setCanvasContainer(i(t).parent().get(0)),this.globe.setCancellationToken(e.cancellationToken),this.applyGeneralTheme(e.palette),this.loadPlugins(e),this.applyGeneralConfig(e.generalConfig),this.globe.draw(t)}applyGeneralConfig(e){this.globe.onInit(()=>{e.initialRotation&&this.globe.getProjection().rotate(e.initialRotation)})}applyGeneralTheme(e){_.forEach(_.keys(e),t=>{const i=e[t],s=this.config.plugins[t];s&&(s.palette=i)})}loadPlugins(e){const{places:t,navigation:i,zoom:d,pings:h,drag:p,autoCenter:g,activity:m,arcs:_}=e.plugins;this.loadEarthPlugin(e),this.loadPluginClass(l.ActivityPlugin,m),this.loadPluginClass(c.AdvancedDragPlugin,p),this.loadPluginClass(a.AdvancedZoomPlugin,d),this.loadPluginClass(s.AutoCenterPlugin,g),this.loadPluginClass(r.NavigationPlugin,i),this.loadPluginClass(n.PlacesPlugin,t),this.loadPluginClass(u.ArcsPlugin,_),this.loadPluginClass(o.AdvancedPingsPlugin,h)}loadEarthPlugin(e){const{oceans:t,land:i,borders:s,earth:n}=e.plugins,r={topojson:n,oceans:t,land:i,borders:s};this.globe.loadPlugin(h.EarthPlugin,this.mediator,r)}loadPluginClass(e,t){t&&t.enabled&&this.globe.loadPlugin(e,this.mediator,t)}destroy(){this.globe.stop(),this.globe.destroy(),this.cleanupFunctions.forEach(e=>e())}updateDimensions(e,t){this.getCanvas().width=e,this.getCanvas().height=t,this.globe.engineCanvas&&(this.globe.engineCanvas.width=e,this.globe.engineCanvas.height=t),this.globe.isPluginLoaded(s.AutoCenterPlugin)&&this.globe.autoCenter()}getCanvas(){return this.globe.getCanvas()}getPlanet(){return this.globe}getPlugins(){return this.globe.getPlugins()}}}),define("components/globe_component",["require","exports","react","flux","entities/globe_entity","canvas_engine","config/default_globe_component_config"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GlobeComponent=class extends s.BaseComponent{constructor(e){super(e),this.state={requireCanvasEngine:!1}}shouldComponentUpdate(e,t){return!this.areDimensionsEqual(this.props.dimensions,e.dimensions)||t.requireCanvasEngine!==this.state.requireCanvasEngine||!_.isEqual(e.plugins,this.props.plugins)}areDimensionsEqual(e,t){return e.width===t.width&&e.height===t.height}getWidth(){return this.props.dimensions.width}getHeight(){return this.props.dimensions.height}render(){return i.createElement("div",{className:"globe"},i.createElement("canvas",{className:"canvasChart",ref:this.initializeGlobe.bind(this)}),this.generateEngineCanvas())}initializeGlobe(e){if(e){const{plugins:t,palette:i,mediator:s,dimensions:n,timeline:r,cancellationToken:o}=this.props;this.globe?this.updateCanvasDimensions(n):(this.globe=this.createEntity(e,t,i,s,o,r),this.setState({requireCanvasEngine:this.isEngineRequired()}))}}generateEngineCanvas(){return this.state.requireCanvasEngine?i.createElement("canvas",{className:"engineCanvas canvas-hover-border",ref:e=>this.initializeEngine(e)}):null}initializeEngine(e){if(e){const t=this.globe.getPlanet();if(!t.engineCanvas){const i=this.getWidth(),s=this.getHeight(),{stage:n,camera:o,scene:a}=r.Stage.build(e,i,s,60,new r.StageSettings(1,0,[r.Constants.StageEvents.MouseDown,r.Constants.StageEvents.MouseUp,r.Constants.StageEvents.MouseLeave,r.Constants.StageEvents.MouseEnter,r.Constants.StageEvents.MouseMove,r.Constants.StageEvents.MouseWheel],this.props.scale));t.isStopped()?t.onInit(()=>{this.addEngineReferences(n,o,a)}):this.addEngineReferences(n,o,a)}this.updateCanvasDimensions(this.props.dimensions)}}addEngineReferences(e,t,i){const s=this.globe.getPlanet();s.stage=e,s.camera=t,s.scene=i,e.setScene(i),s.onDraw(()=>{e.processUpdate()})}isEngineRequired(){const e=this.props.plugins||o.defaultGlobeComponentPlugins;return _(e).any(e=>!0===e.requireCanvasEngine)}updateCanvasDimensions(e){const t=e.width,i=e.height;this.globe.updateDimensions(t,i)}createEntity(e,t=o.defaultGlobeComponentPlugins,i,s,r,a){return new n.GlobeEntity({width:this.getWidth(),height:this.getHeight(),plugins:t,palette:i,generalConfig:o.defaultGeneralConfig,mediator:s,cancellationToken:r,timeline:a},e)}componentWillUnmount(){this.globe&&this.globe.destroy()}}}),define("globe",["require","exports","components/globe_component","config/default_globe_component_config"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("animation/animate",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.animate=function(e,t,i){return new Promise(s=>{if(void 0!==i&&i.isCanceled())return void s();if(0===t)return e(1),void s();const n=Date.now();requestAnimationFrame(function r(){if(void 0!==i&&i.isCanceled())return void s();const o=Date.now()-n,a=o/t;o<t?(requestAnimationFrame(r),e(a)):(e(1),s())})})}}),define("animation/easings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{static linear(e){return e}static easeInSine(e){return-1*Math.cos(e*(Math.PI/2))+1}static easeOutSine(e){return Math.sin(e*(Math.PI/2))}static easeInOutSine(e){return-.5*(Math.cos(Math.PI*e)-1)}static easeInQuad(e){return e*e}static easeOutQuad(e){return e*(2-e)}static easeInOutQuad(e){return e<.5?2*e*e:(4-2*e)*e-1}static easeInCubic(e){return e*e*e}static easeOutCubic(e){const t=e-1;return t*t*t+1}static easeInOutCubic(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}static easeInQuart(e){return e*e*e*e}static easeOutQuart(e){const t=e-1;return 1-t*t*t*t}static easeInOutQuart(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t}static easeInQuint(e){return e*e*e*e*e}static easeOutQuint(e){const t=e-1;return 1+t*t*t*t*t}static easeInOutQuint(e){const t=e-1;return e<.5?16*e*e*e*e*e:1+16*t*t*t*t*t}static easeInExpo(e){return 0===e?0:Math.pow(2,10*(e-1))}static easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}static easeInOutExpo(e){if(0===e||1===e)return e;const t=2*e,i=t-1;return t<1?.5*Math.pow(2,10*i):.5*(2-Math.pow(2,-10*i))}static easeInCirc(e){const t=e/1;return-1*(Math.sqrt(1-t*e)-1)}static easeOutCirc(e){const t=e-1;return Math.sqrt(1-t*t)}static easeInOutCirc(e){const t=2*e,i=t-2;return t<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-i*i)+1)}static easeInBack(e,t=1.70158){return e*e*((t+1)*e-t)}static easeOutBack(e,t=1.70158){const i=e/1-1;return i*i*((t+1)*i+t)+1}static easeInOutBack(e,t=1.70158){const i=2*e,s=i-2,n=1.525*t;return i<1?.5*i*i*((n+1)*i-n):.5*(s*s*((n+1)*s+n)+2)}static easeInElastic(e,t=.7){if(0===e||1===e)return e;const i=e/1-1,s=1-t,n=s/(2*Math.PI)*Math.asin(1);return-Math.pow(2,10*i)*Math.sin((i-n)*(2*Math.PI)/s)}static easeOutElastic(e,t=.7){const i=1-t,s=2*e;if(0===e||1===e)return e;const n=i/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*s)*Math.sin((s-n)*(2*Math.PI)/i)+1}static easeInOutElastic(e,t=.65){const i=1-t;if(0===e||1===e)return e;const s=2*e,n=s-1,r=i/(2*Math.PI)*Math.asin(1);return s<1?Math.pow(2,10*n)*Math.sin((n-r)*(2*Math.PI)/i)*-.5:Math.pow(2,-10*n)*Math.sin((n-r)*(2*Math.PI)/i)*.5+1}static easeOutBounce(e){const t=e/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){const e=t-1.5/2.75;return 7.5625*e*e+.75}if(t<2.5/2.75){const e=t-2.25/2.75;return 7.5625*e*e+.9375}{const e=t-2.625/2.75;return 7.5625*e*e+.984375}}static easeInBounce(e){return 1-i.easeOutBounce(1-e)}static easeInOutBounce(e){return e<.5?.5*i.easeInBounce(2*e):.5*i.easeOutBounce(2*e-1)+.5}}t.EASING=i}),define("color/color",["require","exports","math_utils","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{get r(){return this.colorData.r}get g(){return this.colorData.g}get b(){return this.colorData.b}get a(){return this.colorData.a}set r(e){this.colorData.r=e}set g(e){this.colorData.g=e}set b(e){this.colorData.b=e}set a(e){this.colorData.a=e}constructor(e){this.colorData=e}static fromHex(e){"#"===e.charAt(0)&&(e=e.substring(1));const t=parseInt(e,16);switch(e.length){case 8:return new n(new i.Vector4D(t>>24&255,t>>16&255,t>>8&255,255&t));case 6:return new n(new i.Vector4D(t>>16&255,t>>8&255,255&t,255));case 4:return new n(new i.Vector4D(Math.round((t>>12&15)/15*255),Math.round((t>>8&15)/15*255),Math.round((t>>4&15)/15*255),Math.round((15&t)/.15)/100));case 3:return new n(new i.Vector4D(Math.round((t>>8&15)/15*255),Math.round((t>>4&15)/15*255),Math.round((15&t)/15*255),255));default:throw new Error("unsupported color string")}}static fromARGBString(e){const t=e.replace(/rgba\(|\)|\s/g,"").split(",").map(e=>Number(e));return new n(new i.Vector4D(t[0],t[1],t[2],255*t[3]))}static fromARGBHex(e){return"#"===e.charAt(0)&&(e=e.substring(1)),4===e.length?n.fromHex(e.substring(1)+e.substring(0,1)):8===e.length?n.fromHex(e.substring(2)+e.substring(0,2)):n.fromHex(e)}static lerp(e,t,r){return new n(new i.Vector4D(s.MathUtils.lerp(e.r,t.r,r),s.MathUtils.lerp(e.g,t.g,r),s.MathUtils.lerp(e.b,t.b,r),s.MathUtils.lerp(e.a,t.a,r)))}clone(){return new n(this.colorData.clone())}static hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}toHSL(){return n.RGBtoHSL(new i.Vector3D(this.r,this.g,this.b))}static fromHSL(e){const t=this.HSLtoRGB(e);return new n(new i.Vector4D(t.x,t.y,t.z,255))}static HSLtoRGB(e){const t=e.x,s=e.y,n=e.z;let r,o,a;if(0===s)r=o=a=n;else{const e=n<.5?n*(1+s):n+s-n*s,i=2*n-e;r=this.hue2rgb(i,e,t+1/3),o=this.hue2rgb(i,e,t),a=this.hue2rgb(i,e,t-1/3)}return new i.Vector3D(255*r,255*o,255*a)}static RGBtoHSL(e){const t=e.x/255,s=e.y/255,n=e.z/255,r=Math.max(t,s,n),o=Math.min(t,s,n);let a,l;const c=(r+o)/2;if(r===o)a=l=0;else{const e=r-o;switch(l=c>.5?e/(2-r-o):e/(r+o),r){case t:a=(s-n)/e+(s<n?6:0);break;case s:a=(n-t)/e+2;break;case n:a=(t-s)/e+4}a/=6}return new i.Vector3D(a,l,c)}setSaturation(e){const t=n.RGBtoHSL(new i.Vector3D(this.r,this.g,this.b));t.y=e;const s=n.HSLtoRGB(t);return this.r=s.x,this.g=s.y,this.b=s.z,this}getSaturation(){return n.RGBtoHSL(new i.Vector3D(this.r,this.g,this.b)).y}setLightness(e){const t=n.RGBtoHSL(new i.Vector3D(this.r,this.g,this.b));t.z=e;const s=n.HSLtoRGB(t);return this.r=s.x,this.g=s.y,this.b=s.z,this}getLightness(){return n.RGBtoHSL(new i.Vector3D(this.r,this.g,this.b)).z}darken(e){const t=this.colorData.a;return this.colorData.div(1+e),this.colorData.a=t,this}lighten(e){const t=this.colorData.a;return this.colorData.mul(1+e),this.colorData.a=t,this}static random(){return new n(new i.Vector4D(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),1))}invert(){return this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this}lerpTowards(e,t){return this.r=s.MathUtils.lerp(this.r,e.r,t),this.g=s.MathUtils.lerp(this.g,e.g,t),this.b=s.MathUtils.lerp(this.b,e.b,t),this.a=s.MathUtils.lerp(this.a,e.a,t),this}setOpacity(e){return this.a=255*e,this}toRGB(){return this.normalize(),`rgb(${this.r},${this.g},${this.b})`}toRGBA(){return this.normalize(),`rgba(${this.r},${this.g},${this.b},${this.a/255})`}toHex6(){this.normalize();const e=(65536*this.colorData.r+256*this.colorData.g+this.colorData.b).toString(16);return"#"+"0".repeat(6-e.length)+e}toString(){return this.toRGBA()}toHex8(){this.normalize();const e=(16777216*this.colorData.r+65536*this.colorData.g+256*this.colorData.b+this.colorData.a).toString(16);return"#"+"0".repeat(8-e.length)+e}toARGBHex8(){this.normalize();const e=(16777216*this.colorData.a+65536*this.colorData.r+256*this.colorData.g+this.colorData.b).toString(16);return"#"+"0".repeat(8-e.length)+e}normalize(){this.colorData.clamp(0,255),this.colorData.floor()}}t.Color=n}),define("animation/tween",["require","exports","animation/animate","math_utils"],function(e,t,i,s){"use strict";function n(e,t,n,r){const o=function(e,t){return Object.keys(t).map(t=>({initialValue:e[t],key:t}))}(e,t);return i.animate(i=>{const n=i;r&&r.easing&&(i=r.easing(i)),r&&r.onTick&&r.onTick(i),o.forEach(n=>{e[n.key]=s.generalMathUtils.lerp(n.initialValue,t[n.key],i)}),r&&r.onTick&&r.onTick(n)},n,r&&r.cancellationToken)}Object.defineProperty(t,"__esModule",{value:!0}),t.tweenObject=n,t.tweenVector2D=function(e,t,i,s){return n(e,{x:t.x,y:t.y},i,s)},t.tweenColor=function(e,t,i,s){return n(e,{r:t.r,g:t.g,b:t.b,a:t.a},i,s)},t.tween=function(e,t,n,r,o){const a=e[t];return i.animate(i=>{const r=i;o&&o.easing&&(i=o.easing(i)),o&&o.onTick&&o.onTick(i),function(e,t,i){const s=t.split(".");s.slice(0,-1).reduce((e,t)=>e[t],e)[s[s.length-1]]=i}(e,t,s.generalMathUtils.lerp(a,n,i)),o&&o.onTick&&o.onTick(r)},r,o&&o.cancellationToken)}}),define("animation/timeline",["require","exports","math_utils","event","color/color"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function r(e,t,i){const s=t.split(".");s.slice(0,-1).reduce((e,t)=>e[t],e)[s[s.length-1]]=i}t.Timeline=class extends s.EventEmitter{get isPlaying(){return this.internalIsPlaying}get progress(){return this.internalProgress}set progress(e){this.setProgress(e)}setProgress(e){this.internalProgress=e,this.computePlayTimestamp(),this.refresh(),this.emitEvent("progress",e)}get totalDuration(){return this.internalTotalDuration}constructor(e=[]){super(),this.tweens=e,this.recalculateDuration(),this.progress=0}addTweenModels(e){this.tweens.push.apply(this.tweens,e),this.tweens=_.sortBy(this.tweens,e=>e.duration+(e.offset||0)),this.recalculateDuration(),this.refresh()}getTweenModels(){return this.tweens}setTweenModels(e){this.tweens=e,this.recalculateDuration(),this.refresh()}playByTime(e){0!==e?(this.playbackSpeed=this.totalDuration/e,this.resume()):this.progress=1}play(e=1){return 0===e?this:(this.playbackSpeed=e,this.resume(),this)}pause(){this.internalIsPlaying=!1,cancelAnimationFrame(this.playback)}resume(){this.isPlaying||(this.internalIsPlaying=!0,this.computePlayTimestamp(),this.next())}refresh(){let e=this.tweens.length;const t=e;for(;e--;){const s=this.tweens[t-1-e];let o=this.computeProgress(s);if(o>=0&&o<=1){let e;o=this.computeIndividualProgress(s),void 0!==s.options&&s.options.onTick&&s.options.onTick(o),s.initialValue instanceof n.Color&&s.targetValue instanceof n.Color?((e=s.initialValue.clone()).r=i.generalMathUtils.lerp(e.r,s.targetValue.r,o),e.g=i.generalMathUtils.lerp(e.g,s.targetValue.g,o),e.b=i.generalMathUtils.lerp(e.b,s.targetValue.b,o),e.a=i.generalMathUtils.lerp(e.a,s.targetValue.a,o)):s.initialValue instanceof n.Color||s.targetValue instanceof n.Color||(e=i.generalMathUtils.lerp(s.initialValue,s.targetValue,o)),r(s.object,s.key,s.formatter?s.formatter(e):e),void 0!==s.options&&s.options.onAfterTick&&s.options.onAfterTick(o)}}}computeProgress(e){let t=0===e.duration?1:(this.playTimestamp-(e.offset||0))/e.duration;return 1===this.internalProgress&&(t=Math.min(t,this.internalProgress)),t}computeIndividualProgress(e){const t=this.computeProgress(e);return e.options&&e.options.easing?e.options.easing(t):t}computePlayTimestamp(){this.playTimestamp=this.progress*this.totalDuration}next(){this.lastFrameTime=performance.now(),this.playback=requestAnimationFrame(this.update.bind(this))}update(){const e=performance.now()-this.lastFrameTime;this.playTimestamp+=e*this.playbackSpeed,this.progress=i.generalMathUtils.clamp(this.playTimestamp/this.totalDuration,0,1),(0===this.progress||this.progress>=1)&&this.pause(),this.isPlaying?this.next():(this.emitEvent("done",this.progress),this.tweens.forEach(e=>{e.options&&e.options.onDone&&e.options.onDone()}))}recalculateDuration(){0===this.tweens.length?this.internalTotalDuration=0:this.internalTotalDuration=this.tweens.map(e=>e.duration+(e.offset||0)).reduce((e,t)=>Math.max(e,t))}}}),define("color/gradient",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Gradient=class{constructor(e,t,i){this.start=e,this.end=t,this.stops=i}get startX(){return this.start.x}get startY(){return this.start.y}get endX(){return this.end.x}get endY(){return this.end.y}get colorStops(){return this.stops}set startX(e){this.start.x=e}set startY(e){this.start.y=e}set endX(e){this.end.x=e}set endY(e){this.end.y=e}toCanvasGradient(e){const t=e.createLinearGradient(this.startX,this.startY,this.endX,this.endY);return this.colorStops.forEach(({position:e,color:i})=>{t.addColorStop(e,i.toString())}),t}}}),define("color/pattern",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.REPEAT="repeat",e.REPEAT_X="repeat-x",e.REPEAT_Y="repeat-y",e.NONE="no-repeat"}(t.PATTERN_REPEAT||(t.PATTERN_REPEAT={}));t.Pattern=class{constructor(e,t){this.image=e,this.repeat=t}}}),define("drawing/abstraction/abstract_draw_layer",["require","exports","math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDrawLayer=class{toSerializable(){return{width:this.width,height:this.height,constructorName:this.constructor.name}}getCenterPoint(){return new i.Vector2D(this.width/2,this.height/2)}getBottomLeftPoint(){return new i.Vector2D(0,this.height)}getBottomRightPoint(){return new i.Vector2D(this.width,this.height)}getBottomCenterPoint(){return new i.Vector2D(this.width/2,this.height)}getTopCenterPoint(){return new i.Vector2D(this.width/2,0)}getLeftCenterPoint(){return new i.Vector2D(0,this.height/2)}getRightCenterPoint(){return new i.Vector2D(this.width,this.height/2)}getTopRightPoint(){return new i.Vector2D(this.width,0)}get width(){return this.drawingContext.canvas.width}get height(){return this.drawingContext.canvas.height}get canvas(){return this.drawingContext.canvas}constructor(e){const t=document.createElement("canvas");t.width=e.x,t.height=e.y,this.drawingContext=t.getContext("2d"),this.transformation=i.Matrix3x3.fromArray([[1,0,0],[0,1,0],[0,0,0]])}resize(e,t){let i=!1;this.drawingContext.canvas.width!==e&&(this.drawingContext.canvas.width=e,i=!0),this.drawingContext.canvas.height!==t&&(this.drawingContext.canvas.width=e,i=!0),i&&this.applyTransformation(this.transformation)}setTransformation(e){this.transformation=e,this.applyTransformation(this.transformation)}translateBy(e){this.transformation.translateBy(e),this.applyTransformation(this.transformation)}translateTo(e){this.transformation.translateTo(e),this.applyTransformation(this.transformation)}getTransform(){return this.transformation.w.xy()}scaleBy(e,t){t&&this.transformation.translateBy(new i.Vector2D(-t.x,-t.y)),this.transformation.scaleBy(e),this.applyTransformation(this.transformation)}scaleTo(e,t){t&&this.transformation.translateBy(new i.Vector2D(-t.x,-t.y)),this.transformation.scaleTo(e),this.applyTransformation(this.transformation)}applyTransformation(e){this.transformation=e,this.drawingContext.setTransform(e.x.x,e.x.y,e.y.x,e.y.y,e.w.x,e.w.y)}}}),define("drawing/abstraction/camera",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Camera=class{constructor(e){this.settings=e,this.layerData=e.layers.map(e=>{let t;return t=e.isFixed?new e.layerType(e.size,e.layerOptions||{},e.resolutionScale):new e.layerType(e.size.mul(e.overscan||1),e.layerOptions||{},e.resolutionScale),{isFixed:e.isFixed,name:e.name,layer:t}})}dispose(){this.layerData.forEach(({layer:e})=>e.dispose())}toSerializable(){return{layerData:this.layerData.map(({layer:e,name:t,isFixed:i})=>({name:t,isFixed:i,layer:e.toSerializable()}))}}setTransformation(e){for(const t of this.layerData)t.isFixed||t.layer.setTransformation(e)}translateBy(e){for(const t of this.layerData)t.isFixed||t.layer.translateBy(e)}draw(){for(const e of this.layerData)e.layer.draw()}getLayerByName(e){const t=this.layerData.find(t=>t.name===e);return t?t.layer:void 0}translateTo(e){for(const t of this.layerData)t.isFixed||t.layer.translateTo(e)}scaleBy(e,t){for(const i of this.layerData)i.isFixed||i.layer.scaleBy(e,t)}scaleTo(e,t){for(const i of this.layerData)i.isFixed||i.layer.scaleTo(e,t)}}}),define("drawing/canvas_drawing_style",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BUTT="butt",e.ROUND="round",e.SQUARE="square"}(t.CanvasStyleLineCap||(t.CanvasStyleLineCap={}))}),define("drawing/drawables/interfaces/drawable_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/abstract_drawable",["require","exports","event","reusable_utilities","color/color"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDrawable=class extends i.EventEmitter{constructor(e){super(),this.isClippingMask=!1,this.drawableId=_.uniqueId(),this.additionalData=e.additionalData,this.name=e.name,this.styleData=e.style||{},this.children=e.children,this.onEnter=e.onEnter,this.onExit=e.onExit,this.inheritParentPosition=void 0===e.inheritParentPosition||e.inheritParentPosition,this.inheritParentOpacity=void 0!==e.inheritParentOpacity&&e.inheritParentOpacity,this.isClippingMask=e.isClippingMask||!1,this.cancellationToken=new s.CancellationToken,e.on&&this.initializeEvents(e.on)}getShape(){}get shape(){return this.getShape()}canDraw(){return 0!==this.styleData.opacity}initializeEvents(e){Object.keys(e).forEach(t=>{this.on(t,e[t])})}get boundingX(){return this.shape.getBoundingBox().x}get boundingY(){return this.shape.getBoundingBox().y}get boundingWidth(){return this.shape.getBoundingBox().width}get boundingHeight(){return this.shape.getBoundingBox().height}toSerializable(){return{constructorName:this.constructor.name,position:this.position.toJSON(),boundingX:this.boundingX,boundingY:this.boundingY,boundingWidth:this.boundingWidth,boundingHeight:this.boundingHeight,styleData:Object.keys(this.styleData).reduce((e,t)=>(e[t]=this.styleData[t]instanceof n.Color?this.styleData[t].toHex8():this.styleData[t],e),{}),children:this.children&&this.children.map(e=>e.toSerializable())}}getBoundingBox(){}dispose(){super.dispose(),this.cancellationToken.cancel()}}}),define("drawing/drawables/interfaces/drawable_image_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_image",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableImage=class extends s.AbstractDrawable{getShape(){return this.rectangle}get width(){return this.rectangle.width}set width(e){this.rectangle.width=e,this.setImageSize()}get height(){return this.rectangle.height}set height(e){this.rectangle.height=e,this.setImageSize()}get position(){return this.rectangle.position}set position(e){this.rectangle.position=e}setImageSize(){this.image.setAttribute("width",`${this.width}px`),this.image.setAttribute("height",`${this.height}px`)}constructor(e){super(e),this.image=e.image,this.rectangle=i.Rectangle.fromVectors(e.position,e.size),this.setImageSize()}draw(e,t){n.canvasDrawingUtilities.drawImage(e,this,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:!1,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.rectangle.getBoundingBox()}}}),define("drawing/drawables/interfaces/drawable_text_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NORMAL="normal",e.BOLD="bold"}(t.DrawableTextWeight||(t.DrawableTextWeight={})),function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(t.DrawableTextFontStyle||(t.DrawableTextFontStyle={})),function(e){e.START="start",e.END="end",e.LEFT="left",e.CENTER="center",e.RIGHT="right"}(t.DrawableTextAlign||(t.DrawableTextAlign={})),function(e){e.ALPHABETIC="alphabetic",e.TOP="top",e.HANGING="hanging",e.MIDDLE="middle",e.IDEOGRAPHIC="ideographic",e.BOTTOM="bottom"}(t.DrawableTextBaseline||(t.DrawableTextBaseline={}))}),define("drawing/drawables/drawable_text",["require","exports","math_utils","drawing/drawables/abstract_drawable","reusable_utilities","drawing/canvas_drawing_utilities","drawing/drawables/interfaces/drawable_text_settings"],function(e,t,i,s,n,r,o){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SansSerif="sans-serif",e.RobotoR='"RobotoR',e.RobotoB='"RobotoB"',e.twAwesome='"twAwesome"',e.CabinCondensedR='"CabinCondensedR"'}(a=t.DrawableTextFontFamily||(t.DrawableTextFontFamily={}));class l extends s.AbstractDrawable{constructor(e){super(e),this.internalText="",this.internalTextAlign=o.DrawableTextAlign.START,this.internalSize=10,this.internalFamily=a.RobotoR,this.internalWeight="",this.internalWidth=0,this.internalHeight=0,this.internalTextBaseline=o.DrawableTextBaseline.HANGING,this.internalFontStyle=o.DrawableTextFontStyle.NORMAL,this.internalPosition=e.position,this.batchUpdate(e)}toSerializable(){const e=super.toSerializable();return e.text=this.text,e.family=this.family,e.size=this.size,e.weight=this.weight,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.fontStyle=this.internalFontStyle,e}calculateDimensions(){this.internalShape=void 0;const e=this.shape;this.internalWidth=e.getBoundingBox().width,this.internalHeight=e.getBoundingBox().height}set fontStyle(e){this.internalFontStyle!==e&&(this.internalFontStyle=e,this.updateFontString(),this.calculateDimensions())}get fontStyle(){return this.internalFontStyle}set text(e){this.internalText!==e&&(this.internalText=e,this.calculateDimensions())}set textAlign(e){this.internalTextAlign!==e&&(this.internalTextAlign=e,this.calculateDimensions())}set textBaseline(e){this.internalTextBaseline!==e&&(this.internalTextBaseline=e,this.calculateDimensions())}set size(e){this.internalSize!==e&&(this.internalSize=e,this.updateFontString(),this.calculateDimensions())}set position(e){this.internalPosition=e,this.calculateDimensions()}set family(e){this.internalFamily!==e&&(this.internalFamily=e,this.updateFontString(),this.calculateDimensions())}set weight(e){this.internalWeight!==e&&(this.internalWeight=e,this.updateFontString(),this.calculateDimensions())}get textAlign(){return this.internalTextAlign}get textBaseline(){return this.internalTextBaseline}get text(){return this.internalText}get size(){return this.internalSize}get family(){return this.internalFamily}get weight(){return this.internalWeight}getBoundingBox(){return this.ensureShape(),this.internalShape.getBoundingBox()}createShapeThrottled(){this.createShape()}createShape(){this.internalShapeX=this.position.x,this.internalShapeY=this.position.y;const e=r.canvasDrawingUtilities.measureText(this.text,this.size,this.weight,this.family,this.textAlign,this.textBaseline),t=this.position.clone();switch(this.textBaseline){case o.DrawableTextBaseline.MIDDLE:case o.DrawableTextBaseline.TOP:t.y+=e.height+e.offsetTop;break;default:t.y+=e.height+e.offsetTop}this.textAlign===o.DrawableTextAlign.CENTER&&t.sub(new i.Vector2D(e.width/2,e.height)),this.internalShape=i.trigonometryUtils.rotateRectangle(new i.Rectangle(t,e.width,e.height),this.position,void 0!==this.styleData.rotationAngle?this.styleData.rotationAngle:0).getBoundingBox()}ensureShape(){if(void 0===this.internalShape)this.createShape();else if(this.internalShapeX!==this.position.x||this.internalShapeY!==this.position.y)if(void 0===this.internalShapeX||void 0===this.internalShapeY)this.createShapeThrottled();else{const e=this.internalShapeX-this.position.x,t=this.internalShapeY-this.position.y;this.internalShape.position.x-=e,this.internalShape.position.y-=t,this.internalShapeX=this.position.x,this.internalShapeY=this.position.y}}getShape(){return this.ensureShape(),this.internalShape}get width(){return this.internalWidth}get height(){return this.internalHeight}get position(){return this.internalPosition}get font(){return this.fontString}batchUpdate(e){this.internalText=e.text||this.text,this.internalFamily=e.family||this.internalFamily,this.internalTextAlign=e.textAlign||this.internalTextAlign,this.internalWeight=e.weight||this.internalWeight,this.internalSize=e.size||this.internalSize,this.internalTextBaseline=e.textBaseline||this.internalTextBaseline,this.internalFontStyle=e.fontStyle||this.internalFontStyle,this.updateFontString(),this.calculateDimensions()}updateFontString(){return this.fontString=[`${this.internalFontStyle}`,`${this.internalWeight}`,`${this.internalSize}px`,`${this.internalFamily}`].join(" "),this}draw(e,t){r.canvasDrawingUtilities.drawText(e,this,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}}__decorate([n.throttle(50,{leading:!0,trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],l.prototype,"createShapeThrottled",null),t.DrawableText=l}),define("drawing/drawables/interfaces/drawable_polygon_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_polygon",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawablePolygon=class extends s.AbstractDrawable{getShape(){return this.updatePath(),this._path}get width(){return this.rectangle.width}get height(){return this.rectangle.height}get position(){return this.rectangle.position}get points(){return this._points}set points(e){this._points=e}updatePath(){void 0===this._path?this._path=new i.Path(this.position,this.points,2):(this._path.position.merge(this.position),this._path.points=this.points)}updateRectangle(){let e=0,t=0,i=Number.MAX_VALUE,s=Number.MAX_VALUE;return this._points.forEach(n=>{t=Math.max(e,n.x),e=Math.max(e,n.y),s=Math.min(i,n.x),i=Math.min(i,n.y)}),this.rectangle.x=s,this.rectangle.y=i,this.rectangle.width=t-s,this.rectangle.height=e-i,this}constructor(e){super(e),this.points=e.points,this.rectangle=new i.Rectangle(i.Vector2D.zero(),0,0),this.updateRectangle()}draw(e,t){n.canvasDrawingUtilities.drawPolygon(e,this,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.rectangle.getBoundingBox()}}}),define("drawing/drawables/interfaces/drawable_line_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_line",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableLine=class extends s.AbstractDrawable{getShape(){return this.rectangle}get position(){return this.rectangle.position}get end(){return this._end}get start(){return this._start}set start(e){this._start=e,this.updateRecangle()}set end(e){this._end=e,this.updateRecangle()}updateRecangle(){this.rectangle.x=Math.min(this.start.x,this.end.x),this.rectangle.y=Math.min(this.start.y,this.end.y),this.rectangle.size.x=Math.max(this.start.x,this.end.x),this.rectangle.size.y=Math.max(this.start.y,this.end.y)}constructor(e){super(e),this._start=e.start,this._end=e.end,this.rectangle=i.Rectangle.fromVectors(new i.Vector2D(Math.min(e.start.x,e.end.x),Math.min(e.start.y,e.end.y)),new i.Vector2D(Math.max(e.start.x,e.end.x),Math.max(e.start.y,e.end.y)))}draw(e,t){n.canvasDrawingUtilities.drawLine(e,this,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.rectangle.getBoundingBox()}}}),define("drawing/drawables/drawable_curved_polygon",["require","exports","drawing/canvas_drawing_utilities","drawing/drawables/drawable_polygon"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableCurvedPolygon=class extends s.DrawablePolygon{draw(e,t){i.canvasDrawingUtilities.drawCurvedPolygon(e,this,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}}}),define("drawing/drawables/interfaces/drawable_arrow_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/canvas_drawing_utilities",["require","exports","math_utils","object_pool","color/gradient","color/pattern","reusable_utilities","drawing/drawables/interfaces/drawable_text_settings","drawing/drawables/interfaces/drawable_text_settings","log"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d{constructor(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.vectorPool=new s.Pool({initialSize:100,dynamic:!0,factory:()=>i.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_canvas_drawing_utilities"})}isFontLoaded(e){const t=$("<span>sdiofnsdaioubfns&#xf371;&#xf0b2;&#xf0f4;&#xf593;dilfubsdufbdsuifbsduifb&#xe643;&#xe609;&#xe601;&#xe611;uisdbfuisdbfidusbfiusdbf</span>");t.css({position:"absolute",opacity:0,fontFamily:"Arial",fontSize:100}),t.appendTo("body");const i=t.width();return t.css("font-family",`${e}, Arial`),new Promise(e=>{i!==t.width()&&(t.remove(),e());const s=setInterval(()=>{i!==t.width()&&(t.remove(),clearInterval(s),e())},10)})}getTextWidth(e,t,i=a.DrawableTextWeight.NORMAL,s="Impact",n=a.DrawableTextAlign.LEFT,r=l.DrawableTextBaseline.HANGING){const o=i+" "+t+"px "+s;return this.ctx.save(),this.ctx.font=o,Math.ceil(this.ctx.measureText(e).width)}measureText(e,t,i=a.DrawableTextWeight.NORMAL,s="Impact",n=a.DrawableTextAlign.LEFT,r=l.DrawableTextBaseline.HANGING){const o=i+" "+t+"px "+s;this.ctx.save(),this.ctx.font=o;const d=Math.ceil(this.ctx.measureText(e).width),h=3*t;if(0===d||0===h)return{width:0,height:0,offsetTop:0};let u;this.ctx.clearRect(0,0,d,h),this.canvas.width=2*d,this.canvas.height=h,this.ctx.font=o,this.ctx.textAlign=n,this.ctx.textBaseline=r,this.ctx.fillStyle="#C9C9C9",this.ctx.fillText(e,d,t);try{u=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}catch(i){return c.logService.warn(`Failed to get imageData while measuring ${e}. font: ${o}`),{width:d,height:t,offsetTop:0}}const p=u.data;let g,m;for(let e=0;e<p.length;e++)if(0!==p[e]){g=e;break}for(let e=p.length-1;e>0&&e>g;e--)if(0!==p[e]){m=e;break}const _=g?Math.floor(g/4/u.width):0,f=m?Math.floor(m/4/u.width):_;return this.ctx.restore(),{width:d,height:Math.floor(f-_),offsetTop:_-t}}clearCanvas(e){e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}clearCanvasAreaByShape(e,t){const i=t.getBoundingBox();e.clearRect(i.x,i.y,i.width,i.height)}checkDrawingOptions(e){if(!e.stroke&&!e.fill&&!e.clip)throw new Error("neither fill nor stroke are set, polygon can't be drawn")}drawArrow(e,t,i){this.checkDrawingOptions(i);const s=this.vectorPool.get(t.arrowLength,t.arrowLength);this.begin(e,s,i),e.beginPath();const n=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);e.moveTo(n.x,n.y);const r=this.vectorPool.getMany(4),[o,a,l,c]=r;o.setPolarCoordinates(t.arrowLength,t.direction+t.arrowAngle/2),a.setPolarCoordinates(t.arrowLength,t.direction-t.arrowAngle/2),c.merge(l.merge(n)),l.sub(o),c.sub(a),e.lineTo(l.x,l.y),e.moveTo(n.x,n.y),e.lineTo(c.x,c.y),this.applyFillAndStroke(e,i),this.vectorPool.recycleMany(r),this.vectorPool.recycle(s),this.vectorPool.recycle(n),this.end(e,i)}drawLine(e,t,i){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i),e.beginPath();const s=this.computePosition(t.start,i.drawStyle.offset,i.drawOffset),n=this.computePosition(t.end,i.drawStyle.offset,i.drawOffset);void 0!==i.drawStyle.lineWidth&&i.drawStyle.lineWidth%2==0||e.translate(.5,.5),e.moveTo(Math.round(s.x),Math.round(s.y)),e.lineTo(Math.round(n.x),Math.round(n.y)),e.translate(-.5,-.5),this.applyFillAndStroke(e,i),this.end(e,i)}drawCurvedPolygon(e,t,i){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i),e.beginPath();const s=t.points;void 0!==i.drawStyle.lineWidth&&i.drawStyle.lineWidth%2==0||e.translate(.5,.5),i.drawStyle.offset&&e.translate(i.drawStyle.offset.x,i.drawStyle.offset.y),i.drawOffset&&e.translate(i.drawOffset.x,i.drawOffset.y),e.lineJoin="miter";let n=-1;for(let t=1;t<s.length;t++){const i=s[t-1];0===t&&e.moveTo(Math.round(i.x),Math.round(i.y));const r=s[t],o=Math.round(i.y-r.y);if(n!==o||Math.abs(i.x-r.x)>20){const t=(i.x+r.x)/2,s=(i.y+r.y)/2,n=(t+i.x)/2,o=(t+r.x)/2;e.quadraticCurveTo(Math.round(n),Math.round(i.y),Math.round(t),Math.round(s)),e.quadraticCurveTo(Math.round(o),Math.round(r.y),Math.round(r.x),Math.round(r.y))}else e.lineTo(r.x,r.y);n=o}e.translate(-.5,-.5),this.applyFillAndStroke(e,i),this.end(e,i)}drawPolygon(e,t,i){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i),e.beginPath();const s=t.points;void 0!==i.drawStyle.lineWidth&&i.drawStyle.lineWidth%2==0||e.translate(.5,.5),e.lineJoin="miter";let n=s.length;const r=n;for(;n--;){const t=s[r-n-1],o=this.computePosition(t,i.drawStyle.offset,i.drawOffset);0===n?e.moveTo(Math.round(o.x),Math.round(o.y)):e.lineTo(Math.round(o.x),Math.round(o.y)),this.vectorPool.recycle(o)}e.translate(-.5,-.5),this.applyFillAndStroke(e,i),this.end(e,i)}drawRectangle(e,t,i){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i);const s=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);if(e.beginPath(),e.rect(s.x,s.y,t.width,t.height),this.shouldStroke(e,i)&&this.shouldFill(e,i)){this.stroke(e,i);const n=t.width>0?t.width-2:t.width+2,r=t.height>0?t.height-2:t.height+2,o=t.width>0?s.x+1:s.x-1,a=t.height>0?s.y+1:s.y-1;e.clearRect(o,a,n,r),e.rect(s.x,s.y,t.width,t.height),this.fill(e,i)}else this.applyFillAndStroke(e,i);this.vectorPool.recycle(s),this.end(e,i)}drawText(e,t,i){this.checkDrawingOptions(i);const s=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);this.begin(e,t.getBoundingBox().size,Object.assign({},i,{drawStyle:Object.assign({offset:s},i.drawStyle)})),e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,i.stroke&&e.strokeText(t.text,0,0),i.fill&&e.fillText(t.text,0,0),this.vectorPool.recycle(s),this.end(e,i)}drawImage(e,t,i){this.begin(e,t.getBoundingBox().size,i);const s=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);e.drawImage(t.image,s.x,s.y,t.width,t.height),i.stroke&&(e.beginPath(),e.rect(s.x,s.y,t.width,t.height),e.stroke()),this.vectorPool.recycle(s),this.end(e,i)}drawCircleSector(e,t,i,s=!1){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i);const n=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);e.translate(-t.radius,-t.radius),s&&e.moveTo(n.x+t.radius,n.y+t.radius),e.beginPath(),s||e.moveTo(n.x+t.radius,n.y+t.radius),e.arc(n.x+t.radius,n.y+t.radius,t.radius,t.startAngle,t.endAngle),s||e.closePath(),this.applyFillAndStroke(e,i),s&&e.closePath(),this.vectorPool.recycle(n),this.end(e,i)}drawCircle(e,t,i){this.checkDrawingOptions(i),this.begin(e,t.getBoundingBox().size,i);const s=this.computePosition(t.position,i.drawStyle.offset,i.drawOffset);e.beginPath(),e.arc(s.x+t.radius,s.y+t.radius,t.radius,0,2*Math.PI,!0),this.applyFillAndStroke(e,i),this.vectorPool.recycle(s),this.end(e,i)}static isColorTransparent(e){if("string"==typeof e){if("#"===e[0]&&e.length>7&&"0"===e[e.length-1]&&"0"===e[e.length-2])return!0;if((0===e.toLowerCase().indexOf("rgba(")||0===e.toLowerCase().indexOf("hsla("))&&0===parseFloat(e.substring(0,e.length-1).split(/,/g).pop()))return!0;if("transparent"===e.toLowerCase())return!0}return!1}shouldFill(e,t){return t.fill&&e.fillStyle&&!d.isColorTransparent(e.fillStyle)}shouldStroke(e,t){return t.stroke&&e.strokeStyle&&e.lineWidth>0&&!d.isColorTransparent(e.strokeStyle)}fill(e,t){this.shouldFill(e,t)&&e.fill()}stroke(e,t){this.shouldStroke(e,t)&&e.stroke()}applyFillAndStroke(e,t){this.stroke(e,t),this.fill(e,t),t.clip&&e.clip()}applyStyle(e,t,i){e.fillStyle="transparent",e.strokeStyle="transparent",void 0!==t.fillStyle&&(t.fillStyle instanceof n.Gradient?e.fillStyle=t.fillStyle.toCanvasGradient(e):t.fillStyle instanceof r.Pattern?e.fillStyle=e.createPattern(t.fillStyle.image,t.fillStyle.repeat):e.fillStyle=t.fillStyle.toString(),d.isColorTransparent(e.fillStyle)&&(e.fillStyle="transparent")),void 0!==t.lineDash&&e.setLineDash(t.lineDash),void 0!==t.strokeStyle&&t.lineWidth&&t.lineWidth>0?(e.strokeStyle=t.strokeStyle.toString(),d.isColorTransparent(e.strokeStyle)&&(e.strokeStyle="transparent")):e.strokeStyle="transparent",void 0!==t.shadowBlur&&(e.shadowBlur=t.shadowBlur,void 0!==t.shadowColor&&(e.shadowColor=t.shadowColor.toString())),void 0!==t.lineWidth&&(e.lineWidth=t.lineWidth),void 0!==t.offset&&e.translate(t.offset.x,t.offset.y),void 0!==t.origin&&e.translate(-t.origin.x*i.x,-t.origin.y*i.y),void 0!==t.scale&&e.scale(t.scale.x,t.scale.y),void 0!==t.rotationAngle&&e.rotate(t.rotationAngle),void 0!==t.opacity&&(e.globalAlpha=t.opacity),void 0!==t.lineCap&&(e.lineCap=t.lineCap)}begin(e,t,i={}){i.saveAndRestore&&!i.clip&&e.save(),i.drawStyle&&this.applyStyle(e,i.drawStyle,t)}end(e,t){t.saveAndRestore&&!t.clip&&e.restore()}computePosition(e,t,i){const s=this.vectorPool.get();return s.merge(e),t&&s.add(t),i&&s.add(i),s}}__decorate([o.memoize((e,t,i,s,n,r)=>`${e}|${t}|${i}|${s}|${n}|${r}`),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Number,Object,String,String,String]),__metadata("design:returntype",Object)],d.prototype,"measureText",null),__decorate([o.memoize(e=>`${"string"==typeof e?e:""}`),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Boolean)],d,"isColorTransparent",null),t.CanvasDrawingUtilities=d,t.canvasDrawingUtilities=new d}),define("drawing/drawables/interfaces/drawable_circle_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_circle",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableCircle=class extends s.AbstractDrawable{getShape(){return this.circle}get radius(){return this.circle.radius}set radius(e){this.circle.radius=e}get position(){return this.circle.position}constructor(e){void 0===e.style.origin&&(e.style.origin=new i.Vector2D(.5,.5)),super(e),this.circle=new i.Circle(e.position,e.radius)}canDraw(){return super.canDraw()&&0!==this.radius}draw(e,t){n.canvasDrawingUtilities.drawCircle(e,this.circle,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.circle.getBoundingBox()}}}),define("drawing/drawables/interfaces/drawable_circle_sector_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_circle_sector",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableCircleSector=class extends s.AbstractDrawable{constructor(e){super(e),this.onlyStrokeOutside=!1,this.onlyStrokeOutside=e.onlyStrokeOutside||!1,this.circleSector=new i.CircleSector(e.position,e.radius,e.startAngle,e.endAngle)}get shape(){return this.circleSector}get radius(){return this.circleSector.radius}set radius(e){this.circleSector.radius=e}get position(){return this.circleSector.position}get startAngle(){return this.circleSector.startAngle}set startAngle(e){this.circleSector.startAngle=e}get endAngle(){return this.circleSector.endAngle}set endAngle(e){this.circleSector.endAngle=e}draw(e,t){n.canvasDrawingUtilities.drawCircleSector(e,this.circleSector,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask},this.onlyStrokeOutside)}getBoundingBox(){return this.circleSector.getBoundingBox()}}}),define("drawing/composed_drawable_factories/drawable_pie_chart_factory",["require","exports","math_utils","drawing/drawables/drawable_circle","drawing/drawables/drawable_text","drawing/drawables/drawable_circle_sector","drawing/drawables/interfaces/drawable_text_settings"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawablePieChartFactory=class{static generatePieChart(e,t,a,l,c,d,h){let u=-i.trigonometryUtils.degreesToRadians(91);const p=a.map(({endAngle:e,style:s})=>{e-=i.trigonometryUtils.degreesToRadians(90);const n=new r.DrawableCircleSector({position:h?h.get(0,0):new i.Vector2D(0,0),radius:t,startAngle:u,endAngle:e,style:s,onlyStrokeOutside:c});return u=e,n});if(void 0!==l){const e=new n.DrawableText({position:h?h.get(0,0):new i.Vector2D(0,0),text:l,size:11,textAlign:o.DrawableTextAlign.CENTER,textBaseline:o.DrawableTextBaseline.MIDDLE,weight:o.DrawableTextWeight.BOLD,style:{opacity:1,fillStyle:"#ffffff"}}),s=1.5,r=1+.1*(l.length-1),a=Math.min(t*s*r/e.width,t*s*r/e.height);e.size*=a,d&&e.size>d&&(e.size=d),p.push(e)}return new s.DrawableCircle({position:e,radius:t,style:{fillStyle:"rgba(0,0,0,0)",opacity:0},children:p})}static scaleAngle(e,t,s,n){return i.generalMathUtils.linearScale({min:e,max:t},{min:0,max:s},n)}static getCircleSectorTween(e,t,i,s,n){return{object:e,key:i,targetValue:s,initialValue:n,duration:t}}static tweenToNewEndAngles(e,t,s){let n=0;return e.children.reduce((e,o,a)=>(o instanceof r.DrawableCircleSector&&(e=e.concat([{object:o,key:"startAngle",targetValue:i.trigonometryUtils.degreesToRadians(n)-i.trigonometryUtils.degreesToRadians(90),initialValue:o.startAngle,duration:s},{object:o,key:"endAngle",targetValue:i.trigonometryUtils.degreesToRadians(t[a])-i.trigonometryUtils.degreesToRadians(89),initialValue:o.endAngle,duration:s}]),n=t[a]),e),[])}static tweenPieChartAngle(e,t,s,n){const o=s.children.filter(e=>e instanceof r.DrawableCircleSector),[a,l]=o.reduce((e,t)=>[Math.min(e[0],t.startAngle),Math.max(e[1],t.endAngle)],[Number.MAX_VALUE,0]),c=t=>this.scaleAngle(a,l,e,t)-i.trigonometryUtils.degreesToRadians(90),d=e=>this.scaleAngle(a,l,t,e)-i.trigonometryUtils.degreesToRadians(90),h=_.flatten(o.map((e,t)=>{const s=_.partial(this.getCircleSectorTween,e,n),r=c(e.startAngle);let o=d(e.startAngle);const a=c(e.endAngle),l=d(e.endAngle),h=[s("startAngle",o-=i.trigonometryUtils.degreesToRadians(1),r),s("endAngle",l,a)];return e.startAngle=r,e.endAngle=a,h})),u=_.last(s.children);return 0===e?(h.push({object:u.styleData,key:"opacity",targetValue:1,initialValue:0,duration:n}),u.styleData.opacity=0):0===t&&(h.push({object:u.styleData,key:"opacity",targetValue:0,initialValue:1,duration:n}),u.styleData.opacity=1),h}}}),define("drawing/drawables/drawable_arrow",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableArrow=class extends s.AbstractDrawable{getShape(){return this.rectangle}get position(){return this.rectangle.position}constructor(e){super(e),this.direction=e.direction,this.arrowAngle=e.arrowAngle,this.arrowLength=e.arrowLength,this.rectangle=new i.Rectangle(e.position,e.arrowLength,e.arrowLength)}draw(e,t){n.canvasDrawingUtilities.drawArrow(e,{direction:this.direction,position:this.position,arrowAngle:this.arrowAngle,arrowLength:this.arrowLength},{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.rectangle.getBoundingBox()}}}),define("drawing/drawables/interfaces/drawable_rectangle_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("drawing/drawables/drawable_rectangle",["require","exports","math_utils","drawing/drawables/abstract_drawable","drawing/canvas_drawing_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawableRectangle=class extends s.AbstractDrawable{getShape(){if(this.rectangle&&(this.height<0||this.width<0)){let e;return e=this.internalShape?this.internalShape:this.rectangle.clone(),this.internalShape&&Math.abs(this.rectangle.width)===this.internalShape.width&&Math.abs(this.rectangle.height)===this.internalShape.height||(this.rectangle.width<0&&(e.width=Math.abs(this.rectangle.width),e.position.x-=e.width),this.rectangle.height<0&&(e.height=Math.abs(this.rectangle.height),e.position.y-=e.height),this.internalShape=e),this.internalShape}return this.rectangle}get width(){return this.rectangle.width}set width(e){this.rectangle.width=e}get height(){return this.rectangle.height}set height(e){this.rectangle.height=e}get position(){return this.rectangle.position}constructor(e){super(e),this.rectangle=i.Rectangle.fromVectors(e.position,e.size)}draw(e,t){n.canvasDrawingUtilities.drawRectangle(e,this.rectangle,{saveAndRestore:!0,drawStyle:this.styleData,stroke:void 0!==this.styleData.strokeStyle,fill:void 0!==this.styleData.fillStyle,drawOffset:t,clip:this.isClippingMask})}getBoundingBox(){return this.rectangle.getBoundingBox()}}}),define("drawing/layouts/list_layout",["require","exports","drawing/drawables/abstract_drawable","math_utils","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ListLayout=class extends i.AbstractDrawable{constructor(e){super({name:e.name,children:e.children,onEnter:()=>this.initialAnimation(),onExit:()=>this.closingAnimation()}),this.boundingbox=s.Rectangle.zero(),this.boundingbox.position=e.position,this.listLayoutSettings=e,this.recalculate()}get position(){return this.shape.position}getShape(){return this.boundingbox}addChild(e){this.children.push(e),e.onEnter?e.onEnter():this.listLayoutSettings.onEnter&&this.listLayoutSettings.onEnter.call(e)}async removeChild(e){const t=this.children.indexOf(e);-1!==t&&(e.onExit?e.onExit():this.listLayoutSettings.onExit&&this.listLayoutSettings.onExit.call(e),this.children.splice(t,1))}clearChildren(){return Promise.all(this.children.map(e=>this.removeChild(e)))}recalculate(){const e=s.Vector2D.zero();this.children.forEach((t,i)=>{t.position.merge(e),e.add(this.listLayoutSettings.distanceBetweenChildren)})}draw(e,t){}getBoundingBox(){return this.boundingbox}async initialAnimation(){const e=this.animationStart();for(const t of this.children){if(e.isCanceled())return;t.onEnter?t.onEnter():this.listLayoutSettings.onEnter&&this.listLayoutSettings.onEnter.call(t),await n.waitFor(this.listLayoutSettings.animationDelayBetweenChildren||0)}}async closingAnimation(){const e=[],t=this.animationStart();for(const i of this.children){if(t.isCanceled())return;i.onExit?e.push(i.onExit()):this.listLayoutSettings.onExit&&e.push(this.listLayoutSettings.onExit.call(i)),await n.waitFor(this.listLayoutSettings.animationDelayBetweenChildren||0)}await Promise.all(e)}animationStart(){return this.animationToken&&this.animationToken.cancel(),this.animationToken=new n.CancellationToken}}}),define("drawing/managed_drawing_layer",["require","exports","math_utils","drawing/canvas_drawing_utilities","drawing/abstraction/abstract_draw_layer","canvas_interaction_utils","animation/tween","object_pool"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends n.AbstractDrawLayer{constructor(e,t,i=1){super(e),this.interactionsEnabled=!1,this.interactionElements=[],this.resolutionScale=i,this.drawActivelyRequests=0,this.drawableObjects=[],t.autoComputeInteractionFrom&&this.enableInteractionsFrom(t.autoComputeInteractionFrom)}dispose(){void 0!==this.interactionEnhancer&&this.interactionEnhancer.dispose(),this.interactionElements.forEach(e=>{$(e).off("mousedown").off("mouseup").off("mouseleave").off("mousemove")}),this.interactionElements.length=0,this.drawableObjects.forEach(e=>e.dispose()),this.drawableObjects.length=0}get drawables(){return this.drawableObjects.slice()}setInteractionOffset(e,t){return void 0!==this.interactionLayer&&(this.interactionLayer.drawOffset.x=e,this.interactionLayer.drawOffset.y=t),this}setUpInteractions(){return this.interactionLayer=new r.MouseInteractionLayer,this.interactionEnhancer=new r.InteractionEnhancer(this.interactionLayer),this.interactionsEnabled=!0,this.interactionEnhancer}enableInteractionsFrom(e){this.setUpInteractions(),this.interactionElements.push(e),$(e).on("mousedown",e=>this.interactionEnhancer.mouseDown(e)).on("mouseup",e=>this.interactionEnhancer.mouseUp(e)).on("mouseleave",e=>this.interactionEnhancer.canvasLeave(e)).on("mousemove",e=>this.interactionEnhancer.mouseMove(e))}async addDrawable(e,t){this.drawableObjects.push(e),this.interactionsEnabled&&this.interactionLayer.shapes.push(e),e.onEnter&&await e.onEnter(t)}async clearDrawables(){for(;this.drawableObjects.length>0;)await this.removeDrawable(this.drawableObjects[0])}putChildOnTop(e,t){const i=t.indexOf(e);if(i>-1)return t.push(...t.splice(i,1)),!0;{let i=t.length;const s=i;for(;i--;){const n=t[s-1-i];if(void 0!==n.children&&this.putChildOnTop(e,n.children))return t.push(...t.splice(t.indexOf(n),1)),!0}}return!1}putDrawableOnTop(e){this.putChildOnTop(e,this.drawableObjects)}async removeDrawable(e,t){const i=this.drawableObjects.indexOf(e);if(-1!==i){if(e.onExit&&await e.onExit(t),t&&t.isCanceled())return;if(this.interactionsEnabled){const t=this.interactionLayer.shapes.indexOf(e);-1!==t&&this.interactionLayer.shapes.splice(t,1)}this.drawableObjects.splice(i,1)}}tween(e,t,i,s,n){const r=o.tween(e,t,i,s,n);return this.requestDrawWhile(r),r}tweenObject(e,t,i,s){const n=o.tweenObject(e,t,i,s);return this.requestDrawWhile(n),n}tweenColor(e,t,i,s){return this.tweenObject(e,{r:t.r,g:t.g,b:t.b,a:t.a},i,s)}tweenVector2D(e,t,i,s){return this.tweenObject(e,{x:t.x,y:t.y},i,s)}async requestDrawWhile(e){this.drawActivelyRequests++,this.requestDraw();try{await e}finally{this.drawActivelyRequests--}}requestDraw(){if(!this.pendingDraw){this.pendingDraw=!0;const e=this;requestAnimationFrame(function t(){e.drawActivelyRequests>0&&requestAnimationFrame(t),e.pendingDraw=!1,e.draw()})}}draw(){s.canvasDrawingUtilities.clearCanvas(this.drawingContext);let e=this.drawableObjects.length;const t=e;for(;e--;){const i=this.drawableObjects[t-1-e];this.drawingContext.save(),this.drawDrawable(i),this.drawingContext.restore()}}drawDrawable(e,t){if(this.drawingContext.save(),e.canDraw()&&e.draw(this.drawingContext,e.inheritParentPosition?t:i.Vector2D.zero()),e.children){const t=l.vectorPool.get();t.merge(e.position);let i=e.children.length;const s=i;for(;i--;){const n=e.children[s-i-1];n.inheritParentOpacity&&void 0!==e.styleData.opacity&&(n.styleData.opacity=e.styleData.opacity),this.drawDrawable(n,t)}l.vectorPool.recycle(t)}this.drawingContext.restore()}}l.vectorPool=new a.Pool({initialSize:10,dynamic:!0,factory:()=>i.Vector2D.zero(),metricName:"Vector2D_managed_drawing_layer"}),t.ManagedDrawingLayer=l}),define("graphics_utilities",["require","exports","animation/animate","animation/easings","animation/timeline","animation/tween","color/color","color/gradient","color/pattern","drawing/abstraction/abstract_draw_layer","drawing/abstraction/camera","drawing/canvas_drawing_style","drawing/canvas_drawing_utilities","drawing/composed_drawable_factories/drawable_pie_chart_factory","drawing/drawables/abstract_drawable","drawing/drawables/drawable_arrow","drawing/drawables/drawable_circle","drawing/drawables/drawable_circle_sector","drawing/drawables/drawable_curved_polygon","drawing/drawables/drawable_image","drawing/drawables/drawable_line","drawing/drawables/drawable_polygon","drawing/drawables/drawable_rectangle","drawing/drawables/drawable_text","drawing/drawables/interfaces/drawable_text_settings","drawing/layouts/list_layout","drawing/managed_drawing_layer"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T,I,w){"use strict";function A(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),A(i),A(s),A(n),A(r),A(o),A(a),A(l),A(c),A(d),A(h),A(u),A(p),A(g),A(m),A(_),A(f),A(y),A(b),A(E),A(S),A(C),A(v),A(T),A(I),A(w)}),define("classes/impact_graph_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/impact_graph_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/impact_graph_helpers",["require","exports","math_utils","graphics_utilities","object_pool"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vectorPool=new n.Pool({initialSize:0,dynamic:!0,factory:()=>i.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_impact_graph"}),t.createPopoverData=function(e,t){return{header:"",node:{color:t.color.toHex8(),label:t.label},values:t.popoverEntries.map(t=>({value:t.value,formatted_value:t.isPercentageBased?e.options.numberFormatter.toPercentage(t.value/100):e.options.numberFormatter.toDecimal(t.value),label:t.label}))}},t.createInitialAnimations=function(e){if(e.options.initialAnimationEnabled&&e.options.initialAnimationDuration>0){const t=e.options.initialAnimationDuration/2/e.bubbles.length;e.bubbles.forEach((i,n)=>{e.bubbleTransitions.push({object:i,key:"radius",targetValue:i.radius,initialValue:0,duration:e.options.initialAnimationDuration/2,offset:t*n,options:{easing:s.EASING.easeInOutBounce},drawable:i},{object:i.styleData,key:"opacity",targetValue:1,initialValue:0,duration:e.options.initialAnimationDuration/2,offset:t*n,options:{easing:s.EASING.easeInCubic},drawable:i}),i.radius=.1,i.styleData.opacity=0})}return e},t.createBubbles=function(e){return e.bubbles=_.sortBy(e.data.model.items.map(t=>e.createBubble(e,t)),e=>e.position.y),e},t.createTitle=function(e){e.title=new s.DrawableText({position:new i.Vector2D(e.translateValueToX(5,10,0),-e.margins.top),text:"Impact Score",family:s.DrawableTextFontFamily.RobotoR,size:11,textAlign:s.DrawableTextAlign.CENTER,style:{fillStyle:new s.Color(new i.Vector4D(123,134,134,255)),opacity:1,strokeStyle:"white",lineWidth:4}});const t=e.title.getBoundingBox();return e.title.children=[new s.DrawableRectangle({position:new i.Vector2D(-t.width/2,t.height+2),size:new i.Vector2D(t.width,4),style:{fillStyle:"white"}})],e.titleTransitions=[{object:e.title.position,key:"y",targetValue:e.title.position.y,initialValue:e.title.position.y+15,duration:e.options.initialAnimationDuration/2,offset:e.options.initialAnimationDuration/2,options:{easing:s.EASING.easeInCubic},drawable:e.title},{object:e.title.styleData,key:"opacity",targetValue:1,initialValue:0,duration:e.options.initialAnimationDuration/2,offset:e.options.initialAnimationDuration/2,options:{easing:s.EASING.easeInCubic},drawable:e.title}],e.title.position.y=e.title.position.y+15,e.title.styleData.opacity=0,e}}),define("classes/impact_graph",["require","exports","abstract_canvas_chart","graphics_utilities","math_utils","xstream","classes/impact_graph_helpers","reusable_utilities"],function(e,t,i,s,n,r,o,a){"use strict";var l;Object.defineProperty(t,"__esModule",{value:!0}),t.IMPACT_GRAPH_LAYER_TYPE=Object.assign({},i.CANVAS_GRID_CHART_LAYER_TYPE,{TITLE:"TITLE",BUBBLES:"BUBBLES"}),function(e){e.NORMAL="normal",e.HOVERED="hovered",e.FADED="faded"}(l||(l={}));class c extends i.CanvasGridChart{constructor(e,i){super(e,Object.assign({},i,{layers:t.IMPACT_GRAPH_LAYER_TYPE,layerConfigs:{[t.IMPACT_GRAPH_LAYER_TYPE.BUBBLES]:{enableInteractions:!0}}})),this.handleMediatorEvents()}handleLegendMouseEnter(e,t){void 0===this.clickedItemId&&e.forEach(e=>{e.additionalData.model.code===t.message?this.toggleDrawableAnimationState(e,l.HOVERED):this.toggleDrawableAnimationState(e,l.FADED)})}handleLegendMouseLeave(e,t){void 0===this.clickedItemId&&e.forEach(e=>{this.toggleDrawableAnimationState(e,l.NORMAL)})}handleLegendMouseClick(e,t){this.clickedItemId!==t.message?(e.forEach(e=>{e.additionalData.model.code===t.message?this.toggleDrawableAnimationState(e,l.HOVERED):this.toggleDrawableAnimationState(e,l.FADED)}),this.clickedItemId=t.message):(e.forEach(e=>{this.toggleDrawableAnimationState(e,l.NORMAL)}),this.clickedItemId=void 0)}handleMediatorEvents(){const e=this.options.mediatorStream.subscribe(i.CanvasChartUtils.createStreamListener(e=>{const i=this.getDrawablesForLayer(t.IMPACT_GRAPH_LAYER_TYPE.BUBBLES);switch(e.type){case"LEGEND_MOUSEENTER":this.handleLegendMouseEnter(i,e);break;case"LEGEND_MOUSELEAVE":this.handleLegendMouseLeave(i,e);break;case"LEGEND_MOUSECLICK":this.handleLegendMouseClick(i,e)}}));this.disposeToken.addCleanupFunction(()=>{e.unsubscribe()})}createBuildData(e,i){return{data:i,options:this.options,translateValueToY:this.translateValueToY.bind(this),translateValueToX:this.translateValueToX.bind(this),size:this.chartSize,margins:this.margins,bubbles:[],bubbleTransitions:[],titleTransitions:[],listener:e,init:0===this.getDrawablesForLayer(t.IMPACT_GRAPH_LAYER_TYPE.BUBBLES).length,createBubble:this.createBubble.bind(this)}}createBubble(e,t){const r=new s.DrawableCircle({position:new n.Vector2D(this.translateValueToX(t.xValue,100,-100),this.translateValueToY(e.data.model.grid.range.max-t.yValue,e.data.model.grid.range.max,0)),additionalData:{model:t},style:{fillStyle:t.color.toHex6(),strokeStyle:t.color.clone().setOpacity(.3).toRGBA(),lineWidth:0,opacity:1},on:{mouseenter:s=>{if(s.preventDefault(),void 0!==this.clickedItemId){if(this.clickedItemId===t.code&&this.options.isClickable){this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER);const n=$(s.target).offset(),a=n.left+r.position.x+this.margins.left-1,l=n.top+r.position.y+this.margins.top;this.openPopover(a,l,o.createPopoverData(e,t))}return}const n=$(s.target).offset(),a=n.left+r.position.x+this.margins.left-1,c=n.top+r.position.y+this.margins.top;this.openPopover(a,c,o.createPopoverData(e,t)),this.toggleDrawableAnimationState(r,l.HOVERED),this.options.isClickable&&this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER),e.listener.next({type:"WIDGET_MOUSEENTER",message:t.code})},mouseleave:s=>{if(s.preventDefault(),void 0!==this.clickedItemId)return this.clickedItemId===t.code&&this.options.isClickable&&this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),void this.closePopover();this.toggleDrawableAnimationState(r,l.NORMAL),this.options.isClickable&&this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),this.closePopover(),e.listener.next({type:"WIDGET_MOUSELEAVE",message:t.code})},mouseup:i=>{i.preventDefault(),this.mouseUpHandler(e,t,i.target)}},radius:10});return this.addDrawableAnimationStates(r,{[l.NORMAL]:[{path:"styleData.opacity",value:1,duration:200},{path:"styleData.lineWidth",value:0,duration:200}],[l.HOVERED]:[{path:"styleData.opacity",value:1,duration:200},{path:"styleData.lineWidth",value:9,duration:200}],[l.FADED]:[{path:"styleData.opacity",value:.15,duration:200},{path:"styleData.lineWidth",value:0,duration:200}]}),r}mouseUpHandler(e,t,i){void 0!==this.clickedItemId&&this.clickedItemId!==t.code||(this.options.isClickable&&this.openDrilldown(e.data.model.id,t.filters,i,t.requestedPageType),console.log("mouseup"))}initialize(){return r.Stream.createWithMemory({start:e=>{this.dataStream.map(this.createBuildData.bind(this,e)).map(o.createBubbles).map(o.createTitle).map(o.createInitialAnimations).subscribe(i.CanvasChartUtils.createStreamListener(async e=>{this.clickedItemId=void 0,await this.clearDrawables(t.IMPACT_GRAPH_LAYER_TYPE.BUBBLES),await this.clearDrawables(t.IMPACT_GRAPH_LAYER_TYPE.TITLE),this.addDrawable(t.IMPACT_GRAPH_LAYER_TYPE.TITLE,e.title),e.bubbles.forEach(e=>{this.addDrawable(t.IMPACT_GRAPH_LAYER_TYPE.BUBBLES,e)}),this.addTweens(e.bubbleTransitions),this.addTweens(e.titleTransitions),this.afterUpdate.fire()})),this.disposeToken.addCleanupFunction(()=>{this.afterUpdate.fire()})},stop:()=>{}})}update(e){return super.update(e),this}async animate(){await super.animate()}dispose(){super.dispose()}}__decorate([a.throttle(50,{leading:!1,trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object,HTMLElement]),__metadata("design:returntype",void 0)],c.prototype,"mouseUpHandler",null),t.ImpactGraph=c}),define("impact_graph",["require","exports","classes/impact_graph"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("types/influencer_contact_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("utils/influencer_contact_item_icon_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.influencerContactItemIconUtils=new class{getIconByAddressType(e){switch(e){case"HOME":return"fa fa-home";case"WORK":return"fa fa-briefcase";default:return"fa fa-building"}}getIconByPhoneType(e){switch(e){case"FAX":return"fa fa-fax";case"HOME":return"fa fa-home";case"MOBILE":return"fa fa-mobile";case"OTHER":default:return"fa fa-phone"}}getIconByOtherType(e){switch(e){case"EMAIL":return"fa fa-envelope-o";case"SKYPE":return"fa fa-skype";case"WEB_SITE":return"fa fa-external-link";default:return"fa fa-address-card-o"}}getIconByMediaType(e){switch(e){case"blog":return"sma-logo fa fa-rss";case"socialmedia_facebook":return"sma-logo fa fa-facebook-official";case"socialmedia_instagram":return"sma-logo fa fa-instagram";case"socialmedia_linkedin":return"sma-logo fa fa-linkedin-square";case"socialmedia_pinterest":return"sma-logo fa fa-pinterest";case"socialmedia_twitter":return"sma-logo fa fa-twitter";case"socialmedia_youtube":return"sma-logo fa fa-youtube";default:return"fa fa-users"}}createIconStyleForMediaType(e,t){switch(e){case"blog":case"socialmedia_facebook":return{color:t};case"socialmedia_instagram":return{background:t,color:"white"};case"socialmedia_linkedin":case"socialmedia_twitter":case"socialmedia_youtube":default:return{color:t}}}buildIconStyles(e,i,s){return"media_contact"===e&&void 0!==s?t.influencerContactItemIconUtils.createIconStyleForMediaType(i,s):void 0}}}),define("utils/influencer_contact_item_utils",["require","exports","log","underscore","utils/influencer_contact_item_icon_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.influencerContactItemUtils=new class{updateContactItem(e,t){switch(e.type){case"address":this.updateAddress(e,t);break;case"phone":this.updatePhoneNumber(e,t);break;case"media_contact":this.updateMediaContact(e,t);break;case"other_contact":this.updateOtherContact(e,t);break;default:i.logService.error("No matching type found for influencer contact type !")}}buildSaveRequestPayload(e,t){switch(t){case"address":return this.buildAddressSaveRequestPayload(e,t);case"phone":return this.buildPhoneNumberSaveRequestPayload(e,t);case"media_contact":return this.buildMediaContactSaveRequestPayload(e,t);case"other_contact":return this.buildOtherContactSaveRequestPayload(e,t);default:return void i.logService.error("No matching type found for influencer contact type !")}}createContactContainerByType(e,t){switch(e){case"address":return this.createAddressContainer(t);case"phone":return this.createPhoneNumberContainer(t);case"media_contact":return this.createMediaContactContainer(t);case"other_contact":return this.createOtherContactContainer(t);default:return void i.logService.error("No matching type found for influencer contact type !")}}createContactItemForContainer(e,t,s=!1,n){switch(e.type){case"address":return this.createAddressContactItem(e,t);case"phone":return this.createPhoneContactItem(e,t);case"media_contact":return this.createMediaContactItem(e,t,s,n);case"other_contact":return this.createOtherContactItem(e,t);default:return void i.logService.error("No matching type found for influencer contact type !")}}retrieveContactContainerByType(e,t){switch(e){case"address":return t.address_contact_container;case"phone":return t.phone_contact_container;case"media_contact":return t.media_contact_container;case"other_contact":return t.other_contact_container;default:return void i.logService.error("No matching type found for influencer contact type !")}}filterAddressContainersByType(e,t){return t.filter(t=>t.address_type===e)}filterOhterContainersByType(e,t){return t.filter(t=>t.contact_type===e)}filterMediaContainersByType(e,t){return t.filter(t=>t.media_contact_type===e)}buildDefaultContactItem(e,t,i=!1,r){return{id:s.uniqueId("default-contact-item"),subType:t,type:e,editMode:!0,text:"",isNew:!0,icon:"media_contact"===e&&!0===i?n.influencerContactItemIconUtils.getIconByMediaType(t):void 0,iconStyles:n.influencerContactItemIconUtils.buildIconStyles(e,t,r)}}buildAddressSaveRequestPayload(e,t){return{address_contact_container:e,type:t}}buildPhoneNumberSaveRequestPayload(e,t){return{phone_contact_container:e,type:t}}buildMediaContactSaveRequestPayload(e,t){return{media_contact_container:e,type:t}}buildOtherContactSaveRequestPayload(e,t){return{other_contact_container:e,type:t}}updateAddress(e,t){const i=t;i.address=e.text,i.address_type=e.subType}updatePhoneNumber(e,t){const i=t;i.phone_number=e.text,i.phone_type=e.subType}updateMediaContact(e,t){const i=t;i.media_contact_link=e.text,i.media_contact_type=e.subType}updateOtherContact(e,t){const i=t;i.value=e.text,i.contact_type=e.subType}createAddressContainer(e){return{contact_object_id:e.id,address:e.text,type:"address",address_type:e.subType}}createPhoneNumberContainer(e){return{contact_object_id:e.id,phone_number:e.text,type:"phone",phone_type:e.subType}}createMediaContactContainer(e){return{contact_object_id:e.id,media_contact_link:e.text,type:"media_contact",media_contact_type:e.subType}}createOtherContactContainer(e){return{contact_object_id:e.id,value:e.text,type:"other_contact",contact_type:e.subType}}createAddressContactItem(e,t){return{id:e.contact_object_id,text:e.address,type:e.type,subType:e.address_type,editMode:t}}createMediaContactItem(e,t,i,s){return{id:e.contact_object_id,icon:!0===i?n.influencerContactItemIconUtils.getIconByMediaType(e.media_contact_type):void 0,iconStyles:n.influencerContactItemIconUtils.buildIconStyles(e.type,e.media_contact_type,s),text:e.media_contact_link,type:e.type,subType:e.media_contact_type,editMode:t}}createPhoneContactItem(e,t){return{id:e.contact_object_id,text:e.phone_number,type:e.type,subType:e.phone_type,editMode:t}}createOtherContactItem(e,t){return{id:e.contact_object_id,text:e.value,type:e.type,subType:e.contact_type,editMode:t}}}}),define("influencer_contacts",["require","exports","utils/influencer_contact_item_icon_utils","utils/influencer_contact_item_utils"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/influencer_network_node_model",["require","exports","graphics_utilities","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkNodeModel=class{constructor(e){this.id=e.author_i_d,this.longName=e.author_long_name,this.shortName=e.author_short_name,this.colorPalette=e.display_meta_data.map(e=>({order:e.order,color:i.Color.fromARGBHex(e.color)})),this.numFollowers=e.followers,this.image_url=e.image_url,this.isInfluencer=e.influencer,this.profileUrl=e.profile_url,this.shape=new s.Circle(new s.Vector2D(e.x,e.y),e.size/2),this.totalCrowdSize=e.total_crowd_size,this.matchingObjects=e.matching_source_panels.concat(e.matching_topics_or_channels),this.source={id:this.id,id_hash:this.id,name:this.longName,author:!0,user_rating:e.userRating,favorite:e.favorite,show_only_block_option:!1,show_option_to_add_to_source_panel:!1,url:"",blockable:!1,source_panel_entry:{name:this.longName,mapped_id:this.id,source_id:this.id,author:!0,exact_match:!0}}}removeMatchingObjectById(e){this.matchingObjects=this.matchingObjects.filter(t=>t.id!==e)}toggleMatchingObject(e,t){return this.matchingObjects.some(t=>t.id===e)?(this.removeMatchingObjectById(e),!1):(this.matchingObjects.push({id:e,type:t,label:""}),!0)}}}),define("models/influencer_network_link_model",["require","exports","graphics_utilities","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkLinkModel=class{constructor(e,t,n){this.startNode=t,this.endNode=n,this.entryId=e.entry_id,this.colorPalette=e.display_meta_data.map(e=>({order:e.order,color:i.Color.fromARGBHex(e.color)})),this.type=e.interaction_type,this.interactions={sourceTarget:void 0,targetSource:void 0},e.interactions.source_target&&(this.interactions.sourceTarget=e.interactions.source_target.map(e=>({type:e.interaction_type,entryId:e.entry_id,engagement:e.engagement,reach:e.reach}))),e.interactions.target_source&&(this.interactions.targetSource=e.interactions.target_source.map(e=>({type:e.interaction_type,entryId:e.entry_id,engagement:e.engagement,reach:e.reach})));const r=s.Vector2D.createConnectingVector(this.startNode.shape.position,this.endNode.shape.position),o=r.clone().flip();this.line=new s.Line(this.startNode.shape.position.clone().add(s.Vector2D.fromPolarCoordinates(this.startNode.shape.radius,r.getDirectionAngle())),this.endNode.shape.position.clone().add(s.Vector2D.fromPolarCoordinates(this.endNode.shape.radius,o.getDirectionAngle())))}}}),define("models/influencer_network_hashtag_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkHashtagModel=class{constructor(e,t,i){this.code=e.code,this.color=e.color,this.label=e.label,this.cells=_.map(t,(t,i)=>({name:t.data_columns[0].name,code:t.data_columns[0].code,value:e.cells[i].value.numeric_data})),this.authors=i}}}),define("classes/influencer_network_layout",["require","exports"],function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEFAULT="INFLUENCERS_NETWORK",e.SIDEBAR_HIDDEN="INFLUENCERS_NETWORK_GRAPH",e.GRAPH_HIDDEN="INFLUENCERS_NETWORK_INFLUENCERS",e.INFLUENCER_ONE="INFLUENCERS_NETWORK_I_ONE"}(i=t.InfluencerNetworkLayout||(t.InfluencerNetworkLayout={})),t.INFLUENCER_NETWORK_FRAGMENT_LAYOUTS=[{id:i.DEFAULT,widthScalePriority:1.55,heightScalePriority:1,minWidth:0,minHeight:0},{id:i.SIDEBAR_HIDDEN,widthScalePriority:1,heightScalePriority:1,minWidth:0,minHeight:0},{id:i.GRAPH_HIDDEN,widthScalePriority:0,heightScalePriority:0,minWidth:0,minHeight:0},{id:i.INFLUENCER_ONE,widthScalePriority:1.55,heightScalePriority:1,minWidth:0,minHeight:0}],t.INFLUENCER_NETWORK_SIDEBAR_FRAGMENT_LAYOUTS=[{id:i.DEFAULT,widthScalePriority:0,heightScalePriority:1,minHeight:36,minWidth:480},{id:i.SIDEBAR_HIDDEN,widthScalePriority:0,heightScalePriority:0,minWidth:0,minHeight:0},{id:i.GRAPH_HIDDEN,widthScalePriority:1,heightScalePriority:1,minWidth:1,minHeight:1},{id:i.INFLUENCER_ONE,widthScalePriority:0,heightScalePriority:1,minHeight:36,minWidth:480}]}),define("models/influencer_network_model",["require","exports","models/influencer_network_node_model","models/influencer_network_link_model","math_utils","models/influencer_network_hashtag_model","map"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkModel=class{constructor(e,t){this.nodes={},this.maxX=Number.MIN_VALUE,this.minX=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE,this.minY=Number.MAX_VALUE,this.generationTs=e.getPayloadValue().task_information.generation_ts;const a=e.getPayloadValue().graph.meta_data.attributes.bounding_box;this.widget=e,this.layout=t,this.boundingBox=new n.Rectangle(new n.Vector2D(a.top_left_x,a.top_left_y),a.bottom_right_x-a.top_left_x,a.bottom_right_y-a.top_left_y),this.sourcePanelItems=new o.Map,this.topicAndChannelItems=new o.Map,this.nodes=_.mapObject(e.getPayloadValue().graph.vertices,e=>{this.maxX=Math.max(this.maxX,e.x),this.minX=Math.min(this.minX,e.x),this.maxY=Math.max(this.maxY,e.y),this.minY=Math.min(this.minY,e.y);const t=new i.InfluencerNetworkNodeModel(e);return t.matchingObjects.forEach(e=>{"SOURCE_PANEL"===e.type?this.addToMapArray(this.sourcePanelItems,e.id,t.id):this.addToMapArray(this.topicAndChannelItems,e.id,t.id)}),t}),this.links=_.map(e.getPayloadValue().graph.edges,e=>new s.InfluencerNetworkLinkModel(e,this.nodes[e.start_uid],this.nodes[e.end_uid]));const l=e.getPayloadValue().hashtags;this.hashtags=new o.Map,l.rows.forEach(e=>{const t=new r.InfluencerNetworkHashtagModel(e,l.column_groups,l.meta_data.attributes.hashtag_author_map.hashtag_to_author[e.label]);this.hashtags.set(t.label,t)}),this.history=e.getPayloadValue().task_information.history,this.currentHistoryIndex=e.getPayloadValue().task_information.history_index}addToMapArray(e,t,i){e.has(t)?e.get(t).push(i):e.set(t,[i])}}}),define("classes/influencer_network_layer",["require","exports","widget_base"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkLayer=class{constructor(e,t,i){this.settings=t,this.createCanvas(this.settings,i),this.alpha=1}createCanvas(e,t){return this.canvas=document.createElement("canvas"),this.canvas.classList.add("canvas-hover-border-always"),this.context=this.canvas.getContext("2d"),void 0!==e.dimensions.height&&e.heightMode!==i.WidgetHeightMode.LEGACY&&(this.canvas.style.position="absolute"),void 0!==t&&t.appendChild(this.canvas),this.adjustCanvasSize(e).adjustCanvasPosition(e),this}adjustCanvasPosition(e){return void 0!==e.dimensions.x&&(this.canvas.style.left=e.dimensions.x+"px"),void 0!==e.dimensions.y&&(this.canvas.style.top=e.dimensions.y+"px"),this}adjustCanvasSize(e){const t=Math.floor(e.dimensions.width),i=Math.floor(e.dimensions.height);return this.canvas.style.height=`${i}px`,this.canvas.style.width=`${t}px`,this.canvas.height=i*(e.resolutionMultiplier||1),this.canvas.width=t*(e.resolutionMultiplier||1),this}getWidth(){return this.settings.dimensions.width}getHeight(){return this.settings.dimensions.height}clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this}getContext(){return this.context}update(e){return this.settings=e,this.adjustCanvasSize(e).adjustCanvasPosition(e),this}getCanvas(){return this.canvas}drawImage(e,t,i){this.getWidth()>0&&this.getHeight()>0&&this.context.drawImage(e,t,i)}}}),define("classes/influencer_network_object",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkObject=class{getLayerId(){return this.layerId}setLayerId(e){return this.layerId=e,this}}}),define("classes/influencer_network_link",["require","exports","classes/influencer_network_object"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkLink=class extends i.InfluencerNetworkObject{constructor(e,t,i,s){super(),this.model=e,this.startNode=t,this.endNode=i,this.themeId=s,t.addLink(this),i.addLink(this)}draw(e,t,i){const s=e.getContext(),n=t.getContext(),r=s.globalAlpha;return this.highlighed||this.hoverState?(s.globalAlpha=1,n.globalAlpha=1,s.lineWidth=2*i,s.strokeStyle=this.getColor().clone().setOpacity(1).toRGBA()):(s.strokeStyle=this.getColor().toRGBA(),s.lineWidth=.7*i),s.beginPath(),s.moveTo(this.model.line.position.x*i,this.model.line.position.y*i),s.lineTo(this.model.line.targetPosition.x*i,this.model.line.targetPosition.y*i),s.stroke(),s.globalAlpha=r,this}getInteractions(){const e=[];return this.model.interactions.sourceTarget&&e.push(...this.model.interactions.sourceTarget),this.model.interactions.targetSource&&e.push(...this.model.interactions.targetSource),e}dispose(){}getOtherNode(e){return this.startNode===e?this.endNode:this.startNode}setHoverState(e){this.hoverState=e,this.startNode.setHoverState(e,!1),this.endNode.setHoverState(e,!1)}getColor(){return this.model.colorPalette.find(e=>e.order===this.themeId).color}setThemeId(e){this.themeId=e}}}),define("classes/influencer_network_node",["require","exports","classes/influencer_network_object","math_utils","graphics_utilities","map","classes/influencer_network_renderer"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=14;t.HASHTAG_SELECTION_COLOR="#333333";const l=[0];t.InfluencerNetworkNode=class extends i.InfluencerNetworkObject{constructor(e,t){super(),this.model=e,this.imagesAllowed=!1,this.highlighted=!1,this.currentHighlightLevel=0,this.maximumLevel=0,this.links=[],this.distances=new r.Map,this.hoverState=!1,this.image=document.createElement("img"),this.image.style.display="none",this.themeId=t,window.imageExporter&&(document.body.appendChild(this.image),this.imagesAllowed=!0)}get shape(){return this.model.shape}setThemeId(e){this.links.forEach(t=>t.setThemeId(e)),this.themeId=e}getId(){return this.model.id}checkLoadImage(e,t){return this.isInRectangle(e)&&this.getRadius()*t>a&&""===this.image.src?new Promise((e,t)=>{this.image.onload=(()=>e()),this.image.onerror=(()=>t()),this.image.src=this.model.image_url.replace("_normal","_200x200")}):Promise.reject({})}getRadius(){return this.shape.radius}getHexColor(){return this.getColor().toRGBA()}isInRectangle(e){return s.collisionCalculator.isOverlapping(this.shape,e)}hitCheck(e){this.shape.radius=this.shape.radius*this.shape.radius/2;const t=s.collisionCalculator.isOverlapping(this.shape,new s.Point(e));return this.shape.radius=Math.sqrt(2*this.shape.radius),t}drawLabel(e,t){e.font="12px Arial";const i=e.measureText(this.model.shortName),s=this.shape.position.x*t-i.width/2,n=Math.round((this.shape.position.y+this.shape.radius)*t+15);e.fillStyle="rgba(255,255,255,0.6)",e.fillRect(s-3,n-13,i.width+6,18),e.fillStyle="#000000",e.fillText(this.model.shortName,s,n)}draw(e,t,i,s){const n=e.getContext(),r=n.globalAlpha,o=this.getRadius();let l=this.getColor().clone(),c=this.getColor().clone();return this.isHighlighted(s)&&(n.globalAlpha=1),this.highlightedForLinkedObject?(c=this.getHighlightColor().clone(),l=this.getHighlightColor().clone().lighten(.2)):(this.highlighted||this.hoverState)&&(c=c.darken(.4),l=l.darken(.3)),n.fillStyle=c.toRGBA(),n.strokeStyle=l.toRGBA(),n.lineWidth=Math.max(2,6*i),n.beginPath(),n.arc(this.shape.position.x*i,this.shape.position.y*i,o*i,0,2*Math.PI,!0),this.canDrawImage(i)?(this.drawImage(i,n,o),n.stroke()):n.fill(),o*i>a&&this.drawLabel(t.getContext(),i),this.isHighlighted(s)?(n.lineWidth=Math.max(2,7*i),n.stroke()):(n.strokeStyle="#000000",n.lineWidth=.15*i,n.stroke()),n.closePath(),n.globalAlpha=r,this}canDrawImage(e){return this.imagesAllowed&&this.image.complete&&this.image.naturalWidth&&this.getRadius()*e>a}drawImage(e,t,i){t.save(),t.clip(),t.drawImage(this.image,this.shape.position.x*e-i*e,this.shape.position.y*e-i*e,2*i*e,2*i*e),t.restore()}dispose(){}removeHighlight(){this.highlighted=!1,this.currentHighlightLevel=0,this.links.forEach(e=>e.highlighed=!1)}highlight(){0===this.distances.size&&(this.calculateDistances(),this.maximumLevel=this.getMaxLevel());const e=this.currentHighlightLevel+1;e<=this.maximumLevel&&this.highlightLevel(e)}highlightLevel(e){0===this.distances.size&&(this.calculateDistances(),this.maximumLevel=this.getMaxLevel()),this.currentHighlightLevel=e,this.distances.forEach((t,i)=>{t<=e?(t<e&&i.links.forEach(e=>e.highlighed=!0),i.highlighted=!0):i.removeHighlight()})}getHighlightedNodes(){const e=[];return this.distances.forEach((t,i)=>{t<=this.currentHighlightLevel&&e.push(i)}),e}calculateDistances(e=this.distances,t=0){(!e.has(this)||t<e.get(this))&&(e.set(this,t),this.links.forEach(i=>{i.getOtherNode(this).calculateDistances(e,t+1)}))}getMaxLevel(){let e=1;return this.distances.forEach(t=>{e=Math.max(t,e)}),e}addLink(e){this.links.push(e)}setHoverState(e,t=!0){this.hoverState=e,t&&this.links.forEach(t=>t.setHoverState(e))}isHighlighted(e){return this.hoverState||this.isModeHighlighted(e)}isModeHighlighted(e){switch(e){case o.HighlightMode.SELECTION:return this.highlighted;case o.HighlightMode.FILTER_VIEW:return this.highlightedForLinkedObject;default:return this.hoverState}}hasLinkedObjects(){return this.model.matchingObjects.length>0}highlightForLinkedObject(e,t){this.highlightedForLinkedObject=e,this.highlightColor=t?n.Color.fromHex(t):void 0}getHighlightColor(){return l.includes(this.themeId)?this.highlightColor||n.Color.fromHex(t.HASHTAG_SELECTION_COLOR):this.getColor()}getColor(){return this.model.colorPalette.find(e=>e.order===this.themeId).color}}}),define("classes/influencer_network_ui",["require","exports","math_utils","graphics_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkUi=class{constructor(e,t,i){this.addCameraButtons(e,t,i)}addCameraButtons(e,t,n){const r=new s.Color(new i.Vector4D(0,0,0,88)),o=new s.Color(new i.Vector4D(0,0,0,88)),a=new s.DrawableRectangle({position:new i.Vector2D(10,10),style:{fillStyle:"white",strokeStyle:o.toRGBA()},size:new i.Vector2D(27,27),children:[new s.DrawableRectangle({position:new i.Vector2D(8,12),style:{fillStyle:o},size:new i.Vector2D(4,3)}),new s.DrawableRectangle({position:new i.Vector2D(15,12),style:{fillStyle:o},size:new i.Vector2D(4,3)}),new s.DrawableRectangle({position:new i.Vector2D(12,8),style:{fillStyle:o},size:new i.Vector2D(3,11)})],on:{mouseenter(){e.tween(o,"a",255,200),n.style.cursor="pointer"},mouseleave(){e.tween(o,"a",88,200),n.style.cursor=""},mouseup:t.zoomIn}}),l=new s.DrawableRectangle({position:new i.Vector2D(10,37),style:{fillStyle:"white",strokeStyle:r.toRGBA()},size:new i.Vector2D(27,27),children:[new s.DrawableRectangle({position:new i.Vector2D(8,12),style:{fillStyle:r},size:new i.Vector2D(11,3)})],on:{mouseenter(){e.tween(r,"a",255,200),n.style.cursor="pointer"},mouseleave(){e.tween(r,"a",88,200),n.style.cursor=""},mouseup:t.zoomOut}});e.addDrawable(a),e.addDrawable(l)}}}),define("classes/influencer_network_renderer",["require","exports","math_utils","graphics_utilities","reusable_utilities","classes/influencer_network_ui","map"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a="UI",l="EFFECT_LAYER";!function(e){e.HIGHLIGHT_HASHTAGS="HIGHLIGHT_HASHTAGS",e.HIGHLIGHT_SOURCE_PANELS="HIGHLIGHT_SOURCE_PANELS",e.HIGHLIGHT_SELECTION="HIGHLIGH_SELECTION",e.HIGHLIGHT_FILTER_VIEW="HIGHLIGHT_FILTER_VIEW"}(t.DrawEnhancers||(t.DrawEnhancers={})),function(e){e[e.SELECTION=0]="SELECTION",e[e.FILTER_VIEW=1]="FILTER_VIEW"}(t.HighlightMode||(t.HighlightMode={}));t.InfluencerNetworkRenderer=class{constructor(){this.drawLayers=[],this.hasChanged=!0,this.scale=1,this.drawEnhancers=new o.Map,this.oldOffset=i.Vector2D.zero(),this.offset=i.Vector2D.zero(),this.drawOffset=i.Vector2D.zero(),this.activeHighlightModes=[]}playInitialAnimation(e){this.timeline=new s.Timeline([{object:this.drawLayers[2],key:"alpha",targetValue:1,initialValue:0,duration:.7*e.animationDuration},{object:this.drawLayers[1],key:"alpha",targetValue:1,initialValue:0,duration:.7*e.animationDuration},{object:this.drawLayers[0],key:"alpha",targetValue:1,initialValue:0,duration:.5*e.animationDuration,offset:.5*e.animationDuration}]),this.timeline.play()}createUi(e){new r.InfluencerNetworkUi(this.camera.getLayerByName(a),e,this.visibleLayer.getCanvas())}get size(){return new i.Vector2D(this.width,this.height)}get width(){return this.visibleLayer.getCanvas().width}get height(){return this.visibleLayer.getCanvas().height}getViewport(){const e=this.projectPoint(i.Vector2D.zero());return new i.Rectangle(e,this.width/this.scale,this.height/this.scale)}resetDragOffsets(){return this.drawOffset.add(this.offset),this.offset.zero(),this.refresh(),this}setObjects(e){this.objects=e}getScale(){return this.scale}setScale(e,t){return this.scale=e,this.hasChanged=!0,this.camera.getLayerByName(l).scaleTo(new i.Vector2D(e,e),t),this}setVisibleLayer(e){return this.visibleLayer=e,this}setDrawLayers(e){return this.drawLayers=e,this.camera=new s.Camera({layers:[{name:l,isFixed:!1,overscan:3,resolutionScale:1,size:new i.Vector2D(e[0].getWidth(),e[0].getHeight()),layerType:s.ManagedDrawingLayer},{name:a,isFixed:!0,resolutionScale:1,layerOptions:{autoComputeInteractionFrom:this.visibleLayer.getCanvas()},size:new i.Vector2D(this.visibleLayer.getWidth(),this.visibleLayer.getHeight()),layerType:s.ManagedDrawingLayer}]}),this}drawObjects(){return this.drawLayers.forEach(e=>{e.clear();const t=e.getContext();t.save(),t.translate(this.drawOffset.x+e.getWidth()/2,this.drawOffset.y+e.getHeight()/2)}),this.camera.getLayerByName(l).translateTo(this.camera.getLayerByName(l).getCenterPoint().add(this.drawOffset)),this.objects.forEach(e=>{const t=this.drawLayers[e.layerId],i=this.drawLayers[e.layerId+1];this.drawEnhancers.size>0&&this.drawEnhancers.forEach(i=>i(e,t.getContext())),e.draw(t,i,this.scale,this.activeHighlightModes.length>0?this.activeHighlightModes[0]:void 0)}),this.drawLayers.forEach(e=>{e.getContext().restore()}),this}updateVisibleLayers(e){return this.visibleLayer.update(e),this}updateDrawLayers(e){return this.drawLayers.forEach(t=>t.update(e)),this.camera.getLayerByName(l).resize(e.dimensions.width,e.dimensions.height),this}refresh(){this.hasChanged=!0}removeHighlight(){void 0!==this.highlightingToken&&this.highlightingToken.cancel()}highlight(e){this.removeHighlight();const t=new s.DrawableCircle({position:e.shape.position.clone(),style:{strokeStyle:e.getColor().clone().lighten(.2).toRGBA(),lineWidth:0},radius:e.getRadius()-1}),i=new n.CancellationToken;this.camera.getLayerByName(l).tween(t.styleData,"lineWidth",12,500,{cancellationToken:i}),this.camera.getLayerByName(l).tween(t,"radius",e.getRadius()+5,500,{cancellationToken:i}),i.registerCleanupFunction(async()=>{await Promise.all([this.camera.getLayerByName(l).tween(t.styleData,"lineWidth",0,500),this.camera.getLayerByName(l).tween(t,"radius",e.getRadius()-1,500)]),await this.camera.getLayerByName(l).removeDrawable(t)}),this.highlightingToken=i,this.camera.getLayerByName(l).addDrawable(t)}addHighlightMode(e){this.activeHighlightModes.includes(e)||(this.activeHighlightModes.push(e),this.activeHighlightModes.sort())}removeHighlightMode(e){this.activeHighlightModes.includes(e)&&this.activeHighlightModes.splice(this.activeHighlightModes.indexOf(e),1)}async ping(e,t,i){const n=new s.DrawableCircle({position:e,style:{fillStyle:t.toHex6()},radius:0});this.camera.getLayerByName(l).addDrawable(n);const r=new s.Timeline([{object:n,key:"radius",initialValue:0,targetValue:2*Math.max(50,i)/Math.min(1,3*this.scale),duration:1250},{object:n.styleData,key:"opacity",initialValue:1,targetValue:0,duration:1e3,offset:250}]).play().on("progress",e=>{this.camera.getLayerByName(l).requestDraw(),e>=1&&(r.dispose(),this.camera.getLayerByName(l).removeDrawable(n))})}render(){this.hasChanged&&(this.drawObjects(),this.camera.draw(),this.hasChanged=!1),this.oldOffset.isEqual(this.offset)||this.oldOffset.merge(this.offset),this.visibleLayer.clear(),this.drawLayers.forEach((e,t)=>{const i=this.offset.x-(e.getWidth()-this.visibleLayer.getWidth())/2,s=this.offset.y-(e.getHeight()-this.visibleLayer.getHeight())/2;this.visibleLayer.getContext().globalAlpha=e.alpha,this.visibleLayer.drawImage(this.drawLayers[t].getCanvas(),i,s)});const e=this.camera.getLayerByName(l),t=this.offset.x-(e.width-this.visibleLayer.getWidth())/2,i=this.offset.y-(e.height-this.visibleLayer.getHeight())/2;return this.visibleLayer.drawImage(e.canvas,t,i),this.visibleLayer.drawImage(this.camera.getLayerByName(a).canvas,0,0),requestAnimationFrame(()=>this.render()),this}start(e){this.drawLayers.forEach(e=>e.alpha=0),this.render(),this.playInitialAnimation(e)}projectPoint(e){return e.sub(new i.Vector2D(this.width/2,this.height/2)).sub(this.drawOffset).div(this.scale)}setCursor(e){this.visibleLayer.getCanvas().style.cursor!==e&&(this.visibleLayer.getCanvas().style.cursor=e)}}}),define("models/influencer_network_influencer_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/influencer_network_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFLUENCER_NETWORK_ENABLE_UNSELECT="INFLUENCER_NETWORK_ENABLE_UNSELECT",t.INFLUENCER_NETWORK_DISABLE_UNSELECT="INFLUENCER_NETWORK_DISABLE_UNSELECT",t.INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE="INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE",t.SET_INFLUENCER_NETWORK_RECURSIVE_SELECTION="SET_INFLUENCER_NETWORK_RECURSIVE_SELECTION",t.INFLUENCER_NETWORK_UPDATED="INFLUENCER_NETWORK_UPDATED",t.INFLUENCER_NETWORK_SWITCH_THEME="INFLUENCER_NETWORK_SWITCH_THEME",t.UPDATE_SELECTED_INFLUENCERS="UPDATE_SELECTED_INFLUENCERS",t.UPDATE_NODE_SELECTION="UPDATE_NODE_SELECTION",t.UPDATE_NODE_SELECTION_LEVEL="UPDATE_NODE_SELECTION_LEVEL",t.UPDATE_SOURCE_PANEL_COUNTS="UPDATE_SOURCE_PANEL_COUNTS",t.UPDATE_TOPICS_AND_CHANNELS="UPDATE_TOPICS_AND_CHANNELS",t.RESPOND_HASHTAGS="RESPOND_HASHTAGS",t.SET_HIGHLIGHTED_HASHTAGS="SET_HIGHLIGHTED_HASHTAGS",t.SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE="SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE",t.SET_LINKED_OBJECT_SELECTION="SET_LINKED_OBJECT_SELECTION"}),define("react/influencer_network_sidebar/pages/influencer_network_sidebar_influencer_page",["require","exports","react","react/influencer_dialog/influencer","react-tiny-virtual-list"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=230,o=41;t.InfluencerNetworkSidebarInfluencerPage=class extends i.Component{constructor(e){super(e),this.state={width:480,height:400,elementsPerRow:2}}render(){const{influencerData:e}=this.props,t=this.separateInfluencers(e.filter(e=>!e.isSelected));return i.createElement("div",{className:"influencer-sidebar-page",ref:e=>{!e||e.offsetWidth===this.state.width&&e.parentElement.offsetHeight===this.state.height||this.setState({width:e.offsetWidth,height:e.parentElement.offsetHeight,elementsPerRow:Math.floor(e.offsetWidth/r)})}},this.renderInfluencers(t))}renderInfluencers(e){const t=e.length,s=o*t,n=16+8*t,r=(this.state.height-s-n)/t;return i.createElement("div",{style:{width:"100%"}},e.map(e=>this.renderInfluencerList(e.title,e.influencerData,r)))}renderInfluencerList(e,t,s){return i.createElement("div",{className:"settings-container",key:e},i.createElement("div",{className:"headline"},e),i.createElement(n,{className:"stylized-scrollbar",width:"100%",height:s,itemCount:Math.ceil(t.length/this.state.elementsPerRow),itemSize:84,overscanCount:10,renderItem:({index:e,style:i})=>this.renderVirtualListItem(e,i,this.state.elementsPerRow,t)}))}renderVirtualListItem(e,t,s,n){const r=[],o=[];for(let t=0;t<s;++t)n[e*s+t]?r.push(n[e*s+t]):o.push(!0);return i.createElement("div",{key:e,style:t,className:"sidebar-influencer-row"},r.map(this.renderInfluencer.bind(this)),o.map((e,t)=>this.renderSpacer(t)))}renderInfluencer(e){const{mediator:t}=this.props;return i.createElement(s.Influencer,Object.assign({},e,{key:`INF_${e.influencerId}`,mediator:t,className:"sidebar-influencer"}))}renderSpacer(e){return i.createElement("div",{key:`spacer_${e}`,className:"sidebar-spacer"})}separateInfluencers(e){const t=[],i=[],s=[];return e.forEach(e=>{e.isInfluencer?i.push(e):s.push(e)}),i.length>0&&t.push({title:this.props.messages.influencer,influencerData:i}),s.length>0&&t.push({title:this.props.messages.amplifier,influencerData:s}),t}}}),define("react/influencer_network_sidebar/pages/influencer_network_sidebar_interaction_page",["require","exports","react","reusable_utilities","widget_base","classes/influencer_network_messages"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.Component{constructor(e){super(e),this.state={loading:!1}}render(){return 0===this.props.articleIds.length?this.renderNoResults():i.createElement("div",{ref:"root",style:{height:"100%"}},this.state.loading?i.createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},i.createElement("i",{style:{position:"absolute",left:"50%",top:"50%"},className:"fa fa-refresh fa-spin tw-loading-bubble"})):null)}renderNoResults(){return null}componentDidMount(){const{mediator:e}=this.props;this.cancellationToken=new s.CancellationToken,this.fetchData(),e.listen(r.UPDATE_SELECTED_INFLUENCERS,()=>this.fetchData(),{token:this.cancellationToken})}async fetchData(){if(this.fetchToken&&this.fetchToken.cancel(),this.fetchToken=new s.CancellationToken,this.cancellationToken.chain(this.fetchToken),this.widgetCancellationToken&&(this.fragment.dispose(),this.widgetCancellationToken.cancel()),this.props.articleIds.length>0){this.setState({loading:!0});let{mediator:e,dimensions:t,buildConfiguration:i,articleIds:s,fragmentIndex:r,sampleMaxSize:o}=this.props;const a=t.clone();a.size.moveBy(-1,-135);const{widget:l,cancellationToken:c}=await i.loadFragmentData(s.slice(0,o),r);if(this.fetchToken.isCanceled())return void c.cancel();l.isEmptyWidget()&&(r="noData"),this.cancellationToken.chain(c),this.widgetCancellationToken=c;const{fragment:d,model:h,drawSettings:u}=await this.props.subFragments[r].deploy({mediator:e,dimensions:a,animationDuration:0,animationStrategy:0,payload:l,rootNode:this.refs.root,cleanUp:this.widgetCancellationToken});if(this.fetchToken.isCanceled())return void this.widgetCancellationToken.cancel();if(this.fragment=d,await d.update(h,n.DataAction.NEW_DATA),await d.draw(u),this.fetchToken.isCanceled())return void this.widgetCancellationToken.cancel();this.setState({loading:!1})}}componentWillUnmount(){this.fragment&&this.fragment.dispose(),this.cancellationToken.cancel()}}__decorate([s.debounce(250),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],o.prototype,"fetchData",null),t.InfluencerNetworkSidebarInteractionPage=o}),define("react/influencer_network_sidebar/pages/influencer_network_sidebar_view_page",["require","exports","react","map","reusable_components","classes/influencer_network_messages"],function(e,t,i,s,n,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Default="DEFAULT",e.SourcePanel="SOURCE_PANEL",e.Topic="TOPIC",e.Hashtags="HASHTAGS"}(o=t.InfluencerNetworkFilterViewType||(t.InfluencerNetworkFilterViewType={}));t.InfluencerNetworkSidebarViewPage=class extends i.Component{constructor(e){super(e),this.state={selectedHashtags:[]}}componentWillMount(){const e=(this.props.availableFilterViews?this.props.availableFilterViews[0]:this.props.activeFilterView)||o.Default;this.initTopicMenu(e),this.setInfluencerNetworkFilterViewType(e)}initTopicMenu(e){const t=e===o.Default?"NODE":"NONE",i=e===o.Hashtags?"NODE":"NONE";this.filterViewMenu={root_entry:{name:"root",children:[{mapped_id:o.Default,name:this.props.messages.views.default,selected:t},{mapped_id:o.Hashtags,name:this.props.messages.views.hashtag,selected:i}]}},this.props.filterViews.forEach(t=>{const i=e===t.type?"NODE":"NONE";this.filterViewMenu.root_entry.children.push({mapped_id:t.type,name:t.name,selected:i})}),this.filterViewMenu.root_entry.children=this.filterViewMenu.root_entry.children.filter(e=>!this.props.availableFilterViews||this.props.availableFilterViews.includes(e.mapped_id))}render(){return i.createElement("div",{className:"settings-container"},i.createElement(n.SingleSelectComponent,{model:this.filterViewMenu,selectCallback:e=>this.setInfluencerNetworkFilterViewType(e.mapped_id),isReadOnly:this.filterViewMenu.root_entry.children.length<=1}),this.renderFilterTree())}renderFilterTree(){if(!this.props.activeFilterView||this.props.activeFilterView===o.Default)return null;if(this.props.activeFilterView===o.Hashtags)return this.renderHashtagTable();const e=this.props.filterViews.find(e=>e.type===this.props.activeFilterView);return e.idFilter&&0===e.idFilter.length?i.createElement("div",{style:{padding:10,textAlign:"center"}},e.emptyWarning):i.createElement(n.TreeComponent,{key:e.type,root:e.treeRoot,filterIds:e.idFilter,onChange:e=>this.onTreeChange(e)})}renderHashtagTable(){const{influencerData:e,hashtagData:t}=this.props,n=e.map(e=>e.influencerId),r=new s.Map;t.values().forEach(e=>{const t=e.authors.filter(e=>n.includes(e));r.set(e,t.length)});const o=t.values().filter(e=>r.get(e)>0).sort((e,t)=>r.get(t)-r.get(e));return 0===o.length?i.createElement("div",{style:{padding:10,textAlign:"center"}},this.props.messages.warning.noHashtags):i.createElement("div",{className:"hashtag-table"},o.map(e=>this.renderHashtagRow(e,r.get(e))))}renderHashtagRow(e,t){return i.createElement("div",{key:e.code,className:`hashtag-row ${this.state.selectedHashtags.includes(e.label)?"active":""}`,onClick:()=>this.onClick(e.label)},i.createElement("span",{className:"hashtag-color",style:{backgroundColor:e.color}}),i.createElement("span",{className:"hashtag-label"},e.label),i.createElement("span",{className:"hashtag-count"},t))}onClick(e){const{selectedHashtags:t}=this.state;t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),this.updateHashtags()}updateHashtags(){const{selectedHashtags:e}=this.state,t=e.length>0;this.props.mediator.dispatch(r.SET_HIGHLIGHTED_HASHTAGS,{state:t,hashtags:e}),this.setState({selectedHashtags:e})}setInfluencerNetworkFilterViewType(e){this.props.mediator.dispatch(r.SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE,e),e===o.Hashtags&&this.updateHashtags()}onTreeChange(e){this.props.mediator.dispatch(r.SET_LINKED_OBJECT_SELECTION,e.selectedItems)}componentWillUnmount(){this.props.mediator.dispatch(r.SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE,o.Default)}}}),define("react/influencer_network_sidebar/influencer_network_sidebar",["require","exports","map","react","react-tabs","reusable_components","reusable_utilities","classes/influencer_network_layout","classes/influencer_network_messages","react/influencer_network_sidebar/components/influencer_network_metrics_component","react/influencer_network_sidebar/pages/influencer_network_sidebar_influencer_page","react/influencer_network_sidebar/pages/influencer_network_sidebar_interaction_page","react/influencer_network_sidebar/pages/influencer_network_sidebar_view_page","event_bus","math_utils","log"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m){"use strict";var f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.INFLUENCERS=0]="INFLUENCERS",e[e.VIEWS=1]="VIEWS",e[e.INTERACTIONS=2]="INTERACTIONS"}(f=t.InfluencerSidebarPage||(t.InfluencerSidebarPage={})),t.REQUEST_DATA="REQUEST_DATA";t.InfluencerNetworkSidebar=class extends s.Component{constructor(e){super(e),this.currentLayout=e.model.buildConfiguration.getLayout(e.model.widget),this.initializeViews(),this.state={page:f.INFLUENCERS,showReloadButton:!1,articleUrls:[],influencerData:[],jobStatus:{progress:0,status:""},isVisible:this.currentLayout!==a.InfluencerNetworkLayout.SIDEBAR_HIDDEN,hasLegacyData:!1,hashtags:new i.Map,sourcePanelItems:void 0,topicAndChannelItems:void 0,activeFilterView:u.InfluencerNetworkFilterViewType.Default,filterViews:[this.sourcePanelFilterView,this.topicAndChannelsFilterView]}}initializeViews(){this.sourcePanelFilterView={type:u.InfluencerNetworkFilterViewType.SourcePanel,name:this.props.model.buildConfiguration.messages.views.sourcePanel,emptyWarning:this.props.model.buildConfiguration.messages.warning.noSourcePanels},this.topicAndChannelsFilterView={type:u.InfluencerNetworkFilterViewType.Topic,name:this.props.model.buildConfiguration.messages.views.topicAndChannel,emptyWarning:this.props.model.buildConfiguration.messages.warning.noTopicsOrChannels},this.props.model.widget.hasPayloadValue()&&(this.sourcePanelFilterView.treeRoot=this.parsePanelGroups(this.props.model.widget.getPayloadValue().panels_groups),this.topicAndChannelsFilterView.treeRoot=this.parseTopicEntries(this.props.model.widget.getPayloadValue().topics_and_channels))}componentDidMount(){this.props.mediator.listen(l.UPDATE_SELECTED_INFLUENCERS,e=>this.updateInfluencers(e.models,e.articleUrls,e.changePage)),this.props.mediator.listen(l.INFLUENCER_NETWORK_UPDATED,()=>this.setState({isVisible:this.currentLayout!==a.InfluencerNetworkLayout.SIDEBAR_HIDDEN})),this.props.mediator.listen(l.RESPOND_HASHTAGS,e=>this.setState({hashtags:e})),this.props.mediator.listen(l.UPDATE_SOURCE_PANEL_COUNTS,e=>this.setState({sourcePanelItems:e})),this.props.mediator.listen(l.UPDATE_TOPICS_AND_CHANNELS,e=>this.setState({topicAndChannelItems:e})),this.props.mediator.listen(l.SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE,e=>this.setState({activeFilterView:e})),this.update(),this.props.model.buildConfiguration.onTimeFilterChange(this.props.model.widget,e=>this.setState({hasLegacyData:e}),this.canellationToken);const e=$(".tw-influencer-network-sidebar");p.eventBus.dispatch({type:p.EVENT_TYPES.GRID_WIDGET_OVERFLOW,value:{id:this.props.model.widget.getId(),expectedSize:this.props.settings.dimensions.size,realSize:new g.Vector2D(e.width(),e.outerHeight())}})}componentWillMount(){this.canellationToken=new o.CancellationToken,this.props.model.buildConfiguration.isInteractive&&o.PromiseUtils.cancellationPromise(this.refreshStatus(),this.canellationToken).then(()=>{this.canellationToken.setInterval(()=>this.refreshStatus(),4e3)}).catch(e=>{e.isCancelled||m.logService.error("Failed to refresh influencer network status")})}update(){this.props.mediator.dispatch(t.REQUEST_DATA,{})}componentWillUnmount(){this.canellationToken.cancel()}render(){const{props:{model:{buildConfiguration:{messages:e,isInteractive:t},widget:i}},state:{influencerData:r}}=this,o=this.props.model.buildConfiguration.getPageFilter();if(!this.state.isVisible)return null;if(!i.hasPayloadValue()||i.isEmptyWidget())return this.renderNoPayload();const l=r.find(e=>e.isSelected),c=!i.getPageState().getAllowedPages().isDashboard()&&!i.getPageState().getAllowedPages().isReport(),d=s.createElement("div",{className:"refresh-block"},this.renderGenerationInfo(),this.renderRefreshButton());return s.createElement("div",{className:"tw-influencer-network-sidebar",onMouseDown:()=>this.onSidebarClick()},c?d:null,t?s.createElement(n.Tabs,{className:"tab-container",selectedIndex:this.state.page,onSelect:e=>this.changePage(e)},s.createElement(n.TabList,{className:"nav nav-tabs"},o.includes(f.INFLUENCERS)?null:s.createElement(n.Tab,{className:0===this.state.page?"active":""},s.createElement("a",{href:"javascript:void(0)"},e.pages.people)),o.includes(f.VIEWS)?null:s.createElement(n.Tab,{className:1===this.state.page?"active":""},s.createElement("a",{href:"javascript:void(0)"},e.pages.views)),o.includes(f.INTERACTIONS)?null:s.createElement(n.Tab,{className:2===this.state.page?"active":""},s.createElement("a",{href:"javascript:void(0)"},e.pages.interaction)))):null,s.createElement("div",{className:`page-container ${this.currentLayout===a.InfluencerNetworkLayout.GRAPH_HIDDEN?"stand-alone":""}`},this.renderMetrics(l),s.createElement("div",{className:"tab-content stylized-scrollbar"},this.renderActivePage())))}renderMetrics(e){const{props:{model:{buildConfiguration:{messages:t,isInteractive:i},widget:n},mediator:r,settings:o,nodeSelection:l}}=this,d=n.getPayloadValue(),h=!e&&this.currentLayout===a.InfluencerNetworkLayout.INFLUENCER_ONE;return i&&!h?s.createElement("div",{className:"metric-container"},s.createElement(c.InfluencerNetworkMetricsComponent,{metrics:d.metrics,style:o.style,messages:t,mediator:r,nodeSelection:l,influencer:e})):null}async refreshStatus(){try{const{widget:e,buildConfiguration:t}=this.props.model,{jobStatus:i}=this.state,s=this.getRefreshButtonState(i),n=await o.PromiseUtils.cancellationPromise(t.getStatus(e),this.canellationToken);let a=!1;s===r.ProgressButtonState.LOADING&&this.getRefreshButtonState(n)===r.ProgressButtonState.DEFAULT&&(a=!0),this.setState({jobStatus:n,showReloadButton:this.state.showReloadButton||a})}catch(e){if(!e.isCancelled)throw e}}updateInfluencers(e,t,i){const s=i?f.INFLUENCERS:this.state.page;this.setState({page:s,articleUrls:t,influencerData:e})}renderActivePage(){const{props:{mediator:e,model:{widget:t,buildConfiguration:i,subFragments:n},settings:r,nodeSelection:o},state:{articleUrls:a,sourcePanelItems:l,topicAndChannelItems:c,influencerData:p,filterViews:g,activeFilterView:m}}=this,_=p.map(e=>e.influencerId);switch(this.sourcePanelFilterView.idFilter=this.generateIdFilter(l,_),this.topicAndChannelsFilterView.idFilter=this.generateIdFilter(c,_),this.state.page){case f.INTERACTIONS:return s.createElement(h.InfluencerNetworkSidebarInteractionPage,{key:f.INTERACTIONS,buildConfiguration:i,mediator:e,widget:t,scrollable:!0,sampleMaxSize:125,articleIds:a,fragmentIndex:"articles",dimensions:r.dimensions,subFragments:n});case f.INFLUENCERS:return s.createElement(d.InfluencerNetworkSidebarInfluencerPage,{dimensions:r.dimensions,mediator:e,influencerData:this.state.influencerData,messages:this.getPeopleTypesMessages(),nodeSelection:o});case f.VIEWS:return s.createElement(u.InfluencerNetworkSidebarViewPage,{hashtagData:this.state.hashtags,mediator:e,influencerData:this.state.influencerData,messages:i.messages,filterViews:g,availableFilterViews:i.availableFilterViews,activeFilterView:m});default:return null}}getPeopleTypesMessages(){const{buildConfiguration:e}=this.props.model;return this.currentLayout===a.InfluencerNetworkLayout.INFLUENCER_ONE?e.messages.peopleTypesInfluencerOne:e.messages.peopleTypes}generateIdFilter(e,t){const i=[];return e&&e.forEach((e,s)=>{_.intersection(t,e).length>0&&i.push(s)}),i}changePage(e){this.setState({page:f[f[e]]})}renderNoPayload(){const{model:{widget:e,buildConfiguration:{messages:t}}}=this.props;let i;return i=this.getRefreshButtonState(this.state.jobStatus)===r.ProgressButtonState.LOADING?s.createElement("div",null,s.createElement("div",null,this.renderRefreshButton()),s.createElement("div",null,t.noData.loading)):"NOT_AVAILABLE"===e.getMissingDataReason()?s.createElement("div",null,s.createElement("div",null,this.renderRefreshButton()),s.createElement("div",null,t.noData.noResults)):s.createElement("div",null,s.createElement("div",null,this.renderRefreshButton()),s.createElement("div",null,t.noData.idle)),s.createElement("div",{className:"tw-influencer-network-sidebar no-payload"},i)}async refresh(){const{model:{widget:e,buildConfiguration:{onRefreshClick:t}}}=this.props;try{await t(e),this.setState({jobStatus:{progress:0,status:"LOADING"}})}catch(e){this.setState({jobStatus:{progress:0,status:"FAILED"}})}}renderRefreshButton(){const{model:{buildConfiguration:{messages:e,showRefreshButton:t},widget:i}}=this.props,{showReloadButton:n}=this.state,o=!i.hasPayloadValue()||i.isEmptyWidget();return t?s.createElement("div",{className:"pull-left"},s.createElement("div",{className:"pull-left"},s.createElement(r.ProgressButton,{icon:"fa fa-refresh",progressBar:{fillRate:this.state.jobStatus.progress},forceButtonState:this.getRefreshButtonState(this.state.jobStatus),spinIconWhileLoading:!0,onClick:()=>this.refresh(),className:"button refresh-button",loadingClass:"working",text:o?e.refresh.init:e.refresh.idle,loadingText:e.refresh.busy,errorText:e.refresh.failed,errorClass:"failed"})),this.state.hasLegacyData?this.renderLegacyDataMessage():null,n?this.renderReloadButton():null):null}renderReloadButton(){return s.createElement("i",{onMouseDown:e=>this.reloadGraph(e),className:"icon2-tw-influencer-network-check reload-button"})}renderLegacyDataMessage(){const{model:{buildConfiguration:{messages:e}}}=this.props;return s.createElement("div",{className:"pull-left legacy-data-warning"},s.createElement(r.TooltipComponent,{text:e.warning.legacyData,position:"right"},s.createElement("i",{className:"fa fa-exclamation-triangle legacy-data-warning-button"})))}renderGenerationInfo(){return s.createElement("div",{className:"generation-date"},this.getGenerationDate())}getGenerationDate(){const{model:{widget:e,buildConfiguration:{messages:t}},settings:{style:i}}=this.props,s=e.getPayloadValue();let n=`${t.refresh.generation} ${moment(s.task_information.generation_ts).format(i.formatting.dateTimeFormat)}`;return this.currentLayout===a.InfluencerNetworkLayout.INFLUENCER_ONE&&(n+=` (${t.refresh.period})`),n}onSidebarClick(){this.props.mediator.dispatch(l.INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE,{})}getRefreshButtonState(e){return""===e.status||"FINISHED"===e.status?r.ProgressButtonState.DEFAULT:"FAILED"===e.status?r.ProgressButtonState.ERROR:r.ProgressButtonState.LOADING}reloadGraph(e){e.stopPropagation(),this.props.model.buildConfiguration.reloadGraph(this.props.model.widget),this.setState({showReloadButton:!1})}parsePanelGroups(e){const t={id:"source_panel_root",label:s.createElement("span",null,s.createElement("i",{className:"fa fa-folder"})," ",this.props.model.buildConfiguration.messages.labels.allSourcePanels),children:[{id:"favourites",label:s.createElement("span",null,s.createElement("i",{className:"icon-tw-heart favorite"})),color:"#d32b57",hideColor:!0},{id:"star1",label:s.createElement("span",null,s.createElement("i",{className:"icon-tw-star rating"})),color:"#f2c100",hideColor:!0},{id:"star2",label:s.createElement("span",null,s.createElement("i",{className:"icon-tw-star rating"}),s.createElement("i",{className:"icon-tw-star rating"})),color:"#f2c100",hideColor:!0},{id:"star3",label:s.createElement("span",null,s.createElement("i",{className:"icon-tw-star rating"}),s.createElement("i",{className:"icon-tw-star rating"}),s.createElement("i",{className:"icon-tw-star rating"})),color:"#f2c100",hideColor:!0}],selected:!0},i=(e,t)=>{e.panels.forEach(e=>{const i={id:e.id,label:e.name,color:e.color||void 0};t.children.push(i)})};return e.forEach(e=>{if("ungrouped_source_panels_group"===e.id)i(e,t);else{const n={id:e.id,label:s.createElement("span",null,s.createElement("i",{className:"fa fa-folder"})," ",e.name),children:[]};i(e,n),t.children.push(n)}}),t}parseTopicEntries(e){const t=e=>e?e.map(e=>{let i,n;return e.children&&e.children.length>0?i=s.createElement("span",null,s.createElement("i",{className:"fa fa-folder"})," ",e.name):(i=e.name,n=e.color),{id:e.mapped_id,label:i,color:n,children:t(e.children)}}):[];return{id:"topics_and_channels_root",label:s.createElement("span",null,s.createElement("i",{className:"fa fa-folder"})," ",this.props.model.buildConfiguration.messages.labels.allTopicsAndChannels),children:t(e),selected:!0}}}}),define("react/influencer_network_sidebar/influencer_network_sidebar_fragment",["require","exports","react-dom","react","widget_base","react/influencer_network_sidebar/influencer_network_sidebar","classes/influencer_network_messages","classes/influencer_network_messages","classes/influencer_network_layout"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkSidebarFragment=class extends n.AbstractReactFragment{constructor(e){super(e),this.currentLayout=e.buildConfiguration.getLayout(e.widget)}initialize(e,t,i,s){return this.nodeSelection={node:void 0,currentLevel:1,maxLevel:1,allowRecursiveSelection:!0},t.listen(a.UPDATE_NODE_SELECTION,e=>{this.nodeSelection.node=e,this.nodeSelection.currentLevel=e.currentHighlightLevel,this.nodeSelection.maxLevel=e.maximumLevel}),t.listen(o.SET_INFLUENCER_NETWORK_RECURSIVE_SELECTION,e=>{this.nodeSelection.allowRecursiveSelection=e}),super.initialize(e,t,i,s)}renderIntoContainer(e,t,n,o){this.mediator=o,i.render(s.createElement(r.InfluencerNetworkSidebar,{model:this.fragmentModel,onDraw:t,onUpdate:e,settings:n,mediator:o,nodeSelection:this.nodeSelection}),this.chartContainer)}getXOrder(){return 1}getLayoutIterator(){const e=l.INFLUENCER_NETWORK_SIDEBAR_FRAGMENT_LAYOUTS.filter(e=>e.id===this.currentLayout);return new n.LayoutIterator(e,e=>this.getDimensionsForLayout(e))}update(e,t){return this.mediator.dispatch(r.REQUEST_DATA,{}),super.update(e,t)}}}),define("react/influencer_network_sidebar/components/influencer_network_metrics_component",["require","exports","react","classes/influencer_network_messages","react/influencer_dialog/influencer"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.Component{render(){const{influencer:e,nodeSelection:t,mediator:s,style:o,metrics:a}=this.props,l=e&&t.allowRecursiveSelection&&t.maxLevel>1;return e?i.createElement("div",{style:{width:"100%"}},i.createElement(n.Influencer,Object.assign({style:{width:"100%",boxShadow:"none"}},e,{mediator:s,numberFormatter:o.formatting.numberFormatter,metrics:a,className:"sidebar-influencer"})),l?this.renderLevelInput():null):r.renderInfluencerMetrics(a.map(e=>e.label))}renderLevelInput(){const{nodeSelection:e,messages:t}=this.props,s=t.labels.level.split(/{\d}/g);return i.createElement("div",{className:"level-select"},s[0],i.createElement("input",{type:"number",min:1,max:e.maxLevel,value:e.currentLevel.toString(),onChange:e=>this.changeLevel(e)}),s[1],i.createElement("b",null,e.maxLevel))}changeLevel(e){const{nodeSelection:t,mediator:i}=this.props,n=e.target;let r=parseFloat(n.value);r=(r=(r=isNaN(r)?1:r)>t.maxLevel?t.maxLevel:r)<1?1:r,n.value=r.toString(),i.dispatch(s.UPDATE_NODE_SELECTION_LEVEL,{node:t.node,newLevel:r}),t.currentLevel=r}static renderInfluencerMetrics(e){return i.createElement("div",{style:{paddingTop:10,height:84,width:"48%",float:"left"}},i.createElement("table",{className:"metric"},i.createElement("tbody",null,e.map((e,t)=>i.createElement("tr",{style:{verticalAlign:"baseline"},key:t},i.createElement("td",{className:"label"},e))))))}}t.InfluencerNetworkMetricsComponent=r}),define("react/influencer_dialog/influencer",["require","exports","react","reusable_components","react/influencer_network_sidebar/components/influencer_network_metrics_component","classes/influencer_network_messages","css_modules"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencerStyleModel={container:{display:"flex",cursor:"pointer","&:hover":{backgroundColor:"rgba(189, 192, 222, 0.32)"}},img:{height:70,overflow:"hidden",width:70,float:"left",padding:2,borderRadius:"50%",margin:"0 6px 0 2px"},textContainer:{width:140,float:"left","& div:not(.menu)":{width:"95%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},metricValue:{fontSize:26,paddingRight:5,fontFamily:"CabinCondensedM"}},t.influencerStyle=o.createCssModule(()=>t.influencerStyleModel).compute({}).attach().getModule();t.Influencer=class extends i.Component{render(){const{imageUrl:e,handle:r,metricName:o,style:a,onMouseEnter:l,onMouseLeave:c,metricValue:d,name:h,metrics:u,onClick:p=function(){},onImageClick:g=function(){},onProfileClick:m,fallbackImageUrl:_,className:f,sideMetrics:y}=this.props;return i.createElement("div",{style:a,onMouseEnter:()=>l(),onMouseLeave:()=>c(),onClick:e=>0===e.button?p():void 0,className:`${t.influencerStyle.container} ${f}`},i.createElement(s.Image,{onClick:g,className:t.influencerStyle.img+" avatar",src:e,errorSrc:_}),i.createElement("div",{className:t.influencerStyle.textContainer},this.renderMenu(),i.createElement("div",{dangerouslySetInnerHTML:{__html:h}}),i.createElement("small",null,m?i.createElement("a",{href:"javascript:void(0)",onClick:m},r):r),i.createElement("div",null,i.createElement("span",{className:t.influencerStyle.metricValue},d),i.createElement("span",null,o))),u?n.InfluencerNetworkMetricsComponent.renderInfluencerMetrics(y):null)}generateClickAction(e,t){if(e.onClick)return t=>{this.props.mediator.dispatch(r.INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE,{}),t.stopPropagation(),e.onClick()};if(e.dropdown)return i=>{this.props.mediator.dispatch(r.INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE,{}),i.stopPropagation(),e.dropdown(i,t,this.props)};throw new Error("invalid state")}renderMenu(){return this.props.actions&&this.props.actions.length?i.createElement("div",{className:"menu"},this.props.actions.map((e,t)=>i.createElement("div",{key:t,ref:`menu${t}`,className:"button",onClick:this.generateClickAction(e,this.refs[`menu${t}`])},i.createElement("i",{className:e.icon})))):null}}}),define("classes/influencer_network",["require","exports","react","classes/influencer_network_renderer","classes/influencer_network_layer","classes/influencer_network_node","classes/influencer_network_link","reusable_utilities","math_utils","bubble_dialog_tray","react/influencer_dialog/influencer","reusable_services","react/influencer_network_sidebar/influencer_network_sidebar","reusable_components","classes/influencer_network_layout","map","classes/influencer_network_messages","react/influencer_network_sidebar/pages/influencer_network_sidebar_view_page"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,f,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class b{constructor(e,t,i,n,r){this.settings=t,this.model=i,this.numLayers=3,this.maxScale=3,this.scaleStepMultiplier=1.5,this.initialized=!1,this.updated=!1,this.dragging=!1,this.mousePositionX=0,this.mousePositionY=0,this.blockUnselection=!1,this.renderer=new s.InfluencerNetworkRenderer,this.resolutionMultiplier=1,this.themeId=0,this.blockUnselectionOnce=!1,this.allowRecursiveSelection=!0,this.hightlightedLinkedObjectTreeItems=[],this.mediator=r,this.fragmentModel=n,this.cancellationToken=new a.CancellationToken;const o=t.dimensions.size.clone();this.configureBubbleDialogTray(e,t.dimensions).processModel(i).buildLayers(e,t).setUpMouseEvents(e).setInitialZoom(i,o.clone().mul(this.resolutionMultiplier)).setInitialPosition(i).setInitialTheme(i).initializeMediator().setOverviewMode().buildUi()}setOverviewMode(){return this.checkLoadImages(!0).then(()=>{this.overviewModeAllowed=!0,this.renderer.getScale()===this.minScale&&(this.overviewMode=!0)}),this}initializeMediator(){return this.mediator.listen(u.REQUEST_DATA,()=>{this.canBroadcast=!0,this.broadCastInfluencerData(this.nodes,!1),this.mediator.dispatch(f.RESPOND_HASHTAGS,this.model.hashtags),this.mediator.dispatch(f.UPDATE_SOURCE_PANEL_COUNTS,this.model.sourcePanelItems),this.mediator.dispatch(f.UPDATE_TOPICS_AND_CHANNELS,this.model.topicAndChannelItems)}),this.mediator.listen(f.UPDATE_NODE_SELECTION_LEVEL,e=>{e.node.highlightLevel(e.newLevel),this.canBroadcast=!0,this.renderer.refresh(),this.cancellationToken.setTimeout(()=>{this.recalculateClickBubbles()})}),this}setInitialTheme(e){return e.widget.getExtendedConfiguration().hasColorScheme()&&this.switchTheme(e.widget.getExtendedConfiguration().getColorScheme()),this}setInitialZoom(e,t){return e.widget.getExtendedConfiguration().hasWidgetCameraState()?(this.renderer.setScale(e.widget.getExtendedConfiguration().getWidgetCameraState().zoom,l.Vector2D.zero()),this.minScale=t.componentWiseDiv(e.boundingBox.size).getSmallestComponent()*(1/this.scaleStepMultiplier)):(this.renderer.setScale(t.componentWiseDiv(e.boundingBox.size).getSmallestComponent(),l.Vector2D.zero()),this.minScale=this.renderer.getScale()*(1/this.scaleStepMultiplier)),this}setInitialPosition(e){let t;return t=e.widget.getExtendedConfiguration().hasWidgetCameraState()?e.widget.getExtendedConfiguration().getWidgetCameraState().panningOffset.flip():e.boundingBox.position.clone().add(e.boundingBox.size.clone().div(2).div(this.resolutionMultiplier)).mul(this.renderer.getScale()),this.renderer.drawOffset.set(-t.x,-t.y),this}configureBubbleDialogTray(e,t){return this.hoveringBubbleDialogTray=new c.BubbleDialogTrayController(window.tw.inject("bubbleDialogService"),{width:230,height:75,position:"TOP",targetElement:$(e),animationSpeed:0,bubbleFactory:{influencer:e=>i.createElement(d.Influencer,Object.assign({},e))},distanceBetweenBubbles:0,offsetFromTargetElement:new l.Vector2D(t.x+50,t.y+20)}),this.cancellationToken.registerCleanupFunction(()=>this.hoveringBubbleDialogTray.reset()),this}setUpMouseEvents(e){return $(e).on("wheel",e=>{e.preventDefault(),this.mouseZoom(e)}).on("mousedown",e=>{e.preventDefault(),0===e.button&&(this.canBroadcast=!0,this.dragging=!0)}).on("mousemove",e=>{this.mouseMove(e)}),this.cancellationToken.addDomEvent($("body"),"mouseup",e=>{this.mouseDragEnd(e)}),this.cancellationToken.addDomEvent($("body"),"keydown",e=>{e.keyCode===a.Keys.ESCAPE&&this.onEscape()}),this}onEscape(){this.removeSelection(),this.cancellationToken.setTimeout(()=>this.recalculateClickBubbles(!1))}removeSelection(){this.cancellationToken.setTimeout(()=>{this.removeSelectionSync()})}removeSelectionSync(){this.blockUnselectionOnce?this.blockUnselectionOnce=!1:this.blockUnselection||(this.stopPing(),this.selectedNode&&(this.canBroadcast=!0,this.selectedNode=void 0,this.renderer.removeHighlight(),this.renderer.drawEnhancers.delete(s.DrawEnhancers.HIGHLIGHT_SELECTION),this.nodes.forEach(e=>e.removeHighlight()),this.renderer.removeHighlightMode(s.HighlightMode.SELECTION),this.renderer.refresh()))}click(e){if(0!==e.button)return;if(this.blockUnselectionOnce)return void(this.blockUnselectionOnce=!1);if(this.blockUnselection)return;const t=this.renderer.projectPoint(new l.Vector2D(e.offsetX,e.offsetY));void 0===this.nodes.find(e=>!!e.hitCheck(t)&&(this.selectNode(e),!0))&&this.removeSelection(),this.cancellationToken.setTimeout(()=>{this.recalculateClickBubbles()})}mouseDragEnd(e){if(this.dragging){this.dragging=!1;const t=this.renderer.offset.getLength();this.renderer.resetDragOffsets(),t<8?this.click(e):(this.persistWidgetCamera(),this.onAfterViewChanged())}else this.onEscape()}mouseMove(e){if(this.mousePositionX=e.offsetX,this.mousePositionY=e.offsetY,this.dragging||this.checkHover(new l.Vector2D(e.offsetX,e.offsetY)),this.dragging){const t=new l.Vector2D(this.renderer.offset.x+e.originalEvent.movementX,this.renderer.offset.y+e.originalEvent.movementY);t.x>this.settings.dimensions.width||t.x<-this.settings.dimensions.width||t.y>this.settings.dimensions.height||t.y<-this.settings.dimensions.height||this.renderer.offset.set(t.x,t.y)}}mouseZoom(e){let t;if(e.originalEvent.deltaY>0){if(this.overviewModeAllowed&&!this.overviewMode&&this.renderer.getScale()===this.minScale)return this.overviewMode=!0,this.nodes.forEach(e=>e.imagesAllowed=!1),void this.renderer.refresh();t=1/this.scaleStepMultiplier}else{if(this.nodes.forEach(e=>e.imagesAllowed=!0),this.overviewModeAllowed&&this.overviewMode&&this.renderer.getScale()===this.minScale)return this.overviewMode=!1,void this.renderer.refresh();t=this.scaleStepMultiplier}this.zoom(t,new l.Vector2D(this.mousePositionX,this.mousePositionY))}zoom(e,t){this.canBroadcast=!0;const i=this.renderer.getScale(),s=Math.max(this.minScale,Math.min(this.maxScale,i*e)),n=this.renderer.projectPoint(t);this.renderer.setScale(s,l.Vector2D.zero());const r=s-i;this.renderer.drawOffset.sub(n.mul(r)),this.persistWidgetCamera(),this.onAfterViewChanged()}onAfterViewChanged(){this.selectedNode||this.updateInfluencersInSidebar(!1),this.checkLoadImages(!0)}updateInfluencersInSidebar(e=!1){if(this.selectedNode)return void this.broadCastInfluencerData([],e);if(this.model.layout===g.InfluencerNetworkLayout.GRAPH_HIDDEN)return void this.broadCastInfluencerData(this.nodes);const t=this.renderer.getViewport(),i=this.nodes.filter(e=>e.isInRectangle(t));this.broadCastInfluencerData(i,!1)}checkHover(e){const t=this.renderer.projectPoint(e);!this.nodes.find(e=>!!e.hitCheck(t)&&(e!==this.hoveringNode&&(this.hoveringNode&&this.hoveringNode.setHoverState(!1),e.setHoverState(!0),this.renderer.refresh(),this.hoveringNode=e,this.recalculateHoverBubbles()),!0))&&this.hoveringNode&&(this.hoveringNode.setHoverState(!1),this.hoveringNode=void 0,this.renderer.refresh(),this.recalculateHoverBubbles())}recalculateHoverBubbles(){if(this.hoveringNode){if(!this.hoveringBubbleDialogTray.hasDialog(this.hoveringNode.getId())){const e={type:"influencer",id:this.hoveringNode.getId(),data:this.createBubbleModelFromNode(this.hoveringNode,!1)};this.hoveringBubbleDialogTray.addPopUp(e.id,e.type,e.data),this.renderer.setCursor("pointer")}}else this.renderer.setCursor(""),this.hoveringBubbleDialogTray.reset()}recalculateClickBubbles(e=!1){(this.recalcCache||this.selectedNode)&&(this.recalcCache=this.selectedNode,this.updateInfluencersInSidebar(e))}broadCastInfluencerData(e=[],t=!1){if(!this.canBroadcast)return this;this.canBroadcast=!1;let i=[];return this.nodes.forEach(e=>{e.highlighted&&i.push(this.createBubbleModelFromNode(e,!0))}),0===i.length&&(i=e.map(e=>this.createBubbleModelFromNode(e,!0))),i=i.sort((e,t)=>t.metricValueNumber-e.metricValueNumber),this.mediator.dispatch(f.UPDATE_SELECTED_INFLUENCERS,{models:i,articleUrls:this.getInteractionArticleUrls(),changePage:t}),this}createBubbleModelFromNode(e,t){const i=this.fragmentModel.buildConfiguration.messages,s=this.settings.style.formatting.numberFormatter,n=h.emojiService.parseTextForEmoji(e.model.longName),r={isSelected:this.selectedNode===e,isInfluencer:e.model.isInfluencer,influencerId:e.model.id,handle:e.model.shortName,imageUrl:e.model.image_url.replace("_normal","_200x200"),profileUrl:e.model.profileUrl,fallbackImageUrl:this.fragmentModel.buildConfiguration.defaultAvatarUrl,sideMetrics:[i.totalCrowdSize.replace("{0}",s.toDecimal(e.model.totalCrowdSize))],name:n,metricValueNumber:e.model.numFollowers,onClick:()=>{this.canBroadcast=!0,this.selectNode(e),e.isInRectangle(this.renderer.getViewport())||this.centerInfluencer(e),this.blockUnselectionOnce=!0},onMouseEnter:()=>this.ping(e.model.id),onMouseLeave:()=>this.stopPing(),onImageClick:t=>{this.fragmentModel.buildConfiguration.canDrilldown&&(t.stopPropagation(),this.stopPing(),this.fragmentModel.buildConfiguration.onInfluencerClick(this.fragmentModel.widget,e.model.id,this.mediator))},onProfileClick:t=>{t.stopPropagation(),window.open(e.model.profileUrl,"_blank")},actions:[],source:e.model.source};return t&&this.fragmentModel.buildConfiguration.showInfluencerMenu&&(this.fragmentModel.buildConfiguration.isInfluencerManagementModule?r.actions.push({icon:"fa fa-save",dropdown:(e,t,i)=>{this.fragmentModel.buildConfiguration.onAddInfluencerToList(i,this.mediator)}}):r.actions.push({icon:"icon-tw-ellipsis no-events",dropdown:(e,t,i)=>{this.constructSourcePanelDropdown(e,t,i)}})),e.model.numFollowers>0&&(r.metricName=i.followers,r.metricValue=s.toDecimal(e.model.numFollowers)),r}processModel(e){return this.nodes=this.buildNodes(e),this.links=this.buildLinks(e,this.nodes),this.renderer.setObjects([...this.nodes,...this.links]),this}buildLinks(e,t){return e.links.map(e=>new o.InfluencerNetworkLink(e,t.find(t=>t.getId()===e.startNode.id),t.find(t=>t.getId()===e.endNode.id),this.themeId).setLayerId(0))}buildNodes(e){return _.map(e.nodes,e=>new r.InfluencerNetworkNode(e,this.themeId).setLayerId(1))}buildLayers(e,t){const i={dimensions:t.dimensions,heightMode:t.heightMode};return i.dimensions=i.dimensions.clone(),i.dimensions.size.mul(3),this.renderer.setVisibleLayer(new n.InfluencerNetworkLayer(0,{dimensions:t.dimensions,heightMode:t.heightMode,resolutionMultiplier:this.resolutionMultiplier},e)),this.renderer.setDrawLayers(_.times(this.numLayers,e=>new n.InfluencerNetworkLayer(e,i))),this}async update(e){return this.model=e,this.processModel(e),this.updated=!0,this}async draw(e){const t=this.updated||this.settings.dimensions.width!==e.dimensions.width||this.settings.dimensions.height!==e.dimensions.height;if(this.settings=e,t){const e=this.settings.dimensions.size.clone();this.setInitialZoom(this.model,e.clone().mul(this.resolutionMultiplier)).setInitialPosition(this.model),this.updated=!1}this.renderer.updateVisibleLayers({resolutionMultiplier:this.resolutionMultiplier,heightMode:e.heightMode,dimensions:e.dimensions});const i={heightMode:e.heightMode,dimensions:e.dimensions};return i.dimensions=i.dimensions.clone(),i.dimensions.size.mul(3),this.renderer.updateDrawLayers(i),this.initialized?this.renderer.refresh():(this.initialized=!0,this.renderer.start(e)),this}dispose(){this.cancellationToken.cancel()}checkLoadImages(e){return new Promise(t=>{const i=this.renderer.getViewport(),s=this.nodes.map(e=>e.checkLoadImage(i,this.renderer.getScale()));e?s.forEach(e=>e.then(()=>{t(),this.renderer.refresh()},()=>{})):s.forEach(e=>e.then(()=>{t()},()=>{}))})}buildUi(){return this.settings.style.showWidgetUI&&this.renderer.createUi({history:this.model.history,currentHistoryIndex:this.model.currentHistoryIndex,onNavigateHistory:e=>this.fragmentModel.buildConfiguration.onHistoryClick(this.fragmentModel.widget,e),zoomIn:e=>{this.blockUnselectionOnce=!0,this.zoom(this.scaleStepMultiplier,this.renderer.size.div(2))},zoomOut:e=>{this.blockUnselectionOnce=!0,this.zoom(1/this.scaleStepMultiplier,this.renderer.size.div(2))}}),this}getNodeById(e){return this.nodes.find(t=>t.getId()===e)}highlight(e){this.renderer.highlight(e)}ping(e){this.pingToken&&this.stopPing(),this.pingToken=new a.CancellationToken;const t=this.getNodeById(e);t&&(this.renderer.ping(t.shape.position.clone(),t.getColor(),t.getRadius()/2),this.pingToken.setInterval(()=>{this.renderer.ping(t.shape.position.clone(),t.getColor(),t.getRadius()/2)},700))}setRecursiveSelection(e){this.allowRecursiveSelection=e,!1===e&&this.selectedNode&&this.recomputeSelection()}setFilterView(e){this.activeFilterViewType=e,e!==y.InfluencerNetworkFilterViewType.Default&&e!==y.InfluencerNetworkFilterViewType.Hashtags||(this.renderer.drawEnhancers.delete(s.DrawEnhancers.HIGHLIGHT_FILTER_VIEW),this.renderer.removeHighlightMode(s.HighlightMode.FILTER_VIEW),this.nodes.forEach(e=>e.highlightForLinkedObject(!1))),e!==y.InfluencerNetworkFilterViewType.Default&&(this.renderer.drawEnhancers.set(s.DrawEnhancers.HIGHLIGHT_FILTER_VIEW,(e,t)=>t.globalAlpha=.4),this.renderer.addHighlightMode(s.HighlightMode.FILTER_VIEW)),this.renderer.refresh()}setHighlightLinkedObjectSelection(e){this.hightlightedLinkedObjectTreeItems=e,this.highlightLinkedObjects()}highlightLinkedObjects(){this.nodes.forEach(e=>{let t,i=!1;for(const s of e.model.matchingObjects){for(const n of this.hightlightedLinkedObjectTreeItems)if(s.id===n.id){if(i=!0,t){t=r.HASHTAG_SELECTION_COLOR;break}t=n.getColor()||e.getColor().clone().lighten(.3).toHex6()}if(t===r.HASHTAG_SELECTION_COLOR)break}e.highlightForLinkedObject(i,t)}),this.renderer.refresh()}setHighlightHashtagSelection(e,t){const i=new m.Map;t.forEach(e=>{const t=this.model.hashtags.get(e);t.authors.forEach(e=>{i.has(e)?i.set(e,r.HASHTAG_SELECTION_COLOR):i.set(e,t.color)})}),this.nodes.forEach(t=>{i.has(t.getId())?t.highlightForLinkedObject(e,i.get(t.getId())):t.highlightForLinkedObject(!1)}),this.renderer.refresh()}persistWidgetCamera(){this.model.widget.getExtendedConfiguration().setWidgetCameraState(this.renderer.drawOffset,this.renderer.getScale())}stopPing(){this.pingToken&&this.pingToken.cancel()}disableUnselect(){this.blockUnselection=!0}enableUnselect(){this.blockUnselection=!1}switchTheme(e){this.themeId=e,this.nodes.forEach(t=>t.setThemeId(e)),this.model.widget.getExtendedConfiguration().setColorScheme(e),this.renderer.refresh()}centerInfluencer(e){this.renderer.drawOffset.merge(e.shape.position.clone().mul(this.renderer.getScale()).flip()),this.renderer.refresh()}constructSourcePanelDropdown(e,t,s){if(e.isDefaultPrevented())return;const n=window.tw.inject("bubbleDialogService"),r=window.tw.inject("configurationService");let o;if(n.destroyById("source_panel_menu"),this.selectedNode&&this.selectedNode.getId()===s.influencerId){const e=this.selectedNode.getHighlightedNodes();o=e.map(e=>this.createBubbleModelFromNode(e,!1))}const a=n.createReactBubble("source_panel_menu",$(t),{payload:this.model.widget.getPayloadValue(),widgetId:this.model.widget.getId()},e=>{const{messages:n}=this.fragmentModel.buildConfiguration,{payload:r}=e,l={messages:{sourcePanelHeader:n.sourcePanelHeader,header:void 0,addPanelMessage:n.sourcePanelAddNew,addSelectionPanelMessage:n.sourcePanelSelectionAddNew,includePanelMessage:n.sourcePanelInclude,includeSelectionPanelMessage:n.sourcePanelSelectionInclude,excludePanelMessage:n.sourcePanelExclude,excludeSelectionPanelMessage:n.sourcePanelSelectionExclude,blockSourceHeader:"blockSourceHeader",blockSourceMessage:"blockSourceMessage"},panels_groups:r.panels_groups||[],category:this.createCategory([s]),selectionCategory:o?this.createCategory(o):void 0,forceVisible:!0,widgetId:e.widgetId,onIncludePanel:e=>this.onIncludePanel(e),onApplyFavorite:e=>this.onApplyFavorite(e),onApplyInfluenstar:e=>this.onApplyInfluenstar(e)};return i.createElement(p.DocumentClickTrackerWrapper,{clickInside:()=>setTimeout(this.handleContextMenuClick.bind(this,a,t)),clickOutside:this.handleContextMenuClick.bind(this,a,t),className:"influencer-source-actions-menu tw-source-actions-menu"},i.createElement(p.SourceActionsDropdownRenderable,Object.assign({},l)))},r.getBubbleDialogConfiguration().getStyle("source_panel_menu"),{timeout:{delay:0}})}toggleSourcePanel(e,t){e.toggleMatchingObject(t,y.InfluencerNetworkFilterViewType.SourcePanel)?this.model.sourcePanelItems.has(t)?this.model.sourcePanelItems.get(t).push(e.id):this.model.sourcePanelItems.set(t,[e.id]):this.model.sourcePanelItems.get(t).splice(this.model.sourcePanelItems.get(t).indexOf(e.id)),this.mediator.dispatch(f.UPDATE_SOURCE_PANEL_COUNTS,this.model.sourcePanelItems)}removeSourcePanel(e,t){this.model.sourcePanelItems.has(t)&&this.model.sourcePanelItems.get(t).splice(this.model.sourcePanelItems.get(t).indexOf(e.id)),e.removeMatchingObjectById(t),this.mediator.dispatch(f.UPDATE_SOURCE_PANEL_COUNTS,this.model.sourcePanelItems)}onIncludePanel(e){e.sources.forEach(t=>{const i=this.model.nodes[t.id];this.toggleSourcePanel(i,e.panel.id)}),this.activeFilterViewType!==y.InfluencerNetworkFilterViewType.Default&&this.highlightLinkedObjects()}onApplyFavorite(e){e.sources.forEach(e=>{const t=this.model.nodes[e.id];this.toggleSourcePanel(t,"favourites")}),this.activeFilterViewType!==y.InfluencerNetworkFilterViewType.Default&&this.highlightLinkedObjects()}onApplyInfluenstar(e){e.sources.forEach(t=>{const i=this.model.nodes[t.id];for(let t=1;t<=3;++t)t===e.value?this.toggleSourcePanel(i,`star${t}`):this.removeSourcePanel(i,`star${t}`)}),this.activeFilterViewType!==y.InfluencerNetworkFilterViewType.Default&&this.highlightLinkedObjects()}handleContextMenuClick(e,t,i){e.destroy(),i&&i.target===t&&(i.preventDefault(),i.stopPropagation())}createCategory(e){const{name:t,user_rating:i,blockable:s,favorite:n}=e[0].source;return{author:!0,mapped_id:"AUTHOR",name:t,sources:e.map(e=>e.source),favorite:n,userRating:i,blockable:s,visible:!1,showOnlyBlockOption:!1,showOptionToAddToSourcePanel:!1}}selectNode(e){void 0===this.selectedNode&&this.renderer.drawEnhancers.set(s.DrawEnhancers.HIGHLIGHT_SELECTION,(e,t)=>t.globalAlpha=.4),(e!==this.selectedNode||this.allowRecursiveSelection)&&(e!==this.selectedNode&&(this.nodes.forEach(e=>e.removeHighlight()),this.selectedNode=e,this.highlight(e)),e.highlight(),this.mediator.dispatch(f.UPDATE_NODE_SELECTION,e),this.renderer.addHighlightMode(s.HighlightMode.SELECTION),this.renderer.refresh())}getInteractionArticleUrls(){const e=t=>t.reduce((t,i)=>t.concat(Array.isArray(i)?e(i):i),[]);let t;if(void 0!==this.selectedNode)t=this.links.filter(e=>e.highlighed);else{const i=this.renderer.getViewport();t=e(this.nodes.filter(e=>e.isInRectangle(i)).map(e=>e.links))}return e(t.map(e=>e.getInteractions())).sort(e=>e.engagement||e.reach).map(e=>e.entryId)}recomputeSelection(){const e=this.selectedNode;this.selectedNode=void 0,this.renderer.removeHighlight(),this.renderer.drawEnhancers.delete(s.DrawEnhancers.HIGHLIGHT_SELECTION),this.nodes.forEach(e=>e.removeHighlight()),this.selectNode(e)}}__decorate([a.throttle(150,{leading:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],b.prototype,"mouseZoom",null),__decorate([a.debounce(250),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],b.prototype,"onAfterViewChanged",null),t.InfluencerNetwork=b}),define("classes/influencer_network_fragment",["require","exports","reusable_utilities","widget_base","models/influencer_network_model","classes/influencer_network","classes/influencer_network_messages","classes/influencer_network_layout"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkFragment=class{constructor(e){this.fragmentModel=e,this.influencerNetworkModel=new n.InfluencerNetworkModel(e.widget,e.buildConfiguration.getLayout(e.widget))}initialize(e,t,i){return this.mediator=t,i.style.placement.centeredVertically?e.classList.add("flex-center-vertically"):e.classList.remove("flex-center-vertically"),this.network=new r.InfluencerNetwork(e,i,this.influencerNetworkModel,this.fragmentModel,this.mediator),this.mediator.listen(o.SET_INFLUENCER_NETWORK_FILTER_VIEW_TYPE,e=>{this.network.setFilterView(e)}),this.mediator.listen(o.SET_LINKED_OBJECT_SELECTION,e=>{this.network.setHighlightLinkedObjectSelection(e)}),this.mediator.listen(o.SET_HIGHLIGHTED_HASHTAGS,e=>{this.network.setHighlightHashtagSelection(e.state,e.hashtags)}),this.mediator.listen(o.SET_INFLUENCER_NETWORK_RECURSIVE_SELECTION,e=>{this.network.setRecursiveSelection(e)}),this.mediator.listen(o.INFLUENCER_NETWORK_ENABLE_UNSELECT,()=>{this.network.enableUnselect()}),this.mediator.listen(o.INFLUENCER_NETWORK_DISABLE_UNSELECT_ONCE,()=>{this.network.blockUnselectionOnce=!0}),this.mediator.listen(o.INFLUENCER_NETWORK_DISABLE_UNSELECT,()=>{this.network.disableUnselect()}),this.mediator.listen(o.INFLUENCER_NETWORK_SWITCH_THEME,e=>{this.network.switchTheme(e)}),Promise.resolve(this)}async update(e){return this.fragmentModel=e,this.influencerNetworkModel=new n.InfluencerNetworkModel(e.widget,this.influencerNetworkModel.layout),await this.network.update(this.influencerNetworkModel),this.mediator.isDisposed()||this.mediator.dispatch(o.INFLUENCER_NETWORK_UPDATED,""),this}async draw(e){return await this.network.draw(e),await i.waitFor(500),this}dispose(){this.network.dispose()}getLayoutIterator(){const e=a.INFLUENCER_NETWORK_FRAGMENT_LAYOUTS.filter(e=>e.id===this.influencerNetworkModel.layout);return new s.LayoutIterator(e,e=>({width:Math.min(e.dimensions.width||0,e.dimensions.height||0),height:Math.min(e.dimensions.width||0,e.dimensions.height||0)}))}}}),define("influencer_network",["require","exports","classes/influencer_network","classes/influencer_network_fragment","classes/influencer_network_layer","classes/influencer_network_layout","classes/influencer_network_link","classes/influencer_network_messages","classes/influencer_network_node","classes/influencer_network_object","classes/influencer_network_renderer","models/influencer_network_hashtag_model","models/influencer_network_link_model","models/influencer_network_model","models/influencer_network_node_model","react/influencer_dialog/influencer","react/influencer_network_sidebar/influencer_network_sidebar","react/influencer_network_sidebar/influencer_network_sidebar_fragment","react/influencer_network_sidebar/pages/influencer_network_sidebar_view_page"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y){"use strict";function b(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),b(i),b(s),b(n),b(r),b(o),b(a),b(l),b(c),b(d),b(h),b(u),b(p),b(g),b(m),b(_),b(f),b(y)}),define("react/influencer_network_sidebar/influencer_network_sidebar_style.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencerNetworkSidebarStyleModel={levelLabel:{float:"left",paddingRight:"10px"},sidebarHeader:{backgroundColor:"#009bd5",color:"#FFFFFF",padding:"10px",fontWeight:"bold"}},t.influencerNetworkSidebarStyle=i.createCssModule(()=>t.influencerNetworkSidebarStyleModel).compute({}).attach().getModule()}),define("react/influencer_network_sidebar/pages/influencer_network_sidebar_main_page",["require","exports","react","reusable_components","classes/influencer_network_messages"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerNetworkSidebarMainPage=class extends i.Component{render(){return i.createElement("div",null,this.renderColorPaletteSwitcher())}renderColorPaletteSwitcher(){const{buildConfiguration:{messages:e}}=this.props;return i.createElement("div",{className:"settings-container"},i.createElement("div",{className:"headline"},e.settings.theme),i.createElement(s.SingleSelectComponent,{model:this.props.widget.getMenu().getColoringOptionsMenu().toProto(),selectCallback:e=>{this.props.mediator.dispatch(n.INFLUENCER_NETWORK_SWITCH_THEME,parseInt(e.mapped_id,10))}}))}}}),define("interfaces/campaigns_table/action_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/campaigns_table/campaigns_table_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/campaigns_table/campaigns_table_row_cell",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/campaigns_table/row_action",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/campaigns_table/campaigns_table_row",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencers_state_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencer_move_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencer_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencers_list_block_move_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencers_list_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/influencers_lists_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/influencers_list_block.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListBlockStyleModel={root:{position:"relative",height:182,padding:15,margin:15,backgroundColor:"#F4F5F6",zIndex:1},blockHeader:{marginBottom:10},listTitle:{fontFamily:"RobotoM",fontSize:16,marginLeft:5},blockContent:{height:100},influencerImg:{width:40,height:40,objectFit:"cover",borderRadius:"50%",margin:4},tooltipWrapper:{display:"inline-block"}},t.influencersListBlockStyle=i.createCssModule(()=>t.influencersListBlockStyleModel).compute({}).attach().getModule()}),define("renderables/block/influencers_list_block_renderable",["require","exports","flux","react","css/influencers_list_block.css","reusable_components","jquery","drag_and_drop","event_bus","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencersListBlockRenderable=class extends i.BaseComponent{constructor(e){super(e),this.hidden=!1,this.state={width:void 0,numVisibleInfluencers:void 0}}componentDidMount(){const e=o(this.refs.root).width();this.registerDragSource(this.refs.root,this.props.influencersList),this.registerDropTarget(),this.setState({width:e,numVisibleInfluencers:this.computeNumVisibleInfluencers(e)})}render(){const e=2*n.influencersListBlockStyleModel.root.padding,t={width:`calc(${this.props.widthPercent} - ${e}px`};return s.createElement("div",{ref:"root",className:n.influencersListBlockStyle.root,style:t},this.renderBlockHeader(),this.renderContent())}renderContent(){return void 0!==this.state.width?[this.renderInfluencers(),this.renderHiddenInfluencers()]:null}renderInfluencers(){return void 0!==this.props.influencersList.influencers&&this.props.influencersList.influencers.length>0?s.createElement("div",{className:n.influencersListBlockStyle.blockContent},this.props.influencersList.influencers.slice(0,this.state.numVisibleInfluencers).map(e=>this.renderInfluencer(e))):null}renderInfluencer(e){return s.createElement("img",{src:e.profile_image,className:n.influencersListBlockStyle.influencerImg})}renderBlockHeader(){return s.createElement("div",{className:n.influencersListBlockStyle.blockHeader},s.createElement("div",{className:n.influencersListBlockStyle.listTitle},this.props.influencersList.name))}renderHiddenInfluencers(){if(void 0!==this.props.influencersList.influencers&&this.props.influencersList.influencers.length>this.state.numVisibleInfluencers){const e=`+  ${this.props.influencersList.influencers.length-this.state.numVisibleInfluencers}  ${this.props.messages.moreLabel}`;let t="";return this.props.influencersList.influencers.slice(this.state.numVisibleInfluencers).map(e=>e.profile_name).forEach(e=>{t+=e+"\r\n"}),s.createElement("div",{className:n.influencersListBlockStyle.tooltipWrapper},s.createElement(r.TooltipComponent,{text:t,position:"bottom"},s.createElement("a",null,e)))}return null}computeNumVisibleInfluencers(e){const t=this.computeAvailableWidthForInfluencers(e);return this.computeNumVisibleInfluencersX(t)*this.computeNumVisibleInfluencersY(n.influencersListBlockStyleModel.blockContent.height)}computeAvailableWidthForInfluencers(e){return e-2*n.influencersListBlockStyleModel.root.padding}computeNumVisibleInfluencersX(e){return Math.floor(e/n.influencersListBlockStyleModel.influencerImg.width)}computeNumVisibleInfluencersY(e){return Math.floor(e/n.influencersListBlockStyleModel.influencerImg.height)}registerDragSource(e,t){a.dragAndDropService.registerDragSources([e],{onDragStart:this.onDragStart.bind(this),onDragMove:this.onDragMove.bind(this),onDragStop:this.onDragStop.bind(this),channels:["influencers-list"],minimumDragDistance:5,cancellationToken:this.cancellationToken})}async onDragStart(e){e.stopPropagation(),e.preventDefault(),this.showMovingCursor();const t=o(this.refs.root);return this.dragHandle=this.createDragHandle(t),this.addDragHandle(),this.moveDragHandle(e),this.hideElement(t),{dragHandle:this.dragHandle[0],model:this.props.influencersList}}onDragMove(e,t){e.preventDefault(),e.stopPropagation(),t.sharedData=o(this.refs.root),this.moveDragHandle(e)}async onDragStop(e,t){this.showElement(o(this.refs.root)),this.hideMovingCursor(),this.removeDragHandle()}createDragHandle(e){const t=o(document.createElement("div"));t.css({position:"absolute",zIndex:"9999",pointerEvents:"none"});const i=e.clone();return i.css({width:e.outerWidth(),height:e.outerHeight(),transform:"scale(0.5)",opacity:.64,border:"4px solid lightblue"}),t.append(i),t}addDragHandle(){o("body").prepend(this.dragHandle)}removeDragHandle(){this.dragHandle.remove(),this.dragHandle=void 0}moveDragHandle(e){const t=e.clientX+window.pageXOffset-this.dragHandle.width()/2,i=e.clientY+window.pageYOffset-this.dragHandle.height()/2;this.dragHandle.css({left:t,top:i})}hideElement(e){e.css({opacity:0}),this.hidden=!0}showElement(e){e.css({opacity:""}),this.hidden=!1}showMovingCursor(){o("body").css("cursor","move")}hideMovingCursor(){o("body").css("cursor","")}registerDropTarget(){a.dragAndDropService.registerDropTargets([this.refs.root],{onDragEnter:this.onDropzoneDragEnter.bind(this),onDragMove:this.onDropzoneDragMove.bind(this),onDragAccept:this.onDropzoneDragAccept.bind(this),onDragCancel:this.onDropzoneDragCancel.bind(this),onDragLeave:this.onDropzoneDragLeave.bind(this),cancellationToken:this.cancellationToken,channels:["influencers-list"]})}onDropzoneDragEnter(e,t){c.DOMMath.isPointOnLeftHalf({x:e.pageX,y:e.pageY},o(this.refs.root))?(this.buildDropsideElementIfAbsent(),this.dropsideElement.css({left:"-10px"}),o(this.refs.root).append(this.dropsideElement)):c.DOMMath.isPointOnRightHalf({x:e.pageX,y:e.pageY},o(this.refs.root))&&(this.buildDropsideElementIfAbsent(),this.dropsideElement.css({right:"-10px"}),o(this.refs.root).append(this.dropsideElement)),this.hidden&&(this.buildDropzoneElementIfAbsent(),o(t.sharedData.parent()).append(this.dropzoneElement))}onDropzoneDragMove(e,t){void 0!==this.dropsideElement&&(c.DOMMath.isPointOnLeftHalf({x:e.pageX,y:e.pageY},o(this.refs.root))?(this.dropsideElement.css({left:"-10px",right:""}),o(this.refs.root).before(t.sharedData)):c.DOMMath.isPointOnRightHalf({x:e.pageX,y:e.pageY},o(this.refs.root))?(this.dropsideElement.css({right:"-10px",left:""}),o(this.refs.root).after(t.sharedData)):c.DOMMath.isPointOnElement({x:e.pageX,y:e.pageY},t.sharedData.parent())||this.removeDropsideElementIfExists())}onDropzoneDragLeave(e,t){this.removeDropsideElementIfExists(),this.removeDropzoneElementIfExists()}onDropzoneDragAccept(e,t){this.removeDropsideElementIfExists(),this.dispatchNewIndex(e,t)}onDropzoneDragCancel(e,t){this.removeDropsideElementIfExists(),this.props.influencersList===t.model&&l.eventBus.dispatch({type:l.EVENT_TYPES.REDRAW_INFLUENCERS_LISTS,value:t.model})}buildDropsideElementIfAbsent(){if(void 0===this.dropsideElement){const e=o("<div></div>");e.css({position:"absolute",width:"5px",height:"100%",backgroundColor:"lightblue",top:0}),this.dropsideElement=e}}removeDropsideElementIfExists(){void 0!==this.dropsideElement&&(this.dropsideElement.remove(),this.dropsideElement=void 0)}buildDropzoneElementIfAbsent(){if(void 0===this.dropzoneElement){const e=o(this.refs.root),t=o("<div></div>");t.css({position:"absolute",width:e.outerWidth(),height:e.outerHeight(),border:"3px dashed lightblue",left:e.position().left,top:e.position().top,margin:"15px",zIndex:0}),this.dropzoneElement=t}}removeDropzoneElementIfExists(){void 0!==this.dropzoneElement&&(this.dropzoneElement.remove(),this.dropzoneElement=void 0)}dispatchNewIndex(e,t){const i=t.sharedData.parent().children().index(t.sharedData);l.eventBus.dispatch({type:l.EVENT_TYPES.ON_DRAG_STOP_INFLUENCERS_LIST,value:{list:t.model,newIndex:i}})}}}),define("css/influencers_list_blocks.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListBlocksStyleModel={lists:{display:"flex",flexWrap:"wrap"}},t.influencersListBlocksStyle=i.createCssModule(()=>t.influencersListBlocksStyleModel).compute({}).attach().getModule()}),define("renderables/block/influencers_lists_blocks_renderable",["require","exports","flux","react","renderables/block/influencers_list_block_renderable","event_bus","css/influencers_list_blocks.css","underscore"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencersListsBlocksRenderable=class extends i.BaseComponent{constructor(e){super(e),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.REDRAW_INFLUENCERS_LISTS,this.handleRedraw.bind(this))}render(){return s.createElement("div",null,this.renderLists())}renderLists(){return s.createElement("div",{className:o.influencersListBlocksStyle.lists},this.props.influencersLists.map(e=>this.renderList(e)))}renderList(e){const t=Math.max(25,100/this.props.influencersLists.length)+"%";return s.createElement(n.InfluencersListBlockRenderable,{key:a.uniqueId(`${e.name}-`),influencersList:e,messages:this.props.messages.influencerListMessages,widthPercent:t})}handleRedraw(e){this.props.influencersLists.some(t=>t.list_id===e.value.list_id)&&this.forceUpdate()}}}),define("renderables/campaigns_table/campaigns_table_renderable",["require","exports","flux","react","event_bus","classnames"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CampaignsTableRenderable=class extends i.BaseComponent{constructor(e){super(e)}render(){return s.createElement("div",{className:"campaigns-table"},s.createElement("table",{className:"common-table"},this.renderTableHeader(),this.renderTableBody()),this.renderEmptyText())}renderTableHeader(){return s.createElement("thead",null,s.createElement("tr",{className:"headers"},this.props.columns.map(e=>this.renderColumn(e))))}renderColumn(e){return s.createElement("th",{key:e.code},s.createElement("span",null,e.name))}renderTableBody(){return s.createElement("tbody",null,this.props.rows.map((e,t)=>this.renderRow(e,t)))}renderRow(e,t){const i=void 0!==e.rowAction?t=>this.handleRowClick(e):void 0,n=r({"row-hover row-bottom-border":!0,clickable:this.isRowClickable(e)});return s.createElement("tr",{key:t,onClick:i,className:n},e.cells.map((e,t)=>this.renderCell(e,t)))}renderCell(e,t){return s.createElement("td",{key:t},this.renderCellValue(e),this.renderCellActions(e))}renderCellValue(e){const t=r({"bold-data":this.isCellValueBold(e)});return void 0!==e.value?s.createElement("span",{className:t},e.value):null}renderCellActions(e){return void 0!==e.actionItems?s.createElement("span",{className:"actions"},e.actionItems.map(e=>this.renderActionItem(e))):null}renderActionItem(e){const t=r([e.icon,"icons-action"]);let i;return void 0!==e.color&&(i={color:e.color}),s.createElement("span",{key:e.icon},s.createElement("i",{onMouseEnter:t=>{this.openTooltip(t,e.tooltipMessage)},onMouseLeave:this.closeTooltip.bind(this),onClick:t=>this.handleActionItemClick(e,t),className:t,style:i}))}renderEmptyText(){return void 0===this.props.rows||0===this.props.rows.length?s.createElement("div",{className:"nothing-to-see-here"},s.createElement("p",null,this.props.messages.noCampaigns)):null}handleRowClick(e){this.dispatchEvent(e.rowAction.type,e.rowAction.payload)}handleActionItemClick(e,t){t.stopPropagation(),this.dispatchEvent(e.action,e.actionPayload)}dispatchEvent(e,t){n.eventBus.dispatch({type:e,value:t})}isCellValueBold(e){return void 0!==e.defaultStyleFlags&&e.defaultStyleFlags.boldText}isRowClickable(e){return void 0!==e.rowAction}openTooltip(e,t){void 0!==t&&n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}componentWillUnmount(){super.componentWillUnmount(),this.closeTooltip()}}}),define("css/influencers_list_overview.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListOverviewStyleModel={root:{position:"relative",width:"100%",height:182,margin:15,border:"1px solid lightgray",zIndex:1},blockHeader:{padding:"6px 10px",marginBottom:10,backgroundColor:"#F4F5F6"},listTitle:{fontFamily:"RobotoB",fontSize:16,marginLeft:5},separator:{marginLeft:10,marginRight:10},datePart:{fontSize:12},headerIcon:{float:"right",marginTop:2,marginRight:3,marginLeft:3,fontSize:16},contentBlock:{display:"flex",alignItems:"center"},leftBlock:{display:"inline-block",width:"50%"},rightBlock:{display:"inline-flex",width:"50%",alignItems:"flex-start",marginRight:10},descriptionBlock:{padding:10},descriptionLabel:{fontWeight:"bold",marginRight:5},influencersBlock:{margin:10},influencerImg:{width:40,height:40,objectFit:"cover",borderRadius:"50%",margin:4,border:"1px solid lightgray"},metricBlock:{display:"inline-flex",flexDirection:"column",flex:"1 0 120px"},metricNumber:{fontFamily:"RobotoB",fontSize:36,textAlign:"center"},metricLabel:{fontFamily:"RobotoR",fontSize:16,textAlign:"center"}},t.influencersListOverviewStyle=i.createCssModule(()=>t.influencersListOverviewStyleModel).compute({}).attach().getModule()}),define("renderables/influencer_list/influencer_list_overview_renderable",["require","exports","flux","jquery","css/influencers_list_overview.css","react","reusable_components","event_bus","classnames"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const c=10;t.InfluencerListOverviewRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={width:void 0,numVisibleInfluencers:void 0}}componentDidMount(){const e=s(this.refs.root).width();this.setState({width:e,numVisibleInfluencers:this.computeNumVisibleInfluencers(e)})}render(){const e=l({"influencer-list-overview":!0,[n.influencersListOverviewStyle.root]:!0,clickable:void 0!==this.props.influencersList.action});return r.createElement("div",{ref:"root",onClick:this.handleListClick.bind(this),className:e},this.renderHeader(),this.renderContent())}renderHeader(){return r.createElement("div",{className:n.influencersListOverviewStyle.blockHeader},r.createElement("span",{className:n.influencersListOverviewStyle.listTitle},this.props.influencersList.name),r.createElement("span",{className:`${n.influencersListOverviewStyle.separator} separator`},"|"),r.createElement("span",{className:n.influencersListOverviewStyle.datePart},this.props.influencersList.last_updated),this.renderDeleteIcon(),this.renderEditIcon())}renderDeleteIcon(){return r.createElement("span",{onMouseEnter:e=>this.openTooltip(e,this.props.messages.deleteTooltip),onMouseLeave:this.closeTooltip.bind(this),onClick:this.handleDeleteListClick.bind(this),className:`icon-tw-trash-bin ${n.influencersListOverviewStyle.headerIcon} clickable  influencer-list-overview-action`})}renderEditIcon(){return r.createElement("span",{onMouseEnter:e=>this.openTooltip(e,this.props.messages.editTooltip),onMouseLeave:this.closeTooltip.bind(this),onClick:this.handleEditListClick.bind(this),className:`fa fa-pencil ${n.influencersListOverviewStyle.headerIcon} clickable  influencer-list-overview-action`})}renderContent(){return r.createElement("div",{className:n.influencersListOverviewStyle.contentBlock},r.createElement("div",{className:n.influencersListOverviewStyle.leftBlock},this.renderDescription(),this.renderInfluencers()),r.createElement("div",{className:n.influencersListOverviewStyle.rightBlock},this.renderInfluencerCount(),this.renderMetrics(),this.renderLoadingState()))}renderDescription(){return void 0!==this.props.influencersList.description&&this.props.influencersList.description.length>0?r.createElement("div",{className:n.influencersListOverviewStyle.descriptionBlock},r.createElement("span",{className:n.influencersListOverviewStyle.descriptionLabel},this.props.messages.descriptionLabel,":"),r.createElement("span",null,this.props.influencersList.description)):null}renderInfluencers(){return void 0!==this.props.influencersList.influencers&&this.props.influencersList.influencers.length>0?r.createElement("div",{className:n.influencersListOverviewStyle.influencersBlock},this.props.influencersList.influencers.slice(0,this.state.numVisibleInfluencers).map(e=>this.renderInfluencer(e))):null}renderInfluencer(e){const t=r.createFactory.bind(r,o.AvatarFallbackImageRenderable);return r.createElement(o.ImageBlockRenderable,{key:_.uniqueId(`${e.profile_name}-`),url:e.profile_image,errorTag:t(),errorClass:n.influencersListOverviewStyle.influencerImg,className:n.influencersListOverviewStyle.influencerImg})}renderInfluencerCount(){const e=void 0!==this.props.influencersList.influencers?this.props.influencersList.influencers.length:0;return r.createElement("div",{className:n.influencersListOverviewStyle.metricBlock},r.createElement("div",{className:n.influencersListOverviewStyle.metricNumber},e),r.createElement("div",{className:n.influencersListOverviewStyle.metricLabel},this.props.messages.influencerCountLabel))}renderMetrics(){return void 0!==this.props.influencersList.metrics?this.props.influencersList.metrics.map(e=>this.renderMetric(e)):null}renderMetric(e){return r.createElement("div",{key:e.text,className:n.influencersListOverviewStyle.metricBlock},r.createElement("div",{className:n.influencersListOverviewStyle.metricNumber},e.value),r.createElement("div",{className:n.influencersListOverviewStyle.metricLabel},e.text))}renderLoadingState(){return this.props.loading?r.createElement("div",{className:"loading-indicator"},r.createElement("i",{className:"fa fa-spinner fa-spin"})):null}computeNumVisibleInfluencers(e){const t=this.computeAvailableWidthForInfluencers(e);return this.computeNumVisibleInfluencersX(t)}computeAvailableWidthForInfluencers(e){return.5*e-2*c}computeNumVisibleInfluencersX(e){const t=n.influencersListOverviewStyleModel.influencerImg.width+2*n.influencersListOverviewStyleModel.influencerImg.margin;return Math.floor(e/t)}handleListClick(e){e.stopPropagation(),void 0!==this.props.influencersList.action&&a.eventBus.dispatch({type:a.EVENT_TYPES.ENTER_INFLUENCER_LIST,value:this.props.influencersList.action})}handleDeleteListClick(e){e.stopPropagation(),a.eventBus.dispatch({type:a.EVENT_TYPES.DELETE_INFLUENCER_LIST,value:this.props.influencersList})}handleEditListClick(e){e.stopPropagation(),a.eventBus.dispatch({type:a.EVENT_TYPES.EDIT_INFLUENCER_LIST,value:this.props.influencersList})}openTooltip(e,t){void 0!==t&&a.eventBus.dispatch({type:a.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){a.eventBus.dispatch({type:a.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}componentWillUnmount(){super.componentWillUnmount(),this.closeTooltip()}}}),define("css/influencers_list_overviews.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListOverviewsStyleModel={lists:{display:"flex",flexWrap:"wrap"},plusIconWrapper:{marginRight:2}},t.influencersListOverviewsStyle=i.createCssModule(()=>t.influencersListOverviewsStyleModel).compute({}).attach().getModule()}),define("renderables/influencer_list/influencer_list_overviews_renderable",["require","exports","flux","react","renderables/influencer_list/influencer_list_overview_renderable","css/influencers_list_overviews.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencerListOverviewsRenderable=class extends i.BaseComponent{render(){return s.createElement("div",null,this.renderLists())}renderLists(){return s.createElement("div",{className:`influencer-list-overviews ${r.influencersListOverviewsStyle.lists}`},this.props.influencersLists.map(e=>this.renderList(e)))}renderList(e){return s.createElement(n.InfluencerListOverviewRenderable,{key:_.uniqueId(`${e.name}-`),influencersList:e,messages:this.props.messages.influencerListMessages,loading:this.props.loadingStates[e.list_id]})}}}),define("css/influencers_list_state.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListStateStyleModel={root:{display:"flex",flex:" 0 0 auto",flexDirection:"column"},header:{minHeight:60,height:60,textAlign:"center"},headerCounter:{fontFamily:"RobotoM",fontSize:28,lineHeight:1,paddingTop:8},headerTitle:{fontFamily:"RobotoM",fontSize:14,lineHeight:1},body:{position:"relative",padding:10,marginBottom:25,overflow:"hidden",height:"100%"},influencerImg:{width:50,height:50,objectFit:"cover",borderRadius:"50%",border:"1px solid lightgray",margin:5,backgroundColor:"white"},dragIndicator:{display:"flex",position:"absolute",right:0,bottom:-18,width:18,height:18,color:"#95a5a6",backgroundColor:"white",borderRadius:"50%",border:"1px solid lightgray",justifyContent:"center",alignItems:"center",fontSize:"12px",paddingLeft:1},navigationBtnWrapper:{position:"absolute",width:"60%",height:16,textAlign:"center",marginRight:"20%",marginLeft:"20%",backgroundColor:"#D7DBDD",zIndex:1,borderRadius:4,opacity:.7,cursor:"pointer","&:hover":{opacity:1}},navigationBtn:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",color:"#7F8C8C"},navigationTop:{top:0},navigationBottom:{bottom:0}},t.influencersListStateStyle=i.createCssModule(()=>t.influencersListStateStyleModel).compute({}).attach().getModule()}),define("renderables/influencer/draggable_influencer_renderable",["require","exports","classnames","drag_and_drop","event_bus","flux","jquery","react","css/influencers_list_state.css","reusable_components"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const d="ordering-channel";t.DraggableInfluencerRenderable=class extends r.BaseComponent{constructor(e){super(e),this.preventBubbleDialog=!1}componentDidMount(){this.registerDragSource(this.refs.image),void 0!==this.props.options&&this.props.options.canBeReordered&&this.registerDropTarget(this.refs.image)}render(){const e=a.createFactory.bind(a,c.AvatarFallbackImageRenderable),t=this.canShowDetails()?`${l.influencersListStateStyle.influencerImg} clickable`:l.influencersListStateStyle.influencerImg,s=i(["fa fa-arrows",l.influencersListStateStyle.dragIndicator]);return a.createElement("span",{ref:"image",onClick:this.canShowDetails()?this.triggerShowDetails.bind(this):void 0,className:"draggable-influencer"},a.createElement(c.ImageBlockRenderable,{url:this.props.influencer.profile_data.image_url,errorTag:e(),errorClass:t,className:t,onMouseEnter:this.openInfluencerFollowerInfo.bind(this),onMouseLeave:this.closeInfluencerFollowerInfo.bind(this)}),a.createElement("i",{className:s}))}registerDragSource(e){const t=["influencers-list-state"];void 0!==this.props.options&&this.props.options.canBeReordered&&t.push(d),s.dragAndDropService.registerDragSources([e],{onDragStart:this.onDragStart.bind(this),onDragMove:this.onDragMove.bind(this),onDragStop:this.onDragStop.bind(this),channels:t,minimumDragDistance:5,cancellationToken:this.cancellationToken})}registerDropTarget(e){s.dragAndDropService.registerDropTargets([e],{onDragEnter:this.onDragEnter.bind(this),onDragAccept:this.onDragAccept.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragCancel:this.onDragCancel.bind(this),cancellationToken:this.cancellationToken,channels:[d]})}async onDragStart(e){e.stopPropagation(),e.preventDefault(),this.preventBubbleDialog=!0,this.showMovingCursor();const t=o(this.refs.image);return this.dragHandle=this.createDragHandle(t),this.addDragHandle(),this.moveDragHandle(e),this.hideElement(t),{dragHandle:this.dragHandle[0],model:this.props.influencer}}onDragEnter(e,t){this.props.influencer.id!==t.model.id&&(this.dropIndicator=this.createDropIndicator(),this.addDropIndicator(),this.positionDropIndicator(e))}onDragLeave(e,t){this.props.influencer.id!==t.model.id&&this.removeDropIndicator()}onDragAccept(e,t){this.props.influencer.id!==t.model.id&&(this.removeDropIndicator(),this.props.onMoved(t.model,this.props.influencer,t.sharedData,this.props.owner))}onDragCancel(e,t){this.removeDropIndicator()}onDragMove(e,t){e.preventDefault(),e.stopPropagation(),t.sharedData=this.props.owner,this.moveDragHandle(e)}async onDragStop(e,t){this.showElement(o(this.refs.image)),this.hideMovingCursor(),this.removeDragHandle(),setTimeout(()=>{this.preventBubbleDialog=!1},100)}createDragHandle(e){const t=o(document.createElement("div"));t.css({position:"absolute",zIndex:"9999",pointerEvents:"none"});const i=e.clone();return t.append(i),t}addDragHandle(){o("body").prepend(this.dragHandle)}removeDragHandle(){this.dragHandle.remove(),this.dragHandle=void 0}moveDragHandle(e){const t=e.clientX+window.pageXOffset-this.dragHandle.width()/2,i=e.clientY+window.pageYOffset-this.dragHandle.height()/2;this.dragHandle.css({left:t,top:i})}createDropIndicator(){const e=o("<div></div>");return e.append(o("<i></i>").addClass("fa fa-angle-down")),e.append(o("<div></div>").css({width:2,height:35,backgroundColor:"gray"})),e.append(o("<i></i>").addClass("fa fa-angle-up")),e.css({width:5,height:60,position:"absolute",zIndex:"9999",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}),e}addDropIndicator(){o("body").prepend(this.dropIndicator)}removeDropIndicator(){void 0!==this.dropIndicator&&(this.dropIndicator.remove(),this.dropIndicator=void 0)}positionDropIndicator(e){const t=o(this.refs.image).find("img").offset(),i=t.left+window.pageXOffset-5,s=t.top+window.pageYOffset-5;this.dropIndicator.css({left:i,top:s})}hideElement(e){e.css({opacity:0})}showElement(e){e.css({opacity:""})}showMovingCursor(){o("body").css("cursor","move")}hideMovingCursor(){o("body").css("cursor","")}openInfluencerFollowerInfo(e){s.dragAndDropService.isDragging()||n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"influencer_follower_info",targetElement:e.target,type:"influencer_follower_info",payload:{influencer:this.props.influencer},placement:"bottom"}})}closeInfluencerFollowerInfo(e){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"influencer_follower_info"}})}canShowDetails(){return!s.dragAndDropService.isDragging()&&void 0!==this.props.options&&!0===this.props.options.showDetails}triggerShowDetails(e){this.preventBubbleDialog||n.eventBus.dispatch({type:n.EVENT_TYPES.SHOW_INFLUENCER_DETAILED,value:{influencerId:this.props.influencer.id}})}}}),define("renderables/influencer_states/influencers_list_state_renderable",["require","exports","flux","react","css/influencers_list_state.css","reusable_components","classnames","renderables/influencer/draggable_influencer_renderable","drag_and_drop","event_bus"],function(e,t,i,s,n,r,o,a,l,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UP="up",e.DOWN="down"}(d||(d={}));t.InfluencersListStateRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={startIndex:void 0,numVisibleInfluencers:void 0,width:void 0,height:void 0}}componentDidMount(){const e=$(this.refs.root),t=e.width(),i=e.height(),s=this.computeNumVisibleInfluencers(t,i);this.registerDropTarget(),this.setState({startIndex:0,numVisibleInfluencers:s,width:t,height:i})}componentDidUpdate(){this.getFreshNumVisibleInfluencers()!==this.state.numVisibleInfluencers&&this.setState({numVisibleInfluencers:this.getFreshNumVisibleInfluencers()})}render(){const e={width:this.props.widthPercent};return s.createElement("div",{ref:"root",className:n.influencersListStateStyle.root,style:e},this.renderHeader(),this.renderBody())}renderHeader(){const e={backgroundColor:this.props.stateModel.column.color};return s.createElement("div",{className:n.influencersListStateStyle.header,style:e},s.createElement("div",{className:n.influencersListStateStyle.headerCounter},this.props.stateModel.column.influencers.length),s.createElement("div",{className:n.influencersListStateStyle.headerTitle},this.props.stateModel.column.title))}renderBody(){return s.createElement("div",{className:n.influencersListStateStyle.body},this.renderUpButton(),this.renderInfluencers(),this.renderDownButton())}renderInfluencers(){return s.createElement("div",{style:this.computeTransitionStyles()},this.props.stateModel.column.influencers.map(e=>this.renderInfluencer(e)))}renderInfluencer(e){return s.createElement(a.DraggableInfluencerRenderable,{key:e.id,influencer:e,owner:this.props.stateModel,options:this.props.options,onMoved:this.canBeReordered()?this.handleOnMoved.bind(this):void 0})}renderDownButton(){if(this.state.startIndex+this.state.numVisibleInfluencers<this.props.stateModel.column.influencers.length){const e=o([n.influencersListStateStyle.navigationBtnWrapper,n.influencersListStateStyle.navigationBottom]);return s.createElement("div",{onClick:this.onClickDownBtn.bind(this),className:e},s.createElement("div",{className:n.influencersListStateStyle.navigationBtn},this.renderNavigationButtonIcon(d.DOWN)))}return null}renderUpButton(){if(this.state.startIndex>0){const e=o([n.influencersListStateStyle.navigationBtnWrapper,n.influencersListStateStyle.navigationTop]);return s.createElement("div",{onClick:this.onClickUpBtn.bind(this),className:e},s.createElement("div",{className:n.influencersListStateStyle.navigationBtn},this.renderNavigationButtonIcon(d.UP)))}return null}renderNavigationButtonIcon(e){return s.createElement(r.IconBlockRenderable,{icon:`fa fa-caret-${e}`})}handleOnMoved(e,t,i,s){const n={influencer:e,state:s.column.type,moveLink:s.column.move_link,oldStateModel:i,targetInfluencer:t};c.eventBus.dispatch({type:c.EVENT_TYPES.ON_DRAG_STOP_INFLUENCER,value:n})}canBeReordered(){return void 0!==this.props.options&&!0===this.props.options.canBeReordered}computeNumVisibleInfluencers(e,t){const i=this.computeAvailableWidthForInfluencers(e),s=this.computeAvailableHeightForInfluencers(t);return this.computeNumVisibleInfluencersX(i)*this.computeNumVisibleInfluencersY(s)}getFreshNumVisibleInfluencers(){const e=$(this.refs.root),t=e.width(),i=e.height();return this.computeNumVisibleInfluencers(t,i)}computeAvailableWidthForInfluencers(e){return e-2*n.influencersListStateStyleModel.body.padding}computeAvailableHeightForInfluencers(e){const t=n.influencersListStateStyleModel.header.height,i=n.influencersListStateStyleModel.body.marginBottom;return e-2*n.influencersListStateStyleModel.body.padding-t-i}computeNumVisibleInfluencersX(e){return Math.floor(e/(n.influencersListStateStyleModel.influencerImg.width+2*n.influencersListStateStyleModel.influencerImg.margin))}computeNumVisibleInfluencersY(e){return Math.floor(e/(n.influencersListStateStyleModel.influencerImg.height+n.influencersListStateStyleModel.influencerImg.margin))}onClickDownBtn(e){const t=Math.min(this.props.stateModel.column.influencers.length-1,this.state.startIndex+this.state.numVisibleInfluencers);this.setState({startIndex:t})}onClickUpBtn(e){const t=Math.max(0,this.state.startIndex-this.state.numVisibleInfluencers);this.setState({startIndex:t})}computeTransitionStyles(){const e=this.computeAvailableWidthForInfluencers(this.state.width),t=this.computeNumVisibleInfluencersX(e),i=this.state.startIndex/t,s=n.influencersListStateStyleModel.influencerImg.height+2*n.influencersListStateStyleModel.influencerImg.margin;return{transform:"translateY("+(i>0?-1*i*s:0)+"px)",transition:"transform 500ms ease-in-out"}}registerDropTarget(){l.dragAndDropService.registerDropTargets([this.refs.root],{onDragEnter:this.onDragEnter.bind(this),onDragAccept:this.onDragAccept.bind(this),onDragLeave:this.onDragLeave.bind(this),cancellationToken:this.cancellationToken,channels:["influencers-list-state"]})}onDragEnter(e,t){$(this.refs.root).css({outline:"2px dashed lightgray",zIndex:1})}onDragLeave(e,t){this.removeHighlight()}onDragAccept(e,t){this.removeHighlight();const i=$(this.refs.root).find(".draggable-influencer");if(void 0===this.props.options||!this.props.options.canBeReordered||!(i.is(e.target)||i.has(e.target).length>0)){const e={influencer:t.model,state:this.props.stateModel.column.type,moveLink:this.props.stateModel.column.move_link,oldStateModel:t.sharedData};c.eventBus.dispatch({type:c.EVENT_TYPES.ON_DRAG_STOP_INFLUENCER,value:e})}}removeHighlight(){$(this.refs.root).css({outline:"",zIndex:""})}}}),define("css/influencers_list_states.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.influencersListStatesStyleModel={root:{display:"flex",width:"100%"}},t.influencersListStatesStyle=i.createCssModule(()=>t.influencersListStatesStyleModel).compute({}).attach().getModule()}),define("renderables/influencer_states/influencers_list_states_renderable",["require","exports","flux","react","renderables/influencer_states/influencers_list_state_renderable","css/influencers_list_states.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InfluencersListStatesRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{className:`influencers-list-states ${r.influencersListStatesStyle.root}`},this.renderStateModels())}renderStateModels(){return this.props.stateModels.map((e,t)=>this.renderStateModel(e,t))}renderStateModel(e,t){const i=100/this.props.stateModels.length+"%";return s.createElement(n.InfluencersListStateRenderable,{key:t,stateModel:e,options:this.props.options,widthPercent:i})}}}),define("influencers_list_mgmt",["require","exports","renderables/block/influencers_list_block_renderable","renderables/block/influencers_lists_blocks_renderable","renderables/campaigns_table/campaigns_table_renderable","renderables/influencer_list/influencer_list_overview_renderable","renderables/influencer_list/influencer_list_overviews_renderable","renderables/influencer_states/influencers_list_states_renderable"],function(e,t,i,s,n,r,o,a){"use strict";function l(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),l(i),l(s),l(n),l(r),l(o),l(a)}),define("classes/line_chart_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/line_chart_helpers",["require","exports","graphics_utilities","math_utils"],function(e,t,i,s){"use strict";function n(e,t,s,n){return["a","r","g","b"].map(r=>({object:t,key:r,targetValue:s[r],initialValue:t[r],duration:n,options:{easing:i.EASING.easeInOutBack},drawable:e}))}function r(e,t,i,n){return{topClip:{position:new s.Vector2D(0,0),size:new s.Vector2D(e.chartWidth,i)},bottomClip:{position:new s.Vector2D(0,i),size:new s.Vector2D(e.chartWidth,e.chartHeight-i)},points:n,centerY:i,color:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.createInitialTween=function(e,t){return["top","bottom"].filter(e=>void 0!==t[e]).map(s=>({object:t[s],key:"width",targetValue:t[s].width,initialValue:0,duration:e,options:{easing:i.EASING.easeInCubic},drawable:t[s]}))},t.createPointTween=function(e,t,s){return _.flatten(t.map((t,n)=>[{object:s.points[n],key:"y",targetValue:t.y,initialValue:s.points[n].y,duration:e,options:{easing:i.EASING.easeInOutBack},drawable:s},{object:s.points[n],key:"x",targetValue:t.x,initialValue:s.points[n].x,duration:e,options:{easing:i.EASING.easeInOutBack},drawable:s}]))},t.createColorTween=function(e,t,s){const r=void 0!==e.bottom?n(e.bottom.children[0],e.bottom.children[0].styleData.strokeStyle,t.bottom,s):[];return[...n(e.top.children[0],e.top.children[0].styleData.strokeStyle,t.top,s),...r,...function(e,t,s){const r=[],o=e.top?e.top.children[0]:void 0;o&&o.styleData.fillStyle instanceof i.Gradient&&(o.styleData.fillStyle.colorStops,r.push(...n(o,o.styleData.fillStyle.colorStops[0].color,t.topArea.clone().setOpacity(.5),s),...n(o,o.styleData.fillStyle.colorStops[1].color,t.topArea.clone().setOpacity(.05),s)));const a=e.bottom?e.bottom.children[0]:void 0;return a&&a.styleData.fillStyle instanceof i.Gradient&&(a.styleData.fillStyle.colorStops,r.push(...n(a,a.styleData.fillStyle.colorStops[0].color,t.bottomArea.clone().setOpacity(.5),s),...n(a,a.styleData.fillStyle.colorStops[1].color,t.bottomArea.clone().setOpacity(.05),s))),r}(e,t,s)]},t.handleOldLines=function(e,t){const i=Object.keys(t.drawData),s=[];return e||Object.keys(t.buildData.oldDrawableLines).forEach(e=>{-1===i.indexOf(e)&&(s.push(t.buildData.oldDrawableLines[e]),delete t.buildData.oldDrawableLines[e])}),{lineDrawingData:t,reusableLines:s}},t.createLineDrawingData=function(e){const t=e.chartHeight-e.translateValueToY(0,e.range.max,e.range.min);if(e.isCurved){let t=Number.MAX_VALUE,i=-Number.MAX_VALUE;Object.keys(e.lines).forEach(s=>{const n=e.lines[s];t=Math.min(n.totalNegative,t),i=Math.max(n.totalPositive,i)})}const i=[],s=[];return{buildData:e,drawData:Object.keys(e.lines).reduce((n,o)=>{const a=e.lines[o];return n[o]=r(e,a.color,t,a.values.map((t,n)=>{const r=e.translateValueToX(n,a.values.length-1,0);let o,l=t.value;if(e.isStacked){l>0?void 0!==i[n]?(l+=i[n],i[n]+=t.value):i[n]=l:void 0!==s[n]?(l+=s[n],s[n]+=t.value):s[n]=l;const r=a.totalPositive,c=a.totalNegative;o=e.chartHeight-e.translateValueToY(l,c,r)}else o=e.chartHeight-e.translateValueToY(t.value,e.range.max,e.range.min);return{coordinates:e.vectorPool.get(r,o),label:t.formattedLabel,filters:t.filters,comments:t.comments,requestedPageType:t.requestedPageType,drilldownEnabled:t.drilldownEnabled,isCutOff:t.isCutOff,value:t}})),n},{})}},t.createDrawingData=r,t.getReusableLine=function(e,t,i,s,n){if(void 0!==e[i]&&e[i].top.children[0].points.length===s)return e[i];for(let e=0;e<t.length;e++)if(t[e].top.children[0].points.length===s){const i=t[e];return t.splice(e,1),i}},t.createPopoverData=function(e,t){return{header:e.popoverHeader,node:{color:e.color.toHex8(),label:e.subLabel},commentInfo:e.commentInfo||void 0,values:[{value:e.value,formatted_value:e.percentageBased?t.toPercentage(e.value/100):t.toDecimal(e.value),label:""}]}},t.drawBackground=function(e){let t=[],n=[];if(e.buildData.canShowBackground&&!e.buildData.showArea){const r=e.buildData.chartHeight-e.buildData.translateValueToY(0,e.buildData.range.max,e.buildData.range.min),o=e.buildData.sentimentColors.positive,a=e.buildData.sentimentColors.negative;t=[{object:(n=[new i.DrawableRectangle({position:new s.Vector2D(2,2),size:new s.Vector2D(0,e.buildData.chartHeight/2),style:{fillStyle:new i.Gradient(new s.Vector2D(0,0),new s.Vector2D(0,r),[{position:0,color:new i.Color(new s.Vector4D(o.r,o.g,o.b,255))},{position:.8,color:new i.Color(new s.Vector4D(o.r,o.g,o.b,50))}]),opacity:.15}}),new i.DrawableRectangle({position:new s.Vector2D(2,r),size:new s.Vector2D(0,e.buildData.chartHeight/2-1),style:{fillStyle:new i.Gradient(new s.Vector2D(0,r),new s.Vector2D(0,e.buildData.chartHeight),[{position:.2,color:new i.Color(new s.Vector4D(a.r,a.g,a.b,50))},{position:1,color:new i.Color(new s.Vector4D(a.r,a.g,a.b,255))}]),opacity:.15}})])[0],key:"width",targetValue:e.buildData.chartWidth,initialValue:0,duration:e.buildData.animationDuration,drawable:n[0]},{object:n[1],key:"width",targetValue:e.buildData.chartWidth,initialValue:0,duration:e.buildData.animationDuration,drawable:n[1]}]}return{tweens:t,buildId:e.buildData.buildId,rectangles:n}}}),define("classes/line_chart_chart",["require","exports","abstract_canvas_chart","graphics_utilities","canvas_drawable_mixins","math_utils","object_pool","xstream","classes/line_chart_helpers","event_bus","reusable_utilities"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_CHART_LAYER_TYPE=Object.assign({BACKGROUND:"BACKGROUND"},i.CANVAS_GRID_CHART_LAYER_TYPE,{LINES:"LINES",CIRCLES:"CIRCLES"});const h=new o.Pool({initialSize:0,dynamic:!0,factory:()=>r.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_line_chart"});var u,p;!function(e){e.THICK="THICK",e.THIN="THIN",e.HIDE="HIDE"}(u||(u={})),function(e){e.SHOWN="SHOWN",e.HIDDEN="HIDDEN",e.INDICATOR="INDICATOR"}(p||(p={}));t.LineChart=class extends i.CanvasGridChart{constructor(e,s){if(super(e,Object.assign({},s,{layers:t.LINE_CHART_LAYER_TYPE,layerConfigs:{[t.LINE_CHART_LAYER_TYPE.CIRCLES]:{enableInteractions:!0},[t.LINE_CHART_LAYER_TYPE.LINES]:{enableInteractions:!0}}})),this.drawableLines={},this.circleHovering=!1,this.backgroundDrawn=!1,this.legendMouseClicked=!1,this.commentBubblesReadyPromises=[],this.circles=[],void 0===s.closeCommentsOnStart&&(s.closeCommentsOnStart=!0),this.options.mediatorStream){const n=this.options.mediatorStream.subscribe(i.CanvasChartUtils.createStreamListener(e=>{switch(e.type){case"LEGEND_MOUSEENTER":this.legendMouseClicked||this.getDrawablesForLayer(t.LINE_CHART_LAYER_TYPE.LINES).forEach(t=>{const i=t.children[0];void 0!==t.additionalData&&(t.additionalData.id===e.message?this.toggleDrawableAnimationState(i,u.THICK):this.toggleDrawableAnimationState(i,u.THIN))});break;case"LEGEND_MOUSELEAVE":this.legendMouseClicked||this.getDrawablesForLayer(t.LINE_CHART_LAYER_TYPE.LINES).forEach(e=>{const t=e.children[0];this.toggleDrawableAnimationState(t,u.THIN)});break;case"LEGEND_MOUSECLICK":const i=e.message;this.legendMouseClicked&&this.legendMouseClickedId===i?this.resetLineClickedStates():(this.getDrawablesForLayer(t.LINE_CHART_LAYER_TYPE.LINES).forEach(e=>{const t=e.children[0];void 0!==e.additionalData&&(e.additionalData.id===i?this.toggleDrawableAnimationState(t,u.THICK):this.toggleDrawableAnimationState(t,u.HIDE))}),this.legendMouseClickedId=i,this.legendMouseClicked=!0)}}));this.disposeToken.addCleanupFunction(()=>{n.unsubscribe()}),this.disposeToken.addCleanupFunction(c.eventBus.subscribe(c.EVENT_TYPES.LINE_CHART_SHOW_DETAILS,t=>{this.openDrilldown(e.model.id,t.value.filters,s.containerSpan,t.value.requestedPageType)}).unsubscribe)}}resetLineClickedStates(){this.getDrawablesForLayer(t.LINE_CHART_LAYER_TYPE.LINES).forEach(e=>{const t=e.children[0];this.toggleDrawableAnimationState(t,u.THIN)}),this.legendMouseClickedId=void 0,this.legendMouseClicked=!1}closeCommentPreviews(){c.eventBus.dispatch({type:c.EVENT_TYPES.CLEAR_COMMENT_PREVIEWS,value:{element:$(this.getContainer()).find(">canvas")[this.options.dashedLines?1:0]}})}closeCommentMarkers(){c.eventBus.dispatch({type:c.EVENT_TYPES.CLEAR_COMMENT_MARKERS,value:{element:$(this.getContainer()).find(">canvas")[this.options.dashedLines?1:0]}})}initialize(){let e=0,t=0;return a.Stream.createWithMemory({start:s=>{const n=this.dataStream.map(e=>(this.resetLineClickedStates(),this.options.closeCommentsOnStart&&(this.closeCommentPreviews(),this.closeCommentMarkers()),this.resumeGraphSlicing(),this.commentBubblesReadyPromises=[],{animationDuration:this.options.initialAnimationDuration,oldDrawableLines:this.drawableLines,chartWidth:this.chartSize.x,chartHeight:this.chartSize.y,widgetID:e.model.id,vectorPool:h,translateValueToY:this.translateValueToY.bind(this),translateValueToX:this.translateValueToX.bind(this),lines:e.model.lines,range:e.model.grid.yAxis,buildId:_.uniqueId(),showArea:e.model.showArea,canShowBackground:e.model.canShowBackground,isCurved:e.model.isCurved,isStacked:e.model.isStacked,dashedLines:this.options.dashedLines||!1,nestedId:e.model.nestedId,isIndicator:e.model.isExternalData&&!e.model.isNestedData,isNested:e.model.isNestedData,commentDisplayMode:e.model.commentDisplayMode,sentimentColors:this.options.sentimentColors||{}})).map(l.createLineDrawingData),r=a.Stream.combine(n.map(i=>l.handleOldLines(this.chartSize.x!==e||this.chartSize.y!==t,i)).map(this.createLines.bind(this,s)),n.map(this.createCircles.bind(this,s)),n.map(l.drawBackground)).filter(([e,t,i])=>e.buildId===t.buildId&&e.buildId===i.buildId).map(i=>(e=this.chartSize.x,t=this.chartSize.y,i)).subscribe(i.CanvasChartUtils.createStreamListener(this.handleDrawables.bind(this)));this.disposeToken.addCleanupFunction(()=>{r.unsubscribe()})},stop:()=>{}})}async handleDrawables([e,i,s]){await this.clearDrawables(t.LINE_CHART_LAYER_TYPE.CIRCLES),await this.clearDrawables(t.LINE_CHART_LAYER_TYPE.LINES),0===s.rectangles.length&&await this.clearDrawables(t.LINE_CHART_LAYER_TYPE.BACKGROUND),this.drawableLines={},Object.keys(e.lines).forEach(i=>{this.drawableLines[i]=e.lines[i],this.addDrawable(t.LINE_CHART_LAYER_TYPE.LINES,e.lines[i].top),e.hasNegative&&(this.addDrawable(t.LINE_CHART_LAYER_TYPE.LINES,e.lines[i].bottom),this.hasReplayEnabled&&this.addReplayStates(e.lines[i].bottom,"width",[0,e.lines[i].bottom.width])),this.hasReplayEnabled&&this.addReplayStates(e.lines[i].top,"width",[0,e.lines[i].top.width])}),this.backgroundDrawn||s.rectangles.forEach(e=>{this.addDrawable(t.LINE_CHART_LAYER_TYPE.BACKGROUND,e)}),this.backgroundDrawn||this.addTweens(s.tweens),s.rectangles.length>0?this.backgroundDrawn=!0:this.backgroundDrawn=!1,e.leavingLines.forEach(e=>{this.addDrawable(t.LINE_CHART_LAYER_TYPE.LINES,e.top),void 0!==e.bottom&&this.addDrawable(t.LINE_CHART_LAYER_TYPE.LINES,e.bottom)}),this.circles=[],i.circles.forEach(({circle:e,commentCircle:i})=>{void 0!==i&&this.addDrawable(t.LINE_CHART_LAYER_TYPE.CIRCLES,i),this.addDrawableAnimationStates(e,{[p.HIDDEN]:[{path:"radius",value:0,duration:150},{path:"styleData.lineWidth",value:0,duration:150}],[p.SHOWN]:[{path:"radius",value:6,duration:150},{path:"styleData.lineWidth",value:12,duration:150}],[p.INDICATOR]:[{path:"radius",value:4,duration:150},{path:"styleData.lineWidth",value:0,duration:150}]}),this.circles.push(e),this.addDrawable(t.LINE_CHART_LAYER_TYPE.CIRCLES,e)}),this.addTweens(e.tweens),this.commentBubblesReadyPromises.length>0&&await Promise.all(this.commentBubblesReadyPromises),this.afterUpdate.fire()}update(e){return super.update(e),this}async animate(){await super.animate()}addOffsetPoints(e,t){return[h.get(-500,t),...e,h.get(_.last(e).x+500,t)]}startLineHover(e,t){return this.changePolygonAnimationState(u.THICK,e,t),this.toggleIndicators(),()=>{this.changePolygonAnimationState(u.THIN,e,t),this.stopLineHover=void 0}}disposePolygon(e){const t=e.points;return e.points=[],h.recycleMany(t),this}dispose(){this.circles=[],this.closeCommentPreviews(),this.closeCommentMarkers(),Object.keys(this.drawableLines).forEach(e=>{const{top:t,bottom:i}=this.drawableLines[e];this.disposePolygon(t.children[0]),void 0!==i&&this.disposePolygon(i.children[0])}),super.dispose()}createCircles(e,t){this.circleHovering=!1;const r=[];return Object.keys(t.drawData).forEach(o=>{const a=t.drawData[o];a.points.forEach(d=>{if(d.isCutOff)return;const h=d.coordinates,u=this.getColors(a.color),g=h.y>a.centerY?u.bottom.clone():u.top.clone(),m=new(n.InteractionShapeMixin(s.DrawableCircle))({position:h,shapeModifier(e){return void 0!==this.clonedShape&&this.clonedShape.position.x===e.position.x&&this.clonedShape.position.y===e.position.y||(this.clonedShape=e.clone(),this.clonedShape.radius=6),this.clonedShape},additionalData:{lineId:o},style:{fillStyle:g.toHex6(),strokeStyle:g.clone().setOpacity(.3).toRGBA(),lineWidth:12},on:{mouseenter:t=>{if(this.legendMouseClicked&&this.legendMouseClickedId!==o)return;this.toggleIndicators(),t.preventDefault(),void 0!==this.stopLineHover&&this.stopLineHover(),this.toggleDrawableAnimationState(m,p.SHOWN),this.options.isClickable&&this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER);const s=$(t.target).offset(),n=s.left+h.x+this.margins.left-1,r=s.top+h.y+this.margins.top;this.openPopover(n,r,l.createPopoverData(d.value,this.options.numberFormatter)),d.value.dropdownData.length>0&&this.openDropDown(n,r,d.value.dropdownData),this.circleHovering=!0,this.pauseGraphSlicing(),e.next({type:"WIDGET_MOUSEENTER",message:o})},mouseleave:t=>{this.legendMouseClicked&&this.legendMouseClickedId!==o||(t.preventDefault(),this.toggleDrawableAnimationState(m,p.HIDDEN),this.options.isClickable&&this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),this.closePopover(),this.closeDropDown(),this.circleHovering=!1,this.resumeGraphSlicing(),e.next({type:"WIDGET_MOUSELEAVE",message:o}))},mouseup:e=>{this.legendMouseClicked&&this.legendMouseClickedId!==o||(e.preventDefault(),this.resumeGraphSlicing(),this.options.isClickable&&d.drilldownEnabled&&this.openDrilldown(t.buildData.widgetID,d.filters,e.target,d.requestedPageType))}},radius:0});let _;if(d.comments.length>0&&(("SHOW_ON_HOVER"===t.buildData.commentDisplayMode||"SHOW_ALL_COMMENTS"===t.buildData.commentDisplayMode||"ALWAYS_OPEN"===t.buildData.commentDisplayMode||"SHOW_AS_FOOTNOTE"===t.buildData.commentDisplayMode&&!d.comments[0].pinned)&&(_=new s.DrawableCircle({position:h,style:{fillStyle:"rgba(255,255,255,1)",strokeStyle:g.toHex6(),lineWidth:2},radius:3})),"ALWAYS_OPEN"===t.buildData.commentDisplayMode||"SHOW_ALL_COMMENTS"===t.buildData.commentDisplayMode||"SHOW_AS_FOOTNOTE"===t.buildData.commentDisplayMode&&d.comments[0].pinned)){const e=$(this.getContainer()).find(">canvas"),i=e.offset(),s=i.left+h.x+this.margins.left-1,n=i.top+h.y+this.margins.top;this.commentBubblesReadyPromises.push(new Promise(e=>{const t=c.eventBus.subscribe(c.EVENT_TYPES.ALL_COMMENT_BUBBLES_READY,async i=>{i.value.point===d&&(e(),t.unsubscribe())})})),c.eventBus.dispatch({type:"SHOW_AS_FOOTNOTE"===t.buildData.commentDisplayMode&&d.comments[0].pinned?c.EVENT_TYPES.SHOW_COMMENT_MARKERS:c.EVENT_TYPES.SHOW_COMMENT_PREVIEWS,value:{comments:d.comments,element:e[0],onClick:e=>{c.eventBus.dispatch({type:c.EVENT_TYPES.LINE_CHART_COMMENT_CLICK,value:{filters:d.filters,id:t.buildData.widgetID,rowCode:o,timestamp:e.timestamp,nestedId:t.buildData.nestedId,isIndicator:t.buildData.isIndicator,nestedIndex:t.buildData.isNested?0:void 0}})},color:g.toHex6(),x:s,y:n,point:d}})}const f=m.getSubscriptionCount.bind(m);m.getSubscriptionCount=(e=>this.legendMouseClicked&&this.legendMouseClickedId!==o?0:f(e)),r.push({circle:m,commentCircle:_})})}),{circles:r,buildId:t.buildData.buildId}}createLines(e,{lineDrawingData:t,reusableLines:i}){void 0!==this.stopLineHover&&(this.stopLineHover=void 0);const s={};let n=[];const r=Object.keys(t.drawData),o=t.buildData.canShowBackground&&(1===Object.keys(t.buildData.oldDrawableLines).length||1===r.length);r.forEach((r,a)=>{const c=t.drawData[r],d=c.points.map(({coordinates:e})=>e),u=this.addOffsetPoints(d,2*c.topClip.size.y),p=this.addOffsetPoints(d,2*-c.topClip.size.y).map(e=>h.get(e.x,e.y)),g=this.getColors(c.color);let m;if(o||(m=l.getReusableLine(t.buildData.oldDrawableLines,i,r,u.length,g.top)),o||void 0===m){const i=this.createLineDrawables(u,p,c.topClip,c.bottomClip,g,t.buildData.showArea,t.buildData.range.min<0,t.buildData.isCurved,t.buildData.isStacked,t.buildData.dashedLines,()=>e.next({type:"WIDGET_MOUSEENTER",message:r}),()=>e.next({type:"WIDGET_MOUSELEAVE",message:r}),0===a);i.top.additionalData={id:r,data:c},void 0!==i.bottom&&(i.bottom.additionalData={id:r,data:c}),n=n.concat(l.createInitialTween(t.buildData.animationDuration,i)),s[r]=i}else{s[r]=m;const e=l.createPointTween(t.buildData.animationDuration,u,s[r].top.children[0]);s[r].top.width=c.topClip.size.x,s[r].top.height=c.topClip.size.y+(this.options.hideGrid?8:4);let i=[];void 0!==s[r].bottom&&(s[r].bottom.width=c.bottomClip.size.x,s[r].bottom.height=c.bottomClip.size.y+(this.options.hideGrid?8:4),i=l.createPointTween(t.buildData.animationDuration,p,s[r].bottom.children[0]));const o=l.createColorTween(m,g,t.buildData.animationDuration);n=n.concat([...e,...i,...o])}});const a=[];return o&&(i=i.concat(Object.keys(t.buildData.oldDrawableLines).map(e=>t.buildData.oldDrawableLines[e]))),t.buildData.animationDuration>0&&i.forEach(e=>{n.push(...e.top.children.map(e=>({object:e.styleData,key:"opacity",targetValue:0,initialValue:1,duration:t.buildData.animationDuration/2,drawable:e}))),void 0!==e.bottom&&n.push(...e.bottom.children.map(e=>({object:e.styleData,key:"opacity",targetValue:0,initialValue:1,duration:t.buildData.animationDuration/2,drawable:e}))),a.push(e),this.onAnimationDone.subscribeOnceAsPromise().then(()=>{this.disposePolygon(e.top.children[0]),void 0!==e.bottom&&this.disposePolygon(e.bottom.children[0])})}),{lines:s,tweens:n,leavingLines:a,hasNegative:t.buildData.range.min<0,buildId:t.buildData.buildId}}changePolygonAnimationState(e,t,i){return this.toggleDrawableAnimationState(t,e),void 0!==i&&this.toggleDrawableAnimationState(i,e),this}getColors(e){return{top:e.top.clone().setSaturation(e.top.getSaturation()),bottom:e.bottom.clone().setSaturation(.5*e.bottom.getSaturation()),topArea:e.top.clone(),bottomArea:e.bottom.clone().setSaturation(.6*e.bottom.getSaturation())}}toggleIndicators(e=[]){let t=this.circles.length;for(;t--;){const i=this.circles[t];e.includes(i)?0===i.radius&&this.toggleDrawableAnimationState(i,p.INDICATOR,!0):this.toggleDrawableAnimationState(i,p.HIDDEN,!0)}}createLineDrawables(e,t,i,n,o,a,l,c,h,p,g,m,_=!1){const f=i.size.y+n.size.y,y=i.size.y/f,b=n.size.y/f;let E,S=a?new s.Gradient(new r.Vector2D(0,i.position.y),new r.Vector2D(0,i.size.y+n.size.y),[{position:0,color:o.topArea.clone().setOpacity(.7)},{position:y,color:o.topArea.clone().setOpacity(.05)}]):void 0;h&&(S=o.bottomArea);let C=a?new s.Gradient(new r.Vector2D(0,i.size.y+n.size.y),new r.Vector2D(0,i.position.y),[{position:0,color:o.bottomArea.clone().setOpacity(.7)},{position:b,color:o.bottomArea.clone().setOpacity(.05)}]):void 0;h&&(C=o.bottomArea);const v=new(c?s.DrawableCurvedPolygon:s.DrawablePolygon)({points:e,on:{mouseenter:e=>{this.circleHovering||this.legendMouseClicked||(e.preventDefault(),void 0!==this.stopLineHover&&this.stopLineHover(),this.stopLineHover=this.startLineHover(v,E),g())},mouseleave:e=>{this.legendMouseClicked||(e.preventDefault(),void 0!==this.stopLineHover&&(this.stopLineHover(),m()))}},inheritParentPosition:!1,style:{strokeStyle:o.top,fillStyle:S,lineWidth:2,opacity:1,lineDash:p?[3]:void 0}});let T;if(l){E=new(c?s.DrawableCurvedPolygon:s.DrawablePolygon)({points:t,inheritParentPosition:!1,style:{strokeStyle:o.bottom,fillStyle:C,lineWidth:2,opacity:1,lineDash:p?[3]:void 0}});const e=n.position.clone(),i=n.size.clone();i.y+=this.options.hideGrid?8:4,T=new s.DrawableRectangle({position:e,size:i,isClippingMask:!0,children:[E],style:{opacity:1}})}[v,E].filter(e=>e).forEach(e=>{this.addDrawableAnimationStates(e,{[u.THIN]:[{path:"styleData.opacity",value:1,duration:100},{path:"styleData.lineWidth",value:2,duration:100}],[u.THICK]:[{path:"styleData.opacity",value:1,duration:100},{path:"styleData.lineWidth",value:4,duration:100}],[u.HIDE]:[{path:"styleData.opacity",value:.2,duration:100},{path:"styleData.lineWidth",value:2,duration:100}]})});const I=i.position.clone(),w=i.size.clone();I.y-=4,w.y+=this.options.hideGrid?8:4;let A=!1;return{top:new s.DrawableRectangle({position:I,size:w,isClippingMask:!0,children:[v],on:_?{mousemove:d.AnimationLoop.debounceMethod(e=>{if(!this.stopLineHover&&!this.circleHovering&&A){const t=e.offsetX-this.margins.left;let i=this.circles.length,s=Number.MAX_VALUE,n=[];for(;i--;){const e=this.circles[i],r=Math.floor(100*Math.abs(t-e.position.x))/100;r<s?(n=[e],s=r):r===s&&n.push(e)}n=n.filter(e=>!this.legendMouseClicked||this.legendMouseClickedId===e.additionalData.lineId),this.toggleIndicators(n),this.animate()}},60),mouseenter:()=>{A=!0},mouseleave:()=>{A=!1,this.toggleIndicators(),this.animate()}}:void 0,style:{opacity:1}}),bottom:T}}}}),define("classes/react_line_chart_container",["require","exports","abstract_canvas_chart","classes/line_chart_chart","math_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ReactLineChartContainer=class extends i.AbstractCanvasChartReactContainer{createChart(e){const t=new s.LineChart({size:new n.Vector2D(this.props.width,this.props.height),position:new n.Vector2D(this.props.x,this.props.y),model:this.props.model},Object.assign({containerSpan:e,enableGraphSlicer:!1,initialAnimationEnabled:!1,initialAnimationDuration:0,margins:new n.Vector4D(15,30,0,0),resolutionScale:1,numberFormatter:this.props.numberFormatter,isClickable:!1,yAxis:{hideBaseLine:!0,hideZeroLabel:!0},showDaySeparators:!0,hideGrid:!1},this.props.options||{}));return e.querySelector("canvas").classList.add("react-line-chart"),t}}}),define("line_chart",["require","exports","classes/line_chart_chart","classes/line_chart_helpers","classes/react_line_chart_container"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("log_service",["require","exports","underscore","event"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),void 0!==Error&&(Error.stackTraceLimit=20);const n={log:console&&console.log&&console.log.bind(console)||i.noop,debug:console&&console.debug&&console.debug.bind(console)||i.noop,warn:console&&console.warn&&console.warn.bind(console)||i.noop,error:console&&console.error&&console.error.bind(console)||i.noop,info:console&&console.info&&console.info.bind(console)||i.noop,groupCollapsed:console&&(console.groupCollapsed&&console.groupCollapsed.bind(console)||console.log&&console.log.bind(console))||i.noop,groupEnd:console&&console.groupEnd&&console.groupEnd.bind(console)||i.noop,dir:console&&(console.dir&&console.dir.bind(console)||console.log&&console.log.bind(console))||i.noop};var r;!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR"}(r=t.logLevel||(t.logLevel={}));class o{constructor(e,t=0){this.logLevel=r,this._timestamps=!0,this._timers={},this._logFeatures={},this.onError=new s.Event,this._showDeprecationWarnings=e.showDeprecationWarnings,this._globalLogLevel=e.globalLogLevel,this._traceAll=e.traceAll,this._startTime=t||(new Date).getTime()}enableVerbose(e){this.setLogLevel(r.VERBOSE,e)}setLogLevel(e,t){if(i.isString(e))switch(e.trim().toLowerCase()){case"debug":e=r.DEBUG;break;case"warn":case"warning":e=r.WARNING;break;case"verbose":e=r.VERBOSE;break;case"info":e=r.INFO;break;case"error":e=r.ERROR}void 0!==t?this._logFeatures[t.name.toUpperCase()]=e:this._globalLogLevel=e}setTraceAll(e){this._traceAll=e}enableTimestamps(){this._timestamps=!0}disableTimestamps(){this._timestamps=!1}enableAllLogs(){this._globalLogLevel=r.DEBUG}startTimer(e){this.assertDefined(e,{name:"LOG_SERVICE"});const t={startTime:(new Date).getTime(),logFeature:e};return this._timers[e.name]=this._timers[e.name]||[],this._timers[e.name].push(t),t}endTimer(e,t,s,n){let r,o;this.assertDefined(e,{name:"LOG_SERVICE"}),this.assertDefined(t,{name:"LOG_SERVICE"}),this.assertDefined(s,{name:"LOG_SERVICE"}),e.name?(r=i.last(this._timers[e.name]),o=e):e.logFeature&&(o=(r=e).logFeature),this.assert(void 0!==r,`No timer currently running for the feature ${o.name}`,{name:"LOG_SERVICE"}),this.assert(-1!==this._timers[o.name].indexOf(r),`timer does not belong to this feature ${o.name}`,{name:"LOG_SERVICE"});const a=(new Date).getTime()-r.startTime;a>t&&this.warn([`Timeout occured: ${a} ms / ${t} ms`].concat(s),o,n),this._timers[o.name]=i(this._timers[o.name]).filter(e=>e!==r)}deprecated(e,t,s){const n=this;return function(){return s=s||e.name,n._showDeprecationWarnings&&(void 0===t?n.warn(s+" is deprecated",{name:"DEPRECATED"}):n.warn(s+" is deprecated, please use "+t,{name:"DEPRECATED"})),i.isFunction(e)?e.apply(this,arguments):e}}assert(e,t,i,s){return e||this.error(t,i,s),!!e}assertDefined(e,t,i){return this.assert(void 0!==e,"argument must be defined",t,i)}assertType(e,t,s,n){let r,o;return i.isArray(t)?(o=i.any(t,function(t){return e instanceof t}),r=`${e} should be an instance of either of these types: ${t}`):(o=e instanceof t,r=e+" should be an instance of "+t),this.assert(o,r,s,n)}assertValueInRange(e,t,i,s,n){return this.assert(void 0!==e&&e>=t&&e<=i,`argument must be in range ${t} - ${i}.`,s,n)}assertValueInArray(e,t,i,s){return this.assert(void 0!==e&&void 0!==t&&-1!==t.indexOf(e),"argument must be contained in array.",i,s)}verbose(e,t,i){return this.log({message:e,feature:t,logLevel:r.VERBOSE,object:i,trace:this._traceAll})}debug(e,t,i){return this.log({message:e,feature:t,logLevel:r.DEBUG,object:i,trace:this._traceAll})}warn(e,t,i){return this.log({message:e,feature:t,logLevel:r.WARNING,object:i,trace:this._traceAll})}info(e,t,i){return this.log({message:e,feature:t,logLevel:r.INFO,object:i,trace:this._traceAll})}error(e,t,i){return this.onError.fire(e),this.log({message:e,feature:t,logLevel:r.ERROR,object:i,trace:!1})}trace(e,t,i){return this.log({message:e,feature:t,trace:!0,logLevel:r.DEBUG,object:i})}dir(e){n.dir(e)}log(e){const{logLevel:t=this._globalLogLevel,message:i,trace:s=!1,feature:n={name:"",style:""},object:r}=e;this.assert(void 0!==e.message,"args.message is required",{name:"LOG_SERVICE"}),this._checkConfiguration(t,n)&&this._writeLog(i,t,s,n,r)}canLog(e,t){return this._checkConfiguration(e,t)}_writeLog(e,t,s,o,a){let l;l=(o=o||{}).style,t===r.ERROR&&(l="color:rgba(255,122,122,1);background-color:rgba(30,0,0,1);border-top:rgba(100,0,0,1) 1px solid;border-bottom:rgba(100,0,0,1) 1px solid;font-weight:lighter;padding-top:2px;padding-bottom:2px;"),t===r.WARNING&&(l="color:rgb(255, 220, 158);background-color:hsl(50, 100%, 10%);border-top:rgb(102, 85, 0) 1px solid;border-bottom:rgb(102, 85, 0) 1px solid;font-weight:lighter;padding-top:2px;padding-bottom:2px;",s=!0);let c="";if(void 0!==o.name&&""!==o.name&&(c=`[${o.name}]`),this._timestamps){const e=((new Date).getTime()-this._startTime)%1e6;c=`[${Math.floor(e/1e3)}s ${e%1e3}ms]${c}`}l&&(c=`%c${c}`);let d,h=!1,u=[];i.isArray(e)?(d=c+e[0],u=e.splice(1)):d=c+e,void 0!==a||s||u.length>0?(h=!0,s||t===r.ERROR?(n.groupCollapsed(d,l),t===r.ERROR?n.error(d||"Assert failure"):this._trace("",o.style,2,!0)):n.groupCollapsed(d,l)):s?this._trace(d,l,2,!0):this._logDirectly(d,t,l),u.forEach(e=>{i.isArray(e)?this._writeLog(e,t,s,o,a):this._logDirectly(e,t,h?"":l)}),void 0!==a&&n.dir(a),h&&n.groupEnd()}_logDirectly(e,t,s){if(i.isString(e))switch(t){case r.VERBOSE:case r.DEBUG:s?n.debug(e,s):n.debug(e);break;case r.INFO:s?n.info(e,s):n.info(e);break;case r.WARNING:s?n.warn(e,s):n.warn(e);break;case r.ERROR:s?n.error(e,s):n.error(e);break;default:i.noop()}else n.dir(e)}getStackTrace(e=0){return i.isUndefined(Error)||i.isUndefined((new Error).stack)?"(stack trace not supported)":(new Error).stack.split("\n").splice(e+2).join("\n")}_checkConfiguration(e,t){return void 0!==t?e>=this._getFeatureLogLevel(t):e>=this._globalLogLevel}_getFeatureLogLevel(e){const t=(e.name||"").toUpperCase();return void 0!==this._logFeatures[t]?this._logFeatures[t]:this._globalLogLevel}_trace(e,t,i,s=!1){s||n.groupCollapsed(e,t),n.log(this.getStackTrace(2+i)),s||n.groupEnd()}}t.Log=o,t.logService=new o({showDeprecationWarnings:!0,globalLogLevel:4,traceAll:!0})}),define("log_cluster",["require","exports","underscore","log_service"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={name:"LOG_CLUSTER"};t.LogCluster=class{constructor(e,t,i,n=!1){this.logMemory=[e],this.logLevel=t,this.logFeature=i,this.addStackTrace=n,this.active=s.logService.canLog(t,i),this.scopes=[this.logMemory]}addNestingLevel(e){if(!this.active)return;const t=[e];i.last(this.scopes).push(t),this.scopes.push(t)}removeNestingLevel(){this.active&&(s.logService.assert(this.scopes.length>1,"Nesting level underflow",n),this.scopes.pop())}addMessage(e){this.active&&(s.logService.assert(i.isString(e),"message must be a string",n),i.last(this.scopes).push(e))}addObjectWithMessage(e,t,i=!1,s,n){this.addNestingLevel(e),this.addObject(t,i,s,n),this.removeNestingLevel()}addObject(e,t=!1,n,r){this.active&&(i.isUndefined(n)||(e=e[n].apply(e,r),s.logService.assert(!i.isUndefined(e),"method "+n+" did not return anything!",{name:"LOGCLUSTER"},{object:e,methodCall:n})),t&&(e=JSON.parse(JSON.stringify(e))),i.isArray(e)&&(e={data:e}),i.last(this.scopes).push(e))}writeLog(){this.active&&(s.logService.assert(1===this.scopes.length,"Not all nesting levels were closed",n),s.logService.log({message:this.logMemory,logLevel:this.logLevel,trace:this.addStackTrace,feature:this.logFeature}))}}}),define("log",["require","exports","log_cluster","log_service"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("map/readonly_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("map/map",["require","exports","map/main"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){if(s.hasNativeMap()){const t=window.Map;this.map=new t(e)}else this.map=new i.MapShim(e)}static hasNativeMap(){return window.Map&&window.Map.prototype.get&&window.Map.prototype.set&&window.Map.prototype.values&&window.Map.prototype.keys&&window.Map.toString().includes("[native code]")}clear(){this.map.clear()}delete(e){return this.map.delete(e)}entries(){return Array.from(this.map.entries())}forEach(e,t){return this.map.forEach(e,t)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}keys(){return Array.from(this.map.keys())}values(){return Array.from(this.map.values())}set(e,t){return this.map.set(e,t)}clone(){return this.map.clone()}get size(){return this.map.size}}t.Map=s}),define("map/main",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this._keys=[],this._values=[],e&&e.forEach((e,t)=>{this._keys[t]=e[0],this._values[t]=e[1]})}delete(e){let t=-1;if(i.isObject(e)&&i.isFunction(e.equals)){for(let i=0;i<this._keys.length;i++)if(e.equals(this._keys[i])){t=i;break}}else t=this._keys.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1),!0)}set(e,t){let s=-1;if(i.isObject(e)&&i.isFunction(e.equals)){for(let t=0;t<this._keys.length;t++)if(e.equals(this._keys[t])){s=t;break}}else s=this._keys.indexOf(e);return-1===s?(this._keys.push(e),this._values.push(t)):this._values[s]=t,this}has(e){if(i.isObject(e)&&i.isFunction(e.equals)){for(let t=0;t<this._keys.length;t++)if(e.equals(this._keys[t]))return!0;return!1}return-1!==this._keys.indexOf(e)}get(e){if(!i.isObject(e)||!i.isFunction(e.equals))return this._values[this._keys.indexOf(e)];for(let t=0;t<this._keys.length;t++)if(e.equals(this._keys[t]))return this._values[t]}keys(){return this._keys}entries(){const e=[];return this.forEach((t,i)=>e.push([i,t])),e}values(){return this._values}clear(){this._keys=[],this._values=[]}clone(){const e=new s;return e._keys=[],e._values=[],i.each(this.keys(),t=>{let i=this.get(t);i.clone&&(i=i.clone()),e.set(t,i)}),e}forEach(e){this.values().forEach((t,i)=>e(t,this.keys()[i],this))}get size(){return this._values.length}}t.MapShim=s}),define("map/extendable_map",["require","exports","map/main","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.MapShim{constructor(){super()}clone(){const e=new n;return s.each(this.keys(),t=>{e.set(t,this.get(t).clone&&this.get(t).clone()||this.get(t))},this),e}extend(e){const t=this.clone();return e.forEach(({key:e,value:i})=>{t.set(e,s.extend({},t.get(e),i))}),t}}t.ExtendableMap=n}),define("map",["require","exports","map/extendable_map","map/main","map/map"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("conversion/number_conversion_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_COLOR_DECIMAL=255;class i{decToHex(e){return e.toString(16)}hexToDec(e){return parseInt(e,16)}}t.NumberConversionUtils=i,t.numberConversionUtils=new i}),define("conversion/unit_conversion_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{emuToPixel(e){return Math.round(e/9525)}pixelToEmu(e){return Math.round(9525*e)}}t.UnitConversionUtils=i,t.unitConversionUtils=new i}),define("general/general_math_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{clamp(e,t,i){return t=void 0!==t?t:e,i=void 0!==i?i:e,e<t?t:e<i?e:i}lerp(e,t,i){return(1-i)*e+i*t}linearScale(e,t,i){return 0===e.min&&0===e.max?0:0===t.min&&0===e.max?0:(t.max-t.min)*((i-e.min)/(e.max-e.min))+t.min}logarithmicScale(e,t,i){if(0===e.min&&0===e.max)return 0;if(0===t.min&&0===e.max)return 0;const s=i/(e.max-e.min);return Math.round(Math.pow(t.max-t.min+1,s)+t.min-1)}reverseLog(e,t,i){return Math.log(i-t.min+1)/Math.log(t.max-t.min+1)*(e.max-e.min)}}t.GeneralMathUtils=i,t.generalMathUtils=new i}),define("structures/abstract_vector",["require","exports","general/general_math_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractVector=class{constructor(e){this.components=e}get dimensions(){return this.components.length}zero(){for(let e=0;e<this.components.length;e++)this.components[e]=0;return this}flip(){return this.mul(-1)}getSmallestComponent(){return Math.min.apply(Math,this.components)}getLargestComponent(){return Math.max.apply(Math,this.components)}addScalar(e){for(let t=0;t<this.components.length;t++)this.components[t]+=e;return this}sign(){for(let e=0;e<this.components.length;e++)this.components[e]=Math.sign(this.components[e]);return this}subScalar(e){for(let t=0;t<this.components.length;t++)this.components[t]-=e;return this}mul(e){for(let t=0;t<this.components.length;t++)this.components[t]*=e;return this}div(e){for(let t=0;t<this.components.length;t++)this.components[t]/=e;return this}getLength(){let e=0,t=0;for(let e=0;e<this.components.length;e++)0===this.components[e]&&t++;for(let i=0;i<this.components.length;i++)e+=this.components[i]**(this.components.length-t);return t===this.components.length?0:e**(1/(this.components.length-t))}getLengthSquared(){let e=0,t=0;for(let e=0;e<this.components.length;e++)0===this.components[e]&&t++;for(let i=0;i<this.components.length;i++)e+=this.components[i]**(this.components.length-t);return t===this.components.length?0:e}floor(){for(let e=0;e<this.components.length;e++)this.components[e]=Math.floor(this.components[e]);return this}clamp(e,t){for(let s=0;s<this.components.length;s++)this.components[s]=i.generalMathUtils.clamp(this.components[s],e,t);return this}modulo(e){for(let t=0;t<this.components.length;t++)this.components[t]=this.components[t]%e;return this}}}),define("structures/vector2d",["require","exports","structures/abstract_vector","general/general_math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.AbstractVector{get x(){return this.components[0]}get y(){return this.components[1]}set x(e){this.components[0]=e}set y(e){this.components[1]=e}constructor(e,t){super([e,t])}static zero(){return new n(0,0)}static fromPolarCoordinates(e,t){return n.zero().setPolarCoordinates(e,t)}static createConnectingVector(e,t){return new n(t.x-e.x,t.y-e.y)}setPolarCoordinates(e,t){return this.set(e*Math.cos(t),e*Math.sin(t)),this}toJSON(){return{x:this.x,y:this.y}}zero(){return this.x=0,this.y=0,this}flip(){return this.x*=-1,this.y*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e,this.y*=e,this}div(e){return this.x/=e,this.y/=e,this}lerp(e,t){return s.generalMathUtils.lerp(this.x,e.x,t),s.generalMathUtils.lerp(this.y,e.y,t),this}merge(e){return this.x=e.x,this.y=e.y,this}set(e,t){return this.x=e,this.y=t,this}moveBy(e,t){return this.x+=e,this.y+=t,this}componentWiseMul(e){return this.x*=e.x,this.y*=e.y,this}componentWiseDiv(e){return this.x/=e.x,this.y/=e.y,this}isEqual(e){return this.x===e.x&&this.y===e.y}distance(e){return Math.sqrt(Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2))}distanceSquared(e){return Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2)}distanceApproximation(e){return e.x-this.x+e.y-this.y}clone(){return new n(this.x,this.y)}getDirectionAngle(){return Math.atan2(this.y,this.x)}}t.Vector2D=n}),define("structures/shapes/interfaces/rectangle_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/read_only_rectangle_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/read_only_shape",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/primitive_shape_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LINE=0]="LINE",e[e.POINT=1]="POINT",e[e.CIRCLE=2]="CIRCLE",e[e.RECTANGLE=3]="RECTANGLE",e[e.PATH=4]="PATH"}(t.ShapeType||(t.ShapeType={}))}),define("structures/shapes/interfaces/circle_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/path_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/point_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("geometry/collision_calculator",["require","exports","structures/shapes/interfaces/primitive_shape_interface"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.collisionCheckMap={},this.addCollisionPair(i.ShapeType.RECTANGLE,i.ShapeType.RECTANGLE,this.isRectangleOverlappingRectangle),this.addCollisionPair(i.ShapeType.POINT,i.ShapeType.RECTANGLE,this.isPointOverlappingRectangle),this.addCollisionPair(i.ShapeType.CIRCLE,i.ShapeType.RECTANGLE,this.isCirleOverlappingRectangle),this.addCollisionPair(i.ShapeType.POINT,i.ShapeType.POINT,this.isPointOverlappingPoint),this.addCollisionPair(i.ShapeType.POINT,i.ShapeType.CIRCLE,this.isPointOverlappingCircle),this.addCollisionPair(i.ShapeType.CIRCLE,i.ShapeType.CIRCLE,this.isCircleOverlappingCircle),this.addCollisionPair(i.ShapeType.POINT,i.ShapeType.PATH,this.isPointOverlappingPath)}addCollisionPair(e,t,s){this.collisionCheckMap[i.ShapeType[e]+i.ShapeType[t]]=s.bind(this),e!==t&&(this.collisionCheckMap[i.ShapeType[t]+i.ShapeType[e]]=((e,t)=>s.call(this,t,e)))}isCircleOverlappingCircle(e,t){return e.position.distanceSquared(t.position)<(e.radius+t.radius)**2}isCirleOverlappingRectangle(e,t){const i=Math.abs(e.x-t.x-t.width/2),s=Math.abs(e.y-t.y-t.height/2);if(i>t.width/2+e.radius)return!1;if(s>t.height/2+e.radius)return!1;if(i<=t.width/2)return!0;if(s<=t.height/2)return!0;const n=i-t.width/2,r=s-t.height/2;return n*n+r*r<=e.radius*e.radius}isPointOverlappingPoint(e,t){return e.isEquivalentTo(t)}isPointOverlappingPath(e,t){const i=t.points;for(let s=0,n=i.length-1;s<n;s++){const n=e.x,r=e.y,o=i[s].x,a=i[s].y,l=i[s+1].x,c=i[s+1].y,d=Math.sqrt((l-o)*(l-o)+(c-a)*(c-a)),h=Math.sqrt((n-o)*(n-o)+(r-a)*(r-a)),u=Math.sqrt((l-n)*(l-n)+(c-r)*(c-r));if(d<=h+u+t.thickness&&d>=h+u-t.thickness)return!0}return!1}isOverlapping(e,t){const s=this.collisionCheckMap[i.ShapeType[e.getType()]+i.ShapeType[t.getType()]];if(void 0===s)throw new Error("Shape type not implemented");return s(e,t)}isRectangleOverlappingRectangle(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}isPointOverlappingRectangle(e,t){return e.x>=t.x&&e.x<t.x+t.width&&e.y>=t.y&&e.y<t.y+t.height}isPointOverlappingCircle(e,t){return e.position.distanceSquared(t.position)<2*t.radius}}t.CollisionCalculator=s,t.collisionCalculator=new s}),define("geometry/geometry_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{}t.GeometryUtils=i,t.geometryUtils=new i}),define("random/seeded_random_generator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SeededRandomGenerator=class{constructor(e){0===e&&(e=1),this.seed=e}setSeed(e){this.seed=e}nextSeed(){this.seed=1e4*Math.sin(this.seed)}nextNumber(){return this.nextSeed(),this.seed-Math.floor(this.seed)}nextBoolean(){return this.nextNumber()<.5}getNextHexString(){return Math.floor(268435456*(1+this.nextNumber())).toString(16)}nextUuid(){return[this.getNextHexString(),this.getNextHexString(),this.getNextHexString(),this.getNextHexString()].join("-")}nextNumberInRange(e,t,i=!0){const s=t-e,n=this.nextNumber()*s+e;return i?Math.floor(n):n}rollDice(e=6){return this.nextNumberInRange(1,e+1)}}}),define("structures/vector3d",["require","exports","structures/abstract_vector","structures/vector2d"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.AbstractVector{get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}set x(e){this.components[0]=e}set y(e){this.components[1]=e}set z(e){this.components[2]=e}constructor(e,t,i){super([e,t,i])}componentWiseMul(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}componentWiseDiv(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}clone(){return new n(this.components[0],this.components[1],this.components[2])}xy(){return new s.Vector2D(this.x,this.y)}xz(){return new s.Vector2D(this.x,this.z)}yz(){return new s.Vector2D(this.y,this.z)}yx(){return new s.Vector2D(this.y,this.x)}zx(){return new s.Vector2D(this.z,this.x)}zy(){return new s.Vector2D(this.z,this.y)}}t.Vector3D=n}),define("structures/matrix3x3",["require","exports","structures/vector3d","structures/vector2d"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{get x(){return this.data[0]}get y(){return this.data[1]}get w(){return this.data[2]}constructor(e,t,i){this.data=[e,t,i]}static fromArray(e){const t=new i.Vector3D(e[0][0],e[0][1],e[0][2]),s=new i.Vector3D(e[1][0],e[1][1],e[1][2]),r=new i.Vector3D(e[2][0],e[2][1],e[2][2]);return new n(t,s,r)}translateBy(e){const t=new s.Vector2D(this.x.getLength(),this.y.getLength()),i=e.clone().componentWiseMul(t).add(this.w.xy());return this.translateTo(i),this}translateTo(e){return this.w.x=e.x,this.w.y=e.y,this}scaleBy(e){return this.x.mul(e.x),this.y.mul(e.y),this}scaleTo(e){return this.scaleBy(new s.Vector2D(e.x/this.x.getLength(),e.y/this.y.getLength())),this}}t.Matrix3x3=n}),define("structures/shapes/primitive_shape",["require","exports","geometry/collision_calculator"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PrimitiveShape=class{constructor(e,t){this.position=e,this.type=t}getType(){return this.type}intersects(e){return i.collisionCalculator.isOverlapping(this,e)}}}),define("structures/shapes/rectangle",["require","exports","structures/vector2d","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/primitive_shape"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends n.PrimitiveShape{get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}get width(){return this.size.x}set width(e){this.size.x=e}get height(){return this.size.y}set height(e){this.size.y=e}get bottom(){return this.y+this.height}get right(){return this.x+this.width}constructor(e,t,n){super(e,s.ShapeType.RECTANGLE),this.size=new i.Vector2D(t,n)}static zero(){return new r(i.Vector2D.zero(),0,0)}clone(){return r.fromVectors(this.position.clone(),this.size)}isEquivalentTo(e){return this.size.isEqual(e.size)&&this.position.isEqual(e.position)}getBoundingBox(){return this}static fromVectors(e,t){return new r(e,t.x,t.y)}merge(e){return this.position.merge(e.position),this.size.merge(e.size),this}containsPoint(e){return e.x>=this.x&&e.x<this.right&&e.y>=this.y&&e.y<this.bottom}}t.Rectangle=r}),define("structures/shapes/circle",["require","exports","structures/shapes/primitive_shape","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/rectangle"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.PrimitiveShape{get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}constructor(e,t){super(e,s.ShapeType.CIRCLE),this.radius=t}isEquivalentTo(e){return this.position.isEqual(e.position)&&e.radius===this.radius}getBoundingBox(){return this.updateBoundingBox(),this.boundingBox}clone(){return new r(this.position.clone(),this.radius)}updateBoundingBox(){void 0===this.boundingBox?this.boundingBox=new n.Rectangle(this.position.clone().subScalar(this.radius),2*this.radius,2*this.radius):(this.boundingBox.position.set(this.position.x-this.radius,this.position.y-this.radius),this.boundingBox.size.set(2*this.radius,2*this.radius))}}t.Circle=r}),define("structures/shapes/interfaces/circle_sector_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/circle_sector",["require","exports","structures/vector2d","structures/shapes/circle","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/rectangle"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CircleSector=class extends s.Circle{isEquivalentTo(e){return super.isEquivalentTo(e)&&this.startAngle===e.startAngle&&this.endAngle===e.endAngle}isAngleInSector(e){return!(e<this.startAngle||e>this.endAngle)}getAngleCoordinatesTuple(e){return[this.position.x+this.radius+this.radius*Math.cos(e),this.position.y+this.radius+this.radius*Math.sin(e)]}getPointForAngle(e){if(!this.isAngleInSector(e))throw new Error("Angle not in sector!");const[t,s]=this.getAngleCoordinatesTuple(e);return new i.Vector2D(t,s)}updateBoundingBox(){let e=Number.MAX_VALUE,t=Number.MAX_VALUE,s=0,n=0;for(let i=this.startAngle;i<=this.endAngle;i+=.1){const[r,o]=this.getAngleCoordinatesTuple(i);e=Math.min(e,r),t=Math.min(t,o),s=Math.max(s,r),n=Math.max(n,o)}const{x:o,y:a}=this.position;e=Math.min(e,o+this.radius),t=Math.min(t,a+this.radius),s=Math.max(s,o+this.radius),n=Math.max(n,a+this.radius),void 0===this.boundingBox?this.boundingBox=new r.Rectangle(new i.Vector2D(e-this.radius,t-this.radius),s-e,n-t):(this.boundingBox.position.set(e-this.radius,t-this.radius),this.boundingBox.size.set(s-e,n-t))}constructor(e,t,i,s){super(e,n.ShapeType.CIRCLE),this.radius=t,this.startAngle=i,this.endAngle=s}}}),define("structures/shapes/interfaces/read_only_circle",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/interfaces/read_only_circle_sector",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("structures/shapes/line",["require","exports","structures/shapes/primitive_shape","structures/vector2d","structures/shapes/interfaces/primitive_shape_interface"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Line=class extends i.PrimitiveShape{constructor(e,t){super(e,n.ShapeType.LINE),this.targetPosition=t}isEquivalentTo(e){return this.position.isEqual(e.position)&&this.targetPosition.isEqual(e.targetPosition)}getAngleAtSource(){return s.Vector2D.createConnectingVector(this.targetPosition,this.position).getDirectionAngle()}getAngleAtTarget(){return s.Vector2D.createConnectingVector(this.position,this.targetPosition).getDirectionAngle()}getBoundingBox(){throw new Error("Method not implemented.")}}}),define("structures/shapes/path",["require","exports","structures/shapes/primitive_shape","structures/vector2d","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/rectangle"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Path=class extends i.PrimitiveShape{constructor(e,t,i){super(e,n.ShapeType.PATH),this._points=t.map(t=>new s.Vector2D(t.x-e.x,t.y-e.y)),this._position=e,this._thickness=i}get points(){return this._points}set points(e){this._points=e.map(e=>new s.Vector2D(e.x,e.y))}set position(e){this._position=e}get position(){return this._position}set thickness(e){this._thickness=e}get thickness(){return this._thickness}isEquivalentTo(e){for(let t=0;t<this._points.length;t++)if(this._points[t].isEqual(e.points[t]))return!1;return this.position.isEqual(e.position)}getBoundingBox(){return this.updateBoundingBox(),this.boundingBox}updateBoundingBox(){let e=0,t=0,i=Number.MAX_VALUE,n=Number.MAX_VALUE;this._points.forEach(s=>{t=Math.max(t,s.x),e=Math.max(e,s.y),n=Math.min(n,s.x),i=Math.min(i,s.y)}),this.boundingBox=new r.Rectangle(new s.Vector2D(n,i).add(this._position),t-n,e-i)}}}),define("structures/shapes/point",["require","exports","structures/shapes/primitive_shape","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/rectangle"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Point=class extends i.PrimitiveShape{get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}constructor(e){super(e,s.ShapeType.POINT)}isEquivalentTo(e){return this.position.isEqual(e.position)}getBoundingBox(){return this.updateBoundingBox(),this.boundingBox}updateBoundingBox(){void 0===this.boundingBox?this.boundingBox=new n.Rectangle(this.position,1,1):this.boundingBox.position.set(this.position.x,this.position.y)}}}),define("structures/vector4d",["require","exports","structures/abstract_vector"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s extends i.AbstractVector{get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}get w(){return this.components[3]}set x(e){this.components[0]=e}set y(e){this.components[1]=e}set z(e){this.components[2]=e}set w(e){this.components[3]=e}get r(){return this.components[0]}get g(){return this.components[1]}get b(){return this.components[2]}get a(){return this.components[3]}set r(e){this.components[0]=e}set g(e){this.components[1]=e}set b(e){this.components[2]=e}set a(e){this.components[3]=e}constructor(e,t,i,s){super([e,t,i,s])}clone(){return new s(this.components[0],this.components[1],this.components[2],this.components[3])}isEqual(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}}t.Vector4D=s}),define("trigonometry/trigonometry_utils",["require","exports","structures/vector2d","structures/shapes/path"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{degreesToRadians(e){return Math.PI*e/180}radiansToDegrees(e){return 180*e/Math.PI}rotateRectangle(e,t,n){const r=new i.Vector2D(e.x,e.y),o=new i.Vector2D(e.right,e.y),a=new i.Vector2D(e.x,e.bottom),l=[r,o,new i.Vector2D(e.right,e.bottom),a].map(e=>e.clone().sub(t)).map(e=>i.Vector2D.fromPolarCoordinates(e.getLength(),e.getDirectionAngle()+n)).map(e=>e.add(t));return l.forEach(e=>{e.x=Math.round(e.x),e.y=Math.round(e.y)}),new s.Path(l[0],l,0)}}t.TrigonometryUtils=n,t.trigonometryUtils=new n}),define("math_utils",["require","exports","conversion/number_conversion_utils","conversion/unit_conversion_utils","general/general_math_utils","geometry/collision_calculator","geometry/geometry_utils","random/seeded_random_generator","structures/abstract_vector","structures/matrix3x3","structures/shapes/circle","structures/shapes/circle_sector","structures/shapes/interfaces/primitive_shape_interface","structures/shapes/line","structures/shapes/path","structures/shapes/point","structures/shapes/primitive_shape","structures/shapes/rectangle","structures/vector2d","structures/vector3d","structures/vector4d","trigonometry/trigonometry_utils"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S){"use strict";function C(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),C(i),C(s),C(n),C(r),C(o),C(a),C(l),C(c),C(d),C(h),C(u),C(p),C(g),C(m),C(_),C(f),C(y),C(b),C(E),C(S)}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("metrics_history",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=100,n=1e4;t.LOCAL_STORAGE_ID="metrics_history";class r{static setRestFormConnector(e){this.connector=e}static addEntry(e,t,i){this.historyArray.push({key:e,timestamp:i,value:t}),this.historyArray.size>s&&this.handleSend(),void 0===this.sendToServerTimeout&&(this.sendToServerTimeout=window.setTimeout(()=>{this.handleSend(),this.sendToServerTimeout=void 0},n))}static reset(){this.historyArray.clear()}static async handleSend(){if(void 0!==this.connector){const e=this.historyArray.toArray();this.historyArray.clear(),void 0!==!this.sendingPromise?(this.sendingPromise=this.sendToServer(e),await this.sendingPromise,this.sendingPromise=void 0):(await this.sendingPromise,this.sendingPromise=this.sendToServer(e),await this.sendingPromise,this.sendingPromise=void 0)}}static sendToServer(e){const t=this.connector({history:_.groupBy(e,({key:e})=>e)});return t.catch(()=>{e.forEach(e=>this.historyArray.push(e))}),t}static log(){console.log("METRICS HISTORY STATE:",_.groupBy(this.historyArray.toArray(),({key:e})=>e))}}r.historyArray=new i.LocalStorageArray(t.LOCAL_STORAGE_ID),t.MetricsHistory=r}),define("metrics_store",["require","exports","log","reusable_utilities","reusable_utilities","metrics_history"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SESSION_STORAGE_ID="metrics_store";class o{static handleMetricDefinition(e,t){void 0!==t.initial?this.storage.set(e.join("."),t.initial):Object.keys(t).filter(e=>"initial"!==e&&"action"!==e).forEach(i=>{const s=_.extend([],e);s.push(i),this.handleMetricDefinition(s,t[i])})}static reset(){this.storage.clear(),r.MetricsHistory.reset()}static initializeMetric(e,t){this.handleMetricDefinition([e],t)}static getStats(e){const t=this.storage.get(e);return void 0===t&&i.logService.error("No metric with key ",{name:e}," registered."),t}static setStats(e,t,i,n){this.storage.set(e,t),i&&r.MetricsHistory.addEntry(e,s.deepClone(t),n)}static log(){console.log("METRICS STORE STATE:",this.storage.toObject()),r.MetricsHistory.log()}}o.storage=new n.SessionStorageCollection(t.SESSION_STORAGE_ID),t.MetricsStore=o}),define("metric_definitions/cache/read/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.read={action:(e,t)=>(e[t.cacheId]=t.value,e),initial:{}}}),define("metric_definitions/cache/write/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.write={action:(e,t)=>(e[t.cacheId]=t.value,e),initial:{}}}),define("metric_definitions/cache/definition",["require","exports","metric_definitions/cache/read/definition","metric_definitions/cache/write/definition"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cache={read:i.read,write:s.write}}),define("metric_definitions/loading/network_latency/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.network_latency={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/page_load/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.page_load={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/fully_loaded/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fully_loaded={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/time_to_first_byte/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.time_to_first_byte={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/dom_ready/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dom_ready={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/page_render/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.page_render={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/boot_strap/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.boot_strap={action:(e,t)=>t,initial:{}}}),define("metric_definitions/loading/definition",["require","exports","metric_definitions/loading/network_latency/definition","metric_definitions/loading/page_load/definition","metric_definitions/loading/fully_loaded/definition","metric_definitions/loading/time_to_first_byte/definition","metric_definitions/loading/dom_ready/definition","metric_definitions/loading/page_render/definition","metric_definitions/loading/boot_strap/definition"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loading={network_latency:i.network_latency,page_load:s.page_load,fully_loaded:n.fully_loaded,time_to_first_byte:r.time_to_first_byte,dom_ready:o.dom_ready,page_render:a.page_render,boot_strap:l.boot_strap}}),define("metric_definitions/resources/duration/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.duration={action:(e,t)=>t,initial:{}}}),define("metric_definitions/resources/dns_lookup/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dns_lookup={action:(e,t)=>t,initial:{}}}),define("metric_definitions/resources/response_time/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.response_time={action:(e,t)=>t,initial:{}}}),define("metric_definitions/resources/tcp_handshake/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tcp_handshake={action:(e,t)=>t,initial:{}}}),define("metric_definitions/resources/definition",["require","exports","metric_definitions/resources/duration/definition","metric_definitions/resources/dns_lookup/definition","metric_definitions/resources/response_time/definition","metric_definitions/resources/tcp_handshake/definition"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resources={duration:i.duration,dns_lookup:s.dns_lookup,response_time:n.response_time,tcp_handshake:r.tcp_handshake}}),define("metric_definitions/browser/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browser={action:(e,t)=>t,initial:{}}}),define("metric_definitions/memory/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memory={action:(e,t)=>t,initial:{}}}),define("metric_definitions/object_pool/definition",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.object_pool={action:(e,t)=>(void 0===e[t.poolName]&&(e[t.poolName]={maxSize:0}),e[t.poolName].maxSize=Math.max(e[t.poolName].maxSize,t.size),e),initial:{}}}),define("metric_definitions/definitions",["require","exports","metric_definitions/cache/definition","metric_definitions/loading/definition","metric_definitions/resources/definition","metric_definitions/browser/definition","metric_definitions/memory/definition","metric_definitions/object_pool/definition"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.metrics={cache:i.cache,loading:s.loading,resources:n.resources,browser:r.browser,memory:o.memory,object_pool:a.object_pool}});define("config/default",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMetricsServiceConfiguration={"*":{enabled:!1,sendToServer:!1}}}),define("general_metrics/loading",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStats=function(e){function t(){i.isAPIAvailable("performance.timing")&&(e("metrics.loading.network_latency",{start:performance.timing.fetchStart,end:performance.timing.responseEnd,delta:performance.timing.responseEnd-performance.timing.fetchStart}),e("metrics.loading.page_load",{start:performance.timing.responseEnd,end:performance.timing.loadEventEnd,delta:performance.timing.loadEventEnd-performance.timing.responseEnd}),e("metrics.loading.fully_loaded",{start:performance.timing.navigationStart,end:performance.timing.loadEventEnd,delta:performance.timing.loadEventEnd-performance.timing.navigationStart}),e("metrics.loading.time_to_first_byte",{start:performance.timing.requestStart,end:performance.timing.responseStart,delta:window.performance.timing.responseStart-window.performance.timing.requestStart}),e("metrics.loading.dom_ready",{start:performance.timing.fetchStart,end:performance.timing.domInteractive,delta:window.performance.timing.domInteractive-window.performance.timing.fetchStart}),e("metrics.loading.page_render",{start:performance.timing.domLoading,end:performance.timing.domComplete,delta:window.performance.timing.domComplete-window.performance.timing.domLoading}))}$.isReady?t():$(function(){t()})}}),define("general_metrics/resources",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStats=function(e){function t(){if(i.isAPIAvailable("performance.getEntriesByType")){const t={},i={},s={},n={};performance.getEntriesByType("resource").forEach(e=>{const r=e.name.split(/\//g).pop();t[r]={value:e.duration,url:e.name},i[r]={value:e.domainLookupEnd-e.domainLookupStart,url:e.name},s[r]={value:e.connectEnd-e.connectStart,url:e.name},n[r]={value:e.responseEnd-e.responseStart,url:e.name}}),e("metrics.resources.duration",t),e("metrics.resources.dns_lookup",i),e("metrics.resources.tcp_handshake",s),e("metrics.resources.response_time",n)}}$.isReady?t():$(function(){t()})}}),define("general_metrics/browser",["require","exports","bowser"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=["msie","chrome","firefox","safari","opera","msedge"];t.getStats=function(e){function t(){e("metrics.browser",{name:function(){for(let e=0;e<s.length;e++)if(i[s[e]])return s[e]}(),version:i.version})}$.isReady?t():$(function(){t()})}}),define("general_metrics/memory",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=6e4;t.getStats=function(e){if(i.isAPIAvailable("performance.memory")){let t=0,i=0,n=0;const r=performance.memory,o=function(){r.jsHeapSizeLimit===t&&r.totalJSHeapSize===i&&r.usedJSHeapSize===n||(t=r.jsHeapSizeLimit,i=r.totalJSHeapSize,n=r.usedJSHeapSize,e("metrics.memory",{jsHeapSizeLimit:t,totalJSHeapSize:i,usedJSHeapSize:n}))};setInterval(()=>{o()},s),o()}}}),define("metrics",["require","exports","log","metrics_store","metric_definitions/definitions","config/default","reusable_utilities","general_metrics/loading","general_metrics/resources","general_metrics/browser","general_metrics/memory","object_pool","event_bus"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class p{static setConfig(e=r.defaultMetricsServiceConfiguration){this.config=e}static changeConfig(e){this.setConfig(e),this.initializeMetrics()}static getConfig(){return o.deepFreeze(this.config)}static getAction(e){return this.actions[e]}static getConfigForKey(e){const t=e.join("."),s=this.config[e.join(".")];if(void 0!==s)return s;for(;e.length>0;){e.pop();const t=this.config[e.concat(["*"]).join(".")];if(void 0!==t)return t}i.logService.error("No config found for key: ",{name:t})}static handleMetricDefinition(e,t,i){if(void 0!==i.action){const s=this.getConfigForKey(_.extend([],t));e[t.join(".")]={enabled:s.enabled,sendToServer:s.sendToServer,action:i.action}}else Object.keys(i).filter(e=>"initial"!==e&&"action"!==e).forEach(s=>{const n=_.extend([],t);n.push(s),this.handleMetricDefinition(e,n,i[s])},!1)}static initializeMetric(e,t){this.handleMetricDefinition(this.actions,[e],t)}static initializeMetrics(){this.actions={},Object.keys(n.metrics).forEach(e=>{this.initializeMetric(e,n.metrics[e]),s.MetricsStore.initializeMetric(e,n.metrics[e])})}static initializeSpecialMetrics(){a.getStats((e,t)=>{p.handleStatChange(e,t)}),l.getStats((e,t)=>{p.handleStatChange(e,t)}),c.getStats((e,t)=>{p.handleStatChange(e,t)}),d.getStats((e,t)=>{p.handleStatChange(e,t)}),h.Pool.metricsCallback=((e,t)=>{this.handleStatChange("metrics.object_pool",{poolName:e,size:t})})}static initialize(){this.initializeMetrics(),this.initialized=!0,this.initializeSpecialMetrics()}static isMetricEnabled(e){if(!this.initialized)return!1;e=e.replace("metrics.","");const t=this.getAction(e);return void 0!==t&&t.enabled}static handleStatChange(e,t){if(!this.initialized)return;e=e.replace("metrics.","");const i=this.getAction(e),n=Date.now();void 0!==i&&i.enabled&&_.defer(()=>{const r=s.MetricsStore.getStats(e),o=i.action(r,t);s.MetricsStore.setStats(e,o,i.sendToServer,n)})}static log(){s.MetricsStore.log()}}p.actions={},p.initialized=!1,t.Metrics=p,u.eventBus.stream.filter(e=>e.type===u.EVENT_TYPES.METRICS_PAYLOAD).subscribe(u.EventBus.createListener(e=>{p.handleStatChange(e.value.key,e.value.payload)}))}),define("metrics_exposed",["require","exports","metrics","metrics_history","event_bus"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsService={dispatchStats(e,t){n.eventBus.dispatch({type:n.EVENT_TYPES.METRICS_PAYLOAD,value:{key:e,payload:t}})},isMetricEnabled:e=>i.Metrics.isMetricEnabled(e),setRestFormConnector(e){s.MetricsHistory.setRestFormConnector(e)},log(){i.Metrics.log()},changeConfig(e){i.Metrics.changeConfig(e)},getConfig:()=>i.Metrics.getConfig(),initialize(){i.Metrics.initialize()}}}),define("metrics_service",["require","exports","metrics_exposed"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("topic_navbar/topic_navbar_item_controller",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultTopicNavbarItemController=class{constructor(e){this.mappedId=e}decorateCancellationToken(e){e.subscribeToStream(i.eventBus,i.EVENT_TYPES.FILTER_CLOSE_MENUS,t=>()=>{e.setTimeout(this.fireEventToPersistAllChangesAndCloseAllMenus.bind(this),50)}),e.subscribeToStream(i.eventBus,i.EVENT_TYPES.FILTER_PERSIST_CHANGES_AND_CLOSE_MENUS,t=>()=>{e.setTimeout(this.fireEventToPersistAllChangesAndCloseAllMenus.bind(this),50)})}fireEventToPersistAllChangesAndCloseAllMenus(){i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_FILTER_MENU,value:{mappedId:this.mappedId}})}handleTransition(){i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_TRANSITION,value:{mappedId:this.mappedId}})}toggleContextMenu(e){e.stopPropagation(),i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_CONTEXT_MENU,value:{mappedId:this.mappedId}})}toggleFilterMenu(e){e.stopPropagation(),this.closeFilters(),i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_FILTER_MENU,value:{mappedId:this.mappedId}})}closeFilters(){i.eventBus.dispatch({type:i.EVENT_TYPES.FILTER_CLOSE_MENUS,value:{}})}closeContextMenu(){i.eventBus.dispatch({type:i.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_CONTEXT_MENU,value:{mappedId:this.mappedId}})}}}),define("topic_navbar/topic_navbar_renderable",["require","exports","classnames","event_bus","flux","quicksearch_saved","react","topic_navbar/topic_navbar_item_controller","topic_navbar/topic_navbar_item_renderable"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class c extends n.BaseComponent{constructor(e){super(e),this.state=c.initState(e),this.setupSubscriptions()}static initState(e,t={}){const{items:i}=e,s={};return i.forEach(e=>{const{mapped_id:i}=e;void 0===s[i]&&(void 0!==t[i]?s[i]=t[i]:s[i]={menuOpen:!1,filterMenuOpen:!1,transitioned:!1,hidden:!1,controller:new a.DefaultTopicNavbarItemController(i)})}),s}setupSubscriptions(){this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_FILTER_MENU,e=>{const{mappedId:t}=e.value,i=this.state;Object.entries(i).filter(e=>void 0===t||e[0]===t).forEach(e=>e[1].filterMenuOpen=!1),this.setState(i)}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOPIC_NAVBAR_CLOSE_CONTEXT_MENU,e=>{const{mappedId:t}=e.value,i=this.state;Object.entries(i).filter(e=>void 0===t||e[0]===t).forEach(e=>e[1].menuOpen=!1),this.setState(i)}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOPIC_NAVBAR_TRANSITION,e=>{const{mappedId:t}=e.value,i=this.state[t];i.transitioned=!0,i.hidden=!1,this.setState({[t]:i})}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_CONTEXT_MENU,e=>{const{mappedId:t}=e.value,i=this.state[t];i.menuOpen||this.closeAllContextMenus(),i.menuOpen=!i.menuOpen,this.setState({[t]:i})}),this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_FILTER_MENU,e=>{const{mappedId:t}=e.value,i=this.state[t];i.filterMenuOpen||this.closeAllFilterMenus(),i.filterMenuOpen=!i.filterMenuOpen,this.setState({[t]:i});const n=this.state[t].filterMenuOpen;n&&s.eventBus.dispatch({type:s.EVENT_TYPES.FILTER_MENU_SHOW,value:{rendered:n,mapped_id:t}})})}closeAllContextMenus(){const e=this.state;Object.values(e).forEach(e=>{e.menuOpen=!1}),this.setState(e)}closeAllFilterMenus(){const e=this.state;Object.values(e).forEach(e=>{e.filterMenuOpen=!1}),this.setState(e)}render(){const{sticky:e,buttons:t,menu:s}=this.props,n=i({"topic-navbar-container":!0,sticky:e});return o.createElement("div",{className:n},o.createElement("div",{className:"top"},o.createElement(r.QuickSearchSavedComponent,{items:s.items,title:s.title,width:s.width,emptyLabel:s.emptyLabel,buttons:s.buttons}),o.createElement("div",{className:"items"},this.renderItems()),this.renderActionButtons(t)))}renderActionButtons(e){const t=e.map(e=>this.renderButton(e)),s=i({"action-button":e.length>0,"buttons-shown":e.length>0});return o.createElement("div",{className:s,style:{maxWidth:this.getButtonContainerWidth(t.length)}},t)}getButtonContainerWidth(e){if(0===e)return"0px";const t=30*e+8*(e-1);return`${t-t%e}px`}renderButton(e){return void 0!==e.customComponent?e.customComponent:o.createElement("div",{key:e.id,className:"action-button-wrapper",onClick:t=>this.handleClickActionButton(e),title:e.description},o.createElement("i",{className:e.icon}))}renderItems(){return this.props.items.map((e,t,i)=>this.renderSingleItem(e,t,i.length))}renderSingleItem(e,t,i){const{messages:s}=this.props,n=t!==this.props.maxItems-1&&e.isPlaceholder,r=e.isPlaceholder?"placeholder"+t:e.mapped_id;return o.createElement(l.TopicNavbarItemRenderable,Object.assign({key:r,showBorder:n,messages:s,init:this.props.init,queryValidator:this.props.queryValidator},this.state[e.mapped_id],e))}static getDerivedStateFromProps(e,t){return c.initState(e,t)}handleClickActionButton(e){e.disabled()||e.action()}}t.TopicNavbarRenderable=c}),define("topic_navbar/topic_navbar_item_renderable",["require","exports","angular_utilities","classnames","event_bus","flux","jquery","react","reusable_components","reusable_services","reusable_utilities","underscore"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopicNavbarItemRenderable=class extends r.BaseComponent{constructor(e){super(e),this.props.controller.decorateCancellationToken(this.cancellationToken),this.state={invalid:!1,lastValidatedQuery:void 0},this.debouncedSave=h.debounce(this.saveChanges.bind(this),200,!0)}componentDidMount(){const{controller:e,init:t}=this.props;t?setTimeout(()=>e.handleTransition(),100):h.defer(()=>e.handleTransition())}render(){const{selected:e,showBorder:t,transitioned:i,hidden:n,mapped_id:r,editing:o,disabled:l}=this.props,{invalid:c}=this.state,d=s({item:!0,transitioned:i,selected:e,editing:o,"show-border":!0===t,empty:this.isPlaceHolder(),"hide-item":n,invalid:c,disabled:l});return a.createElement("div",{className:d,key:r,onClick:this.onItemClick.bind(this),style:this.getItemStyle()},this.renderItem())}onItemClick(){const{disabled:e,mapped_id:t,editing:i}=this.props;e?n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_DISABLED_CLICK,value:{mapped_id:t,disabled:e}}):i||this.setEditing(!0)}renderItem(){return this.isPlaceHolder()?[this.renderPlaceholder()]:[a.createElement("div",{key:"right",className:"right"},this.props.editing?this.renderInputField():a.createElement("div",{className:"title"},this.renderTitle()),this.renderButtons()),this.renderContextMenu()]}renderButtons(){const{editing:e,showFilterIcon:t}=this.props;return t||!e?a.createElement("div",{className:s({"button-container":!0,"showing-filters":t})},this.renderContextMenuButton(),this.renderFilterMenuButton()):null}renderTitle(){const{title:e}=this.props;try{const t=c.emojiService.parseTextForEmoji(e);return a.createElement("div",{dangerouslySetInnerHTML:{__html:t}})}catch(t){return a.createElement("div",null,e)}}getItemStyle(){const{color:e,isPlaceholder:t,selected:i}=this.props;if(e&&!t)return{borderBottom:`5px solid ${i?e:"#d7dbdd"}`}}renderContextMenuButton(){return this.props.editing?null:a.createElement("div",{className:"icon context-menu-btn",key:"context-menu-button",id:this.getContextMenuButtonId(),onClick:e=>this.toggleContextMenuWithTimeout(e)},a.createElement("i",{className:"icon-tw-ellipsis"}))}renderContextMenu(){const{menuOpen:e}=this.props;return e?a.createElement(l.ContextMenuBuilder,{key:"context-menu",widgetId:"",onClickOutside:e=>this.toggleContextMenuWithTimeout(e),widgetActions:this.getActions()}):null}toggleContextMenuWithTimeout(e){if(e.stopPropagation(),void 0===this.contextMenuTimeout){const t=e;void 0!==t.persist&&t.persist(),this.contextMenuTimeout=setTimeout(()=>{this.isUnmounted||(this.props.controller.toggleContextMenu(e),this.contextMenuTimeout=void 0)},50)}}renderFilterMenuButton(){const{showFilterIcon:e,editing:t,color:i,controller:s}=this.props,n={color:i,display:"block"};return e&&!t?a.createElement("div",{className:"icon filter-menu-button",key:"filter-menu-button",id:this.getFilterButtonId(),onClick:e=>s.toggleFilterMenu(e)},a.createElement("i",{className:"fa fa-filter",style:n})):null}getActions(){const{messages:e,controller:t,canMute:i,canMuteOthers:s}=this.props,n=[{icon:"icon-tw-cross",label:e.removeItem,clickAction:e=>{e.stopPropagation(),this.deleteItem(),t.closeContextMenu()}},{icon:"fa fa-pencil",label:e.editItem,clickAction:e=>{e.stopPropagation(),t.closeFilters(),this.openEditionModal(),t.closeContextMenu()}},{icon:"fa fa-filter",label:e.editFilters,clickAction:e=>{e.stopPropagation(),t.toggleFilterMenu(e),t.closeContextMenu()}}];return i&&n.push({icon:this.getMuteClass(),label:this.getMuteLabel(),clickAction:e=>{e.stopPropagation(),this.toggleItemMute(),t.closeContextMenu()}}),s&&n.push({icon:this.getSoloClass(),label:this.getSoloLabel(),clickAction:e=>{e.stopPropagation(),this.muteOthers(),t.closeContextMenu()}}),n}getMuteClass(){return this.props.selected?"fa fa-eye-slash":"fa fa-eye"}getMuteLabel(){const{selected:e,messages:t}=this.props;return e?t.muteItem:t.unmuteItem}getSoloClass(){return"fa fa-eye"}getSoloLabel(){return this.props.messages.muteOthers}getFilterButtonId(){return`filters-${h.last(this.props.mapped_id.split("|"))}`}getContextMenuButtonId(){return`context-menu-${h.last(this.props.mapped_id.split("|"))}`}deleteItem(){n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_DELETE_ITEM,value:{mapped_id:this.props.mapped_id,title:this.props.title,query:this.props.query}})}toggleItemMute(){n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_ITEM_MUTE,value:this.props.mapped_id})}muteOthers(){n.eventBus.dispatch({type:n.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_OTHERS,value:this.props.mapped_id})}openEditionModal(){const{title:e,query:t,color:i,isPlaceholder:s,mapped_id:r}=this.props;n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_MODIFY_ITEM,value:{mapped_id:s?void 0:r,title:e,query:t,color:i}})}setEditing(e){n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_TOGGLE_EDITING,value:{mapped_id:this.props.mapped_id,editing:e}})}renderPlaceholder(){const{editing:e}=this.props,t=s({editing:e,hint:!0});return a.createElement("div",{className:"placeholder",key:"placeholder"},[a.createElement("div",{className:t,key:"placeholder-icon"},this.renderPlaceholderIcon(),this.props.title),e?this.renderInputField():void 0,this.renderSearchButton()])}renderPlaceholderIcon(){const{icon:e}=this.props;if(e){const t=s({[e]:!0,"placeholder-icon":!0});return a.createElement("i",{className:t})}return null}renderSearchButton(){const{messages:e}=this.props;return this.isNewSearch()?a.createElement("div",{className:"search-button",ref:e=>this.searchButtonRef=e,key:"search-button",onClick:this.handleSearchButtonClick.bind(this)},a.createElement("button",{type:"button",className:"btn btn-primary"},e.searchButtonLabel)):null}handleSearchButtonClick(){this.canSaveChanges()?this.persistChanges():this.discardChanges()}persistChanges(){this.isNewSearch()?this.startSearch():this.debouncedSave()}async startSearch(){if(this.inputValue){const e=this.inputValue,t=await this.isQueryValid(this.inputValue);if(t){const{editing:t,mapped_id:i}=this.props;t&&this.setEditing(!1),n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_NEW_SEARCH_QUERY,value:{mapped_id:i,query:e}})}else n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_INVALID_QUERY,value:void 0});this.setState({invalid:!t,lastValidatedQuery:this.inputValue})}}discardChanges(e){this.setEditing(!1)}canSaveChanges(){return this.inputValue&&this.inputValue!==this.props.query&&this.inputValue.length>0}async isQueryValid(e){return this.props.queryValidator(e)}async saveChanges(){if(this.canSaveChanges()){const e=await this.isQueryValid(this.inputValue);e?this.saveQuery(this.inputValue):n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_INVALID_QUERY,value:void 0}),this.setState({invalid:!e,lastValidatedQuery:this.inputValue})}else this.discardChanges(),this.setEditing(!1)}onKeyDown(e){e.keyCode===d.Keys.ENTER&&this.canSaveChanges()?this.persistChanges():e.keyCode===d.Keys.ESCAPE?this.discardChanges():this.updateValidationState()}saveQuery(e){n.eventBus.dispatch({type:n.EVENT_TYPES.TOPIC_NAVBAR_UPDATE_QUERY,value:{mapped_id:this.props.mapped_id,query:e}})}renderInputField(){return a.createElement(l.DocumentClickTrackerWrapper,{key:"placeholder-input",clickOutside:this.handleBlur.bind(this),className:"code-container-wrapper"},this.state.invalid?this.renderWarning():null,a.createElement("div",{className:this.getInputFieldClasses(),ref:e=>this.renderCodeContainerInputField(e)}))}renderWarning(){const{messages:e}=this.props;return a.createElement("div",{className:"warning",title:e.queryValidationFailed},a.createElement("i",{className:"fa fa-warning"}))}getInputFieldClasses(){return s({"code-title":!0,"has-warning":this.state.invalid})}async renderCodeContainerInputField(e){if(e&&0===e.getElementsByClassName("searchForm").length){const t=window.tw.inject,s=t("$compile"),n=t("$rootScope");await i.directiveService.inject(s,o(e),"quicksearch-code-container-form",{directiveArguments:{configuration:{initialValue:this.props.query,forceFocus:!0,selectAll:!0,inputMode:!0,hideErrorMessages:!0,onKeyDown:(e,t)=>{this.inputValue=t,this.onKeyDown(e)},location:"QUICK_SEARCH",onModelUpdate:e=>{this.inputValue=e.newValue,this.updateValidationState()}}},directiveAsElement:!1,parentScope:n})}}updateValidationState(){this.state.invalid&&this.inputValue!==this.state.lastValidatedQuery&&this.setState({invalid:!1,lastValidatedQuery:void 0})}handleBlur(e){[e.target,e.relatedTarget].map(e=>e&&this.searchButtonRef&&(this.searchButtonRef===e||o.contains(this.searchButtonRef,e))).some(e=>!!e)||setTimeout(()=>{this.canSaveChanges()?this.persistChanges():this.discardChanges()},100)}isPlaceHolder(){return!0===this.props.isPlaceholder}isNewSearch(){return this.isPlaceHolder()&&this.props.showSearchButton}}}),define("multiple_topic_navbar",["require","exports","topic_navbar/topic_navbar_item_controller","topic_navbar/topic_navbar_item_renderable","topic_navbar/topic_navbar_renderable"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("components/simple_note",["require","exports","flux","react","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SimpleNoteComponent=class extends i.BaseComponent{constructor(e){super(e)}render(){return s.createElement("div",null,s.createElement("form",{name:"note_form",className:"form-horizontal"},s.createElement("div",{className:"form-group no-hover no-border-bottom"},s.createElement("textarea",{name:"note",value:this.props.text,onChange:this.onChange.bind(this),className:"form-control full-width"})),s.createElement("div",{className:"bottom-btn-block clearfix"},s.createElement("div",{className:"col-xs-12 tw-buttons clearfix"},s.createElement(n.ProgressButton,Object.assign({},this.props.progressButtonProps))))))}onChange(e){this.props.onChange(e.target.value)}}}),define("notes",["require","exports","components/simple_note"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("interfaces/notes_feed_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/notes_feed.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNotesFeedStyle=function(e){return{root:{padding:20},creationBoxContainer:{display:"flex",alignItems:"flex-start",marginBottom:30},textareaWrapper:{position:"relative",width:"100%",display:"inline-block"},charsIndicator:{position:"absolute",right:2,bottom:0,fontSize:10},creationBox:{height:27,minHeight:27,width:"100%",resize:"none",paddingRight:12,paddingLeft:12,lineHeight:"20px",overflow:"hidden",border:`1px solid ${e.borderColor}`,"&:focus":{height:"auto",minHeight:100,transition:"all 250ms ease-out",borderColor:e.borderFocusColor,outline:0},"&::-webkit-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&::-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-ms-input-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor},"&:-moz-placeholder":{fontFamily:"CabinCondensedM",color:e.placeholderColor}},button:{padding:"4px 8px",marginRight:5,marginLeft:5},clearButton:{color:`${e.clearButtonColor} !important`,"&:hover":{color:"white !important"}},feedItems:{display:"flex",flexDirection:"column"},feedItem:{position:"relative",marginTop:10,marginBottom:10,paddingLeft:10},feedItemText:{whiteSpace:"pre-wrap"},leftBorder:{borderLeft:`3px solid ${e.leftBorderColor}`,position:"absolute",left:0,height:"calc(100% - 4px)",marginTop:4},noteHeader:{color:e.noteHeaderColor,fontSize:12,marginBottom:4},noteHeaderText:{marginRight:15},feedItemAction:{color:e.feedItemActionColor,marginRight:5,marginLeft:5,cursor:"pointer"}}}}),define("interfaces/note",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/notes_feed_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/notes_feed_config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/textarea_component",["require","exports","flux","react","css/notes_feed.css","classnames","jquery","keypress"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextareaComponent=class extends i.StyledBaseComponent{constructor(e){super(e,n.createNotesFeedStyle),void 0!==this.props.onCreateCallback&&(this.keypressListener=new a.Listener)}componentDidMount(){void 0!==this.props.onCreateCallback&&this.subscribeKeypressEvents()}render(){const e=`${this.props.text.length}/${this.props.config.maxChars}`,t=r([this.style.textareaWrapper,"textarea-wrapper"]);return s.createElement("div",{className:t},s.createElement("textarea",{placeholder:this.props.messages.creationBoxPlaceholder,value:this.props.text,onChange:e=>this.props.onChange(e),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),onKeyDown:this.onResizeTextArea.bind(this),onCut:this.onResizeTextArea.bind(this),onPaste:this.onResizeTextArea.bind(this),disabled:!0===this.props.config.disableCreationBox||void 0,maxLength:this.props.config.maxChars,className:this.style.creationBox}),s.createElement("span",{className:this.style.charsIndicator},e))}componentWillUnmount(){void 0!==this.props.onCreateCallback&&(this.keypressListener.reset(),this.keypressListener.destroy())}onFocus(e){void 0!==this.props.onCreateCallback&&this.keypressListener.listen(),this.onResizeTextArea(e)}onBlur(e){void 0!==this.props.onCreateCallback&&this.keypressListener.stop_listening();const t=e.target;o(t).css({height:""})}onResizeTextArea(e){const t=e.target;this.resizeTextArea(t)}resizeTextArea(e){const t=o(e);t.css({height:""});const i=e.scrollHeight;t.css({height:`${i}px`})}onTriggerAddNote(e){e.shiftKey||this.props.onCreateCallback(e)}subscribeKeypressEvents(){this.keypressListener.register_combo({keys:"enter",is_exclusive:!0,on_release:this.onTriggerAddNote.bind(this),on_keydown:this.onEnterDown.bind(this)}),this.keypressListener.stop_listening()}onEnterDown(e){return e.shiftKey}}}),define("components/notes_feed_item_component",["require","exports","flux","css/notes_feed.css","react","event_bus","classnames","components/textarea_component"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NotesFeedItemComponent=class extends i.StyledBaseComponent{constructor(e){super(e,s.createNotesFeedStyle),this.state={editMode:!1,updating:!1}}componentDidUpdate(){this.state.updating===!this.props.item.updating&&this.setState({editMode:!1,updating:!1,editableContent:void 0})}render(){const e={__html:this.props.item.header};return n.createElement("div",{className:this.style.feedItem},n.createElement("div",{className:this.style.leftBorder}),n.createElement("div",{className:this.style.noteHeader},n.createElement("span",{dangerouslySetInnerHTML:e,className:this.style.noteHeaderText}),this.renderEditButton(),this.renderSaveButton(),this.renderDeleteButton()),this.renderFeedItemContent())}renderEditButton(){const e=o(["fa fa-pencil",this.style.feedItemAction]);return this.canRenderEditButton()?n.createElement("i",{onClick:this.toggleEditMode.bind(this),className:e}):null}renderSaveButton(){const e=o(["fa fa-floppy-o",this.style.feedItemAction]);return this.canRenderSaveButton()?n.createElement("i",{onClick:this.triggerSaveChanges.bind(this),className:e}):null}canRenderEditButton(){return!0===this.props.item.editable&&!this.isEditableContentValid()}canRenderSaveButton(){return!0===this.props.item.editable&&!0===this.state.editMode&&this.isEditableContentValid()}isEditableContentValid(){return void 0!==this.state.editableContent&&this.state.editableContent.length>0}renderDeleteButton(){const e=o(["icon-tw-trash-bin",this.style.feedItemAction]);return!0===this.props.item.deletable?n.createElement("i",{onClick:this.triggerDeleteItem.bind(this),className:e}):null}toggleEditMode(e){this.setState({editMode:!this.state.editMode,editableContent:this.state.editMode?void 0:this.getEditableContent()})}renderFeedItemContent(){if(this.state.editMode)return n.createElement(a.TextareaComponent,{text:this.state.editableContent,onChange:this.onChangeContent.bind(this),theme:this.props.theme,messages:this.props.messages,config:this.props.config});{const e={__html:this.props.item.content};return n.createElement("div",{dangerouslySetInnerHTML:e,className:this.style.feedItemText})}}getEditableContent(){return void 0!==this.props.item.content&&this.props.item.content.length>0?this.props.item.content:""}onChangeContent(e){const t=e.target.value;this.setState({editableContent:t})}triggerSaveChanges(e){r.eventBus.dispatch({type:r.EVENT_TYPES.SAVE_NOTE_FROM_NOTES_FEED,value:Object.assign({},this.props.item,{content:this.state.editableContent})}),this.setState({updating:!0})}triggerDeleteItem(e){r.eventBus.dispatch({type:r.EVENT_TYPES.DELETE_NOTE_FROM_NOTES_FEED,value:this.props.item.id})}}}),define("components/notes_feed_component",["require","exports","flux","css/notes_feed.css","components/notes_feed_item_component","react","classnames","event_bus","components/textarea_component"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NotesFeedComponent=class extends i.StyledBaseComponent{constructor(e){super(e,s.createNotesFeedStyle),this.state={newNote:""}}render(){return r.createElement("div",{className:this.style.root},this.renderCreationBox(),this.renderNotes())}renderCreationBox(){return!0===this.props.config.showCreationBox?r.createElement("div",{className:this.style.creationBoxContainer},this.renderTextArea(),this.renderClearButton()):null}renderTextArea(){return r.createElement(l.TextareaComponent,{text:this.state.newNote,onChange:this.onChangeNewNote.bind(this),onCreateCallback:this.onTriggerAddNote.bind(this),theme:this.props.theme,messages:this.props.messages,config:this.props.config})}renderClearButton(){if(this.props.config.showClearButton){const e={"btn btn-default":!0,disabled:!0===this.props.config.disableCreationBox,[this.style.button]:!0,[this.style.clearButton]:!0},t=o(e);return r.createElement("button",{type:"button",onClick:this.clearCreationBox.bind(this),className:t},r.createElement("i",{className:"fa fa-times"}))}return null}renderNotes(){let e;const t=o({[this.style.feedItems]:!0,"stylized-scrollbar":!0===this.props.config.scrollable});return this.props.config.scrollable&&(e={maxHeight:.7*window.innerHeight,overflowY:"auto"}),r.createElement("div",{className:t,style:e},this.props.notes.map(e=>this.renderNote(e)))}renderNote(e){return r.createElement(n.NotesFeedItemComponent,{key:e.id,item:e,theme:this.props.theme,config:this.props.config,messages:this.props.messages})}clearCreationBox(){this.setState({newNote:""})}onChangeNewNote(e){const t=e.target.value;this.setState({newNote:t})}onTriggerAddNote(e){!this.props.config.disableCreationBox&&void 0!==this.state.newNote&&this.state.newNote.trim().length>0&&(a.eventBus.dispatch({type:a.EVENT_TYPES.CREATE_NOTE_FROM_NOTES_FEED,value:this.state.newNote}),this.setState({newNote:""}))}}}),define("notes_feed",["require","exports","components/notes_feed_component"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("actions/notification_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationActions={notification_onUpdateContent:"notification_onUpdateContent",notification_onClose:"notification_onClose",notification_onAdd:"notification_onAdd"}}),define("interfaces/notification_configuration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/notification",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.model=e,this.configuration=t,this.uuid=_.uniqueId(),++i.createdInstances,this.orderNumber=i.createdInstances}set message(e){this.model.message=e}get message(){return this.model.message}get id(){return this.uuid}get type(){return this.model.type}get config(){return this.configuration}get order(){return this.orderNumber}}i.createdInstances=0,t.NotificationWrapper=i}),define("interfaces/tray_change_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/notifications_tray_attrs",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/notification_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/notification_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/notification_style.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={right:"-100%",opacity:.3},n={right:0,opacity:1},r={WebkitTransition:"none !important",MozTransition:"none !important",OTransition:"none !important",transition:"none !important",opacity:0};t.notificationStyleModel={notification:{boxShadow:"0 0 5px #000",color:"#fff !important",fontSize:18,margin:15,padding:[15,25,15,15],position:"relative","&.notif-anim-appear":{extend:s},"&.notif-anim-appear-active":{extend:s},"&.notif-anim-enter":{extend:s},"&.notif-anim-enter-active":{extend:n},"&.notif-anim-exit":{extend:n,"&.instant-remove":{extend:r}},"&.notif-anim-exit-active":{extend:s,"&.instant-remove":{extend:r}},"& .close-button":{position:"absolute",right:5,top:5,fontSize:12}}},t.notificationStyle=i.createCssModule(()=>t.notificationStyleModel).compute({}).attach().getModule()}),define("components/notification/default_notification",["require","exports","flux","react","actions/notification_actions","css/notification_style.css","classnames","sanitizer"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultNotification=class extends i.BaseComponent{render(){const e=o([this.props.notification.type.toLowerCase(),r.notificationStyle.notification,{"instant-remove":this.isClosingInstantly()}]),t={__html:a.htmlSanitizer.escape(this.props.notification.message,["a","i"])};return s.createElement("li",{className:e,style:this.props.styles},s.createElement("div",{dangerouslySetInnerHTML:t}),this.renderCloseButton())}renderCloseButton(){return!0===this.props.notification.config.hideCloseButton?null:s.createElement("div",{onClick:this.close.bind(this),className:"close-button"},s.createElement("i",{className:"icon-tw-cross"}))}close(e){i.dispatcher.dispatch(n.NotificationActions.notification_onClose,{id:this.props.notification.id})}isClosingInstantly(){return this.props.notification.config.singleInstance}}}),define("css/notifications_style.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notificationsListStyleModel={twNotifications:{"& ul":{backgroundColor:"transparent",width:480,position:"fixed",right:0,top:0,zIndex:1060,listStyle:"none"}}},t.notificationsListStyle=i.createCssModule(()=>t.notificationsListStyleModel).compute({}).attach().getModule()}),define("components/notifications_tray",["require","exports","flux","react","components/notification/default_notification","css/notifications_style.css","classnames","react-transition-group"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TRANSITION_DURATION=750;t.NotificationsTray=class extends i.BaseComponent{constructor(e){super(e),this.state=this.initializeState(this.props)}componentWillReceiveProps(e){e.notifications!==this.props.notifications&&this.setState(this.initializeState(e))}render(){const e=this.computeTotalTransitionTime(),t=o([r.notificationsListStyle.twNotifications,"tw-notifications"]);return s.createElement("div",{ref:"root",className:t},s.createElement(a.TransitionGroup,{component:"ul"},this.renderNotifications(e)))}renderNotifications(e){return this.state.notifications.map((t,i)=>this.renderNotification(t,e,i))}renderNotification(e,t,i){let r=this.getTransitionDuration(e);const o=i*(r/t*.1),l={WebkitTransition:"all "+(r-=o)+"ms ease-out "+o+"ms",MozTransition:"all "+r+"ms ease-out "+o+"ms",OTransition:"all "+r+"ms ease-out "+o+"ms",transition:"all "+r+"ms ease-out "+o+"ms"};return s.createElement(a.CSSTransition,{key:e.id,classNames:"notif-anim",appear:!0,timeout:{enter:t,exit:t}},s.createElement(n.DefaultNotification,{notification:e,styles:l,key:e.id}))}computeTotalTransitionTime(){const e=_.map(this.state.notifications,e=>this.getTransitionDuration(e));return _.isEmpty(e)?t.DEFAULT_TRANSITION_DURATION:_.max(e,e=>e)}getTransitionDuration(e){return e.config.transitionDuration||t.DEFAULT_TRANSITION_DURATION}initializeState(e){return{notifications:e.notifications}}}}),define("stores/notifications_store",["require","exports","flux","actions/notification_actions","map","classes/notification","log","components/notifications_tray"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=7e3;class c extends i.BaseStore{constructor(){super([s.NotificationActions]),this.closeSchedules={},this.addSchedules={},this.notifications=new n.Map}addNotification(e,t){t.permanent=!0;const i=new r.NotificationWrapper(e,t);return this.notifications.set(i.id,i),this.triggerChange(s.NotificationActions.notification_onAdd),i.id}addScheduledNotification(e,t){const i=new r.NotificationWrapper(e,t),n=setTimeout(()=>{this.cancelScheduleInMap(i.id,this.addSchedules),this.notifications.set(i.id,i),this.triggerChange(s.NotificationActions.notification_onAdd),this.scheduleDismiss(i.id)},a.DEFAULT_TRANSITION_DURATION);return this.addSchedules[i.id]=n,i.id}removeNotification(e){this.notifications.delete(e),this.triggerChange(s.NotificationActions.notification_onClose)}getNotification(e){return this.notifications.get(e)}getNotifications(){return _.sortBy(this.notifications.values(),e=>Number(+!e.config.singleInstance+""+e.order))}getScheduledAddNotificationsIds(){return _.keys(this.addSchedules)}changeMessage(e,t){this.notifications.has(e)?(this.notifications.get(e).message=t,this.triggerChange(s.NotificationActions.notification_onUpdateContent)):o.logService.error(`Notification with id ${e} doesn't exist`)}canCreateSingleInstance(e,t){return!0===t.singleInstance&&!this.hasSameNotification(e)}findEqualNotificationByPayload(e){return _.find(this.notifications.values(),t=>this.isPayloadEqualToNotification(e,t))}scheduleDismiss(e){const t=c.getInstance().getNotification(e),i=setTimeout(()=>{this.cancelScheduledTimeout(e),c.getInstance().removeNotification(e)},t.config.displayDuration||l);this.closeSchedules[t.id]=i}hasScheduledAddNotification(e){return void 0!==this.addSchedules[e]}cancelScheduledTimeout(e){this.cancelScheduleInMap(e,this.closeSchedules)}cancelScheduledAdd(e){this.cancelScheduleInMap(e,this.addSchedules)}cancelScheduleInMap(e,t){void 0!==t[e]&&(clearTimeout(t[e]),delete t[e])}onUpdateContent(e){}onClose(e){this.cancelScheduledTimeout(e.id),this.removeNotification(e.id)}static getInstance(){return void 0===c.store&&(c.store=new c),c.store}triggerChange(e){this.onChange.fire({action:e,notifications:this.getNotifications()})}hasSameNotification(e){return this.notifications.values().some(t=>this.isPayloadEqualToNotification(e,t))}isPayloadEqualToNotification(e,t){return t.message===e.message&&t.type===e.type}}t.NotificationsStore=c}),define("containers/notifications_tray_container",["require","exports","flux","stores/notifications_store","actions/notification_actions","components/notifications_tray","react"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NotificationsTrayContainer=class extends i.BaseComponent{constructor(e){super(e),this.state=this.initializeState(e)}componentDidMount(){this.cancellationToken.subscribe(s.NotificationsStore.getInstance().onChange,this.handleAction.bind(this))}render(){return o.createElement(r.NotificationsTray,{notifications:this.state.notifications})}handleAction(e){switch(e.action){case n.NotificationActions.notification_onClose:case n.NotificationActions.notification_onAdd:case n.NotificationActions.notification_onUpdateContent:this.setState(this.initializeState(e))}}initializeState(e){return{notifications:e.notifications}}}}),define("services/notification_service",["require","exports","stores/notifications_store"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=5;class n{constructor(){this.initializeSingleInstanceCounters()}getNotifications(){return i.NotificationsStore.getInstance().getNotifications()}display(e=[]){return e.map(e=>{const t={permanent:e.permanent};return this.addNotification(e,t)})}success(e,t){const i={message:e,type:"SUCCESS"};return this.addNotification(i,t)}info(e,t){const i={message:e,type:"INFO"};return this.addNotification(i,t)}warning(e,t){const i={message:e,type:"WARNING"};return this.addNotification(i,t)}error(e,t){const i={message:e,type:"ERROR"};return this.addNotification(i,t)}dismiss(e){const t=i.NotificationsStore.getInstance().getNotification(e);t.config.singleInstance&&--this.singleInstanceCounters[t.type],this.dismissNotification(e)}changeMessage(e,t){i.NotificationsStore.getInstance().changeMessage(e,t)}dismissNotification(e){i.NotificationsStore.getInstance().removeNotification(e)}dismissFirstNonPermanent(e){const t=_.find(e,e=>!0!==e.config.singleInstance);void 0!==t&&(i.NotificationsStore.getInstance().cancelScheduledTimeout(t.id),this.dismissNotification(t.id))}addNotification(e,t){if(!t.singleInstance||i.NotificationsStore.getInstance().canCreateSingleInstance(e,t)){const s=i.NotificationsStore.getInstance().getNotifications();let n;return this.hasToDismissFirst()&&this.dismissFirstNonPermanent(s),t.permanent?(n=i.NotificationsStore.getInstance().addNotification(e,t),this.handlePermanentNotification(n,e.type,t)):this.handleNonPermanentNotification(e,t),n}{const s=i.NotificationsStore.getInstance().findEqualNotificationByPayload(e);return this.handlePermanentNotification(s.id,e.type,t),s.id}}hasToDismissFirst(){return i.NotificationsStore.getInstance().getNotifications().length+i.NotificationsStore.getInstance().getScheduledAddNotificationsIds().length>s}handleNonPermanentNotification(e,t){let s;return this.singleInstanceCounters[e.type]>0?s=i.NotificationsStore.getInstance().addScheduledNotification(e,t):(s=i.NotificationsStore.getInstance().addNotification(e,t),i.NotificationsStore.getInstance().scheduleDismiss(s)),s}handlePermanentNotification(e,t,i){i.singleInstance&&(++this.singleInstanceCounters[t],void 0!==i.closeOnResolve&&i.closeOnResolve.then(()=>{this.handleCloseOnResolve(e,t)},()=>{this.handleCloseOnResolve(e,t)}))}handleCloseOnResolve(e,t){setTimeout(()=>{--this.singleInstanceCounters[t],0===this.singleInstanceCounters[t]&&(i.NotificationsStore.getInstance().hasScheduledAddNotification(e)?i.NotificationsStore.getInstance().cancelScheduledAdd(e):this.dismissNotification(e))},500)}initializeSingleInstanceCounters(){this.singleInstanceCounters={SUCCESS:0,INFO:0,WARNING:0,ERROR:0}}}t.NotificationService=n,t.notificationService=new n}),define("notifications",["require","exports","containers/notifications_tray_container","services/notification_service"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("pool",["require","exports","log","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.items=[],this.id=s.uniqueId("pool_"),this.localMaximumPoolSize=0,this.sending=!1,this.initializer=e.initializer||s.identity,this.resetter=e.resetter,this.metricName=e.metricName,this.maxSize=e.maxSize||-1;const t=e.factory;this.factory=(()=>{const e=t();return e.poolId=this.id,e}),this.dynamic=e.dynamic,this.initializePool(e.initialSize)}initializePool(e){s(e).times(()=>this.items.push(this.factory()))}recycle(e){if(void 0===e.poolId||e.poolId!==this.id)throw new Error("Trying to recycle an object that did not come from this pool!");if(this.items.length===this.maxSize)throw new Error("Pool has reached maxSize!");return this.items.indexOf(e)>-1?i.logService.warn(`Tried to recycle an object that was already in the pool! (poolId: ${this.id})`):void 0!==this.resetter?this.items.push(this.resetter(e)):this.items.push(e),this.sendMetrics(),this}recycleMany(e){return e.forEach(e=>this.recycle(e)),this}get(...e){let t;if(0===this.items.length){if(!this.dynamic)throw new Error("Pool is not dynamic and does not hold enough items to fullfill request!");t=this.factory()}else t=this.items.pop();return e&&e.length>0?this.initializer(t,...e):t}sendMetrics(){this.sending||(this.sending=!0,this.items.length>this.localMaximumPoolSize&&(this.localMaximumPoolSize=this.items.length,void 0!==this.metricName&&void 0!==n.metricsCallback&&n.metricsCallback(this.metricName+"_"+this.id,this.localMaximumPoolSize)),window.setTimeout(()=>this.sending=!1,1e4))}getMany(e,...t){return s.range(e).map(()=>this.get(...t))}}t.Pool=n}),define("object_pool",["require","exports","pool"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("api/map_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OPEN_LAYERS=0]="OPEN_LAYERS"}(t.MapType||(t.MapType={}))}),define("impl/react_components/results_container",["require","exports","event_bus","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ResultsContainer=class extends s.BaseComponent{constructor(e){super(e),e.containingMap&&e.numberOfResults&&(this.state={numberOfResults:this.props.containingMap.numberOfResults},this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.WORLD_MAP_RESULTS_CHANGED,e=>{this.setState({numberOfResults:e.value.numberOfResults})}))}render(){const{controlLabelClass:e,controlResultsSpanId:t,msgResults:i,controlContainerClass:s}=this.props;return n.createElement("div",{className:s},n.createElement("span",{className:e},i),this.props.numberOfResults&&n.createElement("span",{id:t},this.props.numberFormatter.toInteger(this.props.numberOfResults)))}}}),define("impl/react_components/show_container",["require","exports","flux","react","reusable_components","reusable_utilities"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowContainer=class extends i.BaseComponent{constructor(e){super(e)}render(){const{geodataPrecisionTypesMenu:e,topicMenuSelectStrategy:t,controlContainerClass:i}=this.props,o={mainClass:"control-select-container",containerClass:"label label-primary clickable align-with-icon",clickLocation:r.ClickLocation.ANYWHERE,iconClass:"fa fa-caret-down"};return s.createElement("div",{className:i},s.createElement(n.TopicMenuSelect,{topicMenu:e.toModel(),styleModel:o,allowMultiSelection:!1,concatAllNode:!1,concatSelectionLabel:!1,menuStrategy:t}))}}}),define("impl/react_components/grouping_container",["require","exports","flux","react","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GroupingContainer=class extends i.BaseComponent{render(){const{msgOff:e,msgOn:t,controlContainerClass:i,toggleGrouping:r,controlLabelClass:o,msgGroupBubbles:a,controlGroupingSpanId:l}=this.props;return s.createElement("div",{className:i},s.createElement("span",{className:o},a),s.createElement("span",{id:l},s.createElement(n.OnOffComponent,{on:!0,messages:{off:e,on:t},callback:e=>r(e)})))}}}),define("impl/pie_chart/map_pie_chart_drawable_map_pie",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/pie_chart/map_pie_chart_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/pie_chart/map_pie_chart_vector_pool",["require","exports","object_pool","math_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapPieChartVectorPool=new i.Pool({initialSize:0,dynamic:!0,factory:()=>s.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_map_pie_chart"})}),define("impl/pie_chart/map_pie_chart_utils",["require","exports","math_utils","graphics_utilities","math_utils","impl/pie_chart/map_pie_chart_vector_pool","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=50,l=15;function c(e,t){return Math.min(i.generalMathUtils.linearScale({min:0,max:t},{min:l,max:a},e),a)}t.calculateRadius=c;const d=5;function h(e,t){return e+t+d}function u(e,t){e.totalResults+=t.totalResults,e.nodeCoordinates[t.totalResults]=t.coordinates,e.clusterId+=t.totalResults,e.childNodes.push(t),-1===t.id.indexOf("cluster")?(e.childIds.push(t.id),e.regionIds.push(t.regionId)):(e.childIds.push(...t.childNodes.map(({id:e})=>e)),e.regionIds.push(...t.childNodes.map(({regionId:e})=>e))),"string"==typeof t.filters?"string"!=typeof e.filters?e.filters=`(${t.filters})`:e.filters.includes(t.filters)||(e.filters+=` OR (${t.filters})`):Object.keys(t.filters).forEach(i=>{void 0===e.filters[i]&&(e.filters[i]=[]),e.filters[i].push(...t.filters[i])}),t.slices.forEach(({color:t,results:i},s)=>{void 0===e.slices[s]?e.slices[s]={color:t,results:i}:e.slices[s].results+=i})}function p(e,t,i,s){return 0===t?i:0===s?e:(e*t+i*s)/(t+s)}function g(e,t,i){const s=Object.keys(t).reduce((e,i)=>{const s=parseInt(i),n=t[i];return e=[...function(e,t,i,s){return[p(e[0],t,i[0],s),p(e[1],t,i[1],s)]}([e[0],e[1]],e[2],n,s),e[2]+s]},[0,0,0]);return[s[0],s[1]]}function m(e,t,i,s,n){if(!i.includes(t))return i;const r=[e];return i=i.filter(t=>{const i=s[t];return function(e,t,i){if(e!==t){const s=h(e.radius,t.radius);if(Math.sqrt(Math.pow(e.pixelX-t.pixelX,2)+Math.pow(e.pixelY-t.pixelY,2))<s)return i.push(t),!1}return!0}(e,i,r)}),r.length>0&&(n.push(r),i.splice(i.indexOf(t),1)),i}function f(e,t){const[i,s]=t;return i>0&&s>0&&i<e.data.size.x&&s<e.data.size.y}function y(e,t,i=[]){if(void 0!==t.additionalData.moveFrom&&f(e,[t.position.x,t.position.y])){const[s,n]=e.getPixelFromCoordinate(t.additionalData.moveFrom);f(e,[s,n])&&(i.push({object:t.position,key:"x",targetValue:t.position.x,initialValue:s,duration:500,drawable:t}),i.push({object:t.position,key:"y",targetValue:t.position.y,initialValue:n,duration:500,drawable:t}),t.position.x=s,t.position.y=n)}return i}function b(e,t,i){return t.additionalData.init=!1,y(e,t,i),e.init&&e.options.initialAnimationEnabled&&t.additionalData.node.slices.length>1&&s.DrawablePieChartFactory.tweenPieChartAngle(0,n.trigonometryUtils.degreesToRadians(360),t,e.options.initialAnimationDuration/2).forEach(({object:e,key:s,targetValue:n,initialValue:r,duration:o})=>{i.push({object:e,key:s,targetValue:n,initialValue:r,duration:o,drawable:t})}),t.children.forEach(e=>{e.styleData.opacity=0,i.push({object:e.styleData,key:"opacity",targetValue:1,initialValue:0,duration:500,drawable:e})}),i}function E(e,t,i){if(f(e,[t.position.x,t.position.y])){const[s,n]=e.getPixelFromCoordinate(t.additionalData.moveTo);if(f(e,[s,n])){Math.sqrt(Math.pow(s-t.position.x,2)+Math.pow(n-t.position.y,2))<Math.max(e.data.size.x,e.data.size.y)/2&&(i.push({object:t.position,key:"x",targetValue:s,initialValue:t.position.x,duration:500,drawable:t}),i.push({object:t.position,key:"y",targetValue:n,initialValue:t.position.y,duration:500,drawable:t}))}}return i}function S(e,t,i){return t.children.forEach((e,s)=>{i.push({object:e.styleData,key:"opacity",targetValue:0,initialValue:e.styleData.opacity,duration:500,drawable:e,options:{onTick:i=>{1===i&&_.defer(()=>{r.mapPieChartVectorPool.recycle(e.position),s===t.children.length-1&&r.mapPieChartVectorPool.recycle(t.position)})}}})}),i}t.calculateMinDistance=h,t.createClusterNode=function(e,t,i){const s=function(e,t){const i={totalResults:0,slices:[],childNodes:[],nodeCoordinates:[],clusterId:"cluster_",filters:{},centroid:void 0,pixelCoordinates:void 0,radius:0,childIds:[],regionIds:[]};return t.forEach(e=>{u(i,e)}),i.centroid=g(e,i.nodeCoordinates,i.totalResults),i.pixelCoordinates=e.getPixelFromCoordinate(i.centroid),i.radius=c(i.totalResults,e.data.model.maxResult),i}(e,t);if(function(e,t,i){for(let s=0,n=t.length;s<n;s++){const r=t[s],o=h(i.radius,r.radius);if(Math.sqrt(Math.pow(r.pixelX-i.pixelCoordinates[0],2)+Math.pow(r.pixelY-i.pixelCoordinates[1],2))<o){u(i,r),t.splice(t.indexOf(r),1),n--;const o=c(i.totalResults,e.data.model.maxResult);o>i.radius&&(s=0),i.radius=o}}i.centroid=g(e,i.nodeCoordinates,i.totalResults),i.pixelCoordinates=e.getPixelFromCoordinate(i.centroid)}(e,i,s),void 0!==e.pieCharts[s.clusterId])return void i.push(e.pieCharts[s.clusterId]);s.childIds.length>1&&s.childIds.forEach(t=>{void 0!==e.oldPieCharts[t]&&(e.oldPieCharts[t].additionalData.moveTo=s.centroid)});const n=function(e,t){return{id:1===e.childNodes.length?e.childNodes[0].id:e.clusterId,totalResults:e.totalResults,slices:e.slices,coordinates:e.centroid,pixelX:e.pixelCoordinates[0],pixelY:e.pixelCoordinates[1],radius:e.radius,childNodes:e.childNodes,filters:e.filters,childIds:e.childIds,regionIds:_.uniq(e.regionIds),regionId:t}}(s,t[0].regionId);return i.push(n),e.maxValue=Math.max(e.maxValue,n.totalResults),n},t.skipIfNoModelChange=function(e){let t=0;return i=>(i.data.model.checkSum!==t&&(i=e(i)),t=i.data.model.checkSum,i)},t.skipIfModelChange=function(e){let t=0;return i=>(i.data.model.checkSum===t&&(i=e(i)),t=i.data.model.checkSum,i)},t.computeCentroid=g,t.findClusters=function(e){let t=(e=_.sortBy(e,({totalResults:e})=>-e)).map((e,t)=>t);const i=[];return e.forEach((s,n)=>{t=m(s,n,t,e,i)}),t.forEach(t=>{i.push([e[t]])}),i},t.createMoveFromTweens=y,t.createInitialAnimation=b,t.handleLeavingNodes=function(e,t){_.toArray(e.oldPieCharts).forEach(i=>{if(i.additionalData.leaving=!0,i.additionalData.node.childIds.forEach(s=>{e.data.model.grouping||void 0===t[s]||(t[s].additionalData.moveFrom=i.additionalData.node.coordinates)}),i.position.x>0&&i.position.x<e.data.size.x&&i.position.y>0&&i.position.y<e.data.size.y&&void 0!==i.additionalData.node.regionId){const s=i.additionalData.node.regionId.replace("[","").replace("]","");void 0!==t[e.data.model.regionMap[s].id]&&(i.additionalData.moveTo=t[e.data.model.regionMap[s].id].additionalData.node.coordinates)}})},t.addMoveFrom=function(e,t,i){const s=t.additionalData.node;if(0===s.childNodes.length&&e.data.model.regionMap[s.regionId]&&i[e.data.model.regionMap[s.regionId].id]){const n=i[e.data.model.regionMap[s.regionId].id];n.position.x>0&&n.position.x<e.data.size.x&&n.position.y>0&&n.position.y<e.data.size.y&&(t.additionalData.moveFrom=i[e.data.model.regionMap[s.regionId].id].additionalData.node.coordinates)}},t.createMoveToAnimation=E,t.createLeaveAnimation=S,t.createPieChartTweens=function(e,t){const i=[];return t.additionalData.init?b(e,t,i):t.additionalData.leaving&&S(0,t,i),void 0!==t.additionalData.moveTo&&E(e,t,i),i},t.createNewPieChart=function(e,t){const{slices:i,totalResults:a,radius:l}=t,c=e.options.numberFormatter.toInteger(a);let d=0,h=c.length;c.indexOf("K")>-1&&(h+=1),c.indexOf("M")>-1&&(h+=2),c.indexOf("B")>-1&&(h+=3);const u=o.MathUtils.linearScale({min:1,max:6+(e.maxValue>1e9?1:0)},{min:.55,max:1},h),p=s.DrawablePieChartFactory.generatePieChart(r.mapPieChartVectorPool.get(t.pixelX,t.pixelY),l,i.map(({results:e,color:t})=>(d+=e/a*360,{endAngle:n.trigonometryUtils.degreesToRadians(Math.round(d)),style:{fillStyle:t}})),c,!1,1.5*Math.floor(l),r.mapPieChartVectorPool);return _.last(p.children).size*=u,p.additionalData={node:t,init:!0,leaving:!1},p.styleData.opacity=1,p},t.isNoCompareBucketMap=function(e){return e.nodes[0]&&1===e.nodes[0].slices.length&&e.bucketColors&&e.bucketColors.length>0}}),define("impl/pie_chart/map_pie_chart_model",["require","exports","reusable_utilities","impl/pie_chart/map_pie_chart_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapPieChartModel=class{constructor(e,t,n,r,o,a,l){this.regionMap=a,this.bucketColors=l,this.nodes=[],this.maxResult=0,this.totalResults=0,this.isLogarithmic=!1,this.id=_.uniqueId(),this.grouping=r,this.clusterLevel=o,e.forEach(e=>{this.maxResult=Math.max(this.maxResult,e.properties.result),this.totalResults+=e.properties.result;const t=e.properties.slices.map(({color:e,result:t})=>({results:t,color:e})),s=e.properties.result;this.nodes.push({id:e.id,totalResults:s,slices:t,coordinates:e.properties.olFeature.getGeometry().getCoordinates(),pixelX:0,pixelY:0,radius:0,childNodes:[],filters:0===e.properties.filters.indexOf("sourcegeo")?e.properties.filters:{[e.properties.id]:[i.StringUtils.parseFilters(e.properties.filters)]},regionId:e.properties.parent_id.length>0?e.properties.parent_id:void 0,childIds:[],regionIds:[e.properties.parent_id.length>0?e.properties.parent_id:void 0]}),delete e.properties.olFeature}),this.nodes.forEach(e=>{e.radius=s.calculateRadius(e.totalResults,this.maxResult)}),this.updateCheckSum(t)}toSerializable(){return this}updateCheckSum(e){this.checkSum=i.StringUtils.calculateHash(JSON.stringify(this.nodes)+this.grouping)+e}}}),define("api/geo_json_world_map_payload_value",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/react_components/unavailable_locations_container",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnavailableLocationsContainer=class extends i.BaseComponent{render(){const{controlContainerClass:e,controlLabelClass:t,messages:i}=this.props;return s.createElement("div",{className:e},s.createElement("span",{className:t},i.unavailableLocations),s.createElement("span",null))}}}),define("impl/react_components/zoom_level_display_container",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ZoomLevelDisplayContainer=class extends i.BaseComponent{render(){const{controlContainerClass:e,controlLabelClass:t,controlZoomLevelSpanId:i}=this.props,{zoomLevel:n,zoomDesc:r}=this.props.messages;return s.createElement("div",{className:e},s.createElement("span",{className:t},r),s.createElement("span",{id:i},"country"===this.props.currentZoomLevel?n.country:"region"===this.props.currentZoomLevel?n.region:n.coordinate))}}}),define("impl/react_components/metrics_container",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricsContainer=class extends i.BaseComponent{render(){const{controlLabelClass:e,controlMetricsSpanId:t,msgMetrics:i,controlContainerClass:n,selectedMetrics:r}=this.props,o=(Math.ceil(r.length/2)+1).toString().concat("em");return s.createElement("div",{className:n},s.createElement("span",{className:e},i),s.createElement("span",{id:t,style:{flexGrow:1,flexShrink:0,flexBasis:o}},r))}}}),define("impl/react_components/control_grouping_and_result",["require","exports","react","impl/react_components/results_container","impl/react_components/show_container","impl/react_components/grouping_container","flux","impl/react_components/unavailable_locations_container","impl/react_components/metrics_container"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlGroupingAndResults=class extends o.BaseComponent{constructor(){super(...arguments),this.controlContainerClass="control-container",this.disabledControlClass="disabled-control",this.showLoadingSpinnerClass="loading",this.controlLabelClass="control-label",this.controlResultsSpanId="control-results-span",this.controlMetricsSpanId="control-metrics-span",this.controlGroupingSpanId="control-grouping-span",this.intRootRef=void 0}render(){const{geodataPrecisionTypesMenu:e,messages:t,containingMap:o,toggleGrouping:c,numberFormatter:d,showGroupingContainer:h,unavailableLocations:u,selectedMetrics:p,shouldShowImpreciseLocationsMessage:g,setGroupingToggleStateEvent:m,geodataPrecisionTypesSelectionStrategy:_}=this.props,{results:f,groupBubbles:y,groupBubblesOff:b,groupBubblesOn:E,metrics:S,showImpreciseLocationsMessage:C}=t;return i.createElement("div",{ref:e=>this.intRootRef=e},i.createElement("i",{className:"fa fa-spinner fa-spin loading-indicator"}),i.createElement("div",{className:"tw-ol-pie-chart-control-toggle clickable ".concat(this.props.menuOpen?"":"collapsed"),onClick:e=>this.props.toggleMenu()},i.createElement("span",{className:"fa fa-sort-up"})),this.props.menuOpen&&i.createElement("div",{className:"tw-ol-pie-chart-control ".concat(this.props.menuOpen?"":"collapsed")},i.createElement("div",null,u&&u.length>0&&i.createElement(a.UnavailableLocationsContainer,{controlContainerClass:this.controlContainerClass,controlLabelClass:this.controlLabelClass,features:u,messages:{unavailableLocations:t.unavailableLocations}}),i.createElement(l.MetricsContainer,{controlContainerClass:this.controlContainerClass,controlLabelClass:this.controlLabelClass,controlMetricsSpanId:this.controlMetricsSpanId,msgMetrics:S,selectedMetrics:p}),i.createElement(s.ResultsContainer,{containingMap:o,controlContainerClass:this.controlContainerClass,controlResultsSpanId:this.controlResultsSpanId,msgResults:f,controlLabelClass:this.controlLabelClass,numberFormatter:d,numberOfResults:this.props.numberOfResults}),i.createElement(n.ShowContainer,{controlContainerClass:this.controlContainerClass,geodataPrecisionTypesMenu:e,topicMenuSelectStrategy:_}),h&&i.createElement(r.GroupingContainer,{controlContainerClass:this.controlContainerClass,geodataPrecisionTypesMenu:e,topicMenuSelectStrategy:_,controlLabelClass:this.controlLabelClass,msgGroupBubbles:y,msgOff:b,msgOn:E,toggleGrouping:c,setToggleStateEvent:m,controlGroupingSpanId:this.controlGroupingSpanId})),g&&C&&i.createElement(s.ResultsContainer,{controlContainerClass:this.controlContainerClass,msgResults:C,controlLabelClass:this.controlLabelClass})))}showLoadingSpinner(){this.intRootRef&&this.intRootRef.classList.add(this.showLoadingSpinnerClass)}hideLoadingSpinner(){this.intRootRef&&this.intRootRef.classList.remove(this.showLoadingSpinnerClass)}disable(){this.intRootRef&&this.intRootRef.classList.add(this.disabledControlClass)}enable(){this.intRootRef&&this.intRootRef.classList.remove(this.disabledControlClass)}get rootRef(){return this.intRootRef}}}),define("api/fragment_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/open_layers_widget_info",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/hover_menu_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/open_layers_show_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/open_layers_clear_timeout_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/view_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/extended_configuration_extent_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/open_layers_initial_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PIE_CHART="PIE_CHART",e.DOT_DENSITY="DOT_DENSITY",e.HEAT="HEAT",e.CHOROPLETH="CHOROPLETH",e.EMOJI="EMOJI"}(t.OpenLayersMapType||(t.OpenLayersMapType={}))}),define("api/open_layers_map_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/accessible_ol_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/bubble_dialog_payload_button",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/choropleth_show_value",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.BOTH=1]="BOTH",e[e.ONLY=2]="ONLY"}(t.ChoroplethShowValue||(t.ChoroplethShowValue={}))}),define("api/map_wrapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/constants_ol_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DATA_PROJECTION="EPSG:4326",e.FEATURE_PROJECTION="EPSG:3857"}(t.ConstantsOlMap||(t.ConstantsOlMap={}))}),define("api/abstract_layer_wrapper",["require","exports","impl/constants_ol_map","openlayers"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractLayerWrapper=class{constructor(e){this.options=e,this.lazyAddedFeaturesPromise=void 0,this.listenerKeys=[]}async refresh(e){this.lazyAddedFeaturesPromise&&await this.lazyAddedFeaturesPromise;const t=await this.resolveFetchFunctions();await this.preRefresh(t,e),e&&e.settings&&(this.settings=e.settings),e&&e.merge&&this.removeDuplicateFeaturesFromSource(t),this.layer.getSource()instanceof s.source.Vector?await this.addFeaturesToVectorLayerSource(t):await this.addFeaturesToNonVectorSource(t),e&&!e.noRefresh&&this.layer.getSource().refresh(),await this.postRefresh(t,e&&e.legendRanges)}async createLayer(e){if(!this.layer){const t=this.resolveFetchFunctions();await this.preCreate(t),this.settings=e.settings,this.intLayer=await this.createLayerInternal();const i=this.layer.getSource()instanceof s.source.Vector;e.previewData?i?(await this.addFeaturesToVectorLayerSource([await e.previewData]),this.lazyAddedFeaturesPromise=t.then(e=>this.addFeaturesToVectorLayerSource(e))):(await this.addFeaturesToNonVectorSource([await e.previewData]),this.lazyAddedFeaturesPromise=t.then(e=>this.addFeaturesToNonVectorSource(e))):i?await this.addFeaturesToVectorLayerSource(await t):await this.addFeaturesToNonVectorSource(await t),await this.postCreate(await t,e.legendRanges)}return this.layer}async addFeaturesToNonVectorSource(e){}async preRefresh(e,t){await this.setNumberOfResults(e),(this.options.removeFeaturesBeforeRefresh||t&&t.forceClear)&&this.layer.getSource()instanceof s.source.Vector&&this.layer.getSource().clear()}async preCreate(e){}async postRefresh(e,t){await this.checkForLegendUpdate(t)}async postCreate(e,t){await this.setNumberOfResults(e),await this.checkForLegendUpdate(t)}async checkForLegendUpdate(e){if(this.layer.getSource()instanceof s.source.Vector){const t=this.layer.getSource().getFeatures();e?t&&t.length>0&&this.updateLegend({data:t,legendRanges:e}):setTimeout(()=>this.options.onAfterLegendUpdate.fire(),50)}else this.layer.getSource()instanceof s.source.ImageCanvas&&setTimeout(()=>this.options.onAfterLegendUpdate.fire(),50)}get layer(){return this.intLayer}async initMapListener(){}async initEventListeners(e){}dispose(){this.listenerKeys&&this.listenerKeys.forEach(e=>s.Observable.unByKey(e))}async resolveFetchFunctions(){return Promise.all(this.options.fetchFunctions.map(e=>e()))}async setNumberOfResults(e){if(this.options.setNumberOfResultsFun){const t=_.flatten(e.filter(e=>e).map(e=>e.features)).filter(e=>e&&e.properties&&e.properties.id&&e.properties.result).map(e=>({id:e.properties.id,result:e.properties.result})).filter((e,t,i)=>t===i.findIndex(t=>e.id===t.id)).map(e=>e.result).reduce((e,t)=>e+t,0);this.options.setNumberOfResultsFun(t)}}removeDuplicateFeaturesFromSource(e){if(this.layer.getSource()instanceof s.source.Vector){const t=this.layer.getSource();e.forEach(e=>e.features.forEach(e=>{const i=t.getFeatures().find(t=>t.getProperties().id===e.properties.id);i&&t.removeFeature(i)}))}}async addFeaturesToVectorLayerSource(e){const{DATA_PROJECTION:t,FEATURE_PROJECTION:n}=i.ConstantsOlMap,r=this.layer.getSource(),o=new s.format.GeoJSON;if(e.length>0){let i=await this.prepareCombinedFeatureCollections(e);i=await this.handleDuplicateFeatures(i),i=await this.sortFeaturesBeforeAdding(i),r.addFeatures(o.readFeatures(i,{dataProjection:t,featureProjection:n}))}}async prepareCombinedFeatureCollections(e){return{type:"FeatureCollection",features:_.flatten(e.map(e=>e.features))}}async handleDuplicateFeatures(e){return e}async sortFeaturesBeforeAdding(e){return e}updateLegend(e){if(e.data&&e.legendRanges&&this.options.onLegendRangesUpdates){const t=e.data.filter(e=>e.getProperties()&&e.getProperties().result).reduce((e,t)=>e+t.getProperties().result,0);this.options.onLegendRangesUpdates.fire(e.legendRanges.map(({color:e,min:i,max:s})=>({min:i,max:s,total:t,color:e})))}setTimeout(()=>this.options.onAfterLegendUpdate.fire(),50)}}}),define("impl/ol_layer_dot_density",["require","exports","api/abstract_layer_wrapper","openlayers","api/layer_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerDotDensity=class extends i.AbstractLayerWrapper{constructor(){super(...arguments),this.intFeatures=void 0,this.pointerMoveHandler=(e=>{const t=this.options.getMapWrapper();if(e.dragging)t.controller.clearTimeout.hoverMenus();else{const i=t.getFeaturesAtPixel(e.pixel);i&&t.controller.show.hoverMenus({feature:i[0],map:t,showPopover:!0,choropleth:!1,event:e})}})}async createLayerInternal(){return new s.layer.Vector({source:new s.source.Vector({format:new s.format.GeoJSON,wrapX:!0}),style:new s.style.Style({text:new s.style.Text({text:"",font:"12px FontAwesome",textBaseline:"Bottom",fill:new s.style.Fill({color:"black"})}),zIndex:n.LayerFactory.zIndexes.data}),zIndex:n.LayerFactory.zIndexes.data})}async initMapListener(){const e=this.options.getMapWrapper();this.listenerKeys.push(e.on("pointermove",_.throttle(e=>this.pointerMoveHandler(e),25)))}async postCreate(e,t){await super.postCreate(e,t),await this.setFeaturesFromDataCollections(e)}async postRefresh(e,t){await super.postRefresh(e,t),await this.setFeaturesFromDataCollections(e)}async setFeaturesFromDataCollections(e){this.intFeatures=_.flatten(e.map(e=>e.features))}get features(){return this.intFeatures}get olFeatures(){return this.layer.getSource().getFeatures()}}}),define("impl/ol_layer_heat_map",["require","exports","api/abstract_layer_wrapper","openlayers","api/layer_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerHeatMap=class extends i.AbstractLayerWrapper{constructor(){super(...arguments),this.blur=10,this.radius=5,this.weight=(e=>1)}async createLayerInternal(){return new s.layer.Heatmap({source:new s.source.Vector({format:new s.format.GeoJSON,wrapX:!0}),blur:this.blur,radius:this.radius,weight:this.weight,zIndex:n.LayerFactory.zIndexes.data})}get features(){return this.layer.getSource().getFeatures()}}}),define("impl/ol_layer_choropleth",["require","exports","graphics_utilities","log","openlayers","api/abstract_layer_wrapper","api/layer_factory","impl/constants_ol_map"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerChoropleth=class extends r.AbstractLayerWrapper{constructor(e){super(e),this.options=e,this.highlights={},this.BORDER_COLOR=[255,255,255,1],this.BORDER_WIDTH=.5,this.stroke=new n.style.Stroke({color:this.BORDER_COLOR,width:this.BORDER_WIDTH,lineCap:"round"}),this.style=new n.style.Style({stroke:this.stroke}),this.styleFunction=(e=>this.styleFeature(e)),this.intHighlightFeatures=void 0,this.pointerMoveHandler=(e=>{const t=this.options.getMapWrapper();if(!this.options.highlightOnly&&!e.dragging){const i=t.getFeaturesAtPixel(e.pixel);if(i&&i[0].getProperties().result){const s=i[0];this.isHighlighted(s)||(t.controller.closeBubbleDialogs(),this.uncolorAll(),this.highLight(s),t.controller.show.hoverMenus({feature:s,map:t,showPopover:!0,choropleth:!0,event:e}))}else Object.keys(this.highlights).length>0&&this.uncolorAll(),t.controller.closeBubbleDialogs()}}),this.options.colorChoroplethEvent&&this.options.colorChoroplethEvent.subscribe(e=>this.highlightBycountryIds(e))}async createLayerInternal(){return new n.layer.Vector({source:new n.source.Vector({format:new n.format.GeoJSON,wrapX:!0}),renderBuffer:1200,style:this.styleFunction,zIndex:o.LayerFactory.zIndexes.choroplethData})}highlightBycountryIds(e){const{DATA_PROJECTION:t,FEATURE_PROJECTION:i}=a.ConstantsOlMap,r=this.options.getMapWrapper().controller.logFeature;if(s.logService.info(`Highlighting country with criteria  _ ${e.join(", ")} _. `,r,this.features.map(e=>{const{id:t,country_code:i,region_id:s,resource_url:n}=e.properties;return{id:t,country_code:i,region_id:s,resource_url:n}})),this.highlights={},this.layer.getSource().clear(),e){const o=this.features.filter(t=>e.includes(t.properties.id)||e.includes(t.properties.country_code)||e.includes(t.properties.region_id)||e.includes(t.properties.resource_url));0===o.length&&(e.length>0?s.logService.warn(`Could not find any features matching a criteria of  _ ${e.join(", ")} _! See loglevel info for more information`,r):s.logService.info("Clearing all highlights as the input countryIds array was empty",r)),this.layer.getSource().addFeatures((new n.format.GeoJSON).readFeatures({type:"FeatureCollection",features:o},{dataProjection:t,featureProjection:i})),this.layer.getSource().refresh()}}async initMapListener(){const e=this.options.getMapWrapper();this.listenerKeys.push(e.on("pointermove",_.throttle(e=>this.pointerMoveHandler(e),25)))}async preCreate(e){await super.preCreate(e),this.options.onAfterLegendUpdate&&(this.initialRenderPromise=this.options.onAfterLegendUpdate.subscribeOnceAsPromise())}async postCreate(e,t){await super.postCreate(e,t),this.options.highlightOnly?(this.prepareHighlightFeatures(e),this.layer.getSource().clear()):this.refresh()}async postRefresh(e,t){await super.postRefresh(e,t),this.options.highlightOnly&&(this.prepareHighlightFeatures(e),this.layer.getSource().clear())}async prepareHighlightFeatures(e){if(e.length>0){const t=await this.prepareCombinedFeatureCollections(e);t.features=t.features.concat(this.intHighlightFeatures),this.intHighlightFeatures=(await this.handleDuplicateFeatures(t)).features}}async handleDuplicateFeatures(e){return(e=await this.deleteDuplicatedPreviewFeatures(e)).features=e.features.filter(e=>e),e}async sortFeaturesBeforeAdding(e){return e.features=e.features.sort((e,t)=>e.properties.priority-t.properties.priority),e}async deleteDuplicatedPreviewFeatures(e){const t=[];return e.features.sort((e,t)=>Number.parseInt(e.id,16)-Number.parseInt(t.id,16)).map((e,i,s)=>{e&&s[i+1]&&e.id===s[i+1].id&&("#CCCCCC"===e.properties.color?t.push(i):t.push(i+1))}),t.forEach(t=>delete e.features[t]),e}styleFeature(e){const t=e.getProperties().color;return t&&this.style.setFill(new n.style.Fill({color:t})),this.style}uncolorAll(){for(const e in this.highlights)this.highlights[e].highlighted&&this.resetFeatureHighlight(e)}isHighlighted(e){return this.highlights[this.getFeatureId(e)]&&this.highlights[this.getFeatureId(e)].highlighted}highLight(e){const t=this.getFeatureId(e);this.highlights[t]={color:i.Color.fromARGBHex(e.getProperties().color),highlightColor:i.Color.fromARGBHex(e.getProperties().highlight_color),highlighted:!0},e.setStyle(this.getColoredStyle(this.highlights[t].highlightColor.toHex6())),this.layer.getSource().refresh()}resetFeatureHighlight(e){const t=this.layer.getSource().getFeatureById(e);t&&(t.setStyle(this.getColoredStyle(this.highlights[e].color.toHex6())),this.highlights[e].highlighted=!1),delete this.highlights[e]}getFeatureId(e){return e instanceof n.Feature?e.getId():e.getProperties().id}getColoredStyle(e){return new n.style.Style({fill:new n.style.Fill({color:e}),stroke:this.stroke})}get features(){return this.intHighlightFeatures?this.intHighlightFeatures:this.layer.getSource().getFeatures()}}}),define("impl/ol_layer_osm",["require","exports","api/abstract_layer_wrapper","openlayers","api/layer_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerOSM=class extends i.AbstractLayerWrapper{async createLayerInternal(){const e=this.options.tileServerLang?this.options.tileServerLang:"en";return new s.layer.Tile({source:new s.source.OSM({url:`https://tile.tw-cdn.com/${e}/{z}/{x}/{y}.png`,wrapX:!0,crossOrigin:null}),zIndex:n.LayerFactory.zIndexes.osm})}async refresh(e){}get features(){return[]}}}),define("api/open_layers_log_feature",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openLayersLogFeature={name:"OPEN_LAYERS_MAP",style:"color: #ffa500"}}),define("impl/ol_utils",["require","exports","impl/constants_ol_map","openlayers"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static transformFeatureCoordToDataCoord(e){const{FEATURE_PROJECTION:t,DATA_PROJECTION:n}=i.ConstantsOlMap;return s.proj.transform(e,t,n)}static transformDataCoordToFeatureCoord(e){const{FEATURE_PROJECTION:t,DATA_PROJECTION:n}=i.ConstantsOlMap;return s.proj.transform(e,n,t)}static extractCoordinatesFromBoundingBox(e){const t=e.split(":")[1],[i,s]=t.split(";"),r=i.split(","),o=Number(r[0]),a=Number(r[1]),l=s.split(","),c=Number(l[0]),d=Number(l[1]);return{southWestCoord:n.transformDataCoordToFeatureCoord([a,c]),northEastCoord:n.transformDataCoordToFeatureCoord([d,o])}}static sortFeaturesWithSlicesByResult(e){return e.filter(e=>e.properties.slices).sort((e,t)=>t.properties.result-e.properties.result)}}t.OlUtils=n}),define("impl/pie_chart/map_pie_chart_reducers",["require","exports","graphics_utilities","impl/pie_chart/map_pie_chart_utils"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleDistanceBasedClustering=function(e){if(e.data.model.grouping){const t=[];s.findClusters([...e.data.model.nodes]).forEach(i=>s.createClusterNode(e,i,t)),e.data.model.nodes=t}return e},t.calculatePixelCoordinates=function(e){return e.data.model.nodes.forEach(t=>{const i=e.getPixelFromCoordinate(t.coordinates);t.pixelX=i[0],t.pixelY=i[1]}),e},t.handleDragPositions=function(e){return e.pieCharts=e.oldPieCharts,_.toArray(e.pieCharts).forEach(t=>{const i=e.getPixelFromCoordinate(t.additionalData.node.coordinates);i&&(t.position.x=i[0],t.position.y=i[1])}),e},t.createPieCharts=function(e){const t={},n=Object.assign({},e.oldPieCharts);return e.data.model.nodes.forEach(r=>{void 0===e.oldPieCharts[r.id]?(t[r.id]=s.createNewPieChart(e,r),s.addMoveFrom(e,t[r.id],n)):(t[r.id]=e.oldPieCharts[r.id],t[r.id].additionalData.node=r,t[r.id].position.x=r.pixelX,t[r.id].position.y=r.pixelY,delete e.oldPieCharts[r.id],t[r.id].radius!==r.radius&&(t[r.id].radius=r.radius,t[r.id].children.forEach(e=>{e instanceof i.DrawableCircleSector&&(e.radius=r.radius)}))),e.newKeys.push(`${r.id}`)}),s.handleLeavingNodes(e,t),e.pieCharts=Object.assign({},t,e.oldPieCharts),e},t.createTweens=function(e){return e.tweens=_.flatten(_.toArray(e.pieCharts).map(t=>s.createPieChartTweens(e,t))),e};const n=5;function r(e,t,i,s){const n=t[i],r=t[s];e.push({min:r,max:n,color:"",total:0})}function o(e,t){if(e.buckets&&e.buckets.length>0&&void 0!==e.data.model.bucketColors[e.buckets.length-1]){const i=e.data.model.bucketColors[e.buckets.length-1].list_of_colors;e.buckets.forEach((e,s)=>{e.color=i[s],e.total=t})}}function a(e,t,i,s,n){let r=e,o=s[0],a=n.get(o),l=o*a,c=o/r*100,d=0;for(let e=1;e<s.length;e++){const h=s[e],u=n.get(h),p=h/r*100;if(Math.abs(p-c)<=i)l+=h*u,e==s.length-1&&d++;else{if(r-=l,o=h,a=u,++d==t-1)return++d;l=o*a,c=o/r*100,e==s.length-1&&d++}}return d}const l=7;t.buildLegendData=function(e){if(s.isNoCompareBucketMap(e.data.model)){let[t,i,s,c,d]=function(e){let t=0;const i=new Map;let s=0,n=0;const r=_.toArray(e.pieCharts).filter(({additionalData:t,position:i,radius:s})=>{let n=!0;return(i.x-s<0||i.x+s>e.data.size.x||i.y-s<0||i.y+s>e.data.size.y)&&(n=!1),!t.leaving&&n}).map(e=>(t+=e.additionalData.node.totalResults,i.has(e.additionalData.node.totalResults)?i.set(e.additionalData.node.totalResults,i.get(e.additionalData.node.totalResults)+1):(i.set(e.additionalData.node.totalResults,1),s++),n+=e.additionalData.node.totalResults,e.additionalData.node.totalResults)).sort((e,t)=>e>t?-1:1);return[i,r,t,s,n]}(e);const h=[],u=Math.min(n,c);if(i.length<=u)return i.forEach((e,t)=>r(h,i,t,t)),e.buckets=h.reverse(),o(e,d),e;let p=i[0],g=t.get(p),m=p*g,f=p/s*100,y=0,b=0;const E=function(e,t,i,s){let n=0,r=100,o=0,c=(r+o)/2,d=c,h=!1;for(;n<=l;){const l=a(e,t,c,i,s);l<t?r=c:o=c,l==t&&(h=!0,d=c),c=(r+o)/2,n++}return h?d:c}(d,u,i,t);for(let e=1;e<i.length;e++){const n=i[e],o=t.get(n),a=n/s*100;if(Math.abs(a-f)<=E)m+=n*o,e===i.length-1&&r(h,i,y,e);else{if(r(h,i,y,e-1),s-=m,p=n,g=o,y=e,++b==u-1){r(h,i,y,i.length-1);break}m=p*g,f=p/s*100,e===i.length-1&&r(h,i,y,y)}}e.buckets=h.reverse(),o(e,d)}return e},t.setSingleSlicePieColor=function(e){return s.isNoCompareBucketMap(e.data.model)&&_.toArray(e.pieCharts).forEach(t=>{if(!t.additionalData.leaving)for(const i of e.buckets)if(t.additionalData.node.totalResults<=i.max&&t.additionalData.node.totalResults>=i.min){t.children[0].styleData.fillStyle=i.color;break}}),e}}),define("impl/pie_chart/map_pie_chart",["require","exports","abstract_canvas_chart","math_utils","event_bus","event","impl/pie_chart/map_pie_chart_reducers","impl/pie_chart/map_pie_chart_utils"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAP_PIE_CHART_LAYER_TYPE=Object.assign({},i.CANVAS_CHART_LAYER_TYPE,{ITEMS:"ITEMS"});t.MapPieChart=class extends i.CanvasChart{constructor(e,i){super(e,Object.assign({},i,{layers:t.MAP_PIE_CHART_LAYER_TYPE,layerConfigs:{[t.MAP_PIE_CHART_LAYER_TYPE.ITEMS]:{enableInteractions:!0}},useCanvasAsMouseTarget:!0,margins:new s.Vector4D(0,0,0,0)})),this.initialData=e,this.onAfterUpdate=new r.Event,this.onAfterDraw=new r.Event,this.init=!0,this.dropDownOpened=!1,this.drawCanvas=i.containerSpan.children[0]}initialize(){this.renderer.onDrawDone.subscribe(()=>this.onAfterDraw.fire()),this.dataStream.map(this.createBuildData.bind(this)).map(a.skipIfNoModelChange(o.calculatePixelCoordinates)).map(a.skipIfNoModelChange(o.handleDistanceBasedClustering)).map(a.skipIfNoModelChange(o.createPieCharts)).map(a.skipIfNoModelChange(o.createTweens)).map(a.skipIfNoModelChange(o.buildLegendData)).map(a.skipIfNoModelChange(o.setSingleSlicePieColor)).map(a.skipIfModelChange(o.handleDragPositions)).subscribe(i.CanvasChartUtils.createStreamListener(this.handleDrawables.bind(this)))}async handleDrawables(e){e.buckets&&this.options.onLegendRangesUpdates.fire(e.buckets);const s=_.toArray(e.pieCharts);await this.clearDrawables(t.MAP_PIE_CHART_LAYER_TYPE.ITEMS);for(const n of s)n.on("mouseleave",()=>{this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT),this.closeDropDown()}),n.on("mouseenter",function(t){if(!n.additionalData.leaving){const i=$(t.target).offset(),s=n.getBoundingBox(),r=i.left+s.width/2+s.x,o=i.top+s.y;e.openDropDown(r,o+n.radius+_.last(n.children).getBoundingBox().height/2+5,this),this.dropDownOpened=!0}}),n.on("mouseleave",function(t){e.pieMouseLeave()}),n.on("mouseup",()=>this.options.zoomToCoordinates(n.additionalData.node.coordinates)),this.addDrawable(t.MAP_PIE_CHART_LAYER_TYPE.ITEMS,n);for(const i of e.leavingPieCharts)this.addDrawable(t.MAP_PIE_CHART_LAYER_TYPE.ITEMS,i);this.init=!1,e.tweens.length>0&&this.addTweens(e.tweens),this.onAfterUpdate.fire()}handleOldPieCharts(){return this.getDrawablesForLayer(t.MAP_PIE_CHART_LAYER_TYPE.ITEMS).reduce((e,t)=>(t.cancelAll(),t.additionalData.leaving||(e[t.additionalData.node.id]=t),e),{})}createBuildData(e){this.dropDownOpened&&(this.closeDropDown(),this.dropDownOpened=!1);const t=this.handleOldPieCharts();return{data:e,options:this.options,pieCharts:{},oldPieCharts:t,oldKeys:Object.keys(t),newKeys:[],tweens:[],leavingPieCharts:[],init:this.init,openDropDown:this.openPieDropDown.bind(this),pieMouseLeave:()=>this.options.colorChoroplethEvent.fire([]),maxValue:e.model.maxResult,getPixelFromCoordinate:this.options.getPixelFromCoordinate}}openPieDropDown(e,t,s){this.options.colorChoroplethEvent.fire(Object.keys(s.additionalData.node.filters)),this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER),this.openDropDown(e,t,[{icon:"fa fa-search-plus",text:"_196874",onClick:()=>{this.options.zoomToCoordinates(s.additionalData.node.coordinates)}},{icon:"fa fa-bars",text:"_489448",onClick:()=>{n.eventBus.dispatch({type:n.EVENT_TYPES.OPEN_MAP_DRILLDOWN,value:{filters:s.additionalData.node.filters,container:this.getContainer(),id:this.initialData.id}})}}])}changeCursor(e){return this.drawCanvas.style.cursor=e,this}dispose(){super.dispose(),this.closePopover(),this.onAfterUpdate.cancelAll(),this.onAfterDraw.cancelAll(),this.dropDownOpened&&(this.closeDropDown(),this.dropDownOpened=!1)}}}),define("impl/pie_chart/map_pie_chart_container",["require","exports","math_utils","impl/pie_chart/map_pie_chart","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapPieChartContainer=class{constructor(e){this.oldChecksum=0;const{settings:t,model:n,widgetId:r,container:o,zoomToCoordinates:a,colorChoroplethEvent:l,onLegendRangesUpdates:c,dispatchChangeEvent:d,getPixelFromCoordinate:h}=e;this.settings=t,this.model=n,this.chart=new s.MapPieChart({size:new i.Vector2D(t.dimensions.width,t.dimensions.height),position:new i.Vector2D(t.dimensions.x,t.dimensions.y),model:n,id:r},{containerSpan:o,resolutionScale:1,initialAnimationEnabled:1===t.animationStrategy,initialAnimationDuration:t.animationDuration,numberFormatter:t.style.formatting.numberFormatter,zoomToCoordinates:a,colorChoroplethEvent:l,onLegendRangesUpdates:c,getPixelFromCoordinate:h,fps:1e3}),this.chart.initialize(),this.chart.onAfterDraw.subscribe(()=>d())}dispose(){this.chart.dispose()}get drawCanvas(){return this.chart.drawCanvas}async updatePositions(){return await this.draw(),this}async updateAndDraw(e){return this.oldChecksum!==e.checkSum?(this.oldChecksum=e.checkSum,this.model=e,await this.draw()):await this.updatePositions(),this}async draw(){return void 0!==this.model&&(this.chart.update({size:new i.Vector2D(this.settings.dimensions.width,this.settings.dimensions.height),position:new i.Vector2D(this.settings.dimensions.x,this.settings.dimensions.y),model:this.model}),await this.chart.onAfterUpdate.subscribeOnceAsPromise(),void 0===this.drawToken&&(this.drawToken=new n.CancellationToken,this.chart.start(this.drawToken)),this.chart.animate(),this.chart.rendering&&await this.chart.afterRenderPromise),this}}}),define("impl/ol_layer_pie_chart",["require","exports","event","log","openlayers","reusable_utilities","api/abstract_layer_wrapper","api/layer_factory","api/open_layers_log_feature","impl/constants_ol_map","impl/ol_utils","impl/pie_chart/map_pie_chart_container","impl/pie_chart/map_pie_chart_model"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerPieChart=class extends o.AbstractLayerWrapper{constructor(e){super(e),this.emptyCanvas=document.createElement("canvas"),this.regionMap={},this.init=!0,this.intFeatures=[],this.initialAnimationDoneEvent=new i.Event,this.token=new r.CancellationToken,this.token.createChannel("drawCanvas")}async preCreate(e){await super.preCreate(e),this.initialRenderPromise=this.initialAnimationDoneEvent.subscribeOnceAsPromise(),this.options.onAfterLegendUpdate&&this.options.onAfterLegendUpdate.subscribeOnceAsPromise().then(()=>{setTimeout(()=>this.initialAnimationDoneEvent.fire(),this.settings.animationDuration)})}async createLayerInternal(){return this.regionMap=this.options.getMapWrapper().clusterConfig.features.reduce((e,t)=>(e[t.properties.region_id]=t,e),{}),new n.layer.Image({source:new n.source.ImageCanvas({canvasFunction:this.draw.bind(this),projection:c.ConstantsOlMap.FEATURE_PROJECTION,ratio:1}),zIndex:a.LayerFactory.zIndexes.osm})}draw(e,t,i,n,o){return this.size=n,void 0===this.pieChartcontainer?this.setUpPieCanvas():this.init?this.init=!1:(void 0!==this.zoomTimeoutId&&clearTimeout(this.zoomTimeoutId),r.PromiseUtils.conditionalAwait(()=>void 0!==this.options.getMapWrapper()&&void 0!==this.options.getMapWrapper().map,[async()=>{this.chartModel=await this.prepareChartModel()},async()=>{await this.pieChartcontainer.updateAndDraw(this.chartModel)}]).catch(e=>s.logService.debug("Map was disposed while pieChart container was updating",l.openLayersLogFeature,e))),this.emptyCanvas}setUpPieCanvas(){const e=this.options.getMapWrapper(),t=document.createElement("canvas"),i=t.getContext("2d"),s=document.createElement("span");this.prepareChartModel().then(n=>{let r;this.chartModel=n,this.pieChartcontainer=new h.MapPieChartContainer({settings:this.settings,model:this.chartModel,container:s,dispatchChangeEvent:()=>this.drawToVisibleCanvas(i,r),zoomToCoordinates:this.options.zoomToCoordinates,colorChoroplethEvent:this.options.colorChoroplethEvent,onLegendRangesUpdates:this.options.onLegendRangesUpdates,widgetId:this.options.widgetId,getPixelFromCoordinate:t=>e.map.getPixelFromCoordinate(t)}),r=this.pieChartcontainer.drawCanvas,this.token.cancelChannel("drawCanvas"),this.token.createChannel("drawCanvas"),this.token.getChannel("drawCanvas").addDomEvent(r,"mousemove.mapMove",()=>this.postRenderHandler()),this.pieChartcontainer.draw(),this.overlayCanvases(e.map.getViewport(),t,r),this.postRenderSub&&e.map.un("postrender",this.postRenderSub)}),this.postRenderSub=(()=>{e.map&&(void 0!==this.oldZoom&&this.oldZoom!==e.map.getView().getZoom()&&(void 0!==this.zoomTimeoutId&&clearTimeout(this.zoomTimeoutId),this.zoomTimeoutId=setTimeout(()=>{void 0!==this.chartModel&&this.chartModel.updateCheckSum(e.map.getView().getZoom()),this.postRenderHandler()},50)),this.postRenderHandler())}),this.listenerKeys.push(e.map.on("postrender",this.postRenderSub.bind(this))),this.options.groupingChanged.subscribe(()=>{this.prepareChartModel().then(e=>{this.chartModel=e,this.pieChartcontainer.updateAndDraw(this.chartModel)})})}overlayCanvases(e,t,i){const s=$(e),n=$(t),r=$(i);return n.addClass("open-layers-map-pie-overlay"),r.addClass("open-layers-map-pie-overlay").addClass("open-layers-map-pie-draw-canvas"),s.addClass("open-layers-map-column"),n.prependTo(s),r.prependTo(s),n}postRenderHandler(){const e=this.options.getMapWrapper();void 0===this.oldZoom&&(this.oldZoom=e.map.getView().getZoom(),this.oldCenter=e.map.getView().getCenter());const t=e.map.getView().getZoom(),i=e.map.getView().getCenter();this.oldZoom===t&&this.oldCenter[0]===i[0]&&this.oldCenter[1]===i[1]||(this.oldZoom=t,this.oldCenter=i,this.pieChartcontainer&&this.pieChartcontainer.updatePositions())}drawToVisibleCanvas(e,t){e.canvas.width=t.width,e.canvas.height=t.height,e.save(),e.clearRect(0,0,this.size[0],this.size[1]),e.drawImage(t,0,0),e.restore()}async prepareChartModel(){const e=this.options.getMapWrapper(),t=await e.controller.fetchData();this.intFeatures=this.transformFeatures(t.features);const i=d.OlUtils.sortFeaturesWithSlicesByResult(this.intFeatures);return(new n.format.GeoJSON).readFeatures(t,{dataProjection:c.ConstantsOlMap.DATA_PROJECTION,featureProjection:c.ConstantsOlMap.FEATURE_PROJECTION}).forEach(e=>{const t=e.getId();i.find(e=>e.id===t).properties.olFeature=e}),new u.MapPieChartModel(i,e.map.getView().getZoom(),this.size,this.options.grouping(),this.getClusterLevel(),this.regionMap,e.controller.initialData.payload.bucketColors)}transformFeatures(e){const t=this.options.getMapWrapper(),i=t.map.getView(),s=n.proj.toLonLat(i.getCenter()),r=Math.floor((s[0]+180)/360);return e.map(e=>{const s=i.calculateExtent(t.map.getSize()),[o,a]=n.proj.toLonLat([s[0],s[1]]),[l,c]=n.proj.toLonLat([s[2],s[3]]),d=[o,a,l,c];return n.extent.containsCoordinate(d,[e.geometry.coordinates[0],e.geometry.coordinates[1]])||(e.geometry.coordinates[0]=e.geometry.coordinates[0]+360*r,e.geometry.coordinates[0]>d[2]?e.geometry.coordinates[0]=e.geometry.coordinates[0]-360:e.geometry.coordinates[0]<d[0]&&(e.geometry.coordinates[0]=e.geometry.coordinates[0]+360)),e}),e}getClusterLevel(){switch(this.options.getMapWrapper().map.getView().getZoom()){case 0:case 1:return"Continent";case 2:case 3:case 4:return"Country";default:return"Region"}}get features(){return this.intFeatures}dispose(){super.dispose(),this.token.cancel(),void 0!==this.zoomTimeoutId&&clearTimeout(this.zoomTimeoutId),this.pieChartcontainer.dispose(),this.initialAnimationDoneEvent&&this.initialAnimationDoneEvent.cancelAll()}}}),define("api/layer_factory",["require","exports","event","impl/ol_layer_dot_density","impl/ol_layer_heat_map","impl/ol_layer_choropleth","impl/ol_layer_osm","impl/ol_layer_pie_chart","api/open_layers_initial_data"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class c{constructor(e){this.options=e,this.grouping=!0,this.onAfterLegendUpdate=new i.Event}createPreviewWrapper(e,t,i){return e===l.OpenLayersMapType.CHOROPLETH?new r.OlLayerChoropleth({fetchFunctions:[this.options.fetchPreview,this.options.fetchData],setNumberOfResultsFun:t,onLegendRangesUpdates:this.options.onLegendRangesUpdates,onAfterLegendUpdate:this.onAfterLegendUpdate,getMapWrapper:this.options.getMapWrapper}):new o.OlLayerOSM({fetchFunctions:[],tileServerLang:this.options.tileServerLang})}createLayerWrapper(e,t,i){const o=[];switch(e){case l.OpenLayersMapType.PIE_CHART:o.push(new a.OlLayerPieChart({fetchFunctions:[this.options.fetchData],setNumberOfResultsFun:t,onLegendRangesUpdates:this.options.onLegendRangesUpdates,onAfterLegendUpdate:this.onAfterLegendUpdate,getMapWrapper:this.options.getMapWrapper,groupingChanged:this.options.groupingChanged,grouping:()=>this.grouping,colorChoroplethEvent:this.options.colorChoroplethEvent,zoomToCoordinates:this.options.zoomToCoordinates,widgetId:this.options.widgetId})),o.push(new r.OlLayerChoropleth({fetchFunctions:[this.options.fetchHighlights],setNumberOfResultsFun:t,onLegendRangesUpdates:this.options.onLegendRangesUpdates,onAfterLegendUpdate:this.onAfterLegendUpdate,getMapWrapper:this.options.getMapWrapper,highlightOnly:!0,colorChoroplethEvent:this.options.colorChoroplethEvent}));break;case l.OpenLayersMapType.DOT_DENSITY:o.push(new s.OlLayerDotDensity({fetchFunctions:[this.options.fetchData],setNumberOfResultsFun:t,getMapWrapper:this.options.getMapWrapper,onAfterLegendUpdate:this.onAfterLegendUpdate,removeFeaturesBeforeRefresh:!0}));break;case l.OpenLayersMapType.HEAT:o.push(new n.OlLayerHeatMap({fetchFunctions:[this.options.fetchData],setNumberOfResultsFun:t,getMapWrapper:this.options.getMapWrapper,onAfterLegendUpdate:this.onAfterLegendUpdate,removeFeaturesBeforeRefresh:!0}));break;case l.OpenLayersMapType.EMOJI:case l.OpenLayersMapType.CHOROPLETH:break;default:throw new Error("Unknown map type!")}return o}toggleGroupingHandler(e){this.grouping=void 0!==e?e:!this.grouping,this.options.groupingChanged.fire(e)}}c.zIndexes={osm:0,choroplethPreview:1,choroplethData:2,data:3,draw:4},t.LayerFactory=c}),define("api/refresh_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/abstract_map",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractMap=class{constructor(){this.intCancellationToken=void 0,this.model=void 0,this.intDrawSettings=void 0,this.intClusterConfig=void 0,this.intController=void 0,this.intChoroplethPreview=void 0}initialize(e,t,s,n){this.intCancellationToken=new i.CancellationToken,this.model=e,this.intController=t,this.intDrawSettings=n,this.intClusterConfig=s}dispose(){this.intCancellationToken&&this.intCancellationToken.cancel(),this.disposeMap()}get cancellationToken(){return this.intCancellationToken}set cancellationToken(e){this.intCancellationToken=e}get drawSettings(){return this.intDrawSettings}get choroplethPreview(){return this.intChoroplethPreview}get controller(){return this.intController}get clusterConfig(){return this.intClusterConfig}}}),define("impl/ol_layer_draw_filter",["require","exports","openlayers","api/layer_factory"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlLayerDrawFilter=class{constructor(){this.style=new i.style.Style({}),this.source=new i.source.Vector({wrapX:!1})}getLayer(){return this.intLayer=new i.layer.Vector({source:this.source,style:this.style,zIndex:s.LayerFactory.zIndexes.draw})}get layer(){return this.intLayer}set layer(e){this.intLayer=e}}}),define("api/view_wrapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/ol_view",["require","exports","impl/constants_ol_map","impl/ol_utils","openlayers"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OlView=class{constructor(e){const{width:t,maxZoom:r=12,lat:o=0,lon:a=0,zoom:l=0,extent:c}=e,d=s.OlUtils.transformDataCoordToFeatureCoord([a,o]);this.intView=new n.View({center:d,zoom:l,projection:i.ConstantsOlMap.FEATURE_PROJECTION,maxResolution:1057/t*40166,maxZoom:r}),c&&(this.intView.fit(c),this.intView.setZoom(l))}get view(){return this.intView}}}),define("impl/react_components/control_headline",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlHeadline=class extends s.BaseComponent{constructor(){super(...arguments),this.controlHeadLineClass="ol-control-headline",this.titleClass="title",this.cancelButtonClass="cancel fa fa-times clickable"}render(){return i.createElement("li",{className:this.controlHeadLineClass},i.createElement("span",{className:this.titleClass},this.props.messages.title),i.createElement("span",{className:this.cancelButtonClass,onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.props.cancelClickHandler()}}))}}}),define("impl/react_components/control_top_results",["require","exports","react","flux","impl/react_components/control_headline","openlayers","impl/constants_ol_map","impl/ol_utils"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlTopResults=class extends s.BaseComponent{constructor(e){super(e),this.resultsContainerClass="results-container",this.resultsDisplayClass="results-display",this.hiddenClass=" hidden",this.controlListItemClass="control",this.crossHairItemClass="button fa fa-crosshairs clickable",this.menuItemClass="button fa fa-bars clickable",this.controlNameClass="state",this.controlValueClass="result",this.wrapperClass="",this.iconWrapperClass="icon-wrapper",this.wrapperId="top-results-control-wrapper",this.activatedControlClass=" activated",this.numberOfTopResults=10,this.buttonRef=void 0,this.displayRef=void 0,this.rootRef=void 0,this.state={hidden:!0}}render(){const{hidden:e}=this.props;return i.createElement("div",{className:this.resultsContainerClass},i.createElement("div",{className:this.wrapperClass.concat(e?"":this.activatedControlClass),id:this.wrapperId},i.createElement("button",{ref:e=>this.buttonRef=e,className:this.crossHairItemClass,onClick:t=>{t.preventDefault(),this.props.toggleTopResults(!e)}})),i.createElement("div",{ref:e=>this.displayRef=e,className:this.resultsDisplayClass.concat(e?this.hiddenClass:"")},i.createElement(n.ControlHeadline,{messages:{title:this.props.messages.controlHeadline},cancelClickHandler:()=>this.props.toggleTopResults(!0)}),this.props.features.filter(e=>"unavailable"!==e.properties.id).slice(0,this.maxNumberOfTopResults).map(e=>this.transformFeatureToTopResult(e)).map(e=>this.createTopResultListItem(e))))}componentDidUpdate(){}transformFeatureToTopResult(e){const{DATA_PROJECTION:t,FEATURE_PROJECTION:i}=o.ConstantsOlMap,s=e.id,{label:n,result:l,filters:c,zoom:d}=e.properties,h=(new r.format.GeoJSON).readFeature(e,{dataProjection:t,featureProjection:i}).getGeometry(),u=this.props.useGeometryCoordinatesForTopResults?h.getCoordinates():a.OlUtils.transformDataCoordToFeatureCoord(e.properties.coordinate.coordinates);return{name:n,value:l,lon:u[0],lat:u[1],filters:c,zoom:d,id:s}}createTopResultListItem(e){return i.createElement("div",{ref:e=>this.rootRef=e,className:this.controlListItemClass,key:e.id},i.createElement("span",{className:this.iconWrapperClass},i.createElement("i",{className:this.crossHairItemClass,onClick:t=>{t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),this.props.panToLocation(e.lon,e.lat,e.zoom,e.id)}})),i.createElement("span",{className:this.iconWrapperClass},i.createElement("i",{className:this.menuItemClass,onClick:t=>{t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),this.openTopResultDrilldown(t,e)}})),i.createElement("span",{className:this.controlNameClass},e.name),i.createElement("span",{className:this.controlValueClass},e.value))}get maxNumberOfTopResults(){return this.numberOfTopResults}openTopResultDrilldown(e,t){this.props.map.controller.show.featureDetails(e,t.filters)}get button(){return this.buttonRef}get display(){return this.displayRef}get root(){return this.rootRef}}}),define("impl/react_components/control_activate_draw_filter",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlActivateDrawFilter=class extends s.BaseComponent{constructor(e){super(e),this.controlContainerClass=" ol-control draw-filter-control-container",this.disabledControlClass=" disabled-control",this.activatedControlClass=" activated",this.rootRef=void 0,this.buttonRef=void 0,this.clickHandler=(e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const{toggle:t,on:i}=this.props;t(!i)})}render(){const{on:e}=this.props;let t=this.controlContainerClass;t=t.concat(e?"":this.disabledControlClass);const s="button fa fa-crop clickable ".concat(e?this.activatedControlClass:"");return i.createElement("div",{ref:e=>this.rootRef=e,className:t,onClick:this.clickHandler,id:"draw-filter-control"},i.createElement("button",{ref:e=>this.buttonRef=e,className:s}))}get button(){return this.buttonRef}get root(){return this.rootRef}}}),define("impl/react_components/attribution_osm",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AttributionOSM=class extends s.BaseComponent{render(){return i.createElement("span",null,"",i.createElement("a",{href:"https://www.openstreetmap.org/copyright"},"OpenStreetMap")," contributors")}}}),define("impl/react_components/attribution_omt",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AttributionOMT=class extends s.BaseComponent{render(){return i.createElement("span",null,"",i.createElement("a",{href:"https://openmaptiles.org/?_ga=2.111050060.85525219.1528357067-427132292.1528357067"},"OpenMapTiles"))}}}),define("impl/react_components/attribution_container",["require","exports","react","flux","impl/react_components/attribution_osm","impl/react_components/attribution_omt"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AttributionContainer=class extends s.BaseComponent{constructor(){super(...arguments),this.attributionContainerClass="attribution-container",this.attributionClass="attribution"}render(){return i.createElement("div",{className:this.attributionContainerClass},i.createElement("div",{className:this.attributionClass},i.createElement(n.AttributionOSM,null)),i.createElement("div",{className:this.attributionClass},i.createElement(r.AttributionOMT,null)))}}}),define("impl/react_components/control_top_left",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlTopLeft=class extends s.BaseComponent{constructor(e){super(e),this.controlContainerClass="control-top-left",this.intRootRef=void 0}render(){return i.createElement("div",{ref:e=>this.intRootRef=e,className:this.controlContainerClass},this.props.children)}get rootRef(){return this.intRootRef}}}),define("impl/react_components/control_zoom",["require","exports","react","flux","reusable_components"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ControlZoom=class extends s.BaseComponent{constructor(e){super(e),this.controlContainerClass=" zoom-control-container",this.zoomInClass=" zoom-in clickable",this.zoomOutClass=" zoom-out clickable",this.plusButtonRef=void 0,this.minusButtonRef=void 0,this.sliderRef=void 0,this.rootRef=void 0}render(){const{zoomHandler:e}=this.props;return i.createElement("div",{ref:e=>this.rootRef=e,className:this.controlContainerClass},i.createElement("div",{ref:e=>this.plusButtonRef=e,className:this.zoomInClass,onClick:t=>{t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e(!1)}},"+"),this.props.sliderOpen&&i.createElement(n.RangeSliderComponent,Object.assign({ref:e=>this.sliderRef=e},this.props.rangeSliderProps)),i.createElement("div",{ref:e=>this.minusButtonRef=e,className:this.zoomOutClass.concat(this.props.sliderOpen?"":" no-slider"),onClick:t=>{t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),t.nativeEvent.stopImmediatePropagation(),e(!0)}},"-"))}get plusButton(){return this.plusButtonRef}get minusButton(){return this.minusButtonRef}get slider(){return this.sliderRef}get root(){return this.rootRef}}}),define("impl/react_components/map_react_wrapper",["require","exports","react","flux","impl/react_components/control_top_results","impl/react_components/control_activate_draw_filter","impl/react_components/control_grouping_and_result","impl/react_components/attribution_container","impl/react_components/control_top_left","impl/react_components/control_zoom"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapReactControlWrapper=class extends s.BaseComponent{constructor(e){super(e),this.controlGroupingAndResult=void 0,this.zoomLevelChangedChannelId="zoomLevel",this.zoomLevelChangedChannelToken=void 0,this.shouldShowImpreciseLocationChangedChannelToken=void 0,this.numberOfResults=0,this.controlTopResultsRef=void 0,this.controlZoomRef=void 0,this.controlActivateDrawFilterRef=void 0,this.toggleTopResults=(e=>{this.setState({topResults:{hidden:e}})}),this.openSlider=(e=>{this.setState({zoom:{sliderOpen:e,showZoomSlider:this.state.zoom.showZoomSlider}})}),this.setControlHoverstate=(e=>{if(void 0!==e){const{condition:t,state:i}=e;void 0!==t?t&&(this.props.containingMap.controlsHovered=i):this.props.containingMap.controlsHovered=i}}),this.rangeSliderHandler=_.debounce(e=>{this.props.eventHandler.zoom.zoomSliderHandler(parseFloat(e.target.value))},300),this.toggleMenuHandler=(()=>{this.setState({menuOpen:!this.state.menuOpen})}),this.initZoomLevelToken(),this.state={zoom:{sliderOpen:!0,showZoomSlider:e.showZoomSlider},topResults:{hidden:!0},drawFilters:{on:void 0!==e.widgetInfo.isCropped&&e.widgetInfo.isCropped()},payloadData:e.containingMap.controller.initialData.payload.data,numberOfResults:0,currentZoomLevel:e.currentZoomLevel,shouldShowImpreciseLocationsMessage:e.widgetInfo.shouldShowImpreciseLocationsMessage,menuOpen:!1,showControls:e.showControls}}componentWillReceiveProps(e){this.props.zoomLevelChangedEvent!==e.zoomLevelChangedEvent&&(this.zoomLevelChangedChannelToken.cancel(),this.initZoomLevelToken()),this.props.shouldShowImpreciseLocationsStateEvent&&(this.shouldShowImpreciseLocationChangedChannelToken.cancel(),this.initImpreciseLocationToken())}initZoomLevelToken(){this.zoomLevelChangedChannelToken=this.cancellationToken.getChannel(this.zoomLevelChangedChannelId),this.zoomLevelChangedChannelToken.subscribe(this.props.shouldShowImpreciseLocationsStateEvent,e=>this.setState({shouldShowImpreciseLocationsMessage:e}))}initImpreciseLocationToken(){this.shouldShowImpreciseLocationChangedChannelToken=this.cancellationToken.getChannel(this.zoomLevelChangedChannelId),this.shouldShowImpreciseLocationChangedChannelToken.subscribe(this.props.zoomLevelChangedEvent,e=>this.updateCurrentZoomLevel(e))}updateCurrentZoomLevel(e){switch(e){case 0:case 1:case 2:case 3:case 4:this.setState({currentZoomLevel:"country"});break;case 5:case 6:case 7:case 8:this.setState({currentZoomLevel:"region"});break;default:this.setState({currentZoomLevel:"coordinate"})}}render(){if(this.state.payloadData){this.numberOfResults=this.state.payloadData.features.map(e=>e.properties.result).reduce((e,t)=>e+t,0);const e=this.props.showGroupingContainer?this.getPieChartControlOptions():this.getBasicChartControlOptions();return i.createElement("div",null,this.state.showControls&&[i.createElement(l.ControlTopLeft,{key:"controlTopLeft"},i.createElement(r.ControlActivateDrawFilter,Object.assign({ref:e=>this.controlActivateDrawFilterRef=e,toggle:()=>{this.state.drawFilters.on?this.props.widgetInfo.isCropped()?this.props.eventHandler.drawFilters.clearCropFilter():this.props.eventHandler.drawFilters.activateDrawFilterClickHandler(!1):this.props.eventHandler.drawFilters.activateDrawFilterClickHandler(!0),this.setState({drawFilters:Object.assign({},this.state.drawFilters,{on:!this.state.drawFilters.on}),topResults:{hidden:!0}})}},this.state.drawFilters)),this.state.payloadData.features&&this.props.showTopResults&&i.createElement(n.ControlTopResults,Object.assign({ref:e=>this.controlTopResultsRef=e},this.props.eventHandler.topResults,{messages:this.props.messages.topResults,hidden:this.state.topResults.hidden,features:this.sortFeatures(this.state.payloadData.features,this.props.removeFeaturesWithEmptySlices),widgetHeight:this.props.widgetInfo.widgetHeight,toggleTopResults:this.toggleTopResults,map:this.props.containingMap,useGeometryCoordinatesForTopResults:this.props.useGeometryCoordinatesForTopResults})),i.createElement(c.ControlZoom,{ref:e=>this.controlZoomRef=e,zoomHandler:this.props.eventHandler.zoom.zoomHandler,sliderOpen:this.state.zoom.sliderOpen&&this.state.zoom.showZoomSlider,openSliderHandler:this.openSlider,rangeSliderProps:this.createRangeSliderProps()})),i.createElement(o.ControlGroupingAndResults,Object.assign({key:"controlGroupingAndResult",ref:e=>this.controlGroupingAndResult=e},e,{numberOfResults:this.numberOfResults}))],i.createElement(a.AttributionContainer,null),this.props.children)}return i.createElement("div",null)}getPieChartControlOptions(){const e=this.getBasicChartControlOptions();return e.showGroupingContainer=!0,e}getBasicChartControlOptions(){const{messages:e,containingMap:t,setGroupingToggleStateEvent:i}=this.props,{currentZoomLevel:s}=this.state,{geodataPrecisionTypesMenu:n,numberFormatter:r,geodataPrecisionTypesSelectionStrategy:o,selectedMetrics:a}=this.props.widgetInfo;return{messages:e.groupingAndResults,geodataPrecisionTypesMenu:n,geodataPrecisionTypesSelectionStrategy:o,toggleGrouping:this.props.eventHandler.groupingAndResults.toggleGroupingHandler.bind(this),containingMap:t,numberFormatter:r,showGroupingContainer:!1,unavailableLocations:this.state.payloadData.features?this.state.payloadData.features.filter(e=>e.properties.location_identifier&&e.properties.location_identifier.subregion&&-1!==e.properties.location_identifier.subregion.indexOf("DBP_UNAVAILABLE_REGION")):void 0,numberOfResults:this.state.numberOfResults,currentZoomLevel:s,selectedMetrics:a,shouldShowImpreciseLocationsMessage:this.state.shouldShowImpreciseLocationsMessage,setGroupingToggleStateEvent:i,menuOpen:this.state.menuOpen,toggleMenu:this.toggleMenuHandler}}sortFeatures(e,t){let i=e;return t&&(i=i.filter(e=>e.properties.slices)),i.sort((e,t)=>t.properties.result-e.properties.result)}showLoadingSpinner(){this.controlGroupingAndResult&&this.controlGroupingAndResult.showLoadingSpinner()}hideLoadingSpinner(){this.controlGroupingAndResult&&this.controlGroupingAndResult.hideLoadingSpinner()}disable(){this.controlGroupingAndResult&&this.controlGroupingAndResult.disable()}enable(){this.controlGroupingAndResult&&this.controlGroupingAndResult.enable()}componentDidMount(){this.controlTopResultsRef&&this.controlTopResultsRef.button&&(this.cancelEventsWithDefaultBehaviour(this.controlTopResultsRef.button),this.cancelEventsWithDefaultBehaviour(this.controlTopResultsRef.display,!this.state.topResults.hidden)),this.controlActivateDrawFilterRef&&this.controlActivateDrawFilterRef.button&&this.cancelEventsWithDefaultBehaviour(this.controlActivateDrawFilterRef.button),this.controlGroupingAndResult&&this.controlGroupingAndResult.rootRef&&this.cancelEventsWithDefaultBehaviour(this.controlGroupingAndResult.rootRef),this.controlZoomRef&&this.controlZoomRef.slider&&(this.cancelEventsWithDefaultBehaviour(this.controlZoomRef.plusButton),this.cancelEventsWithDefaultBehaviour(this.controlZoomRef.minusButton),this.cancelEventsWithDefaultBehaviour(this.controlZoomRef.slider.input))}cancelEventsWithDefaultBehaviour(e,t){this.cancelEventsOnControl(e,[{eventName:"pointermove"},{eventName:"mouseover",setControlHoverstate:{state:!0,condition:t}},{eventName:"pointerdown",setControlHoverstate:{state:!1}},{eventName:"mouseout",setControlHoverstate:{state:!1}}])}cancelEventsOnControl(e,t){t.forEach(t=>{const{eventName:i,setControlHoverstate:s}=t;switch(i){case"pointermove":e.onpointermove=(e=>{e.stopPropagation(),e.stopImmediatePropagation(),this.setControlHoverstate(s)});break;case"mouseover":e.onmouseover=(e=>{e.stopPropagation(),e.stopImmediatePropagation(),this.setControlHoverstate(s)});break;case"pointerdown":e.onpointerdown=(e=>{e.stopPropagation(),e.stopImmediatePropagation(),this.setControlHoverstate(s)});break;case"mouseout":e.onmouseout=(e=>{e.stopPropagation(),e.stopImmediatePropagation(),this.setControlHoverstate(s)})}})}createRangeSliderProps(){const e=this.props.containingMap.map,t={className:"zoom-slider",min:0,max:12,value:0,onChange:this.rangeSliderHandler,vertical:!0,showLabels:!1,updateValueEvent:this.props.updateZoomSliderEvent},i={};if(e){const t=e.getView();i.min=t.getMinZoom(),i.max=t.getMaxZoom(),i.value=t.getZoom()}return Object.assign({},t,i)}}}),define("impl/ol_map",["require","exports","event","event_bus","log","openlayers","react","react-dom","reusable_utilities","api/layer_factory","api/open_layers_initial_data","api/open_layers_log_feature","impl/abstract_map","impl/ol_layer_draw_filter","impl/ol_utils","impl/ol_view","impl/react_components/map_react_wrapper"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=r.proj.toLonLat,b=r.extent.getBottomLeft,E=r.extent.getTopRight;class S extends u.AbstractMap{constructor(){super(),this.intActiveLayerWrapper=[],this.intMap=void 0,this.mapId=void 0,this.mapType=void 0,this.intNumberOfResults=void 0,this.controlGroups=void 0,this.intControlsHovered=!1,this.mapNode=void 0,this.controlNode=void 0,this.drawFilterLayer=(new p.OlLayerDrawFilter).getLayer(),this.drawInteraction=new r.interaction.Draw({source:this.drawFilterLayer.getSource(),type:"Circle",geometryFunction:r.interaction.Draw.createBox()}),this.listenerKeys=[],this.ANIMATION_DURATION=500,this.PREVIEW_LAYER_INDEX=0,this.layerFactory=void 0,this.colorChoroplethEvent=new i.Event,this.onLegendRangesUpdates=new i.Event,this.groupingChanged=new i.Event,this.zoomLevelChangedEvent=new i.Event,this.initialCall=!0,this.pageStateRefreshChannelId="page-state-refresh",this.zoomSliderHandler=(e=>{this.map.getView().animate({zoom:e,duration:this.ANIMATION_DURATION})}),this.activateDrawFilterClickHandler=(async e=>{this.map&&(e?(this.map.addLayer(this.drawFilterLayer),this.map.addInteraction(this.drawInteraction)):(this.map.removeLayer(this.drawFilterLayer),this.map.removeInteraction(this.drawInteraction),await this.refreshAllLayers()))}),this.moveendHandler=_.debounce(async e=>{try{if(this.initialCall)this.initialCall=!1;else{const t=e.map.getView().getZoom();await this.refreshData({newZoom:t})}}catch(e){console.error(e)}},1e3),this.resolutionChangeHandler=(async e=>{switch(e.key){case"resolution":this.zoomLevelChangedEvent.fire(e.target.getZoom())}}),this.onLegendRangesUpdates.subscribe(e=>this.controller.onLegendRangesUpdates.fire(e))}async render(e,t){this.mapId=e,this.intDrawSettings=t;const{getMapType:i}=this.controller.initialData;this.layerFactory=this.createLayerFactory(),this.initDrawInteraction(),this.resetMap(),this.intActiveLayerWrapper=this.createActiveLayerWrapper(i()),this.intMap=await this.createMapWithPreviewLayer(),await this.setViewWithOptionsFromExtendedConfig({initial:!0}),this.map.setSize([this.drawSettings.dimensions.width,this.drawSettings.dimensions.height]),this.controller.skipDataLoading=!1,await this.addNonPreviewLayers(),this.renderReactControls(),this.listenerKeys.push(this.intMap.on("moveend",async e=>this.moveendHandler(e))),this.listenerKeys.push(this.intMap.getView().on("change:resolution",async e=>this.resolutionChangeHandler(e))),this.setUpEventListener(),this.controller.initCountryPopups(this.mapId),await Promise.all(this.intActiveLayerWrapper.filter(e=>e.initialRenderPromise).map(({initialRenderPromise:e})=>e))}createLayerFactory(){return new c.LayerFactory({colorChoroplethEvent:this.colorChoroplethEvent,groupingChanged:this.groupingChanged,onLegendRangesUpdates:this.onLegendRangesUpdates,fetchPreview:this.controller.fetchChoroplethPreview.bind(this.controller),fetchHighlights:this.controller.fetchHighlights.bind(this.controller),fetchData:this.controller.fetchData.bind(this.controller),clusterConfig:this.clusterConfig,getMapWrapper:()=>this,zoomToCoordinates:this.zoomToCoordinates.bind(this),widgetId:this.controller.widgetId,tileServerLang:this.controller.tileServerLang})}initDrawInteraction(){this.listenerKeys.push(this.drawInteraction.on("drawend",async e=>this.drawendHandler(e)))}createActiveLayerWrapper(e){return[].concat(this.layerFactory.createPreviewWrapper(e,this.setNumberOfResults.bind(this),this.drawSettings),...this.layerFactory.createLayerWrapper(e,this.setNumberOfResults.bind(this),this.drawSettings)).filter(e=>e)}async update(e){this.map&&(await this.refreshAllLayers(),await this.setViewWithOptionsFromExtendedConfig({initial:!1}),this.controlGroups.setState({showControls:e}))}isInitialized(){return this.intActiveLayerWrapper&&this.intActiveLayerWrapper.length>0}async refreshAllLayers(e){await Promise.all(this.intActiveLayerWrapper.filter(e=>e).map(t=>t.refresh({merge:!0,settings:this.drawSettings,forceClear:e})))}async setViewWithOptionsFromExtendedConfig(e){const t=await this.controller.getViewOptions(),{extent:i}=t;i&&(e.initial?this.map.getView().fit(i,{nearest:!0}):this.map.getView().fit(i,{duration:this.ANIMATION_DURATION,nearest:!0}))}getPixelFromCoordinate(e){return this.map.getPixelFromCoordinate(e)}getFeaturesAtPixel(e){return this.map.getFeaturesAtPixel(e)}on(e,t,i){return this.map.on(e,t,i)}disposeMap(){this.map&&(this.removeEventListeners(),void 0!==this.controlNode&&a.unmountComponentAtNode(this.controlNode),void 0!==this.mapNode&&a.unmountComponentAtNode(this.mapNode),this.listenerKeys.forEach(e=>r.Observable.unByKey(e)),this.intActiveLayerWrapper.forEach(e=>e.dispose()),this.intActiveLayerWrapper.fill(void 0),this.intMap.setTarget(null),this.intMap=null),this.onLegendRangesUpdates.cancelAll(),this.colorChoroplethEvent.cancelAll(),this.groupingChanged.cancelAll(),this.zoomLevelChangedEvent.cancelAll(),this.cancellationToken.cancel()}setUpEventListener(){this.intActiveLayerWrapper.forEach(e=>{e.initMapListener(),e.initEventListeners(this.intCancellationToken)});let e=this.cancellationToken.getChannel(this.pageStateRefreshChannelId);(e=e?this.cancellationToken.cancelAndRecreateChannel(this.pageStateRefreshChannelId):this.cancellationToken.createChannel(this.pageStateRefreshChannelId)).subscribeToStream(s.eventBus,s.EVENT_TYPES.PAGESTATE_REFRESH,async()=>{try{this.controlGroups&&this.controlGroups.setState({drawFilters:{on:this.controller.widgetInfo.isCropped()}}),await this.refreshAllLayers(!0);const{extent:t}=await l.PromiseUtils.cancellationPromise(this.controller.getViewOptions(),e);t&&this.intMap&&this.intMap.getView().fit(t,{nearest:!0,duration:this.ANIMATION_DURATION})}catch(e){if(!e.isCancelled)throw e}})}removeEventListeners(){const e=$(this.getMapTarget()).find(".ol-viewport");if(e&&e.get(0)){const t=e.get(0),i=t.ol_lm;void 0!==i&&Object.keys(i).forEach(e=>{const s=i[e];s&&s.length>0&&(s.forEach(i=>{t.removeEventListener(e,i)}),i[e]=void 0)})}}resetMap(){void 0!==this.intMap&&(this.removeEventListeners(),this.intMap.setTarget(null),this.intMap=null)}async createMapWithPreviewLayer(e){return this.createMap(await this.intActiveLayerWrapper[this.PREVIEW_LAYER_INDEX].createLayer({previewData:e?e.data:void 0,settings:this.drawSettings}))}createMap(e){return new r.Map({loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,target:this.getMapTarget(),layers:[e],view:new m.OlView({width:this.drawSettings.dimensions.width}).view,controls:r.control.defaults({attribution:!1,zoom:!1}).extend([new r.control.ScaleLine]),interactions:this.model.configuration.disableInteraction?[]:r.interaction.defaults({pinchZoom:!1}).extend([new r.interaction.PinchZoom({constrainResolution:!0})])})}async addNonPreviewLayers(){this.mapType===d.OpenLayersMapType.CHOROPLETH?await this.intActiveLayerWrapper[0].refresh({merge:!0,settings:this.drawSettings,forceClear:!1}):this.intActiveLayerWrapper.slice(1).map(e=>e.createLayer({settings:this.drawSettings}).then(e=>this.map.addLayer(e)))}renderReactControls(){a.render(this.getMapContainer(),this.getOpenlayersControlOverlay())}findMapTargetByJQuery(){return $(".ol-map").filter(function(){return 0===$(this).parents(".grid-preview-clone").length}).filter(`#${this.mapId}`)}getMapTarget(){return this.mapNode=this.findMapTargetByJQuery().get(0)}getOpenlayersControlOverlay(){return this.controlNode=this.findMapTargetByJQuery().find(".ol-overlaycontainer").get(0),void 0===this.controlNode?this.getOpenlayersControlOverlay():this.controlNode}setNumberOfResults(e){this.intNumberOfResults=e}async refreshData(e){await l.PromiseUtils.conditionalAwait(()=>void 0!==this.intMap,[async()=>this.toggleControlgroups(!1),async()=>this.calculateAndSetExtendedConfigExtent(e.newZoom?e.newZoom:this.intMap.getView().getZoom()),async()=>{e.query&&await this.controller.applyDataGraphFilters([].concat({QUERY:[].concat(e.query.query)}))},async()=>await this.refreshAllLayers(),async()=>this.controller.fetchData().then(e=>{n.logService.info(`Fetched data from server: ${e}. Number of features: ${e.features.length}. Number of results: ${e.features.map(e=>e.properties.result).reduce((e,t)=>e+t,0)}`,this.controller.logFeature),this.toggleControlgroups(!0,e),this.controller.updateCountryPopups(e.features)})]).catch(e=>n.logService.debug("Map was disposed while pieChart container was updating",h.openLayersLogFeature,e))}async toggleControlgroups(e,t){e?this.controlGroups&&(this.controlGroups.setState({payloadData:t||await this.controller.fetchData()}),this.controlGroups.enable(),this.controlGroups.hideLoadingSpinner()):this.controlGroups&&(this.controlGroups.disable(),this.controlGroups.showLoadingSpinner())}calculateAndSetExtendedConfigExtent(e){const t=this.map.getView().calculateExtent(this.map.getSize()),i=y(this.map.getView().getCenter()),s=this.normalizeLongitude(i[0]),n=i[1],r=y(b(t)),o=y(E(t));let a=this.normalizeLongitude(o[0]),l=this.normalizeLongitude(r[0]);this.isViewCrossingLine(a,l,s)&&(a=180,l=-180);const c=o[1],d=r[1];this.controller.setExtendedConfigurationExtent({centerLonLat:[s,n],zoomLevel:e,topRightLonLat:[a,c],bottomLeftLonLat:[l,d]})}normalizeLongitude(e){return e-360*Math.floor((e+180)/360)}isViewCrossingLine(e,t,i){return e<i||t>i}getMapContainer(){const{show:e,results:t,groupBubbles:i,groupBubblesOn:s,groupBubblesOff:n,unavailableLocations:r,zoomDesc:a,zoomLevel:l,metrics:c,topResultsControlHeadline:d,showImpreciseLocationsMessage:h}=this.model.messages,{selectedMetrics:u}=this.controller.widgetInfo;return o.createElement(f.MapReactControlWrapper,{ref:e=>this.controlGroups=e,messages:{topResults:{controlHeadline:d},groupingAndResults:{show:e,results:t,groupBubbles:i,groupBubblesOn:s,groupBubblesOff:n,unavailableLocations:r,zoomDesc:a,zoomLevel:l,metrics:c,showImpreciseLocationsMessage:h}},eventHandler:{topResults:{panToLocation:this.panTo.bind(this)},drawFilters:{activateDrawFilterClickHandler:this.activateDrawFilterClickHandler,clearCropFilter:this.controller.widgetInfo.clearCropFilter},groupingAndResults:{toggleGroupingHandler:this.layerFactory.toggleGroupingHandler.bind(this.layerFactory)},zoom:{zoomHandler:this.zoomHandler.bind(this),zoomSliderHandler:this.zoomSliderHandler}},widgetInfo:{widgetHeight:this.drawSettings.dimensions.height,numberFormatter:this.drawSettings.style.formatting.numberFormatter,geodataPrecisionTypesMenu:this.model.geodataPrecisionTypesMenu,selectedMetrics:u,isCropped:this.controller.widgetInfo.isCropped,shouldShowImpreciseLocationsMessage:!1,geodataPrecisionTypesSelectionStrategy:this.controller.selectionMenuStrategy},containingMap:this,currentZoomLevel:"country",zoomLevelChangedEvent:this.zoomLevelChangedEvent,setGroupingToggleStateEvent:this.groupingChanged,shouldShowImpreciseLocationsStateEvent:this.controller.showingResultsWithImpreciseLocationUpdate,updateZoomSliderEvent:this.zoomLevelChangedEvent,removeFeaturesWithEmptySlices:this.controller.removeFeaturesWithEmptySlices,showGroupingContainer:this.controller.showGroupingContainer,useGeometryCoordinatesForTopResults:this.controller.useGeometryCoordinatesForTopResults,showTopResults:this.controller.showTopResults,showControls:this.intDrawSettings.style.showWidgetUI&&!this.model.configuration.disableControls,showZoomSlider:this.intDrawSettings.dimensions.height>400})}panTo(e,t,i,s){if(s){const n=this.clusterConfig.features.filter(e=>e.id===s)[0];if(n)if(n.properties.bounding_box){const{southWestCoord:e,northEastCoord:t}=g.OlUtils.extractCoordinatesFromBoundingBox(n.properties.bounding_box),i=r.extent.boundingExtent([e,t]);this.map.getView().fit(i,{duration:this.ANIMATION_DURATION})}else this.animatedPan([e,t],i||6);else this.animatedPan([e,t],i||6)}else this.animatedPan([e,t],i||6);this.layerFactory.toggleGroupingHandler(!1)}animatedPan(e,t){this.map.getView().animate({center:e,zoom:t,duration:this.ANIMATION_DURATION})}zoomHandler(e){const t=this.intMap.getView().getZoom(),i=e?t-1:t+1;this.map.getView().animate({zoom:i,duration:this.ANIMATION_DURATION})}zoomToCoordinates(e){this.animatedPan(e,this.map.getView().getZoom()+1)}async drawendHandler(e){const t=e.feature.getGeometry(),i=t.getCoordinates(),s=g.OlUtils.transformFeatureCoordToDataCoord(i[0][0]),n=g.OlUtils.transformFeatureCoordToDataCoord(i[0][2]),r={query:`sourcegeo:${n[1]},${s[0]};${s[1]},${n[0]}`,query_override:!0,query_pinned:!1,query_pinned_type:"SEARCHBAR"};this.activateDrawFilterClickHandler(!1),await this.refreshData({query:r}),this.map&&this.map.getView().fit(t,{duration:this.ANIMATION_DURATION})}get controlsHovered(){return this.intControlsHovered}set controlsHovered(e){this.intControlsHovered=e}get map(){return this.intMap}get numberOfResults(){return this.intNumberOfResults}}__decorate([l.debounce(300),__metadata("design:type",Function),__metadata("design:paramtypes",[Boolean]),__metadata("design:returntype",Promise)],S.prototype,"refreshAllLayers",null),__decorate([l.throttle(50,{leading:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",HTMLElement)],S.prototype,"getOpenlayersControlOverlay",null),t.OlMap=S}),define("api/map_factory",["require","exports","api/map_type","impl/ol_map"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapFactory=class{static createMap(e){switch(e){case i.MapType.OPEN_LAYERS:return new s.OlMap}}}}),define("impl/geo_json_world_map_fetch_data_param",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("open_layers_map",["require","exports","api/choropleth_show_value","api/map_factory","api/map_type","api/open_layers_initial_data","api/open_layers_log_feature","impl/constants_ol_map","impl/ol_utils","impl/pie_chart/map_pie_chart","impl/pie_chart/map_pie_chart_container","impl/pie_chart/map_pie_chart_model"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";function u(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),u(i),u(s),u(n),u(r),u(o),u(a),u(l),u(c),u(d),u(h)}),define("api/control_wrapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("api/overlay_wrapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("impl/pie_chart/map_pie_chart_drawable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("list/classes/list_paginator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=10;t.ListPaginator=class{constructor(e,t,i,s){this.models=e,this.events=t,this.matchPredicate=i,this.limit=s,this.tablePageNum=1}replaceModels(e){this.models=e,this.getTotalTablePages()<this.tablePageNum&&(this.tablePageNum=this.getTotalTablePages()),void 0!==this.events.onRedraw&&this.events.onRedraw.fire()}canShowTableNavigation(){return this.getTotalTablePages()>1}canShowPreviousTablePage(){return this.tablePageNum>1}canShowNextTablePage(){return this.tablePageNum<this.getTotalTablePages()}showTableStart(){this.tablePageNum=1}showPreviousTablePage(){if(!(this.tablePageNum>1))throw new Error("Attempting to go to previous page of first page");this.tablePageNum--}showNextTablePage(){if(!(this.tablePageNum<this.getTotalTablePages()))throw new Error("Attempting to go to next page of last page");this.tablePageNum++}showTableEnd(){this.tablePageNum=this.getTotalTablePages()}getTotalTablePages(){if(this.hasMatchPredicate()){const e=Math.ceil(this.models.filter(this.matchPredicate).length/this.getLimit());return e>0?e:1}{const e=Math.ceil(this.models.length/this.getLimit());return e>0?e:1}}get pageNum(){return this.tablePageNum}getTablePageModels(){const e=(this.tablePageNum-1)*this.getLimit();let t;return(t=this.hasMatchPredicate()?this.models.filter(this.matchPredicate):this.models).slice(e,e+this.getLimit())}getCurrentStateText(){return this.tablePageNum+" / "+this.getTotalTablePages()}set pageNum(e){if(!(e>0&&e<=this.getTotalTablePages()))throw new Error("Attempting to set current page out of bounds");this.tablePageNum=e}hasMatchPredicate(){return void 0!==this.matchPredicate}getLimit(){return void 0!==this.limit?this.limit:i}}}),define("css/pagination.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paginationStyleModel={pagination:{display:"flex",alignItems:"center",justifyContent:"center","& .pagination-btn":{paddingRight:5,paddingLeft:5,cursor:"pointer"}}},t.paginationStyle=i.createCssModule(()=>t.paginationStyleModel).compute({}).attach().getModule()}),define("list/components/list_pagination_component",["require","exports","flux","react","classnames","css/pagination.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ListPaginationComponent=class extends i.BaseComponent{componentWillMount(){void 0!==this.props.paginator.events.onRedraw&&this.props.paginator.events.onRedraw.subscribe(()=>this.forceUpdate())}render(){if(this.props.paginator.canShowTableNavigation()){const e=n(["pagination",r.paginationStyle.pagination]);return s.createElement("div",{className:e},this.renderStartPageIcon(),this.renderPreviousPageIcon(),this.renderCurrentStateText(),this.renderNextPageIcon(),this.renderEndPageIcon())}return null}renderStartPageIcon(){return this.props.paginator.canShowPreviousTablePage()?s.createElement("span",{onClick:this.showTableStart.bind(this),className:"pagination-btn"},s.createElement("i",{className:"fa fa-angle-double-left"})):null}renderPreviousPageIcon(){return this.props.paginator.canShowPreviousTablePage()?s.createElement("span",{onClick:this.showPreviousTablePage.bind(this),className:"pagination-btn"},s.createElement("i",{className:"fa fa-angle-left"})):null}renderCurrentStateText(){return s.createElement("span",null,this.props.paginator.getCurrentStateText())}renderNextPageIcon(){return this.props.paginator.canShowNextTablePage()?s.createElement("span",{onClick:this.showNextTablePage.bind(this),className:"pagination-btn"},s.createElement("i",{className:"fa fa-angle-right"})):null}renderEndPageIcon(){return this.props.paginator.canShowNextTablePage()?s.createElement("span",{onClick:this.showTableEnd.bind(this),className:"pagination-btn"},s.createElement("i",{className:"fa fa-angle-double-right"})):null}showTableStart(){this.props.paginator.showTableStart(),this.props.paginator.events.onChange.fire(),this.forceUpdate()}showPreviousTablePage(){this.props.paginator.showPreviousTablePage(),this.props.paginator.events.onChange.fire(),this.forceUpdate()}showNextTablePage(){this.props.paginator.showNextTablePage(),this.props.paginator.events.onChange.fire(),this.forceUpdate()}showTableEnd(){this.props.paginator.showTableEnd(),this.props.paginator.events.onChange.fire(),this.forceUpdate()}}}),define("pagination",["require","exports","list/classes/list_paginator","list/components/list_pagination_component"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("enums/progress_graph_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PROGRESS_GRAPH="PROGRESS_GRAPH",e.PROGRESS_GRAPH_PERC="PROGRESS_GRAPH_PERC",e.PROGRESS_GRAPH_COMPARE="PROGRESS_GRAPH_COMPARE",e.PROGRESS_GRAPH_PLAIN="PROGRESS_GRAPH_PLAIN"}(t.ProgressGraphLayout||(t.ProgressGraphLayout={}))}),define("interfaces/progress_graph_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/progress_graph_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProgressGraphModel=class{constructor(e){if(this.isLogarithmic=!1,this.checkSum=0,e.progressValues.length<1)throw new Error("At least one progress value is required");this.id=_.uniqueId(),this.progressValues=e.progressValues,this.layout=e.layout,this.lineWidth=e.lineWidth}toSerializable(){return this}}}),define("interfaces/progress_graph_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/progress_graph_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/progress_graph_bar_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/bars/abstract_progress_graph_bar",["require","exports","graphics_utilities","graphics_utilities","math_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=10;t.AbstractProgressGraphBar=class{constructor(e,t){this.drawables=[],this.oldMultiplier=0,this.progressValue=e,t.lineWidth=t.lineWidth||r,t.lineCap=t.lineCap||s.CanvasStyleLineCap.ROUND,this.settings=t,this.generateDrawables()}get percent(){return 100*this.multiplier}get multiplier(){return this.progressValue.value/this.progressValue.maxValue}get value(){return this.progressValue.value}get maxValue(){return this.progressValue.maxValue}get color(){return this.progressValue.color||new i.Color(new n.Vector4D(0,0,0,255))}setProgressValue(e){this.oldMultiplier=this.multiplier,this.progressValue=e,this.generateDrawables()}setSettings(e){Object.assign(this.settings,e),this.generateDrawables()}getDrawables(){return this.drawables}}}),define("classes/graphs/progress_graph",["require","exports","abstract_canvas_chart","graphics_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROGRESS_GRAPH_BOLD_FONT=s.DrawableTextFontFamily.RobotoB,t.PROGRESS_GRAPH_PRIMARY_FONT=s.DrawableTextFontFamily.RobotoR,t.PROGRESS_GRAPH_SECONDARY_FONT=s.DrawableTextFontFamily.RobotoR,t.progressGraphLayerType=Object.assign({},i.CANVAS_CHART_LAYER_TYPE,{GRAPH:"GRAPH",TEXT:"TEXT"});t.ProgressGraph=class extends i.CanvasChart{constructor(e,i,s){super(e,Object.assign({},i,{layers:t.progressGraphLayerType,layerConfigs:{[t.progressGraphLayerType.LINES]:{enableInteractions:!0}}})),this.firstCall=!0,this.colorPalette=s,$(i.containerSpan).addClass("canvas-progress-graph")}initialize(){this.dataStream.subscribe(i.CanvasChartUtils.createStreamListener(_.throttle(async e=>{await this.clearDrawables(t.progressGraphLayerType.GRAPH),await this.clearDrawables(t.progressGraphLayerType.TEXT),this.generateDrawables(e),this.progressBars.forEach(e=>{e.getDrawables().forEach(e=>this.addDrawable(t.progressGraphLayerType.GRAPH,e))}),this.getTextDrawables().forEach(e=>this.addDrawable(t.progressGraphLayerType.TEXT,e)),(this.firstCall&&this.options.initialAnimationEnabled||!this.firstCall)&&this.options.initialAnimationDuration>0&&(this.progressBars.forEach(e=>{this.addTweens(e.getTweens())}),this.addTweens(this.getTweens()),this.firstCall=!1),this.afterUpdate.fire()},this.options.initialAnimationDuration||0))),this.disposeToken.addCleanupFunction(()=>{this.afterUpdate.fire()})}update(e){return super.update(e),this}getMaxFontSizeForDrawable(e,t,i){return i.width>t?e*(t/i.width):e}}}),define("enums/progress_graph_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FRACTION=0]="FRACTION",e[e.PERCENTAGE=1]="PERCENTAGE",e[e.PLAIN=2]="PLAIN"}(t.ProgressGraphType||(t.ProgressGraphType={}))}),define("classes/bars/progress_graph_arc",["require","exports","graphics_utilities","math_utils","classes/bars/abstract_progress_graph_bar"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.INDICATOR=1]="INDICATOR"}(r||(r={}));t.ProgressGraphArc=class extends n.AbstractProgressGraphBar{get range(){return this.settings.endAngle-this.settings.startAngle}constructor(e,t){e.value<0&&(t.counterClockwise=!t.counterClockwise),super(e,t)}generateDrawables(){this.drawables=[],this.drawables[r.BACKGROUND]=this.createCircleSector(this.getRadiansByMultiplier(0),this.getRadiansByMultiplier(1),this.settings.lineWidth,this.color.clone().setOpacity(.3)),this.drawables[r.INDICATOR]=this.createCircleSector(this.getRadiansByMultiplier(0),this.getRadiansByMultiplier(this.multiplier),this.settings.lineWidth,this.color)}createCircleSector(e,t,s,n){const r={strokeStyle:n,lineWidth:s,lineCap:this.settings.lineCap};return new i.DrawableCircleSector({position:this.settings.position,radius:this.settings.radius,startAngle:this.settings.counterClockwise?t:e,endAngle:this.settings.counterClockwise?e:t,onlyStrokeOutside:!0,style:r})}getTweens(){if(!this.settings.animationDuration)return[];const e=this.settings.animationDuration*Math.abs(this.oldMultiplier-this.multiplier);return[{drawable:this.getProgressIndicatorDrawable(),object:this.getProgressIndicatorDrawable(),key:this.settings.counterClockwise?"startAngle":"endAngle",targetValue:this.getRadiansByMultiplier(this.multiplier),initialValue:this.getRadiansByMultiplier(this.oldMultiplier),duration:e}]}getRadiansByMultiplier(e){return e=Math.abs(e),this.settings.counterClockwise&&(e=1-e),s.trigonometryUtils.degreesToRadians(this.settings.startAngle+this.range*e)}getProgressIndicatorDrawable(){return this.drawables[r.INDICATOR]}}}),define("classes/graphs/circular_progress_graph",["require","exports","classes/graphs/progress_graph","graphics_utilities","math_utils","enums/progress_graph_type","classes/bars/progress_graph_arc"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=-90,l=.05,c=.04,d=.4,h=.375;t.CircularProgressGraph=class extends i.ProgressGraph{constructor(e,t,i,s=r.ProgressGraphType.PERCENTAGE,n=!1,o=!1){super(e,t,i),this.type=s,this.counterClockwise=n,this.forceInteger=o}generateDrawables(e){const t=Math.min(e.size.x,e.size.y);this.lineWidth=Math.max(2,Math.round(t*l)),this.position=new n.Vector2D(e.size.x/2,e.size.y/2),this.radius=Math.min(e.size.x,e.size.y)/2-this.lineWidth;const i={animationDuration:this.options.initialAnimationDuration,position:this.position,radius:this.radius,lineWidth:this.lineWidth};e.model.progressValues[0].color||(e.model.progressValues[0].color=s.Color.fromHex(this.colorPalette.mainColor.toHex6())),this.progressBars?(this.getProgressBar().setProgressValue(e.model.progressValues[0]),this.getProgressBar().setSettings(i)):this.progressBars=[new o.ProgressGraphArc(e.model.progressValues[0],Object.assign({},i,{startAngle:a,endAngle:a+360,counterClockwise:this.counterClockwise}))];const r=t*d;this.primaryLabel=this.generatePrimaryLabel(r),this.primaryLabel.size=this.getMaxFontSizeForDrawable(r,.6*t,this.primaryLabel);const c=this.primaryLabel.size*h;this.secondaryLabel=this.generateSecondaryLabel(c);const u=this.generatePrimaryLabel(this.primaryLabel.size,"0");this.digitDimension=new n.Vector2D(u.width,u.height),this.calculateLabelPositioning()}getTextDrawables(){const e=[this.primaryLabel];return this.type!==r.ProgressGraphType.PLAIN&&e.push(this.secondaryLabel),e}getTweens(){const e=this.getProgressBar().oldMultiplier,t=this.getProgressBar().multiplier,i=this.options.initialAnimationDuration*Math.abs(e-t);return[{drawable:this.primaryLabel,object:this.primaryLabel,key:"text",targetValue:t*this.getProgressBar().maxValue,initialValue:e*this.getProgressBar().maxValue,duration:i,formatter:e=>(this.calculateLabelPositioning(e),this.formatValue(e))}]}formatValue(e){return this.options.numberFormatter?this.forceInteger?this.options.numberFormatter.toInteger(e):this.options.numberFormatter.toDecimal(e):this.forceInteger?Math.round(e).toLocaleString():e.toLocaleString()}getPrimaryLabelText(e){switch(this.type){case r.ProgressGraphType.PERCENTAGE:return this.formatValue(e||this.getProgressBar().percent);case r.ProgressGraphType.FRACTION:case r.ProgressGraphType.PLAIN:return this.formatValue(e||this.getProgressBar().value)}}getSecondaryLabelText(){switch(this.type){case r.ProgressGraphType.PERCENTAGE:return"%";case r.ProgressGraphType.FRACTION:return`/${this.getProgressBar().maxValue}`;case r.ProgressGraphType.PLAIN:return""}}calculateLabelPositioning(e){switch(this.type){case r.ProgressGraphType.PERCENTAGE:e=e||Math.round(this.getProgressBar().percent);const t=this.getPrimaryLabelText(e),i=t.replace(new RegExp("[0-9]","g"),"").length,s=(t.length-.5*i)*this.digitDimension.x;this.primaryLabel.position.x=this.position.x-.5*this.secondaryLabel.width,this.secondaryLabel.position.x=this.position.x+.5*s,this.secondaryLabel.position.y=this.position.y-.5*this.digitDimension.y+.5*this.secondaryLabel.height;break;case r.ProgressGraphType.FRACTION:const n=Math.round((2*this.radius+this.lineWidth)*c);this.primaryLabel.position.y=this.position.y-.5*this.secondaryLabel.height-n,this.secondaryLabel.position.y=this.position.y+.5*this.digitDimension.y+n}}generatePrimaryLabel(e,t){return new s.DrawableText({position:this.position.clone(),text:t||this.getPrimaryLabelText(),size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_PRIMARY_FONT,style:{fillStyle:this.getProgressBar().color}})}generateSecondaryLabel(e){return new s.DrawableText({position:this.position.clone(),text:this.getSecondaryLabelText(),size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_SECONDARY_FONT,style:{fillStyle:this.colorPalette.labelColor.toHex6()}})}getProgressBar(){if(!this.progressBars)throw new Error("Progress bar was not initialized");return this.progressBars[0]}}}),define("classes/graphs/comparison_progress_graph",["require","exports","classes/graphs/progress_graph","graphics_utilities","math_utils","classes/bars/progress_graph_arc"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=-180,a=.04,l=.04,c=.23,d=.375,h=.2,u=5,p=String.fromCharCode(58941),g=String.fromCharCode(58940);t.ComparisonProgressGraph=class extends i.ProgressGraph{get change(){return 0===this.getPreviousProgressBar().value?0:(this.getCurrentProgressBar().value-this.getPreviousProgressBar().value)/this.getPreviousProgressBar().value}constructor(e,t,i,s){if(super(e,t,i),this.infoLabelText=s,this.displayChangeLabel=!0,2!==e.model.progressValues.length)throw new Error("This graph requires two progress values")}generateDrawables(e){const t=Math.min(e.size.x,e.size.y);this.lineWidth=Math.max(2,Math.round(t*a)),this.position=new n.Vector2D(e.size.x/2,e.size.y/2),this.radius=Math.min(e.size.x,e.size.y)/2-this.lineWidth,e.model.progressValues[0].color||(e.model.progressValues[0].color=s.Color.fromHex(this.colorPalette.mainColor.toHex6())),e.model.progressValues[1]||(e.model.progressValues[1]={value:0,maxValue:e.model.progressValues[0].maxValue}),0===e.model.progressValues[1].value&&(this.displayChangeLabel=!1),e.model.progressValues[1].color=s.Color.fromHex(this.colorPalette.previousColor.toHex6()),this.generateProgressBars(e);const i=t*c,r=i*d,o=i*h;this.valueLabel=this.generateValueLabel(i),this.changeLabelEmoji=this.generateChangeLabelEmoji(r),this.changeLabel=this.generateChangeLabel(r),this.infoLabel=this.generateInfoLabel(o),this.previousValueLabel=this.generatePreviousValueLabel(r),this.calculateLabelPositioning()}generateProgressBars(e){const t={animationDuration:this.options.initialAnimationDuration,position:this.position,radius:this.radius,lineWidth:this.lineWidth};this.progressBars?(this.getCurrentProgressBar().setProgressValue(e.model.progressValues[0]),this.getPreviousProgressBar().setProgressValue(e.model.progressValues[1]),this.getCurrentProgressBar().setSettings(t),this.getPreviousProgressBar().setSettings(t)):this.progressBars=[new r.ProgressGraphArc(e.model.progressValues[0],Object.assign({},t,{startAngle:o+u,endAngle:o+180-u,counterClockwise:!1})),new r.ProgressGraphArc(e.model.progressValues[1],Object.assign({},t,{startAngle:o+180+u,endAngle:o+360-u,counterClockwise:!0}))]}generateValueLabel(e,t){const n=new s.DrawableText({position:this.position.clone().moveBy(0,-e/2),text:t||this.options.numberFormatter.toDecimal(this.getCurrentProgressBar().value),size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_BOLD_FONT,style:{fillStyle:this.getCurrentProgressBar().color}});return n.size=this.getMaxFontSizeForDrawable(e,2*this.radius*.8,n),n}generateChangeLabelEmoji(e){let t="";return this.change>0?t=p:this.change<0&&(t=g),new s.DrawableText({position:this.position.clone().moveBy(0,this.radius/4),text:t,size:.8*e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:s.DrawableTextFontFamily.twAwesome,weight:100,style:{fillStyle:this.colorPalette.changeLabelColor.toHex6()}})}generateChangeLabel(e){const t=(this.change>0?"+":"")+this.options.numberFormatter.toPercentage(this.change);return new s.DrawableText({position:this.position.clone().moveBy(0,this.radius/4),text:t,size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_SECONDARY_FONT,style:{fillStyle:this.colorPalette.changeLabelColor.toHex6()}})}generateInfoLabel(e){return new s.DrawableText({position:this.position.clone().moveBy(0,this.radius/4*2),text:this.infoLabelText,size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_SECONDARY_FONT,style:{fillStyle:this.colorPalette.previousColor.toHex6()}})}generatePreviousValueLabel(e,t){const n=new s.DrawableText({position:this.position.clone().moveBy(0,this.radius/4*3-e/2),text:t||this.options.numberFormatter.toDecimal(this.getPreviousProgressBar().value),size:e,textAlign:s.DrawableTextAlign.CENTER,textBaseline:s.DrawableTextBaseline.MIDDLE,family:i.PROGRESS_GRAPH_SECONDARY_FONT,style:{fillStyle:this.colorPalette.previousColor.toHex6()}});return n.size=this.getMaxFontSizeForDrawable(e,2*this.radius*.65,n),n}calculateLabelPositioning(){this.changeLabelEmoji.position.moveBy(-this.changeLabel.width/2-l*this.radius,0),this.changeLabel.position.moveBy(this.changeLabelEmoji.width/2+l*this.radius,0)}getCurrentProgressBar(){return this.progressBars[0]}getPreviousProgressBar(){return this.progressBars[1]}getTextDrawables(){const e=[this.valueLabel,this.infoLabel,this.previousValueLabel];return this.displayChangeLabel&&e.push(this.changeLabelEmoji,this.changeLabel),e}getTweens(){return[this.generateTextTween(this.getCurrentProgressBar(),this.valueLabel),this.generateTextTween(this.getPreviousProgressBar(),this.previousValueLabel)]}generateTextTween(e,t){const i=e.oldMultiplier,s=e.multiplier,n=this.options.initialAnimationDuration*Math.abs(i-s);return{drawable:t,object:t,key:"text",initialValue:i*e.maxValue,targetValue:s*e.maxValue,duration:n,formatter:e=>this.options.numberFormatter.toDecimal(e)}}}}),define("classes/progress_graph_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProgressGraphColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){switch(this.themeId){case 2:case 3:return this.buildDarkColorPalette();default:return this.buildLightColorPalette()}}buildLightColorPalette(){return{emptyColor:new i.Color("#DDDDDD"),labelColor:new i.Color("#666666"),mainColor:new i.Color("#0089C0"),previousColor:new i.Color("#757575"),changeLabelColor:new i.Color("#000000")}}buildDarkColorPalette(){return{emptyColor:new i.Color("#666666"),labelColor:new i.Color("#DDDDDD"),mainColor:new i.Color("#3392B9"),previousColor:new i.Color("#757575"),changeLabelColor:new i.Color("#FFFFFF")}}}}),define("components/progress_graph_component",["require","exports","flux","react","math_utils","reusable_utilities","enums/progress_graph_type","classes/progress_graph_color_palette_builder"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends i.BaseComponent{constructor(e){super(e),this.colorPaletteBuilder=new a.ProgressGraphColorPaletteBuilder(this.props.theme),this.state={width:this.props.style.width?this.props.style.width:0,height:this.props.style.height?this.props.style.height:0}}render(){return s.createElement("div",{style:this.props.style,className:this.props.className,ref:e=>this.rootElement=e},s.createElement("span",{style:{display:"block"},ref:e=>this.progressGraphSpan=e}))}componentDidMount(){this.setState({width:this.rootElement.offsetWidth,height:this.rootElement.offsetHeight}),this.cancellationToken.setInterval(()=>{const e=Math.min(this.rootElement.offsetWidth,this.rootElement.offsetHeight);e!==this.oldRadius&&(this.oldRadius=e,this.setState({width:this.rootElement.offsetWidth,height:this.rootElement.offsetHeight}))},200),this.initializeGraph(),this.draw()}shouldComponentUpdate(e,t,i){return this.props.lineWidth!==e.lineWidth||this.props.theme!==e.theme||this.state.width!==t.width||this.state.height!==t.height}componentDidUpdate(e,t,i){this.draw()}getProgressGraphData(){return{size:new n.Vector2D(this.state.width,this.state.height),position:n.Vector2D.zero(),model:this.getProgressGraphModel()}}getCanvasChartOptions(){return{containerSpan:this.progressGraphSpan,initialAnimationEnabled:this.props.animationEnabled,initialAnimationDuration:this.props.animationDuration,margins:new n.Vector4D(0,0,0,0),resolutionScale:1,numberFormatter:this.props.numberFormatter}}getColorPalette(){return this.colorPaletteBuilder.build()}async draw(){if(void 0!==this.animationPromise&&(await this.animationPromise,this.animationPromise=void 0),this.state.width&&this.state.height){const e=this.progressGraph.afterUpdate.subscribeOnceAsPromise();if(this.progressGraph.update(this.getProgressGraphData()),await e,void 0===this.drawToken){if(this.cancellationToken.isCanceled())return;this.drawToken=new r.CancellationToken,this.cancellationToken.chain(this.drawToken),this.progressGraph.start(this.drawToken)}this.animationPromise=new Promise(async e=>{await this.progressGraph.animate(!0),e()}),await this.animationPromise,this.progressGraph.rendering&&await this.progressGraph.afterRenderPromise}}}l.defaultProps={type:o.ProgressGraphType.PERCENTAGE,animationEnabled:!1,animationDuration:2e3,theme:1,style:{width:"100%",height:"100%"},className:"",numberFormatter:void 0},t.ProgressGraphComponent=l}),define("components/circular_progress_graph_component",["require","exports","components/progress_graph_component","classes/graphs/circular_progress_graph","enums/progress_graph_layout","classes/progress_graph_model","graphics_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.ProgressGraphComponent{initializeGraph(){this.progressGraph=new s.CircularProgressGraph(this.getProgressGraphData(),this.getCanvasChartOptions(),this.getColorPalette(),this.props.type,this.props.counterClockwise,this.props.forceInteger),this.progressGraph.initialize()}getProgressGraphModel(){return new r.ProgressGraphModel({progressValues:[{value:this.props.value,maxValue:this.props.maxValue,color:o.Color.fromHex(this.props.color)}],layout:n.ProgressGraphLayout.PROGRESS_GRAPH,lineWidth:this.props.lineWidth})}shouldComponentUpdate(e,t,i){return super.shouldComponentUpdate(e,t,i)||this.props.value!==e.value||this.props.maxValue!==e.maxValue}}a.defaultProps=Object.assign({},i.ProgressGraphComponent.defaultProps,{value:0,maxValue:100,color:"#0089bc",counterClockwise:!1,forceInteger:!0}),t.CircularProgressGraphComponent=a}),define("interfaces/progress_graph_fragment_build_configuration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("progress_graph",["require","exports","classes/graphs/circular_progress_graph","classes/graphs/comparison_progress_graph","classes/graphs/progress_graph","classes/progress_graph_color_palette_builder","classes/progress_graph_model","components/circular_progress_graph_component","components/progress_graph_component","enums/progress_graph_layout","enums/progress_graph_type"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";function h(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),h(i),h(s),h(n),h(r),h(o),h(a),h(l),h(c),h(d)}),define("filter_value_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TEXT_INPUT="TEXT_INPUT",e.FILTER_MENU="FILTER_MENU",e.SINGLE_SELECT="SINGLE_SELECT"}(t.FilterValueType||(t.FilterValueType={}))}),define("query_builder_structure_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("query_builder_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("query_builder_component_renderable_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("query_builder_utilities",["require","exports","filter_value_types"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static getFilterValueType(e){switch(e){case"AUTHOR_BIO":case"AUTHOR_NAME":case"CONTENT":case"CONTENT_AND_TITLE":case"FOLLOWER_COUNT":return i.FilterValueType.TEXT_INPUT;case"COUNTRY":case"INTERESTS":case"LANGUAGE":case"OCCUPATIONS":case"PREDEFINED_FILTER":return i.FilterValueType.FILTER_MENU;case"REACH":case"GENDER":return i.FilterValueType.SINGLE_SELECT;default:throw new Error(`Unknown FIELD type "${e}" !`)}}static generateFilterGroupId(){return _.uniqueId("filter-group")}static generateQueryBuilderFilterId(){return _.uniqueId("query-builder-filter")}static hasGroups(e){return!!e&&e.filterGroups.length>0}static getAndSelectFirstEntry(e){return e.root_entry.children[0].selected="NODE",e.root_entry.children[0]}static getFilterParentGroup(e,t){return t.find(t=>void 0!==t.filters.find(t=>t.id===e.id))}static createFreshState(e,t,i){const n=s.getAndSelectFirstEntry(t);return{canAddGroups:!0,filterGroups:[{id:s.generateFilterGroupId(),canAddFilters:!0,canBeDeleted:!1,filters:[s.createNewFilter(i,!1)],header:{leftMessage:e.firstGroupLeftHeader,selectedSelector:{message:n.name,type:n.mapped_id},rightMessage:e.rightHeader}}]}}static createNewGroup(e,t,i,n){return{id:s.generateFilterGroupId(),canAddFilters:!0,canBeDeleted:!0,filters:[s.createNewFilter(e,!1)],header:s.createNewGroupHeader(t,i,n)}}static createNewGroupHeader(e,t,i){const n=s.getAndSelectFirstEntry(t);return{leftMessage:s.hasGroups(i)?e.otherGroupsLeftHeader:e.firstGroupLeftHeader,selectedSelector:{message:n.name,type:n.mapped_id},rightMessage:e.rightHeader}}static createNewFilter(e,t){const i=s.getAndSelectFirstEntry(e);return{selectedProperty:{message:i.name,type:i.mapped_id},selectedValue:void 0,id:s.generateQueryBuilderFilterId(),canBeRemoved:!!t}}static initializeGroupSelectorsTopicMenu(e){return s.convertToTopicMenu(e,!0)}static initializeFilterPropertiesTopicMenu(e){return s.convertToTopicMenu(e)}static convertToTopicMenu(e,t){return{grouping:"NOT_APPLIED",pinned_type:"NONE",root_entry:{children:e.map(e=>({name:t?e.message.toLocaleUpperCase():e.message,selected:"NONE",mapped_id:e.type}))}}}static areStatesTheSame(e,t){return e.canAddGroups===t.canAddGroups&&(e.filterGroups.length===t.filterGroups.length&&!s.areGroupsDifferent(e.filterGroups,t.filterGroups))}static areGroupsDifferent(e,t){return e.some((e,i)=>{const n=t[i];if(e.canAddFilters!==n.canAddFilters||e.canBeDeleted!==n.canBeDeleted)return!0;{const t=e.header,i=n.header;return t.leftMessage!==i.leftMessage||t.rightMessage!==i.rightMessage||t.selectedSelector.type!==i.selectedSelector.type||(e.filters.length!==n.filters.length||!!s.areFiltersDifferent(e.filters,n.filters))}})}static areFiltersDifferent(e,t){return e.some((e,i)=>{const s=t[i];return e.canBeRemoved!==s.canBeRemoved||e.selectedProperty.type!==s.selectedProperty.type||e.selectedValue!==s.selectedValue})}static getFilterMenuAllNode(e){return e.getAdapter().getAttributes().topicMenu.root_entry.children[0]}static getSelectedEntries(e){const t=[];return s.getSelectedEntriesRecursively(e.selectedValue,t),t}static getSelectedEntriesRecursively(e,t){if("NODE"===e.selected)t.push(e.mapped_id);else if(e.children)for(let i=0;i<e.children.length;i++)s.getSelectedEntriesRecursively(e.children[i],t)}static generateMapKey(e,t){return e+t}}s.filterMenus=new Map,t.QueryBuilderUtilities=s}),define("query_builder_parser",["require","exports","filter_menu","react","filter_value_types","query_builder_utilities"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{static registerQueryBuilder(e,t){o.queryBuilders.set(e.id,{props:e,state:t})}static updateQueryBuilder(e,t){o.registerQueryBuilder(e,t)}static unregisterQueryBuilder(e){o.queryBuilders.delete(e)}static parseToSearchDescriptor(e){return{type:"CONSTRUCTED",constructed_search:{operator:"AND",clauses:o.buildClauses(o.queryBuilders.get(e).state.filterGroups)}}}static buildClauses(e){return e.map(e=>o.buildSingleClause(e))}static buildSingleClause(e){return{operator:e.header.selectedSelector.type,terms:o.buildTerms(e)}}static buildTerms(e){return e.filters.map(e=>o.buildSingleTerm(e))}static buildSingleTerm(e){return{field:e.selectedProperty.type,values:o.buildValuesByType(e),id:e.id}}static buildValuesByType(e){const t=r.QueryBuilderUtilities.getFilterValueType(e.selectedProperty.type);return t===n.FilterValueType.TEXT_INPUT?o.buildSingleValueValue(e):t===n.FilterValueType.FILTER_MENU?o.buildValueFromFilterMenuContainer(e):t===n.FilterValueType.SINGLE_SELECT?o.buildSingleValueValue(e):void 0}static buildValueFromFilterMenuContainer(e){return e.selectedValue?r.QueryBuilderUtilities.getSelectedEntries(e):[""]}static buildSingleValueValue(e){return e.selectedValue?[e.selectedValue]:[""]}static parseSearchDescriptor(e,t,i,s){const{props:n}=o.queryBuilders.get(e);if("CONSTRUCTED"!==t.type&&void 0===t.constructed_search)return r.QueryBuilderUtilities.createFreshState(n.messages,i,s);const{maxNumberOfGroups:a=Number.MAX_SAFE_INTEGER}=n;return{canAddGroups:t.constructed_search.clauses.length<a,filterGroups:o.parseClauses(t.constructed_search.clauses,e)}}static parseClauses(e,t){const i=e.length;return e.map((e,s)=>o.parseSingleClause(e,s,i,t))}static parseSingleClause(e,t,i,s){const{props:n}=o.queryBuilders.get(s),{maxNumberOfFiltersPerGroup:a=Number.MAX_SAFE_INTEGER}=n,{firstGroupLeftHeader:l,otherGroupsLeftHeader:c,rightHeader:d}=n.messages;return{canAddFilters:e.terms.length<a,canBeDeleted:i>1,id:r.QueryBuilderUtilities.generateFilterGroupId(),header:{leftMessage:0===t?l:c,rightMessage:d,selectedSelector:{message:n.model.groupSelectors.find(t=>t.type===e.operator).message,type:e.operator}},filters:o.parseTerms(e,s)}}static parseTerms(e,t){const i=e.terms.length;return e.terms.map(e=>o.parseSingleTerm(e,i,t))}static parseSingleTerm(e,t,i){const s=void 0===e.id?r.QueryBuilderUtilities.generateQueryBuilderFilterId():e.id,{props:n}=o.queryBuilders.get(i);return{id:s,canBeRemoved:t>1,selectedProperty:{type:e.field,message:n.model.filterProperties.find(t=>t.type===e.field).message},selectedValue:o.parseValuesByType(e,s,i)}}static parseValuesByType(e,t,i){const s=r.QueryBuilderUtilities.getFilterValueType(e.field);return s===n.FilterValueType.TEXT_INPUT?o.parseValuesAsTextInput(e):s===n.FilterValueType.FILTER_MENU?o.parseValuesAsFilterMenu(e,t,i):s===n.FilterValueType.SINGLE_SELECT?o.parseValuesAsSingleSelect(e):void 0}static parseValuesAsTextInput(e){return e.values?e.values[0]:""}static parseValuesAsFilterMenu(e,t,n){if(e.values){const{props:a}=o.queryBuilders.get(n),{filterMenus:l}=a.model,{controllerFactory:c}=l.find(t=>t.type===e.field),d=c(t),h=s.createElement(i.FilterMenuContainer,{messages:a.messages.filterMenuMessages,controller:d});return o.selectNodesFromTerm(r.QueryBuilderUtilities.getFilterMenuAllNode(d),e),r.QueryBuilderUtilities.filterMenus.set(r.QueryBuilderUtilities.generateMapKey(n,t),{type:e.field,renderable:h,controller:d}),r.QueryBuilderUtilities.getFilterMenuAllNode(d)}}static selectNodesFromTerm(e,t){o.values=JSON.parse(JSON.stringify(t.values)),o.selectNodesFromTermRecursively(e)}static selectNodesFromTermRecursively(e){if(o.values)if(o.values.includes(e.mapped_id)){const t=o.values.findIndex(t=>t===e.mapped_id);o.values.splice(t,1),e.selected="NODE"}else if(e.selected="NONE",e.children)for(let t=0;t<e.children.length;t++)o.selectNodesFromTermRecursively(e.children[t])}static parseValuesAsSingleSelect(e){return e.values?e.values[0]:void 0}}o.queryBuilders=new Map,t.QueryBuilderParser=o}),define("query_builder_component_renderable",["require","exports","event_bus","filter_menu","flux","react","reusable_components","filter_value_types","query_builder_parser","query_builder_utilities"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueryBuilderComponentRenderable=class extends n.BaseComponent{constructor(e){super(e);const{groupSelectors:t,filterProperties:s}=this.props.model;this.groupSelectors=c.QueryBuilderUtilities.initializeGroupSelectorsTopicMenu(t),this.filterProperties=c.QueryBuilderUtilities.initializeFilterPropertiesTopicMenu(s),this.state=this.initializeState(),this.cleanState=JSON.parse(JSON.stringify(this.state)),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.FILTER_MENU_FILTER_CHANGED,()=>this.forceUpdate()),this.dirty=!1}initializeState(){return l.QueryBuilderParser.registerQueryBuilder(this.props,this.state),this.props.initialState&&Object.getOwnPropertyNames(this.props.initialState).length>0?l.QueryBuilderParser.parseSearchDescriptor(this.props.id,this.props.initialState,this.groupSelectors,this.filterProperties):c.QueryBuilderUtilities.createFreshState(this.props.messages,this.groupSelectors,this.filterProperties)}render(){return r.createElement("div",{className:"query-builder-component-container"},this.renderGroups(),this.renderButtons())}renderGroups(){return r.createElement("div",{className:"query-builder-groups"},this.state.filterGroups.map(e=>this.renderSingleGroup(e)))}renderSingleGroup(e){return r.createElement("div",{className:"query-builder-group",key:e.id},this.renderRemoveGroupButton(e),this.renderGroupHeader(e),this.renderFilters(e),this.renderAddFilterButton(e))}renderRemoveGroupButton(e){return e.canBeDeleted?r.createElement("div",{className:"group-remove-button",onClick:()=>{this.removeGroup(e)}},r.createElement("i",{className:"fa fa-times","aria-hidden":"true"})):void 0}renderGroupHeader(e){const{header:t}=e,i=JSON.parse(JSON.stringify(this.groupSelectors));let s=i.root_entry.children.findIndex(t=>t.mapped_id===e.header.selectedSelector.type);return-1===s&&(s=0),i.root_entry.children[s].selected="NODE",r.createElement("div",{className:"query-builder-group-header"},t.leftMessage,r.createElement("div",{className:"group-selector"},r.createElement(o.SingleSelectComponent,{model:i,selectCallback:t=>{this.handleGroupSelectorSelection(t,e)}})),t.rightMessage)}renderFilters(e){return r.createElement("div",{className:"query-builder-groups"},e.filters.map(e=>this.renderSingleFilter(e)))}renderSingleFilter(e){return r.createElement("div",{className:"query-builder-filter",key:e.id},this.renderFilterProperty(e),this.renderFilterValue(e),this.renderRemoveFilterButton(e))}renderFilterProperty(e){const t=JSON.parse(JSON.stringify(this.filterProperties));let i=t.root_entry.children.findIndex(t=>t.mapped_id===e.selectedProperty.type);return-1===i&&(i=0),t.root_entry.children[i].selected="NODE",r.createElement("div",{className:"filter-property"},r.createElement(o.SingleSelectComponent,{model:t,selectCallback:t=>{this.handleFilterPropertySelection(t,e)}}))}renderFilterValue(e){return r.createElement("div",{className:"filter-value"},this.renderFilterValueByType(e))}renderFilterValueByType(e){const t=c.QueryBuilderUtilities.getFilterValueType(e.selectedProperty.type);return t===a.FilterValueType.TEXT_INPUT?this.renderTextFieldFilterValue(e):t===a.FilterValueType.FILTER_MENU?this.renderFilterMenuContainerFilterValue(e):t===a.FilterValueType.SINGLE_SELECT?this.renderSingleSelectFilterValue(e):void 0}renderTextFieldFilterValue(e){return r.createElement("input",{type:"text",value:e.selectedValue||"",onChange:t=>{this.handleTextFieldValueChange(t,e)},onFocus:this.handleTextInputFocus.bind(this),id:e.id})}renderFilterMenuContainerFilterValue(e){const t=c.QueryBuilderUtilities.generateMapKey(this.props.id,e.id);if(c.QueryBuilderUtilities.filterMenus.has(t)&&c.QueryBuilderUtilities.filterMenus.get(t).type===e.selectedProperty.type)return e.selectedValue=c.QueryBuilderUtilities.getFilterMenuAllNode(c.QueryBuilderUtilities.filterMenus.get(t).controller),c.QueryBuilderUtilities.filterMenus.get(t).renderable;{const{filterMenus:i}=this.props.model,{controllerFactory:n}=i.find(t=>t.type===e.selectedProperty.type),o=n(e.id),a=r.createElement(s.FilterMenuContainer,{messages:this.props.messages.filterMenuMessages,controller:o});return c.QueryBuilderUtilities.filterMenus.set(t,{type:e.selectedProperty.type,renderable:a,controller:o}),e.selectedValue=c.QueryBuilderUtilities.getFilterMenuAllNode(o),a}}renderSingleSelectFilterValue(e){const t=JSON.parse(JSON.stringify(this.props.model.singleSelects.find(t=>t.type===e.selectedProperty.type).topicMenu));let i=t.root_entry.children.findIndex(t=>!!e.selectedValue&&t.mapped_id===e.selectedValue);return-1===i&&(i=0),t.root_entry.children[i].selected="NODE",e.selectedValue=t.root_entry.children[i].mapped_id,r.createElement(o.SingleSelectComponent,{model:t,selectCallback:t=>this.handleSingleSelectFilterValueSelection(t,e),openOnHover:!0})}renderRemoveFilterButton(e){return e.canBeRemoved?r.createElement("i",{className:"fa fa-trash remove-filter-button","aria-hidden":"true",onClick:()=>{this.removeFilter(e)}}):r.createElement("i",{className:"remove-filter-button-placeholder"})}renderAddFilterButton(e){return e.canAddFilters?r.createElement("div",{className:"add-filter-button-container"},r.createElement("div",{className:"add-filter-button",onClick:()=>{this.addFilter(e)}},r.createElement("i",{className:"fa fa-plus-circle","aria-hidden":"true"}),r.createElement("span",{className:"add-filter-button-label"},this.props.messages.addFilter))):void 0}renderButtons(){return r.createElement("div",{className:"query-builder-buttons"},this.renderAddGroupButton(),this.renderResetButton())}renderAddGroupButton(){return this.state.canAddGroups?r.createElement("div",{className:"button-container"},r.createElement("div",{className:"button",onClick:this.addGroup.bind(this)},r.createElement("i",{className:"fa fa-plus-circle","aria-hidden":"true"}),r.createElement("span",{className:"button-label"},this.props.messages.addGroup))):void 0}renderResetButton(){return r.createElement("div",{className:"button-container"},r.createElement("div",{className:"button",onClick:this.reset.bind(this)},r.createElement("i",{className:"fa fa-times-circle","aria-hidden":"true"}),r.createElement("span",{className:"button-label"},this.props.messages.reset)))}removeGroup(e){const{filterGroups:t}=this.state,i=t,s=i.indexOf(e);i.splice(s,1),0===s&&i.length>0&&(i[0].header.leftMessage=this.props.messages.firstGroupLeftHeader),1===i.length&&(i[0].canBeDeleted=!1),this.setState({filterGroups:i})}handleGroupSelectorSelection(e,t){t.header.selectedSelector={type:e.mapped_id,message:e.name},this.forceUpdate()}handleFilterPropertySelection(e,t){const i=e.mapped_id;c.QueryBuilderUtilities.getFilterValueType(i)===a.FilterValueType.TEXT_INPUT&&c.QueryBuilderUtilities.getFilterValueType(t.selectedProperty.type)===a.FilterValueType.TEXT_INPUT||(t.selectedValue=void 0),t.selectedProperty={type:i,message:e.name},this.forceUpdate()}handleTextFieldValueChange(e,t){const i=e.target.value;t.selectedValue=i,this.forceUpdate()}handleTextInputFocus(){i.eventBus.dispatch({type:i.EVENT_TYPES.QUERY_BUILDER_FOCUS,value:void 0})}handleSingleSelectFilterValueSelection(e,t){t.selectedValue=e.mapped_id,this.forceUpdate()}removeFilter(e){const t=c.QueryBuilderUtilities.getFilterParentGroup(e,this.state.filterGroups);t.canAddFilters=!0;const i=t.filters.findIndex(t=>t.id===e.id);t.filters.splice(i,1);const s=this.state.filterGroups.findIndex(e=>e.id===t.id),n=this.state.filterGroups;1===t.filters.length&&(t.filters[0].canBeRemoved=!1),n[s]=t,this.setState({filterGroups:n})}addFilter(e){const t=e,{maxNumberOfFiltersPerGroup:i=Number.MAX_SAFE_INTEGER}=this.props;t.filters.push(c.QueryBuilderUtilities.createNewFilter(this.filterProperties,!0)),t.canAddFilters=t.filters.length<i;const s=this.state.filterGroups,n=s.findIndex(t=>t.id===e.id);t.filters.length>1&&(t.filters[0].canBeRemoved=!0),s[n]=t,this.setState({filterGroups:s})}addGroup(){const{maxNumberOfGroups:e=Number.MAX_SAFE_INTEGER}=this.props,{filterGroups:t}=this.state;1===t.length&&(t[0].canBeDeleted=!0),this.setState({filterGroups:t.concat(c.QueryBuilderUtilities.createNewGroup(this.filterProperties,this.props.messages,this.groupSelectors,this.state)),canAddGroups:t.length+1<e})}reset(){this.setState(c.QueryBuilderUtilities.createFreshState(this.props.messages,this.groupSelectors,this.filterProperties))}checkValidity(){const e=this.valid,t=this.isItAtLeastOneFilterValueSet();e!==t&&(this.valid=t,i.eventBus.dispatch({type:i.EVENT_TYPES.PROPAGATE_QUERY_BUILDER_VALIDITY,value:{valid:t,id:this.props.id}}))}isItAtLeastOneFilterValueSet(){return this.state.filterGroups.some(e=>e.filters.some(e=>e.selectedValue))}handleDirtyState(){c.QueryBuilderUtilities.areStatesTheSame(this.state,this.cleanState)?this.setDirty(!1):this.setDirty(!0)}setDirty(e){this.dirty!==e&&(this.dirty=e,i.eventBus.dispatch({type:i.EVENT_TYPES.QUERY_BUILDER_PROPAGATE_DIRTY_STATE,value:{dirty:e,id:this.props.id}}))}componentDidMount(){this.checkValidity(),i.eventBus.dispatch({type:i.EVENT_TYPES.QUERY_BUILDER_PROPAGATE_DIRTY_STATE,value:{dirty:this.dirty,id:this.props.id}}),l.QueryBuilderParser.registerQueryBuilder(this.props,this.state),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.RESET_QUERY_BUILDER_TO_CLEAN_STATE,e=>{e.value===this.props.id&&this.setState(JSON.parse(JSON.stringify(this.cleanState)))}),this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.UPDATE_QUERY_BUILDER_CLEAN_STATE,e=>{e.value===this.props.id&&(this.cleanState=this.state)})}componentDidUpdate(e){this.shouldResetToInitialState(e)&&this.setState(c.QueryBuilderUtilities.createFreshState(this.props.messages,this.groupSelectors,this.filterProperties)),this.checkValidity(),this.handleDirtyState(),l.QueryBuilderParser.updateQueryBuilder(this.props,this.state)}shouldResetToInitialState(e){return!(!e.initialState||0===Object.getOwnPropertyNames(e.initialState).length||this.props.initialState&&0!==Object.getOwnPropertyNames(this.props.initialState).length)}componentWillUmount(){super.componentWillUnmount(),l.QueryBuilderParser.unregisterQueryBuilder(this.props.id)}}}),define("query_builder",["require","exports","query_builder_component_renderable","query_builder_parser","query_builder_utilities"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("queries/query_impact/query_impact_node",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueryImpactGraphNode=class{get recursive(){return this._recursive}set recursive(e){this._recursive=e}constructor(e,t){this.successors=[],this.operation=e,this.queryIdentity=t}tryMergeSuccessors(){if(this.recursive)this.successors=[];else{for(let e=0;e<this.successors.length;e++)for(let t=e+1;t<this.successors.length;t++)this.successors[e].operation===this.successors[t].operation&&this.successors[e].queryIdentity===this.successors[t].queryIdentity&&(this.successors[e].addSuccessors(this.successors[t].successors),this.successors.splice(t,1),t--);this.successors.forEach(e=>e.tryMergeSuccessors())}}addSuccessor(e){this.successors.push(e)}addSuccessors(e){this.successors.push.apply(this.successors,e)}}}),define("queries/query_impact/query_impact_graph",["require","exports","queries/query_impact/query_impact_node","underscore","log"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueryImpactGraph=class{constructor(){this.rootNode=new i.QueryImpactGraphNode("(root)")}markAsUntracable(){n.logService.verbose("Query was made untracable due to dynamic step",{name:"QUERY_SYSTEM"}),this.untracable=!0}addBranch(e){this.rootNode.addSuccessor(e),this.activeNode=e}isEmpty(){return 0===this.rootNode.successors.length}getActiveNode(){return this.activeNode}setActiveNode(e){this.activeNode=e}deactivateActiveNode(){this.activeNode=void 0}optimize(){this.rootNode.tryMergeSuccessors()}addToActiveNode(e){s.isArray(e)?void 0===this.activeNode?e.forEach(e=>this.addBranch(e)):(this.getActiveNode().addSuccessors(e),this.activeNode=s.last(e)):void 0===this.activeNode?this.addBranch(e):(this.getActiveNode().addSuccessor(e),this.activeNode=e)}concat(e){this.rootNode.successors.push.apply(this.rootNode.successors,e.rootNode.successors)}isAffectedBy(e){return this.checkPathMatch(e.rootNode,this.rootNode)}debugPrint(){this._debugPrint(this.rootNode,"",!0)}_debugPrint(e,t,i){const n=e.recursive?"red":"";console.log(t+(i?" ":" ")+"%c"+e.operation,"color:"+n);const r=e.successors?s.flatten([e.successors]):[];for(let e=0;e<r.length;e++)this._debugPrint(r[e],t+(i?"    ":"   "),r.length===e+1)}checkPathMatch(e,t){if(e.operation!==t.operation)return!1;if(0===e.successors.length)return!0;if(0===t.successors.length)return!0;for(let i=0;i<e.successors.length;i++)for(let s=0;s<t.successors.length;s++)if(e.successors[i].operation===t.successors[s].operation)return this.checkPathMatch(e.successors[i],t.successors[s]);return!1}}}),define("queries/query_registry",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.observableQueries=[]}publishMutation(e){this.observableQueries.forEach(t=>t.checkMutation(e))}makeObservable(e){this.observableQueries.push(e)}removeObservable(e){this.observableQueries.splice(this.observableQueries.indexOf(e),1)}}t.QueryRegistry=i,t.queryRegistry=new i}),define("queries/query",["require","exports","log","queries/query_impact/query_impact_graph","queries/query_impact/query_impact_node","queries/query_registry","underscore"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e,t){this.definition=e,this.parentQuery=t||a.genesisQuery}createSubQuery(e){return new a(e,this)}hasParent(){return this.parentQuery!==a.genesisQuery}getParent(){return this.parentQuery}execute(e){e||(this.logCluster=new i.LogCluster("Query executed",i.logLevel.VERBOSE,{name:"QUERY_SYSTEM",style:"color:blue;"},!1),this.queryImpactGraph=new s.QueryImpactGraph);const t=this.getStartingData(e||this),n=this.evaluate(t,e||this);return e||(this.queryImpactGraph.optimize(),this.logCluster.addObjectWithMessage("Final Query result",n),this.logCluster.writeLog()),n}observe(e){if(void 0===this.queryImpactGraph)throw new Error("cannot watch changes on a query that was never executed, there is no reference point");if(this.queryImpactGraph.untracable)throw new Error('cannot watch changes on a query that is untracable. This means the query is not "pure" in other words the query can change based on factors that are outside of the query system');this.callback=e,r.queryRegistry.makeObservable(this)}stopObserve(){this.callback=void 0,r.queryRegistry.removeObservable(this)}checkMutation(e){void 0!==this.callback&&void 0!==this.queryImpactGraph&&this.queryImpactGraph.isAffectedBy(e)&&this.callback()}isObjectQuery(e){return!this.isSimpleQuery(e)}isSimpleQuery(e){return this.isAtomic(e)||e instanceof a||o.isArray(e)||o.isFunction(e)}evaluate(e,t){t.logCluster.addNestingLevel("Evaluating query definition");const i=this.resolveQuery(this.definition,e,t);return t.logCluster.removeNestingLevel(),i}isAtomic(e){return o.isString(e)||o.isNumber(e)||o.isBoolean(e)}queryObjectResolver(e,t,i){const s={},n=i.queryImpactGraph.getActiveNode();return o.keys(e).forEach(r=>{i.logCluster.addNestingLevel(`Evaluating query for key: ${r}`),i.queryImpactGraph.setActiveNode(n),s[r]=this.resolveQuery(e[r],t,i),i.logCluster.removeNestingLevel()}),s}resolveQuery(e,t,i){if(this.isSimpleQuery(e)){o.isArray(e)||(e=[e]);let s=!1;if(e.forEach((e,r)=>{if(!s){if(o.isFunction(e)){const n=e;if(i.queryImpactGraph.getActiveNode().recursive=!0,i.logCluster.addMessage("Node marked as recursive"),e=n(t),i.logCluster.addObjectWithMessage(`Evaluated function resolved to step ${e}`,n),void 0===e)return void(s=!0)}if(e instanceof a)t=e.evaluate(t,i);else if(o.isArray(e))i.logCluster.addMessage(`Query fork step: ${JSON.stringify(e)})`),t=e.map(e=>t[e]),i.queryImpactGraph.addToActiveNode(e.map(e=>new n.QueryImpactGraphNode(e)));else{if(!this.isAtomic(e))throw void 0===e?new Error("Query step is undefined"):new Error("Query has non atomic steps");i.logCluster.addMessage(`Query step: ${e}`),t=t[e],i.queryImpactGraph.addToActiveNode(new n.QueryImpactGraphNode(e))}}}),s)return;return i.logCluster.addObjectWithMessage("Sub query resolved with value",t),t}return this.queryObjectResolver(e,t,i)}getStartingData(e){let t;return this!==a.genesisQuery&&void 0!==this.parentQuery&&(t=this.parentQuery.execute(e)),this!==a.genesisQuery&&void 0!==this.parentQuery||(t=window),t}}t.Query=a}),define("queries/aggregation_query",["require","exports","queries/query"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AggregationQuery=class extends i.Query{constructor(e,t,i,s){super(void 0,s),this.queries=e,this.transformer=t,this.context=i}evaluate(e,t){t.queryImpactGraph.deactivateActiveNode(),e=void 0!==this.context?this.resolveQuery(this.context,e,t):i.Query.genesisQuery.evaluate(window,t);const s=t.queryImpactGraph.getActiveNode(),n=[];return this.queries.map(e=>new i.Query(e)).forEach(i=>{n.push(i.evaluate(e,t)),t.queryImpactGraph.setActiveNode(s)}),t.logCluster.addObjectWithMessage("aggregating",{values:n,transformer:this.transformer}),this.transformer(n)}}}),define("queries/transformation_query",["require","exports","queries/query"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TransformationQuery=class extends i.Query{constructor(e,t){super(void 0,t),this.transformer=e}execute(){throw new Error("transformation queries can only be used as part of a chain")}evaluate(e,t){t.queryImpactGraph.getActiveNode().recursive=!0;const i=this.transformer(e);return t.logCluster.addObjectWithMessage("Transforming query value",{input:e,output:i}),i}}}),define("queries/aggregation_queries/basic_aggregator_queries",["require","exports","queries/aggregation_query","queries/transformation_query","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=(e,t)=>(...s)=>new i.AggregationQuery(s,i=>n.reduce(i,e,t));t.queryAnd=r((e,t)=>e&&t,!0),t.queryOr=r((e,t)=>e||t,!1),t.querySum=r((e,t)=>e+t,0),t.queryNegate=new s.TransformationQuery(e=>!e),t.queryEquals=(e=>new s.TransformationQuery(t=>t===e))}),define("queries/selector_queries/property_single_selector_query",["require","exports","queries/query","queries/query_impact/query_impact_node","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PropertySingleSelectorQuery=class extends i.Query{constructor(e,t){super(void 0,void 0),this.property=e,this.delegate=t}evaluate(e,t){const i=n.find(e,e=>this.delegate(e[this.property])),r=t.queryImpactGraph.getActiveNode();return e.forEach((e,n)=>{t.queryImpactGraph.addToActiveNode(new s.QueryImpactGraphNode(n)),e!==i&&(t.queryImpactGraph.addToActiveNode(new s.QueryImpactGraphNode(this.property)),t.queryImpactGraph.getActiveNode().recursive=!0),t.queryImpactGraph.setActiveNode(r)}),i}}}),define("queries/selector_queries/property_multi_selector_query",["require","exports","queries/query","queries/query_impact/query_impact_node","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PropertyMultiSelectorQuery=class extends i.Query{constructor(e,t){super(void 0,void 0),this.property=e,this.delegate=t}evaluate(e,t){const i=n.filter(e,e=>this.delegate(e[this.property])),r=t.queryImpactGraph.getActiveNode();return e.forEach((e,o)=>{t.queryImpactGraph.addToActiveNode(new s.QueryImpactGraphNode(o)),n.contains(i,e)||(t.queryImpactGraph.addToActiveNode(new s.QueryImpactGraphNode(this.property)),t.queryImpactGraph.getActiveNode().recursive=!0),t.queryImpactGraph.setActiveNode(r)}),i}}}),define("queries/atomic_queries/special_queries",["require","exports","underscore","queries/selector_queries/property_single_selector_query","queries/selector_queries/property_multi_selector_query"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryFilterByProperty=((e,t)=>new n.PropertyMultiSelectorQuery(e,e=>i.contains(t,e))),t.queryExcludeByProperty=((e,t)=>new n.PropertyMultiSelectorQuery(e,e=>!i.contains(t,e))),t.queryFindByProperty=((e,t)=>new s.PropertySingleSelectorQuery(e,e=>e===t)),t.queryArrayIndex=(e=>e)}),define("queries/atomic_queries/underscore_queries",["require","exports","underscore","queries/transformation_query"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryUnderscore={filter:e=>t=>{const i=[];for(let s=0;s<t.length;s++)e(t[s])&&i.push(s);return i},first:e=>e[0],find:e=>t=>{for(let i=0;i<t.length;i++)if(e(t[i]))return i},any:(...e)=>new s.TransformationQuery(i.partial(i.any,i,...e)),pick:(...e)=>new s.TransformationQuery(i.partial(i.pick,i,...e)),omit:(...e)=>new s.TransformationQuery(i.partial(i.omit,i,...e)),map:e=>new s.TransformationQuery(i.partial(i.map,i,e)),reduce:(e,t)=>new s.TransformationQuery(i.partial(i.reduce,i,e,t))}}),define("queries/fork_query",["require","exports","queries/query","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ForkQuery=class extends i.Query{constructor(e,t,i,s){super(e,s),this.handler=t,this.context=i}evaluate(e,t){t.logCluster.addNestingLevel("Fork query");const s=t.queryImpactGraph.getActiveNode(),n=super.evaluate(e,t);t.queryImpactGraph.setActiveNode(s);const r=this.resolveQuery(this.decide(n,t),this.resolveQuery(this.context||i.Query.genesisQuery,this.context?i.Query.genesisQuery.execute(t):window,t),t);return t.logCluster.removeNestingLevel(),r}decide(e,t){let i;return i=s.isFunction(this.handler)?this.handler(e):this.handler[e],t.logCluster.addObjectWithMessage("Query fork result",{conditionValue:e,selectedBranch:i}),i}}}),define("queries/property_mutation_query",["require","exports","queries/query","queries/query_registry","queries/query_impact/query_impact_node","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PropertyMutationQuery=class extends i.Query{constructor(e,t,i){super(e,i),this.mutator=t}evaluate(e,t){e=this.resolveQuery(this.definition,e,t),t.queryImpactGraph.getActiveNode().addSuccessors(r.keys(this.mutator).map(e=>new n.QueryImpactGraphNode(e))),r.keys(this.mutator).forEach(t=>{e[t]=this.mutator[t]}),s.queryRegistry.publishMutation(t.queryImpactGraph)}}}),define("queries/provider_query",["require","exports","queries/query","queries/query_impact/query_impact_node"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProviderQuery=class extends i.Query{constructor(e){super([]),this.data=e}evaluate(e,t){return t.queryImpactGraph.deactivateActiveNode(),t.logCluster.addObjectWithMessage("Providing value",this.data),t.queryImpactGraph.addToActiveNode(new s.QueryImpactGraphNode("(ProviderQuery)",this)),this.data}}}),define("queries/query_array_to_map",["require","exports","queries/query","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueryArrayToMap=class extends i.Query{constructor(e,t,i={}){const{context:s,parent:n}=i;super(e,n),this.options=i,this.delegate=t,this.context=s}evaluate(e,t){const{keyMap:n=s.identity}=this.options,r=super.evaluate(e,t);if(void 0===r)return;if(!s.isArray(r))throw new Error("Query array to map can only work with arrays");const o={};return r.forEach(e=>{o[n(e)]=this.resolveQuery(this.delegate(e),this.resolveQuery(this.context||i.Query.genesisQuery,this.context?i.Query.genesisQuery.execute():window,t),t)}),o}}}),define("query_system",["require","exports","queries/aggregation_queries/basic_aggregator_queries","queries/atomic_queries/special_queries","queries/atomic_queries/underscore_queries","queries/fork_query","queries/property_mutation_query","queries/provider_query","queries/query","queries/query_array_to_map","queries/query_registry","queries/transformation_query"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";function u(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),u(i),u(s),u(n),u(r),u(o),u(a),u(l),u(c),u(d),u(h)}),define("queries/mutation_query",["require","exports","queries/query","queries/query_registry"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MutationQuery=class extends i.Query{constructor(e,t,i){super(e,i),this.mutator=t}evaluate(e,t){this.mutator(e),s.queryRegistry.publishMutation(t.queryImpactGraph)}}}),define("components/menu_item_renderable",["require","exports","flux","react","classnames","event_bus","components/menu_renderable","reusable_services"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchMenuItemRenderable=class extends i.BaseComponent{renderChildren(){const{children:e,level:t}=this.props;return void 0!==e&&e.length>0?s.createElement(o.QuickSearchMenuRenderable,{level:t+1,items:e}):null}renderIcon(e){if(void 0!==e.faIconClass){const t=n({fa:!0,[e.faIconClass]:!0});return s.createElement("i",{className:t})}}renderBody(){const{children:e}=this.props,t=void 0!==e&&e.length>0;return s.createElement("p",null,this.renderIcon(this.props),this.renderText(this.props),t?s.createElement("i",{className:"fa fa-caret-right"}):null)}renderText(e){const{text:t}=e,i={__html:a.emojiService.parseTextForEmoji(t)};return s.createElement("span",{dangerouslySetInnerHTML:i})}itemClick(e){e.stopPropagation();const{action:t}=this.props;void 0!==t&&r.eventBus.dispatch({type:t.type,value:t.value})}getClassNames(){const{children:e,action:t}=this.props;return n({sub:void 0!==e&&e.length>0,clickable:void 0!==t})}render(){return s.createElement("li",{className:this.getClassNames(),onClick:this.itemClick.bind(this)},this.renderBody(),this.renderChildren())}}}),define("components/menu_renderable",["require","exports","flux","react","components/menu_item_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchMenuRenderable=class extends i.BaseComponent{getClassName(){return 0===this.props.level?"menu top-menu":"menu sub"}render(){return s.createElement("ul",{className:this.getClassName()},this.props.items.map((e,t)=>s.createElement(n.QuickSearchMenuItemRenderable,Object.assign({},e,{key:t,level:this.props.level+1}))))}}}),define("components/menu_component",["require","exports","react","classnames","flux","event_bus","components/menu_renderable","reusable_components"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchMenuComponent=class extends n.BaseComponent{constructor(e){super(e),this.state={open:!1}}componentDidMount(){const e=this.cancellationToken;e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_CATEGORY,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_ITEM,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,this.closeMenu.bind(this))}renderDots(){return i.createElement("div",{className:"dots",onClick:this.toggleOpen.bind(this)},i.createElement("i",{className:"fa icon-tw-ellipsis fa-rotate-90"}))}toggleOpen(){this.setState({open:!this.state.open})}closeMenu(){this.setState({open:!1})}render(){const e=s({open:this.state.open});return i.createElement(a.DocumentClickTrackerWrapper,{clickOutside:this.closeMenu.bind(this),className:e,id:"quicksearch-menu"},this.renderDots(),i.createElement(o.QuickSearchMenuRenderable,Object.assign({},this.props,{level:0})))}}}),define("quicksearch_menu",["require","exports","components/menu_component","components/menu_item_renderable","components/menu_renderable"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("css/menu.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quickSearchMenuStyleModel={quicksearchmenu:{}},t.quickSearchMenuStyle=i.createCssModule(()=>t.quickSearchMenuStyleModel).compute({}).attach().getModule()}),define("components/save_menu_button_renderable",["require","exports","flux","react","event_bus"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchSavedButtonRenderable=class extends i.BaseComponent{itemClick(e){e.stopPropagation();const{clickAction:t}=this.props;void 0!==t&&n.eventBus.dispatch({type:t.type,value:t.value})}render(){return s.createElement("li",{onClick:this.itemClick.bind(this),className:"saved-search-button"},s.createElement("i",{className:this.props.icon}),s.createElement("span",null,this.props.text))}}}),define("components/save_menu_item_renderable",["require","exports","flux","react","event_bus"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchSavedItemRenderable=class extends i.BaseComponent{itemClick(e){e.stopPropagation();const{selectAction:t}=this.props;n.eventBus.dispatch({type:t.type,value:t.value}),n.eventBus.dispatch({type:n.EVENT_TYPES.FILTER_CLOSE_MENUS,value:{}})}itemDeleteClick(e){e.stopPropagation();const{deleteAction:t}=this.props;n.eventBus.dispatch({type:t.type,value:t.value}),n.eventBus.dispatch({type:n.EVENT_TYPES.FILTER_CLOSE_MENUS,value:{}})}renderNumber(){return this.props.numItems>1?s.createElement("i",{className:"search-num"},this.props.numItems):void 0}renderTrash(){return void 0!==this.props.deleteAction?s.createElement("i",{className:"fa fa-trash",onClick:this.itemDeleteClick.bind(this)}):void 0}render(){return s.createElement("li",{onClick:this.itemClick.bind(this),className:"saved-search-item"},s.createElement("span",null,this.props.text),s.createElement("span",null,this.renderNumber(),this.renderTrash()))}}}),define("components/save_menu_component",["require","exports","react","classnames","flux","event_bus","components/save_menu_item_renderable","components/save_menu_button_renderable","reusable_components"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QuickSearchSavedComponent=class extends n.BaseComponent{constructor(e){super(e),this.state={open:!1}}componentDidMount(){const e=this.cancellationToken;e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_CATEGORY,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_SELECT_ITEM,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_UNSELECT_ALL,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.GRID_PAGE_ACTIVE_INDEX_CHANGE,this.closeMenu.bind(this)),e.subscribeToStream(r.eventBus,r.EVENT_TYPES.QUICKSEARCH_MENU_OPEN,this.openMenu.bind(this))}openMenu(){this.setState({open:!0})}renderDots(){return i.createElement("div",{className:"dots",onClick:this.toggleOpen.bind(this)},i.createElement("i",{className:"fa icon-tw-ellipsis fa-rotate-90"}))}toggleOpen(){r.eventBus.dispatch({type:r.EVENT_TYPES.QUICKSEARCH_SAVED_TOGGLE,value:!this.state.open}),this.setState({open:!this.state.open})}closeMenu(){r.eventBus.dispatch({type:r.EVENT_TYPES.QUICKSEARCH_SAVED_TOGGLE,value:!1}),this.setState({open:!1})}getClassName(){return"saved-menu"}renderNoItems(){return i.createElement("li",{className:"no-items",key:0},i.createElement("span",null,this.props.emptyLabel))}renderItems(){return 0===this.props.items.length?[this.renderNoItems()]:this.props.items.map((e,t)=>i.createElement(o.QuickSearchSavedItemRenderable,Object.assign({},e,{key:"search-saved-item-"+t})))}renderMenu(){const{open:e}=this.state,{width:t,title:s,buttons:n}=this.props,r=this.props.items.length,o=this.props.buttons.length;let l=49;l+=44*(Math.ceil(r/6)+Math.ceil(o/6)),0===r&&(l+=20);const c={width:t,pointerEvents:e?void 0:"none",height:this.state.open?l+"px":"0px"};return i.createElement("ul",{className:this.getClassName(),style:c},n&&n.map((e,t)=>i.createElement(a.QuickSearchSavedButtonRenderable,Object.assign({},e,{key:"search-saved-item-"+t}))),i.createElement("li",{className:"saved-title",key:"search-saved-item--1"},i.createElement("span",null,s),i.createElement("hr",null)),this.renderItems())}render(){const e=s({open:this.state.open});return i.createElement(l.DocumentClickTrackerWrapper,{clickOutside:this.closeMenu.bind(this),className:e,id:"quicksearch-saved"},this.renderDots(),this.renderMenu())}}}),define("quicksearch_saved",["require","exports","components/save_menu_button_renderable","components/save_menu_component","components/save_menu_item_renderable"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("actions/radar_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadarActions={radar_onMouseEnter:"radar_onMouseEnter",radar_onMouseLeave:"radar_onMouseLeave",radar_onMouseClick:"radar_onMouseClick",radar_onAxisLegendMouseEnter:"radar_onAxisLegendMouseEnter",radar_onAxisLegendMouseLeave:"radar_onAxisLegendMouseLeave"}}),define("classes/abstract_radar_entity",["require","exports","canvas_engine"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractRadarEntity=class extends i.Entity{constructor(e,t,i){super(e,[],void 0),this.checkCursorPredicate=((e,t,i)=>e.containsPoint(t,i)),this.timeline=i,this.animationComponent=t}showPointer(e){if(!this.getStageFacade().isCursorPointer()){const t=this.getStageFacade(),s=t.getActiveCamera(),n=s.stageToCameraCoordinates(t.getCurrentMousePosition());this.checkCursorPredicate(e,n,s)&&(this.getStageFacade().getCanvas().style.cursor=i.Constants.Mouse.Cursor.Pointer),i.ObjectCache.recycleObject(n)}return this}resetCursor(e){const t=this.getStageFacade(),s=t.getActiveCamera(),n=s.stageToCameraCoordinates(t.getCurrentMousePosition());return this.checkCursorPredicate(e,n,s)||this.getStageFacade().resetCursor(),i.ObjectCache.recycleObject(n),this}}}),define("models/radar_model_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{}i.RADAR_CHART_ROW_AXES="RADAR_CHART_ROW_AXES",i.RADAR_CHART_COLUMN_AXES="RADAR_CHART_COLUMN_AXES",i.RADAR_CHART_MULTI_METRIC_COLUMN_AXES="RADAR_CHART_MULTI_METRIC_COLUMN_AXES",t.RadarModelType=i}),define("models/radar_model",["require","exports","data_structures","reusable_utilities","underscore","models/radar_model_type"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarChartModel=class extends i.AbstractDatamodel{constructor(e,t=r.RadarModelType.RADAR_CHART_COLUMN_AXES){super(e),this.axesData=[],this.axesMap={},this.polygonsData=[],this.datagraph=e,this.radarModelType=t,this.buildAxisData(),this.buildDatasets()}getPolygonsData(){return this.polygonsData}getAxesData(){return this.axesData}createDataSet(e,t,s,n,r,o,a,l){const c=new i.Dataset(e,s);return c.setSubLabel(n),c.setId(r),c.setPopoverFooter(o),c.setOldValue(t),c.setFilters(a),c.setAdditionalMetric(l),c}addPolygonData(e,t,i,s){let r=n.find(this.polygonsData,({label:t})=>t===e);return void 0===r?(r={color:t,label:e,id:s.getId(),maxValue:i,datasets:[s]},this.polygonsData.push(r)):(r.maxValue+=i,r.datasets.push(s)),this}isMultriMetric(){return this.radarModelType===r.RadarModelType.RADAR_CHART_MULTI_METRIC_COLUMN_AXES||this.radarModelType===r.RadarModelType.RADAR_CHART_ROW_AXES}shortenLabel(e){let t=!0;if(e.length>26){const i=e.split(" ");if(i.reduce((e,t)=>Math.max(e,t.length),0)>26)e=e.substring(0,26).trim()+"...";else{let s="";for(;i.length>0&&(s+""+i[0]).length<=26;)s+=(t?"":" ")+i.shift(),t=!1;e=s+"..."}}return e}pushToAxesData(e,t,i){const s=t,n=(t=this.shortenLabel(t)).length!==s.length;return this.axesData.push({id:e,label:t,total:i,shortened:n,fullLabel:s,maxPercentage:0}),this.axesMap[e]=this.axesData[this.axesData.length-1],this}buildAxisData(){switch(this.axesData=[],this.polygonsData=[],this.axesMap={},this.radarModelType){case r.RadarModelType.RADAR_CHART_ROW_AXES:this.datagraph.getRows().forEach(e=>{this.pushToAxesData(e.getCode(),e.getFormattedLabel(),100)});break;case r.RadarModelType.RADAR_CHART_MULTI_METRIC_COLUMN_AXES:case r.RadarModelType.RADAR_CHART_COLUMN_AXES:this.datagraph.getColumns().forEach(e=>{this.pushToAxesData(e.getCode(),e.getFormattedLabel(),100)});break;default:throw new Error("Invalid RadarModelType:"+this.radarModelType)}return this}buildDatasets(){return this.datasets=[],this.datagraph.getRows().forEach(e=>{e.getCells().forEach(t=>{const i=t.getColumn(),n=t.getNumericData(),o=t.getOldNumericData(),a=s.StringUtils.parseFilters(e.getFilters());let l,c,d,h,u,p,g;switch(i.getFilter().length>0&&a.push(i.getFilter()[0]),this.radarModelType){case r.RadarModelType.RADAR_CHART_ROW_AXES:c=e.getFormattedLabel(),d=i.getCode(),u=e.getCode(),l=i.getTwColor(),h=i.getFormattedLabel(),g=n/(p=i.getCells().reduce((e,t)=>e+=t.getNumericData(),0))*100,isNaN(g)&&(g=0),this.axesMap[u].maxPercentage=Math.max(g,this.axesMap[u].maxPercentage);break;case r.RadarModelType.RADAR_CHART_COLUMN_AXES:case r.RadarModelType.RADAR_CHART_MULTI_METRIC_COLUMN_AXES:c=i.getFormattedLabel(),d=e.getCode(),u=i.getCode(),l=e.getTwColor(),h=e.getFormattedLabel(),g=n/(p=e.getCells().reduce((e,t)=>e+=t.getNumericData(),0))*100,isNaN(g)&&(g=0),this.axesMap[u].maxPercentage=Math.max(g,this.axesMap[u].maxPercentage);break;default:throw new Error("Invalid RadarModelType:"+this.radarModelType)}const m=[a],_=this.createDataSet(n,o,l,c,d,h,m,{percentage:g,axisId:u});this.addPolygonData(d,l,n,_),this.addDataset(_)})}),this.isSampleData=this.datagraph.isSampleData(),this.setLabel(this.datagraph.getLabel()),this}}}),define("interfaces/radar_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SINGLE=0]="SINGLE",e[e.MULTI=1]="MULTI",e[e.BREAKING=2]="BREAKING"}(t.RadarAxisLabelType||(t.RadarAxisLabelType={})),function(e){e[e.HOVER=0]="HOVER",e[e.FADE_OUT=1]="FADE_OUT"}(t.RadarPolygonAnimationTypes||(t.RadarPolygonAnimationTypes={}))}),define("classes/radar_axis",["require","exports","canvas_engine","reusable_utilities","classes/abstract_radar_entity"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends n.AbstractRadarEntity{constructor(e,t=new i.AnimationComponent,n=new i.Timeline){super(i.Presence.PresencePool.getObject().setCoordinates(e.center.getX(),e.center.getY()),t,n),this.lengthMultiplier=1,this.props=e,this.total=e.total,this.margin=e.margin,this.angle=e.angle,this.oldAngle=e.angle,this.labelSettings=new i.LabelSettings,this.labelSettings.setColor(s.Color.DARK_GREY()),this.createAxis()}getTotal(){return this.total}setTotal(e){return this.total=e,this}getID(){return this.props.id}getCircles(){return this.circles}getLine(){return this.line}getLabel(){return this.props.legendLabel}setMargin(e){return this.margin=e,this}transitionStaticLine(e,t,s,n=1){const r=this.generateAxisPoint(this.props.length-this.margin,!0,!0,this.angle).subtract(this.getPresence()),o=[{key:"x",value:r.getX(),duration:s},{key:"y",value:r.getY(),duration:s}];e.addSequence(t.tween(this.line.getPoints()[0],o,this.line.getNodeId()+"changeAngle"));const a=[{key:i.Style.Opacity,value:n,duration:s}];return e.addSequence(t.tween(this.line,a,this.line.getNodeId()+"changeOpacity")),this.circles.forEach((r,o)=>{const a=(this.props.length-this.margin)/this.labels.length,l=[{key:"presence",value:this.generateAxisPoint(a*(o+1)-1,!1,!1,this.angle),duration:s},{key:i.Style.Opacity,value:n,duration:s}];e.addSequence(t.tween(r,l,r.getNodeId()+"changeAngle"+o))}),this}transitionDynamicLine(e,t,s,n=1){let r=this.oldAngle;const o=this.angle;let a=o-r;-180===o&&r>=0?a=180-r:-180===r&&o>0&&(a=-(360-a));const l=a/12;let c=0;for(let o=0;o<12;o++){r+=l;const a=this.generateAxisPoint(this.props.length-this.margin,!0,!0,r).subtract(this.getPresence()),d=[{key:"x",value:a.getX(),duration:s/12},{key:"y",value:a.getY(),duration:s/12}];e.addSequence(t.tween(this.line.getPoints()[0],d,this.line.getNodeId()+"changeAngle"+o),c);const h=[{key:i.Style.Opacity,value:n,duration:s/12}];e.addSequence(t.tween(this.line,h,this.line.getNodeId()+"changeOpacity"+o),c),this.circles.forEach((a,l)=>{const d=(this.props.length-this.margin)/this.labels.length,h=[{key:"presence",value:this.generateAxisPoint(d*(l+1)-1,!1,!1,r),duration:s/12},{key:i.Style.Opacity,value:n,duration:s/12}];e.addSequence(t.tween(a,h,a.getNodeId()+"changeAngle"+o+l),c)}),c+=s/12}return this}transitionLine(e,t,i,s=1){return this.oldAngle===this.angle?this.transitionStaticLine(e,t,i,s):this.transitionDynamicLine(e,t,i,s),this}transitionLegend(e,t,s,n=!1){if(void 0!==this.legend){const n=[{key:i.Style.Opacity,value:0,duration:s/2}],r=t.tween(this.legend,n,this.legend.getNodeId()+"hide");e.addSequence(r)}if(!n){this.legend.getPresence().setStyle(i.Style.RotationAngle,i.getDefaultStyle(i.Style.RotationAngle));const n=this.legend.getPresence().getBoundingBox(!0),r=n.height;i.ObjectCache.recycleObject(n);const o=this.generateAxisPoint(this.props.length+r/2-this.margin+4);this.legend.getPresence().setCoordinates(o.getX(),o.getY()),this.legend.getPresence().setStyle(i.Style.RotationAngle,this.getLegendAngle());const a=[{key:i.Style.Opacity,value:1,duration:s/2}];this.legend.setStyle(i.Style.Opacity,0);const l=t.tween(this.legend,a,this.legend.getNodeId()+"show");e.addSequence(l,s/2)}return this}setAngle(e){return this.oldAngle=this.angle,this.angle=e,this}fadeOut(e,t,i,s){return this.setAngle(s),this.transitionLine(e,t,i,0).transitionLegend(e,t,i,!0),this}changeAngle(e,t,i,s,n){return this.setAngle(s),this.transitionLine(e,t,i,1),n&&this.transitionLegend(e,t,i),this}prepareLabels(){const e=[],t=100/this.props.numCircles;for(let i=0;i<this.props.numCircles;i++)e.push(Math.ceil(t*(i+1))+"%");return this.labels=e,this}buildInitialAnimation(e){const t=[{key:"x",value:this.line.getPoints()[0].getX(),duration:e},{key:"y",value:this.line.getPoints()[0].getY(),duration:e}];this.line.getPoints()[0].setCoordinates(0,0),this.timeline.addSequence(this.animationComponent.tween(this.line.getPoints()[0],t,this.line.getNodeId())),this.circles.forEach(t=>{const s=[{key:"presence",value:t.getPresence().toRelativePoint(),duration:e},{key:i.Style.Opacity,value:1,duration:e}];t.getPresence().setCoordinates(0,0),t.setStyle(i.Style.Opacity,0),this.timeline.addSequence(this.animationComponent.tween(t,s,t.getNodeId()))});const s=[{key:i.Style.Opacity,value:1,duration:e}];this.legend.setStyle(i.Style.Opacity,0),this.timeline.addSequence(this.animationComponent.tween(this.legend,s,this.legend.getNodeId()),e)}getAngle(){return this.angle}generateAxisPoint(e,t=!1,s=!1,n){const r=i.Utilities.rotatePoint(i.Point.zero().setCoordinates(-1,e*(t?this.lengthMultiplier:1)),n?-n:-this.angle,i.Point.zero());return s?r.translate(this.getPresence().getRelativeX(),this.getPresence().getRelativeY()):r}getValuePoint(e){return this.generateAxisPoint(e/100*(this.props.length-this.margin),!0,!0)}createAxisCircle(e){const t=new i.CircleComponent(new i.Circle(e.getX(),e.getY(),2.5));return t.setStyle(i.Style.Color,this.props.color),this.addComponent(t),this.circles.push(t),this}createLine(){return this.line=new i.LineComponent(i.Presence.zeroTopLeft(),this.generateAxisPoint(this.props.length-this.margin,!0,!0).subtract(this.getPresence())),this.line.setStyle(i.Style.BorderColor,this.props.color).setStyle(i.Style.BorderThickness,1.5),this.addComponent(this.line),this}getLegendAngle(){let e=this.angle+180;return this.angle<=90&&this.angle>=-90&&(e-=180),-e}getLegend(){return this.props.legend}setMouseEvents(e,t){return void 0!==this.legend&&(this.legend.setInteractiveState(!0),void 0!==this.legendMouseEnterSub&&(this.legendMouseEnterSub.cancel(),this.legendMouseLeaveSub.cancel()),this.legendMouseEnterSub=this.legend.onMouseEnter.subscribe(()=>{this.showPointer(this),e(this.props.fullLegendLabel,this.legend)}),this.legendMouseLeaveSub=this.legend.onMouseLeave.subscribe(()=>{this.resetCursor(this),t(this.props.fullLegendLabel,this.legend)})),this}static getAxisLegendHeight(e){const t=e.getStyle(i.Style.RotationAngle),s=e.getStyle(i.Style.RotationPoint);e.getStyleMap().resetStyle(i.Style.RotationAngle),e.getStyleMap().resetStyle(i.Style.RotationPoint);const n=e.getPresence().getBoundingBox(!0),r=n.height;return e.getStyleMap().setStyle(i.Style.RotationAngle,t),e.getStyleMap().setStyle(i.Style.RotationPoint,s),i.ObjectCache.recycleObject(n),r}prepareLineLegend(){const e=this.props.legend,t=r.getAxisLegendHeight(e),s=this.generateAxisPoint(this.props.length+t/2-this.margin+4);return e.getPresence().setCoordinates(s.getX(),s.getY()),e.getPresence().setStyle(i.Style.RotationOrigin,"center").setStyle(i.Style.RotationAngle,this.getLegendAngle()),e.setLayer(1),e.setStyle(i.Style.RotationPoint,i.Point.zero()),this.addComponent(e),e.setStageFacade(this.getStageFacade()),e.subscribeToStage(),e}createAxis(){this.prepareLabels(),this.circles=[],this.createLine(),this.legend=this.prepareLineLegend();const e=(this.props.length-this.margin)/this.labels.length;return this.labels.forEach((t,i)=>{const s=this.generateAxisPoint(e*(i+1)-1);this.createAxisCircle(s)}),this}draw(e){super.draw(e)}}t.RadarAxis=r}),define("classes/radar_circles",["require","exports","canvas_engine","classes/abstract_radar_entity"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarCircles=class extends s.AbstractRadarEntity{constructor(e,t=new i.AnimationComponent,s=new i.Timeline){super(i.Presence.PresencePool.getObject().setCoordinates(e.center.getX(),e.center.getY()),t,s),this.props=e,this.margin=e.margin,this.buildCircles()}getCircles(){return this.circles}buildInitialAnimation(e){let t=0;const s=e/this.circles.length;this.circles.forEach(n=>{const r=[{key:i.Style.Radius,value:n.getStyle(i.Style.Radius),duration:e-t},{key:i.Style.Depth,value:n.getStyle(i.Style.Depth),duration:e-t}];this.timeline.addSequence(this.animationComponent.tween(n,r,n.getNodeId()),t),n.setStyle(i.Style.Radius,0),n.setStyle(i.Style.Depth,0),t+=s})}calculateRadiusSteps(){return Math.max(1,this.props.radius-this.margin)/this.props.numCircles}transition(e,t,s,n){this.margin=n;const r=this.calculateRadiusSteps();return this.circles.forEach((n,o)=>{const a=r*(this.props.numCircles-o),l=Math.max(1,a-1),c=[{key:i.Style.Radius,value:a,duration:s},{key:i.Style.Depth,value:l,duration:s}],d=t.tween(n,c,n.getNodeId()+"radiusChange");e.addSequence(d)}),this}buildCircles(){this.circles=[];const e=this.calculateRadiusSteps();for(let t=0;t<this.props.numCircles;t++){const s=e*(this.props.numCircles-t),n=Math.max(1,s-1),r=new i.CircleComponent(new i.Circle(0,0,s,n));r.setStyle(i.Style.Color,this.props.color),this.addComponent(r),this.circles.push(r)}return this}draw(e){super.draw(e)}}}),define("classes/radar_legend",["require","exports","canvas_engine","classes/abstract_radar_entity"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarLegend=class extends s.AbstractRadarEntity{constructor(e,t=new i.AnimationComponent,s=new i.Timeline){super(i.Presence.PresencePool.getObject().setCoordinates(e.center.getX(),e.center.getY()),t,s),this.axisLabelMargin=3,this.maxValueChanged=!1,this.props=e,this.maxValue=e.maxValue,this.margin=e.margin,this.labelSettings=new i.LabelSettings,this.labelSettings.setFontSize(Math.max(1,.8*this.props.scaling)*this.labelSettings.getFontSize()).setColor(e.color),this.createAxisLabels()}setMaxValue(e){return this.maxValueChanged=e!==this.maxValue,this.maxValue=e,this}setMargin(e){return this.margin=e,this}transition(e,t,i){if(this.maxValueChanged){const s=this.labels;this.prepareLabels(),this.labelComponents.forEach((n,r)=>{const o=[{key:"percentage",value:Number(this.labels[r].replace("%","")),duration:i}],a={percentage:Number(s[r].replace("%",""))};e.addSequence(t.tween(a,o,n.getNodeId()+"transitionPercentage"+r));const l=e.onStep.subscribe(()=>{n.setText(Math.round(a.percentage)+"%")});e.onDone.subscribeOnceAsPromise().then(()=>{l.cancel(),n.setText(Math.round(a.percentage)+"%")})})}return this.labelComponents.forEach((s,n)=>{const r=(this.props.length-this.margin)/this.labels.length,o=this.generateAxisPoint(r*(n+1)-1,!1);o.setX(o.getX()+this.axisLabelMargin);const a=[{key:"presence",value:o,duration:i}];e.addSequence(t.tween(s,a,s.getNodeId()+"transition"+n))}),this}prepareLabels(){const e=[],t=this.maxValue/this.props.numCircles;for(let i=0;i<this.props.numCircles;i++)e.push(Math.ceil(t*(i+1))+"%");return this.labels=e,this}buildInitialAnimation(e){this.labelComponents.forEach(t=>{const s=[{key:"presence",value:t.getPresence().toRelativePoint(),duration:e},{key:i.Style.Opacity,value:1,duration:e}];t.getPresence().setCoordinates(0,0),t.setStyle(i.Style.Opacity,0),this.timeline.addSequence(this.animationComponent.tween(t,s,t.getNodeId()))})}generateAxisPoint(e,t=!1){const s=i.Point.zero().setCoordinates(0,-e);return t?s.translate(this.getPresence().getX(),this.getPresence().getY()):s}createLabel(e,t){const s=new i.LabelComponent(i.Presence.PresencePool.getObject().setCoordinates(t.getX()+this.axisLabelMargin,t.getY()),e,this.labelSettings);return s.setLayer(1),this.addComponent(s),this.labelComponents.push(s),this}createAxisLabels(){this.prepareLabels(),this.labelComponents=[];const e=(this.props.length-this.margin)/this.labels.length;return this.labels.forEach((t,i)=>{const s=this.generateAxisPoint(e*(i+1)-1);this.createLabel(t,s)}),this}draw(e){super.draw(e)}}}),define("classes/radar_polygon",["require","exports","canvas_engine","reusable_utilities","classes/abstract_radar_entity","underscore","interfaces/radar_interfaces"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarPolygon=class extends n.AbstractRadarEntity{constructor(e,t,s,n){super(i.Presence.PresencePool.getObject().setCoordinates(e.center.getX(),e.center.getY()),s,n),this.mouseAnimationDuration=200,this.circleRadius=3,this.grayedOut=!1,this.mouseAnimationsBuilt=!1,this.mouseInteractionsBuilt=!1,this.props=e,this.datasets=this.props.data.datasets,this.points=e.points,this.buildPolygon(),this.id=t,this.subs=[]}setGrayedOut(e){if(this.grayedOut=e,e){const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+o.RadarPolygonAnimationTypes.FADE_OUT);void 0!==e&&(e.isReversed()?e.setReverseState(!1):e.reset(),e.getState()!==i.Constants.State.Animation.Playing&&e.resume(),this.polygonComponent.setLayer(2),this.circles.forEach(({circle:e,hoverCircle:t})=>{e.setLayer(2),t.setLayer(2)}))}else{const e=this.animationComponent.accessSequenceFor(this.getNodeId().toString()+o.RadarPolygonAnimationTypes.FADE_OUT);void 0!==e&&(e.isReversed()?e.reset():e.setReverseState(!0),e.getState()!==i.Constants.State.Animation.Playing&&e.resume(),this.polygonComponent.setLayer(3),this.circles.forEach(({circle:e,hoverCircle:t})=>{e.setLayer(3),t.setLayer(3)}))}return this}isGrayedOut(){return this.grayedOut}getID(){return this.id}buildAnimation(e,t,s=0){const n=[{key:i.Style.Opacity,value:1,duration:e}];return t.addSequence(this.animationComponent.tween(this.polygonComponent,n,this.polygonComponent.getNodeId()),s),this.polygonComponent.setStyle(i.Style.Opacity,0),this.circles.forEach(({circle:n,hoverCircle:r})=>{const o=[{key:i.Style.Opacity,value:1,duration:e}];n.setStyle(i.Style.Opacity,0),t.addSequence(this.animationComponent.tween(n,o,n.getNodeId()),s),r.setStyle(i.Style.Opacity,0),t.addSequence(this.animationComponent.tween(r,o,r.getNodeId()),s)}),this}buildInitialAnimation(e){this.buildAnimation(e,this.timeline,e)}buildMouseAnimations(){if(this.mouseAnimationsBuilt)return this;this.mouseAnimationsBuilt=!0;const e=[{key:i.Style.Opacity,value:0,duration:this.mouseAnimationDuration}],t=this.animationComponent.tween(this.polygonComponent,e,this.getNodeId().toString()+o.RadarPolygonAnimationTypes.FADE_OUT);return this.circles.forEach(({circle:s})=>{const n=[{key:i.Style.Radius,value:2*this.circleRadius,duration:this.mouseAnimationDuration}];this.animationComponent.tween(s,n,s.getNodeId().toString()+o.RadarPolygonAnimationTypes.HOVER),t.chainSequence(this.animationComponent.tween(s,e))}),this}setMouseEvents(e,t,s){return this.mouseInteractionsBuilt?this:(this.mouseInteractionsBuilt=!0,this.subs.forEach(e=>{e.cancel()}),this.subs=[],this.circles.forEach(({circle:n,hoverCircle:r,dataset:a})=>{r.setInteractiveState(!0),this.subs.push(r.onMouseEnter.subscribe(t=>{if(this.grayedOut)return;this.showPointer(this);const s=this.animationComponent.accessSequenceFor(n.getNodeId().toString()+o.RadarPolygonAnimationTypes.HOVER);s.isReversed()?s.setReverseState(!1):s.reset(),s.getState()!==i.Constants.State.Animation.Playing&&s.resume(),this.polygonComponent.setLayer(3),n.setLayer(3),e.fire({event:t,circle:n,color:this.props.data.color,dataset:a})})),this.subs.push(r.onMouseLeave.subscribe(e=>{if(this.grayedOut)return;this.resetCursor(this);const s=this.animationComponent.accessSequenceFor(n.getNodeId().toString()+o.RadarPolygonAnimationTypes.HOVER);s.isReversed()?s.reset():s.setReverseState(!0),s.getState()!==i.Constants.State.Animation.Playing&&s.resume(),this.polygonComponent.setLayer(2),n.setLayer(2),t.fire({event:e,circle:n,color:this.props.data.color,dataset:a})})),this.subs.push(r.onMouseClick.subscribe(e=>{this.resetCursor(this);const t=this.animationComponent.accessSequenceFor(n.getNodeId().toString()+o.RadarPolygonAnimationTypes.HOVER);t.isReversed()?t.reset():t.setReverseState(!0),t.getState()!==i.Constants.State.Animation.Playing&&t.resume(),this.polygonComponent.setLayer(2),n.setLayer(2),s.fire({event:e,circle:n,color:this.props.data.color,dataset:a})}))}),this)}transitionToNewPolygon(e,t,s,n,r){this.datasets=r,this.points=n;const o=this.polygonComponent,a=this.circles;a.forEach(({circle:n,hoverCircle:r})=>{const o=[{key:i.Style.Opacity,value:1,duration:s/2}];n.getPresence().setCoordinates(0,0),n.setStyle(i.Style.Opacity,0),e.addSequence(t.tween(n,o,n.getNodeId()+"fadeOut")),r.getPresence().setCoordinates(0,0),r.setStyle(i.Style.Opacity,0),e.addSequence(t.tween(r,o,r.getNodeId()+"fadeOut"))});const l=[{key:i.Style.Opacity,value:0,duration:s/2}],c=t.tween(o,l,o.getNodeId()+"hide");return this.buildPolygon(),this.mouseInteractionsBuilt=!1,this.mouseAnimationsBuilt=!1,this.buildAnimation(s,e,s/2),c.onDone.subscribeOnce(()=>{this.removeComponent(o,!0),a.forEach(({circle:e,hoverCircle:t})=>{this.removeComponent(e,!0),this.removeComponent(t,!0)})}),e.addSequence(c),this}transitionCurrentPolygon(e,t,i,s,n){let o=0;return r.each(s,s=>{const n=this.circles[o],r=this.polygonComponent.getPoints()[o],a=s.subtract(this.getPresence()),l=[{key:"presence",value:a,duration:i}];e.addSequence(t.tween(n.circle,l,n.circle.getNodeId()+"position"+o));const c=[{key:"presence",value:a,duration:i}];e.addSequence(t.tween(n.hoverCircle,c,n.hoverCircle.getNodeId()+"position"+o));const d=[{key:"x",value:s.getX(),duration:i},{key:"y",value:s.getY(),duration:i}];e.addSequence(t.tween(r,d,this.polygonComponent.getNodeId()+"point"+o)),o++}),this}transition(e,t,i,s,n){return this.polygonComponent.getPoints().length===Object.keys(s).length?this.transitionCurrentPolygon(e,t,i,s,n):this.transitionToNewPolygon(e,t,i,s,n),this}transitionOut(e,t,s){this.circles.forEach(({circle:n,hoverCircle:r})=>{const o=[{key:i.Style.Opacity,value:1,duration:s}];n.getPresence().setCoordinates(0,0),n.setStyle(i.Style.Opacity,0),e.addSequence(t.tween(n,o,n.getNodeId()+"fadeOut")),r.getPresence().setCoordinates(0,0),r.setStyle(i.Style.Opacity,0),e.addSequence(t.tween(r,o,r.getNodeId()+"fadeOut"))});const n=[{key:i.Style.Opacity,value:0,duration:s}],r=t.tween(this.polygonComponent,n,this.polygonComponent.getNodeId()+"hide");return r.onDone.subscribeOnce(()=>{this.removeComponent(this.polygonComponent,!0),this.circles.forEach(({circle:e,hoverCircle:t})=>{this.removeComponent(e,!0),this.removeComponent(t,!0)})}),e.addSequence(r),this}buildPolygon(){const e=r.map(this.points,e=>e);this.circles=[];const t=new i.PolygonComponent(i.Presence.zeroTopLeft().setCoordinates(e[0].getX(),e[0].getX()),e);t.setStyle(i.Style.BorderColor,this.props.data.color).setStyle(i.Style.BorderThickness,2).setStyle(i.Style.Color,this.props.data.color.clone().setAlpha(.2)).setReturnToSource(!0).setLayer(1),this.addComponent(t);const n=this.props.data.color.clone().darken(3);return this.datasets.forEach(e=>{const t=this.points[e.getSubLabel()],r=new i.CircleComponent(new i.Circle(t.getX()-this.getPresence().getX(),t.getY()-this.getPresence().getY(),this.circleRadius));r.setStyle(i.Style.Color,n).setLayer(1),this.addComponent(r);const o=new i.CircleComponent(new i.Circle(t.getX()-this.getPresence().getX(),t.getY()-this.getPresence().getY(),2*this.circleRadius));o.setStyle(i.Style.Color,s.Color.TRANSPARENT_COLOR()).setLayer(1),this.addComponent(o),this.circles.push({circle:r,hoverCircle:o,dataset:e})}),this.polygonComponent=t,this}draw(e){super.draw(e)}dispose(){super.dispose(),this.subs.forEach(e=>{e.cancel()})}}}),define("models/radar_settings",["require","exports","canvas_chart_utilities","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarChartSettings=class extends i.DefaultChartSettings{constructor(e,t){super(t),this.height=0,this.width=0,this.normalizeAxis=!1,this.enableLegend=!1,this.numCircles=5,this.scaling=1,s.extend(this,e),this.delayComputation=!0}getModel(){return this.model}setModel(e){return this.model=e,this}getFontColor(){return this.fontColor}setFontColor(e){return this.fontColor=e,this}getScaling(){return this.scaling}setScaling(e){return this.scaling=e,this}getWidget(){return this.widget}getNumCircles(){return this.numCircles}setNumCircles(e){return this.numCircles=e,this}getHeight(){return this.height}setHeight(e){return this.height=e,this}getWidth(){return this.width}setWidth(e){return this.width=e,this}getNormalizeAxis(){return this.normalizeAxis}setNormalizeAxis(e){return this.normalizeAxis=e,this}getEnableLegend(){return this.enableLegend}setEnableLegend(e){return this.enableLegend=e,this}}}),define("classes/radar_chart",["require","exports","classes/radar_circles","classes/radar_axis","classes/radar_legend","underscore","actions/radar_actions","classes/radar_polygon","reusable_utilities","event","models/radar_settings","canvas_engine","flux","canvas_chart_utilities","interfaces/radar_interfaces"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarChart=class extends p.Chart{constructor(e,t=new d.RadarChartSettings({height:0,width:0,normalizeAxis:!1,enableLegend:!1}),i){super(e,t,i),this.radarColor=l.Color.LIGHT_GREY().darken(10),this.onMouseEnter=new c.Event,this.onMouseLeave=new c.Event,this.onMouseClick=new c.Event,this.animationComponent=(new h.AnimationComponent).attach(this),this.mouseSubs=[],this.legendSplitCharacter=" ",this.alternativeSplitCharacter="{*}",this.MAX_STRING_LENGTH=10,this.maxLabelWidth=0,this.margin=this.generateLegendSettings().createAxesLegendLabels().calculateMargin(),this.initialAnimationTimeline=new h.Timeline,this.center=h.Point.zero().setCoordinates(this.settings.getWidth()/2,this.settings.getHeight()/2)}generateLegendSettings(){this.legendSettings=new h.LabelSettings,this.legendSettings.setTextBaseLine(h.Constants.TextBaseLine.HANGING).setFontSize(this.settings.getScaling()*this.legendSettings.getFontSize()).setOrigin("center").setColor(this.settings.getFontColor());let e=0;const t=this.settings.getModel().getAxesData().reduce((t,{label:i})=>{const s=i.split(this.legendSplitCharacter);e=Math.max(e,s.length);const n=s.reduce((e,t)=>e.length>t.length?e:t,"");return t.length>n.length?t:n},""),i=h.Utilities.measureText(t,this.legendSettings.getFont());return this.maxLabelWidth=Math.max(40,3.1*(Math.min(this.settings.getHeight(),this.settings.getWidth())-e*i.height*2)/this.settings.getModel().getAxesData().length),this.longLegendSettings=this.legendSettings.clone(),this.longLegendSettings.setMultiline(!0).setSplitCharacter(this.legendSplitCharacter),this.breakingLegendSettings=this.legendSettings.clone(),this.breakingLegendSettings.setMaxWidth(this.maxLabelWidth),h.ObjectCache.recycleObject(i),this}getWidth(){return this.settings.getWidth()}getHeight(){return this.settings.getHeight()}getSize(){return Math.min(this.settings.getWidth(),this.settings.getHeight())}getAxisLabelType(e,t){const i=e.split(this.legendSplitCharacter),s=h.Utilities.measureText(e,this.legendSettings.getFont());if(1===i.length){if(s.width>this.maxLabelWidth)return g.RadarAxisLabelType.BREAKING}else{if(i.reduce((e,t)=>{const i=h.Utilities.measureText(t,this.legendSettings.getFont()),s=i.width>this.maxLabelWidth;return h.ObjectCache.recycleObject(i),s},!1))return g.RadarAxisLabelType.BREAKING;if(s.width>this.maxLabelWidth||t%90!=0&&s.width>.4*Math.min(this.settings.getHeight(),this.settings.getWidth()))return g.RadarAxisLabelType.MULTI}return h.ObjectCache.recycleObject(s),g.RadarAxisLabelType.SINGLE}getLabelSettings(e,t){let i;switch(e){case g.RadarAxisLabelType.SINGLE:i=this.legendSettings;break;case g.RadarAxisLabelType.BREAKING:i=this.breakingLegendSettings;break;case g.RadarAxisLabelType.MULTI:i=this.longLegendSettings;const s=t.split(this.legendSplitCharacter);let n=void 0;const r=[];let o=!1;s.forEach((e,t)=>{void 0===n?(n=e,t===s.length-1&&r.push(e)):(n+this.legendSplitCharacter+e).length<=this.MAX_STRING_LENGTH?(o=!0,r.push(n+this.legendSplitCharacter+e),n=void 0):(r.push(n),n=e,t===s.length-1&&r.push(e))}),o&&(i=i.clone().setSplitCharacter(this.alternativeSplitCharacter),t=r.join(this.alternativeSplitCharacter))}return{labelSettings:i,newLabel:t}}createAxisLegendLabel(e,t){if(void 0===e.legend){const i=this.getLabelSettings(this.getAxisLabelType(e.label,t),e.label);e.label=i.newLabel;const s=new h.LabelComponent(h.Presence.zeroTopLeft(),e.label,i.labelSettings);e.label=e.label.replace(this.alternativeSplitCharacter,this.legendSplitCharacter),e.legend=s}return this}createAxesLegendLabels(){const e=360/this.settings.getModel().getAxesData().length;return this.settings.getModel().getAxesData().forEach((t,i)=>{const s=e*i-180;this.createAxisLegendLabel(t,s)}),this}calculateMargin(){return this.settings.getModel().getAxesData().reduce((e,t)=>{const i=s.RadarAxis.getAxisLegendHeight(t.legend);return Math.max(e,i)},0)+5}generatePolygonPoints(e){const t={};return r.sortBy(e.datasets,e=>{const t=r.find(this.axes,t=>t.getID()===e.getId());return void 0===t?-1:t.getAngle()}).forEach(e=>{const i=r.find(this.axes,t=>t.getID()===e.getAdditionalMetric().axisId);t[e.getSubLabel()]=i.getValuePoint(0===i.getTotal()?0:e.getAdditionalMetric().percentage/i.getTotal()*100*(100/this.maxPercentage)||0)}),t}updatePolygons(e,t,i){return this.polygons=this.polygons.filter(s=>(s.transitionOut(e,t,i),!1)),this.settings.getModel().getPolygonsData().filter(e=>void 0===r.find(this.polygons,t=>t.getID()===e.id)).forEach(t=>{const i=this.buildPolygon(t);i.buildAnimation(this.settings.getAnimationDuration(),e),this.polygons.push(i),this.addChild(i)}),this}fadeOutAxe(e,t,i,s,n){e.forEach(e=>{let r=0;const o=Number.MAX_VALUE;t.forEach(t=>{Math.abs(e.getAngle()-t)<o&&(r=t)}),e.fadeOut(i,s,n,r)})}updateAxes(e,t,i,s,n){const o=360/this.settings.getModel().getAxesData().length,a=[];let l=0;const c=[];if(this.axes=this.axes.concat(this.unsusedAxes).filter(d=>{const h=n.indexOf(d.getLabel().replace(this.alternativeSplitCharacter,this.legendSplitCharacter));if(h>-1){const a=r.find(this.settings.getModel().getAxesData(),e=>d.getID()===e.id).total;d.setTotal(a),n.splice(h,1);const u=o*l-180,p=d.getLegend(),g=this.getAxisLabelType(d.getLabel(),u),m=this.getLabelSettings(g,d.getLabel());return p.setText(m.newLabel),p.setSettings(m.labelSettings),c.push(u),d.setMargin(this.margin),d.changeAngle(e,t,i,u,s),l++,!0}return a.push(d),!1}),this.fadeOutAxe(a,c,e,t,i),n.length>0){const s=this.settings.getModel().getAxesData().filter((e,t)=>n.indexOf(e.label.replace(this.alternativeSplitCharacter,this.legendSplitCharacter))>-1);for(;s.length>0;){const n=s.pop();this.buildAxis(n,l,-180).changeAngle(e,t,i,o*l-180,!0),l++}}return this.unsusedAxes=a,this}transition(e,t,i,s){void 0!==this.activeItemID&&this.legendMouseClick(this.activeItemID);let n=!0;const r=i.getAxesData().map(e=>e.label);this.settings.getModel().getAxesData().length===r.length&&(n=this.settings.getModel().getAxesData().reduce((e,t)=>-1===r.indexOf(t.label)||e,!1)),this.settings.setModel(i),this.maxPercentage=this.computeMaxPercentage(),this.margin=this.generateLegendSettings().createAxesLegendLabels().calculateMargin(),this.circles.transition(e,t,s||this.settings.getAnimationDuration(),this.margin),this.updateAxes(e,t,s||this.settings.getAnimationDuration(),n,r),this.updatePolygons(e,t,s||this.settings.getAnimationDuration()),this.radarLegend.setMargin(this.margin).setMaxValue(this.maxPercentage).transition(e,t,s||this.settings.getAnimationDuration());const o=e.onStep.subscribe(()=>{this.setUpMouseInteractions()});return e.onDone.subscribeOnce(()=>{this.setUpMouseInteractions(),o.cancel()}),this}animate(){return this.settings.isInitialAnimationEnabled()?this.playInitialAnimation():this.initialAnimationTimeline.isPlaying()?void 0:Promise.resolve(this)}playInitialAnimation(){return this.initialAnimationTimeline.reset(),this.initialAnimationTimeline.playOverTime(this.settings.getAnimationDuration()),this.initialAnimationTimeline.onDone.subscribeOnceAsPromise()}compute(){return this.buildRadarChart(),this}computeMaxPercentage(){let e=Math.max(...this.settings.getModel().getDatasets().map(e=>Math.ceil(e.getAdditionalMetric().percentage)));for(;e%this.settings.getNumCircles()!=0;)e++;return e}buildRadarChart(){return this.maxPercentage=this.computeMaxPercentage(),this.clearChildren(),this.buildCircles(),this.buildAxes(),this.buildLegend(),this.buildPolygons(),this.settings.isInitialAnimationEnabled()&&this.buildInitialAnimation(),this.setUpMouseInteractions(),this}pointMouseEnterHandler(e,t,i,s){u.dispatcher.dispatch(o.RadarActions.radar_onMouseEnter,{event:e,circle:t,color:i,dataset:s,canvas:this.getParent().getStageFacade().getCanvas(),widget:this.settings.getWidget()})}pointMouseLeaveHandler(e,t,i,s){u.dispatcher.dispatch(o.RadarActions.radar_onMouseLeave,{event:e,circle:t,color:i,dataset:s,canvas:this.getParent().getStageFacade().getCanvas()})}pointMouseClickHandler(e){this.settings.getWidget()&&this.settings.getWidget().getDataGraph()&&this.settings.getWidget().getDataGraph().payloadDataGraph&&this.settings.getWidget().getDataGraph().payloadDataGraph.rows&&this.settings.getWidget().getDataGraph().payloadDataGraph.rows.some(e=>e.drilldown_disabled)||u.dispatcher.dispatch(o.RadarActions.radar_onMouseClick,{stageFacade:this.getParent().getStageFacade()})}legendMouseEnter(e){this.activeItemID!==e&&this.polygons.forEach(t=>{t.getID()===e?t.isGrayedOut()&&t.setGrayedOut(!1):t.isGrayedOut()||t.setGrayedOut(!0)})}legendMouseLeave(e){this.activeItemID!==e&&this.polygons.forEach(e=>{e.isGrayedOut()&&e.setGrayedOut(!1)})}legendMouseClick(e){this.polygons.filter(t=>t.getID()===e)[0].getID()===this.activeItemID?(this.activeItemID=void 0,this.legendMouseLeave(e)):(this.legendMouseEnter(e),this.activeItemID=e)}axisLegendMouseEnterHandler(e,t){u.dispatcher.dispatch(o.RadarActions.radar_onAxisLegendMouseEnter,{fullLabel:e,canvas:this.getParent().getStageFacade().getCanvas(),label:t})}axisLegendMouseLeaveHandler(){u.dispatcher.dispatch(o.RadarActions.radar_onAxisLegendMouseLeave,null)}setUpMouseInteractions(){return this.mouseSubs.forEach(e=>e.cancel()),this.mouseSubs=[],this.polygons.forEach(e=>{e.buildMouseAnimations().setMouseEvents(this.onMouseEnter,this.onMouseLeave,this.onMouseClick)}),this.axes.forEach(e=>{e.setMouseEvents((e,t)=>{this.axisLegendMouseEnterHandler(e,t)},()=>{this.axisLegendMouseLeaveHandler()})}),this.mouseSubs.push(this.onMouseEnter.subscribe(({event:e,circle:t,color:i,dataset:s})=>{this.pointMouseEnterHandler(e,t,i,s)})),this.mouseSubs.push(this.onMouseLeave.subscribe(({event:e,circle:t,color:i,dataset:s})=>{this.pointMouseLeaveHandler(e,t,i,s)})),this.mouseSubs.push(this.onMouseClick.subscribe(({dataset:e})=>{this.pointMouseClickHandler(e)})),this}buildInitialAnimation(){const e=this.settings.getAnimationDuration()/2;return this.children.forEach(t=>{t.buildInitialAnimation(e)}),this}buildPolygon(e){const t=this.center,i=this.generatePolygonPoints(e);return new a.RadarPolygon({data:e,center:t,points:i},e.id,this.animationComponent,this.initialAnimationTimeline)}buildPolygons(){return this.polygons=[],this.settings.getModel().getPolygonsData().forEach(e=>{const t=this.buildPolygon(e);t.setStyle(h.Style.Opacity,this.getStyleMap()),this.polygons.push(t),this.addChild(t)}),this}buildCircles(){const e=this.center,t=this.getSize()/2,s=this.settings.getNumCircles(),n=this.margin,r=this.radarColor;return this.circles=new i.RadarCircles({center:e,radius:t,numCircles:s,margin:n,color:r},this.animationComponent,this.initialAnimationTimeline),this.circles.setStyle(h.Style.Opacity,this.getStyleMap()),this.addChild(this.circles),this}buildAxis(e,t,i){const n=this.center,r=this.getSize()/2,o=360/this.settings.getModel().getAxesData().length,a=this.radarColor,l=o*t-180,c=this.margin,d=e.label,u=e.fullLabel,p=e.legend,g=e.total,m=this.settings.getNumCircles(),_=e.id,f=new s.RadarAxis({center:n,length:r,angle:i||l,numCircles:m,margin:c,total:g,color:a,legend:p,legendLabel:d,fullLegendLabel:u,id:_},this.animationComponent,this.initialAnimationTimeline);return f.setStyle(h.Style.Opacity,this.getStyleMap()),this.addChild(f),this.axes.push(f),f}buildLegend(){const e=this.center,t=this.getSize()/2,i=this.settings.getFontColor(),s=this.margin,r=this.settings.getNumCircles(),o=this.settings.getScaling(),a=new n.RadarLegend({center:e,length:t,numCircles:r,scaling:o,margin:s,maxValue:this.maxPercentage,color:i},this.animationComponent,this.initialAnimationTimeline);return a.setStyle(h.Style.Opacity,this.getStyleMap()),this.addChild(a),this.radarLegend=a,a.setStageFacade(this.getStageFacade()),a.subscribeToStage(),this}buildAxes(){return this.axes=[],this.unsusedAxes=[],this.settings.getModel().getAxesData().forEach((e,t)=>{this.buildAxis(e,t)}),this}dispose(){this.animationComponent.dispose(),void 0!==this.initialAnimationTimeline&&(this.initialAnimationTimeline.unsync(),this.initialAnimationTimeline.dispose())}}}),define("classes/radar_color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/radar_color_palette_builder",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarColorPaletteBuilder=class extends i.ColorPaletteBuilder{build(){return 2===this.themeId?this.buildDarkColorPalette():this.buildLightColorPalette()}buildLightColorPalette(){return{fontColor:new i.Color("#000")}}buildDarkColorPalette(){return{fontColor:new i.Color("#fff")}}}}),define("classes/radar_fragment",["require","exports","canvas_chart_utilities","canvas_engine","data_structures","reusable_utilities","widget_base","models/radar_model","models/radar_settings","classes/radar_chart"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RadarFragment=class extends i.AbstractCanvasFragment{constructor(e){super(e),this.stageSettings={layerAmount:3,relayEvents:[s.Constants.StageEvents.MouseWheel]},this.replayFirstStarted=!1,this.cancellationToken=new r.CancellationToken,this.fragmentModel=e}buildRadarChartModelFromDatagraph(e,t){return new a.RadarChartModel(new n.DataGraphWrapper(e),t)}buildRadarChartModel(e){return this.buildRadarChartModelFromDatagraph(e.widget.getDataGraph().payloadDataGraph,e.widget.getConfigurationRendering().uuid_configuration.replace("UUID_CONFIG_",""))}async handleCanvas(e,t={layerAmount:3}){await super.handleCanvas(e,t),$(this.canvas).addClass("tw-radar-chart")}getChartOptions(e,t,i,s){const n={width:e,height:t,normalizeAxis:!1,numCircles:4,enableLegend:!0,widget:i};if(void 0!==s){const e=s.style.colorPalette;_.extend(n,{hasInitialAnimation:s.animationDuration>0&&1===s.animationStrategy,animationDuration:s.animationDuration,scaling:this.getScaling(s.style.fontSize),fontColor:e.fontColor})}return n}getScaling(e){switch(e){case o.FontSize.SMALL:return 1;case o.FontSize.MEDIUM:return 1.5;case o.FontSize.LARGE:return 2;case o.FontSize.EXTRA_LARGE:return 2.5}}async buildRadarChart(e,t,r,o=!1,a=this.radarChartModel){this.stage.processUpdate(),o&&(r=_.extend({},r,{hasInitialAnimation:!1})),n.ModelEnhancer.calculatePercentages(a,r.style.formatting.numberFormatter);const d=new c.RadarChart(s.Presence.zeroTopLeft(),new l.RadarChartSettings(this.getChartOptions(e,t,this.fragmentModel.widget,r),a));return o?(this.replayChart=d,this.replayChart.setStageFacade(this.chart.getStageFacade()),this.replayChart.subscribeToStage(),d.setStyle(s.Style.Opacity,0)):this.chart=d,d.compute(),d.onMouseEnter.subscribe(({dataset:e})=>{this.mediator.dispatch(i.LegendFragmentActions.WIDGET_MOUSEENTER,e.getId())}),d.onMouseLeave.subscribe(({dataset:e})=>{this.mediator.dispatch(i.LegendFragmentActions.WIDGET_MOUSELEAVE,e.getId())}),this.scene.addChild(d),this.stage.processUpdate(),await d.animate(),this}transitionChart(e,t,i){return this.chart.transition(e,t,i||this.radarChartModel),this}createReplay(e){return this.replayFirstStarted=!1,this.replayTimeline=new s.Timeline,this.replayAnimationComponent=(new s.AnimationComponent).attach(this.replayChart),this.fragmentModel.widget.getDataGraph().getAdditionalFrames().forEach((t,i)=>{const s=this.buildRadarChartModelFromDatagraph(t,this.fragmentModel.widget.getConfigurationRendering().uuid_configuration.replace("UUID_CONFIG_",""));if(0===i){const t=this.dimensions.width,i=this.dimensions.height;this.buildRadarChart(t,i,_.extend({},e,{animationStrategy:0}),!0,s)}else this.replayTimeline.setDelayAdditive(1e3*i),this.replayAnimationComponent.setIdAdditive(_.uniqueId()),this.replayChart.transition(this.replayTimeline,this.replayAnimationComponent,s,1e3)}),this.replayTimeline}setUpMediatorListeners(e,t){if(this.cancellationToken.cancel(),this.cancellationToken=new r.CancellationToken,this.fragmentModel.widget.hasAdditionalFrames()){const i=this.createReplay(t);e.listen(o.REPLAY_ACTIONS.PROGRESS,({progress:e})=>{void 0!==e&&(this.replayFirstStarted||this.chart===this.replayChart||(this.scene.removeChild(this.chart),this.chart.dispose(),this.chart=this.replayChart,this.replayChart.setStyle(s.Style.Opacity,1)),i.setProgress(e),this.replayChart.hasStageFacade()&&this.replayChart.getStageFacade().processUpdate())},{token:this.cancellationToken})}return e.listen(i.LegendFragmentActions.LEGEND_MOUSEENTER,e=>{this.chart.legendMouseEnter(e)},{token:this.cancellationToken}),e.listen(i.LegendFragmentActions.LEGEND_MOUSELEAVE,e=>{this.chart.legendMouseLeave(e)},{token:this.cancellationToken}),e.listen(i.LegendFragmentActions.LEGEND_MOUSECLICK,e=>{this.chart.legendMouseClick(e)},{token:this.cancellationToken}),this}initialize(e,t,i){return super.initialize(e,t,i),this.mediator=t,this.chartContainer=e,this.dimensions=i.dimensions,this.radarChartModel=this.buildRadarChartModel(this.fragmentModel),this.handleCanvas(i,this.stageSettings)}update(e){return this.fragmentModel=e,this.radarChartModel=this.buildRadarChartModel(this.fragmentModel),Promise.resolve(this)}async draw(e){await this.handleCanvas(e,this.stageSettings),this.dimensions=e.dimensions;const t=this.dimensions.width,i=this.dimensions.height;if(void 0!==this.chart&&this.chart.getWidth()===t&&this.chart.getHeight()===i&&1===e.animationStrategy){const t=new s.Timeline,i=(new s.AnimationComponent).attach(this.chart);return this.transitionChart(t,i),t.playOverTime(e.animationDuration),t.onDone.subscribeOnceAsPromise().then(()=>{i.dispose(),t.dispose()}),await t.onDone.subscribeOnceAsPromise()}return this.scene.clearChildren(),await this.buildRadarChart(t,i,e),this.setUpMediatorListeners(this.mediator,e),this}dispose(){this.stage.dispose(),void 0!==this.replayTimeline&&this.replayTimeline.dispose(),void 0!==this.replayAnimationComponent&&this.replayAnimationComponent.dispose()}getLayoutIterator(){return new o.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minWidth:0,minHeight:0}],e=>({width:Math.min(e.dimensions.width||0,e.dimensions.height||0),height:Math.min(e.dimensions.width||0,e.dimensions.height||0)}))}}}),define("radar",["require","exports","actions/radar_actions","classes/radar_axis","classes/radar_chart","classes/radar_circles","classes/radar_color_palette_builder","classes/radar_fragment","classes/radar_legend","classes/radar_polygon","interfaces/radar_interfaces","models/radar_model","models/radar_model_type","models/radar_settings"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p){"use strict";function g(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),g(i),g(s),g(n),g(r),g(o),g(a),g(l),g(c),g(d),g(h),g(u),g(p)}),define("models/image_box_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/image_box_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/image_box_save_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/image_box.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageBoxStyleModel={imageBox:{position:"relative",width:"100%",height:"100%"},imageUpload:{height:"67%","& .form-control":{height:"100%","& input":{display:"none"}}},urlBlock:{marginTop:10},urlLabel:{textAlign:"right",marginBottom:0,padding:"2px 10px 2px 4px",width:"35%"},urlInputWrapper:{display:"inline-block",width:"65%",paddingRight:10},urlInput:{width:"100%"},imageBlock:{position:"relative",width:"100%",height:"100%","& .img-error-style":{position:"relative",width:"100%",height:"100%","& .img-error-font":{fontSize:"3em",transform:"translate(-50%, -50%)",top:"50%",left:"50%",position:"absolute",border:"1px solid gray",borderRadius:40}}},imageBlockEditable:{position:"relative",width:"100%",height:"75%",padding:10,"& .img-error-style":{position:"relative",width:"100%",height:"100%","& .img-error-font":{fontSize:"3em",transform:"translate(-50%, -50%)",top:"50%",left:"50%",position:"absolute",border:"1px solid gray",borderRadius:40}}},image:{width:"100%",height:"100%",objectFit:"fill"},deleteIcon:{position:"absolute",top:15,right:15,color:"#a2daf1",cursor:"pointer"},separatorBlock:{display:"block",textAlign:"center",overflow:"hidden",padding:10,margin:"0 2px"},separatorText:{position:"relative","&:before":{content:'""',position:"absolute",right:"100%",top:"50%",width:9999,height:1,marginRight:15},"&:after":{content:'""',position:"absolute",left:"100%",top:"50%",width:9999,height:1,marginLeft:15}},saveButton:{margin:15},cancelButton:{margin:15},placeholderIcon:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},t.imageBoxStyle=i.createCssModule(()=>t.imageBoxStyleModel).compute({}).attach().getModule()}),define("interfaces/editable_changed_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/image_box_renderable",["require","exports","flux","react","reusable_components","event_bus","reusable_utilities","css/image_box.css","classnames","file_upload"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageBoxRenderable=class extends i.BaseComponent{constructor(e){super(e),this.props.settings.editable&&(this.cancellationToken.addDomEvent($(document),"mouseup",e=>this.handleMouseUp(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown())),this.state={editable:e.settings.editable,url:e.model.imageUrl}}componentWillReceiveProps(e){e.model.imageUrl!==this.props.model.imageUrl&&this.initializeState(e)}render(){const e=l(["image-box",a.imageBoxStyle.imageBox]);return s.createElement("div",{ref:this.handleElement.bind(this),className:e},this.renderFileUpload(),this.renderImage(),this.renderSeparator(),this.renderUrlInput(),this.renderSaveButton(),this.renderCancelButton())}renderFileUpload(){if(this.state.editable&&this.isStringEmpty(this.state.url)){const e=l(["file-upload",a.imageBoxStyle.imageUpload]);return s.createElement("div",{className:e},s.createElement(c.FileUpload,{label:this.props.model.uploadLabel,mimeFilter:this.props.settings.mimeFilter,blockSvg:this.props.settings.blockSvg,onLoad:this.onLoad.bind(this),onClick:()=>this.lockModal=!0}))}return null}renderImage(){if(this.isStringEmpty(this.state.url)){if(this.state.editable)return null;{const e=l([a.imageBoxStyle.placeholderIcon,"icon2-tw-image"]);return void 0!==this.elem&&this.adaptFontSize(),s.createElement("i",{className:e,style:{fontSize:this.placeholderIconFontSize}})}}{const e=s.createFactory.bind(s,n.FallbackImageRenderable),t=this.state.editable?a.imageBoxStyle.imageBlockEditable:a.imageBoxStyle.imageBlock;return s.createElement("div",{className:t},s.createElement(n.ImageBlockRenderable,{url:this.state.url,errorTag:e(),errorClass:"icon2-tw-no-img1 img-error-font img-error-font-colors",className:a.imageBoxStyle.image}),this.renderDeleteImageButton())}}renderDeleteImageButton(){if(this.state.editable){const e=l(["icon-tw-cross",a.imageBoxStyle.deleteIcon]);return s.createElement("i",{onClick:this.deleteImage.bind(this),className:e})}return null}renderSeparator(){if(this.canShowSeparator()){const e=l(["separator-text",a.imageBoxStyle.separatorText]);return s.createElement("div",{className:a.imageBoxStyle.separatorBlock},s.createElement("span",{className:e},this.props.model.separatorLabel))}return null}renderUrlInput(){const e=new o.Url(this.props.model.imageUrl);if(this.state.editable&&!e.isDataURL()){const e=this.isStringEmpty(this.state.url)?void 0:a.imageBoxStyle.urlBlock;return s.createElement("div",{className:e},s.createElement("label",{className:a.imageBoxStyle.urlLabel},this.props.model.inputLabel),s.createElement("div",{className:a.imageBoxStyle.urlInputWrapper},s.createElement("input",{defaultValue:(this.state.url||"").substring(0,1024),onChange:this.onChange.bind(this),className:a.imageBoxStyle.urlInput})))}return null}renderSaveButton(){if(this.state.editable){const e={"btn btn-primary pull-right":!0,disabled:this.props.model.imageUrl===this.state.url};e[a.imageBoxStyle.saveButton]=!0;const t=l(e);return s.createElement("div",null,s.createElement(n.ProgressButton,{onClick:this.save.bind(this),className:t,text:this.props.model.saveLabel,loadingText:this.props.model.savingLabel}))}return null}renderCancelButton(){if(this.state.editable){const e=l(["btn","btn-default","pull-right",a.imageBoxStyle.cancelButton]);return s.createElement("button",{onClick:this.cancel.bind(this),className:e},this.props.model.cancelLabel)}return null}onLoad(e){this.setState({url:e.dataUrl})}onChange(e){const t=e.target.value;this.setState({url:t})}deleteImage(e){this.setState({url:""})}cancel(e){const t={id:this.props.model.id,editable:!1};r.eventBus.dispatch({type:r.EVENT_TYPES.IMAGE_BOX_EDITABLE_CHANGED,value:t}),void 0!==e&&r.eventBus.dispatch({type:r.EVENT_TYPES.IMAGE_BOX_CANCEL,value:t})}save(e){const t={id:this.props.model.id,dataUrl:this.state.url};r.eventBus.dispatch({type:r.EVENT_TYPES.IMAGE_BOX_SAVE,value:t})}initializeState(e){this.setState({url:e.model.imageUrl})}isStringEmpty(e){return void 0===e||0===e.length}canShowSeparator(){return this.state.editable&&(this.isStringEmpty(this.state.url)&&this.isStringEmpty(this.props.model.imageUrl)||this.isStringEmpty(this.state.url)&&!this.isStringEmpty(this.props.model.imageUrl))}handleMouseUp(e){this.lockModal?this.lockModal=!1:o.DOMMath.isPointOnElement({x:e.clientX+window.scrollX,y:e.clientY+window.scrollY},$(this.elem))||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.cancel(void 0)}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}handleElement(e){const t=this.elem;null!==e&&(this.elem=e,this.adaptFontSize(),void 0===t&&this.forceUpdate())}adaptFontSize(){this.isStringEmpty(this.state.url)&&!this.state.editable&&(this.placeholderIconFontSize=Math.floor(.3*Math.min(this.elem.clientWidth,this.elem.clientHeight)))}}}),define("css/text_box.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textBoxStyleModel={textBox:{resize:"none",width:"100%",height:"100%",border:"none",backgroundColor:"transparent",cursor:"text",overflow:"hidden","&:focus":{outline:"none"}}},t.textBoxStyle=i.createCssModule(()=>t.textBoxStyleModel).compute({}).attach().getModule()}),define("interfaces/toolbar_item_action_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/toolbar_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BUTTON=0]="BUTTON",e[e.DROPDOWN_BUTTON=1]="DROPDOWN_BUTTON",e[e.DROPDOWN_BUTTON_COLOR=2]="DROPDOWN_BUTTON_COLOR",e[e.DROPDOWN_BUTTON_NUMBER_INPUT=3]="DROPDOWN_BUTTON_NUMBER_INPUT",e[e.DRAGGABLE_BUTTON=4]="DRAGGABLE_BUTTON",e[e.TEXT=5]="TEXT"}(t.ToolbarItemType||(t.ToolbarItemType={}))}),define("interfaces/optional_toolbar_block",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TEXT_BOX="TEXT_BOX"}(t.ToolbarOwnerType||(t.ToolbarOwnerType={})),function(e){e[e.FONT=0]="FONT",e[e.TEXT_ALIGNMENT=1]="TEXT_ALIGNMENT"}(t.OptionalToolbarBlockType||(t.OptionalToolbarBlockType={}))}),define("models/text_box_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/text_box_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/toggle_resizable_display_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/text_box_renderable",["require","exports","flux","react","classnames","css/text_box.css","reusable_utilities","event_bus"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=30;t.TextBoxRenderable=class extends i.BaseComponent{constructor(e){super(e),this.cancellationToken.addDomEvent($(document),"click",e=>this.handleDocumentClick(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown()),this.state={text:e.model.text,displayText:e.model.displayText,focus:!1}}componentWillReceiveProps(e){e.model.displayText===this.props.model.displayText&&e.settings.forceFocus===this.props.settings.forceFocus||this.initializeState(e)}render(){const e=n(["text-box",r.textBoxStyle.textBox]),t=this.getTextToDisplay(),i=this.processStyles();return s.createElement("textarea",{ref:e=>this.textboxRef=e,value:t,disabled:!this.props.settings.editable,onChange:this.onChange.bind(this),onScroll:this.onScroll.bind(this),onClick:this.onClick.bind(this),className:e,style:i})}getTextToDisplay(){return this.state.focus?this.state.text||"":void 0!==this.state.displayText&&this.state.displayText.length>0||!this.props.settings.editable?this.state.displayText:this.props.model.placeholderText}onChange(e){if(this.props.settings.editable&&(!this.props.settings.fillBoxOnly||this.textboxRef.scrollTop<=l)){this.previousText=this.state.text;const t=e.target.value;this.setState({text:t,displayText:t})}}onScroll(e){const t=e.target;this.props.settings.fillBoxOnly&&t.scrollTop>l&&(e.target.scrollTop=0,void 0!==this.previousText&&this.setState({text:this.previousText}))}onClick(e){this.props.settings.editable&&this.setFocus(!0)}setFocus(e){this.state.focus!==e&&(this.initializeFocusState(e),this.toggleResizable(e),a.eventBus.dispatch({type:a.EVENT_TYPES.TEXT_BOX_FOCUS_CHANGED,value:{id:this.props.model.id,focused:e}}),e||this.props.model.text===this.state.text||a.eventBus.dispatch({type:a.EVENT_TYPES.TEXT_BOX_SAVE,value:{id:this.props.model.id,text:this.state.text}}))}toggleResizable(e){const t={id:this.props.model.id,show:e};a.eventBus.dispatch({type:a.EVENT_TYPES.TOGGLE_RESIZABLE_DISPLAY,value:t})}initializeFocusState(e){this.setState({focus:e})}initializeState(e){e.settings.forceFocus&&(this.textboxRef.focus(),this.setFocus(!0)),!e.settings.forceFocus&&this.props.settings.forceFocus&&this.setFocus(!1),e.settings.forceFocus||this.props.settings.forceFocus||this.setState({text:e.model.text,displayText:e.model.displayText})}handleDocumentClick(e){const t=$(this.textboxRef);this.isClickOutsideElement(e,t)&&this.isClickOutsideWhiteList(e)&&(void 0===this.savedScrollX||void 0===this.savedScrollY||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY)&&this.setFocus(!1)}isClickOutsideWhiteList(e){let t=!0;for(const i of this.props.settings.connectedSelectorWhiteList){const s=$(i);if(!(t=this.isClickOutsideElement(e,s)))break}return t}isClickOutsideElement(e,t){return t.length>0&&!t.is(e.target)&&0===t.has(e.target).length&&!o.DOMMath.isPointOnElement({x:e.clientX,y:e.clientY},t)}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}processStyles(){const e=JSON.parse(JSON.stringify(this.props.model.styles));return e.fontFamily+=`, ${this.props.model.defaultStyles.fontFamily}`,e}}}),define("models/toolbar_renderable_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/abstract_toolbar_item_renderable",["require","exports","flux","event_bus"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractToolbarItemRenderable=class extends i.BaseComponent{constructor(e){super(e)}dispatchEvent(e,t){s.eventBus.dispatch({type:e,value:t})}}}),define("interfaces/toolbar_block_item_single_select_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/toolbar_item_button_renderable",["require","exports","components/abstract_toolbar_item_renderable","event_bus","react","classnames"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarItemButtonRenderable=class extends i.AbstractToolbarItemRenderable{constructor(e){super(e)}componentDidMount(){this.cancellationToken.addDomEvent(this.elementRef,"click",this.onClick.bind(this))}render(){const e=r([this.props.model.icon,"icon"]),t=r({"item button-item":!0,selected:this.props.model.selected});return n.createElement("div",{ref:e=>this.elementRef=e,className:t},n.createElement("i",{className:e}))}onClick(e){e.stopPropagation();const t={item:this.props.model,block:this.props.block};this.dispatchEvent(this.props.model.eventType,this.props.model.actionPayload),this.dispatchEvent(s.EVENT_TYPES.TOOLBAR_BLOCK_ITEM_SINGLE_SELECT,t)}}}),define("interfaces/toolbar_update_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/toolbar_init_dragndrop_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/toolbar_item_draggable_button_renderable",["require","exports","components/abstract_toolbar_item_renderable","event_bus","react","classnames"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarItemDraggableButtonRenderable=class extends i.AbstractToolbarItemRenderable{constructor(e){super(e)}componentDidMount(){const e={item:this.props.model,element:this.itemRef,cancellationToken:this.cancellationToken};this.dispatchEvent(s.EVENT_TYPES.INIT_TOOLBAR_ITEM_DRAG_N_DROP,e)}render(){const e=r([this.props.model.icon,"icon"]);return n.createElement("div",{ref:e=>this.itemRef=e,className:"item draggable-item"},n.createElement("i",{className:e}))}}}),define("css/toolbar.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toolbarStyleModel={toolbar:{width:"100%","& .items":{padding:"10px 12px","& .item":{position:"relative",height:30,border:"1px solid black",borderRadius:4,fontSize:Math.floor(16.5),float:"left",marginRight:2,marginLeft:2,userSelect:"none","&.draggable-item":{width:30,"&:hover":{cursor:"move"}},"&.button-item":{width:30},"&.text-item":{padding:"0 4px","&:hover":{cursor:"default"},"& .text-item-label":{verticalAlign:"sub"}},"& .icon":{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}},"& .optional-block":{float:"left","& .block-separator":{width:1,height:1,margin:"0 10px",float:"left"}}}},dropdownButton:{display:"flex",alignItems:"center",padding:"0 5px",cursor:"pointer","& .tw-dropdown-menu":{minWidth:45}},dropdownButtonInput:{width:30,backgroundColor:"transparent",border:"none","-moz-appearance":"textfield","&::-webkit-inner-spin-button":{appearance:"none",margin:0},"&::-webkit-outer-spin-button":{appearance:"none",margin:0}},dropdownColorButtonIndicator:{borderBottomWidth:5,borderBottomStyle:"solid"}},t.toolbarStyle=i.createCssModule(()=>t.toolbarStyleModel).compute({}).attach().getModule()}),define("components/toolbar_item_text_renderable",["require","exports","components/abstract_toolbar_item_renderable","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarItemTextRenderable=class extends i.AbstractToolbarItemRenderable{constructor(e){super(e)}render(){return s.createElement("div",{className:"item text-item"},s.createElement("span",{className:"text-item-label"},this.props.model.title))}}}),define("components/toolbar_item_dropdown_renderable",["require","exports","components/abstract_toolbar_item_renderable","event_bus","react","classnames","underscore","reusable_components","css/toolbar.css","interfaces/toolbar_item","reusable_services"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarItemDropdownRenderable=class extends i.AbstractToolbarItemRenderable{constructor(e){super(e),this.state={selectedTitle:this.props.model.title,dropdownOpen:!1},this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOOLBAR_DROPDOWN_CLOSE,this.hanleToolbarDropdownClose.bind(this))}componentDidMount(){this.cancellationToken.addDomEvent(this.elementRef,"click",this.onClick.bind(this))}render(){let e=null;this.state.dropdownOpen&&void 0!==this.props.model.subItems&&this.props.model.subItems.length>0&&(e=n.createElement(a.DocumentClickTrackerWrapper,{clickOutside:()=>this.setMenuState(!1)},n.createElement(a.DropdownMenuContainer,{forceShow:!0,options:{recursive:{buttonOptions:{parseForEmojis:!0,tooltip:a.RenderFilterButtonTooltipMode.DESCRIPTION}}},entries:this.props.model.subItems,isSubMenu:!1,alignRight:!0,onClick:this.onEntryClicked.bind(this)})));const t=this.renderDisplayElement(),i=r([l.toolbarStyle.dropdownButton,"item"]);return n.createElement("div",{ref:e=>this.elementRef=e,className:i},t,n.createElement("i",{className:this.props.model.icon}),e)}renderDisplayElement(){if(this.props.model.type===c.ToolbarItemType.DROPDOWN_BUTTON_NUMBER_INPUT){const e=Number(o.first(this.props.model.subItems).name),t=Number(o.last(this.props.model.subItems).name),i=r([l.toolbarStyle.dropdownButtonInput]);return n.createElement("input",{type:"number",min:e,max:t,value:this.state.selectedTitle,onChange:this.onNumberChange.bind(this),className:i})}return n.createElement("span",{dangerouslySetInnerHTML:{__html:d.emojiService.parseTextForEmoji(this.state.selectedTitle)}})}onClick(e){this.state.dropdownOpen||(e.stopPropagation(),s.eventBus.dispatch({type:s.EVENT_TYPES.TOOLBAR_DROPDOWN_CLOSE,value:void 0}),this.setMenuState(!0))}onEntryClicked(e,t,i){e.stopPropagation();const s={sourceId:this.props.model.actionPayload.sourceId,data:t.mapped_id};this.dispatchEvent(this.props.model.eventType,s),this.setState({selectedTitle:t.name,dropdownOpen:!1})}setMenuState(e){this.setState({dropdownOpen:e})}onNumberChange(e){const t=e.target.value,i={sourceId:this.props.model.actionPayload.sourceId,data:t};this.dispatchEvent(this.props.model.eventType,i),this.setState({selectedTitle:t})}hanleToolbarDropdownClose(e){this.setState({dropdownOpen:!1})}}}),define("components/toolbar_item_color_renderable",["require","exports","components/abstract_toolbar_item_renderable","event_bus","react","classnames","reusable_components","css/toolbar.css"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarItemColorRenderable=class extends i.AbstractToolbarItemRenderable{constructor(e){super(e);const t=this.props.model.color;this.state={selectedColor:t,dropdownOpen:!1},this.cancellationToken.subscribeToStream(s.eventBus,s.EVENT_TYPES.TOOLBAR_DROPDOWN_CLOSE,this.hanleToolbarDropdownClose.bind(this))}componentDidMount(){this.cancellationToken.addDomEvent(this.elementRef,"click",this.onClick.bind(this))}render(){let e=null;this.state.dropdownOpen&&void 0!==this.props.model.subItems&&this.props.model.subItems.length>0&&(e=n.createElement(o.DocumentClickTrackerWrapper,{clickOutside:()=>this.setMenuState(!1)},n.createElement(o.ColorPickerPopoverRenderable,{selectedColor:this.state.selectedColor,themes:this.props.model.subItems,onColorChange:this.onColorChange.bind(this)})));const t=this.renderDisplayElement(),i=r([a.toolbarStyle.dropdownButton,"item"]),s={borderBottomColor:this.state.selectedColor};return n.createElement("div",{ref:e=>this.elementRef=e,className:i},n.createElement("div",{className:a.toolbarStyle.dropdownColorButtonIndicator,style:s},t,n.createElement("i",{className:this.props.model.icon}),e))}renderDisplayElement(){return n.createElement("span",null,this.props.model.title)}onClick(e){this.state.dropdownOpen||(e.stopPropagation(),s.eventBus.dispatch({type:s.EVENT_TYPES.TOOLBAR_DROPDOWN_CLOSE,value:void 0}),this.setMenuState(!0))}onColorChange(e){const t={sourceId:this.props.model.actionPayload.sourceId,data:e};this.dispatchEvent(this.props.model.eventType,t),this.props.model.color=e,this.setState({selectedColor:e})}setMenuState(e){this.setState({dropdownOpen:e})}hanleToolbarDropdownClose(e){this.setState({dropdownOpen:!1})}}}),define("components/toolbar_renderable",["require","exports","flux","react","interfaces/toolbar_item","components/toolbar_item_button_renderable","event_bus","components/toolbar_item_draggable_button_renderable","css/toolbar.css","classnames","underscore","components/toolbar_item_text_renderable","components/toolbar_item_dropdown_renderable","components/toolbar_item_color_renderable","reusable_components"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToolbarRenderable=class extends i.BaseComponent{constructor(e){super(e),this.cancellationToken.addCleanupFunction(o.eventBus.subscribe(o.EVENT_TYPES.UPDATE_TOOLBAR,this.update.bind(this)).unsubscribe),this.cancellationToken.subscribeToStream(o.eventBus,o.EVENT_TYPES.TOOLBAR_BLOCK_ITEM_SINGLE_SELECT,this.handleBlockItemSingleSelect.bind(this)),this.state={model:this.props.model}}componentDidMount(){o.eventBus.dispatch({type:o.EVENT_TYPES.TOOLBAR_MOUNTED,value:!0})}componentWillUnmount(){super.componentWillUnmount(),o.eventBus.dispatch({type:o.EVENT_TYPES.TOOLBAR_MOUNTED,value:!1})}render(){const e=c(["toolbar",l.toolbarStyle.toolbar]);return s.createElement("div",{className:e},s.createElement("div",{className:"items clearfix"},this.renderItems(),this.renderOptionalBlocks()))}renderItems(){return this.props.model.items.map(e=>this.renderItem(e))}renderItem(e,t){const i=this.getRenderableForItemType(e.type);return null!==i?void 0!==e.tooltip&&e.tooltip.length>0?s.createElement(g.TooltipComponent,{key:e.id,text:e.tooltip,position:"bottom"},s.createElement(i,{model:e,block:t})):s.createElement(i,{model:e,block:t,key:e.id}):null}renderOptionalBlocks(){return void 0!==this.state.model.optionalBlocks?this.state.model.optionalBlocks.map((e,t)=>{const i=this.state.model.optionalBlocks.length-1;return s.createElement("div",{className:"optional-block",key:e.id},0===t?s.createElement("div",{className:"block-separator"}):null,this.renderOptionalBlockItems(e),t<i?s.createElement("div",{className:"block-separator"}):null)}):null}renderOptionalBlockItems(e){return e.items.map(t=>this.renderItem(t,e))}getRenderableForItemType(e){switch(e){case n.ToolbarItemType.DRAGGABLE_BUTTON:return a.ToolbarItemDraggableButtonRenderable;case n.ToolbarItemType.DROPDOWN_BUTTON:case n.ToolbarItemType.DROPDOWN_BUTTON_NUMBER_INPUT:return u.ToolbarItemDropdownRenderable;case n.ToolbarItemType.DROPDOWN_BUTTON_COLOR:return p.ToolbarItemColorRenderable;case n.ToolbarItemType.TEXT:return h.ToolbarItemTextRenderable;default:return r.ToolbarItemButtonRenderable}}update(e){let t=!1;e.value.optionalItemBlocks.forEach(e=>{const i=d.findIndex(this.state.model.optionalBlocks,t=>t.id===e.id||t.type===e.type);-1===i?e.show&&(this.addNewBlock(e),t=!0):(e.show?this.replaceBlock(e,i):this.removeBlock(e),t=!0)}),t&&this.forceUpdate()}addNewBlock(e){void 0===this.state.model.optionalBlocks&&(this.state.model.optionalBlocks=[]),this.state.model.optionalBlocks.push(e)}replaceBlock(e,t){this.state.model.optionalBlocks.splice(t,1,e)}removeBlock(e){const t=d.findIndex(this.state.model.optionalBlocks,t=>t.id===e.id);this.state.model.optionalBlocks.splice(t,1)}handleBlockItemSingleSelect(e){let t;if(void 0!==e.value.block){const i=d.find(this.state.model.optionalBlocks,t=>t.id===e.value.block.id);t=JSON.parse(JSON.stringify(i.items)),i.items=t}else t=JSON.parse(JSON.stringify(this.state.model.items)),this.state.model.items=t;this.setItemSelectionsById(t,e.value.item.id),this.forceUpdate()}setItemSelectionsById(e,t){e.forEach(e=>{let i=e.id===t;!0===e.unselectable&&!0===e.selected&&(i=!i),e.selected=i})}}}),define("models/video_box_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/video_box_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("css/video_box.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoBoxStyleModel={videoBox:{width:"100%",height:"100%"},videoBlock:{width:"100%",height:"100%"},videoBlockEditable:{position:"relative",width:"100%",height:"75%",padding:10},videoWrapper:{display:"block",position:"relative",height:"100%","&.video-unicepta":{"& video":{width:"100%",border:"1px solid #bdc3c7","&::-internal-media-controls-download-button":{display:"none"},"&::-webkit-media-controls-enclosure":{overflow:"hidden"},"::-webkit-media-controls-panel":{width:"calc(100% + 30px)",marginLeft:"-1px"}}}},iframe:{width:"100%",height:"100%"},videoPlaceholder:{position:"relative",height:"100%",marginBottom:15,border:"1px dashed lightgray",textAlign:"center",minHeight:"150px"},videoPlaceholderLabel:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},urlBlock:{marginTop:10},urlLabel:{textAlign:"right",marginBottom:0,padding:"2px 10px 2px 4px",width:"35%"},urlInputWrapper:{display:"inline-block",width:"65%",paddingRight:10},urlInput:{width:"100%"},saveButton:{margin:15},cancelButton:{margin:15},placeholderIcon:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},t.videoBoxStyle=i.createCssModule(()=>t.videoBoxStyleModel).compute({}).attach().getModule()}),define("interfaces/video_box_save_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/video_box_renderable",["require","exports","flux","reusable_utilities","classnames","reusable_components","react","css/video_box.css","event_bus","css/image_box.css"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoBoxRenderable=class extends i.BaseComponent{constructor(e){super(e),this.props.settings.editable&&(this.cancellationToken.addDomEvent($(document),"mouseup",e=>this.handleMouseUp(e)),this.cancellationToken.addDomEvent($(document),"mousedown",e=>this.handleMouseDown())),this.state={url:e.model.url}}componentWillReceiveProps(e){e.model.url!==this.props.model.url&&this.initializeState(e)}render(){const e=n(["video-box",a.videoBoxStyle.videoBox]),t=this.props.settings.editable?a.videoBoxStyle.videoBlockEditable:a.videoBoxStyle.videoBlock;return o.createElement("div",{ref:this.handleElement.bind(this),id:this.props.model.id,className:e},o.createElement("div",{className:t},this.renderBoxContent()),this.renderUrlInput(),this.renderSaveButton(),this.renderCancelButton())}renderBoxContent(){if(this.props.settings.editable)return s.StringUtils.isValidVideoUrl(this.state.url,this.props.settings.hosts)?this.renderVideoPlayer():this.renderVideoPlaceholder();if(s.StringUtils.isValidVideoUrl(this.state.url,this.props.settings.hosts))return this.renderVideoPlayer();if(this.props.settings.editable)return null;{const e=n([a.videoBoxStyle.placeholderIcon,"icon2-tw-video"]);return void 0!==this.elem&&this.adaptFontSize(),o.createElement("i",{className:e,style:{fontSize:this.placeholderIconFontSize}})}}renderVideoPlayer(){const e=this.props.model.id,t=this.state.url,i=this.props.settings.hosts,l=s.StringUtils.getVideoHost(t,i),c=n([a.videoBoxStyle.videoWrapper,l.className]);if(l.html5video){const n=s.StringUtils.getVideoUrlPattern(t,i).exec(t)[1];return o.createElement(r.Html5Video,{fileName:n,spanClass:c,id:e,mediaUrl:t})}return o.createElement("div",{className:c},o.createElement("iframe",{src:s.StringUtils.transformVideoUrl(t,i,this.getTemplate(t)),frameBorder:"0",allowFullScreen:!0,className:a.videoBoxStyle.iframe}))}renderVideoPlaceholder(){const e=n(["video-placeholder",a.videoBoxStyle.videoPlaceholder]);return o.createElement("div",{className:e},o.createElement("span",{className:a.videoBoxStyle.videoPlaceholderLabel},this.props.model.placeholerLabel))}renderUrlInput(){if(this.props.settings.editable){const e=this.isStringEmpty(this.state.url)?void 0:a.videoBoxStyle.urlBlock;return o.createElement("div",{className:e},o.createElement("label",{className:a.videoBoxStyle.urlLabel},this.props.model.inputLabel),o.createElement("div",{className:a.videoBoxStyle.urlInputWrapper},o.createElement("input",{defaultValue:(this.state.url||"").substring(0,1024),onChange:this.onChange.bind(this),className:a.videoBoxStyle.urlInput})))}return null}renderSaveButton(){if(this.props.settings.editable){const e={"btn btn-primary pull-right":!0,disabled:this.props.model.url===this.state.url,[a.videoBoxStyle.saveButton]:!0},t=n(e);return o.createElement("div",null,o.createElement(r.ProgressButton,{onClick:this.save.bind(this),className:t,text:this.props.model.saveLabel,loadingText:this.props.model.savingLabel}))}return null}renderCancelButton(){if(this.props.settings.editable){const e=n(["btn","btn-default","pull-right",c.imageBoxStyle.cancelButton]);return o.createElement("button",{onClick:this.cancel.bind(this),className:e},this.props.model.cancelLabel)}return null}initializeState(e){this.setState({url:e.model.url})}onChange(e){const t=e.target.value;this.setState({url:t})}getTemplate(e){return s.StringUtils.getVideoHost(e,this.props.settings.hosts).template}save(e){const t={id:this.props.model.id,mediaUrl:this.state.url};l.eventBus.dispatch({type:l.EVENT_TYPES.VIDEO_BOX_SAVE,value:t})}cancel(e){const t={id:this.props.model.id,editable:!1};l.eventBus.dispatch({type:l.EVENT_TYPES.VIDEO_BOX_EDITABLE_CHANGED,value:t})}handleMouseUp(e){s.DOMMath.isPointOnElement({x:e.clientX,y:e.clientY},$(this.elem))||this.savedScrollX===window.scrollX&&this.savedScrollY===window.scrollY&&this.cancel(void 0)}handleMouseDown(){this.savedScrollX=window.scrollX,this.savedScrollY=window.scrollY}isStringEmpty(e){return void 0===e||0===e.length}handleElement(e){const t=this.elem;null!==e&&(this.elem=e,this.adaptFontSize(),void 0===t&&this.forceUpdate())}adaptFontSize(){this.isStringEmpty(this.state.url)&&!this.props.settings.editable&&(this.placeholderIconFontSize=Math.floor(.3*Math.min(this.elem.clientWidth,this.elem.clientHeight)))}}}),define("interfaces/focus_changed_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/text_box_save_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("report_components",["require","exports","components/image_box_renderable","components/text_box_renderable","components/toolbar_renderable","components/video_box_renderable","interfaces/optional_toolbar_block","interfaces/toolbar_item"],function(e,t,i,s,n,r,o,a){"use strict";function l(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),l(i),l(s),l(n),l(r),l(o),l(a)}),define("anchor/abstract/interfaces/model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FIXED="FIXED",e.SCROLLABLE="SCROLLABLE"}(t.DisplayMode||(t.DisplayMode={}))}),define("anchor/abstract/interfaces/move_node_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("anchor/actions/anchor_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnchorActions={anchor_onClick:"anchor_onClick",anchor_updateAll:"anchor_updateAll"}}),define("anchor/abstract/renderables/abstract_anchor",["require","exports","react","flux","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractAnchor=class extends s.BaseComponent{constructor(e){super(e),this.id=_.uniqueId("anchor-container"),this.state={hovering:!1}}render(){const{model:e}=this.props,t=n({"tw-anchor stylized-scrollbar":!0,[e.className]:!0,hovering:this.state.hovering});return i.createElement("div",{id:this.id,style:this.props.style,className:t,onMouseEnter:this.onMouseEnter.bind(this)},this.renderBeforeFirstNode(),e.nodes.map((t,i)=>this.renderNode(t,i,e.nodeSize,e.nodeOffset,e)),this.renderAfterLastNode())}componentDidMount(){this.mouseMoveHandler=_.throttle(()=>{this.state.hovering&&0===$(":hover").parents("[tw-icon-anchor]").length&&(void 0!==this.timeOutId&&clearTimeout(this.timeOutId),this.timeOutId=setTimeout(()=>{this.state.hovering&&0===$(":hover").parents("[tw-icon-anchor]").length&&this.setState({hovering:!1}),this.timeOutId=void 0},100))},30,{leading:!0,trailing:!0}),this.cancellationToken.addDomEvent($("body"),"mousemove",this.mouseMoveHandler)}onMouseEnter(e){setTimeout(()=>{$(":hover").parents(".tw-anchor").length>0&&(void 0!==this.timeOutId&&clearTimeout(this.timeOutId),this.timeOutId=setTimeout(()=>{$(":hover").parents(".tw-anchor").length>0&&this.setState({hovering:!0}),this.timeOutId=void 0},500))})}renderBeforeFirstNode(){return null}renderAfterLastNode(){return null}}}),define("drag_and_drop/draggable_service",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.draggableInstances=[]}registerDraggable(e){this.draggableInstances.push(e)}unregisterDraggable(e){this.draggableInstances.splice(this.draggableInstances.indexOf(e),1)}forwardCallToDropzones(e,t,...s){i.chain(this.draggableInstances).filter(e=>e.isDropzone()&&i.any(e.dropAcceptChannels,e=>i.contains(t,e))).map(e=>e.dropzoneStrategy[i.find(t,t=>i.contains(e.dropAcceptChannels,t))]).invoke(e,...s)}onMove(e,t){this.forwardCallToDropzones("onMove",t.dropTargetChannels,...Array.prototype.slice.call(arguments))}onDragStart(e,t){this.forwardCallToDropzones("onDragStart",t.dropTargetChannels,...Array.prototype.slice.call(arguments))}onDragEnd(e,t){this.forwardCallToDropzones("onDragEnd",t.dropTargetChannels,...Array.prototype.slice.call(arguments))}}t.DraggableService=s,t.draggableService=new s}),define("drag_and_drop/strategies/abstract_draggable_strategy",["require","exports","reusable_utilities","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractDraggableStrategy=class{constructor(e){this.draggable=e}getChannel(e){return s(e.dropTargetChannels).find(e=>s(this.draggable.dropAcceptChannels).contains(e))}onDragStart(e,t){const i=this.getChannel(t);this.draggable.dropzoneHighlight(i)}isOnTopOf(e,t){return i.DOMMath.isPointOnElement({x:e.pageX,y:e.pageY},t)}onDragEnd(e,t){const i=this.getChannel(t);this.draggable.removeDropzoneHighlight(i),this.draggable.removeDropzoneHighlightHover(i)}}}),define("drag_and_drop/strategies/draggable_children_strategy",["require","exports","drag_and_drop/strategies/abstract_draggable_strategy","reusable_utilities"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DraggableChildrenStrategy=class extends i.AbstractDraggableStrategy{onMove(e,t){const i=this.getChannel(t),{typeSpecificConfig:{childrenSelector:n,canChangeParent:r}}=this.draggable.dropzoneConfig[i];(r||-1!==$(this.draggable.getRootElement()).find(n).index(t.getRootElement()))&&(this.draggable.getRootElement()!==t.getRootElement()&&this.isOnTopOf(e,$(this.draggable.getRootElement()))&&($(t.getRootElement()).remove(),this.draggable.getRootElement().appendChild(t.getRootElement()),t.updateOffset(e)),$(this.draggable.getRootElement()).find(n).each((i,n)=>{n!==t.getRootElement()&&this.isOnTopOf(e,$(n))&&($(t.getRootElement()).remove(),s.DOMMath.isPointOnUpperHalf({x:e.pageX,y:e.pageY},$(n))?$(t.getRootElement()).insertBefore($(n)):$(t.getRootElement()).insertAfter($(n)),t.updateOffset(e))}))}onDragEnd(e,t){const i=this.getChannel(t),{typeSpecificConfig:{childrenSelector:s}}=this.draggable.dropzoneConfig[i];this.draggable.removeDropzoneHighlight(i),this.draggable.removeDropzoneHighlightHover(i);const n=$(this.draggable.getRootElement()).find(s).index(t.getRootElement());n>=0&&this.draggable.props.dropzoneConfig[i].callback(t.model,this.draggable.model,n)}}}),define("drag_and_drop/strategies/draggable_self_strategy",["require","exports","reusable_utilities","drag_and_drop/strategies/abstract_draggable_strategy"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DraggableSelfStrategy=class extends s.AbstractDraggableStrategy{onMove(e,t){const s=this.draggable.getRootElement();s!==t.getRootElement()&&this.isOnTopOf(e,$(s))&&($(t.getRootElement()).remove(),i.DOMMath.isPointOnUpperHalf({x:e.pageX,y:e.pageY},$(s))?$(t.getRootElement()).insertBefore($(s)):$(t.getRootElement()).insertAfter($(s)),t.updateOffset(e))}onDragStart(e,t){const i=this.getChannel(t);this.draggable.dropzoneHighlight(i)}onDragEnd(e,t){const i=this.getChannel(t);if(super.onDragEnd(e,t),this.isOnTopOf(e,$(this.draggable.getRootElement()))){const e=$(this.draggable.getRootElement()).parent().children().index(t.getRootElement());this.draggable.props.dropzoneConfig[i].callback(t.model,this.draggable.model,e)}}}}),define("drag_and_drop/draggable",["require","exports","event_bus","flux","underscore","drag_and_drop/draggable_service","drag_and_drop/strategies/draggable_children_strategy","drag_and_drop/strategies/draggable_self_strategy"],function(e,t,i,s,n,r,o,a){"use strict";var l;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.self=0]="self",e[e.children=1]="children"}(l=t.DropzoneType||(t.DropzoneType={}));t.Draggable=class extends s.BaseComponent{get dropAcceptChannels(){return n.keys(this.props.dropzoneConfig)}get dropTargetChannels(){return this.props.dropTargetChannels}get model(){return this.props.model}get dropzoneConfig(){return this.props.dropzoneConfig}constructor(e){super(e),this.started=!1,this.dropzoneStrategy={},this.initialize(e)}componentDidMount(){r.draggableService.registerDraggable(this),this.cancellationToken.registerCleanupFunction(()=>{r.draggableService.unregisterDraggable(this),void 0!==this.releaseCleanUp&&this.releaseCleanUp()})}componentWillReceiveProps(e){this.initialize(e)}initialize(e){this.isDropzoneByProps(e)&&n.keys(e.dropzoneConfig).forEach(t=>{switch(e.dropzoneConfig[t].type){case l.children:this.dropzoneStrategy[t]=new o.DraggableChildrenStrategy(this);break;case l.self:this.dropzoneStrategy[t]=new a.DraggableSelfStrategy(this)}})}render(){const{className:e,style:t,domNode:i}=this.props;return i({ref:"root",className:e,style:t,onMouseDown:e=>this.mouseDown(e)},this.props.children)}getRootElement(){return this.refs.root}isDropzone(){return this.isDropzoneByProps(this.props)}isDropzoneByProps(e){return void 0!==this.props.dropzoneConfig}release(e){if(this.releaseCleanUp(),this.started){e.preventDefault(),e.stopPropagation();const t=this.getRootElement();t.style.position="",void 0!==this.findParentContainer()&&(t.style.opacity=void 0),r.draggableService.onDragEnd(e,this),i.eventBus.dispatch({type:i.EVENT_TYPES.REACT_DRAGGABLE_DRAG_STOP,value:this.props.dropTargetChannels})}}move(e){!this.started&&(e.offsetX-this.clickLocation.offsetX>15||e.offsetY-this.clickLocation.offsetY>15)&&(this.started=!0,this.handleDraggedElementStart(e),r.draggableService.onDragStart(e,this)),this.started&&(e.stopPropagation(),e.preventDefault(),this.updateOffset(e),r.draggableService.onMove(e,this))}handleDraggedElementStart(e){const t=this.findParentContainer();void 0!==t&&(this.draggedElement=this.getRootElement().cloneNode(!0),this.draggedElement.style.position="absolute",this.draggedElement.style.left=this.clickLocation.x-e.offsetX+"px",this.draggedElement.style.top=this.clickLocation.y-e.offsetY+"px",this.draggedElement.style.zIndex="9999",document.body.appendChild(this.draggedElement),this.getRootElement().style.opacity="0",this.draggedElement.onwheel=(e=>{e.preventDefault(),t.scrollTop+=e.deltaY}),i.eventBus.dispatch({type:i.EVENT_TYPES.REACT_DRAGGABLE_DRAG_START,value:this.props.dropTargetChannels}))}mouseDown(e){this.started=!1;const{disabled:t}=this.props;if(t||0!==e.button)return;e.stopPropagation(),e.preventDefault();let i=e.pageX-this.getRootElement().offsetLeft,s=e.pageY-this.getRootElement().offsetTop;const n=this.findParentContainer();void 0!==n&&(i+=n.scrollLeft,s+=n.scrollTop),this.clickLocation={x:i,y:s,offsetX:e.nativeEvent.offsetX,offsetY:e.nativeEvent.offsetY};const r=e=>this.release(e),o=e=>this.move(e);void 0!==this.releaseCleanUp&&this.releaseCleanUp(),window.document.addEventListener("mouseup",r),window.document.addEventListener("mousemove",o),this.releaseCleanUp=(()=>{window.document.removeEventListener("mouseup",r),window.document.removeEventListener("mousemove",o),void 0!==this.draggedElement&&(document.body.removeChild(this.draggedElement),this.draggedElement=void 0,this.getRootElement().style.opacity=void 0)})}dropzoneHighlight(e){this.props.dropzoneConfig[e].dropZoneHighlightClass&&$(this.getRootElement()).addClass(this.props.dropzoneConfig[e].dropZoneHighlightClass)}removeDropzoneHighlight(e){this.props.dropzoneConfig[e].dropZoneHighlightClass&&$(this.getRootElement()).removeClass(this.props.dropzoneConfig[e].dropZoneHighlightClass)}dropzoneHighlightHover(e){this.props.dropzoneConfig[e].dropZoneHighlightClassOnHover&&$(this.getRootElement()).addClass(this.props.dropzoneConfig[e].dropZoneHighlightClassOnHover)}removeDropzoneHighlightHover(e){this.props.dropzoneConfig[e].dropZoneHighlightClassOnHover&&$(this.getRootElement()).removeClass(this.props.dropzoneConfig[e].dropZoneHighlightClassOnHover)}updateOffset(e){const t=this.getRootElement();let i=Number(t.style.left.substring(0,t.style.left.indexOf("px"))),s=Number(t.style.top.substring(0,t.style.top.indexOf("px")));const n=this.findParentContainer();void 0!==n&&(i+=n.scrollLeft,s+=n.scrollTop),this.moveOffset={x:e.pageX-(this.clickLocation.x+t.offsetLeft-i),y:e.pageY-(this.clickLocation.y+t.offsetTop-s)},t.style.position="relative",t.style.left=this.moveOffset.x+"px",t.style.top=this.moveOffset.y+"px",t.style.zIndex="9999",void 0!==this.draggedElement&&(this.draggedElement.style.left=e.pageX-this.clickLocation.offsetX+"px",this.draggedElement.style.top=e.pageY-this.clickLocation.offsetY+"px")}findParentContainer(){if(void 0!==this.props.parentContainerId){const e=$(this.refs.root).closest(`#${this.props.parentContainerId}`);return e.length>0?e[0]:void 0}}}}),define("anchor/preview_anchor/interfaces/model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("icons/models/page_icon_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.FROM_TITLE="FROM_TITLE",e.FIGURE="FIGURE",e.CUSTOM_LETTERS="CUSTOM_LETTERS"}(t.CustomPageIconType||(t.CustomPageIconType={}))}),define("icons/classes/icon_maps",["require","exports","talkwalker_constants","map","icons/models/page_icon_model"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}r.pageIconMap=new s.Map([[i.PageIcon.CUSTOM,""],[i.PageIcon.NONE,""],[i.PageIcon.BINOCULARS,"icon2-tw-binoculars"],[i.PageIcon.CLOCK,"icon2-tw-clock"],[i.PageIcon.COMPASS,"icon2-tw-compass"],[i.PageIcon.CROSSHAIRS,"fa fa-crosshairs"],[i.PageIcon.COLUMN_CHART,"icon2-tw-qs-charts"],[i.PageIcon.DEMOGRAPHIC,"icon2-tw-qs-who"],[i.PageIcon.EYE,"icon2-tw-eye"],[i.PageIcon.HANDSHAKE,"fa fa-handshake-o"],[i.PageIcon.IMAGE,"icon2-tw-qs-images"],[i.PageIcon.KPI,"icon-tw-kpi"],[i.PageIcon.LEADER,"icon2-tw-qs-people"],[i.PageIcon.LIST,"fa fa-th-list"],[i.PageIcon.LIST_SEARCH,"icon2-tw-results-list"],[i.PageIcon.MAP,"icon2-tw-worldmap"],[i.PageIcon.NETWORK,"icon2-tw-influencer-network"],[i.PageIcon.ROCKET,"icon2-tw-discovery"],[i.PageIcon.SEARCH,"icon-tw-search"],[i.PageIcon.SPEEDOMETER,"icon2-tw-gauge"],[i.PageIcon.SUMMARY,"fa fa-line-chart"],[i.PageIcon.THEME,"icon2-tw-themecloud"],[i.PageIcon.TREND_CHART,"icon2-tw-results-list"],[i.PageIcon.WATCHLIST,"fa fa-table"],[i.PageIcon.COLUMNS,"fa fa-columns"],[i.PageIcon.LIST_UL,"fa fa-list-ul"],[i.PageIcon.CARDS,"icon2-tw-cards"]]),r.pageIconTypeMap=new s.Map([[n.CustomPageIconType.FROM_TITLE,"fa fa-font"],[n.CustomPageIconType.FIGURE,"fa fa-hashtag"],[n.CustomPageIconType.CUSTOM_LETTERS,"fa fa-i-cursor"]]),t.IconMaps=r}),define("generic/components/icon_component/icon_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/icon_component/icon_component_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconComponentRenderable=class extends i.BaseComponent{render(){return s.createElement("div",{className:`identity-icon-component ${this.props.containerClassName||""}`,style:this.generateStyle(),ref:e=>{this.ref=e}},this.generateValue())}generateStyle(){const e=this.props.textColor?this.props.textColor:"white",t=this.props.backgroundColor?this.props.backgroundColor:"transparent",i=this.props.rounded?"100%":"";return Object.assign({color:e,backgroundColor:t,borderRadius:i,width:this.props.size},this.props.customStyle)}componentDidMount(){const{customStyle:e}=this.props;e&&e.height||(this.ref.style.height=`${this.ref.offsetWidth}px`),e&&e.width||(this.ref.style.width=this.ref.style.height),e&&e.fontSize||(this.ref.style.fontSize=(this.ref.offsetWidth/1.7).toString()+"px")}}}),define("generic/components/initials_component/initials_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/initials_component/initials_component_renderable",["require","exports","react","generic/components/icon_component/icon_component_renderable"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InitialsComponentRenderable=class extends s.IconComponentRenderable{generateValue(){return i.createElement("span",null,this.props.initials)}}}),define("generic/components/font_icon_component/font_icon_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/font_icon_component/font_icon_component_renderable",["require","exports","react","generic/components/icon_component/icon_component_renderable"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FontIconComponentRenderable=class extends s.IconComponentRenderable{generateValue(){return i.createElement("i",{className:this.props.icon})}}}),define("icons/components/page_icon_component",["require","exports","react","flux","icons/models/page_icon_model","talkwalker_constants","icons/classes/icon_maps","generic/components/initials_component/initials_component_renderable","generic/components/font_icon_component/font_icon_component_renderable"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PageIconComponent=class extends s.BaseComponent{render(){const{model:e,pageTitle:t,pageNumber:s,iconProps:c,displayIconType:d}=this.props;let h;if(e.type===r.PageIcon.CUSTOM){switch(e.customIconData.type){case n.CustomPageIconType.FROM_TITLE:h=i.createElement(a.InitialsComponentRenderable,Object.assign({initials:t.substring(0,1).toUpperCase()},c));break;case n.CustomPageIconType.FIGURE:h=i.createElement(a.InitialsComponentRenderable,Object.assign({initials:s.toString()},c));break;case n.CustomPageIconType.CUSTOM_LETTERS:h=i.createElement(a.InitialsComponentRenderable,Object.assign({initials:e.customIconData.content},c))}if(d){const t=o.IconMaps.pageIconTypeMap.get(e.customIconData.type);h=i.createElement("div",{style:{position:"relative"}},h,i.createElement("i",{className:t,style:{position:"absolute",bottom:-1,left:-1,fontSize:"small",color:"#FFFFFF",textShadow:"1px 1px 0 #000"}}))}}else h=i.createElement(l.FontIconComponentRenderable,Object.assign({icon:o.IconMaps.pageIconMap.get(e.type)},c));return h}}}),define("anchor/preview_anchor/preview_anchor_node",["require","exports","flux","react","classnames","drag_and_drop","reusable_utilities","event_bus","icons/components/page_icon_component"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PreviewAnchorNode=class extends i.BaseComponent{constructor(e){super(e)}componentDidMount(){if(this.cancellationToken.addCleanupFunction(()=>{this.renderToken&&this.renderToken.cancel()}),this.updatePreview(this.refs.previewRoot,this.props.nodeModel.preview),this.cancellationToken.addDomEvent(this.refs.previewRoot.parentElement.parentElement.parentElement.parentElement,"scroll",()=>{this.updatePreview(this.refs.previewRoot,this.props.nodeModel.preview)}),this.cancellationToken.subscribeToStream(a.eventBus,a.EVENT_TYPES.ANCHOR_PREVIEW_CHANGED,e=>{this.props.nodeModel.id===e.value.id&&(this.props.nodeModel.preview=e.value.preview,this.forceUpdate(()=>{this.updatePreview(this.refs.previewRoot,this.props.nodeModel.preview)}))}),this.props.nodeModel.dropZone){const{onDragEnter:e=_.noop,onDragStart:t=_.noop,onDragLeave:i=_.noop,onDragMove:s=_.noop,onDragStop:n=_.noop,acceptChannels:o}=this.props.nodeModel.dropZone;r.dragAndDropService.registerDropTargets([this.refs.root],{channels:o,cancellationToken:this.cancellationToken,onDragEnter:(t,i)=>{e(t,i,this.refs.root,this.props.nodeModel)},onDragStart:t,onDragLeave:(e,t)=>{i(e,t,this.refs.root,this.props.nodeModel)},onDragMove:(e,t)=>{s(e,t,this.refs.root,this.props.nodeModel)},onDragAccept:(e,t)=>{n(e,t,this.refs.root,this.props.nodeModel)}})}}render(){const{nodeModel:e,anchorModel:t,index:i}=this.props,r=n({content:!0,selected:e.selected});let o;o=t.gridCellSize&&e.gridSize?{width:t.gridCellSize.x*e.gridSize.x*t.scaleFactor+48,height:t.gridCellSize.y*e.gridSize.y*t.scaleFactor+25,left:t.nodeOffset.x*i,top:t.nodeOffset.y*i}:{width:t.nodeSize.x,height:t.nodeSize.y,left:t.nodeOffset.x*i,top:t.nodeOffset.y*i};const a={transform:`scale(${t.scaleFactor})`,width:`${100/t.scaleFactor}%`,height:`${100/t.scaleFactor}%`};return s.createElement("div",{ref:"root",onClick:s=>this.nodeClick(s,e,t,i),onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,className:"tw-anchor-node tw-preview-anchor-node",style:o},s.createElement("div",{className:"side"},this.renderIcon(i,e.icon)),s.createElement("div",{className:r},s.createElement("div",{className:"preview-node",style:a,ref:"previewRoot"}),s.createElement("div",{className:"overlay-node"}),this.renderDeleteButton(e,t),this.renderEditButton(e,t)))}renderIcon(e,t){const i={fontSize:"18px",marginTop:"4px",marginLeft:"6px",width:"16px",color:"black"};return t?s.createElement(l.PageIconComponent,{model:t.icon,pageTitle:t.pageTitle,iconProps:{customStyle:i},pageNumber:e+1}):s.createElement("span",null,e+1)}updatePreview(e,t){$(e).empty(),o.DOMMath.isOnScreen(e)&&e.appendChild(t)}renderEditButton(e,t){return t.onEditButtonClick?s.createElement("div",{className:"edit-button "+t.editButtonIcon,onClick:i=>{i.stopPropagation(),t.onEditButtonClick(e)}}):null}renderDeleteButton(e,t){return t.onDeleteButtonClick?s.createElement("div",{className:"delete-button "+t.deleteButtonIcon,onClick:i=>{i.stopPropagation(),t.onDeleteButtonClick(e)}}):null}nodeClick(e,t,i,s){i.onClick&&i.onClick(e,t,i,s)}}}),define("anchor/icon_anchor/interfaces/icon_anchor_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("anchor/icon_anchor/icon_anchor",["require","exports","react","anchor/abstract/renderables/abstract_anchor","math_utils","classnames","icons/components/page_icon_component"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconAnchor=class extends s.AbstractAnchor{constructor(e){super(e)}renderNode(e,t,s,n,o,a=0){const l=this.shouldShowChildren(e),c=r({"tw-anchor-node":!0,active:e.selected,group:l}),d=r({content:!0,selected:e.selected}),h={height:s.y,left:`${n.x}px`},u={fontSize:o.fontSize+a,width:s.x,height:s.y,marginRight:`${n.x}px`};return i.createElement("div",{onMouseEnter:o.onMouseEnter,onMouseLeave:o.onMouseLeave,className:c,style:h,key:t},i.createElement("div",{className:d,onClick:i=>this.nodeClick(i,e,o,t)},this.renderSelectedBar(e.selected),this.renderIcon(e.icon,t+1,u),this.renderLabel(e.label)),l?this.renderChildren(e.children,s,n,o,t):null)}renderIcon(e,t,s){const n={customStyle:s};return i.createElement(o.PageIconComponent,{model:e.icon,pageTitle:e.pageTitle,pageNumber:t,iconProps:n})}shouldShowChildren(e){return void 0!==e.children&&e.children.length>0&&(e.selected||e.children.some(e=>e.selected))}renderSelectedBar(e){return e?i.createElement("div",{className:"bar"}):null}renderChildren(e,t,s,r,o){const a=t.clone();a.y=42;const l=s.clone().add(new n.Vector2D((t.x-a.x)/2,0));return i.createElement("div",{className:"sub-icons"},e.map((e,t)=>this.renderNode(e,o+t+1,a,l,r,-4)))}renderLabel(e){return void 0!==e?i.createElement("span",{className:"icon-anchor-label"},e):void 0}nodeClick(e,t,i,s){void 0!==this.timeOutId&&clearTimeout(this.timeOutId),i.onClick&&i.onClick(e,t,i,s)}}}),define("anchor/presentation_anchor/interfaces/model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("anchor/presentation_anchor/presentation_anchor",["require","exports","react","anchor/abstract/renderables/abstract_anchor","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PresentationAnchor=class extends s.AbstractAnchor{renderNode(e,t,s,r,o){const a={width:o.nodeSize.x,height:o.nodeSize.y,left:o.nodeOffset.x,top:o.nodeOffset.y},l=n({"presentation-anchor-node fa fa-circle":!0,selected:e.selected});return i.createElement("div",{key:t,onClick:i=>o.onClick(i,e,o,t),className:l,style:a})}}}),define("anchor/preview_anchor/preview_anchor",["require","exports","drag_and_drop","react","drag_and_drop/draggable","anchor/abstract/renderables/abstract_anchor","anchor/preview_anchor/preview_anchor_node"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PreviewAnchor=class extends r.AbstractAnchor{constructor(e){super(e)}renderNode(e,t,i,r,a){const l={width:a.nodeSize.x,height:a.nodeSize.y,left:a.nodeOffset.x*t,top:a.nodeOffset.y*t};return s.createElement(n.Draggable,{key:_.uniqueId("anchor-node"),model:e,domNode:(e,t)=>s.createElement("div",e,t),dropzoneConfig:{previews:a.swappingConfiguration},dropTargetChannels:this.props.model.dropzoneChannels,parentContainerId:this.id,className:"draggable-anchor",style:l},s.createElement(o.PreviewAnchorNode,{nodeModel:e,anchorModel:a,index:t}))}onMouseEnter(){}onMouseLeave(){}renderAfterLastNode(){const{nodeSize:e,nodeOffset:t,nodes:i}=this.props.model,n={width:e.x,height:Math.max(50,e.y||0),left:t.x*i.length,top:t.y*i.length};return this.props.model.onAddButtonClick&&this.props.model.nodes.length<this.props.model.maxNodeCount?s.createElement("div",{ref:"addButton",onClick:e=>this.props.model.onAddButtonClick(),className:"tw-anchor-node tw-preview-anchor-node",style:n},s.createElement("div",{className:"content add"},s.createElement("i",{className:"fa fa-plus"}),s.createElement("span",null,"Add"))):null}componentDidMount(){this.addDropzone(this.refs.addButton)}addDropzone(e){if(e&&this.props.model.addButtonDropZone){const{onDragEnter:t=_.noop,onDragStart:s=_.noop,onDragLeave:n=_.noop,onDragMove:r=_.noop,onDragStop:o=_.noop,acceptChannels:a}=this.props.model.addButtonDropZone;i.dragAndDropService.registerDropTargets([e],{channels:a,cancellationToken:this.cancellationToken,onDragEnter:(i,s)=>{t(i,s,e,this.props.model)},onDragStart:s,onDragLeave:(t,i)=>{n(t,i,e,this.props.model)},onDragMove:(t,i)=>{r(t,i,e,this.props.model)},onDragAccept:(t,i)=>{o(t,i,e,this.props.model)}})}}}}),define("animated_label/animated_label",["require","exports","underscore","flux","canvas_engine"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AnimatedLabel=class extends s.BaseComponent{constructor(e){super(e),this.state={value:0,formattedValue:""}}componentDidMount(){this.setupTween(this.props)}componentWillReceiveProps(e){e.start===this.props.start&&e.end===this.props.end||this.setupTween(e)}setupTween(e){const{start:t,end:i,duration:s}=e;this.target={_value:t},this.animationComponent=new n.AnimationComponent,this.animationComponent.attach(this),this.cancellationToken.registerDisposable(this.animationComponent),this.sequence=this.animationComponent.tween(this.target,{key:"_value",value:i,duration:s}),this.play()}play(){const{onStep:e,onDone:t}=this.props,s=this.sequence.getAnimations()[0];s.onAnimationStep.subscribe(()=>{const t=i.isUndefined(e)?`${this.target._value}`:e(this.target._value);this.setState({formattedValue:t,value:this.target._value})}),s.onDone.subscribe(()=>{if(this.animationComponent.destroyAll(),!i.isUndefined(t)){const e=t(this.target._value);this.setState({formattedValue:e})}}),this.animationComponent.play(this.sequence)}render(){const{value:e,formattedValue:t}=this.state,{renderFunction:i}=this.props;return i(e,t)}}}),define("generic/components/models/sentiments",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.POSITIVE="positive",e.NEUTRAL="neutral",e.NEGATIVE="negative",e.NONE="none"}(t.Sentiment||(t.Sentiment={}))}),define("generic/actions/generic_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericActions={generic_onClickUrlAndSetRead:"generic_onClickUrlAndSetRead",generic_onOpenContextPage:"generic_onOpenContextPage",generic_onRemoveArticlesBySources:"generic_onRemoveArticlesBySources",generic_onToggleChildFilter:"generic_onToggleChildFilter",generic_onTriggerChildrenLoadmore:"generic_onTriggerChildrenLoadmore",generic_onTriggerTranslationToggle:"generic_onTriggerTranslationToggle",generic_onToggleEntryUserWorkflow:"generic_onToggleEntryUserWorkflow",generic_onReportImageMismatch:"generic_onReportImageMismatch",generic_onApplySentiment:"generic_onApplySentiment",generic_onToggleImportant:"generic_onToggleImportant"}}),define("blocks/components/click_actions/apply_sentiment_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ApplySentimentClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&this.model.stop_propagation&&e.stopPropagation(),i.dispatcher.dispatch(s.GenericActions.generic_onApplySentiment,{widgetId:this.model.widget_id,sentiment:this.model.sentiment.toUpperCase(),canTagComments:this.model.canTagComments})})}}}),define("blocks/components/click_actions/fetch_and_toggle_translation_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FetchAndToggleTranslationClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation()),i.dispatcher.dispatch(s.GenericActions.generic_onTriggerTranslationToggle,{entryId:this.model.article_id,widgetId:this.model.widget_id,showTranslation:!this.model.translation_status,targetLanguage:this.model.targetLanguage})})}}}),define("blocks/components/click_actions/interfaces/action_ payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/show_influencer_campaigns_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/open_influencer_detailed_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/show_influencer_lists_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/open_context_page_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OpenContextPageClickAction=class{constructor(e){this.model=e,this.callback=(e=>{this.model.url&&e&&(e.preventDefault(),e.nativeEvent.preventDefault()),i.dispatcher.dispatch(s.GenericActions.generic_onOpenContextPage,{entryId:this.model.article_id,widgetId:this.model.widget_id,pageType:this.model.page_type,clusterId:this.model.cluster_id,isComment:this.model.is_comments})})}}}),define("blocks/components/click_actions/open_story_clustering_click_action",["require","exports","blocks/components/click_actions/open_context_page_click_action"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OpenStoryClusteringClickAction=class extends i.OpenContextPageClickAction{}}),define("blocks/components/click_actions/open_url_and_set_read_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OpenUrlAndSetReadClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&e.preventDefault(),i.dispatcher.dispatch(s.GenericActions.generic_onClickUrlAndSetRead,{widgetId:this.model.widget_id,entryId:this.model.article_id,url:this.model.url,safeRedirectUrl:this.model.safe_redirect_url})})}}}),define("blocks/components/click_actions/open_url_click_action",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e){this.model=e,this.callback=(t=>{t&&(t.preventDefault(),t.stopPropagation()),window.open(i.getRedirectUrl(e),"blank")})}static getRedirectUrl(e){const{url:t,safe_redirect_url:i}=e;return void 0!==i?i:t}}t.OpenUrlClickAction=i}),define("blocks/components/click_actions/interfaces/on_show_influencer_campaigns_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/show_influencer_campaigns_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowInfluencerCampaignsClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation());const t={actionPayload:this.model.action_payload,widgetId:this.model.widget_id};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_INFLUENCER_CAMPAIGNS,value:t})})}}}),define("blocks/components/click_actions/interfaces/on_open_influencer_detailed_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/open_influencer_detailed_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OpenInfluencerDetailedClickAction=class{constructor(e){this.model=e,this.callback=(e=>{if(e){if(e.stopPropagation(),e.nativeEvent.stopPropagation(),void 0!==this.timeout)return;this.timeout=window.setTimeout(()=>{this.timeout=void 0},300)}const t={influencerId:this.model.influencer_id,pageType:this.model.page_type,widgetId:this.model.widget_id,query:this.model.action_payload.query};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_INFLUENCER_DETAILED,value:t})})}}}),define("blocks/components/click_actions/interfaces/on_show_influencer_lists_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/show_influencer_lists_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowInfluencerListsClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation());const t={actionPayload:this.model.action_payload,widgetId:this.model.widget_id};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_INFLUENCER_LISTS,value:t})})}}}),define("blocks/components/click_actions/show_reporting_actions_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowReportingActionsClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation()),i.dispatcher.dispatch(s.GenericActions.generic_onReportImageMismatch,{entryId:this.model.article_id,widgetId:this.model.widget_id})})}}}),define("blocks/components/click_actions/toggle_child_filter_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToggleChildFilterClickAction=class{constructor(e){this.model=e,this.callback=(e=>{i.dispatcher.dispatch(s.GenericActions.generic_onToggleChildFilter,{entryId:this.model.article_id,widgetId:this.model.widget_id,isComments:this.model.is_comments})})}}}),define("blocks/components/click_actions/toggle_entry_user_workflow_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToggleEntryUserWorkflowClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation()),i.dispatcher.dispatch(s.GenericActions.generic_onToggleEntryUserWorkflow,{entryId:this.model.article_id,widgetId:this.model.widget_id,timestamp:this.model.indexed_timestamp,savedStatus:this.model.saved_status})})}}}),define("blocks/components/click_actions/toggle_important_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ToggleImportantClickAction=class{constructor(e){this.model=e,this.callback=(e=>{i.dispatcher.dispatch(s.GenericActions.generic_onToggleImportant,{widgetId:this.model.widget_id,canTagComments:this.model.canTagComments})})}}}),define("blocks/components/click_actions/trigger_children_loadmore_click_action",["require","exports","flux","generic/actions/generic_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TriggerChildrenLoadmoreClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e.stopPropagation(),i.dispatcher.dispatch(s.GenericActions.generic_onTriggerChildrenLoadmore,{entryId:this.model.article_id,widgetId:this.model.widget_id,isComments:this.model.is_comments})})}}}),define("blocks/components/models/click_action_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClickActionTypes={OPEN_URL:"open_url",OPEN_CONTEXT_PAGE:"open_context_page",OPEN_STORY_CLUSTERING:"open_story_clustering",OPEN_URL_AND_SET_READ:"open_url_and_set_read",APPLY_SENTIMENT:"apply_sentiment",TOGGLE_IMPORTANT:"toggle_important",TOGGLE_CHILD_FILTER:"toggle_child_filter",TRIGGER_CHILDREN_LOADMORE:"trigger_children_loadmore",FETCH_AND_TOGGLE_TRANSLATION:"fetch_and_toggle_translation",SAVE_ENTRY_TO_USER_WORKFLOW:"save_entry_to_user_workflow",SHOW_REPORTING_ACTIONS:"show_reporting_actions",SHOW_INFLUENCER_LISTS:"show_influencer_lists",SHOW_INFLUENCER_CAMPAIGNS:"show_influencer_campaigns",OPEN_INFLUENCER_DETAILED:"open_influencer_details",REMOVE_INFLUENCER_FROM_LIST:"remove_influencer_from_list",SHOW_WATCHLISTS:"show_watchlists",ADD_TO_WATCHLIST:"open_add_issue_to_watchlist",OPEN_EDIT_ITEM:"open_edit_issue_to_watchlist",SHOW_VIDEO:"show_video"},t.GenericClickActionTypes={POST_CALL:"post_call",GET_CALL:"get_call",DELETE_CALL:"delete_call"}}),define("blocks/components/click_actions/interfaces/on_remove_influencer_from_list_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/remove_influencer_from_list_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/remove_influencer_from_list_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RemoveInfluencerFromListClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation());const t={widgetId:this.model.widget_id,actionPayload:this.model.action_payload,confirmationMessage:this.model.confirmation_message};i.eventBus.dispatch({type:i.EVENT_TYPES.ON_REMOVE_INFLUENCER_FROM_LIST,value:t})})}}}),define("blocks/components/click_actions/interfaces/add_to_watchlist_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_add_to_watchlist_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/add_to_watchlist_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AddToWatchlistClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation());const t={issueId:this.model.issue_id,widgetId:this.model.widget_id};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_WATCHLISTS,value:t})})}}}),define("blocks/components/click_actions/interfaces/show_watchlists_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_show_watchlists_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/show_watchlists_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowWatchlistsClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation());const t={issueId:this.model.issue_id,widgetId:this.model.widget_id};i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_WATCHLISTS,value:t})})}}}),define("blocks/components/click_actions/open_edit_item_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OpenEditItemClickAction=class{constructor(e){this.model=e,this.callback=(t=>{t&&(t.stopPropagation(),t.nativeEvent.stopPropagation()),i.eventBus.dispatch({type:i.EVENT_TYPES.OPEN_EDIT_ITEM,value:{issue_id:e.issue_id}})})}}}),define("blocks/components/click_actions/post_call_restform_click_action",["require","exports","event_bus","blocks/components/click_actions/abstract_restform_click_action"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PostCallRestformClickAction=class extends s.AbstractRestformClickAction{getEventType(){return i.EVENT_TYPES.POST_CALL_RESTFORM_CLICK_ACTION}}}),define("blocks/components/click_actions/interfaces/restform_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/post_call_restform_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/get_call_restform_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/get_call_restform_click_action",["require","exports","event_bus","blocks/components/click_actions/abstract_restform_click_action"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GetCallRestformClickAction=class extends s.AbstractRestformClickAction{getEventType(){return i.EVENT_TYPES.GET_CALL_RESTFORM_CLICK_ACTION}}}),define("blocks/components/click_actions/interfaces/delete_call_restform_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/show_video_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/show_video_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShowVideoClickAction=class{constructor(e){this.model=e,this.callback=(e=>{e&&(e.stopPropagation(),e.nativeEvent.stopPropagation()),i.eventBus.dispatch({type:i.EVENT_TYPES.SHOW_VIDEO_PLAYER,value:{endpointUrl:this.model.endpoint_url}})})}}}),define("blocks/components/factories/click_action_factory",["require","exports","blocks/components/click_actions/apply_sentiment_click_action","blocks/components/click_actions/fetch_and_toggle_translation_click_action","blocks/components/click_actions/open_context_page_click_action","blocks/components/click_actions/open_story_clustering_click_action","blocks/components/click_actions/open_url_and_set_read_click_action","blocks/components/click_actions/open_url_click_action","blocks/components/click_actions/show_influencer_campaigns_click_action","blocks/components/click_actions/open_influencer_detailed_click_action","blocks/components/click_actions/show_influencer_lists_click_action","blocks/components/click_actions/show_reporting_actions_click_action","blocks/components/click_actions/toggle_child_filter_click_action","blocks/components/click_actions/toggle_entry_user_workflow_click_action","blocks/components/click_actions/toggle_important_click_action","blocks/components/click_actions/trigger_children_loadmore_click_action","blocks/components/models/click_action_types","blocks/components/click_actions/remove_influencer_from_list_click_action","blocks/components/click_actions/add_to_watchlist_click_action","blocks/components/click_actions/show_watchlists_click_action","blocks/components/click_actions/open_edit_item_click_action","blocks/components/click_actions/post_call_restform_click_action","blocks/components/click_actions/get_call_restform_click_action","blocks/components/click_actions/delete_call_restform_click_action","blocks/components/click_actions/show_video_click_action"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ClickActionFactory=class{static create(e){if(e)switch(e.action){case _.ClickActionTypes.OPEN_URL:return new a.OpenUrlClickAction(e).callback;case _.ClickActionTypes.OPEN_URL_AND_SET_READ:return new o.OpenUrlAndSetReadClickAction(e).callback;case _.ClickActionTypes.OPEN_CONTEXT_PAGE:return new n.OpenContextPageClickAction(e).callback;case _.ClickActionTypes.OPEN_STORY_CLUSTERING:return new r.OpenStoryClusteringClickAction(e).callback;case _.ClickActionTypes.APPLY_SENTIMENT:return new i.ApplySentimentClickAction(e).callback;case _.ClickActionTypes.TOGGLE_IMPORTANT:return new g.ToggleImportantClickAction(e).callback;case _.ClickActionTypes.TOGGLE_CHILD_FILTER:return new u.ToggleChildFilterClickAction(e).callback;case _.ClickActionTypes.TRIGGER_CHILDREN_LOADMORE:return new m.TriggerChildrenLoadmoreClickAction(e).callback;case _.ClickActionTypes.FETCH_AND_TOGGLE_TRANSLATION:return new s.FetchAndToggleTranslationClickAction(e).callback;case _.ClickActionTypes.SAVE_ENTRY_TO_USER_WORKFLOW:return new p.ToggleEntryUserWorkflowClickAction(e).callback;case _.ClickActionTypes.SHOW_REPORTING_ACTIONS:return new h.ShowReportingActionsClickAction(e).callback;case _.ClickActionTypes.SHOW_INFLUENCER_LISTS:return new d.ShowInfluencerListsClickAction(e).callback;case _.ClickActionTypes.SHOW_INFLUENCER_CAMPAIGNS:return new l.ShowInfluencerCampaignsClickAction(e).callback;case _.ClickActionTypes.OPEN_INFLUENCER_DETAILED:return new c.OpenInfluencerDetailedClickAction(e).callback;case _.ClickActionTypes.REMOVE_INFLUENCER_FROM_LIST:return new f.RemoveInfluencerFromListClickAction(e).callback;case _.ClickActionTypes.SHOW_WATCHLISTS:return new b.ShowWatchlistsClickAction(e).callback;case _.ClickActionTypes.ADD_TO_WATCHLIST:return new y.AddToWatchlistClickAction(e).callback;case _.ClickActionTypes.OPEN_EDIT_ITEM:return new E.OpenEditItemClickAction(e).callback;case _.GenericClickActionTypes.POST_CALL:return new S.PostCallRestformClickAction(e).callback;case _.GenericClickActionTypes.GET_CALL:return new C.GetCallRestformClickAction(e).callback;case _.GenericClickActionTypes.DELETE_CALL:return new v.DeleteCallRestformClickAction(e).callback;case _.ClickActionTypes.SHOW_VIDEO:return new T.ShowVideoClickAction(e).callback;default:return void console.warn("Unknown click action: "+e.action)}}}}),define("blocks/components/models/block_action",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/models/click_action",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ClickAction=class{constructor(e){this.model=e}}}),define("blocks/components/click_actions/abstract_restform_click_action",["require","exports","event_bus"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractRestformClickAction=class{constructor(e){this.model=e,this.internalCallback=(e=>{e&&(e.preventDefault(),e.stopPropagation()),i.eventBus.dispatch({type:this.getEventType(),value:_.pick(this.model,"widget_id","action_payload","confirmation_message","refresh_after")})})}get callback(){return this.internalCallback}set callback(e){this.internalCallback=e}}}),define("blocks/components/click_actions/delete_call_restform_click_action",["require","exports","event_bus","blocks/components/click_actions/abstract_restform_click_action"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DeleteCallRestformClickAction=class extends s.AbstractRestformClickAction{getEventType(){return i.EVENT_TYPES.DELETE_CALL_RESTFORM_CLICK_ACTION}}}),define("blocks/components/click_actions/interfaces/restform_click_action_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_delete_call_restform_click_action_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_get_call_restform_click_action_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_open_issue_detailed_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_post_call_restform_click_action_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/on_remove_issue_from_list_event_bus_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/restform_click_action_handler_construct_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/models/bounding_box",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BoundingBox=class{constructor(e,t={w:0,h:0},i={top:0,right:0,left:0,bottom:0}){this.model=e,this.dimensions=t,this.padding=i}getCanvasWidth(){return this.dimensions.w}getCanvasHeight(){return this.dimensions.h}getPaddingTop(){return this.padding.top}getPaddingBottom(){return this.padding.bottom}getPaddingLeft(){return this.padding.left}getPaddingRight(){return this.padding.right}getLabel(){return this.model.label}getX(){return this.model.top_left.x*this.getCanvasWidth()}getY(){return this.model.top_left.y*this.getCanvasHeight()}getX2(){return this.model.bottom_right.x*this.getCanvasWidth()}getY2(){return this.model.bottom_right.y*this.getCanvasHeight()}getWidth(){return this.getX2()-this.getX()}getHeight(){return this.getY2()-this.getY()}getLineWidth(){return this.getWidth()<8||this.getHeight()<8?1:2}getBounds(){return{x:this.getX(),y:this.getY(),w:this.getWidth(),h:this.getHeight()}}}}),define("blocks/components/renderables/base_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/models/bounding_box_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/models/block_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/models/block",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractBlock=class{constructor(e,t){this.options=t||{},this.model=this.enhanceBlock(e)}}}),define("blocks/components/models/text_block",["require","exports","blocks/components/models/click_action","blocks/components/models/block"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextBlock=class extends s.AbstractBlock{enhanceBlock(e){const t=JSON.parse(JSON.stringify(e)),{isTranslated:s,tooltip:n,translationLanguage:r,widgetId:o,className:a,icon:l,backgroundColor:c,fontColor:d}=this.options;return s&&t.translatable?(e.alt_text&&(t.text=e.alt_text),e.alt_click_action&&(t.click_action=new i.ClickAction(e.alt_click_action).model)):e.click_action&&(t.click_action=new i.ClickAction(e.click_action).model,t.show_url=!0),c&&(t.background_color=c),d&&(t.font_color=d),o&&t.click_action&&(t.click_action.widget_id=t.click_action.widget_id||o),void 0!==n&&(t.title=n),void 0!==a&&(t.className=a),void 0!==l&&(t.icon=l),void 0!==r&&void 0!==e.click_action&&(t.click_action.targetLanguage=r),t}}}),define("blocks/components/models/image_block",["require","exports","blocks/components/models/block","blocks/components/models/click_action","blocks/components/models/bounding_box","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageBlock=class extends i.AbstractBlock{enhanceBlock(e){const{widgetId:t,showUrl:i=!1}=this.options,o=JSON.parse(JSON.stringify(e)),a=this.options.boundingBoxes;return o.show_url=i,e.click_action&&(o.click_action=new s.ClickAction(o.click_action).model,t&&(o.click_action.widget_id=o.click_action.widget_id||t)),a&&a.length>0&&(o.boundingBoxes=r.map(a,e=>new n.BoundingBox(e).model)),o}}}),define("blocks/components/models/icon_block",["require","exports","blocks/components/models/click_action","blocks/components/models/block","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconBlock=class extends s.AbstractBlock{enhanceBlock(e){const{icon:t,tooltip:s,translationLanguage:r,isTranslated:o,widgetId:a}=this.options,l=JSON.parse(JSON.stringify(e));return e.click_action&&(l.click_action=new i.ClickAction(e.click_action).model,a&&(l.click_action.widget_id=l.click_action.widget_id||a)),n.isUndefined(t)||(l.icon=t),n.isUndefined(s)||(l.title=s),e.click_action&&(n.isUndefined(r)||(l.click_action.targetLanguage=r),n.isUndefined(o)||(l.click_action.translation_status=o)),l}}}),define("blocks/components/models/block_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TEXT=0]="TEXT",e[e.IMAGE=1]="IMAGE",e[e.ICON=2]="ICON"}(t.BlockTypes||(t.BlockTypes={}))}),define("blocks/components/models/button",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/renderables/avatar_fallback_image_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AvatarFallbackImageRenderable=class extends i.BaseComponent{render(){return s.createElement("img",Object.assign({src:"/app/assets/images/articles/avatar.png",className:this.props.className},_.omit(this.props,["className","src"])))}}}),define("blocks/components/renderables/button_renderable",["require","exports","react","flux","blocks/components/factories/click_action_factory"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ButtonRenderable=class extends s.BaseComponent{render(){const e=this.props.id||null,t=this.props.className||null,s=this.generateIcons(),n=this.generateOnClick();return i.createElement("div",{className:t,onClick:n,id:e,title:this.props.title},s)}generateIcons(){return("string"==typeof this.props.icon?[this.props.icon]:this.props.icon).map((e,t)=>i.createElement("i",{className:e,key:"icon-"+t}))}generateOnClick(){return this.props.click_action?n.ClickActionFactory.create(this.props.click_action):this.props.onClick?this.props.onClick:null}}}),define("blocks/components/renderables/event_handle_wrapper",["require","exports","flux","log","blocks/components/factories/click_action_factory","react"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventHandleWrapper=class extends i.BaseComponent{constructor(){super(...arguments),this.prepareCallbacks=(e=>{if(this.isEventHandleWrap(e)&&e.addDebugLogs)return(e=this.createHandleWrapProxy(e)).callback;if(this.isClickActionModel(e))return e.addDebugLogs?(e=this.createHandleWrapProxy(n.ClickActionFactory.create(e))).callback:n.ClickActionFactory.create(e);if(e)throw new Error(`Wrong callback configuration! ${e}`)})}render(){const{onClick:e,onMouseDown:t,onMouseUp:i,onMouseEnter:s,onMouseLeave:n}=this.props,[o,a,l,c,d]=[e,t,i,s,n].map(this.prepareCallbacks);return r.createElement("span",{className:"event-handle-wrapper",onClick:o,onMouseUp:l,onMouseDown:a,onMouseEnter:c,onMouseLeave:d},this.props.children)}isEventHandleWrap(e){return e&&void 0!==e.callback&&void 0!==e.addDebugLogs}isClickActionModel(e){return e&&void 0!==e.action}createHandleWrapProxy(e){return new Proxy(e,{get:(t,i)=>(s.logService.info(e.debugGetMsg?e.debugGetMsg:`Accessing handler with get: ${e}`),t[i]),set:(t,i,n)=>(s.logService.info(e.debugSetMsg?e.debugSetMsg:`Accessing handler with set: ${e}`),i in t&&(t[i]=n,!0))})}}}),define("blocks/components/renderables/fallback_image_renderable",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FallbackImageRenderable=class extends i.BaseComponent{render(){const e={clear:"both",marginRight:0,height:void 0,textAlign:"initial"};return this.props.fullSize&&(e.height="100%"),this.props.adaptiveFontSize&&(e.textAlign="center"),s.createElement("div",{ref:e=>this.adaptFont(e),className:"img-error-style",style:e},s.createElement("i",Object.assign({},_.omit(this.props,["fullSize","adaptiveFontSize"]))))}adaptFont(e){e&&this.props.adaptiveFontSize&&(e.children[0].style.fontSize=e.clientHeight+"px")}}}),define("blocks/components/renderables/icon_block_renderable",["require","exports","react","classnames","flux","blocks/components/factories/click_action_factory"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconBlockRenderable=class extends n.BaseComponent{render(){const e={title:this.props.title,className:s({[this.props.icon]:!0,clickable:void 0!==this.props.click_action}),onClick:r.ClickActionFactory.create(this.props.click_action)};return i.createElement("i",Object.assign({},e))}}}),define("blocks/components/renderables/bounding_box_renderable",["require","exports","flux","react","blocks/components/models/bounding_box"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BoundingBoxRenderable=class extends i.BaseComponent{constructor(e){super(e),this.colorMap=[{fillColor:"rgba(231, 76, 60, 0.25)",strokeColor:"#E74C3C"},{fillColor:"rgba(255, 119, 0, 0.25)",strokeColor:"#ff7700"}],this.useSameColor=!0,this.sourceImage=document.createElement("img"),this.sourceImage.style.display="none",document.body.appendChild(this.sourceImage),this.sourceImage.onload=(()=>{this.updateBoundingBox()}),this.sourceImage.onerror=(()=>{this.firstLoadFailed?this.fallbackLoadFailed||(this.fallbackLoadFailed=!0):this.firstLoadFailed=!0,this.sourceImage.src=this.getFallback(),this.updateBoundingBox()}),this.sourceImage.src=this.props.imgProps.src}componentWillUnmount(){document.body.removeChild(this.sourceImage)}render(){return s.createElement("canvas",{className:this.props.imgProps.className,ref:this.assignCanvasRef.bind(this),onClick:this.props.imgProps.onClick?this.props.imgProps.onClick.bind(this):()=>{},style:this.props.imgProps.style?Object.assign({},this.props.imgProps.style):void 0})}assignCanvasRef(e){this.canvas=e,e&&this.updateBoundingBox()}getStrokeColor(e=0){return!0===this.useSameColor&&(e=0),this.colorMap[e].strokeColor}getFillColor(e=0){return!0===this.useSameColor&&(e=0),this.colorMap[e].fillColor}updateBoundingBox(){if(this.sourceImage&&this.sourceImage.complete&&this.canvas){this.canvas.width=this.sourceImage.naturalWidth,this.canvas.height=this.sourceImage.naturalHeight;const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.drawImage(this.sourceImage,0,0),this.sourceImage.src.includes(this.getFallback())||this.props.models.forEach((t,i)=>{const s=new n.BoundingBox(t,{w:this.sourceImage.naturalWidth,h:this.sourceImage.naturalHeight},{bottom:0,left:0,right:0,top:0}),r=s.getBounds();e.lineWidth=s.getLineWidth(),e.strokeStyle=this.getStrokeColor(i),e.fillStyle=this.getFillColor(i),e.beginPath(),e.rect(r.x,r.y,r.w,r.h),e.fill(),e.stroke()})}}getFallback(){return this.props.imgProps.fallback_url&&!this.fallbackLoadFailed?this.props.imgProps.fallback_url:"/app/assets/images/articles/default_thumbnail_grey_box.png"}}}),define("utilities/image",["require","exports","flux","react","underscore","blocks/components/renderables/bounding_box_renderable","blocks/components/models/click_action_types","event_bus"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Image=class extends i.BaseComponent{constructor(e){super(e),this.state={isError:!1}}componentWillReceiveProps(e){this.props.src!==e.src&&this.setState({isError:!1})}render(){let e,t=this.getImgTag();return this.props.click_action&&this.props.click_action.action===o.ClickActionTypes.SHOW_VIDEO&&(e=s.createElement("div",{className:"articles-video-thumbnail-wrapper"},s.createElement("i",{className:"fa fa-play","aria-hidden":"true",onClick:()=>{a.eventBus.dispatch({value:{endpointUrl:this.props.click_action.endpoint_url},type:a.EVENT_TYPES.SHOW_VIDEO_PLAYER})}}))),this.hasBoundingBoxes()&&!this.state.isError?s.createElement("div",{className:"image-component"},s.createElement(r.BoundingBoxRenderable,{models:this.props.bounding_boxes,allowObjectPositioning:this.props.allowObjectPositioning,boundingBoxIEorEdgeStyles:this.props.boundingBoxIEorEdgeStyles,imgProps:this.getImgProps()}),e):this.props.click_action&&this.props.click_action.action===o.ClickActionTypes.SHOW_VIDEO?s.createElement("div",{className:"video-image-wrapper",style:{position:"relative"}},t,e):t}getTagFactory(){return this.canUseErrorTag()?this.props.errorTag:(e,t)=>s.createElement("img",e,t)}getImgTag(){return this.getTagFactory()(this.getImgProps())}getImgProps(){const{errorStyle:e,errorProps:t}=this.props,i=this.getSource(),s=this.getClassName();let r=n.omit(this.props,["errorClass","errorStyle","errorSrc","errorTag","errorProps","src","className","boundingBoxes","bounding_boxes","children","blocked","allowObjectPositioning","allowEmptyPlaceholder","boundingBoxIEorEdgeStyles","click_action"]);this.canUseErrorProps(t)&&(r=n.assign(r,t)),r.draggable=!1;const o=this.prepareErrorPropsToAssign(i,s,e);return this.setOptionalPropsObjectPosition(r,o),n.assign(r,o)}setOptionalPropsObjectPosition(e,t){if(this.props.allowObjectPositioning&&this.isBoundingBoxAvailable()){void 0===e.style&&(e.style={});const i=this.composeObjectPosition();void 0===t.style&&(e.style=n.assign(JSON.parse(JSON.stringify(e.style)),{objectPosition:i}))}}canUseErrorProps(e){return(this.state.isError||this.props.blocked)&&void 0!==e}canUseErrorTag(){return(this.state.isError||this.props.blocked)&&void 0!==this.props.errorTag&&!this.hasBoundingBoxes()}hasBoundingBoxes(){return this.props.bounding_boxes&&this.props.bounding_boxes.length>0}getSource(){return this.canShowErrorSrc()?this.props.errorSrc:this.props.src}getClassName(){return this.canShowErrorClass()?this.props.errorClass:void 0!==this.props.className?this.props.className:""}onError(e){this.setState({isError:!0}),void 0!==this.props.onError&&this.props.onError.call(this,e)}composeObjectPosition(){return`${100*this.props.bounding_boxes[0].top_left.x}% ${100*this.props.bounding_boxes[0].top_left.y}%`}prepareErrorPropsToAssign(e,t,i){const s={onError:e=>this.onError(e),src:e,className:t};if(void 0!==i&&(s.style=i),this.props.allowObjectPositioning&&this.isBoundingBoxAvailable()){const e=this.composeObjectPosition();void 0!==s.style&&(s.style=n.assign(JSON.parse(JSON.stringify(s.style)),{objectPosition:e}))}return s}isBoundingBoxAvailable(){return void 0!==this.props.bounding_boxes&&this.props.bounding_boxes.length>0}canShowErrorSrc(){return(this.state.isError||this.props.blocked)&&void 0!==this.props.errorSrc}canShowErrorClass(){return(this.state.isError||this.props.blocked)&&void 0!==this.props.errorClass}}}),define("blocks/components/renderables/image_block_renderable",["require","exports","flux","react","underscore","utilities/image","blocks/components/factories/click_action_factory"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageBlockRenderable=class extends i.BaseComponent{shouldComponentUpdate(e,t){return e.url!==this.props.url||n.isEqual(e.boundingBoxes,this.props.boundingBoxes)}render(){const e=n.omit(this.props,["className","url","show_url","urlEnhancer","disableBoundingBoxes"]),{urlEnhancer:t,disableBoundingBoxes:i}=this.props;return e.src=t?t(this.props.url,{}):this.props.url,i&&(e.bounding_boxes=[]),e.className=this.generateClassName(),e.onClick=o.ClickActionFactory.create(this.props.click_action),e.src?this.renderImage(e):this.renderNoSource(e)}renderNoSource(e){if(this.props.allowEmptyPlaceholder&&void 0!==this.props.errorTag){const t={};return void 0!==this.props.errorClass&&(t.className=this.props.errorClass),void 0!==this.props.errorStyle&&(t.style=this.props.errorStyle),e.errorTag(Object.assign({},e,t))}return null}renderImage(e){return this.shouldShowUrl()?s.createElement("a",{href:this.props.click_action.url,onClick:()=>!1},s.createElement(r.Image,Object.assign({},e))):s.createElement(r.Image,Object.assign({},e))}generateClassName(){const e=[];return this.props.className&&e.push(this.props.className),this.props.click_action&&e.push("clickable"),e.join(" ")}shouldShowUrl(){const e=this.props.click_action;return this.props.show_url&&!n.isUndefined(e)&&!!e.url}}}),define("utilities/icon",["require","exports","flux","react","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Icon=class extends i.BaseComponent{render(){const{count:e=1,icon:t,className:i=""}=this.props.model;return s.createElement("span",{className:i.concat(" "+this.props.className).trim()},n.range(e).map(e=>s.createElement("i",{key:e,className:t})))}}}),define("generic/components/models/source_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/renderables/social_media_icon_renderable",["require","exports","react","flux","blocks/components/renderables/icon_block_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SocialMediaIconRenderable=class extends s.BaseComponent{render(){return i.createElement("div",{className:"social-media-icon add-social-accts"},i.createElement("div",{className:"logo"},i.createElement(n.IconBlockRenderable,{icon:this.generateIcon()})))}generateIcon(){const e=this.props.sourceType?this.props.sourceType.level1+"_"+this.props.sourceType.level2:"OTHER";return this.props.iconMap[e]?this.props.iconMap[e].icon:this.props.iconMap.OTHER.icon}}}),define("blocks/components/renderables/verified_icon_renderable",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VerifiedIconRenderable=class extends s.BaseComponent{render(){return i.createElement("i",{className:"fa fa-check-circle verified-icon",key:"icon-verified"})}}}),define("blocks/components/renderables/text_block_renderable",["require","exports","classnames","flux","react","blocks/components/factories/click_action_factory","blocks/components/renderables/verified_icon_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextBlockRenderable=class extends s.BaseComponent{shouldComponentUpdate(e,t){return e.text!==this.props.text||e.click_action!==this.props.click_action||e.limitSize!==this.props.limitSize}render(){const e={className:this.generateClassName(),style:this.props.style,title:this.props.title,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:r.ClickActionFactory.create(this.props.click_action)},t=this.initializeContent();return this.props.click_action&&this.props.click_action.url&&this.props.show_url?n.createElement("a",Object.assign({href:this.props.click_action.url,target:"blank"},e),t):(this.props.tag||((e,t)=>n.createElement("span",e,t)))(e,t)}initializeContent(){const e=[];this.props.icon&&e.push(n.createElement("i",{className:this.props.icon,key:"icon"}));const t=i({"limit-size":this.props.limitSize});return e.push(n.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.text},key:"content",className:t})),this.props.add_verified_icon&&e.push(n.createElement(o.VerifiedIconRenderable,{key:"verified"})),e}generateClassName(){const e=[];return this.props.className&&e.push(this.props.className),this.props.click_action&&e.push("clickable"),e.join(" ")}}}),define("button_selection/interfaces/button_selection_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("button_selection/interfaces/button_selection_event",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("button_selection/interfaces/button_selection_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("button_selection/css/button_selection.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buttonSelectionStyleModel={listItem:{textAlign:"center"},item:{width:75,height:75,lineHeight:"75px",borderRadius:5,fontSize:26,cursor:"pointer",textAlign:"center",color:"#32485d",backgroundColor:"#f1f3f4",margin:"0 auto","&.selected":{color:"#fff",backgroundColor:"#0089bc"}}},t.buttonSelectionStyle=i.createCssModule(()=>t.buttonSelectionStyleModel).compute({}).attach().getModule()}),define("button_selection/interfaces/button_selection_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("button_selection/classes/button_selection",["require","exports","react","classnames","flux","button_selection/css/button_selection.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ButtonSelection=class extends n.BaseComponent{constructor(e){super(e);const{items:t,multiSelection:i}=e;let s=0;if(t.forEach(e=>{e.selected&&s++}),!i&&s>1)throw new Error("Too many selected items found");i||0!==s||(t[0].selected=!0),this.state={items:t}}render(){const{items:e}=this.state;return i.createElement("ul",{className:"list-unstyled list-inline"},e.map(this.renderButton.bind(this)))}renderButton(e,t){const{itemClass:n}=this.props,o=s({[r.buttonSelectionStyle.item]:!n,[n]:!!n,selected:e.selected});return i.createElement("li",{className:r.buttonSelectionStyle.listItem,onClick:()=>this.toggleItem(e),key:t},i.createElement("div",{className:o},e.label),e.caption?i.createElement("div",null,e.caption):null)}toggleItem(e){const{multiSelection:t,onChange:i}=this.props,{items:s}=this.state;t?e.selected=!e.selected:(s.forEach(e=>e.selected=!1),e.selected=!0),i&&i({clickedItem:e,items:s}),this.setState({items:s})}}}),define("image_export_flag/image_export_flag",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageExportFlag=class extends i.BaseComponent{render(){const{fullyLoaded:e}=this.props;return s.createElement("input",{type:"hidden",className:"trendiction_loadable_field",value:e.toString()})}}}),define("carousel_list/carousel_list",["require","exports","react","classnames","flux","blocks/components/renderables/icon_block_renderable","image_export_flag/image_export_flag","underscore"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CarouselList=class extends n.BaseComponent{constructor(e){super(e),this.state=this.initializeState(e),this.numberOfItemsInView=e.settings.numberOfItemsInView||5,this.loadMoreThresholdItems=e.settings.loadMoreThresholdItems||5,this.renderCount=0,this.targetRenderCount=0}initializeState(e){return{index:0,isFullyLoaded:!1===e.settings.useLoadingFlag}}componentWillReceiveProps(e){const t=e?e.items:[],i=this.props?this.props.items:[];t.length<=i.length&&!a.isEqual(t,i)&&this.setState(this.initializeState(e))}componentDidMount(){if(null!==this.containerRef){const e=$(this.containerRef).find("img");a.forEach(e,e=>this.attachImageCallback(e));const t=$(this.containerRef).find(".img-error-style");a.forEach(t,e=>{this.loadCallback(this.containerRef)}),this.targetRenderCount=e.length+t.length}}attachImageCallback(e){if(e)if(e.complete)this.loadCallback(this.containerRef);else{const t=e.onload;e.onload=(i=>{t&&t.call(e,i),this.loadCallback(this.containerRef)});const i=e.onerror;e.onerror=(t=>{i&&i.call(e,t),this.loadCallback(this.containerRef)})}else this.loadCallback(this.containerRef)}loadCallback(e){!1!==this.props.settings.useLoadingFlag&&(this.renderCount++,this.setState({index:this.state.index,isFullyLoaded:this.renderCount>=this.targetRenderCount}))}render(){const e=this.calculateStyle(),t=this.generateContent(),n=this.generateNavigationComponentLeft(),r=this.generateNavigationComponentRight(),o=this.generateImageExportFlagComponent(),a=s({"tw-carousel":!0,animated:this.props.settings.isAnimated});return i.createElement("div",{className:a},n,i.createElement("div",{className:"list",style:e,ref:e=>{this.containerRef=e}},t),r,o)}calculateStyle(){const e=this.props.settings,t=this.props.settings.width,i=this.props.settings.margin;return{transform:"translate("+-1*this.state.index*(t+i)+"px)",transition:e.isAnimated&&e.animationDuration&&"transform "+e.animationDuration+"ms ease-in-out"}}getItems(){return this.props&&this.props.items||[]}getRemainingItems(){return this.getItems().length-this.state.index-this.numberOfItemsInView}generateContent(){return this.props.generateItems(this.getItems())}canNavigateLeft(){return this.state.index>0}canNavigateRight(){return this.getRemainingItems()>0}shouldFetchMoreData(){return this.getRemainingItems()<=this.loadMoreThresholdItems}generateNavigationComponent(e,t,n,r){const o=s(a.assign(e,{"navigate-pane":!0,clickable:!0}));return i.createElement("div",{className:o,onClick:t,key:r},n)}generateNavigationComponentLeft(){return this.props.renderLeftNavigation?this.props.renderLeftNavigation(this.navigateLeftAction.bind(this),!this.canNavigateLeft()):this.generateNavigationComponent({left:!0,hidden:!this.canNavigateLeft(),small:this.props.settings.useSmallIcons},this.navigateLeftAction.bind(this),this.generateIconContainer("left"),"navigate-left")}generateNavigationComponentRight(){return this.props.renderRightNavigation?this.props.renderRightNavigation(this.navigateRightAction.bind(this),!this.canNavigateRight()):this.generateNavigationComponent({right:!0,hidden:!this.canNavigateRight(),small:this.props.settings.useSmallIcons},this.navigateRightAction.bind(this),this.generateIconContainer("right"),"navigate-right")}generateIconContainer(e){const t=s({"icon-container":!0,[e]:!0});return i.createElement("div",{className:t},i.createElement(r.IconBlockRenderable,{icon:"fa fa-chevron-"+e}))}navigateLeftAction(){this.canNavigateLeft()&&this.setState({index:Math.max(0,this.state.index-this.numberOfItemsInView),isFullyLoaded:!0})}navigateRightAction(){if(!this.canNavigateRight())return;const e=this.getRemainingItems();this.setState({index:Math.min(this.getItems().length-1,this.state.index+(e<this.numberOfItemsInView?e:this.numberOfItemsInView)),isFullyLoaded:!0}),this.shouldFetchMoreData()&&this.props.onFetchMoreData&&this.props.onFetchMoreData()}generateImageExportFlagComponent(){return this.props.settings.useLoadingFlag?i.createElement(o.ImageExportFlag,{fullyLoaded:this.state.isFullyLoaded}):null}}}),define("color_picker/popover/css/alpha_spectrum.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.alphaSpectrumStyleModel={alphaSpectrum:{position:"relative",width:"100%",height:"100%"},checkboard:{position:"absolute",width:"100%",height:"100%",zIndex:1,background:'url("/app/assets/images/checkboard.jpg") center left',backgroundSize:"contain"},colorGradient:{position:"absolute",width:"100%",height:"100%",zIndex:2},dragHandle:{position:"absolute",width:10,height:"100%",zIndex:3,border:"1px solid black",backgroundColor:"white"}},t.alphaSpectrumStyle=i.createCssModule(()=>t.alphaSpectrumStyleModel).compute({}).attach().getModule()}),define("color_picker/popover/alpha_spectrum_renderable",["require","exports","classnames","flux","math_utils","react","reusable_utilities","color_picker/popover/css/alpha_spectrum.css"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AlphaSpectrumRenderable=class extends s.BaseComponent{constructor(e){super(e),this.dragging=!1}shouldComponentUpdate(e){return this.props.color!==e.color||this.props.opacity!==e.opacity}render(){const e={backgroundImage:`linear-gradient(to right, rgba(0, 0, 0, 0), ${this.props.color}`},t=i(["handle",a.alphaSpectrumStyle.dragHandle]),s={top:0,left:`calc(100% * ${this.props.opacity})`};return r.createElement("div",{onMouseDown:this.handleDragStart.bind(this),className:a.alphaSpectrumStyle.alphaSpectrum},r.createElement("div",{className:a.alphaSpectrumStyle.colorGradient,style:e}),r.createElement("div",{ref:"sliderBackground",id:"checkboard",className:a.alphaSpectrumStyle.checkboard}),r.createElement("div",{ref:"slider",className:t,style:s}))}handleDragStart(e){this.dragToken&&!this.dragToken.isCanceled()&&this.dragToken.cancel(),this.dragToken=new o.CancellationToken,this.dragToken.addDomEvent(window,"mousemove",this.handleDrag.bind(this)),this.dragToken.addDomEvent(window,"mouseup",this.handleDragEnd.bind(this)),$(document).on("dragover.AlphaSpectrumRenderable",e=>e.preventDefault()),this.handleChange(e),this.dragging=!0}handleDragEnd(e){this.dragToken.cancel(),this.dragging=!1,$(document).off("dragover.AlphaSpectrumRenderable")}handleDrag(e){e.stopPropagation(),this.dragging&&this.handleChange(e)}handleChange(e){const t=$(this.refs.sliderBackground),i=t.width(),s=t.offset().left;let r=n.generalMathUtils.clamp(e.clientX-s,0,i);r-=this.refs.slider.clientWidth/2,this.props.onAlphaChange(r/i)}}}),define("color_picker/popover/css/color_picker_popover.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.colorPickerPopoverStyleModel={colorPickerPopover:{position:"absolute",right:0,top:"calc(100% + 7px)",zIndex:1e3,minWidth:182,backgroundColor:"white",border:"1px solid lightgray",cursor:"default"},colorPickerEmbedded:{position:"relative",cursor:"default"},themeLabel:{padding:"5px 5px 0"},colors:{paddingTop:4},colorContainer:{width:20,height:20,display:"inline-block",marginRight:"5px",marginLeft:"5px",border:"1px solid gray",cursor:"pointer","&:hover":{borderWidth:2}},colorSelected:{borderWidth:2},colorPicker:{paddingLeft:4},alphaSpectrumWrapper:{height:25,padding:"4px 15px 4px 4px"},pointerBorder:{content:"",position:"absolute",borderStyle:"solid",display:"block",width:0,zIndex:1e3,borderWidth:"0px 6px 6px",borderColor:"lightgray transparent",right:"9px",top:-6},pointer:{content:"",position:"absolute",borderStyle:"solid",display:"block",width:0,zIndex:1001,borderWidth:"0px 6px 6px",borderColor:"white transparent",right:"9px",top:-5}},t.colorPickerPopoverStyle=i.createCssModule(()=>t.colorPickerPopoverStyleModel).compute({}).attach().getModule()}),define("color_picker/popover/color_picker_popover_renderable",["require","exports","classnames","flux","react","react-color-picker","color_picker/popover/alpha_spectrum_renderable","color_picker/popover/css/color_picker_popover.css"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ColorPickerPopoverRenderable=class extends s.BaseComponent{constructor(e){super(e)}render(){const e=["color-picker-popover"];this.props.embed?e.push(a.colorPickerPopoverStyle.colorPickerEmbedded):e.push(a.colorPickerPopoverStyle.colorPickerPopover);const t=i(e);return n.createElement("div",{onClick:e=>e.stopPropagation(),className:t},this.renderThemes(),this.renderColorPicker(),this.renderAlphaSpectrum(),this.renderPointerBorder(),this.renderPointer())}renderThemes(){return void 0!==this.props.themes?n.createElement("div",{className:a.colorPickerPopoverStyle.colors},this.props.themes.map(e=>this.renderTheme(e,this.props.themes.length>1))):null}renderTheme(e,t){return n.createElement("div",{key:e.mapped_id},this.renderThemeLabel(e,t),this.renderColors(e))}renderThemeLabel(e,t){return t?n.createElement("div",{className:a.colorPickerPopoverStyle.themeLabel},e.name):null}renderColors(e){return e.children.map(e=>this.renderColor(e))}renderColor(e){const t={backgroundColor:e.mapped_id},s=[a.colorPickerPopoverStyle.colorContainer];e.mapped_id===this.props.selectedColor&&s.push(a.colorPickerPopoverStyle.colorSelected);const r=i(s);return n.createElement("div",{key:e.mapped_id,onClick:t=>this.handleColorClick(t,e),className:r,style:t})}renderColorPicker(){return n.createElement("div",{className:a.colorPickerPopoverStyle.colorPicker},n.createElement(r,{value:this.props.selectedColor,saturationWidth:148,saturationHeight:148,hueWidth:13,hueHeight:148,onChange:this.props.onColorChange,onDrag:this.props.onColorChange}))}renderAlphaSpectrum(){return void 0!==this.props.opacityProps?n.createElement("div",{className:a.colorPickerPopoverStyle.alphaSpectrumWrapper},n.createElement(o.AlphaSpectrumRenderable,{color:this.props.selectedColor,opacity:this.props.opacityProps.opacity,onAlphaChange:this.props.opacityProps.onOpacityChange.bind(this)})):null}renderPointerBorder(){return!0!==this.props.embed?n.createElement("div",{className:a.colorPickerPopoverStyle.pointerBorder}):null}renderPointer(){return!0!==this.props.embed?n.createElement("div",{className:a.colorPickerPopoverStyle.pointer}):null}handleColorClick(e,t){e.stopPropagation(),this.props.onColorChange(t.mapped_id)}}}),define("utilities/document_click_tracker_wrapper",["require","exports","react","flux","reusable_utilities","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends s.BaseComponent{constructor(e){super(e)}clickInside(e){void 0!==this.props.clickInside&&this.props.clickInside(e)}clickOutside(e){void 0!==this.props.clickOutside&&this.props.clickOutside(e)}render(){const e=r.omit(this.props,["clickInside","clickOutside"]);return i.createElement("div",Object.assign({},e),this.props.children)}}t.DocumentClickTrackerWrapper=o,n.applyMixins(o,[s.DocumentClickTracker])}),define("context_menu/components/renderables/context_menu_panel",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextMenuPanel=class extends s.BaseComponent{render(){return n.createElement("li",{className:this.getPanelClassName()},this.generateHeader(),this.generateContent())}getPanelClassName(){return this.props.className?i({[this.props.className]:!0}):null}generateHeader(){return this.props.header?n.createElement("h6",null,this.props.header):null}}}),define("context_menu/components/renderables/context_menu_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextMenuRenderable=class extends s.BaseComponent{render(){const e=i({"dropdown-menu-placeholder":!0,open:!0});return n.createElement("div",{className:e},n.createElement("ul",{id:"entryMenu",className:"dropdown-menu menu",tabIndex:1,onClick:this.handleClick.bind(this),onKeyDown:this.onKeyDown.bind(this),onBlur:this.handleOverlayBlur.bind(this),onLoad:this.handleOverlayLoad.bind(this)},this.generatePanels()))}handleClick(e){e.stopPropagation()}onKeyDown(e){e&&(this.props.onKeyDown&&this.props.onKeyDown(e),e.stopPropagation())}handleOverlayBlur(e){e&&e.stopPropagation()}handleOverlayLoad(){}generatePanels(){return this.props.panels.filter((e,t)=>e)}}}),define("context_menu/containers/context_menu_container",["require","exports","flux","react","underscore","utilities/document_click_tracker_wrapper","context_menu/components/renderables/context_menu_renderable"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextMenuContainer=class extends i.BaseComponent{constructor(e){super(e),this.state={isOpen:!0}}clickOutside(e){this.state.isOpen&&setTimeout(()=>{this.props.onClickOutside&&this.props.onClickOutside(e)},0)}render(){if(this.state.isOpen){const e=n.omit(this.props,["buttonHash"]);return s.createElement(r.DocumentClickTrackerWrapper,{clickOutside:this.clickOutside.bind(this)},s.createElement(o.ContextMenuRenderable,Object.assign({},e)))}return null}}}),define("context_menu/components/renderables/panels/widget_actions_panel",["require","exports","react","context_menu/components/renderables/context_menu_panel"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WidgetActionsPanel=class extends s.ContextMenuPanel{generateContent(){return i.createElement("ul",{className:"list-unstyled"},this.generateActionItems())}generateActionItems(){return this.props.actions.map(e=>this.generateSingleItem(e))}generateSingleItem(e){const{label:t,icon:s,clickAction:n}=e;return i.createElement("li",{key:t},i.createElement("div",{className:"menuitem label clickable",onClick:n||null},s?i.createElement("i",{className:s}):null,i.createElement("span",null,t)))}}}),define("context_menu/builder/context_menu_builder",["require","exports","react","flux","context_menu/containers/context_menu_container","context_menu/components/renderables/panels/widget_actions_panel"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextMenuBuilder=class extends s.BaseComponent{render(){const e=Object.assign({},_.omit(this.props,"widgetActions"),{buttonHash:this.props.widgetId,panels:this.generatePanels()});return i.createElement(n.ContextMenuContainer,Object.assign({},e))}generatePanels(){const{widgetId:e,widgetActions:t}=this.props,s=[];return void 0!==t&&t.length>0&&s.push(i.createElement(r.WidgetActionsPanel,{key:"widgetActions",widgetId:e,actions:t})),s}}}),define("context_menu/components/models/context_menu_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/tag",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/ratio",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/match",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/entity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/meta_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/metric",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/metrics",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_based_widget/options_menu_option",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_based_widget/unit",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/source",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/article",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NEWS="news",e.BLOG="blog",e.PRINT="print",e.BROADCAST="broadcast",e.MICROBLOG="microblog",e.SOCIAL_VIDEO="social_video",e.SOCIAL_PHOTO="social_photo",e.SOCIAL_NETWORK="social_network",e.PODCAST="podcast",e.REVIEW="review",e.WIKI="wiki",e.COMMENT="comment",e.Q_AND_A="q_and_a",e.FORUM="forum",e.CLASSIFIED="classified"}(t.NexisMediaType||(t.NexisMediaType={})),function(e){e.ACADEMIC="academic",e.CONSUMER="consumer",e.CORPORATE="corporate",e.GENERAL="general",e.GOVERNMENT="government",e.JOURNAL="journal",e.LOCAL="local",e.MISCELLANEOUS="miscellaneous",e.NATIONAL="national",e.ORGANISATION="organization",e.PRESS_WIRE="press_wire",e.TRADE="trade"}(t.NexisSourceCategory||(t.NexisSourceCategory={}))}),define("context_menu/components/models/context_menu_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("utilities/timed_hover",["require","exports","react","flux","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TimedHover=class extends s.BaseComponent{constructor(e){super(e),this.timer=0}handleMouseEnter(){clearTimeout(this.timer),this.timer=setTimeout(this.props.callback,this.props.duration)}handleMouseLeave(e,t){clearTimeout(this.timer),void 0!==t&&t(e)}render(){const{onMouseLeave:e}=this.props,t=n.omit(this.props,["duration","mouseLeave","callback"]);return i.createElement("div",Object.assign({},t,{onMouseEnter:()=>this.handleMouseEnter(),onMouseLeave:t=>this.handleMouseLeave(t,e)}),this.props.children)}}}),define("filters/components/utilities/shared_filter_logic",["require","exports","react","classnames","underscore","utilities/timed_hover","utilities/icon","reusable_utilities","reusable_services"],function(e,t,i,s,n,r,o,a,l){"use strict";var c,d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SAME_AS_NAME=1]="SAME_AS_NAME",e[e.DESCRIPTION=2]="DESCRIPTION"}(c=t.RenderFilterButtonTooltipMode||(t.RenderFilterButtonTooltipMode={})),function(e){e[e.NEVER=0]="NEVER",e[e.ALWAYS=1]="ALWAYS",e[e.IF_CHILDREN_AVAILABLE=2]="IF_CHILDREN_AVAILABLE"}(d=t.ShowChildrenIndicator||(t.ShowChildrenIndicator={}));class h{renderFilterButton(e,t={}){const{showChildrenIndicator:s=d.NEVER,timedHoverOptions:o,onClick:a,renderEnhancers:{finalizer:l=n.identity,siblings:c=n.identity}={}}=t,{title:h,className:u,hits:p,name:g,children:m,selectCount:_}=this.prepareRenderFilterButton(e,t),f=[];this.canShowChildrenIndicator(s,e)&&f.push(i.createElement("i",{key:`${e.mapped_id}_arrow`,className:"fa no-square ng-scope fa-caret-left arrow-left"})),m.length>0&&f.push(i.createElement("span",{key:`${e.mapped_id}_children`},m)),f.push(i.createElement("span",{key:e.mapped_id,className:"ellipsis",dangerouslySetInnerHTML:{__html:g}})),_&&f.push(i.createElement("span",{key:`${e.mapped_id}_count`},_));const y=i.createElement("span",{key:e.mapped_id,title:h,onClick:t=>a&&!o?a(t,e):null,"data-mapped-id":e.mapped_id,className:u},c([f],e));let b;return l([b=void 0!==o?i.createElement(r.TimedHover,{className:"pull-left",duration:o.duration,"data-mapped-id":e.mapped_id,key:e.mapped_id,onClick:i=>t.onClick?t.onClick(i,e):null,onMouseLeave:o.onMouseLeave,callback:()=>o.onMouseEnter(e)},y):y,t.showFilterHits?i.createElement("span",{key:0,className:"filter-count"},p):null],e)}hasIcon(e,t){return!(!t||!t[e.mapped_id]&&!t["*"])}getIcon(e,t){return t&&(t[e.mapped_id]||t["*"])}canShowChildrenIndicator(e,t){return e!==d.NEVER&&(n.isFunction(e)?e(t):e===d.ALWAYS||e===d.IF_CHILDREN_AVAILABLE&&void 0!==t.children&&t.children.length>0)}prepareRenderFilterButton(e,t){let{iconMap:r,numberFormatter:d=(e=>e),showFilterHits:h=!1,clickableStyle:u=!0,hideName:p=!1,tooltip:g=c.NONE,overrideSelectionCheck:m=a.TopicEntryUtils.isSelectedOrHoldsSelection.bind(this),noCount:_=!1}=t;n.isFunction(p)&&(p=p(e,r));let f="";const y=[];let b,E="",S="";h&&e.filter_hits>0&&(f=`(${d(e.filter_hits)})`),this.hasIcon(e,r)&&(S=s({[S]:!0,active:m(e)}),y.push(i.createElement(o.Icon,{className:S,key:e.mapped_id,model:this.getIcon(e,r)}))),p||(E=this.getEntryLabel(e,t),b=s({"label label-span":!0,"label-primary":m(e),clickable:u}));let C="";g===c.SAME_AS_NAME&&(C=E),g===c.DESCRIPTION&&(C=e.description),void 0===_?_=!1:n.isFunction(_)&&(_=_(e));let v="";const T=this.countSelectedChildren(e);return T>0&&!_&&(v=`(${T}) `),t.parseForEmojis&&(E=l.emojiService.parseTextForEmoji(E)),{title:C,name:E,className:b,hits:f,children:y,selectCount:v}}renderInlineList(e,r={}){let{allNode:o,levels:a=1,buttonOptions:l,ref:c,inline:d,liStyle:h={}}=r;a--,r=n.omit(r,["allNode","ref"]);const u=s({"list-unstyled":!0,"list-inline":d});return i.createElement("ul",{className:u,ref:c},o?i.createElement("li",{key:o.mapped_id,style:h,"data-mapped-id":o.mapped_id},t.sharedFilterLogic.renderFilterButton(o,n.assign({},l,{overrideSelectionCheck:e=>"NODE"===e.selected,noCount:!0}))):null,e.map(e=>{const s=a>0&&e.children&&e.children.length>0;return i.createElement("li",{"data-mapped-id":e.mapped_id,key:e.mapped_id,style:h},t.sharedFilterLogic.renderFilterButton(e,l),(()=>s?(r.inline=!0,this.renderInlineList(e.children,r)):null)())}))}renderColumns(e,t,i,s,r){return n.range(e).map(n=>this.renderColumn(n,e,t,i,s,r))}renderColumn(e,s,n,r,o,a){let l=n.length/s;const c=n.length-Math.floor(l)*s;l=Math.floor(l);const d=n.slice(e*l+Math.min(c,e),(e+1)*l+Math.min(c,e+1)).map(e=>i.createElement("div",{key:e.mapped_id,onClick:t=>r(t,e,a)},t.sharedFilterLogic.renderFilterButton(e,{showFilterHits:!0,numberFormatter:o})));if(0!==d.length)return i.createElement("div",{key:e,className:"column"},d)}countSelectedChildren(e){return e.children&&0!==e.children.length?e.children.reduce((e,t)=>e+(a.TopicEntryUtils.isSelectedOrHoldsSelection(t)?1:0),0):0}getSelectedChildren(e){return e.children.filter(e=>a.TopicEntryUtils.isSelectedOrHoldsSelection(e))}getUnselectedChildren(e){return e.children.filter(e=>!a.TopicEntryUtils.isSelectedOrHoldsSelection(e))}getFirstSelectedEntry(e){if(a.TopicEntryUtils.isSelected(e))return e;if(e.children)for(let t=0;t<e.children.length;t++){const i=this.getFirstSelectedEntry(e.children[t]);if(i)return i}}getEntryLabel(e,{prefix:t=""}){return`${t}${e.name+" "}`}getAllSelectedEntries(e){return this.getAllSelectedEntriesImpl(e,[])}getAllSelectedEntriesImpl(e,t){return a.TopicEntryUtils.isSelected(e)?t.push(e):e.children&&e.children.forEach(e=>this.getAllSelectedEntriesImpl(e,t)),t}}t.SharedFilterLogic=h,t.sharedFilterLogic=new h}),define("dropdown_menu/dropdown_menu_entry",["require","exports","flux","react","classnames","filters/components/utilities/shared_filter_logic","dropdown_menu/shared_dropdown_logic","underscore","event_bus"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DropdownMenuEntry=class extends i.BaseComponent{constructor(e){super(e);const{entry:t}=this.props;this.state={open:!1,entry:t}}componentDidMount(){this.cancellationToken.subscribeToStream(l.eventBus,l.EVENT_TYPES.UPDATE_DROPDOWN_MENU_ENTRY,e=>{const t=e.value;if(t.changedEntry&&t.changedEntry.mapped_id===this.state.entry.mapped_id&&this.setState({entry:t.changedEntry}),t.openPath){const e=a.contains(t.openPath,this.state.entry.mapped_id);e!==this.state.open&&this.setState({open:e})}})}componentWillReceiveProps(e){this.setState({entry:e.entry})}render(){const{options:e,options:{oneLevel:t,recursive:i},cssMode:l,level:c}=this.props,{open:d,entry:h}=this.state,{oneLevel:{buttonOptions:u}={buttonOptions:{}},recursive:{buttonOptions:p}={buttonOptions:{}}}=e,g=a.assign({},p,u),m=a.assign({},i,t);m.buttonOptions=g;const _=n({"tw-dropdown-submenu":h.children&&h.children.length>0}),f=n({"menuitem clickable":!0}),y=h.children&&!~m.hideChildrenOf.indexOf(h.mapped_id)&&(d||l),b=a.omit(m.buttonOptions,["onClick"]);return s.createElement("li",{key:h.mapped_id,className:_},s.createElement("div",{className:f,style:{display:"flex"},onClick:e=>m.buttonOptions.onClick(e,h)},r.sharedFilterLogic.renderFilterButton(h,b)),y?o.sharedDropdownLogic.generateList(h.children,c+1,{oneLevel:{forceOpen:d},recursive:i},l):null)}}}),define("dropdown_menu/shared_dropdown_logic",["require","exports","dropdown_menu/dropdown_menu_entry","classnames","react","underscore","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{generateList(e,t,i,o){const{recursive:a,oneLevel:l}=i,c=r.assign({},a,l),{forceOpen:d}=c;if(e){if(t>0){const r=s({"force-show":d,[c.ulClass||""]:!0,"tw-dropdown-menu":t>0,scripted:!o,"list-unstyled":0===t});return n.createElement("ul",{className:r,onClick:e=>e.stopPropagation()},n.createElement("li",null,n.createElement("ul",{className:"list-unstyled"},e.map(e=>this.renderDrowndownEntry(e,t,i,o)))))}return n.createElement("ul",{className:(c.ulClass||"")+" list-unstyled"},e.map(e=>this.renderDrowndownEntry(e,t,i,o)))}return null}renderDrowndownEntry(e,t,s,r){return o.TopicEntryUtils.isEntryVisible(e)?n.createElement(i.DropdownMenuEntry,{cssMode:r,key:e.mapped_id,entry:e,level:t,options:s}):null}}t.SharedDropdownLogic=a,t.sharedDropdownLogic=new a}),define("dropdown_menu/dropdown_menu_renderable",["require","exports","react","flux","classnames","dropdown_menu/shared_dropdown_logic","underscore"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DropdownMenuRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state={expandedPath:[]}}render(){let{entries:e,mergeFirstLevel:t,onMouseEnter:s=o.noop,forceShow:a,alignRight:l,isSubMenu:c,options:d={},icon:h,cssMode:u,onClick:p}=this.props;(d=o.assign({},{oneLevel:{},recursive:{buttonOptions:{iconMap:{}},onMouseLeave:o.noop}},d)).oneLevel.buttonOptions=d.oneLevel.buttonOptions||{},d.recursive.buttonOptions=d.recursive.buttonOptions||{},p&&o.assign(d.recursive.buttonOptions,{onClick:p}),h&&o.assign(d.recursive.buttonOptions.iconMap,{"*":{icon:h}});const g=d.recursive.hideChildrenOf||[];t&&(e=this.mergeLevel(e,g));const m=n({"tw-dropdown-menu":!0,"force-show":a,"tw-dropdown-menu-right":l,[this.props.className||""]:!0});return d.recursive.hideChildrenOf=g,c?(o.assign(d.oneLevel,{ulClass:this.props.className}),r.sharedDropdownLogic.generateList(e,0,d,u)):i.createElement("ul",{onMouseEnter:s,onMouseLeave:d.recursive.onMouseLeave,onClick:e=>e.stopPropagation(),className:m},i.createElement("li",null,r.sharedDropdownLogic.generateList(e,0,d,u)))}mergeLevel(e,t){let i=(e=e.slice()).length;for(;i--;)e[i].children&&(t.push(e[i].mapped_id),e.splice(i+1,0,...e[i].children));return e}}}),define("dropdown_menu/dropdown_menu_container",["require","exports","flux","react","dropdown_menu/dropdown_menu_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DropdownMenuContainer=class extends i.BaseComponent{constructor(e){super(e)}render(){return s.createElement(n.DropdownMenuRenderable,Object.assign({},this.props))}}}),define("context_menu/components/renderables/panels/dropdown_menu_panel",["require","exports","react","context_menu/components/renderables/context_menu_panel","dropdown_menu/dropdown_menu_container"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DropdownMenuPanel=class extends s.ContextMenuPanel{generateContent(){return i.createElement(n.DropdownMenuContainer,{className:"report-dropdown",entries:this.props.entries,icon:this.props.icon,onClick:this.props.onClick.bind(this),isSubMenu:!0,cssMode:!0})}}}),define("generic/components/models/panel",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("source_actions_menu/components/renderables/source_actions_header_renderable",["require","exports","react","flux","sanitizer"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsHeaderRenderable=class extends s.BaseComponent{render(){const{header:e,message:t}=this.props;return e&&t?i.createElement("li",null,i.createElement("h6",null,e),i.createElement("ul",{className:"list-unstyled"},i.createElement("li",null,i.createElement("div",{className:"menuitem unclickable"},i.createElement("span",{dangerouslySetInnerHTML:{__html:n.htmlSanitizer.unescape(t.__html)}}))))):null}}}),define("source_actions_menu/components/renderables/source_actions_block_renderable",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsBlockRenderable=class extends s.BaseComponent{render(){const{header:e,message:t,onClick:s}=this.props;return i.createElement("li",null,i.createElement("h6",null,e),i.createElement("ul",{className:"list-unstyled"},i.createElement("li",null,i.createElement("div",{onClick:s,className:"menuitem label clickable"},i.createElement("i",{className:"fa fa-minus-circle"}),i.createElement("span",null,t)))))}}}),define("source_actions_menu/components/renderables/source_actions_panel_list_renderable",["require","exports","classnames","flux","react","underscore"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends s.BaseComponent{render(){return n.createElement("ul",{className:"list-unstyled"},this.generateSourcePanelGroups(),this.generateSourcePanelItems())}generateSourcePanelItems(){const{panels:e,category:t}=this.props;return r.isUndefined(e)?null:e.map((e,i)=>this.generateSinglePanelItem(t,e,i))}generateSourcePanelGroups(){const{panels_groups:e}=this.props;return r.isUndefined(e)?null:e.map((e,t)=>this.generatePanelGroup(e,t))}generatePanelGroup(e,t){const s=i({"menuitem label":!0}),r=this.generatePanelIcon(!0);return this.generateListItem(e.name,r,t,{panel:s},n.createElement(o,{panels:e.panels,panels_groups:[],messages:this.props.messages,category:this.props.category,selectionCategory:this.props.selectionCategory,onIncludePanel:this.props.onIncludePanel,onExcludePanel:this.props.onExcludePanel,onIncludeSelectionPanel:this.props.onIncludeSelectionPanel,onExcludeSelectionPanel:this.props.onExcludeSelectionPanel}))}generateSinglePanelItem(e,t,s){const{messages:r,onIncludePanel:o,onExcludePanel:a,onIncludeSelectionPanel:l,onExcludeSelectionPanel:c}=this.props,d=i({"label-primary":this.hasPanelSelection(t,e),"menuitem label":!0}),h=i({"menuitem label clickable":!0}),u=this.generatePanelIcon(!1,this.isPanelSelected(t,e,!0),this.isPanelSelected(t,e,!1));return this.generateListItem(t.name,u,s,{panel:d,item:h},n.createElement("ul",{className:"list-unstyled"},n.createElement("li",null,n.createElement("div",{onClick:o.bind(this,t),className:h},n.createElement("span",null,r.includePanelMessage))),l?n.createElement("li",null,n.createElement("div",{onClick:l.bind(this,t),className:h},n.createElement("span",null,r.includeSelectionPanelMessage))):null,n.createElement("li",null,n.createElement("div",{onClick:a.bind(this,t),className:h},n.createElement("span",null,r.excludePanelMessage))),l?n.createElement("li",null,n.createElement("div",{onClick:c.bind(this,t),className:h},n.createElement("span",null,r.excludeSelectionPanelMessage))):null))}generateListItem(e,t,i,s,r){return n.createElement("li",{key:i,className:"dropdown-submenu pull-left"},t,n.createElement("div",{className:s.panel},n.createElement("span",{className:"elipsis"},e)),this.getSubItem(r))}getSubItem(e){return void 0!==e?n.createElement("ul",{className:"dropdown-menu"},n.createElement("li",null,e)):null}hasPanelSelection(e,t){return this.isPanel(t.sources,e,!0)||this.isPanel(t.sources,e,!1)}isPanelSelected(e,t,i){return this.isPanel(t.sources,e,i)}isPanel(e,t,i){if(r.isEmpty(e))return!1;const s=i?t.included_entries:t.excluded_entries;return r.every(e,e=>r.contains(s,e.id_hash)||r.contains(s,e.url_hash))}generatePanelIcon(e,t,i){return e?n.createElement("i",{className:"fa fa-folder"}):t?n.createElement("i",{className:"fa fa-check-circle-o included-icon"}):i?n.createElement("i",{className:"fa fa-times-circle-o excluded-icon"}):null}}t.SourceActionsPanelListRenderable=o}),define("source_actions_menu/components/renderables/source_actions_predefined_panels_renderable",["require","exports","react","underscore","classnames","flux"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsPredefinedPanelsRenderable=class extends r.BaseComponent{render(){return this.generateInfluenstars()}generateInfluenstars(){const{onApplyFavorite:e,isFavorite:t}=this.props,r=n({active:t,"tw-btn-icon btn favorite":!0});return i.createElement("ul",{className:"list-unstyled"},i.createElement("li",null,s.range(3).map(e=>this.generateStarButton(e+1)),i.createElement("button",{type:"button",onClick:e.bind(this,t),className:r},i.createElement("i",{className:"icon-tw-heart"}))))}generateStarButton(e){const{onApplyInfluenstar:t,userRating:r}=this.props,o=n({active:r===e,"tw-btn-icon btn rating":!0});return i.createElement("button",{type:"button",key:"rating-"+e,onClick:t.bind(this,e),className:o},s.range(e).map((e,t)=>i.createElement("i",{key:"star"+t,className:"icon-tw-star"})))}}}),define("source_actions_menu/actions/source_actions_menu_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceActionsMenuActions={sourceActionsMenu_onApplyInfluenstar:"sourceActionsMenu_onApplyInfluenstar",sourceActionsMenu_onApplyFavorite:"sourceActionsMenu_onApplyFavorite",sourceActionsMenu_onIncludeInPanel:"sourceActionsMenu_onIncludeInPanel",sourceActionsMenu_onExcludeFromPanel:"sourceActionsMenu_onExcludeFromPanel",sourceActionsMenu_onBlock:"sourceActionsMenu_onBlock",sourceActionsMenu_onAddPanel:"sourceActionsMenu_onAddPanel"}}),define("source_actions_menu/components/renderables/source_actions_dropdown_renderable",["require","exports","react","classnames","flux","source_actions_menu/components/renderables/source_actions_header_renderable","source_actions_menu/components/renderables/source_actions_block_renderable","source_actions_menu/components/renderables/source_actions_panel_list_renderable","source_actions_menu/components/renderables/source_actions_predefined_panels_renderable","source_actions_menu/actions/source_actions_menu_actions"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsDropdownRenderable=class extends n.BaseComponent{render(){const{forceVisible:e,messages:t,category:n,selectionCategory:o}=this.props,a=s({"dropdown-menu":!0,"force-show":e});return i.createElement("ul",{className:a},i.createElement(r.SourceActionsHeaderRenderable,{key:"header",header:t.header,message:t.sourcePanelMessage}),this.renderMainPanelActions(n,t,o),this.generateBlockSourceBlock())}renderMainPanelActions(e,t,s){return this.shouldAllowMainPanelActions()?i.createElement("li",null,i.createElement("h6",null,t.sourcePanelHeader),i.createElement(l.SourceActionsPredefinedPanelsRenderable,{key:"predefined_panels",onApplyInfluenstar:this.onApplyInfluenstar(e),onApplyFavorite:this.onApplyFavorite(e),userRating:e.userRating,isFavorite:e.favorite}),i.createElement(a.SourceActionsPanelListRenderable,{key:"actions",messages:t,panels_groups:this.getPanelGroups(),panels:this.getUngroupedPanels(),category:e,selectionCategory:s,onIncludePanel:this.onPanelInclude(e),onExcludePanel:this.onPanelExclude(e),onIncludeSelectionPanel:s?this.onPanelInclude(s):void 0,onExcludeSelectionPanel:s?this.onPanelExclude(s):void 0}),this.generateAddPanelActionBlock()):void 0}shouldAllowMainPanelActions(){return!0}getPanelGroups(){const{panels_groups:e}=this.props;return _.filter(e,e=>"ungrouped_source_panels_group"!==e.id)}getUngroupedPanels(){const{panels_groups:e}=this.props;return _(e).chain().filter(e=>"ungrouped_source_panels_group"===e.id).map(e=>e.panels).flatten().value()}generateBlockSourceBlock(){if(this.isBlockable()){const{messages:e,category:t}=this.props;return i.createElement(o.SourceActionsBlockRenderable,{key:"block",header:e.blockSourceHeader,message:e.blockSourceMessage,onClick:this.onBlock(t)})}return null}generateAddPanelActionBlock(){const{messages:e,category:t,selectionCategory:s}=this.props;return e.addPanelMessage?i.createElement("ul",{className:"list-unstyled"},i.createElement("li",{key:"addPanelActionBlock"},i.createElement("a",{onClick:this.onAddPanel(t)},i.createElement("div",{className:"menuitem label clickable"},i.createElement("span",null,e.addPanelMessage)))),s?i.createElement("li",{key:"addSelectionPanelActionBlock"},i.createElement("a",{onClick:this.onAddPanel(s)},i.createElement("div",{className:"menuitem label clickable"},i.createElement("span",null,e.addSelectionPanelMessage)))):null):null}isBlockable(){return this.props.category.blockable}onApplyInfluenstar(e){return(t,i)=>{const s={widgetId:this.props.widgetId,sources:e.sources,value:t,author:e.author};this.props.onApplyInfluenstar&&this.props.onApplyInfluenstar(s),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onApplyInfluenstar,s)}}onApplyFavorite(e){return(t,i)=>{const s={widgetId:this.props.widgetId,sources:e.sources,toggle:t,author:e.author};this.props.onApplyFavorite&&this.props.onApplyFavorite(s),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onApplyFavorite,s)}}onAddPanel(e){return t=>{const i={widgetId:this.props.widgetId,sources:e.sources};this.props.onAddPanel&&this.props.onAddPanel(i),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onAddPanel,i)}}onBlock(e){return t=>{const i={widgetId:this.props.widgetId,sources:e.sources};this.props.onBlock&&this.props.onBlock(i),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onBlock,i)}}onPanelInclude(e){return(t,i)=>{const s={widgetId:this.props.widgetId,sources:e.sources,panel:t,include:!0,author:e.author};this.props.onIncludePanel&&this.props.onIncludePanel(s),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onIncludeInPanel,s)}}onPanelExclude(e){return(t,i)=>{const s={widgetId:this.props.widgetId,sources:e.sources,panel:t,include:!1,author:e.author};this.props.onExcludePanel&&this.props.onExcludePanel(s),n.dispatcher.dispatch(c.SourceActionsMenuActions.sourceActionsMenu_onExcludeFromPanel,s)}}}}),define("source_actions_menu/components/renderables/source_actions_menu_item_renderable",["require","exports","flux","react","source_actions_menu/components/renderables/source_actions_dropdown_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsMenuItemRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={forceVisible:e.visible||!1}}componentWillReceiveProps(e){!this.props.visible===e.visible&&this.setState({forceVisible:e.visible||!1})}render(){const{messages:e,panels_groups:t,category:i,selectionCategory:r,onMouseEnter:o=_.noop,widgetId:a}=this.props,{forceVisible:l}=this.state;return s.createElement("li",{className:"dropdown-submenu pull-left",onMouseEnter:o.bind(this)},this.generateMenuItemLabel(),s.createElement(n.SourceActionsDropdownRenderable,{key:"dropdown",panels_groups:t,category:i,selectionCategory:r,messages:e,widgetId:a,forceVisible:l}))}generateMenuItemLabel(){const{menuIcon:e,messages:t}=this.props;return s.createElement("div",{key:"label",className:"menuitem label"},s.createElement("i",{className:e}),s.createElement("span",null,t.menuLabel))}}}),define("source_actions_menu/components/renderables/source_actions_menu_renderable",["require","exports","flux","react","source_actions_menu/components/renderables/source_actions_menu_item_renderable","underscore","reusable_services"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsMenuRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={visibility:this.calculateVisibility(e)}}calculateVisibility(e,t=!1){const i={};return e.sourcesCategory&&(i[e.sourcesCategory.mapped_id]=!t&&e.sourcesCategory.visible),e.authorsCategory&&(i[e.authorsCategory.mapped_id]=!t&&e.authorsCategory.visible),i}render(){return s.createElement("ul",{className:"list-unstyled tw-source-actions-menu"},this.generateSourceItemRenderable(),this.generateAuthorItemRenderable())}onMouseEnter(e,t){let i=!1;r.each(this.state.visibility,(t,s)=>{s!==e&&t&&(t=!1,i=!0),this.state.visibility[s]=t},{}),i&&this.setState(this.state)}generateSourceItemRenderable(){const e=this.props.sourcesCategory;return e&&e.showOptionToAddToSourcePanel?s.createElement(n.SourceActionsMenuItemRenderable,{category:e,visible:this.state.visibility[e.mapped_id],panels_groups:this.props.panels_groups,menuIcon:"fa fa-globe",messages:r.assign(this.getSharedMessages(),{menuLabel:e.name,header:this.props.messages._001166,sourcePanelHeader:this.props.messages._540506.toUpperCase(),sourcePanelMessage:this.getMessage(e.sources)}),onMouseEnter:this.onMouseEnter.bind(this,e.mapped_id),widgetId:this.props.widgetId}):null}generateAuthorItemRenderable(){const e=this.props.authorsCategory;return e?s.createElement(n.SourceActionsMenuItemRenderable,{category:e,visible:this.state.visibility[e.mapped_id],panels_groups:this.props.panels_groups,menuIcon:"fa fa-user",onMouseEnter:this.onMouseEnter.bind(this,e.mapped_id),messages:r.assign(this.getSharedMessages(),{menuLabel:this.props.messages._868599,header:this.props.messages._868599,sourcePanelHeader:this.props.messages._540506.toUpperCase(),sourcePanelMessage:this.getMessage(e.sources)}),widgetId:this.props.widgetId}):null}getSharedMessages(){return{addPanelMessage:this.props.messages._306883,includePanelMessage:this.props.messages._644521,excludePanelMessage:this.props.messages._984212,blockSourceHeader:this.props.messages._355355,blockSourceMessage:this.props.messages._212333}}getMessage(e){const t=r.first(e),{message:i,multiple_selection_message:s}=t;if(i||s)return{__html:o.emojiService.parseTextForEmoji(1===e.length?i:s)}}}}),define("source_actions_menu/actions/source_actions_menu_event",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceActionsMenuEvent={sourceActionsMenuEvent_onInfluenstarChanged:"sourceActionsMenuEvent_onInfluenstarChanged",sourceActionsMenuEvent_onFavoriteChanged:"sourceActionsMenuEvent_onFavoriteChanged",sourceActionsMenuEvent_onPanelIncludesChanged:"sourceActionsMenuEvent_onPanelIncludesChanged",sourceActionsMenuEvent_onPanelAdded:"sourceActionsMenuEvent_onPanelAdded"}}),define("source_actions_menu/stores/source_actions_menu_store",["require","exports","flux","source_actions_menu/actions/source_actions_menu_event","generic/actions/generic_actions","source_actions_menu/actions/source_actions_menu_actions","underscore","log"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends i.BaseStore{constructor(e){super(r.SourceActionsMenuActions),this.storeObject=e,l.store=this}static getInstance(){return l.store}onApplyInfluenstar(e,t){const i=this.getUserRating(e.sources);this.toggleUserRating(e.sources,e.value).then(()=>{this.onChange.fire({action:s.SourceActionsMenuEvent.sourceActionsMenuEvent_onInfluenstarChanged,payload:{widgetId:e.widgetId,sources:e.sources,value:i!==e.value?e.value:0,author:e.author}}),t()})}onApplyFavorite(e,t){const i=e.toggle;this.toggleFavorite(e.sources).then(()=>{this.onChange.fire({action:s.SourceActionsMenuEvent.sourceActionsMenuEvent_onFavoriteChanged,payload:{widgetId:e.widgetId,sources:e.sources,toggle:!i,author:e.author}}),t()})}onIncludeInPanel(e,t){this.togglePanel(e.sources,e.panel,e.include).then(()=>{this.onChange.fire({action:r.SourceActionsMenuActions.sourceActionsMenu_onIncludeInPanel}),t()})}onExcludeFromPanel(e,t){this.togglePanel(e.sources,e.panel,e.include).then(()=>{this.onChange.fire({action:r.SourceActionsMenuActions.sourceActionsMenu_onExcludeFromPanel}),t()})}onBlock(e){this.block(e.sources).then(()=>{this.onChange.fire({action:r.SourceActionsMenuActions.sourceActionsMenu_onBlock}),i.dispatcher.dispatch(n.GenericActions.generic_onRemoveArticlesBySources,{sources:e.sources,author:e.author})})}onAddPanel(e,t){this.addPanel(e.sources,e.widgetId).then(i=>{this.onChange.fire({action:s.SourceActionsMenuEvent.sourceActionsMenuEvent_onPanelAdded,payload:{widgetId:e.widgetId,newPanel:i.panel,group:i.group}}),t()},e=>{e&&a.logService.error(e),t()})}toggleUserRating(e,t){return this.storeObject.toggleUserRating(this,{sources:e,value:t})}toggleFavorite(e){return this.storeObject.toggleFavorite(this,{sources:e})}togglePanel(e,t,i){return this.storeObject.togglePanel(this,{sources:e,panel:t,include:i})}block(e){return this.storeObject.block(this,{sources:e})}addPanel(e,t){return this.storeObject.addPanel(this,{sources:e,widgetId:t})}getUserRating(e){if(!o.isEmpty(e))return o.reduce(e,(e,t)=>e===t.user_rating?t.user_rating:void 0,e[0].user_rating)}getFavorite(e){return!o.isEmpty(e)&&o.every(e,e=>e.favorite)}isBlockable(e){return o.every(e,e=>e.blockable)}shouldShowOnlyBlockOption(e){return o.every(e,e=>e.show_only_block_option)}showOptionToAddToSourcePanel(e){return o.every(e,e=>e.show_option_to_add_to_source_panel)}getMonitoredSites(){return this.storeObject.getMonitoredSites()}getMessages(){return this.storeObject.getMessages()}}__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",Object)],l.prototype,"onApplyInfluenstar",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",Object)],l.prototype,"onApplyFavorite",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",Object)],l.prototype,"onIncludeInPanel",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",Object)],l.prototype,"onExcludeFromPanel",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",Object)],l.prototype,"onAddPanel",null),t.SourceActionsMenuStore=l}),define("source_actions_menu/containers/source_actions_menu_container",["require","exports","react","source_actions_menu/components/renderables/source_actions_menu_renderable","source_actions_menu/stores/source_actions_menu_store","flux"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsMenuContainer=class extends r.BaseComponent{componentDidMount(){this.cancellationToken.subscribe(n.SourceActionsMenuStore.getInstance().onChange,()=>this.forceUpdate())}render(){return i.createElement(s.SourceActionsMenuRenderable,Object.assign({},this.props))}}}),define("context_menu/components/renderables/panels/source_actions_panel",["require","exports","react","source_actions_menu/containers/source_actions_menu_container","context_menu/components/renderables/context_menu_panel","source_actions_menu/stores/source_actions_menu_store"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SourceActionsPanel=class extends n.ContextMenuPanel{generateContent(){const{authors:e,sources:t,panels_groups:n,widgetId:r,monitoredSites:o}=this.props,a=this.initializeSourcePanelCategory(e,!0),l=this.initializeSourcePanelCategory(t,!1);return i.createElement(s.SourceActionsMenuContainer,{authorsCategory:a,sourcesCategory:l,panels_groups:n,widgetId:r,monitoredSites:o,messages:this.getMessages()})}initializeSourcePanelCategory(e,t=!1){if(e&&e.length>0){const i=t?"AUTHOR":"SOURCE";return{author:t,mapped_id:i,name:t?r.SourceActionsMenuStore.getInstance().getMessages()._868599:r.SourceActionsMenuStore.getInstance().getMessages()._001166,userRating:r.SourceActionsMenuStore.getInstance().getUserRating(e),favorite:r.SourceActionsMenuStore.getInstance().getFavorite(e),blockable:r.SourceActionsMenuStore.getInstance().isBlockable(e),sources:e,showOptionToAddToSourcePanel:r.SourceActionsMenuStore.getInstance().showOptionToAddToSourcePanel(e),showOnlyBlockOption:r.SourceActionsMenuStore.getInstance().shouldShowOnlyBlockOption(e),visible:!!this.props.isPanelVisible&&this.props.isPanelVisible(i)}}return null}getMessages(){return r.SourceActionsMenuStore.getInstance().getMessages()}}}),define("form/components/on_off_component",["require","exports","flux","react","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OnOffComponent=class extends i.BaseComponent{constructor(e){super(e),this.state={on:void 0!==!e.on&&e.on}}render(){const e=this.props.messages,t=n({"on-off":!0,off:!this.state.on,small:this.props.small});return s.createElement("div",{className:"checkbox"},s.createElement("div",{className:t,onClick:this.toggleState.bind(this)},s.createElement("span",{className:"label-on"},e.on),s.createElement("span",{className:"button"}),s.createElement("span",{className:"label-off"},e.off)))}toggleState(){const e=!this.state.on;this.props.callback&&this.props.callback(e),this.setState({on:e})}set on(e){this.setState({on:e})}}}),define("diff_explorer/models/diff_explorer_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("diff_explorer/components/diff_explorer_header",["require","exports","react","flux","form/components/on_off_component"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DiffExplorerHeader=class extends s.BaseComponent{constructor(e){super(e)}render(){const{close:e}=this.props;return i.createElement("div",{className:"modal-header"},i.createElement("button",{onClick:e,type:"button",className:"close"},""),i.createElement("h2",null,this.props.contextData.getMessage("_1191852")),i.createElement("div",{className:"button-bar"},this.renderButtonBar()))}renderButtonBar(){return this.props.options.showCompare?i.createElement("div",{className:"header"},i.createElement(n.OnOffComponent,{messages:{off:this.props.options.messages.previous,on:this.props.options.messages.latest},callback:e=>this.props.onCompareChange(e)}),i.createElement("div",{className:"message"},this.props.contextData.getMessage("_1191850"))):this.props.options.showDeletedOption?i.createElement("div",{className:"header"},i.createElement(n.OnOffComponent,{messages:{off:this.props.options.messages.off,on:this.props.options.messages.on},callback:e=>this.props.onShowDeletionChange(e)}),i.createElement("div",{className:"message"},this.props.contextData.getMessage("_1191851"))):null}}}),define("diff_explorer/models/diff_display_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("diff_explorer/components/query_display",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.QueryDisplay=class extends s.BaseComponent{constructor(e){super(e)}render(){const{beforeModel:e,afterModel:t,afterClassName:s,afterTitle:n,beforeClassName:r,beforeTitle:o}=this.props;return this.normalizeModel(e,t),i.createElement("div",{style:{width:"100%"}},this.renderBox(e,o,r),this.renderBox(t,n,s))}renderBox(e,t,s){const{excluded_items:n=[],included_items:r=[]}=e;return i.createElement("div",{className:s},i.createElement("b",null,t),[...this.renderLines(r)],[...this.renderLines(n)])}renderLines(e){return e.map((e,t)=>i.createElement("div",{key:t,dangerouslySetInnerHTML:{__html:e.text}}))}normalizeModel(e,t){this.normalizeQueryItems(e.included_items,t.included_items),this.normalizeQueryItems(e.excluded_items,t.excluded_items)}normalizeQueryItems(e=[],t=[]){const i=e.length>t.length?e:t,s=i===e?t:e;for(let e=0;e<i.length;e++)void 0===s[e]?s.splice(e,0,{id:i[e].id,type:i[e].type,text:"&nbsp;"}):i[e].id!==s[e].id&&(i[e+1]&&i[e+1].id!==s[e].id?i.splice(e,0,{id:s[e].id,type:s[e].type,text:"&nbsp;"}):s.splice(e,0,{id:i[e].id,type:i[e].type,text:"&nbsp;"}))}}}),define("diff_explorer/components/diff_display",["require","exports","react","flux","classnames","diff_explorer/components/query_display","talkwalker_constants"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DiffDisplay=class extends s.BaseComponent{constructor(e){super(e)}render(){const{query:e}=this.props,t=e.execute();return this.isDataLoaded(t)?i.createElement("div",{className:"diff-display"},t.historyEntry.filter(this.removeUnchanged).map(e=>this.renderDiff(e)),i.createElement("div",{className:"other-states"},i.createElement(r.QueryDisplay,{beforeClassName:"before",beforeTitle:"Before",beforeModel:t.before,afterClassName:"after",afterTitle:"After",afterModel:t.after}))):null}removeUnchanged(e){return e.type!==o.ChangingType.MODIFIED||void 0!==e.changes}renderDiff(e){let t=e.query;switch(e.type){case o.ChangingType.MODIFIED:t=this.parseQuery(t,e)}const s=n({"diff-entry":!0});return i.createElement("div",{className:s,key:e.id_item},i.createElement("div",{className:"icon-slot",dangerouslySetInnerHTML:{__html:this.getIcon(e.type)}}),i.createElement("div",{className:"query-slot",dangerouslySetInnerHTML:{__html:this.markup(t,e.type)}}))}parseQuery(e,t){return e.replace(/{\d+}/g,e=>{const i=parseInt(e.substring(1,e.length-1),10),s=t.changes[i].type;return this.markup(t.changes[i].text,s)})}getIcon(e){switch(e){case o.ChangingType.ADDED:return'<i class="fa fa-plus"></i>';case o.ChangingType.MODIFIED:return'<i class="fa fa-pencil"></i>';case o.ChangingType.REMOVED:return'<i class="fa fa-times"></i>';default:return""}}markup(e,t){switch(t){case o.ChangingType.ADDED:return`<span class="added">${e}</span>`;case o.ChangingType.MODIFIED:return`<span class="modified">${e}</span>`;case o.ChangingType.REMOVED:return`<span class="removed">${e}</span>`;default:throw new Error(`Unknown change type ${t}`)}}isDataLoaded(e){return void 0!==e.historyEntry}}}),define("diff_explorer/models/history_entry_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("diff_explorer/components/history_entry",["require","exports","react","flux","classnames"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HistoryEntry=class extends s.BaseComponent{constructor(e){super(e),this.state={selected:!1}}render(){const{onClicked:e=_.noop,onRevert:t,query:s,selected:r}=this.props,o=s.execute(),{historyEntry:{user_email:a,timestamp:l,user_name:c}}=o,d=o.historyEntry.topic_name||o.historyEntry.brand_name,h=n({"history-entry":!0,selected:r,"three-columns":void 0===d,"four-columns":void 0!==d});return i.createElement("div",{className:h,onClick:t=>e(t)},i.createElement("div",{className:"column-left"},i.createElement("span",{className:"author-name"},c)," ",i.createElement("a",{href:`mailto:${a}`},"(",a,")")),i.createElement("div",{className:"column-middle"},o.historyEntry.action,""),void 0!==d?i.createElement("div",{className:"column-middle"},d,""):null,i.createElement("div",{className:"column-right"},l),i.createElement("a",{href:"javascript:void(0)",className:"column-actions",onClick:e=>t(e)},i.createElement("i",{className:"fa fa-history no-decoration"})))}}}),define("diff_explorer/components/history_entry_selector",["require","exports","react","flux","diff_explorer/components/history_entry","query_system","reusable_utilities","classnames"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class l extends s.BaseComponent{constructor(e){super(e),this.keyActions=[{keys:[o.Keys.DOWN_ARROW],action:e=>this.onDownPress(e)},{keys:[o.Keys.UP_ARROW],action:e=>this.onUpPress(e)}],this.state={selectedEntry:void 0}}render(){const{query:e}=this.props,t=e.execute(),s=t.history.length>0&&void 0!==(t.history[0].topic_name||t.history[0].brand_name),n=a({"history-header":!0,"three-columns":!s,"four-columns":s});return i.createElement("div",{className:"history-selector-container"},i.createElement("div",{className:n},i.createElement("div",{className:"history-user"},i.createElement("span",null,"User")),i.createElement("div",{className:"history-action"},i.createElement("span",null,"Action")),s?i.createElement("div",{className:"history-name"},i.createElement("span",null,"Name")):null,i.createElement("div",{className:"history-date"},i.createElement("span",null,"Date and time"))),i.createElement("div",{className:"history-selector",ref:"root",onScroll:e=>this.checkBottomReached(e)},t.history.map((e,t)=>this.renderHistoryEntry(e,t))))}renderHistoryEntry(e,t){const{query:s}=this.props,{selectedEntry:o}=this.state,{onRevert:a}=this.props,c=o?e.id===o:0===t,d=s.createSubQuery({historyEntry:[l.HISTORY,r.queryFindByProperty(l.ID,e.id)]});return i.createElement("div",{className:"history-entry-container",key:e.id,ref:e.id},i.createElement(n.HistoryEntry,{key:e.id,query:d,selected:c,onRevert:t=>a(e.id),onClicked:t=>this.onSelectionChanged(t,e)}))}onSelectionChanged(e,t){e.stopPropagation(),this.selectEntry(t)}onDownPress(e){e.preventDefault(),this.selectNext()}onUpPress(e){e.preventDefault(),this.selectPrevious()}selectNext(){const{query:e}=this.props,t=e.execute();let i=_.findIndex(_.values(t.history),e=>e.id===this.state.selectedEntry);i<0&&(i=0),t.history.length>i+1&&this.selectEntry(t.history[i+1])}selectPrevious(){const{query:e}=this.props,t=e.execute();let i=_.findIndex(_.values(t.history),e=>e.id===this.state.selectedEntry);i<0&&(i=0),i-1>=0&&this.selectEntry(t.history[i-1])}selectEntry(e){const{onSelectionChanged:t=_.noop}=this.props;_.isString(history)?(this.setState({selectedEntry:e}),t(e),this.scrollIntoView(this.refs[e])):(this.setState({selectedEntry:e.id}),t(e.id),this.scrollIntoView(this.refs[e.id]))}scrollIntoView(e){const t=$(e),i=$(this.refs[l.ROOT]);t.offset().top<i.offset().top?i.scrollTop(i.scrollTop()-(i.offset().top-t.offset().top)):t.offset().top+t.height()>i.offset().top+i.height()&&i.scrollTop(i.scrollTop()+t.offset().top+t.height()-i.height()-i.offset().top)}checkBottomReached(e){const t=this.refs[l.ROOT];t.clientHeight+t.scrollTop>t.scrollHeight-10&&this.props.onBottomReached()}}l.HISTORY="history",l.ID="id",l.ROOT="root",__decorate([o.throttle(175,{trailing:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],l.prototype,"selectNext",null),__decorate([o.throttle(175,{trailing:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],l.prototype,"selectPrevious",null),t.HistoryEntrySelector=l,o.applyMixins(l,[s.KeyListener])}),define("diff_explorer/data/diff_explorer_data_service",["require","exports","reusable_services"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DiffExplorerDataService=class{static loadHistoryEntry(e,t,s,n,r,o){const a=$.Deferred();return i.requestService.post(e,{compare_type:s,item_history_id:o,show_deleted:r,display_single_item:void 0!==o,search_query_history:t,last_history_id:n}).then(e=>{a.resolve({entry:e.search_query_history.item_differences,before:e.search_query_history.previous,after:e.search_query_history.after})}),a.promise()}static loadMoreEntries(e,t,s,n,r,o,a,l){const c=$.Deferred();return i.requestService.post(e,{displaying_type:t,id:r,show_deleted:a,item_history_id:l,length_histories:n,start_history_id:s,search_query_history:{project_id:o}}).then(e=>{c.resolve(e.search_query_histories)}),c.promise()}static revertChange(e,t){return i.requestService.post(e,{search_query_history:t})}static loadDeletedEntries(e,t,s,n,r){const o=$.Deferred();return i.requestService.post(e,{displaying_type:t,form:s,id:n,length_histories:10,show_deleted:r}).then(e=>{o.resolve(e.search_query_histories)}),o.promise()}}}),define("diff_explorer/diff_explorer",["require","exports","flux","query_system","react","reusable_utilities","talkwalker_constants","diff_explorer/components/diff_display","diff_explorer/components/diff_explorer_header","diff_explorer/components/history_entry_selector","diff_explorer/data/diff_explorer_data_service"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class h extends i.BaseComponent{constructor(e){super(e),this.keyActions=[{keys:r.Keys.ESCAPE,action:()=>{this.props.close()}}],this.showDeleted=!1,this.state={selectedEntry:void 0,historyEntries:e.query.execute().history,historyEntriesContent:{},historyCompare:{},compareType:o.CompareType.COMPARE_WITH_PREVIOUS}}render(){const{close:e}=this.props,t=this.props.query.execute(),i={messages:t.messages,showCompare:t.showCompare,showDeletedOption:t.showDeletedOption};return n.createElement("div",{className:"tw-diff-explorer"},n.createElement(l.DiffExplorerHeader,{onCompareChange:e=>this.onCompareChange(e),onShowDeletionChange:e=>this.onShowDeletionChange(e),close:e,options:i,contextData:t.contextData}),this.renderBody())}clickInside(e){}clickOutside(e){this.props.close()}updateSelection(e){this.setState({selectedEntry:e})}revert(e){const{query:t}=this.props,i=t.execute();i.confirmFunctions.revertConfirmation().then(()=>{const{historyEntries:t}=this.state;d.DiffExplorerDataService.revertChange(i.endPoints.revertEntry,_.find(t,t=>t.id===e)).then(e=>{t.unshift(e.search_query_history),this.setState({historyEntries:t})})},()=>void 0),window.tw.inject("$rootScope").$apply()}renderDiff(){const{historyEntries:e,selectedEntry:t}=this.state,i=t||e[0].id;void 0===this.state.historyEntriesContent[i]&&this.loadEntry(_.find(e,e=>e.id===i));const r=this.props.query.createSubQuery({historyEntry:new s.ProviderQuery(this.state.historyEntriesContent[i]),before:new s.ProviderQuery((this.state.historyCompare[i]||{}).before),after:new s.ProviderQuery((this.state.historyCompare[i]||{}).after)});return n.createElement(a.DiffDisplay,{query:r})}renderBody(){const{historyEntries:e}=this.state;return e.length>0?n.createElement("div",null,n.createElement(c.HistoryEntrySelector,{onRevert:e=>this.revert(e),onSelectionChanged:e=>this.updateSelection(e),onBottomReached:()=>this.loadMore(),query:new s.Query({history:new s.ProviderQuery(e)})}),this.renderDiff()):n.createElement("div",{className:"no-data"},"No history available")}loadMore(){const{historyEntries:e}=this.state,{query:t}=this.props,i=t.execute();d.DiffExplorerDataService.loadMoreEntries(i.endPoints.loadMoreEntries,i.settings.displayType,_.last(this.state.historyEntries).id,i.settings.loadBatchSize,i.topicId,i.projectId,this.showDeleted,i.queryId).then(t=>{e.push.apply(e,t),this.forceUpdate()})}loadEntry(e){const{query:t}=this.props,{compareType:i}=this.state,s=t.execute();d.DiffExplorerDataService.loadHistoryEntry(s.endPoints.loadHistoryEntry,e,i,s.lastHistoryId,this.showDeleted,s.queryId).then(({entry:t,before:i,after:s})=>{this.state.historyEntriesContent[e.id]=t,this.state.historyCompare[e.id]={before:i,after:s},this.forceUpdate()})}loadDeletedEntries(e){const t=this.props.query.execute();d.DiffExplorerDataService.loadDeletedEntries(t.endPoints.loadDeletedEntries,t.settings.displayType,t.settings.form,t.topicId,e).then(e=>{this.setState({historyEntries:e,historyEntriesContent:{}})})}onCompareChange(e){this.setState({compareType:e?o.CompareType.COMPARE_WITH_LATEST:o.CompareType.COMPARE_WITH_PREVIOUS,historyEntriesContent:{}})}onShowDeletionChange(e){this.showDeleted=e,this.loadDeletedEntries(e)}}__decorate([r.throttle(1e3,{trailing:!1}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],h.prototype,"loadMore",null),t.DiffExplorer=h,r.applyMixins(h,[i.DocumentClickTracker,i.KeyListener])}),define("dropdown_menu/generic/models/generic_dropdown_menu_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("dropdown_menu/generic/generic_dropdown_menu_renderable",["require","exports","flux","utilities/document_click_tracker_wrapper","react","classnames","event_bus","underscore"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GenericDropdownMenuRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={dropdownOpen:!1}}componentDidMount(){this.cancellationToken.addDomEvent(this.refs.element,"click",this.onClick.bind(this))}render(){let e=null;this.state.dropdownOpen&&void 0!==this.props.model.items&&this.props.model.items.length>0&&(e=n.createElement(s.DocumentClickTrackerWrapper,{clickOutside:()=>this.setMenuState(!1)},this.renderDropdown()));const t=r(["generic-dropdown-menu"]);return n.createElement("div",{ref:"element",className:t},n.createElement("i",{className:this.props.model.menuButtonIcon}),e)}renderDropdown(){return n.createElement("div",{className:"menu"},this.props.model.items.map(e=>this.renderItem(e)))}renderItem(e){return n.createElement("div",{key:a.uniqueId("generic-dropdown-item-"),onClick:t=>this.handleItemClick(t,e),className:"item"},this.renderIcon(e),this.renderName(e))}renderIcon(e){if(void 0!==e.icon){const t=r([e.icon,"item-icon"]);return n.createElement("i",{className:t})}return null}renderName(e){return void 0!==e.icon?n.createElement("span",null,e.name):null}onClick(e){e.preventDefault(),e.stopPropagation(),this.setMenuState(!this.state.dropdownOpen)}handleItemClick(e,t){o.eventBus.dispatch({type:t.eventType,value:t.actionPayload})}setMenuState(e){this.setState({dropdownOpen:e})}}}),define("expandable_list/list_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("filter_menu/hoverable_filter_menu/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("expandable_list/menu_entry_config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("expandable_list/menu_config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEFAULT="default"}(t.MenuConfigKeys||(t.MenuConfigKeys={}))}),define("expandable_list/style/expandable_list_style",["require","exports","emotion","composable_styles"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expandableListContainerStyle=(e=>s.dynamicStyle((e,t)=>e`
            display: block;
            width: ${t.width};
            color: ${t.fontColor};
            margin: ${t.margin};

            overflow-x: ${t.showScrollbar?"hidden":void 0};
            overflow-y: ${t.showScrollbar?"scroll":void 0};

            label: expandableListContainerStyle;
        `)(s.composeProps(e,{showScrollbar:!1,fontSize:"12px"}))),t.expandableListSubListStyle=i.css`
    display: block;

    label: expandableListSubListStyle;
`,t.expandableListChildContainerStyle=(e=>s.dynamicStyle((e,t)=>e`
            display: block;
            margin: ${t.margin};

            label: expandableListChildContainerStyle;
        `)(s.composeProps(e,{margin:"0 0 0 0.5em"}))),t.expandableListItemContainerStyle=(e=>s.dynamicStyle((e,t)=>e`
            display: flex;
            height: ${t.height};
            padding: ${t.padding};
            margin: ${t.margin};

            label: expandableListItemContainerStyle;
        `)(s.composeProps(e,{height:"20px",padding:"0",margin:"0.15em"}))),t.expandableListItemLabel=(e=>s.dynamicStyle((e,t)=>e`
            display: flex;
            padding: ${t.padding};
            max-width: calc(100% - 18px);
            flex: 1;

            label: expandableListItemLabel;
        `)(s.composeProps(e,{padding:"0 6px 0 0",margin:"0.15em"}))),t.expandableListItemIconStyle=(e=>s.dynamicStyle((e,t)=>e`
            color: ${t.hovered?"white":void 0};
            background-color: ${t.hovered?t.color:t.backgroundColor};
            margin: auto;
            border-radius: 3px;
            padding: 1px 0;
            min-width: 18px;
            text-align: center;
            font-size: 12px;
            display: flex;
            justify-content: center;

            label: expandableListItemIconStyle;
        `)(s.composeProps(e,{backgroundColor:"#eeeeee"}))),t.expandableListSelectionNumberStyle=(e=>s.dynamicStyle((e,t)=>e`
            display: flex;
            width: 30px;
            height: 18px;
            margin: auto 5px;

            .selection-number {
                display: flex;
                width: 100%;
                height: 100%;
                border-radius: 5px;
                font-size: 12px;
                justify-content: center;

                background-color: ${t.backgroundColor};
                color: ${t.color};
            }

            label: expandableListSelectionNumberStyle;
        `)(s.composeProps(e,{color:"white"}))),t.expandableListLoadingSpinner=s.dynamicStyle((e,t)=>e`
        text-align: center;
        color: ${t.color};

        label: expandableListLoadingSpinner;
    `)}),define("expandable_list/expandable_list_item",["require","exports","react","expandable_list/menu_config","emotion","expandable_list/style/expandable_list_style"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.Component{render(){const{listItem:e,hoveredItems:t,openItems:s,toggleHover:n}=this.props,o=t.get(e.label),a=s.get(e.label);return i.createElement("div",null,i.createElement("div",{className:r.expandableListSubListStyle,onMouseEnter:()=>n(e.label),onMouseLeave:()=>n(e.label)},i.createElement("div",{className:this.getItemContainerStyle()},this.renderItemIcon(e,o),this.renderItemLabel(e,o),this.renderItemSelectionNumber(e),this.renderItemExpandButton(e,o,a))),this.renderItemChildren(e,a))}getItemContainerStyle(){const{style:e={}}=this.props,{item:t=r.expandableListItemContainerStyle}=e;return t({})}renderItemIcon(e,t=!1){if(e.leftIconClass&&""!==e.leftIconClass){const s=t?e.hoveredLeftIconStyle:e.leftIconStyle;return i.createElement("div",{className:"expandable-list-item-icon"},i.createElement("div",{className:e.leftIconClass,style:s}))}return null}renderItemLabel(e,t=!1){const s=t?e.hoveredLabelStyle:e.labelStyle;return i.createElement("div",{className:r.expandableListItemLabel({}),onClick:()=>e.labelClick()},i.createElement("span",{style:s,className:e.labelClass},i.createElement("span",{className:"filter-name-label"},e.label)))}renderItemSelectionNumber(e){return void 0!==e.selectionNumber&&e.selectionNumber>0?i.createElement("span",{className:r.expandableListSelectionNumberStyle({backgroundColor:e.color})},i.createElement("span",{className:"selection-number"},e.selectionNumber)):null}renderItemExpandButton(e,t=!1,s=!1){const{style:o={}}=this.props,{rightIcon:a=r.expandableListItemIconStyle,expandedIconClass:l="fa fa-caret-up",collapsedIconClass:c="fa fa-caret-down"}=o,d=a({hovered:t,color:e.color});return e.children&&e.children.length>0||e.showExpandButton?i.createElement("div",{className:n.cx(d,s?l:c),onClick:()=>this.props.onClick(e)}):null}renderItemChildren(e,t=!1){const{children:s}=e;if(t){if(void 0!==s&&s.length>0)return i.createElement("div",{className:r.expandableListChildContainerStyle({})},s.map(e=>this.renderItem(e)));if(e.showExpandButton)return i.createElement("div",{className:r.expandableListLoadingSpinner({color:e.color})},i.createElement("i",{className:"fa fa-spinner fa-spin"}))}return null}renderItem(e){let t;const i=this.getCustomComponentToRender(e),s=`${e.label}-${e.id}`;return t=void 0!==i?this.renderCustomComponent(i,s):this.renderExpandableListItem(e,s)}getCustomComponentToRender(e){const{menuConfig:t}=this.props;if(void 0!==t&&t.entries){const i=t.entries[e.id]||t.entries[s.MenuConfigKeys.DEFAULT];if(void 0!==i&&void 0!==i.renderable)return i}}renderExpandableListItem(e,t){return i.createElement(o,{key:t,menuConfig:this.props.menuConfig,openItems:this.props.openItems,hoveredItems:this.props.hoveredItems,listItem:e,onClick:this.props.onClick,toggleHover:this.props.toggleHover})}renderCustomComponent(e,t){return i.createElement(e.renderable,Object.assign({},e.props,{key:t}))}}t.ExpandableListItem=o}),define("expandable_list/filter_menu_selection_mode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INCLUDE="INCLUDE",e.EXCLUDE="EXCLUDE"}(t.FilterMenuSelectionModeType||(t.FilterMenuSelectionModeType={}))}),define("expandable_list/menu_attributes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("expandable_list/expandable_list_container",["require","exports","react","expandable_list/expandable_list_item","react-tiny-virtual-list","emotion","expandable_list/style/expandable_list_style"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ExpandableListContainer=class extends i.Component{constructor(e){if(super(e),this.key=_.uniqueId(),this.state={openItems:this.mapItems(this.props.listItems),hoveredItems:this.mapItems(this.props.listItems)},this.shouldExpandSingleCategory()){const t=e.listItems[0];this.state.openItems.set(t.label,!0)}}shouldExpandSingleCategory(){const{menuAttributes:e,listItems:t}=this.props;return e.config.shouldExpandSingleCategory&&1===t.length}render(){const e=this.getContainerClass();return i.createElement("div",{key:"expandable-list-container-"+this.key,className:e},this.props.useVirtualList?this.renderAsVirtualList():this.renderExpandable())}getContainerClass(){const{useVirtualList:e,containerScrollable:t,style:i={}}=this.props,{container:s=o.expandableListContainerStyle}=i;return r.cx(s({width:"100%",fontColor:"#333",showScrollbar:!e&&t}),{"stylized-scrollbar":t})}renderAsVirtualList(){return i.createElement(n,{key:"virtual-list-"+this.key,className:"stylized-scrollbar",width:"100%",height:Math.min(22*this.props.listItems.length,this.props.height),itemCount:this.props.listItems.length,itemSize:22,overscanCount:5,renderItem:({index:e,style:t})=>this.renderItem(this.props.listItems[e])})}renderExpandable(){const e=[];return void 0!==this.props.listItems&&this.props.listItems.length>0&&this.props.listItems.forEach(t=>{e.push(this.renderItem(t))}),e}renderItem(e){return i.createElement(s.ExpandableListItem,{style:this.props.style,key:e.id,openItems:this.state.openItems,hoveredItems:this.state.hoveredItems,toggleHover:this.toggleHover.bind(this),listItem:e,menuConfig:this.props.menuAttributes.config,onClick:this.toggleClick.bind(this)})}toggleClick(e){const{openItems:t}=this.state;t.set(e.label,!t.get(e.label)),t.get(e.label)&&e.expandButtonClick(t.get(e.label)),this.setState({openItems:t})}toggleHover(e){const{hoveredItems:t}=this.state;t.set(e,!t.get(e)),this.setState({hoveredItems:t})}mapItems(e){const t=new Map;return e&&_.flatten(e.map(e=>this.mapItem(e))).forEach(e=>t.set(e,!1)),t}mapItem(e){const t=[];return t.push(e.label),e.children&&e.children.forEach(e=>t.concat(this.mapItem(e))),t}}}),define("filter_menu/hoverable_filter_menu/simple_rounded_filter_menu_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SimpleRoundedFilterMenuRenderable=class extends s.BaseComponent{constructor(){super(...arguments),this.baseStyle={display:"flex",color:"black",alignItems:"center",padding:"0 15px 0 0",backgroundColor:"#eeeeee",border:"1px solid #eeeeee",height:"34px"},this.baseLabelStyle={fontSize:"13px",padding:"0 15px",flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}}render(){const{onClick:e,onMouseEnter:t,onMouseLeave:i}=this.props;return n.createElement("div",{className:"hoverable clickable",onClick:e,onMouseEnter:t,onMouseLeave:i},this.renderMenuContainer())}renderMenuContainer(){const{elementProviders:e,label:t}=this.props;return n.createElement("div",{className:"menu-container",style:this.getStyle()},n.createElement("div",{className:"filter-menu-btn-container",style:{flexGrow:1,overflow:"hidden"}},this.renderLabel(t),e.filterContainer({className:"integrated-menu"})),n.createElement("div",{className:this.getCaretClass(),style:this.getCaretStyle()}))}renderLabel(e){return n.createElement("span",{style:this.getLabelStyle()},e)}getCaretClass(){const{isRendered:e}=this.props;return i({"fa big-icon":!0,"fa-caret-down filter-caret-down":!e,"fa-caret-up filter-caret-up":e})}getCaretStyle(){return{color:"#57616D"}}getStyle(){const{minWidth:e,isRendered:t}=this.props;return Object.assign({},this.baseStyle,{borderRadius:t?"4px 4px 0 0":"4px",width:e})}getLabelStyle(){return Object.assign({},this.baseLabelStyle,{fontFamily:"RobotoR"})}}}),define("filter_menu/hoverable_filter_menu/square_filter_menu_renderable",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OPEN=0]="OPEN",e[e.CLOSED=1]="CLOSED",e[e.CLOSED_WITH_SELECTION=2]="CLOSED_WITH_SELECTION"}(r||(r={}));t.SquareFilterMenuRenderable=class extends s.BaseComponent{constructor(e){super(e);const t={display:"flex",color:"black",alignItems:"center",padding:"0 15px 0 0",borderRadius:"2px",border:"1px solid #cccccc",height:"39px"},i={fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"1px 0 0 1px",height:"100%",width:"39px"},s={fontSize:"14px",padding:"0 15px",flexGrow:1,overflow:"hidden",textOverflow:"ellipsis"};if(this.props.customStyle){const{baseStyle:e=t,baseIconStyle:n=i,baseLabelStyle:r=s}=this.props.customStyle;this.baseStyle=e,this.baseLabelStyle=r,this.baseIconStyle=n}else this.baseStyle=t,this.baseIconStyle=i,this.baseLabelStyle=s}render(){const{onClick:e,onMouseEnter:t,onMouseLeave:i}=this.props;return n.createElement("div",{className:"hoverable clickable",onClick:e,onMouseEnter:t,onMouseLeave:i},this.renderMenuContainer())}renderMenuContainer(){const{elementProviders:e,iconClass:t,label:i}=this.props,s=this.determineMenuState(),r=this.getStyle(s);return n.createElement("div",{className:"menu-container",style:r},this.renderIcon(t,s),n.createElement("div",{className:"filter-menu-btn-container",style:{flexGrow:1,overflow:"hidden"}},this.renderLabel(i,s),e.clearButton({style:this.getClearButtonStyle()}),e.filterContainer({className:"integrated-menu",minWidth:r.minWidth})),n.createElement("div",{className:this.getCaretClass()}))}determineMenuState(){const{isRendered:e,numberOfSelected:t,hasDefaultSelection:i}=this.props;return e?r.OPEN:0===t?r.CLOSED:i?r.OPEN:r.CLOSED_WITH_SELECTION}getClearButtonStyle(){const e={backgroundColor:"#57616d",color:"#fff"},t={backgroundColor:"#abb0b6",color:"#000"};if(this.props.customStyle){const{normalButtonStyle:i=e,hoveredButtonStyle:s=t}=this.props.customStyle;return{normal:i,hovered:s}}return{normal:e,hovered:t}}renderIcon(e,t){return void 0!==e&&e.length>0?n.createElement("div",{style:this.getIconStyle(t)},n.createElement("i",{className:e})):null}renderLabel(e,t){return n.createElement("span",{style:this.getLabelStyle(t)},e)}getCaretClass(){const{isRendered:e}=this.props;if(this.props.caretClasses){const{up:t="fa-caret-up filter-caret-up",down:s="fa-caret-down filter-caret-down"}=this.props.caretClasses;return i({fa:!0,[s]:!e,[t]:e})}return i({fa:!0,"fa-caret-down filter-caret-down":!e,"fa-caret-up filter-caret-up":e})}getStyle(e){const{minWidth:t}=this.props,i={minWidth:t,backgroundColor:"#d8dce1",borderBottom:"0",borderRadius:"0 2px 0 0"},s={minWidth:t,backgroundColor:"#ffffff",borderBottom:"1px solid #cccccc"},n={minWidth:t,color:"#ffffff",backgroundColor:"#818992"};if(this.props.customStyle){const{openMenuStyle:t=i,closedMenuStyle:o=s,closedWithSelectionMenuStyle:a=n}=this.props.customStyle;switch(e){case r.OPEN:return Object.assign({},this.baseStyle,t);case r.CLOSED:return Object.assign({},this.baseStyle,o);case r.CLOSED_WITH_SELECTION:return Object.assign({},this.baseStyle,a)}return Object.assign({},this.baseStyle)}switch(e){case r.OPEN:return Object.assign({},this.baseStyle,i);case r.CLOSED:return Object.assign({},this.baseStyle,s);case r.CLOSED_WITH_SELECTION:return Object.assign({},this.baseStyle,n)}return Object.assign({},this.baseStyle)}getIconStyle(e){switch(e){case r.OPEN:return Object.assign({},this.baseIconStyle,{border:"1px solid #abb0b6",borderRadius:"2px 0 0 0",backgroundColor:"#abb0b6",width:"40px"});case r.CLOSED:return Object.assign({},this.baseIconStyle,{borderRight:"1px solid #cccccc",backgroundColor:"#f2f3f4"});case r.CLOSED_WITH_SELECTION:return Object.assign({},this.baseIconStyle,{border:"1px solid #57616d",borderRadius:"2px 0 0 0",backgroundColor:"#57616d",width:"40px"})}return Object.assign({},this.baseIconStyle)}getLabelStyle(e){let t,i;if(this.props.customStyle){const{customStyle:e}=this.props;e.openAndClosedWithSelectionMenuLabelStyle&&(t=e.openAndClosedWithSelectionMenuLabelStyle),e.closedMenuLabelStyle&&(i=e.closedMenuLabelStyle)}switch(e){case r.OPEN:case r.CLOSED_WITH_SELECTION:return Object.assign({},this.baseLabelStyle,t);case r.CLOSED:return Object.assign({},this.baseLabelStyle,i)}return Object.assign({},this.baseLabelStyle)}}}),define("filters/actions/filter_menu_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterMenuActions={verticalFilters_onFilterClick:"verticalFilters_onFilterClick",verticalFilters_onMoreClick:"verticalFilters_onMoreClick",verticalFilters_onRefreshHitCount:"verticalFilters_onRefreshHitCount",verticalFilters_onFiltersCleared:"verticalFilters_onFiltersCleared",verticalFilters_onLazyLoad:"verticalFilters_onLazyLoad",verticalFilters_onFiltersChanged:"verticalFilters_onFiltersChanged"}}),define("filters/actions/filter_option_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterOptionMenuActions={filterOptions_toggleFilterSort:"filterOptions_toggleFilterSort",filterOptions_toggleFilterPin:"filterOptions_toggleFilterPin",filterOptions_toggleGroupFilter:"filterOptions_toggleGroupFilter",filterOptions_setPinState:"filterOptions_setPinState",filterOptions_setGroupFilter:"filterOptions_setGroupFilter",filterOptions_onChangeFilterBehaviour:"filterOptions_onChangeFilterBehaviour",filterOptions_onInvertSelection:"filterOptions_onInvertSelection"}}),define("filters/components/models/FilterOptionsContainer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("filters/components/models/filter_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("filters/components/renderables/filter_options/filter_options",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ICON_LABEL=0]="ICON_LABEL",e[e.TOGGLE_BUTTONS=1]="TOGGLE_BUTTONS"}(r=t.FilterOptionType||(t.FilterOptionType={}));t.FilterOptions=class extends n.Component{constructor(e){super(e)}dispatch(e,t){s.dispatcher.dispatch(e,t)}handleOptionClick(e,t){e.stopPropagation(),this.dispatch(t.clickAction,t.clickData)}renderOptionsSection(e,t){return n.createElement("div",{key:t,className:"container-block"},n.createElement("h6",{className:"title"},e.title),n.createElement("ul",{className:"list-unstyled list-inline"},e.options.map((e,t)=>this.renderOption(e,t))))}renderOption(e,t){switch(e.type){case r.ICON_LABEL:return this.renderIconLabelOption(e,t);case r.TOGGLE_BUTTONS:return this.renderToggleButtonsOption(e,t);default:return null}}renderIconLabelOption(e,t){const s=i({"menuitem label clickable":!0,"label-primary":e.selected,[e.style]:!0}),r=i({selected:e.selected});return n.createElement("li",{key:t},n.createElement("div",{onClick:t=>this.handleOptionClick(t,e),title:e.name,className:s},n.createElement("i",{className:e.icon}),n.createElement("span",{className:r},e.name)))}renderToggleButtonsOption(e,t){return n.createElement("li",{key:t},n.createElement("div",{className:"btn-group","data-toggle":"buttons"},e.buttons.map((t,i)=>this.renderToggleButton(t,e,i))))}renderToggleButton(e,t,s){const r=i({btn:!0,"active btn-primary":e.selected,"btn-default":!e.selected});return n.createElement("label",{key:s,onClick:e=>this.handleOptionClick(e,t),className:r},n.createElement("input",{type:"radio",name:"options",id:s.toString(),autoComplete:"off"}),e.name)}renderMenu(){return n.createElement("div",{onClick:e=>{e.stopPropagation()},className:"actions-container"},n.createElement("div",{className:"container-icon"}),this.props.optionsSections.map((e,t)=>this.renderOptionsSection(e,t)))}render(){const e=i({"filter-options tw-btn-icon btn menu-actions-btn":!0,open:this.props.open,active:this.props.displayMenuButtonAsActive});return n.createElement("div",{ref:"root",className:e,onClick:e=>this.toggle(e)},n.createElement("i",{className:"icon-tw-ellipsis"}),this.props.open?this.renderMenu():"")}toggle(e){e.stopPropagation(),this.props.toggleOpen()}}}),define("filters/components/renderables/horizontal_filter/horizontal_filter",["require","exports","react","flux","filters/components/utilities/shared_filter_logic","filters/actions/filter_menu_actions","dropdown_menu/dropdown_menu_container","utilities/document_click_tracker_wrapper","reusable_utilities","underscore"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HorizontalFilter=class extends s.BaseComponent{constructor(e){super(e),this.state={overflowingElements:void 0,showingMore:!1,subMenuTarget:void 0}}filterClicked(e,t,i){e.stopPropagation(),s.dispatcher.dispatch(r.filterMenuActions.verticalFilters_onFilterClick,{event:e,mappedId:t.mapped_id,parentMappedId:i?i.mapped_id:void 0,menuType:this.props.menu.type,refresh:!0})}checkOverflow(e){if(null!==e&&e.children.length>1&&void 0===this.state.overflowingElements&&e.scrollHeight>e.clientHeight+5){const t=e.children.item(0).offsetTop+e.clientHeight,i=[].slice.call(e.children).filter(e=>e.offsetTop>t);this.setState({overflowingElements:i})}}render(){const{menu:e,constants:t}=this.props,{messages:s}=t,{name:r}=this.props.menu.root_entry,{showingMore:a,overflowingElements:c=[]}=this.state;let d=l.TopicMenuUtils.getMainNode(e),h=l.TopicMenuUtils.getAllNode(e),u=d.children||[];l.TopicMenuUtils.isSingleOrMultiple(e)&&"TAGS"!==e.type&&(h=void 0,(d=e.root_entry.children[e.root_entry.children.length-1]).children!==u&&(u=u.concat(d.children)));const p={inline:!0,allNode:h,ref:e=>this.checkOverflow(e),buttonOptions:{overrideSelectionCheck:l.TopicMenuUtils.isSingleOrMultiple(e)?l.TopicEntryUtils.isSelected:void 0,noCount:!!l.TopicMenuUtils.isSingleOrMultiple(e)||void 0,hideName:n.sharedFilterLogic.hasIcon,iconMap:this.props.constants.iconMap,timedHoverOptions:{duration:50,onMouseEnter:e=>{this.state.subMenuTarget!==e&&e.children&&e.children.length>0&&this.setState({subMenuTarget:e})},onMouseLeave:()=>{void 0!==this.state.subMenuTarget&&this.setState({subMenuTarget:void 0})}},renderEnhancers:{siblings:(e,t)=>{const s=this.buildOptions();return t!==d&&t.children&&t.children.length>0&&e.push(i.createElement("i",{key:0,className:"fa fa-caret-down"})),void 0!==this.state.subMenuTarget&&t!==d&&t.children&&t.children.length>0&&t.mapped_id===this.state.subMenuTarget.mapped_id&&e.push(i.createElement(o.DropdownMenuContainer,{key:1,className:"pull-up",onClick:(e,t)=>{const i=this.getParentNode(t,this.state.subMenuTarget);this.filterClicked.call(this,e,t,i)},options:s,isSubMenu:!1,forceShow:!0,cssMode:!0,entries:t.children})),e}},onClick:(e,t,i)=>this.filterClicked(e,t,i)}};return i.createElement("div",{className:"tw-horizontal-menu"},i.createElement("div",{className:"list"},i.createElement("p",null,r),n.sharedFilterLogic.renderInlineList(u,p),c.length>0?i.createElement("div",{onClick:e=>this.toggleMore(e),className:"more-btn"},i.createElement("i",{className:"icon-tw-ellipsis"}),i.createElement("span",null," ",s.more),a?this.renderShowingMore(d):null):null))}getParentNode(e,t){return l.TopicEntryUtils.getParent(e,t)}toggleMore(e){e.stopPropagation(),this.setState({showingMore:!this.state.showingMore})}closeMore(e){e.stopPropagation(),setTimeout(()=>this.setState({showingMore:!1}))}renderShowingMore(e){const{overflowingElements:t=[]}=this.state,s=t.map(t=>c.find(e.children,e=>e.mapped_id===t.getAttribute("data-mapped-id"))),n=this.buildOptions();return i.createElement(a.DocumentClickTrackerWrapper,{clickOutside:e=>this.closeMore(e)},i.createElement(o.DropdownMenuContainer,{forceShow:!0,alignRight:!0,onClick:(...e)=>this.filterClicked.call(this,...e),isSubMenu:!1,options:n,cssMode:!0,entries:s}))}buildOptions(){return{recursive:{buttonOptions:{timedHoverOptions:{duration:50,onMouseEnter:e=>{e.children&&0!==e.children.length||this.dispatch(r.filterMenuActions.verticalFilters_onLazyLoad,{mappedId:e.mapped_id,menuType:this.props.menu.type})},onMouseLeave:c.noop}}}}}}}),define("filters/components/renderables/sub_page/filter_sub_page_body",["require","exports","flux","react","reusable_utilities","filters/components/utilities/shared_filter_logic"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterSubPageBody=class extends i.BaseComponent{constructor(e){super(e)}render(){const{entry:e,size:t,clickCallback:i,offset:o,numberFormatter:a,filterConstants:l,onMouseLeave:c,onMouseEnter:d}=this.props,h=r.sharedFilterLogic.getSelectedChildren(e),u=r.sharedFilterLogic.getUnselectedChildren(e);return s.createElement("div",{onMouseEnter:e=>d(e),onMouseLeave:e=>c(e),onClick:e=>e.stopPropagation(),className:`sub-window side-window child left-col-${o} diff-col-${t} col-${t}`},s.createElement("div",{className:"all-node"},r.sharedFilterLogic.renderFilterButton(e,{overrideSelectionCheck:n.TopicEntryUtils.isSelected,prefix:l.messages.all+" ",noCount:!0})),h.length>0?r.sharedFilterLogic.renderInlineList(h,{levels:2,buttonOptions:{onClick:this.props.clickCallback}}):null,r.sharedFilterLogic.renderColumns(t,u,i,a,e))}}}),define("filters/components/renderables/sub_page/filter_sub_page",["require","exports","react","flux","filters/components/renderables/sub_page/filter_sub_page_body","filters/actions/filter_menu_actions","underscore","filters/components/utilities/shared_filter_logic","utilities/timed_hover"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterSubPage=class extends s.BaseComponent{constructor(e){super(e),this.state={subPageOwner:void 0}}render(){return this.renderSubPageHeader(this.props.entries)}enterEntry(e){void 0!==e.children&&0!==e.children.length||s.dispatcher.dispatch(r.filterMenuActions.verticalFilters_onLazyLoad,{mappedId:e.mapped_id,menuType:this.props.menuType}),this.setState({subPageOwner:e.mapped_id})}leaveEntry(){this.setState({subPageOwner:void 0})}renderSubPageHeader(e){const t=this.getEntryByMappedId(this.state.subPageOwner),s=void 0!==t&&t.children&&t.children.length>0,{size:r,clickCallback:o,offset:c,filterConstants:d,numberFormatter:h,onMouseEnter:u,onMouseLeave:p}=this.props;return i.createElement("ul",{className:"list-unstyled"},e.map(e=>i.createElement("li",{key:e.mapped_id,className:`col-${c} right side hoverable dark-hover full-width`,onMouseLeave:()=>this.leaveEntry(),onClick:t=>this.props.clickCallback(t,e)},i.createElement(l.TimedHover,{duration:75,callback:()=>this.enterEntry(e),className:"line-block",onClick:()=>{}},a.sharedFilterLogic.renderFilterButton(e),this.renderRightCaret(e),e.filter_hits?i.createElement("span",{className:"filter-count"},(e=>`(${h(e.filter_hits)})`)(e)):null),s?i.createElement(n.FilterSubPageBody,{entry:t,offset:c,size:r,onMouseEnter:u,onMouseLeave:p,filterConstants:d,numberFormatter:h,clickCallback:o}):"")))}renderRightCaret(e){return void 0!==e.children&&e.children.length>0?i.createElement("i",{className:"fa fa-caret-right arrow right"}):null}getEntryByMappedId(e){return o.find(this.props.entries,t=>t.mapped_id===e)}}}),define("filters/components/renderables/side_panel/filter_side_panel",["require","exports","react","flux","filters/components/renderables/sub_page/filter_sub_page","filters/components/utilities/shared_filter_logic","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FilterSidePanel=class extends s.BaseComponent{constructor(e){super(e),this.state={hideScrollbar:!1}}onEnterSubPage(){this.setState({hideScrollbar:!0})}onLeaveSubPage(){this.setState({hideScrollbar:!1})}render(){const{size:e,entry:t,clickCallback:s,filterConstants:o,numberFormatter:a,menuType:l}=this.props,c={};return this.state.hideScrollbar&&(c["overflow-y"]="hidden"),void 0===t.children||0===t.children.length?i.createElement("div",{style:c,className:"side-window col-"+e},i.createElement("div",{className:"loading"},t.additional_info?i.createElement("div",null,t.additional_info):i.createElement("i",{className:"fa fa-refresh fa-spin"}))):i.createElement("div",{style:c,className:"side-window col-"+e,ref:"root",onMouseEnter:()=>this.show(),onMouseLeave:()=>this.hide()},this.renderSidePanelAllNode(t),this.props.hasSubPage?i.createElement(n.FilterSubPage,{entries:r.sharedFilterLogic.getSelectedChildren(t),offset:e-Math.floor(e/2),size:Math.floor(e/2),menuType:l,filterConstants:o,numberFormatter:a,onMouseEnter:()=>this.onEnterSubPage(),onMouseLeave:()=>this.onLeaveSubPage(),clickCallback:s}):"",this.renderSelectedSidePanelChildren(t),r.sharedFilterLogic.renderColumns(e,r.sharedFilterLogic.getUnselectedChildren(t),s,a,t))}renderSelectedSidePanelChildren(e){const{hasSubPage:t,clickCallback:i,numberFormatter:s}=this.props;return t?null:r.sharedFilterLogic.renderInlineList(r.sharedFilterLogic.getSelectedChildren(e),{levels:2,inline:!0,buttonOptions:{onClick:i,numberFormatter:s}})}renderSidePanelAllNode(e){const{clickCallback:t,filterConstants:s}=this.props;return i.createElement("div",{onClick:i=>t(i,e),className:"all-node"},r.sharedFilterLogic.renderFilterButton(e,{overrideSelectionCheck:o.TopicEntryUtils.isSelected,prefix:s.messages.all+" ",noCount:!0}))}show(){"right"!==this.props.side&&(clearTimeout(this.pendingHide),$(this.refs.root).css({display:"block",right:"213px"}))}hide(){"right"!==this.props.side&&(this.pendingHide=setTimeout(()=>{$(this.refs.root).removeAttr("style")},500))}}}),define("filters/components/renderables/vertical_filter/vertical_filter",["require","exports","classnames","flux","react","reusable_utilities","utilities/timed_hover","filters/actions/filter_menu_actions","filters/actions/filter_option_actions","filters/components/utilities/shared_filter_logic","filters/components/renderables/side_panel/filter_side_panel","underscore"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VerticalFilter=class extends s.BaseComponent{constructor(e){super(e)}filterClicked(e,t,i){e.stopPropagation(),s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onFilterClick,{event:e,mappedId:t.mapped_id,parentMappedId:i?i.mapped_id:void 0,menuType:this.props.topicMenu.type})}removePinState(){s.dispatcher.dispatch(l.FilterOptionMenuActions.filterOptions_setPinState,{topicMenu:this.props.topicMenu,pin:!1})}showMore(){const e=r.TopicEntryUtils.getChildrenCountRecursive(this.props.topicMenu.root_entry,2);s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onMoreClick,{childrenCount:e+this.props.optionsToShowOffset,rowIndex:this.props.rowIndex}),window.tw.inject("brokerService").publish("FILTERS.MORE",[e+this.props.optionsToShowOffset,6,1,this.props.rowIndex+1]),setTimeout(()=>{window.tw.inject("$rootScope").$apply()})}showLess(){s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onMoreClick,{childrenCount:0,rowIndex:this.props.rowIndex}),window.tw.inject("brokerService").publish("FILTERS.LESS",[this.props.rowIndex+1]),setTimeout(()=>{window.tw.inject("$rootScope").$apply()})}refreshHitCount(){s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onRefreshHitCount,{menuType:this.props.topicMenu.type})}canShowMore(){const e=this.props.topicMenu.root_entry;return r.TopicEntryUtils.getChildrenCountRecursive(e,2)-1>this.props.numberOfOptionsToShow}canShowLess(){const{numberOfOptionsToShow:e,minimumNumberOfOptionsToShow:t,topicMenu:i}=this.props,s=i.root_entry;return!this.canShowMore()&&e>t&&r.TopicEntryUtils.getChildrenCountRecursive(s,2)-1>t}getSidePanelDirection(){return this.props.columnIndex>2?"left":"right"}getSidePanelSize(){switch(this.getSidePanelDirection()){case"left":return this.props.columnIndex;case"right":return 5-this.props.columnIndex;default:throw new Error("unexpected side panel direction")}}render(){if(void 0===this.props.topicMenu||void 0===this.props.topicMenu.root_entry||void 0===this.props.topicMenu.root_entry.children||void 0===this.props.topicMenu.root_entry.name||void 0===this.props.topicMenu.type)throw new Error("one or more props or properties or props of vertical filter is undefined");const{numberOfOptionsToShow:e,minimumNumberOfOptionsToShow:t}=this.props,s=this.props.topicMenu.root_entry.children,r=this.props.topicMenu.root_entry.name,o=i({"tw-vertical-menu tw-filter-menu tw-label-menu":!0,disabled:!0===this.props.topicMenu.disabled}),a=i({"list-unstyled":!0,"show-more":e>t});return n.createElement("div",{className:o},n.createElement("div",{className:"menu-header clearfix"},n.createElement("div",{className:"menu-title"},n.createElement("h6",null,r),this.renderLockIcon()),n.createElement("div",{className:"menu-buttons"},this.renderMenuButtons())),n.createElement("ul",{className:a},s.map(this.renderHighlightedButtons,this),s.map(this.renderNonHighlightedButtons,this)),this.renderMoreButton())}renderLockIcon(){return this.props.topicMenu.disabled?n.createElement("i",{className:"fa fa-lock lock-icon"}):null}renderMenuButtons(){const e=[],{FilterOptionsContainer:t,topicMenu:i,loadingFilterCount:s}=this.props;return e.push(n.createElement(t,{key:e.length,topicMenu:i})),e.push(n.createElement("a",{key:e.length,onClick:()=>this.refreshHitCount(),className:"filter-action pull-right "+(s?"loading":"")},n.createElement("i",{className:"fa fa-refresh refresh "+(s?"fa-spin":"")}))),this.props.topicMenu.pinned&&e.push(n.createElement("button",{key:e.length,onClick:()=>this.removePinState(),className:"thumb-tack tw-btn-icon small btn pinned pull-right",type:"button"},n.createElement("i",{className:"fa fa-thumb-tack"}))),e}renderMoreButton(){return this.canShowMore()||this.canShowLess()?n.createElement("div",{className:"more-btn"},this.canShowMore()?n.createElement("span",{onClick:()=>this.showMore()},n.createElement("i",{className:"icon-tw-ellipsis"}),n.createElement("span",{className:"more-btn-text"},this.props.filterConstants.messages.more)):n.createElement("span",{onClick:()=>this.showLess()},n.createElement("i",{className:"icon-tw-ellipsis"}),n.createElement("span",{className:"more-btn-text"},this.props.filterConstants.messages.less))):null}renderHighlightedButtons(e){return this.renderButtons(e,!0)}renderNonHighlightedButtons(e){return this.renderButtons(e,!1)}renderButtons(e,t){const i={},{numberOfOptionsToShow:s,filterConstants:{iconMap:o},lazy:a,topicMenu:l,highlightedEntries:d}=this.props;let u,{children:p=[]}=e;return t?(p=p.filter(e=>h.contains(d,e.mapped_id)),u=h.contains(d,e.mapped_id)):(p=p.filter(e=>!h.contains(d,e.mapped_id)),u=!h.contains(d,e.mapped_id)),(e===r.TopicMenuUtils.getMainNode(l)||r.TopicMenuUtils.isSingleOrMultiple(l))&&(i.overrideSelectionCheck=r.TopicEntryUtils.isSelected,i.noCount=!0,i.clickableStyle=!1),i.iconMap=o,n.createElement("div",{key:e.mapped_id},u?this.renderRow(e,!1,i):null,p.map((e,t)=>{const i=(e.children||[]).length>0||a.enabled&&a.loadOnHover||a.enabled&&r.TopicEntryUtils.isSelected(e);return t>=s?null:this.renderRow(e,i,{iconMap:o,hideName:c.sharedFilterLogic.hasIcon})}))}renderRow(e,t,s={}){if(void 0===this.props.topicMenu||void 0===this.props.topicMenu.type)throw new Error("one or more props or properties or props of vertical filter is undefined");const{hasSubPage:r,topicMenu:a,numberFormatter:l,filterConstants:h}=this.props,u=c.sharedFilterLogic.hasIcon(e,s.iconMap),p=i({side:!0,hoverable:!u,"clearfix inline-element":u,[this.getSidePanelDirection()]:!0});return n.createElement("li",{key:e.mapped_id,className:p},n.createElement(o.TimedHover,{className:"line-block",onClick:t=>this.filterClicked(t,e),duration:150,callback:()=>this.checkLazyLoaded(e)},this.renderRowContent(e,t,s)),t?n.createElement(d.FilterSidePanel,{entry:e,hasSubPage:r,menuType:a.type,side:this.getSidePanelDirection(),size:this.getSidePanelSize(),numberFormatter:l,filterConstants:h,clickCallback:(e,t,i)=>this.filterClicked(e,t,i)}):null)}renderRowContent(e,t,i){const s=`fa fa-caret-${this.getSidePanelDirection()} arrow ${this.getSidePanelDirection()}`,{numberFormatter:r}=this.props;return[...c.sharedFilterLogic.renderFilterButton(e,i),t?n.createElement("i",{key:1,className:s}):null,e.filter_hits?n.createElement("span",{key:2,className:"filter-count"},`(${r(e.filter_hits)})`):null]}checkLazyLoaded(e){const{lazy:t}=this.props;t.enabled&&t.loadOnHover&&(t.cached?void 0===e.children&&s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onLazyLoad,{mappedId:e.mapped_id,menuType:this.props.topicMenu.type}):s.dispatcher.dispatch(a.filterMenuActions.verticalFilters_onLazyLoad,{mappedId:e.mapped_id,menuType:this.props.topicMenu.type}))}}}),define("filters/components/stores/filter_option_store_logic",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("filters/components/stores/filter_option_store",["require","exports","flux","filters/actions/filter_option_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.BaseStore{constructor(e){super([s.FilterOptionMenuActions]),this.filterOptionStoreLogic=e,n.instance=this}static getInstance(){return n.instance}toggleFilterSort(e){this.filterOptionStoreLogic.toggleFilterSort(e,()=>{this.onChange.fire({topicMenuType:e.topicMenu.type,sorting:e.topicMenu.sorting})})}toggleGroupFilter(e){this.filterOptionStoreLogic.toggleGroupFilter(e),this.onChange.fire({topicMenuType:e.topicMenu.type,grouping:e.topicMenu.grouping})}setGroupFilter(e){this.filterOptionStoreLogic.setGroupFilter(e),this.onChange.fire({topicMenuType:e.topicMenu.type,grouping:e.topicMenu.grouping})}toggleFilterPin(e){this.filterOptionStoreLogic.toggleFilterPin(e),this.onChange.fire({topicMenuType:e.topicMenu.type,pinState:e.topicMenu.pinned})}setPinState(e){this.filterOptionStoreLogic.setPinState(e),this.onChange.fire({topicMenuType:e.topicMenu.type,pinState:e.topicMenu.pinned})}onChangeFilterBehaviour(e){this.filterOptionStoreLogic.onChangeFilterBehaviour(e,()=>{this.onChange.fire({topicMenuType:e.menuType,newPageState:!0})})}onInvertSelection(e){this.filterOptionStoreLogic.onInvertSelection(e,()=>{this.onChange.fire({topicMenuType:e.menuType,selectionChange:!0,forceClose:e.forceClose})})}}t.FilterOptionStore=n}),define("filters/components/stores/filter_store_logic",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("filters/components/stores/filter_store",["require","exports","flux","filters/actions/filter_menu_actions","source_actions_menu/actions/source_actions_menu_actions","source_actions_menu/stores/source_actions_menu_store"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.BaseStore{constructor(e){super([s.filterMenuActions,"global_onPageStateReceived",n.SourceActionsMenuActions.sourceActionsMenu_onAddPanel]),this.filterStoreLogic=e,o.instance=this}static getInstance(){return o.instance}onPageStateReceived(e){this.onChange.fire({newPageState:!0})}onFiltersCleared(){this.onChange.fire({newPageState:!0})}onMoreClick(e){this.onChange.fire({numberOfOptionsToShow:e.childrenCount,rowIndex:e.rowIndex})}onRefreshHitCount(e,t){this.filterStoreLogic.onRefreshHitCount(e,()=>{this.onChange.fire({topicMenuType:e.menuType,filterHitCount:!0}),t()}),this.onChange.fire({topicMenuType:e.menuType,filterHitCountLoading:!0})}onLazyLoad(e,t){this.filterStoreLogic.onLazyLoad(e,()=>{this.onChange.fire({topicMenuType:e.menuType,selectionChange:!0}),t()})}onAddPanel(e){this.onChange.fire({topicMenuType:e.menuType,filterAdded:!0})}onFilterClick(e){this.filterStoreLogic.onFilterClick(e,()=>{this.onChange.fire({topicMenuType:e.menuType,selectionChange:!0})}),this.onChange.fire({topicMenuType:e.menuType,selectionChange:!0})}onFiltersChanged(){this.onChange.fire({newPageState:!0})}isPinnable(e){return this.filterStoreLogic.isPinnable(e)}isGroupable(e){return this.filterStoreLogic.isGroupable(e)}getTopicMenuByType(e){return this.filterStoreLogic.getTopicMenuByType(e)}getMenuTransformation(e){return this.filterStoreLogic.getMenuTransformation(e)}hasSubPage(e){return this.filterStoreLogic.hasSubPage(e)}getLazyLoadMode(e){return this.filterStoreLogic.getLazyLoadMode(e)}canInvertSelection(e){return this.filterStoreLogic.canInvertSelection(e)}}__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",void 0)],o.prototype,"onRefreshHitCount",null),__decorate([i.asyncHandler(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",void 0)],o.prototype,"onLazyLoad",null),__decorate([i.waitFor([r.SourceActionsMenuStore]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],o.prototype,"onAddPanel",null),t.FilterStore=o}),define("form/components/action_button_component",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STATUS={IDLE:"idle",LOADING:"loading",DONE:"done",FAILED:"failed"};t.ActionButtonComponent=class extends s.BaseComponent{constructor(e){super(e),this.state={status:t.STATUS.IDLE}}componentWillReceiveProps(e){e.id!==this.props.id&&this.setState({status:t.STATUS.IDLE})}render(){const e=this.getStyle();return n.createElement("span",{className:e.className},n.createElement("button",{type:"button",onClick:this.performAction.bind(this),className:this.getButtonClass()},n.createElement("i",{className:e.icon}),n.createElement("span",null,e.label)))}getButtonClass(){return i({"btn btn-default":!0,unclickable:!this.canPerformAction()})}getStyle(){const{status:e}=this.state,{labels:s}=this.props;switch(e){case t.STATUS.DONE:return{icon:"fa fa-check-circle",label:s.done||"Success",className:i({"add-button action-button":!0,success:!0})};case t.STATUS.FAILED:return{icon:"fa fa-exclamation-circle",label:s.failed||"Error",className:i({"add-button action-button":!0,error:!0})};case t.STATUS.LOADING:return{icon:"fa fa-circle-o-notch fa-spin",label:s.loading||"Loading",className:i({"add-button action-button":!0})};default:case t.STATUS.IDLE:return{icon:this.props.icon,label:s.idle,className:i({"add-button action-button":!0})}}}canPerformAction(){const{status:e}=this.state;return this.props.clickAction&&(e===t.STATUS.FAILED||e===t.STATUS.IDLE)}performAction(e){if(!this.canPerformAction())return;const i=this.props.id;this.setState({status:t.STATUS.LOADING}),this.generateAction(this.props.clickAction,e).then(e=>(this.isUnmounted||this.props.id!==i||this.setState({status:t.STATUS.DONE}),e),e=>(this.isUnmounted||this.props.id!==i||this.setState({status:t.STATUS.FAILED}),e))}generateAction(e,t){const i=e(t);return i&&i.then?i:$.when(i)}}}),define("form/components/access_management_component",["require","exports","underscore","react","classnames","flux","form/components/action_button_component"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AccessManagementComponent=class extends r.BaseComponent{render(){return s.createElement("div",{className:"user-access-management"},this.generateTable())}generateTable(){const{messages:e,objects:t}=this.props;return s.createElement("div",{className:"access-objects"},s.createElement("h4",null,e.title),s.createElement("table",{className:"common-table"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",{className:"col-object"},e.name),s.createElement("th",{className:"col-description"},e.description),s.createElement("th",{className:"col-access"},e.access),s.createElement("th",{className:"col-access-actions"},e.actions))),s.createElement("tbody",{className:"rows"},i.map(t,e=>this.generateTableRow(e)))))}generateTableRow(e){return s.createElement("tr",{className:"access-row",key:"object-row-"+e.name},s.createElement("td",{className:"name"},e.name),s.createElement("td",{className:"description"},e.description),this.generateAccessCell(e.hasAccess),this.generateActionsBlock(e))}generateAccessCell(e){const t=n({fa:!0,"fa-check-circle-o":e,"fa-circle-o":!e});return s.createElement("td",{className:"access"},s.createElement("i",{className:t}))}generateActionsBlock(e){const t=i.filter(this.props.actions,t=>!t.canShow||t.canShow(e));return s.createElement("td",{className:"access-actions"},s.createElement("ul",{className:"list-unstyled"},i.map(t,(t,i)=>s.createElement("li",{className:"action",key:"action"+i},s.createElement(o.ActionButtonComponent,{labels:{idle:t.title,done:t.success_title},icon:t.icon,clickAction:t.action?t.action.bind(this,e):null,id:t.id})))))}}}),define("form/components/css/dual_range_slider_component.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.thumbStyles={appearance:"none",border:"1px solid white",borderRadius:"50%",width:15,height:15,backgroundColor:"#0077a7",cursor:"pointer",pointerEvents:"all"};const s=e=>({position:"absolute",top:"50%",transform:"translateY(-50%)",width:"100%",border:"1px solid #e5e7e9",borderRadius:3,backgroundColor:e,height:10}),n={backgroundColor:"transparent",borderColor:"transparent"};t.dualRangeSliderStyleModel={dualSlider:{position:"relative",width:"100%",height:50},currentLabel:{position:"absolute",top:"calc(50% - 14px)",transform:"translate(-50%, -50%)",color:"#bdc3c7"},minLabel:{position:"absolute",left:0,top:"calc(50% + 14px)",transform:"translateY(-50%)",color:"#bdc3c7"},maxLabel:{position:"absolute",right:0,top:"calc(50% + 14px)",transform:"translateY(-50%)",color:"#bdc3c7"},input:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"100%",backgroundColor:"transparent",zIndex:1,appearance:"none",pointerEvents:"none","&:focus":{outline:"none"},"&::-webkit-slider-thumb":t.thumbStyles,"&::-moz-range-thumb":t.thumbStyles,"&::-ms-thumb":t.thumbStyles,"&::-webkit-slider-runnable-track":n,"&::-moz-range-track":n,"&::-ms-track":n},transparentTrack:{"&::-webkit-slider-runnable-track":n,"&::-moz-range-track":n,"&::-ms-track":n},track:s("#eeeeee"),trackRange:s("#009bda")},t.dualRangeSliderStyle=i.createCssModule(()=>t.dualRangeSliderStyleModel).compute({}).attach().getModule()}),define("form/components/dual_range_slider_component",["require","exports","flux","react","form/components/css/dual_range_slider_component.css","classnames"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DualRangeSliderComponent=class extends i.BaseComponent{constructor(e){super(e),this.state={values:JSON.parse(JSON.stringify(this.props.values))}}render(){return s.createElement("div",{className:n.dualRangeSliderStyle.dualSlider},s.createElement("span",{className:n.dualRangeSliderStyle.minLabel},this.props.min.label),this.renderRangeInput(this.props,0),this.renderRangeInput(this.props,1),s.createElement("span",{className:n.dualRangeSliderStyle.maxLabel},this.props.max.label),s.createElement("div",{className:n.dualRangeSliderStyle.track}),this.renderTrackRange())}renderRangeInput(e,t){const i=this.computeValuePercentage(this.state.values[t].value,e.max.value),o={left:`calc((100% - ${n.thumbStyles.width}px) * ${i} + ${n.thumbStyles.width/2}px)`},a=0===t?1:0,l=Math.min(e.min.value,Math.abs(this.state.values[a].value)),c=Math.max(e.max.value,Math.abs(this.state.values[a].value)),d=[n.dualRangeSliderStyle.input];1===t&&d.push(n.dualRangeSliderStyle.transparentTrack);const h=r(d);return[s.createElement("span",{className:n.dualRangeSliderStyle.currentLabel,style:o},this.state.values[t].label),s.createElement("input",{type:"range",min:l,max:c,value:this.state.values[t].value.toString(),onChange:e=>this.handleOnChange(t,e),className:h})]}renderTrackRange(){const e=this.computeTrackRangeStyles();return s.createElement("div",{className:n.dualRangeSliderStyle.trackRange,style:e})}handleOnChange(e,t){const i=JSON.parse(JSON.stringify(this.state.values)),s=t.nativeEvent.target.value;i[e].label=s,i[e].value=Number(s),this.setState({values:i})}computeCurrentLabelXPosition(e,t){return 100*this.computeValuePercentage(t,e)}computeValuePercentage(e,t){return e/t}computeTrackRangeStyles(){const e=this.computeCurrentLabelXPosition(this.props.max.value,this.state.values[0].value);return{left:e+"%",width:this.computeCurrentLabelXPosition(this.props.max.value,this.state.values[1].value)-e+"%"}}}}),define("form/components/progress_button/progress_button",["require","exports","classnames","flux","react"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.DEFAULT=1]="DEFAULT",e[e.LOADING=2]="LOADING",e[e.ERROR=3]="ERROR"}(r=t.ProgressButtonState||(t.ProgressButtonState={}));t.ProgressButton=class extends s.BaseComponent{constructor(e){super(e),this.state={buttonState:r.DEFAULT}}setState(e,t){this.refs.mainDiv&&super.setState(e,t)}render(){const{isDisabled:e,style:t}=this.props;return n.createElement("div",{ref:"mainDiv",style:t,className:this.generateClassNames(),onClick:e=>this.handleClick(e),"data-disabled":!0===e?e:void 0},this.renderProgressBarFilling(),this.getText())}async handleClick(e){const{onClick:t,isDisabled:i}=this.props;if(i)return;const s=t(e);if(s instanceof Promise){this.setState({buttonState:r.LOADING});try{await s}catch(e){return void this.setState({buttonState:r.ERROR})}this.setState({buttonState:r.DEFAULT})}}getButtonState(){const{forceButtonState:e=r.NONE}=this.props;return e!==r.NONE?e:this.state.buttonState}getText(){const{loadingText:e,icon:t,spinIconWhileLoading:s,progressBar:o,text:a,errorText:l}=this.props,c=this.getButtonState(),d=[];if(t){const e=i({[t]:!0,"fa-spin":s&&c===r.LOADING});d.push(n.createElement("i",{key:0,className:e})),d.push(n.createElement("span",{key:1},""))}return c===r.ERROR?d.push(n.createElement("span",{key:2},l||a)):c===r.LOADING?d.push(n.createElement("span",{key:2},e||a)):d.push(n.createElement("span",{key:3},a)),o?[n.createElement("div",{key:"filling",className:"filling "+o.className},d)]:d}generateClassNames(){const e=this.getButtonState();return i({"progress-button ":!0,[this.props.className]:!0,[this.props.loadingClass]:e===r.LOADING,[this.props.errorClass]:e===r.ERROR})}renderProgressBarFilling(){return this.props.progressBar?n.createElement("div",{style:{transition:"all 1s",width:`${this.props.progressBar.fillRate}%`},className:"before"}):null}}}),define("form/components/range_slider_component",["require","exports","flux","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=20;t.RangeSliderComponent=class extends i.BaseComponent{constructor(e){super(e),this.formatter=e.formatter||(e=>e.toString()),this.state={value:e.value,thumbPosition:0,labelWidth:20},e.updateValueEvent&&this.cancellationToken.subscribe(e.updateValueEvent,e=>{this.preventRerender?e===this.state.value&&(this.preventRerender=!this.preventRerender):this.setState({value:e})})}componentWillReceiveProps(e,t){this.setState({value:e.value}),this.updateThumbPosition(e.value)}componentDidMount(){this.leftLabel&&this.rightLabel&&this.calculateSizes()}render(){return s.createElement("div",{ref:e=>this.rootRef=e,className:this.props.className},s.createElement("div",{className:"range-slider ".concat(this.props.vertical?"vertical-slider":"")},this.props.showLabels&&s.createElement("span",{style:{minWidth:this.state.labelWidth},className:"range-slider-label",ref:e=>this.leftLabel=e},this.props.vertical?this.formatter(this.props.max):this.formatter(this.props.min)),!this.props.vertical&&s.createElement("span",{style:{minWidth:this.state.labelWidth,marginLeft:`-${this.state.labelWidth/2}px`,left:this.state.thumbPosition},className:"range-slider-label-current"},this.formatter(this.state.value)),s.createElement("input",{type:"range",min:this.props.min,max:this.props.max,value:this.state.value.toString(),onChange:e=>{e.persist(),this.onChange(e)},ref:e=>this.rangeInput=e}),this.props.showLabels&&s.createElement("span",{style:{minWidth:this.state.labelWidth},className:"range-slider-label",ref:e=>this.rightLabel=e},this.props.vertical?this.formatter(this.props.min):this.formatter(this.props.max))))}onChange(e){const t=e.target,i=parseFloat(t.value);this.setState({value:i}),this.updateThumbPosition(i),this.preventRerender=!0,this.props.onChange(e)}updateThumbPosition(e){const t=this.props.max-this.props.min,i=(e-this.props.min)*(this.rangeInput.offsetWidth-n)/t+this.rangeInput.offsetLeft+n/2;this.setState({thumbPosition:i})}calculateSizes(){this.setState({labelWidth:Math.max(this.leftLabel.offsetWidth,this.rightLabel.offsetWidth)})}get input(){return this.rangeInput}get root(){return this.rootRef}}}),define("form/components/single_select_component",["require","exports","classnames","flux","react","reusable_utilities","utilities/document_click_tracker_wrapper"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SingleSelectComponent=class extends s.BaseComponent{constructor(e){super(e),this.wasOpenedByFocus=!1,this.state=this.initializeState(this.props)}render(){return n.createElement("div",{ref:"root",style:this.props.style,className:"single-select",tabIndex:0,onFocus:this.handleFocus.bind(this),onBlur:this.handleBlur.bind(this),onKeyDown:this.handleKeyDown.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseLeave:this.handleMouseLeave.bind(this)},n.createElement(o.DocumentClickTrackerWrapper,{clickOutside:this.handleClickOutside.bind(this)},this.generatePlaceholder(),this.generateList()))}generatePlaceholder(){const e=i({"form-control":!0,"invalid-form-element":this.isInvalid(),active:this.isActive(),disabled:this.isDisabled()}),t=i({placeholder:this.shouldShowPlaceholder()});let s;return s=this.shouldShowPlaceholder()?this.getPlaceholder():this.getSelectedValue()?this.getSelectedValue().name:"",n.createElement("div",{className:e,onClick:this.handlePlaceHolderClick.bind(this)},n.createElement("span",{className:t},s),n.createElement("i",{className:"fa fa-angle-down"}))}generateList(){if(this.isActive()){const e=this.getValues().map(e=>{const t=i({active:this.getSelectedValue()&&this.getSelectedValue().mapped_id===e.mapped_id,"solid-breakline":this.hasBreakLine(e)});return n.createElement("li",{className:t,value:e.mapped_id,key:e.mapped_id,onClick:this.handleEntryClick.bind(this,e)},e.name)}),t=this.props.bottomButton;return void 0!==this.props.bottomButton&&e.push(n.createElement("li",{onClick:this.handleBottomButtonClick.bind(this),className:"bottom-btn"},t.name)),n.createElement("ol",{className:"single-select-list"},e)}return null}isInvalid(){return!1}isActive(){return this.state.active}isDisabled(){return this.props.isReadOnly}hasBreakLine(e){return r.TopicEntryUtils.hasBreakLine(e)}initializeState(e){let t=e.model;return void 0===t&&(t={root_entry:{children:[]}}),e.defaultValue&&r.TopicEntryUtils.recursiveUnselectAndSelect(t.root_entry,e.defaultValue),{active:!1,model:t,selectedValue:t.root_entry.children.find(e=>"NODE"===e.selected)||null}}getSelectedValue(){return this.state.selectedValue}getPlaceholder(){return this.props.placeholder}shouldShowPlaceholder(){return!this.getSelectedValue()&&!!this.getPlaceholder()}getRootEntry(){return this.state.model.root_entry}getValues(){if(this.state.model){const e=this.getRootEntry().children;return this.props.allowEmptySelection?[this.createEmptyTopicEntry()].concat(e):e}}createEmptyTopicEntry(){return{mapped_id:"empty",name:""}}handleKeyDown(e){if(e.keyCode===r.Keys.TAB)return this.refs.root.blur(),void this.setState({active:!1});const t=String.fromCharCode(e.keyCode).toUpperCase(),i=this.getRootEntry().children.find(e=>0===e.name.toUpperCase().indexOf(t));i&&(r.TopicEntryUtils.recursiveUnselectAndSelect(this.getRootEntry(),i.mapped_id),this.scrollTo(i))}handleBlur(){this.setState({active:!1})}handleFocus(e){this.isActive()||this.isDisabled()||(this.wasOpenedByFocus=!0,this.setState({active:!0}))}handlePlaceHolderClick(e){this.wasOpenedByFocus?this.wasOpenedByFocus=!1:!this.isActive()&&!this.isDisabled()||(this.refs.root.blur(),this.setState({active:!1,model:this.state.model,selectedValue:this.state.selectedValue}))}handleBottomButtonClick(e){this.props.bottomButton&&this.props.bottomButtonCallback&&this.props.bottomButtonCallback(this.props.bottomButton.params)}handleEntryClick(e,t){this.props.isReadOnly||(r.TopicEntryUtils.recursiveUnselectAndSelect(this.getRootEntry(),e.mapped_id),this.refs.root.blur(),this.setState({active:!1,selectedValue:e}),this.props.selectCallback&&this.props.selectCallback(e),t.stopPropagation())}handleClickOutside(e){this.isActive()&&this.setState({active:!1})}scrollTo(e){if(this.listReference&&e&&e.mapped_id){const t=$(this.listReference),i=t.find('li[value="'+e.mapped_id+'"]'),s=t.scrollTop()+i.position().top;t.scrollTop(s)}}handleMouseEnter(){this.props.openOnHover&&this.setState({active:!0})}handleMouseLeave(){this.props.openOnHover&&this.setState({active:!1})}componentDidUpdate(e){e.model.root_entry.mapped_id!==this.props.model.root_entry.mapped_id&&this.setState(this.initializeState(this.props))}}}),define("form/components/state_button/state_button_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHECKED="CHECKED",e.INDETERMINATE="INDETERMINATE",e.UNCHECKED="UNCHECKED"}(t.StateButtonState||(t.StateButtonState={}))}),define("form/components/state_button/state_button_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHECKBOX="checkbox",e.RADIO_BUTTON="radio"}(t.StateButtonType||(t.StateButtonType={}))}),define("form/components/state_button/state_button_component_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("form/components/state_button/state_button_component",["require","exports","classnames","event_bus","flux","react","form/components/state_button/state_button_state","form/components/state_button/state_button_type"],function(e,t,i,s,n,r,o,a){"use strict";var l,c,d,h,u,p;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CONTAINER="state-button-container-default",e.INPUT="state-button-input-default",e.LABEL="state-button-label-default"}(l||(l={})),function(e){e.INPUT="state-button-input-error",e.LABEL="state-button-label-error"}(c||(c={})),function(e){e.CHECKED="state-button-disabled-checked",e.INDETERMINATE="state-button-disabled-indeterminate",e.UNCHECKED="state-button-disabled-unchecked"}(d||(d={})),function(e){e.CHECKED="state-button-checked",e.INDETERMINATE="state-button-indeterminate",e.UNCHECKED="state-button-unchecked"}(h||(h={})),function(e){e.CHECKED="icon2-tw-checked-checkbox",e.INDETERMINATE="icon2-tw-indeterminate-checkbox",e.UNCHECKED="icon2-tw-unchecked-checkbox"}(u||(u={})),function(e){e.CHECKED="icon2-tw-checked-radio-button",e.UNCHECKED="icon2-tw-unchecked-radio-button"}(p||(p={}));t.StateButtonComponent=class extends n.BaseComponent{render(){const{label:e}=this.props.model,{valid:t}=this.props;return this.valid=void 0===t||t,this.tooltipEvent&&this.openTooltip(this.tooltipEvent,this.generateTooltipMessage()),r.createElement("div",{className:this.getContainerClassName(),onClick:this.handleStateButtonClick.bind(this),onMouseEnter:e=>{this.handleMouseEnter(e)},onMouseLeave:()=>{this.handleMouseLeave()}},r.createElement("i",{className:this.getStateButtonClassName()}),r.createElement("label",{className:this.getLabelClassName()},e,this.generateErrorMessage()))}handleStateButtonClick(e){const{toggleCallback:t,disabled:i,model:{owner:s}}=this.props;e.preventDefault(),this.shouldStopPropagation()&&e.stopPropagation(),i||(this.closeTooltip(),void 0!==t&&t(e,s))}shouldStopPropagation(){const{stopPropagation:e}=this.props;return void 0===e||void 0!==e&&e}openTooltip(e,t){void 0===t||this.props.disabled||s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"top"}})}closeTooltip(){this.props.disabled||s.eventBus.dispatch({type:s.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}handleMouseEnter(e){void 0===this.tooltipEvent&&(e.persist(),this.tooltipEvent=e),this.openTooltip(e,this.generateTooltipMessage())}handleMouseLeave(){this.tooltipEvent=void 0,this.closeTooltip()}getContainerClassName(){const{customClasses:e}=this.props;return this.props.showContainer?`${e&&void 0!==e.container?e.container:l.CONTAINER} ${this.getClickableClass()}`:this.getClickableClass()}getStateButtonClassName(){const{disabled:e}=this.props;return i({[this.getStateButtonStateClass()]:!0,[this.getInputClass()]:!0,[this.getInputErrorClass()]:!this.valid,[this.getDisabledClass()]:e,[this.getClickableClass()]:!e,[this.getIcon()]:!0})}getStateButtonStateClass(){switch(this.props.model.stateButtonState){case o.StateButtonState.CHECKED:return h.CHECKED;case o.StateButtonState.INDETERMINATE:return h.INDETERMINATE;case o.StateButtonState.UNCHECKED:return h.UNCHECKED;default:throw new Error("no state button state")}}getInputClass(){const{customClasses:e}=this.props;return void 0!==e&&void 0!==e.input?e.input:l.INPUT}getInputErrorClass(){return c.INPUT}getDisabledClass(){switch(this.props.model.stateButtonState){case o.StateButtonState.CHECKED:return d.CHECKED;case o.StateButtonState.INDETERMINATE:return d.INDETERMINATE;case o.StateButtonState.UNCHECKED:return d.UNCHECKED;default:throw new Error("no state button state")}}getLabelClassName(){const{customClasses:e}=this.props;return`${void 0!==e&&void 0!==e.label?e.label:l.LABEL} ${this.getClickableClass()}`}generateErrorMessage(){const{errorMessage:e}=this.props;return this.shouldDisplayErrorMessage()?r.createElement("span",{className:c.LABEL},e):void 0}generateTooltipMessage(){const{errorMessage:e}=this.props,{tooltipMessage:t}=this.props.model;let i="";return void 0!==t&&(i+=t),void 0!==t&&this.shouldDisplayErrorMessage()&&(i+="\n"),this.shouldDisplayErrorMessage()&&(i+=e),""!==i?i:void 0}shouldDisplayErrorMessage(){return!this.valid&&void 0!==this.props.errorMessage}getClickableClass(){return this.props.disabled?"":"clickable"}getIcon(){switch(this.props.type){case a.StateButtonType.CHECKBOX:return this.getCheckboxIcon();case a.StateButtonType.RADIO_BUTTON:return this.getRadioButtonIcon()}}getCheckboxIcon(){switch(this.props.model.stateButtonState){case o.StateButtonState.CHECKED:return u.CHECKED;case o.StateButtonState.INDETERMINATE:return u.INDETERMINATE;case o.StateButtonState.UNCHECKED:return u.UNCHECKED;default:throw new Error("no checkbox state")}}getRadioButtonIcon(){switch(this.props.model.stateButtonState){case o.StateButtonState.CHECKED:return p.CHECKED;case o.StateButtonState.INDETERMINATE:throw new Error("Trying to access indeterminate state of radio button which does not exist");case o.StateButtonState.UNCHECKED:return p.UNCHECKED;default:throw new Error("no checkbox state")}}componentWillUnmount(){this.closeTooltip()}}}),define("generic/components/crop_component/crop_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/crop_component/crop_component_renderable",["require","exports","croppie","flux","react","event_bus"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=400,a=400;t.CropComponentRenderable=class extends s.BaseComponent{constructor(e){super(e),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.CROP_IMAGE,this.cropImage.bind(this))}render(){return n.createElement("div",{style:this.generateContainerStyle(),ref:e=>this.initializeCroppie(e)},n.createElement("div",{style:this.generateLoadingPlaceholderStyle()},n.createElement("i",{className:"fa fa-refresh fa-spin"})))}async initializeCroppie(e){if(e){const{imageUrl:t,croppingAreaDimensions:s={width:o,height:a},cropCircle:n}=this.props,r=await t;this.croppie=new i.Croppie(e,{boundary:s,viewport:{width:100,height:100,type:n?"circle":"square"}}),await this.croppie.bind({url:r})}}async cropImage(e){const{containerId:t}=this.props;if(t===e.value)try{r.eventBus.dispatch({type:r.EVENT_TYPES.IMAGE_WAS_CROPPED,value:{containerId:t,imageUrl:await this.croppie.result({type:"base64",size:"original",circle:this.props.cropCircle})}})}catch(e){}}generateContainerStyle(){const{croppingAreaDimensions:e={width:o,height:a}}=this.props;return{minWidth:e.width+60,minHeight:e.height+54}}generateLoadingPlaceholderStyle(){return{position:"absolute",fontSize:"4em",color:this.props.placeholderColor,top:"42%",left:"50%",transform:"translate(-50%, -50%)"}}componentWillUnmount(){this.croppie&&this.croppie.destroy()}}}),define("generic/components/image_component/image_component_renderable_props",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/image_component/image_component_renderable",["require","exports","react","generic/components/icon_component/icon_component_renderable"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageComponentRenderable=class extends s.IconComponentRenderable{generateValue(){return i.createElement("div",{className:"image",style:{backgroundImage:`url("${this.props.image}")`,borderRadius:`${this.props.rounded?"100%":0}`}})}}}),define("generic/components/models/breakdown_group",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/article_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/matching_list",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/influencer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/block_influencers_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/influencer_additional_information",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_influencers/ratios",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_issues/issue",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_issues/block_issues_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/block_issues/issue_options_menu",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/cloud_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/margin",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/marking_tags",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/components/models/score",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic/dropdownButton/dropdown_button",["require","exports","flux","react","reusable_utilities","dropdown_menu/dropdown_menu_container","utilities/document_click_tracker_wrapper"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DropdownButton=class extends i.BaseComponent{constructor(e){super(e),this.state={menuOpen:!1}}render(){const{topicMenu:e,buttonClass:t,alignRight:i,topicMenu:{root_entry:a}}=this.props,{menuOpen:l}=this.state;let c=null;if(l&&void 0!==a.children&&a.children.length>0){const t=n.TopicMenuUtils.getMainNode(e),l=this.getOptions(t),d=a.children;c=s.createElement(o.DocumentClickTrackerWrapper,{clickOutside:()=>this.setMenuState(!1)},s.createElement(r.DropdownMenuContainer,{forceShow:!0,entries:d,isSubMenu:!1,options:l,alignRight:i,onMouseEnter:()=>this.cancelExit(),onClick:(e,t,i)=>this.onEntryClicked(e,t,i)}))}return s.createElement("div",{className:"buttonReact",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.exitZone.bind(this),onClick:e=>this.props.onClick(e,a)},s.createElement("i",{className:t}),c)}cancelExit(){this.exitHandle&&(clearTimeout(this.exitHandle),this.exitHandle=0)}onMouseOver(){this.setMenuState(!0),this.cancelExit()}exitZone(){this.exitHandle||(this.exitHandle=setTimeout(()=>{this.exitHandle=0,this.setMenuState(!1)},200))}getOptions(e){return{oneLevel:{buttonOptions:{noCount:t=>t.mapped_id===e.mapped_id,overrideSelectionCheck:t=>t.mapped_id===e.mapped_id?n.TopicEntryUtils.isSelected(t):n.TopicEntryUtils.isSelectedOrHoldsSelection(t)}},recursive:{onMouseLeave:this.exitZone.bind(this)}}}onEntryClicked(e,t,i){this.props.onClick(e,t),this.setMenuState(!1)}setMenuState(e){this.setState({menuOpen:e})}}}),define("generic/progress_bar/progress_bar",["require","exports","react","graphics_utilities","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=35,o=1250;t.ProgressBar=class extends i.Component{constructor(e,t){super(e,t),this.state={isIdle:e.fillRate<0,animationProgress:0}}componentDidUpdate(e,t,i){const s=this.props.fillRate<0;this.state.isIdle!==s&&(this.setState({isIdle:s}),s?this.startAnimation():this.stopAnimation())}componentDidMount(){this.state.isIdle&&this.startAnimation()}componentWillUnmount(){this.stopAnimation()}getProgressMargin(e){return Math.round(e*(100+r)-r)}render(){const{fillRate:e,showPercentage:t=!1,className:s="",style:n}=this.props,{isIdle:o,animationProgress:a}=this.state;return i.createElement("div",{style:n,className:"progress "+s},o?i.createElement("div",{className:"progress-bar progress-bar-striped active",style:{width:`${r}%`,marginLeft:`${this.getProgressMargin(a)}%`}}):i.createElement("div",{className:"progress-bar progress-bar-striped active",style:{width:`${100*e}%`}},t?Math.floor(100*e)+"%":""))}async startAnimation(){this.stopAnimation(),this.animationCancellationToken=new n.CancellationToken,await s.animate(e=>{this.setState({animationProgress:e})},o,this.animationCancellationToken),this.animationCancellationToken.isCanceled()||this.startAnimation()}stopAnimation(){this.animationCancellationToken&&this.animationCancellationToken.cancel()}}}),define("generic_menu/components/interfaces/topic_menu_select_renderable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic_menu/components/interfaces/topic_menu_select_strategy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("generic_menu/components/renderables/providers/icon_left_style.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={main:{display:"inline-block"},container:{borderRadius:"3px",display:"inline-flex",overflow:"hidden"},iconContainer:{padding:"0.33em 0.75em"},textContainer:{padding:"0.33em 1em",border:"1px solid",borderRadius:"0 5px 5px 0",borderLeft:"none",fontSize:"12px"},text:{top:"50%",position:"relative",display:"block",transform:"translateY(-50%)"}};t.iconLeftStyle=i.createCssModule(()=>s).compute({}).attach().getModule()}),define("generic_menu/components/renderables/providers/icon_left_topic_menu_select_renderable",["require","exports","classnames","react","generic_menu/components/renderables/providers/icon_left_style.css"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconLeftTopicMenuSelectRenderable=class{constructor(e){this.style=this.buildStyle(e)}render(e,t){const r=i({[n.iconLeftStyle.main]:!0}),o=i({[n.iconLeftStyle.container]:!0});return s.createElement("div",{className:r,onClick:e.clickAnywhere},s.createElement("div",{className:o},s.createElement("div",{className:n.iconLeftStyle.iconContainer,style:{backgroundColor:this.style.iconBackgroundColor,color:this.style.iconColor}},s.createElement("i",{className:this.style.iconClass,onClick:e.clickArrow})),s.createElement("div",{className:n.iconLeftStyle.textContainer,style:{backgroundColor:this.style.textBackgroundColor,color:this.style.textColor,borderColor:this.style.iconBackgroundColor}},s.createElement("span",{className:n.iconLeftStyle.text},t))))}buildStyle(e){const{icon:t,text:i}=e;return{iconClass:`fa ${t.class} clickable`,iconBackgroundColor:t.backgroundColor,iconColor:t.color,textBackgroundColor:i.backgroundColor,textColor:i.color}}}}),define("generic_menu/components/renderables/topic_menu_select",["require","exports","event_bus","flux","react","reusable_utilities","underscore","filters/components/utilities/shared_filter_logic","utilities/icon","classnames"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuSelect=class extends s.BaseComponent{constructor(e){super(e),this.clickUsed=!1,this.validateProps(e),this.state={menuOpen:!1,savedTitle:this.getSelectionText(!0)}}validateProps(e){if(!e.styleModel&&!e.renderable)throw new Error("TopicMenuSelect needs either a styleModel or a renderable!")}getLabel(e){let{title:t,topicMenu:{root_entry:{name:i}}}=e;return void 0===t&&(t=i),t}render(){const e=c({"widget-topic-menu-select react-topic-menu-select":!0,open:this.state.menuOpen,disabled:this.props.menuStrategy.isActionsDisabled()});return n.createElement("div",{ref:"root",className:e},this.renderContent(this.props.styleModel,this.getLabel(this.props)))}componentWillUnmount(){super.componentWillUnmount(),this.cancelMouseLeaveToken()}onClick(){this.props.menuStrategy.isActionsDisabled()||(this.state.menuOpen&&!this.clickUsed?this.clickUsed=!0:(this.clickUsed=!this.state.menuOpen,this.setMenuState(!this.state.menuOpen)))}onMouseEnter(){this.props.menuStrategy.isActionsDisabled()?this.setState({menuDisabled:!0}):(this.cancelMouseLeaveToken(),this.setMenuState(!0),this.setState({menuDisabled:!1}))}onMouseLeave(){!this.props.menuStrategy.isActionsDisabled()&&this.canUseMouseEnterOrLeave()&&(this.cancelMouseLeaveToken(),this.mouseLeaveToken=new r.CancellationToken,this.mouseLeaveToken.setTimeout(()=>{this.cancelMouseLeaveToken(),this.setMenuState(!1)},500))}cancelMouseLeaveToken(){void 0!==this.mouseLeaveToken&&(this.mouseLeaveToken.cancel(),this.mouseLeaveToken=void 0)}renderContent(e={},t){const{renderable:i}=this.props,{clickLocation:s=r.ClickLocation.ANYWHERE}=e,n=this.getClickHandlers(s);return i?i.render(n,t):this.renderDefaultContent(e,n,t)}renderDefaultContent(e,t,i){const{mainClass:s="",containerClass:r="",selectionClass:o="",iconClass:a="fa fa-caret-down"}=e,{clickAnywhere:c,clickArrow:d}=t,h=this.buildOptionalAttributes();return n.createElement("div",Object.assign({className:s,onClick:c},h),void 0!==i&&i.length>0?n.createElement("label",null,i):null,n.createElement("div",{className:r},this.hasIcon()?n.createElement(l.Icon,{model:this.getIcon()}):null,n.createElement("span",{title:this.getSelectionText(),className:o+" selection-text"},this.getSelectionText()),n.createElement("i",{className:a,onClick:d})))}buildOptionalAttributes(){const e={};return this.canUseMouseEnterOrLeave()&&(e.onMouseEnter=this.onMouseEnter.bind(this),e.onMouseLeave=this.onMouseLeave.bind(this)),e}getClickHandlers(e){let t=o.noop,i=o.noop;switch(e){case r.ClickLocation.ANYWHERE:t=this.onClick.bind(this);break;case r.ClickLocation.ARROW:i=this.onClick.bind(this);break;default:throw new Error(`unexpected clickLocation ${e}`)}return{clickAnywhere:t,clickArrow:i}}getSelectionText(e=!1){const{concatSelectionLabel:t,updateSelectionLabelOnClose:i}=this.props;return!e&&i?this.state.savedTitle:t?this.getAllSelectedEntries().map(e=>e.name).join(" "):(this.getSelectedEntry()||{name:""}).name}getAllSelectedEntries(){return a.sharedFilterLogic.getAllSelectedEntries(this.props.topicMenu.root_entry)}getSelectedEntry(){return a.sharedFilterLogic.getFirstSelectedEntry(this.props.topicMenu.root_entry)}hasIcon(){return!1}getIcon(){return this.props.iconMap[this.getSelectedEntry().mapped_id]}onEntryClicked(e,t,s){const{allowMultiSelection:n}=this.props;e.stopPropagation(),this.props.menuStrategy.onSelect(e,t,s).then(e=>{i.eventBus.dispatch({type:i.EVENT_TYPES.UPDATE_TOPIC_MENU_SELECT_DROPDOWN,value:e})},()=>void 0),n||this.setMenuState(!1)}setMenuState(e){setTimeout(()=>{this.state.menuOpen&&!e?(this.closeDropdown(),void 0!==this.props.menuStrategy.onClose&&this.props.menuStrategy.onClose()):!this.state.menuOpen&&e&&this.openDropdown(),this.setState({menuOpen:e,savedTitle:this.getSelectionText(!0)})})}openDropdown(){i.eventBus.dispatch({type:i.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"topic_menu_select_dropdown",targetElement:this.refs.root,config:{timeout:{delay:0}},type:"topic_menu_select_dropdown",payload:this.buildDropdownPayload(),placement:"bottom"}})}closeDropdown(){i.eventBus.dispatch({type:i.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"topic_menu_select_dropdown"}})}buildDropdownPayload(){const{concatAllNode:e,topicMenu:t,dropdownClassName:i}=this.props;return{menu:t,concatAllNode:e,options:this.buildDropdownOptions(),close:e=>{const t=$(this.refs.root),i=$(e.target);t.is(i)||0!==t.has(i[0]).length||(this.clickUsed=!1,this.setMenuState(!1))},onEntryClicked:this.onEntryClicked.bind(this),onMouseEnter:this.canUseMouseEnterOrLeave()?e=>this.cancelMouseLeaveToken():void 0,className:i}}buildDropdownOptions(){const{topicMenu:e}=this.props,t=r.TopicMenuUtils.getMainNode(e);return{oneLevel:{buttonOptions:{noCount:e=>e.mapped_id===t.mapped_id,overrideSelectionCheck:e=>e.mapped_id===t.mapped_id?r.TopicEntryUtils.isSelected(e):r.TopicEntryUtils.isSelectedOrHoldsSelection(e)}},recursive:{buttonOptions:{showChildrenIndicator:e=>e.mapped_id!==t.mapped_id&&r.TopicEntryUtils.hasChildren(e),timedHoverOptions:{duration:50,onMouseEnter:async e=>{const t=await this.props.menuStrategy.onMouseEnter(e);i.eventBus.dispatch({type:i.EVENT_TYPES.UPDATE_DROPDOWN_MENU_ENTRY,value:t})},onMouseLeave:o.noop},iconMap:this.props.iconMap},onMouseLeave:this.canUseMouseEnterOrLeave()?e=>this.onMouseLeave():void 0}}}canUseMouseEnterOrLeave(){return!0===this.props.openOnHover&&!this.clickUsed}}}),define("generic_menu/actions/topic_menu_select_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.topicMenuSelectActions={topicMenuSelect_onClick:"topicMenuSelect_onClick",topicMenuSelect_onMouseOver:"topicMenuSelect_onMouseOver"}}),define("generic_menu/components/stores/topic_menu_select_store",["require","exports","flux","generic_menu/actions/topic_menu_select_actions","filters/components/stores/filter_store","filters/actions/filter_menu_actions"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends i.BaseStore{constructor(e){super([s.topicMenuSelectActions,r.filterMenuActions.verticalFilters_onFilterClick,"global_onPageStateReceived",r.filterMenuActions.verticalFilters_onFiltersCleared]),o.instance=this,this.topicMenuSelectStoreLogic=e}static getInstance(){return o.instance}verticalFiltersOnFilterClick(e){this.onChange.fire({topicMenu:this.topicMenuSelectStoreLogic.getTopicMenu(e.menuType)})}onFiltersCleared(){this.onChange.fire({newPageState:!0})}onPageStateReceived(e){this.onChange.fire({newPageState:!0})}}__decorate([i.waitFor([n.FilterStore]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],o.prototype,"verticalFiltersOnFilterClick",null),t.TopicMenuSelectStore=o}),define("hyperlink_with_icon/src/hyperlink_with_icon_container",["require","exports","flux","react","log"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.BaseComponent{constructor(e){super(e)}render(){const{containerClass:e,hyperlinkWrapperClass:t,hyperlinkIconWrapperClass:i,hyperlinkIconClass:n,hyperlinkLabel:r,hyperlinkLabelClass:o,hyperlinkClickHandler:a}=this.props;return a||this.printWarning(),s.createElement("span",{className:e},s.createElement("span",{className:t},s.createElement("a",{href:"javascript:void(0)",onClick:a?e=>a(e):()=>this.printWarning()},s.createElement("span",{className:i},s.createElement("i",{className:n})),s.createElement("span",{className:o},r))))}printWarning(){n.logService.warn("No click handler reached into HyperlinkWithIconContainer component! Clicks will be ignored!")}}r.defaultProps={containerClass:"right",hyperlinkWrapperClass:"option",hyperlinkIconWrapperClass:"plus-icon-wrapper",hyperlinkIconClass:"icon-tw-plus-sign",hyperlinkLabelClass:"hyper-link-label",hyperlinkLabel:""},t.HyperlinkWithIconContainer=r}),define("icons/classes/icon_utils",["require","exports","icons/models/page_icon_model","talkwalker_constants","icons/classes/icon_maps"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconUtils=class{static getDefaultPageIconModels(e=!1,t="Aa"){const r=[];return e&&(r.push({type:s.PageIcon.CUSTOM,customIconData:{type:i.CustomPageIconType.FIGURE}}),r.push({type:s.PageIcon.CUSTOM,customIconData:{type:i.CustomPageIconType.FROM_TITLE}}),r.push({type:s.PageIcon.CUSTOM,customIconData:{type:i.CustomPageIconType.CUSTOM_LETTERS,content:t}})),Object.keys(s.PageIcon).forEach(e=>{n.IconMaps.pageIconMap.get(e)&&r.push({type:e})}),r}}}),define("image_selector_list/css/image_selector_list.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageSelectorListStyleModel={imageSelectorList:{overflowY:"auto"},category:{display:"flex",flexWrap:"wrap",flex:"initial",marginBottom:10},container:{display:"flex",flexDirection:"row",padding:0,flexWrap:"wrap",width:"100%"},entry:{display:"flex",flexDirection:"column",alignItems:"center",width:125,marginRight:5,marginLeft:5},entryImageWrapper:{display:"flex",flexDirection:"column",alignItems:"center",border:"1px solid lightgray","&:not(.selected)":{width:130,marginTop:3,marginBottom:3},"&.selected":{borderColor:"lightgray",borderWidth:4,width:133}},entryImage:{maxWidth:125,maxHeight:100},entryName:{textAlign:"center"}},t.imageSelectorListStyle=i.createCssModule(()=>t.imageSelectorListStyleModel).compute({}).attach().getModule()}),define("image_selector_list/interfaces/list_item_clicked_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("image_selector_list/components/image_selector_list",["require","exports","flux","react","image_selector_list/css/image_selector_list.css","classnames","event_bus","reusable_utilities"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageSelectorListRenderable=class extends i.BaseComponent{render(){const e=r(["image-selector-list",n.imageSelectorListStyle.imageSelectorList,"stylized-scrollbar",n.imageSelectorListStyle.category]);return s.createElement("div",{className:e},this.renderList())}renderList(){return this.props.menu.root_entry.children.map(e=>a.TopicEntryUtils.hasChildren(e)?this.renderCategory(e):this.renderLeaf(e))}renderCategory(e){const t=r([n.imageSelectorListStyle.category]);return s.createElement("div",{key:e.mapped_id,className:t},s.createElement("label",null,e.name),s.createElement("div",{className:n.imageSelectorListStyle.container},this.renderChildren(e)))}renderChildren(e){return e.children.map(e=>this.renderLeaf(e))}renderLeaf(e){const t=r({[n.imageSelectorListStyle.entryImageWrapper]:!0,selected:"NODE"===e.selected});return s.createElement("div",{key:e.mapped_id,onClick:t=>this.handleClick(e),className:n.imageSelectorListStyle.entry},s.createElement("div",{className:t},s.createElement("img",{src:e.additional_info,className:n.imageSelectorListStyle.entryImage})),s.createElement("span",{className:n.imageSelectorListStyle.entryName},e.name))}handleClick(e){const t={menu:this.props.menu,entry:e};o.eventBus.dispatch({type:o.EVENT_TYPES.IMAGE_SELECTOR_LIST_ITEM_CLICKED,value:t})}}}),define("image_selector_list/interfaces/list_update_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("image_selector_list/image_selector_list_container",["require","exports","flux","react","image_selector_list/components/image_selector_list","event_bus","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageSelectorListContainer=class extends i.BaseComponent{constructor(e){super(e),this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.IMAGE_SELECTOR_LIST_ITEM_CLICKED,this.handleImageSelectorListItemClicked.bind(this))}componentDidMount(){this.cancellationToken.subscribeToStream(r.eventBus,r.EVENT_TYPES.IMAGE_SELECTOR_LIST_UPDATE,this.handleImageSelectorListUpdate.bind(this))}render(){return s.createElement(n.ImageSelectorListRenderable,{menu:this.props.menu})}handleImageSelectorListItemClicked(e){const t=e.value;this.props.menu.type===t.menu.type&&(o.TopicEntryUtils.recursiveUnselectAndSelect(this.props.menu.root_entry,t.entry.mapped_id),r.eventBus.dispatch({type:r.EVENT_TYPES.IMAGE_SELECTOR_LIST_ITEM_SELECTED,value:e}),this.forceUpdate())}handleImageSelectorListUpdate(e){const t=e.value;this.props.menu.type===t.menu.type&&this.forceUpdate()}}}),define("inline_tags_suggestion/allowed_tag_char_regex",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ALLOWED_TAG_CHAR_REGEX="[^\\\\/`']"}),define("inline_tags_suggestion/inline_tags_suggestion",["require","exports","flux","react","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InlineTagsSuggestion=class extends i.BaseComponent{constructor(e){super(e),this.state={input:"",suggestions:[]}}componentWillReceiveProps(e){if(!n.isEqual(e,this.props)){const e=this.element&&$(this.element);e&&e.val()!==this.state.input&&this.updateValue(e.val())}}handleKeyDown(e){const t=$(e.target);t.val()&&n.contains([13,188],e.keyCode)&&(e.preventDefault(),this.props.addCallback&&$(this.element).is(":valid")&&this.props.addCallback(e,t.val())),n.contains([27],e.keyCode)||e.stopPropagation()}handleFocus(e){setTimeout(()=>{$(this.element).inlineCompleter({source:this.getSuggestedTagAliases.bind(this),updateValue:this.updateValue.bind(this)})})}getSuggestedTagAliases(e){return n.chain(this.props.tags).filter(t=>t.name.indexOf(e)>=0).map(t=>t.name.substring(t.name.indexOf(e),t.name.length)).value()}updateValue(e){this.setState({input:e,suggestions:this.getSuggestions(e)})}getSuggestions(e){return e?n.chain(this.props.tags).filter(t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>=0).value():[]}render(){const e=n.omit(this.props,["addCallback","selectSuggestionCallback","keydown","focus","tags"]);return s.createElement("div",Object.assign({},e,{ref:e=>{this.setElement(e)},onKeyDown:this.handleKeyDown.bind(this),onFocus:this.handleFocus.bind(this)}),this.props.children,this.generateSuggestionsBlock())}generateSuggestionsBlock(){return this.state.suggestions&&this.state.suggestions.length>0?s.createElement("div",{className:"inline-suggestions"},s.createElement("ul",{className:"labels list-inline"},this.state.suggestions.map((e,t)=>s.createElement("li",{key:e.code+t,title:e.name},s.createElement("span",{className:"label label-elipsis label-secondary clickable",onClick:this.selectSuggestion.bind(this,e)},e.name))))):null}selectSuggestion(e,t){this.props.selectSuggestionCallback&&this.props.selectSuggestionCallback(t,e)}setElement(e){null!==e&&(this.element=e.children[0])}}}),define("inline_tags_suggestion/max_tag_with_group_length",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_TAG_WITH_GROUP_LENGTH=64}),define("inline_tags_suggestion/tag_or_tag_group_regex",["require","exports","inline_tags_suggestion/allowed_tag_char_regex"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagOrTagGroupRegex=`^(${i.ALLOWED_TAG_CHAR_REGEX}+)$`}),define("inline_tags_suggestion/tag_with_optional_group_regex",["require","exports","inline_tags_suggestion/allowed_tag_char_regex"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagWithOptionalGroupRegex=`((${i.ALLOWED_TAG_CHAR_REGEX}+/{0,1}){0,1}${i.ALLOWED_TAG_CHAR_REGEX}+)`}),define("item_grid_selection_dropdown/src/item_grid_selection_dropdown_style_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("item_grid_selection_dropdown/src/item_grid_selection_dropdown_style.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_MARGIN=2,t.DEFAULT_THEME={backgroundColor:"#FFFFFF",borderColor:"#bdc3c7",activeBorderColor:"#0089c0"},t.itemGridSelectionDropdownStyleModelFactory=function(e){return{container:{position:"relative"},element:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"space-between",padding:2,backgroundColor:(e=Object.assign({},t.DEFAULT_THEME,e)).backgroundColor,zIndex:1,border:`1px solid ${e.borderColor}`,"&.active":{borderColor:e.activeBorderColor,borderBottomWidth:0,paddingBottom:3,zIndex:20},"& > *":{margin:"0 2px"}},itemGrid:{boxSizing:"content-box",position:"absolute",display:"flex",flexWrap:"wrap",padding:5,marginTop:-1,backgroundColor:e.backgroundColor,zIndex:10,border:`1px solid ${e.activeBorderColor}`,"& > *":{margin:t.ITEM_MARGIN}}}}}),define("item_grid_selection_dropdown/src/item_grid_selection_dropdown",["require","exports","react","flux","classnames","item_grid_selection_dropdown/src/item_grid_selection_dropdown_style.css"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ItemGridSelectionDropdown=class extends s.StyledBaseComponent{constructor(e){super(e,r.itemGridSelectionDropdownStyleModelFactory),this.maxItemWidth=0;let t=e.items.find(e=>e.selected);t||((t=e.items[0]).selected=!0),this.state={open:!1,selectedItem:t,dropdownWidth:0}}render(){const e={};return this.state.dropdownWidth&&(e.width=this.state.dropdownWidth),i.createElement("div",{className:this.style.container,onMouseLeave:()=>this.setState({open:!1})},i.createElement("div",{className:n(this.style.element,{active:this.state.open}),onClick:()=>this.setState({open:!this.state.open})},this.state.selectedItem.element,i.createElement("i",{className:"fa fa-caret-down"})),this.state.open?i.createElement("div",{className:this.style.itemGrid,style:e},this.props.items.map(this.renderItem.bind(this))):null)}componentDidUpdate(e,t,i){let s=this.props.items.find(e=>e.selected);s||((s=this.props.items[0]).selected=!0),s!==this.state.selectedItem&&this.setState({selectedItem:s})}renderItem(e,t){return i.createElement("div",{key:`item_${t}`,onClick:()=>this.selectItem(e),ref:e=>{this.props.columns&&e&&e.offsetWidth>this.maxItemWidth&&(this.maxItemWidth=e.offsetWidth,this.setState({dropdownWidth:(this.maxItemWidth+2*r.ITEM_MARGIN)*this.props.columns}))}},e.element)}selectItem(e){this.props.items.forEach(e=>{e.selected=!1}),e.selected=!0,this.setState({open:!1,selectedItem:e}),this.props.onItemChange&&this.props.onItemChange(e)}}}),define("item_pool/strategies/item_pool_strategy",["require","exports","reusable_utilities","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ItemPoolStrategy=class{enhanceInitialItemList(e){return e}calculateNextRenderTime(e){const t=e.pool?e.pool.length:0,s=Math.max(0,e.nextItemArrival-Date.now());if(t>0){const e=s/t;return Math.max(this.minRenderDelay,Math.floor(e*i.MathUtils.getRandomRange(.85,1.33)))}return 0===s?0:this.defaultRenderDelay}handleOldItemDiscard(e){const{items:t,pool:i}=e;if(0===i.length)return;const s=i.slice(-this.maxItems);if(s.length<this.maxItems){const e=this.maxItems-i.length;t.slice(-e).forEach(e=>this.addItemToPool(e,s))}t.length=0,i.length=0,s.forEach(e=>t.push(e))}getMaxItems(){return this.maxItems}getTimeFrame(){return this.timeframe}setTimeframe(e){this.timeframe=e}setNextRenderTime(e){this.nextRenderTime=e}getNextRenderTime(){return this.nextRenderTime}getItemsToAdd(){return 1}isItemInListOrPool(e,t,i){const n=-1!==s.findIndex(t,t=>t.key===e.key),r=-1!==s.findIndex(i,t=>t.key===e.key);return n||r}getRenderedItems(e,t,i){return e.items.map((e,s)=>t(e,s,i))}}}),define("item_pool/item_pool_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemPoolFeature={name:"ITEM_POOL",style:"color: yellow; background-color: #222;"}}),define("item_pool/item_pool_container",["require","exports","event_bus","flux","log","underscore","item_pool/item_pool_interfaces"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a="timeout";t.ItemPoolContainer=class extends s.BaseComponent{constructor(e){super(e),this.state={items:e.strategy.enhanceInitialItemList(e.items),nextItemArrival:Date.now()+e.strategy.getTimeFrame(),pool:[]},this.setupEvents()}componentWillReceiveProps(e){if(!r.isEqual(e,this.props)&&(n.logService.debug("Received new props or configuration",o.ItemPoolFeature,{oldProps:this.props,props:e,currentState:this.state}),this.state.items&&this.state.items.length>0)){const t=this.props.strategy.handleNewPayloadArrival(this.props,e,this.state);this.setState(t)}}addPooledItems(){if(!this.isUnmounted){const{strategy:e}=this.props,t=e.addPooledItemsToList(this.state);void 0!==t&&this.setState(t);const i=e.calculateNextRenderTime(t||this.state);e.setNextRenderTime(i),this.cancellationToken.cancelAndRecreateChannel(a).setTimeout(this.addPooledItems.bind(this),i),n.logService.debug(`Next render time is in ${i}ms`,o.ItemPoolFeature,{timeframe:e.getTimeFrame()})}}setupEvents(){const{id:e,strategy:t}=this.props;this.cancellationToken.subscribeToStream(i.eventBus,i.EVENT_TYPES.ITEM_POOL_DISCARD_OLD,i=>{const{value:s}=i;s.id===e&&t.handleOldItemDiscard(this.state)})}componentDidMount(){this.isUnmounted||this.cancellationToken.getChannel(a).setTimeout(this.addPooledItems.bind(this),0)}render(){const{strategy:e,renderItem:t,containerClass:i}=this.props;return e.renderItems(this.state,t,i)}}}),define("item_pool/strategies/default_item_pool_strategy",["require","exports","react","react-transition-group","item_pool/item_pool_interfaces","item_pool/strategies/item_pool_strategy","underscore","log","event"],function(e,t,i,s,n,r,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultItemPoolStrategy=class extends r.ItemPoolStrategy{constructor(e=new l.Event){super(),this.maxItems=10,this.timeframe=6e4,this.minRenderDelay=1e3,this.defaultRenderDelay=2e3,this.maxPoolSize=50,this.onItemsAdded=e}handleNewPayloadArrival(e,t,i){return{items:i.items,pool:this.calculateNewItemPool(i,t.items),nextItemArrival:Date.now()+this.getTimeFrame()}}calculateNewItemPool(e,t){const i=e.items;if(a.logService.debug("Calculating item pool",n.ItemPoolFeature,{existingItems:i,newPayloadItems:t}),i&&0!==i.length){let s=e.pool||[];return o.each(t,e=>{this.isItemInListOrPool(e,i,s)?a.logService.verbose(`We are ignoring ${e.key}! Already in pool / items!`,n.ItemPoolFeature,{item:e}):(s=this.addItemToPool(e,s),a.logService.verbose(`Item ${e.key} is not in pool / items, adding to pool`,n.ItemPoolFeature,{item:e}))}),this.pruneItemPool(s),a.logService.debug("Adding new items from the pool",n.ItemPoolFeature,{pool:s}),s}return a.logService.debug("No items in the pool, just add the new ones",n.ItemPoolFeature),t}addItemToPool(e,t){return[e].concat(t)}addPooledItemsToList(e){if(e.pool&&e.pool.length>0){const t=this.getItemsToAdd(),i=e.pool.splice(0,t),s=i.concat(e.items||[]);return void 0!==this.onItemsAdded&&this.onItemsAdded.fire(i),a.logService.debug("Add an item from the pool!",n.ItemPoolFeature,{newItems:i,items:s}),a.logService.debug(`There are now ${e.pool.length} items left in the pool`,n.ItemPoolFeature,{pool:e.pool}),this.pruneItemList(s),{items:s,pool:e.pool,nextItemArrival:e.nextItemArrival}}a.logService.debug("Item pool is empty...",n.ItemPoolFeature)}renderItems(e,t,n){return i.createElement(s.TransitionGroup,{className:this.getContainerClass()},this.getRenderedItems(e,t))}pruneItemList(e){const t=this.getMaxItems();void 0!==t&&t&&e.length>t&&(a.logService.debug("Too many items in list, trimming!",n.ItemPoolFeature,{maxItems:t,listLength:e.length}),e.length=t)}pruneItemPool(e){const t=this.getMaxPoolSize();void 0!==t&&t&&e.length>t&&(a.logService.debug("Too many items in pool, trimming!",n.ItemPoolFeature,{maxPoolSize:t,poolLength:e.length}),e.splice(0,e.length-t))}setContainerClass(e){this.containerClass=e}getContainerClass(){return this.containerClass}getRenderedItems(e,t){return e.items.map((e,n)=>i.createElement(s.CSSTransition,{key:e.key,classNames:"ticker",timeout:{enter:750,exit:750}},t(e,n,{})))}getMaxPoolSize(){return this.maxPoolSize}}}),define("item_pool/strategies/single_value_item_pool_strategy",["require","exports","item_pool/strategies/default_item_pool_strategy","event"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SingleValueItemPoolStrategy=class extends i.DefaultItemPoolStrategy{constructor(e=new s.Event){super(e),this.maxItems=1}addItemToPool(e,t){return t.push(e),t}}}),define("item_pool/strategies/single_value_no_pool_strategy",["require","exports","event","item_pool/strategies/default_item_pool_strategy"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SingleValueNoPoolStrategy=class extends s.DefaultItemPoolStrategy{constructor(e=new i.Event){super(e),this.maxItems=1,this.maxPoolSize=1}addItemToPool(e,t){return t.push(e),t}}}),define("label_select/label_select_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("label_select/label_select_adapter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LabelSelectAdapter=class{constructor(e){this.data=e}getData(){return this.data}}}),define("label_select/controller/abstract_label_select_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractLabelSelectController=class{constructor(e,t){this.data=e,this.adapter=new t(e)}getItems(){return this.adapter.getItems()}}}),define("label_select/label_select_components",["require","exports","react","classnames","flux"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LabelSelectComponent=class extends n.BaseComponent{render(){return i.createElement("div",{className:"label-select label-select-div"},i.createElement("div",{className:this.getListClasses()},this.renderChildren()))}getController(){return this.props.controller}getConfiguration(){return this.props.configuration||{}}renderChildren(){return this.getController().getItems().filter(e=>e.visible).map(e=>this.renderSingleChild(e))}renderSingleChild(e){return i.createElement("div",{key:e.id,className:"item",onClick:this.handleClick.bind(this,e)},this.renderChildContent(e))}renderChildContent(e){if(void 0===e.label&&void 0!==e.icon)return this.renderIcon(e.icon);{const t=s({"label clickable":!0,"label-primary":e.selected,"disabled-entry":e.disabled}),{icon:n=e.icon}=this.getConfiguration();return i.createElement("span",{className:t,"data-mapped-id":e.id},this.renderIcon(n),e.label)}}renderIcon(e){return e?i.createElement("i",{className:e}):null}handleClick(e){this.getController().onSelectItem(e),this.forceUpdate()}getListClasses(){const e=this.getConfiguration();return s({"list-inline":!0,"limit-size":void 0!==e.maxWidth})}}}),define("metrics/icon_metric_renderable",["require","exports","react","flux","blocks/components/models/text_block","blocks/components/renderables/text_block_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IconMetricRenderable=class extends s.BaseComponent{render(){const{metric:e,className:t,widgetId:s}=this.props,o=new n.TextBlock({text:e.value,click_action:e.click_action},{icon:e.icon,widgetId:s});return i.createElement("li",null,i.createElement(r.TextBlockRenderable,Object.assign({},o.model,{className:t,title:e.text})))}}}),define("metrics/metric_bar_renderable",["require","exports","react","flux","metrics/icon_metric_renderable"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetricBarRenderable=class extends s.BaseComponent{render(){const e=this.props.widgetId,t=this.props.metrics.map(t=>i.createElement(n.IconMetricRenderable,{widgetId:e,key:t.order+"",metric:t}));return i.createElement("div",{className:"metric-bar",style:this.props.style},i.createElement("ul",{className:"list-unstyled"},t))}}}),define("multiple_checkbox/multiple_checkbox.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multipleCheckboxStyleModel={container:{},item:{position:"relative",lineHeight:"1.66em",marginTop:"5px"},radioButton:{pointerEvents:"none",marginTop:"0 !important"},label:{paddingLeft:"1.66em",fontWeight:"normal",position:"absolute",bottom:"-2px",maxWidth:"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},stateButtonContainer:{display:"inline-block"}},t.multipleCheckboxStyle=i.createCssModule(()=>t.multipleCheckboxStyleModel).compute({}).attach().getModule()}),define("multiple_checkbox/multiple_checkbox_renderable",["require","exports","classnames","flux","react","form/components/state_button/state_button_component","form/components/state_button/state_button_state","multiple_checkbox/multiple_checkbox.css"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultipleCheckboxRenderable=class extends s.BaseComponent{shouldComponentUpdate(){return!0}render(){const{className:e}=this.props,t=i({[a.multipleCheckboxStyle.container]:!0,[e]:void 0!==e});return n.createElement("div",{className:t},this.props.items.map(e=>{const{id:t,type:s,disabled:l,label:c,checked:d,itemClassName:h}=e,u=i({[a.multipleCheckboxStyle.item]:!0,[h]:void 0!==h}),p={stateButtonState:d?o.StateButtonState.CHECKED:o.StateButtonState.UNCHECKED,label:c};return n.createElement("div",{className:u,key:t,onClick:this.onClick.bind(this,e)},n.createElement(r.StateButtonComponent,{model:p,toggleCallback:void 0,customClasses:{container:a.multipleCheckboxStyle.stateButtonContainer,label:a.multipleCheckboxStyle.label},showContainer:!0,stopPropagation:!1,type:s,disabled:l}))}))}onClick(e,t){const i=t.nativeEvent;t.preventDefault(),t.stopPropagation(),e.disabled||e.onClick(i,e)}}}),define("shortcut_explanation/shortcut_explanation",["require","exports","react","flux","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends s.BaseComponent{constructor(e){super(e),this.keyActions=[{keys:n.Keys.ESCAPE,action:()=>{this.props.close()}}]}clickInside(e){}clickOutside(e){this.props.close()}render(){const{query:e,close:t}=this.props,s=e.execute(),{keyMap:n,title:r}=s;return i.createElement("div",{className:"tw-shortcut-explanation"},i.createElement("header",null,i.createElement("h3",null,r),i.createElement("button",{onClick:t,type:"button",className:"close"},"")),n.keys().map(e=>this.renderKeyRow(e,n.get(e))))}renderKeyRow(e,t){return i.createElement("div",{className:"key-row",key:t},e.map((e,t)=>i.createElement("div",{key:t,className:"tw-keyboard-button"},i.createElement("span",null,e))),i.createElement("span",{className:"explanation"},t))}}t.ShortcutExplanation=r,n.applyMixins(r,[s.DocumentClickTracker,s.KeyListener])}),define("sidebar/actions/sidebar_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sidebarActions={sidebar_onClickTopic:"sidebar_onClickTopic",sidebar_onAddButtonClicked:"sidebar_onAddButtonClicked",sidebar_onAddGroupButtonClicked:"sidebar_onAddGroupButtonClicked",sidebar_onReorderTopic:"sidebar_onReorderTopic",sidebar_onToggleCollapse:"sidebar_onToggleCollapse",sidebar_onToggleCollapseAll:"sidebar_onToggleCollapseAll",sidebar_onAddEntry:"sidebar_onAddEntry",sidebar_onSortGroup:"sidebar_onSortGroup"}}),define("sidebar/components/models/sidebar_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("sidebar/components/models/sidebar_menu_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("sidebar/components/renderables/side_bar_options_container",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("sidebar/components/renderables/sidebar_menu",["require","exports","classnames","flux","react","reusable_utilities","underscore","drag_and_drop/draggable","sidebar/actions/sidebar_actions","event_bus"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SidebarMenu=class extends s.BaseComponent{constructor(e){super(e),this.draggableState=0,this.isOptionsDisplayed=!1,this.cancellationToken.subscribeToStream(c.eventBus,c.EVENT_TYPES.UPDATE_SIDE_BAR,e=>{const{query:t}=this.props,i=t.execute();e.value.change.menuType===i.menu.type&&this.forceUpdate()})}render(){const{query:e}=this.props,t=e.execute(),{menu:s,editMode:o,menu:{root_entry:{children:a=[]}},messages:l}=t;if(!o&&0===s.root_entry.children.length)return null;const c=r.TopicEntryUtils.isSelectedOrHoldsSelection(s.root_entry),{canShowRootName:d}=t.settings,h=i({root:!0,active:c,"no-padding":!d});return n.createElement("div",{className:"tw-menu",id:s.type},n.createElement("div",{className:h},this.renderRootGroup(s,t,l,c),this.renderAddButton(s,t),this.renderAddGroupButton(s,t),n.createElement("ul",{onMouseEnter:e=>this.hideOptions(e),className:"list-unstyled icons-ul",key:this.draggableState},a.map((e,i)=>this.renderGroup(e,t,i,l)))))}renderRootGroup(e,t,s,r){const{canShowRootName:o,canCollapseAll:a,canSortChildren:l,canEnableGrouping:c}=t.settings;if(!o)return null;const d=this.isShownAsSelected(e.root_entry,void 0,e.root_entry,t),h=i({not_selectable:!this.canSelect(e.root_entry,t),selected:d,"root-name":!0}),u=i({"collapse-icon collapse-all-icon category-icon icon2-tw-expand-head":!0,collapsed:this.hasAllCategoriesCollapsed(e)}),p=i({"sort-group-icon fa fa-sort-alpha-asc":!0,active:d}),{editMode:g}=t,m=e.root_entry&&e.root_entry.children&&e.root_entry.children.length>0,_=g&&l&&m,f=this.props.SidebarOptionsContainer;return n.createElement("div",{onClick:()=>this.selectRoot(e.root_entry,t),onMouseEnter:e=>this.showOptions(e),onMouseLeave:e=>this.hideOptions(e),className:h},a?n.createElement("i",{onClick:e=>this.toggleCollapseAll(e),className:u}):null,n.createElement("span",{className:"entry-style"},e.root_entry.name),c&&!g?n.createElement(f,{onMouseEnter:e=>this.cancelHide(e),topicMenu:e}):null,r?n.createElement("span",{className:"hits"},e.root_entry.hits_text):null,_?n.createElement("i",{className:p,title:s.sort_all,onClick:this.sortGroup.bind(this,void 0)}):null)}renderGroup(e,t,s,r){const c=i({"top-spacing":0===s,category:!0,spacing:e.children&&e.children.length>0}),{children:d=[]}=e,{menu:{type:h},settings:{groupDropzoneConfig:u={},canDragAndDrop:p=!1}}=t;u[h+"children"]&&(u[h+"children"].callback=((e,t,i)=>{const{query:s}=this.props;this.dispatch(l.sidebarActions.sidebar_onReorderTopic,{query:s,droppedElement:e,newParent:t,newIndex:i}),this.draggableState++})),u[h+"categories"]&&(u[h+"categories"].callback=((e,i,s)=>{const{query:n}=this.props;this.dispatch(l.sidebarActions.sidebar_onReorderTopic,{query:n,droppedElement:{child:e,parent:t.menu.root_entry},newParent:t.menu.root_entry,newIndex:s})}));const g=!p||void 0===u[h+"categories"]||!this.canShowCategory(e,t);let m;return m=g?o.omit(u,h+"categories"):u,n.createElement(a.Draggable,{key:e.mapped_id,dropzoneConfig:m,domNode:(e,t)=>n.createElement("li",e,t),model:e,disabled:g,dropTargetChannels:[h+"categories"]},n.createElement("div",{className:c},this.renderCategory(e,t,d,r),this.canShowChildren(e)?this.renderGroupList(e,t):null))}renderCategory(e,t,s,o){const a=!this.isCollapsed(e),l=i({"category-icon icon2-tw-arrow-collapse-menu collapse-icon":!0,expanded:a}),c=this.isShownAsSelected(e,t.menu.root_entry,t.menu.root_entry,t),d=i({"category-block":!0,selected:c,not_selectable:!r.TopicEntryUtils.canBeSelected(e)}),h=s.length>0&&this.canShowCategory(e,t)||this.canShowHiddenCategory(e,t),u=this.canOrderGroup(e,s,t),p=i({"sort-group-icon fa fa-sort-alpha-asc":!0,active:c}),g=this.isCollapsed(e)&&r.TopicEntryUtils.isSelectedOrHoldsSelection(e);return n.createElement("div",{onClick:i=>this.handleCategorySelect(e,t,i),className:d},h?n.createElement("i",{className:l,onClick:this.toggleCollapse.bind(this,e)}):null,this.renderCategoryName(e,t,o),u?n.createElement("i",{className:p,title:o.sort_group,onClick:this.sortGroup.bind(this,e)}):null,g?n.createElement("div",{style:{color:"#0089C0",paddingRight:5,paddingTop:2,fontSize:13},className:"hits"},e.hits_text):null)}handleCategorySelect(e,t,i){this.canShowCategory(e,t)?this.select(e):this.canShowHiddenCategory(e,t)&&this.toggleCollapse(e,i)}renderCategoryName(e,t,s){const o=i({"more-text":t.settings.canAdd(t.menu,t.editMode),"entry-style":!0,"category-name":!0});return this.canShowCategory(e,t)?n.createElement("span",{className:o,id:r.StringUtils.sanitizeInputForHtmlAttribute(e.mapped_id)},e.name):this.hasAllCategoriesCollapsed(t.menu)?n.createElement("span",{className:o,id:r.StringUtils.sanitizeInputForHtmlAttribute(e.mapped_id)},s.uncategorized):null}canOrderGroup(e,t,i){const{editMode:s,settings:n}=i;return this.canShowCategory(e,i)&&n.canSortChildren&&s&&!this.isCollapsed(e)&&t.length>1}renderGroupList(e,t){const{children:i=[]}=e;return n.createElement("ul",{className:"list-unstyled icons-ul"},i.map(i=>this.renderGroupChild(i,e,t)))}renderGroupChild(e,t,s){const o=i({hoverable:s.editMode}),{type:l}=s.menu,{canDragAndDrop:c,groupDropzoneConfig:d}=s.settings,h=i({selected:this.isShownAsSelected(e,t,s.menu.root_entry,s),topic:!0}),u={color:e.color||"#0089C0"};return n.createElement(a.Draggable,{domNode:(e,t)=>n.createElement("li",e,t),dropTargetChannels:[l+"children"],model:{child:e,parent:t},disabled:!c||void 0===d[l+"children"],key:e.mapped_id},n.createElement("div",{className:o},c?n.createElement("span",{className:"drag-icon"},n.createElement("i",{className:"fa fa-arrows"})):null,n.createElement("div",{onClick:()=>this.select(e),className:h},n.createElement("i",{className:"fa fa-circle tw-topic-icon-circle"}),n.createElement("span",{title:e.name,className:"topic-name entry-style",id:r.StringUtils.sanitizeInputForHtmlAttribute(e.mapped_id)},e.name),this.canShowShareeInfo(e,s)?n.createElement("span",{className:"shared-topic"},n.createElement("i",{className:"fa fa-link"})):null,n.createElement("span",{className:"trend-and-hits"},n.createElement("span",{style:u,className:"hits"},e.hits_text)))))}canShowCategory(e,t){return!t.settings.hideCategories.includes(e.mapped_id)}canShowChildren(e){return!this.isCollapsed(e)&&e.children&&e.children.length>0}isCollapsed(e){return e.collapsed}canShowShareeInfo(e,t){return t.editMode&&void 0!==e.transient_properties&&"SHAREE"===e.transient_properties.sharing_role}canShowHiddenCategory(e,t){return void 0!==e.children&&e.children.length>0&&!this.canShowCategory(e,t)&&this.hasAllCategoriesCollapsed(t.menu)}canSelect(e,t){return!!r.TopicEntryUtils.canBeSelected(e)&&!!t.editMode}selectRoot(e,t){!t.editMode&&e.children&&e.children.length>0?this.select(e.children[0]):t.editMode&&this.select(e)}isShownAsSelected(e,t,i,s){return!(!r.TopicEntryUtils.isSelected(e)||!s.settings.canHighlightRoot&&e===i)||(s.settings.highlightDirectChildren&&t?t!==i&&r.TopicEntryUtils.isSelected(t):!(!s.settings.highlightChildrenRecursive||e===i)&&(r.TopicEntryUtils.isSelected(i)||t&&r.TopicEntryUtils.isSelected(t)))}select(e){const{query:t}=this.props;this.dispatch(l.sidebarActions.sidebar_onClickTopic,{entry:e,query:t,mainQuery:t.getParent()})}addButtonClicked(){const{query:e}=this.props;this.dispatch(l.sidebarActions.sidebar_onAddButtonClicked,{query:e,containerQuery:e.getParent()})}addGroupButtonClicked(){const{query:e}=this.props;this.dispatch(l.sidebarActions.sidebar_onAddGroupButtonClicked,{query:e,containerQuery:e.getParent()})}renderAddButton(e,t){return t.settings.canAdd(e,t.editMode)?n.createElement("span",{className:"new-category ",onClick:()=>this.addButtonClicked(),onMouseEnter:e=>this.hideOptions(e)},n.createElement("span",{className:"add-button tw-edit tw-button"},n.createElement("button",{type:"button",className:"btn btn-default"},n.createElement("span",null,t.settings.addButtonLabel),n.createElement("i",{className:"icon-tw-plus-sign add-icon"})))):null}renderAddGroupButton(e,t){return t.settings.canAddGroup(e,t.editMode)?n.createElement("span",{className:"new-category",onClick:()=>this.addGroupButtonClicked(),onMouseEnter:e=>this.hideOptions(e)},n.createElement("span",{className:"add-button tw-edit tw-button"},n.createElement("button",{type:"button",className:"btn btn-default"},n.createElement("span",null,t.settings.addGroupButtonLabel),n.createElement("i",{className:"icon-tw-plus-sign add-icon"})))):null}toggleCollapse(e,t){const{query:i}=this.props;t.stopPropagation(),this.dispatch(l.sidebarActions.sidebar_onToggleCollapse,{query:i,entry:e})}sortGroup(e,t){const{query:i}=this.props;t.stopPropagation(),this.dispatch(l.sidebarActions.sidebar_onSortGroup,{entry:e,query:i})}toggleCollapseAll(e){const{query:t}=this.props;e.stopPropagation(),this.dispatch(l.sidebarActions.sidebar_onToggleCollapseAll,{query:t})}hasAllCategoriesCollapsed(e){return e.root_entry.children.every(e=>e.collapsed)}showOptions(e){const t=$(e.target);let i=t.find(".tw-sidebar .root");0===i.length&&(i=t.closest(".tw-sidebar .root")),i.find(".filter-options").css({display:"inline-block"}),this.isOptionsDisplayed=!0}hideOptions(e){if(this.isOptionsDisplayed){const t=$(e.target);let i=t.find(".tw-sidebar .root");0===i.length&&(i=t.closest(".tw-sidebar .root"));const s=i.find(".filter-options");0===s.find(".actions-container").length?setTimeout(()=>{s.hide(),this.isOptionsDisplayed=!1},250):this.cancelHide(e)}}cancelHide(e){e.stopPropagation(),clearTimeout(this.hideTimeout)}}}),define("sidebar/components/renderables/sidebar",["require","exports","react","flux","sidebar/components/renderables/sidebar_menu"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Sidebar=class extends s.BaseComponent{constructor(e){super(e)}render(){const{query:e}=this.props,t=e.execute();return i.createElement("div",{className:"tw-sidebar"},t.menus.map(e=>this.renderMenu(e)))}renderMenu(e){let{query:t}=this.props;return t=t.execute().getMenuSubQuery(t,e.type),i.createElement(n.SidebarMenu,{query:t,key:e.type,SidebarOptionsContainer:this.props.SidebarOptionsContainer})}}}),define("single_selection_dropdown/src/single_selection_dropdown",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SingleSelectionDropdown=class extends s.BaseComponent{render(){const e=this.props.items.filter(e=>e.selected);if(e.length>1)throw new Error("There must not be more than one item selected for the single selection dropdown component!");let t=e[0];return void 0===t&&((t=this.props.items[0]).selected=!0),i.createElement("div",{className:"single-selection-dropdown-container"},i.createElement("div",{className:"single-selection-dropdown-preview"},i.createElement("span",{className:"single-selection-dropdown-preview-label"},t.label),i.createElement("i",{className:"single-selection-dropdown-preview-icon fa-caret-down fa"}),i.createElement("div",{className:"single-selection-dropdown-menu"},i.createElement("ul",null,this.props.items.map(e=>i.createElement("li",{key:e.label,className:"clickable",onClick:()=>e.onClick()},i.createElement("i",{className:e.selected?"fa fa-check":""}),i.createElement("span",null,i.createElement("span",null,e.label),i.createElement("span",{className:"single-selection-dropdown-description "},e.description))))))))}}}),define("spinner/spinner",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SpinnerComponent=class extends s.BaseComponent{render(){return i.createElement("div",{className:"loader"})}}}),define("tooltip/tooltip",["require","exports","react","flux","event_bus"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TooltipComponent=class extends s.BaseComponent{constructor(e){super(e)}render(){return i.createElement("div",{className:"tooltip-container",ref:"root",onMouseEnter:e=>this.fadeIn(e),onMouseLeave:()=>this.fadeOut()},this.props.children)}fadeIn(e){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}}),n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:this.props.text},placement:this.props.position}})}fadeOut(){n.eventBus.dispatch({type:n.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip",schedule:!0}})}}}),define("tree/models/tree_item",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.props=e,this.id=e.id,this.label=e.label,this.selected=!!e.selected,this.color=e.color,this.hideColor=!!e.hideColor,this.parent=t,this.children=[],e.children&&e.children.forEach((e,t)=>{this.children[t]=new i(e,this)})}isSelected(){return this.selected}isEnabled(){return this.selected||this.parent&&this.parent.isEnabled()}clone(){return new i(this.props)}applyFilter(e){const t=[];this.children.forEach(i=>{i.checkFilter(e)&&(i.applyFilter(e),t.push(i))}),this.children=t}checkFilter(e){return!!e.includes(this.id)||this.children.some(t=>t.checkFilter(e))}setSelected(e){this.setSelectedInternal(e),this.inheritSelection(!1),this.parent&&this.parent.checkSelection()}setSelectedInternal(e){this.selected=e,this.props.selected=e}checkSelection(){this.children.every(e=>e.selected)?(this.children.forEach(e=>{e.setSelectedInternal(!1)}),this.setSelectedInternal(!0)):this.setSelectedInternal(!1),this.parent&&this.parent.checkSelection()}inheritSelection(e){this.children.forEach(t=>{t.setSelectedInternal(e),t.inheritSelection(e)})}displayColor(){return!this.hideColor&&this.hasColor()}hasColor(){return void 0!==this.color}getColor(){return this.color}hasChildren(){return this.children.length>0}getChildren(){return this.children}getRoot(){return this.parent?this.parent.getRoot():this}getDescendants(e){let t=this.getChildren();return this.getChildren().forEach(i=>{t=t.concat(i.getDescendants(e))}),e?t.filter(e):t}}t.TreeItem=i}),define("tree/models/tree_event",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("tree/css/tree.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.treeComponentStyleModel={colorIcon:{display:"inline-block",float:"left",width:16,height:16,borderRadius:8,margin:"2px 5px 2px 2px"}},t.treeComponentStyle=i.createCssModule(()=>t.treeComponentStyleModel).compute({}).attach().getModule()}),define("tree/renderables/tree_list_renderable",["require","exports","react","flux","tree/css/tree.css"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TreeListRenderable=class extends s.BaseComponent{constructor(e){super(e),this.state={elements:this.getFilteredElements(this.props.filterIds)}}componentWillReceiveProps(e,t){this.setState({elements:this.getFilteredElements(e.filterIds)})}componentDidMount(){this.props.onChange&&this.props.onChange({target:this.props.root,selectedItems:this.props.root.getDescendants(e=>e.isEnabled())})}render(){return this.renderList(this.state.elements)}renderList(e){return i.createElement("ul",{className:"list-unstyled"},e.map(e=>{let t=null;return e.hasChildren()&&(t=this.renderList(e.getChildren())),i.createElement("li",{key:e.id},i.createElement("div",{className:`item text-unselectable ${e.isSelected()?"active":""}`,onClick:()=>this.onItemClick(e)},e.displayColor()?i.createElement("i",{className:n.treeComponentStyle.colorIcon,style:{backgroundColor:e.getColor()}}):null,e.label),t)}))}onItemClick(e){e.setSelected(!e.isSelected()),this.setState({}),this.props.onChange&&this.props.onChange({target:e,selectedItems:e.getRoot().getDescendants(e=>e.isEnabled())})}getFilteredElements(e){const t=this.props.root.clone();return e&&t.applyFilter(e),this.props.hideRoot?t.getChildren():[t]}}}),define("tree/tree",["require","exports","react","flux","tree/models/tree_item","tree/renderables/tree_list_renderable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TreeComponent=class extends s.BaseComponent{constructor(e){super(e),this.state={root:new n.TreeItem(this.props.root)}}render(){const e=void 0===this.props.visible||this.props.visible;return i.createElement("div",{className:"tree-select",style:{display:e?"block":"none"}},e?i.createElement(r.TreeListRenderable,{root:this.state.root,filterIds:this.props.filterIds,hideRoot:this.props.hideRoot,onChange:this.props.onChange}):null)}}}),define("utilities/load_more/visibility_renderable",["require","exports","react","react-dom","flux","reusable_utilities"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends n.BaseComponent{constructor(e){super(e),this.state=this.getInitialState(e)}getInitialState(e){const{showChildren:t=!0}=e;return{isVisible:!1,visibilityRect:{},showChildren:t}}componentDidMount(){this.props.active&&this.startWatching()}componentWillUnmount(){super.componentWillUnmount(),this.stopWatching()}componentWillReceiveProps(e){e.active?(this.setState(this.getInitialState(e)),this.startWatching()):this.stopWatching()}render(){return this.props.children&&this.state.showChildren?i.Children.only(this.props.children):i.createElement("div",null)}startWatching(){this.delayId||(this.delayId=r.AnimationLoop.registerCallback(()=>new Promise(e=>{this.check(),e()}),!1,1e3/this.props.delay))}stopWatching(){this.delayId&&(r.AnimationLoop.removeCallbackById(this.delayId),this.delayId=void 0)}isInvalidRect(e){return(e.top||0)+(e.right||0)+(e.bottom||0)+(e.left||0)===0}check(){if(this.isUnmounted)return;const e=s.findDOMNode(this);let t,i;if(!e)return;if(t=e.getBoundingClientRect(),this.isInvalidRect(t))return;i=this.props.containment&&null!==this.props.containment?this.props.containment.getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};const n={top:t.top>=i.top,left:t.left>=i.left,bottom:t.bottom<=i.bottom,right:t.right<=i.right};let r;const o=n.top&&n.left&&n.bottom&&n.right;if(r=this.props.partialVisibility?Math.floor(t.top)<=Math.floor(i.bottom)&&Math.floor(t.bottom)>=Math.floor(i.top)&&Math.floor(t.left)<=Math.floor(i.right)&&Math.floor(t.right)>=Math.floor(i.left):o,this.state.isVisible!==r){const{showChildren:e=!0}=this.props;this.setState({isVisible:r,visibilityRect:n,showChildren:e}),this.props.onChange(r)}}}o.defaultProps={active:!0,containment:null,partialVisibility:!0,delay:1e3,showChildren:!0,onChange:e=>{}},t.VisibilityRenderable=o}),define("video/video_preview_html5video",["require","exports","react","flux"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={ogg:"video/ogg",webm:"video/webm",mp4:"video/mp4"};t.Html5Video=class extends s.BaseComponent{constructor(e){super(e)}renderFileSources(e,t){const s=e.split(t),r=s[0]+t,o=s[1].replace(".","");return Object.keys(n).reduce((e,t)=>(o.toLowerCase()===t?e.unshift(i.createElement("source",{key:t,src:r+"."+o,type:n[t]})):e.push(i.createElement("source",{key:t,src:r+"."+t,type:n[t]})),e),[])}render(){const{mediaUrl:e,id:t,spanClass:s,fileName:n}=this.props,r=this.renderFileSources(e,n);return i.createElement("div",{id:t},i.createElement("span",{className:s,ref:"wrapper"},i.createElement("video",{controls:!0},r,"Your browser does not support the video tag.")))}}}),define("virtual_list/containers/virtual_list_container",["require","exports","react","flux","reusable_utilities"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VirtualListContainer=class extends s.BaseComponent{constructor(e){super(e),this.state={itemsInView:[],forceRenderTs:Date.now()}}componentWillReceiveProps(e){if(e.items&&0!==e.items.length){if(e.items.length>=this.props.items.length){const t=Math.max(...this.props.items.map(e=>e.timeStamp||0));if(this.state.forceRenderTs<t)return void this.setState({forceRenderTs:t,itemsInView:this.state.itemsInView.splice(0,this.props.items.findIndex(e=>e.timeStamp===t))});const i=e.items.findIndex((e,t)=>e!==this.props.items[t]);i>=0&&i<this.state.itemsInView.length&&this.setState({itemsInView:this.state.itemsInView.splice(0,i)})}else if(e.items.length<this.props.items.length){let t=0;const i=this.state.itemsInView.filter((i,s)=>{const n=Math.max(s-t,0);return i===e.items[n]||(t++,!1)});this.setState({itemsInView:i})}}else this.setState({itemsInView:[]})}shouldComponentUpdate(){return!0}componentDidMount(){const e=n.AnimationLoop.registerCallback(()=>new Promise(t=>{this.isUnmounted?n.AnimationLoop.removeCallbackById(e):this.recalculateItemsInView(),t()}));this.cancellationToken.registerCleanupFunction(()=>{n.AnimationLoop.removeCallbackById(e)})}render(){return i.createElement(this.props.tagName,{children:this.state.itemsInView.map((e,t)=>this.props.renderItem(e,t)),className:this.props.containerClass})}shouldAddItems(){return this.props.items.length>this.state.itemsInView.length}recalculateItemsInView(){if(this.shouldAddItems()){const e=this.props.items,t=this.state.itemsInView,i=this.getItemsToAdd();this.setState({itemsInView:t.concat(e.slice(t.length,t.length+i))}),this.shouldAddItems()||this.performOnDone()}}performOnDone(){this.props.onDone&&this.props.onDone()}getItemsToAdd(){const e=this.props.items,t=this.state.itemsInView,i=this.props.batchSize||5;return e.length-t.length>i?i:e.length}}}),define("reusable_components",["require","exports","anchor/abstract/interfaces/model","anchor/actions/anchor_actions","anchor/icon_anchor/icon_anchor","anchor/presentation_anchor/presentation_anchor","anchor/preview_anchor/preview_anchor","animated_label/animated_label","blocks/components/click_actions/delete_call_restform_click_action","blocks/components/click_actions/get_call_restform_click_action","blocks/components/click_actions/post_call_restform_click_action","blocks/components/factories/click_action_factory","blocks/components/models/block","blocks/components/models/block_types","blocks/components/models/click_action","blocks/components/models/click_action_types","blocks/components/models/icon_block","blocks/components/models/image_block","blocks/components/models/text_block","blocks/components/renderables/avatar_fallback_image_renderable","blocks/components/renderables/button_renderable","blocks/components/renderables/event_handle_wrapper","blocks/components/renderables/fallback_image_renderable","blocks/components/renderables/icon_block_renderable","blocks/components/renderables/image_block_renderable","blocks/components/renderables/social_media_icon_renderable","blocks/components/renderables/text_block_renderable","blocks/components/renderables/verified_icon_renderable","button_selection/classes/button_selection","carousel_list/carousel_list","color_picker/popover/color_picker_popover_renderable","context_menu/builder/context_menu_builder","context_menu/components/renderables/context_menu_panel","context_menu/components/renderables/panels/dropdown_menu_panel","context_menu/components/renderables/panels/source_actions_panel","context_menu/components/renderables/panels/widget_actions_panel","context_menu/containers/context_menu_container","diff_explorer/components/diff_explorer_header","diff_explorer/diff_explorer","drag_and_drop/draggable","drag_and_drop/draggable_service","dropdown_menu/dropdown_menu_container","dropdown_menu/dropdown_menu_renderable","dropdown_menu/generic/generic_dropdown_menu_renderable","expandable_list/expandable_list_container","expandable_list/expandable_list_item","expandable_list/filter_menu_selection_mode","expandable_list/menu_config","expandable_list/style/expandable_list_style","filter_menu/hoverable_filter_menu/simple_rounded_filter_menu_renderable","filter_menu/hoverable_filter_menu/square_filter_menu_renderable","filters/actions/filter_menu_actions","filters/actions/filter_option_actions","filters/components/renderables/filter_options/filter_options","filters/components/renderables/horizontal_filter/horizontal_filter","filters/components/renderables/side_panel/filter_side_panel","filters/components/renderables/sub_page/filter_sub_page","filters/components/renderables/vertical_filter/vertical_filter","filters/components/stores/filter_option_store","filters/components/stores/filter_store","filters/components/utilities/shared_filter_logic","form/components/access_management_component","form/components/dual_range_slider_component","form/components/on_off_component","form/components/progress_button/progress_button","form/components/range_slider_component","form/components/single_select_component","form/components/state_button/state_button_component","form/components/state_button/state_button_state","form/components/state_button/state_button_type","generic/actions/generic_actions","generic/components/crop_component/crop_component_renderable","generic/components/font_icon_component/font_icon_component_renderable","generic/components/icon_component/icon_component_renderable","generic/components/image_component/image_component_renderable","generic/components/initials_component/initials_component_renderable","generic/components/models/article","generic/components/models/sentiments","generic/dropdownButton/dropdown_button","generic/progress_bar/progress_bar","generic_menu/components/renderables/providers/icon_left_topic_menu_select_renderable","generic_menu/components/renderables/topic_menu_select","generic_menu/components/stores/topic_menu_select_store","hyperlink_with_icon/src/hyperlink_with_icon_container","icons/classes/icon_maps","icons/classes/icon_utils","icons/components/page_icon_component","icons/models/page_icon_model","image_export_flag/image_export_flag","image_selector_list/image_selector_list_container","inline_tags_suggestion/allowed_tag_char_regex","inline_tags_suggestion/inline_tags_suggestion","inline_tags_suggestion/max_tag_with_group_length","inline_tags_suggestion/tag_or_tag_group_regex","inline_tags_suggestion/tag_with_optional_group_regex","item_grid_selection_dropdown/src/item_grid_selection_dropdown","item_pool/item_pool_container","item_pool/item_pool_interfaces","item_pool/strategies/default_item_pool_strategy","item_pool/strategies/item_pool_strategy","item_pool/strategies/single_value_item_pool_strategy","item_pool/strategies/single_value_no_pool_strategy","label_select/label_select_adapter","label_select/label_select_components","metrics/icon_metric_renderable","metrics/metric_bar_renderable","multiple_checkbox/multiple_checkbox_renderable","shortcut_explanation/shortcut_explanation","sidebar/actions/sidebar_actions","sidebar/components/renderables/sidebar","single_selection_dropdown/src/single_selection_dropdown","source_actions_menu/actions/source_actions_menu_actions","source_actions_menu/actions/source_actions_menu_event","source_actions_menu/components/renderables/source_actions_dropdown_renderable","source_actions_menu/components/renderables/source_actions_menu_renderable","source_actions_menu/components/renderables/source_actions_panel_list_renderable","source_actions_menu/containers/source_actions_menu_container","source_actions_menu/stores/source_actions_menu_store","spinner/spinner","tooltip/tooltip","tree/models/tree_item","tree/renderables/tree_list_renderable","tree/tree","utilities/document_click_tracker_wrapper","utilities/icon","utilities/image","utilities/load_more/visibility_renderable","utilities/timed_hover","video/video_preview_html5video","virtual_list/containers/virtual_list_container"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T,I,w,A,O,M,L,P,x,D,R,N,k,F,B,U,H,G,j,V,q,W,z,Y,X,K,$,Z,Q,J,ee,te,ie,se,ne,re,oe,ae,le,ce,de,he,ue,pe,ge,me,_e,fe,ye,be,Ee,Se,Ce,ve,Te,Ie,we,Ae,Oe,Me,Le,Pe,xe,De,Re,Ne,ke,Fe,Be,Ue,He,Ge,je,Ve,qe,We,ze,Ye,Xe,Ke,$e,Ze,Qe,Je,et,tt,it,st,nt,rt,ot,at,lt,ct,dt,ht,ut,pt,gt,mt,_t,ft,yt,bt,Et,St){"use strict";function Ct(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),Ct(i),Ct(s),Ct(n),Ct(r),Ct(o),Ct(a),Ct(l),Ct(c),Ct(d),Ct(h),Ct(u),Ct(p),Ct(g),Ct(m),Ct(_),Ct(f),Ct(y),Ct(b),Ct(E),Ct(S),Ct(C),Ct(v),Ct(T),Ct(I),Ct(w),Ct(A),Ct(O),Ct(M),Ct(L),Ct(P),Ct(x),Ct(D),Ct(R),Ct(N),Ct(k),Ct(F),Ct(B),Ct(U),Ct(H),Ct(G),Ct(j),Ct(V),Ct(q),Ct(W),Ct(z),Ct(Y),Ct(X),Ct(K),Ct($),Ct(Z),Ct(Q),Ct(J),Ct(ee),Ct(te),Ct(ie),Ct(se),Ct(ne),Ct(re),Ct(oe),Ct(ae),Ct(le),Ct(ce),Ct(de),Ct(he),Ct(ue),Ct(pe),Ct(ge),Ct(me),Ct(_e),Ct(fe),Ct(ye),Ct(be),Ct(Ee),Ct(Se),Ct(Ce),Ct(ve),Ct(Te),Ct(Ie),Ct(we),Ct(Ae),Ct(Oe),Ct(Me),Ct(Le),Ct(Pe),Ct(xe),Ct(De),Ct(Re),Ct(Ne),Ct(ke),Ct(Fe),Ct(Be),Ct(Ue),Ct(He),Ct(Ge),Ct(je),Ct(Ve),Ct(qe),Ct(We),Ct(ze),Ct(Ye),Ct(Xe),Ct(Ke),Ct($e),Ct(Ze),Ct(Qe),Ct(Je),Ct(et),Ct(tt),Ct(it),Ct(st),Ct(nt),Ct(rt),Ct(ot),Ct(at),Ct(lt),Ct(ct),Ct(dt),Ct(ht),Ct(ut),Ct(pt),Ct(gt),Ct(mt),Ct(_t),Ct(ft),Ct(yt),Ct(bt),Ct(Et),Ct(St)}),define("anchor/abstract/renderables/abstract_anchor_node",["require","exports","flux"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractAnchorNode=class extends i.BaseComponent{}}),define("blocks/components/click_actions/interfaces/add_to_watchlist_action_payload",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("blocks/components/click_actions/interfaces/open_issue_detailed_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("browser_detection_service",["require","exports","bowser"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BrowserDetection=class{constructor(){this.versions={msie:"11",chrome:"50",firefox:"50",safari:"9.0",opera:"40",msedge:"14"}}isIEorEdge(){return!0===i.msie||!0===i.msedge}isBrowserSupported(){return i.check(this.versions)}getVersionMapping(){return this.versions}}}),define("clipboard",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.GENERAL="GENERAL"}(t.ClipboardChannel||(t.ClipboardChannel={}));class s{constructor(){this.clearAll()}store(e,t,i){null!==t&&void 0!==t&&(this.memory[e]={data:t,isCutOperation:i})}get(e){return this.memory[e]}has(e){return void 0!==this.memory[e]}clear(e){delete this.memory[e]}clearAll(){this.memory={}}addCutCopy(e,t,i,s){this.addCopyEvent(e,t,i,s),this.addCutEvent(e,t,i,s)}addCopyEvent(e,t,s,n){n.addDomEvent(e,"keydown",e=>{e.keyCode===i.Keys.KEY_C&&(e.ctrlKey||e.metaKey)&&("function"==typeof s?this.store(t,s(),!1):this.store(t,s,!1))})}addCutEvent(e,t,s,n){n.addDomEvent(e,"keydown",e=>{e.keyCode===i.Keys.KEY_X&&(e.ctrlKey||e.metaKey)&&("function"==typeof s?this.store(t,s(),!0):this.store(t,s,!0))})}addPasteEvent(e,t,s,n){n.addDomEvent(e,"keydown",e=>{this.has(t)&&e.keyCode===i.Keys.KEY_V&&(e.ctrlKey||e.metaKey)&&s(this.get(t))})}}t.ClipboardService=s,t.clipboardService=new s}),define("emoji_service",["require","exports","reusable_utilities","sanitizer","twemoji"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.emojiDataStrings={}}parseTextForEmoji(e,t=!1){return n.parse(t?e:s.htmlSanitizer.escape(e),this.parseConfigurations)}parseTextForCanvasEmoji(e){const t=this.parseTextForEmoji(e),s=$.Deferred();if(i.StringUtils.containsHTML(t)){const i=$(t)[0];void 0===this.emojiDataStrings[e]?$.ajax({url:i.src}).done(t=>{const n=t.childNodes[0],r=n.getAttribute("viewBox").match(/\w+ \w+ (\w+) (\w+)/),o=r[1],a=r[2];n.setAttribute("width",o),n.setAttribute("height",a);const l=(new XMLSerializer).serializeToString(n),c="data:image/svg+xml;base64,"+btoa(l);i.src=c,this.emojiDataStrings[e]=c,s.resolve(this.prepareModifiedString(i))}):(i.src=this.emojiDataStrings[e],s.resolve(this.prepareModifiedString(i)))}else s.resolve(t);return s.promise()}setParseConfigurations(e){this.parseConfigurations=e}prepareModifiedString(e){return $("<div></div>").append($(e).clone()).html()}}t.EmojiService=r,t.emojiService=new r}),define("font_detection_service",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.baseFonts=["monospace","sans-serif","serif"],this.body=document.getElementsByTagName("body")[0],this.testSpan=document.createElement("span"),this.testSpan.style.fontSize="72px",this.testSpan.innerHTML="mmmmmmmmmmlli",this.defaultWidth={},this.defaultHeight={};for(const e of this.baseFonts)this.testSpan.style.fontFamily=e,this.body.appendChild(this.testSpan),this.defaultWidth[e]=this.testSpan.offsetWidth,this.defaultHeight[e]=this.testSpan.offsetHeight,this.body.removeChild(this.testSpan)}waitUntilLoaded(e,i=5e3){return new Promise((s,n)=>{function r(){return!!t.fontDetectionService.detect(e)&&(s(),!0)}if(r())return;const o=Date.now(),a=setInterval(()=>{r()&&clearInterval(a),Date.now()-o>i&&n(new Error("Font loading timed out"))},50)})}detect(e){let t=!1;for(const i of this.baseFonts){this.testSpan.style.fontFamily=e+","+i,this.body.appendChild(this.testSpan);const s=this.testSpan.offsetWidth!==this.defaultWidth[i]||this.testSpan.offsetHeight!==this.defaultHeight[i];this.body.removeChild(this.testSpan),t=t||s}return t}}t.Detector=i,t.fontDetectionService=new i}),define("request_service",["require","exports","jquery"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{async get(e){return i.getJSON(e)}async post(e,t){return i.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json",dataType:"json"})}}t.RequestService=s,t.requestService=new s}),define("reusable_services",["require","exports","browser_detection_service","clipboard","emoji_service","font_detection_service","request_service"],function(e,t,i,s,n,r,o){"use strict";function a(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),a(i),a(s),a(n),a(r),a(o)}),define("form_elements/button",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buttonStyleModel=(e=>({backgroundColor:e.backgroundColor,border:"1px solid "+e.borderColor,color:e.fontColor,cursor:"pointer",padding:[5,8]}))}),define("reusable_style",["require","exports","form_elements/button"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("annotations/after",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.after=function(e){return(t,s)=>(function(e,t,s){const n=e[t];return{value:i.after(s,n)}})(t,s,e)}}),define("other/disposable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("other/animation_loop",["require","exports","map"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=[],n=new i.Map,r=new i.Map;let o=0;class a{static registerCallback(e,t=!1,i=60){const a=o;return o++,t?s.unshift(a):s.push(a),n.set(a,{callback:e,then:performance.now(),fps:i,running:!1}),r.set(e,a),1===n.size&&function e(){requestAnimationFrame(t=>{if(n.size>0){let i=0,r=s.length;const o=s.length;for(;r--;){const e=s[o-1-r],a=n.get(e);if(a&&t-a.then>1e3/a.fps&&!a.running){const e=a.callback(t);e instanceof Promise?(a.running=!0,e.then(()=>{a.running=!1,a.then=t})):a.then=t,i+=performance.now()-t}}e()}})}(),a}static debounceMethod(e,t=1e3/60){let i=-1;return(...s)=>{i>-1&&this.cancelAnimationFrame(i),i=a.requestDelay(()=>new Promise(t=>{i=-1,e(...s),t()}),t)}}static throttleMethod(e,t=1e3/60,{leading:i,trailing:s}={leading:!0,trailing:!0}){let n=!1,r=!1;return(...o)=>{n?s&&(r=!0):(i?e(...o):r=!0,n=!0,a.requestDelay(()=>new Promise(t=>{r&&e(...o),n=!1,t()}),t))}}static removeCallback(e){r.has(e)&&this.cancelAnimationFrame(r.get(e))}static removeCallbackById(e){n.has(e)&&(s.splice(s.indexOf(e),1),r.delete(n.get(e).callback),n.delete(e))}static cancelAnimationFrame(e){this.removeCallbackById(e)}static requestAnimationFrame(e,t=!1){const i=this.registerCallback(function(t){e(t),a.cancelAnimationFrame(i)},t,1e3);return i}static requestDelay(e,t,i=!1){const s=this.registerCallback(function(t){e(t),a.cancelAnimationFrame(s)},i,1e3/t);return s}}t.AnimationLoop=a}),define("other/cancellation_token",["require","exports","log","map","underscore","other/animation_loop"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(...e){this.cancelled=!1,this.cleanupFunctions=e||[]}cancel(){this.isCanceled()||(this.cancelled=!0,this.cleanupFunctions.forEach(e=>e()),delete this.cleanupFunctions,this.cancelAllChannels())}isCanceled(){return this.cancelled}throwIfCancelled(e="Token cancelled"){if(this.isCanceled())throw new Error(e)}chain(e,t=!1){return this.registerCleanupFunction(()=>e.cancel()),t&&e.registerCleanupFunction(()=>this.cancel()),this}setTimeout(e,t=0){const i=setTimeout(e,t);return this.registerCleanupFunction(()=>{clearTimeout(i)}),i}setInterval(e,t){const i=setInterval(e,t);return this.registerCleanupFunction(()=>{clearInterval(i)}),i}requestAnimationFrame(e){const t=r.AnimationLoop.requestAnimationFrame(e);return this.registerCleanupFunction(()=>{r.AnimationLoop.cancelAnimationFrame(t)}),this}requestAnimationFrameOnRepeat(e){const t=this;let i=r.AnimationLoop.requestAnimationFrame(function s(n){t.isCanceled()||(i=r.AnimationLoop.requestAnimationFrame(s),e(n))});return this.registerCleanupFunction(()=>{r.AnimationLoop.cancelAnimationFrame(i)}),this}subscribe(e,t){return i.logService.assertDefined(t),i.logService.assert(n.isFunction(t),"Callback must be a function"),this.registerCleanupFunction(e.subscribe(t).cancel),this}subscribeOnce(e,t){return i.logService.assertDefined(t),i.logService.assert(n.isFunction(t),"Callback must be a function"),this.registerCleanupFunction(e.subscribeOnce(t).cancel),this}subscribeToStream(e,t,i){const s=e.subscribe(t,i);return this.registerCleanupFunction(()=>{try{s.unsubscribe()}catch(e){}}),this}subscribeToBrokerTopic(e,t,i){const s=e.subscribe(t,i);return this.registerCleanupFunction(()=>{e.unsubscribe(t,s)}),this}addDomEvent(e,t,i,s){if(e instanceof HTMLElement)e.addEventListener(t,i,s),this.registerCleanupFunction(()=>e.removeEventListener(t,i));else{const n=$(e);n.on(t,i,s),this.registerCleanupFunction(()=>n.off(t,i))}return this}addCleanupFunction(e){return this.registerCleanupFunction(e)}registerCleanupFunction(e){return this.throwIfCancelled("Adding clean up function to token that is already cancelled"),this.cleanupFunctions.push(e),this}registerDisposable(e){return this.registerCleanupFunction(e.dispose.bind(e)),this}createChannel(e){if(void 0===this.channels&&(this.channels=new s.Map),this.isValidChannel(e))throw new Error("Cannot overwrite existing channel if it has not been cancelled!");const t=new o;return this.channels.set(e,t),t}getChannel(e){return void 0!==this.channels&&this.isValidChannel(e)||this.createChannel(e),this.channels.get(e)}cancelChannel(e){this.channels&&this.isValidChannel(e)&&this.channels.get(e).cancel()}cancelAndRecreateChannel(e){return this.cancelChannel(e),this.createChannel(e)}cancelAllChannels(){this.channels&&this.channels.size>0&&this.channels.keys().forEach(e=>{this.cancelChannel(e)})}isValidChannel(e){return this.channels.has(e)&&!this.channels.get(e).isCanceled()}}t.CancellationToken=o}),define("annotations/cancellable",["require","exports","other/cancellation_token"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancellable=function(e){return(t,s)=>(function(e,t,s){const n=e[t];return{value:function(...e){const t=e[e.length-1];if(t instanceof i.CancellationToken)return t.isCanceled()?s:n.apply(this,e);if(void 0!==t)throw new Error("Incorrect use of @Cancellable annotation, last argument must be a canncellation token");return n.apply(this,e)}}})(t,s,e)}}),define("annotations/debounce",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=function(e,t=!1){return(s,n)=>(function(e,t,s,n=!1){const r=e[t];return{value:i.debounce(r,s,n)}})(s,n,e,t)}}),define("annotations/delay",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=function(e,t=!1){return(t,s)=>(function(e,t,s,n=!1){const r=e[t];return{value:i.delay(r,s)}})(t,s,e)}}),define("annotations/deprecated",["require","exports","log"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deprecated=function(e){return(t,s)=>(function(e,t,s){const n=e[t];return{value:i.logService.deprecated(n,s,t)}})(t,s,e)}}),define("annotations/memoize",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memoize=function(e){return(t,s)=>(function(e,t,s){const n=e[t];return{value:i.memoize(n,s)}})(t,s,e)}}),define("annotations/meta",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.meta=function(e){return(i,s)=>(function(e,i,s){i?e[i][t.metaSymbol]=s:e[t.metaSymbol]=s})(i,s,e)},t.getMetadata=function(e){return e[t.metaSymbol]},t.metaSymbol="@meta"}),define("annotations/order",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.order=function(e){return t=>(function(e,t){e.__order=t})(t,e)}}),define("annotations/post_check",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postCheck=function(e){return(t,s)=>(function(e,t,s){if(!i.isFunction(e[t]))throw new Error("postcheck annotation only works for functions");i.isArray(s)||(s=[s]);const n=e[t];return{value:function(...e){n.apply(this,e),s.forEach(t=>{t.call(this,e)})}}})(t,s,e)}}),define("annotations/pre_check",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preCheck=function(e,t){return(s,n)=>(function(e,t,s,n){if(!i.isFunction(e[t]))throw new Error("precheck annotation only works for functions");i.isArray(s)||(s=[s]);const r=e[t];return{value:function(...e){let t=!1;const i=[],o=n(e);if(s.forEach(e=>{e.call(this,o,{abort(){t=!0},waitFor(e){i.push(e)}})}),!t)if(i.length>0){let t=i.length;i.forEach(i=>i.then(()=>{0==--t&&r.apply(this,e)}))}else r.apply(this,e)}}})(s,n,e,t||i.identity)}}),define("annotations/throttle",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=function(e,t){return(s,n)=>(function(e,t,s,n){const r=e[t];return{value:i.throttle(r,s,n)}})(s,n,e,t)}}),define("async/jobs",["require","exports","other/cancellation_token"],function(e,t,i){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PENDING=0]="PENDING",e[e.WORKING=1]="WORKING",e[e.DONE=2]="DONE"}(s=t.JobState||(t.JobState={}));t.JobRunner=class{constructor(){this.jobQueue=[]}addJob(e){const t={token:new i.CancellationToken,model:e,state:s.PENDING};return void 0===this.activeJob||t.model.options.background?this.runJob(t):new Promise((e,i)=>{this.queueJob(t,{resolve:e,reject:i})})}async runJob(e){if(e.model.options.background)return await e.model.run();{if(void 0!==this.activeJob&&this.activeJob.state!==s.DONE)throw new Error("illegal state exception: active job is not done");this.activeJob=e;const t=await this.activeJob.model.run();return this.activeJob=void 0,t}}queueJob(e,t){const i=Object.assign({resolve:t.resolve,reject:t.reject},e);i.token.addCleanupFunction(()=>t.reject());for(let t=this.jobQueue.length-1;t>=-1;t--){if(-1===t)return void this.jobQueue.splice(0,0,i);this.jobQueue[t].model.options.priority<=e.model.options.priority&&this.jobQueue.splice(t+1,0,i)}}cancelAllJobs(){this.activeJob&&(this.activeJob.token.cancel(),this.activeJob=void 0),this.jobQueue.forEach(e=>e.token.cancel()),this.jobQueue.length=0}cancelJobsByType(e){this.activeJob&&this.activeJob.model.type===e&&(this.activeJob.token.cancel(),this.activeJob=void 0);for(let t=this.jobQueue.length-1;t>=0;t--)this.jobQueue[t].model.type===e&&(this.jobQueue[t].token.cancel(),this.jobQueue.splice(t,1))}}}),define("interfaces/generic_object_feature",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("other/object_utils",["require","exports","log","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static hasProperties(e,t){return s.isArray(t)||(t=[t]),s.reduce(t,(t,i)=>t&&void 0!==e[i],void 0!==e)}static hasPropertyChain(e,t){s.isArray(t)||(t=[t]);let i=!0;for(;i&&t.length>0;){i=void 0!==(e=e[t.shift()])}return i}static applyFunctionIfAble(e,t,...r){if(n.hasProperties(e,t)&&s.isFunction(e[t])){const i=e[t].apply(e,r);return void 0===i||i}return i.logService.verbose("unable to apply function "+t+" on "+e,{name:"ObjectUtils",style:""},{functionName:t,context:e,arguments:r}),!1}static isTweenable(e){return this.hasProperties(e,["getTweenableAttributes"])}static isCloneable(e){return this.hasProperties(e,["clone"])}static isMergeable(e){return this.hasProperties(e,["merge"])}}t.ObjectUtils=n}),define("classes/color",["require","exports","log","other/object_utils","math_utils"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={name:"Color",style:""};class o{constructor(e){if(this.a=0,this.r=0,this.g=0,this.b=0,this.h=0,this.sHSV=0,this.sHSL=0,this.l=0,this.v=0,this.i=0,this.transcendedA=!1,this.transcendedR=!1,this.transcendedG=!1,this.transcendedB=!1,this.transformations=[],e instanceof o)return void this.merge(e);let t=e;if(void 0!==t&&t.match(new RegExp("#?[0-9a-fA-F]{3,8}"))){"#"===t.charAt(0)&&(t=t.slice(1));const e=parseInt(t,16);switch(t.length){case 8:this.a=Math.round((e>>24&255)/2.55)/100,this.r=e>>16&255,this.g=e>>8&255,this.b=255&e;break;case 6:this.a=1,this.r=e>>16&255,this.g=e>>8&255,this.b=255&e;break;case 4:this.a=Math.round((e>>12&15)/.15)/100,this.r=Math.round((e>>8&15)/15*255),this.g=Math.round((e>>4&15)/15*255),this.b=Math.round((15&e)/15*255);break;case 3:this.a=1,this.r=Math.round((e>>8&15)/15*255),this.g=Math.round((e>>4&15)/15*255),this.b=Math.round((15&e)/15*255);break;default:this.a=0,this.r=0,this.g=0,this.b=0}}this.adaptByRGB()}get s(){return this.sHSV}set s(e){this.sHSV=e}getTweenableAttributes(){return["a","r","g","b"]}onAfterTween(){this.adaptByRGB()}static seededRandom(e){return void 0===e?Math.random:function(){return(e=1e4*Math.sin(e))-Math.floor(e)}}static random(e){const t=this.seededRandom(e);return o.fromRGB(Math.floor(255*t()),Math.floor(255*t()),Math.floor(255*t()))}static fromJson(e){const t=this.fromRGB(e.r,e.g,e.b);return s.ObjectUtils.hasProperties(e,"a")&&t.setAlpha(e.a),t}toJson(){return{a:this.a,r:this.r,g:this.g,b:this.b}}static fromRGB(e,t,i){return o.fromARGB(1,e,t,i)}setChroma(e,t,i,s){return this.setAlpha(e,!0),this.setRedValue(t,!0),this.setGreenValue(i,!0),this.setBlueValue(s,!0),this}extractChroma(e){return this.setAlpha(e.a,!0),this.setRedValue(e.r,!0),this.setGreenValue(e.g,!0),this.setBlueValue(e.b,!0),this}static fromARGB(e,t,i,s){return(new o).setChroma(e,t,i,s)}static fromRGBA(e,t,i,s){return this.fromARGB(s,e,t,i)}static addCustomColor(e,t){const i=new o(t);return o.customColors[e]=((e=1)=>o.fromARGB(e,i.r,i.g,i.b)),i}static getCustomColor(e){return o.customColors[e]}static getCustomColors(){return o.customColors}setARGB(e,t,i,s){return this.a=e,this.r=t,this.g=i,this.b=s,this.adaptByRGB(),this}compareTo(e){return this.isEqualTo(e)}isEqualTo(e){return this.a===e.a&&(this.r===e.r&&(this.g===e.g&&this.b===e.b))}isBiggerThan(e){return[this.a>e.a,this.r>e.r,this.g>e.g,this.b>e.b]}isBiggerOrEqualTo(e){return[this.a>=e.a,this.r>=e.r,this.g>=e.g,this.b>=e.b]}isSmallerThan(e){return[this.a<e.a,this.r<e.r,this.g<e.g,this.b<e.b]}isSmallerOrEqualTo(e){return[this.a<=e.a,this.r<=e.r,this.g<=e.g,this.b<=e.b]}clone(){return void 0!==this.a?o.fromRGBA(this.r,this.g,this.b,this.a):o.fromRGB(this.r,this.g,this.b)}addColorTransformation(e=0,t=0,i=0,s=0,n=0,r=0,o=0,a=0,l=0,c=0){this.transformations.push({a:e,r:t,g:i,b:s,h:n,s:r,v:o,i:a,l:l,sHSL:c})}lighten(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=Math.round(2.55*e),o=n.generalMathUtils.clamp(this.r+s,0,255),a=n.generalMathUtils.clamp(this.g+s,0,255),l=n.generalMathUtils.clamp(this.b+s,0,255);return t?this.clearTransformationStack():this.addColorTransformation(0,o-this.r,a-this.g,l-this.b),this.setARGB(this.a,o,a,l),this}getNegative(){const e=this.clone();return e.setRedValue(255-this.r,!0),e.setGreenValue(255-this.g,!0),e.setBlueValue(255-this.b,!0),e}darken(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=Math.round(2.55*e),o=n.generalMathUtils.clamp(this.r-s,0,255),a=n.generalMathUtils.clamp(this.g-s,0,255),l=n.generalMathUtils.clamp(this.b-s,0,255);return t?this.clearTransformationStack():this.addColorTransformation(0,o-this.r,a-this.g,l-this.b),this.setARGB(this.a,o,a,l),this}saturate(e,t=!1,s=!1){i.logService.assertValueInRange(e,0,100,r,this);const n=e/100;let o;return s?(o=this.sHSL+n,this.setHSLSaturation(o,t)):(o=this.s+n,this.setSaturation(o,t)),this}desaturate(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.s-s;return this.setSaturation(n,t),this}increaseHue(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=Math.floor(3.6*e),n=this.h+s;return this.setHue(n,t),this}decreaseHue(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=Math.floor(3.6*e),n=this.h-s;return this.setHue(n,t),this}increaseValue(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.v+s;return this.setValue(n,t),this}decreaseValue(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.v-s;return this.setValue(n,t),this}increaseLuminosity(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.l+s;return this.setLuminosity(n,t),this}decreaseLuminosity(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.l-s;return this.setLuminosity(n,t),this}increaseIntensity(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.i+s;return this.setIntensity(n,t),this}decreaseIntensity(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.i-s;return this.setIntensity(n,t),this}fadeIn(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.a+s;return this.setAlpha(n,t),this}fadeOut(e,t=!1){i.logService.assertValueInRange(e,0,100,r,this);const s=e/100,n=this.a-s;return this.setAlpha(n,t),this}reverseTransformation(e=1){if(this.transformations.length>0){let t;e=e<=this.transformations.length?e:this.transformations.length;for(let i=0;i<e;i++)t=this.transformations.pop(),this.a-=t.a,0!==t.h||0!==t.s||0!==t.v?(this.h-=t.h,this.s-=t.s,this.v-=t.v,this.adaptByHSV()):(this.r-=t.r,this.g-=t.g,this.b-=t.b,this.adaptByRGB())}return this}reset(){return this.reverseTransformation(this.transformations.length),this}clearTransformationStack(){return this.transformations.length=0,this}setAlpha(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(e-this.a),this.a=e,this}setRedValue(e,t=!1){return e=n.generalMathUtils.clamp(e,0,255),t?this.clearTransformationStack():this.addColorTransformation(0,e-this.r),this.r=e,this.adaptByRGB(),this}setGreenValue(e,t=!1){return e=n.generalMathUtils.clamp(e,0,255),t?this.clearTransformationStack():this.addColorTransformation(0,0,e-this.g),this.g=e,this.adaptByRGB(),this}setBlueValue(e,t=!1){return e=n.generalMathUtils.clamp(e,0,255),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,e-this.b),this.b=e,this.adaptByRGB(),this}setValue(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,0,0,e-this.v),this.v=e,this.adaptByHSV(),this}setHue(e,t=!1){return e=Math.round(n.generalMathUtils.clamp(e%360,0,360)),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,e-this.h),this.h=e,this.adaptByHSV(),this}setSaturation(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,0,e-this.s),this.s=e,this.adaptByHSV(),this}setHSLSaturation(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,0,0,0,0,0,e-this.sHSL),this.s=e,this.adaptByHSL(),this}setIntensity(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,0,0,0,e-this.i),this.i=e,this.adaptByHSI(),this}setLuminosity(e,t=!1){return e=n.generalMathUtils.clamp(e,0,1),t?this.clearTransformationStack():this.addColorTransformation(0,0,0,0,0,0,0,0,e-this.l),this.l=e,this.adaptByHSL(),this}add(e,t=!1){return this.clone().addFast(e,t)}subtract(e,t=!1){return this.clone().subtractFast(e,t)}addFast(e,t=!1){return this.a=Math.min(this.a+e.a,1),this.r+=e.r,this.g+=e.g,this.b+=e.b,t||(this.setAlpha(this.a),this.setRedValue(this.r),this.setGreenValue(this.g),this.setBlueValue(this.b)),this.r>=0&&this.g>=0&&this.b>=0&&this.adaptByRGB(),this}subtractFast(e,t=!1){return this.a-=e.a,this.r-=e.r,this.g-=e.g,this.b-=e.b,t||(this.setAlpha(this.a),this.setRedValue(this.r),this.setGreenValue(this.g),this.setBlueValue(this.b)),this.r>=0&&this.g>=0&&this.b>=0&&this.adaptByRGB(),this}transcend(e){return this.transcendedA?(this.a=-this.a,this.transcendedA=!1):this.a<0&&(this.a=-this.a,this.transcendedA=!0),void 0!==e&&e.transcendedA&&(this.a=-this.a),this.transcendedR?(this.r=-this.r,this.transcendedR=!1):this.r<0&&(this.r=-this.r,this.transcendedR=!0),void 0!==e&&e.transcendedR&&(this.r=-this.r),this.transcendedG?(this.g=-this.g,this.transcendedG=!1):this.g<0&&(this.g=-this.g,this.transcendedG=!0),void 0!==e&&e.transcendedG&&(this.g=-this.g),this.transcendedB?(this.b=-this.b,this.transcendedB=!1):this.b<0&&(this.b=-this.b,this.transcendedB=!0),void 0!==e&&e.transcendedB&&(this.b=-this.b),this}multiply(e){let t;this.transcend(),e instanceof o&&e.transcend(),t=e instanceof o?e.a:e;const i=Math.round(this.a*t*100)/100;t=e instanceof o?e.r:e;const s=Math.abs(Math.round(this.r*t))%256;t=e instanceof o?e.g:e;const n=Math.abs(Math.round(this.g*t))%256;t=e instanceof o?e.b:e;const r=Math.abs(Math.round(this.b*t))%256;this.a=i,this.r=s,this.g=n,this.b=r,this.addColorTransformation(i,s,n,r);const a=e instanceof o?e:void 0;return this.transcend(a),e instanceof o&&e.transcend(),this.r>=0&&this.g>=0&&this.b>=0&&this.adaptByRGB(),this}merge(e){return this.a=e.a,this.r=e.r,this.g=e.g,this.b=e.b,this.h=e.h,this.s=e.s,this.v=e.v,this.l=e.l,this.i=e.i,this.transformations.length=0,this}round(e=0){return this.clone().roundFast(e)}roundFast(e=0){const t=Math.pow(10,e);return this.a=Math.round(this.a*t)/t,this.r=Math.round(this.r*t)/t,this.g=Math.round(this.g*t)/t,this.b=Math.round(this.b*t)/t,this.b=Math.round(this.b*t)/t,this.h=Math.round(this.h*t)/t,this.s=Math.round(this.s*t)/t,this.v=Math.round(this.v*t)/t,this.i=Math.round(this.i*t)/t,this.l=Math.round(this.l*t)/t,this}toHex8(){const e=Math.round(255*this.a);return 0===e?this.toHex6("#00"):this.toHex6("#"+e.toString(16))}toHex6(e="#"){return e+(16777216+65536*Math.round(this.r)+256*Math.round(this.g)+Math.round(this.b)).toString(16).slice(1)}toHex4(){return this.toHex3("#"+Math.round(15*this.a).toString(16))}toHex3(e="#"){return e+(4096+256*Math.floor(this.r/16)+16*Math.floor(this.g/16)+Math.floor(this.b/16)).toString(16).slice(1)}toRGBAString(){return"rgba("+Math.round(this.r)+", "+Math.round(this.g)+", "+Math.round(this.b)+", "+this.a+")"}toHSVAString(){return this.roundFast(2),"hsva("+Math.round(this.h)+", "+this.s+", "+this.v+", "+this.a+")"}toHSLAString(){return this.roundFast(2),"hsla("+Math.round(this.h)+", "+this.sHSL+", "+this.l+", "+this.a+")"}toHSIAString(){return this.roundFast(2),"hsia("+Math.round(this.h)+", "+this.s+", "+this.i+", "+this.a+")"}adaptByRGB(){const e=this.r/255,t=this.g/255,i=this.b/255,s=Math.max(e,t,i),n=Math.min(e,t,i),r=s-n;this.h=0===r?0:s===e?(t-i)/r%6*60:s===t?60*((i-e)/r+2):60*((e-t)/r+4),this.h<0&&(this.h+=360),this.h=Math.round(this.h),this.s=0===s?0:r/s,this.v=s,this.i=(e+t+i)/3,this.l=(s+n)/2,this.sHSL=(s-n)/(1-(2*this.l-1))}adaptByHSV(){const e=this.v*this.s,t=e*(1-Math.abs(this.h/60%2-1)),i=this.v-e;this.adaptByHCXm(e,t,i),this.l=this.v-e/2,this.sHSL=e/(1-(2*this.l-1))}adaptByHCXm(e,t,i){let s,n,r;return this.h>360&&(this.h=this.h%360),this.h<60?(s=e,n=t,r=0):this.h>=60&&this.h<120?(s=t,n=e,r=0):this.h>=120&&this.h<180?(s=0,n=e,r=t):this.h>=180&&this.h<240?(s=0,n=t,r=e):this.h>=240&&this.h<300?(s=t,n=0,r=e):(s=e,n=0,r=t),this.r=Math.round(255*(s+i)),this.g=Math.round(255*(n+i)),this.b=Math.round(255*(r+i)),this.i=(s+n+r)/3,{r:s,g:n,b:r}}adaptByHSL(){const e=(1-Math.abs(2*this.l-1))*this.sHSL,t=e*(1-Math.abs(this.h/60%2-1)),i=this.l-e/2,s=this.adaptByHCXm(e,t,i);return this.v=2*this.l-Math.min(s.r,s.g,s.b),this}adaptByHSI(){let e,t,i,s=n.trigonometryUtils.degreesToRadians(this.h);const r=(1-this.s)/3,o=()=>(1+this.s*Math.cos(s)/Math.cos(Math.PI/3-s))/3,a=(e,t)=>1-e-t,l=e=>3*e*this.i;return this.h<=120?t=a(i=r,e=o()):120<this.h&&this.h<=240?(s-=2*Math.PI/3,e=r,i=a(t=o(),e)):240<this.h&&this.h<=360&&(s-=4*Math.PI/3,e=a(t=r,i=o())),e=l(e),t=l(t),i=l(i),this.v=Math.max(e,t,i),this.l=(this.v+Math.min(e,t,i))/2,this.sHSL=2*this.l/(1-(2*this.l-1)),this.r=Math.round(255*e),this.g=Math.round(255*t),this.b=Math.round(255*i),this}static TRANSPARENT_COLOR(){return new o}static BLACK(e=1){return o.fromARGB(e,0,0,0)}static WHITE(e=1){return o.fromARGB(e,255,255,255)}static CREAM_WHITE(e=1){return o.fromARGB(e,255,247,220)}static GREY(e=1){return o.fromARGB(e,150,150,150)}static ICON_GREY(e=1){return o.fromARGB(e,112,121,121)}static MID_VALUE_GREY(e=1){return o.fromARGB(e,128,128,128)}static SHADE(e=1){return o.fromARGB(e,185,185,185)}static LIGHT_GREY(e=1){return o.fromARGB(e,220,220,220)}static GREEN(e=1){return o.fromARGB(e,0,255,0)}static LIGHT_GREEN(e=1){return o.fromARGB(e,0,128,0)}static LEMON_YELLOW(e=1){return o.fromARGB(e,255,247,0)}static SHADOW_GREY(e=1){return o.fromARGB(e,102,102,102)}static DARK_GREY(e=1){return o.fromARGB(e,75,75,75)}static NO_DATA_GREY(e=1){return o.fromARGB(e,52,73,94)}static LIGHT_CYAN(e=1){return o.fromARGB(e,226,255,255)}static CYAN(e=1){return o.fromARGB(e,0,255,255)}static BLUE(e=1){return o.fromARGB(e,0,0,255)}static LAWN_GREEN(e=1){return o.fromARGB(e,124,252,0)}static AQUA(e=1){return o.CYAN(e)}static FUCHSIA(e=1){return o.fromARGB(e,255,0,255)}static MITHRIL(e=1){return o.fromARGB(e,234,242,247)}static DEFAULT_BRANDING_COLOR(e=1){const t=o.fromARGB(e,0,137,192);return t.setAlpha(e),t}static NEGATIVE_SENTIMENT_COLOR(e=1){const t=o.fromARGB(e,231,76,60);return t.setAlpha(e),t}static NEUTRAL_SENTIMENT_COLOR(e=1){const t=o.fromARGB(e,242,193,0);return t.setAlpha(e),t}static POSITIVE_SENTIMENT_COLOR(e=1){const t=o.fromARGB(e,31,206,110);return t.setAlpha(e),t}static RED(e=1){return o.fromARGB(e,255,0,0)}static ORANGE(e=1){return o.fromARGB(e,255,127,0)}}o.customColors={},t.Color=o}),define("enums/theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/color_palette",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/color_palette_builder",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e){this.themeId=e}}t.ColorPaletteBuilder=i;class s extends i{constructor(e,t){super(t),this.builders=e.map(e=>new e(t))}build(){return this.builders.reduce((e,t)=>Object.assign({},e,t.build()),{})}}t.CombinedColorPaletteBuilder=s,t.combineColorPalettes=function(e){return s.bind(s,e)}}),define("classes/iterator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Iterator=class{constructor(e){this.index=0,this.data=e}hasNext(){return this.index<this.data.length}reset(){return this.index=0,this}next(){const e=this.data[this.index];return this.index++,e}}}),define("interfaces/video_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("other/string_utils",["require","exports","underscore","jquery","classes/relayed_constants","annotations/deprecated"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{static recoverApostrophes(e){return e.replace("&#039;","'").replace("&#39;","'")}static updateStringUtilConstants(){this.numberSuffixes=[n.RelayedConstants.number_prefixes.kilo,n.RelayedConstants.number_prefixes.mega,n.RelayedConstants.number_prefixes.giga,n.RelayedConstants.number_prefixes.tera,n.RelayedConstants.number_prefixes.peta,n.RelayedConstants.number_prefixes.exa],this.useHighPrecisionFormatting=n.RelayedConstants.project.settings.useHighPrecisionFormatting}static formatNumber(e,t=1,i=this.useHighPrecisionFormatting){const s=Math.pow(10,t);let n=""+(e=Math.round(e*s)/s);const r=this.getDecimalSign(n),o=""!==r,a=n.substring(0,n.indexOf(r)),l=o?a.length:n.length;let c=Math.floor((l-1)/3);if(i&&c--,(c=Math.min(c,this.numberSuffixes.length))>0){o&&(n=a);const e=n.substring(0,n.length-(3*c-t)),i=this.numberSuffixes[c-1];return parseInt(e)/s+(void 0===i?"":i)}return e+""}static getDecimalSign(e){return e.indexOf(".")>=0?".":e.indexOf(",")>=0?",":""}static parseFilters(e){return i.isUndefined(e)?[]:e.split(";").map(function(e){const t=e.split("="),i=t[0],s=t.slice(1).join("=");return{key:i,value:s,toString:function(){return i+":"+s}}})}static containsHTML(e){return s("<div>").html(e).children().length>0}static stripHTML(e){return s("<div>").append(e).text()}static trim(e,t){t=t?`[${t}]`:"\\s";const i=new RegExp(`^${t}+|${t}+$`,"gi");return e.replace(i,"")}static isIMGOnly(e){return 0===e.indexOf("<img")&&e.indexOf(">")===e.length-1}static calculateHash(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return t>>>0}static replaceUnicodeValues(e){return"&#"===e.substring(0,2)&&(e=String.fromCharCode(parseInt(e.substring(2),10))),e}static sanitizeInputForHtmlAttribute(e){return e=e.replace(/\|/g,"\\|")}static getVideoHost(e,t){return i.find(t,(t,s)=>void 0!==i.find(t.patterns,t=>!!e.match(t)))}static isValidVideoUrl(e,t){return!!e&&i.some(t,(t,s)=>i.some(t.patterns,t=>!!e.match(t)))}static transformVideoUrl(e,t,i){const s=o.getVideoUrlPattern(e,t).exec(e)[1];let n=void 0!==i?i.replace("<%- id %>",s):e;return window.tw.pageState.getAllowedPages().isCommandCenter()&&(n+="?autoplay=1&loop=1&playlist="+s),n}static getVideoUrlPattern(e,t){let s=void 0;return i.find(t,t=>void 0!==(s=i.find(t.patterns,t=>!!e.match(t)))),s}static snakeCaseToCamelCase(e){return e.toLowerCase().split("_").map((e,t)=>t>0?e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():e.toLowerCase()).join("")}static pad(e,t,i=" ",s=!1){return e.length<t?s?"0".repeat(t-e.toString().length)+e.toString():e.toString()+"0".repeat(t-e.toString().length):e.toString()}}o.useHighPrecisionFormatting=!1,o.numberSuffixes=["K","M","G","T","P"],__decorate([r.deprecated("use numberFormatter instead"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Boolean]),__metadata("design:returntype",String)],o,"formatNumber",null),t.StringUtils=o}),define("classes/relayed_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayedConstants={number_prefixes:{},project:{settings:{}}}}),define("interfaces/generic_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("dom/dom_math",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{static isPointOnElement(e,t){return e.x>=t.offset().left&&e.y>=t.offset().top&&e.x<=t.offset().left+t.outerWidth()&&e.y<=t.offset().top+t.outerHeight()}static pointRelativeToElement(e,t){return{x:e.x-t.offset().left,y:e.y-t.offset().top}}static isPointOnUpperHalf(e,t){return!!i.isPointOnElement(e,t)&&e.y<t.offset().top+t.outerHeight()/2}static isPointOnLowerHalf(e,t){return!!i.isPointOnElement(e,t)&&e.y>=t.offset().top+t.outerHeight()/2}static isPointOnLeftHalf(e,t){return!!i.isPointOnElement(e,t)&&e.x<t.offset().left+t.outerWidth()/2}static isPointOnRightHalf(e,t){return!!i.isPointOnElement(e,t)&&e.x>=t.offset().left+t.outerWidth()/2}static getPageBounds(){const e=$("body");return e.length>0?{left:window.pageXOffset+e.offset().left,top:window.pageYOffset,bottom:window.pageYOffset+$(window).outerHeight(),right:window.pageXOffset+Math.min(e.width(),$(window).outerWidth())+e.offset().left}:{left:window.pageXOffset,top:window.pageYOffset,bottom:window.pageYOffset+$(window).outerHeight(),right:window.pageXOffset+$(window).outerWidth()}}static hasVerticalScrollbar(){return document.body.scrollHeight>document.body.clientHeight}static hasHorizontalScrollbar(){return document.body.scrollWidth>document.body.clientWidth}static isOnScreen(e){const t=e.getBoundingClientRect();return t.top>-t.height&&t.left>-t.width&&t.top<window.innerHeight&&t.left<window.innerWidth}static isBottomOfPage(){return $(window).scrollTop()+$(window).height()===$(document).height()}static isTopOfPage(){return 0===$(window).scrollTop()}}t.DOMMath=i}),define("dom/dead_scroll",["require","exports","jquery","other/cancellation_token","dom/dom_math"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DeadScroll=class{constructor(e){this.config=e,this.initialize()}pause(){this.paused=!0}resume(){this.paused=!1}dispose(){this.cancellationToken.cancel()}initialize(){this.cancellationToken=new s.CancellationToken,this.cancellationToken.addDomEvent(this.config.target||i(document),"wheel",this.handleMouseWheelEvent.bind(this)),this.distanceTravelled={top:0,bottom:0},this.paused=!1;const{onScrollStop:e=_.noop,scrollStopDelay:t=0}=this.config;this.onScrollStop=_.debounce(e.bind(this),t,!1)}handleMouseWheelEvent(e){if(e.isDefaultPrevented()||!this.isEnabled())return;const t=e.originalEvent.deltaY,i=1.75*t;n.DOMMath.isBottomOfPage()&&t>0?(this.distanceTravelled={top:0,bottom:this.distanceTravelled.bottom+Math.abs(t)},this.distanceTravelled.bottom>=i&&(this.config.onScrollDown(),this.onScrollStop(),this.resetDistanceTravelled())):n.DOMMath.isTopOfPage()&&t<0&&(this.distanceTravelled={top:this.distanceTravelled.top+Math.abs(t),bottom:0},this.distanceTravelled.top>=i&&(this.config.onScrollUp(),this.onScrollStop(),this.resetDistanceTravelled())),this.setupResetTimer()}isEnabled(){if(this.paused)return!1;const{allowScrollbar:e=!0}=this.config;let t=!0;return e||(t=t&&!n.DOMMath.hasVerticalScrollbar()),t}setupResetTimer(){const{resetTime:e=0}=this.config;e>0&&(this.resetTimeout&&clearTimeout(this.resetTimeout),this.resetTimeout=setTimeout(()=>this.resetDistanceTravelled(),e))}resetDistanceTravelled(){this.distanceTravelled={top:0,bottom:0}}}}),define("dom/touch_scroll_handler",["require","exports","other/cancellation_token"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TouchScrollHandler=class{constructor(e){this.timerChannelName="TIMER",this.token=new i.CancellationToken,this.config=e,this.initialize()}initialize(){const{target:e=$(document)}=this.config;this.token.addDomEvent(e,"touchstart",this.handleTouchStart.bind(this)),this.token.addDomEvent(e,"touchmove",this.handleTouchMove.bind(this)),this.token.addDomEvent(e,"touchend",this.handleTouchEnd.bind(this)),this.isActive=!1}handleTouchStart(e){const t=e.originalEvent;this.startY=t.touches[0].clientY}handleTouchMove(e){const t=e.originalEvent,{clientY:i}=t.touches[0];this.canActivate(i)&&(this.config.onActivate(),this.isActive=!0)}canActivate(e){const{threshold:t}=this.config;return!this.paused&&!this.isActive&&Math.abs(e-this.startY)>=t}handleTouchEnd(){this.isActive&&this.refreshResetTimer()}refreshResetTimer(){const{onReset:e,resetTime:t}=this.config;this.token.getChannel(this.timerChannelName).cancel(),this.token.createChannel(this.timerChannelName).setTimeout(()=>{e(),this.isActive=!1},t)}dispose(){this.token.cancel()}pause(){this.paused=!0,this.isActive&&this.token.isValidChannel(this.timerChannelName)&&this.token.getChannel(this.timerChannelName).cancel()}resume(){this.paused=!1,this.isActive&&this.refreshResetTimer()}}}),define("formatter/number/number_formatter_interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("formatter/number/number_formatter",["require","exports","numeral","underscore"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NumberFormatter=class{constructor(e){this.config=e,this.registerLocale(e)}registerLocale(e){const t=this.generateLocaleId(e);try{i.register("locale",t,Object.assign({ordinal:e=>""+e,currency:{symbol:""}},e))}catch(e){}i.locale(t)}valuesToPercentages(e,t){if(void 0===t&&(t=s.reduce(e,(e,t)=>e+t,0)),0===t)return e.map(e=>this.toPercentage(0));const i={};e.forEach((e,t)=>{i[e]=i[e]||[],i[e].push(t)});const n=s.sortBy(e,e=>e),r=[];return n.reduce((e,s,o)=>{const a=i[s].pop();if(o===n.length-1)return r[a]=this.toPercentage(1-e),1;{const i=this.toPercentage(s/t),n=this.parse(i).value();return r[a]=i,e+n}},0),r}parse(e){return i(e)}generateLocaleId(e){const{abbreviations:t,delimiters:i}=e;return s.flatten([s.values(t),s.values(i)]).reduce((e,t)=>`${e}:${t}`)}assertNumber(e){if("number"!=typeof e)throw new Error(`${e} is not of type number! (${typeof e})`)}}}),define("formatter/number/formats/default_format",["require","exports","formatter/number/number_formatter"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultNumberFormatter=class extends i.NumberFormatter{toInteger(e){return this.assertNumber(e),this.parse(e).format("0a")}toDecimal(e){return this.assertNumber(e),this.parse(e).format("0[.]0a")}toPercentage(e){return this.assertNumber(e),this.parse(e).format("0.[0]a%")}toTime(e){return this.assertNumber(e),this.parse(e).format("00:00:00")}}}),define("formatter/number/formats/high_precision_number_formatter",["require","exports","formatter/number/number_formatter"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HighPrecisionNumberFormatter=class extends i.NumberFormatter{toInteger(e){return this.assertNumber(e),this.parse(e).format("0,a")}toDecimal(e){this.assertNumber(e);const t=this.parse(e);return Math.abs(e)>=1e9?t.format("0,.[000000]a"):t.format("0,.[0]")}toPercentage(e){return this.assertNumber(e),this.parse(e).format("0.[0]a%")}toTime(e){return this.assertNumber(e),this.parse(e).format("00:00:00")}}}),define("formatter/number/number_formatter_factory",["require","exports","formatter/number/formats/default_format","formatter/number/formats/high_precision_number_formatter"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NumberFormatterFactory=class{static build(e,t){return void 0!==t&&!0===t.highPrecision?new s.HighPrecisionNumberFormatter(e):new i.DefaultNumberFormatter(e)}}}),define("optimizations/object_pool",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ObjectPool=class{constructor(e){this.memory=new Array(e.initialPoolSize),this.settings=e,this.initialize()}initialize(){for(let e=0;e<this.memory.length;e++)this.memory[e]=this.settings.objectFactory()}getObject(...e){if(0!==this.memory.length)return this.initializeObject(this.memory.pop(),e);if(this.settings.flexible)return this.initializeObject(this.settings.objectFactory(),e);throw new Error("Object pool is empty")}initializeObject(e,t){return this.settings.initializationFunction?this.settings.initializationFunction(e,...t):e}recycleObject(e){this.settings.resetFunction&&this.settings.resetFunction(e),this.memory.push(e)}getObjects(e){if(this.settings.flexible&&this.memory.length<e)for(;this.memory.length<e;)this.memory.push(this.settings.objectFactory());else if(this.memory.length<e)throw new Error("Object pool does not have enough objects left to fullfil request");return this.memory.splice(this.memory.length-e,e).map(e=>e)}recycleObjects(e){this.memory=this.memory.concat(e)}}}),define("optimizations/property_link",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPropertyLink=function(e,t,i,s,n=!1){Object.defineProperty(e,t,{enumerable:!0,writable:!n,configurable:!0,get:()=>i[s],set(e){if(n)throw new Error("attempted to write on read only property");i[s]=e}})}}),define("other/array_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArrayUtils=class{static removeInPlace(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}}}),define("other/assign_recursive",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assignRecursive=function e(t,...i){return[t,...i].map(e=>Object.keys(e)).filter((e,t,i)=>i.lastIndexOf(e)===t).reduce((e,t)=>e.concat(t)).forEach(s=>{for(let n=0;n<i.length;n++)s in i[n]&&("object"==typeof i[n][s]&&"object"==typeof t[s]?e(t[s],i[n][s]):void 0!==i[n][s]&&(t[s]=i[n][s]))}),t}}),define("other/color_map",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SentimentColorMap={positive:"#1fce6e",neutral:"#f2c100",negative:"#e74c3c"}}),define("other/deep_clone",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepClone=function e(t){let i,s,n;if("object"!=typeof t)return t;if(!t)return t;if(t.constructor===Array){for(i=[],n=t.length,s=0;s<n;s++)i[s]=e(t[s]);return i}for(s in i={},t)i[s]=e(t[s]);return i}}),define("other/deep_freeze",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepFreeze=function e(t){return Object.getOwnPropertyNames(t).forEach(i=>{const s=t[i];"object"==typeof s&&null!==s&&e(s)}),Object.freeze(t)}}),define("other/key_codes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ESCAPE="esc",e.ENTER="enter",e.NUM_ENTER="num_enter",e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.SPACE="space",e.DELETE="delete",e.A="a",e.D="d",e.F="f",e.S="s",e.X="x",e.CTRL="ctrl"}(t.KeyCodes||(t.KeyCodes={}))}),define("other/keys",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.KEY_0=48]="KEY_0",e[e.KEY_1=49]="KEY_1",e[e.KEY_2=50]="KEY_2",e[e.KEY_3=51]="KEY_3",e[e.KEY_4=52]="KEY_4",e[e.KEY_5=53]="KEY_5",e[e.KEY_6=54]="KEY_6",e[e.KEY_7=55]="KEY_7",e[e.KEY_8=56]="KEY_8",e[e.KEY_9=57]="KEY_9",e[e.KEY_A=65]="KEY_A",e[e.KEY_B=66]="KEY_B",e[e.KEY_C=67]="KEY_C",e[e.KEY_D=68]="KEY_D",e[e.KEY_E=69]="KEY_E",e[e.KEY_F=70]="KEY_F",e[e.KEY_G=71]="KEY_G",e[e.KEY_H=72]="KEY_H",e[e.KEY_I=73]="KEY_I",e[e.KEY_J=74]="KEY_J",e[e.KEY_K=75]="KEY_K",e[e.KEY_L=76]="KEY_L",e[e.KEY_M=77]="KEY_M",e[e.KEY_N=78]="KEY_N",e[e.KEY_O=79]="KEY_O",e[e.KEY_P=80]="KEY_P",e[e.KEY_Q=81]="KEY_Q",e[e.KEY_R=82]="KEY_R",e[e.KEY_S=83]="KEY_S",e[e.KEY_T=84]="KEY_T",e[e.KEY_U=85]="KEY_U",e[e.KEY_V=86]="KEY_V",e[e.KEY_W=87]="KEY_W",e[e.KEY_X=88]="KEY_X",e[e.KEY_Y=89]="KEY_Y",e[e.KEY_Z=90]="KEY_Z",e[e.LEFT_META=91]="LEFT_META",e[e.RIGHT_META=92]="RIGHT_META",e[e.SELECT=93]="SELECT",e[e.NUMPAD_0=96]="NUMPAD_0",e[e.NUMPAD_1=97]="NUMPAD_1",e[e.NUMPAD_2=98]="NUMPAD_2",e[e.NUMPAD_3=99]="NUMPAD_3",e[e.NUMPAD_4=100]="NUMPAD_4",e[e.NUMPAD_5=101]="NUMPAD_5",e[e.NUMPAD_6=102]="NUMPAD_6",e[e.NUMPAD_7=103]="NUMPAD_7",e[e.NUMPAD_8=104]="NUMPAD_8",e[e.NUMPAD_9=105]="NUMPAD_9",e[e.MULTIPLY=106]="MULTIPLY",e[e.ADD=107]="ADD",e[e.SUBTRACT=109]="SUBTRACT",e[e.DECIMAL=110]="DECIMAL",e[e.DIVIDE=111]="DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUM_LOCK=144]="NUM_LOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.SEMICOLON=186]="SEMICOLON",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.DASH=189]="DASH",e[e.PERIOD=190]="PERIOD",e[e.FORWARD_SLASH=191]="FORWARD_SLASH",e[e.GRAVE_ACCENT=192]="GRAVE_ACCENT",e[e.OPEN_BRACKET=219]="OPEN_BRACKET",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.CLOSE_BRACKET=221]="CLOSE_BRACKET",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE"}(t.Keys||(t.Keys={}))}),define("other/math_utils",["require","exports","annotations/deprecated"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static distanceBetween2Points(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static clamp(e,t,i,s){return t=void 0!==t?t:e,i=void 0!==i?i:e,s?(e%=i)<t?e+i:e<i?e:e-i:e<t?t:e<i?e:i}static sign(e){return void 0!==Math.sign?Math.sign(e):0===(e=+e)||isNaN(e)?Number(e):e>0?1:-1}static toRadians(e,t=2){const i=Math.pow(10,t);return Math.round(Math.PI*e/180*i)/i}static toDegrees(e,t=2){const i=Math.pow(10,t);return Math.round(180*e/Math.PI*i)/i}static generateUuid(){return Math.floor(268435456*(1+Math.random()))}static lerp(e,t,i){return(1-i)*e+i*t}static getRandomRange(e,t,i=100){return(Math.floor(Math.random()*(t*i-e*i+1))+e*i)/i}static linearScale(e,t,i){return 0===e.min&&0===e.max?0:0===t.min&&0===e.max?0:(t.max-t.min)*((i-e.min)/(e.max-e.min))+t.min}static logarithmicScale(e,t,i){if(0===e.min&&0===e.max)return 0;if(0===t.min&&0===e.max)return 0;const s=i/(e.max-e.min);return Math.round(Math.pow(t.max-t.min+1,s)+t.min-1)}static reverseLog(e,t,i){return Math.log(i-t.min+1)/Math.log(t.max-t.min+1)*(e.max-e.min)}}__decorate([i.deprecated("vector2d class"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Number)],s,"distanceBetween2Points",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number,Boolean]),__metadata("design:returntype",Number)],s,"clamp",null),__decorate([i.deprecated("native function"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",Number)],s,"sign",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number]),__metadata("design:returntype",Number)],s,"toRadians",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number]),__metadata("design:returntype",Number)],s,"toDegrees",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Number)],s,"generateUuid",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number]),__metadata("design:returntype",Number)],s,"lerp",null),__decorate([i.deprecated("math_utils module"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number]),__metadata("design:returntype",Number)],s,"getRandomRange",null),t.MathUtils=s}),define("other/misc",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={};t.isAPIAvailable=function(e){if(void 0!==i[e])return i[e];const t=e.split(".");let s=window;for(let n=0,r=t.length;n<r;n++){if(void 0===s[t[n]])return i[e]=!1,!1;s=s[t[n]]}return i[e]=!0,!0}}),define("other/mixin",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{if("constructor"!==i)if("function"!=typeof e.prototype[i]||e.prototype[i].toString().includes("Method not implemented"))e.prototype[i]=t.prototype[i];else{const s=e.prototype[i];e.prototype[i]=function(){return s.apply(this,arguments),t.prototype[i].apply(this,arguments)}}})})}}),define("other/storage",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.name=e,this.keysStoreKey=this.name+"_keys"}get size(){return this.getKeys().length}getItemStoreKey(e){return this.name+"_item_"+e}get(e){return JSON.parse(window[this.storageType].getItem(this.getItemStoreKey(e)))}set(e,t){return this.addKey(e),window[this.storageType].setItem(this.getItemStoreKey(e),JSON.stringify(t)),this}delete(e){return window[this.storageType].removeItem(this.getItemStoreKey(e)),this.removeKey(e),this}clear(){return this.getKeys().forEach(e=>this.delete(e)),this}map(e){const t=[];return this.forEach((i,s)=>{t.push(e(i,s))}),t}forEach(e){this.getKeys().forEach(t=>{e(this.get(t),t)})}toObject(){const e={};return this.getKeys().forEach(t=>{e[t]=this.get(t)}),e}removeKey(e){const t=i.without(this.getKeys(),e);return window[this.storageType].setItem(this.keysStoreKey,JSON.stringify(t)),this}addKey(e){const t=this.getKeys();return-1===t.indexOf(e)&&t.push(e),window[this.storageType].setItem(this.keysStoreKey,JSON.stringify(t)),this}getKeys(){const e=JSON.parse(window[this.storageType].getItem(this.keysStoreKey));return null===e?[]:e}}t.StoredCollection=s;class n extends s{constructor(){super(...arguments),this.storageType="localStorage"}}t.LocalStorageCollection=n;t.SessionStorageCollection=class extends s{constructor(){super(...arguments),this.storageType="sessionStorage"}};t.LocalStorageArray=class{constructor(e){this.collection=new n(e)}get(e){return this.collection.get(String(e))}set(e,t){return this.collection.set(String(e),t),this}push(e){return this.collection.set(String(this.size),e),this}toArray(){return this.collection.map(e=>e)}delete(e){return this.collection.delete(String(e)),this}clear(){return this.collection.clear(),this}map(e){return this.collection.map((t,i)=>e(t,parseInt(i)))}forEach(e){this.collection.forEach((t,i)=>{e(t,parseInt(i))})}get size(){return this.collection.size}},t.StorageUtils={LocalStorage:{setObject(e,t){localStorage.setItem(e,JSON.stringify(t))},getObject:e=>JSON.parse(localStorage.getItem(e)),hasObject:e=>null!==localStorage.getItem(e)},SessionStorage:{setObject(e,t){sessionStorage.setItem(e,JSON.stringify(t))},getObject:e=>JSON.parse(sessionStorage.getItem(e)),hasObject:e=>null!==sessionStorage.getItem(e)}}}),define("other/style_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StyleUtils=class{static toPercentageString(e,t,i=0){const s=Number(100*e/t).toFixed(5);return 0!==i?`calc(${s}% - ${i}px`:`${s}%`}}}),define("other/topic_menu_select_style_utils",["require","exports"],function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ANYWHERE=0]="ANYWHERE",e[e.ARROW=1]="ARROW"}(i=t.ClickLocation||(t.ClickLocation={}));t.TopicMenuSelectStyleUtils=class{static buildBoxedStyleModel(){return{mainClass:"boxed-layout",containerClass:"clickable",selectionClass:"boxed-label",clickLocation:i.ANYWHERE,iconClass:"fa fa-caret-down toggle-button clickable"}}static buildLabelStyleModel(){return{containerClass:"label label-primary clickable align-with-icon",clickLocation:i.ANYWHERE,iconClass:"fa fa-caret-down"}}static buildButtonStyleModel(e){return{mainClass:"button-layout",containerClass:"clickable",selectionClass:"button-label",clickLocation:i.ANYWHERE,iconClass:`fa ${e} clickable`}}}}),define("promises/promise_timeout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=function(e,t,i,s={}){return new Promise((n,r)=>{const o=setTimeout(()=>{if(!s.rejectOnTimeout)throw new Error(i);r()},t);e.then((...e)=>{clearTimeout(o),n.apply(void 0,e)},(...e)=>{clearTimeout(o),r.apply(void 0,e)})})}}),define("promises/promise_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PromiseUtils=class{static cancellationPromise(e,t){return new Promise((i,s)=>{e.then(e=>t.isCanceled()?s({isCancelled:!0}):i(e),e=>t.isCanceled()?s({isCancelled:!0}):s(e))})}static async conditionalAwait(e,t){for(const i of t){if(!e())return Promise.reject();await i()}}}}),define("promises/wait_for",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitFor=function(e){return new Promise(t=>setTimeout(t,e))}}),define("proto/data_graph_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DataGraphUtils=class{static hasIndicatorFrames(e){return this.hasAdditionalFrames(e)&&!this.hasAnimationTimeFrame(e)&&!this.hasNestedFrames(e)}static hasAdditionalFrames(e){return void 0!==e.additional_frames&&e.additional_frames.length>0}static hasAnimationTimeFrame(e){return this.hasAdditionalFrames(e)&&void 0!==e.additional_frames[0].meta_data&&void 0!==e.additional_frames[0].meta_data.attributes.animation_timeframe}static hasDataFrameTypeX(e,t){return void 0!==e.additional_frames[0].meta_data&&e.additional_frames[0].meta_data.attributes.dataframe_type===t}static hasNestedFrames(e){return this.hasAdditionalFrames(e)&&this.hasDataFrameTypeX(e,"nested")}}}),define("proto/page_configuration_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PageConfigurationUtils=class{static getCurrentPage(e){return this.findPageRecursively(e.active_page_id,e.pages)}static findPageRecursively(e,t){let i;for(const s of t){if(s.id===e){i=s;break}if(void 0!==s.pages&&s.pages.length>0&&void 0!==(i=this.findPageRecursively(e,s.pages)))break}return i}}}),define("proto/topic_entry_utils",["require","exports","annotations/deprecated"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static isSelected(e){return"NODE"===e.selected}static isSelectedOrHoldsSelection(e){return s.isSelected(e)||e.children&&e.children.some(s.isSelectedOrHoldsSelection)}static canBeSelected(e){return!e.not_selectable}static hideChildren(e){return!!e.hide_children}static getChildrenCount(e){return s.hasChildren(e)?e.children.length:0}static getChildrenCountRecursive(e,t){let i=0;return s.iterateChildrenRecursive(e,e=>i+=s.getChildrenCount(e),{includeParent:!0,levelCount:t}),i}static getSelectedChildrenRecursively(e){const t=[];return s.iterateChildrenRecursive(e,e=>{t.push(...s.getSelectedChildren(e))},{includeParent:!0}),t}static hasChildren(e){return!!e.children&&e.children.length>0}static getChildren(e){return e.children?e.children:[]}static getParent(e,t){if(s.hasChildren(t)){if(t.children.some(t=>t.mapped_id===e.mapped_id))return t;{let i;return t.children.some(t=>{const n=s.getParent(e,t);return!!n&&(i=n,!0)}),i}}}static allChildrenSelected(e){return!s.hasChildren(e)||e.children.every(e=>s.isSelected(e))}static firstChildSelected(e){return s.hasChildren(e)?e.children.find(e=>s.isSelected(e)):void 0}static iterateChildrenRecursive(e,t,i={}){const{includeParent:n=!1}=i;n&&t(e),void 0!==i.levelCount&&(i.levelCount--,0===i.levelCount)||s.hasChildren(e)&&e.children.forEach(e=>{t(e),s.iterateChildrenRecursive(e,t,{includeParent:!1,levelCount:i.levelCount})})}static setSelection(e,t){e.selected=t?"NODE":"NONE"}static recursiveUnselectAndSelect(e,t,i){s.iterateChildrenRecursive(e,e=>s.setSelection(e,e.mapped_id===t),{includeParent:i})}static recursiveUnselectAll(e,t){this.iterateChildrenRecursive(e,e=>s.setSelection(e,!1),{includeParent:t})}static setSelectionRecursive(e,t,i){s.iterateChildrenRecursive(e,e=>s.setSelection(e,t),{includeParent:i})}static hasBreakLine(e){return!!e&&"SOLID_LINE"===e.breakline}static getFirstSelectedChild(e){if(s.hasChildren(e))return e.children.find(e=>s.isSelected(e))}static getFirstSelectedChildRecursive(e){let t=s.getFirstSelectedChild(e);if(t)return t;if(s.hasChildren(e))for(const i of e.children)if(t=s.getFirstSelectedChildRecursive(i))return t}static getSelectedChildren(e){return s.hasChildren(e)?e.children.filter(e=>s.isSelected(e)):[]}static getEntryByMappedId(e,t,i,n){if(e.mapped_id===t){if(void 0===n)return e;if(i.mapped_id===n)return e}const r=e.children;if(void 0!==r)for(let e=0;e<r.length;e++){const o=s.getEntryByMappedId(r[e],t,i,n);if(void 0!==o)return o}}static getEntriesRecursively(e,t=!1){const i=[];return t&&i.push(e),s.iterateChildrenRecursive(e,e=>i.push(e)),i}static getEntriesRecursivelyWithRoot(e){return this.getEntriesRecursively(e,!0)}static getAllLeavesRecursively(e){const t=[];return s.iterateChildrenRecursive(e,e=>{s.hasChildren(e)||t.push(e)}),t}static getFirstLeaf(e){const t=s.getAllLeavesRecursively(e);return t.length>0?t[0]:void 0}static isNotSelectable(e){return!0===e.not_selectable}static isEntryVisible(e){return void 0===e.visibility||"NOT_VISIBLE"!==e.visibility}}__decorate([i.deprecated("getFirstSelectedChild"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Object)],s,"firstChildSelected",null),t.TopicEntryUtils=s}),define("proto/topic_menu_utils",["require","exports","proto/topic_entry_utils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopicMenuUtils=class{static getMainNode(e){return this.getAllNode(e)||e.root_entry}static getAllNode(e){const{root_entry:{children:t=[]}={children:[]}}=e;return 1===t.length?e.root_entry.children[0]:void 0}static isLazyLoaded(e){return e.fetch_content_from_server||"COUNTRIES"===e.type}static hasAllNode(e){return 1===e.root_entry.children.length}static isSingleOrMultiple(e){return"SINGLE_OR_MULTIPLE"===e.root_entry.selection_type}static getFirstSelectedEntry(e){return i.TopicEntryUtils.isSelected(e.root_entry)?e.root_entry:i.TopicEntryUtils.getFirstSelectedChildRecursive(e.root_entry)}static getEntryByMappedId(e,t,s,n){return i.TopicEntryUtils.getEntryByMappedId(e.root_entry,t,s,n)}static getEntriesRecursively(e){const t=e.root_entry;return void 0!==t?[t,...i.TopicEntryUtils.getEntriesRecursively(t)]:[]}}}),define("proto/tw_tree_utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{static retrieveAllLeavesRecursively(e){const t=[];return void 0!==e.root&&void 0!==e.root.children&&e.root.children.length&&e.root.children.forEach(e=>{i.retrieveLeavesRecursively(e,t)}),t}static retrieveSmallestValue(e){const t=i.retrieveAllLeavesRecursively(e);return i.retrieveSmallestValueForLeaves(t)}static retrieveSmallestValueForLeaves(e){let t;return e.forEach(e=>{(void 0===t||e.metric.value<t)&&(t=e.metric.value)}),t}static retrieveLargestValue(e){const t=i.retrieveAllLeavesRecursively(e);return i.retrieveLargestValueForLeaves(t)}static retrieveLargestValueForLeaves(e){let t;return e.forEach(e=>{(void 0===t||e.metric.value>t)&&(t=e.metric.value)}),t}static retrieveLeavesRecursively(e,t){void 0!==e.children&&e.children.length>0?e.children.forEach(e=>{i.retrieveLeavesRecursively(e,t)}):t.push(e)}}t.TWTreeUtils=i}),define("url/url",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){if(e=decodeURIComponent(e),!i.isString(e))throw new Error(e+" is not a valid URL (expected string got "+typeof e+")");this.href=e,""===this.getHost()&&(this.relative=!0)}isRelative(){return this.relative}parseParameters(e){return this._tokenize(e)}isDataURL(){return!!this.href.match(s.isDataURLRegex)}removeSearch(){if(!this.hasSearch())return this;if(this.getHashCount()>0){const e=this.href.substring(this.href.indexOf("#"));this.href=this.href.substring(0,this.getSearchIndex())+e}else this.href=this.href.substring(0,this.getSearchIndex());return this}setSearch(e){if(this.hasSearch()&&this.removeSearch(),!e)return this;if(this.getHashCount()>0){const t=this.href.substring(this.href.indexOf("#"));this.href=this.href.substring(0,this._getPrimaryHashIndex())+"?"+e+t}else this.href+="?"+e;return this}getSearchParameters(){return this._tokenize(this.getSearch(),"")}getSearch(){if(!this.hasSearch())return"";let e=this.getSearchIndex();e++;let t=this._getPrimaryHashIndex();return-1===t?t=void 0:t-=e,this.href.substr(e,t)}getHref(){return this.href}setHref(e){return this.href=e,this}getUrlParameters(){return this.hasHash()?this._tokenize(decodeURIComponent(this.getParameterHash())):{}}storeSearchInHash(e){return this.setUrlParameter("search",e.split("=").join("|eq|").split("&").join("|and|")),this}hasSearchInHash(){return void 0!==this.getUrlParameter("search")}getSearchFromHash(){return this.getUrlParameter("search").split("|eq|").join("=").split("|and|").join("&")}removeSearchFromHash(){this.removeUrlParameter("search")}moveSearchFromHashToMainUrl(){if(this.hasSearchInHash()){const e=this.getSearchFromHash();this.removeSearchFromHash(),this.setSearch(e)}return this}hasHash(){return!!~this.href.indexOf("#")}getHashCount(){return this.href.split("#").length-1}hasParameterHash(){return""!==this.getParameterHash()}getParameterHash(){return this._hasSecondaryHash()?this._getSecondaryHash():this._hasPrimaryHash()&&"/"!==this._getPrimaryHash()[0]?this._getPrimaryHash():""}removeUrlParameter(e){const t=this.getUrlParameters();return delete t[e],this.setUrlParameters(t),this}setParameterHash(e){return this._hasSecondaryHash()?this._setSecondaryHash(e):this._hasPrimaryHash()&&"/"===this._getPrimaryHash()[0]?this._setSecondaryHash(e):this._setPrimaryHash(e),this}getLocalPath(){return this.hasLocalPath()?this._getPrimaryHash():""}setPath(){throw new Error("not implemented")}setHost(){throw new Error("not implemented")}setLocalPath(e){if(""!==e&&"/"!==e.substring(0,1))throw new Error(e+" is not a valid path");return this._hasPrimaryHash()&&this._getPrimaryHash()===this.getParameterHash()&&this._setSecondaryHash(this._getPrimaryHash()),this._setPrimaryHash(e),this}setUrlParameter(e,t){const i=this.getUrlParameters();return i[e]=t,this.setParameterHash(this._rebuildHash(i)),this}removeUrlParameters(){return this.hasHash()&&(this._hasSecondaryHash()?this._removeSecondaryHash():"/"!==this._getPrimaryHash()[0]&&this._removePrimaryHash()),this}setUrlParameters(e){return this.setParameterHash(this._rebuildHash(e)),this}assignUrlParameters(e){return this.setParameterHash(this._rebuildHash(i.assign(this.getUrlParameters(),e))),this}getHost(){let e="";const t=this.href.split("/");return~this.href.indexOf("://")?(e+=t[0]+"//",e+=t[2].split("?")[0].split("#")[0]):e+=t[0].split("?")[0].split("#")[0],e}hasLocalPath(){return this._hasPrimaryHash()&&"/"===this._getPrimaryHash().substring(0,1)}getUrlParameter(e){return this.getUrlParameters()[e]}removeHost(){return this.getHref().substr(this.getHost().length)}getPath(){return this.href.substr(this.getHost().length).split("?")[0].split("#")[0]}_tokenize(e,t){const i=e.split("&"),s={};return 1===i.length&&""===i[0]?{}:(i.forEach(e=>{const i=e.indexOf("=");s[e.substr(0,i)]=-1===i?t:e.substr(i+1)}),s)}_getPrimaryHash(){return this._hasSecondaryHash()?this.getHrefWithoutSearch().substring(this._getPrimaryHashIndex()+1,this._getSecondaryHashIndex()):this._hasPrimaryHash()?this.getHrefWithoutSearch().substring(this._getPrimaryHashIndex()+1):""}getHrefWithoutSearch(){return this.hasSearch()?this.href.substring(0,this.getSearchIndex()):this.href}_getPrimaryHashIndex(){return this.href.indexOf("#")}hasSearch(){return-1!==this.href.indexOf("?")}getSearchIndex(){return this.href.indexOf("?")}_getSecondaryHashIndex(){return this._hasSecondaryHash()?this.href.indexOf("#",this.href.indexOf("#")+1):-1}_getSecondaryHash(){return this._hasSecondaryHash()?this.href.substring(this._getSecondaryHashIndex()+1):""}_removeSecondaryHash(){return this._hasSecondaryHash()&&(this.href=this.href.substring(0,this._getSecondaryHashIndex())),this}_removePrimaryHash(){const e=this._getSecondaryHash();return this.href=this.getHost()+this.getPath(),""!==e&&(this.href+="#"+e),this}_hasPrimaryHash(){return this.href.split("#").length>1}_hasSecondaryHash(){return this.href.split("#").length>2}_setPrimaryHash(e){let t=this.getHost()+this.getPath();return e&&(t+="#"+e),this._hasSecondaryHash()&&(t+="#"+this._getSecondaryHash()),this.setHref(t),this}_setSecondaryHash(e){if(!this._hasPrimaryHash())throw new Error("A URL without primary hash, cannot have a secondary hash");return this._removeSecondaryHash(),this.href+="#"+e,this}_rebuildHash(e){let t="";return Object.keys(e).forEach((i,s)=>{0!==s&&(t+="&"),t+=i+"="+e[i]}),t}getBase64(){if(this.isDataURL())return this.href.substring(this.href.indexOf("base64,")+7)}}s.isDataURLRegex=/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i,t.Url=s}),define("reusable_utilities",["require","exports","annotations/after","annotations/cancellable","annotations/debounce","annotations/delay","annotations/deprecated","annotations/memoize","annotations/meta","annotations/order","annotations/post_check","annotations/pre_check","annotations/throttle","async/jobs","classes/color","classes/color_palette_builder","classes/iterator","classes/relayed_constants","dom/dead_scroll","dom/dom_math","dom/touch_scroll_handler","enums/theme","formatter/number/formats/default_format","formatter/number/formats/high_precision_number_formatter","formatter/number/number_formatter","formatter/number/number_formatter_factory","optimizations/object_pool","optimizations/property_link","other/animation_loop","other/array_utils","other/assign_recursive","other/cancellation_token","other/color_map","other/deep_clone","other/deep_freeze","other/key_codes","other/keys","other/math_utils","other/misc","other/mixin","other/object_utils","other/storage","other/string_utils","other/style_utils","other/topic_menu_select_style_utils","promises/promise_timeout","promises/promise_utils","promises/wait_for","proto/data_graph_utils","proto/page_configuration_utils","proto/topic_entry_utils","proto/topic_menu_utils","proto/tw_tree_utils","url/url"],function(e,t,i,s,n,r,o,a,l,c,d,h,u,p,g,m,_,f,y,b,E,S,C,v,T,I,w,A,O,M,L,P,x,D,R,N,k,F,B,U,H,G,j,V,q,W,z,Y,X,K,$,Z,Q,J){"use strict";function ee(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),ee(i),ee(s),ee(n),ee(r),ee(o),ee(a),ee(l),ee(c),ee(d),ee(h),ee(u),ee(p),ee(g),ee(m),ee(_),ee(f),ee(y),ee(b),ee(E),ee(S),ee(C),ee(v),ee(T),ee(I),ee(w),ee(A),ee(O),ee(M),ee(L),ee(P),ee(x),ee(D),ee(R),ee(N),ee(k),ee(F),ee(B),ee(U),ee(H),ee(G),ee(j),ee(V),ee(q),ee(W),ee(z),ee(Y),ee(X),ee(K),ee($),ee(Z),ee(Q),ee(J)}),define("routing_request",["require","exports","event","reusable_utilities"],function(e,t,i,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NOT_DETERMINED="NOT_DETERMINED",e.REFRESH="REFRESH",e.NAVIGATION="NEW_PAGE"}(n=t.RequestTypes||(t.RequestTypes={}));t.RoutingRequest=class{constructor(e,t){this.pendingTasks=[],this.onAccept=new i.Event,this.onCancel=new i.Event,this.onComplete=new i.Event,this.onError=new i.Event,this.oldUrl=e,this.newUrl=t,this.requestToken=new s.CancellationToken,this.requestType=n.NOT_DETERMINED}accept(e){this.onAccept.fire(this,e)}error(e){this.onError.fire(this,e)}cancel(e){this.onCancel.fire(this,e),this.requestToken.cancel()}waitFor(...e){this.pendingTasks.push.apply(this.pendingTasks,e)}async complete(e){await Promise.all(this.pendingTasks),this.onComplete.fire(this,e)}}}),define("abstract_page",["require","exports","underscore","url_matcher"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractPage=class{constructor(e,t){this.id=t,this.urlPatterns=e}matchesUrl(e){return this.urlPatterns.some(t=>void 0!==s.matchPattern(t,e))}getId(){return this.id}getPatterns(){return this.urlPatterns}getMatchingPattern(e){return i.find(this.urlPatterns,t=>void 0!==s.matchPattern(t,e))}}}),define("tw_router",["require","exports","event","routing_request","underscore","reusable_utilities","abstract_page"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(){this.onRoutingRequest=new i.Event,this.onRoutingError=new i.Event,this.onRoutingCanceled=new i.Event,this.onRoutingAccept=new i.Event,this.onRoutingFinish=new i.Event,this.onUnknownPage=new i.Event,this.pages=[],this.previousUrl=window.location.href,window.addEventListener("hashchange",()=>this.processRequest(!1,!1))}addPage(e){if(this.getPageById(e.getId()))throw new Error("Page "+e.getId()+" already exists");return this.pages.push(e),this}getPages(){return this.pages}setUrlWithoutRouting(e){return this.urlChangeToIgnore=e,decodeURIComponent(window.location.href)!==decodeURIComponent(e)&&(window.location.href=e),this}navigateTo(e,t){return this.setUrlWithoutRouting(e),this.processRequest(!1,!1,t),this}refresh(){this.processRequest(!0,!1)}processRequest(e,t,i={}){let n=window.location.href,r=this.previousUrl;e&&(n=this.previousUrl,r=""),decodeURIComponent(this.urlChangeToIgnore)!==decodeURIComponent(n)?void 0===this.getPageByUrl(n)?this.onUnknownPage.fire(new s.RoutingRequest(r,n)):this._handleRequest(new s.RoutingRequest(r,n),t,i):this.urlChangeToIgnore=void 0}reload(e={}){void 0!==this.getPageByUrl(window.location.pathname+window.location.hash)&&this.processRequest(!0,!0,e)}forceReload(e){e&&(window.location.href=e),window.location.reload(!0)}_handleRequest(e,t=!1,i){this.previousRequest&&this.previousRequest.requestToken.cancel(),this.previousRequest=e,e.onAccept.subscribeOnce((e,t)=>{this.onRoutingAccept.fire(e,i)}),e.onCancel.subscribeOnce((e,t)=>{this.onRoutingCanceled.fire(e,t,i)}),e.onComplete.subscribeOnce((e,t)=>{i.pageData=t,this.onRoutingFinish.fire(e,i)}),e.onError.subscribeOnce((e,t)=>{this.onRoutingError.fire(e,t,i)}),this.onRoutingRequest.fire(e);const n=this.getPageByUrl(e.newUrl);this.getPageByUrl(this.previousUrl)!==n||t?(e.requestType=s.RequestTypes.NAVIGATION,n.navigate(e,i)):(e.requestType=s.RequestTypes.REFRESH,n.refresh(e,i)),this.previousUrl=e.newUrl}getCurrentPage(){return this.getPageByUrl(window.location.pathname+window.location.hash)}getPageById(e){return n.find(this.pages,t=>t.getId()===e)}getPageByUrl(e){e=new r.Url(e).removeHost();const t=n.filter(this.pages,t=>t.matchesUrl(e));return this.findBestMatch(t,e)}findBestMatch(e,t){if(1===e.length)return e[0];{const i=e.map(e=>e.getMatchingPattern(t)).map(e=>10*e.split("*").length+e.split(":").length-e.split("/").length),s=Math.min.apply(Math,i);return e[i.indexOf(s)]}}}__decorate([r.memoize(),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",o.AbstractPage)],a.prototype,"getPageByUrl",null),t.Router=a}),define("router",["require","exports","abstract_page","routing_request","tw_router"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("html_sanitizer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.decoder=document.createElement("div")}escape(e,t=[]){const i=t.join("").toLowerCase();return e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(e,t)=>i.indexOf(t.toLowerCase())>-1?e:"")}unescape(e){return this.decoder.innerHTML=e,this.decoder.innerText}}t.HTMLSanitizer=i,t.htmlSanitizer=new i}),define("sanitizer",["require","exports","html_sanitizer"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("sentiment_indicator_component",["require","exports","graphics_utilities","math_utils","event_bus"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SentimentIndicatorComponent=class{constructor(e,t){this.model=t,this.canvasDiv=document.createElement("div"),this.managedDrawingLayer=new i.ManagedDrawingLayer(new s.Vector2D(t.width,t.height),{autoComputeInteractionFrom:this.canvasDiv}),e.appendChild(this.canvasDiv),this.canvasDiv.appendChild(this.managedDrawingLayer.canvas),this.update(this.model)}dispose(){this.managedDrawingLayer.dispose()}getCellWidth(e){let t;return t=this.model.globalWeight?this.model.globalWeight:this.model.data.map(e=>e.weight).reduce((e,t)=>e+t),this.model.width*(e.weight/t)}createEmptyCell(e){const t=e.color.clone(),n=new i.DrawableRectangle({name:e.id,style:{fillStyle:t},size:new s.Vector2D(0,this.model.height),position:new s.Vector2D(0,0),on:{mouseenter:i=>{this.managedDrawingLayer.tweenColor(t,e.highlightColor,100),this.openPopup(i,e)},mouseleave:i=>{this.managedDrawingLayer.tweenColor(t,e.color,100),this.closePopup()}}});return this.managedDrawingLayer.addDrawable(n),n}update(e){let t=0;e.data.forEach(i=>{let s=this.managedDrawingLayer.drawables.find(e=>e.name===i.id);const n=this.getCellWidth(i);s?(this.managedDrawingLayer.tween(s.position,"x",t,e.animationDuration),this.managedDrawingLayer.tween(s,"width",n,e.animationDuration),this.managedDrawingLayer.tweenColor(s.styleData.fillStyle,i.color,e.animationDuration)):((s=this.createEmptyCell(i)).position.x=t,i.xOffset=t,s.width=n,i.width=n,s.styleData.opacity=0,this.managedDrawingLayer.tween(s.styleData,"opacity",1,e.animationDuration)),t+=n}),this.model=e}getElement(){return this.canvasDiv}openPopup(e,t){void 0!==t&&n.eventBus.dispatch({type:n.EVENT_TYPES.SHOW_SENTIMENT_POPUP,value:{cell:t,event:e}})}closePopup(){n.eventBus.dispatch({type:n.EVENT_TYPES.HIDE_SENTIMENT_POPUP,value:{}})}}}),define("sentiment_indicator",["require","exports","sentiment_indicator_component"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("classes/stream_graph_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/interfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/stream_graph_helpers",["require","exports","math_utils","graphics_utilities","object_pool"],function(e,t,i,s,n){"use strict";function r(e,i,s,n,r){const o=e.translateValueToY(e.data.model.max,e.data.model.max,e.data.model.min,!1)-e.translateValueToY(n,e.data.model.max,e.data.model.min,!1);return t.vectorPool.get(r,o)}function o(e,t,i,s,n,r){let o;return r.topLeftY=t[n].y,r.topRightY=(t[n].y+t[n+1].y)/2,r.bottomLeftY=i[n].y,r.bottomRightY=(i[n].y+i[n+1].y)/2,r.pickedLeft=!0,o=(e-r.leftX)/(s-r.leftX),r.topY=r.topLeftY*(1-o)+r.topRightY*o,r.bottomY=r.bottomLeftY*(1-o)+r.bottomRightY*o,o}function a(e,t,i,s,n,r){let o;return r.topLeftY=(t[n].y+t[n+1].y)/2,r.topRightY=t[n+1].y,r.bottomLeftY=(i[n].y+i[n+1].y)/2,r.bottomRightY=i[n+1].y,r.pickedLeft=!1,o=(e-s)/(r.rightX-s),r.topY=r.topLeftY*(1-o)+r.topRightY*o,r.bottomY=r.bottomLeftY*(1-o)+r.bottomRightY*o,r.index++,o}function l(e,t,i){const s={leftX:0,rightX:0,topLeftY:0,topRightY:0,topMidY:0,bottomLeftY:0,bottomRightY:0,bottomMidY:0,pickedLeft:!1,topY:0,bottomY:0,index:0};return function(e,t,i,s){for(let n=Math.max(0,Math.floor(e/_.last(t).x*t.length)-1);n<t.length-1;n++){if(e<t[n].x)continue;s.leftX=t[n].x,s.rightX=t[n+1].x;const r=(s.leftX+s.rightX)/2;let l;if(e>s.leftX&&e<r&&(l=o(e,t,i,r,n,s)),e>r&&e<s.rightX&&(l=a(e,t,i,r,n,s),n++),void 0!==l){s.topY=s.topLeftY*(1-l)+s.topRightY*l,s.bottomY=s.bottomLeftY*(1-l)+s.bottomRightY*l,s.index=n;break}}}(e,t,i,s),s}Object.defineProperty(t,"__esModule",{value:!0}),t.vectorPool=new n.Pool({initialSize:0,dynamic:!0,factory:()=>i.Vector2D.zero(),initializer:(e,t,i)=>(e.set(t,i),e),metricName:"Vector2D_stream_graph"}),t.getCoordinatesForX=l,t.checkStreamMouseCollision=function(e,t,i){for(const s of e.polygons){const e=s.getBoundingBox();if(i<e.position.y||i>e.position.y+e.height)continue;const n=s.additionalData.topPoints,r=s.additionalData.bottomPoints,{leftX:o,rightX:a,topLeftY:c,topRightY:d,bottomLeftY:h,bottomRightY:u,pickedLeft:p,topY:g,bottomY:m,index:_}=l(t,n,r);if(g<i&&m>i){let e,t,i;return p?(e=o,t=c,i=h-c):(e=a,t=d,i=u-d),[s,s.additionalData.values[_],e,t,i]}}return[void 0,void 0,0,0,0]};const c=12,d=20;t.createLabels=function(e){return e.labels=[],e.polygons.forEach(n=>{const r=n.additionalData.topPoints,o=n.additionalData.bottomPoints,a=r[0].x,h=_.last(r).x,u=new i.Rectangle(i.Vector2D.zero(),0,0);for(let e=a;e<h;e+=10){const t=l(e,r,o),i=t.bottomY-t.topY;if(!(isNaN(i)||i<c))for(let s=i;s>=c;s--){const n=Math.round(t.topY+(i-s)/2),c=Math.round(t.bottomY-(i-s)/2);let d=0;for(;!(e-(d+=10)/2<a||e+d/2>h);){const t=e-d/2,i=l(t,r,o),a=e+d/2,h=l(a,r,o);if(i.topY>n||i.bottomY<c||h.topY>n||h.bottomY<c)break;(a-t)*s>=u.width*u.height&&a-t>s&&(u.x=t,u.y=n,u.width=d,u.height=s)}}}let p=u.height;if(u.height>d&&(p=d),p>=c){const i=new s.DrawableText({position:t.vectorPool.get(u.x+u.width/2,u.y+u.height/2),text:n.additionalData.name,family:s.DrawableTextFontFamily.RobotoR,size:p,textBaseline:s.DrawableTextBaseline.MIDDLE,textAlign:s.DrawableTextAlign.CENTER,style:{fillStyle:"white",shadowBlur:3,shadowColor:"rgba(0,0,0,0.4)"},inheritParentPosition:!1});for(;i.width>u.width&&i.size>=c;)i.size-=1;i.size>=c&&e.labels.push(i)}}),e},t.createLineBuildDataData=function(e){const t=Object.keys(e.data.model.lines),i=e.data.model.lines[t[0]],s=new Array(i.values.length).fill(0),n=_.first(i.values).timestamp,o=_.last(i.values).timestamp,a=e.translateValueToY(0,e.data.model.max,e.data.model.min,!1);return e.lineBuildData=t.reduce((t,i,l)=>{const c=e.data.model.lines[i],d=[],h=[];return c.values.forEach((t,i)=>{const l=e.translateValueToX(t.timestamp,o,n,!1),u=e.translateValueToY(e.data.model.totalThickness[i],e.data.model.max,e.data.model.min,!1)-a,p=r(e,0,c.values.length,Math.ceil(s[i]+t.drawValue),l);p.y+=u/2,d.push(p);const g=r(e,0,c.values.length,Math.floor(s[i]),l);g.y+=u/2,h.unshift(g),s[i]+=t.drawValue}),t[i]={model:c,topPoints:d,bottomPoints:h},t},{}),e},t.createContainers=function(e){return e.container=new s.DrawableRectangle({position:t.vectorPool.get(0,-10),size:new i.Vector2D(e.size.x,e.size.y+20),style:{fillStyle:new s.Color(new i.Vector4D(0,0,0,0)),opacity:1},children:e.polygons,isClippingMask:!0}),e.labelContainer=new s.DrawableRectangle({position:t.vectorPool.get(0,-10),size:new i.Vector2D(e.size.x,e.size.y+20),style:{fillStyle:new s.Color(new i.Vector4D(0,0,0,0)),opacity:1},children:e.labels,isClippingMask:!0}),e},t.createPolygons=function(e){const i=Object.keys(e.data.model.lines);return e.polygons=i.map(i=>{const n=e.lineBuildData[i],r=n.bottomPoints,o=n.topPoints,a=[t.vectorPool.get(_.first(o).x,_.first(o).y),...o,t.vectorPool.get(_.first(r).x,_.first(r).y),...r,t.vectorPool.get(_.last(r).x,_.last(r).y)],l=n.model.color.clone().setOpacity(1),c=n.model.color.clone().setOpacity(1);return new s.DrawableCurvedPolygon({points:a,inheritParentPosition:!1,style:{strokeStyle:l,fillStyle:c,lineWidth:1,opacity:.85},additionalData:{name:n.model.name,code:n.model.code,values:n.model.values,topPoints:o,bottomPoints:r.reverse(),strokeSaturation:l.getSaturation(),fillSaturation:c.getSaturation()},children:[]})}),e}}),define("classes/stream_graph",["require","exports","abstract_canvas_chart","graphics_utilities","xstream","classes/stream_graph_helpers","reusable_utilities"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STREAM_GRAPH_LAYER_TYPE=Object.assign({},i.CANVAS_GRID_CHART_LAYER_TYPE,{LINES:"LINES",HOVER_LINE:"HOVER_LINE",LABELS:"LABELS"});const a=200;class l extends i.CanvasGridChart{constructor(e,i){super(e,Object.assign({},i,{layers:t.STREAM_GRAPH_LAYER_TYPE,layerConfigs:{[t.STREAM_GRAPH_LAYER_TYPE.LINES]:{enableInteractions:!0}}})),this.mouseMoveFromBubble=!1,this.handleLegendMediatorEvents()}handleLegendMediatorEvents(){const e=this.options.mediatorStream.subscribe(i.CanvasChartUtils.createStreamListener(e=>{switch(e.type){case"LEGEND_MOUSEENTER":this.handleLegendMouseEnter(e);break;case"LEGEND_MOUSELEAVE":this.handleLegendMouseLeave(e);break;case"LEGEND_MOUSECLICK":this.handleLegendMouseClick(e)}}));this.disposeToken.addCleanupFunction(()=>{e.unsubscribe()})}handleLegendMouseEnter(e){void 0===this.legendClickedId&&(this.closePopover(),this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LINES).forEach(t=>{const i=t.children;this.togglePolygonHover(i,e.message)}))}handleLegendMouseLeave(e){void 0===this.legendClickedId&&(this.abortAnimations(),this.closePopover(),this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LINES).forEach(e=>{e.children.forEach(e=>{this.tweenDrawable(e,"styleData.opacity",.85,a),e.styleData.strokeStyle.setSaturation(e.additionalData.strokeSaturation),e.styleData.fillStyle.setSaturation(e.additionalData.fillSaturation)})}),this.animate())}handleLegendMouseClick(e){e.message===this.legendClickedId?(this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LINES).forEach(e=>{e.children.forEach(e=>{this.tweenDrawable(e,"styleData.opacity",.85,a),e.styleData.strokeStyle.setSaturation(e.additionalData.strokeSaturation),e.styleData.fillStyle.setSaturation(e.additionalData.fillSaturation)})}),this.legendClickedId=void 0,this.animate()):(this.closePopover(),this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LINES).forEach(t=>{const i=t.children;this.togglePolygonHover(i,e.message,.1)}),this.legendClickedId=e.message)}togglePolygonHover(e,t,i=.15){let s;this.abortAnimations(),e.forEach(e=>{e.additionalData.code===t?(this.tweenDrawable(e,"styleData.opacity",1,a),s=e,e.styleData.strokeStyle.setSaturation(e.additionalData.strokeSaturation),e.styleData.fillStyle.setSaturation(e.additionalData.fillSaturation)):(this.tweenDrawable(e,"styleData.opacity",i,a),e.styleData.strokeStyle.setSaturation(e.additionalData.strokeSaturation/2),e.styleData.fillStyle.setSaturation(e.additionalData.fillSaturation/2))}),void 0!==s&&(e.splice(e.indexOf(s),1),e.unshift(s)),this.animate()}async clearHover(e){this.closePopover(),void 0!==this.currentHoverPolygon&&(e.next({type:"WIDGET_MOUSELEAVE",message:this.currentHoverPolygon.additionalData.code}),this.currentHoverPolygon=void 0),await this.clearHoverLine(),this.changeCursor(i.CANVAS_CHART_CURSOR.DEFAULT)}async clearHoverLine(){const e=this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.HOVER_LINE)[0];await this.clearDrawables(t.STREAM_GRAPH_LAYER_TYPE.HOVER_LINE),void 0!==e&&r.vectorPool.recycleMany([e.position,e.children[0].start,e.children[0].end,e.children[1].start,e.children[1].end])}async showHover(e){const{buildData:t,hoverPolygon:i,value:s,hoverX:n,hoverY:r,hoverHeight:o}=e;await this.clearHoverLine(),this.addHoverValueIndicatorLine(t,n,r,o,i.styleData.fillStyle);const a=$(this.options.containerSpan.children[0]).offset(),l=a.left+n+this.margins.left-1,c=a.top+r+this.margins.top;this.showPopover(s,t.options.numberFormatter.toDecimal(s.value),l,c)}async setHover(e){const{container:t,listener:s,hoverPolygon:n}=e;n!==this.currentHoverPolygon&&(this.togglePolygonHover(t.children,n.additionalData.code),this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER),void 0!==this.currentHoverPolygon&&s.next({type:"WIDGET_MOUSELEAVE",message:this.currentHoverPolygon.additionalData.code}),s.next({type:"WIDGET_MOUSEENTER",message:n.additionalData.code}),this.currentHoverPolygon=n),this.showHover(e)}addContainerEventHandlers(e,t,i){e.on("mousemove",async s=>{this.containerMouseMoveHandler(s,e,t,i)}),e.on("mouseup",async e=>{this.containerMouseUpHandler(e,t)}),e.on("mouseenter",()=>{}),e.on("mouseleave",t=>this.containerMouseLeaveHandler(t,e,i))}async containerMouseLeaveHandler(e,t,i){void 0===this.legendClickedId&&(this.abortAnimations(),0===$(document.elementFromPoint(e.clientX,e.clientY+10)).parents(".tw-bubble-dialog.popover").length&&(this.mouseMoveFromBubble=!0),await this.clearHover(i),t.children.forEach(e=>{this.tweenDrawable(e,"styleData.opacity",.85,a),e.styleData.strokeStyle.setSaturation(e.additionalData.strokeSaturation),e.styleData.fillStyle.setSaturation(e.additionalData.fillSaturation)}),this.animate())}containerMouseMoveHandler(e,t,s,n){if(void 0===this.legendClickedId)if(this.mouseMoveFromBubble)this.mouseMoveFromBubble=!1;else{const i=e.offsetX-this.margins.left,o=e.offsetY-this.margins.top,[a,l,c,d,h]=r.checkStreamMouseCollision(s,i,o);if(void 0!==a)a===this.currentHoverPolygon&&this.oldMouseX===c||this.setHover({container:t,buildData:s,listener:n,hoverPolygon:a,value:l,hoverX:c,hoverY:d,hoverHeight:h});else if(void 0===a&&void 0!==this.currentHoverPolygon)return this.containerMouseLeaveHandler(e,t,n),void(this.oldMouseX=void 0);this.oldMouseX=c}else{const o=e.offsetX-this.margins.left,a=e.offsetY-this.margins.top,[l,c,d,h,u]=r.checkStreamMouseCollision(s,o,a);if(void 0===l||l.additionalData.code!==this.legendClickedId)return this.clearHover(n),this.reRender(),void(this.oldMouseX=void 0);this.changeCursor(i.CANVAS_CHART_CURSOR.POINTER),this.showHover({container:t,buildData:s,listener:n,hoverPolygon:l,value:c,hoverX:d,hoverY:h,hoverHeight:u}),this.oldMouseX=d}}containerMouseUpHandler(e,t){if(void 0!==this.currentHoverPolygon){const i=e.offsetX-this.margins.left,s=e.offsetY-this.margins.top,[n,o]=r.checkStreamMouseCollision(t,i,s);n===this.currentHoverPolygon&&this.openDrilldown(t.data.model.id,o.filters,e.target,o.requestedPageType)}}showPopover(e,t,i,s){this.openPopover(i,s,{header:e.popoverHeader,node:{color:e.color.toHex8(),label:e.formattedLabel},values:[{value:e.value,formatted_value:t,label:e.popoverMetricLabel||""}]})}addHoverValueIndicatorLine(e,i,n,o,a){const l=e.size.clone();this.addDrawable(t.STREAM_GRAPH_LAYER_TYPE.HOVER_LINE,new s.DrawableRectangle({position:r.vectorPool.get(i-1,n),size:l,style:{fillStyle:"rgba(255, 255, 255, 0)",opacity:1},children:[new s.DrawableLine({start:r.vectorPool.get(1,0),end:r.vectorPool.get(1,o),style:{strokeStyle:a.clone().darken(.5),lineWidth:3,opacity:1}}),new s.DrawableLine({start:r.vectorPool.get(1,0),end:r.vectorPool.get(1,o),style:{strokeStyle:"white",lineWidth:1,lineDash:[5,5],opacity:1}})],isClippingMask:!0}))}addOldContainerLeaveAnimation(e,t){e.forEach(e=>this.addTweens([{object:e.position,key:"x",targetValue:t.size.x,initialValue:e.position.x,duration:t.options.initialAnimationDuration,drawable:e,options:{easing:s.EASING.easeInOutCubic}},{object:e,key:"width",targetValue:0,initialValue:e.width,duration:t.options.initialAnimationDuration,drawable:e,options:{easing:s.EASING.easeInOutCubic}}]))}addOldContainerDisposeHandler(e,i){this.onAnimationDone.subscribeOnceAsPromise().then(()=>{const s=[];void 0!==e&&(this.clearDrawable(t.STREAM_GRAPH_LAYER_TYPE.LINES,e),s.push(e.position),e.children.forEach(e=>{s.push(e.position,...e.points)})),void 0!==i&&(this.clearDrawable(t.STREAM_GRAPH_LAYER_TYPE.LABELS,i),s.push(i.position),i.children.forEach(e=>{s.push(e.position)}))})}handleOldContainers(e){const i=this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LINES)[0],s=this.getDrawablesForLayer(t.STREAM_GRAPH_LAYER_TYPE.LABELS)[0];return this.addOldContainerLeaveAnimation([i,s].filter(e=>void 0!==e),e),this.addOldContainerDisposeHandler(i,s),e}createBuildData(e){return{data:e,options:this.options,translateValueToY:this.translateValueToY.bind(this),translateValueToX:this.translateValueToX.bind(this),size:this.chartSize,polygons:[],allTopPoints:[],allBottomPoints:[]}}addInitialTween(e){e.options.initialAnimationEnabled&&e.options.initialAnimationDuration>0&&(this.addTweens([{object:e.container,key:"width",targetValue:e.container.width,initialValue:0,duration:e.options.initialAnimationDuration,drawable:e.container,options:{easing:s.EASING.easeInOutCubic}},{object:e.labelContainer,key:"width",targetValue:e.labelContainer.width,initialValue:0,duration:e.options.initialAnimationDuration,drawable:e.labelContainer,options:{easing:s.EASING.easeInOutCubic}}]),e.container.width=0,e.labelContainer.width=0)}initialize(){let e=-1,s=0,o=0;return n.Stream.createWithMemory({start:n=>{this.dataStream.filter(t=>{const i=t.model.checkSum!==e||t.size.x!==s||t.size.y!==o;return e=t.model.checkSum,i||(this.afterUpdate.fire(),this.reRender()),s=t.size.x,o=t.size.y,i}).map(this.createBuildData.bind(this)).map(r.createLineBuildDataData).map(r.createPolygons).map(r.createLabels).map(this.handleOldContainers.bind(this)).map(r.createContainers).subscribe(i.CanvasChartUtils.createStreamListener(async e=>{this.legendClickedId=void 0,this.clearHover(n),this.addContainerEventHandlers(e.container,e,n),this.addDrawable(t.STREAM_GRAPH_LAYER_TYPE.LINES,e.container),this.addDrawable(t.STREAM_GRAPH_LAYER_TYPE.LABELS,e.labelContainer),this.hasReplayEnabled&&this.addReplayStates(e.container,"width",[0,e.container.width]).addReplayStates(e.labelContainer,"width",[0,e.labelContainer.width]),this.addInitialTween(e),this.afterUpdate.fire()})),this.disposeToken.addCleanupFunction(()=>{this.afterUpdate.fire()})},stop:()=>{}})}update(e){return super.update(e),this}dispose(){super.dispose()}}__decorate([o.throttle(20,{leading:!0,trailing:!0}),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent,s.DrawableRectangle,Object,Object]),__metadata("design:returntype",void 0)],l.prototype,"containerMouseMoveHandler",null),t.StreamGraph=l}),define("stream_graph",["require","exports","classes/stream_graph","classes/stream_graph_helpers"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("classes/polygon_animation_states",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SHOWN="shown",e.HIGHLIGHTED="highlighted",e.HIDDEN="hidden"}(t.PolygonAnimationStates||(t.PolygonAnimationStates={}))}),define("models/division_model",["require","exports","reusable_utilities","event","reusable_components","talkwalker_constants"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o="^0-9a-z";t.DivisionModel=class{constructor(e,t,n=13){this.title=i.StringUtils.trim(i.StringUtils.stripHTML(e),o),this.maxWidth=t,this.maxSubdivisions=n,this.subdivisions=[],this.items=[],this.onChange=new s.Event}canCreateNewSubdivision(){return this.subdivisions.length<this.maxSubdivisions}addSubdivision(e){this.canCreateNewSubdivision()&&(this.subdivisions.push({title:i.StringUtils.trim(i.StringUtils.stripHTML(e),o),firstRowIndex:this.items.length,numRows:0,icon:{type:r.PageIcon.CUSTOM,customIconData:{type:n.CustomPageIconType.FIGURE}}}),this.onChange.fire())}changeSubdivisionTitle(e,t){if(!this.subdivisions.includes(e))throw new Error("Subdivision does not exist");e.title=t,this.onChange.fire()}changeSubdivisionIcon(e,t){if(!this.subdivisions.includes(e))throw new Error("Subdivision does not exist");e.icon=t,this.onChange.fire()}splitSubdivision(e,t){if(this.canCreateNewSubdivision()){if(t<1||t>e.numRows-1)throw new Error("Offset out of range");const s=this.subdivisions.indexOf(e),a=e.numRows,l=e.firstRowIndex+t;e.numRows=t;const c={title:i.StringUtils.trim(i.StringUtils.stripHTML(this.items[l][0].title),o),firstRowIndex:l,numRows:a-t,icon:{type:r.PageIcon.CUSTOM,customIconData:{type:n.CustomPageIconType.FIGURE}}};this.subdivisions.splice(s+1,0,c),this.onChange.fire()}}joinSubdivisions(e){const t=this.subdivisions.indexOf(e),i=this.subdivisions[t+1];e.numRows+=i.numRows,this.subdivisions.splice(t+1,1),this.onChange.fire()}resizeSubdivision(e,t){const i=this.subdivisions.indexOf(e),s=this.subdivisions[i+1],n=e.numRows-t;e.numRows=t,s.firstRowIndex=e.firstRowIndex+t,s.numRows=s.numRows+n,this.onChange.fire()}addItem(e,t){if(!this.hasSubdivisions())throw new Error("At least one subdivision is required");t.title=i.StringUtils.stripHTML(t.title),this.items[e]||(this.items[e]=[],this.subdivisions[this.subdivisions.length-1].numRows++),this.items[e].push(t),this.onChange.fire()}getTitle(){return this.title}getMaxWidth(){return this.maxWidth}hasSubdivisions(){return this.subdivisions.length>0}getSubdivisions(){return this.subdivisions}hasSubdivision(e){return void 0!==this.subdivisions[e]}getSubdivision(e){if(!this.subdivisions[e])throw new Error("Requested subdivision does not exist");return this.subdivisions[e]}getItemsByRowIndex(e){return this.items[e]}getItemCountByRow(e){return this.items[e].length}getItemCountBySubdivision(e){let t=0;for(let i=e.firstRowIndex;i<e.firstRowIndex+e.numRows;++i)t+=this.getItemCountByRow(i);return t}getWidgetIdsOfSubdivision(e){const t=[];for(let i=e.firstRowIndex;i<e.firstRowIndex+e.numRows;++i)this.items[i].forEach(e=>{t.push(e.id)});return t}}}),define("controller/subdivision_editor_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("style/subdivision_editor_theme",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("style/subdivision_editor.css",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={separator:{color:"#0078a3",iconColor:"#e3f5fa"},subdivision:{secondaryColor:"#e5fafc",borderColor:"#000000"},item:{backgroundColor:"#FAFAFA",borderColor:"#000000"},button:{apply:{working:{backgroundColor:"#e47923"},failed:{backgroundColor:"#e74c3c"}}},dragAndDrop:{handleColor:"#0078a3",pageSeparatorColor:"#000000",topPageColor:"rgba(0,0,255,0.1)",bottomPageColor:"rgba(0,255,0,0.1)"}};function s(e){return e?{color:e.color?`${e.color} !important`:void 0,backgroundColor:e.backgroundColor?`${e.backgroundColor} !important`:void 0,borderColor:e.borderColor?`${e.borderColor} !important`:void 0,"&:hover":{color:e.hoverColor?`${e.hoverColor} !important`:void 0,backgroundColor:e.hoverBackgroundColor?`${e.hoverBackgroundColor} !important`:void 0,borderColor:e.hoverBorderColor?`${e.hoverBorderColor} !important`:void 0}}:void 0}t.subdivisionEditorStyleModelFactory=function(e){return{mainContainer:{position:"relative",userSelect:"none"},editor:{display:"flex"},dragHandles:{width:"100%",height:"100%",position:"absolute",pointerEvents:"none","& .handle":{position:"absolute",width:"100%",height:"0px",borderBottom:`1px solid ${(e=Object.assign({},i,e)).dragAndDrop.handleColor}`,cursor:"ns-resize",pointerEvents:"none",zIndex:9999},"& .resizeBox":{position:"absolute",width:"100%",borderColor:e.dragAndDrop.pageSeparatorColor,transition:"0.5s",zIndex:9998,"&.top":{backgroundColor:e.dragAndDrop.topPageColor,borderBottom:"2px solid"},"&.bottom":{backgroundColor:e.dragAndDrop.bottomPageColor,borderTop:"2px solid"}}},dragHandle:{position:"absolute",width:"100%",height:"16px",marginTop:"-8px",cursor:"ns-resize",pointerEvents:"all"},subdivisions:{flexGrow:1},subdivision:{boxSizing:"border-box",display:"flex",alignItems:"flex-start",borderBottom:"1px dotted",padding:"0 !important",borderColor:e.subdivision.borderColor,"&:last-of-type":{border:0},"&:nth-child(odd)":{backgroundColor:e.subdivision.primaryColor?e.subdivision.primaryColor:void 0},"&:nth-child(even)":{backgroundColor:e.subdivision.secondaryColor?e.subdivision.secondaryColor:void 0}},subdivisionPreview:{flexBasis:"65%",margin:5},subdivisionOptions:{flexBasis:"35%",padding:10,"& .row":{display:"flex",alignItems:"center",marginBottom:5,"& label":{flexBasis:75,fontSize:"small",textAlign:"right",marginRight:10}}},row:{display:"flex"},item:Object.assign({},s(e.item),{display:"flex",flexDirection:"column",height:80,margin:5,border:"1px solid",textAlign:"center",justifyContent:"space-evenly","& i":{fontSize:30}}),separators:{position:"relative",flexBasis:50,flexShrink:0},separator:{position:"absolute",cursor:"pointer",width:26,height:26,left:12,marginTop:-13,"&.disabled":{"& i":{color:e.separator.iconColor,cursor:"not-allowed"}},"& .leaf":{position:"absolute",width:"100%",height:"100%",backgroundColor:e.separator.color,borderRadius:"80% 0 55% 50% / 55% 0 80% 50%",transformOrigin:"50% 50% 0",transform:"rotateZ(45deg)",zIndex:0},"& i":{position:"absolute",width:"100%",height:"100%",textAlign:"center",lineHeight:"26px",fontSize:"16px",zIndex:1,"&.light":{color:e.separator.iconColor}}},selectableIcon:{width:27,height:27,margin:1,fontSize:16,cursor:"pointer"},specialIcon:{backgroundColor:e.separator.color},buttons:{padding:10,display:"flex",justifyContent:"flex-end","& .button":Object.assign({},s(e.button.basic),{cursor:"pointer","&.apply-button":Object.assign({},s(e.button.apply.idle),{"&.working":s(e.button.apply.working),"&.failed":s(e.button.apply.failed)})})}}}}),define("models/subdivision_editor_messages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/subdivision",["require","exports","react","flux","classnames","reusable_components","talkwalker_constants","reusable_utilities"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Subdivision=class extends s.BaseComponent{constructor(e){super(e),this.icons=a.deepClone(e.icons),this.state={iconContentVisible:!1}}render(){const{model:e,subdivision:t,style:s,messages:r}=this.props,o=t.firstRowIndex,a=t.firstRowIndex+t.numRows;return i.createElement("div",{className:n(s.subdivision,"form-group")},i.createElement("div",{className:s.subdivisionPreview},_.range(o,a).map(this.renderRow.bind(this))),i.createElement("div",{className:s.subdivisionOptions},i.createElement("div",{className:"row"},i.createElement("label",null,r.labels.icon,":"),this.renderIconSelection(),this.state.iconContentVisible?i.createElement("input",{type:"text",className:"form-control",size:2,style:{width:253,marginLeft:5},value:t.icon.customIconData.content,onChange:e=>{t.icon.customIconData.content=e.target.value.substring(0,2),this.setState({})}}):null),i.createElement("div",{className:"row"},i.createElement("label",null,r.labels.title,":"),i.createElement("input",{type:"text",className:"form-control",value:t.title,onChange:i=>{e.changeSubdivisionTitle(t,i.target.value)}}))))}renderRow(e){const{style:t}=this.props,s=this.props.getItemsByRowIndex(e);return i.createElement("div",{key:`row_${e}`,className:t.row},s.map(this.renderItem.bind(this)))}renderItem(e,t){const{style:s,maxWidth:n}=this.props,r=e.width/n;return i.createElement("div",{key:`item_${t}`,className:s.item,style:{flexBasis:`${100*r}%`}},i.createElement("i",{className:`fa ${e.icon}`}),i.createElement("div",null,e.title))}renderIconSelection(){const{model:e,subdivision:t,style:s,styleModel:a}=this.props;if(!this.icons)return null;const l=[];return this.icons.forEach(c=>{const d={backgroundColor:"#7d8999",rounded:!1,customStyle:a.selectableIcon};c.type===o.PageIcon.CUSTOM&&(d.containerClassName=n(s.selectableIcon,s.specialIcon),d.backgroundColor="#009bda"),l.push({key:c,element:i.createElement(r.PageIconComponent,{model:c,pageTitle:t.title,pageNumber:e.getSubdivisions().indexOf(t)+1,iconProps:d,displayIconType:!0}),selected:t.icon===c})}),i.createElement(r.ItemGridSelectionDropdown,{items:l,columns:5,theme:{},onItemChange:i=>{i.key.type===o.PageIcon.CUSTOM&&i.key.customIconData.type===r.CustomPageIconType.CUSTOM_LETTERS?this.setState({iconContentVisible:!0}):this.setState({iconContentVisible:!1}),e.changeSubdivisionIcon(t,i.key)}})}}}),define("models/subdivision_editor_drag_and_drop_models",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/subdivision_editor_separator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROW=0]="ROW",e[e.SUBDIVISION=1]="SUBDIVISION"}(t.SubdivisionEditorSeparatorType||(t.SubdivisionEditorSeparatorType={}))}),define("components/subdivision_editor_drag_and_drop",["require","exports","react","flux","drag_and_drop","jquery","models/subdivision_editor_separator"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SubdivisionEditorDragAndDrop=class extends s.BaseComponent{constructor(){super(...arguments),this.dragSourceHandleMap=new Map}componentDidMount(){n.dragAndDropService.registerDropTargets([this.dropTarget],{onDragAccept:this.onDragAccept.bind(this),channels:["subdivision-editor"],cancellationToken:this.cancellationToken})}render(){const{separators:e,style:t}=this.props;return i.createElement("div",{className:t.dragHandles,ref:e=>{this.dropTarget=e}},e.map(this.renderDragSource.bind(this)))}renderDragSource(e,t){const{style:s}=this.props;return e.type===o.SubdivisionEditorSeparatorType.SUBDIVISION?i.createElement("div",{key:`dragSource_${t}`,className:s.dragHandle,style:{top:e.top},ref:t=>{t&&(this.dragSourceHandleMap.has(t)||n.dragAndDropService.registerDragSources([t],{onDragStart:this.onDragStart.bind(this),onDragMove:this.onDragMove.bind(this),onDragStop:this.onDragStop.bind(this),channels:["subdivision-editor"],minimumDragDistance:3,cancellationToken:this.cancellationToken}),this.dragSourceHandleMap.set(t,e))}}):null}createDragHandle(){const e=r(document.createElement("div"));return e.addClass("handle"),r(this.dropTarget).append(e),e}createResizeBoxes(){this.topResizeBox=this.createResizeBox("top"),this.bottomResizeBox=this.createResizeBox("bottom")}createResizeBox(e){const t=r(document.createElement("div"));return t.addClass(`resizeBox ${e}`),r(this.dropTarget).append(t),t}async onDragStart(e,t){return e.stopPropagation(),e.preventDefault(),this.createResizeBoxes(),this.dragHandle=this.createDragHandle(),r(this.dropTarget).css({pointerEvents:"all"}),{dragHandle:this.dragHandle[0],model:this.generateDropModel(t)}}onDragMove(e,t){e.stopPropagation(),e.preventDefault();const{itemHeight:i,containerSpacing:s}=this.props,{areas:n}=t.model,o=_.first(n).center,a=_.last(n).center,l=e.clientY+window.pageYOffset-r(this.dropTarget).offset().top,c=Math.min(Math.max(o,l),a),d=(i+s)/2;this.dropArea=n.find(e=>e.start<=c&&e.end>=c),this.topResizeBox.css({top:_.first(n).start-d,height:this.dropArea.center-_.first(n).start+d-1}),this.bottomResizeBox.css({top:this.dropArea.center,height:_.last(n).end-this.dropArea.center+d}),this.dragHandle.css({left:0,top:c})}async onDragStop(e){e.stopPropagation(),e.preventDefault(),r(this.dropTarget).css({pointerEvents:"none"}),this.dropTarget.removeChild(this.dragHandle[0]),this.dropTarget.removeChild(this.topResizeBox[0]),this.dropTarget.removeChild(this.bottomResizeBox[0]),this.dragHandle=void 0,this.topResizeBox=void 0,this.bottomResizeBox=void 0,this.dropArea=void 0}onDragAccept(e,t){e.stopPropagation(),e.preventDefault();const{model:i}=this.props;if(0===this.dropArea.row)return;const s=t.model.sourceSubdivision;let n;n=this.dropArea.subdivision===s?this.dropArea.row:s.numRows+this.dropArea.row,i.resizeSubdivision(s,n)}generateDropModel(e){const{separators:t,itemHeight:i,containerSpacing:s}=this.props,n=this.dragSourceHandleMap.get(e),r=t.indexOf(n),a=[n];let l=r-1;for(;t[l]&&t[l].type!==o.SubdivisionEditorSeparatorType.SUBDIVISION;)a.unshift(t[l]),l--;let c=r+1;for(;t[c]&&t[c].type!==o.SubdivisionEditorSeparatorType.SUBDIVISION;)a.push(t[c]),c++;const d=[];return a.forEach((e,t)=>{let n=e.top-i/2,r=a[t+1]?a[t+1].top-i/2:e.top+i/2;e.type===o.SubdivisionEditorSeparatorType.SUBDIVISION&&(0===t&&(n-=s/2),t===a.length-1&&(r+=s/2)),d.push({start:n,end:r,center:e.top,subdivision:e.subdivision,row:e.row})}),{sourceSubdivision:n.subdivision,areas:d}}}}),define("components/subdivision_editor",["require","exports","flux","classnames","react","style/subdivision_editor.css","reusable_components","components/subdivision","components/subdivision_editor_drag_and_drop","models/subdivision_editor_separator"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SubdivisionEditor=class extends i.StyledBaseComponent{get itemHeight(){return this.cssModule.getStyleSheetModel().item.height+2*this.cssModule.getStyleSheetModel().item.margin}get containerSpacing(){return 2*this.cssModule.getStyleSheetModel().subdivisionPreview.margin}constructor(e){super(e,r.subdivisionEditorStyleModelFactory)}componentWillMount(){const{model:e}=this.props;this.cancellationToken.subscribe(e.onChange,()=>{this.setState({})})}render(){const{controller:e,model:t,messages:i,icons:s}=this.props,r=t.getSubdivisions();return this.separators=this.generateSeparators(),n.createElement("div",{className:this.style.mainContainer},n.createElement(l.SubdivisionEditorDragAndDrop,{model:t,style:this.style,separators:this.separators,itemHeight:this.itemHeight,containerSpacing:this.containerSpacing}),n.createElement("div",{className:this.style.editor},n.createElement("div",{className:this.style.separators},this.separators.map(this.renderSeparator.bind(this))),n.createElement("div",{className:this.style.subdivisions},r.map((e,r)=>n.createElement(a.Subdivision,{style:this.style,styleModel:this.cssModule.getStyleSheetModel(),model:t,subdivision:e,messages:i,maxWidth:t.getMaxWidth(),icons:s,getItemsByRowIndex:e=>t.getItemsByRowIndex(e),key:`subdivision_${r}`})))),n.createElement("div",{className:this.style.buttons},n.createElement("button",{type:"button",className:"button btn btn-default",onClick:()=>e.cancel(t)},i.buttons.cancel),n.createElement(o.ProgressButton,{icon:"fa fa-refresh",spinIconWhileLoading:!0,onClick:()=>e.apply(t),className:"button apply-button btn btn-primary",loadingClass:"working",text:i.buttons.apply,errorClass:"failed"})))}renderSeparator(e,t){const{model:i,messages:r}=this.props;switch(e.type){case c.SubdivisionEditorSeparatorType.SUBDIVISION:return n.createElement(o.TooltipComponent,{key:`separator_${t}`,text:r.tooltips.removePageBreak,position:"bottom"},n.createElement("div",{style:{top:e.top},className:this.style.separator,onClick:()=>{i.joinSubdivisions(e.subdivision)}},n.createElement("i",{className:"fa fa-chain light"}),n.createElement("div",{className:"leaf"})));case c.SubdivisionEditorSeparatorType.ROW:return n.createElement(o.TooltipComponent,{key:`separator_${t}`,text:r.tooltips.createPageBreak,position:"bottom"},n.createElement("div",{style:{top:e.top},className:s(this.style.separator,{disabled:!i.canCreateNewSubdivision()}),onClick:()=>{i.splitSubdivision(e.subdivision,e.row)}},n.createElement("i",{className:"fa fa-chain-broken"})))}}generateSeparators(){const{model:e}=this.props,t=e.getSubdivisions(),i=[];let s=0;return t.forEach((e,n)=>{for(let t=0;t<e.numRows-1;++t)i.push({type:c.SubdivisionEditorSeparatorType.ROW,top:s+(t+1)*this.itemHeight+this.containerSpacing/2,subdivision:e,row:t+1});if(n<t.length-1){const t=e.numRows*this.itemHeight+this.containerSpacing+1;i.push({type:c.SubdivisionEditorSeparatorType.SUBDIVISION,top:t+s,subdivision:e,row:0}),s+=t}}),i}}}),define("subdivision_editor",["require","exports","components/subdivision_editor","components/subdivision_editor_drag_and_drop","models/division_model"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("interfaces/column_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/sort_display_behaviour",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ONE_COLUMN=0]="ONE_COLUMN",e[e.ALL_COLUMNS=1]="ALL_COLUMNS"}(t.SortDisplayBehaviour||(t.SortDisplayBehaviour={}))}),define("interfaces/table_sorter_options",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/table_sorter",["require","exports","jquery","underscore","interfaces/sort_display_behaviour"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TableSorter=class{constructor(e,t){this.defaultHTMLs=[],this.sortedClassName="sorted",this.clickableClassName="clickable",this.handleClickFunc=this.handleClick.bind(this),this.tableElem=i(e),this.options=t,this.initializeSorting()}initializeSorting(){this.tableHeaders=this.tableElem.find("th");const e=this.determineTemplate();this.usedHTML=i.parseHTML(e);const t=this.options.customDefaultTemplate?this.options.customDefaultTemplate:this.getArrowDown();this.tableHeaders.each((e,s)=>{const r=i(s);this.removeEventHandlers(r),r.on("click",this.handleClickFunc);const o=i.parseHTML(t);this.defaultHTMLs.push(o),this.isColumnSortable(this.options.sortableColumns[e])&&this.addClassIfAbsent(r,this.clickableClassName),this.isSorted(this.options.sortableColumns[e])&&0===r.has(this.usedHTML[0]).length?this.addSortingToElem(r):this.isSorted(this.options.sortableColumns[e])||(this.options.displayBehaviour===n.SortDisplayBehaviour.ALL_COLUMNS&&this.isColumnSortable(this.options.sortableColumns[e])?r.append(o):this.canDisplaySortedRelation(e)&&this.addClassIfAbsent(r,this.sortedClassName))})}determineTemplate(){return this.options.customTemplate?this.options.customTemplate:this.options.displayBehaviour===n.SortDisplayBehaviour.ONE_COLUMN?this.getBottomCaretLine():this.getArrowDownCircle()}sortByElement(e){this.isElemSortable(e)&&(void 0===this.sortedElem||e.is(this.sortedElem)||this.removeSortingFromOldElem(),(void 0===this.sortedElem||void 0!==this.sortedElem&&!e.is(this.sortedElem))&&this.handleDefaultHtml(e),this.addSortingToElem(e))}destroy(){this.removeSortingFromOldElem(),this.tableHeaders.each((e,t)=>{this.removeEventHandlers(i(t))}),this.defaultHTMLs&&this.defaultHTMLs.forEach(e=>(e||[]).forEach(e=>e.remove())),this.defaultHTMLs=void 0}handleClick(e){const t=i(e.target);let s;t.is("th")?this.sortByElement(t):(s=t.parents("th")).length>0&&this.sortByElement(s)}handleDefaultHtml(e){this.options.displayBehaviour===n.SortDisplayBehaviour.ALL_COLUMNS&&(this.removeDefaultHtml(e),this.addDefaultToOldElem())}addClassIfAbsent(e,t){e.hasClass(t)||e.addClass(t)}addSortingToElem(e){0===e.has(this.usedHTML[0]).length&&e.append(this.usedHTML),this.addClassIfAbsent(e,this.sortedClassName),this.sortedElem=e}addDefaultToOldElem(){void 0!==this.sortedElem&&this.sortedElem.length>0&&this.tableHeaders.each((e,t)=>{if(i(t).is(this.sortedElem))return this.sortedElem.append(this.defaultHTMLs[e]),!1})}removeDefaultHtml(e){this.tableHeaders.each((t,s)=>{if(i(s).is(e))return this.defaultHTMLs[t].forEach(e=>e.remove()),!1})}removeSortingFromOldElem(){this.usedHTML.forEach(e=>e.remove()),this.tableHeaders.each((e,t)=>{if(i(t).is(this.sortedElem))return this.canDisplaySortedRelation(e)||this.sortedElem.removeClass("sorted"),!1})}removeEventHandlers(e){e.off("click",this.handleClickFunc)}getBottomCaretLine(){return'<div class="sorted-bottom-line"><i class="fa fa-sort-desc"></i></div>'}getArrowDown(){return'<br/><span class="sort-icons"><span class="fa fa-arrow-down sort-icons__item"></span></span>'}getArrowDownCircle(){return'<br/><span class="sort-icons"><span class="fa fa-arrow-circle-down sort-icons__item"></span></span>'}isSorted(e){return this.isSortedAsc(e.sort)||this.isSortedDesc(e.sort)}isSortedAsc(e){return void 0!==e&&"ASC"===e}isSortedDesc(e){return void 0!==e&&"DESC"===e}isElemSortable(e){return e.hasClass(this.clickableClassName)}isColumnSortable(e){return!0===this.options.allColumnsSortable||!0===e.sortable}hasAnySortedChildren(e){return s.any(e.children,e=>this.isSorted(e))}canDisplaySortedRelation(e){return this.hasAnySortedChildren(this.options.sortableColumns[e])||void 0!==this.options.sortableColumns[e].parent&&this.hasAnySortedChildren(this.options.sortableColumns[e].parent)}}}),define("table_sorter_ui",["require","exports","classes/table_sorter","interfaces/sort_display_behaviour"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("enums/ai_enums",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TRAINING_REQUIRED="TRAINING_REQUIRED",e.TRAINING="TRAINING",e.RUNNING="RUNNING",e.STOPPED="STOPPED",e.STOPPED_AND_TRAINING="STOPPED_AND_TRAINING",e.RUNNING_AND_TRAINING="RUNNING_AND_TRAINING"}(t.DisplayStatus||(t.DisplayStatus={}))}),define("enums/navigation_enums",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEFAULT_APP="DEFAULT_APP",e.PROTECT="PROTECT",e.PROMOTE="PROMOTE"}(t.Application||(t.Application={})),function(e){e.DEFAULT_MODULE="DEFAULT_MODULE",e.ISSUE_TRACKER="ISSUE_TRACKER",e.INFLUENCER_MANAGEMENT="INFLUENCER_MANAGEMENT"}(t.ApplicationModule||(t.ApplicationModule={})),function(e){e.MONITOR="MONITOR",e.DASHBOARD="DASHBOARD",e.NEWS_LETTER="NEWS_LETTER",e.SEARCH="SEARCH",e.REPORT="REPORT",e.GENERIC="GENERIC",e.CUSTOM_PAGE="CUSTOM_PAGE",e.TRIGGER_CONDITION="TRIGGER_CONDITION",e.DASHBOARD_TEMPLATE="DASHBOARD_TEMPLATE",e.WIDGET_EDIT="WIDGET_EDIT",e.EMBEDDED_WIDGET="EMBEDDED_WIDGET",e.HOME_SCREEN="HOME_SCREEN",e.TOPIC_SETUP="TOPIC_SETUP",e.SETTINGS="SETTINGS",e.NONE="NONE",e.BASIC_SETUP="BASIC_SETUP",e.CONTEXT_MENU="CONTEXT_MENU",e.EDIT="EDIT",e.SEARCH_ADVANCED="SEARCH_ADVANCED",e.HOME_SCREEN_DISCOVERY="HOME_SCREEN_DISCOVERY",e.USER_WORKFLOW="USER_WORKFLOW",e.COMMAND_CENTER="COMMAND_CENTER",e.INFLUENCER_MANAGEMENT="INFLUENCER_MANAGEMENT"}(t.GroupPage||(t.GroupPage={})),function(e){e.TOPICS_CATEGORY="TOPICS_CATEGORY",e.TWITTER_PM_CATEGORY="TWITTER_PM_CATEGORY",e.FACEBOOK_PM_CATEGORY="FACEBOOK_PM_CATEGORY",e.YOUTUBE_PM_CATEGORY="YOUTUBE_PM_CATEGORY",e.OTHER_PM_CATEGORY="OTHER_PM_CATEGORY",e.GOOGLE_PM_CATEGORY="GOOGLE_PM_CATEGORY",e.LINKEDIN_PM_CATEGORY="LINKEDIN_PM_CATEGORY",e.FLICKR_PM_CATEGORY="FLICKR_PM_CATEGORY",e.FOURSQUARE_PM_CATEGORY="FOURSQUARE_PM_CATEGORY",e.INSTAGRAM_PM_CATEGORY="INSTAGRAM_PM_CATEGORY",e.MIXCLOUD_PM_CATEGORY="MIXCLOUD_PM_CATEGORY",e.SOUNDCLOUD_PM_CATEGORY="SOUNDCLOUD_PM_CATEGORY",e.VIMEO_PM_CATEGORY="VIMEO_PM_CATEGORY",e.DAILYMOTION_PM_CATEGORY="DAILYMOTION_PM_CATEGORY",e.EXTERNAL_URL_PM_CATEGORY="EXTERNAL_URL_PM_CATEGORY",e.REPORTS_CATEGORY="REPORTS_CATEGORY",e.WEIBO_PM_CATEGORY="WEIBO_PM_CATEGORY",e.NEWSLETTER_PM_CATEGORY="NEWSLETTER_PM_CATEGORY",e.VK_PM_CATEGORY="VK_PM_CATEGORY",e.MIXED_PM_CATEGORY="MIXED_PM_CATEGORY",e.PINTEREST_PM_CATEGORY="PINTEREST_PM_CATEGORY",e.VINE_PM_CATEGORY="VINE_PM_CATEGORY",e.LISTENING_DT_CATEGORY="LISTENING_DT_CATEGORY",e.HASHTAGS_DT_CATEGORY="HASHTAGS_DT_CATEGORY",e.EVENTS_DT_CATEGORY="EVENTS_DT_CATEGORY",e.CRISIS_DT_CATEGORY="CRISIS_DT_CATEGORY",e.CUSTOMER_EXPERIENCE_DT_CATEGORY="CUSTOMER_EXPERIENCE_DT_CATEGORY",e.COMPETITIVE_DT_CATEGORY="COMPETITIVE_DT_CATEGORY",e.INFLUENCERS_DT_CATEGORY="INFLUENCERS_DT_CATEGORY",e.SOCIAL_CHANNEL_ANALYTICS_DT_CATEGORY="SOCIAL_CHANNEL_ANALYTICS_DT_CATEGORY",e.ADVERTISING_DT_CATEGORY="ADVERTISING_DT_CATEGORY",e.TV_SHOWS_DT_CATEGORY="TV_SHOWS_DT_CATEGORY",e.CONTENT_MARKETING_DT_CATEGORY="CONTENT_MARKETING_DT_CATEGORY",e.ISSUE_TRACKING_DT_CATEGORY="ISSUE_TRACKING_DT_CATEGORY",e.SUCCESS_CONTROLLING_DT_CATEGORY="SUCCESS_CONTROLLING_DT_CATEGORY",e.DEEP_ANALYTICS_DT_CATEGORY="DEEP_ANALYTICS_DT_CATEGORY",e.C_LEVEL_SCORECARD_CATEGORY="C_LEVEL_SCORECARD_CATEGORY",e.PROJECT_SETUP_DESCRIPTION_CATEGORY="PROJECT_SETUP_DESCRIPTION_CATEGORY",e.WIDGET_EDIT_CATEGORY="WIDGET_EDIT_CATEGORY",e.EMBEDDED_WIDGET_CATEGORY="EMBEDDED_WIDGET_CATEGORY",e.CONTEXT_MENU_CATEGORY="CONTEXT_MENU_CATEGORY",e.VISUAL_DISCOVERY_CATEGORY="VISUAL_DISCOVERY_CATEGORY",e.TREND_DISCOVERY_CATEGORY="TREND_DISCOVERY_CATEGORY",e.INSTANT_DISCOVERY_CATEGORY="INSTANT_DISCOVERY_CATEGORY",e.USER_WORKFLOW_CATEGORY="USER_WORKFLOW_CATEGORY",e.FACEBOOK_INSIGHTS_PM_CATEGORY="FACEBOOK_INSIGHTS_PM_CATEGORY",e.GOOGLE_ANALYTICS_WC_CATEGORY="GOOGLE_ANALYTICS_WC_CATEGORY",e.WEB_CONNECTORS="WEB_CONNECTORS",e.FREE_INSTANT_DISCOVERY_CATEGORY="FREE_INSTANT_DISCOVERY_CATEGORY",e.INFLUENCER_MANAGEMENT_SEARCH="INFLUENCER_MANAGEMENT_SEARCH",e.INFLUENCER_MANAGEMENT_MONITOR="INFLUENCER_MANAGEMENT_MONITOR",e.INFLUENCER_MANAGEMENT_OUTREACH="INFLUENCER_MANAGEMENT_OUTREACH",e.INFLUENCER_MANAGEMENT_MEASURE="INFLUENCER_MANAGEMENT_MEASURE",e.ADOBE_ANALYTICS_WC_CATEGORY="ADOBE_ANALYTICS_WC_CATEGORY",e.GOOGLE_PLAY_PM_CATEGORY="GOOGLE_PLAY_PM_CATEGORY",e.INSTAGRAM_INSIGHTS_PM_CATEGORY="INSTAGRAM_INSIGHTS_PM_CATEGORY",e.INSTAGRAM_BUSINESS_DISCOVERY_PM_CATEGORY="INSTAGRAM_BUSINESS_DISCOVERY_PM_CATEGORY",e.INSTAGRAM_HASHTAG_TRACKING_PM_CATEGORY="INSTAGRAM_HASHTAG_TRACKING_PM_CATEGORY",e.CONVERSATION_CLUSTER_DT_CATEGORY="CONVERSATION_CLUSTER_DT_CATEGORY"}(t.PageCategory||(t.PageCategory={})),function(e){e.GENERIC="GENERIC",e.OVERVIEW="OVERVIEW",e.RESULTS="RESULTS",e.INFLUENCERS="INFLUENCERS",e.SENTIMENTS="SENTIMENTS",e.THEME="THEME",e.DEMOGRAPHICS="DEMOGRAPHICS",e.WORLD_MAP="WORLD_MAP",e.PERFORMANCE="PERFORMANCE",e.EDIT="EDIT",e.VISUAL_INSIGHTS="VISUAL_INSIGHTS",e.OWNER_ACTIVITY="OWNER_ACTIVITY",e.AUDIENCE_ACTIVITY="AUDIENCE_ACTIVITY",e.AUDIENCE="AUDIENCE",e.ALERTS="ALERTS",e.DOWNLOADS="DOWNLOADS",e.REPORT_LAYOUT="REPORT_LAYOUT",e.REPORT_SCHEDULE="REPORT_SCHEDULE",e.REPORT_SETTINGS="REPORT_SETTINGS",e.EDIT_REPORTS_CATEGORIES="EDIT_REPORTS_CATEGORIES",e.EDIT_REPORTS_CATEGORY="EDIT_REPORTS_CATEGORY",e.REPORTS_LOGS="REPORTS_LOGS",e.DELETED_REPORTS="DELETED_REPORTS",e.CUSTOM_PAGE_STATE_ID="CUSTOM_PAGE_STATE_ID",e.LI_ALL_MEDIA_DASHBOARD="LI_ALL_MEDIA_DASHBOARD",e.LI_NEWS_DASHBOARD="LI_NEWS_DASHBOARD",e.LI_TWITTER_DASHBOARD="LI_TWITTER_DASHBOARD",e.LI_FACEBOOK_DASHBOARD="LI_FACEBOOK_DASHBOARD",e.LI_BLOGS_DASHBOARD="LI_BLOGS_DASHBOARD",e.LI_FORUMS_DASHBOARD="LI_FORUMS_DASHBOARD",e.LI_SOCIAL_NETWORK_DASHBOARD="LI_SOCIAL_NETWORK_DASHBOARD",e.LI_COMPARE_DASHBOARD="LI_COMPARE_DASHBOARD",e.HT_ALL_MEDIA_DASHBOARD="HT_ALL_MEDIA_DASHBOARD",e.HT_TWITTER_DASHBOARD="HT_TWITTER_DASHBOARD",e.HT_INSTAGRAM_DASHBOARD="HT_INSTAGRAM_DASHBOARD",e.HT_COMPARE_ALL_MEDIA_DASHBOARD="HT_COMPARE_ALL_MEDIA_DASHBOARD",e.HT_COMPARE_TWITTER_DASHBOARD="HT_COMPARE_TWITTER_DASHBOARD",e.HT_COMPARE_INSTAGRAM_DASHBOARD="HT_COMPARE_INSTAGRAM_DASHBOARD",e.SCA_TWITTER_DASHBOARD="SCA_TWITTER_DASHBOARD",e.SCA_FACEBOOK_DASHBOARD="SCA_FACEBOOK_DASHBOARD",e.SCA_MULTI_TWITTER_DASHBOARD="SCA_MULTI_TWITTER_DASHBOARD",e.SCA_MULTI_FACEBOOK_DASHBOARD="SCA_MULTI_FACEBOOK_DASHBOARD",e.SCA_INSTAGRAM_DASHBOARD="SCA_INSTAGRAM_DASHBOARD",e.SCA_FACEBOOK_INSIGHT_DASHBOARD="SCA_FACEBOOK_INSIGHT_DASHBOARD",e.SCA_MULTI_FACEBOOK_INSIGHT_DASHBOARD="SCA_MULTI_FACEBOOK_INSIGHT_DASHBOARD",e.CI_SHARE_OF_VOICE_DASHBOARD="CI_SHARE_OF_VOICE_DASHBOARD",e.CI_COMPARE_TWITTER_DASHBOARD="CI_COMPARE_TWITTER_DASHBOARD",e.CI_COMPARE_FACEBOOK_DASHBOARD="CI_COMPARE_FACEBOOK_DASHBOARD",e.CI_COMPARE_INSTAGRAM_DASHBOARD="CI_COMPARE_INSTAGRAM_DASHBOARD",e.AD_KEYWORD_DESCOVERY_DASHBOARD="AD_KEYWORD_DESCOVERY_DASHBOARD",e.AD_CAMPAIGN_PERFORMANCE_DASHBOARD="AD_CAMPAIGN_PERFORMANCE_DASHBOARD",e.AD_COMPARE_CAMPAIGN_DASHBOARD="AD_COMPARE_CAMPAIGN_DASHBOARD",e.II_TWITTER_DASHBOARD="II_TWITTER_DASHBOARD",e.II_BLOGS_DASHBOARD="II_BLOGS_DASHBOARD",e.II_NEWS_DASHBOARD="II_NEWS_DASHBOARD",e.II_FACEBOOK_DASHBOARD="II_FACEBOOK_DASHBOARD",e.II_INSTAGRAM_DASHBOARD="II_INSTAGRAM_DASHBOARD",e.II_YOUTUBE_DASHBOARD="II_YOUTUBE_DASHBOARD",e.II_FORUMS_DASHBOARD="II_FORUMS_DASHBOARD",e.II_COMPARE_DASHBOARD="II_COMPARE_DASHBOARD",e.CR_DETECTING_CRISIS="CR_DETECTING_CRISIS",e.CR_ON_GOING_CRISIS="CR_ON_GOING_CRISIS",e.CR_ALL_ISSUES="CR_ALL_ISSUES",e.CR_ISSUE_RESEARCH="CR_ISSUE_RESEARCH",e.TV_ON_AIR_PERFORMANCE_DASHBOARD="TV_ON_AIR_PERFORMANCE_DASHBOARD",e.TV_SHOW_PERFORMANCE_DASHBOARD="TV_SHOW_PERFORMANCE_DASHBOARD",e.TV_AUDIENCE_DASHBOARD="TV_AUDIENCE_DASHBOARD",e.TV_COMPARE_DASHBOARD="TV_COMPARE_DASHBOARD",e.CI_COMPARE_DASHBOARD="CI_COMPARE_DASHBOARD",e.CM_OWN_CHANNELS_ANALYTICS="CM_OWN_CHANNELS_ANALYTICS",e.CM_OWNED_EARNED_MEDIA="CM_OWNED_EARNED_MEDIA",e.CM_COMPETITIVE_INTELLIGENCE="CM_COMPETITIVE_INTELLIGENCE",e.SC_OWN_BRAND="SC_OWN_BRAND",e.SC_BENCHMARK="SC_BENCHMARK",e.IT_OWN_BRAND="IT_OWN_BRAND",e.IT_SECTOR="IT_SECTOR",e.IT_BENCHMARK="IT_BENCHMARK",e.DA_INFLUENCERS="DA_INFLUENCERS",e.CS_AWARENESS="CS_AWARENESS",e.CS_MARKET="CS_MARKET",e.CS_REPUTATION="CS_REPUTATION",e.CS_BRAND_HEALTH="CS_BRAND_HEALTH",e.CS_COMMUNITY="CS_COMMUNITY",e.CS_OVERVIEW="CS_OVERVIEW",e.SNAPSHOT_REPORT_NEWS_DASHBOARD="SNAPSHOT_REPORT_NEWS_DASHBOARD",e.SNAPSHOT_REPORT_TWEETS_DASHBOARD="SNAPSHOT_REPORT_TWEETS_DASHBOARD",e.ONGOING_CRISIS_DASHBOARD="ONGOING_CRISIS_DASHBOARD",e.ISSUE_MONITORING_REPORT_DASHBOARD="ISSUE_MONITORING_REPORT_DASHBOARD",e.ISSUE_MONITORING_REPORT_SPECIFIC_DASHBOARD="ISSUE_MONITORING_REPORT_SPECIFIC_DASHBOARD",e.INFLUENCER_REPORT_DASHBOARD="INFLUENCER_REPORT_DASHBOARD",e.TEST_FACEBOOK_PM_DASHBOARD="TEST_FACEBOOK_PM_DASHBOARD",e.TEST_TWITTER_PM_DASHBOARD="TEST_TWITTER_PM_DASHBOARD",e.TEST_FB_TW_PM_DASHBOARD="TEST_FB_TW_PM_DASHBOARD",e.TEST_ENTITY_TYPE_DASHBOARD="TEST_ENTITY_TYPE_DASHBOARD",e.TEST_MESSAGE_DIFFUSION_DASHBOARD="TEST_MESSAGE_DIFFUSION_DASHBOARD",e.WIDGET_EDIT="WIDGET_EDIT",e.CONTEXT_MENU_DEFAULT="CONTEXT_MENU_DEFAULT",e.CONTEXT_MENU_TEST="CONTEXT_MENU_TEST",e.CONTEXT_MENU_WORLD_MAP="CONTEXT_MENU_WORLD_MAP",e.CONTEXT_MENU_RESULT_ENTRY="CONTEXT_MENU_RESULT_ENTRY",e.CONTEXT_MENU_INFLUENCER_OVERVIEW="CONTEXT_MENU_INFLUENCER_OVERVIEW",e.CONTEXT_MENU_PREVIEW="CONTEXT_MENU_PREVIEW",e.EDIT_RESULTS="EDIT_RESULTS",e.CONTEXT_MENU_MESSAGE_DIFFUSION="CONTEXT_MENU_MESSAGE_DIFFUSION",e.CONTEXT_MENU_THEME_OVERVIEW="CONTEXT_MENU_THEME_OVERVIEW",e.CONTEXT_MENU_HASHTAG_OVERVIEW="CONTEXT_MENU_HASHTAG_OVERVIEW",e.CONTEXT_MENU_OBJECT_SCENE="CONTEXT_MENU_OBJECT_SCENE",e.CONTEXT_MENU_LIMITED_READ_ONLY_RESULTS="CONTEXT_MENU_LIMITED_READ_ONLY_RESULTS",e.CONTEXT_MENU_ISSUE_OVERVIEW="CONTEXT_MENU_ISSUE_OVERVIEW",e.CONTEXT_MENU_DEFAULT_STORIES_ONLY="CONTEXT_MENU_DEFAULT_STORIES_ONLY",e.REACH_PAGE="REACH_PAGE",e.AVE_ANALYTICS="AVE_ANALYTICS",e.CONTEXT_MENU_OVERVIEW="CONTEXT_MENU_OVERVIEW",e.CONTEXT_MENU_VELOCITY="CONTEXT_MENU_VELOCITY",e.SHARED_DASHBOARD="SHARED_DASHBOARD",e.VD_RESULTS="VD_RESULTS",e.VD_ANALYTICS="VD_ANALYTICS",e.VD_DEMOGRAPHICS="VD_DEMOGRAPHICS",e.VD_INFLUENCERS="VD_INFLUENCERS",e.VD_WORLDMAP="VD_WORLDMAP",e.ID_OVERVIEW="ID_OVERVIEW",e.TD_OVERVIEW="TD_OVERVIEW",e.TD_RESULTS="TD_RESULTS",e.TD_INFLUENCERS="TD_INFLUENCERS",e.TD_THEMES="TD_THEMES",e.TD_DEMOGRAPHICS="TD_DEMOGRAPHICS",e.TD_WORLDMAP="TD_WORLDMAP",e.CONTEXT_MENU_VELOCITY_AND_DIFFUSION="CONTEXT_MENU_VELOCITY_AND_DIFFUSION",e.CONTEXT_MENU_DIFFUSION_AND_VELOCITY="CONTEXT_MENU_DIFFUSION_AND_VELOCITY",e.REPLAY="REPLAY",e.CONTEXT_MENU_TREND_OVERVIEW="CONTEXT_MENU_TREND_OVERVIEW",e.WORKFLOW_SAVED_ENTRIES="WORKFLOW_SAVED_ENTRIES",e.PAGE="PAGE",e.POSTS="POSTS",e.PEOPLE="PEOPLE",e.PAID="PAID",e.VIDEO="VIDEO",e.STORIES="STORIES",e.CONTEXT_COMMAND_CENTER_PREVIEW="CONTEXT_COMMAND_CENTER_PREVIEW",e.WC_PAGE_PERFORMANCE="WC_PAGE_PERFORMANCE",e.WC_ACQUISITION="WC_ACQUISITION",e.WC_AUDIENCE_ENGAGEMENT="WC_AUDIENCE_ENGAGEMENT",e.WC_DEMOGRAPHICS="WC_DEMOGRAPHICS",e.LOAD_MORE_STORY_CLUSTERING="LOAD_MORE_STORY_CLUSTERING",e.ID_HOME_PAGE="ID_HOME_PAGE",e.IM_PAGE_MONITOR_LISTS="IM_PAGE_MONITOR_LISTS",e.IM_PAGE_MONITOR_LIST="IM_PAGE_MONITOR_LIST",e.IM_PAGE_MONITOR_CONTENT="IM_PAGE_MONITOR_CONTENT",e.IM_PAGE_MONITOR_DISCOVERY="IM_PAGE_MONITOR_DISCOVERY",e.IM_PAGE_SEARCH="IM_PAGE_SEARCH",e.IM_PAGE_OUTREACH="IM_PAGE_OUTREACH",e.IM_PAGE_CAMPAIGN_STATUS="IM_PAGE_CAMPAIGN_STATUS",e.IM_PAGE_MEASURE="IM_PAGE_MEASURE",e.IM_PAGE_OUTREACH_CONTENT="IM_PAGE_OUTREACH_CONTENT",e.IM_PAGE_SEARCH_RESULTS="IM_PAGE_SEARCH_RESULTS",e.CONTEXT_INFLUENCER_DETAILS="CONTEXT_INFLUENCER_DETAILS",e.CONTEXT_INFLUENCER_INFO="CONTEXT_INFLUENCER_INFO",e.IBD_ACTIVITY="IBD_ACTIVITY",e.II_MENTIONS="II_MENTIONS",e.CC_CLUSTER="CC_CLUSTER"}(t.PageType||(t.PageType={})),function(e){e.NONE="NONE",e.TOPICS="TOPICS",e.FILTERS="FILTERS",e.EVENTS="EVENTS",e.MEDIA_TYPE="MEDIA_TYPE",e.SENTIMENT="SENTIMENT",e.PANEL="PANEL",e.TAGS="TAGS",e.COUNTRY="COUNTRY",e.LANGUAGE="LANGUAGE",e.INFLUENCERS_COMPARE="INFLUENCERS_COMPARE",e.THEMES="THEMES",e.DEMOGRAPHICS_COMPARE="DEMOGRAPHICS_COMPARE",e.PROFILE="PROFILE",e.CONTENT="CONTENT",e.GENDER_COMPARE="GENDER_COMPARE",e.ENTITIES_COMPARE="ENTITIES_COMPARE",e.SCORE_COMPARE="SCORE_COMPARE",e.DEVICE_COMPARE="DEVICE_COMPARE",e.CUSTOM_ENTITIES_COMPARE="CUSTOM_ENTITIES_COMPARE",e.PMG_BRANDGROUP_COMPARE="PMG_BRANDGROUP_COMPARE",e.PMG_PUBLICATION_UNIT_COMPARE="PMG_PUBLICATION_UNIT_COMPARE",e.SMART_FILTERS="SMART_FILTERS",e.AGE_COMPARE="AGE_COMPARE",e.PAGE_COMPARE="PAGE_COMPARE"}(t.Compare||(t.Compare={})),function(e){e.COLUMN_CHART="COLUMN_CHART",e.TREND_CHART="TREND_CHART",e.IMAGE="IMAGE",e.LEADER="LEADER",e.DEMOGRAPHIC="DEMOGRAPHIC",e.MAP="MAP",e.THEME="THEME",e.BINOCULARS="BINOCULARS",e.COMPASS="COMPASS",e.KPI="KPI",e.LIST="LIST",e.SEARCH="SEARCH",e.NETWORK="NETWORK",e.HANDSHAKE="HANDSHAKE",e.SPEEDOMETER="SPEEDOMETER",e.CLOCK="CLOCK",e.EYE="EYE",e.LIST_SEARCH="LIST_SEARCH",e.SMILEY="SMILEY",e.ROCKET="ROCKET",e.CROSSHAIRS="CROSSHAIRS",e.SUMMARY="SUMMARY",e.WATCHLIST="WATCHLIST",e.NONE="NONE",e.CUSTOM="CUSTOM",e.COLUMNS="COLUMNS",e.LIST_UL="LIST_UL",e.CARDS="CARDS"}(t.PageIcon||(t.PageIcon={}))}),define("enums/topic_enums",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COMPARE_WITH_PREVIOUS="COMPARE_WITH_PREVIOUS",e.COMPARE_WITH_LATEST="COMPARE_WITH_LATEST"}(t.CompareType||(t.CompareType={})),function(e){e.MODIFIED="MODIFIED",e.ADDED="ADDED",e.REMOVED="REMOVED",e.EQUAL="EQUAL"}(t.ChangingType||(t.ChangingType={})),function(e){e.NONE="NONE",e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e.SINGLE_AND_MULTIPLE="SINGLE_AND_MULTIPLE",e.OPPOSITE="OPPOSITE",e.TOPIC_PM_COMPOSED_SELECTION="TOPIC_PM_COMPOSED_SELECTION",e.TOPIC_PM_COMPOSED_SELECTION_MIXED="TOPIC_PM_COMPOSED_SELECTION_MIXED",e.MULTIPLE_INVERTED="MULTIPLE_INVERTED",e.SINGLE_OR_MULTIPLE="SINGLE_OR_MULTIPLE"}(t.SelectType||(t.SelectType={})),function(e){e.CONSTRAINT_AND="CONSTRAINT_AND",e.CONSTRAINT_OR="CONSTRAINT_OR",e.CONSTRAINT_XOR="CONSTRAINT_XOR"}(t.SelectionConstraintStrategy||(t.SelectionConstraintStrategy={})),function(e){e.NONE="NONE",e.NODE="NODE",e.CHILDREN="CHILDREN",e.CHILDREN_RECURSIVE="CHILDREN_RECURSIVE"}(t.Selected||(t.Selected={})),function(e){e.NOT_VISIBLE="NOT_VISIBLE",e.VISIBLE="VISIBLE",e.NEVER_VISIBLE="NEVER_VISIBLE",e.VISIBLE_ANY_TIME="VISIBLE_ANY_TIME"}(t.Visibility||(t.Visibility={}))}),define("enums/widget_enums",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UUID_CONFIG_EDTION="UUID_CONFIG_EDTION",e.UUID_CONFIG_RESTFORM="UUID_CONFIG_RESTFORM",e.UUID_CONFIG_RESULT="UUID_CONFIG_RESULT",e.UUID_CONFIG_RESULT_SIMPLE="UUID_CONFIG_RESULT_SIMPLE",e.UUID_CONFIG_RESULT_PROGRESS_GRAPH="UUID_CONFIG_RESULT_PROGRESS_GRAPH",e.UUID_CONFIG_COUNTER="UUID_CONFIG_COUNTER",e.UUID_CONFIG_COLUMN_CHART_VERTICAL="UUID_CONFIG_COLUMN_CHART_VERTICAL",e.UUID_CONFIG_COLUMN_CHART_VERTICAL_PERC="UUID_CONFIG_COLUMN_CHART_VERTICAL_PERC",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL="UUID_CONFIG_COLUMN_CHART_HORIZONTAL",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_PERC="UUID_CONFIG_COLUMN_CHART_HORIZONTAL_PERC",e.UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED="UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED",e.UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED_PERC="UUID_CONFIG_COLUMN_CHART_VERTICAL_STACKED_PERC",e.UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED="UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED",e.UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED_PERC="UUID_CONFIG_COLUMN_CHART_VERTICAL_NOT_STACKED_PERC",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED="UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED_PERC="UUID_CONFIG_COLUMN_CHART_HORIZONTAL_STACKED_PERC",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_NOT_STACKED="UUID_CONFIG_COLUMN_CHART_HORIZONTAL_NOT_STACKED",e.UUID_CONFIG_COLUMN_CHART_HORIZONTAL_NOT_STACKED_PERC="UUID_CONFIG_COLUMN_CHART_HORIZONTAL_NOT_STACKED_PERC",e.UUID_CONFIG_PIE_CHART="UUID_CONFIG_PIE_CHART",e.UUID_CONFIG_PIE_CHART_LEGEND_BOTTOM="UUID_CONFIG_PIE_CHART_LEGEND_BOTTOM",e.UUID_CONFIG_PIE_CHART_LEGEND_RIGHT="UUID_CONFIG_PIE_CHART_LEGEND_RIGHT",e.UUID_CONFIG_RADAR_CHART_ROW_AXES="UUID_CONFIG_RADAR_CHART_ROW_AXES",e.UUID_CONFIG_RADAR_CHART_COLUMN_AXES="UUID_CONFIG_RADAR_CHART_COLUMN_AXES",e.UUID_CONFIG_WHEEL_CHART="UUID_CONFIG_WHEEL_CHART",e.UUID_CONFIG_MULTI_METRICS="UUID_CONFIG_MULTI_METRICS",e.UUID_CONFIG_LINE_CHART="UUID_CONFIG_LINE_CHART",e.UUID_CONFIG_LINE_CHART_AREA="UUID_CONFIG_LINE_CHART_AREA",e.UUID_CONFIG_LINE_CHART_MULTIPLE="UUID_CONFIG_LINE_CHART_MULTIPLE",e.UUID_CONFIG_LINE_CHART_MULTIPLE_AREA="UUID_CONFIG_LINE_CHART_MULTIPLE_AREA",e.UUID_CONFIG_VELOCITY_CHART="UUID_CONFIG_VELOCITY_CHART",e.UUID_CONFIG_STREAM_GRAPH="UUID_CONFIG_STREAM_GRAPH",e.UUID_CONFIG_PROGRESS_GRAPH="UUID_CONFIG_PROGRESS_GRAPH",e.UUID_CONFIG_PROGRESS_GRAPH_PERC="UUID_CONFIG_PROGRESS_GRAPH_PERC",e.UUID_CONFIG_PAGE_DEFAULT="UUID_CONFIG_PAGE_DEFAULT",e.UUID_CONFIG_SECTION_DEFAULT="UUID_CONFIG_SECTION_DEFAULT",e.UUID_CONFIG_SECTION_MAP="UUID_CONFIG_SECTION_MAP",e.UUID_CONFIG_MAP="UUID_CONFIG_MAP",e.UUID_CONFIG_MAP_HEATMAP="UUID_CONFIG_MAP_HEATMAP",e.UUID_CONFIG_MAP_GEO_CENTROID="UUID_CONFIG_MAP_GEO_CENTROID",e.UUID_CONFIG_MAP_CHOROPLETH="UUID_CONFIG_MAP_CHOROPLETH",e.UUID_CONFIG_MAP_EMOJI="UUID_CONFIG_MAP_EMOJI",e.UUID_CONFIG_COMPOSER="UUID_CONFIG_COMPOSER",e.UUID_CONFIG_ENTRIES_RESULTS_DEFAULT="UUID_CONFIG_ENTRIES_RESULTS_DEFAULT",e.UUID_CONFIG_ENTRIES_RESULTS_NO_METRICS="UUID_CONFIG_ENTRIES_RESULTS_NO_METRICS",e.UUID_CONFIG_ENTRIES_RESULTS_IMAGE_GRID="UUID_CONFIG_ENTRIES_RESULTS_IMAGE_GRID",e.UUID_CONFIG_ENTRIES_RESULTS_IMAGE_TILES="UUID_CONFIG_ENTRIES_RESULTS_IMAGE_TILES",e.UUID_CONFIG_ENTRIES_RESULTS_COMPACT="UUID_CONFIG_ENTRIES_RESULTS_COMPACT",e.UUID_CONFIG_ENTRIES_RESULTS_STORY_TILES="UUID_CONFIG_ENTRIES_RESULTS_STORY_TILES",e.UUID_CONFIG_ENTRIES_RESULTS_WORLD_MAP="UUID_CONFIG_ENTRIES_RESULTS_WORLD_MAP",e.UUID_CONFIG_ENTRIES_RESULTS_TREE_MAP="UUID_CONFIG_ENTRIES_RESULTS_TREE_MAP",e.UUID_CONFIG_ENTRIES_RESULTS_STORIES="UUID_CONFIG_ENTRIES_RESULTS_STORIES",e.UUID_CONFIG_ENTRIES_RESULTS_INTERACTIONS="UUID_CONFIG_ENTRIES_RESULTS_INTERACTIONS",e.UUID_CONFIG_ENTRIES_RESULTS_SLIDES_ONE="UUID_CONFIG_ENTRIES_RESULTS_SLIDES_ONE",e.UUID_CONFIG_ENTRIES_RESULTS_SLIDES_THREE="UUID_CONFIG_ENTRIES_RESULTS_SLIDES_THREE",e.UUID_CONFIG_ENTRIES_RESULTS_SLIDES_FIVE="UUID_CONFIG_ENTRIES_RESULTS_SLIDES_FIVE",e.UUID_CONFIG_ENTRIES_RESULTS_SLIDES_TEN="UUID_CONFIG_ENTRIES_RESULTS_SLIDES_TEN",e.UUID_CONFIG_ENTRIES_RESULTS_SLIDES_IMAGES="UUID_CONFIG_ENTRIES_RESULTS_SLIDES_IMAGES",e.UUID_CONFIG_ISSUE_TRACKER_ITEMS_TABLE="UUID_CONFIG_ISSUE_TRACKER_ITEMS_TABLE",e.UUID_CONFIG_ISSUE_TRACKER_ISSUES_TILE="UUID_CONFIG_ISSUE_TRACKER_ISSUES_TILE",e.UUID_CONFIG_DATA_TABLE_DEFAULT="UUID_CONFIG_DATA_TABLE_DEFAULT",e.UUID_CONFIG_DATA_TABLE_FANCY="UUID_CONFIG_DATA_TABLE_FANCY",e.UUID_CONFIG_INFLUENCERS_DEFAULT="UUID_CONFIG_INFLUENCERS_DEFAULT",e.UUID_CONFIG_INFLUENCERS_TABLE_DEFAULT="UUID_CONFIG_INFLUENCERS_TABLE_DEFAULT",e.UUID_CONFIG_BUBBLE_DEFAULT="UUID_CONFIG_BUBBLE_DEFAULT",e.UUID_CONFIG_BUBBLE_TRENDS_DEFAULT="UUID_CONFIG_BUBBLE_TRENDS_DEFAULT",e.UUID_CONFIG_IMPACT_BUBBLES_DEFAULT="UUID_CONFIG_IMPACT_BUBBLES_DEFAULT",e.UUID_CONFIG_ACTIVITY_DEFAULT="UUID_CONFIG_ACTIVITY_DEFAULT",e.UUID_CONFIG_GENDER_DEFAULT="UUID_CONFIG_GENDER_DEFAULT",e.UUID_CONFIG_INFLUENCERLIST_LIST="UUID_CONFIG_INFLUENCERLIST_LIST",e.UUID_CONFIG_INFLUENCERLIST_DEFAULT="UUID_CONFIG_INFLUENCERLIST_DEFAULT",e.UUID_CONFIG_INFLUENCERLIST_TILE="UUID_CONFIG_INFLUENCERLIST_TILE",e.UUID_CONFIG_INFLUENCERLIST_DETAILED="UUID_CONFIG_INFLUENCERLIST_DETAILED",e.UUID_CONFIG_INFLUENCERLIST_CONTACTS="UUID_CONFIG_INFLUENCERLIST_CONTACTS",e.UUID_CONFIG_INFLUENCERLIST_LABELS="UUID_CONFIG_INFLUENCERLIST_LABELS",e.UUID_CONFIG_INFLUENCER_OVERVIEW_DEFAULT="UUID_CONFIG_INFLUENCER_OVERVIEW_DEFAULT",e.UUID_CONFIG_TOP_INFLUENCERS_OVERVIEW_DEFAULT="UUID_CONFIG_TOP_INFLUENCERS_OVERVIEW_DEFAULT",e.UUID_CONFIG_ENTRIES_THEME_CLOUD="UUID_CONFIG_ENTRIES_THEME_CLOUD",e.UUID_CONFIG_ENTRIES_THEME_CLOUD_HORIZONTAL="UUID_CONFIG_ENTRIES_THEME_CLOUD_HORIZONTAL",e.UUID_CONFIG_ENTRIES_THEME_TREE_WITH_TRENDS="UUID_CONFIG_ENTRIES_THEME_TREE_WITH_TRENDS",e.UUID_CONFIG_ENTRIES_THEME_TREE_ONLY_TRENDS="UUID_CONFIG_ENTRIES_THEME_TREE_ONLY_TRENDS",e.UUID_CONFIG_ENTRIES_THEME_TREE="UUID_CONFIG_ENTRIES_THEME_TREE",e.UUID_CONFIG_THEME_PIE_CHART="UUID_CONFIG_THEME_PIE_CHART",e.UUID_CONFIG_THEME_WHEEL_CHART="UUID_CONFIG_THEME_WHEEL_CHART",e.UUID_CONFIG_THEME_COLUMN_CHART="UUID_CONFIG_THEME_COLUMN_CHART",e.UUID_CONFIG_THEME_COLUMN_CHART_STACKED_PERC="UUID_CONFIG_THEME_COLUMN_CHART_STACKED_PERC",e.UUID_CONFIG_THEME_COLUMN_CHART_STACKED="UUID_CONFIG_THEME_COLUMN_CHART_STACKED",e.UUID_CONFIG__THEME_BAR_CHART="UUID_CONFIG__THEME_BAR_CHART",e.UUID_CONFIG_THEME_BAR_CHART_STACKED_PERC="UUID_CONFIG_THEME_BAR_CHART_STACKED_PERC",e.UUID_CONFIG_THEME_BAR_CHART_STACKED="UUID_CONFIG_THEME_BAR_CHART_STACKED",e.UUID_CONFIG_THEME_TREEMAP="UUID_CONFIG_THEME_TREEMAP",e.UUID_CONFIG_THEME_SORTED="UUID_CONFIG_THEME_SORTED",e.UUID_CONFIG_TOPIC_COUNT_RENDERING="UUID_CONFIG_TOPIC_COUNT_RENDERING",e.UUID_CONFIG_TEXT_HEADLINE="UUID_CONFIG_TEXT_HEADLINE",e.UUID_CONFIG_TEXT_PARAGRAPH="UUID_CONFIG_TEXT_PARAGRAPH",e.UUID_CONFIG_TEXT_HEADLINE_PARAGRAPH="UUID_CONFIG_TEXT_HEADLINE_PARAGRAPH",e.UUID_CONFIG_TEXT_IMAGE="UUID_CONFIG_TEXT_IMAGE",e.UUID_CONFIG_TEXT_TEXT_TOP="UUID_CONFIG_TEXT_TEXT_TOP",e.UUID_CONFIG_TEXT_TEXT_RIGHT="UUID_CONFIG_TEXT_TEXT_RIGHT",e.UUID_CONFIG_TEXT_TEXT_BOTTOM="UUID_CONFIG_TEXT_TEXT_BOTTOM",e.UUID_CONFIG_TEXT_TEXT_LEFT="UUID_CONFIG_TEXT_TEXT_LEFT",e.UUID_CONFIG_TEXT_VIDEO="UUID_CONFIG_TEXT_VIDEO",e.UUID_CONFIG_TEXT_VIDEO_TOP="UUID_CONFIG_TEXT_VIDEO_TOP",e.UUID_CONFIG_TOPICS_COMPARE="UUID_CONFIG_TOPICS_COMPARE",e.UUID_CONFIG_PAGE_BREAK="UUID_CONFIG_PAGE_BREAK",e.UUID_CONFIG_MESSAGE_DIFFUSION_ENTRIES="UUID_CONFIG_MESSAGE_DIFFUSION_ENTRIES",e.UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS="UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS",e.UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS_ENTRIES="UUID_CONFIG_MESSAGE_DIFFUSION_LEADERS_ENTRIES",e.UUID_CONFIG_DOCUMENT_CLUSTER="UUID_CONFIG_DOCUMENT_CLUSTER",e.UUID_CONFIG_INFLUENCERS_NETWORK="UUID_CONFIG_INFLUENCERS_NETWORK",e.UUID_CONFIG_INFLUENCERS_NETWORK_GRAPH="UUID_CONFIG_INFLUENCERS_NETWORK_GRAPH",e.UUID_CONFIG_INFLUENCERS_NETWORK_INFLUENCERS="UUID_CONFIG_INFLUENCERS_NETWORK_INFLUENCERS",e.UUID_CONFIG_INFLUENCERS_NETWORK_I_ONE="UUID_CONFIG_INFLUENCERS_NETWORK_I_ONE",e.UUID_CONFIG_EXTERNAL_DATA="UUID_CONFIG_EXTERNAL_DATA",e.UUID_CONFIG_TRENDS_TABLE="UUID_CONFIG_TRENDS_TABLE",e.UUID_CONFIG_TOP_ELEMENTS_TABLE="UUID_CONFIG_TOP_ELEMENTS_TABLE",e.UUID_CONFIG_TOP_IMAGES="UUID_CONFIG_TOP_IMAGES",e.UUID_CONFIG_EXTERNAL_TRENDS_LIST="UUID_CONFIG_EXTERNAL_TRENDS_LIST",e.UUID_CONFIG_EXTERNAL_TRENDS_CLOUD="UUID_CONFIG_EXTERNAL_TRENDS_CLOUD",e.UUID_CONFIG_SUMMARY_WIDGET="UUID_CONFIG_SUMMARY_WIDGET",e.UUID_CONFIG_CAMPAIGNS_TABLE="UUID_CONFIG_CAMPAIGNS_TABLE"}(t.ConfigurationDefaultsEnum||(t.ConfigurationDefaultsEnum={})),function(e){e.NONE_DATA="NONE_DATA",e.LINE_CHART="LINE_CHART",e.LINE_CHART_AREA="LINE_CHART_AREA",e.LINE_CHART_MULTIPLE="LINE_CHART_MULTIPLE",e.LINE_CHART_MULTIPLE_AREA="LINE_CHART_MULTIPLE_AREA",e.COLUMN_CHART_VERTICAL="COLUMN_CHART_VERTICAL",e.COLUMN_CHART_VERTICAL_PERC="COLUMN_CHART_VERTICAL_PERC",e.COLUMN_CHART_HORIZONTAL="COLUMN_CHART_HORIZONTAL",e.COLUMN_CHART_HORIZONTAL_PERC="COLUMN_CHART_HORIZONTAL_PERC",e.COLUMN_CHART_VERTICAL_STACKED="COLUMN_CHART_VERTICAL_STACKED",e.COLUMN_CHART_VERTICAL_NOT_STACKED="COLUMN_CHART_VERTICAL_NOT_STACKED",e.COLUMN_CHART_VERTICAL_STACKED_PERC="COLUMN_CHART_VERTICAL_STACKED_PERC",e.COLUMN_CHART_VERTICAL_NOT_STACKED_PERC="COLUMN_CHART_VERTICAL_NOT_STACKED_PERC",e.COLUMN_CHART_HORIZONTAL_STACKED="COLUMN_CHART_HORIZONTAL_STACKED",e.COLUMN_CHART_HORIZONTAL_NOT_STACKED="COLUMN_CHART_HORIZONTAL_NOT_STACKED",e.COLUMN_CHART_HORIZONTAL_STACKED_PERC="COLUMN_CHART_HORIZONTAL_STACKED_PERC",e.COLUMN_CHART_HORIZONTAL_NOT_STACKED_PERC="COLUMN_CHART_HORIZONTAL_NOT_STACKED_PERC",e.WHEEL_CHART="WHEEL_CHART",e.RADAR_CHART_ROW_AXES="RADAR_CHART_ROW_AXES",e.RADAR_CHART_COLUMN_AXES="RADAR_CHART_COLUMN_AXES",e.STREAM_GRAPH="STREAM_GRAPH",e.PROGRESS_GRAPH="PROGRESS_GRAPH",e.PROGRESS_GRAPH_PERC="PROGRESS_GRAPH_PERC",e.BUBBLE="BUBBLE",e.ACTIVITY="ACTIVITY",e.DATATABLE="DATATABLE",e.PIE_CHART="PIE_CHART",e.RESULT="RESULT",e.GENDER="GENDER",e.MAP_DEFAULT="MAP_DEFAULT",e.MAP_HEATMAP="MAP_HEATMAP",e.ENTRIES_DATA_TYPE="ENTRIES_DATA_TYPE",e.INFLUENCORS_DATA_TYPE="INFLUENCORS_DATA_TYPE",e.FANCY_DATATABLE="FANCY_DATATABLE",e.COUNTER="COUNTER",e.RESULTSLIST="RESULTSLIST",e.RESULTSLIST_IMAGE_GRID="RESULTSLIST_IMAGE_GRID",e.RESULTSLIST_IMAGE_TILES="RESULTSLIST_IMAGE_TILES",e.RESULTSLIST_NO_METRICS="RESULTSLIST_NO_METRICS",e.RESULTSLIST_COMPACT="RESULTSLIST_COMPACT",e.RESULTSLIST_STORIES="RESULTSLIST_STORIES",e.RESULTSLIST_STORY_TILES="RESULTSLIST_STORY_TILES",e.RESULTSLIST_WORLD_MAP="RESULTSLIST_WORLD_MAP",e.RESULTSLIST_TREE_MAP="RESULTSLIST_TREE_MAP",e.RESULTSLIST_INTERACTIONS="RESULTSLIST_INTERACTIONS",e.RESULTSLIST_SLIDES_ONE="RESULTSLIST_SLIDES_ONE",e.RESULTSLIST_SLIDES_THREE="RESULTSLIST_SLIDES_THREE",e.RESULTSLIST_SLIDES_FIVE="RESULTSLIST_SLIDES_FIVE",e.RESULTSLIST_SLIDES_TEN="RESULTSLIST_SLIDES_TEN",e.RESULTSLIST_SLIDES_IMAGES="RESULTSLIST_SLIDES_IMAGES",e.INFLUENCER_MANAGEMENT_TILE="INFLUENCER_MANAGEMENT_TILE",e.INFLUENCER_MANAGEMENT_DETAILED="INFLUENCER_MANAGEMENT_DETAILED",e.INFLUENCER_MANAGEMENT_NOTES="INFLUENCER_MANAGEMENT_NOTES",e.INFLUENCER_MANAGEMENT_LIST="INFLUENCER_MANAGEMENT_LIST",e.INFLUENCER_MANAGEMENT_CONTACT="INFLUENCER_MANAGEMENT_CONTACT",e.CAMPAIGNS_TABLE="CAMPAIGNS_TABLE",e.DATA_SET="DATA_SET",e.THEME_TREE_WITH_TRENDS="THEME_TREE_WITH_TRENDS",e.THEME_TREE_ONLY_TRENDS="THEME_TREE_ONLY_TRENDS",e.THEME_TREE="THEME_TREE",e.TAGCLOUD_LIST="TAGCLOUD_LIST",e.TAGCLOUD_OLD="TAGCLOUD_OLD",e.THEME_PIE_CHART="THEME_PIE_CHART",e.THEME_BAR_CHART="THEME_BAR_CHART",e.THEME_BAR_CHART_STACKED="THEME_BAR_CHART_STACKED",e.THEME_BAR_CHART_STACKED_PERC="THEME_BAR_CHART_STACKED_PERC",e.THEME_COLUMN_CHART="THEME_COLUMN_CHART",e.THEME_COLUMN_CHART_STACKED="THEME_COLUMN_CHART_STACKED",e.THEME_COLUMN_CHART_STACKED_PERC="THEME_COLUMN_CHART_STACKED_PERC",e.THEME_WHEEL_CHART="THEME_WHEEL_CHART",e.THEME_TREE_MAP="THEME_TREE_MAP",e.THEME_SORTED="THEME_SORTED",e.COMPOSED_GRAPH="COMPOSED_GRAPH",e.TEXT_HEADLINE="TEXT_HEADLINE",e.TEXT_PARAGRAPH="TEXT_PARAGRAPH",e.TEXT_HEADLINE_PARAGRAPH="TEXT_HEADLINE_PARAGRAPH",e.TEXT_IMAGE="TEXT_IMAGE",e.TEXT_TEXT_TOP="TEXT_TEXT_TOP",e.TEXT_TEXT_RIGHT="TEXT_TEXT_RIGHT",e.TEXT_TEXT_BOTTOM="TEXT_TEXT_BOTTOM",e.TEXT_TEXT_LEFT="TEXT_TEXT_LEFT",e.TEXT_VIDEO="TEXT_VIDEO",e.TEXT_VIDEO_TOP="TEXT_VIDEO_TOP",e.PAGE_BREAK="PAGE_BREAK",e.MESSAGE_DIFFUSION_ENTRIES_LEADERS_DATA_TYPE="MESSAGE_DIFFUSION_ENTRIES_LEADERS_DATA_TYPE",e.MESSAGE_DIFFUSION_ENTRIES_DATA_TYPE="MESSAGE_DIFFUSION_ENTRIES_DATA_TYPE",e.INFLUENCER_OVERVIEW="INFLUENCER_OVERVIEW",e.TOP_INFLUENCERS_OVERVIEW="TOP_INFLUENCERS_OVERVIEW",e.MESSAGE_DIFFUSION_LEADERS_DATA_TYPE="MESSAGE_DIFFUSION_LEADERS_DATA_TYPE",e.RESULT_SIMPLE="RESULT_SIMPLE",e.MULTI_METRICS="MULTI_METRICS",e.VELOCITY_LINE_CHART="VELOCITY_LINE_CHART",e.INFLUENCERS_NETWORK="INFLUENCERS_NETWORK",e.MAP_GEO_CENTROID="MAP_GEO_CENTROID",e.EXTERNAL_DATA_WIDGET="EXTERNAL_DATA_WIDGET",e.TRENDS_TABLE="TRENDS_TABLE",e.SUMMARY_WIDGET="SUMMARY_WIDGET",e.TOP_IMAGES="TOP_IMAGES",e.INFLUENCERS_NETWORK_GRAPH="INFLUENCERS_NETWORK_GRAPH",e.INFLUENCERS_NETWORK_INFLUENCERS="INFLUENCERS_NETWORK_INFLUENCERS",e.INFLUENCERS_NETWORK_I_ONE="INFLUENCERS_NETWORK_I_ONE",e.RESTFORM="RESTFORM",e.EXTERNAL_TRENDS_LIST="EXTERNAL_TRENDS_LIST",e.EXTERNAL_TRENDS_CLOUD="EXTERNAL_TRENDS_CLOUD",e.MAP_CHOROPLETH="MAP_CHOROPLETH",e.MAP_EMOJI="MAP_EMOJI",e.IMPACT_BUBBLE="IMPACT_BUBBLE",e.RESULT_PROGRESS_GRAPH="RESULT_PROGRESS_GRAPH",e.TOP_ELEMENTS_TABLE="TOP_ELEMENTS_TABLE",e.ISSUE_ITEMS_TABLE="ISSUE_ITEMS_TABLE",e.ISSUES_TILE="ISSUES_TILE",e.DOCUMENT_CLUSTER="DOCUMENT_CLUSTER",e.DOCUMENT_CLUSTER_GRAPH="DOCUMENT_CLUSTER_GRAPH"}(t.DataType||(t.DataType={})),function(e){e.AREA="AREA",e.DOT_CHART="DOT_CHART",e.LINE_CHART="LINE_CHART",e.MAP="MAP",e.PIE_CHART="PIE_CHART",e.BAR_CHART="BAR_CHART",e.COLUMN_CHART="COLUMN_CHART",e.MULTI_METRICS="MULTI_METRICS",e.SUMMARY="SUMMARY",e.RADAR_CHART="RADAR_CHART"}(t.TypeGraph||(t.TypeGraph={})),function(e){e.UUID_CONFIG_ENTRIES_DEFAULT="UUID_CONFIG_ENTRIES_DEFAULT",e.UUID_CONFIG_GRAPH_ON_TOP_OF_ENTRIES_CONFIGURATION="UUID_CONFIG_GRAPH_ON_TOP_OF_ENTRIES_CONFIGURATION",e.UUID_CONFIG_WORLDMAP_CONFIGURATION="UUID_CONFIG_WORLDMAP_CONFIGURATION",e.UUID_CONFIG_INFLUENCORS_CONFIGURATION="UUID_CONFIG_INFLUENCORS_CONFIGURATION",e.UUID_CONFIG_DEFAULT_GRAPH="UUID_CONFIG_DEFAULT_GRAPH",e.UUID_CONFIG_TAG_CLOUD="UUID_CONFIG_TAG_CLOUD",e.UUID_CONFIG_TAG_CLOUD_LINE_CHART="UUID_CONFIG_TAG_CLOUD_LINE_CHART",e.UUID_CONFIG_INFLUENCER_OVERVIEW="UUID_CONFIG_INFLUENCER_OVERVIEW",e.UUID_CONFIG_EXTERNAL_DATA="UUID_CONFIG_EXTERNAL_DATA",e.UUID_CONFIG_NETWORK="UUID_CONFIG_NETWORK",e.UUID_CONFIG_INFLUENCERS_DEFAULT="UUID_CONFIG_INFLUENCERS_DEFAULT",e.UUID_CONFIG_DOCUMENT_CLUSTER="UUID_CONFIG_DOCUMENT_CLUSTER"}(t.TypeExtendedConfiguration||(t.TypeExtendedConfiguration={})),function(e){e.NO_PAYLOAD="NO_PAYLOAD",e.PAYLOAD_BUBBLE="PAYLOAD_BUBBLE",e.PAYLOAD_DATAGRAPH="PAYLOAD_DATAGRAPH",e.PAYLOAD_DATA_TABLE="PAYLOAD_DATA_TABLE",e.PAYLOAD_EDITION="PAYLOAD_EDITION",e.PAYLOAD_GENDER="PAYLOAD_GENDER",e.PAYLOAD_INFLUENCER_LIST="PAYLOAD_INFLUENCER_LIST",e.PAYLOAD_INFLUENCER_OVERVIEW="PAYLOAD_INFLUENCER_OVERVIEW",e.PAYLOAD_TOP_INFLUENCERS_OVERVIEW="PAYLOAD_TOP_INFLUENCERS_OVERVIEW",e.PAYLOAD_ACTIVITY="PAYLOAD_ACTIVITY",e.PAYLOAD_MAP="PAYLOAD_MAP",e.PAYLOAD_RESULT="PAYLOAD_RESULT",e.PAYLOAD_THEME_CLOUD="PAYLOAD_THEME_CLOUD",e.PAYLOAD_COMPOSER="PAYLOAD_COMPOSER",e.PAYLOAD_TOPICS_COUNT="PAYLOAD_TOPICS_COUNT",e.PAYLOAD_TEXT="PAYLOAD_TEXT",e.PAYLOAD_PAGE_BREAK="PAYLOAD_PAGE_BREAK",e.PAYLOAD_MESSAGE_DIFFUSION_ENTRIES="PAYLOAD_MESSAGE_DIFFUSION_ENTRIES",e.PAYLOAD_THEME_TREE="PAYLOAD_THEME_TREE",e.PAYLOAD_VELOCITY_DATAGRAPH="PAYLOAD_VELOCITY_DATAGRAPH",e.PAYLOAD_INFLUENCER_NETWORK="PAYLOAD_INFLUENCER_NETWORK",e.PAYLOAD_DOCUMENT_CLUSTER="PAYLOAD_DOCUMENT_CLUSTER",e.PAYLOAD_EXTERNAL_DATA="PAYLOAD_EXTERNAL_DATA",e.PAYLOAD_TRENDS_TABLE="PAYLOAD_TRENDS_TABLE",e.PAYLOAD_SUMMARY_WIDGET="PAYLOAD_SUMMARY_WIDGET",e.PAYLOAD_ENTRIES="PAYLOAD_ENTRIES",e.PAYLOAD_ARTICLES="PAYLOAD_ARTICLES",e.PAYLOAD_TOPICS_COMPARE="PAYLOAD_TOPICS_COMPARE",e.PAYLOAD_RESTFORM="PAYLOAD_RESTFORM",e.PAYLOAD_PROGRESS="PAYLOAD_PROGRESS",e.PAYLOAD_CAMPAIGNS_TABLE="PAYLOAD_CAMPAIGNS_TABLE",e.PAYLOAD_EXTERNAL_TRENDS="PAYLOAD_EXTERNAL_TRENDS",e.PAYLOAD_ISSUE_ITEMS_TABLE="PAYLOAD_ISSUE_ITEMS_TABLE",e.PAYLOAD_ISSUES_LIST="PAYLOAD_ISSUES_LIST"}(t.PayloadType||(t.PayloadType={}))}),define("talkwalker_constants",["require","exports","enums/ai_enums","enums/navigation_enums","enums/topic_enums","enums/widget_enums"],function(e,t,i,s,n,r){"use strict";function o(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),o(i),o(s),o(n),o(r)}),define("mock_service",["require","exports","underscore","map"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,r=/([^\s,]+)/g;class o{static ensureMocked(e,t){if(void 0===e[t])throw new Error(`Object does not have property ${t}`);!0!==e[t].__mocked&&o.mock(e,t)}static mock(e,t){o.data.has(e)||o.data.set(e,new s.Map),o.data.get(e).has(t)||o.data.get(e).set(t,[]);const n=e[t];e[t]=function(...s){const r=o.matchParamNamesToValues(n,s),a=o.getRules(e,t),l=i.find(a,e=>o.canIntercept(r,e));return void 0!==l?i.isFunction(l.replacement)?l.replacement.apply(this,[n,...s]):l.replacement:n.apply(this,s)},e[t].__mocked=!0}static matchParamNamesToValues(e,t){const i=o.getParamNames(e),s={};for(let e=0;e<Math.min(i.length,t.length);e++)s[i[e]]=t[e];return s}static getParamNames(e){const t=e.toString().replace(n,"");let i=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(r);return null===i&&(i=[]),i}static canIntercept(e,t){return void 0===t.args||Object.keys(t.args).every(function(s){return void 0!==e[s]&&(i.isFunction(t.args[s])?t.args[s](e[s]):t.args[s]===e[s])})}static getRules(e,t){return o.data.get(e).get(t)}static storeRule(e,t,i){o.data.get(e).get(t).push(i)}static removeAllRules(){o.data.keys().forEach(e=>o.removeAllRulesForObject(e))}static removeAllRulesForObject(e){o.data.get(e).keys().forEach(t=>o.removeAllRulesForFunction(e,t))}static removeAllRulesForFunction(e,t){o.data.get(e).get(t).length=0}static addRule(e,t,i){o.ensureMocked(e,t),o.storeRule(e,t,i)}static block(e,t,i){return o.addRule(e,t,{replacement:i})}static intercept(e,t,i){return o.addRule(e,t,{replacement:i})}}o.data=new s.Map,t.MockService=o}),define("mock_request_animation_frame",["require","exports","mock_service"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockRequestAnimationFrame=function(){const e={lastFrameId:0,pendingFrames:[],flush(){const e=this.pendingFrames.slice();for(;e.length;){const{id:t,fn:i}=e.shift();i(),console.error("executed fn in RAF",i),cancelAnimationFrame(t)}},requestAnimationFrame(e){console.error("RAF",e);const t=++this.lastFrameId;return this.pendingFrames.push({id:t,fn:e}),t},cancelAnimationFrame(e){for(let t,i=0;t=this.pendingFrames[i];i++)if(t.id===e)return void this.pendingFrames.splice(i,1)},restore(){this.lastFrameId=0,this.pendingFrames=[],i.MockService.removeAllRulesForFunction(window,"requestAnimationFrame"),i.MockService.removeAllRulesForFunction(window,"cancelAnimationFrame"),i.MockService.removeAllRulesForFunction(global,"requestAnimationFrame"),i.MockService.removeAllRulesForFunction(global,"cancelAnimationFrame")},setup(){i.MockService.intercept(window,"requestAnimationFrame",(t,i)=>{e.requestAnimationFrame(i)}),i.MockService.intercept(window,"cancelAnimationFrame",(t,i)=>{e.cancelAnimationFrame(i)}),i.MockService.intercept(global,"requestAnimationFrame",(t,i)=>{e.requestAnimationFrame(i)}),i.MockService.intercept(global,"cancelAnimationFrame",(t,i)=>{e.cancelAnimationFrame(i)})}};return e}}),define("test_utilities",["require","exports","mock_request_animation_frame","mock_service"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("actions/text_editor_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextEditorActions={textEditor_onSave:"textEditor_onSave",textEditor_onSaveLayout:"textEditor_onSaveLayout",textEditor_onDelete:"textEditor_onDelete",textEditor_onEdit:"textEditor_onEdit"}}),define("renderables/layout/base_layout_element",["require","exports","flux","event"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseLayoutElement=class extends i.BaseComponent{constructor(e){super(e),this.onDataChange=new s.Event}hide(){this.props.model.hidden=!0}show(){this.props.model.hidden=!1}save(e){void 0!==this.props.model.save&&(this.props.editorState[this.props.model.save]=e)}isValid(){return!0}}}),define("models/text_editor_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/controllers/controllers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ImageUploadController=0]="ImageUploadController",e[e.VideoController=1]="VideoController"}(t.TextEditorControllers||(t.TextEditorControllers={}))}),define("models/text_editor_body_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/layout/text_style_toolbar",["require","exports","react","renderables/layout/base_layout_element","reusable_components","classnames"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextStyleToolbar=class extends s.BaseLayoutElement{constructor(e){super(e)}componentWillReceiveProps(){this.onDataChange.cancelAll()}componentWillUnmount(){this.onDataChange.cancelAll()}render(){const{editMode:e,model:{enableTextLayouts:t}}=this.props;return e&&t?this.renderEditMode():null}renderEditMode(){const{model:e,editorState:t}=this.props;this.ensureDataPresence(t[e.save]);const s=this.currentData;function o(e){return r({"label-primary":s.text_alignment===e})}function a(e,t=!1){return r({"label-primary":s.text_orientation===e,"rotated-button":t})}return i.createElement("div",{id:"text-style-toolbar",className:"text-style-toolbar"},i.createElement("label",{className:"form-group-label text-right"},"Textstyle Toolbar"),i.createElement("div",{id:"button-list",className:"button-list"},i.createElement(n.ButtonRenderable,{id:"align-left",icon:"fa fa-align-left",className:o("left"),onClick:()=>this.handleClick("text_alignment","left")}),i.createElement(n.ButtonRenderable,{id:"align-center",icon:"fa fa-align-center",className:o("center"),onClick:()=>this.handleClick("text_alignment","center")}),i.createElement(n.ButtonRenderable,{id:"align-right",icon:"fa fa-align-right",className:o("right"),onClick:()=>this.handleClick("text_alignment","right")}),i.createElement(n.ButtonRenderable,{id:"orientation-horizontal",icon:"fa fa-align-justify",className:a("horizontal"),onClick:()=>this.handleClick("text_orientation","horizontal")}),i.createElement(n.ButtonRenderable,{id:"orientation-vertical",icon:"fa fa-align-justify",className:a("vertical",!0),onClick:()=>this.handleClick("text_orientation","vertical")})))}ensureDataPresence(e=this.props.editorState[this.props.model.save]){void 0===e&&(this.save({text_alignment:"left",text_orientation:"horizontal"}),e=this.props.editorState[this.props.model.save]),void 0===this.oldData&&(this.oldData=JSON.parse(JSON.stringify(e))),void 0===this.currentData&&(this.currentData=JSON.parse(JSON.stringify(e)))}handleClick(e,t){const i=this.currentData;i[e]!==t&&(i[e]=t,this.save(JSON.parse(JSON.stringify(i))),this.onDataChange.fire(i),this.forceUpdate())}}}),define("renderables/text_editor_body",["require","exports","event","flux","react","underscore","classnames","renderables/layout/layout_element_factory"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextEditorBody=class extends s.BaseComponent{constructor(e){super(e),this.onForceUpdate=new i.Event,this.state=this.calculateState(e),this.onForceUpdate.subscribe(()=>{this.forceUpdate()})}render(){const{forceRender:e,useImageBackground:t,editorState:i,editMode:s}=this.props;let a=[];this.state.model.layout.forEach(e=>e.forEach(e=>e.items.forEach(e=>a.push(e.id)))),a=a.map(e=>this.state.model.content[e].save),Object.keys(this.props.editorState).forEach(e=>r.contains(a,e)?r.noop:delete this.props.editorState[e]);const l=o({"editor-body":!0,"fill-background":t}),{controllers:c,model:d}=this.state,h=d.layout,u=c.reduce((e,t)=>t.enhanceLayout(e,i,s),h);return n.createElement("div",{className:l,key:e},u.map((e,t)=>this.renderBlock(e,this.state.model.content,t)))}renderBlock(e,t,i){return n.createElement("div",{className:"block",key:i,ref:e=>{e&&this.state.controllers.forEach(e=>e.initialize())}},this.enhanceBlock(e.filter(e=>this.isSectionAllowed(e,t))).map((e,i)=>this.renderSection(e,t,i)))}componentDidMount(){r.invoke(this.state.controllers,"initializeOrUpdate")}componentWillReceiveProps(e){this.props!==e&&this.setState(this.calculateState(e))}componentWillUnmount(){r.invoke(this.state.controllers,"dispose")}componentDidUpdate(){r.invoke(this.state.controllers,"initializeOrUpdate"),this.props.validate()}renderSection(e,t,i){const{editorState:s,editMode:r,layoutElements:l,fragmentDrawSettings:c}=this.props,d=this.getSectionStyle(e),h=s.text_style,u=e.items.filter(e=>"header"===e.id||"text"===e.id).length>0,p=this.state.model.content.enableTextLayouts,g=!!h&&u&&p&&!this.props.editMode,m=o({"editor-body-section":p,"center-aligned":g&&"center"===h.text_alignment,"right-aligned":g&&"right"===h.text_alignment,"vertical-text-adapter":g&&"vertical"===h.text_orientation});return n.createElement("div",{style:d,key:i,className:m},a.LayoutElementFactory.createSection(e,t,this.state.controllers,r,s,c,l))}getSectionStyle(e){return 0===e.widthRatio?{width:0,display:"none"}:{width:100*e.widthRatio+"%"}}isSectionAllowed(e,t){return!(e.editOnly&&!this.props.editMode)&&((!e.normalOnly||!this.props.editMode)&&e.items.filter(e=>!e.editOnly||this.props.editMode).filter(e=>!e.normalOnly||!this.props.editMode).filter(e=>!e.optional||(this.props.editorState[t[e.id].save]||"").length>0).length>0)}calculateState(e){const t=e.query.execute();return{model:t,controllers:this.processControllers(t,e.editMode)}}processControllers(e,t){const i=(e.controllers||[]).filter(e=>!e.editOnly||t),{state:{controllers:s=[]}={}}=this;if(void 0===s)return a.LayoutElementFactory.createControllers(e.controllers,this.onForceUpdate);{const e=i.filter(e=>!r.any(s,t=>t.config.id===e.id)),t=s.filter(e=>!r.any(i,t=>t.id===e.config.id)),n=s.filter(e=>r.any(i,t=>t.id===e.config.id));return t.forEach(e=>e.dispose()),n.concat(a.LayoutElementFactory.createControllers(e,this.onForceUpdate))}}enhanceBlock(e){return 1===e.length&&(e[0].widthRatio=1),e}}}),define("renderables/text_editor_header",["require","exports","flux","classnames","react"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextEditorHeader=class extends i.BaseComponent{constructor(e){super(e)}render(){const{query:e}=this.props,t=e.execute();if(Object.keys(t.settings.layouts).length>1){const{settings:{header:{inlineLabel:e}}}=t,i=s({"form-group-label text-right":!0,"col-xs-1":e,"inline-label":!e}),r=s({"list-unstyled list-inline layouts-list":!0,smaller:e});return n.createElement(n.Fragment,null,this.renderLayoutSelection(i,t,r))}return n.createElement(n.Fragment,null,this.renderFieldDescription())}renderFieldDescription(){return n.createElement("div",{style:{paddingLeft:"101px",paddingTop:"20px",fontSize:"0.85em"},dangerouslySetInnerHTML:{__html:this.props.query.execute().description}})}renderLayoutSelection(e,t,i){return n.createElement("div",{className:"layout-selection"},n.createElement("label",{className:e},t.messages.layout),n.createElement("ul",{className:i},Object.keys(t.settings.layouts).map(e=>this.renderLayoutButton(t.settings.layouts[e],e,t.settings.header))))}renderLayoutButton({text:e,icons:t},i,{size:r,hideLabels:o}){const{selectLayoutCallback:a,selectedLayout:l}=this.props,c=s({"btn-name":!0,selected:i===l}),d=document.createElement("div");d.innerHTML=e;const h=d.innerText,u=s({"btn-icons":!0,[r]:!0,"label-primary":i===l}),p=h.toLowerCase().replace(/\s/g,"");return n.createElement("li",{key:i,onClick:()=>a(i),className:"clickable option"},n.createElement("div",{title:h,className:u,id:p},t.map(e=>n.createElement("i",{key:e,className:e}))),o?null:n.createElement("div",{className:c,dangerouslySetInnerHTML:{__html:e}}))}}}),define("renderables/text_editor_renderable",["require","exports","classnames","flux","react","underscore","widget_base","actions/text_editor_actions","renderables/text_editor_body","renderables/text_editor_header"],function(e,t,i,s,n,r,o,a,l,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TEXT_HEADLINE=0]="TEXT_HEADLINE",e[e.TEXT_PARAGRAPH=1]="TEXT_PARAGRAPH",e[e.TEXT_HEADLINE_PARAGRAPH=2]="TEXT_HEADLINE_PARAGRAPH",e[e.TEXT_TEXT_LEFT=3]="TEXT_TEXT_LEFT",e[e.TEXT_TEXT_RIGHT=4]="TEXT_TEXT_RIGHT",e[e.TEXT_TEXT_TOP=5]="TEXT_TEXT_TOP",e[e.TEXT_TEXT_BOTTOM=6]="TEXT_TEXT_BOTTOM",e[e.TEXT_IMAGE=7]="TEXT_IMAGE",e[e.TEXT_VIDEO=8]="TEXT_VIDEO",e[e.TEXT_VIDEO_TOP=9]="TEXT_VIDEO_TOP",e[e.TEXT_STYLE_TOOLBAR=10]="TEXT_STYLE_TOOLBAR"}(d=t.TextEditorLayouts||(t.TextEditorLayouts={})),t.layoutResizeSwapMap={[d[d.TEXT_TEXT_LEFT]]:d[d.TEXT_TEXT_BOTTOM],[d[d.TEXT_TEXT_RIGHT]]:d[d.TEXT_TEXT_TOP],[d[d.TEXT_TEXT_BOTTOM]]:d[d.TEXT_TEXT_LEFT],[d[d.TEXT_TEXT_TOP]]:d[d.TEXT_TEXT_RIGHT],[d[d.TEXT_VIDEO]]:d[d.TEXT_VIDEO_TOP],[d[d.TEXT_VIDEO_TOP]]:d[d.TEXT_VIDEO]};t.TextEditor=class extends s.BaseComponent{constructor(e){super(e),this.watcher=[],this.editorState={};const t=e.query.execute();this.state={selectedLayout:t.settings.initialLayout.toString(),previousInitialLayout:t.settings.initialLayout.toString(),drawSettings:this.props.drawSettings,editMode:!1}}componentWillReceiveProps(e){const t=e.query.execute().settings.initialLayout.toString();t!==this.state.previousInitialLayout&&(this.saveLayout(t),this.setState({selectedLayout:t,previousInitialLayout:t,editMode:this.state.editMode}))}saveLayout(e){this.dispatch(a.TextEditorActions.textEditor_onSaveLayout,{query:this.props.query,layout:e})}componentDidMount(){this.validate(),this.watch(),this.cancellationToken.subscribe(this.props.onEdit,e=>{this.setState({editMode:e})}),this.props.fragment.attach(this,this.props.rootElement)}componentWillUnmount(){this.unwatch()}componentDidUpdate(){this.validate(),this.watch()}componentWillUpdate(e,i){const s=this.props.query.execute();this.isSelectedLayoutAvailable(s)||this.selectLayout(t.layoutResizeSwapMap[i.selectedLayout])}render(){this.layoutElements=[];const e=this.props.query.execute(),{editMode:t}=this.state;return t?(r.values(e.content).forEach(e=>{this.editorState[e.save]=e.editModeData?e.editModeData:e.data}),this.renderEditMode(e)):(r.values(e.content).forEach(e=>this.editorState[e.save]=e.data),this.renderNormalMode(e))}renderEditMode(e){let{props:{query:s},state:{selectedLayout:r}}=this;if(this.isSelectedLayoutAvailable(e)||(r=t.layoutResizeSwapMap[r]),void 0===r)throw new Error("cannot render text Editor in edit mode without a selected Layout.");const o=i({"tw-text edit-mode unsortable":!0,"show-hover":this.canShowHoverStyle(e)});return n.createElement("div",{className:o},this.renderActionButtons(e),n.createElement(c.TextEditorHeader,{query:s,selectLayoutCallback:e=>this.selectLayout(e),selectedLayout:r}),this.renderEditorBody(e),n.createElement("div",{className:"buttons pull-right"},n.createElement("button",{type:"button",className:"btn btn-default",onClick:()=>this.cancel()},e.messages.cancel),n.createElement("button",{ref:"save",type:"button",className:"btn btn-primary",onClick:()=>this.save(this.state.selectedLayout)},e.messages.save)))}redrawWidget(e){return new Promise((t,i)=>{this.state.editMode?t():this.setState({drawSettings:e},()=>{t()})})}renderNormalMode(e){const{drawSettings:t}=this.state,s={},r=i({"tw-text":!0,"show-hover":this.canShowHoverStyle(e),"image-box":this.isImageBox(e),"font-size-medium":t.style.fontSize===o.FontSize.MEDIUM,"font-size-large":t.style.fontSize===o.FontSize.LARGE});return t.heightMode!==o.WidgetHeightMode.LEGACY&&(s.margin="0"),n.createElement("div",{className:r,style:s},e.settings.showActionButtons?this.renderActionButtons(e):null,this.renderEditorBody(e))}canShowHoverStyle(e){for(const t in e.content)if("toolbar"!==t){const i=e.content[t].data,s=void 0!==i&&("string"!=typeof i||"string"==typeof i&&i.trim().length>0);if(s)return!s}return!0}isImageBox(e){const{image:t={data:void 0}}=e.content;return void 0!==t.data}selectLayout(e){e!==this.state.selectedLayout&&this.setState({selectedLayout:e})}save(e,t=!1){const{props:{query:i},editorState:s}=this;this.dispatch(a.TextEditorActions.textEditor_onSave,{query:i,changes:s,layout:e}),t||this.setState({editMode:!1,previousInitialLayout:e})}cancel(){void 0!==this.cancelState&&(this.editorState=this.cancelState),this.setState({editMode:!1,selectedLayout:this.state.previousInitialLayout})}deleteTextEditor(){this.dispatch(a.TextEditorActions.textEditor_onDelete,{query:this.props.query})}renderActionButtons(e){return n.createElement("div",{className:"edit-buttons h-btn-list"},n.createElement("div",{onClick:()=>this.toggleEditMode(e)},n.createElement("i",{className:"fa fa-pencil"})),e.settings.canDelete?n.createElement("div",{onClick:()=>this.deleteTextEditor()},n.createElement("i",{className:"icon-tw-trash-bin"})):null)}toggleEditMode(e){this.state.editMode?this.cancel():(this.cancelState={},r.values(e.content).forEach(e=>{this.editorState[e.save]=e.editModeData?e.editModeData:e.data}),this.setState({editMode:!0}))}renderEditorBody(e){let{props:{query:i,forceRender:s},state:{selectedLayout:r,editMode:o,drawSettings:a}}=this;if(this.isSelectedLayoutAvailable(e)||(r=t.layoutResizeSwapMap[r]),void 0===r)throw new Error("cannot render text Editor body without a selected Layout.");const c=i.createSubQuery({layout:["settings","layouts",r,"blocks"],controllers:["settings","layouts",r,"controllers"],content:"content",messages:"messages"});return n.createElement(l.TextEditorBody,{query:c,validate:this.validate.bind(this),editMode:o,useImageBackground:e.settings.useImageBackground,layoutElements:this.layoutElements,forceRender:s,fragmentDrawSettings:a,editorState:this.editorState})}canSave(){return r.all(this.layoutElements,e=>e.isValid())}validate(){this.refs.save&&(this.refs.save.disabled=!this.canSave())}watch(){this.unwatch(),this.layoutElements.forEach(e=>this.watcher.push(e.onDataChange.subscribe(()=>this.validate()).cancel))}unwatch(){this.watcher.forEach(e=>e()),this.watcher.length=0}isSelectedLayoutAvailable(e){const{selectedLayout:t}=this.state;return void 0!==e.settings.layouts[t]}}}),define("renderables/controllers/base_text_editor_controller",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseTextEditorController=class{constructor(e,t){this.config=e,this.ownerForceUpdateEvent=t}canAddComponent(e,t,i){return!0}addComponent(e){this.config[e.props.id]&&(this[this.config[e.props.id]]=e)}removeComponent(e){this.addComponent(e)}update(){}enhanceLayout(e,t,i){return e}}}),define("renderables/layout/image_upload",["require","exports","react","renderables/layout/base_layout_element","file_upload","event","classnames","reusable_components"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageUpload=class extends s.BaseLayoutElement{constructor(e){super(e),this.state=this.calculateState(this.props),this.onDataChange=new r.Event}componentWillReceiveProps(e){e.model.data!==this.props.model.data&&this.setState(this.calculateState(this.props))}componentWillUnmount(){this.onDataChange.cancelAll()}render(){const{editMode:e}=this.props;return e?this.state.imageUrl?this.renderImage():this.renderUploader():this.state.imageUrl?this.renderImage():null}handleImageLoaded(e){this.save(e.dataUrl),this.onDataChange.fire(e),this.setState({imageUrl:e.dataUrl})}deleteImage(e){this.save(void 0),this.onDataChange.fire(void 0),this.setState({imageUrl:void 0})}renderImage(){const{state:{imageUrl:e},props:{model:{brokenImageUrl:t},editMode:s}}=this,n=o({"form-control":s});return i.createElement("div",{className:"default-width image-upload"},i.createElement("div",{className:n},i.createElement(a.Image,{className:"image",src:e,errorSrc:t}),this.renderDeleteImageButton()))}renderUploader(){const{model:{label:e},id:t}=this.props;return i.createElement("div",{id:t,className:"default-width file-upload"},i.createElement(n.FileUpload,{label:e,mimeFilter:"image/*",blockSvg:!0,onLoad:e=>this.handleImageLoaded(e)}))}renderDeleteImageButton(){return this.props.editMode?i.createElement("i",{onClick:this.deleteImage.bind(this),className:"icon-tw-cross delete-icon"}):null}calculateState(e){return{imageUrl:e.model.data}}}}),define("renderables/enhancers/text_enhancer",["require","exports","underscore"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=/\{(.+?)\}/g;t.textEnhancer=function(e="",t){return e.replace(s,(e,i)=>r(i=i.toLowerCase())?function(e,t){return n[e](t)}(i,t):e)},t.hasTimeCommands=i.memoize(function(e){const t=e.match(s);if(t)for(let e=0;e<t.length;e++){const i=t[e].replace(/{|}/g,"");if(r(i)&&"project"!==i)return!0}return!1});const n={time:function(e){return moment().format(e.formatting.timeFormat)},date:function(e){return moment().format(e.formatting.dateFormat)},"date time":function(e){return moment().format(e.formatting.dateTimeFormat)},project:function(e){return window.tw.pageState.getProject().getName()}};function r(e){return i.contains(Object.keys(n),e)}}),define("renderables/layout/single_line_input",["require","exports","classnames","react","renderables/layout/base_layout_element","renderables/enhancers/text_enhancer"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SingleLineInput=class extends n.BaseLayoutElement{constructor(e){super(e)}componentWillReceiveProps(){this.onDataChange.cancelAll()}componentWillUnmount(){this.onDataChange.cancelAll()}render(){const{editMode:e}=this.props;return e?this.renderEditMode():this.renderNormalMode()}renderEditMode(){const{id:e,model:t,model:{label:i},editorState:n}=this.props,r=n[t.save];return s.createElement("span",{id:e,className:"form-group no-hover no-borders"},s.createElement("label",{key:"0",className:"form-group-label text-right"},i),s.createElement("div",{key:"1",className:"form-group-content"},s.createElement("input",{defaultValue:(r||"").substring(0,1024),onChange:e=>this.handleDataChange(e),className:"form-control"})))}renderNormalMode(){const{model:{data:e,placeHolder:t},editorState:{text_style:n},id:o,fragmentDrawSettings:{style:a}}=this.props,l=i({"text-placeholder":!e,"text-align__left":!0,"text-editor-title":!!e}),c=i({"center-aligned":!!n&&"center"===n.text_alignment,"right-aligned":!!n&&"right"===n.text_alignment,"vertical-text":!!n&&"vertical"===n.text_orientation});return s.createElement("span",{id:o,className:c},s.createElement("div",{className:l,dangerouslySetInnerHTML:{__html:r.textEnhancer(e,a)||t}}))}isValid(){return(this.props.editorState[this.props.model.save]||"").length>0||this.props.optional}handleDataChange(e){const t=e.target.value;this.save(t),this.onDataChange.fire(t)}}}),define("renderables/controllers/image_upload_controller",["require","exports","reusable_utilities","renderables/controllers/base_text_editor_controller","renderables/controllers/controllers"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ImageUploadController=class extends s.BaseTextEditorController{getType(){return n.TextEditorControllers.ImageUploadController}isDataURL(e){return new i.Url(e).isDataURL()}dispose(){void 0!==this.imageUrl&&this.imageUrl.onDataChange.cancelAll(),this.image.onDataChange.cancelAll()}canAddComponent(e,t,i){if("imageUrl"===i.id||"imageSeparator"===i.id){const s=e[t.image.save];return"imageUrl"===i.id?!s||!this.isDataURL(s):!s}return!0}initialize(){this.listen()}update(){this.listen()}listen(){void 0!==this.imageUrl&&(this.imageUrl.onDataChange.cancelAll(),this.imageUrl.onDataChange.subscribe(e=>{this.image.setState({imageUrl:e}),this.ownerForceUpdateEvent.fire()})),void 0!==this.image&&(this.image.onDataChange.cancelAll(),this.image.onDataChange.subscribe(e=>{this.ownerForceUpdateEvent.fire()}))}}}),define("renderables/layout/video_preview",["require","exports","classnames","react","reusable_components","reusable_utilities","renderables/layout/base_layout_element"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoPreview=class extends o.BaseLayoutElement{constructor(e){super(e),this.state={mediaUrl:e.model.data}}render(){let{props:{editMode:e},state:{mediaUrl:t}}=this;return t=(t||"").trim(),e?this.isValidUrl(t)?this.renderVideo(t):this.renderVideoPlaceholder():this.isValidUrl(t)?this.renderVideo(t):null}renderVideo(e){const{id:t}=this.props,r=this.getHost(e),o=i({"video-wrapper":!0,[r.className]:!0});if(r.html5video){const i=this.getUrlPattern(e).exec(e)[1];return s.createElement(n.Html5Video,{fileName:i,spanClass:o,id:t,mediaUrl:e})}return s.createElement("div",{id:t},s.createElement("span",{className:o},s.createElement("iframe",Object.assign({},{allow:"autoplay; fullscreen"},{src:this.transformUrl(e),"frame-border":"0","allow-full-screen":"true"}))))}renderVideoPlaceholder(){const{model:{label:e},id:t}=this.props;return s.createElement("div",{id:t,className:"default-width file-upload"},s.createElement("div",{className:"form-control"},s.createElement("span",{className:"centered-absolute"},e)))}getHost(e){return r.StringUtils.getVideoHost(e,this.props.model.hosts)}isValidUrl(e){return r.StringUtils.isValidVideoUrl(e,this.props.model.hosts)}transformUrl(e){return this.getHost(e).transformUrl?r.StringUtils.transformVideoUrl(e,this.props.model.hosts,this.getTemplate(e)):e}getUrlPattern(e){return r.StringUtils.getVideoUrlPattern(e,this.props.model.hosts)}getTemplate(e){return this.getHost(e).template}}}),define("renderables/controllers/video_controller",["require","exports","renderables/controllers/base_text_editor_controller","renderables/controllers/controllers"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoController=class extends i.BaseTextEditorController{dispose(){this.mediaUrl&&this.mediaUrl.onDataChange&&this.mediaUrl.onDataChange.cancelAll()}getType(){return s.TextEditorControllers.VideoController}enhanceLayout(e,t,i){const s=t.headline,n=t.text;return!1!==i||s||n||(e[0][0].widthRatio=1,e[0][1]?e[0][1].widthRatio=0:e[1][0].widthRatio=0),e}initialize(){this.mediaUrl&&this.mediaUrl.onDataChange&&(this.mediaUrl.onDataChange.cancelAll(),this.mediaUrl.onDataChange.subscribe(e=>{this.video.setState({mediaUrl:e})}))}}}),define("renderables/layout/horizontal_rule",["require","exports","react","renderables/layout/base_layout_element"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HorizontalRule=class extends s.BaseLayoutElement{render(){const{model:{label:e},id:t}=this.props;return i.createElement("span",{id:t,className:"separator-text"}," ",i.createElement("span",null,e)," ")}}}),define("renderables/layout/multi_line_input",["require","exports","react","classnames","renderables/layout/base_layout_element","renderables/enhancers/text_enhancer"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultiLineInput=class extends n.BaseLayoutElement{render(){const{editMode:e}=this.props;return e?this.renderEditMode():this.renderNormalMode()}renderEditMode(){const{id:e,model:{editModeData:t,label:s}}=this.props;return i.createElement("span",{id:e,className:"form-group no-hover no-borders"},i.createElement("label",{key:"0",className:"form-group-label text-right"},s),i.createElement("div",{key:"1",className:"form-group-content"},i.createElement("textarea",{defaultValue:t,onChange:e=>this.handleDataChange(e),className:"form-control"})))}isValid(){return(this.props.editorState[this.props.model.save]||"").length>0||this.props.optional}renderNormalMode(){const{model:{data:e},id:t,fragmentDrawSettings:{style:n},editorState:{text_style:o}}=this.props,a=s({"center-aligned":!!o&&"center"===o.text_alignment,"right-aligned":!!o&&"right"===o.text_alignment,"vertical-text":!!o&&"vertical"===o.text_orientation});return i.createElement("span",{id:t,className:a},i.createElement("div",{className:"text-display text-align__left",dangerouslySetInnerHTML:{__html:r.textEnhancer(e,n)}}))}handleDataChange(e){const t=e.target.value;this.save(t),this.onDataChange.fire(t)}}}),define("renderables/layout/layout_element_factory",["require","exports","react","underscore","renderables/controllers/controllers","renderables/controllers/image_upload_controller","renderables/controllers/video_controller","renderables/layout/horizontal_rule","renderables/layout/image_upload","renderables/layout/multi_line_input","renderables/layout/single_line_input","renderables/layout/text_style_toolbar","renderables/layout/video_preview"],function(e,t,i,s,n,r,o,a,l,c,d,h,u){"use strict";var p;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SingleLineInput=0]="SingleLineInput",e[e.MultiLineInput=1]="MultiLineInput",e[e.HorizontalRule=2]="HorizontalRule",e[e.ImageUpload=3]="ImageUpload",e[e.VideoPreview=4]="VideoPreview",e[e.TextStyleToolbar=5]="TextStyleToolbar"}(p=t.LayoutElementTypes||(t.LayoutElementTypes={}));const g={[p.SingleLineInput]:d.SingleLineInput,[p.MultiLineInput]:c.MultiLineInput,[p.HorizontalRule]:a.HorizontalRule,[p.ImageUpload]:l.ImageUpload,[p.VideoPreview]:u.VideoPreview,[p.TextStyleToolbar]:h.TextStyleToolbar},m={[n.TextEditorControllers.ImageUploadController]:r.ImageUploadController,[n.TextEditorControllers.VideoController]:o.VideoController};class _{static createSection(e,t,i,s,n,r,o){return e.items.filter(e=>_.isItemAllowed(e,s,t[e.id],i,n,t)).map(e=>_.createElement(e,t[e.id],i,s,n,r,o))}static isItemAllowed(e,t,i,n,r,o){return!i.hidden&&s.all(n,t=>t.canAddComponent(r,o,e))&&(e.editOnly&&t||e.normalOnly&&!t||!e.editOnly&&!e.normalOnly)}static createElement(e,t,n,r,o,a,l){return i.createElement(g[e.type],{ref:t=>null!==t?_.onCreate(n,t,e,l):s.noop(),editorState:o,optional:!!e.optional,editMode:r,id:e.id,model:t,fragmentDrawSettings:a,key:e.id})}static onCreate(e,t,i,s){s.push(t),_.controllerBind(e,t,i)}static createControllers(e,t){return e.map(e=>new m[e.type](e,t))}static controllerBind(e,t,i){e.forEach(e=>{const n=s.find(s.keys(e.config.bindings),t=>e.config.bindings[t]===i.id);n&&(e[n]=t)})}}t.LayoutElementFactory=_}),define("models/text_editor_layout_models",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("text_editor",["require","exports","actions/text_editor_actions","renderables/controllers/controllers","renderables/enhancers/text_enhancer","renderables/layout/layout_element_factory","renderables/text_editor_renderable"],function(e,t,i,s,n,r,o){"use strict";function a(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),a(i),a(s),a(n),a(r),a(o)}),define("actions/treemap_actions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreemapActions={treemap_onClick:"treemap_onClick",treemap_onMouseEnter:"treemap_onMouseEnter",treemap_onMouseLeave:"treemap_onMouseLeave"}}),define("classes/treemap_query_result",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("classes/treemap_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/node_model_click_action_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("models/node_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/components/base_node_renderable",["require","exports","flux"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BaseNodeRenderable=class extends i.BaseComponent{constructor(e){super(e)}}}),define("stores/treemap_store",["require","exports","flux","actions/treemap_actions"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends i.BaseStore{constructor(e){super([s.TreemapActions]),this.storeObject=e,n.store=this}static getInstance(){return n.store}destroyBubbles(){this.storeObject.destroyBubbles()}onClick(e){this.storeObject.toggleMouseClickAction(e)}onMouseEnter(e){this.storeObject.toggleMouseEnterAction(e)}onMouseLeave(e){this.storeObject.toggleMouseLeaveAction(e)}}t.TreemapStore=n}),define("renderables/components/fallback_image_renderable",["require","exports","flux","react","underscore"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FallbackImageRenderable=class extends i.BaseComponent{render(){let e=void 0!==this.props.style?this.props.style:{clear:"both",marginRight:0};const t=this.buildIconStyles(e);return(e=n.omit(e,["transitionDelay","WebkitTransitionDelay","MozTransitionDelay","OTransitionDelay"])).borderRadius="4px",s.createElement("div",{className:"img-error-style",style:e},s.createElement("i",{className:this.props.className,style:t}))}buildIconStyles(e){const t={fontSize:.75*Math.min(parseFloat(this.props.style.width.toString()),parseFloat(this.props.style.height.toString()))};return e.transitionDelay&&(t.animationDelay=e.transitionDelay,t.WebkitAnimationDelay=e.WebkitTransitionDelay,t.MozAnimationDelay=e.MozTransitionDelay,t.OAnimationDelay=e.OTransitionDelay),t}}}),define("renderables/components/image_node_renderable",["require","exports","renderables/components/base_node_renderable","reusable_components","react","reusable_services","flux","actions/treemap_actions","classnames","renderables/components/fallback_image_renderable"],function(e,t,i,s,n,r,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d extends i.BaseNodeRenderable{constructor(e){super(e),this.MAX_METRIC_WIDTH=100}render(){const{model:e}=this.props;if(d.browserDetection.isIEorEdge()){const t=this.buildStylesForIEorEdge(e);return this.renderNode(e,{back:t,image:{display:"none"},error:t,front:this.buildStyles(e),metricBar:this.buildMetricStylesForIEorEdge(e)},"ie-edge")}{const t=this.buildStyles(this.props.model);return this.renderNode(this.props.model,{image:t,error:t,front:t,metricBar:this.buildMetricStyles(e)})}}renderNode(e,t,i){const r=this.handleMouseEnter.bind(this),o=this.handleMouseLeave.bind(this),a=this.buildClickHandler(),l=this.buildCssClasses(i),d=n.createFactory.bind(n,c.FallbackImageRenderable),h=this.buildBoundingBoxStylesForIEorEdge(t);return n.createElement("span",{className:"flip-container"},n.createElement("span",{className:l,onClick:void 0!==a?a:_.noop},n.createElement("span",{className:"front",style:t.front}),n.createElement("span",{className:"back"},n.createElement("span",{onMouseEnter:r,onMouseLeave:o,style:t.back},n.createElement(s.ImageBlockRenderable,{url:e.label,bounding_boxes:e.bounding_boxes,boundingBoxIEorEdgeStyles:h,allowObjectPositioning:!0,allowEmptyPlaceholder:!0,errorTag:d(),errorClass:"icon2-tw-no-img1 img-error-font img-error-font-colors",errorStyle:t.error,className:"thumbnail",style:t.image}),e.dx>=this.MAX_METRIC_WIDTH?n.createElement(s.MetricBarRenderable,{metrics:[e.metric],widgetId:this.props.queryResult.widget.widget_id,style:t.metricBar}):null))))}buildStyles(e){const t={width:e.dx+"px",height:e.dy+"px",top:e.y,left:e.x,position:"absolute",display:"inline-block"};return this.props.queryResult.actionsEnabled&&this.props.queryResult.widgetClickable&&(t.cursor="pointer"),void 0!==this.props.additionalStyles&&_.extendOwn(t,this.props.additionalStyles),t}buildMetricStyles(e){const t=this.buildStyles(e);return t.fontSize=Math.max(14,.05*e.dy)+"px",t}buildStylesForIEorEdge(e){const t=this.buildStyles(e);return t.backgroundImage=`url('${e.label}')`,t.backgroundSize="cover",this.isBoundingBoxAvailable(e)?t.backgroundPosition=this.composeBackgroundPosition(e):t.backgroundPosition="center center",t}buildMetricStylesForIEorEdge(e){const t=this.buildMetricStyles(e);return t.top=0,t.left=0,t}buildBoundingBoxStylesForIEorEdge(e){let t;return void 0!==e.back&&(delete(t=JSON.parse(JSON.stringify(e.back))).backgroundImage,t.left=0,t.top=0),t}buildCssClasses(e){const{bounding_boxes:t}=this.props.model;return l({"img-flipper":!0,"has-bb":void 0!==t&&t.length>0,[e]:void 0!==e})}handleMouseEnter(e){if(this.props.model.dx<this.MAX_METRIC_WIDTH){const t=this.buildChangePayload(e);o.dispatcher.dispatch(a.TreemapActions.treemap_onMouseEnter,t)}}handleMouseLeave(e){if(this.props.model.dx<this.MAX_METRIC_WIDTH){const t=this.buildChangePayload(e);o.dispatcher.dispatch(a.TreemapActions.treemap_onMouseLeave,t)}}buildChangePayload(e){return{node:this.props.model,queryResult:this.props.queryResult,event:e}}buildClickHandler(){const{model:e,queryResult:t}=this.props;return e.clickAction?(e.clickAction.widget_id=t.widget.widget_id,s.ClickActionFactory.create(e.clickAction)):void 0}isBoundingBoxAvailable(e){return void 0!==e.bounding_boxes&&e.bounding_boxes.length>0}composeBackgroundPosition(e){return`${100*e.bounding_boxes[0].top_left.x}% ${100*e.bounding_boxes[0].top_left.y}%`}}d.browserDetection=new r.BrowserDetection,t.ImageNodeRenderable=d}),define("classes/treemap_struct",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TreemapStruct=class{constructor(e,t){this.rootNode=e,this.settings=t,this.treemap=d3.layout.treemap()}process(){this.treemap.mode(this.settings.mode).size([this.settings.width,this.settings.height]).sort((e,t)=>e.value-t.value).nodes(this.rootNode)}getRootNode(){return this.rootNode}}}),define("renderables/treemap_renderable",["require","exports","flux","react","renderables/components/image_node_renderable","classes/treemap_struct","log","react-transition-group"],function(e,t,i,s,n,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.treeMapLogFeature={name:"TREEMAP",style:"color:orange; font-weight:bold"};t.TreemapRenderable=class extends i.BaseComponent{constructor(e){super(e),this.state={rootModel:void 0,fullyLoaded:!1,canDraw:!1},this.props.mediator.listen("TREEMAP.EVENTS.DRAW",e=>{this.setState({canDraw:e})})}componentWillMount(){this.buildTreemap(this.props)}componentDidUpdate(){setTimeout(()=>{const e=$(this.refs.root).find(".back .thumbnail").parent(":not(.image-component)");let t;e.length>0&&(t=e.find(".thumbnail")),this.checkIfImagesAreLoaded($(this.refs.root).find(".image-component .bounding-box-img"),t)},this.props.drawSettings.animationDuration)}checkIfImagesAreLoaded(e,i){const{mediator:s}=this.props,n=void 0!==i?i.length:0,r=e.length+n;let a=0;function l(e){e.each((e,t)=>{t.complete?c():(t.onload=(()=>{c()}),t.onerror=(()=>{c(!0)}))})}function c(e){a++,e?o.logService.verbose("Oh no, image errored",t.treeMapLogFeature):o.logService.verbose("Image loaded",t.treeMapLogFeature),a===r?(o.logService.verbose("All images done!",t.treeMapLogFeature),s.dispatch("TREEMAP.EVENTS.LOADED",!0)):o.logService.verbose(`${r-a} images remain`,t.treeMapLogFeature)}l(e),n>0&&l(i)}componentWillReceiveProps(e){e.rootNode!==this.props.rootNode&&this.buildTreemap(e)}shouldComponentUpdate(e,t){const{drawSettings:{dimensions:{width:i,height:s}}}=e,{drawSettings:{dimensions:{width:n,height:r}}}=this.props;return t.canDraw!==this.state.canDraw||t.rootModel!==this.state.rootModel||i!==n||s!==r}buildTreemap(e){let{drawSettings:{dimensions:{width:t,height:i}}}=e;if(0===i&&(i=.7*t),void 0!==e.rootNode){const s=JSON.parse(JSON.stringify(e.rootNode)),n={width:t,height:i,mode:"squarify"},o=new r.TreemapStruct(s,n);o.process(),this.setState({rootModel:o.getRootNode()})}}render(){let{drawSettings:{dimensions:{width:e,height:t}}}=this.props;if(0===t&&(t=.7*e),void 0!==this.state.rootModel){const i=this.state.rootModel.children.map((e,t,i)=>this.renderNode(e,t,i)),n={width:e,height:t};return this.state.canDraw?s.createElement("div",{ref:"root",style:n},s.createElement(a.TransitionGroup,{className:"root-children"},i)):null}return null}renderNode(e,t,i){let r=this.props.drawSettings.animationDuration;const o=(i.length-1-t)*(r/i.length*.1),l={WebkitTransition:"all "+(r-=o)+"ms linear "+o+"ms",MozTransition:"all "+r+"ms linear "+o+"ms",OTransition:"all "+r+"ms linear "+o+"ms",transition:"all "+r+"ms linear "+o+"ms"};return s.createElement(a.CSSTransition,{key:e.id,classNames:"init-anim",appear:!0,timeout:{enter:r,exit:r}},s.createElement(n.ImageNodeRenderable,{key:e.id,model:e,queryResult:this.props.queryResult,additionalStyles:l}))}}}),define("treemap",["require","exports","actions/treemap_actions","renderables/treemap_renderable","stores/treemap_store"],function(e,t,i,s,n){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i),r(s),r(n)}),define("classes/point",["require","exports","log"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}setX(e){this.x=e}getY(){return this.y}setY(e){this.y=e}distanceTo(e){i.logService.warn("distanceTo point not implemented")}clone(){return new s(this.x,this.y)}}t.Point=s}),define("renderables/components/text_node_renderable",["require","exports","renderables/components/base_node_renderable","react"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextNodeRenderable=class extends i.BaseNodeRenderable{constructor(e){super(e)}render(){return this.renderNode(this.props.model)}renderNode(e){const t={backgroundColor:e.color,color:"white",width:e.dx+"px",height:e.dy+"px",top:e.y,left:e.x,position:"absolute",display:"inline-block",border:"1px solid red"};return s.createElement("span",{style:t},e.label," ",void 0!==e.children?e.children.map(e=>this.renderNode(e)):null)}}}),define("models/trends_configurable_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("trends_configurable_fragment_build_configuration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("renderables/trends_configurable",["require","exports","flux","react","reusable_components","reusable_utilities","talkwalker_constants","widget_base","reusable_components"],function(e,t,i,s,n,r,o,a,l){"use strict";var c,d;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TWITTER="source_twitter",e.GOOGLE="source_google"}(c=t.TrendsConfigurableSource||(t.TrendsConfigurableSource={})),function(e){e.TABLE="layout_table",e.WORD_CLOUD="layout_word_cloud"}(d=t.TrendsConfigurableLayout||(t.TrendsConfigurableLayout={}));t.TrendsConfigurable=class extends i.BaseComponent{constructor(e){super(e);const{fragmentModel:{widget:t}}=this.props;let i;switch(t.getConfigurationRendering().uuid_configuration){case o.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_CLOUD:i=d.WORD_CLOUD;break;case o.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_LIST:default:i=d.TABLE}this.state={selectedLayout:i,selectedSource:c.TWITTER,drawSettings:this.props.drawSettings,editMode:!1,isLoading:!1,title:t.getDic().title||""}}componentDidMount(){this.drawSubFragment().then()}componentDidUpdate(e,t){t.editMode&&!this.state.editMode&&setTimeout(()=>{this.drawSubFragment().then()})}async drawSubFragment(){this.setState({isLoading:!0}),this.trendFragmentUpdateToken&&this.trendFragmentUpdateToken.cancel(),this.trendFragmentUpdateToken=new r.CancellationToken,this.cancellationToken.chain(this.trendFragmentUpdateToken),this.trendFragmentCancellationToken&&(this.trendFragment.dispose(),this.trendFragmentCancellationToken.cancel());const e=this.state.selectedLayout===d.TABLE?"table":"themeCloud",{mediator:t,drawSettings:{dimensions:i},fragmentModel:{subFragments:s}}=this.props,n=new r.CancellationToken;if(this.trendFragmentUpdateToken.isCanceled())return void n.cancel();this.cancellationToken.chain(n),this.trendFragmentCancellationToken=n;const{fragment:o,model:l,drawSettings:c}=await s[e].deploy({mediator:t,dimensions:i,animationDuration:0,animationStrategy:0,payload:this.props.fragmentModel.widget,rootNode:this.graphContainer,cleanUp:this.trendFragmentCancellationToken});this.trendFragmentUpdateToken.isCanceled()?this.trendFragmentCancellationToken.cancel():(this.trendFragment=o,await o.update(l,a.DataAction.NEW_DATA),await o.draw(c),this.trendFragmentUpdateToken.isCanceled()?this.trendFragmentCancellationToken.cancel():this.setState({isLoading:!1}))}render(){return s.createElement("div",{className:"tw-trends-configurable"},this.props.fragmentModel.buildConfiguration.displayEditButtons?this.renderEditButtons():null,this.state.editMode?this.renderConfiguration():this.renderGraph())}renderEditButtons(){return s.createElement("div",{className:"edit-buttons h-btn-list"},s.createElement("div",{onClick:()=>this.setState({editMode:!this.state.editMode})},s.createElement("i",{className:"fa fa-pencil"})))}handleTitleChange(e){this.setState({title:e.target.value})}renderConfiguration(){const{fragmentModel:{widget:e,buildConfiguration:{messages:t}}}=this.props,i=e.getExtendedConfiguration().getTrendCountriesMenu().toProto(),r=e.getExtendedConfiguration().getTrendTimerangeMenu().toProto(),a=e.getExtendedConfiguration().getNumResultsMenu().toProto();return s.createElement("div",{key:"configuration"},s.createElement("div",{className:"form-row"},s.createElement("label",{className:"form-label"},t.labels.layout),s.createElement("div",{className:"form-element"},s.createElement(n.ButtonSelection,{items:this.getLayoutButtonSelectionItems(),multiSelection:!1,onChange:e=>this.onLayoutChange(e)}))),s.createElement("div",{className:"form-row"},s.createElement("label",{className:"form-label"},t.labels.title),s.createElement("div",{className:"form-element"},s.createElement("input",{value:this.state.title,onChange:e=>this.handleTitleChange(e)}))),s.createElement("div",{className:"form-row"},s.createElement("label",{className:"form-label"},t.labels.country),s.createElement("div",{className:"form-element"},s.createElement(n.SingleSelectComponent,{model:i,style:{width:150}})),s.createElement("label",{className:"form-label"},t.labels.timeframe),s.createElement("div",{className:"form-element"},s.createElement(n.SingleSelectComponent,{model:r,style:{width:150}})),s.createElement("label",{className:"form-label"},t.labels.display),s.createElement("div",{className:"form-element"},s.createElement(n.SingleSelectComponent,{model:a,style:{width:80,float:"left",marginRight:5}}),s.createElement("div",null,t.labels.topTrends))),s.createElement("div",{className:"buttons pull-right"},s.createElement("button",{type:"button",className:"btn btn-default",onClick:()=>this.setState({editMode:!1})},t.labels.cancel),s.createElement(l.ProgressButton,{icon:"fa fa-refresh",spinIconWhileLoading:!0,onClick:async()=>{e.setTitle(this.state.title),e.getConfigurationRendering().uuid_configuration=this.state.selectedLayout===d.TABLE?o.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_LIST:o.ConfigurationDefaultsEnum.UUID_CONFIG_EXTERNAL_TRENDS_CLOUD,await this.props.fragmentModel.buildConfiguration.saveWidget(e),this.setState({editMode:!1})},className:"button refresh-button btn btn-primary",loadingClass:"working",text:t.labels.save,errorClass:"failed"})))}renderGraph(){return s.createElement("div",{key:"graph",ref:e=>{this.graphContainer=e}})}getLayoutButtonSelectionItems(){const{fragmentModel:{buildConfiguration:{messages:e}}}=this.props;return[this.getButtonSelectionItem(d.TABLE,e.labels.table,"icon-tw-icons-table",this.state.selectedLayout===d.TABLE),this.getButtonSelectionItem(d.WORD_CLOUD,e.labels.wordCloud,"icon2-tw-themecloud",this.state.selectedLayout===d.WORD_CLOUD)]}getButtonSelectionItem(e,t,i,n){return{id:e,caption:t,label:s.createElement("i",{className:i}),selected:n}}onLayoutChange(e){this.setState({selectedLayout:e.clickedItem.id})}}}),define("trends_configurable_fragment",["require","exports","widget_base","react-dom","react","renderables/trends_configurable"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TrendsConfigurableFragment=class extends i.AbstractReactFragment{renderIntoContainer(e,t,i,o){s.render(n.createElement(r.TrendsConfigurable,{drawSettings:i,mediator:o,fragmentModel:this.fragmentModel}),this.chartContainer)}}}),define("trends_configurable",["require","exports","renderables/trends_configurable","trends_configurable_fragment"],function(e,t,i,s){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i),n(s)}),define("css/trends_configurable.css",["require","exports","css_modules"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trendsConfigurableStyleModel={buttonSelection:{width:"50%",display:"inline-block"}},t.trendsConfigurableStyle=i.createCssModule(()=>t.trendsConfigurableStyleModel).compute({}).attach().getModule()}),define("regex_utils",["require","exports"],function(e,t){"use strict";function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}Object.defineProperty(t,"__esModule",{value:!0}),t.getAllMatches=function(e,t){let i,s=[];for(;i=e.exec(t);)s.push(i);return s},t.escapeRegExp=i,t.escapeSource=function(e){return i(e).replace(/\/+/g,"/+")}}),define("rules",["require","exports"],function(e,t){"use strict";function i({regex:e,validate:t,convert:i}){return{regex:e||"([^/?#]+)",validate:t||(()=>!0),convert:i||(e=>e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.string=function({maxLength:e,minLength:t,length:s}={}){return i({validate:i=>!(e&&i.length>e||t&&i.length<t||s&&i.length!==s)})},t.greedySplat=function(){return i({regex:"([\\s\\S]*)"})},t.splat=function(){return i({regex:"([\\s\\S]*?)"})},t.any=function(...e){return i({validate:t=>-1!==e.indexOf(t)})},t.int=function({max:e,min:t,fixedLength:s}={}){return i({regex:"(\\d+)",validate:function(i){const n=Number(i);return!(s&&s!==i.length||e&&n>e||t&&n<t)},convert:function(e){return Number(e)}})},t.uuid=function(){return i({regex:"([A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12})"})},t.createRule=i}),define("matcher",["require","exports","regex_utils","rules"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n={};function r(e){return e=function(e){return"string"==typeof e&&(e={pattern:e,rules:{}}),e.rules=e.rules||{},e}(e),n[e.pattern]||(n[e.pattern]=function({pattern:e,rules:t}){const n=[],r=[];let o="";"/"!==e.charAt(0)&&(e=`/${e}`);const a=i.getAllMatches(/:([a-zA-Z_$][a-zA-Z0-9_$]*)|\*\*|\*|\(|\)|[^:*()]+/g,e);for(let[e,l]of a){let a;l?a=t[l]||s.string():"**"===e?(a=s.greedySplat(),l="splat"):"*"===e?(a=s.splat(),l="splat"):o+="("===e?"(?:":")"===e?")?":i.escapeSource(e),l&&(o+=a.regex,r.push({paramName:l,rule:a})),n.push(e)}const l="*"!==n[n.length-1];return{tokens:n,regexpSource:new RegExp(`^${o}/*${l?"":"$"}`,"i"),params:r,paramNames:r.map(e=>e.paramName)}}(e)),n[e.pattern]}function o(e,t,i=!1){"/"!==t.charAt(0)&&(t=`/${t}`);const{regexpSource:s,params:n,paramNames:o}=r(e),a=t.match(s);if(null==a)return;const l=t.slice(a[0].length);if("/"===l[0]||a[0][a[0].length]||i&&l.length>0)return;let c=a.slice(1).map(e=>null!=e?decodeURIComponent(e):e);return function(e,t){return e.every((e,i)=>t[i].rule.validate(e))}(c,n)?{remainingPathname:l,paramValues:c=c.map((e,t)=>n[t].rule.convert(e)),paramNames:o}:void 0}t._clearCache=function(){n={}},t.getRoute=r,t.matchPattern=o,t.formatPattern=function(e,t){t=t||{};const{tokens:i}=r(e);let s,n,o,a="",l=0;for(let e=0,r=i.length;e<r;++e)"*"===(s=i[e])||"**"===s?null!=(o=Array.isArray(t.splat)?t.splat[l++]:t.splat)&&(a+=encodeURI(o)):"("===s||")"===s||(":"===s.charAt(0)?null!=(o=t[n=s.substring(1)])&&(a+=encodeURIComponent(o)):a+=s);return a.replace(/\/+/g,"/")},t.getParams=function(e,t){const{paramNames:i=[],paramValues:s=[]}=o(e,t)||{},n={};for(let e=0;e<i.length;e++)n[i[e]]=s[e];return n}}),define("url_matcher",["require","exports","matcher"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("interfaces/bounding_box",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/bounding_box_indication",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/time_point",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("interfaces/video_annotations",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("components/video_player_component",["require","exports","flux","react","moment","event_bus"],function(e,t,i,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=4e3;t.VideoPlayerComponent=class extends i.BaseComponent{constructor(e){super(e),this.confidence=0,this.state={playing:!1,progress:0,duration:0,handlePosition:0,handleDraggingOn:!1,fullscreen:!1,volumeControlOpen:!1,volumeHandlePosition:this.props.initiallyMute?0:100,showReportingOverlay:!1},this.debouncedButtonsFadeOut=_.debounce(()=>{!this.cancelVideoFadeOut&&this.bottomButtons&&(this.bottomButtons.style.opacity="0",this.cancelVideoFadeOut=!1)},o),this.subscribeToFullscreenEvents()}subscribeToFullscreenEvents(){document.addEventListener("fullscreenchange",this.onFullSreenChange.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullSreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullSreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.onFullSreenChange.bind(this))}onFullSreenChange(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement?this.setState({fullscreen:!0}):this.setState({fullscreen:!1})}render(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"video-player-component",ref:this.getPlayer.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseLeave:this.handleMouseLeave.bind(this),onClick:this.handleVideoClick.bind(this)},s.createElement("div",{style:this.getWrapperStyle()},this.renderVideo(),this.renderAnnotations(),this.renderReportingOverlay()),this.renderButtons()),void 0!==this.video&&this.props.debuggingMode?s.createElement(s.Fragment,null,s.createElement("span",null," current time for data science: ",this.video.currentTime," "),s.createElement("a",{onClick:()=>{window.open("about:blank","","_blank").document.write(this.props.ffmpegScript)},style:{cursor:"pointer"}},"download script"),s.createElement("a",{onClick:()=>{const e=window.open("about:blank","","_blank"),t=this.props.ffmpegScript.split(";")[2],i=t.substring(7,t.length-14);e.document.write(i)},style:{cursor:"pointer"}},"download filter only"),s.createElement("a",{href:this.props.videoUrl},"download original video")):"")}renderReportingOverlay(){return this.state.showReportingOverlay?s.createElement("div",{onClick:e=>{e.stopPropagation()},style:{position:"absolute",width:"100%",height:"100%",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.75)",display:"flex",flexFlow:"column",color:"snow",justifyContent:"center",alignItems:"center",fontSize:"0.9em",zIndex:10}},s.createElement("div",{style:{marginBottom:"12px",width:"200px",maxWidth:"100%",border:"1px solid snow",padding:"8px 12px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",borderRadius:"5px",backgroundColor:"rgba(0,0,0,0.33)",boxShadow:"0px 0px 55px 5px rgba(100,100,100,0.45)"},onClick:async e=>{e.stopPropagation(),await window.tw.inject("restFormService").postRForm("dev_image_recognition_reporting","send",{article_url:this.props.articleUrl,timestamp:Math.round(1e3*this.video.currentTime),confidence:this.confidence,type:"video",cache_info_key:this.props.cacheInfoKey}),this.setState({showReportingOverlay:!1})}},s.createElement("i",{className:"fa fa-exclamation",style:{marginRight:"15px",padding:"4px 7px 2px 7px",border:"1px solid snow",borderRadius:"4px"}}),s.createElement("div",{style:{float:"right"}},this.props.reportButtonLabel)),s.createElement("div",{style:{cursor:"pointer"},onClick:e=>{e.stopPropagation(),this.setState({showReportingOverlay:!1})}},this.props.cancelReportButtonLabel)):void 0}handleMouseMove(){this.bottomButtons&&(this.bottomButtons.style.opacity="1",this.cancelVideoFadeOut||this.debouncedButtonsFadeOut())}handleMouseLeave(){this.bottomButtons&&(this.bottomButtons.style.opacity="0",this.cancelVideoFadeOut=!0,setTimeout(()=>this.cancelVideoFadeOut=!1,o))}handleVideoClick(e){this.togglePlaying(),this.handleMouseMove()}getWrapperStyle(){const e={width:"auto",height:"auto",position:"relative"};if(this.video){const t=this.video.videoHeight>=this.video.videoWidth;e.width=t?"auto":"100%",e.height=t?"100%":"auto"}return e}renderVideo(){return s.createElement("video",{style:{maxHeight:this.state.fullscreen?"":700,maxWidth:this.state.fullscreen?"":1e3}},s.createElement("source",{src:this.props.videoUrl,type:"video/mp4"}))}getPlayer(e){e&&(this.player||(this.player=e),this.video||this.initializeVideo())}initializeVideo(){this.video=this.player.querySelector("video"),this.video&&(this.video.volume=this.props.initiallyMute?0:1,this.subscribeToVideoEvents(),this.startVideo())}startVideo(){this.video.play(),this.setState({playing:!0})}subscribeToVideoEvents(){this.video.ontimeupdate=(()=>{this.onTimeUpdate()}),this.videoUpdateIntervalId=setInterval(()=>{this.onTimeUpdate()},50),this.video.oncanplay=(()=>{this.onCanPlay()}),this.video.onplay=(()=>{this.onPlay()}),this.video.onpause=(()=>{this.onPause()})}onTimeUpdate(){const e=this.video.currentTime/this.video.duration;this.state.progress!==e&&this.setState({progress:e,handlePosition:this.state.handleDraggingOn?this.state.handlePosition:100*e})}onCanPlay(){this.setState({duration:Math.ceil(this.video.duration)})}onPlay(){this.state.playing||this.setState({playing:!0})}onPause(){this.state.playing&&this.setState({playing:!1})}renderButtons(){return this.video?s.createElement("div",{className:"buttons"},this.renderPlayIndicator(),this.renderReportButton(),this.renderBottomButtons()):void 0}renderPlayIndicator(){return s.createElement("div",{className:"play-button",ref:e=>this.playButton=e},s.createElement("span",null,this.state.playing?this.renderPlayButton():this.renderPauseButton()))}renderReportButton(){return this.state.showReportingOverlay?void 0:s.createElement("i",{className:"fa fa-exclamation video-report-button",onClick:e=>{e.stopPropagation(),this.state.showReportingOverlay||(this.state.playing&&this.togglePlaying(),this.setState({showReportingOverlay:!0}))},onMouseEnter:e=>{this.openTooltip(e,this.props.reportButtonTooltip)},onMouseLeave:()=>{this.closeTooltip()}})}renderBottomButtons(){return s.createElement("div",{className:"bottom-buttons",ref:e=>this.bottomButtons=e,onClick:e=>e.stopPropagation(),onMouseEnter:()=>this.cancelVideoFadeOut=!0,onMouseLeave:()=>this.cancelVideoFadeOut=!1},this.renderPlayPauseButton(),this.renderTime(),this.renderSlider(),this.renderVolumeButton(),this.renderFullscreenButton())}renderPlayPauseButton(){return s.createElement("span",{className:"play-pause-button",onClick:this.togglePlaying.bind(this)},this.state.playing?this.renderPauseButton():this.renderPlayButton())}togglePlaying(){this.playButton.style.transition="transform 333ms ease-in",$(this.playButton).addClass("activated-play-button"),setTimeout(()=>{this.playButton.style.transition="none",$(this.playButton).removeClass("activated-play-button")},333),this.state.playing?this.video.pause():this.video.play()}renderPauseButton(){return s.createElement("i",{className:"fa fa-pause","aria-hidden":"true"})}renderPlayButton(){return s.createElement("i",{className:"fa fa-play","aria-hidden":"true"})}renderTime(){return this.state.duration>0?s.createElement("div",{className:"time"},s.createElement("span",{className:"current-time"}," ",this.calculateCurrentTime()," "),"/ ",this.calculateDuration()):s.createElement("div",{className:"time"},"A/A")}calculateCurrentTime(){return this.formatTime(this.state.duration*this.state.progress)}calculateDuration(){return this.formatTime(this.state.duration)}formatTime(e){return n(1e3*e).format("mm:ss")}renderSlider(){return s.createElement("div",{className:"video-slider-wrapper"},s.createElement("div",{className:"handle",onMouseDown:this.handleDragStart.bind(this),style:{left:`${this.state.handlePosition}%`}}),this.renderIndicators(),s.createElement("div",{className:"video-slider",onMouseDown:this.handleVideoSliderClick.bind(this)}))}handleDragStart(e){e.preventDefault(),this.handleVideoSliderDragAndDrop(e.target.parentElement.getBoundingClientRect())}handleVideoSliderDragAndDrop(e){if(!this.state.handleDraggingOn){this.setState({handleDraggingOn:!0});const t=t=>{t.preventDefault();const i=Math.min(e.width,Math.max(0,t.clientX-e.left))/e.width*100;this.video.currentTime=this.video.duration*i/100,this.state.handlePosition!==i&&this.setState({handlePosition:i})};document.body.addEventListener("mousemove",t);const i=e=>{e.preventDefault(),this.setState({handleDraggingOn:!1}),document.body.removeEventListener("mouseup",i),document.body.removeEventListener("mousemove",t)};document.body.addEventListener("mouseup",i)}}renderIndicators(){return s.createElement("div",{className:"indicators"},s.createElement("div",{style:{position:"relative",height:"1px",width:"100%"}},this.props.boundingBoxIndicators.map(e=>s.createElement("div",{className:"bounding-box-indicator",key:e.from+e.to,style:this.getBoundingBoxIndicatorStyle(e)})),this.renderProgressIndicator()))}getBoundingBoxIndicatorStyle(e){const t=this.timestampToPercentage(e.from);return{left:t+"%",width:this.timestampToPercentage(e.to)-t+"%"}}timestampToPercentage(e){return Math.min(100/this.video.duration*e,100)}renderProgressIndicator(){return s.createElement("div",{className:"progress-indicator",style:{width:100*this.state.progress+"%"}})}handleVideoSliderClick(e){e.preventDefault();const t=e.target.getBoundingClientRect(),i=Math.min(t.width,Math.max(0,e.clientX-t.left))/t.width*100;this.video.currentTime=this.video.duration*i/100,this.setState({handlePosition:i}),this.handleVideoSliderDragAndDrop(t)}renderVolumeButton(){return s.createElement("span",{style:{position:"relative",top:"1px",width:"18px"},onMouseEnter:()=>this.setState({volumeControlOpen:!0}),onMouseLeave:()=>this.setState({volumeControlOpen:!1})},s.createElement("i",{className:`fa ${this.getVolumeIcon()} volume-button`,onClick:()=>this.toggleMute()}),this.renderVolumeControl())}getVolumeIcon(){const{volume:e}=this.video;return 0===e?"fa-volume-off":e<=.333?"fa-volume-down":"fa-volume-up"}toggleMute(){this.previousVolume&&0===this.video.volume?(this.video.volume=this.previousVolume,this.previousVolume=void 0):0===this.video.volume?this.video.volume=1:(this.previousVolume=this.video.volume,this.video.volume=0),this.setState({volumeHandlePosition:100*this.video.volume})}renderVolumeControl(){return s.createElement("div",{className:`volume-control ${this.state.volumeControlOpen?"open":""}`},s.createElement("div",{className:"volume-slider",onMouseDown:this.handleVolumeSliderClick.bind(this),ref:e=>this.volumeSlider=e},s.createElement("div",{className:"volume-handle",style:this.getVolumeHandleStyle()}),s.createElement("div",{className:"volume-indicator",style:this.getVolumeIndicatorStyle()})))}handleVolumeSliderClick(e){e.preventDefault(),e.stopPropagation();const t=this.volumeSlider.getBoundingClientRect(),i=100-Math.min(t.height,Math.max(0,e.clientY-t.top))/t.height*100;this.video.volume=i/100,this.setState({volumeHandlePosition:i}),this.handleVolumeSliderDragAndDrop(t)}handleVolumeSliderDragAndDrop(e){const t=t=>{t.preventDefault();const i=100-Math.min(e.height,Math.max(0,t.clientY-e.top))/e.height*100;this.video.volume=i/100,this.setState({volumeHandlePosition:i})};document.body.addEventListener("mousemove",t);const i=e=>{e.preventDefault(),document.body.removeEventListener("mouseup",i),document.body.removeEventListener("mousemove",t)};document.body.addEventListener("mouseup",i)}getVolumeHandleStyle(){return{bottom:`${this.state.volumeHandlePosition}%`}}getVolumeIndicatorStyle(){return{height:`${this.state.volumeHandlePosition}%`}}renderFullscreenButton(){return s.createElement("i",{style:{display:"none"},className:"fa fa-arrows-alt fullscreen-button",onClick:this.toggleFullscreen.bind(this)})}toggleFullscreen(){this.state.fullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():this.player.requestFullscreen?this.player.requestFullscreen():this.player.mozRequestFullScreen?this.player.mozRequestFullScreen():this.player.webkitRequestFullscreen?this.player.webkitRequestFullscreen():this.player.msRequestFullscreen&&this.player.msRequestFullscreen()}renderAnnotations(){const{annotations:e}=this.props;if(this.video&&e){const t=this.getIndexOfClosestTimePoint();if(void 0!==t)return this.renderBoundingBoxes(e.occurences[t])}}getIndexOfClosestTimePoint(){let e=void 0,t=Number.MIN_SAFE_INTEGER;const{occurences:i=[]}=this.props.annotations;return i.forEach((i,s)=>{const n=i.timestamp-this.video.currentTime;n<=0&&n>t&&(t=n,e=s)}),e}renderBoundingBoxes(e){if(e&&e.boxes)return s.createElement(s.Fragment,null,e.boxes.map(e=>this.renderSingleBoundingBox(e)))}renderSingleBoundingBox(e){return this.confidence=e.confidence,s.createElement("div",{className:"bounding-box",style:this.getBoundingBoxStyle(e),key:_.uniqueId()})}getBoundingBoxStyle(e){const{top:t,left:i,width:s,height:n,color:r}=e;return{left:100*i+"%",width:100*s+"%",top:100*t+"%",height:100*n+"%",borderColor:r}}componentDidMount(){r.eventBus.subscribe(r.EVENT_TYPES.SET_VIDEO_PLAYER_TO_TIMESTAMP,e=>{this.video.currentTime=e.value;const t=this.video.currentTime/this.video.duration;this.state.progress!==t&&this.setState({progress:t,handlePosition:this.state.handleDraggingOn?this.state.handlePosition:100*t})})}componentWillUnmount(){if(clearInterval(this.videoUpdateIntervalId),this.video){const e=0===this.video.volume;window.tw.inject("restFormService").postRForm("video_annotations","update",{muted:e})}this.closeTooltip()}openTooltip(e,t){void 0!==t&&r.eventBus.dispatch({type:r.EVENT_TYPES.BUBBLE_DIALOG_CREATE,value:{id:"tooltip",targetElement:e.target,type:"tooltip",payload:{message:t},placement:"bottom"}})}closeTooltip(){r.eventBus.dispatch({type:r.EVENT_TYPES.BUBBLE_DIALOG_DESTROY,value:{id:"tooltip"}})}componentDidUpdate(){this.state.showReportingOverlay&&this.closeTooltip()}}}),define("video_player",["require","exports","components/video_player_component"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i)}),define("controllers/widget_mediator",["require","exports","reusable_utilities","log"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.REDRAW_FRAGMENT="REDRAW_FRAGMENT"}(t.WIDGET_MEDIATOR_BASE_MESSAGES||(t.WIDGET_MEDIATOR_BASE_MESSAGES={}));class n{constructor(){this.listeners={},this.pipes={},this.cancellationToken=new i.CancellationToken,this.cancellationToken.addCleanupFunction(()=>{this.pipes=void 0,this.listeners=void 0})}dispatch(e,t,i="default"){if(this.cancellationToken.throwIfCancelled("attempting to dispatch on disposed mediator"),s.logService.debug(`Widget mediator dispatch ${e}`,{name:"WIDGET_MEDIATOR"},t),n.debugMonitoring&&this.logDispatch(e,t,i),this.getListeners(e,i).forEach(s=>s.callback(t,e,i)),this.pipes[i])this.pipes[i].forEach(i=>{i.targetMediator.dispatch(e,t,i.targetChannel)});else if("*"===i)for(const i in this.pipes)this.pipes[i].forEach(i=>{i.targetMediator.dispatch(e,t,i.targetChannel)});return this}broadcast(e,t){return this.dispatch(e,t,"*")}pipe(e,t,i=e,s=!1){void 0===this.pipes[e]&&(this.pipes[e]=[]);const n={targetMediator:t,targetChannel:i};return t.cancellationToken.addCleanupFunction(()=>{if(void 0===this.pipes)return;const t=this.pipes[e].indexOf(n);t>-1&&this.pipes[e].splice(t,1)}),this.pipes[e].push(n),s&&t.pipe(i,this,e,!1),this}listenToMany(e,t,i={}){return e.forEach(e=>this.listen(e,t,i)),this}listen(e,t,i={}){this.cancellationToken.throwIfCancelled("attempting to listen on disposed mediator"),i.channelFilter=i.channelFilter||"*",void 0===this.listeners[i.channelFilter]&&(this.listeners[i.channelFilter]={}),void 0===this.listeners[i.channelFilter][e]&&(this.listeners[i.channelFilter][e]=[]);const s={callback:t};return this.listeners[i.channelFilter][e].push(s),i.token&&i.token.addCleanupFunction(()=>{if(void 0===this.listeners)return;const t=this.listeners[i.channelFilter][e].indexOf(s);t>-1&&this.listeners[i.channelFilter][e].splice(t,1)}),this}dispose(){this.cancellationToken.cancel()}isDisposed(){return this.cancellationToken.isCanceled()}logDispatch(e,t,i){n.debugLogs.push({dispatchSource:this,message:t,messageId:e,channel:i,timeStamp:performance.now(),listeners:this.getListeners(e,i),stackTrace:s.logService.getStackTrace(2)})}getListeners(e,t){this.cancellationToken.throwIfCancelled("attempting to getListeners on disposed mediator");const i=[];return"*"===t?(Object.keys(this.listeners).forEach(t=>{this.listeners[t][e]&&i.push(...this.listeners[t][e])}),i):(this.listeners[t]&&this.listeners[t][e]&&i.push(...this.listeners[t][e]),this.listeners["*"]&&this.listeners["*"][e]&&i.push(...this.listeners["*"][e]),i)}}n.debugLogs=[],n.debugMonitoring=!1,t.WidgetMediator=n}),define("fragments/interfaces/fragment_dimensions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("widget_layout_data",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("fragments/portable/portable_fragment",["require","exports","reusable_utilities","widget_manager"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PortableFragment=class{constructor(e,t,i){this.fragmentConstructor=e,this.buildConfiguration=t,this.fragmentStyleFactory=i}async deploy(e){const t={widget:e.payload,buildConfiguration:this.buildConfiguration,subFragments:{}},n=new this.fragmentConstructor(t),r={style:this.fragmentStyleFactory(n),layout:void 0,dimensions:e.dimensions,widthMode:s.WidgetWidthMode.FIXED,heightMode:s.WidgetHeightMode.LEGACY,animationStrategy:e.animationStrategy,animationDuration:e.animationDuration};return await n.initialize(e.rootNode,e.mediator,r,new i.CancellationToken),e.cleanUp&&e.cleanUp.registerCleanupFunction(()=>$(e.rootNode).empty()),{fragment:n,model:t,drawSettings:r}}}}),define("fragments/interfaces/widget_fragment_model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("fragments/model/model_creator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("fragments/model/default_model_creator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultModelCreator=class{initialize(e){return e}update(e,t){return t}}}),define("fragments/fragment_wrapper",["require","exports","log","widget_manager","fragments/model/default_model_creator"],function(e,t,i,s,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.INITIALIZED=1]="INITIALIZED",e[e.DISPOSED=2]="DISPOSED"}(r=t.FragmentState||(t.FragmentState={}));t.FragmentWrapper=class{constructor(e){this.fragment=e,void 0===this.fragment.modelCreator&&(this.fragment.modelCreator=new n.DefaultModelCreator),this.state=r.UNINITIALIZED}initialize(e,t,i,s){return this.fragment.initialize(e,t,i,s).then(e=>(this.state=r.INITIALIZED,e))}update(e,t){return this.state===r.INITIALIZED?(this.generatedModel?this.generatedModel=this.fragment.modelCreator.initialize(e):this.generatedModel=this.fragment.modelCreator.update(this.generatedModel,e),this.fragment.update(this.generatedModel,t)):Promise.resolve(this.fragment)}draw(e,t){return this.state===r.INITIALIZED?e.heightMode!==s.WidgetHeightMode.FIXED||0!==e.dimensions.width&&0!==e.dimensions.height?this.fragment.draw(e,t):Promise.resolve(this.fragment):(i.logService.warn("draw called on widget before it was initialized",{name:"WIDGET"}),Promise.resolve(this.fragment))}dispose(){if(this.state!==r.DISPOSED){try{this.fragment.dispose()}catch(e){i.logService.error("Failed to properly dispose of fragment",{name:"WIDGET"},e)}this.generatedModel=void 0,this.state=r.DISPOSED}}getLayoutIterator(){const e=this.fragment.getLayoutIterator();if(void 0===e)throw new Error(`${Object.getPrototypeOf(this.fragment).constructor.name} does not implement getLayoutIterator\n                  correctly. Returns undefined`);return e}getXOrder(){return this.fragment.getXOrder?this.fragment.getXOrder():0}getYOrder(){return this.fragment.getYOrder?this.fragment.getYOrder():0}unwrap(){return this.fragment}}}),define("fragments/fragment_layout_strategies/fragment_layout_strategy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("fragments/fragment_layout_strategies/computed_fragment_layout",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ComputedFragmentLayout=class{constructor(e,t){this.fragments=e,this.divisions=t}}}),define("widget_manager",["require","exports","event","log","map","reusable_utilities","controllers/widget_mediator","fragments/fragment_wrapper","underscore","jquery","event_bus"],function(e,t,i,s,n,r,o,a,l,c,d){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FULLSCREEN=0]="FULLSCREEN",e[e.FIXED=1]="FIXED"}(t.WidgetWidthMode||(t.WidgetWidthMode={})),function(e){e[e.NEW_DATA=0]="NEW_DATA",e[e.DATA_CHANGED=1]="DATA_CHANGED",e[e.MORE_DATA=2]="MORE_DATA"}(t.DataAction||(t.DataAction={})),t.REPLAY_ACTIONS={PROGRESS:"REPLAY_PROGRESS",STEP:"REPLAY_STEP"},function(e){e[e.FLEXIBLE=0]="FLEXIBLE",e[e.FULLSCREEN=1]="FULLSCREEN",e[e.FIXED=2]="FIXED",e[e.LEGACY=3]="LEGACY"}(h=t.WidgetHeightMode||(t.WidgetHeightMode={}));const u={LEGEND_MOUSEENTER:d.EVENT_TYPES.GLOBAL_LEGEND_MOUSEENTER,LEGEND_MOUSELEAVE:d.EVENT_TYPES.GLOBAL_LEGEND_MOUSELEAVE,LEGEND_MOUSECLICK:d.EVENT_TYPES.GLOBAL_LEGEND_MOUSECLICK,WIDGET_MOUSEENTER:d.EVENT_TYPES.GLOBAL_WIDGET_MOUSEENTER,WIDGET_MOUSELEAVE:d.EVENT_TYPES.GLOBAL_WIDGET_MOUSELEAVE};t.WidgetManager=class{constructor(e,t,s){this.id=l.uniqueId(),this.widgetDomNode=e,this.config=t,this.cancellationToken=new r.CancellationToken,this.mediator=new o.WidgetMediator,this.mediator.listen(o.WIDGET_MEDIATOR_BASE_MESSAGES.REDRAW_FRAGMENT,e=>{this.enqueue(this.currentSettings,[this.currentData.keys().find(({fragment:t})=>t===e)])}),this.onWidgetSizeCalculated=new i.Event,this.cancellationToken.registerDisposable(this.mediator),this.fragments=l.mapObject(s,(e,t)=>e.map(e=>new a.FragmentWrapper(e))),Object.values(s).forEach(t=>{const i=c('<div class="widget-division"></div>');e.append(i),l.uniq(t.map(e=>e.getXOrder?e.getXOrder():0)).forEach(e=>{i.append(c('<div class="widget-column"></div>'))})}),t.shouldEnableGlobalLegendMessages&&this.enableGlobalLegendMessages()}resetLegendClickStates(){this.config.shouldEnableGlobalLegendMessages&&(this.legendClickedId&&d.eventBus.dispatch({type:d.EVENT_TYPES.GLOBAL_LEGEND_MOUSECLICK,value:{message:this.legendClickedId,widgetManagerId:this.id}}),this.legendClickedId=void 0)}enableGlobalLegendMessages(){let e=!1;this.mediator.listenToMany(["LEGEND_MOUSEENTER","LEGEND_MOUSELEAVE","LEGEND_MOUSECLICK","WIDGET_MOUSEENTER","WIDGET_MOUSELEAVE"],(t,i,s)=>{if(!e){"LEGEND_MOUSECLICK"===i&&(this.legendClickedId===t?this.legendClickedId=void 0:this.legendClickedId=t);const e=(()=>{if("default"===s)return u[i]})();e&&d.eventBus.dispatch({type:e,value:{message:t,widgetManagerId:this.id}})}e=!1}),this.cancellationToken.addCleanupFunction(d.eventBus.subscribeToMany(l.toArray(u),({type:t,value:i})=>{const{message:s,widgetManagerId:n}=i;if(this.id!==n){const i=l.invert(u)[t];switch(this.mediator.dispatch(i,s,"global"),i){case"WIDGET_MOUSEENTER":e=!0,d.eventBus.dispatch({type:d.EVENT_TYPES.IGNORE_NEXT_POPOVER_CLOSE,value:{}}),this.mediator.dispatch("LEGEND_MOUSEENTER",s);break;case"WIDGET_MOUSELEAVE":e=!0,this.mediator.dispatch("LEGEND_MOUSELEAVE",s)}}}).unsubscribe)}initialize(e){s.logService.debug("initilizating all fragments",{name:"WIDGET"},this);const t=this.invokeOnFragments("initialize",!0,{drawSettings:e,domNode:this.widgetDomNode,cancellationToken:this.cancellationToken},this.mediator);return Promise.all(t)}update(e,t){s.logService.debug("updating all fragments",{name:"WIDGET"},this);const i=l.invoke(l.flatten(Object.values(this.fragments)),"update",e,t);return Promise.all(i)}unqueue(){requestAnimationFrame(()=>{this.cancellationToken.isCanceled()||(this.nextDraw&&!this.nextDraw.isPartial&&this.currentDraw&&!this.currentDraw.drawToken.isCanceled()?this.currentDraw.drawToken.cancel():this.nextDraw&&!this.currentDraw&&(this.nextDraw.draw(),this.currentDraw=this.nextDraw,this.nextDraw=void 0))})}enqueue(e,t){const i=new Promise(i=>{const n=void 0!==t,o=new r.CancellationToken;if(this.nextDraw){if(!this.nextDraw.isPartial&&n)return o.cancel(),void i();o.chain(this.nextDraw.drawToken)}o.addCleanupFunction(()=>{i()}),this.cancellationToken.chain(o),this.nextDraw={draw:()=>{let i=!1;const n=()=>{i||(o.isCanceled()||o.cancel(),this.currentDraw&&this.currentDraw.drawToken===o&&(this.currentDraw=void 0),this.unqueue()),i=!0},r=t?t.map(e=>this.invokeOnFragment("draw",!1,o,e,this.currentData)):this.invokeOnFragments("draw",!1,{domNode:this.widgetDomNode,drawSettings:e,cancellationToken:o});let a;requestAnimationFrame(()=>{i||(a=setTimeout(()=>{s.logService.warn("One or more fragment draw calls timed out."),n()},e.animationDuration>0?3*e.animationDuration:3e3))}),Promise.all(r).then(()=>{a&&clearTimeout(a),n()})},drawToken:o,isPartial:n}});return this.unqueue(),i}draw(e){return this.cancellationToken.isCanceled()?Promise.resolve(void 0):(this.resetLegendClickStates(),this.currentSettings=e,s.logService.debug("drawing all fragments",{name:"WIDGET"},this),this.enqueue(e))}dispose(){this.resetLegendClickStates(),s.logService.debug("disposing all fragments",{name:"WIDGET"},this),this.currentDraw&&!this.currentDraw.drawToken.isCanceled()&&this.currentDraw.drawToken.cancel(),l.invoke(l.flatten(Object.values(this.fragments)),"dispose"),this.widgetDomNode.empty(),this.cancellationToken.cancel(),this.currentData.clear()}invokeOnFragment(e,t,i,s,n,...r){const{drawSettings:o,domNode:a}=n.get(s),l=[];return t&&l.push(a),l.push(...r),l.push(o),i&&l.push(i),s[e](...l)}invokeOnFragments(e,t,i,...s){const n=[],[r,o]=this.createDrawSettings(i,i.drawSettings.fragmentMetadata,this.config.layoutStrategy);return this.currentData&&this.currentData.clear(),this.currentData=r,o.forEach(o=>{n.push(this.invokeOnFragment(e,t,i.cancellationToken,o,r,...s))}),n}getMediator(){return this.mediator}createDrawSettings(e,t,i){let s=e.drawSettings.idealSize.width;const r=e.drawSettings.idealSize.height;e.drawSettings.hasMargin&&(s-=40);const o=i.positionFragments(this.fragments,{widthMode:this.config.widthMode,heightMode:this.config.heightMode,availableSpace:{width:s,height:r}},t),a={width:Math.max(...o.fragments.map(e=>e.dimensions.x+e.dimensions.width)),height:Math.max(...o.fragments.map(e=>e.dimensions.y+e.dimensions.height))};this.onWidgetSizeCalculated.fire(a);let l=void 0;const c=[],d=new n.Map;return o.divisions.forEach((t,i)=>this.applyDivisionStyle(e.domNode[0].children[i],t,this.config.heightMode)),o.fragments.forEach(t=>{if(e.domNode&&document.contains(e.domNode[0])){const i=e.domNode[0].children[t.divisionIndex].children[t.columnIndex];l=i}d.set(t.fragment,{drawSettings:{animationStrategy:e.drawSettings.animationStrategy,animationDuration:e.drawSettings.animationDuration,dimensions:t.dimensions,layout:t.layout,style:t.style,widthMode:this.config.widthMode,heightMode:this.config.heightMode},domNode:l}),c.push(t.fragment)}),[d,c]}applyDivisionStyle(e,t,i){i!==h.LEGACY&&(t.height>0?e.style.height=`${t.height}px`:e.style.height="100%"),t.columns.forEach((t,s)=>{const n=e.children[s];n.style.setProperty("width",`${t.width}px`,"important"),n.style.setProperty("min-width",`${t.width}px`,"important"),n.style.setProperty("max-width",`${t.width}px`,"important"),i!==h.LEGACY&&(t.height>0?(n.style.setProperty("height",`${t.height}px`,"important"),n.style.setProperty("min-height",`${t.height}px`,"important"),n.style.setProperty("max-height",`${t.height}px`,"important")):(n.style.setProperty("height","100%","important"),n.style.setProperty("min-height","100%","important"),n.style.setProperty("max-height","100%","important")))})}}}),define("fragments/interfaces/widget_fragment_draw_settings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE",e[e.EXTRA_LARGE=3]="EXTRA_LARGE"}(t.FontSize||(t.FontSize={}))}),define("layout_iterator",["require","exports","reusable_utilities"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LayoutIterator=class extends i.Iterator{constructor(e,t){super(e),this.dimensionFactory=t}next(){const e=super.next();return new s(e,this.dimensionFactory)}};class s{constructor(e,t){this.layout=e,this.dimensionFactory=t}compute(e){const t=this.dimensionFactory(e);return{dimensions:t,layout:this.layout,overflow:this.isOverflowing(e,t)}}isOverflowing(e,t){return void 0!==e.dimensions.width&&e.dimensions.width<t.width||void 0!==e.dimensions.height&&e.dimensions.height<t.height}}t.LayoutIteratorValue=s}),define("fragments/interfaces/widget_fragment_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("fragments/fragment_layout_strategies/default_fragment_layout_strategy",["require","exports","data_structures","math_utils","widget_manager","fragments/fragment_layout_strategies/computed_fragment_layout","underscore"],function(e,t,i,s,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultFragmentLayoutStrategy=class{constructor(e={}){const{minimumChartSize:t=250}=e;this.minimumChartSize=t}positionFragments(e,t,i){const s=this.createGrid(e),n=this.pickLayouts(s,t,i);return this.calculateSizes(t,n),this.createDrawSettings(n,t,i)}calculateSizes(e,t){let i,s,n=0,r=0;const a=o.clone(e.availableSpace);t.getData().forEach(t=>{i=this.calculateSpaceSubdivision(this.extractSizeParametersForDivision(t.map(e=>e.map(e=>e.fragment))),a.width),t.forEach((t,o)=>{s=this.calculateSpaceSubdivision(t.map(e=>({priority:e.layout.heightScalePriority,minSize:e.dimensions.height||e.layout.minHeight})),a.height),t.forEach((t,n)=>{t.dimensions.width=this.fragmentWidthCalculationStrategy(t,i[o]),t.dimensions.height=this.fragmentHeightCalculationStrategy(e,t,a,s[n]),r+=t.dimensions.height}),n=Math.max(r,n),r=0}),a.height-=n})}fragmentWidthCalculationStrategy(e,t){return Math.max(t,e.layout.minWidth)}fragmentHeightCalculationStrategy(e,t,i,s){return e.heightMode===n.WidgetHeightMode.LEGACY&&1===t.layout.heightScalePriority&&s<this.minimumChartSize?Math.max(this.minimumChartSize,t.layout.minHeight):Math.max(t.dimensions.height,s,t.layout.minHeight)}createDrawSettings(e,t,i){let n=0,o=0,a=0,l=0,c=0,d=0,h=0,u=0;const p=[];let g=[];const m=e.mapZ((e,r,m,_,f,y)=>{n===f&&o===y||(g.push({width:d,height:h}),a+=d,h=0,d=0,l=u,n=f),o!==y&&(p.push({columns:g,height:c}),g=[],a=0,o=y,d=0,h=0,l=u+=c);const b={fragment:e.fragment,dimensions:new s.Rectangle(new s.Vector2D(a,l),e.dimensions.width,e.dimensions.height),layout:e.layout,divisionIndex:y,columnIndex:f,style:i.get(e.fragment.unwrap()),heightMode:t.heightMode,widthMode:t.widthMode};return d=Math.max(d,e.dimensions.width),h+=e.dimensions.height,c=Math.max(c,h),l+=e.dimensions.height,b}).flatten();return g.push({width:d,height:h}),p.push({columns:g,height:c}),this.applyMargins(m),new r.ComputedFragmentLayout(m,p)}applyMargins(e){e.forEach(e=>{const{left:t=0,right:i=0,top:s=0,bottom:n=0}=e.style.margin;e.dimensions.width-=i,e.dimensions.height-=n,e.dimensions.x+=t,e.dimensions.y+=s})}createGrid(e){const t=Object.values(e);return new i.CubicArray(t.map(e=>{const t=this.createColumns(e);let i=0;e.sort((e,t)=>e.getXOrder()-t.getXOrder());let s=o.first(e).getXOrder();for(let n=0;n<e.length;n++){const r=e[n].getXOrder();r!==s&&(s=r,i++),t[i].push(e[n])}return t.forEach(e=>e.sort((e,t)=>e.getYOrder()-t.getYOrder())),t}))}pickLayouts(e,t,i){let n;return e.mapZ((e,r,a,l,c,d)=>{let h;return-1!==d&&(n=this.calculateSpaceSubdivision(this.extractSizeParametersForDivision(a),t.availableSpace.width)),h=e.getLayoutIterator().next(),o.assign(h.compute({style:i.get(e.unwrap()),animationStrategy:void 0,animationDuration:void 0,layout:h.layout,heightMode:t.heightMode,widthMode:t.widthMode,dimensions:new s.Rectangle(new s.Vector2D(0,0),n[c],0)}),{fragment:e})})}extractSizeParametersForDivision(e){return e.map(e=>e.map(e=>{const t=e.getLayoutIterator().next().layout;return{priority:t.widthScalePriority||0,minSize:t.minWidth||0}}).reduce((e,t)=>({priority:Math.max(e.priority,t.priority),minSize:Math.max(e.minSize,t.minSize)})))}calculateSpaceSubdivision(e,t){const i=e.reduce((e,t)=>e+(t.minSize||0),0);if(i>t)return e.map(e=>e.minSize);t-=i;const s=e.reduce((e,t)=>e+(t.priority||0),0);let n;if((n=0===s?e.map(e=>e.minSize):e.map(e=>e.minSize+t*((e.priority||0)/s))).filter(e=>isNaN(e)).length>0)throw new Error("NaN or undefined found after space subdivision");return n}createColumns(e){return o.chain(e).map(e=>e.getXOrder()).uniq().map(()=>[]).value()}}}),define("widget_blueprint",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.CROSS_FADE=1]="CROSS_FADE",e[e.FADE_OUT_IN=2]="FADE_OUT_IN",e[e.FLIP=3]="FLIP"}(t.WidgetTransitionType||(t.WidgetTransitionType={}))}),define("controllers/abstract_widget_blueprint_enhancer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractWidgetBlueprintEnhancer=class{enhanceBlueprint(e,t){return e}initialize(e){this.fragments=e}filterWidgetDivisions(e,t){return e}}}),define("fragments/react/abstract_react_fragment",["require","exports","react-dom","event","layout_iterator"],function(e,t,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractReactFragment=class{constructor(e){this.fragmentModel=e,this.onUpdate=new s.Event,this.onDraw=new s.Event}initialize(e,t,i,s){return this.chartContainer=e,this.cancellationToken=s,this.renderIntoContainer(this.onUpdate,this.onDraw,i,t),Promise.resolve(this)}update(e,t){return this.fragmentModel=e,this.onUpdate.fire(e,t),Promise.resolve(this)}draw(e){return this.onDraw.fire(e),Promise.resolve(this)}dispose(){i.unmountComponentAtNode(this.chartContainer)}getLayoutIterator(){return new n.LayoutIterator([{id:"default",widthScalePriority:1,heightScalePriority:1,minHeight:36,minWidth:0}],e=>this.getDimensionsForLayout(e))}getDimensionsForLayout(e){return{width:e.dimensions.width||0,height:e.dimensions.height||0}}getXOrder(){return 0}getYOrder(){return 0}}}),define("fragments/react/abstract_react_fragment_layer",["require","exports","flux"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AbstractFragmentLayer=class extends i.BaseComponent{constructor(e){super(e),this.cancellationToken.subscribe(e.onUpdate,e=>this.update(e)),this.cancellationToken.subscribe(e.onDraw,e=>this.draw(e))}}}),define("widget_base",["require","exports","controllers/abstract_widget_blueprint_enhancer","controllers/widget_mediator","fragments/fragment_layout_strategies/default_fragment_layout_strategy","fragments/interfaces/widget_fragment_draw_settings","fragments/portable/portable_fragment","fragments/react/abstract_react_fragment","fragments/react/abstract_react_fragment_layer","layout_iterator","widget_blueprint","widget_manager"],function(e,t,i,s,n,r,o,a,l,c,d,h){"use strict";function u(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),u(i),u(s),u(n),u(r),u(o),u(a),u(l),u(c),u(d),u(h)});